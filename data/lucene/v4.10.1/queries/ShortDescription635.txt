[PATCH] Decouple locking implementation from Directory implementation