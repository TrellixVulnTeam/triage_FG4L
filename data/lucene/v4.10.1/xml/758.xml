<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:04:29 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-758/LUCENE-758.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[LUCENE-758] IndexReader.isCurrent fails when using two IndexReaders</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-758</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;there is a problem in IndexReader.isCurrent() if using two reader instances where one of them is based on a RAMDirectory. If there is an index and we open two IndexReaders where one is based on a FSDirectory and the other is based on a RAMDirectory, the IndexReader using the RAMDirectory does not recognize when the underlaying index has changed. The method IndexReader.isCurrent() always returns true. The testcase below shows the problem.&lt;/p&gt;

&lt;p&gt;I did not find an ideal solution to solve the problem. I think the best way would be to change the IndexReader.isCurrent() implementation from:&lt;br/&gt;
  public boolean isCurrent() throws IOException &lt;/p&gt;
{
    return SegmentInfos.readCurrentVersion(directory) == segmentInfos.getVersion();
  }
&lt;p&gt;to something like:&lt;br/&gt;
  public boolean isCurrent() throws IOException &lt;/p&gt;
{
    return directory.readCurrentVersion() == segmentInfos.getVersion();
  }
&lt;p&gt;As far as i can see this would work for FS- and RAMDirectory. But then the implementing Directory classes have to know about &quot;segment&quot; files and there formating details.&lt;br/&gt;
What do others think ?&lt;/p&gt;

&lt;p&gt;  /** &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;additional testcase for IndexReaderTest to show the problem when using two different Readers&lt;br/&gt;
   */&lt;br/&gt;
  public void testIsCurrentWithCombined() throws Exception 
{
      String tempDir = System.getProperty(&quot;tempDir&quot;);
      if (tempDir == null)
          throw new IOException(&quot;tempDir undefined, cannot run test&quot;);

      File indexDir = new File(tempDir, &quot;lucenetestiscurrent&quot;);
      Directory fsStore = FSDirectory.getDirectory(indexDir, true);
      
      IndexWriter writer = new IndexWriter(fsStore, new SimpleAnalyzer(), true);
      addDocumentWithFields(writer);
      writer.close();
      
      IndexReader reader1 = IndexReader.open(fsStore);
      IndexReader reader2 = IndexReader.open(new RAMDirectory(fsStore));
      
      assertTrue(reader1.isCurrent());
      assertTrue(reader2.isCurrent());
      
      reader1.deleteDocument(0);
      reader1.close();
      
      // BUG: reader based on the RAMDirectory does not recognize the index change.
      assertFalse(reader2.isCurrent());
      
      reader2.close();
    }&lt;/li&gt;
&lt;/ul&gt;

</description>
                <environment>&lt;p&gt;Operating System: other&lt;br/&gt;
Platform: other&lt;/p&gt;</environment>
        <key id="12359286">LUCENE-758</key>
            <summary>IndexReader.isCurrent fails when using two IndexReaders</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="bmesser">Bernhard Messer</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Dec 2006 12:40:38 +0000</created>
                <updated>Mon, 1 Jan 2007 13:49:47 +0000</updated>
                            <resolved>Mon, 1 Jan 2007 13:49:47 +0000</resolved>
                                    <version>2.1</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12460555" author="mikemccand" created="Fri, 22 Dec 2006 17:50:12 +0000"  >&lt;p&gt;Thank you for the full test case showing the issue!&lt;/p&gt;

&lt;p&gt;However, I believe this is by design.  When you init a RAMDirectory off a current Directory, it makes a full copy of that original Directory and from then on the original &amp;amp; the copy are totally independent.&lt;/p&gt;

&lt;p&gt;So it&apos;s not expected that changes to the original Directory would be reflected in the copy?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 22 Dec 2006 17:50:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12994</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxyvpz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27290</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>