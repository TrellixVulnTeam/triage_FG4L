<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:08:00 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-124/LUCENE-124.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[LUCENE-124] Fuzzy Searches do not get a boost of 0.2 as stated in &quot;Query Syntax&quot; doc</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-124</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                    <description>&lt;p&gt;According to the website&apos;s &quot;Query Syntax&quot; page, fuzzy searches are given a&lt;br/&gt;
boost of 0.2. I&apos;ve found this not to be the case, and have seen situations where&lt;br/&gt;
exact matches have lower relevance scores than fuzzy matches.&lt;/p&gt;

&lt;p&gt;Rather than getting a boost of 0.2, it appears that all variations on the term&lt;br/&gt;
are first found in the model, where dist* &amp;gt; 0.5.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;dist = levenshteinDistance / length of min(termlength, variantlength)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This then leads to a boolean OR search of all the variant terms, each of whose&lt;br/&gt;
boost is set to (dist - 0.5)*2 for that variant.&lt;/p&gt;

&lt;p&gt;The upshot of all of this is that there are many cases where a fuzzy match will&lt;br/&gt;
get a higher relevance score than an exact match.&lt;/p&gt;

&lt;p&gt;See this email for a test case to reproduce this anomalous behaviour.&lt;br/&gt;
&lt;a href=&quot;http://www.mail-archive.com/lucene-dev@jakarta.apache.org/msg02819.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.mail-archive.com/lucene-dev@jakarta.apache.org/msg02819.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here is a candidate patch to address the issue -&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;lucene-1.2\src\java\org\apache\lucene\search\FuzzyTermEnum.java	Sun Jun 09&lt;br/&gt;
13:47:54 2002&lt;/li&gt;
		&lt;/ul&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;lucene-1.2-modified\src\java\org\apache\lucene\search\FuzzyTermEnum.java	Fri&lt;br/&gt;
Mar 14 11:37:20 2003&lt;br/&gt;
***************&lt;/li&gt;
		&lt;/ul&gt;
		&lt;ul&gt;
			&lt;li&gt;99,105 ****&lt;br/&gt;
      }&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;      final protected float difference() &lt;/p&gt;
{
!         return (float)((distance - FUZZY_THRESHOLD) * SCALE_FACTOR);
      }

&lt;p&gt;      final public boolean endEnum() &lt;/p&gt;
{
--- 99,109 ----
      }

&lt;p&gt;      final protected float difference() {&lt;br/&gt;
! 		if (distance == 1.0) &lt;/p&gt;
{
! 			return 1.0f;
! 		}
&lt;p&gt;! 		else&lt;br/&gt;
! 			return (float)((distance - FUZZY_THRESHOLD) * SCALE_FACTOR);&lt;br/&gt;
      }&lt;/p&gt;

&lt;p&gt;      final public boolean endEnum() {&lt;br/&gt;
***************&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;111,117 ****&lt;br/&gt;
       ******************************/&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;      public static final double FUZZY_THRESHOLD = 0.5;&lt;br/&gt;
!     public static final double SCALE_FACTOR = 1.0f / (1.0f - FUZZY_THRESHOLD);&lt;/p&gt;

&lt;p&gt;      /**&lt;br/&gt;
       Finds and returns the smallest of three integers &lt;br/&gt;
&amp;#8212; 115,121 ----&lt;br/&gt;
       ******************************/&lt;/p&gt;

&lt;p&gt;      public static final double FUZZY_THRESHOLD = 0.5;&lt;br/&gt;
!     public static final double SCALE_FACTOR = 0.2f * (1.0f / (1.0f -&lt;br/&gt;
FUZZY_THRESHOLD));&lt;/p&gt;

&lt;p&gt;      /**&lt;br/&gt;
       Finds and returns the smallest of three integers&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: All&lt;br/&gt;
Platform: All&lt;/p&gt;</environment>
        <key id="12314274">LUCENE-124</key>
            <summary>Fuzzy Searches do not get a boost of 0.2 as stated in &quot;Query Syntax&quot; doc</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rcmuir">Robert Muir</assignee>
                                    <reporter username="cormac@siderean.com">Cormac Twomey</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Jul 2003 04:46:44 +0100</created>
                <updated>Fri, 10 May 2013 11:44:25 +0100</updated>
                            <resolved>Mon, 8 Mar 2010 20:39:30 +0000</resolved>
                                    <version>1.2</version>
                                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>core/search</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12321341" author="otis@apache.org" created="Wed, 10 Sep 2003 23:56:36 +0100"  >&lt;p&gt;Cormac, the problem you described at&lt;br/&gt;
&lt;a href=&quot;http://www.mail-archive.com/lucene-dev@jakarta.apache.org/msg02819.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.mail-archive.com/lucene-dev@jakarta.apache.org/msg02819.html&lt;/a&gt; seems clear.&lt;/p&gt;

&lt;p&gt;I do not see any mention of 0.2f boost in any of the &lt;b&gt;Fuzzy&lt;/b&gt; classes.  This is a&lt;br/&gt;
documentation bug, which I will fix soon.&lt;/p&gt;

&lt;p&gt;However, your fix may still be valid, as exact matches should never have lower&lt;br/&gt;
score than fuzzy ones.  I would be very greatful if you could submit that&lt;br/&gt;
levtest class as a JUnit test, so we can see the bug clearly before applying&lt;br/&gt;
your patch.&lt;/p&gt;

&lt;p&gt;Finally, why did you choose the boost of 0.2?  Why not 0.1 or 0.3 for example? &lt;br/&gt;
And is it possible that choosing a random&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; number such as 0.2, will work for&lt;br/&gt;
your test document set, but may not work for some other cases?&lt;/p&gt;

&lt;p&gt;Thank you.&lt;/p&gt;</comment>
                            <comment id="12321342" author="cormac@siderean.com" created="Thu, 11 Sep 2003 02:01:49 +0100"  >&lt;p&gt;I will work on massaging my test case into a JUnit test.&lt;/p&gt;

&lt;p&gt;Meanwhile, I chose the value of 0.2 simply because it is the documented&lt;br/&gt;
behavior, and therefore I considered that to be the expected, even desired,&lt;br/&gt;
behavior. That said, it does appear to be a randomly chosen value, although not&lt;br/&gt;
chosen by me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Following the logic of how the scoring mechanism works (or at least my&lt;br/&gt;
understanding of it), this is not a universal fix, but rather as I state in my&lt;br/&gt;
original email on lucene-dev, it mitigates the problem. I chose the fix simply&lt;br/&gt;
as it brought the functionality in line with documented behavior.&lt;/p&gt;

&lt;p&gt;The essence of the problem is the battle in scoring between levenshtein distance&lt;br/&gt;
 and term frequency - high frequency terms are scored lower than low frequency&lt;br/&gt;
terms. A good example of a low frequency term is a typo in a document. If the&lt;br/&gt;
original correctly spelled word has a very high frequency, the misspelled word&lt;br/&gt;
will come out on top, due to its significantly lower frequency.&lt;/p&gt;

&lt;p&gt;By setting the boost to 0.2, We at least make it 5 times harder (in terms of&lt;br/&gt;
frequency) for the misspelled item to appear ahead of the correctly spelled&lt;br/&gt;
item. But this clearly means that it will still happen.&lt;/p&gt;

&lt;p&gt;--Cormac&lt;/p&gt;</comment>
                            <comment id="12330223" author="markh" created="Fri, 23 Sep 2005 05:49:15 +0100"  >&lt;p&gt;I would suggest this is a duplicate of &lt;a href=&quot;http://issues.apache.org/jira/browse/LUCENE-329&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/LUCENE-329&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The idf rating of expanded terms should be the same and not favour rarer terms. I suggest that this applies to all auto-expanding searches eg range queries.&lt;/p&gt;

&lt;p&gt;Should we drop this bug as a duplicate?&lt;/p&gt;</comment>
                            <comment id="12833856" author="rcmuir" created="Mon, 15 Feb 2010 15:46:33 +0000"  >&lt;p&gt;Here is a patch, with a test for the issue.&lt;/p&gt;

&lt;p&gt;This patch adds TOP_TERMS_CONSTANT_BOOLEAN_REWRITE to complement TOP_TERMS_SCORING_BOOLEAN_REWRITE.&lt;/p&gt;

&lt;p&gt;Note: this solution is different than &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-329&quot; title=&quot;Fuzzy query scoring issues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-329&quot;&gt;LUCENE-329&lt;/a&gt;, but I think this rewrite method could be useful for other queries as well.&lt;/p&gt;

&lt;p&gt;example usage:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
FuzzyQuery query = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FuzzyQuery(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Term(&lt;span class=&quot;code-quote&quot;&gt;&quot;field&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Lucene&quot;&lt;/span&gt;));
query.setRewriteMethod(MultiTermQuery.TOP_TERMS_CONSTANT_BOOLEAN_REWRITE);
ScoreDoc[] hits = searcher.search(query, ...)
 ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12833865" author="rcmuir" created="Mon, 15 Feb 2010 16:02:41 +0000"  >&lt;p&gt;I will wait till after the code freeze and commit this in a few days if no one objects.&lt;/p&gt;

&lt;p&gt;I don&apos;t claim its a &apos;best-practice&apos; fix for fuzzy (see &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-329&quot; title=&quot;Fuzzy query scoring issues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-329&quot;&gt;LUCENE-329&lt;/a&gt; for ideas on that), I just think TOP_TERMS_CONSTANT_BOOLEAN_REWRITE is a useful complement to TOP_TERMS_SCORING_BOOLEAN_REWRITE, for MultiTermQueries that want the Top-N terms expansion, but the constant score behavior of CONSTANT_BOOLEAN_REWRITE.&lt;/p&gt;

&lt;p&gt;this patch doesnt change any defaults for fuzzy either. in fact its not specific to fuzzy at all.&lt;/p&gt;</comment>
                            <comment id="12833885" author="rcmuir" created="Mon, 15 Feb 2010 16:51:15 +0000"  >&lt;p&gt;uwe pointed out to me, i think there is a naming problem with TOP_TERMS_CONSTANT_BOOLEAN_REWRITE, as the entire booleanquery will not produce the same score like CONSTANT_SCORE_BOOLEAN_QUERY_REWRITE. &lt;/p&gt;

&lt;p&gt;I think the behavior makes sense though, as it wouldnt make sense to use TOP_TERMS without per-term boosting, but we need to fix the naming... and TOP_TERMS_BOOST_BOOLEAN_REWRITE sounds confusing.&lt;/p&gt;</comment>
                            <comment id="12834163" author="thetaphi" created="Tue, 16 Feb 2010 11:17:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;I will wait till after the code freeze and commit this in a few days if no one objects. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The code freeze only affects branches. Trunk is only frozen for fixes that should also go into branches.&lt;/p&gt;</comment>
                            <comment id="12834376" author="rcmuir" created="Tue, 16 Feb 2010 18:49:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;The code freeze only affects branches. Trunk is only frozen for fixes that should also go into branches.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;ok, well I will wait on this one anyway especially as there is a concern about naming... no rush, looks like its been open for a long time.&lt;/p&gt;</comment>
                            <comment id="12842768" author="rcmuir" created="Mon, 8 Mar 2010 18:54:32 +0000"  >&lt;p&gt;Attached is an updated patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Synced to trunk as these PQ rewrite methods allow setting of the size&lt;/li&gt;
	&lt;li&gt;Renamed to TopTermsBoostOnlyBooleanQueryRewrite&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Please review, I think this rewrite method would also be helpful for&lt;br/&gt;
improving Fuzzy&apos;s junit tests: Testing that scores are correct, etc.&lt;/p&gt;</comment>
                            <comment id="12842772" author="mikemccand" created="Mon, 8 Mar 2010 19:07:43 +0000"  >&lt;p&gt;Patch looks good Robert!&lt;/p&gt;</comment>
                            <comment id="12842776" author="rcmuir" created="Mon, 8 Mar 2010 19:17:51 +0000"  >&lt;p&gt;Thanks Mike. I will commit later today if no one objects.&lt;/p&gt;</comment>
                            <comment id="12842810" author="rcmuir" created="Mon, 8 Mar 2010 20:39:30 +0000"  >&lt;p&gt;Committed revision 920499.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12314479">LUCENE-329</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12438212" name="LUCENE-124.patch" size="7460" author="rcmuir" created="Mon, 8 Mar 2010 18:54:32 +0000"/>
                            <attachment id="12435881" name="LUCENE-124.patch" size="5066" author="rcmuir" created="Mon, 15 Feb 2010 15:46:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21446</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 10 Sep 2003 22:56:36 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>13626</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Lucene Fields</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10120"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxyzn3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27925</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>