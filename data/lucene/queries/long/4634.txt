It could be convenient to have a streaming API (writers and iterators, no random access) that supports variable numbers of bits per value. Although this would be much slower than the current fixed-size APIs, it could help save bytes in our codec formats.

The API could look like:


Iterator {
  long next(int bitsPerValue);
}

Writer {
  void write(long value, int bitsPerValue); // assert PackedInts.bitsRequired(value) <= bitsPerValue;
}

