The Sorter we use for offline sorting seems to use the MIN_BUFFER_SIZE as a upper bound even if there is more memory available. See this snippet:


long half = free/2;
if (half >= ABSOLUTE_MIN_SORT_BUFFER_SIZE) { 
  return new BufferSize(Math.min(MIN_BUFFER_SIZE_MB * MB, half));
}
      
// by max mem (heap will grow)
half = (max - total) / 2;
return new BufferSize(Math.min(MIN_BUFFER_SIZE_MB * MB, half));



use use use Math.max instead of min here.