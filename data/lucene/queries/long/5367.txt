Hi,

When I use the API as below :


List<CategoryPath> categories = Collections.<CategoryPath>singletonList(new CategoryPath(path.toArray(new String[path.size()])));
FacetFields facetFields = new FacetFields(taxonomyWriter);
facetFields.addFields(document, categories);
taxonomyWriter.commit();


An exception occurs :

java.util.NoSuchElementException
	at java.util.Collections$1.next(Collections.java:3302)
	at org.apache.lucene.facet.index.DrillDownStream.reset(DrillDownStream.java:78)
	at org.apache.lucene.index.DocInverterPerField.processFields(DocInverterPerField.java:97)
	at org.apache.lucene.index.DocFieldProcessor.processDocument(DocFieldProcessor.java:248)
	at org.apache.lucene.index.DocumentsWriterPerThread.updateDocument(DocumentsWriterPerThread.java:253)
	at org.apache.lucene.index.DocumentsWriter.updateDocument(DocumentsWriter.java:453)
	at org.apache.lucene.index.IndexWriter.updateDocument(IndexWriter.java:1520)
	at org.apache.lucene.index.IndexWriter.addDocument(IndexWriter.java:1190)
	at org.apache.lucene.index.IndexWriter.addDocument(IndexWriter.java:1171)

Seems likes this is due to multiple calls to org.apache.lucene.facet.index.DrillDownStream#reset which invoques #next() on an 'used' iterator.

Regards,
Lucien 