There are currently a ton of conditionals checking for various problems, as well as a horribly confusing unbalanced decrement + increment, and in general the code is a nightmare to follow.

To make it worse, besides being confusing it doesnt handle all cases: e.g. a negative position increment gap from the analyzer will just result in total chaos (corruption etc).

I think an easier way to implement this is to init fieldinvertstate.position to -1, and for the logic to be:



  position += posincr;
  check that position >= 0 && position >= lastPosition
  lastPosition = position;

