Turn asserts in I/O related code into hard checks