Upgrade JUnit to 4.10, refactor state-machine of detecting setUp/tearDown call chaining.