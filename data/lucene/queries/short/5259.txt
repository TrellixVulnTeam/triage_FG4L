convert analysis consumers to try-with-resources