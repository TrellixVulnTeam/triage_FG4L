<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:48:39 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-893/ZOOKEEPER-893.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-893] ZooKeeper high cpu usage when invalid requests</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-893</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;When ZooKeeper receives certain illegally formed messages on the internal communication port (:4181 by default), it&apos;s possible for ZooKeeper to enter an infinite loop which causes 100% cpu usage. It&apos;s related to &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-427&quot; title=&quot;ZooKeeper server unexpectedly high CPU utilisation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-427&quot;&gt;&lt;del&gt;ZOOKEEPER-427&lt;/del&gt;&lt;/a&gt;, but that patch does not resolve all issues.&lt;/p&gt;

&lt;p&gt;from: src/java/main/org/apache/zookeeper/server/quorum/QuorumCnxManager.java &lt;/p&gt;

&lt;p&gt;the two affected parts:&lt;br/&gt;
===========&lt;br/&gt;
int length = msgLength.getInt();                                                        &lt;br/&gt;
if(length &amp;lt;= 0) &lt;/p&gt;
{                                                                       
    throw new IOException(&quot;Invalid packet length:&quot; + length);                           
}
&lt;p&gt; &lt;br/&gt;
===========&lt;/p&gt;


&lt;p&gt;===========&lt;br/&gt;
while (message.hasRemaining()) {                                                    &lt;br/&gt;
    temp_numbytes = channel.read(message);                                          &lt;br/&gt;
    if(temp_numbytes &amp;lt; 0) &lt;/p&gt;
{                                                         
        throw new IOException(&quot;Channel eof before end&quot;);                            
    }
&lt;p&gt;                                                                               &lt;br/&gt;
    numbytes += temp_numbytes;                                                      &lt;br/&gt;
} &lt;br/&gt;
===========&lt;/p&gt;

&lt;p&gt;how to replicate this bug:&lt;/p&gt;

&lt;p&gt;perform an nmap portscan against your zookeeper server: &quot;nmap -sV -n your.ip.here -p4181&quot;&lt;br/&gt;
wait for a while untill you see some messages in the logfile and then you will see 100% cpu usage. It does not recover from this situation. With my patch, it does not occur anymore&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux 2.6.16&lt;br/&gt;
4x Intel(R) Xeon(R) CPU X3320  @ 2.50GHz&lt;br/&gt;
java version &quot;1.6.0_17&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_17-b04)&lt;br/&gt;
Java HotSpot(TM) Server VM (build 14.3-b01, mixed mode)&lt;/p&gt;</environment>
        <key id="12476980">ZOOKEEPER-893</key>
            <summary>ZooKeeper high cpu usage when invalid requests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tt">Thijs Terlouw</assignee>
                                    <reporter username="tt">Thijs Terlouw</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Oct 2010 08:15:55 +0100</created>
                <updated>Wed, 23 Nov 2011 19:22:29 +0000</updated>
                            <resolved>Tue, 19 Oct 2010 23:38:09 +0100</resolved>
                                    <version>3.3.1</version>
                                    <fixVersion>3.3.2</fixVersion>
                    <fixVersion>3.4.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <timeoriginalestimate seconds="3600">1h</timeoriginalestimate>
                            <timeestimate seconds="3600">1h</timeestimate>
                                        <comments>
                            <comment id="12919738" author="tt" created="Mon, 11 Oct 2010 08:23:44 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-427&quot; title=&quot;ZooKeeper server unexpectedly high CPU utilisation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-427&quot;&gt;&lt;del&gt;ZOOKEEPER-427&lt;/del&gt;&lt;/a&gt; fixes only part of the problems and still caused problems for me. This solves all my problems&lt;/p&gt;</comment>
                            <comment id="12921103" author="henryr" created="Thu, 14 Oct 2010 21:07:26 +0100"  >&lt;p&gt;Thanks for the patch Thijs! It looks pretty good to me - good catch.&lt;/p&gt;

&lt;p&gt;Do you think you might be able to write a test case that verifies correct behaviour when you send malformed messages to the control port? &lt;/p&gt;</comment>
                            <comment id="12921286" author="tt" created="Fri, 15 Oct 2010 09:41:05 +0100"  >&lt;p&gt;I&apos;ll try to write a test case, but not exactly sure yet how to integrate. Need to look at some example unit tests first &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12922530" author="fpj" created="Tue, 19 Oct 2010 13:08:51 +0100"  >&lt;p&gt;Missing a test.&lt;/p&gt;</comment>
                            <comment id="12922533" author="fpj" created="Tue, 19 Oct 2010 13:10:40 +0100"  >&lt;p&gt;Adding a test and removing an if statement that became unnecessary with this patch from RecvWorker.run(). I&apos;ll be adding a patch for the 3.3 branch shortly.&lt;/p&gt;</comment>
                            <comment id="12922539" author="tt" created="Tue, 19 Oct 2010 13:42:22 +0100"  >&lt;p&gt;Thanks Flavio! I have been too busy to add a testcase and yours looks great!&lt;/p&gt;</comment>
                            <comment id="12922561" author="fpj" created="Tue, 19 Oct 2010 15:06:02 +0100"  >&lt;p&gt;Thanks, Thijs. Adding 3.3 patch. &lt;/p&gt;</comment>
                            <comment id="12922762" author="phunt" created="Tue, 19 Oct 2010 23:38:09 +0100"  >&lt;p&gt;+1 Great work, thanks!&lt;/p&gt;</comment>
                            <comment id="12922910" author="hudson" created="Wed, 20 Oct 2010 11:51:49 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #972 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/ZooKeeper-trunk/972/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/ZooKeeper-trunk/972/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-893&quot; title=&quot;ZooKeeper high cpu usage when invalid requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-893&quot;&gt;&lt;del&gt;ZOOKEEPER-893&lt;/del&gt;&lt;/a&gt;. ZooKeeper high cpu usage when invalid requests&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12426974">ZOOKEEPER-427</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12457549" name="ZOOKEEPER-893-3.3.patch" size="5434" author="fpj" created="Tue, 19 Oct 2010 15:06:02 +0100"/>
                            <attachment id="12457545" name="ZOOKEEPER-893.patch" size="5453" author="fpj" created="Tue, 19 Oct 2010 13:10:39 +0100"/>
                            <attachment id="12456833" name="ZOOKEEPER-893.patch" size="1865" author="tt" created="Mon, 11 Oct 2010 08:34:02 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 14 Oct 2010 20:07:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47560</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxztvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32823</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>zookeeper server cpu &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-427&quot; title=&quot;ZooKeeper server unexpectedly high CPU utilisation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-427&quot;&gt;&lt;strike&gt;ZOOKEEPER-427&lt;/strike&gt;&lt;/a&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>