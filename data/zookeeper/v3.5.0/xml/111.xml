<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:50:08 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-111/ZOOKEEPER-111.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-111] significant cleanup of existing tests</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-111</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;About to submit a patch that significantly cleans up existing tests.&lt;/p&gt;

&lt;p&gt;1) removed the need for &quot;sleep&quot; calls in the tests, instead I monitor the status of the server (using the client socket &quot;stat&quot; command) which provides a barrier to the client test operations. I use this barrier both when starting and ending the test.&lt;/p&gt;

&lt;p&gt;2) also fixed a number of problems in the tests where the test itself was broken.&lt;/p&gt;

&lt;p&gt;3) general cleanup and some refactoring to make it easier to write new tests, maintain old, and track down issues if the test does find a problem.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12401819">ZOOKEEPER-111</key>
            <summary>significant cleanup of existing tests</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="phunt">Patrick Hunt</assignee>
                                    <reporter username="phunt">Patrick Hunt</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Aug 2008 20:08:40 +0100</created>
                <updated>Sun, 26 Oct 2008 01:10:41 +0000</updated>
                            <resolved>Fri, 15 Aug 2008 23:03:04 +0100</resolved>
                                                    <fixVersion>3.0.0</fixVersion>
                                    <component>tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12620387" author="phunt" created="Wed, 6 Aug 2008 20:13:53 +0100"  >&lt;p&gt;This patch is tested/passing on three machines:&lt;/p&gt;

&lt;p&gt;1) my personal 1cpu 1.2ghz machine ubuntu&lt;br/&gt;
2) hudson zones machine (dual core x86 solaris)&lt;br/&gt;
3) 2cpu dualcore (4cores) 2ghz rhel&lt;/p&gt;

&lt;p&gt;Note: I&apos;ve comment out testReuse in SessionTest for the time being. The bug in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-63&quot; title=&quot;Race condition in client close() operation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-63&quot;&gt;&lt;del&gt;ZOOKEEPER-63&lt;/del&gt;&lt;/a&gt; is causing this test to fail (intermittently). I&apos;ve updated that jira to note&lt;br/&gt;
this issue and as part of fixing that bug I will re-enable this test. Otw all tests are maintained from the mainline.&lt;/p&gt;</comment>
                            <comment id="12620752" author="mahadev" created="Thu, 7 Aug 2008 22:17:25 +0100"  >&lt;p&gt;this is a really good thing to clean up our tests to be more reliable. the patch looks good. comments &amp;#8212; &lt;/p&gt;

&lt;p&gt;1) In clientcnxn.java the log message is &lt;br/&gt;
LOG.warn(&quot;Closing session &quot; + sessionId, e);&lt;br/&gt;
can we print the session id to be in hex to be consistent.&lt;/p&gt;

&lt;p&gt;again in close() in clientcnxn.java can we print the sessionid in hex&lt;/p&gt;

&lt;p&gt;also there are some in zookeeper.java.&lt;/p&gt;

&lt;p&gt;2) It would be nice to pull out the quorum starting and stopping code from the quorum servers and create a utility class that allows creation of n number of quorum servers in the tests. This is not related to this jira but would be a good thing to clean up. This is just a nice to have and the patch is good without this as well.&lt;/p&gt;</comment>
                            <comment id="12620852" author="phunt" created="Fri, 8 Aug 2008 07:24:11 +0100"  >&lt;p&gt;Updated patch to output hex session ids for the logs I added.&lt;/p&gt;

&lt;p&gt;Went through the code and fixed up any other sessionid logging that wasn&apos;t using hex.&lt;/p&gt;

&lt;p&gt;In addition I added &quot;0x&quot; prefix to any hex values output to the log.&lt;/p&gt;</comment>
                            <comment id="12620854" author="phunt" created="Fri, 8 Aug 2008 07:27:11 +0100"  >&lt;p&gt;Updated the patch to address point 1 - consistent hex output of session ids.&lt;/p&gt;

&lt;p&gt;Added a separate jira &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-116&quot; title=&quot;simplify testing with quorums - quorum setup test utility code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-116&quot;&gt;ZOOKEEPER-116&lt;/a&gt; for point 2 (do that one separate patch)&lt;/p&gt;</comment>
                            <comment id="12621128" author="fpj" created="Sat, 9 Aug 2008 10:52:22 +0100"  >&lt;p&gt;AsyncTest is crashing consistently on my machine (Windows XP, jdk 1.6.0_02). Here is the output:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[junit] Tests run: 2, Failures: 2, Errors: 0, Time elapsed: 65.939 sec
    [junit] java.net.SocketException: Software caused connection abort: socket write error
    [junit] 	at java.net.SocketOutputStream.socketWrite0(Native Method)
    [junit] 	at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)
    [junit] 	at java.net.SocketOutputStream.write(SocketOutputStream.java:136)
    [junit] 	at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)
    [junit] 	at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)
    [junit] 	at org.apache.zookeeper.server.quorum.Follower.writePacket(Follower.java:87)
    [junit] 	at org.apache.zookeeper.server.quorum.Follower.followLeader(Follower.java:214)
    [junit] 	at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:401)
    [junit] java.io.EOFException
    [junit] 	at java.io.DataInputStream.readInt(DataInputStream.java:375)
    [junit] 	at org.apache.jute.BinaryInputArchive.readInt(BinaryInputArchive.java:64)
    [junit] 	at org.apache.zookeeper.server.quorum.QuorumPacket.deserialize(QuorumPacket.java:65)
    [junit] 	at org.apache.jute.BinaryInputArchive.readRecord(BinaryInputArchive.java:109)
    [junit] 	at org.apache.zookeeper.server.quorum.Follower.readPacket(Follower.java:100)
    [junit] 	at org.apache.zookeeper.server.quorum.Follower.followLeader(Follower.java:201)
    [junit] 	at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:401)
    [junit] java.io.EOFException
    [junit] 	at java.io.DataInputStream.readInt(DataInputStream.java:375)
    [junit] 	at org.apache.jute.BinaryInputArchive.readInt(BinaryInputArchive.java:64)
    [junit] 	at org.apache.zookeeper.server.quorum.QuorumPacket.deserialize(QuorumPacket.java:65)
    [junit] 	at org.apache.jute.BinaryInputArchive.readRecord(BinaryInputArchive.java:109)
    [junit] 	at org.apache.zookeeper.server.quorum.Follower.readPacket(Follower.java:100)
    [junit] 	at org.apache.zookeeper.server.quorum.Follower.followLeader(Follower.java:201)
    [junit] 	at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:401)
    [junit] java.io.EOFException
    [junit] 	at java.io.DataInputStream.readInt(DataInputStream.java:375)
    [junit] 	at org.apache.jute.BinaryInputArchive.readInt(BinaryInputArchive.java:64)
    [junit] 	at org.apache.zookeeper.server.quorum.QuorumPacket.deserialize(QuorumPacket.java:65)
    [junit] 	at org.apache.jute.BinaryInputArchive.readRecord(BinaryInputArchive.java:109)
    [junit] 	at org.apache.zookeeper.server.quorum.Follower.readPacket(Follower.java:100)
    [junit] 	at org.apache.zookeeper.server.quorum.Follower.followLeader(Follower.java:201)
    [junit] 	at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:401)
    [junit] java.net.SocketException: Software caused connection abort: socket write error
    [junit] 	at java.net.SocketOutputStream.socketWrite0(Native Method)
    [junit] 	at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)
    [junit] 	at java.net.SocketOutputStream.write(SocketOutputStream.java:136)
    [junit] 	at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)
    [junit] 	at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)
    [junit] 	at org.apache.zookeeper.server.quorum.Follower.writePacket(Follower.java:87)
    [junit] 	at org.apache.zookeeper.server.quorum.Follower.followLeader(Follower.java:214)
    [junit] 	at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:401)
    [junit] Test org.apache.zookeeper.test.AsyncTest FAILED 

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Any idea?&lt;/p&gt;</comment>
                            <comment id="12621139" author="phunt" created="Sat, 9 Aug 2008 15:09:40 +0100"  >&lt;p&gt;Mahadev and I saw that there is still some timing issue in asynctest, shows up rarely for us. Does this happen every time or just occasionally?&lt;/p&gt;

&lt;p&gt;Please attach the entire log, the issues pasted are related to the close race &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-63&quot; title=&quot;Race condition in client close() operation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-63&quot;&gt;&lt;del&gt;ZOOKEEPER-63&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12621161" author="fpj" created="Sat, 9 Aug 2008 18:37:14 +0100"  >&lt;p&gt;As requested, logs from the test run.&lt;/p&gt;</comment>
                            <comment id="12621607" author="phunt" created="Mon, 11 Aug 2008 22:11:32 +0100"  >&lt;p&gt;This patch has everything from previous version plus:&lt;/p&gt;

&lt;p&gt;1) hammerthreads are now named better (for debugging)&lt;br/&gt;
2) testHammer joins for 60sec rather than 10 (if very slow machine)&lt;br/&gt;
3) if the join fails we now print the stack of the thread that didn&apos;t shutdown&lt;/p&gt;

&lt;p&gt;4) various cleanups from findbugs&lt;/p&gt;</comment>
                            <comment id="12621839" author="fpj" created="Tue, 12 Aug 2008 15:49:51 +0100"  >&lt;p&gt;Now both SyncCallTest and WatcherFuncTest are failing on ClientBase.recursiveDelete. Here are the reported messages:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;junit.framework.AssertionFailedError: delete
	at org.apache.zookeeper.test.ClientBase.recursiveDelete(ClientBase.java:168)
	at org.apache.zookeeper.test.ClientBase.tearDown(ClientBase.java:158)
	at org.apache.zookeeper.test.WatcherFuncTest.tearDown(WatcherFuncTest.java:101)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12622120" author="phunt" created="Wed, 13 Aug 2008 07:55:17 +0100"  >&lt;p&gt;same as last patch except I don&apos;t check for file delete success (see &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-121&quot; title=&quot;SyncRequestProcessor is not closing log stream during shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-121&quot;&gt;&lt;del&gt;ZOOKEEPER-121&lt;/del&gt;&lt;/a&gt;) as it fails under windows (this is what flavio was seeing)&lt;/p&gt;

&lt;p&gt;I&apos;m still seeing some weirdness on windows (linux is fine) in QuorumTest, testHammer still sometimes fails for me on windows xp.&lt;/p&gt;

&lt;p&gt;Flavio, please give this another try.&lt;/p&gt;</comment>
                            <comment id="12622380" author="phunt" created="Wed, 13 Aug 2008 23:41:14 +0100"  >&lt;p&gt;same as last patch except I addressed the issues on windows:&lt;/p&gt;

&lt;p&gt;1) concurrency/fs sucks for single core, creating the 64mb log files (5) in quorum test was taking 15seconds / server - resulting in client timeout when session was not established quickly enough&lt;/p&gt;

&lt;p&gt;2) testHammer in quorumtest is taking upwards of 8 minutes to complete on my 2ghz 1core windows machine&lt;/p&gt;

&lt;p&gt;for 1) I decreased the log file prealloc in tests (tests only to 100k), and for 2) I reworked testHammer to monitor the running hammer threads and look for them to complete rather than assume they complete within some bounded time. (still a max though to handle runaways)&lt;/p&gt;

&lt;p&gt;tested on ubuntu and windows and tests are passing.&lt;/p&gt;</comment>
                            <comment id="12622503" author="fpj" created="Thu, 14 Aug 2008 11:13:23 +0100"  >&lt;p&gt;QuorumTest still fails in my Windows XP machine. It did run fine on a Ubuntu box. Now, something interesting that I just observed with this new patch is that the previous one was using gigabytes of data of my disk. I noticed because after I ran &quot;ant test&quot; with the previous patch, my OS started complaining about disk space. Once I deleted the eclipse project I regained several gigabytes of space, and after running &quot;ant test&quot; with this new patch, I noticed that the amount of disk space available had barely changed.&lt;/p&gt;

&lt;p&gt;I&apos;m attaching the test logs for QuorumTest. &lt;/p&gt;</comment>
                            <comment id="12622720" author="phunt" created="Thu, 14 Aug 2008 22:53:21 +0100"  >&lt;p&gt;Flavio: each zk server pre-allocates a 64m log file by default when started, the latest patch sets the pre-allocate size to 100K instead. This greatly reduces the amount of space needed to run the tests (in general each server started during the unit tests created a 64m log file)&lt;/p&gt;</comment>
                            <comment id="12622722" author="phunt" created="Thu, 14 Aug 2008 23:01:50 +0100"  >&lt;p&gt;Flavio, at least one of the tests that&apos;s failing (testHammer) seems related to a quorum problem, can you take a look?&lt;/p&gt;

&lt;p&gt;2008-08-14 11:28:40,695 - ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;FollowerHandler-/127.0.0.1:2599:FollowerHandler@343&amp;#93;&lt;/span&gt; - FIXMSG&lt;br/&gt;
java.net.SocketTimeoutException: Read timed out&lt;br/&gt;
	at java.net.SocketInputStream.socketRead0(Native Method)&lt;br/&gt;
	at java.net.SocketInputStream.read(SocketInputStream.java:129)&lt;br/&gt;
	at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)&lt;br/&gt;
	at java.io.BufferedInputStream.read(BufferedInputStream.java:237)&lt;br/&gt;
	at java.io.DataInputStream.readInt(DataInputStream.java:370)&lt;br/&gt;
	at org.apache.jute.BinaryInputArchive.readInt(BinaryInputArchive.java:64)&lt;br/&gt;
	at org.apache.zookeeper.server.quorum.QuorumPacket.deserialize(QuorumPacket.java:65)&lt;br/&gt;
	at org.apache.jute.BinaryInputArchive.readRecord(BinaryInputArchive.java:109)&lt;br/&gt;
	at org.apache.zookeeper.server.quorum.FollowerHandler.run(FollowerHandler.java:279)&lt;/p&gt;

&lt;p&gt;After which the followers all seem to shutdown.&lt;/p&gt;

&lt;p&gt;The test is failing because the clients are not complete (10 clients creating 1000 nodes) even after 5 minutes.&lt;/p&gt;

&lt;p&gt;What type of hardware is this?&lt;/p&gt;</comment>
                            <comment id="12622932" author="mahadev" created="Fri, 15 Aug 2008 18:35:41 +0100"  >&lt;p&gt;This patch does not apply anymore. Can you upload a new one? Also, I htink we should commit this as it is and file new jira&apos;s for new problems on tests. &lt;/p&gt;</comment>
                            <comment id="12622978" author="phunt" created="Fri, 15 Aug 2008 19:59:30 +0100"  >&lt;p&gt;Recreated patch against latest svn.&lt;/p&gt;</comment>
                            <comment id="12623035" author="mahadev" created="Fri, 15 Aug 2008 23:03:04 +0100"  >&lt;p&gt;I just committed this. Thanks Pat.&lt;/p&gt;</comment>
                            <comment id="12623633" author="hudson" created="Tue, 19 Aug 2008 12:02:11 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #58 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/58/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/58/&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="12642715" author="phunt" created="Sun, 26 Oct 2008 01:10:41 +0000"  >&lt;p&gt;3.0.0 has been released, closing issues.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12399048">ZOOKEEPER-54</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12399319">ZOOKEEPER-61</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12400845">ZOOKEEPER-86</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12387882" name="TEST-org.apache.zookeeper.test.AsyncTest.txt" size="798168" author="fpj" created="Sat, 9 Aug 2008 18:37:14 +0100"/>
                            <attachment id="12388216" name="TEST-org.apache.zookeeper.test.QuorumTest.txt" size="376085" author="fpj" created="Thu, 14 Aug 2008 11:13:23 +0100"/>
                            <attachment id="12388328" name="ZOOKEEPER-111.patch" size="110084" author="phunt" created="Fri, 15 Aug 2008 19:59:30 +0100"/>
                            <attachment id="12388187" name="ZOOKEEPER-111.patch" size="119118" author="phunt" created="Wed, 13 Aug 2008 23:41:14 +0100"/>
                            <attachment id="12388106" name="ZOOKEEPER-111.patch" size="114660" author="phunt" created="Wed, 13 Aug 2008 07:55:17 +0100"/>
                            <attachment id="12387995" name="ZOOKEEPER-111.patch" size="103590" author="phunt" created="Mon, 11 Aug 2008 22:11:32 +0100"/>
                            <attachment id="12387796" name="ZOOKEEPER-111.patch" size="75799" author="phunt" created="Fri, 8 Aug 2008 07:24:11 +0100"/>
                            <attachment id="12387670" name="ZOOKEEPER-111.patch" size="50053" author="phunt" created="Wed, 6 Aug 2008 20:13:53 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 7 Aug 2008 21:17:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48049</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzylj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33589</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>