<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:40:30 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1081/ZOOKEEPER-1081.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1081] modify leader/follower code to correctly deal with new leader</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1081</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;the leader and follower code need to be modified to correctly handle and log epoch changes&lt;/p&gt;</description>
                <environment></environment>
        <key id="12508720">ZOOKEEPER-1081</key>
            <summary>modify leader/follower code to correctly deal with new leader</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12416126">ZOOKEEPER-335</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="breed">Benjamin Reed</assignee>
                                    <reporter username="breed">Benjamin Reed</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 May 2011 16:15:45 +0100</created>
                <updated>Wed, 23 Nov 2011 19:22:32 +0000</updated>
                            <resolved>Tue, 14 Jun 2011 06:14:46 +0100</resolved>
                                                    <fixVersion>3.4.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13043306" author="breed" created="Fri, 3 Jun 2011 12:17:09 +0100"  >&lt;p&gt;this is a patch that addresses the newleader logging issue, and brings the implementation in line with the theoretically proven protocol.&lt;/p&gt;

&lt;p&gt;there is a problem with hierarchal quorums that i haven&apos;t looked at. the backwards compatibility code is in, but i haven&apos;t tested it. i&apos;m still trying to make leader election mod in a backward compatible way.&lt;/p&gt;

&lt;p&gt;the code LearnerHandler code is pretty messy now and i&apos;m torn between cleaning it up or leaving until later. my concerns about cleaning is that 1) it may be hard to compare past logic with current if we need to in the near future and 2) it may introduce new bugs. on the pro side, it is crying out for the code cleanup, and this is usually when we do it.&lt;/p&gt;</comment>
                            <comment id="13043307" author="breed" created="Fri, 3 Jun 2011 12:19:32 +0100"  >&lt;p&gt;oh btw, the test case was super hard to write. the scenario is easy to describe, but i found it quite hard to implement. if someone (vishal? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; sees a better way to do the test, i would be really happy to try it.&lt;/p&gt;</comment>
                            <comment id="13043917" author="vishalmlst" created="Fri, 3 Jun 2011 19:02:44 +0100"  >&lt;p&gt;Hi Ben,&lt;/p&gt;

&lt;p&gt;I have attached the diff that I used to repro the bug.&lt;/p&gt;

&lt;p&gt;I inserted a failure in ProposalRequestProcessor.java. Everytime I read file /etc/zookeeper/debug.property. I check if the debug property is set. If it is, then I fail (I did shutdown -h to avoid some timing issues specific to our application) the leader after call to syncProcessor.processRequest(request). This ensures that the transaction is logged but not sent to followers. Then, when we restart the old leader we can check if it still has the old data.&lt;/p&gt;

&lt;p&gt;Do you think this helps? I think we need to start injecting faults in the code itself. So having a framwork that would do something similar to the attached diff would be useful.&lt;/p&gt;</comment>
                            <comment id="13044110" author="breed" created="Fri, 3 Jun 2011 23:45:34 +0100"  >&lt;p&gt;yeah, we really should be injecting faults. i think there are nice fault injectors that you can use without modifying your code right? have you (or anyone else listening) ever tried them?&lt;/p&gt;</comment>
                            <comment id="13044724" author="mahadev" created="Mon, 6 Jun 2011 06:54:05 +0100"  >&lt;p&gt;Would mockito be helpful? &lt;/p&gt;</comment>
                            <comment id="13044855" author="fournc" created="Mon, 6 Jun 2011 15:09:37 +0100"  >&lt;p&gt;I dunno that mockito would do enough, but some of my colleagues had good luck with MultiThreadedTestCase:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://code.google.com/p/multithreadedtc/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://code.google.com/p/multithreadedtc/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I didn&apos;t use it myself but it looked pretty cool.&lt;/p&gt;</comment>
                            <comment id="13050968" author="hudson" created="Fri, 17 Jun 2011 11:57:10 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #1215 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/1215/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/1215/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12481323" name="ZOOKEEPER-1081.patch" size="29247" author="breed" created="Fri, 3 Jun 2011 12:17:09 +0100"/>
                            <attachment id="12481380" name="sample.diff" size="2906" author="vishalmlst" created="Fri, 3 Jun 2011 19:02:44 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 3 Jun 2011 18:02:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47488</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzx1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33337</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Committed revision 1135382. </customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>