<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:51:18 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1027/ZOOKEEPER-1027.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1027] chroot not transparent in zoo_create()</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1027</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;I&apos;ve recently started to use the chroot functionality (introduced in&lt;br/&gt;
3.2.0) as part of my connect string.It mostly works as expected, but&lt;br/&gt;
there is one case that is unexpected: when I create a path with&lt;br/&gt;
zoo_create() I can retrieve the created path. This is very useful when&lt;br/&gt;
you set the ZOO_SEQUENCE flag. Unfortunately the returned path&lt;br/&gt;
includes the chroot as part of the path. This was unexpected to me: I&lt;br/&gt;
expected that the chroot would be totally transparent. The&lt;br/&gt;
documentation for zoo_create() says:&lt;br/&gt;
&quot;path_buffer : Buffer which will be filled with the path of the new&lt;br/&gt;
node (this might be different than the supplied path because of the&lt;br/&gt;
ZOO_SEQUENCE flag).&quot;&lt;/p&gt;

&lt;p&gt;This gave me the impression that this flag is the only reason the&lt;br/&gt;
returned path is different from the created path, but apparently it&apos;s&lt;br/&gt;
not. Is this a bug or intended behavior? &lt;br/&gt;
I workaround this issue now by remembering the chroot in&lt;br/&gt;
my wrapper code and after a call to zoo_create() i check if the returned&lt;br/&gt;
path starts with the chroot. If it does, I remove it.&lt;/p&gt;

&lt;p&gt;My use case is to create a path with a sequence number and then delete&lt;br/&gt;
this path later. Unfortunately I cannot delete the path because it has&lt;br/&gt;
the chroot prepended to it, and thus it will result in two chroots.&lt;/p&gt;

&lt;p&gt;I believe this only affects the create functions.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux, ZooKeeper 3.3.3, C-client, java 1.6.0_17-b04, hotspot server vm&lt;/p&gt;</environment>
        <key id="12502255">ZOOKEEPER-1027</key>
            <summary>chroot not transparent in zoo_create()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tt">Thijs Terlouw</assignee>
                                    <reporter username="tt">Thijs Terlouw</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Mar 2011 05:06:47 +0000</created>
                <updated>Wed, 23 Nov 2011 19:22:13 +0000</updated>
                            <resolved>Mon, 25 Jul 2011 18:45:31 +0100</resolved>
                                    <version>3.3.3</version>
                                    <fixVersion>3.4.0</fixVersion>
                                    <component>c client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                            <comments>
                            <comment id="13010592" author="tt" created="Thu, 24 Mar 2011 07:27:54 +0000"  >&lt;p&gt;I realized that I probably need to test it again using the new 3.3.3 C-client code. I only tested against the 3.3.3 server&lt;/p&gt;</comment>
                            <comment id="13010622" author="tt" created="Thu, 24 Mar 2011 10:17:35 +0000"  >&lt;p&gt;tested with 3.3.3 C-client, same problem&lt;/p&gt;</comment>
                            <comment id="13011077" author="tt" created="Fri, 25 Mar 2011 02:49:55 +0000"  >&lt;p&gt;Two problems afaik:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;(1)&lt;/b&gt; I noticed a sub_string(zh, server_path) function that contains a bug at line 840 in zookeeper.c: &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;if (strncmp(server_path, zh-&amp;gt;chroot, strlen(zh-&amp;gt;chroot) != 0)) {&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;notice that &quot;&lt;span class=&quot;error&quot;&gt;Unable to render embedded object: File (= 0&amp;quot; appears inside the 3rd argument to the strncmp() function) not found.&lt;/span&gt; So it executes&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;if(strncmp(server_path, zh-&amp;gt;chroot, 1)) {&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;which will always fail if the first character is the same. The next if() also fails (server_path length is not equal to chroot usually). This if() has the potential to cause wrong results btw. Then finally it returns the string with the chroot stripped off. So it will strip off the chroot, but for the wrong reason.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;(2)&lt;/b&gt; the sub_string() function is only called for do_foreach_watcher() function (zk_hashtable.c line 273). It doesn&apos;t seem to be called in the zoo_create/zoo_acreate/add_string_completion path. This is the bug that influences this bug report.&lt;/p&gt;</comment>
                            <comment id="13011079" author="tt" created="Fri, 25 Mar 2011 03:07:39 +0000"  >&lt;p&gt;&lt;b&gt;(1)&lt;/b&gt; fix:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;    // &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1027&quot; title=&quot;chroot not transparent in zoo_create()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1027&quot;&gt;&lt;del&gt;ZOOKEEPER-1027&lt;/del&gt;&lt;/a&gt;/1 : fix strncmp + do not return NULL &lt;br/&gt;
    if (strncmp(server_path, zh-&amp;gt;chroot, strlen(zh-&amp;gt;chroot)) != 0) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
        LOG_ERROR((&amp;quot;server path %s does not include chroot path %s&amp;quot;,
                   server_path, zh-&amp;gt;chroot));
        return (char *) server_path;  
    }&lt;/span&gt; &lt;/div&gt;&lt;/blockquote&gt;</comment>
                            <comment id="13011082" author="tt" created="Fri, 25 Mar 2011 03:18:30 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; 
diff -Naur zookeeper-3.3.3/src/c/src/zookeeper.c zookeeper-3.3.3-patched/src/c/src/zookeeper.c
--- zookeeper-3.3.3/src/c/src/zookeeper.c   2011-02-24 07:44:56.000000000 +0800
+++ zookeeper-3.3.3-patched/src/c/src/zookeeper.c   2011-03-25 11:11:23.000000000 +0800
@@ -837,10 +837,11 @@
     char *ret_str;
     if (zh-&amp;gt;chroot == NULL)
         return (char *) server_path;
-    if (strncmp(server_path, zh-&amp;gt;chroot, strlen(zh-&amp;gt;chroot) != 0)) {
+    //ZOOKEEPER-1027/1 : do not return NULL and fix strncmp
+    if (strncmp(server_path, zh-&amp;gt;chroot, strlen(zh-&amp;gt;chroot)) != 0) {
         LOG_ERROR((&quot;server path %s does not include chroot path %s&quot;,
                    server_path, zh-&amp;gt;chroot));
-        return NULL;
+        return (char *) server_path;
     }
     if (strlen(server_path) == strlen(zh-&amp;gt;chroot)) {
         //return &quot;/&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </comment>
                            <comment id="13011095" author="tt" created="Fri, 25 Mar 2011 04:33:07 +0000"  >&lt;p&gt;The call to sub_string() appears to be needed inside zookeeper_process() near line 2062 in zookeeper.c&lt;br/&gt;
I&apos;ll submit a full patch later&lt;/p&gt;</comment>
                            <comment id="13011138" author="tt" created="Fri, 25 Mar 2011 09:35:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1027&quot; title=&quot;chroot not transparent in zoo_create()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1027&quot;&gt;&lt;del&gt;ZOOKEEPER-1027&lt;/del&gt;&lt;/a&gt; patch by Thijs Terlouw&lt;/p&gt;</comment>
                            <comment id="13011140" author="tt" created="Fri, 25 Mar 2011 09:37:22 +0000"  >&lt;p&gt;I&apos;ve tried to make a failing unit test, but strangely enough the unit tests return the correct result (even without my patch). I still have to investigate this further, but I believe the two bugs are correctly solved.&lt;/p&gt;</comment>
                            <comment id="13011142" author="hadoopqa" created="Fri, 25 Mar 2011 09:41:33 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12474602/zookeeper-3.3.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12474602/zookeeper-3.3.3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1082362.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/200//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/200//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13011145" author="tt" created="Fri, 25 Mar 2011 09:48:42 +0000"  >&lt;p&gt;I can confirm that this patch solves the problem I was seeing. I have tried a lot of things to make the unit tests fail for testChroot() but somehow the unit test always succeeds. Perhaps some compilation options are different or different concurrency? Just guessing, it&apos;s very strange that the unit tests don&apos;t fail &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13016299" author="savu.andrei" created="Wed, 6 Apr 2011 09:36:02 +0100"  >&lt;p&gt;I&apos;ve seen a similar issue affecting the zookeeper python client (see &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-995&quot; title=&quot;C Client exposing chroot information&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-995&quot;&gt;&lt;del&gt;ZOOKEEPER-995&lt;/del&gt;&lt;/a&gt;) and I&apos;ve attached a failing unit test. &lt;/p&gt;</comment>
                            <comment id="13017758" author="phunt" created="Sat, 9 Apr 2011 00:50:51 +0100"  >&lt;p&gt;Thijs, thanks for this - would you mind updating this patch for:&lt;/p&gt;

&lt;p&gt;1) get it to patch successfully against trunk (you&apos;ll probably need two patch files, one for 3.3 branch and one for trunk)&lt;br/&gt;
2) add a C based test based on Andrei&apos;s example from python (possible?)&lt;br/&gt;
3) add the &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-995&quot; title=&quot;C Client exposing chroot information&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-995&quot;&gt;&lt;del&gt;ZOOKEEPER-995&lt;/del&gt;&lt;/a&gt; changes to this patch&lt;/p&gt;</comment>
                            <comment id="13017759" author="phunt" created="Sat, 9 Apr 2011 00:51:30 +0100"  >&lt;p&gt;cancelling patch for now while we address the comments (tests primarily)&lt;/p&gt;</comment>
                            <comment id="13018334" author="tt" created="Mon, 11 Apr 2011 14:11:25 +0100"  >&lt;p&gt;Hi Patrick, I will try to create an improved patch next weekend, currently I have no time.&lt;/p&gt;</comment>
                            <comment id="13023138" author="tt" created="Fri, 22 Apr 2011 07:49:54 +0100"  >&lt;p&gt;New patch attached which includes unit tests. Should apply cleanly to the trunk, but I have no idea how to trigger the Hadoop QA Bot...&lt;/p&gt;</comment>
                            <comment id="13023146" author="hadoopqa" created="Fri, 22 Apr 2011 08:54:13 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12477090/ZOOKEEPER-1027-TRUNK_WITH_TESTS.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12477090/ZOOKEEPER-1027-TRUNK_WITH_TESTS.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1091841.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/229//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/229//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/229//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/229//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/229//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/229//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13032543" author="mahadev" created="Thu, 12 May 2011 18:54:53 +0100"  >&lt;p&gt;+1 the patch looks good to me.&lt;/p&gt;</comment>
                            <comment id="13032549" author="mahadev" created="Thu, 12 May 2011 19:01:37 +0100"  >&lt;p&gt;one minor nit:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
 LOG_ERROR((&quot;server path %s does not include chroot path %s&quot;,
                   server_path, zh-&amp;gt;chroot));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think we should comment this out as well, since this wont be an error on a create call. What do you think Thijs?&lt;/p&gt;</comment>
                            <comment id="13032550" author="mahadev" created="Thu, 12 May 2011 19:02:27 +0100"  >&lt;p&gt;marking it for just 3.4 since 3.3.3 isnt planned yet.&lt;/p&gt;</comment>
                            <comment id="13032808" author="tt" created="Fri, 13 May 2011 04:14:18 +0100"  >&lt;p&gt;I think just for 3.4 is good, because it changes the behavior of the C-client a little bit and that should probably not happen in a small patch release such as 3.3.3&lt;/p&gt;

&lt;p&gt;About the LOG_ERROR() message: I didn&apos;t look in detail at the code-path for creating, so I didn&apos;t consider this case. It&apos;s a non-functional change, so removing it is no problem for me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13050822" author="breed" created="Fri, 17 Jun 2011 01:15:26 +0100"  >&lt;p&gt;what are we waiting on for this patch? is is simply to remove the LOG_ERROR?&lt;/p&gt;

&lt;p&gt;i&apos;m also wondering if we shouldn&apos;t still return NULL if there is a suffix error in sub_string. it seems like we should keep returning a NULL.&lt;/p&gt;</comment>
                            <comment id="13050895" author="tt" created="Fri, 17 Jun 2011 05:25:09 +0100"  >&lt;p&gt;@benjamin:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I was under the impression that Mahadev indeed wanted to remove the LOG_ERROR, but that this patch would be incorporated into 3.4.0 due to slight change in behavior (some people might rely on the fact that now the chroot is included)&lt;br/&gt;
I added the LOG_ERROR() because chroot should be NULL if it&apos;s not used, and otherwise it should always be included in the server path, but perhaps I overlooked something here.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I think NULL should not be returned from sub_string, for the following reasons:&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;in the current code NULL is never returned due to a parenthesis bug on the enclosing if() statement. strlen(zh-&amp;gt;chroot) != 0 will always return 1 and the strncmp() function will thus compare 1 character of server_path and zh-&amp;gt;chroot. Since they both start with &quot;/&quot; strncmp will equal (0) and thus the if(0) always fails.&lt;/li&gt;
	&lt;li&gt;other cases in sub_string all return the current server_path as default value&lt;/li&gt;
	&lt;li&gt;the documentation (in zookeeper.h) only states that the path is NULL when the type is ZOO_SESSION_EVENT&lt;/li&gt;
	&lt;li&gt;the function documentation for sub_string() says it should return the exact path if chroot is not included&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;as far as I am concerned, this patch (or without LOG_ERROR) can just be incorporated in the next release, but do let mahadev have another look at it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13055360" author="mahadev" created="Mon, 27 Jun 2011 07:46:41 +0100"  >&lt;p&gt;Retrying hudson.&lt;/p&gt;</comment>
                            <comment id="13055361" author="mahadev" created="Mon, 27 Jun 2011 07:47:20 +0100"  >&lt;p&gt;retrying Thijs patch.&lt;/p&gt;</comment>
                            <comment id="13055370" author="hadoopqa" created="Mon, 27 Jun 2011 08:14:16 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12483913/ZOOKEEPER-1027-TRUNK_WITH_TESTS.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12483913/ZOOKEEPER-1027-TRUNK_WITH_TESTS.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1140017.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/354//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/354//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/354//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/354//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/354//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/354//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13061060" author="mahadev" created="Thu, 7 Jul 2011 07:35:06 +0100"  >&lt;p&gt;The patch has gone stale due to Multi checkin.&lt;/p&gt;</comment>
                            <comment id="13061062" author="mahadev" created="Thu, 7 Jul 2011 07:36:27 +0100"  >&lt;p&gt;Updated patch to apply on trunk. Thijis can you please take a look and see in case I missed something? &lt;/p&gt;

&lt;p&gt;I didnt get a chance to run the tests since I currently dont have access to a linux box.&lt;/p&gt;</comment>
                            <comment id="13061108" author="hadoopqa" created="Thu, 7 Jul 2011 08:51:18 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12485539/ZOOKEEPER-1027-TRUNK_WITH_TESTS.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12485539/ZOOKEEPER-1027-TRUNK_WITH_TESTS.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1142377.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/373//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/373//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/373//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/373//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/373//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/373//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13061152" author="tt" created="Thu, 7 Jul 2011 09:57:31 +0100"  >&lt;p&gt;Patch looks fine, i just compared yours and mine. There are some open issues from the discussion of Benjamin and me, if you agree with me, then the patch can be released like this &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13061156" author="tt" created="Thu, 7 Jul 2011 09:59:55 +0100"  >&lt;p&gt;I see that Hadoop QA didn&apos;t agree:&lt;/p&gt;

&lt;p&gt;-1 core tests. The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;but there are no failed tests in the test report...&lt;/p&gt;</comment>
                            <comment id="13062087" author="hadoopqa" created="Fri, 8 Jul 2011 19:03:45 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12485539/ZOOKEEPER-1027-TRUNK_WITH_TESTS.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12485539/ZOOKEEPER-1027-TRUNK_WITH_TESTS.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1144087.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/384//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/384//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/384//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/384//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/384//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/384//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13063575" author="mahadev" created="Mon, 11 Jul 2011 23:11:32 +0100"  >&lt;p&gt;Looks like some issue in compilation. Thijs can you please take a look? It might take you less time than me to create a patch for this one. Let me know if you cant. &lt;/p&gt;

&lt;p&gt;Here&apos;s the issue:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/384/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/384/console&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;At the bottom of the logs there is a compilation error.&lt;/p&gt;</comment>
                            <comment id="13063678" author="tt" created="Tue, 12 Jul 2011 03:47:32 +0100"  >&lt;p&gt;It seems the code has been refactored, a large block of code has been moved from the function &lt;br/&gt;
zookeeper_process(zhandle_t *zh, int events) &lt;br/&gt;
to &lt;br/&gt;
process_sync_completion(cptr, sc, ia);&lt;/p&gt;

&lt;p&gt;the patch requires access to the zhandle_t pointer though, so you get compilation issues about missing &quot;zh&quot;&lt;/p&gt;

&lt;p&gt;The simplest solution is to add a 4th parameter (zhandle_t *zh) to the process_sync_completion() function. It compiles and runs the unit tests correctly after this change, but it&apos;s a bit complicated to generate a new patch for me, because I am not sure which version to patch against. &lt;/p&gt;</comment>
                            <comment id="13063680" author="mahadev" created="Tue, 12 Jul 2011 03:50:55 +0100"  >&lt;p&gt;Thijs,&lt;br/&gt;
 The version to patch against is trunk. Would you be able to provide a patch in that case?&lt;/p&gt;</comment>
                            <comment id="13063703" author="tt" created="Tue, 12 Jul 2011 04:59:11 +0100"  >&lt;p&gt;no problem, I will do it later today!&lt;/p&gt;</comment>
                            <comment id="13063752" author="tt" created="Tue, 12 Jul 2011 08:11:16 +0100"  >&lt;p&gt;ZK-1027 patch updated for trunk. Adds a 4th parameter zhandle_t* to process_sync_completion()&lt;/p&gt;</comment>
                            <comment id="13065018" author="hadoopqa" created="Thu, 14 Jul 2011 03:51:36 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12486152/ZOOKEEPER-1027-PATCH-TRUNK2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12486152/ZOOKEEPER-1027-PATCH-TRUNK2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1146025.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/392//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/392//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13065071" author="tt" created="Thu, 14 Jul 2011 07:09:45 +0100"  >&lt;p&gt;previous patch had some issues with directory name, fixed that and added a new patch&lt;/p&gt;</comment>
                            <comment id="13065081" author="hadoopqa" created="Thu, 14 Jul 2011 07:34:27 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12486412/ZOOKEEPER-1027-PATCH-TRUNK3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12486412/ZOOKEEPER-1027-PATCH-TRUNK3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1146025.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/395//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/395//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/395//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/395//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/395//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/395//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13070632" author="mahadev" created="Mon, 25 Jul 2011 18:45:31 +0100"  >&lt;p&gt;I just pushed this. Thanks Thijs.&lt;/p&gt;</comment>
                            <comment id="13071035" author="hudson" created="Tue, 26 Jul 2011 11:58:35 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #1255 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/1255/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/1255/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1027&quot; title=&quot;chroot not transparent in zoo_create()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1027&quot;&gt;&lt;del&gt;ZOOKEEPER-1027&lt;/del&gt;&lt;/a&gt;. chroot not transparent in zoo_create() (Thijs Terlouw via  mahadev)&lt;/p&gt;

&lt;p&gt;mahadev : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1150802&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1150802&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/src/c/src/zookeeper.c&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/c/tests/TestClient.cc&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13082401" author="dheerajagrawal" created="Wed, 10 Aug 2011 16:32:17 +0100"  >&lt;p&gt;Mahadev, this patch breaks windows build.&lt;br/&gt;
       //&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1027&quot; title=&quot;chroot not transparent in zoo_create()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1027&quot;&gt;&lt;del&gt;ZOOKEEPER-1027&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
        const char* client_path = sub_string(zh, res.path);&lt;/p&gt;

&lt;p&gt;Windows doesn&apos;t like declaration of variables in middle of the code... The declaration of const char* client_path should be made just after the if condition at line 1898. &lt;br/&gt;
   1898         if (sc-&amp;gt;rc==0) {&lt;br/&gt;
   1899             const char* client_path;&lt;/p&gt;</comment>
                            <comment id="13082470" author="mahadev" created="Wed, 10 Aug 2011 17:58:17 +0100"  >&lt;p&gt;dheeraj,&lt;br/&gt;
 Can you please open a new jira and file a patch for it? Please mark it as a blocker for 3.4.0.&lt;/p&gt;

&lt;p&gt;thanks&lt;/p&gt;</comment>
                            <comment id="13082483" author="dheerajagrawal" created="Wed, 10 Aug 2011 18:13:51 +0100"  >&lt;p&gt;yes, i have created a sub-task for this jira. will be uploading patch in some time.&lt;/p&gt;</comment>
                            <comment id="13082487" author="mahadev" created="Wed, 10 Aug 2011 18:15:50 +0100"  >&lt;p&gt;thanks a lot Dheeraj!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12499233">ZOOKEEPER-995</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12486152" name="ZOOKEEPER-1027-PATCH-TRUNK2.patch" size="3098" author="tt" created="Tue, 12 Jul 2011 08:11:16 +0100"/>
                            <attachment id="12486412" name="ZOOKEEPER-1027-PATCH-TRUNK3.patch" size="3014" author="tt" created="Thu, 14 Jul 2011 07:08:23 +0100"/>
                            <attachment id="12485539" name="ZOOKEEPER-1027-TRUNK_WITH_TESTS.patch" size="2327" author="mahadev" created="Thu, 7 Jul 2011 07:36:27 +0100"/>
                            <attachment id="12483913" name="ZOOKEEPER-1027-TRUNK_WITH_TESTS.patch" size="2525" author="mahadev" created="Mon, 27 Jun 2011 07:47:20 +0100"/>
                            <attachment id="12477090" name="ZOOKEEPER-1027-TRUNK_WITH_TESTS.patch" size="2525" author="tt" created="Fri, 22 Apr 2011 07:31:51 +0100"/>
                    </attachments>
                <subtasks>
                            <subtask id="12518468">ZOOKEEPER-1150</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 25 Mar 2011 09:41:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47510</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxztif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32765</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Correctly removes the chroot from the returned path in a call to zoo_create()</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>chroot zookeeper zoo_create</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>