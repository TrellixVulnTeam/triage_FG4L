<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:43:07 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1835/ZOOKEEPER-1835.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1835] dynamic configuration file renaming fails on Windows</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1835</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;On Windows, reconfig fails to rename the tmp dynamic config file to the real dynamic config filename.&lt;br/&gt;
Javadoc of java.io.File.renameTo says the behavior is highly plateform dependent, so I guess this should not be a big surprise.&lt;br/&gt;
The problem occurs in src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java that could be modified like this:&lt;br/&gt;
+ curFile.delete();&lt;br/&gt;
if (!tmpFile.renameTo(curFile)) {&lt;br/&gt;
+ configFile.delete();&lt;br/&gt;
if (!tmpFile.renameTo(configFile)) {&lt;br/&gt;
As suggested by Alex in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1691&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1691&lt;/a&gt; (btw there is more information about my test scenario over there) it is a bit &quot;scary&quot; to delete the current configuration file.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 7 64-bit, Oracle Java  1.6.0_32-b05&lt;/p&gt;</environment>
        <key id="12684352">ZOOKEEPER-1835</key>
            <summary>dynamic configuration file renaming fails on Windows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bfreuden">Bruno Freudensprung</assignee>
                                    <reporter username="bfreuden">Bruno Freudensprung</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Dec 2013 21:05:27 +0000</created>
                <updated>Fri, 4 Jul 2014 12:11:39 +0100</updated>
                            <resolved>Fri, 4 Jul 2014 03:25:43 +0100</resolved>
                                    <version>3.5.0</version>
                                    <fixVersion>3.5.0</fixVersion>
                                    <component>quorum</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13848420" author="bfreuden" created="Sat, 14 Dec 2013 18:21:09 +0000"  >&lt;p&gt;I&apos;ve discovered the existing org.apache.zookeeper.common.AtomicFileOutputStream class that precisely does this job (writing a temp file, then rename it, if failure on windows then delete and rename, delete the temp file...).&lt;br/&gt;
There is a kind of idiomatic usage described in org.apache.zookeeper.server.quorum.QuorumPeer.writeLongToFile(...), so I&apos;ve created a org.apache.zookeeper.common.AtomicFileWritingIdiom class (using AtomicFileOutputStream) in order not to miss anything from the idiom, and used it org.apache.zookeeper.server.quorum.QuorumPeerConfig.&lt;br/&gt;
You will find attached a patch containing this new AtomicFileWritingIdiom class, a unit test for it, and the existing modified QuorumPeerConfig class.&lt;br/&gt;
I&apos;ve run the ZK junit test suite that did not show any induced problem.&lt;br/&gt;
I&apos;ve also tested the &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1691&quot; title=&quot;Add a flag to disable standalone mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1691&quot;&gt;&lt;del&gt;ZOOKEEPER-1691&lt;/del&gt;&lt;/a&gt; patch in addition to this one, and I got my dynamic reconfig scenario working like described in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1691&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1691&lt;/a&gt;&lt;br/&gt;
And I finally tested the configBackwardCompatibilityMode scenario where the dynamic config file gets created and the zoo.cfg file rewritten. It works too.&lt;br/&gt;
There is a small bug in the current implementation of the configBackwardCompatibilityMode though: even if the clientPort= line is mentioned the the zoo.cfg file, the port is not appended at the end of the line of the dynamic config. Don&apos;t know if it &quot;deserves&quot; a bug though. &lt;/p&gt;

&lt;p&gt;Bruno.&lt;/p&gt;</comment>
                            <comment id="13848566" author="hadoopqa" created="Sun, 15 Dec 2013 09:15:05 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12618808/ZOOKEEPER-1835.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12618808/ZOOKEEPER-1835.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1550213.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1837//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1837//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1837//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1837//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1837//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1837//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13848829" author="rakeshr" created="Mon, 16 Dec 2013 05:26:01 +0000"  >&lt;p&gt;Thanks for the patch, it looks nice. I have few comments, please see. &lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;It would be nice to use IOUtils.closeStream(out); instead of following in the patch
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (out != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
	out.close();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Apache license is missing in the files AtomicFileWritingIdiom.java, AtomicFileWritingIdiomTest.java&lt;/li&gt;
	&lt;li&gt;Please correct the code format. Please see &lt;a href=&quot;http://wiki.apache.org/hadoop/ZooKeeper/HowToContribute&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/hadoop/ZooKeeper/HowToContribute&lt;/a&gt; section for more info.&lt;br/&gt;
There are  spaces in empty lines and also in java comments like &quot;//   and the caller will be notified (IOException)&quot;&lt;/li&gt;
	&lt;li&gt;I couldn&apos;t see the following constructor is used anywhere. Is it required?
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; AtomicFileWritingIdiom(File targetFile, WriterStatement wStmt, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; encoding)  &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;(targetFile, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, wStmt, encoding);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;This is a suggestion only. There are many null checks in the constructor logic like, if not null do the operation. I think, you have done this to reduce the code duplication. But I feel, this will create confusions in debugging or maintainability. Say, by mistake if the passed object is null, this will just skip the logic and return. Caller will be thinking the operation is successfully completed. IMHO, its ok to duplicate the constructor logics rather than null checks and skipping. Whats your opinion?&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;-Rakesh&lt;/p&gt;</comment>
                            <comment id="13848925" author="bfreuden" created="Mon, 16 Dec 2013 08:36:19 +0000"  >&lt;p&gt;Hi Rakesh,&lt;/p&gt;

&lt;p&gt;Thank you for the review! &lt;br/&gt;
My answers:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;1, 2, 3: Sure! I will do it.&lt;/li&gt;
	&lt;li&gt;You are right, it is not required. I am just reluctant providing a Writer-based API without the possibility to provide an encoding. But I understand that dead code should be avoided. I will remove it.&lt;/li&gt;
	&lt;li&gt;You are right: there are null check because I didn&apos;t want to duplicate the idiom (I felt the complexity was more in the idiom - try catch abort finally close...- than in the initialization of the objets). That is why this constructor is private (it handles the null check, and the public constructors cannot accept null parameters, excepted the encoding parameter that I will remove). I you prefer code duplication (for maintenability reasons) I am fine with that as well. Just tell me!&lt;br/&gt;
Regards,&lt;br/&gt;
Bruno.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13848935" author="rakeshr" created="Mon, 16 Dec 2013 09:00:07 +0000"  >&lt;p&gt;Hi Bruno,&lt;/p&gt;

&lt;p&gt;Can we refactor &apos;BufferedWriter bw = null&apos; logic as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
          } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                &lt;span class=&quot;code-comment&quot;&gt;// prepare writer
&lt;/span&gt;                BufferedWriter bw = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedWriter(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OutputStreamWriter(out));
                &lt;span class=&quot;code-comment&quot;&gt;//......
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// execute writer operation
&lt;/span&gt;                wStmt.write(bw);
                bw.flush();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also, I just noticed the exception blocks in the patch. Both &apos;IOException&apos; and &apos;RuntimeException&apos; handles the exception in the same way, aborting and throw back exception to the caller. Instead of having multiple blocks, I think we can simplify this by catching &apos;Exception or Throwable&apos; and handle it.&lt;/p&gt;</comment>
                            <comment id="13849114" author="bfreuden" created="Mon, 16 Dec 2013 12:42:02 +0000"  >&lt;p&gt;Hi Ralesh,&lt;/p&gt;

&lt;p&gt;Yes I will refactor the writer logic following your suggestion.&lt;br/&gt;
However I am not fond of the global &quot;catch Exception&quot;: since it is re-thrown, either this will modify the signature of all caller methods (throws Exception), or caller methods will have to catch the Exception and rethrow an IOException (or any other one) embedding the Exception (that was an IOException anyway). This is odd.&lt;br/&gt;
Either the exception is checked and enforced by the compiler (here IOException), or it is unchecked and it will be a subclass of RuntimeException.&lt;br/&gt;
That&apos;s why, as catching a Throwable is never a good idea, we are sure that the double catch (IOException and RuntimeException) is necessary and sufficient. It induces a bit of code duplication, but it sanitizes the throws clause of the method. Would you agree if I left it like as is?&lt;/p&gt;

&lt;p&gt;Bruno.&lt;/p&gt;</comment>
                            <comment id="13850181" author="rakeshr" created="Tue, 17 Dec 2013 06:43:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;However I am not fond of the global &quot;catch Exception&quot;: since it is re-thrown, either this will modify the signature of all caller methods (throws Exception), or caller methods will have to catch the Exception and rethrow an IOException (or any other one) embedding the Exception (that was an IOException anyway). This is odd.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;yeah, it makes sense and separate exception block is ok.&lt;/p&gt;</comment>
                            <comment id="13850989" author="bfreuden" created="Tue, 17 Dec 2013 22:13:24 +0000"  >&lt;p&gt;Taking account latest remarks&lt;/p&gt;</comment>
                            <comment id="13850998" author="bfreuden" created="Tue, 17 Dec 2013 22:21:18 +0000"  >&lt;p&gt;Hi Rakesh,&lt;/p&gt;

&lt;p&gt;First of all, I apologize for mispelling your name in my last comment.&lt;br/&gt;
Please find attached the new patch including all your remarks (well, I hope so). The only one that puzzled me was the &quot;// and the caller will be notified (IOException)&quot;, I didn&apos;t find anything special in it, except the extra spaces after the // that I removed.&lt;br/&gt;
As you will see I have modified the try/catch/finally in a way that should satisfy both of us: it does not duplicate code, it is simpler, and it now resists to any kind of throwable (RuntimeException, Exception, Error) like demonstrated into the new unit tests. I also modified the unit tests to test that the tmp file is removed in any case.&lt;/p&gt;

&lt;p&gt;I&apos;ve tested the &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1691&quot; title=&quot;Add a flag to disable standalone mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1691&quot;&gt;&lt;del&gt;ZOOKEEPER-1691&lt;/del&gt;&lt;/a&gt; patch in addition to this new one, and I still got my dynamic reconfig scenario working like described in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1691&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1691&lt;/a&gt;&lt;br/&gt;
And I finally tested the configBackwardCompatibilityMode scenario where the dynamic config file gets created and the zoo.cfg file rewritten. It still works too.&lt;/p&gt;

&lt;p&gt;I hope I have not forgotten anything!&lt;/p&gt;

&lt;p&gt;Bruno.&lt;/p&gt;</comment>
                            <comment id="13851047" author="hadoopqa" created="Tue, 17 Dec 2013 22:54:07 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12619178/ZOOKEEPER-1835.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12619178/ZOOKEEPER-1835.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1551624.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1845//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1845//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1845//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1845//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1845//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1845//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13855270" author="hadoopqa" created="Sun, 22 Dec 2013 20:54:45 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12620103/ZOOKEEPER-1835.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12620103/ZOOKEEPER-1835.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1552946.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1858//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1858//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1858//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1858//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1858//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1858//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13855272" author="bfreuden" created="Sun, 22 Dec 2013 20:56:51 +0000"  >&lt;p&gt;I&apos;m out of the office till Jan 5th (included), having limited access to my emails.&lt;br/&gt;
In case of urgency, please contact support@temis.com&lt;br/&gt;
Best regards,&lt;/p&gt;
</comment>
                            <comment id="13855296" author="bfreuden" created="Sun, 22 Dec 2013 22:00:56 +0000"  >&lt;p&gt;I don&apos;t know why my out of office reply got here as a comment, but if an admin could delete it (since it is containing an email), it would be great! Thanks in advance,&lt;br/&gt;
Bruno.&lt;/p&gt;</comment>
                            <comment id="13855521" author="bfreuden" created="Mon, 23 Dec 2013 09:35:15 +0000"  >&lt;p&gt;Before explaining the latest patch, let me summarize its content:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I created a new AtomicFileWritingIdiom...&lt;/li&gt;
	&lt;li&gt;reusing the existing AtomicFileOutputStream class,&lt;/li&gt;
	&lt;li&gt;inspired by the way the  writeLongToFile method of QuorumPeer is using it,&lt;/li&gt;
	&lt;li&gt;... and used this new AtomicFileWritingIdiom class in the writeDynamicConfig method of QuorumPeerConfig&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It took me some time to understand what was going wrong in QuorumPeerMainTest and ObserverHierarchicalQuorumTest unit tests with my second patch.&lt;br/&gt;
During my investigations I discovered strange stack traces in the junit reports of the (unpatched) trunk, related to AtomicFileOutputStream :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.nio.channels.ClosedByInterruptException
        at java.nio.channels.spi.AbstractInterruptibleChannel.end(AbstractInterruptibleChannel.java:202)
        at sun.nio.ch.FileChannelImpl.force(FileChannelImpl.java:380)
        at org.apache.zookeeper.common.AtomicFileOutputStream.close(AtomicFileOutputStream.java:71)
        at org.apache.zookeeper.server.quorum.QuorumPeer.writeLongToFile(QuorumPeer.java:1499)
        at org.apache.zookeeper.server.quorum.QuorumPeer.setCurrentEpoch(QuorumPeer.java:1520)
        at org.apache.zookeeper.server.quorum.Leader.lead(Leader.java:523)
        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:980)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;They occur in:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
TEST-org.apache.zookeeper.server.quorum.Zab1_0Test.txt
TEST-org.apache.zookeeper.test.ObserverHierarchicalQuorumTest.txt
TEST-org.apache.zookeeper.test.ReadOnlyModeTest.txt
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There seems to be a problem with the &quot;force(true)&quot; call on the FileChannel. I don&apos;t know why to be honnest (maybe related to the threading model of zookeeper).&lt;br/&gt;
If I simply remove this line (on the unpatched trunk), ClosedByInterruptExceptions disappeared but I observed the same unit test regressions in QuorumPeerMainTest as with my second patch.&lt;br/&gt;
However when I replaced:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
((FileOutputStream) out).getChannel().force(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
((FileOutputStream) out).getFD().sync();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;then there was no ClosedByInterruptException in the report, and no unit test regression.&lt;br/&gt;
And if I apply my patch (the third one, including this modification), there is no unit test regression neither (latest Hadoop QA result).&lt;/p&gt;

&lt;p&gt;It seems that both fc.force() and fd.sync() have the same effect of flushing data on the device:&lt;br/&gt;
&lt;a href=&quot;http://stackoverflow.com/questions/5650327/are-filechannel-force-and-filedescriptor-sync-both-needed&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://stackoverflow.com/questions/5650327/are-filechannel-force-and-filedescriptor-sync-both-needed&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve tested the &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1691&quot; title=&quot;Add a flag to disable standalone mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1691&quot;&gt;&lt;del&gt;ZOOKEEPER-1691&lt;/del&gt;&lt;/a&gt; patch in addition to this new one and the configBackwardCompatibilityMode scenario. Both are still working.&lt;/p&gt;</comment>
                            <comment id="13888606" author="bfreuden" created="Sat, 1 Feb 2014 14:11:13 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I&apos;ve tested the patch against the latest sources of the trunk and it is still ok: dynamic reconfiguration is working on Windows.&lt;br/&gt;
By the way: I&apos;ve run the unit tests on the unpatched trunk on Ubuntu 12.04 64-bit and there was still one ClosedByInterruptException (see above) in TEST-org.apache.zookeeper.test.ObserverHierarchicalQuorumTest.txt. &lt;br/&gt;
With the patch this exception does not occur.&lt;br/&gt;
I would 100% understand if you decided that letting me modify the existing AtomicFileOutputStream class is not a good idea. If this is the case, please tell me and I&apos;ll submit a patch that does not touch this class.&lt;br/&gt;
Regards&lt;/p&gt;</comment>
                            <comment id="13888613" author="hadoopqa" created="Sat, 1 Feb 2014 14:38:41 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12626481/ZOOKEEPER-1835.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12626481/ZOOKEEPER-1835.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1561672.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1909//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1909//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1909//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1909//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1909//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1909//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13888714" author="shralex" created="Sat, 1 Feb 2014 20:09:47 +0000"  >&lt;p&gt;Thanks Bruno! &lt;/p&gt;

&lt;p&gt;Should we use this new class for writing out epoch numbers instead of having a separate QuorumPeer.writeLongToFile ? &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=phunt&quot; class=&quot;user-hover&quot; rel=&quot;phunt&quot;&gt;Patrick Hunt&lt;/a&gt; can you please take a look ? (I see that you originally wrote that function for &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1427&quot; title=&quot;Writing to local files is done non-atomically&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1427&quot;&gt;&lt;del&gt;ZOOKEEPER-1427&lt;/del&gt;&lt;/a&gt;)&lt;br/&gt;
also re Bruno&apos;s question about modifying the existing AtomicFileOutputStream.&lt;/p&gt;

&lt;p&gt;&amp;gt; There is a small bug in the current implementation of the configBackwardCompatibilityMode though: even if the clientPort= line is &lt;br/&gt;
&amp;gt; mentioned the the zoo.cfg file, the port is not appended at the end of the line of the dynamic config. Don&apos;t know if it &quot;deserves&quot; a &lt;br/&gt;
&amp;gt; bug though.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure we want to do this automatically - the user still needs to specify the server specs according to the new format&lt;br/&gt;
for this and the other servers, in all of the config files. Appending just the client port for one of the server in each config file is not enough unless we fix the rest automatically too, which we don&apos;t do.&lt;/p&gt;</comment>
                            <comment id="13888725" author="shralex" created="Sat, 1 Feb 2014 20:28:55 +0000"  >&lt;p&gt;moreover, when the leader is established, if I remember correctly, the leader&apos;s config will be written in everyone&apos;s config files. So unless the leader also somehow knows the client port of this server, the port will disappear from the config file even if you initially append it.&lt;/p&gt;</comment>
                            <comment id="13888740" author="fpj" created="Sat, 1 Feb 2014 21:16:16 +0000"  >&lt;p&gt;AtomicFileWritingIdiomTest passes for me on windows, but ReconfigTest fails. When you say:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;ve tested the patch against the latest sources of the trunk and it is still ok: dynamic reconfiguration is working on Windows.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Do you mean unit tests or tests you&apos;ve written yourself, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bfreuden&quot; class=&quot;user-hover&quot; rel=&quot;bfreuden&quot;&gt;Bruno Freudensprung&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13889078" author="bfreuden" created="Sun, 2 Feb 2014 21:55:51 +0000"  >&lt;p&gt;Hi Alexander,&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Should we use this new class for writing out epoch numbers instead of having a separate QuorumPeer.writeLongToFile ? &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is almost the same code (writeLongToFile is actually where I got the &quot;idiom&quot;), except this modification in the AtomicFileOutputStream. However I preferred leaving it as-is for the sake of &quot;not touching something that is working for aesthetics reasons&quot;. But if you or Patrick Hunt feel ok about it, I can certainly do it. I am just puzzled by this difference between fc.force() and fd.sync().&lt;br/&gt;
Concerning the backward compatibitity mode behavior, I entirely trust you since I don&apos;t know much about ZK (to say the least).&lt;/p&gt;
</comment>
                            <comment id="13889092" author="bfreuden" created="Sun, 2 Feb 2014 22:38:43 +0000"  >&lt;p&gt;Hi Flavio,&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;AtomicFileWritingIdiomTest passes for me on windows, but ReconfigTest fails. When you say: &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; Do you mean unit tests or tests you&apos;ve written yourself&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I mean a test scenario that I am playing manually on Windows (and that did not work without the patch). This manual test is described here: &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1691?focusedCommentId=13846779&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13846779&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1691?focusedCommentId=13846779&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13846779&lt;/a&gt;&lt;br/&gt;
Concerning the ReconfigTest unit test (trunk+patch), on Linux and Windows the result is:&lt;br/&gt;
Tests run: 9, Failures: 0, Errors: 0, Skipped: 0&lt;/p&gt;</comment>
                            <comment id="13959486" author="michim" created="Fri, 4 Apr 2014 01:45:05 +0100"  >&lt;p&gt;Flavio/Bruno, could you guys find out if this patch is causing the test failure?&lt;/p&gt;</comment>
                            <comment id="13959487" author="bfreuden" created="Fri, 4 Apr 2014 01:47:15 +0100"  >&lt;p&gt;I&apos;m out of the office till April 6th (included), having no access to my emails.&lt;br/&gt;
In case of urgency, please contact support@temis.com&lt;br/&gt;
Best regards,&lt;/p&gt;
</comment>
                            <comment id="13963834" author="bfreuden" created="Wed, 9 Apr 2014 06:42:30 +0100"  >&lt;p&gt;I&apos;ll try asap (probably this week-end) to get the latest version of the trunk, run the test suite, apply the patch, run the test suite once again, and compare test results.&lt;br/&gt;
I hope I&apos;ll reproduce the test failure Flavio is talking about.&lt;/p&gt;</comment>
                            <comment id="13968790" author="bfreuden" created="Mon, 14 Apr 2014 21:22:54 +0100"  >&lt;p&gt;Ok, here are the results. &lt;br/&gt;
The short version: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;on Linux, tests results are the same with and without the patch (so I can&apos;t reproduce Flavio&apos;s test failure),&lt;/li&gt;
	&lt;li&gt;on Windows, tests results are better with the patch (even though results are very strange : timeouts, 3 times longer to run on Windows than on Linux despite a far better CPU - maybe an effect of the SSD?).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The long version:&lt;br/&gt;
Test plateforms:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ubuntu 13.04 x64 / Oracle Java 1.7 x64 / Celeron G530 / SSD&lt;/li&gt;
	&lt;li&gt;Windows 7 x64 / Oracle Java 1.7 x64 / Core i7 860 / HDD&lt;br/&gt;
Test suite runs in 45 minutes on Linux, and in 165 minutes on Windows.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Linux trunk-only (failures and errors) and Linux trunk+patch are the same:&lt;br/&gt;
    Running org.apache.zookeeper.server.quorum.StandaloneDisabledTest&lt;br/&gt;
    Tests run: 2, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 107,875 sec&lt;br/&gt;
    Running org.apache.zookeeper.test.StaticHostProviderTest&lt;br/&gt;
    Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0 sec&lt;/p&gt;

&lt;p&gt;Windows trunk+patch (failures and errors):&lt;br/&gt;
    Test org.apache.zookeeper.server.ZxidRolloverTest FAILED (timeout)&lt;br/&gt;
    Test org.apache.zookeeper.server.quorum.ReconfigRecoveryTest FAILED&lt;br/&gt;
    Test org.apache.zookeeper.test.FollowerResyncConcurrencyTest FAILED (timeout)&lt;br/&gt;
    Test org.apache.zookeeper.test.LeaderSessionTrackerTest FAILED (timeout)&lt;br/&gt;
    Test org.apache.zookeeper.test.QuorumTest FAILED (timeout)&lt;br/&gt;
    Test org.apache.zookeeper.test.ReadOnlyModeTest FAILED (timeout)&lt;br/&gt;
    Test org.apache.zookeeper.test.ReconfigTest FAILED (timeout)&lt;br/&gt;
    Test org.apache.zookeeper.test.StaticHostProviderTest FAILED (timeout)&lt;/p&gt;

&lt;p&gt;Windows trunk-only (failures and errors) has the same than above, plus these:&lt;br/&gt;
    Test org.apache.zookeeper.ZooKeeperTest FAILED&lt;br/&gt;
    Test org.apache.zookeeper.ZooKeeperTestableTest FAILED&lt;br/&gt;
    Test org.apache.zookeeper.server.CRCTest FAILED&lt;br/&gt;
    Test org.apache.zookeeper.server.InvalidSnapCountTest FAILED&lt;br/&gt;
    Test org.apache.zookeeper.server.util.DynamicConfigBCTest FAILED&lt;br/&gt;
    Test org.apache.zookeeper.test.AsyncHammerTest FAILED (crashed)&lt;/p&gt;

&lt;p&gt;I&apos;ll try another run on Windows with the SSD to see if results are reproducible.&lt;/p&gt;</comment>
                            <comment id="13969362" author="fpj" created="Tue, 15 Apr 2014 10:18:58 +0100"  >&lt;p&gt;Hi Bruno, You seem to get more errors/failures with the patch on windows, no?  Do you have a windows 8 box to run it?&lt;/p&gt;</comment>
                            <comment id="13969369" author="bfreuden" created="Tue, 15 Apr 2014 10:26:50 +0100"  >&lt;p&gt;Hi Flavio, Actually not. My explanation was not clear (sorry for that): the trunk-only has more test failures but it shares some of them with the trunk+patch. So my first Windows-related list contains the failures found both in trunk-only and trunk+patch (common failures), and my second list contains only the additional failures found in the trunk-only only.&lt;/p&gt;</comment>
                            <comment id="13969375" author="bfreuden" created="Tue, 15 Apr 2014 10:27:44 +0100"  >&lt;p&gt;Yes I have access to a Windows 8 box. I&apos;ll give it a try and keep you posted.&lt;/p&gt;</comment>
                            <comment id="13973389" author="bfreuden" created="Thu, 17 Apr 2014 21:50:06 +0100"  >&lt;p&gt;First I&apos;d like to say I&apos;m sorry for previous alarming test results.&lt;br/&gt;
After encouraging test results on the Windows 8 box, I finally realized that, besides the OS, the other difference was the Java version: Oracle Java 1.6 x64 on my Windows 8 box, and Oracle Java 1.7 x64 on my Windows 7 box.&lt;br/&gt;
I switched to Oracle Java 1.6 x64 on my Windows 7 box as well and... much better!&lt;/p&gt;

&lt;p&gt;Windows 8 trunk-only:&lt;br/&gt;
     Test org.apache.zookeeper.server.util.DynamicConfigBCTest FAILED&lt;br/&gt;
     Test org.apache.zookeeper.test.ClientPortBindTest FAILED&lt;br/&gt;
     Test org.apache.zookeeper.test.QuorumTest FAILED&lt;br/&gt;
     Test org.apache.zookeeper.test.StaticHostProviderTest FAILED (timeout)&lt;/p&gt;

&lt;p&gt;Windows 8 trunk+patch:&lt;br/&gt;
     Test org.apache.zookeeper.server.quorum.ReconfigRecoveryTest FAILED&lt;br/&gt;
     Test org.apache.zookeeper.test.ClientPortBindTest FAILED&lt;br/&gt;
     Test org.apache.zookeeper.test.QuorumTest FAILED&lt;br/&gt;
     Test org.apache.zookeeper.test.StaticHostProviderTest FAILED (timeout)&lt;/p&gt;

&lt;p&gt;Windows 7 trunk-only:&lt;br/&gt;
     Test org.apache.zookeeper.server.quorum.ReconfigRecoveryTest FAILED&lt;br/&gt;
     Test org.apache.zookeeper.server.util.DynamicConfigBCTest FAILED&lt;br/&gt;
     Test org.apache.zookeeper.test.ClientPortBindTest FAILED&lt;br/&gt;
     Test org.apache.zookeeper.test.QuorumTest FAILED&lt;br/&gt;
     Test org.apache.zookeeper.test.StaticHostProviderTest FAILED (timeout)&lt;/p&gt;

&lt;p&gt;Windows 7 trunk+patch:&lt;br/&gt;
     Test org.apache.zookeeper.server.quorum.ReconfigRecoveryTest FAILED&lt;br/&gt;
     Test org.apache.zookeeper.test.ClientPortBindTest FAILED&lt;br/&gt;
     Test org.apache.zookeeper.test.QuorumTest FAILED&lt;br/&gt;
     Test org.apache.zookeeper.test.StaticHostProviderTest FAILED (timeout)&lt;/p&gt;

&lt;p&gt;Quite honestly, I don&apos;t know what to conclude; on Windows test results seem to be so unpredictable.&lt;br/&gt;
The invariant seems to be that org.apache.zookeeper.server.util.DynamicConfigBCTest failure neved showed up with the patch.&lt;br/&gt;
Maybe I&apos;ll try to loop on ReconfigRecoveryTest and DynamicConfigBCTest tests to see if there is a statistical &quot;evidence&quot;.&lt;/p&gt;
</comment>
                            <comment id="13975575" author="bfreuden" created="Mon, 21 Apr 2014 14:51:11 +0100"  >&lt;p&gt;This week-end I looped on DynamicConfigBCTest, ReconfigRecoveryTest and FLETest (tests failures not observed on Linux). Tests are done using a shell script performing a loop of &quot;ant test -Dtestcase=...&quot;.&lt;/p&gt;

&lt;p&gt;DynamicConfigBCTest (more than 6500 loops each): &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;trunk: 100% failures (0 success)&lt;/li&gt;
	&lt;li&gt;patch: 0% failures (0 failure)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ReconfigRecoveryTest (more than 200 loops each): &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;trunk: 99% failures&lt;/li&gt;
	&lt;li&gt;patch: 94% failures&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;FLETest (more than 500 loops each): &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;trunk: 20% failures&lt;/li&gt;
	&lt;li&gt;patch: 2% failures&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ReconfigRecoveryTest and FLETest do exhibit a random behavior on my Windows 7 box.&lt;/p&gt;</comment>
                            <comment id="13976071" author="michim" created="Mon, 21 Apr 2014 22:30:18 +0100"  >&lt;p&gt;Thank you for running these tests Bruno! Flavio/Alex, should we check this patch in? It looks good to me.&lt;/p&gt;</comment>
                            <comment id="13982413" author="shralex" created="Sun, 27 Apr 2014 19:19:08 +0100"  >&lt;p&gt;It looks good, thanks a lot Bruno! &lt;/p&gt;

&lt;p&gt;I&apos;d still suggest to change the implementation of writeLongToFile to use the new Ideom class, to make things consistent. Is there any downside to this ? Could this reduce failures on Windows ? This seems nice to have, but up to you, Bruno.&lt;/p&gt;
</comment>
                            <comment id="14021791" author="bfreuden" created="Mon, 9 Jun 2014 10:29:58 +0100"  >&lt;p&gt;I&apos;m Sorry Alex, I totally missed the notification of your message.&lt;br/&gt;
Hard to say if there is a downside but I&apos;ll do it, run the tests, and we&apos;ll see! Probably next week-end though.&lt;/p&gt;</comment>
                            <comment id="14032006" author="bfreuden" created="Sun, 15 Jun 2014 20:43:05 +0100"  >&lt;p&gt;Here is the new patch including the writeLongToFile implementation based on the idiom.&lt;br/&gt;
I ran junit tests on linux and windows, with and without the patch.&lt;br/&gt;
There is a litle improvement on Linux with org.apache.zookeeper.test.ReconfigTest not failing with the patch.&lt;br/&gt;
On Windows results are still variable, thus not comparable on a single run. During the week, I&apos;ll do another round of test loops.&lt;/p&gt;</comment>
                            <comment id="14034285" author="bfreuden" created="Tue, 17 Jun 2014 21:00:54 +0100"  >&lt;p&gt;re-upload the latest patch in order to try to trigger Hadoop QA report&lt;/p&gt;</comment>
                            <comment id="14045506" author="hadoopqa" created="Fri, 27 Jun 2014 05:22:50 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12650866/ZOOKEEPER-1835.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12650866/ZOOKEEPER-1835.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1605517.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2156//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2156//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2156//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2156//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2156//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2156//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14045553" author="shralex" created="Fri, 27 Jun 2014 06:36:07 +0100"  >&lt;p&gt;+1. The failure seems unrelated to the JIRA&lt;/p&gt;</comment>
                            <comment id="14048630" author="rakeshr" created="Tue, 1 Jul 2014 09:22:57 +0100"  >&lt;p&gt;It seems like this patch is good to go. I&apos;ll check this in tomorrow unless somebody complains.&lt;/p&gt;


&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bfreuden&quot; class=&quot;user-hover&quot; rel=&quot;bfreuden&quot;&gt;Bruno Freudensprung&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Just one comment. IMHO the test class AtomicFileWritingIdiomTest could extend ZKTestCase, it would be helpful later when debugging test case failures.&lt;br/&gt;
If possible please include this minor change and update new patch, otw I&apos;ll do the changes when committing the patch.&lt;/p&gt;</comment>
                            <comment id="14052105" author="rakeshr" created="Fri, 4 Jul 2014 03:24:45 +0100"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bfreuden&quot; class=&quot;user-hover&quot; rel=&quot;bfreuden&quot;&gt;Bruno Freudensprung&lt;/a&gt; for the fix. Thanks for the reviews guys.&lt;/p&gt;

&lt;p&gt;Committed to trunk : &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1607774&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1607774&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14052356" author="hudson" created="Fri, 4 Jul 2014 12:11:39 +0100"  >&lt;p&gt;FAILURE: Integrated in ZooKeeper-trunk #2355 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2355/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2355/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1835&quot; title=&quot;dynamic configuration file renaming fails on Windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1835&quot;&gt;&lt;del&gt;ZOOKEEPER-1835&lt;/del&gt;&lt;/a&gt;. dynamic configuration file renaming fails on Windows(Bruno Freudensprung via rakeshr) (rakeshr: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1607774&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1607774&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/common/AtomicFileOutputStream.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/common/AtomicFileWritingIdiom.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/common/AtomicFileWritingIdiomTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12650866" name="ZOOKEEPER-1835.patch" size="29204" author="bfreuden" created="Tue, 17 Jun 2014 21:00:54 +0100"/>
                            <attachment id="12650491" name="ZOOKEEPER-1835.patch" size="29204" author="bfreuden" created="Sun, 15 Jun 2014 20:43:31 +0100"/>
                            <attachment id="12626481" name="ZOOKEEPER-1835.patch" size="26653" author="bfreuden" created="Sat, 1 Feb 2014 14:00:24 +0000"/>
                            <attachment id="12620103" name="ZOOKEEPER-1835.patch" size="26653" author="bfreuden" created="Sun, 22 Dec 2013 20:13:59 +0000"/>
                            <attachment id="12619178" name="ZOOKEEPER-1835.patch" size="26028" author="bfreuden" created="Tue, 17 Dec 2013 22:13:24 +0000"/>
                            <attachment id="12618808" name="ZOOKEEPER-1835.patch" size="19301" author="bfreuden" created="Sun, 15 Dec 2013 08:35:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 15 Dec 2013 09:15:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>363424</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzkhn3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>363730</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Patch described in this comment below:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1835?focusedCommentId=13848420&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13848420&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1835?focusedCommentId=13848420&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13848420&lt;/a&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>