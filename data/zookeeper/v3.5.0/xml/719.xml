<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:39:58 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-719/ZOOKEEPER-719.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-719] Add throttling to BookKeeper client</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-719</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;Add throttling to client to control the rate of operations to bookies. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12459682">ZOOKEEPER-719</key>
            <summary>Add throttling to BookKeeper client</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fpj">Flavio Junqueira</assignee>
                                    <reporter username="fpj">Flavio Junqueira</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Mar 2010 17:35:11 +0000</created>
                <updated>Wed, 23 Nov 2011 19:22:40 +0000</updated>
                            <resolved>Fri, 9 Jul 2010 21:54:36 +0100</resolved>
                                    <version>3.3.0</version>
                                    <fixVersion>3.4.0</fixVersion>
                                    <component>contrib-bookkeeper</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12848420" author="phunt" created="Mon, 22 Mar 2010 22:55:26 +0000"  >&lt;p&gt;Is this really a bug or improvement? If not a bug it should go to 3.4.0 and not 3.3.1. Marking for 3.3.1/3.4.0 for now.&lt;/p&gt;</comment>
                            <comment id="12849108" author="fpj" created="Wed, 24 Mar 2010 08:41:51 +0000"  >&lt;p&gt;I&apos;m not sure how to classify this one. In my test cases, the only problem it causes me so far is that it makes it more difficult to measure throughput because some bookies can be arbitrarily ahead of others in an ensemble while writing. One could see it as a bug too, I suppose, since throttling is desirable to keep the flow of requests under control.&lt;/p&gt;

&lt;p&gt;It is fine to have it marked for 3.4.0 for me.&lt;/p&gt;</comment>
                            <comment id="12852579" author="fpj" created="Thu, 1 Apr 2010 23:25:48 +0100"  >&lt;p&gt;I added a semaphore object to count the number of writes and reads pending to LedgerHandle. This solution does not cause a deadlock in the case of bookie crashes, which happens if we change the pendingAddOps ArrayDeque to a blocking data structure.&lt;/p&gt;</comment>
                            <comment id="12852586" author="hadoopqa" created="Thu, 1 Apr 2010 23:48:13 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12440549/ZOOKEEPER-719.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12440549/ZOOKEEPER-719.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 929564.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no tests are needed for this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/41/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/41/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/41/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/41/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/41/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/41/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12852843" author="fpj" created="Fri, 2 Apr 2010 15:53:37 +0100"  >&lt;p&gt;I&apos;m not happy with this patch for two reasons:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;In this current form, it is not possible to set the maximum number of outstanding operations;&lt;/li&gt;
	&lt;li&gt;Because of the use of a semaphore, I had to catch InterruptedException in a few places. The most critical ones for me are the ones in the procedure to recover a ledger. I believe in the way I have currently implemented, it could cause problems if an instance of InterruptedException is raised when recovering a ledger, since the procedure could complete successfully. I need to investigate this further and either determine that it isn&apos;t a problem or find a better way.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Any suggestion would be appreciated.     &lt;/p&gt;</comment>
                            <comment id="12852852" author="phunt" created="Fri, 2 Apr 2010 16:48:31 +0100"  >&lt;p&gt;3. tests missing&lt;/p&gt;</comment>
                            <comment id="12870291" author="fpj" created="Sat, 22 May 2010 12:59:48 +0100"  >&lt;p&gt;I have added a call to set the throttling threshold in LedgerHandle and a test to set the threshold value while reading and writing. I have also added calls to interrupt the current thread in the catch block of InterruptedException in LedgerRecoveryOp. &lt;/p&gt;</comment>
                            <comment id="12870292" author="hadoopqa" created="Sat, 22 May 2010 13:27:20 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12445236/ZOOKEEPER-719.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12445236/ZOOKEEPER-719.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 947063.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/103/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/103/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/103/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/103/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/103/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/103/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12870297" author="fpj" created="Sat, 22 May 2010 14:12:48 +0100"  >&lt;p&gt;The core test failure is unrelated to this patch. This patch does not affect any ZK core code.&lt;/p&gt;</comment>
                            <comment id="12873167" author="breed" created="Fri, 28 May 2010 23:14:27 +0100"  >&lt;p&gt;there are a couple of problems:&lt;/p&gt;

&lt;p&gt;1) you seem to have a stray opCounterSem in PerClientBookieClient. you define it, but you never use it.&lt;/p&gt;

&lt;p&gt;2) i think it might be better to use a system property to set the throttling rather than allow it to be dynamically changed. it simplifies the code. setThrottle is especially problematic since you are catching InterruptedException and it isn&apos;t thread safe.&lt;/p&gt;</comment>
                            <comment id="12873386" author="fpj" created="Sun, 30 May 2010 09:33:06 +0100"  >&lt;p&gt;Thanks for the comments, Ben. I see three options to set the throttling threshold:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Use a configuration file to set the parameter value. Unfortunately, there are a couple of issues to this option. First, we currently don&apos;t have a config file on the client side, and I&apos;m not sure if one variable would justify setting it up. Second, I&apos;m not convinced that it is a good idea to have config files on the client side. It is nice to instantiate a BookKeeper object without having to bother about config files (on the client side);&lt;/li&gt;
	&lt;li&gt;Add an input variable to BookKeeper constructors or to createLedger/openLedger calls. This one sounds like a bad option to me because I don&apos;t think it will be used often and it is not related to the corresponding operations;&lt;/li&gt;
	&lt;li&gt;Use set/get calls to change the threshold value. This is what I used with this patch.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;A fourth option is to have an environment variable, but this is similar to having a config file, so I&apos;m not sure there is any great advantage.&lt;/p&gt;

&lt;p&gt;Any thoughts?&lt;/p&gt;</comment>
                            <comment id="12873580" author="fpj" created="Mon, 31 May 2010 09:18:40 +0100"  >&lt;p&gt;Canceling patch until we decide how to control throttling on the client.&lt;/p&gt;</comment>
                            <comment id="12878850" author="breed" created="Tue, 15 Jun 2010 05:09:48 +0100"  >&lt;p&gt;i think using a system property is still the easiest, but i&apos;m fine with the set/get if you want to do it. you just need to make it thread safe.&lt;/p&gt;</comment>
                            <comment id="12883945" author="fpj" created="Wed, 30 Jun 2010 15:52:17 +0100"  >&lt;p&gt;Submitting a new patch that uses a system property.&lt;/p&gt;

&lt;p&gt;In LedgerHandle, I&apos;m currently throwing NumberFormatException instead of catching it locally. My rationale is that if a user is trying to set the throttling threshold, then we should not proceed when the input value is not correct. To catch and handle a NFE exception that may arise in both LedgerCreateOp and LedgerOpenOp, I created a new BKException called BKIncorrectParameterException.&lt;/p&gt;

</comment>
                            <comment id="12884100" author="hadoopqa" created="Thu, 1 Jul 2010 00:46:10 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12448407/ZOOKEEPER-719.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12448407/ZOOKEEPER-719.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 958096.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no tests are needed for this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/91/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/91/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/91/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/91/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/91/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/91/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12884164" author="fpj" created="Thu, 1 Jul 2010 06:03:02 +0100"  >&lt;p&gt;My bad, forgot to include the test file in the patch... Resubmitting in a second. &lt;/p&gt;</comment>
                            <comment id="12884182" author="hadoopqa" created="Thu, 1 Jul 2010 07:13:29 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12448478/ZOOKEEPER-719.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12448478/ZOOKEEPER-719.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 958096.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/92/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/92/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/92/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/92/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/92/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/92/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12886019" author="breed" created="Wed, 7 Jul 2010 19:17:18 +0100"  >&lt;p&gt;+1 looks good&lt;/p&gt;</comment>
                            <comment id="12886880" author="breed" created="Fri, 9 Jul 2010 21:54:36 +0100"  >&lt;p&gt;Committed revision 962693.&lt;/p&gt;</comment>
                            <comment id="12890523" author="hudson" created="Wed, 21 Jul 2010 02:43:28 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #881 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/881/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/881/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12448478" name="ZOOKEEPER-719.patch" size="15283" author="fpj" created="Thu, 1 Jul 2010 06:30:36 +0100"/>
                            <attachment id="12448407" name="ZOOKEEPER-719.patch" size="10821" author="fpj" created="Wed, 30 Jun 2010 15:52:16 +0100"/>
                            <attachment id="12445236" name="ZOOKEEPER-719.patch" size="12171" author="fpj" created="Sat, 22 May 2010 12:59:48 +0100"/>
                            <attachment id="12440549" name="ZOOKEEPER-719.patch" size="5044" author="fpj" created="Thu, 1 Apr 2010 23:25:48 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 22 Mar 2010 22:55:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47636</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzudj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32905</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>