<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:50:43 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-820/ZOOKEEPER-820.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-820] update c unit tests to ensure &quot;zombie&quot; java server processes don&apos;t cause failure</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-820</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;When the c unit tests are run sometimes the server doesn&apos;t shutdown at the end of the test, this causes subsequent tests (hudson esp) to fail.&lt;/p&gt;

&lt;p&gt;1) we should try harder to make the server shut down at the end of the test, I suspect this is related to test failing/cleanup&lt;br/&gt;
2) before the tests are run we should see if the old server is still running and try to shut it down&lt;/p&gt;</description>
                <environment></environment>
        <key id="12469466">ZOOKEEPER-820</key>
            <summary>update c unit tests to ensure &quot;zombie&quot; java server processes don&apos;t cause failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="michim">Michi Mutsuzaki</assignee>
                                    <reporter username="phunt">Patrick Hunt</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Jul 2010 17:00:32 +0100</created>
                <updated>Wed, 23 Nov 2011 19:22:45 +0000</updated>
                            <resolved>Wed, 20 Oct 2010 19:46:25 +0100</resolved>
                                    <version>3.3.1</version>
                                    <fixVersion>3.3.2</fixVersion>
                    <fixVersion>3.4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12889216" author="phunt" created="Fri, 16 Jul 2010 17:01:11 +0100"  >&lt;p&gt;Mahadev suggested this for item 2 from the description:&lt;/p&gt;

&lt;p&gt;&amp;gt;   I think we could some more standard tools like netstat to getthe process&lt;br/&gt;
&amp;gt; using that port and try killing it. This would be less error prone nd more&lt;br/&gt;
&amp;gt; reliable than other tools.&lt;/p&gt;</comment>
                            <comment id="12902014" author="michim" created="Tue, 24 Aug 2010 19:56:15 +0100"  >&lt;p&gt;What&apos;s the &apos;correct&apos; way to stop zookeeper server process? Right now the c unit test does kill -9. Is there a way to do clean shutdown?&lt;/p&gt;

&lt;p&gt;--Michi&lt;/p&gt;</comment>
                            <comment id="12902151" author="michim" created="Wed, 25 Aug 2010 00:20:57 +0100"  >&lt;p&gt;This patch is for branch-3.3.&lt;/p&gt;

&lt;p&gt;I changed 2 things.&lt;/p&gt;

&lt;p&gt;1. Instead of using a file to keep track of pid, use lsof to check if a process is using port 22181.&lt;br/&gt;
2. Fixed invalid return code checking. This was causing the unit test to go into a loop for 2 minutes in certain cases. &lt;/p&gt;

&lt;p&gt;--Michi&lt;/p&gt;</comment>
                            <comment id="12902161" author="michim" created="Wed, 25 Aug 2010 00:42:05 +0100"  >&lt;p&gt;One more change. I like to change the sleep time to from 5 seconds 1 second. Most of the time, 1 second is enough for the server to start up (at least on my box). &lt;/p&gt;

&lt;p&gt;--Michi&lt;/p&gt;</comment>
                            <comment id="12909306" author="mahadev" created="Tue, 14 Sep 2010 17:21:21 +0100"  >&lt;p&gt;The only comment I have is  that these scripts might not work on cygwin.  Let me try and check how lsof works on cygwin windows.&lt;/p&gt;</comment>
                            <comment id="12915799" author="breed" created="Tue, 28 Sep 2010 16:57:31 +0100"  >&lt;p&gt;+1 this looks good to me. did you try it on cygwin?&lt;/p&gt;</comment>
                            <comment id="12915918" author="michim" created="Tue, 28 Sep 2010 21:48:36 +0100"  >&lt;p&gt;Cygwin doesn&apos;t have lsof. &lt;/p&gt;

&lt;p&gt;Most of the time, &apos;zombie&apos; process is caused by the invalid return code checking (it keeps starting the server process in a loop for 2 minutes). I think it&apos;s ok to use pid file to keep track of the server process. &lt;/p&gt;

&lt;p&gt;I&apos;ll submit a new patch.&lt;/p&gt;

&lt;p&gt;--Michi&lt;/p&gt;</comment>
                            <comment id="12915936" author="michim" created="Tue, 28 Sep 2010 22:51:47 +0100"  >&lt;p&gt;Reverted back to use pid file instead of lsof. &lt;/p&gt;</comment>
                            <comment id="12918144" author="mahadev" created="Tue, 5 Oct 2010 21:04:16 +0100"  >&lt;p&gt;thsi does fix the if problem in the script (which took me sometime to realise was backwards &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ). Michi, can you also add the lsof check as follows:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; which lsof &amp;gt; /dev/&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; 2&amp;gt;&amp;amp;1; then &lt;span class=&quot;code-quote&quot;&gt;&quot;run the command to kill the process using lsof&quot;&lt;/span&gt;; &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;we dont &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; anything&quot;&lt;/span&gt;; fi
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that this is in addition to using pid checks. We can do the following -&lt;/p&gt;

&lt;p&gt;on stop server:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;kill using pid file first&lt;/li&gt;
	&lt;li&gt;kill using lsof, if any such process if present.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12918596" author="phunt" created="Wed, 6 Oct 2010 18:03:54 +0100"  >&lt;p&gt;Cancelling patch - needs to be updated for Mahadev&apos;s most recent comment.&lt;/p&gt;</comment>
                            <comment id="12921927" author="michim" created="Mon, 18 Oct 2010 00:51:53 +0100"  >&lt;p&gt;Uses which to check if lsof command is present. If it is, use it to see if there is a process listening on port 22181 and kill it. &lt;/p&gt;

&lt;p&gt;--Michi&lt;/p&gt;</comment>
                            <comment id="12923085" author="phunt" created="Wed, 20 Oct 2010 19:46:25 +0100"  >&lt;p&gt;+1, committed to trunk/branch33. Thanks Michi!&lt;/p&gt;</comment>
                            <comment id="12923115" author="hudson" created="Wed, 20 Oct 2010 20:26:09 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #973 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/ZooKeeper-trunk/973/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/ZooKeeper-trunk/973/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-820&quot; title=&quot;update c unit tests to ensure &amp;quot;zombie&amp;quot; java server processes don&amp;#39;t cause failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-820&quot;&gt;&lt;del&gt;ZOOKEEPER-820&lt;/del&gt;&lt;/a&gt;. update c unit tests to ensure &quot;zombie&quot; java server processes dont cause failure&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12452989" name="ZOOKEEPER-820-1.patch" size="2528" author="michim" created="Wed, 25 Aug 2010 00:42:05 +0100"/>
                            <attachment id="12457400" name="ZOOKEEPER-820.patch" size="2507" author="michim" created="Mon, 18 Oct 2010 00:51:53 +0100"/>
                            <attachment id="12455878" name="ZOOKEEPER-820.patch" size="2104" author="michim" created="Tue, 28 Sep 2010 22:51:47 +0100"/>
                            <attachment id="12452987" name="ZOOKEEPER-820.patch" size="2392" author="michim" created="Wed, 25 Aug 2010 00:20:57 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 24 Aug 2010 18:56:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47585</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzu2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32855</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>