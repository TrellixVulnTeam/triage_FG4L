<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:45:10 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1992/ZOOKEEPER-1992.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1992] backward compatibility of zoo.cfg</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1992</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;This issue supersedes our discussion in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1989&quot; title=&quot;backward compatibility of zoo.cfg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1989&quot;&gt;&lt;del&gt;ZOOKEEPER-1989&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;To summarize, ZK users can seamlessly upgrade 3.4 to 3.5. But two things will happen:&lt;br/&gt;
1. the server list will be separated out as a dynamic file (the original should be backup automatically).&lt;br/&gt;
2. Client port is mandatory on reconfig. So when reconfig the server itself (its id), the client port in config file will be removed and replaced by the one in reconfig (written in dynamic file).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12730105">ZOOKEEPER-1992</key>
            <summary>backward compatibility of zoo.cfg</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hdeng">Hongchao Deng</assignee>
                                    <reporter username="hdeng">Hongchao Deng</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Jul 2014 03:05:18 +0100</created>
                <updated>Sat, 2 Aug 2014 20:00:12 +0100</updated>
                            <resolved>Fri, 1 Aug 2014 06:43:13 +0100</resolved>
                                    <version>3.5.0</version>
                                    <fixVersion>3.5.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                            <comments>
                            <comment id="14079668" author="shralex" created="Wed, 30 Jul 2014 19:08:50 +0100"  >&lt;p&gt;&amp;gt; Client port is mandatory on reconfig.&lt;/p&gt;

&lt;p&gt;I think we don&apos;t have to enforce this as part of this JIRA.&lt;/p&gt;

&lt;p&gt;How about this:&lt;/p&gt;

&lt;p&gt;-In QuorumPeer.writeDynamicConfig, pass a new parameter that indicates that you need to delete clientPort and clientPortAddress from the static file (last configuration didn&apos;t includes a client port for self.getId() but the new one has it, you can know that from where you call this function, in setQuorumVerifier).&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If a failure happens after updating the dynamic file but before you update the static file, indeed you could come up and have clientPort and/or clientPortAddress in both the static and dynamic files and they could be different. If they are different I think we should still raise an error like we&apos;re doing now and require admin intervention. If they are equal you could delete clientPort from the static file in QuorumPeerConfig when the server comes up.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;My rational is that after the server comes up the two files should be consistent and the port is either in the static file or in the dynamic one but not in both. Silently prioritizing the dynamic port and removing the conflicting static port to solve the inconsistency may be a surprise to the user. But actually I don&apos;t feel strongly about it. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=phunt&quot; class=&quot;user-hover&quot; rel=&quot;phunt&quot;&gt;Patrick Hunt&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michim&quot; class=&quot;user-hover&quot; rel=&quot;michim&quot;&gt;Michi Mutsuzaki&lt;/a&gt; which way would you prefer ? &lt;/p&gt;</comment>
                            <comment id="14079683" author="phunt" created="Wed, 30 Jul 2014 19:15:04 +0100"  >&lt;blockquote&gt;&lt;p&gt;If they are different I think we should still raise an error like we&apos;re doing now and require admin intervention.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;that sounds reasonable to me&lt;/p&gt;</comment>
                            <comment id="14079736" author="hdeng" created="Wed, 30 Jul 2014 19:40:20 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;br/&gt;
Could you give more details about your method? I will try to make it work.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Silently prioritizing the dynamic port and removing the conflicting static port to solve the inconsistency may be a surprise to the user.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;As we discussed before, what happened in reconfig client port is that if there is client port in static file, it is gonna remove that one from static file too. But my worry is that this requires much consideration on consistency in removing the line and updating the dynamic file.&lt;/p&gt;

&lt;p&gt;So my plan is that:&lt;br/&gt;
1. Keep the client port on fresh boot for backward compatibility.&lt;br/&gt;
Then what happens if the server reconfig itself client port? Well, I plan for two tasks, where the second task is gonna replace the first one finally.&lt;br/&gt;
2.1 Since it will updates the client port in dynamic file, making a preference on dynamic file over static file is a hackish way to finish it. Not delete/remove here. This would be quick and make out a release. This is part of ZOOKEEPRE-1993&lt;br/&gt;
2.2 (This one is difficult and I need more time to get through the code.) Basically, on reconfiguring the client port on itself, it should safely remove the client port, update the dynamic file. This is part of ZOOKEEPRE-1995&lt;/p&gt;

&lt;p&gt;Does that make sense? Please let me know what you think might be proper solution.&lt;/p&gt;</comment>
                            <comment id="14079760" author="shralex" created="Wed, 30 Jul 2014 19:51:20 +0100"  >&lt;p&gt;Here&apos;s my proposal, can you clarify which part you feel uncomfortable with ?&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;in QuorumPeer.writeDynamicConfig, pass a new parameter that indicates that you need to delete clientPort and clientPortAddress from the static file (last configuration didn&apos;t includes a client port for self.getId() but the new one has it, you can know that from where you call this function, in QuorumPeer.setQuorumVerifier).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;in QuorumPeerConfig, where this exception is thrown&lt;br/&gt;
throw new ConfigException(&quot;client address for this server (id = &quot; + serverId + &quot;) in static config file is &quot; + clientPortAddress + &quot; is different from client address found in dynamic file: &quot; + qs.clientAddr);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;and an &quot;else&quot; (meaning &quot;everything is consistent) that in case clientPort and clientPortAddress appear in the dynamic file removes them from the static file. &lt;/p&gt;</comment>
                            <comment id="14079772" author="hdeng" created="Wed, 30 Jul 2014 19:59:46 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;br/&gt;
Regarding keeping the client port on fresh boot??&lt;br/&gt;
Just change this??&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                           &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!key.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;server.&quot;&lt;/span&gt;) &amp;amp;&amp;amp; !key.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;group&quot;&lt;/span&gt;) 
                                   &amp;amp;&amp;amp; !key.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;) &amp;amp;&amp;amp; !key.equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;clientPort&quot;&lt;/span&gt;) &amp;amp;&amp;amp; !key.equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;clientPortAddress&quot;&lt;/span&gt;)){
                               out.write(key.concat(&lt;span class=&quot;code-quote&quot;&gt;&quot;=&quot;&lt;/span&gt;).concat(value).concat(&lt;span class=&quot;code-quote&quot;&gt;&quot;\n&quot;&lt;/span&gt;));
                           }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14079782" author="shralex" created="Wed, 30 Jul 2014 20:04:58 +0100"  >&lt;p&gt;right - just remove the &quot;!key.equals(&quot;clientPort&quot;) &amp;amp;&amp;amp; !key.equals(&quot;clientPortAddress&quot;)&quot; from the above.&lt;/p&gt;</comment>
                            <comment id="14079787" author="hdeng" created="Wed, 30 Jul 2014 20:08:39 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;br/&gt;
Okay.&lt;br/&gt;
I will get the minimal change. As far as I know, I got several test errors If I forced a client port check after parsing.. But I will put off this and delve into the finer grain patches (also later)..&lt;/p&gt;</comment>
                            <comment id="14079803" author="hdeng" created="Wed, 30 Jul 2014 20:15:27 +0100"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;. I am not sure what this means.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;last configuration didn&apos;t includes a client port for self.getId() but the new one has it&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Can you be more specific?? Thanks.&lt;/p&gt;</comment>
                            <comment id="14079853" author="hdeng" created="Wed, 30 Jul 2014 20:53:41 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;br/&gt;
Please take a look at the draft for the idea of workflow.&lt;br/&gt;
Let me know your feedback.&lt;br/&gt;
I will try to implement and test them.&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                            <comment id="14079927" author="hdeng" created="Wed, 30 Jul 2014 21:34:40 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;br/&gt;
I finished the coding. Start testing it. Second draft.&lt;/p&gt;</comment>
                            <comment id="14079935" author="shralex" created="Wed, 30 Jul 2014 21:41:04 +0100"  >&lt;p&gt;looks pretty good, thanks. a few comments&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;eraseClient() should compare prevQV (the previous committed configuration) and qv  or quorumVerifier (the new committed configuration).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;something like eraseClient(QuorumVerier prevQV, QuorumVerifier newQV) &lt;/p&gt;
{
       QuorumServer myOldSpec = prevQV.getAllMembers().get(getId());
       QuorumServer myNewSpec = quorumVerifier.getAllMembers().get(getId());
       return (myNewSpec != null &amp;amp;&amp;amp; myNewSpec.clientAddr != null 
               &amp;amp;&amp;amp; (myOldSpec == null || myOldSpec.clientAddr == null);
}

&lt;p&gt;maybe change &quot;eraseClient&quot; to something like &quot;eraseStaticClientPortInfo&quot; so that its more clear&lt;/p&gt;</comment>
                            <comment id="14079945" author="hdeng" created="Wed, 30 Jul 2014 21:45:32 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;br/&gt;
One more question:&lt;br/&gt;
I am confused by setLastSeenQuorumXXX and setQuorumXXX.&lt;br/&gt;
I think I just need erase client port in setQuorumXXX because that&apos;s where the client port is updated to actual dynamic file. Correct?&lt;/p&gt;</comment>
                            <comment id="14079962" author="shralex" created="Wed, 30 Jul 2014 21:57:36 +0100"  >&lt;p&gt;yes, that&apos;s correct. &lt;br/&gt;
the logic here seems wrong - some of the &amp;amp;&amp;amp; should be || etc... a key can&apos;t both start with server. and with group.&lt;/p&gt;

&lt;p&gt;+                    if ((backwardCompatible&lt;br/&gt;
+                            &amp;amp;&amp;amp; key.startsWith(&quot;server.&quot;) &amp;amp;&amp;amp; key.startsWith(&quot;group&quot;)&lt;br/&gt;
+                            &amp;amp;&amp;amp; key.startsWith(&quot;weight&quot;))&lt;br/&gt;
+                            ||&lt;br/&gt;
+                            (eraseClient&lt;br/&gt;
+                                    &amp;amp;&amp;amp; key.equals(&quot;clientPort&quot;) &amp;amp;&amp;amp; key.equals(&quot;clientPortAddress&quot;))) {&lt;br/&gt;
+                        continue;&lt;/p&gt;

&lt;p&gt;if (!key.startsWith(&quot;server.&quot;) &amp;amp;&amp;amp; !key.startsWith(&quot;group&quot;) &amp;amp;&amp;amp; !key.startsWith(&quot;weight&quot;)&lt;br/&gt;
    &amp;amp;&amp;amp; (!eraseClient || ( !key.equals(&quot;clientPort&quot;) &amp;amp;&amp;amp; !key.equals(&quot;clientPortAddress&quot;))){&lt;br/&gt;
                               out.write(key.concat(&quot;=&quot;).concat(value).concat(&quot;\n&quot;));&lt;/p&gt;
</comment>
                            <comment id="14079964" author="shralex" created="Wed, 30 Jul 2014 21:58:16 +0100"  >&lt;p&gt;sorry - the &quot;if&quot; at the end of my message is a suggested change&lt;/p&gt;</comment>
                            <comment id="14080003" author="hdeng" created="Wed, 30 Jul 2014 22:27:24 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;br/&gt;
There you go~ I will open a review board start testing it&lt;/p&gt;</comment>
                            <comment id="14080099" author="hdeng" created="Wed, 30 Jul 2014 23:37:43 +0100"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;br/&gt;
I uploaded the final patch that I tested manually:&lt;br/&gt;
1. Start from old style config, has client port remain&lt;br/&gt;
2. reconfig change port, port is removed from static file and added in dynamic file.&lt;/p&gt;

&lt;p&gt;I have a few unit tests failing. I am trying to look at them and ask for more help.&lt;br/&gt;
I have a question about reconfig client port:&lt;br/&gt;
1. If a client reconfig the port it&apos;s connected to, what happened? Is it automatically changed to another port?&lt;/p&gt;</comment>
                            <comment id="14080104" author="hdeng" created="Wed, 30 Jul 2014 23:41:48 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;br/&gt;
I couldn&apos;t get those annoying whitespace changes out on reviewboard. So I am using Github for it&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/fengjingchao/zookeeper/commit/ab49b98ca07d2a675115b4a65a552e64c544127d?w=1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/fengjingchao/zookeeper/commit/ab49b98ca07d2a675115b4a65a552e64c544127d?w=1&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14080156" author="hdeng" created="Thu, 31 Jul 2014 00:09:40 +0100"  >&lt;p&gt;Updated the patch.&lt;/p&gt;

&lt;p&gt;Review place:&lt;br/&gt;
&lt;a href=&quot;https://github.com/fengjingchao/zookeeper/commit/4528d636d0639b62fcabe2ec07a0ac276fe967cc?w=1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/fengjingchao/zookeeper/commit/4528d636d0639b62fcabe2ec07a0ac276fe967cc?w=1&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="14080252" author="hdeng" created="Thu, 31 Jul 2014 01:01:27 +0100"  >&lt;p&gt;The previous patch is generated using&lt;br/&gt;
&quot;git diff -w&quot;&lt;br/&gt;
which ignores whitespaces.&lt;br/&gt;
In case that doesn&apos;t work, here&apos;s an equivalent patch which contains all whitespace, CRLT-&amp;gt;LF changes using&lt;br/&gt;
&quot;git diff&quot;&lt;/p&gt;</comment>
                            <comment id="14080279" author="hdeng" created="Thu, 31 Jul 2014 01:16:51 +0100"  >&lt;p&gt;This patch is generated using&lt;br/&gt;
&quot;git diff -w --no-prefix&quot;&lt;br/&gt;
The previous &quot;-withspaces&quot; one is&lt;br/&gt;
&quot;git diff --no-prefix&quot;&lt;/p&gt;</comment>
                            <comment id="14080317" author="hadoopqa" created="Thu, 31 Jul 2014 01:46:44 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12658790/ZOOKEEPER-1992-withspaces.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12658790/ZOOKEEPER-1992-withspaces.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1613553.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2247//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2247//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2247//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2247//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2247//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2247//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14080365" author="hadoopqa" created="Thu, 31 Jul 2014 02:25:02 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12658791/ZOOKEEPER-1992-without-spaces.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12658791/ZOOKEEPER-1992-without-spaces.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1613553.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2248//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2248//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14080423" author="hdeng" created="Thu, 31 Jul 2014 04:05:16 +0100"  >&lt;p&gt;I do a&lt;br/&gt;
&quot;git add -p&quot;&lt;br/&gt;
And this is the minimal changes I picked.&lt;/p&gt;</comment>
                            <comment id="14080428" author="hdeng" created="Thu, 31 Jul 2014 04:14:36 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;br/&gt;
This is the latest patch from the &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1992&quot; title=&quot;backward compatibility of zoo.cfg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1992&quot;&gt;&lt;del&gt;ZOOKEEPER-1992&lt;/del&gt;&lt;/a&gt;-gitaddp.patch&quot;:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/fengjingchao/zookeeper/commit/217b7de2b242efbf6bb9dd85baad02b34dfd316e?w=1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/fengjingchao/zookeeper/commit/217b7de2b242efbf6bb9dd85baad02b34dfd316e?w=1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;When ignoring whitespace/line-ending changes they are all the same. It&apos;s the as minimal as I could. Hopefully we can get this in.&lt;/p&gt;</comment>
                            <comment id="14080473" author="shralex" created="Thu, 31 Jul 2014 05:25:03 +0100"  >&lt;p&gt;Hi, Some test is failing - see last test results  (ReconfigTest.testRemoveAddOne)&lt;/p&gt;</comment>
                            <comment id="14080482" author="hdeng" created="Thu, 31 Jul 2014 05:39:40 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;br/&gt;
I saw that this afternoon. It&apos;s weird..&lt;br/&gt;
I tested it locally and in my jenkins. They all passed.&lt;br/&gt;
Let it trigger another Pre-Build and see what happened.&lt;/p&gt;</comment>
                            <comment id="14080493" author="shralex" created="Thu, 31 Jul 2014 05:55:31 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hdeng&quot; class=&quot;user-hover&quot; rel=&quot;hdeng&quot;&gt;Hongchao Deng&lt;/a&gt; can you attach an uptodate patch generated by svn diff including the new test(s) ?&lt;/p&gt;</comment>
                            <comment id="14080497" author="hdeng" created="Thu, 31 Jul 2014 06:01:14 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;br/&gt;
Sure.&lt;br/&gt;
Just sync up before I wrote the code.&lt;/p&gt;

&lt;p&gt;Regarding the tests, I plan for the following:&lt;br/&gt;
1. test dynamic goes up with old style config will have client port and can do reconfig&lt;br/&gt;
2. test reconfig client port itself will remove the client port in static file and add it in dynamic file.&lt;/p&gt;

&lt;p&gt;Let me know if I miss anything.&lt;/p&gt;</comment>
                            <comment id="14080498" author="hadoopqa" created="Thu, 31 Jul 2014 06:01:39 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12658827/ZOOKEEPER-1992-gitaddp.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12658827/ZOOKEEPER-1992-gitaddp.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1613553.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2249//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2249//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2249//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2249//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2249//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2249//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14080509" author="shralex" created="Thu, 31 Jul 2014 06:19:29 +0100"  >&lt;p&gt;when you do the reconfig in a test, for example adding one of the servers this time with a port specified, you could check that its static config was updated (like you suggest) and also check that the static configs of the other servers were not updated - still contain their client ports.&lt;/p&gt;</comment>
                            <comment id="14080541" author="shralex" created="Thu, 31 Jul 2014 07:00:27 +0100"  >&lt;p&gt;some minor naming suggestions:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;needEraseClient() -&amp;gt; eraseClientInfoFromStaticConfig()&lt;/li&gt;
	&lt;li&gt;eraseLinesInStaticFile() - &amp;gt; editStaticConfig ()    (since it is also adding lines, not only removing)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14080577" author="shralex" created="Thu, 31 Jul 2014 07:46:26 +0100"  >&lt;p&gt;if you look at the log for the failed test, there is a null pointer exception. It happens because the test doesn&apos;t create a static config file - it creates a QuorumPeer object directly and has only a dynamic config file. To fix this change&lt;br/&gt;
QuorumPeer.needEraseClient last line to &quot;return (configFilename!=null &amp;amp;&amp;amp; ... &quot;&lt;/p&gt;

&lt;p&gt;&amp;gt; If a client reconfig the port it&apos;s connected to, what happened? Is it automatically changed to another port?&lt;/p&gt;

&lt;p&gt;I think right now it just closes the socket and the clients disconnect. I&apos;m not 100% sure. There may be a better way to do it, if you&apos;d like, take a look at NIOServerCnxmFactory.java, reconfigure() and NettyServerCnxnFactory.java reconfigure()&lt;/p&gt;</comment>
                            <comment id="14080596" author="shralex" created="Thu, 31 Jul 2014 08:19:12 +0100"  >&lt;p&gt;sorry, I take it back - with the current implementation existing clients won&apos;t disconnect, new ones trying to connect will have to use the new client port. &lt;/p&gt;</comment>
                            <comment id="14080929" author="hdeng" created="Thu, 31 Jul 2014 15:19:45 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;br/&gt;
editStaticConfig sounds better. I will change it.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;if you look at the log for the failed test, there is a null pointer exception. It happens because the test doesn&apos;t create a static config file - it creates a QuorumPeer object directly and has only a dynamic config file. To fix this change&lt;br/&gt;
QuorumPeer.needEraseClient last line to &quot;return (configFilename!=null &amp;amp;&amp;amp; ... &quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The flow is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
needEraseClient =&amp;gt; writeDynamicConfig =&amp;gt; editStaticConfig
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;editStaticConfig is the only thing using configFile. Is it better to prevent that in&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void editStaticConfig(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; configFileStr,
                                        ......
        &lt;span class=&quot;code-comment&quot;&gt;// some tests may not have &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; config file
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (configFileStr == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;

        File configFile = (&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; VerifyingFileFactory.Builder(LOG)
                .warnForRelativePath()
                .failForNonExistingPath()
                .build()).create(configFileStr);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14080933" author="hdeng" created="Thu, 31 Jul 2014 15:27:27 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;One more thing, Can I change DynamicConfigBackwardCompatibilityTest.java to ReconfigBackwardCompatibilityTest.java or ReconfigLegacyTest.java&lt;/p&gt;

&lt;p&gt;1. name consistency: All reconfig tests start with &quot;Reconfig&quot;, people jumping to the code can find relevant tests.&lt;/p&gt;</comment>
                            <comment id="14080938" author="shralex" created="Thu, 31 Jul 2014 15:35:31 +0100"  >&lt;p&gt;sure, both things sound fine&lt;/p&gt;</comment>
                            <comment id="14081038" author="hdeng" created="Thu, 31 Jul 2014 17:03:45 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;with the current implementation existing clients won&apos;t disconnect&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;On a client port change, if it won&apos;t disconnect, will it still use the old port or redirect to another?&lt;br/&gt;
The current cli tool still shows the old port.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[zk: 127.0.0.1:2181(CONNECTED)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14081113" author="shralex" created="Thu, 31 Jul 2014 17:59:56 +0100"  >&lt;p&gt;on accept() a server socket returns a new socket which the newly connected client and the server use. So as I understand it, closing the server socket doesn&apos;t kill the existing connections - they are using different sockets.&lt;/p&gt;</comment>
                            <comment id="14081137" author="hdeng" created="Thu, 31 Jul 2014 18:10:30 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;br/&gt;
I finished it and uploaded the new patch.&lt;/p&gt;

&lt;p&gt;As usual, review place:&lt;br/&gt;
&lt;a href=&quot;https://github.com/fengjingchao/zookeeper/commit/621f9f641945f4b9d7050c41bf9a2069baf1d582?w=1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/fengjingchao/zookeeper/commit/621f9f641945f4b9d7050c41bf9a2069baf1d582?w=1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I also added the check on editing static file.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;on accept() a server socket returns a new socket which the newly connected client and the server use. So as I understand it, closing the server socket doesn&apos;t kill the existing connections - they are using different sockets.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;So I think on reconfig a client will be &quot;redirected&quot; to a new server port. This is not shown in cli tool, I mean.&lt;/p&gt;</comment>
                            <comment id="14081143" author="shralex" created="Thu, 31 Jul 2014 18:17:59 +0100"  >&lt;p&gt;Its not redirected upon reconfig. It just continues to use the socket that was created when it first connected, which is different from the server socket that is closed. Currently the client is not notified. It can find out as usual by subscribing to configuration change notifications. I&apos;m not sure what&apos;s the right thing to present on the CLI tool, but not sure its that important.&lt;/p&gt;</comment>
                            <comment id="14081281" author="hdeng" created="Thu, 31 Jul 2014 20:06:32 +0100"  >&lt;p&gt;This adds a retry logic to test if clientPort has been removed.&lt;br/&gt;
Because after reconfig succeeded, there might be race that it setQuorumVerifier.&lt;/p&gt;

&lt;p&gt;It&apos;s the same as &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1992&quot; title=&quot;backward compatibility of zoo.cfg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1992&quot;&gt;&lt;del&gt;ZOOKEEPER-1992&lt;/del&gt;&lt;/a&gt;-addTest.patch&quot; except the retry logic.&lt;/p&gt;</comment>
                            <comment id="14081290" author="hadoopqa" created="Thu, 31 Jul 2014 20:15:13 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12658951/ZOOKEEPER-1992-addTest.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12658951/ZOOKEEPER-1992-addTest.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1613553.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2251//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2251//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2251//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2251//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2251//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2251//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14081298" author="hdeng" created="Thu, 31 Jul 2014 20:19:17 +0100"  >&lt;p&gt;I remove my new retry logic.&lt;/p&gt;

&lt;p&gt;So the latest patch is &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1992&quot; title=&quot;backward compatibility of zoo.cfg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1992&quot;&gt;&lt;del&gt;ZOOKEEPER-1992&lt;/del&gt;&lt;/a&gt;-addTest.patch&lt;/p&gt;

&lt;p&gt;Above it shows the test has passed.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14081363" author="hdeng" created="Thu, 31 Jul 2014 21:01:54 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;br/&gt;
Okay. I finalized everything into &quot;final.patch&quot;.&lt;/p&gt;

&lt;p&gt;The previous &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1992&quot; title=&quot;backward compatibility of zoo.cfg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1992&quot;&gt;&lt;del&gt;ZOOKEEPER-1992&lt;/del&gt;&lt;/a&gt;-addTest.patch&quot; is flaky because there might be race after it finish reconfig before it finish editing static file the assertFalse on &quot;clientPort&quot; failed. I mitigate the pain by moving the check to the last.&lt;/p&gt;

&lt;p&gt;An ideal solution is that there is a way to notify outside once editing static file is done.&lt;/p&gt;</comment>
                            <comment id="14081625" author="shralex" created="Thu, 31 Jul 2014 23:44:03 +0100"  >&lt;p&gt;+1 The patch looks good, thanks for the hard work Hongchao!&lt;br/&gt;
I made a few minor edits, mainly variable names and some changes to the test. Lets see that final1.patch passes the tests on Jenkins and then commit it.&lt;/p&gt;</comment>
                            <comment id="14081628" author="hadoopqa" created="Thu, 31 Jul 2014 23:48:03 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12658991/final.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12658991/final.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1613553.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2252//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2252//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2252//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2252//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2252//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2252//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14081770" author="hdeng" created="Fri, 1 Aug 2014 02:02:14 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;br/&gt;
Just minor changes.&lt;br/&gt;
1. Code formatting in editStaticConfig. Previously it wasn&apos;t aligned after name change (eraseLinesXXX -&amp;gt; editStaticXX).&lt;br/&gt;
2. test case:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; changedServerId = SERVER_COUNT - 1;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;To check it last to mitigate flaky case.&lt;/p&gt;</comment>
                            <comment id="14081771" author="hdeng" created="Fri, 1 Aug 2014 02:02:37 +0100"  >&lt;p&gt;Have it as final2.patch&lt;/p&gt;</comment>
                            <comment id="14081898" author="hadoopqa" created="Fri, 1 Aug 2014 05:37:39 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12659081/final2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12659081/final2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1613553.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2253//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2253//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2253//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2253//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2253//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2253//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14081932" author="shralex" created="Fri, 1 Aug 2014 06:41:09 +0100"  >&lt;p&gt;Committed final1.patch + reformatting as suggested by Hongchao + small change to test so that it waits for 1 sec before checking the files. I chose that over setting the changedServerId to 2 since we also want to check the configuration files of the other 2 servers.&lt;/p&gt;</comment>
                            <comment id="14081936" author="shralex" created="Fri, 1 Aug 2014 06:43:13 +0100"  >&lt;p&gt;Committed to trunk. Thanks Hongchao!&lt;/p&gt;</comment>
                            <comment id="14082237" author="hudson" created="Fri, 1 Aug 2014 14:30:58 +0100"  >&lt;p&gt;FAILURE: Integrated in ZooKeeper-trunk #2393 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2393/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2393/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1992&quot; title=&quot;backward compatibility of zoo.cfg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1992&quot;&gt;&lt;del&gt;ZOOKEEPER-1992&lt;/del&gt;&lt;/a&gt;. Backward compatibility of the static configuration file (Hongchao Deng via Alex Shraer) (shralex: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1615037&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1615037&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/DynamicConfigBackwardCompatibilityTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/ReconfigLegacyTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14083666" author="shralex" created="Sat, 2 Aug 2014 20:00:12 +0100"  >&lt;p&gt;I just noticed that we have  a bug which I missed - when invoking editStaticConfig from QuorumPeerConfig it will remove the server. weight and other dynamic definitions even though the dynamic file doesn&apos;t exist yet. Assuming that &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1994&quot; title=&quot;Backup config files.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1994&quot;&gt;&lt;del&gt;ZOOKEEPER-1994&lt;/del&gt;&lt;/a&gt; will get in 3.5.0, lets fix it there.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="12730852">ZOOKEEPER-1999</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12729508">ZOOKEEPER-1989</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                            <outwardlinks description="requires">
                                        <issuelink>
            <issuekey id="12730300">ZOOKEEPER-1997</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12658951" name="ZOOKEEPER-1992-addTest.patch" size="26735" author="hdeng" created="Thu, 31 Jul 2014 18:05:34 +0100"/>
                            <attachment id="12658827" name="ZOOKEEPER-1992-gitaddp.patch" size="12871" author="hdeng" created="Thu, 31 Jul 2014 04:06:13 +0100"/>
                            <attachment id="12658791" name="ZOOKEEPER-1992-without-spaces.patch" size="7421" author="hdeng" created="Thu, 31 Jul 2014 01:16:51 +0100"/>
                            <attachment id="12658790" name="ZOOKEEPER-1992-withspaces.patch" size="51293" author="hdeng" created="Thu, 31 Jul 2014 01:01:27 +0100"/>
                            <attachment id="12658730" name="draft-2.patch" size="6853" author="hdeng" created="Wed, 30 Jul 2014 21:34:40 +0100"/>
                            <attachment id="12658743" name="draft-3.patch" size="7422" author="hdeng" created="Wed, 30 Jul 2014 22:27:24 +0100"/>
                            <attachment id="12658758" name="draft-4.patch" size="8340" author="hdeng" created="Wed, 30 Jul 2014 23:37:43 +0100"/>
                            <attachment id="12658717" name="draft.patch" size="5135" author="hdeng" created="Wed, 30 Jul 2014 20:53:41 +0100"/>
                            <attachment id="12658991" name="final.patch" size="26735" author="hdeng" created="Thu, 31 Jul 2014 20:57:36 +0100"/>
                            <attachment id="12659033" name="final1.patch" size="26573" author="shralex" created="Thu, 31 Jul 2014 23:44:03 +0100"/>
                            <attachment id="12659081" name="final2.patch" size="26982" author="hdeng" created="Fri, 1 Aug 2014 03:56:01 +0100"/>
                    </attachments>
                <subtasks>
                            <subtask id="12730106">ZOOKEEPER-1993</subtask>
                            <subtask id="12730108">ZOOKEEPER-1995</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 30 Jul 2014 18:08:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>408178</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzs3cv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>408182</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>