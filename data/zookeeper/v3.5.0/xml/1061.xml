<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:40:17 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1061/ZOOKEEPER-1061.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1061] Zookeeper stop fails if start called twice</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1061</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;The zkServer.sh script doesn&apos;t check properly to see if a previously started&lt;br/&gt;
server is still running.  If you call start twice, the second invocation&lt;br/&gt;
will over-write the PID file with a process that then fails due to port&lt;br/&gt;
occupancy.&lt;/p&gt;

&lt;p&gt;This means that stop will subsequently fail.&lt;/p&gt;

&lt;p&gt;Here is a reference that describes how init scripts should normally work:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://refspecs.freestandards.org/LSB_3.1.0/LSB-Core-generic/LSB-Core-generic/iniscrptact.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://refspecs.freestandards.org/LSB_3.1.0/LSB-Core-generic/LSB-Core-generic/iniscrptact.html&lt;/a&gt;&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12506765">ZOOKEEPER-1061</key>
            <summary>Zookeeper stop fails if start called twice</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tdunning">Ted Dunning</assignee>
                                    <reporter username="tdunning">Ted Dunning</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 May 2011 21:38:36 +0100</created>
                <updated>Wed, 23 Nov 2011 19:22:43 +0000</updated>
                            <resolved>Mon, 16 May 2011 18:12:48 +0100</resolved>
                                    <version>3.3.2</version>
                                    <fixVersion>3.4.0</fixVersion>
                                    <component>scripts</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13031380" author="tdunning" created="Tue, 10 May 2011 22:05:42 +0100"  >&lt;p&gt;Here is a patch that handles the double start and fixes up some exit values.&lt;/p&gt;</comment>
                            <comment id="13031393" author="hadoopqa" created="Tue, 10 May 2011 22:33:42 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12478734/ZOOKEEPER-1061.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12478734/ZOOKEEPER-1061.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1099329.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/256//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/256//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/256//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/256//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/256//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/256//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13031401" author="tdunning" created="Tue, 10 May 2011 22:46:29 +0100"  >&lt;p&gt;No unit tests are reasonably for these script-only changes.  Here is a manual&lt;br/&gt;
test.  Without the fix, we see this mal-behavior:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
tdunning@ted-desk:~/Apache/zookeeper$ sudo bin/zkServer.sh start
JMX enabled by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
Using config: /etc/zookeeper/zoo.cfg
Starting zookeeper ... 
STARTED
tdunning@ted-desk:~/Apache/zookeeper$ sudo jps
17610 QuorumPeerMain
17646 Jps
tdunning@ted-desk:~/Apache/zookeeper$ sudo bin/zkServer.sh start
JMX enabled by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
Using config: /etc/zookeeper/zoo.cfg
Starting zookeeper ... 
STARTED
tdunning@ted-desk:~/Apache/zookeeper$ sudo jps
17685 Jps
17610 QuorumPeerMain
tdunning@ted-desk:~/Apache/zookeeper$ sudo bin/zkServer.sh stop
JMX enabled by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
Using config: /etc/zookeeper/zoo.cfg
Stopping zookeeper ... 
kill: 160: No such process

STOPPED
tdunning@ted-desk:~/Apache/zookeeper$ sudo jps
17730 Jps
17610 QuorumPeerMain
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With the fix, I get this.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
tdunning@ted-desk:~/Apache/zookeeper$ patch &amp;lt; ZOOKEEPER-1061.patch 
patching file zkServer.sh

# first start works
tdunning@ted-desk:~/Apache/zookeeper$ sudo bin/zkServer.sh start
JMX enabled by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
Using config: /etc/zookeeper/zoo.cfg
Starting zookeeper ... STARTED

# second start fails with good message
tdunning@ted-desk:~/Apache/zookeeper$ sudo bin/zkServer.sh start
JMX enabled by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
Using config: /etc/zookeeper/zoo.cfg
Starting zookeeper ... already running as process 17928.

# and &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is persistent behavior
tdunning@ted-desk:~/Apache/zookeeper$ sudo bin/zkServer.sh start
JMX enabled by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
Using config: /etc/zookeeper/zoo.cfg
Starting zookeeper ... already running as process 17928.

# stop now works
tdunning@ted-desk:~/Apache/zookeeper$ sudo bin/zkServer.sh stop
JMX enabled by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
Using config: /etc/zookeeper/zoo.cfg
Stopping zookeeper ... STOPPED

# repeated stop works correctly
tdunning@ted-desk:~/Apache/zookeeper$ sudo bin/zkServer.sh stop
JMX enabled by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
Using config: /etc/zookeeper/zoo.cfg
Stopping zookeeper ... error: could not find file /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/zookeeper/zookeeper_server.pid

# and start works again
tdunning@ted-desk:~/Apache/zookeeper$ sudo bin/zkServer.sh start
JMX enabled by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
Using config: /etc/zookeeper/zoo.cfg
Starting zookeeper ... STARTED

# but can&apos;t be repeated
tdunning@ted-desk:~/Apache/zookeeper$ sudo bin/zkServer.sh start
JMX enabled by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
Using config: /etc/zookeeper/zoo.cfg
Starting zookeeper ... already running as process 18155.

# running without proper permissions gives a different error
tdunning@ted-desk:~/Apache/zookeeper$ bin/zkServer.sh start
JMX enabled by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
Using config: /etc/zookeeper/zoo.cfg
Starting zookeeper ... bin/zkServer.sh: 169: cannot create /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/zookeeper/zookeeper_server.pid: Permission denied
FAILED TO WRITE PID
tdunning@ted-desk:~/Apache/zookeeper$ sudo bin/zkServer.sh stop
JMX enabled by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
Using config: /etc/zookeeper/zoo.cfg
Stopping zookeeper ... STOPPED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13032561" author="mahadev" created="Thu, 12 May 2011 19:19:05 +0100"  >&lt;p&gt;thats good to have!&lt;/p&gt;

&lt;p&gt;love this change though &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; :&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-dataDir=/export/crawlspace/mahadev/zookeeper/server1/data
+dataDir=/home/tdunning/tmp
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Other than that +1 for the change!&lt;/p&gt;</comment>
                            <comment id="13032648" author="tdunning" created="Thu, 12 May 2011 21:25:25 +0100"  >&lt;p&gt;Ouch.  Our internal review caught that after I pushed out the patch.&lt;/p&gt;

&lt;p&gt;I was kind of hoping nobody else would notice.&lt;/p&gt;</comment>
                            <comment id="13033178" author="tdunning" created="Fri, 13 May 2011 19:24:20 +0100"  >&lt;p&gt;Any hope for a commit on this?&lt;/p&gt;</comment>
                            <comment id="13033183" author="mahadev" created="Fri, 13 May 2011 19:30:41 +0100"  >&lt;p&gt;ted, ill commit this tonight (latest over the weekend). Need to run some tests manually and will also fix the datadir conf change to point to just /tmp/zookeeper.&lt;/p&gt;</comment>
                            <comment id="13034106" author="mahadev" created="Mon, 16 May 2011 18:12:48 +0100"  >&lt;p&gt;I just pushed this with minor changes to conf/zoo_sample.cfg. &lt;br/&gt;
Thanks Ted.&lt;/p&gt;</comment>
                            <comment id="13034704" author="hudson" created="Tue, 17 May 2011 11:55:18 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #1185 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/ZooKeeper-trunk/1185/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/ZooKeeper-trunk/1185/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1061&quot; title=&quot;Zookeeper stop fails if start called twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1061&quot;&gt;&lt;del&gt;ZOOKEEPER-1061&lt;/del&gt;&lt;/a&gt;. Zookeeper stop fails if start called twice. (Ted Dunning via mahadev)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12478734" name="ZOOKEEPER-1061.patch" size="2411" author="tdunning" created="Tue, 10 May 2011 22:05:42 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 10 May 2011 21:33:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37453</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxztdr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32744</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>