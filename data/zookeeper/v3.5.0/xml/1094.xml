<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:49:21 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1094/ZOOKEEPER-1094.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1094] Small improvements to LeaderElection and Vote classes</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1094</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;1. o.a.z.q.Vote is a struct-style class, whose fields are public and not final. &lt;/p&gt;

&lt;p&gt;In general, we should prefer making the fields of these kind of classes final, and hiding them behind getters for the following reasons:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Marking them as final allows clients of the class not to worry about any synchronisation when accessing the fields&lt;/li&gt;
	&lt;li&gt;Hiding them behind getters allows us to change the implementation of the class without changing the API.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Object creation is very cheap. It&apos;s ok to create new Votes rather than mutate existing ones. &lt;/p&gt;

&lt;p&gt;2. Votes are mainly used in the LeaderElection class. In this class a map of addresses to votes is passed in to countVotes, which modifies the map contents inside an iterator (and therefore changes the object passed in by reference). This is pretty gross, so at the same time I&apos;ve slightly refactored this method to return information about the number of validVotes in the ElectionResult class, which is returned by countVotes. &lt;/p&gt;

&lt;p&gt;3. The previous implementation of countVotes was quadratic in the number of votes. It is possible to do this linearly. No real speed-up is expected as a result, but it salves the CS OCD in me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12510238">ZOOKEEPER-1094</key>
            <summary>Small improvements to LeaderElection and Vote classes</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="henryr">Henry Robinson</assignee>
                                    <reporter username="henryr">Henry Robinson</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Jun 2011 23:14:32 +0100</created>
                <updated>Wed, 23 Nov 2011 19:22:05 +0000</updated>
                            <resolved>Fri, 17 Jun 2011 00:34:52 +0100</resolved>
                                                    <fixVersion>3.4.0</fixVersion>
                                    <component>quorum</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13048865" author="hadoopqa" created="Tue, 14 Jun 2011 00:16:15 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12482485/ZK-1094.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12482485/ZK-1094.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1135270.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 21 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/314//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/314//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/314//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/314//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/314//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/314//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13048911" author="breed" created="Tue, 14 Jun 2011 01:12:08 +0100"  >&lt;p&gt;henry, can you make this patch relative to &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-335&quot; title=&quot;zookeeper servers should commit the new leader txn to their logs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-335&quot;&gt;&lt;del&gt;ZOOKEEPER-335&lt;/del&gt;&lt;/a&gt;? i plan on committing 335 tonight. i haven&apos;t yet learned the git voodoo to do merges.&lt;/p&gt;</comment>
                            <comment id="13048915" author="henryr" created="Tue, 14 Jun 2011 01:25:37 +0100"  >&lt;p&gt;Sure - if you commit &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-335&quot; title=&quot;zookeeper servers should commit the new leader txn to their logs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-335&quot;&gt;&lt;del&gt;ZOOKEEPER-335&lt;/del&gt;&lt;/a&gt; tonight, I&apos;ll rebase against trunk and repost the patch tomorrow. I just read the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-335&quot; title=&quot;zookeeper servers should commit the new leader txn to their logs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-335&quot;&gt;&lt;del&gt;ZOOKEEPER-335&lt;/del&gt;&lt;/a&gt;, and there should be very few conflicts. Thanks!&lt;/p&gt;</comment>
                            <comment id="13048922" author="breed" created="Tue, 14 Jun 2011 02:00:17 +0100"  >&lt;p&gt;deal. in return i&apos;ll review your patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13049454" author="henryr" created="Tue, 14 Jun 2011 22:49:22 +0100"  >&lt;p&gt;Updated patch against trunk, in particular &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-335&quot; title=&quot;zookeeper servers should commit the new leader txn to their logs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-335&quot;&gt;&lt;del&gt;ZOOKEEPER-335&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="13049472" author="hadoopqa" created="Tue, 14 Jun 2011 23:16:45 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12482602/ZK-1094.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12482602/ZK-1094.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1135515.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 21 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/315//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/315//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/315//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/315//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/315//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/315//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13049612" author="breed" created="Wed, 15 Jun 2011 06:27:23 +0100"  >&lt;p&gt;this looks good overall. flavio can you check countVotes() in LeaderElection?&lt;/p&gt;</comment>
                            <comment id="13050507" author="fpj" created="Thu, 16 Jun 2011 16:51:02 +0100"  >&lt;p&gt;The improvements look good, but I&apos;m actually not sure why we update all votes for the same id to have the same zxid. It sounds like we are transforming stale votes into valid votes. &lt;/p&gt;</comment>
                            <comment id="13050543" author="henryr" created="Thu, 16 Jun 2011 17:28:46 +0100"  >&lt;p&gt;Thanks guys. Regarding the staleness transformation - it did seem a bit weird to me as well. If you think this patch preserves the original behaviour, maybe we should get that committed and open another JIRA to figure out if that behaviour is actually wrong... there are a couple of things in LE that could do with being cleaned up, such as the fact that it doesn&apos;t use the current quorum verifier to pass votes.&lt;/p&gt;</comment>
                            <comment id="13050552" author="fpj" created="Thu, 16 Jun 2011 17:42:41 +0100"  >&lt;p&gt;+1, it sounds good to me to get these improvements in and have another jira to discuss the staleness issue. On the use of quorum verifier, we have brought up a number of times the option of deprecating LeaderElection (at least I did bring up), and this was one reason at the time we introduced quorum verifiers to not have it in LeaderElection. We should also consider deprecating AuthFLE. We don&apos;t even have tests for it, and to my knowledge, no one uses it.&lt;/p&gt;</comment>
                            <comment id="13050789" author="breed" created="Fri, 17 Jun 2011 00:07:04 +0100"  >&lt;p&gt;+1 ok i&apos;ll get this committed. i also think it is the time to move to a single leader election. the current default has been in place a long time, so the caution about moving to it is gone.&lt;/p&gt;</comment>
                            <comment id="13050804" author="breed" created="Fri, 17 Jun 2011 00:34:52 +0100"  >&lt;p&gt;Committed revision 1136740.&lt;br/&gt;
thanx henry!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12482602" name="ZK-1094.patch" size="33616" author="henryr" created="Tue, 14 Jun 2011 22:49:22 +0100"/>
                            <attachment id="12482485" name="ZK-1094.patch" size="33647" author="henryr" created="Mon, 13 Jun 2011 23:24:45 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 13 Jun 2011 23:16:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47483</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzx13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33335</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>