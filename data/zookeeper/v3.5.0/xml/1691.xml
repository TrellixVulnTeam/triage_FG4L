<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:43:26 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1691/ZOOKEEPER-1691.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1691] Add a flag to disable standalone mode</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1691</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;Currently you cannot use dynamic reconfiguration to bootstrap zookeeper cluster because the server goes into standalone mode when there is only one server in the cluster.&lt;/p&gt;

&lt;p&gt;--Michi&lt;/p&gt;</description>
                <environment></environment>
        <key id="12642600">ZOOKEEPER-1691</key>
            <summary>Add a flag to disable standalone mode</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="helen">Helen Hastings</assignee>
                                    <reporter username="michim">Michi Mutsuzaki</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Apr 2013 20:41:40 +0100</created>
                <updated>Tue, 28 Jan 2014 18:47:58 +0000</updated>
                            <resolved>Tue, 21 Jan 2014 04:46:32 +0000</resolved>
                                                    <fixVersion>3.5.0</fixVersion>
                                    <component>quorum</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>11</watches>
                                                                <comments>
                            <comment id="13721277" author="helen" created="Fri, 26 Jul 2013 22:58:36 +0100"  >&lt;p&gt;Added standaloneEnabled flag to QuorumPeerConfig.&lt;/p&gt;</comment>
                            <comment id="13721291" author="michim" created="Fri, 26 Jul 2013 23:16:04 +0100"  >&lt;p&gt;I&apos;m trying to set the assignee to Helen but I&apos;m getting an error &quot;User &apos;helen&apos; cannot be assigned issues&quot;...&lt;/p&gt;</comment>
                            <comment id="13721311" author="hadoopqa" created="Fri, 26 Jul 2013 23:33:44 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12594459/ZOOKEEPER-1691.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12594459/ZOOKEEPER-1691.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1503101.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1523//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1523//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1523//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1523//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1523//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1523//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13721343" author="shralex" created="Sat, 27 Jul 2013 00:01:38 +0100"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/12983/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/12983/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13721369" author="hadoopqa" created="Sat, 27 Jul 2013 00:23:42 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12594468/ZOOKEEPER-1691.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12594468/ZOOKEEPER-1691.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1503101.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1524//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1524//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1524//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1524//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1524//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1524//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13744318" author="hadoopqa" created="Mon, 19 Aug 2013 23:03:56 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12598837/ZOOKEEPER-1691.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12598837/ZOOKEEPER-1691.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1503101.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1543//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1543//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1543//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1543//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1543//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1543//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13746908" author="helen" created="Wed, 21 Aug 2013 23:05:43 +0100"  >&lt;p&gt;Added more suggestions from ZK review board.&lt;/p&gt;</comment>
                            <comment id="13748965" author="hadoopqa" created="Fri, 23 Aug 2013 21:34:28 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12599288/ZOOKEEPER-1691.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12599288/ZOOKEEPER-1691.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1516126.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1544//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1544//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1544//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1544//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1544//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1544//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13749562" author="hadoopqa" created="Sun, 25 Aug 2013 08:42:17 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12599288/ZOOKEEPER-1691.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12599288/ZOOKEEPER-1691.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1516126.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1545//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1545//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1545//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1545//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1545//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1545//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13783526" author="hadoopqa" created="Wed, 2 Oct 2013 01:33:01 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12599288/ZOOKEEPER-1691.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12599288/ZOOKEEPER-1691.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1528271.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1617//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1617//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13784255" author="phunt" created="Wed, 2 Oct 2013 19:33:00 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt; did the recent RB comments from Helen sufficiently address your question? Perhaps you and/or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;Flavio Junqueira&lt;/a&gt; can sign off on the patch? (or not...)&lt;/p&gt;</comment>
                            <comment id="13784268" author="phunt" created="Wed, 2 Oct 2013 19:44:43 +0100"  >&lt;p&gt;Minor tweak to fix patch conflict with latest codebase.&lt;/p&gt;</comment>
                            <comment id="13784283" author="shralex" created="Wed, 2 Oct 2013 19:56:40 +0100"  >&lt;p&gt;Hi Patrick, I&apos;ll take a look at it soon, probably this weekend.&lt;/p&gt;</comment>
                            <comment id="13784316" author="hadoopqa" created="Wed, 2 Oct 2013 20:17:28 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12606410/ZOOKEEPER-1691.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12606410/ZOOKEEPER-1691.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1528586.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1626//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1626//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1626//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1626//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1626//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1626//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13784325" author="hadoopqa" created="Wed, 2 Oct 2013 20:23:33 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12606410/ZOOKEEPER-1691.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12606410/ZOOKEEPER-1691.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1528586.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1627//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1627//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1627//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1627//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1627//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1627//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13787961" author="shralex" created="Mon, 7 Oct 2013 08:12:59 +0100"  >&lt;p&gt;I&apos;ve verified that at least part of the problem is that both the established leader and the joining server have configuration version equal to 0, so the leader can&apos;t convince the joiner to adapt the current config. I&apos;m working on this. &lt;/p&gt;

&lt;p&gt;In the meanwhile, here&apos;s a workaround: remove your change to FastLeaderElection and add this dummy reconfiguration (just to bump up the version) before you add the two servers:&lt;/p&gt;

&lt;p&gt;        reconfigServers.clear();&lt;br/&gt;
        reconfigServers.add(serverStrings.get(leaderId) + &quot;\n&quot;);&lt;br/&gt;
        testReconfig(leaderId, true, reconfigServers);&lt;/p&gt;

&lt;p&gt;With this change adding the two servers in your test works for me. The bad news is that when the test shuts down the leader the remaining servers can&apos;t form a quorum for some reason.&lt;/p&gt;</comment>
                            <comment id="13788692" author="helen" created="Tue, 8 Oct 2013 00:16:08 +0100"  >&lt;p&gt;Thanks for looking into this.  This explains why when I manually set the version in my first submission that the problem was solved. I&apos;ll try to figure out why the remaining servers can&apos;t form a quorum when the leader shuts down.&lt;/p&gt;</comment>
                            <comment id="13820819" author="hadoopqa" created="Wed, 13 Nov 2013 01:58:23 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12606410/ZOOKEEPER-1691.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12606410/ZOOKEEPER-1691.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1540961.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1762//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1762//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13820842" author="michim" created="Wed, 13 Nov 2013 02:16:35 +0000"  >&lt;p&gt;The patch doesn&apos;t apply anymore. It would be great if we can check this in soon. Helen/Alex, what are remaining issues?&lt;/p&gt;

&lt;p&gt;Thanks!&lt;br/&gt;
--Michi&lt;/p&gt;</comment>
                            <comment id="13820935" author="shralex" created="Wed, 13 Nov 2013 04:45:16 +0000"  >&lt;p&gt;Hi Michi,&lt;/p&gt;

&lt;p&gt;Delete the FastLeaderElection.java part of the patch and it should apply.&lt;br/&gt;
The change to FastLeaderElection.java in the patch are problematic in any case - they&apos;re sort of a hack, we should find a solution instead.&lt;br/&gt;
Once you delete these changes you&apos;ll see that one of the tests doesn&apos;t pass, not sure where is the problem exactly. &lt;/p&gt;

&lt;p&gt;Fixing FastLeaderElection to support a single server and making the test pass are the remaining issues I know of.&lt;/p&gt;

&lt;p&gt;Alex&lt;/p&gt;</comment>
                            <comment id="13820963" author="helen" created="Wed, 13 Nov 2013 05:44:09 +0000"  >&lt;p&gt;Currently working on turning the hack into a solution.&lt;/p&gt;</comment>
                            <comment id="13821688" author="michim" created="Wed, 13 Nov 2013 19:09:07 +0000"  >&lt;p&gt;Cool thank you guys!&lt;/p&gt;</comment>
                            <comment id="13834178" author="helen" created="Wed, 27 Nov 2013 21:40:29 +0000"  >&lt;p&gt;When I looked at this for the first time in a while, the previous bug was no longer a problem.  There were some changes made to FastLeaderElection.java since I last worked with it, which I couldn&apos;t quite understand, but it looks like they may have somehow solved the problem.  This makes me a bit wary, but everything works.  I had to fix one other issue in my test with how I was setting up the servers in the first place, but this updated patch should work. Alex when you get a chance let me know what you think.&lt;/p&gt;</comment>
                            <comment id="13834230" author="hadoopqa" created="Wed, 27 Nov 2013 22:16:15 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12616130/ZOOKEEPER-1691.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12616130/ZOOKEEPER-1691.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1543281.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1808//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1808//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1808//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1808//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1808//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1808//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13843764" author="michim" created="Tue, 10 Dec 2013 00:36:54 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;, did you get a chance to review the latest patch? It would be great if we can check this in soon.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13843993" author="shralex" created="Tue, 10 Dec 2013 06:16:15 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I didn&apos;t have a chance to take a look yet, but will try to do it soon.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=helen&quot; class=&quot;user-hover&quot; rel=&quot;helen&quot;&gt;Helen Hastings&lt;/a&gt; do you mind uploading the new patch to review board ?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Alex&lt;/p&gt;</comment>
                            <comment id="13845759" author="bfreuden" created="Wed, 11 Dec 2013 21:58:01 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I&apos;ve just tested the patch on the trunk and unfortunately I didn&apos;t succeed to perform an incremental reconfig (add 1 ZK node to a 2 ZK nodes cluster). &lt;br/&gt;
I have to say I made the test on Windows 7 with Oracle JDK 1.6.0_32 64-bit, so I don&apos;t know if it is relevant.&lt;br/&gt;
Anyway you will find attached my test configuration and scenario. As I am a ZK beginner (still very interested in the dynamic reconfig feature), maybe I did something wrong.&lt;br/&gt;
During the process, I discovered the reconfig fails to rename the tmp dynamic config file to the real dynamic config filename (javadoc of java.io.File.renameTo says the behavior is highly plateform dependent, so I guess this should not be a big surprise since I did the test on Windows).&lt;br/&gt;
That&apos;s why my test scenario ran after I modified src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java like this (after having applied the patch) :&lt;br/&gt;
+           curFile.delete();&lt;br/&gt;
            if (!tmpFile.renameTo(curFile)) {&lt;br/&gt;
+                   configFile.delete();&lt;br/&gt;
                    if (!tmpFile.renameTo(configFile)) {&lt;/p&gt;

&lt;p&gt;I also discovered that, when clientPort=2183 and standaloneEnabled=false (this one makes the difference) are omitted from the zoo.cfg of my server 3 (see my test scenario), the server won&apos;t listen on the client port (tries to bind to port &quot;null&quot;):&lt;br/&gt;
2013-12-11 22:48:08,227 &lt;span class=&quot;error&quot;&gt;&amp;#91;myid:&amp;#93;&lt;/span&gt; - INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main:NIOServerCnxnFactory@683&amp;#93;&lt;/span&gt; - binding to port null&lt;/p&gt;

&lt;p&gt;Bruno.&lt;/p&gt;</comment>
                            <comment id="13845762" author="bfreuden" created="Wed, 11 Dec 2013 22:02:04 +0000"  >&lt;p&gt;Forgot to say: great idea this dynamic reconfig, go ahead! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13845764" author="hadoopqa" created="Wed, 11 Dec 2013 22:02:51 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12618298/test%20scenario.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12618298/test%20scenario.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1550213.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1826//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1826//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13845778" author="shralex" created="Wed, 11 Dec 2013 22:14:27 +0000"  >&lt;p&gt;Hi Bruno,&lt;/p&gt;

&lt;p&gt;thanks for testing this. I have a feeling that your findings are not specific to the current JIRA but more general about dynamic reconfig.&lt;br/&gt;
The current JIRA should have effect when your start or end configuration contains just a single server, which is not the case in your scenario - you start from 2 servers and are going to 3. Its possible of course that the patch has effect there but you should run your scenario with and without the patch to verify.&lt;/p&gt;

&lt;p&gt;The problem that your log shows is that the starting config of server 3 includes only this server. Since the standaloneEnabled flag is false, this server happily forms an ensemble just by himself, and doesn&apos;t know that you&apos;ve issued a reconfig. This works as expected.&lt;br/&gt;
You should start it with a config including all three servers (the general rule of thumb for joiner&apos;s A config should be current config + A).&lt;br/&gt;
You can see that the other servers do add it to the configuration, so the reconfig worked. They just think server 3 is faulty (and don&apos;t mind because one out of three can fail).&lt;/p&gt;

&lt;p&gt;About the renaming - could you please open a JIRA for this and perhaps propose a patch ? I&apos;m a bit concerned what will happen if there&apos;s a failure after you deleted the current config file but before you renamed. &lt;/p&gt;

&lt;p&gt;Thanks again for taking a look at this,&lt;br/&gt;
Alex&lt;/p&gt;






</comment>
                            <comment id="13846741" author="bfreuden" created="Thu, 12 Dec 2013 21:09:23 +0000"  >&lt;p&gt;Hi Alex,&lt;/p&gt;

&lt;p&gt;Thanks for your answer. I feel sorry having done a pointless test and I hope the following one will be more interesting. &lt;br/&gt;
As suggested, here is the JIRA about the renaming:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1835&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1835&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Bruno.&lt;/p&gt;</comment>
                            <comment id="13846779" author="bfreuden" created="Thu, 12 Dec 2013 21:44:28 +0000"  >&lt;p&gt;Here is my next test. Reconfig has been successful although I am still unsure about correct &quot;start&quot; conditions (should zoo.cfg files have standaloneEnabled=false or standaloneEnabled=true?). I assume &quot;false&quot; in this test (well.. I couldn&apos;t make it work with false anyway, I guess it is the situation described here &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1726&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1726&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;== Server 1 zoo.cfg:&lt;br/&gt;
standaloneEnabled=false&lt;br/&gt;
dynamicConfigFile=&amp;lt;path to&amp;gt;/confdyn1/zoo.cfg.dynamic&lt;/p&gt;

&lt;p&gt;== Server 1 zoo.cfg.dynamic:&lt;br/&gt;
server.1=localhost:2888:3888:participant;localhost:2181&lt;/p&gt;

&lt;p&gt;Now say I want to add server 2 to the &quot;server 1 cluster&quot;.&lt;/p&gt;

&lt;p&gt;== Server 2 zoo.cfg:&lt;br/&gt;
standaloneEnabled=false&lt;br/&gt;
dynamicConfigFile=&amp;lt;path to&amp;gt;/confdyn2/zoo.cfg.dynamic&lt;/p&gt;

&lt;p&gt;== Server 2 zoo.cfg.dynamic (it is &quot;aware&quot; of the server 1, as mentioned in the Dynamic Reconfiguration - User Manual&lt;br/&gt;
that I should have read more carefully yesterday):&lt;br/&gt;
server.1=localhost:2888:3888:participant;localhost:2181&lt;br/&gt;
server.2=localhost:2889:3889:participant;localhost:2182&lt;/p&gt;

&lt;p&gt;Start server 1 =&amp;gt; OK&lt;br/&gt;
Start server 2 =&amp;gt; OK but something rather strange happens, server 2  zoo.cfg.dynamic now becomes (server.2 line disappears, although server 2 myid file contains &quot;2&quot;):&lt;/p&gt;

&lt;p&gt;server.1=localhost:2888:3888:participant;localhost:2181&lt;br/&gt;
version=100000000&lt;/p&gt;

&lt;p&gt;== connect client 1 to server 1 and ask for the config:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;zk: localhost:2181(CONNECTED) 0&amp;#93;&lt;/span&gt; config&lt;br/&gt;
server.1=localhost:2888:3888:participant;localhost:2181&lt;br/&gt;
version=100000000&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;zk: localhost:2181(CONNECTED) 1&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;== connect client 2 to server 2 and ask for the config:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;zk: localhost:2182(CONNECTED) 1&amp;#93;&lt;/span&gt; config&lt;br/&gt;
server.1=localhost:2888:3888:participant;localhost:2181&lt;br/&gt;
version=100000000&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;zk: localhost:2182(CONNECTED) 2&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;== use client 1 to issue a reconfig command on server 1:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;zk: localhost:2181(CONNECTED) 1&amp;#93;&lt;/span&gt; reconfig -add server.2=localhost:2889:3889:participant;localhost:2182&lt;br/&gt;
Committed new configuration:&lt;br/&gt;
server.1=localhost:2888:3888:participant;localhost:2181&lt;br/&gt;
server.2=localhost:2889:3889:participant;localhost:2182&lt;br/&gt;
version=100000003&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;zk: localhost:2181(CONNECTED) 2&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;== display config from client 2 connected to server 2:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;zk: localhost:2182(CONNECTED) 2&amp;#93;&lt;/span&gt; config&lt;br/&gt;
server.1=localhost:2888:3888:participant;localhost:2181&lt;br/&gt;
server.2=localhost:2889:3889:participant;localhost:2182&lt;br/&gt;
version=100000003&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;zk: localhost:2182(CONNECTED) 3&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Looks fine!! Nodes created from client 1 are visible to client 2 and vice-versa.&lt;br/&gt;
Still, I can see strange stack traces in both server consoles.&lt;/p&gt;

&lt;p&gt;Server 1:&lt;br/&gt;
2013-12-12 22:31:40,888 &lt;span class=&quot;error&quot;&gt;&amp;#91;myid:1&amp;#93;&lt;/span&gt; - WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;ProcessThread(sid:1 cport:-1)::QuorumCnxManager@390&amp;#93;&lt;/span&gt; - Cannot open channel to 2 at election address localhost/127.0.0.1:3889&lt;br/&gt;
java.net.ConnectException: Connection refused: connect&lt;br/&gt;
        at java.net.PlainSocketImpl.socketConnect(Native Method)&lt;br/&gt;
        at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:351)&lt;br/&gt;
        at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:213)&lt;br/&gt;
        at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:200)&lt;br/&gt;
        at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)&lt;br/&gt;
        at java.net.Socket.connect(Socket.java:529)&lt;br/&gt;
        at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:375)&lt;br/&gt;
        at org.apache.zookeeper.server.quorum.QuorumPeer.connectNewPeers(QuorumPeer.java:1252)&lt;br/&gt;
        at org.apache.zookeeper.server.quorum.QuorumPeer.setLastSeenQuorumVerifier(QuorumPeer.java:1272)&lt;br/&gt;
        at org.apache.zookeeper.server.quorum.Leader.propose(Leader.java:1071)&lt;br/&gt;
        at org.apache.zookeeper.server.quorum.ProposalRequestProcessor.processRequest(ProposalRequestProcessor.java:78)&lt;br/&gt;
        at org.apache.zookeeper.server.PrepRequestProcessor.pRequest(PrepRequestProcessor.java:864)&lt;br/&gt;
        at org.apache.zookeeper.server.PrepRequestProcessor.run(PrepRequestProcessor.java:144)&lt;br/&gt;
2013-12-12 22:31:41,919 &lt;span class=&quot;error&quot;&gt;&amp;#91;myid:1&amp;#93;&lt;/span&gt; - WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;LearnerHandler-/127.0.0.1:52301:QuorumPeer@1259&amp;#93;&lt;/span&gt; - Restarting Leader Election&lt;br/&gt;
2013-12-12 22:31:41,920 &lt;span class=&quot;error&quot;&gt;&amp;#91;myid:1&amp;#93;&lt;/span&gt; - INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;localhost/127.0.0.1:3888:QuorumCnxManager$Listener@571&amp;#93;&lt;/span&gt; - Leaving listener&lt;br/&gt;
2013-12-12 22:31:41,920 &lt;span class=&quot;error&quot;&gt;&amp;#91;myid:1&amp;#93;&lt;/span&gt; - INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeerListener:QuorumCnxManager$Listener@544&amp;#93;&lt;/span&gt; - My election bind port: localhost/127.0.0.1:3888&lt;br/&gt;
2013-12-12 22:31:44,438 &lt;span class=&quot;error&quot;&gt;&amp;#91;myid:1&amp;#93;&lt;/span&gt; - INFO  [WorkerReceiver&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;:FastLeaderElection$Messenger$WorkerReceiver@410] - WorkerReceiver is down&lt;br/&gt;
2013-12-12 22:31:44,439 &lt;span class=&quot;error&quot;&gt;&amp;#91;myid:1&amp;#93;&lt;/span&gt; - INFO  [WorkerSender&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;:FastLeaderElection$Messenger$WorkerSender@442] - WorkerSender is down&lt;/p&gt;

&lt;p&gt;Server 2:&lt;br/&gt;
2013-12-12 22:31:41,894 &lt;span class=&quot;error&quot;&gt;&amp;#91;myid:2&amp;#93;&lt;/span&gt; - WARN  [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=2&amp;#93;&lt;/span&gt;/127.0.0.1:2182:QuorumCnxManager@390] - Cannot open channel to 2 at election address localhost/127.0.0.1:3889&lt;br/&gt;
java.net.ConnectException: Connection refused: connect&lt;br/&gt;
        at java.net.PlainSocketImpl.socketConnect(Native Method)&lt;br/&gt;
        at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:351)&lt;br/&gt;
        at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:213)&lt;br/&gt;
        at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:200)&lt;br/&gt;
        at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)&lt;br/&gt;
        at java.net.Socket.connect(Socket.java:529)&lt;br/&gt;
        at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:375)&lt;br/&gt;
        at org.apache.zookeeper.server.quorum.QuorumPeer.connectNewPeers(QuorumPeer.java:1252)&lt;br/&gt;
        at org.apache.zookeeper.server.quorum.QuorumPeer.setLastSeenQuorumVerifier(QuorumPeer.java:1272)&lt;br/&gt;
        at org.apache.zookeeper.server.quorum.Follower.processPacket(Follower.java:131)&lt;br/&gt;
        at org.apache.zookeeper.server.quorum.Follower.followLeader(Follower.java:89)&lt;br/&gt;
        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:967)&lt;br/&gt;
2013-12-12 22:31:41,923 &lt;span class=&quot;error&quot;&gt;&amp;#91;myid:2&amp;#93;&lt;/span&gt; - WARN  [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=2&amp;#93;&lt;/span&gt;/127.0.0.1:2182:QuorumPeer@1259] - Restarting Leader Election&lt;br/&gt;
2013-12-12 22:31:41,924 &lt;span class=&quot;error&quot;&gt;&amp;#91;myid:2&amp;#93;&lt;/span&gt; - INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeerListener:QuorumCnxManager$Listener@544&amp;#93;&lt;/span&gt; - My election bind port: localhost/127.0.0.1:3889&lt;/p&gt;

&lt;p&gt;Bruno.&lt;/p&gt;</comment>
                            <comment id="13846973" author="shralex" created="Fri, 13 Dec 2013 00:38:12 +0000"  >&lt;p&gt;Hi Bruno,&lt;/p&gt;

&lt;p&gt;standaloneEnabled=false seems correct. Otherwise you would not be able to connect the servers since each of them would form a separate standalone ensemble.  The fact that server 2&apos;s line disappears initially from its own config is expected - once it syncs with the leader it adopts the current config in which its not yet a member. the initial config you start it with is invalid and only used to bootstrap server 2. Its sort of a hack, I agree, but we need to tell it which ports to listen to initially, etc. &lt;/p&gt;

&lt;p&gt;The error messages may indicate a bug or two. The second one from server 2 means that its trying to initiate a connection to itself, which I don&apos;t think should happen. The fix for this seems easy. I&apos;m not sure about the reason for server 1&apos;s error message. In any case, would be great if you open a JIRA for this, you can assign it to me.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Alex&lt;/p&gt;</comment>
                            <comment id="13848089" author="helen" created="Sat, 14 Dec 2013 00:13:52 +0000"  >&lt;p&gt;Uploaded patch to reviewboard. Alex, in my debugging over the summer I also came across similar stack traces that suggested a server was trying to connect to itself.&lt;/p&gt;</comment>
                            <comment id="13848337" author="bfreuden" created="Sat, 14 Dec 2013 11:58:05 +0000"  >&lt;p&gt;Hi Alexander,&lt;/p&gt;

&lt;p&gt;Here is the JIRA: &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1840&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1840&lt;/a&gt;&lt;br/&gt;
Opened it as a minor bug. However I&apos;ve not been able to assign it to you (I&apos;m wondering if I have rights to do so).&lt;br/&gt;
Regards,&lt;/p&gt;

&lt;p&gt;Bruno.&lt;/p&gt;</comment>
                            <comment id="13852267" author="michim" created="Wed, 18 Dec 2013 23:01:16 +0000"  >&lt;p&gt;I assigned &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1840&quot; title=&quot;Server tries to connect to itself during dynamic reconfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1840&quot;&gt;&lt;del&gt;ZOOKEEPER-1840&lt;/del&gt;&lt;/a&gt; to Alex.&lt;/p&gt;</comment>
                            <comment id="13857511" author="shralex" created="Fri, 27 Dec 2013 14:49:27 +0000"  >&lt;p&gt;Hi Helen,&lt;/p&gt;

&lt;p&gt;Sorry for the delay. Here are a few remaining comments:&lt;/p&gt;

&lt;p&gt;1) Please make sure that edge cases work properly. For example, after starting 2 servers with standaloneEnabled = true I am able to remove one of them. Please try to run other edge cases.&lt;/p&gt;

&lt;p&gt;2) When I&apos;m trying to remove all servers I get a No Quorum Connected error instead of &quot;BadArguments&quot; error that was issued previously. This is because the check for number of servers &amp;lt; 2 in PrepRequestProcessor is now gone. I think there should still be a check there, perhaps taking into account the new flag.&lt;/p&gt;

&lt;p&gt;Best Regards,&lt;br/&gt;
Alex&lt;/p&gt;</comment>
                            <comment id="13857625" author="helen" created="Fri, 27 Dec 2013 18:40:17 +0000"  >&lt;p&gt;Thanks for the input Alex.  Starting to work on this right now.&lt;/p&gt;</comment>
                            <comment id="13863881" author="helen" created="Tue, 7 Jan 2014 03:51:11 +0000"  >&lt;p&gt;I fixed part 2 to issue a BadArgument error. I&apos;m holding off on uploading the patch until we resolve what I&apos;m about to bring up.&lt;/p&gt;

&lt;p&gt;When I start two servers with standaloneEnabled = true and attempt to remove one (either the leader or follower) from the configuration I get the following error, as expected:&lt;br/&gt;
&quot;Error:KeeperErrorCode = BadArguments for Reconfig failed - new configuration must include at least 2 followers.&quot;&lt;/p&gt;

&lt;p&gt;When I start two servers with standaloneEnabled = true and force the leader to shut down I get the following error, as expected:&lt;br/&gt;
&quot;shutdown Leader! reason: Not sufficient followers synced, only synced with sids: [ 2 ]&quot; (which occurs from Leader.java when there is no longer a quorum). &lt;/p&gt;

&lt;p&gt;When I start two servers with standaloneEnabled = true and force the follower to shut down, the leader sets its state to LOOKING but hangs because it cannot connect to the shut down server. This is the case before my changes as well. &lt;/p&gt;

&lt;p&gt;Can you let me know under what circumstances are you removing 1 server from 2 servers with the remaining server running as normal so I can try to duplicate it?&lt;/p&gt;

&lt;p&gt;I also spent some time checking other edge cases and found everything to be working fine.  &lt;/p&gt;

&lt;p&gt;Thanks!&lt;br/&gt;
Helen&lt;/p&gt;
</comment>
                            <comment id="13863890" author="shralex" created="Tue, 7 Jan 2014 04:13:16 +0000"  >&lt;p&gt;Hi Helen,&lt;/p&gt;

&lt;p&gt;thanks for looking at this. I meant removing a server by reconfiguring it out of the ensemble, not by stopping it. From what you&apos;re saying your change might have already fixed the problem. If I&apos;m not mistaken we want to make sure that when the flag is false the target config includes 1 or more servers and when the flag is true we should ensure 2 or more remaining servers. &lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Alex&lt;/p&gt;</comment>
                            <comment id="13863893" author="helen" created="Tue, 7 Jan 2014 04:23:30 +0000"  >&lt;p&gt;Yes, that&apos;s the case!  I&apos;ll upload the new patch now.&lt;/p&gt;</comment>
                            <comment id="13863917" author="hadoopqa" created="Tue, 7 Jan 2014 05:16:09 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12621747/ZOOKEEPER-1691.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12621747/ZOOKEEPER-1691.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1554981.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1874//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1874//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1874//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1874//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1874//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1874//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13876975" author="shralex" created="Mon, 20 Jan 2014 23:29:47 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;I run the new patch and saw that Helen&apos;s change solves the last issue I raised.&lt;br/&gt;
thanks a lot Helen for all the hard work!&lt;/p&gt;</comment>
                            <comment id="13876995" author="helen" created="Mon, 20 Jan 2014 23:52:26 +0000"  >&lt;p&gt;Great, thank you Alex!&lt;/p&gt;</comment>
                            <comment id="13877183" author="hudson" created="Tue, 21 Jan 2014 04:39:49 +0000"  >&lt;p&gt;SUCCESS: Integrated in ZooKeeper-trunk #2192 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2192/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2192/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1691&quot; title=&quot;Add a flag to disable standalone mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1691&quot;&gt;&lt;del&gt;ZOOKEEPER-1691&lt;/del&gt;&lt;/a&gt;. Add a flag to disable standalone mode (Helen Hastings via michim) (michim: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1559916&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1559916&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/docs/src/documentation/content/xdocs/zookeeperAdmin.xml&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/cli/ReconfigCommand.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/FollowerZooKeeperServer.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/LeaderZooKeeperServer.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerTestBase.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/ReconfigTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/StandaloneTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13877186" author="michim" created="Tue, 21 Jan 2014 04:46:32 +0000"  >&lt;p&gt;Great work, Helen!&lt;/p&gt;</comment>
                            <comment id="13877653" author="rgs" created="Tue, 21 Jan 2014 17:50:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michim&quot; class=&quot;user-hover&quot; rel=&quot;michim&quot;&gt;Michi Mutsuzaki&lt;/a&gt;: some how src/java/test/org/apache/zookeeper/server/quorum/StandaloneDisabledTest.java didn&apos;t hit trunk. See: &lt;a href=&quot;https://github.com/apache/zookeeper/commit/283fd1886bab41850ceea3a7da3d41c248996619&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/zookeeper/commit/283fd1886bab41850ceea3a7da3d41c248996619&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="13877820" author="michim" created="Tue, 21 Jan 2014 20:28:07 +0000"  >&lt;p&gt;Ah good catch thanks Raul. &lt;/p&gt;</comment>
                            <comment id="13877822" author="michim" created="Tue, 21 Jan 2014 20:30:42 +0000"  >&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1560172&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1560172&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13878524" author="hudson" created="Wed, 22 Jan 2014 11:04:06 +0000"  >&lt;p&gt;FAILURE: Integrated in ZooKeeper-trunk #2194 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2194/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2194/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1691&quot; title=&quot;Add a flag to disable standalone mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1691&quot;&gt;&lt;del&gt;ZOOKEEPER-1691&lt;/del&gt;&lt;/a&gt;. Add StandaloneDisabledTest.java (Helen Hastings via michim) (michim: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1560172&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1560172&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/StandaloneDisabledTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12691695">ZOOKEEPER-1870</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12672660">ZOOKEEPER-1783</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12621747" name="ZOOKEEPER-1691.patch" size="27780" author="helen" created="Tue, 7 Jan 2014 04:31:39 +0000"/>
                            <attachment id="12616130" name="ZOOKEEPER-1691.patch" size="27299" author="helen" created="Wed, 27 Nov 2013 21:41:01 +0000"/>
                            <attachment id="12606410" name="ZOOKEEPER-1691.patch" size="28627" author="phunt" created="Wed, 2 Oct 2013 19:44:43 +0100"/>
                            <attachment id="12599288" name="ZOOKEEPER-1691.patch" size="28533" author="helen" created="Wed, 21 Aug 2013 23:05:43 +0100"/>
                            <attachment id="12598837" name="ZOOKEEPER-1691.patch" size="27419" author="helen" created="Mon, 19 Aug 2013 22:28:30 +0100"/>
                            <attachment id="12594468" name="ZOOKEEPER-1691.patch" size="24261" author="helen" created="Fri, 26 Jul 2013 23:49:11 +0100"/>
                            <attachment id="12594459" name="ZOOKEEPER-1691.patch" size="25548" author="helen" created="Fri, 26 Jul 2013 22:58:36 +0100"/>
                            <attachment id="12618298" name="test scenario.txt" size="14120" author="bfreuden" created="Wed, 11 Dec 2013 21:59:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 26 Jul 2013 21:58:36 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>323014</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzdkxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>323359</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>