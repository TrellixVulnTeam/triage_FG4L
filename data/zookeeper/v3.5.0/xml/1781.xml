<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:46:16 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1781/ZOOKEEPER-1781.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1781] ZooKeeper Server fails if snapCount is set to 1 </title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1781</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;If snapCount is set to 1, ZooKeeper Server can start but it fails with the below error:&lt;/p&gt;

&lt;p&gt;2013-10-02 18:09:07,600 &lt;span class=&quot;error&quot;&gt;&amp;#91;myid:1&amp;#93;&lt;/span&gt; - ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;SyncThread:1:SyncRequestProcessor@151&amp;#93;&lt;/span&gt; - Severe unrecoverable error, exiting&lt;br/&gt;
java.lang.IllegalArgumentException: n must be positive&lt;br/&gt;
        at java.util.Random.nextInt(Random.java:300)&lt;br/&gt;
        at org.apache.zookeeper.server.SyncRequestProcessor.run(SyncRequestProcessor.java:93)&lt;/p&gt;

&lt;p&gt;In source code,  it maybe be supposed that snapCount must be 2 or more:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;org.apache.zookeeper.server.SyncRequestProcessor.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     91             &lt;span class=&quot;code-comment&quot;&gt;// we &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; in an attempt to ensure that not all ofthe servers
&lt;/span&gt;     92             &lt;span class=&quot;code-comment&quot;&gt;// in the ensemble take a snapshot at the same time
&lt;/span&gt;     93             &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; randRoll = r.nextInt(snapCount/2);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think this supposition is not bad because snapCount = 1 is not realistic setting...&lt;br/&gt;
But, it may be better to mention this restriction in documentation or add a validation in the source code.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12672267">ZOOKEEPER-1781</key>
            <summary>ZooKeeper Server fails if snapCount is set to 1 </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bwtakacy">Takashi Ohnishi</assignee>
                                    <reporter username="bwtakacy">Takashi Ohnishi</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Oct 2013 02:19:27 +0100</created>
                <updated>Thu, 13 Mar 2014 18:17:07 +0000</updated>
                            <resolved>Tue, 8 Oct 2013 00:38:49 +0100</resolved>
                                    <version>3.4.5</version>
                                    <fixVersion>3.4.6</fixVersion>
                    <fixVersion>3.5.0</fixVersion>
                                    <component>quorum</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13786323" author="phunt" created="Fri, 4 Oct 2013 17:52:05 +0100"  >&lt;p&gt;IMO making it work with snapCount set to 1 would be the best way to resolve this. While it&apos;s not realistic for production use it would possibly be interesting for things like testing.&lt;/p&gt;</comment>
                            <comment id="13787194" author="bwtakacy" created="Sat, 5 Oct 2013 13:43:40 +0100"  >&lt;p&gt;I make a patch for ZooKeeper 3.4.5. By reading SyncRequestProcessor.java, I found that a  random number between snapCount/2 and snapCount-1 is used. So, I added an explanation about it in the documentation. And I changed the source code to reset snapCount into 2 if it is configured to 1, because snapCount = 1 is meaningless and snapCount = 2 is the minimum for this algorism.&lt;/p&gt;</comment>
                            <comment id="13787322" author="hadoopqa" created="Sat, 5 Oct 2013 21:32:56 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12606988/ZOOKEEPER-1781.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12606988/ZOOKEEPER-1781.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1529344.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1641//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1641//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13787524" author="bwtakacy" created="Sun, 6 Oct 2013 09:01:18 +0100"  >&lt;p&gt;I attached a modified patch which includes a junit test.&lt;/p&gt;</comment>
                            <comment id="13787528" author="hadoopqa" created="Sun, 6 Oct 2013 09:33:15 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12607062/ZOOKEEPER-1781.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12607062/ZOOKEEPER-1781.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1529344.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1643//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1643//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1643//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1643//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1643//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1643//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13787929" author="breed" created="Mon, 7 Oct 2013 06:50:57 +0100"  >&lt;p&gt;+1 good work!&lt;/p&gt;</comment>
                            <comment id="13788712" author="phunt" created="Tue, 8 Oct 2013 00:38:49 +0100"  >&lt;p&gt;Committed to 3.4.6 and trunk. Thanks Takashi!&lt;/p&gt;</comment>
                            <comment id="13789108" author="hudson" created="Tue, 8 Oct 2013 12:12:31 +0100"  >&lt;p&gt;SUCCESS: Integrated in ZooKeeper-trunk #2082 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2082/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2082/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1781&quot; title=&quot;ZooKeeper Server fails if snapCount is set to 1 &quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1781&quot;&gt;&lt;del&gt;ZOOKEEPER-1781&lt;/del&gt;&lt;/a&gt;. ZooKeeper Server fails if snapCount is set to 1 (Takashi Ohnishi via phunt, breed) (phunt: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1530110&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1530110&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/docs/index.pdf&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/docs/javaExample.pdf&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/docs/linkmap.pdf&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/docs/recipes.pdf&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/docs/releasenotes.pdf&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/docs/zookeeperAdmin.html&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/docs/zookeeperAdmin.pdf&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/docs/zookeeperHierarchicalQuorums.pdf&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/docs/zookeeperInternals.pdf&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/docs/zookeeperJMX.pdf&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/docs/zookeeperObservers.pdf&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/docs/zookeeperOver.pdf&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/docs/zookeeperProgrammers.pdf&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/docs/zookeeperQuotas.pdf&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/docs/zookeeperStarted.pdf&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/docs/zookeeperTutorial.pdf&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1781&quot; title=&quot;ZooKeeper Server fails if snapCount is set to 1 &quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1781&quot;&gt;&lt;del&gt;ZOOKEEPER-1781&lt;/del&gt;&lt;/a&gt;. ZooKeeper Server fails if snapCount is set to 1 (Takashi Ohnishi via phunt, breed) (phunt: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1530108&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1530108&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/docs/zookeeperAdmin.html&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/InvalidSnapCountTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13933761" author="fpj" created="Thu, 13 Mar 2014 18:17:07 +0000"  >&lt;p&gt;Closing issues after releasing 3.4.6.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12607062" name="ZOOKEEPER-1781.patch" size="6507" author="bwtakacy" created="Sun, 6 Oct 2013 08:57:01 +0100"/>
                            <attachment id="12606988" name="ZOOKEEPER-1781.patch" size="2036" author="bwtakacy" created="Sat, 5 Oct 2013 13:18:21 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 4 Oct 2013 16:52:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>351893</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hziikn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352181</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>