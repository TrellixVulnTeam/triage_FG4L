<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:41:31 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-335/ZOOKEEPER-335.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-335] zookeeper servers should commit the new leader txn to their logs.</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-335</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;currently the zookeeper followers do not commit the new leader election. This will cause problems in a failure scenarios with a follower acking to the same leader txn id twice, which might be two different intermittent leaders and allowing them to propose two different txn&apos;s of the same zxid.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12416126">ZOOKEEPER-335</key>
            <summary>zookeeper servers should commit the new leader txn to their logs.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="breed">Benjamin Reed</assignee>
                                    <reporter username="mahadev">Mahadev konar</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Mar 2009 18:55:48 +0000</created>
                <updated>Wed, 23 Nov 2011 19:22:30 +0000</updated>
                            <resolved>Tue, 14 Jun 2011 06:14:31 +0100</resolved>
                                    <version>3.1.0</version>
                                    <fixVersion>3.4.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                            <comments>
                            <comment id="12724318" author="mahadev" created="Thu, 25 Jun 2009 23:02:48 +0100"  >&lt;p&gt;to fix this issue we require server -server protocol change. Thsi protocol change will break backwards compatibility. To maintain backwards compatibility the code becomes quite complex and tricky. Instead of making a last minute change and having to do al lthe testing to check if backwards compatibily for servers is maintained, I am moving it to 3.3 to see if we want to fix it in a backwards compatible manner or fix it in 4.0 and break backwards compatibility. &lt;/p&gt;</comment>
                            <comment id="12843639" author="mahadev" created="Wed, 10 Mar 2010 17:16:37 +0000"  >&lt;p&gt;given the change is non trivial as mentioned above, I am moving this to 3.4 for now.&lt;/p&gt;</comment>
                            <comment id="12874733" author="phunt" created="Wed, 2 Jun 2010 19:45:38 +0100"  >&lt;p&gt;Raising to blocker level - we&apos;ve seen this reported by users a couple times now.&lt;/p&gt;</comment>
                            <comment id="12874888" author="charitymid" created="Thu, 3 Jun 2010 01:31:54 +0100"  >&lt;p&gt;I ran into this bug this morning, but it also seemed to put my cluster into an unusable state.  The cluster stopped accepting all connections, until I restarted node one.  After node one departed the cluster, nodes two and three formed a quorum and started serving again.  Node one was unable to rejoin, and had this error:&lt;/p&gt;

&lt;p&gt;2010-06-02 17:04:56,486 - FATAL &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0:0:0:0:0:0:0:0:2181:Follower@71&amp;#93;&lt;/span&gt; - Leader epoch a is less than our epoch b&lt;br/&gt;
2010-06-02 17:04:56,486 - WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0:0:0:0:0:0:0:0:2181:Follower@82&amp;#93;&lt;/span&gt; - Exception when following the leader&lt;br/&gt;
java.io.IOException: Error: Epoch of leader is lower&lt;/p&gt;

&lt;p&gt;until I cleared the data directory and restarted again.&lt;/p&gt;</comment>
                            <comment id="12879520" author="vishalmlst" created="Wed, 16 Jun 2010 22:47:17 +0100"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;We are running into this bug very often (almost 60-75% hit rate) while testing our newly developed application over ZK.&lt;br/&gt;
This is almost a blocker for us. Will the fix be simplified if backward compatibility was not an issue?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="12879548" author="phunt" created="Wed, 16 Jun 2010 23:23:48 +0100"  >&lt;p&gt;We are unable to reproduce this issue. If you can provide the server logs (all servers) and attach them to this jira it would be very helpful. Some detail on the approx time of the issue so we can correlate to the logs would help too (summary of what you did/do to cause it, etc... anything that might help us nail this one down).&lt;/p&gt;

&lt;p&gt;Detail on ZK version, OS, Java version, HW info, etc... would also be of use to us. &lt;/p&gt;</comment>
                            <comment id="12879967" author="msolo" created="Thu, 17 Jun 2010 23:14:28 +0100"  >&lt;p&gt;I am having this exact issue, but I am not upgrading. I am merely restarting the cluster.&lt;/p&gt;

&lt;p&gt;I have a cluster of three. I took down host1 and verified that my application remained and reconnected to host2 and host3.&lt;/p&gt;

&lt;p&gt;With host1 back online, I took down host2. I noticed that the java process was spinning over 100% CPU and realized it had not come back up.&lt;/p&gt;

&lt;p&gt;This is running the 3.3.0 JAR release on a dual proc, quad-core Intel box. I&apos;m running SuSE 10.3, 64-bit, with this version of java:&lt;/p&gt;

&lt;p&gt;java version &quot;1.6.0_10&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_10-b33)&lt;br/&gt;
Java HotSpot(TM) Server VM (build 11.0-b15, mixed mode)&lt;/p&gt;

&lt;p&gt;I will attach a log file.&lt;/p&gt;</comment>
                            <comment id="12879968" author="msolo" created="Thu, 17 Jun 2010 23:16:27 +0100"  >&lt;p&gt;This is the log file of my second attempt to restart a wedged zookeeper server.&lt;/p&gt;</comment>
                            <comment id="12880001" author="phunt" created="Fri, 18 Jun 2010 00:33:14 +0100"  >&lt;p&gt;Thanks for the log Mike. This issue does seem similar to what Charity reported:&lt;/p&gt;

&lt;p&gt;2010-06-17 14:35:34,263 - FATAL &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0:0:0:0:0:0:0:0:2181:Follower@71&amp;#93;&lt;/span&gt; - Leader epoch 1 is less than our epoch 2&lt;/p&gt;

&lt;p&gt;Unfortunately the attached log shows information only after the problem occurred. Any chance you could upload the logs during the initial event? (what I mean is when the problem originally started) Also the logs from the other servers in the ensemble (again, at the time that the problem originally occurred) would really help. Thanks.&lt;/p&gt;

&lt;p&gt;Have you been able to clear the problem? It&apos;s fairly straightforward to resolve - Charity resolved by; 1) bring down the failing server, 2) clear the data directory of that server (only), 3) start that server. You only want to do this for the server that&apos;s unable to rejoin the quorum - ie the one thats outputting &quot;Leader epoch 1 is less than our epoch 2&quot;, &lt;em&gt;not&lt;/em&gt; for all servers in the ensemble.&lt;/p&gt;</comment>
                            <comment id="12880202" author="fpj" created="Fri, 18 Jun 2010 14:38:50 +0100"  >&lt;p&gt;Mike, There is one thing I don&apos;t understand. From the logs, it looks like servers 1 and 3 are proposing a zxid of 0 (second field of notification) during election, which makes me think that they had no state at all:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2010-06-17 14:35:40,714 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:FastLeaderElection@689] - Notification: 2, 8589934884, 2, 2, LOOKING, LOOKING, 2
2010-06-17 14:35:40,714 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:FastLeaderElection@799] - Notification: 3, 0, 1, 2, LOOKING, FOLLOWING, 1
2010-06-17 14:35:40,714 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:FastLeaderElection@799] - Notification: 3, 0, 1, 2, LOOKING, LEADING, 3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Server 2 on the other hand had accepted updates based on the zxid it proposes. Were they supposed to have no state at all? Have you deleted your logs and snapshots before restarting the servers? &lt;/p&gt;</comment>
                            <comment id="12880234" author="phunt" created="Fri, 18 Jun 2010 16:55:31 +0100"  >&lt;p&gt;Side note: Flavio can you enter a JIRA to fix this log message, it would really be helpful to have attribute names in the log message do simplify debugging. (general review of quorum logging would be great, fix stuff like this and ensure that enough information is provided to debug - add logging?) Perhaps coordinate with Ivan, I think he was trying to change things a bit to enable more log analysis support in the &quot;loggrapher&quot; contrib.&lt;/p&gt;</comment>
                            <comment id="12880305" author="vishalmlst" created="Fri, 18 Jun 2010 21:06:50 +0100"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I have attached the logs. The log entries are similar to those reported by others.&lt;/p&gt;

&lt;p&gt;We are testing with 3 nodes. Each node is run in a VM running SLES 11. All 3 VMs are run on the same host. VMs are sharing the same disk. cpuinfo and meminfo for VM is in the attached file.&lt;br/&gt;
I have also tried to collect more info with -verbose:gc -Xloggc:/../ -Xprof options to java.&lt;/p&gt;

&lt;p&gt;gc.lg contains the gc output&lt;br/&gt;
rest of the info should be in msgs.log&lt;br/&gt;
Default java heap size was used. java version  &quot;1.6.0_18&quot; was used.&lt;/p&gt;

&lt;p&gt;One point to note - In my case, on the misbehaving node could not joing the cluster. Rest of the cluster was stable (except for the flood of log messages on the leader because the misbehaving follower kept terminating session).&lt;/p&gt;

&lt;p&gt;Hope this helps.&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="12880320" author="fpj" created="Fri, 18 Jun 2010 21:48:30 +0100"  >&lt;p&gt;Guys, I don&apos;t see enough information in these logs to determine what&apos;s going on. Let me tell you what I&apos;m seeing so that perhaps other folks can help me out here. &lt;/p&gt;

&lt;p&gt;One part of the log that is suspicious is this one:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;=6693 [QuorumPeer:/0.0.0.0:2181] WARN  org.apache.zookeeper.server.quorum.Learner  - Got zxid 0x300000001 expected 0x1
=6693 [QuorumPeer:/0.0.0.0:2181] WARN  org.apache.zookeeper.server.quorum.Learner  - Got zxid 0x300000001 expected 0x1
[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor30]
[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor27]
[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor22]
[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor23]
[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor18]
[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor20]
[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor19]
[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor31]
[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor21]
[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor26]
[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor25]
[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor33]
[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor29]
[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor28]
[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor24]
[Unloading class sun.reflect.GeneratedSerializationConstructorAccessor32]

************* NODE RESTARTED HERE **********************
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Before being restarted, the bad node receives a proposal with zxid &amp;lt;3,1&amp;gt; and it expects &amp;lt;0,1&amp;gt;. Next in the logs after being restarted, I can see that it is complaining that it has epoch 4 and the leader 3. Something strange apparently happened during the restart. It also seems to be the case that the node was being able to talk to the others (first entries in the log before the excerpt above).&lt;/p&gt;

&lt;p&gt;Do you guys see anything I&apos;m overlooking?&lt;/p&gt;</comment>
                            <comment id="12880917" author="phunt" created="Mon, 21 Jun 2010 19:02:54 +0100"  >&lt;p&gt;vishal comment on list:&lt;/p&gt;


&lt;p&gt;I might be wrong here, but let me try to chip in my few cents.&lt;/p&gt;

&lt;p&gt;I think the problem is in LearnerHandler.java at the leader fo this&lt;br/&gt;
Follower.&lt;/p&gt;

&lt;p&gt;            /* see what other packets from the proposal&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;and tobeapplied queues need to be sent&lt;/li&gt;
	&lt;li&gt;and then decide if we can just send a DIFF&lt;/li&gt;
	&lt;li&gt;or we actually need to send the whole snapshot&lt;br/&gt;
             */&lt;br/&gt;
            long leaderLastZxid = leader.startForwarding(this, updates);&lt;br/&gt;
---&amp;gt; this leaderLastZxid returned is probably incorrect.&lt;br/&gt;
            // a special case when both the ids are the same&lt;br/&gt;
            if (peerLastZxid == leaderLastZxid) 
{
                packetToSend = Leader.DIFF;
                zxidToSend = leaderLastZxid;
            }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;            QuorumPacket newLeaderQP = new QuorumPacket(Leader.NEWLEADER,&lt;br/&gt;
                    leaderLastZxid, null, null);&lt;br/&gt;
            oa.writeRecord(newLeaderQP, &quot;packet&quot;);&lt;br/&gt;
            bufferedOutput.flush()&lt;/p&gt;</comment>
                            <comment id="12880918" author="phunt" created="Mon, 21 Jun 2010 19:03:12 +0100"  >&lt;p&gt;vishal comment on list:&lt;/p&gt;


&lt;p&gt;Nevermind. I am on the wrong track. Flavio&apos;s earlier mail did clarify that&lt;br/&gt;
the follower received the epoch before restart.&lt;/p&gt;</comment>
                            <comment id="12880919" author="phunt" created="Mon, 21 Jun 2010 19:03:30 +0100"  >&lt;p&gt;Vishal comment on list:&lt;/p&gt;


&lt;p&gt;Hi Flavio,&lt;/p&gt;

&lt;p&gt;I have 3 set of logs and they all seem to indicate two problems on the&lt;br/&gt;
misbehaving follower:&lt;/p&gt;

&lt;p&gt;Problem 1: Expected zxid is incorrect&lt;br/&gt;
=0    &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181&amp;#93;&lt;/span&gt; WARN&lt;br/&gt;
org.apache.zookeeper.server.quorum.Learner  - Got zxid 0x300000002 expected&lt;br/&gt;
0x1&lt;br/&gt;
=0    &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181&amp;#93;&lt;/span&gt; WARN&lt;br/&gt;
org.apache.zookeeper.server.quorum.Learner  - Got zxid 0x300000002 expected&lt;br/&gt;
0x1&lt;br/&gt;
=2495 &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181&amp;#93;&lt;/span&gt; WARN&lt;br/&gt;
org.apache.zookeeper.server.quorum.Learner  - Got zxid 0x400000001 expected&lt;br/&gt;
0x1&lt;br/&gt;
=2495 &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181&amp;#93;&lt;/span&gt; WARN&lt;br/&gt;
org.apache.zookeeper.server.quorum.Learner  - Got zxid 0x400000001 expected&lt;br/&gt;
0x1&lt;br/&gt;
=191617 &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181&amp;#93;&lt;/span&gt; WARN&lt;br/&gt;
org.apache.zookeeper.server.quorum.Learner  - Got zxid 0x500000001 expected&lt;br/&gt;
0x1&lt;br/&gt;
=191617 &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181&amp;#93;&lt;/span&gt; WARN&lt;br/&gt;
org.apache.zookeeper.server.quorum.Learner  - Got zxid 0x500000001 expected&lt;br/&gt;
0x1&lt;br/&gt;
=0    &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181&amp;#93;&lt;/span&gt; WARN&lt;br/&gt;
org.apache.zookeeper.server.quorum.Learner  - Got zxid 0x600000001 expected&lt;br/&gt;
0x1&lt;br/&gt;
=0    &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181&amp;#93;&lt;/span&gt; WARN&lt;br/&gt;
org.apache.zookeeper.server.quorum.Learner  - Got zxid 0x600000001 expected&lt;br/&gt;
0x1&lt;br/&gt;
=245016 &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181&amp;#93;&lt;/span&gt; WARN&lt;br/&gt;
org.apache.zookeeper.server.quorum.Learner  - Got zxid 0x700000001 expected&lt;br/&gt;
0x1&lt;br/&gt;
=245016 &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181&amp;#93;&lt;/span&gt; WARN&lt;br/&gt;
org.apache.zookeeper.server.quorum.Learner  - Got zxid 0x700000001 expected&lt;br/&gt;
0x1&lt;/p&gt;

&lt;p&gt;Note expected zxid is always 0x1 (lastQueued is always 0?)&lt;/p&gt;

&lt;p&gt;Problem 2: While joining the cluster expected epoch is 1 higher than seen&lt;br/&gt;
earlier&lt;br/&gt;
=14991 &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181&amp;#93;&lt;/span&gt; FATAL&lt;br/&gt;
org.apache.zookeeper.server.quorum.Learner  - Leader epoch 7 is less than&lt;br/&gt;
our epoch 8&lt;/p&gt;

&lt;p&gt;-Vishal&lt;/p&gt;</comment>
                            <comment id="12881028" author="vishalmlst" created="Tue, 22 Jun 2010 03:45:05 +0100"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I enabled tracing and did some more debugging. Looks like the restarted peer (and trying to join the cluster) determines that it is a leader and increments its epoch. However, rest of the nodes don&apos;t acknowledge this node as the leader, and hence, have an older epoch. I will attache the log. Unfortunately, I don&apos;t have traces from other nodes. I will repeat the experiment later and attache logs from other nodes. &lt;/p&gt;

&lt;p&gt;Scenario:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Form a 3 node cluster. This is not just ZK cluster. It also involves our application cluster that uses ZK.&lt;/li&gt;
	&lt;li&gt;Kill one of the follower&lt;/li&gt;
	&lt;li&gt;After a minute or so restart follower&lt;/li&gt;
	&lt;li&gt;Follower rejects leader with &quot;Leader epoch y is less than our epoch y + 1&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;From logs:&lt;/p&gt;

&lt;p&gt;a) Peer X restarts and starts leader election.&lt;br/&gt;
a) For a small window of time, X thinks that it is the new leader! During this window, for some reason, rest of the nodes tell X that they are also trying to find a leader. I.e., all 3 nodes are in LOOKING state. After seeing that all 3 nodes are in LOOKING state, X decides to be a leader?&lt;/p&gt;

&lt;p&gt;   155 2010-06-20 23:22:46,421 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;WorkerSender Thread:QuorumCnxManager@346&amp;#93;&lt;/span&gt; - Opening channel to server 1&lt;br/&gt;
   156 2010-06-20 23:22:46,423 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;WorkerReceiver Thread:FastLeaderElection$Messenger$WorkerReceiver@214&amp;#93;&lt;/span&gt; - Receive new notification message. My id = 0&lt;br/&gt;
   157 2010-06-20 23:22:46,424 - INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181:FastLeaderElection@689&amp;#93;&lt;/span&gt; - Notification: 0, 77309411393, 1, 0, LOOKING, LOOKING, 0&lt;br/&gt;
   158 2010-06-20 23:22:46,424 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181:FastLeaderElection@495&amp;#93;&lt;/span&gt; - id: 0, proposed id: 0, zxid: 77309411393, proposed zxid: 77309411393&lt;br/&gt;
   159 2010-06-20 23:22:46,424 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181:FastLeaderElection@717&amp;#93;&lt;/span&gt; - Adding vote: From = 0, Proposed leader = 0, Porposed zxid = 77309411393, Proposed epoch = 1&lt;br/&gt;
   160 2010-06-20 23:22:46,426 - INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;WorkerSender Thread:QuorumCnxManager@162&amp;#93;&lt;/span&gt; - Have smaller server identifier, so dropping the connection: (1, 0)&lt;br/&gt;
   161 2010-06-20 23:22:46,426 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;WorkerSender Thread:QuorumCnxManager@346&amp;#93;&lt;/span&gt; - Opening channel to server 2&lt;br/&gt;
   162 2010-06-20 23:22:46,427 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-1:QuorumCnxManager$Listener@445&amp;#93;&lt;/span&gt; - Connection request /192.168.1.182:46701&lt;br/&gt;
   163 2010-06-20 23:22:46,427 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-1:QuorumCnxManager$Listener@448&amp;#93;&lt;/span&gt; - Connection request: 0&lt;br/&gt;
   164 2010-06-20 23:22:46,428 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-1:QuorumCnxManager$SendWorker@504&amp;#93;&lt;/span&gt; - Address of remote peer: 1&lt;br/&gt;
   165 2010-06-20 23:22:46,428 - INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;WorkerSender Thread:QuorumCnxManager@162&amp;#93;&lt;/span&gt; - Have smaller server identifier, so dropping the connection: (2, 0)&lt;br/&gt;
   166 2010-06-20 23:22:46,431 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;WorkerReceiver Thread:FastLeaderElection$Messenger$WorkerReceiver@214&amp;#93;&lt;/span&gt; - Receive new notification message. My id = 0&lt;br/&gt;
   167 2010-06-20 23:22:46,432 - INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181:FastLeaderElection@689&amp;#93;&lt;/span&gt; - Notification: 1, 77309411372, 1, 0, LOOKING, LOOKING, 1&lt;br/&gt;
   168 2010-06-20 23:22:46,432 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181:FastLeaderElection@495&amp;#93;&lt;/span&gt; - id: 1, proposed id: 0, zxid: 77309411372, proposed zxid: 77309411393&lt;br/&gt;
   169 2010-06-20 23:22:46,432 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181:FastLeaderElection@717&amp;#93;&lt;/span&gt; - Adding vote: From = 1, Proposed leader = 1, Porposed zxid = 77309411372, Proposed epoch = 1&lt;br/&gt;
   170 2010-06-20 23:22:46,436 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-1:QuorumCnxManager$Listener@445&amp;#93;&lt;/span&gt; - Connection request /192.168.1.183:44310&lt;br/&gt;
   171 2010-06-20 23:22:46,436 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-1:QuorumCnxManager$Listener@448&amp;#93;&lt;/span&gt; - Connection request: 0&lt;br/&gt;
   172 2010-06-20 23:22:46,436 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-1:QuorumCnxManager$SendWorker@504&amp;#93;&lt;/span&gt; - Address of remote peer: 2&lt;br/&gt;
   173 2010-06-20 23:22:46,440 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;WorkerReceiver Thread:FastLeaderElection$Messenger$WorkerReceiver@214&amp;#93;&lt;/span&gt; - Receive new notification message. My id = 0&lt;br/&gt;
   174 2010-06-20 23:22:46,440 - INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181:FastLeaderElection@689&amp;#93;&lt;/span&gt; - Notification: 2, 73014444097, 1, 0, LOOKING, LOOKING, 2&lt;br/&gt;
   175 2010-06-20 23:22:46,440 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181:FastLeaderElection@495&amp;#93;&lt;/span&gt; - id: 2, proposed id: 0, zxid: 73014444097, proposed zxid: 77309411393&lt;br/&gt;
   176 2010-06-20 23:22:46,441 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181:FastLeaderElection@717&amp;#93;&lt;/span&gt; - Adding vote: From = 2, Proposed leader = 2, Porposed zxid = 73014444097, Proposed epoch = 1&lt;br/&gt;
   177 2010-06-20 23:22:46,441 - INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;QuorumPeer:/0.0.0.0:2181:QuorumPeer@647&amp;#93;&lt;/span&gt; - LEADING&lt;/p&gt;

&lt;p&gt;b) As a result X  increments its epoch. Worse, since this node decided to be a leader, it starts doing transactions. The first set of transactions start removing all ephemeral nodes. But these transactions are only done locally. Other peers do not ack these transactions since they know that this peer is not the leader.&lt;/p&gt;

&lt;p&gt;c) After a few seconds (8 secs), X relinquishes leadership since it does not receive any ack from rest of the peers&lt;br/&gt;
d) It starts leader election again. This time, rests of the peers respond correctly informing X that a leader already exists.&lt;br/&gt;
e) X determines that it should now follow the leader and starts handshake with the leader. However, X has incremented its epoch in the mean time. X thinks that the epoch sent by the leader during handshake is older than the epoch it has noticed before. X aborts connection with the leader.&lt;/p&gt;</comment>
                            <comment id="12881033" author="vishalmlst" created="Tue, 22 Jun 2010 04:03:07 +0100"  >&lt;p&gt;Apologies for multiple attachments.&lt;/p&gt;</comment>
                            <comment id="12881168" author="fpj" created="Tue, 22 Jun 2010 12:14:22 +0100"  >&lt;p&gt;Thanks for detailed assessment, Vishal. In Step b, the fact that the process believes it is the leader is not a problem, and it happens because we queue notification messages during leader election. &lt;/p&gt;

&lt;p&gt;The real issue is that leader code is setting the last processed zxid to the first of the new epoch even before connecting to a quorum of followers. Because the leader code sets this value before connecting to a quorum of followers (Leader.java:281) and the follower code throws an IOException (Follower.java:73) if the leader epoch is smaller, we have that when the false leader drops leadership and becomes a follower, it finds a smaller epoch and kills itself.&lt;/p&gt;

&lt;p&gt;I noticed that this follower check was not there before (not present in 3.0 branch), and it might have been introduced when we did the observer reorganization. For now I propose that we move line Leader.java:281 to Leader.java:470. It simply changes the point in which we set the last processed zxid to one in which we know that  a quorum of followers supports the leader. I reasoned a bit about it and verified that tests pass.&lt;/p&gt;

&lt;p&gt;A patch for the change I&apos;m proposing is trivial, but a unit test will require some work, so I&apos;d rather hear opinions first. Also, please note that this problem is not related to the topic of this jira, so we might consider working on a different jira from this point on. &lt;/p&gt;
</comment>
                            <comment id="12881236" author="phunt" created="Tue, 22 Jun 2010 17:13:48 +0100"  >&lt;p&gt;Vishal, if Flavio provides you with a patch could you apply it and verify with your configuration?&lt;/p&gt;

&lt;p&gt;Flavio, please provide an initial patch that people could use to verify. We&apos;ll hold off on a release until you add the test(s), but this would be great to start with.&lt;/p&gt;

&lt;p&gt;Thanks all for helping to track this down!&lt;/p&gt;

&lt;p&gt;I&apos;d like to fast track a 3.3.2 release, so if possible please make this a priority.&lt;/p&gt;</comment>
                            <comment id="12881244" author="fpj" created="Tue, 22 Jun 2010 17:50:44 +0100"  >&lt;p&gt;I have created a new jira for this issue: &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-790&quot; title=&quot;Last processed zxid set prematurely while establishing leadership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-790&quot;&gt;&lt;del&gt;ZOOKEEPER-790&lt;/del&gt;&lt;/a&gt;. There is a patch there.&lt;/p&gt;</comment>
                            <comment id="12881280" author="vishalmlst" created="Tue, 22 Jun 2010 19:18:13 +0100"  >&lt;p&gt;I will try out the patch. FYI I am using 3.3.0.&lt;/p&gt;</comment>
                            <comment id="12888684" author="traviscrawford" created="Thu, 15 Jul 2010 04:21:39 +0100"  >&lt;p&gt;Unfortunately I still observed the &quot;Leader epoch&quot; issue and needed to manually force a leader election for the cluster to recover. This test was performed with the following base+patches, applied in the order listed.&lt;/p&gt;

&lt;p&gt;Zookeeper 3.3.1&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-744&quot; title=&quot;Add monitoring four-letter word&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-744&quot;&gt;&lt;del&gt;ZOOKEEPER-744&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-790&quot; title=&quot;Last processed zxid set prematurely while establishing leadership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-790&quot;&gt;&lt;del&gt;ZOOKEEPER-790&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2010-07-15 02:43:57,181 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:FileSnap@82] - Reading snapshot /data/zookeeper/version-2/snapshot.2300001ac2
2010-07-15 02:43:57,384 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:FastLeaderElection@649] - New election. My id =  1, Proposed zxid = 154618826848
2010-07-15 02:43:57,385 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:FastLeaderElection@689] - Notification: 1, 154618826848, 4, 1, LOOKING, LOOKING, 1
2010-07-15 02:43:57,385 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:FastLeaderElection@799] - Notification: 2, 146030952153, 3, 1, LOOKING, LEADING, 2
2010-07-15 02:43:57,385 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:FastLeaderElection@799] - Notification: 2, 146030952153, 3, 1, LOOKING, FOLLOWING, 3
2010-07-15 02:43:57,385 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:QuorumPeer@642] - FOLLOWING
2010-07-15 02:43:57,385 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:ZooKeeperServer@151] - Created server with tickTime 2000 minSessionTimeout 4000 maxSessionTimeout 40000 datadir /data/zookeeper/txlog/version-2 snapdir /data/zookeeper/version-2
2010-07-15 02:43:57,387 - FATAL [QuorumPeer:/0:0:0:0:0:0:0:0:2181:Follower@71] - Leader epoch 23 is less than our epoch 24
2010-07-15 02:43:57,387 - WARN  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:Follower@82] - Exception when following the leader 
java.io.IOException: Error: Epoch of leader is lower
        at org.apache.zookeeper.server.quorum.Follower.followLeader(Follower.java:73)
        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:644)
2010-07-15 02:43:57,387 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:Follower@166] - shutdown called 
java.lang.Exception: shutdown Follower
        at org.apache.zookeeper.server.quorum.Follower.shutdown(Follower.java:166)
        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:648)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;I followed the recipe @vishal provided for recreating.&lt;/p&gt;

&lt;p&gt;(a) Stop one follower in a three node cluster&lt;br/&gt;
(b) Get some tea while it falls behind&lt;br/&gt;
(c) Start the node stopped in (a).&lt;/p&gt;


&lt;p&gt;These timestamps show where the follower was stopped. It also shows when it was turned back on.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2010-07-15 02:35:36,398 - INFO  [QuorumPeer:/0:0:0:0:0:0:0:0:2181:NIOServerCnxn@1661] - Established session 0x229aa13cfc6276b with negotiated timeout 10000 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; client /10.209.45.114:34562
2010-07-15 02:39:18,907 - INFO  [main:QuorumPeerConfig@90] - Reading configuration from: /etc/zookeeper/conf/zoo.cfg
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;This timestamp is the first ``Leader epoch`` line. Everything between these two points will be the interesting bits.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2010-07-15 02:39:43,339 - FATAL [QuorumPeer:/0:0:0:0:0:0:0:0:2181:Follower@71] - Leader epoch 23 is less than our epoch 24
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12888686" author="traviscrawford" created="Thu, 15 Jul 2010 04:24:56 +0100"  >&lt;p&gt;Please see my most recent comment for a summary of where the interesting lines are in this log file.&lt;/p&gt;</comment>
                            <comment id="12934189" author="rss1987" created="Sat, 20 Nov 2010 20:48:35 +0000"  >&lt;p&gt;We are hitting this problem often. A follower starts infinite looping on this, and it does not accept clients anymore.&lt;/p&gt;

&lt;p&gt;It says LOOKING, than FOLLOWING, than &quot;Leader epoch y is less than our epoch y +1 &quot;, throws exception in shutdown and loops again.&lt;/p&gt;

&lt;p&gt;The only way I could make it work again it was to cleanup the data directory and restart the server.&lt;/p&gt;

&lt;p&gt;Any change this will be fixed soon ?&lt;/p&gt;</comment>
                            <comment id="12934202" author="fpj" created="Sat, 20 Nov 2010 22:21:33 +0000"  >&lt;p&gt;Radu, It sounds like the problem you mention has been resolved in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-790&quot; title=&quot;Last processed zxid set prematurely while establishing leadership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-790&quot;&gt;&lt;del&gt;ZOOKEEPER-790&lt;/del&gt;&lt;/a&gt;. I&apos;m not sure which version you&apos;re using, but perhaps you should consider moving to 3.3.2.&lt;/p&gt;</comment>
                            <comment id="13006250" author="vishalmlst" created="Sun, 13 Mar 2011 18:49:57 +0000"  >&lt;blockquote&gt;
&lt;p&gt;to fix this issue we require server -server protocol change. Thsi protocol change will break backwards compatibility. To maintain backwards compatibility the code becomes quite complex and tricky. Instead of making a last minute change and having to do all the testing to check if backwards compatibily for servers is maintained, I am moving it to 3.3 to see if we want to fix it in a backwards compatible manner or fix it in 4.0 and break backwards compatibility.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Until the bug is fixed, will it be possible to avoid running into this scenario by doing the following:&lt;br/&gt;
1. Create a znode /dummy&lt;br/&gt;
2. After receiving a SyncConnected write some data to /dummy&lt;br/&gt;
3. Then proceed with other write transactions&lt;/p&gt;

&lt;p&gt;Essentially, do a NULL transaction from the client. Will this prevent the log divergence to affect divergence of ordering of client transactions?&lt;/p&gt;</comment>
                            <comment id="13015965" author="vishalmlst" created="Tue, 5 Apr 2011 16:36:18 +0100"  >&lt;p&gt;Folks,&lt;/p&gt;

&lt;p&gt;Can someone comment if the work around that I mentioned in my previous comment is valid?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;br/&gt;
-Vishal&lt;/p&gt;</comment>
                            <comment id="13043017" author="vishalmlst" created="Thu, 2 Jun 2011 20:54:12 +0100"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I think we are running into this bug where the leader dies after&lt;br/&gt;
recording the transaction locally but before sending it out to the followers.&lt;/p&gt;

&lt;p&gt;This is causing log divergence, which is causing the client connected&lt;br/&gt;
to the old leader (after reboot) to  see different&lt;br/&gt;
data. Unfortunately, I don&apos;t have the transaction logs to look&lt;br/&gt;
into. But based on the ZooKeeper logs I am strongly suspecting that we&lt;br/&gt;
are running into this bug. I have given the description below. Please&lt;br/&gt;
let me know if you think I am on the wrong track.&lt;/p&gt;

&lt;p&gt;We have a 3 node cluster. IP addresses are *.53, *.54 and *.55.&lt;/p&gt;

&lt;p&gt;1) 54 is the leader and is rebooted by our test.&lt;/p&gt;

&lt;p&gt;2) Node 55 becomes ZK leader&lt;br/&gt;
2011-05-30 22:56:45.797 INFO - [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=2&amp;#93;&lt;/span&gt;/0:0:0:0:0:0:0:0:2181:QuorumPeer@662] - LEADING&lt;/p&gt;

&lt;p&gt;The next transaction it will do will be zxid 0x0x5D00000001. We can see this from the zxid below:&lt;/p&gt;

&lt;p&gt;2011-05-30 22:56:46.819 INFO - [LearnerHandler&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=2&amp;#93;&lt;/span&gt;-/192.168.4.1:33329:Leader@503] - Have quorum of supporters; starting up and setting last processed zxid: 399431958528&lt;/p&gt;

&lt;p&gt;3) Our client on 55 attempts to create a znode. This is the first&lt;br/&gt;
transaction after 55 becomes the leader. The following application&lt;br/&gt;
message tells us that is writing to ZK.&lt;/p&gt;

&lt;p&gt;2011-05-30 22:56:52.608 INFO - commitTransaction - Committing transaction 21068:&lt;/p&gt;

&lt;p&gt;This will translate to ZooKeeper transaction ID 0x5D00000001. Now, at&lt;br/&gt;
the same instant 53 was rebooted by the test.&lt;/p&gt;

&lt;p&gt;Now 54 and 53 are both down, 55 loses quorum and is rebooted by our watchdog.&lt;br/&gt;
2011-05-30 22:56:54.922 WARN - [LearnerHandler&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=2&amp;#93;&lt;/span&gt;-/192.168.4.1:33329:LearnerHandler@475] - ******* GOODBYE /192.168.4.1:33329 ********&lt;br/&gt;
2011-05-30 22:56:55.916 INFO - [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=2&amp;#93;&lt;/span&gt;/0:0:0:0:0:0:0:0:2181:Leader@396] - Shutdown called&lt;br/&gt;
java.lang.Exception: shutdown Leader! reason: Only 0 followers, need 1&lt;/p&gt;

&lt;p&gt;At this step, I will assume that 53 logged transaction ID 0x5D00000001&lt;br/&gt;
&lt;b&gt;and&lt;/b&gt; 53 went offline before receiving this transaction from 55. I am&lt;br/&gt;
not able to verify this since I don&apos;t have the transaction logs. But I&lt;br/&gt;
think this assumption is valid and can be inferred from the&lt;br/&gt;
description below.&lt;/p&gt;


&lt;p&gt;4) Now, 53 and 54 reboot. 53 becomes leader. Since neither 53 and 54&lt;br/&gt;
have heard of 55&apos;s 0x5D00000001 transaction, 53 also decides to&lt;br/&gt;
start doing the transaction from 0x5D00000001.&lt;br/&gt;
Corresponding log entry from 53:&lt;br/&gt;
2011-05-30 22:58:10.116 INFO - [LearnerHandler&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=1&amp;#93;&lt;/span&gt;-/192.168.4.1:52419:Leader@503] - Have quorum of supporters; starting up and setting last processed zxid: 399431958528&lt;/p&gt;

&lt;p&gt;This is where 55 and rest of the cluster will differ in their&lt;br/&gt;
states. Same zxid but different content.&lt;/p&gt;

&lt;p&gt;5) 55 reboots and rejoins the cluster. It tells 54 that it has&lt;br/&gt;
transaction 0x5D00000001 logged. 54 sends it a diff of transactions&lt;br/&gt;
starting from 0x5D00000002.&lt;/p&gt;

&lt;p&gt;We can see that from the following entry in 55&apos;s log:&lt;br/&gt;
2011-05-30 22:58:24.677 WARN - [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=2&amp;#93;&lt;/span&gt;/0:0:0:0:0:0:0:0:2181:Learner@341] - Got zxid 0x5d00000002 expected 0x1&lt;/p&gt;

&lt;p&gt;Thus, old transaction 0x5D00000001 remains in 55 logs. As a result,&lt;br/&gt;
the client connected to 55 sees different data.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I understand the fix proposed is to perform a null transaction after&lt;br/&gt;
leader election. I can work on it, but I am not sure why this is considered as a&lt;br/&gt;
complex fix. Mahadev mentioned earlier that the bug fix (for the&lt;br/&gt;
current ZAB version) will break backward compatibility. Can someone&lt;br/&gt;
explain why?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In the meantime, as a workaround, we are forcing our client to do a dummy transaction&lt;br/&gt;
after leader election. We have a few clients so I think this workaround&lt;br/&gt;
will work without much overhead.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Comments/suggestions?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13043114" author="breed" created="Thu, 2 Jun 2011 23:52:58 +0100"  >&lt;p&gt;yes this is the scenario that creates the issue. note that step 5 has to occur soon after step 4 otherwise 55 will get a state transfer rather than a diff and the problem will be fixed.&lt;/p&gt;

&lt;p&gt;the fix isn&apos;t really performing a null transaction. (it is a work around, but you also need to get the timing right.) the problem is actually two parts: 1) the new epoch isn&apos;t getting logged properly. 2) once we do log properly we also need to make sure that we distinguish epochs that we tried to join from epochs that we did join. see &lt;a href=&quot;https://cwiki.apache.org/confluence/display/ZOOKEEPER/Zab1.0&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://cwiki.apache.org/confluence/display/ZOOKEEPER/Zab1.0&lt;/a&gt; for the details.&lt;/p&gt;

&lt;p&gt;fixing it is rather easy, it is making sure that it is backwards compatible that is a bit tricky. i should have it done today hopefully. well at least a first cut. the problem is that method is rather complicated and adding in the backwards compatibility makes it more so. i&apos;m going to avoid refactoring for the first cut so that it is clear what i have modified. note that this affects both the leading code and the leader election code.&lt;/p&gt;</comment>
                            <comment id="13043152" author="fournc" created="Fri, 3 Jun 2011 01:15:55 +0100"  >&lt;p&gt;Was there an email or something about this? Could we get a summary of the current state of correctness vis a vis the existing implementation? It makes me a bit nervous seeing this come in seemingly out of the blue, considering the criticality of the production systems I&apos;m running on top of &quot;pre&quot;Zab1.0.&lt;/p&gt;</comment>
                            <comment id="13043164" author="vishalmlst" created="Fri, 3 Jun 2011 02:08:39 +0100"  >&lt;blockquote&gt;
&lt;p&gt;note that step 5 has to occur soon after step 4 otherwise 55 will get a state transfer rather than a diff and the problem will be fixed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, I realized that. In our case, the new leader is sending diffs to the faulty node.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;the fix isn&apos;t really performing a null transaction. (it is a work around, but you also need to get the timing right.)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It will be a workaround but it will be useful for pre zab 1.0 users. Why do you think we need to get the timing right? We just need to ensure that the leader performs the transaction before accepting any transactions from clients.&lt;/p&gt;

&lt;p&gt;Do you agree that my workaround from the client side will work? (another workaround is to always send SNAP instead of DIFF).&lt;/p&gt;</comment>
                            <comment id="13043171" author="vishalmlst" created="Fri, 3 Jun 2011 02:29:01 +0100"  >&lt;blockquote&gt;
&lt;p&gt;Was there an email or something about this?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;http://zookeeper-user.578899.n2.nabble.com/Divergence-in-ZK-transaction-logs-in-some-corner-cases-td2547596.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://zookeeper-user.578899.n2.nabble.com/Divergence-in-ZK-transaction-logs-in-some-corner-cases-td2547596.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13043176" author="fournc" created="Fri, 3 Jun 2011 02:47:21 +0100"  >&lt;p&gt;What year is it now...? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Would be nice if we got somewhat more regular pings about this stuff, for the newer joiners.&lt;/p&gt;</comment>
                            <comment id="13043311" author="breed" created="Fri, 3 Jun 2011 12:28:56 +0100"  >&lt;p&gt;vishal, i&apos;m not sure if i understand your proposal correctly. when i originally read it i thought you meant to have a client make sure to do an innocuous first transaction, but you would run into timing issues there because another client might be first.&lt;/p&gt;

&lt;p&gt;your comment got me thinking about another way, which you were probably proposing all along: if the leader issues the first innocuous transaction, and makes sure it is committed before it processes any more it might be easier than doing things at the quorum packet layer. i&apos;m going to see if i can map it to the flow in the tech report. it would help with the backwards compatibility.&lt;/p&gt;</comment>
                            <comment id="13043441" author="vishalmlst" created="Fri, 3 Jun 2011 17:17:43 +0100"  >&lt;blockquote&gt;
&lt;p&gt;vishal, i&apos;m not sure if i understand your proposal correctly. when i originally read it i thought you meant to have a client make sure to do an innocuous first transaction, but you would run into timing issues there because another client might be first.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You are right about the timing issue. To avoid another client from&lt;br/&gt;
doing a transaction I do the null transactions from all clients &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Not efficient, but avoids this race. However, while testing this&lt;br/&gt;
client side workaround I ran into another problem. Our application&lt;br/&gt;
uses watchdogs and reboots the machines when zookeeper is disconnect&lt;br/&gt;
for long periods of time. As a result, the client cannot guarantee&lt;br/&gt;
that the first transaction to be logged will be always the null&lt;br/&gt;
transaction. It could be a createSession. So two nodes can still have&lt;br/&gt;
log divergence. If a node misses createSession from its transaction&lt;br/&gt;
log, then it will not expire it. doh! should have realized this.  Now,&lt;br/&gt;
I can go a step ahead and make sure that the first session creation is&lt;br/&gt;
innocuous. This will work, but does not sound good. I will probably&lt;br/&gt;
give up on my idea for client side work around.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;your comment got me thinking about another way, which you were probably proposing all along: if the leader issues the first innocuous transaction, and makes sure it is committed before it processes any more it might be easier than doing things at the quorum packet layer. i&apos;m going to see if i can map it to the flow in the tech report. it would help with the backwards compatibility.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, that was what I was proposing (and hence confused about backward compatibility).&lt;/p&gt;</comment>
                            <comment id="13043888" author="breed" created="Fri, 3 Jun 2011 18:25:45 +0100"  >&lt;p&gt;are you able to reproduce the problem reliably? i think my test case does it, but i&apos;m curious if it fixes your problem.&lt;/p&gt;</comment>
                            <comment id="13043926" author="vishalmlst" created="Fri, 3 Jun 2011 19:10:46 +0100"  >&lt;p&gt;I am able to repro the bug reliably.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;but i&apos;m curious if it fixes your problem.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;What are you referring to? The client side does fix the problem for us, but it is a bit ugly fix.&lt;/p&gt;</comment>
                            <comment id="13045293" author="breed" created="Tue, 7 Jun 2011 07:48:07 +0100"  >&lt;p&gt;fixed the FLE tests.&lt;/p&gt;

&lt;p&gt;right now the hierarchal quorum tests are failing. flavio can you see if you notice anything?&lt;/p&gt;</comment>
                            <comment id="13045412" author="vishalmlst" created="Tue, 7 Jun 2011 14:17:53 +0100"  >&lt;p&gt;Hi Ben, Flavio,&lt;/p&gt;

&lt;p&gt;Thanks. We will try out the patch.&lt;/p&gt;

&lt;p&gt;For the record, after some more discussion with Ben I realized that none of the workarounds that I was trying would work. Fixing this bug would need change in the protocol. Thanks for the clarification..&lt;/p&gt;</comment>
                            <comment id="13045579" author="breed" created="Tue, 7 Jun 2011 19:32:00 +0100"  >&lt;p&gt;this has a small fix in it. still working on two more tests that aren&apos;t passing. i think it might be a problem in the tests.&lt;/p&gt;</comment>
                            <comment id="13045715" author="breed" created="Wed, 8 Jun 2011 01:13:36 +0100"  >&lt;p&gt;i think this is it. after i make sure the tests pass. i&apos;ll upload it to review.apache.org.&lt;/p&gt;

&lt;p&gt;vishal and flavio can you check it out?&lt;/p&gt;</comment>
                            <comment id="13045727" author="hadoopqa" created="Wed, 8 Jun 2011 01:46:59 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12481761/ZOOKEEPER-335_4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12481761/ZOOKEEPER-335_4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1132489.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 13 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/308//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/308//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/308//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/308//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/308//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/308//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13046049" author="phunt" created="Wed, 8 Jun 2011 17:23:19 +0100"  >&lt;p&gt;Findbugs has a single issue that needs to be addressed:&lt;/p&gt;

&lt;p&gt;HE_EQUALS_USE_HASHCODE: Class defines equals() and uses Object.hashCode()&lt;/p&gt;</comment>
                            <comment id="13046887" author="breed" created="Thu, 9 Jun 2011 23:48:42 +0100"  >&lt;p&gt;addressed flavio&apos;s review and the findbug issue.&lt;/p&gt;</comment>
                            <comment id="13046888" author="jiraposter@reviews.apache.org" created="Thu, 9 Jun 2011 23:48:59 +0100"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/877/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/877/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for fpj and Vishal Kher.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;zookeeper servers should commit the new leader txn to their logs.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-335&quot; title=&quot;zookeeper servers should commit the new leader txn to their logs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-335&quot;&gt;&lt;del&gt;ZOOKEEPER-335&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-335&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-335&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  &lt;a href=&quot;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/ZooKeeperServer.java&lt;/a&gt; 1134016 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/FastLeaderElection.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/FastLeaderElection.java&lt;/a&gt; 1134016 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Follower.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Follower.java&lt;/a&gt; 1134016 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Leader.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Leader.java&lt;/a&gt; 1134016 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Learner.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Learner.java&lt;/a&gt; 1134016 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/LearnerHandler.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/LearnerHandler.java&lt;/a&gt; 1134016 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java&lt;/a&gt; 1134016 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/StateSummary.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/StateSummary.java&lt;/a&gt; PRE-CREATION &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Vote.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Vote.java&lt;/a&gt; 1134016 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/util/ZxidUtils.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/util/ZxidUtils.java&lt;/a&gt; PRE-CREATION &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerMainTest.java&lt;/a&gt; 1134016 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerTestBase.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerTestBase.java&lt;/a&gt; 1134016 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/ClientBase.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/ClientBase.java&lt;/a&gt; 1134016 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/ReadOnlyModeTest.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/ReadOnlyModeTest.java&lt;/a&gt; 1134016 &lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/zookeeper/trunk/src/zookeeper.jute&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/zookeeper/trunk/src/zookeeper.jute&lt;/a&gt; 1134016 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/877/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/877/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Benjamin&lt;/p&gt;
</comment>
                            <comment id="13046913" author="hadoopqa" created="Fri, 10 Jun 2011 00:17:26 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12481990/ZOOKEEPER-335_5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12481990/ZOOKEEPER-335_5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1132489.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 13 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/311//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/311//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/311//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/311//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/311//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/311//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13048665" author="fpj" created="Mon, 13 Jun 2011 18:26:32 +0100"  >&lt;p&gt;+1, I have reviewed the patch twice and I don&apos;t have further issues. Also, I believe the patch I provided in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1082&quot; title=&quot;modify leader election to correctly take into account current epoch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1082&quot;&gt;&lt;del&gt;ZOOKEEPER-1082&lt;/del&gt;&lt;/a&gt; has been correctly incorporated.&lt;/p&gt;</comment>
                            <comment id="13048910" author="breed" created="Tue, 14 Jun 2011 01:06:57 +0100"  >&lt;p&gt;ok if there are no objections, i&apos;d like to get this in tonight. i plan on just applying to trunk since the change is rather deep. given that we have never seen this bug in production it&apos;s probably better to not risk the stable branch.&lt;/p&gt;</comment>
                            <comment id="13048981" author="breed" created="Tue, 14 Jun 2011 06:14:31 +0100"  >&lt;p&gt;Committed revision 1135382. &lt;/p&gt;</comment>
                            <comment id="13050966" author="hudson" created="Fri, 17 Jun 2011 11:57:10 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #1215 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/1215/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/1215/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12467595">ZOOKEEPER-790</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12529897">ZOOKEEPER-1278</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12481665" name="ZOOKEEPER-335.patch" size="56053" author="breed" created="Tue, 7 Jun 2011 06:47:48 +0100"/>
                            <attachment id="12481666" name="ZOOKEEPER-335_2.patch" size="57022" author="breed" created="Tue, 7 Jun 2011 07:48:07 +0100"/>
                            <attachment id="12481730" name="ZOOKEEPER-335_3.patch" size="58993" author="breed" created="Tue, 7 Jun 2011 19:32:00 +0100"/>
                            <attachment id="12481761" name="ZOOKEEPER-335_4.patch" size="59649" author="breed" created="Wed, 8 Jun 2011 01:13:36 +0100"/>
                            <attachment id="12481990" name="ZOOKEEPER-335_5.patch" size="59469" author="breed" created="Thu, 9 Jun 2011 23:48:42 +0100"/>
                            <attachment id="12449532" name="ZOOKEEPER-790.travis.log.bz2" size="44747" author="traviscrawford" created="Thu, 15 Jul 2010 04:24:55 +0100"/>
                            <attachment id="12447658" name="faultynode-vishal.txt" size="116726" author="vishalmlst" created="Tue, 22 Jun 2010 04:03:07 +0100"/>
                            <attachment id="12447392" name="zk.log.gz" size="5061" author="msolo" created="Thu, 17 Jun 2010 23:16:27 +0100"/>
                            <attachment id="12447490" name="zklogs.tar.gz" size="76728" author="vishalmlst" created="Fri, 18 Jun 2010 21:06:50 +0100"/>
                    </attachments>
                <subtasks>
                            <subtask id="12508720">ZOOKEEPER-1081</subtask>
                            <subtask id="12508721">ZOOKEEPER-1082</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 2 Jun 2010 18:45:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47894</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzvqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33127</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>