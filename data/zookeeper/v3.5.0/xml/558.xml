<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:41:59 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-558/ZOOKEEPER-558.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-558] server &quot;sent&quot; stats not being updated</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-558</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;the server and connection &quot;sent&quot; stat is not being updated. if you run &quot;stat&quot; on the client port the sent packets is much lower than it should be&lt;/p&gt;

&lt;p&gt;seems that sendbuffer is not updating the stats when it shortcircuits the send.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12439021">ZOOKEEPER-558</key>
            <summary>server &quot;sent&quot; stats not being updated</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="phunt">Patrick Hunt</assignee>
                                    <reporter username="phunt">Patrick Hunt</reporter>
                        <labels>
                    </labels>
                <created>Sun, 25 Oct 2009 01:08:18 +0100</created>
                <updated>Fri, 26 Mar 2010 17:25:02 +0000</updated>
                            <resolved>Sat, 7 Nov 2009 00:48:26 +0000</resolved>
                                    <version>3.2.1</version>
                                    <fixVersion>3.3.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12771468" author="phunt" created="Thu, 29 Oct 2009 16:39:38 +0000"  >&lt;p&gt;looks like this may be more serious, afaict some sendbuffer(closeconn) will (may) be ignored. not sure this was thought out when the short-circuit optimization was made. esp around four letter words.&lt;/p&gt;</comment>
                            <comment id="12772771" author="phunt" created="Mon, 2 Nov 2009 23:58:19 +0000"  >&lt;p&gt;This patch addresses the sent count issue (counter update was missing), additionally I addressed a number&lt;br/&gt;
of session establishment/teardown issues that I found while fixing this:&lt;/p&gt;

&lt;p&gt;1) better logging of session est/teardown, much of this was based on user feedback such as &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-565&quot; title=&quot;Revisit some java client log messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-565&quot;&gt;&lt;del&gt;ZOOKEEPER-565&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-564&quot; title=&quot;Give more feedback on that current flow of events in java client logs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-564&quot;&gt;&lt;del&gt;ZOOKEEPER-564&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
Much of this was cleaning up the log text and using common terminology for the messages themselves&lt;br/&gt;
1.1) some of 1) required better error handling. A lot of the changed code was throwing general IOExceptions, rather than throwing&lt;br/&gt;
more specific exceptions allowing higher layer code to properly report the issue.&lt;br/&gt;
2) while closing a client connection the connection close response was not always sent to the client&lt;br/&gt;
3) in some cases the server would not close the connection (closeconn buffer was not being queued) properly. this would happen anyway when the client closed the connection, but the server should do the right thing regardless&lt;/p&gt;

&lt;p&gt;4) calling close more than once just returns after the first call&lt;br/&gt;
5) added testableWaitForShutdown to ZooKeeper to allow tests to validate that the client has shutdown all threads&lt;br/&gt;
(this is test only)&lt;/p&gt;

&lt;p&gt;6) reading a client sockets now reads the entire request in one shot if possible. previously we would re-poll the&lt;br/&gt;
selector after reading the length header.&lt;/p&gt;
</comment>
                            <comment id="12772814" author="hadoopqa" created="Tue, 3 Nov 2009 01:11:41 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12423863/ZOOKEEPER-558.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12423863/ZOOKEEPER-558.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 831486.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 15 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 1 new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/45/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/45/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/45/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/45/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/45/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/45/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12773092" author="phunt" created="Tue, 3 Nov 2009 18:14:03 +0000"  >&lt;p&gt;Same as last patch except cleared up the findbugs issue.&lt;/p&gt;</comment>
                            <comment id="12773102" author="hadoopqa" created="Tue, 3 Nov 2009 18:34:39 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12423930/ZOOKEEPER-558.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12423930/ZOOKEEPER-558.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 831486.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 15 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/46/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/46/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/46/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/46/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/46/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/46/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12773268" author="mahadev" created="Tue, 3 Nov 2009 23:06:22 +0000"  >&lt;p&gt;was looking at the patch.&lt;/p&gt;

&lt;p&gt;any reason to add &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; serialVersionUID

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;in the new exceptions? The exceptions are IOException and serializing and deserializing them as IOException serialversion should be fine. no? &lt;/p&gt;</comment>
                            <comment id="12773277" author="phunt" created="Tue, 3 Nov 2009 23:25:42 +0000"  >&lt;p&gt;eclipse warns otw if you don&apos;t have the uid. no other reason&lt;/p&gt;</comment>
                            <comment id="12774473" author="henryr" created="Fri, 6 Nov 2009 22:57:48 +0000"  >&lt;p&gt;Big +1 on this patch from me; a bunch of very necessary refactorings as well the bug fix.  Couple of tiny nits&lt;/p&gt;

&lt;p&gt;{{+                        // this is ugly, you have a better way speak up&lt;br/&gt;
+                        if (e instanceof SessionExpiredException) &lt;/p&gt;
{
+                            LOG.info(e.getMessage() + &quot;, closing socket connection&quot;);
+                        }
&lt;p&gt; else if (e instanceof SessionTimeoutException) &lt;/p&gt;
{
+                            LOG.info(e.getMessage() + RETRY_CONN_MSG);
+                        } else if (e instanceof EndOfStreamException) {
+                            LOG.info(e.getMessage() + RETRY_CONN_MSG);
+                        }
&lt;p&gt; else &lt;/p&gt;
{
+                            LOG.warn(&quot;Session 0x&quot;
+                                    + Long.toHexString(getSessionId())
+                                    + &quot; for server &quot;
+                                    + ((SocketChannel)sockKey.channel())
+                                        .socket().getRemoteSocketAddress()
+                                    + &quot;, unexpected error&quot;
+                                    + RETRY_CONN_MSG,
+                                    e);
+                        }
&lt;p&gt;}}&lt;/p&gt;

&lt;p&gt;Is the better way to have catch clauses for each exception type?.&lt;/p&gt;

&lt;p&gt;{{+                try &lt;/p&gt;
{
+                    sock.write(bb);
+                }
&lt;p&gt; catch (IOException e) &lt;/p&gt;
{
+                    // we are just doing best effort right now
+                }
&lt;p&gt;}}&lt;/p&gt;

&lt;p&gt;Debug message here?&lt;/p&gt;</comment>
                            <comment id="12774510" author="phunt" created="Sat, 7 Nov 2009 00:38:30 +0000"  >&lt;p&gt;The idea with catching Exception (current code before/after patch) is to warn if &lt;br/&gt;
something unexpected happens (esp so that we&apos;ll know about&lt;br/&gt;
it and have a chance to fix). Except in the case where we are closing the &lt;br/&gt;
connection. All kinds of weird errors could be thrown (not just by write afaict) &lt;br/&gt;
and we don&apos;t want to bother the user with that, at least not at warn level during close.&lt;br/&gt;
I don&apos;t think there&apos;s one or two of these potential sites, afaict that&apos;s why the code&lt;br/&gt;
had this originally (a big net).&lt;/p&gt;

&lt;p&gt;That&apos;s the theory at least behind the refactorings in the patch...&lt;/p&gt;

&lt;p&gt;I&apos;d like this to go through unless you have something concrete in mind - I&apos;d be happy&lt;br/&gt;
to explore further as additional JIRAs for example. (if you feel strongly to wait&lt;br/&gt;
then we could do that too)&lt;/p&gt;</comment>
                            <comment id="12774512" author="breed" created="Sat, 7 Nov 2009 00:48:26 +0000"  >&lt;p&gt;Committed revision 833620.&lt;/p&gt;</comment>
                            <comment id="12774519" author="breed" created="Sat, 7 Nov 2009 00:58:19 +0000"  >&lt;p&gt;i agree, breaking down the reasons behind the IOException is great! sorry i didn&apos;t see your comment before committing henry. i couldn&apos;t think of a nicer way to do the if conditions, but it would be cool to come up with one.&lt;/p&gt;</comment>
                            <comment id="12774522" author="henryr" created="Sat, 7 Nov 2009 01:08:03 +0000"  >&lt;p&gt;No problem - like I say those were tiny issues and shouldn&apos;t have stopped the patch being committed. &lt;/p&gt;

&lt;p&gt;I understand about catching Exception; I was just wondering why we couldn&apos;t do &lt;/p&gt;

&lt;p&gt;catch (IOException e) &lt;/p&gt;
{ ... } &lt;br/&gt;
catch (SessionExpireException e) { ... }
&lt;p&gt;catch (Exception e) &lt;/p&gt;
{ ... }

&lt;p&gt;rather than the explicit instanceof checks? I feel like I&apos;m probably missing something subtle here, and it&apos;s moot anyhow since the patch went in &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12774554" author="phunt" created="Sat, 7 Nov 2009 04:51:02 +0000"  >&lt;p&gt;I&apos;m probably snow blind from looking at it too long.&lt;/p&gt;

&lt;p&gt;Henry, easiest way for you to explain it is to create a jira and attach a patch. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; This is just&lt;br/&gt;
a small step, still lots of opportunity for improving the user experience in particular.&lt;/p&gt;</comment>
                            <comment id="12774727" author="hudson" created="Sun, 8 Nov 2009 05:19:57 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #522 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/522/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/522/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12439089">ZOOKEEPER-560</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12439330">ZOOKEEPER-564</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12439332">ZOOKEEPER-565</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12423930" name="ZOOKEEPER-558.patch" size="71513" author="phunt" created="Tue, 3 Nov 2009 18:14:03 +0000"/>
                            <attachment id="12423863" name="ZOOKEEPER-558.patch" size="71105" author="phunt" created="Mon, 2 Nov 2009 23:58:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 3 Nov 2009 01:11:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47733</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzuz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33002</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>