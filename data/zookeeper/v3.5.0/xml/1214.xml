<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:47:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1214/ZOOKEEPER-1214.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1214] QuorumPeer should unregister only its previsously registered MBeans instead of use MBeanRegistry.unregisterAll() method.</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1214</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;When a QuorumPeer thread dies, it is unregistering &lt;b&gt;all&lt;/b&gt; ZKMBeanInfo MBeans previously registered on its java process; including those that has not been registered by itself.&lt;/p&gt;

&lt;p&gt;It does not cause any side effect in production environment where each server is running on a separate java process; but fails when using &quot;org.apache.zookeeper.test.QuorumUtil&quot; to programmatically start up a zookeeper server ensemble and use its provided methods to force Disconnected, SyncConnected or SessionExpired events; in order to perform some basic/functional testing.&lt;/p&gt;

&lt;p&gt;Scenario:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;QuorumUtil qU = new QuorumUtil(1); // It creates a 3 servers ensemble.&lt;/li&gt;
	&lt;li&gt;qU.startAll(); // Startup all servers: 1 Leader + 2 Followers&lt;/li&gt;
	&lt;li&gt;qU.shutdown&amp;#40;i&amp;#41;; // i is a number from 1 to 3. It shutdown one server.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The last method causes that a QuorumPeer will die, invoking the MBeanRegistry.unregisterAll() method.&lt;br/&gt;
As a result, &lt;b&gt;all&lt;/b&gt; ZKMBeanInfo MBeans are unregistered; including those belonging to the other QuorumPeer instances.&lt;/p&gt;

&lt;p&gt;When trying to restart previous server (qU.restart&amp;#40;i&amp;#41;) an AssertionError is thrown at MBeanRegistry.register(ZKMBeanInfo bean, ZKMBeanInfo parent) method, causing the QuorumPeer thread dead.&lt;/p&gt;

&lt;p&gt;To solve it:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;MBeanRegistry.unregisterAll() method has been removed.&lt;/li&gt;
	&lt;li&gt;QuorumPeer only unregister its ZKMBeanInfo MBeans.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12525784">ZOOKEEPER-1214</key>
            <summary>QuorumPeer should unregister only its previsously registered MBeans instead of use MBeanRegistry.unregisterAll() method.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="calvarez">C&#233;sar &#193;lvarez N&#250;&#241;ez</assignee>
                                    <reporter username="calvarez">C&#233;sar &#193;lvarez N&#250;&#241;ez</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Oct 2011 10:56:36 +0100</created>
                <updated>Tue, 20 May 2014 12:09:12 +0100</updated>
                            <resolved>Sun, 18 May 2014 04:49:28 +0100</resolved>
                                                    <fixVersion>3.5.0</fixVersion>
                                    <component>quorum</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13120786" author="hadoopqa" created="Wed, 5 Oct 2011 11:02:35 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12497775/ZOOKEEPER-1214.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12497775/ZOOKEEPER-1214.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1177432.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/603//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/603//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13120840" author="calvarez" created="Wed, 5 Oct 2011 12:30:07 +0100"  >&lt;p&gt;Refreshed trunk.&lt;br/&gt;
Regenerated patch.&lt;/p&gt;</comment>
                            <comment id="13120850" author="hadoopqa" created="Wed, 5 Oct 2011 12:54:09 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12497782/ZOOKEEPER-1214.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12497782/ZOOKEEPER-1214.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1177432.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/605//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/605//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/605//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/605//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/605//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/605//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13120860" author="jiraposter@reviews.apache.org" created="Wed, 5 Oct 2011 12:59:34 +0100"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2208/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for zookeeper.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&quot; title=&quot;QuorumPeer should unregister only its previsously registered MBeans instead of use MBeanRegistry.unregisterAll() method.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1214&quot;&gt;&lt;del&gt;ZOOKEEPER-1214&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  /src/java/test/org/apache/zookeeper/test/QuorumUtil.java 1179165 &lt;br/&gt;
  /src/java/test/org/apache/zookeeper/test/QuorumUtilTest.java PRE-CREATION &lt;br/&gt;
  /src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java 1179166 &lt;br/&gt;
  /src/java/main/org/apache/zookeeper/jmx/MBeanRegistry.java 1169669 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2208/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;-&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;C&#233;sar&lt;/p&gt;
</comment>
                            <comment id="13169809" author="phunt" created="Wed, 14 Dec 2011 23:36:42 +0000"  >&lt;p&gt;I updated the RB review with some f/b that needs to be incorporated before this can be committed.&lt;/p&gt;</comment>
                            <comment id="13169811" author="jiraposter@reviews.apache.org" created="Wed, 14 Dec 2011 23:37:30 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2208/#review3914&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/#review3914&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;a good cleanup, some comments before we can commit it.&lt;/p&gt;


&lt;p&gt;/src/java/main/org/apache/zookeeper/jmx/MBeanRegistry.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2208/#comment8794&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/#comment8794&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    cleanup this typo (2 returns)&lt;/p&gt;



&lt;p&gt;/src/java/main/org/apache/zookeeper/jmx/MBeanRegistry.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2208/#comment8793&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/#comment8793&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    let&apos;s call this &lt;/p&gt;

&lt;p&gt;    getRegisteredBeans()&lt;/p&gt;




&lt;p&gt;/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2208/#comment8795&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/#comment8795&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Add back the try/catch protection. This was necessary in some cases (I can&apos;t remember why off the top of my head though).&lt;/p&gt;



&lt;p&gt;/src/java/test/org/apache/zookeeper/test/QuorumUtilTest.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2208/#comment8796&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/#comment8796&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    license header is missing. add the std boilerplate found on any other java file in the project.&lt;/p&gt;



&lt;p&gt;/src/java/test/org/apache/zookeeper/test/QuorumUtilTest.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2208/#comment8798&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/#comment8798&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    add a comment to the class describing what this set of tests is for&lt;/p&gt;



&lt;p&gt;/src/java/test/org/apache/zookeeper/test/QuorumUtilTest.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2208/#comment8797&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/#comment8797&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    no tabs, reformat with spaces only. (you&apos;ll probably need to cleanup some of your other changes at the same time)&lt;/p&gt;



&lt;p&gt;/src/java/test/org/apache/zookeeper/test/QuorumUtilTest.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2208/#comment8799&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/#comment8799&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    it&apos;s fine to ref a jira here, however there should also be some details on what this test is doing. (short summary esp as the test itself is pretty clear)&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Patrick&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-10-05 11:59:30, C&#233;sar &#193;lvarez N&#250;&#241;ez wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2208/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-10-05 11:59:30)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&quot; title=&quot;QuorumPeer should unregister only its previsously registered MBeans instead of use MBeanRegistry.unregisterAll() method.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1214&quot;&gt;&lt;del&gt;ZOOKEEPER-1214&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/java/test/org/apache/zookeeper/test/QuorumUtil.java 1179165 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/java/test/org/apache/zookeeper/test/QuorumUtilTest.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java 1179166 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/java/main/org/apache/zookeeper/jmx/MBeanRegistry.java 1169669 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2208/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;C&#233;sar&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13180498" author="calvarez" created="Thu, 5 Jan 2012 16:17:39 +0000"  >&lt;p&gt;Patch updated due to review feedback.&lt;/p&gt;</comment>
                            <comment id="13180512" author="jiraposter@reviews.apache.org" created="Thu, 5 Jan 2012 16:39:39 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-12-14 23:36:06, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; /src/java/main/org/apache/zookeeper/jmx/MBeanRegistry.java, lines 126-127&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2208/diff/1/?file=48123#file48123line126&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/diff/1/?file=48123#file48123line126&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     cleanup this typo (2 returns)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-12-14 23:36:06, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; /src/java/main/org/apache/zookeeper/jmx/MBeanRegistry.java, line 130&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2208/diff/1/?file=48123#file48123line130&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/diff/1/?file=48123#file48123line130&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     let&apos;s call this &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     getRegisteredBeans()&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-12-14 23:36:06, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; /src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java, lines 757-767&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2208/diff/1/?file=48124#file48124line757&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/diff/1/?file=48124#file48124line757&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Add back the try/catch protection. This was necessary in some cases (I can&apos;t remember why off the top of my head though).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ve enhanced the exception handling during &quot;public void unregister(ZKMBeanInfo bean)&quot; method invocation since JMException was caught and logged two times: 1) private void unregister(String path,ZKMBeanInfo bean) throws JMException, 2) public void unregister(ZKMBeanInfo bean).&lt;/p&gt;

&lt;p&gt;I&apos;ve also added a &quot;catch(Throwable t)&quot; to &quot;public void unregister(ZKMBeanInfo bean)&quot; method that will generate an error log instead of a warn. &lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-12-14 23:36:06, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; /src/java/test/org/apache/zookeeper/test/QuorumUtilTest.java, line 1&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2208/diff/1/?file=48126#file48126line1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/diff/1/?file=48126#file48126line1&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     license header is missing. add the std boilerplate found on any other java file in the project.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;As you can see I&apos;m a newbie contributor &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-12-14 23:36:06, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; /src/java/test/org/apache/zookeeper/test/QuorumUtilTest.java, line 15&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2208/diff/1/?file=48126#file48126line15&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/diff/1/?file=48126#file48126line15&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     add a comment to the class describing what this set of tests is for&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-12-14 23:36:06, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; /src/java/test/org/apache/zookeeper/test/QuorumUtilTest.java, line 16&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2208/diff/1/?file=48126#file48126line16&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/diff/1/?file=48126#file48126line16&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     no tabs, reformat with spaces only. (you&apos;ll probably need to cleanup some of your other changes at the same time)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done. It would be nice that the eclipse ant task will create the .setting files to set all formatting rules and useful save actions (like apply formatting). I&apos;ll investigate it and upload as a new jira if success.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-12-14 23:36:06, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; /src/java/test/org/apache/zookeeper/test/QuorumUtilTest.java, line 19&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2208/diff/1/?file=48126#file48126line19&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/diff/1/?file=48126#file48126line19&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     it&apos;s fine to ref a jira here, however there should also be some details on what this test is doing. (short summary esp as the test itself is pretty clear)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;C&#233;sar&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2208/#review3914&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/#review3914&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-10-05 11:59:30, C&#233;sar &#193;lvarez N&#250;&#241;ez wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2208/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-10-05 11:59:30)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&quot; title=&quot;QuorumPeer should unregister only its previsously registered MBeans instead of use MBeanRegistry.unregisterAll() method.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1214&quot;&gt;&lt;del&gt;ZOOKEEPER-1214&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/java/test/org/apache/zookeeper/test/QuorumUtil.java 1179165 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/java/test/org/apache/zookeeper/test/QuorumUtilTest.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java 1179166 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/java/main/org/apache/zookeeper/jmx/MBeanRegistry.java 1169669 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2208/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;C&#233;sar&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13180514" author="hadoopqa" created="Thu, 5 Jan 2012 16:45:30 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12509566/ZOOKEEPER-1214.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12509566/ZOOKEEPER-1214.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1227000.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/879//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/879//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/879//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/879//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/879//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/879//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13181017" author="phunt" created="Fri, 6 Jan 2012 01:11:49 +0000"  >&lt;p&gt;Can you update the diff on RB, re-submit, and I&apos;ll take another look? Thanks.&lt;/p&gt;</comment>
                            <comment id="13185558" author="jiraposter@reviews.apache.org" created="Fri, 13 Jan 2012 12:12:39 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2208/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2012-01-13 12:10:38.234750)&lt;/p&gt;


&lt;p&gt;Review request for zookeeper.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&quot; title=&quot;QuorumPeer should unregister only its previsously registered MBeans instead of use MBeanRegistry.unregisterAll() method.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1214&quot;&gt;&lt;del&gt;ZOOKEEPER-1214&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  /src/java/main/org/apache/zookeeper/jmx/MBeanRegistry.java 1226094 &lt;br/&gt;
  /src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java 1226094 &lt;br/&gt;
  /src/java/test/org/apache/zookeeper/test/QuorumUtil.java 1226094 &lt;br/&gt;
  /src/java/test/org/apache/zookeeper/test/QuorumUtilTest.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2208/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2208/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;-&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;C&#233;sar&lt;/p&gt;
</comment>
                            <comment id="13434479" author="michim" created="Tue, 14 Aug 2012 21:32:01 +0100"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Pat, could you take a look at the updated patch? If it looks ok to you, I&apos;ll go ahead and check this patch in.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;br/&gt;
--Michi&lt;/p&gt;</comment>
                            <comment id="13494297" author="michim" created="Fri, 9 Nov 2012 20:43:22 +0000"  >&lt;p&gt;Ping!&lt;/p&gt;

&lt;p&gt;--Michi&lt;/p&gt;</comment>
                            <comment id="13571756" author="michim" created="Tue, 5 Feb 2013 21:39:31 +0000"  >&lt;p&gt;I saw this error in 3.4.5 with &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&quot; title=&quot;QuorumPeer should unregister only its previsously registered MBeans instead of use MBeanRegistry.unregisterAll() method.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1214&quot;&gt;&lt;del&gt;ZOOKEEPER-1214&lt;/del&gt;&lt;/a&gt;.patch applied. &lt;/p&gt;

&lt;p&gt;2013-02-04 03:42:39,682 503835 &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-6&amp;#93;&lt;/span&gt; INFO org.apache.zookeeper.jmx.MBeanRegistry  - Unregister MBean &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.ZooKeeperService:name0=ReplicatedServer_id0,name1=replica.0,name2=Follower,name3=Connections,name4=127.0.0.1,name5=0x13ca4fc35c40001&amp;#93;&lt;/span&gt;&lt;br/&gt;
2013-02-04 03:42:39,683 503836 [QuorumPeer&lt;span class=&quot;error&quot;&gt;&amp;#91;myid=0&amp;#93;&lt;/span&gt;/127.0.0.1:2901] ERROR org.apache.zookeeper.jmx.MBeanRegistry  - Unexpected exception during unregister of &lt;span class=&quot;error&quot;&gt;&amp;#91;Follower&amp;#93;&lt;/span&gt;. It should be reviewed and fixed.&lt;br/&gt;
java.lang.IllegalMonitorStateException&lt;br/&gt;
        at java.util.concurrent.locks.ReentrantReadWriteLock$Sync.tryReleaseShared(ReentrantReadWriteLock.java:398)&lt;br/&gt;
        at java.util.concurrent.locks.AbstractQueuedSynchronizer.releaseShared(AbstractQueuedSynchronizer.java:1340)&lt;br/&gt;
        at java.util.concurrent.locks.ReentrantReadWriteLock$ReadLock.unlock(ReentrantReadWriteLock.java:778)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.Repository.retrieve(Repository.java:522)&lt;br/&gt;
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getMBean(DefaultMBeanServerInterceptor.java:1111)&lt;br/&gt;
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.exclusiveUnregisterMBean(DefaultMBeanServerInterceptor.java:433)&lt;br/&gt;
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.unregisterMBean(DefaultMBeanServerInterceptor.java:421)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.JmxMBeanServer.unregisterMBean(JmxMBeanServer.java:540)&lt;br/&gt;
        at org.apache.zookeeper.jmx.MBeanRegistry.unregister(MBeanRegistry.java:116)&lt;br/&gt;
        at org.apache.zookeeper.jmx.MBeanRegistry.unregister(MBeanRegistry.java:137)&lt;br/&gt;
        at org.apache.zookeeper.server.quorum.LearnerZooKeeperServer.unregisterJMX(LearnerZooKeeperServer.java:138)&lt;br/&gt;
        at org.apache.zookeeper.server.quorum.Follower.followLeader(Follower.java:100)&lt;br/&gt;
        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:745)&lt;/p&gt;

&lt;p&gt;I&apos;m using openjdk-6-jre-6b24-1.11.3-1ubuntu0.12.04.1. Should I use sun-java6-jre instead?&lt;/p&gt;

&lt;p&gt;--Michi&lt;/p&gt;</comment>
                            <comment id="13572143" author="eribeiro" created="Wed, 6 Feb 2013 04:33:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Hi Michi,&lt;/p&gt;

&lt;p&gt;My two cents: this looks like a bug in ReentrantReadWriteLock, the JVM, or even an incorrect use of &lt;em&gt;ReentrantReadWriteLock&lt;/em&gt; by JmxMBeanServer. I say so because a quick Google search shows that other projects that use ReentrantReadWriteLock, &lt;b&gt;directly or not&lt;/b&gt;, as HBase, Netbeans and Maven have hit this very same exception.&lt;/p&gt;

&lt;p&gt;As ZooKeeper uses &lt;em&gt;ReentrantReadWriteLock&lt;/em&gt; indirectly through JmxMBeanServer, a possible solution seems to be to create a lock object and synchronize lines 98 and 117 of JmxMBeanServer as follows:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;JmxMBeanServer.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; LOCK = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;();
...
&lt;span class=&quot;code-comment&quot;&gt;// line 98 becomes
&lt;/span&gt;  synchronize (LOCK) {
     mBeanServer.registerMBean(bean, oname);            
  }
&lt;span class=&quot;code-comment&quot;&gt;// line 117 becomes
&lt;/span&gt;  synchronize (LOCK) {
     mBeanServer.unregisterMBean(makeObjectName(path, bean));
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As this is a issue addressed to Cesar I&apos;ll not submit a patch, but I may provide you a patch by email to see if this  solution works.&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Edward&lt;/p&gt;</comment>
                            <comment id="13572190" author="eribeiro" created="Wed, 6 Feb 2013 05:25:38 +0000"  >&lt;p&gt;Ummm ... as this issue last patch is +1 year old &amp;#8211; and I made a silly mistake during my previous explanation (sorry, it&apos;s &lt;em&gt;synchronized&lt;/em&gt; keyword  instead of &lt;em&gt;synchronize&lt;/em&gt;) &amp;#8211; then I  decided to submit a new version of Cesar&apos;s patch that applies against the trunk and implements the &lt;em&gt;possible&lt;/em&gt; solution I&apos;ve just proposed. It still Cesar&apos;s patch tough. See if it helps. &lt;/p&gt;</comment>
                            <comment id="13572882" author="michim" created="Wed, 6 Feb 2013 21:52:49 +0000"  >&lt;p&gt;Thank you for the patch, Edward.&lt;/p&gt;

&lt;p&gt;This patch looks good to me. I&apos;d like to check it in if nobody is against it.&lt;/p&gt;

&lt;p&gt;--Michi&lt;/p&gt;</comment>
                            <comment id="13573256" author="eribeiro" created="Thu, 7 Feb 2013 07:09:19 +0000"  >&lt;p&gt;Thanks for the feedback Michi, it&apos;s highly appreciated. I am sending a new version with an one line change wrt the previous one.&lt;/p&gt;</comment>
                            <comment id="13986100" author="michim" created="Wed, 30 Apr 2014 22:15:21 +0100"  >&lt;p&gt;Sorry I forgot about this patch. I&apos;ll rebase it and check it in.&lt;/p&gt;</comment>
                            <comment id="13986152" author="hadoopqa" created="Wed, 30 Apr 2014 23:07:39 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12642729/ZOOKEEPER-1214.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12642729/ZOOKEEPER-1214.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1591175.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2070//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2070//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2070//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2070//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2070//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2070//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14000965" author="hadoopqa" created="Sun, 18 May 2014 04:26:08 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12642729/ZOOKEEPER-1214.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12642729/ZOOKEEPER-1214.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1595559.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2101//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2101//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2101//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2101//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2101//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2101//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14000983" author="michim" created="Sun, 18 May 2014 04:49:28 +0100"  >&lt;p&gt;trunk: &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1595561&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1595561&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14003086" author="hudson" created="Tue, 20 May 2014 12:09:12 +0100"  >&lt;p&gt;FAILURE: Integrated in ZooKeeper-trunk #2311 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2311/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2311/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1214&quot; title=&quot;QuorumPeer should unregister only its previsously registered MBeans instead of use MBeanRegistry.unregisterAll() method.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1214&quot;&gt;&lt;del&gt;ZOOKEEPER-1214&lt;/del&gt;&lt;/a&gt;. QuorumPeer should unregister only its previsously registered MBeans instead of use MBeanRegistry.unregisterAll() method. (C&#233;sar &#193;lvarez N&#250;&#241;ez via michim) (michim: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1595561&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1595561&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/jmx/MBeanRegistry.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/QuorumUtil.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/QuorumUtilTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12568167" name="ZOOKEEPER-1214.2.patch" size="11032" author="eribeiro" created="Wed, 6 Feb 2013 05:25:38 +0000"/>
                            <attachment id="12568375" name="ZOOKEEPER-1214.3.patch" size="11086" author="eribeiro" created="Thu, 7 Feb 2013 07:09:19 +0000"/>
                            <attachment id="12642729" name="ZOOKEEPER-1214.patch" size="10938" author="michim" created="Wed, 30 Apr 2014 22:24:59 +0100"/>
                            <attachment id="12509566" name="ZOOKEEPER-1214.patch" size="10633" author="calvarez" created="Thu, 5 Jan 2012 16:14:32 +0000"/>
                            <attachment id="12497782" name="ZOOKEEPER-1214.patch" size="8281" author="calvarez" created="Wed, 5 Oct 2011 12:30:07 +0100"/>
                            <attachment id="12497775" name="ZOOKEEPER-1214.patch" size="8346" author="calvarez" created="Wed, 5 Oct 2011 10:59:50 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 5 Oct 2011 10:02:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>46382</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzsvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32661</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>