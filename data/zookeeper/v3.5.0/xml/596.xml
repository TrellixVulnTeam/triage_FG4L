<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:40:31 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-596/ZOOKEEPER-596.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-596] The last logged zxid calculated by zookeeper servers could cause problems in leader election if data gets corrupted.</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-596</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;It is possible that the last loggged zxid as reported by all the servers during leader election is not the last zxid that the server can upload data to. It is very much possible that some transaction or snapshot gets corrupted and the servers actually do not have valid data till last logged zxid. We need to make sure that what the servers report as there last logged zxid, they are able to load data till that zxid.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12441617">ZOOKEEPER-596</key>
            <summary>The last logged zxid calculated by zookeeper servers could cause problems in leader election if data gets corrupted.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mahadev">Mahadev konar</assignee>
                                    <reporter username="mahadev">Mahadev konar</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Nov 2009 22:51:29 +0000</created>
                <updated>Thu, 2 May 2013 03:29:23 +0100</updated>
                            <resolved>Fri, 18 Dec 2009 02:20:28 +0000</resolved>
                                    <version>3.2.1</version>
                                    <fixVersion>3.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12782223" author="mahadev" created="Tue, 24 Nov 2009 23:02:44 +0000"  >&lt;p&gt;To elablorate on the problem:&lt;br/&gt;
Currently this is what happens:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;servers read the last logged zxid from the last log or snapshot and use that in the leader election&lt;/li&gt;
	&lt;li&gt;it is quite possible that something in the logs (some transaction lower than the one reported in leader election) is corrupt and the server does not have sane data till the last reported zxid in leader election&lt;/li&gt;
	&lt;li&gt;this could lead to leader election spinning in a loop if the one elected a leader cannot actually read the data till the reported transaction id.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The solution is to let the servers upload all the data before they start the leader election and then send the last logged zxid. This way the server can be sure that it has valid data til the last zxid it actually reports in the leader election.&lt;/p&gt;
</comment>
                            <comment id="12789970" author="mahadev" created="Mon, 14 Dec 2009 02:16:32 +0000"  >&lt;p&gt;a preliminary patch. Does not include tests. Will still be adding tests and cleaning it up. &lt;/p&gt;

&lt;p&gt;this patch adds:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a new class ZKDatabase that becomes a top level member of quorumpeer and passed around to all the zookeeper server&apos;s created for the life of a quorumPeer&lt;/li&gt;
	&lt;li&gt;the zkdatabase includes all the api&apos;s needed to modify/use/load the zk database&lt;br/&gt;
making ZKDatabase as the top level member of quorumpeer allows it to be shared across different instances of zookeeper servers (leader/learner/observer) of an instance of quorumpeer.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I will be adding javadocs and cleaning up the patch shortly.&lt;/p&gt;</comment>
                            <comment id="12790590" author="mahadev" created="Tue, 15 Dec 2009 06:37:17 +0000"  >&lt;p&gt;after 3 failed attempts, hopefully jira would upload this file.&lt;/p&gt;

&lt;p&gt;a cleaned up patch with comments/javadoc. I am still adding tests. Trying to fix some tests that are failing.&lt;/p&gt;</comment>
                            <comment id="12791352" author="fpj" created="Wed, 16 Dec 2009 12:52:55 +0000"  >&lt;p&gt;FLELostMessage test won&apos;t work without &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-629&quot; title=&quot;FLELostMessageTest assumes that the first zxid on a startup of quorum is -1.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-629&quot;&gt;&lt;del&gt;ZOOKEEPER-629&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12791539" author="mahadev" created="Wed, 16 Dec 2009 19:33:24 +0000"  >&lt;p&gt;this patch adds a test case for using memory based zkdatabase most of the time. The test checks to see that a server who has corrupted database cannot join the cluster. I am still thinking if we should just start with a empty database in such a case or just shutdown and let the admin figure it out. This way if the disk is corrupt, an admin can take care of it. For now, I have left the quorumpeer to exit if it finds its database is corrupt on and upto the admin to sanitize the database (by just deleting the database and starting all new on that node).&lt;/p&gt;

&lt;p&gt;this patch includes :&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-629&quot; title=&quot;FLELostMessageTest assumes that the first zxid on a startup of quorum is -1.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-629&quot;&gt;&lt;del&gt;ZOOKEEPER-629&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="12791546" author="hadoopqa" created="Wed, 16 Dec 2009 19:43:17 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12428210/ZOOKEEPER-596.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12428210/ZOOKEEPER-596.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 891368.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/28/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/28/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12791550" author="mahadev" created="Wed, 16 Dec 2009 19:52:00 +0000"  >&lt;p&gt;looks like the patch got stale.... uploading a new patch that applies to the trunk.&lt;/p&gt;

</comment>
                            <comment id="12791566" author="hadoopqa" created="Wed, 16 Dec 2009 20:18:43 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12428212/ZOOKEEPER-596.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12428212/ZOOKEEPER-596.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 891368.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/29/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/29/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/29/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/29/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/29/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/29/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12791593" author="mahadev" created="Wed, 16 Dec 2009 21:28:53 +0000"  >&lt;p&gt;an updated patch with acess methods for accessing zkdatabase from zookeeperserver. It was accessing members directly which I think is a bad idea.&lt;/p&gt;</comment>
                            <comment id="12791611" author="hadoopqa" created="Wed, 16 Dec 2009 21:58:51 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12428223/ZOOKEEPER-596.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12428223/ZOOKEEPER-596.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 891368.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/30/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/30/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/30/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/30/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/30/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/30/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12792127" author="breed" created="Thu, 17 Dec 2009 21:10:53 +0000"  >&lt;p&gt;looks really good. just a couple of comments:&lt;/p&gt;

&lt;p&gt;1) i think zkDb should be private&lt;br/&gt;
2) you have get/setZkb() in QuorumPeer. you should make it consistent with ZooKeeper and use get/setZKDatabase&lt;/p&gt;</comment>
                            <comment id="12792133" author="mahadev" created="Thu, 17 Dec 2009 21:21:53 +0000"  >&lt;p&gt;patch that addresses ben&apos;s comments. Also removed some unnecessary logging from the tests.&lt;/p&gt;</comment>
                            <comment id="12792142" author="breed" created="Thu, 17 Dec 2009 21:37:51 +0000"  >&lt;p&gt;+1 (assuming it passes test)&lt;/p&gt;</comment>
                            <comment id="12792253" author="hadoopqa" created="Fri, 18 Dec 2009 00:35:16 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12428346/ZOOKEEPER-596.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12428346/ZOOKEEPER-596.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 892001.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/93/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/93/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/93/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/93/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/93/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/93/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12792300" author="mahadev" created="Fri, 18 Dec 2009 02:20:28 +0000"  >&lt;p&gt;I just committed this.&lt;/p&gt;</comment>
                            <comment id="12792481" author="hudson" created="Fri, 18 Dec 2009 13:59:55 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #634 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/634/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/634/&lt;/a&gt;)&lt;br/&gt;
    . The last logged zxid calculated by zookeeper servers could cause problems in leader election if data gets corrupted. (mahadev)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12443494">ZOOKEEPER-629</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12428346" name="ZOOKEEPER-596.patch" size="66191" author="mahadev" created="Thu, 17 Dec 2009 21:21:53 +0000"/>
                            <attachment id="12428223" name="ZOOKEEPER-596.patch" size="66050" author="mahadev" created="Wed, 16 Dec 2009 21:28:53 +0000"/>
                            <attachment id="12428212" name="ZOOKEEPER-596.patch" size="65420" author="mahadev" created="Wed, 16 Dec 2009 19:52:00 +0000"/>
                            <attachment id="12428210" name="ZOOKEEPER-596.patch" size="66143" author="mahadev" created="Wed, 16 Dec 2009 19:33:24 +0000"/>
                            <attachment id="12428010" name="ZOOKEEPER-596.patch" size="58736" author="mahadev" created="Tue, 15 Dec 2009 06:37:17 +0000"/>
                            <attachment id="12427881" name="ZOOKEEPER-596.patch" size="54544" author="mahadev" created="Mon, 14 Dec 2009 02:16:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 16 Dec 2009 12:52:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47707</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzutz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32979</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>