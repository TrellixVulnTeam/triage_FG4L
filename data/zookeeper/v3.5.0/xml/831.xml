<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:46:54 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-831/ZOOKEEPER-831.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-831] BookKeeper: Throttling improved for reads</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-831</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;Reads and writes in BookKeeper are asymmetric: a write request writes one entry, whereas a read request may read multiple requests. The current implementation of throttling only counts the number of read requests instead of counting the number of entries being read. Consequently, a few read requests reading a large number of entries each will spawn a large number of read-entry requests. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12470839">ZOOKEEPER-831</key>
            <summary>BookKeeper: Throttling improved for reads</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fpj">Flavio Junqueira</assignee>
                                    <reporter username="fpj">Flavio Junqueira</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Aug 2010 22:25:16 +0100</created>
                <updated>Thu, 2 May 2013 03:29:29 +0100</updated>
                            <resolved>Fri, 17 Sep 2010 17:59:19 +0100</resolved>
                                    <version>3.3.1</version>
                                    <fixVersion>3.4.0</fixVersion>
                                    <component>contrib-bookkeeper</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12895432" author="fpj" created="Wed, 4 Aug 2010 22:36:11 +0100"  >&lt;p&gt;This patch fixes the issue described and modifies a test to verify that it is working.&lt;/p&gt;</comment>
                            <comment id="12895440" author="hadoopqa" created="Wed, 4 Aug 2010 23:00:40 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12451268/ZOOKEEPER-831.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12451268/ZOOKEEPER-831.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 980576.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/107/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/107/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/107/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/107/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/107/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/107/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12895560" author="fpj" created="Thu, 5 Aug 2010 06:49:28 +0100"  >&lt;p&gt;Need to fix log messages.&lt;/p&gt;</comment>
                            <comment id="12898514" author="fpj" created="Sat, 14 Aug 2010 06:47:25 +0100"  >&lt;p&gt;Submitting new patch.&lt;/p&gt;</comment>
                            <comment id="12907144" author="ikelly" created="Wed, 8 Sep 2010 10:42:33 +0100"  >&lt;p&gt;asyncAddEntry - why did you move the semaphore acquire in this? If an exception occurs during the adding of the operation, is the completion (and therefore the release) guaranteed?&lt;/p&gt;

&lt;p&gt;Otherwise the patch looks good.&lt;/p&gt;</comment>
                            <comment id="12907149" author="ikelly" created="Wed, 8 Sep 2010 11:00:12 +0100"  >&lt;p&gt;You&apos;ve added a public method to the API purely for testing. Is this necessary? You can access the private members using reflection, which would save you having to add anything to the API which could be difficult to remove in the future.&lt;/p&gt;

&lt;p&gt;@suppressWarning(&quot;unchecked&quot;)&lt;br/&gt;
int getAvailablePermits(LedgerHandle lh) &lt;/p&gt;
{
    Field field = LedgerHandle.class.getDeclaredField(&quot;opCounterSem&quot;);
    field.setAccessible(true);
    return ((Semaphore)field.get(lh)).getAvailablePermits();
}</comment>
                            <comment id="12907171" author="fpj" created="Wed, 8 Sep 2010 12:27:43 +0100"  >&lt;p&gt;Canceling patch until comments are addressed.&lt;/p&gt;</comment>
                            <comment id="12907663" author="fpj" created="Thu, 9 Sep 2010 16:49:01 +0100"  >&lt;p&gt;I have implemented the modification Ivan suggested to avoid a new call in the API of LedgerHandler.&lt;/p&gt;

&lt;p&gt;The comment on the acquire call, however, is a little trickier. First, we can&apos;t acquire a permit in pendingAddOp.initiate() because the call to asyncAddEntry and the call to initiate are decoupled (a separate thread executes initiate). To have the acquire call being effective in throttling the client application, we need to put it either before or after submitOrdered in asyncAddEntry. Given that there is only one checked exception, which is thrown by the acquire call itself, it is my impression that it is ok to place the call before, and placing it before is the same order the we followed for read operations in pendingReadOp.initiate().&lt;/p&gt;

&lt;p&gt;What do you think, Ivan?&lt;/p&gt;
</comment>
                            <comment id="12908724" author="ikelly" created="Mon, 13 Sep 2010 12:13:28 +0100"  >&lt;p&gt;submitOrdered can throw RejectedExecutionException (Im guessing rare to the order of &quot;if this happens the machine will die soon&quot;) or NullPointerException (unlikely). However there&apos;s no harm putting a try { } catch (Exception e) &lt;/p&gt;
{ opCounterSem.release(); }
&lt;p&gt; around it. the handler will never run except if the job is never submitted.&lt;/p&gt;

&lt;p&gt;Also, you need a release inside the if (metadata.isClosed) . Otherwise I think it should be fine. As PendingAddOp should be able to handle it no matter what error occurs.&lt;/p&gt;</comment>
                            <comment id="12909192" author="fpj" created="Tue, 14 Sep 2010 12:13:59 +0100"  >&lt;p&gt;Attaching a new patch. In this patch, asyncAddOp catches a RunTimeException and releases a permit if there is such an exception while calling submitOrdered. It also releases a permit if metadata.isClosed() evaluates to true.&lt;/p&gt;</comment>
                            <comment id="12909236" author="ikelly" created="Tue, 14 Sep 2010 14:36:42 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12910662" author="breed" created="Fri, 17 Sep 2010 17:59:19 +0100"  >&lt;p&gt;Committed revision 998200.&lt;/p&gt;

&lt;p&gt;thanx for the fix flavio and ivan for the reviews!&lt;/p&gt;</comment>
                            <comment id="12910965" author="hudson" created="Sat, 18 Sep 2010 11:55:13 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #940 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/ZooKeeper-trunk/940/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/ZooKeeper-trunk/940/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-831&quot; title=&quot;BookKeeper: Throttling improved for reads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-831&quot;&gt;&lt;del&gt;ZOOKEEPER-831&lt;/del&gt;&lt;/a&gt;. BookKeeper: Throttling improved for reads&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12470083">BOOKKEEPER-4</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12454534" name="ZOOKEEPER-831.patch" size="12944" author="fpj" created="Tue, 14 Sep 2010 12:13:59 +0100"/>
                            <attachment id="12454213" name="ZOOKEEPER-831.patch" size="11522" author="fpj" created="Thu, 9 Sep 2010 16:49:01 +0100"/>
                            <attachment id="12452075" name="ZOOKEEPER-831.patch" size="10194" author="fpj" created="Sat, 14 Aug 2010 06:47:25 +0100"/>
                            <attachment id="12451268" name="ZOOKEEPER-831.patch" size="6217" author="fpj" created="Wed, 4 Aug 2010 22:36:11 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 4 Aug 2010 22:00:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47582</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzu1r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32852</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>