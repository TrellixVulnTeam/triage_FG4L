<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:44:36 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-624/ZOOKEEPER-624.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-624] The C Client cause core dump when receive error data from Zookeeper Server</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-624</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;I encountered a problem today that the Zookeeper C Client (version 3.2.0) core dump when reconnected and did some operations on the zookeeper server which just restarted. The gdb infomation is like:&lt;/p&gt;

&lt;p&gt;(gdb) bt&lt;br/&gt;
#0  0x000000302af71900 in memcpy () from /lib64/tls/libc.so.6&lt;br/&gt;
#1  0x000000000047bfe4 in ia_deserialize_string (ia=Variable &quot;ia&quot; is not available.) at src/recordio.c:270&lt;br/&gt;
#2  0x000000000047ed20 in deserialize_CreateResponse (in=0x9cd870, tag=0x50a74e &quot;reply&quot;, v=0x409ffe70) at generated/zookeeper.jute.c:679&lt;br/&gt;
#3  0x000000000047a1d0 in zookeeper_process (zh=0x9c8c70, events=Variable &quot;events&quot; is not available.) at src/zookeeper.c:1895&lt;br/&gt;
#4  0x00000000004815e6 in do_io (v=Variable &quot;v&quot; is not available.) at src/mt_adaptor.c:310&lt;br/&gt;
#5  0x000000302b80610a in start_thread () from /lib64/tls/libpthread.so.0&lt;br/&gt;
#6  0x000000302afc6003 in clone () from /lib64/tls/libc.so.6&lt;br/&gt;
#7  0x0000000000000000 in ?? ()&lt;br/&gt;
(gdb) f 1&lt;br/&gt;
#1  0x000000000047bfe4 in ia_deserialize_string (ia=Variable &quot;ia&quot; is not available.) at src/recordio.c:270&lt;br/&gt;
270     in src/recordio.c&lt;br/&gt;
(gdb) info locals&lt;br/&gt;
priv = (struct buff_struct *) 0x9cd8d0&lt;br/&gt;
len = -1&lt;br/&gt;
rc = Variable &quot;rc&quot; is not available.&lt;/p&gt;

&lt;p&gt;According to the source code,&lt;br/&gt;
int ia_deserialize_string(struct iarchive *ia, const char *name, char **s)&lt;br/&gt;
{&lt;br/&gt;
    struct buff_struct *priv = ia-&amp;gt;priv;&lt;br/&gt;
    int32_t len;&lt;br/&gt;
    int rc = ia_deserialize_int(ia, &quot;len&quot;, &amp;amp;len);&lt;br/&gt;
    if (rc &amp;lt; 0)&lt;br/&gt;
        return rc;&lt;br/&gt;
    if ((priv-&amp;gt;len - priv-&amp;gt;off) &amp;lt; len) &lt;/p&gt;
{
        return -E2BIG;
    }
&lt;p&gt;    *s = malloc(len+1);&lt;br/&gt;
    if (!*s) &lt;/p&gt;
{
        return -ENOMEM;
    }
&lt;p&gt;    memcpy(*s, priv-&amp;gt;buffer+priv-&amp;gt;off, len);&lt;br/&gt;
    (*s)&lt;span class=&quot;error&quot;&gt;&amp;#91;len&amp;#93;&lt;/span&gt; = &apos;\0&apos;;&lt;br/&gt;
    priv-&amp;gt;off += len;&lt;br/&gt;
    return 0;&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;the variable len is set by ia_deserialize_int, and the returned len doesn&apos;t been checked, so the client segment fault when trying to memcpy -1 byte data.&lt;br/&gt;
In the source file recordio.c, there are many functions which don&apos;t check the returned len. They all might cause segment fault in some kind of  situations.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux 2.6.9 x86_64&lt;/p&gt;</environment>
        <key id="12443330">ZOOKEEPER-624</key>
            <summary>The C Client cause core dump when receive error data from Zookeeper Server</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mahadev">Mahadev konar</assignee>
                                    <reporter username="creatstar">Qian Ye</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Dec 2009 03:17:08 +0000</created>
                <updated>Fri, 26 Mar 2010 17:25:08 +0000</updated>
                            <resolved>Wed, 17 Mar 2010 00:05:38 +0000</resolved>
                                    <version>3.2.0</version>
                                    <fixVersion>3.3.0</fixVersion>
                                    <component>c client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12790546" author="mahadev" created="Tue, 15 Dec 2009 03:39:24 +0000"  >&lt;p&gt;marking this for 3.3 for now. we should find out if this is critical or not. &lt;/p&gt;</comment>
                            <comment id="12803406" author="phunt" created="Thu, 21 Jan 2010 18:32:12 +0000"  >&lt;p&gt;Ben, can you have a look at this one as well?&lt;/p&gt;</comment>
                            <comment id="12843414" author="mahadev" created="Wed, 10 Mar 2010 03:07:17 +0000"  >&lt;p&gt;this patch checks for len in deserialize_String() and also adds a testcase. I checked for other places but looks like everywhere else we do check for len being -1.&lt;/p&gt;
</comment>
                            <comment id="12843415" author="mahadev" created="Wed, 10 Mar 2010 03:08:32 +0000"  >&lt;p&gt;minor change to the patch with check for len &amp;lt;0.&lt;/p&gt;</comment>
                            <comment id="12843426" author="hadoopqa" created="Wed, 10 Mar 2010 03:56:35 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12438363/ZOOKEEPER-624.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12438363/ZOOKEEPER-624.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 921201.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/7/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/7/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/7/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/7/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/7/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/7/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12844261" author="breed" created="Thu, 11 Mar 2010 22:59:49 +0000"  >&lt;p&gt;+1 good job mahadev!&lt;/p&gt;</comment>
                            <comment id="12846221" author="mahadev" created="Wed, 17 Mar 2010 00:05:38 +0000"  >&lt;p&gt;I just committed this.&lt;/p&gt;</comment>
                            <comment id="12846239" author="hudson" created="Wed, 17 Mar 2010 00:34:21 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #752 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/752/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/752/&lt;/a&gt;)&lt;br/&gt;
    . The C Client cause core dump when receive error data from Zookeeper Server (mahadev)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12438363" name="ZOOKEEPER-624.patch" size="1756" author="mahadev" created="Wed, 10 Mar 2010 03:08:32 +0000"/>
                            <attachment id="12438362" name="ZOOKEEPER-624.patch" size="1758" author="mahadev" created="Wed, 10 Mar 2010 03:07:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 15 Dec 2009 03:39:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47686</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzupj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32959</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>c client, core dump</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>