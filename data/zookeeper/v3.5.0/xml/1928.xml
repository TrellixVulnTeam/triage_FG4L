<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:46:52 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1928/ZOOKEEPER-1928.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1928] add configurable throttling to the number of snapshots concurrently sent by a leader</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1928</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;We want to add configurable throttling to the number of snapshots concurrently sent by a leader.  Without this, when recovering from a partial outage or network partition, the leader can become overloaded and unresponsive due to its attempts to send snapshots to too many followers and observers all at once.  The throttle will operate by terminating the connection of any observer receiving a snapshot deemed to be in excess of the throttle.  Followers should be allowed to receive snapshots unconditionally, though those snapshots do count against the quota.&lt;/p&gt;

&lt;p&gt;I have a patch ready which implements this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12715901">ZOOKEEPER-1928</key>
            <summary>add configurable throttling to the number of snapshots concurrently sent by a leader</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ecarter">Edward Carter</assignee>
                                    <reporter username="ecarter">Edward Carter</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 May 2014 01:46:46 +0100</created>
                <updated>Tue, 10 Jun 2014 12:16:22 +0100</updated>
                            <resolved>Mon, 9 Jun 2014 23:19:32 +0100</resolved>
                                                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                    <timeoriginalestimate seconds="604800">168h</timeoriginalestimate>
                            <timeestimate seconds="604800">168h</timeestimate>
                                        <comments>
                            <comment id="14005538" author="ecarter" created="Thu, 22 May 2014 03:03:39 +0100"  >&lt;p&gt;patch against trunk implementing the described feature&lt;/p&gt;</comment>
                            <comment id="14005563" author="michim" created="Thu, 22 May 2014 04:06:46 +0100"  >&lt;p&gt;Thank you for the patch Edward. Please click on &quot;Submit Patch&quot; button when it&apos;s ready for review.&lt;/p&gt;</comment>
                            <comment id="14010492" author="ecarter" created="Wed, 28 May 2014 00:30:11 +0100"  >&lt;p&gt;Patch is submitted and ready for review.&lt;/p&gt;</comment>
                            <comment id="14010494" author="hadoopqa" created="Wed, 28 May 2014 00:32:45 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12646163/ZOOKEEPER-1928.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12646163/ZOOKEEPER-1928.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1596684.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The patch appears to cause tar ant target to fail.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to cause Findbugs (version 1.3.9) to fail.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2113//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2113//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2113//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2113//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14010509" author="fpj" created="Wed, 28 May 2014 00:48:47 +0100"  >&lt;p&gt;Patch looks nice, thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ecarter&quot; class=&quot;user-hover&quot; rel=&quot;ecarter&quot;&gt;Edward Carter&lt;/a&gt;. I was wondering if we can do better than this. Can we for example queue requests and serve them as get &quot;available slots&quot; rather than dropping the learner when we are over the limit?&lt;/p&gt;</comment>
                            <comment id="14011388" author="ecarter" created="Wed, 28 May 2014 18:57:44 +0100"  >&lt;p&gt;Removes dependency on Java 7 AutoCloseable and adds configurable timeout to wait for snapshot slot.&lt;/p&gt;</comment>
                            <comment id="14011390" author="ecarter" created="Wed, 28 May 2014 18:59:28 +0100"  >&lt;p&gt;The new patch adds a simple mechanism for learner threads that want to send a snapshot to wait until there is room in the throttle for some configurable timeout.&lt;/p&gt;</comment>
                            <comment id="14011454" author="hadoopqa" created="Wed, 28 May 2014 20:00:43 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12647177/ZOOKEEPER-1928.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12647177/ZOOKEEPER-1928.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1598087.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2116//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2116//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2116//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2116//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2116//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2116//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14015101" author="fpj" created="Sun, 1 Jun 2014 23:02:58 +0100"  >&lt;p&gt;Thanks for the changes, Edward. I had a more careful look at the patch and here are some other comments, hope you don&apos;t mind:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;The configuration this is adding is only taking parameters through the command line. Although there has been some configuration introduced that doesn&apos;t use the config file, we typically prefer to have both options. Would you be ok with adding the config file option?&lt;/li&gt;
	&lt;li&gt;In beginSnapshot, if an interrupted exception is thrown, shouldn&apos;t we also throw an exception, either snapshot throttle or extend it also throw interrupted exception?&lt;/li&gt;
	&lt;li&gt;Minor: if I&apos;m not mistaken, we are still using 80 characters per line, and there are some pretty long lines in leaner throttler.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Other than that, it looks good to me.&lt;/p&gt;</comment>
                            <comment id="14015975" author="ecarter" created="Mon, 2 Jun 2014 23:25:48 +0100"  >&lt;p&gt;For point 2, I made beginSnapshot propagate InterruptedException, since the caller already handles it; for point 3, I reformatted some lines in LearnerSnapshotThrottler.&lt;/p&gt;

&lt;p&gt;For point 1, since the system properties used start with &quot;zookeeper.&quot;, can&apos;t they already be configured by QuorumPeerConfig with keys &quot;leader.maxConcurrentSnapshots&quot; and &quot;leader.maxConcurrentSnapshotTimeout&quot;?&lt;/p&gt;</comment>
                            <comment id="14016030" author="hadoopqa" created="Tue, 3 Jun 2014 00:14:17 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12648024/ZOOKEEPER-1928.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12648024/ZOOKEEPER-1928.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1598087.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2122//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2122//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2122//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2122//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2122//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2122//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14017101" author="fpj" created="Tue, 3 Jun 2014 21:26:57 +0100"  >&lt;p&gt;Thanks for the updates, Edward. I can live with the default for the system properties.&lt;/p&gt;

&lt;p&gt;The test failure seems to be due to this: *** glibc detected *** ./zktest-mt: free(): invalid pointer: 0x00002b7a4aa61000 ***. This is weird, but I don&apos;t think it is related to this patch. &lt;/p&gt;

&lt;p&gt;It&apos;s +1 for me. Since it is a new feature, I&apos;ll wait a day or two before committing to see if anyone else has a comment.&lt;/p&gt;</comment>
                            <comment id="14025849" author="fpj" created="Mon, 9 Jun 2014 23:19:32 +0100"  >&lt;p&gt;Thanks, Edward. Committed revision 1601516.&lt;/p&gt;</comment>
                            <comment id="14026330" author="hudson" created="Tue, 10 Jun 2014 12:16:22 +0100"  >&lt;p&gt;SUCCESS: Integrated in ZooKeeper-trunk #2331 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2331/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2331/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1928&quot; title=&quot;add configurable throttling to the number of snapshots concurrently sent by a leader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1928&quot;&gt;&lt;del&gt;ZOOKEEPER-1928&lt;/del&gt;&lt;/a&gt;. add configurable throttling to the number of snapshots concurrently sent by a leader (Edward Carter via fpj) (fpj: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1601516&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1601516&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Leader.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/LearnerHandler.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/LearnerSnapshot.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/LearnerSnapshotThrottler.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/SnapshotThrottleException.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/LearnerSnapshotThrottlerTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12648024" name="ZOOKEEPER-1928.patch" size="22624" author="ecarter" created="Mon, 2 Jun 2014 23:22:13 +0100"/>
                            <attachment id="12647177" name="ZOOKEEPER-1928.patch" size="22049" author="ecarter" created="Wed, 28 May 2014 18:57:43 +0100"/>
                            <attachment id="12646163" name="ZOOKEEPER-1928.patch" size="17180" author="ecarter" created="Thu, 22 May 2014 03:03:39 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 22 May 2014 03:06:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>394186</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzpq6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>394324</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>