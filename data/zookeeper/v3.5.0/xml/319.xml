<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:46:45 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-319/ZOOKEEPER-319.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-319] add locking around auth info in zhandle_t</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-319</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;Looking over the zookeeper.c code it appears to me that the zoo_add_auth() function may be called at any time by the user in their &quot;main&quot; thread.  This function alters the elements of the auth_info structure in the zhandle_t structure.&lt;/p&gt;

&lt;p&gt;Meanwhile, the IO thread may read those elements at any time in such functions as send_auth_info() and auth_completion_func().  It seems important, then, to add a lock which prevents data being read by the IO thread while only partially changed by the user&apos;s thread.  The attached patch add such a lock.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12414999">ZOOKEEPER-319</key>
            <summary>add locking around auth info in zhandle_t</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cdarroch">Chris Darroch</assignee>
                                    <reporter username="cdarroch">Chris Darroch</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Feb 2009 22:32:27 +0000</created>
                <updated>Wed, 8 Jul 2009 21:24:00 +0100</updated>
                            <resolved>Fri, 27 Feb 2009 19:49:16 +0000</resolved>
                                    <version>3.0.0</version>
                    <version>3.0.1</version>
                    <version>3.1.0</version>
                                    <fixVersion>3.1.1</fixVersion>
                    <fixVersion>3.2.0</fixVersion>
                                    <component>c client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12674805" author="cdarroch" created="Wed, 18 Feb 2009 22:07:57 +0000"  >&lt;p&gt;This version avoids holding the auth lock while calling the user&apos;s auth completion function (which may run for a long time; we don&apos;t know).&lt;/p&gt;</comment>
                            <comment id="12676824" author="mahadev" created="Thu, 26 Feb 2009 00:20:38 +0000"  >&lt;p&gt;just a minor modification. my compiler fails on compiliing &lt;br/&gt;
consta char* auth_data without initialization.&lt;/p&gt;

&lt;p&gt;+1 to the patch.&lt;/p&gt;

&lt;p&gt;one minor nit &amp;#8211; &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;we have some logging in auth_completion_func() in zookeeper.c&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; zoo_lock_auth(zh);
    
    if(rc!=0){
        LOG_ERROR((&quot;Authentication scheme %s failed. Connection closed.&quot;,
                zh-&amp;gt;auth.scheme));
        zh-&amp;gt;state=ZOO_AUTH_FAILED_STATE;
    }else{
        zh-&amp;gt;auth.state=1;  // active
        LOG_INFO((&quot;Authentication scheme %s succeeded&quot;, zh-&amp;gt;auth.scheme));
    }

    if (zh-&amp;gt;auth.completion) {
        auth_completion = zh-&amp;gt;auth.completion;
        auth_data = zh-&amp;gt;auth.data;
        zh-&amp;gt;auth.completion=0;
    }

    zoo_unlock_auth(zh);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should we get rid of logging within the lock?&lt;/p&gt;</comment>
                            <comment id="12677142" author="cdarroch" created="Thu, 26 Feb 2009 21:12:56 +0000"  >&lt;p&gt;Good points &amp;#8211; see if this suits.&lt;/p&gt;</comment>
                            <comment id="12677497" author="mahadev" created="Fri, 27 Feb 2009 19:49:16 +0000"  >&lt;p&gt;I just committed this. thanks chris.&lt;/p&gt;</comment>
                            <comment id="12677685" author="hudson" created="Sat, 28 Feb 2009 15:15:49 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #243 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/243/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/243/&lt;/a&gt;)&lt;br/&gt;
    . add locking around auth info in zhandle_t. (chris darroch via mahadev)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12401067" name="ZOOKEEPER-319.patch" size="5393" author="cdarroch" created="Thu, 26 Feb 2009 21:12:56 +0000"/>
                            <attachment id="12400979" name="ZOOKEEPER-319.patch" size="5223" author="mahadev" created="Thu, 26 Feb 2009 00:20:38 +0000"/>
                            <attachment id="12400454" name="ZOOKEEPER-319.patch" size="5216" author="cdarroch" created="Wed, 18 Feb 2009 22:07:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 26 Feb 2009 00:20:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47903</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzvsn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33135</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>