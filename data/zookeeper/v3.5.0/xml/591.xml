<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:52:15 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-591/ZOOKEEPER-591.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-591] The C Client cannot exit properly in some situation</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-591</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;The following code produce a situation, where the C Client can not exit properly,&lt;/p&gt;

&lt;p&gt;#include &quot;include/zookeeper.h&quot;&lt;/p&gt;

&lt;p&gt;void default_zoo_watcher(zhandle_t &lt;b&gt;zzh, int type, int state, const char *path, void&lt;/b&gt; context){&lt;br/&gt;
    int zrc = 0;&lt;br/&gt;
    struct String_vector str_vec = &lt;/p&gt;
{0, NULL};&lt;br/&gt;
    printf(&quot;in the default_zoo_watcher\n&quot;);&lt;br/&gt;
    zrc = zoo_wget_children(zzh, &quot;/mytest&quot;, default_zoo_watcher, NULL, &amp;amp;str_vec);&lt;br/&gt;
    printf(&quot;zoo_wget_children, error: %d\n&quot;, zrc);&lt;br/&gt;
&lt;br/&gt;
    return;&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
int main()&lt;br/&gt;
{&lt;br/&gt;
    int zrc = 0;&lt;br/&gt;
    int buff_len = 10; &lt;br/&gt;
    char buff&lt;span class=&quot;error&quot;&gt;&amp;#91;10&amp;#93;&lt;/span&gt; = &quot;hello&quot;;&lt;br/&gt;
    char path&lt;span class=&quot;error&quot;&gt;&amp;#91;512&amp;#93;&lt;/span&gt;;&lt;br/&gt;
    struct Stat stat;&lt;br/&gt;
    struct String_vector str_vec = {0, NULL}
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;    zhandle_t *zh = zookeeper_init(&quot;10.81.20.62:2181&quot;, NULL, 30000, 0, 0, 0); &lt;br/&gt;
    zrc = zoo_create(zh, &quot;/mytest&quot;, buff, 10, &amp;amp;ZOO_OPEN_ACL_UNSAFE, 0, path, 512);&lt;br/&gt;
    printf(&quot;zoo_create, error: %d\n&quot;, zrc);&lt;/p&gt;

&lt;p&gt;    zrc = zoo_wget_children(zh, &quot;/mytest&quot;, default_zoo_watcher, NULL, &amp;amp;str_vec);&lt;br/&gt;
    printf(&quot;zoo_wget_children, error: %d\n&quot;, zrc);&lt;/p&gt;

&lt;p&gt;    zrc = zoo_create(zh, &quot;/mytest/test1&quot;, buff, 10, &amp;amp;ZOO_OPEN_ACL_UNSAFE, 0, path, 512);&lt;br/&gt;
    printf(&quot;zoo_create, error: %d\n&quot;, zrc);&lt;/p&gt;

&lt;p&gt;    zrc = zoo_wget_children(zh, &quot;/mytest&quot;, default_zoo_watcher, NULL, &amp;amp;str_vec);&lt;br/&gt;
    printf(&quot;zoo_wget_children, error: %d\n&quot;, zrc);&lt;/p&gt;

&lt;p&gt;    zrc = zoo_delete(zh, &quot;/mytest/test1&quot;, -1);&lt;/p&gt;

&lt;p&gt;    printf(&quot;zoo_delete, error: %d\n&quot;, zrc);&lt;br/&gt;
    zookeeper_close(zh);&lt;br/&gt;
    return 0;&lt;br/&gt;
}&lt;/p&gt;


&lt;p&gt;running this code can cause the program hang at zookeeper_close(zh);(line 38). using gdb to attach the process, I found that the main thread is waiting for do_completion thread to finish,&lt;br/&gt;
(gdb) bt&lt;br/&gt;
#0  0x000000302b806ffb in pthread_join () from /lib64/tls/libpthread.so.0&lt;br/&gt;
#1  0x000000000040de3b in adaptor_finish (zh=0x515b60) at src/mt_adaptor.c:219&lt;br/&gt;
#2  0x00000000004060ba in zookeeper_close (zh=0x515b60) at src/zookeeper.c:2100&lt;br/&gt;
#3  0x000000000040220b in main ()&lt;/p&gt;

&lt;p&gt;and the thread which handle the zoo_wget_children(in the default_zoo_watcher) is waiting for sc-&amp;gt;cond. &lt;br/&gt;
(gdb) thread 2&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Switching to thread 2 (Thread 1094719840 (LWP 25093))&amp;#93;&lt;/span&gt;#0  0x000000302b8089aa in pthread_cond_wait@@GLIBC_2.3.2 ()&lt;br/&gt;
   from /lib64/tls/libpthread.so.0&lt;br/&gt;
(gdb) bt&lt;br/&gt;
#0  0x000000302b8089aa in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/tls/libpthread.so.0&lt;br/&gt;
#1  0x000000000040d88b in wait_sync_completion (sc=0x5167f0) at src/mt_adaptor.c:82&lt;br/&gt;
#2  0x00000000004082c9 in zoo_wget_children (zh=0x515b60, path=0x40ebc0 &quot;/mytest&quot;, watcher=0x401fd8 &amp;lt;default_zoo_watcher&amp;gt;, watcherCtx=Variable &quot;watcherCtx&quot; is not available.)&lt;br/&gt;
    at src/zookeeper.c:2884&lt;br/&gt;
#3  0x0000000000402037 in default_zoo_watcher ()&lt;br/&gt;
#4  0x000000000040d664 in deliverWatchers (zh=0x515b60, type=4, state=3, path=0x515100 &quot;/mytest&quot;, list=0x5177d8) at src/zk_hashtable.c:274&lt;br/&gt;
#5  0x0000000000403861 in process_completions (zh=0x515b60) at src/zookeeper.c:1631&lt;br/&gt;
#6  0x000000000040e1b5 in do_completion (v=Variable &quot;v&quot; is not available.) at src/mt_adaptor.c:333&lt;br/&gt;
#7  0x000000302b80610a in start_thread () from /lib64/tls/libpthread.so.0&lt;br/&gt;
#8  0x000000302afc6003 in clone () from /lib64/tls/libc.so.6&lt;br/&gt;
#9  0x0000000000000000 in ?? ()&lt;/p&gt;

&lt;p&gt;here, a deadlock presents.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Linux db-passport-test05.vm 2.6.9_5-4-0-5 #1 SMP Tue Apr 14 15:56:24 CST 2009 x86_64 x86_64 x86_64 GNU/Linux &lt;/p&gt;</environment>
        <key id="12441435">ZOOKEEPER-591</key>
            <summary>The C Client cannot exit properly in some situation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mahadev">Mahadev konar</assignee>
                                    <reporter username="creatstar">Qian Ye</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Nov 2009 09:35:37 +0000</created>
                <updated>Fri, 26 Mar 2010 17:25:04 +0000</updated>
                            <resolved>Thu, 18 Mar 2010 01:45:01 +0000</resolved>
                                    <version>3.2.1</version>
                                    <fixVersion>3.3.0</fixVersion>
                                    <component>c client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12801661" author="creatstar" created="Mon, 18 Jan 2010 03:14:23 +0000"  >&lt;p&gt;The reason of the deadlock is that the io thread didn&apos;t check whether there is some sync commands still in processing, before it returned. I think some kind of pending sync commands and thread mutex should be added to make sure the zookeeper handler can be closed properly. Has anyone have a look at this bug yet?&lt;/p&gt;</comment>
                            <comment id="12802371" author="phunt" created="Tue, 19 Jan 2010 17:50:52 +0000"  >&lt;p&gt;Upping the priority and assigning to 3.3.0&lt;/p&gt;</comment>
                            <comment id="12841941" author="mahadev" created="Fri, 5 Mar 2010 17:30:16 +0000"  >&lt;p&gt;ben, did you get a chance to take a look at it ?&lt;/p&gt;</comment>
                            <comment id="12843374" author="mahadev" created="Wed, 10 Mar 2010 00:13:17 +0000"  >&lt;p&gt;looking at the code, it looks like that there is a race condition wherein after free_completions is called by do_io(), calls could still be queued, which will cause the above problem to happen. I am attachign a patch which will not allow calls to be queued as soon as zookeeper_close() is callled.&lt;/p&gt;

&lt;p&gt;Qian, can you try out this patch and post the results. Its not possible to write a unit test for this.&lt;/p&gt;</comment>
                            <comment id="12843394" author="hadoopqa" created="Wed, 10 Mar 2010 01:34:02 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12438345/ZOOKEEPER-591.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12438345/ZOOKEEPER-591.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 921117.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no tests are needed for this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/6/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/6/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/6/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/6/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/6/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/6/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12843443" author="creatstar" created="Wed, 10 Mar 2010 05:43:02 +0000"  >&lt;p&gt;Hi Mahadev,  the patch doesn&apos;t work &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, the deadlock still exist.&lt;/p&gt;

&lt;p&gt;(gdb) info thread&lt;br/&gt;
  2 Thread 1094719840 (LWP 13889)  0x000000302b8089aa in pthread_cond_wait@@GLIBC_2.3.2 ()&lt;br/&gt;
   from /lib64/tls/libpthread.so.0&lt;br/&gt;
  1 Thread 182894113888 (LWP 13887)  0x000000302b806ffb in pthread_join () from /lib64/tls/libpthread.so.0&lt;br/&gt;
(gdb) thread 1&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Switching to thread 1 (Thread 182894113888 (LWP 13887))&amp;#93;&lt;/span&gt;#0  0x000000302b806ffb in pthread_join ()&lt;br/&gt;
   from /lib64/tls/libpthread.so.0&lt;br/&gt;
(gdb) bt&lt;br/&gt;
#0  0x000000302b806ffb in pthread_join () from /lib64/tls/libpthread.so.0&lt;br/&gt;
#1  0x000000000040de2b in adaptor_finish (zh=0x515b60) at src/mt_adaptor.c:218&lt;br/&gt;
#2  0x00000000004060aa in zookeeper_close (zh=0x515b60) at src/zookeeper.c:2086&lt;br/&gt;
#3  0x000000000040220b in main ()&lt;br/&gt;
(gdb) thread 2&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Switching to thread 2 (Thread 1094719840 (LWP 13889))&amp;#93;&lt;/span&gt;#0  0x000000302b8089aa in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/tls/libpthread.so.0&lt;br/&gt;
(gdb) bt     &lt;br/&gt;
#0  0x000000302b8089aa in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/tls/libpthread.so.0&lt;br/&gt;
#1  0x000000000040d87b in wait_sync_completion (sc=0x517850) at src/mt_adaptor.c:82&lt;br/&gt;
#2  0x00000000004082b9 in zoo_wget_children (zh=0x515b60, path=0x40eba0 &quot;/mytest&quot;, &lt;br/&gt;
    watcher=0x401fd8 &amp;lt;default_zoo_watcher&amp;gt;, watcherCtx=Variable &quot;watcherCtx&quot; is not available.&lt;br/&gt;
) at src/zookeeper.c:2866&lt;br/&gt;
#3  0x0000000000402037 in default_zoo_watcher ()&lt;br/&gt;
#4  0x000000000040d654 in deliverWatchers (zh=0x515b60, type=4, state=3, path=0x516920 &quot;/mytest&quot;, &lt;br/&gt;
    list=0x5177d8) at src/zk_hashtable.c:271&lt;br/&gt;
#5  0x0000000000403871 in process_completions (zh=0x515b60) at src/zookeeper.c:1620&lt;br/&gt;
#6  0x000000000040e1a5 in do_completion (v=Variable &quot;v&quot; is not available.&lt;br/&gt;
) at src/mt_adaptor.c:332&lt;br/&gt;
#7  0x000000302b80610a in start_thread () from /lib64/tls/libpthread.so.0&lt;br/&gt;
#8  0x000000302afc6003 in clone () from /lib64/tls/libc.so.6&lt;br/&gt;
#9  0x0000000000000000 in ?? ()&lt;/p&gt;</comment>
                            <comment id="12843642" author="mahadev" created="Wed, 10 Mar 2010 17:19:56 +0000"  >&lt;p&gt;we need to resolve this. marking it as a blocker.&lt;/p&gt;</comment>
                            <comment id="12843705" author="mahadev" created="Wed, 10 Mar 2010 19:09:00 +0000"  >&lt;p&gt;here is the updated patch. Qian can you try it out as soon as possible?&lt;/p&gt;</comment>
                            <comment id="12843789" author="hadoopqa" created="Wed, 10 Mar 2010 21:59:21 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12438438/ZOOKEEPER-591.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12438438/ZOOKEEPER-591.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 921509.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no tests are needed for this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/11/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/11/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/11/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/11/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/11/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/11/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12843870" author="creatstar" created="Thu, 11 Mar 2010 01:51:36 +0000"  >&lt;p&gt; The process still hang there, Mahadev. &lt;br/&gt;
(gdb) info thread&lt;br/&gt;
  2 Thread 1094719840 (LWP 31877)  0x000000302b8089aa in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/tls/libpthread.so.0&lt;br/&gt;
  1 Thread 182894113888 (LWP 31875)  0x000000302b806ffb in pthread_join () from /lib64/tls/libpthread.so.0&lt;br/&gt;
(gdb) thread 1&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Switching to thread 1 (Thread 182894113888 (LWP 31875))&amp;#93;&lt;/span&gt;#0  0x000000302b806ffb in pthread_join () from /lib64/tls/libpthread.so.0&lt;br/&gt;
(gdb) bt&lt;br/&gt;
#0  0x000000302b806ffb in pthread_join () from /lib64/tls/libpthread.so.0&lt;br/&gt;
#1  0x000000000040de5b in adaptor_finish (zh=0x515b60) at src/mt_adaptor.c:218&lt;br/&gt;
#2  0x00000000004060da in zookeeper_close (zh=0x515b60) at src/zookeeper.c:2109&lt;br/&gt;
#3  0x000000000040220b in main ()&lt;br/&gt;
(gdb) thread 2&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Switching to thread 2 (Thread 1094719840 (LWP 31877))&amp;#93;&lt;/span&gt;#0  0x000000302b8089aa in pthread_cond_wait@@GLIBC_2.3.2 ()&lt;br/&gt;
   from /lib64/tls/libpthread.so.0&lt;br/&gt;
(gdb) bt&lt;br/&gt;
#0  0x000000302b8089aa in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/tls/libpthread.so.0&lt;br/&gt;
#1  0x000000000040d8ab in wait_sync_completion (sc=0x5167f0) at src/mt_adaptor.c:82&lt;br/&gt;
#2  0x00000000004082e9 in zoo_wget_children (zh=0x515b60, path=0x40ebe0 &quot;/mytest&quot;, watcher=0x401fd8 &amp;lt;default_zoo_watcher&amp;gt;, watcherCtx=Variable &quot;watcherCtx&quot; is not available.&lt;br/&gt;
)&lt;br/&gt;
    at src/zookeeper.c:2889&lt;br/&gt;
#3  0x0000000000402037 in default_zoo_watcher ()&lt;br/&gt;
#4  0x000000000040d684 in deliverWatchers (zh=0x515b60, type=4, state=3, path=0x515100 &quot;/mytest&quot;, list=0x2a95700b08) at src/zk_hashtable.c:271&lt;br/&gt;
#5  0x0000000000403771 in process_completions (zh=0x515b60) at src/zookeeper.c:1623&lt;br/&gt;
#6  0x000000000040e1d5 in do_completion (v=Variable &quot;v&quot; is not available.&lt;br/&gt;
) at src/mt_adaptor.c:332&lt;br/&gt;
#7  0x000000302b80610a in start_thread () from /lib64/tls/libpthread.so.0&lt;br/&gt;
#8  0x000000302afc6003 in clone () from /lib64/tls/libc.so.6&lt;br/&gt;
#9  0x0000000000000000 in ?? ()&lt;/p&gt;

&lt;p&gt;I patched the patch to the c client source code version 3.2.2,  not the working copy, I think this won&apos;t make any difference, right?&lt;/p&gt;</comment>
                            <comment id="12844113" author="mahadev" created="Thu, 11 Mar 2010 16:22:44 +0000"  >&lt;p&gt;Qian,&lt;br/&gt;
 I can reproduce this as well on trunk. Yes, my patch does not fix the bug. I am still working on it. &lt;/p&gt;
</comment>
                            <comment id="12844176" author="mahadev" created="Thu, 11 Mar 2010 19:19:08 +0000"  >&lt;p&gt;a test case that qian actually reported that can reproduce the bug.&lt;/p&gt;</comment>
                            <comment id="12844179" author="phunt" created="Thu, 11 Mar 2010 19:22:13 +0000"  >&lt;p&gt;This test case from qian, we plan to add this to the c unit tests right?&lt;/p&gt;</comment>
                            <comment id="12844181" author="mahadev" created="Thu, 11 Mar 2010 19:24:38 +0000"  >&lt;p&gt;i think we can .... am working on including it as soon as we figure out the fix..... &lt;/p&gt;</comment>
                            <comment id="12844241" author="mahadev" created="Thu, 11 Mar 2010 21:21:58 +0000"  >&lt;p&gt;another patch for fixing this.&lt;/p&gt;</comment>
                            <comment id="12844245" author="hadoopqa" created="Thu, 11 Mar 2010 21:49:01 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12438540/ZOOKEEPER-591.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12438540/ZOOKEEPER-591.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 921853.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no tests are needed for this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/12/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/12/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/12/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/12/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/12/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/12/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12844255" author="mahadev" created="Thu, 11 Mar 2010 22:41:38 +0000"  >&lt;p&gt;this patch fixes the issue. I have added a test case as well which is on teh lines of the code posted by Qian. &lt;/p&gt;

&lt;p&gt;Qian, you can go ahead and try it. This should fix the bug.&lt;/p&gt;</comment>
                            <comment id="12844259" author="breed" created="Thu, 11 Mar 2010 22:56:49 +0000"  >&lt;p&gt;+1 good job mahadev!&lt;/p&gt;</comment>
                            <comment id="12844263" author="hadoopqa" created="Thu, 11 Mar 2010 23:08:47 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12438547/ZOOKEEPER-591.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12438547/ZOOKEEPER-591.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 921853.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/13/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/13/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/13/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/13/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/13/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/13/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12844391" author="creatstar" created="Fri, 12 Mar 2010 07:00:05 +0000"  >&lt;p&gt;This patch works for me, thx mahadev&lt;/p&gt;</comment>
                            <comment id="12846241" author="mahadev" created="Wed, 17 Mar 2010 00:35:46 +0000"  >&lt;p&gt;patch that applies to the trunk.&lt;/p&gt;</comment>
                            <comment id="12846288" author="mahadev" created="Wed, 17 Mar 2010 04:13:50 +0000"  >&lt;p&gt;the last patch had a bug which is fixed in this patch.&lt;/p&gt;</comment>
                            <comment id="12846289" author="mahadev" created="Wed, 17 Mar 2010 04:13:51 +0000"  >&lt;p&gt;the last patch had a bug which is fixed in this patch.&lt;/p&gt;</comment>
                            <comment id="12846290" author="mahadev" created="Wed, 17 Mar 2010 04:15:12 +0000"  >&lt;p&gt;I just ran ant test and it passed. I committed this!&lt;/p&gt;</comment>
                            <comment id="12846305" author="phunt" created="Wed, 17 Mar 2010 05:42:41 +0000"  >&lt;p&gt;this occassionally hangs for me, had to ctrl-c to kill it:&lt;/p&gt;

&lt;p&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; Zookeeper_simpleSystem::testAcl : elapsed 1022 : OK&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; Zookeeper_simpleSystem::testChroot : elapsed 3166 : OK&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; Zookeeper_simpleSystem::testAuth ZooKeeper server started : elapsed 25773 : OK&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; make: *** wait: No child processes.  Stop.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; make: *** Waiting for unfinished jobs....&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; make: *** wait: No child processes.  Stop.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; Zookeeper_simpleSystem::testHangingClient&lt;/p&gt;

&lt;p&gt;BUILD FAILED&lt;br/&gt;
/home/phunt/dev/workspace/gitzk/build.xml:866: The following error occurred while executing this line:&lt;br/&gt;
/home/phunt/dev/workspace/gitzk/build.xml:877: exec returned: 2&lt;/p&gt;</comment>
                            <comment id="12846324" author="hadoopqa" created="Wed, 17 Mar 2010 07:19:03 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12438988/ZOOKEEPER-591_1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12438988/ZOOKEEPER-591_1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 924065.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/29/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/29/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/29/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/29/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/29/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/29/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12846376" author="hudson" created="Wed, 17 Mar 2010 10:48:29 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #754 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/754/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/754/&lt;/a&gt;)&lt;br/&gt;
    . The C Client cannot exit properly in some situation (mahadev)&lt;/p&gt;</comment>
                            <comment id="12846595" author="mahadev" created="Wed, 17 Mar 2010 21:21:03 +0000"  >&lt;p&gt;this patch should fix the hang. The return code was wrong in queue_completions() which made calls hang!&lt;/p&gt;</comment>
                            <comment id="12846607" author="hadoopqa" created="Wed, 17 Mar 2010 21:49:14 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12439082/ZOOKEEPER-591_2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12439082/ZOOKEEPER-591_2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 924147.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no tests are needed for this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/30/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/30/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/30/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/30/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/30/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h1.grid.sp2.yahoo.net/30/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12846624" author="hudson" created="Wed, 17 Mar 2010 22:32:13 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #755 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/755/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/755/&lt;/a&gt;)&lt;br/&gt;
    . The C Client cannot exit properly in some situation&lt;/p&gt;</comment>
                            <comment id="12846713" author="phunt" created="Thu, 18 Mar 2010 01:45:01 +0000"  >&lt;p&gt;+1 on the latest patch. This seems to address the issue, no longer hanging on my machine, also not hanging on some other systems I tested (was hanging before). Great job Mahadev!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12438547" name="ZOOKEEPER-591.patch" size="4454" author="mahadev" created="Thu, 11 Mar 2010 22:41:38 +0000"/>
                            <attachment id="12438540" name="ZOOKEEPER-591.patch" size="2636" author="mahadev" created="Thu, 11 Mar 2010 21:21:57 +0000"/>
                            <attachment id="12438438" name="ZOOKEEPER-591.patch" size="2445" author="mahadev" created="Wed, 10 Mar 2010 19:09:00 +0000"/>
                            <attachment id="12438345" name="ZOOKEEPER-591.patch" size="498" author="mahadev" created="Wed, 10 Mar 2010 00:13:17 +0000"/>
                            <attachment id="12439006" name="ZOOKEEPER-591_1.patch" size="4222" author="mahadev" created="Wed, 17 Mar 2010 04:13:51 +0000"/>
                            <attachment id="12439005" name="ZOOKEEPER-591_1.patch" size="4222" author="mahadev" created="Wed, 17 Mar 2010 04:13:38 +0000"/>
                            <attachment id="12438988" name="ZOOKEEPER-591_1.patch" size="4215" author="mahadev" created="Wed, 17 Mar 2010 00:35:46 +0000"/>
                            <attachment id="12439082" name="ZOOKEEPER-591_2.patch" size="397" author="mahadev" created="Wed, 17 Mar 2010 21:21:03 +0000"/>
                            <attachment id="12438528" name="zootest.c" size="1265" author="mahadev" created="Thu, 11 Mar 2010 19:19:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 19 Jan 2010 17:50:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47711</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzuun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32982</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Zookeeper C Client</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>