<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:43:09 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-29/ZOOKEEPER-29.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-29] Flexible quorums</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-29</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;Moved from SourceForge to Apache.&lt;br/&gt;
&lt;a href=&quot;http://sourceforge.net/tracker/index.php?func=detail&amp;amp;aid=1938782&amp;amp;group_id=209147&amp;amp;atid=1008547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://sourceforge.net/tracker/index.php?func=detail&amp;amp;aid=1938782&amp;amp;group_id=209147&amp;amp;atid=1008547&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12397992">ZOOKEEPER-29</key>
            <summary>Flexible quorums</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fpj">Flavio Junqueira</assignee>
                                    <reporter username="phunt">Patrick Hunt</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Jun 2008 23:12:38 +0100</created>
                <updated>Wed, 8 Jul 2009 21:23:55 +0100</updated>
                            <resolved>Fri, 24 Apr 2009 19:28:16 +0100</resolved>
                                                    <fixVersion>3.2.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12649648" author="fpj" created="Fri, 21 Nov 2008 11:53:19 +0000"  >&lt;p&gt;Currently quorums are majorities of processes. There are some cases, however, in which a system designer might want more flexibility to specify quorums. For example, applications running across data centers or even inside a data center when servers are spread across racks or simply different subnets. In such cases, we might want to perhaps split the set of servers into sub-groups and assign weights to the sub-groups.&lt;/p&gt;

&lt;p&gt;The main property that a majority of servers satisfy that matters for the correctness of ZooKeeper is the intersection property of such subsets. As long as subsets of servers intersect, they can be used as a quorum system for ZooKeeper.&lt;/p&gt;

&lt;p&gt;In the current code, whenever we need a quorum, we just check if the number is greater than n/2, where n is the total number of servers configured. My initial proposal is to move such a computation to a separate class, call it QuorumSpec for now, that reads a quorum configuration from a configuration file, and provides a method to check if a set of elements contains a quorum, call it &quot;containsQuorum&quot;. For example, if we want to check whether a set of votes when electing a leader contains a quorum, then we invoke &quot;containsQuorum&quot; on an instance of &quot;QuorumSpec&quot;.&lt;/p&gt;

&lt;p&gt;With respect to configuration, the most flexible way would be to enumerate all possible subsets. Such an option is tedious and prone to configuration errors, though. Instead, I thought of providing for splitting the servers into groups, and assigning weights to the groups. The semantics would the following. We have a quorum if we have votes from a subset of groups such that the sum of the weights of such groups is more than half of the total sum of weights. Also, we include a group in the previous computation only if we have a majority of votes from such a group.&lt;/p&gt;

&lt;p&gt;To illustrate, consider the following example. Suppose that we have 4 groups of servers with weights in parenthesis: A (2), B (1), C (1), and D (1). Now suppose that we have 3 servers in each group. We have a quorum if, for example, we have votes from two processes from each one of A and B. As another example, we have a quorum if we have two votes from processes in each one of B, C, and D.&lt;/p&gt;</comment>
                            <comment id="12694168" author="fpj" created="Tue, 31 Mar 2009 17:15:23 +0100"  >&lt;p&gt;This is a preliminary patch. It is not functional, but it gives an idea of what I&apos;m trying to do, so please comment if you have a chance to check it out.&lt;/p&gt;</comment>
                            <comment id="12697093" author="fpj" created="Wed, 8 Apr 2009 17:53:49 +0100"  >&lt;p&gt;This new patch is partially functional. FastLeaderElection and Leader use QuorumConfigMaj.&lt;/p&gt;

&lt;p&gt;It required a change to the server protocol because the leader currently doesn&apos;t have the identifiers of followers, which will be necessary when I add functionality to read quorum configuration from a file. &lt;/p&gt;</comment>
                            <comment id="12697112" author="mahadev" created="Wed, 8 Apr 2009 18:27:33 +0100"  >&lt;p&gt;flavio,&lt;br/&gt;
i just took a cursory look at the patch... i saw that you added an interface for config and another configuration QuorumConfigMaj. I was thinking of getting rid of all the config stuff and putting it into just a single serverconfig or something. Would it be possible for you to get rid of the these new configs and use the other configs already existing?&lt;/p&gt;</comment>
                            <comment id="12697182" author="fpj" created="Wed, 8 Apr 2009 21:29:55 +0100"  >&lt;p&gt;Mahadev, I&apos;m ok with moving the interface and the implementations of the interface elsewhere, but I&apos;m not sure I understand your proposal. On my side, I need an interface to represent any implementation that takes a set of servers and verifies if that set is a quorum or not. I currently have two implementations: one for majority and one for loading a quorum system from a file in the way described above. The implementation of the second one is not complete yet. In fact, I haven&apos;t implemented most of it.&lt;/p&gt;

&lt;p&gt;I find mixing this quorum representation with the current configuration a little messy, especially because it is an optional feature and it does correspond to a simple value loaded from a file. We need some logic to perform quorum verification aside from values that we load from a separate configuration file. &lt;/p&gt;</comment>
                            <comment id="12697220" author="stuhood" created="Wed, 8 Apr 2009 22:25:41 +0100"  >&lt;p&gt;Two comments:&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;This ticket seems to overlap with &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-368&quot; title=&quot;Observers: core functionality &quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-368&quot;&gt;&lt;del&gt;ZOOKEEPER-368&lt;/del&gt;&lt;/a&gt; to some degree: wouldn&apos;t an Observer simply be a server in the quorum that wouldn&apos;t get to vote on proposed values?&lt;/p&gt;

&lt;hr /&gt;

&lt;blockquote&gt;
&lt;p&gt;I find mixing this quorum representation with the current configuration a little messy, especially because it is an optional feature and it does correspond to a simple value loaded from a file. We need some logic to perform quorum verification aside from values that we load from a separate configuration file.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It could probably correspond to a key loaded from a flat file, if the key was hierarchial. It would require a bit of a config overhaul: rather than&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
server.1=ahost:2181:2888
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;.. you&apos;d want&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
server.1.hostname=ahost
server.1.port=2181
server.1.otherport=2888
server.1.weight=3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;...so then weight is optional, which defaults to an equal weight for all servers.&lt;/p&gt;</comment>
                            <comment id="12697364" author="fpj" created="Thu, 9 Apr 2009 02:55:21 +0100"  >&lt;p&gt;Thanks for you comments, Stu. The features of &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-368&quot; title=&quot;Observers: core functionality &quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-368&quot;&gt;&lt;del&gt;ZOOKEEPER-368&lt;/del&gt;&lt;/a&gt; and this one are different. You are right in that one way of implementing observers is to assign a weight of 0, assuming that we have a weight scheme as you propose. However, my current preference is to have observers not voting at all and being able to connect to followers. &lt;/p&gt;

&lt;p&gt;Your proposal for adding weights is certainly an option. However, if you read my initial proposal, I proposed something slightly more elaborate than the scheme you describe. And, because there are potentially several different ways we can express quorums, I thought it would be good to have a separate file describing a quorum system to leave it open to multiple implementations. We can then write different parsers and even having them co-existing, using a flag to select which one to use. &lt;/p&gt;

&lt;p&gt;Of course, we can mix all this with the current server configuration, but I think that setting the parameters of a server and declaring quorums are different concerns and should be in separate files. I understand that this is a matter of preference, though. &lt;/p&gt;</comment>
                            <comment id="12697378" author="mahadev" created="Thu, 9 Apr 2009 04:12:22 +0100"  >&lt;p&gt;flavio,&lt;br/&gt;
 can you elaborate on what else do you have in mind other than using weights for which the parsing/config interface would be useful?  It would be great to list some examples  on this jira.&lt;/p&gt;</comment>
                            <comment id="12697526" author="fpj" created="Thu, 9 Apr 2009 15:56:52 +0100"  >&lt;p&gt;This patch implements most of what I had in mind. I have changed the names of the classes I already had previously in an attempt to make more clear what they do. Also, I haven&apos;t tested extensively, and I need to write a unit test.&lt;/p&gt;

&lt;p&gt;After working out the details of the hierarchical construction I wanted to implement. I realized that perhaps you guys are right in that I should try to read the quorum description from QuorumPeerConfig because I ended up duplicating some code. In any case, check it out and give me feedback.&lt;/p&gt;</comment>
                            <comment id="12697527" author="fpj" created="Thu, 9 Apr 2009 16:01:07 +0100"  >&lt;p&gt;Here is a simple example of a hierarchical quorum construction (this is an example of a configuration file as it is currently implemented):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;group.1=1:2:3
group.2=4:5:6
group.3=7:8:9

weight.1=1
weight.2=1
weight.3=1
weight.4=1
weight.5=1
weight.6=1
weight.7=1
weight.8=1
weight.9=1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12699140" author="fpj" created="Wed, 15 Apr 2009 11:09:04 +0100"  >&lt;p&gt;I have written a unit test and changed the implementation to read the quorum configuration from QuorumPeerConfig as all the other parameters.&lt;/p&gt;</comment>
                            <comment id="12699286" author="fpj" created="Wed, 15 Apr 2009 18:16:23 +0100"  >&lt;p&gt;I&apos;d like to replace QuorumValidator with QuorumVerifier. It is just a small modification.&lt;/p&gt;</comment>
                            <comment id="12699287" author="fpj" created="Wed, 15 Apr 2009 18:17:20 +0100"  >&lt;p&gt;Uploading a new patch with the name of the interface changed.&lt;/p&gt;</comment>
                            <comment id="12699288" author="mahadev" created="Wed, 15 Apr 2009 18:17:57 +0100"  >&lt;p&gt;some questions on the patch &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;is it backwards compatible in the sense that if I do not specify groups and weights in the config then it will work as it used to?&lt;/li&gt;
	&lt;li&gt;also in the example that you mentioned above shouldnt the group size be atleast 5 since you have equal weights and 9 servers?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12699289" author="mahadev" created="Wed, 15 Apr 2009 18:40:03 +0100"  >&lt;p&gt;also,&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;why not just have groups and equal weights for first cut? wouldnt that suffice for the scenario of co located zookeeper servers?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12699336" author="fpj" created="Wed, 15 Apr 2009 20:46:15 +0100"  >&lt;p&gt;Mahadev, thanks for checking it out. Here are answers to your questions:&lt;/p&gt;

&lt;p&gt;1- With this patch, it defaults to majority if there is no declaration of groups and weights. We currently use majority quorums;&lt;br/&gt;
2- No, the example is fine. You have a quorum if you have at least two servers from two different groups;&lt;br/&gt;
3- I don&apos;t see a reason for having groups in a first cut and weights in a second. In fact, one typical way of specifying quorums is to assign weights, so even if a user is not interested in groups, the user can declare one group and assign weights.   &lt;/p&gt;</comment>
                            <comment id="12699407" author="fpj" created="Wed, 15 Apr 2009 22:40:29 +0100"  >&lt;p&gt;Just to motivate a little more this scheme, taking the example above, suppose that each group corresponds to the set of ZooKeeper servers in a colocation. To form a quorum, we just need to get a majority of servers from a majority of groups. This gives us quorums of size 4, whereas majority quorums would require 5. This model is reasonable, though, as it is reasonable to expect that at least a majority of colocations have a majority of servers up and running.  &lt;/p&gt;

&lt;p&gt;This idea actually appeared in the following citation (apologies for the self-reference): &lt;a href=&quot;http://dslab.epfl.ch/hotdep/2005/papers/junqueira_dependent.pdf&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dslab.epfl.ch/hotdep/2005/papers/junqueira_dependent.pdf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Another question that may arise is how leader election changes. With this scheme it only changes minimally. In the current trunk code, we always wait for a majority of votes, and that&apos;s because we have majority quorums hardcoded. With this patch, we check if we have a quorum, and a quorum can be a majority, as we have currently, or a different quorum system as the one of the example.&lt;/p&gt;</comment>
                            <comment id="12699436" author="breed" created="Thu, 16 Apr 2009 00:06:29 +0100"  >&lt;p&gt;this looks really good.&lt;/p&gt;

&lt;p&gt;you build an ackToString String, but don&apos;t use it. it&apos;s probably a left over debugging.&lt;/p&gt;

&lt;p&gt;i&apos;m wondering if it is a good idea to let the QuorumVerifier to be changed while the service is up. perhaps we should throw an exception in that case.&lt;/p&gt;

&lt;p&gt;could you document the configuration of the hierarchical QuorumVerifier? it would also be good to expand the description in the javadoc at the top of QuorumHierarchical?&lt;/p&gt;</comment>
                            <comment id="12699578" author="fpj" created="Thu, 16 Apr 2009 09:18:37 +0100"  >&lt;p&gt;Canceling patch to implement suggestions.  &lt;/p&gt;</comment>
                            <comment id="12699651" author="fpj" created="Thu, 16 Apr 2009 12:42:42 +0100"  >&lt;p&gt;New patch with comments addressed.&lt;/p&gt;</comment>
                            <comment id="12699661" author="fpj" created="Thu, 16 Apr 2009 12:55:16 +0100"  >&lt;p&gt;&amp;gt; you build an ackToString String, but don&apos;t use it. it&apos;s probably a left over debugging.&lt;/p&gt;

&lt;p&gt;I forgot to add to add the string to the message following it. I have fixed it in the new patch.   &lt;/p&gt;

&lt;p&gt;&amp;gt; i&apos;m wondering if it is a good idea to let the QuorumVerifier to be changed while the service &lt;br/&gt;
&amp;gt; is up. perhaps we should throw an exception in that case.&lt;/p&gt;

&lt;p&gt;If I interpret your comment correctly, you&apos;re concerned about calls to QuorumPeer::setQuorumVerifier after initialization. As far as I can tell, we have the same issue with other variables. For example, if we change the quorum port on-the-fly, we might get into trouble. Actually, changing the QuorumVerifier on-the-fly doesn&apos;t seem to cause a server to stop operating. The only issue I can see is that a server may have a different notion of quorums, but I think this can happen even if we enforce that we set the QuorumVerifier only during initialization. We guarantee that servers have consistent configuration files, right?&lt;/p&gt;

&lt;p&gt;If you think this is a general issue with initialization, we should perhaps open a different jira and address this problem there? &lt;/p&gt;

&lt;p&gt;&amp;gt; could you document the configuration of the hierarchical QuorumVerifier? it would also be &lt;br/&gt;
&amp;gt; good to expand the description in the javadoc at the top of QuorumHierarchical?&lt;/p&gt;

&lt;p&gt;Done. Let me know if you think it is sufficient.&lt;/p&gt;</comment>
                            <comment id="12699771" author="breed" created="Thu, 16 Apr 2009 18:20:39 +0100"  >&lt;p&gt;+1 looks good. marking patch available so that qa can run against it.&lt;/p&gt;</comment>
                            <comment id="12699796" author="mahadev" created="Thu, 16 Apr 2009 19:30:57 +0100"  >&lt;p&gt;sorry to be commenting late on the patch flavio,&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;minor nit - there is an unneccesary change in AuthFastLeaderElection.java&lt;/li&gt;
	&lt;li&gt;I see changes to FastLeaderElection but no changes in LeaderElection. Shouldnt both of them change.&lt;/li&gt;
	&lt;li&gt;also this breaks backward comtability with servers, should this go into 4.0? or is 3.2 fine?&lt;/li&gt;
	&lt;li&gt;isnt the sid sent only once so why do we have that in a loop -&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
       &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
                &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; Leader.SID:
                    bb = ByteBuffer.wrap(qp.getData());
                    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.sid = bb.getLong();
                    
                    &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;  
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;do we expect the followers to keep sending the SID?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I think this code is wrong in Leader.java (line 297 or so)&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 HashSet&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt; followerSet = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt;();
                    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(FollowerHandler f : followers)
                        followerSet.add(f.getSid());
                    
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (self.getQuorumVerifier().containsQuorum(followerSet)) {
                    &lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (followers.size() &amp;gt;= self.quorumPeers.size() / 2) {
&lt;/span&gt;                        LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Enough followers present. &quot;&lt;/span&gt;+
                                &quot;Perhaps the init 
 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The reason being the sid is always set to 0 even if the follower hasnt been able to be synced with the leader &lt;br/&gt;
and sent back the sid &amp;#8211; which is the above case. So mostly the above statement would never execute since &lt;br/&gt;
the sid is only sent after the follower synchronizes the database. Meaning that your code would not be able &lt;br/&gt;
to estimate if you had the right set of followers with the SID. Why isnt the SID sent as the first packet when&lt;br/&gt;
syncing up with the leader as a payload? Why do we need another protocol change? &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;also it would be good to have checking in groups and weights (mostly for mistakes that people would make). You can see&lt;br/&gt;
that it gets really easy to make mistakes with this configuration pattern. We should have more error checking (like serverid belongs &lt;br/&gt;
to some unique group) and also in cases like 
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;((serverWeight.size() &amp;gt; 0) &amp;amp;&amp;amp;
                    (serverGroup.size() &amp;gt; 0) &amp;amp;&amp;amp; 
                    (servers.size() == serverGroup.size())){
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;          &lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;where only one or two of the above statements are true, we should fail saying that some problem on the config files rather than&lt;br/&gt;
resorting to majority config. We can do it in seperate jira.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;sorry for being naive, you mentioned in the comments that &quot;This gives us quorums of size 4, whereas majority quorums would require 5.&quot; . What are&lt;br/&gt;
the implications of this? Meaning is their anycase where the servers can diverge on the databases?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12699804" author="mahadev" created="Thu, 16 Apr 2009 19:46:35 +0100"  >&lt;p&gt;also we should have (forrest) documentation for the new configuration style for groups and servers. &lt;/p&gt;</comment>
                            <comment id="12699806" author="fpj" created="Thu, 16 Apr 2009 19:53:52 +0100"  >&lt;p&gt;I forgot to say that with the new patch, we assign a weight of 1 by default to servers. That is, if a user defines groups, but not the weights, then servers will get a weight of 1.&lt;/p&gt;</comment>
                            <comment id="12699808" author="mahadev" created="Thu, 16 Apr 2009 19:58:59 +0100"  >&lt;p&gt;I am +1 on putting in 3.2 since it does not break any compatibility with database and clients (only that 3.1.1 servers cannot run with 3.2 servers) which I think is fine.&lt;/p&gt;</comment>
                            <comment id="12699951" author="hadoopqa" created="Fri, 17 Apr 2009 01:53:06 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12405640/ZOOKEEPER-29.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12405640/ZOOKEEPER-29.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 765797.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 21 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 3 new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/36/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/36/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/36/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/36/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/36/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/36/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12700082" author="fpj" created="Fri, 17 Apr 2009 09:40:18 +0100"  >&lt;p&gt;Thanks for your comments, Mahadev. Here are my response based on our discussion:&lt;/p&gt;

&lt;p&gt;1- Using this new feature with FastLeaderElection is easier because the protocol already exchanges server ids. It will require more modifications to move LeaderElection and AuthFastLeaderElection, so I propose to work on it in a different jira. If a user decides to use one of these implementations, then only majority quorums will be available;&lt;br/&gt;
2- Mahadev suggested to change the LASTZXID message to FOLLOWERINFO and send both the lastzxid and the server id in the same message. The main reason for doing this is to avoid creating a new message every time we have to send a new piece of information. I think it is a good suggestion, so I&apos;ll implement it in the next patch;&lt;br/&gt;
3- The SID case is in the loop just in case we receive a stray message. It shouldn&apos;t happen with this patch, so I&apos;m ok with removing it. In fact, with modification of 2, that case will have to go anyway;&lt;br/&gt;
4- We agreed that the problem pointed out in Leader.java:297 is not really a problem because SID is the first message sent. The same will happen with the modification of 2;&lt;br/&gt;
5- Mahadev suggests that instead of falling back to majority if there is a problem with the group configuration, we should throw an exception. I&apos;m ok with that suggestion;&lt;br/&gt;
6- Although it may seem that using quorums of size 4 with 9 replicas may cause replicas to diverge, it is simple exercise to verify that all quorums constructed hierarchically in the way proposed are guaranteed to intersect. All we need to guarantee that replicas won&apos;t diverge is that quorums intersect. Majority quorums trivially intersect;&lt;br/&gt;
7-  I don&apos;t think the failure in the test is due to this patch. I looked over the results and it is due to testRecovery failing due to &quot;unreasonable length&quot;. Isn&apos;t it the issue of &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-367&quot; title=&quot;RecoveryTest failure - &amp;quot;unreasonable length&amp;quot; IOException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-367&quot;&gt;&lt;del&gt;ZOOKEEPER-367&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="12700121" author="fpj" created="Fri, 17 Apr 2009 11:50:57 +0100"  >&lt;p&gt;Re-submitting patch with suggested modifications.&lt;/p&gt;</comment>
                            <comment id="12700134" author="fpj" created="Fri, 17 Apr 2009 12:38:40 +0100"  >&lt;p&gt;Fixing the problems pointed by findbugs.&lt;/p&gt;</comment>
                            <comment id="12700215" author="breed" created="Fri, 17 Apr 2009 16:45:42 +0100"  >&lt;p&gt;i like the idea of doing the FOLLOWERINFO and adding the server id in there.&lt;/p&gt;</comment>
                            <comment id="12700291" author="hadoopqa" created="Fri, 17 Apr 2009 20:15:20 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12405754/ZOOKEEPER-29.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12405754/ZOOKEEPER-29.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 766107.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 22 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/39/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/39/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/39/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/39/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/39/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/39/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12700319" author="mahadev" created="Fri, 17 Apr 2009 21:33:54 +0100"  >&lt;p&gt;their is a very easy way to make this backwards compatible after we moved to the payload design. The payload would only be added if the server has itself configured to be group *.  This way the new server can talk to the old servers and their wont be any opposition to getting this into 3.2 (instead of 4)... &lt;/p&gt;</comment>
                            <comment id="12700328" author="mahadev" created="Fri, 17 Apr 2009 22:10:34 +0100"  >&lt;p&gt;i realized that it wont be easy becasue the quorum verifuer and other would still need SID to function right.. &lt;/p&gt;</comment>
                            <comment id="12700341" author="phunt" created="Fri, 17 Apr 2009 22:48:06 +0100"  >&lt;p&gt;Just a reminder, non-backward compatible changes will have to wait for 4.0. It would be great to figure out a way to support this for 3.2.&lt;/p&gt;</comment>
                            <comment id="12700382" author="hadoopqa" created="Sat, 18 Apr 2009 00:47:56 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12405754/ZOOKEEPER-29.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12405754/ZOOKEEPER-29.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 766160.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 22 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/40/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/40/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/40/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/40/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/40/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/40/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12700581" author="fpj" created="Sun, 19 Apr 2009 12:53:31 +0100"  >&lt;p&gt;I made an attempt at making the protocol backward compatible. Basically, a FollowerHandler is able to interpret both FOLLOWERINFO message and LASTZXID. If it receives a LASTZXID message, it generates a unique id number that does not correspond to the server id, but ti doesn&apos;t matter if we are using majority because for majority we only need to count votes. Of course, if a user tries to use hierarchical quorums with servers running older versions, it won&apos;t work.   &lt;/p&gt;</comment>
                            <comment id="12700744" author="fpj" created="Mon, 20 Apr 2009 11:26:15 +0100"  >&lt;p&gt;I have realized that with the previous patch it wouldn&apos;t be backward compatible because a new follower would never send a LASTZXID, and an old leader wouldn&apos;t understand a FOLLOWERINFO message. This new patch gets rid of FOLLOWERINFO and only uses LASTZXID, and it seems to work fine. &lt;/p&gt;

&lt;p&gt;My preference is to stick with LASTZXID for now, if keeping it backward compatible is really necessary, and consider updating it for 4.0.  &lt;/p&gt;</comment>
                            <comment id="12700803" author="hadoopqa" created="Mon, 20 Apr 2009 15:28:19 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12405927/ZOOKEEPER-29.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12405927/ZOOKEEPER-29.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 766160.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 21 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to cause Findbugs to fail.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/42/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/42/testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/42/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/42/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12700808" author="fpj" created="Mon, 20 Apr 2009 15:39:29 +0100"  >&lt;p&gt;The previous patch didn&apos;t compile properly. I have fixed the problem and I&apos;m submitting again.&lt;/p&gt;</comment>
                            <comment id="12701051" author="mahadev" created="Tue, 21 Apr 2009 05:38:35 +0100"  >&lt;blockquote&gt;
&lt;p&gt;I have realized that with the previous patch it wouldn&apos;t be backward compatible because a new follower would never send a LASTZXID, and an old leader wouldn&apos;t understand a FOLLOWERINFO message. This new patch gets rid of FOLLOWERINFO and only uses LASTZXID, and it seems to work fine.&lt;br/&gt;
My preference is to stick with LASTZXID for now, if keeping it backward compatible is really necessary, and consider updating it for 4.0.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;great... this is what I was thinking and was going to propose.. I dont see any problems with changing it to FOLLOWERINFO in this patch (but its up to you)... &lt;/p&gt;</comment>
                            <comment id="12701054" author="mahadev" created="Tue, 21 Apr 2009 06:00:32 +0100"  >&lt;p&gt;by chaning it to FOLLOWERINFO I meant just changing the name from LASTZXID to FOLLOWEINFO (keepeing the int value). So its just a name change for code readability and nothing else.&lt;/p&gt;</comment>
                            <comment id="12701058" author="hadoopqa" created="Tue, 21 Apr 2009 06:15:03 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12405929/ZOOKEEPER-29.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12405929/ZOOKEEPER-29.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 766897.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 21 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/44/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/44/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/44/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/44/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/44/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/44/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12701111" author="fpj" created="Tue, 21 Apr 2009 10:09:05 +0100"  >&lt;p&gt;I&apos;m replacing LASTZXID with FOLLOWERINFO. Also, I checked the results of QA and it seems to be failing on a C client test, which is unrelated to this issue. In fact, when I follow the link to the test results, it says that no test has failed, but if you look at the console output there is a failure for one of the C tests:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[exec]      [exec] Zookeeper_simpleSystem::testAsyncWatcherAutoReset : assertion
     [exec]      [exec] 
     [exec]      [exec] /home/hudson/hudson-slave/workspace/Zookeeper-Patch-vesta.apache.org/trunk/src/c/tests/TestClient.cc:273: Assertion: equality assertion failed [Expected: -101, Actual  : 0]
     [exec]      [exec] Failures !!!
     [exec]      [exec] Run: 32   Failure total: 1   Failures: 1   Errors: 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12701137" author="hadoopqa" created="Tue, 21 Apr 2009 12:13:01 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12406013/ZOOKEEPER-29.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12406013/ZOOKEEPER-29.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 766897.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 22 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/45/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/45/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/45/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/45/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/45/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/45/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12701139" author="fpj" created="Tue, 21 Apr 2009 12:40:18 +0100"  >&lt;p&gt;There is something strange with the test result. If we check the console output of test number 45 (the latest one for this patch), we find:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[exec]      [exec] Zookeeper_simpleSystem::testAsyncWatcherAutoReset : assertion
     [exec]      [exec] 
     [exec]      [exec] /home/hudson/hudson-slave/workspace/Zookeeper-Patch-vesta.apache.org/trunk/src/c/tests/TestClient.cc:273: Assertion: equality assertion failed [Expected: -101, Actual  : 0]
     [exec]      [exec] Failures !!!
     [exec]      [exec] Run: 32   Failure total: 1   Failures: 1   Errors: 0
     [exec]      [exec] make: *** [run-check] Error 1
     [exec] 
     [exec] BUILD FAILED
     [exec] /home/hudson/hudson-slave/workspace/Zookeeper-Patch-vesta.apache.org/trunk/build.xml:612: The following error occurred while executing this line:
     [exec] /home/hudson/hudson-slave/workspace/Zookeeper-Patch-vesta.apache.org/trunk/build.xml:622: exec returned: 2
     [exec] 
     [exec] Total time: 8 minutes 52 seconds
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This same failure also appears in the trunk test, but it doesn&apos;t cause the whole check to fail:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[exec] /home/hudson/hudson-slave/workspace/ZooKeeper-trunk/trunk/src/c/tests/TestClient.cc:273: Assertion: equality assertion failed [Expected: -101, Actual  : 0]
     [exec] Failures !!!
     [exec] Run: 32   Failure total: 1   Failures: 1   Errors: 0
     [exec] make: *** [run-check] Error 1
     [exec] Result: 2

test-core-cppunit:

test-core:

test-contrib:

BUILD SUCCESSFUL
Total time: 9 minutes 32 seconds
Recording fingerprints
Publishing Javadoc
Recording test results
finished: SUCCESS
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Am I reading it wrong?&lt;/p&gt;</comment>
                            <comment id="12701191" author="phunt" created="Tue, 21 Apr 2009 17:29:24 +0100"  >&lt;p&gt;Giri is working on getting cppunit integrated into the patch/build process on hudson.&lt;/p&gt;

&lt;p&gt;There was a recent change where cppunit failures used to be ignored, now they are not.&lt;br/&gt;
Try pinging Giri.&lt;/p&gt;</comment>
                            <comment id="12701307" author="mahadev" created="Wed, 22 Apr 2009 00:06:24 +0100"  >&lt;p&gt;this patch looks good. The only thing being -&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;QuorumPeer should have a new constructor that adds a parameter rather than replacing the old parameter for backwards compatibility&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;other than that everything else looks good.&lt;/p&gt;</comment>
                            <comment id="12701471" author="fpj" created="Wed, 22 Apr 2009 11:13:55 +0100"  >&lt;p&gt;Thanks for the suggestion, Mahadev. I have implemented your suggestion in this new patch. I have also done a couple of other things:&lt;/p&gt;

&lt;p&gt;1- I have fixed a bug on FollowerHandler. We should be checking if &quot;qp.getData() == null&quot; instead of checking if &quot;qp.getData().length &amp;gt; 0&quot;. With the current protocol, a follower wont&apos;t send any data, and qp.getData will be null;&lt;br/&gt;
2- I have removed ackCount from the Leader::Proposal class. It is not necessary given that we are keeping a set.&lt;/p&gt;

&lt;p&gt;All java tests pass for me.&lt;/p&gt;</comment>
                            <comment id="12701553" author="hadoopqa" created="Wed, 22 Apr 2009 15:40:53 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12406121/ZOOKEEPER-29.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12406121/ZOOKEEPER-29.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 766897.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/47/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/47/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/47/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/47/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/47/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/47/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12702478" author="mahadev" created="Fri, 24 Apr 2009 19:28:16 +0100"  >&lt;p&gt;+1 to the patch... &lt;br/&gt;
minor nits (though I took care of it) &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;avoid using tabs in forrest docs&lt;/li&gt;
	&lt;li&gt;run forrest before you submit doc changes &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I just committed this. thanks flavio.&lt;/p&gt;</comment>
                            <comment id="12702711" author="hudson" created="Sat, 25 Apr 2009 16:38:12 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #290 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/290/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/290/&lt;/a&gt;)&lt;br/&gt;
    . Flexible quorums (flavio via mahadev)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12406121" name="ZOOKEEPER-29.patch" size="46063" author="fpj" created="Wed, 22 Apr 2009 11:13:55 +0100"/>
                            <attachment id="12406013" name="ZOOKEEPER-29.patch" size="51807" author="fpj" created="Tue, 21 Apr 2009 10:09:05 +0100"/>
                            <attachment id="12405929" name="ZOOKEEPER-29.patch" size="50468" author="fpj" created="Mon, 20 Apr 2009 15:39:29 +0100"/>
                            <attachment id="12405927" name="ZOOKEEPER-29.patch" size="50786" author="fpj" created="Mon, 20 Apr 2009 13:27:16 +0100"/>
                            <attachment id="12405926" name="ZOOKEEPER-29.patch" size="51148" author="fpj" created="Mon, 20 Apr 2009 13:24:20 +0100"/>
                            <attachment id="12405911" name="ZOOKEEPER-29.patch" size="50714" author="fpj" created="Mon, 20 Apr 2009 11:26:15 +0100"/>
                            <attachment id="12405874" name="ZOOKEEPER-29.patch" size="50712" author="fpj" created="Sun, 19 Apr 2009 12:53:31 +0100"/>
                            <attachment id="12405754" name="ZOOKEEPER-29.patch" size="50304" author="fpj" created="Fri, 17 Apr 2009 12:38:40 +0100"/>
                            <attachment id="12405752" name="ZOOKEEPER-29.patch" size="50050" author="fpj" created="Fri, 17 Apr 2009 11:51:40 +0100"/>
                            <attachment id="12405640" name="ZOOKEEPER-29.patch" size="45007" author="fpj" created="Thu, 16 Apr 2009 12:42:41 +0100"/>
                            <attachment id="12405549" name="ZOOKEEPER-29.patch" size="43934" author="fpj" created="Wed, 15 Apr 2009 18:17:20 +0100"/>
                            <attachment id="12405518" name="ZOOKEEPER-29.patch" size="44747" author="fpj" created="Wed, 15 Apr 2009 11:09:04 +0100"/>
                            <attachment id="12405075" name="ZOOKEEPER-29.patch" size="32541" author="fpj" created="Thu, 9 Apr 2009 15:56:52 +0100"/>
                            <attachment id="12404984" name="ZOOKEEPER-29.patch" size="20760" author="fpj" created="Wed, 8 Apr 2009 17:53:49 +0100"/>
                            <attachment id="12404346" name="ZOOKEEPER-29.patch" size="10043" author="fpj" created="Wed, 1 Apr 2009 17:13:48 +0100"/>
                            <attachment id="12404249" name="ZOOKEEPER-29.patch" size="6474" author="fpj" created="Tue, 31 Mar 2009 17:15:23 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 21 Nov 2008 11:53:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48099</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzytj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33625</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Flexible quorums in zookeeper.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>