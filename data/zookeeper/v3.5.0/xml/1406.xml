<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:40:49 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1406/ZOOKEEPER-1406.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1406] dpkg init scripts don&apos;t restart - missing check_priv_sep_dir</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1406</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;The included init.d script for dpkg creation doesn&apos;t restart.&lt;/p&gt;

&lt;p&gt;It exits with the following error:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&amp;#35; /etc/init.d/zookeeper restart&lt;br/&gt;
/etc/init.d/zookeeper: 127: check_privsep_dir: not found&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Also the actual zkServer.sh line in restart has a path of .../bin/ rather than .../sbin/&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Linux Ubuntu 10.4 lucid - presumably affects debian too, but not tested here&lt;/p&gt;</environment>
        <key id="12545302">ZOOKEEPER-1406</key>
            <summary>dpkg init scripts don&apos;t restart - missing check_priv_sep_dir</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ericthecat">Chris Beauchamp</assignee>
                                    <reporter username="ericthecat">Chris Beauchamp</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Mar 2012 09:14:03 +0000</created>
                <updated>Sun, 18 Mar 2012 11:00:40 +0000</updated>
                            <resolved>Sun, 18 Mar 2012 06:50:37 +0000</resolved>
                                    <version>3.4.3</version>
                                    <fixVersion>3.4.4</fixVersion>
                    <fixVersion>3.5.0</fixVersion>
                                    <component>scripts</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13223118" author="ericthecat" created="Tue, 6 Mar 2012 09:17:26 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;--- zookeeper/zookeeper-3.4.3/src/packages/deb/init.d/zookeeper	2012-02-06 10:48:40.000000000 +0000
+++ zookeeper.new	2012-03-06 08:37:57.566109535 +0000
@@ -34,7 +34,17 @@
 
 . /lib/lsb/init-functions
 
-ZOOPIDFILE=/var/lib/zookeeper/data/zookeeper_server.pid
+ZOOPIDDIR=/var/lib/zookeeper/data
+ZOOPIDFILE=${ZOOPIDDIR}/zookeeper_server.pid
+
+check_privsep_dir() {
+    # Create the PrivSep empty dir if necessary
+    if [ ! -d ${ZOOPIDDIR} ]; then
+	mkdir -p ${ZOOPIDDIR}
+        chown zookeeper:hadoop ${ZOOPIDDIR}
+	chmod 0775 ${ZOOPIDDIR} 
+    fi
+}
 
 # Are we running from init?
 run_by_init() {
@@ -59,6 +69,7 @@
 case &quot;$1&quot; in
   start)
 	check_for_no_start
+	check_privsep_dir
 	log_daemon_msg &quot;Starting Apache ZooKeeper server&quot; &quot;zookeeper&quot;
 	if start-stop-daemon --start --quiet --oknodo --pidfile ${ZOOPIDFILE} -c zookeeper -x ${ZOOKEEPER_PREFIX}/sbin/zkServer.sh start; then
 	    log_end_msg 0
@@ -80,7 +91,7 @@
 	log_daemon_msg &quot;Restarting Apache ZooKeeper server&quot; &quot;zookeeper&quot;
 	start-stop-daemon --stop --quiet --oknodo --retry 30 --pidfile ${ZOOPIDFILE}
 	check_for_no_start log_end_msg
-	if start-stop-daemon --start --quiet --oknodo --pidfile ${ZOOPIDFILE} -c zookeeper -x ${ZOOKEEPER_PREFIX}/bin/zkServer.sh start; then
+	if start-stop-daemon --start --quiet --oknodo --pidfile ${ZOOPIDFILE} -c zookeeper -x ${ZOOKEEPER_PREFIX}/sbin/zkServer.sh start; then
 	    log_end_msg 0
 	else
 	    log_end_msg 1
@@ -98,7 +109,7 @@
 	    0)
 		# old daemon stopped
 		check_for_no_start log_end_msg
-		if start-stop-daemon --start --quiet --oknodo --pidfile ${ZOOPIDFILE} -c zookeeper -x ${ZOOKEEPER_PREFIX}/bin/zkServer.sh start; then
+		if start-stop-daemon --start --quiet --oknodo --pidfile ${ZOOPIDFILE} -c zookeeper -x ${ZOOKEEPER_PREFIX}/sbin/zkServer.sh start; then
 		    log_end_msg 0
 		else
 		    log_end_msg 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13223119" author="ericthecat" created="Tue, 6 Mar 2012 09:18:29 +0000"  >&lt;p&gt;Have attached a patch which should fix it - check_privsep_dir shamelessly lifted from hadoop&apos;s init script &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and other minor tweaks&lt;/p&gt;</comment>
                            <comment id="13223455" author="phunt" created="Tue, 6 Mar 2012 17:37:52 +0000"  >&lt;p&gt;Great artists steal. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Thanks. Would you mind attaching that as a patch file? (and select the &quot;grant&quot; option when doing so).&lt;br/&gt;
&lt;a href=&quot;https://cwiki.apache.org/confluence/display/ZOOKEEPER/HowToContribute&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://cwiki.apache.org/confluence/display/ZOOKEEPER/HowToContribute&lt;/a&gt;&lt;br/&gt;
Regards.&lt;/p&gt;</comment>
                            <comment id="13224323" author="ericthecat" created="Wed, 7 Mar 2012 13:27:45 +0000"  >&lt;p&gt;Patch Attached&lt;/p&gt;</comment>
                            <comment id="13224326" author="ericthecat" created="Wed, 7 Mar 2012 13:29:15 +0000"  >&lt;p&gt;All done, hopefully in the right way - thanks.&lt;/p&gt;</comment>
                            <comment id="13224341" author="hadoopqa" created="Wed, 7 Mar 2012 13:55:34 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12517398/ZOOKEEPER-1406.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12517398/ZOOKEEPER-1406.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1297740.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/980//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/980//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/980//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/980//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/980//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/980//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13232195" author="phunt" created="Sun, 18 Mar 2012 06:50:39 +0000"  >&lt;p&gt;Thanks Chris!&lt;/p&gt;</comment>
                            <comment id="13232255" author="hudson" created="Sun, 18 Mar 2012 11:00:40 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #1498 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/1498/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/1498/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1406&quot; title=&quot;dpkg init scripts don&amp;#39;t restart - missing check_priv_sep_dir&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1406&quot;&gt;&lt;del&gt;ZOOKEEPER-1406&lt;/del&gt;&lt;/a&gt;. dpkg init scripts don&apos;t restart - missing check_priv_sep_dir (Chris Beauchamp via phunt) (Revision 1302069)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
phunt : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1302069&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1302069&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/packages/deb/init.d/zookeeper&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12517398" name="ZOOKEEPER-1406.patch" size="1968" author="ericthecat" created="Wed, 7 Mar 2012 13:27:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 6 Mar 2012 17:37:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>230488</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzsav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32569</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>