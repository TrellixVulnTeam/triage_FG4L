<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:42:07 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-231/ZOOKEEPER-231.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-231] Quotas in zookeeper</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-231</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;creating quota&apos;s in zookeeper so that a runaway application does not bring down the zookeeper cluster.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12409025">ZOOKEEPER-231</key>
            <summary>Quotas in zookeeper</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mahadev">Mahadev konar</assignee>
                                    <reporter username="mahadev">Mahadev konar</reporter>
                        <labels>
                    </labels>
                <created>Fri, 21 Nov 2008 21:13:13 +0000</created>
                <updated>Fri, 13 Feb 2009 21:18:50 +0000</updated>
                            <resolved>Tue, 3 Feb 2009 05:26:51 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>3.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12649797" author="mahadev" created="Fri, 21 Nov 2008 21:14:21 +0000"  >&lt;p&gt;I will put up a proposal shortly ... &lt;/p&gt;</comment>
                            <comment id="12650406" author="mahadev" created="Tue, 25 Nov 2008 00:19:46 +0000"  >&lt;p&gt;here is a proposal for quotas &amp;#8211; &lt;/p&gt;

&lt;p&gt;The goal:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;prevent run away processes or applications bringing down the service.&lt;/li&gt;
	&lt;li&gt;providing admins to look at usage and being able to monitor proactively&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;What kind of quoata would we have&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;namespace quotas&lt;/li&gt;
	&lt;li&gt;bytes quota&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Proposal:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Reserve the node /zookeeper for zookeeper stats and zookeeper data management.&lt;/li&gt;
	&lt;li&gt;reserve /zookeeper/quota/ for quota related data structures&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The proposal is to have subtree based quotas for the number of bytes and number of nodes as well.&lt;br/&gt;
The monitoring of quotas and stats should be availabe through the command port &lt;br/&gt;
and through zookeeper itself via the /zookeeper node.&lt;/p&gt;

&lt;p&gt;The proposal is to have something like &lt;br/&gt;
/zookeeper/quota/path/limits/size&lt;br/&gt;
/zookeeper/quota/path/usage/size&lt;br/&gt;
/zookeeper/quota/path/limits/count&lt;br/&gt;
/zookeeper/quota/path/usage/count&lt;/p&gt;

&lt;p&gt;limits are the stored values that signify the limit for a subtree path&lt;br/&gt;
and usage denote the actual usage of the subtree in terms of bytes or count or number of writes/reads.&lt;/p&gt;</comment>
                            <comment id="12650679" author="aw" created="Tue, 25 Nov 2008 18:54:55 +0000"  >&lt;p&gt;so we eat sizeof(path)x8 to set quotas?  isn&apos;t that excessive?  also seems overly difficult to administer.&lt;/p&gt;</comment>
                            <comment id="12650708" author="ksankar" created="Tue, 25 Nov 2008 19:57:59 +0000"  >&lt;p&gt;Couple of points:&lt;br/&gt;
a) We could set the &lt;b&gt;total&lt;/b&gt; bytes used by one client. If it is a runaway process, sooner or later it will exceed the limit anway&lt;br/&gt;
b)How would we handle the identity ? Do we assume a secure environment or a hostile one ? Reason being, if someone wants to expose ZooKeeper as an internet service, wat kind of safeguards do we need ? Secure identity mechanisms ? &lt;/p&gt;</comment>
                            <comment id="12650709" author="ksankar" created="Tue, 25 Nov 2008 20:03:25 +0000"  >&lt;p&gt;Sorry for the second comment.&lt;br/&gt;
I suddenly realized, what Mahadev is proposing is a per path quota and not a per client quota. SO when a path exceeds a limit, we just prune the path. A runaway client most probably will again fillup the path and we prune again.&lt;br/&gt;
May be we should have a per client model /zookeeper/quota/&amp;lt;ipAddress&amp;gt;/usage. ust accumulate the siz of all artifacts the client stores with ZooKeeper. Of course, when the limit exceeds, we would have to deny storage for that client and this has the potential for DOS.&lt;/p&gt;</comment>
                            <comment id="12650727" author="mahadev" created="Tue, 25 Nov 2008 20:38:19 +0000"  >&lt;p&gt;in response to allen&apos;s comments:&lt;/p&gt;

&lt;p&gt;we expect that the admin&apos;s will have some common subtree for users/apps&lt;br/&gt;
something like /apps/app1 &amp;#8211; &lt;/p&gt;

&lt;p&gt;so in that case it would just add one node for a new user and in zookeeepr 1 node corresponds to 100 bytes or so.&lt;/p&gt;

&lt;p&gt;so usage should not be a problem.&lt;/p&gt;

&lt;p&gt;also regarding administration, we will expose the setting and getting of these quotas using jmx and will have command line tools to do that and get stats. &lt;/p&gt;


&lt;p&gt;@krishna&apos;s comments:&lt;/p&gt;

&lt;p&gt;it would a huge overhead to track usage/stats per client since the clients are usually distributed and of the ordeor of thousands.&lt;br/&gt;
does that make sense?&lt;/p&gt;</comment>
                            <comment id="12650731" author="phunt" created="Tue, 25 Nov 2008 20:55:39 +0000"  >&lt;p&gt;Another issue with perclient tracking - what if an IP is running multiple clients (within or across processes). It seems to me that having quotas based on subtrees (application/service) make much more sense.&lt;/p&gt;

&lt;p&gt;/app/app1 10mb&lt;br/&gt;
/app/app2/service1 10mb&lt;br/&gt;
/app/app2/service2 10mb&lt;br/&gt;
/app/app3 30mb&lt;br/&gt;
etc...&lt;/p&gt;

&lt;p&gt;Regardless of the number of clients i&apos;ve limited a particular service/application to a set space.&lt;/p&gt;</comment>
                            <comment id="12650736" author="ksankar" created="Tue, 25 Nov 2008 21:10:19 +0000"  >&lt;p&gt;@Mahadev:&lt;br/&gt;
I thought there would be much more trees than clients. So if tracking per client is high overhead, wouldn&apos;t that apply to the trees ? What is the normal arit between clients/trees ? Again we are talking about clients that store something not the ones that refer to the nodes&lt;br/&gt;
@Patrick&lt;br/&gt;
Application/Service makes sense, but how would we reliably know the app name and also deal efficiently with duplicates ?&lt;/p&gt;</comment>
                            <comment id="12650742" author="mahadev" created="Tue, 25 Nov 2008 21:30:03 +0000"  >&lt;p&gt;@krishna:&lt;br/&gt;
a distributed application say A1 might have thousands of clients of Zookeeper. So, the idea is that the admins assign /apps/a1 for application A1 (set them up with proper acls so that only A1 is able to access it). &lt;/p&gt;

&lt;p&gt;also for reliably knowing the app name we would have some kind of authorization for a client to identify itself as a part of some application. initially it could just be something like &lt;br/&gt;
instantiating a zookeeper-client with an application name. (no security).&lt;/p&gt;</comment>
                            <comment id="12650743" author="phunt" created="Tue, 25 Nov 2008 21:32:07 +0000"  >&lt;p&gt;@Krishna: the paths I specified are zk subtree path specs.&lt;/p&gt;

&lt;p&gt;I should have been more clear: /app/app1 corresponds to the /app/app1 znode subtree w/in ZK namespace.  To take my example further you might have:&lt;/p&gt;

&lt;p&gt;/app/app1/cluster1/members/...&lt;br/&gt;
/app/app1/cluster1/leader&lt;br/&gt;
/app/app1/cluster2/members/...&lt;br/&gt;
/app/app1/cluster2/leader&lt;/p&gt;

&lt;p&gt;where members is storing the hosts &amp;amp; ports of the members of cluster1, for app1, etc... and leader is storing the leader node for the cluster (this is but one simple example).&lt;/p&gt;

&lt;p&gt;The ZK ACLs feature could be used to lock down a particular acl id to particular subtree(s).&lt;br/&gt;
&lt;a href=&quot;http://hadoop.apache.org/zookeeper/docs/r3.0.0/zookeeperProgrammers.html#sc_ZooKeeperAccessControl&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hadoop.apache.org/zookeeper/docs/r3.0.0/zookeeperProgrammers.html#sc_ZooKeeperAccessControl&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So in this case you might have acl ids for app1, app2 and app3, each only able to access it&apos;s particular corresponding subtree of znodes, where each of those trees has some associated quota.&lt;/p&gt;

&lt;p&gt;Does that help?&lt;/p&gt;
</comment>
                            <comment id="12650801" author="phunt" created="Tue, 25 Nov 2008 23:53:57 +0000"  >&lt;p&gt;Adding a link to &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-119&quot; title=&quot;Reserve &amp;quot;.zookeeper&amp;quot; node for server use.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-119&quot;&gt;ZOOKEEPER-119&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Originally we talked about using /.zookeeper rather than /zookeeper, have we changed our minds on whether that&apos;s a good idea or not?&lt;/p&gt;</comment>
                            <comment id="12652443" author="ksankar" created="Tue, 2 Dec 2008 18:10:19 +0000"  >&lt;p&gt;@Patrick,&lt;br/&gt;
 Yep, that helps. But raises another question ;o). &lt;/p&gt;

&lt;p&gt;RE:acl id, woud it be a good idea to get couple more double clicks and granularities ? Eg&amp;gt; app and some sort of id at the next level. May be app is sufficient. For now, looks like our least count is ip, but there are more smaller leaf units than that, like app.&lt;/p&gt;

&lt;p&gt;Cheers&lt;br/&gt;
&amp;lt;k/&amp;gt;&lt;/p&gt;</comment>
                            <comment id="12652526" author="mahadev" created="Tue, 2 Dec 2008 21:45:20 +0000"  >&lt;p&gt;@krishna&lt;br/&gt;
zookeeper has a pluggalbe authorization system. So in case you want to use ip as the granularities instead of an app, then you can create an authorization system with &lt;/p&gt;

&lt;p&gt;id = ipaddress.&lt;br/&gt;
scheme=ipscheme&lt;/p&gt;

&lt;p&gt;which classifies the ipaddesses into one of the subnet ids? ... we already have one such auth system using subnet authorization in &lt;br/&gt;
src/java/main/org/apache/zookeeper/server/auth/IPAuthenticationProvider.java &lt;/p&gt;



</comment>
                            <comment id="12661754" author="mahadev" created="Wed, 7 Jan 2009 22:40:22 +0000"  >&lt;p&gt;here is a preliminary patch for qutoa&apos;s. This is not fully complete &amp;#8211; lacking tests, documentation and a few minor features, which I will be adding shortly. The design is based on whats discussed above. COmments are welcome.&lt;/p&gt;</comment>
                            <comment id="12663639" author="mahadev" created="Wed, 14 Jan 2009 06:19:18 +0000"  >&lt;p&gt;here is a more recent patch (needs testing). it does not include tests and docs &amp;#8211; will be adding them. &lt;/p&gt;</comment>
                            <comment id="12664762" author="mahadev" created="Sat, 17 Jan 2009 00:57:02 +0000"  >&lt;p&gt;updated patch ... shaked out some bugs... still needs tests and documentation... please review the code.... ill be making some changes .... but not drastic ones... the one thing to keep in mind is htat the current code forbids setting of quota if a path &quot;does not&quot; already exist (just an easier implementation choice) ... I will be changing that to setting of quota only if a path exists.&lt;/p&gt;</comment>
                            <comment id="12665674" author="mahadev" created="Wed, 21 Jan 2009 01:26:52 +0000"  >&lt;p&gt;this patch includes a test and documentation. The only thing I have to change is to allow setting quota only for paths athat exist. I will be adding more tests and more documentation. I will make it patch available to get early feedback.. &lt;/p&gt;</comment>
                            <comment id="12666008" author="mahadev" created="Wed, 21 Jan 2009 23:54:38 +0000"  >&lt;p&gt;fixed a bug that i found while debugging...&lt;/p&gt;</comment>
                            <comment id="12666675" author="mahadev" created="Fri, 23 Jan 2009 19:56:49 +0000"  >&lt;p&gt;Here is the latest patch. THis patch has the following &amp;#8211; &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;quota can be set via the commadn line using setQuota -n|-b path&lt;/li&gt;
	&lt;li&gt;quota can be deleted via the commandline using delQuota &lt;span class=&quot;error&quot;&gt;&amp;#91;-n|-b&amp;#93;&lt;/span&gt; path&lt;/li&gt;
	&lt;li&gt;setting quota for a node that does not exist will throw an exception&lt;/li&gt;
	&lt;li&gt;setting quota for a node that has an ancestor or a descendant that has a quota cannot be set&lt;/li&gt;
	&lt;li&gt;includes a simeple test case &amp;#8211; their are lot of corner cases. I am still trying to add more&lt;/li&gt;
	&lt;li&gt;includes documentation (please review the documentation to see if you understand how to use quotas)&lt;/li&gt;
	&lt;li&gt;their are a lot of corner cases &amp;#8212; feel free to test them and mention it on the jira &amp;#8211; i will tru and write a test case for that.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12666693" author="mahadev" created="Fri, 23 Jan 2009 20:42:14 +0000"  >&lt;p&gt;forogt to mention- &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;to list the quota limit and usage use listquota path&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12666937" author="fpj" created="Sat, 24 Jan 2009 14:39:24 +0000"  >&lt;p&gt;This might be a naive question, but what happens if I create a znode with x bytes, and I try to set a quota for &quot;x&apos; &amp;lt; x&quot;? My guess is that the setQuota operation will fail. If this is correct, then the semantics is a little awkward because the service doesn&apos;t allow me to set a quota for a given znode that might be using too much space. &lt;/p&gt;

&lt;p&gt;Along the same lines, why not enabling to set quotas for nodes that do not exist? Because the create call enables a client to add data to a new node, it might be desirable to set a quota before creating the node. &lt;/p&gt;

&lt;p&gt;I was also wondering about performance. Do you have an idea if this quota scheme will affect our throughput performance?&lt;/p&gt;</comment>
                            <comment id="12667509" author="mahadev" created="Tue, 27 Jan 2009 00:08:39 +0000"  >&lt;p&gt;added a junit test to run with QUorum for quotas.&lt;/p&gt;</comment>
                            <comment id="12668169" author="mahadev" created="Wed, 28 Jan 2009 21:23:17 +0000"  >&lt;p&gt;Refactored the QuorumTest to create a quorumBase class like clientbase. Had to make some changes in the testcases to get it to working after the refactoring.&lt;/p&gt;</comment>
                            <comment id="12669128" author="phunt" created="Sat, 31 Jan 2009 02:21:26 +0000"  >&lt;p&gt;there are a number of issues I found, I have an updated patch in progress&lt;/p&gt;</comment>
                            <comment id="12669152" author="phunt" created="Sat, 31 Jan 2009 05:35:59 +0000"  >&lt;p&gt;addressed a few issues in the patch:&lt;/p&gt;

&lt;p&gt;1) updated to apply against latest svn with no rejects&lt;br/&gt;
2) fixed handling of parent quota checking - was failing due&lt;br/&gt;
to / char being at end of path - now checked by client and server code&lt;br/&gt;
3) fixed forrest docs for site/index page&lt;br/&gt;
4) cleaned up some imports&lt;br/&gt;
5) some spelling issues&lt;br/&gt;
6) added eof newlines to some files that were missing&lt;br/&gt;
7) @Override on interface method caused compilation to fail on 1.5 - removed&lt;/p&gt;</comment>
                            <comment id="12669745" author="fpj" created="Mon, 2 Feb 2009 21:38:04 +0000"  >&lt;p&gt;+1. It looks good to me, it compiles without problems, and tests run fine.&lt;/p&gt;</comment>
                            <comment id="12669879" author="mahadev" created="Tue, 3 Feb 2009 05:26:51 +0000"  >&lt;p&gt;I just committed this.&lt;/p&gt;</comment>
                            <comment id="12669929" author="hudson" created="Tue, 3 Feb 2009 11:45:55 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #218 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/218/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/218/&lt;/a&gt;)&lt;br/&gt;
    . Committing updated docs.&lt;br/&gt;
. Committing updated docs.&lt;br/&gt;
. Quotas in ZooKeeper. (mahadev)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12402147">ZOOKEEPER-119</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12399198" name="ZOOKEEPER-231.patch" size="77861" author="phunt" created="Sat, 31 Jan 2009 05:35:59 +0000"/>
                            <attachment id="12398930" name="ZOOKEEPER-231.patch" size="75113" author="mahadev" created="Wed, 28 Jan 2009 21:23:17 +0000"/>
                            <attachment id="12398782" name="ZOOKEEPER-231.patch" size="70711" author="mahadev" created="Tue, 27 Jan 2009 00:08:38 +0000"/>
                            <attachment id="12398600" name="ZOOKEEPER-231.patch" size="57742" author="mahadev" created="Fri, 23 Jan 2009 19:56:49 +0000"/>
                            <attachment id="12398440" name="ZOOKEEPER-231.patch" size="55758" author="mahadev" created="Wed, 21 Jan 2009 23:54:38 +0000"/>
                            <attachment id="12398359" name="ZOOKEEPER-231.patch" size="55638" author="mahadev" created="Wed, 21 Jan 2009 01:26:52 +0000"/>
                            <attachment id="12398128" name="ZOOKEEPER-231.patch" size="46386" author="mahadev" created="Sat, 17 Jan 2009 00:57:02 +0000"/>
                            <attachment id="12397861" name="ZOOKEEPER-231.patch" size="45213" author="mahadev" created="Wed, 14 Jan 2009 06:19:18 +0000"/>
                            <attachment id="12397338" name="ZOOKEEPER-231.patch" size="33693" author="mahadev" created="Wed, 7 Jan 2009 22:40:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 25 Nov 2008 18:54:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47961</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzyc7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33547</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>