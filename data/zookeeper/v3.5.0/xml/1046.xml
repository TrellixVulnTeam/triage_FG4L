<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:45:46 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1046/ZOOKEEPER-1046.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1046] Creating a new sequential node results in a ZNODEEXISTS error</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1046</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;On several occasions, I&apos;ve seen a create() with the sequential flag set fail with a ZNODEEXISTS error, and I don&apos;t think that should ever be possible.  In past runs, I&apos;ve been able to closely inspect the state of the system with the command line client, and saw that the parent znode&apos;s cversion is smaller than the sequential number of existing children znode under that parent.  In one example:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[zk:&amp;lt;ip:port&amp;gt;(CONNECTED) 3] stat /zkrsm
cZxid = 0x5
ctime = Mon Jan 17 18:28:19 PST 2011
mZxid = 0x5
mtime = Mon Jan 17 18:28:19 PST 2011
pZxid = 0x1d819
cversion = 120710
dataVersion = 0
aclVersion = 0
ephemeralOwner = 0x0
dataLength = 0
numChildren = 2955
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, the znode /zkrsm/000000000000002d_record0000120804 existed on disk.&lt;/p&gt;

&lt;p&gt;In a recent run, I was able to capture the Zookeeper logs, and I will attach them to this JIRA.  The logs are named as nodeX.&amp;lt;zxid_prefixes&amp;gt;.log, and each new log represents an application process restart.&lt;/p&gt;

&lt;p&gt;Here&apos;s the scenario:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;There&apos;s a cluster with nodes 1,2,3 using zxid 0x3.&lt;/li&gt;
	&lt;li&gt;All three nodes restart, forming a cluster of zxid 0x4.&lt;/li&gt;
	&lt;li&gt;Node 3 restarts, leading to a cluster of 0x5.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;At this point, it seems like node 1 is the leader of the 0x5 epoch.  In its log (node1.0x4-0x5.log) you can see the first (of many) instances of the following message:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2011-04-11 21:16:12,607 16649 [ProcessThread:-1] INFO org.apache.zookeeper.server.PrepRequestProcessor  - Got user-level KeeperException when processing sessionid:0x512f466bd44e0002 type:create cxid:0x4da376ab zxid:0xfffffffffffffffe txntype:unknown reqpath:n/a Error Path:/zkrsm/00000000000000b2_record0001761440 Error:KeeperErrorCode = NodeExists for /zkrsm/00000000000000b2_record0001761440
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This then repeats forever as my application isn&apos;t expecting to ever get this error message on a sequential node create, and just continually retries.  The message even transfers over to node3.0x5-0x6.log once the 0x6 epoch comes into play.&lt;/p&gt;

&lt;p&gt;I don&apos;t see anything terribly fishy in the transition between the epochs; the correct snapshots seem to be getting transferred, etc.  Unfortunately I don&apos;t have a ZK snapshot/log that exhibits the problem when starting with a fresh system.&lt;/p&gt;

&lt;p&gt;Some oddities you might notice in these logs:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Between epochs 0x3 and 0x4, the zookeeper IDs of the nodes changed due to a bug in our application code.  (They are assigned randomly, but are supposed to be consistent across restarts.)&lt;/li&gt;
	&lt;li&gt;We manage node membership dynamically, and our application restarts the ZooKeeperServer classes whenever a new node wants to join (without restarting the entire application process).  This is why you&apos;ll see messages like the following in node1.0x4-0x5.log before a new election begins:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2011-04-11 21:16:00,762 4804 [QuorumPeer:/0.0.0.0:2888] INFO org.apache.zookeeper.server.quorum.Learner  - shutdown called
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;There is in fact one of these dynamic membership changes in node1.0x4-0x5.log, just before the 0x4 epoch is formed.  I&apos;m not sure how this would be related though, as no transactions are done during this period.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;A 3 node-cluster running Debian squeeze.&lt;/p&gt;</environment>
        <key id="12504115">ZOOKEEPER-1046</key>
            <summary>Creating a new sequential node results in a ZNODEEXISTS error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vishalmlst">Vishal Kher</assignee>
                                    <reporter username="strib">Jeremy Stribling</reporter>
                        <labels>
                            <label>sequence</label>
                    </labels>
                <created>Tue, 12 Apr 2011 23:24:19 +0100</created>
                <updated>Wed, 23 Nov 2011 19:22:03 +0000</updated>
                            <resolved>Thu, 14 Jul 2011 15:24:41 +0100</resolved>
                                    <version>3.3.2</version>
                    <version>3.3.3</version>
                                    <fixVersion>3.3.4</fixVersion>
                    <fixVersion>3.4.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13019092" author="strib" created="Tue, 12 Apr 2011 23:26:40 +0100"  >&lt;p&gt;The logs are too big to attach, but you can download them from &lt;a href=&quot;http://pdos.csail.mit.edu/~strib/zk_node_exists.tgz&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://pdos.csail.mit.edu/~strib/zk_node_exists.tgz&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;24 MB, 670 MB unzipped&amp;#93;&lt;/span&gt;.&lt;/p&gt;</comment>
                            <comment id="13019357" author="fournc" created="Wed, 13 Apr 2011 15:39:04 +0100"  >&lt;p&gt;You saw this problem in the past in a single node setup, correct?&lt;/p&gt;</comment>
                            <comment id="13019398" author="strib" created="Wed, 13 Apr 2011 16:59:33 +0100"  >&lt;p&gt;Correct.  Sorry, forgot to mention that.&lt;/p&gt;</comment>
                            <comment id="13019656" author="fournc" created="Thu, 14 Apr 2011 02:26:12 +0100"  >&lt;p&gt;So, from a first pass through the code, I&apos;m not sure how this is happening. It looks like the parent cversion is always updated when you add a child node, and that is reflected in both the data tree that would be serialized and the transaction log replay (which itself would update the parent node cversion). It would be nice if we could get the log. and snapshot. files from the zk data directories the next time you see this. Can you force it to happen more often by updating your cluster more frequently or bouncing nodes?&lt;/p&gt;</comment>
                            <comment id="13019657" author="strib" created="Thu, 14 Apr 2011 02:33:04 +0100"  >&lt;p&gt;Thanks for looking into.  I will grab all the data I can the next time I see this happen, but it&apos;s difficult since I&apos;ve never had it happen on my own setup, only when others report it to me, and by then the data may have been rotated away.&lt;/p&gt;

&lt;p&gt;I haven&apos;t found a test to reproduce this yet, but I will try to come up with one when I get some time.&lt;/p&gt;
</comment>
                            <comment id="13019660" author="strib" created="Thu, 14 Apr 2011 02:44:18 +0100"  >&lt;p&gt;The log and snapshot files for an occurrence of this with a single node using ZK 3.3.2.&lt;/p&gt;</comment>
                            <comment id="13019661" author="strib" created="Thu, 14 Apr 2011 02:47:10 +0100"  >&lt;p&gt;I was wrong &amp;#8211; I was able to find the log/snapshot files from a run with Zookeeper 3.3.2 (single node).  If you start up Zookeeper 3.3.2 with this as your data dir, you can reproduce the problem with the following command in zkCli:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;# create -s /zkrsm/000000000000002d_record test
Node already exists: /zkrsm/000000000000002d_record
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Unfortunately, I do not have logs for the run that led to this state, I only have logs from after the restart, which shouldn&apos;t give you any more info than just running with these snapshots yourself.&lt;/p&gt;</comment>
                            <comment id="13020139" author="strib" created="Fri, 15 Apr 2011 01:55:10 +0100"  >&lt;p&gt;For the record, I have another example of this happening, this time without a lot complicated cluster dynamics.  The scenario is:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;There is a 3-node cluster&lt;/li&gt;
	&lt;li&gt;A sequential node is created with seq. num. X&lt;/li&gt;
	&lt;li&gt;The leader dies very shortly after that (within a couple of transactions)&lt;/li&gt;
	&lt;li&gt;A new leader is elected (who has seen all of the transactions committed by the previous leader)&lt;/li&gt;
	&lt;li&gt;The new leader immediately hits the problem where it returns ZNODEEXISTS when a seq. node is returned&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I have logs from before and after the problem, as well as Zookeeper snapshots that contain the problem, but unfortunately the transaction log containing the actual problematic transaction was rotated away.  If anyone wants to see what I do have, let me know and I&apos;ll upload them somewhere.&lt;/p&gt;

&lt;p&gt;I will also try to write a simple test that creates lots of sequential nodes, kills the leader, and sees if the problem occurs.&lt;/p&gt;</comment>
                            <comment id="13020145" author="fournc" created="Fri, 15 Apr 2011 02:01:36 +0100"  >&lt;p&gt;Thanks Jeremy.&lt;br/&gt;
Today I ran the single node test with your log above and got even stranger results; instead of giving me NODEEXISTS errors I was simply overwriting nodes. This was through a java ZooKeeper instead of zkCli. Going to look into it further now.&lt;/p&gt;</comment>
                            <comment id="13020237" author="savu.andrei" created="Fri, 15 Apr 2011 09:25:34 +0100"  >&lt;p&gt;I&apos;ve seen a similar behavior while writing a strictly increasing sequence of numbers as sequential nodes. You can find the code at the following link &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. The repository also contains some basic tools for fault injection.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/andreisavu/zookeeper-mq&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/andreisavu/zookeeper-mq&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13020441" author="fournc" created="Fri, 15 Apr 2011 22:31:52 +0100"  >&lt;p&gt;This one is a bear. I believe what is happening is the following:&lt;/p&gt;

&lt;p&gt;Your code is creating and deleting large numbers of sequential nodes. At time T, it is in the process of deleting a bunch of nodes when ZK decides to take a snapshot of the state.&lt;/p&gt;

&lt;p&gt;When we take a snapshot, we spawn a separate thread and serialize the nodes of the tree in that thread. We get into your /zkrsm node in DataTree.serializeNode, get that node from the tree, synchronize on it, and write out the record of that node including its current cversion (used to generate sequential node information) and the list of children. However, we then release the sync on that node, and attempt to iterate through the children to serialize them out. In the meantime, the other thread is merrily deleting children of this node, increasing the cversion of /zkrsm all the while. So the list of children that we got while serializing the parent is defunct. When we try to serialize these now-deleted children, we see that they are null and continue on.&lt;/p&gt;

&lt;p&gt;Now, you finish this snapshot, delete some more nodes under /zkrsm, create some more sequential nodes under /zkrsm, and crash. When you start back up again, you read that snapshot and start playing through the log transactions after the snapshot zxid. Unfotunately, the first N transactions in your log after the snapshot zxid are deletions of nodes that didn&apos;t make it into the snapshot because you deleted them before they could be serialized to the snapshot. We will try to process the delete transaction and get a NoNodeException, but ignore it because we know that can happen due to what I wrote above. But what we don&apos;t do is increment the cversion of the parent node after this failed deletion. So our parent&apos;s cversion is less than the version it would be if you played just the transaction log through, or of the system before the crash. Now you want to continue creating sequential nodes where you left off, but your cversion is wrong so you try to create a node that already exists. Whoops.&lt;/p&gt;

&lt;p&gt;So, now we just need to fix it. Should we be incrementing the cversion of the parent even on a NoNode exception during txn log replay? I suspect that is the right thing to do. Thoughts?&lt;/p&gt;</comment>
                            <comment id="13020447" author="strib" created="Fri, 15 Apr 2011 23:00:12 +0100"  >&lt;p&gt;Wow, nice sleuthing.  Sounds very plausible &amp;#8211; we are doing a lot of deletions under that same node, and it could definitely be concurrent with the node creation.  But not knowing the code very well, I&apos;ll defer to others for confirmation.&lt;/p&gt;

&lt;p&gt;I will try to implement this change locally for our app and see if we run into the problem again.  I assume you&apos;re talking about the OpCode.delete case in PrepRequestProcessor::pRequest?  And copying the cversion increment into a catch clause after the getRecordForPath(path) call?&lt;/p&gt;</comment>
                            <comment id="13020490" author="fournc" created="Sat, 16 Apr 2011 00:55:38 +0100"  >&lt;p&gt;No, it&apos;ll need to be fixed in the DataTree deleteNode method somehow. I&apos;m not really sure the best way to do it yet. But an easy manual test to run is, with the log and snapshot files attached to this ticket, if you start up a zk with the version-2 directory containing just log.1, the cversion of /zkrsm is 84340. If you start it up with log.1 and snapshot.1460d, the cversion of /zkrsm is 84245. If you fix this bug, both should show cversion of 84340.&lt;/p&gt;</comment>
                            <comment id="13020502" author="strib" created="Sat, 16 Apr 2011 01:19:19 +0100"  >&lt;p&gt;A quick and dirty patch that seems to fix the problem.  Applies from src/ with `patch -p1`.&lt;/p&gt;</comment>
                            <comment id="13020503" author="strib" created="Sat, 16 Apr 2011 01:20:48 +0100"  >&lt;p&gt;Thanks Camille.  The patch I just attached seems to solve the problem for the log/snap combo you point out above.  I haven&apos;t tested it extensively yet, and it&apos;s not very elegant so you probably want to rewrite it and I&apos;m not going to put this into &quot;patch available&quot; yet.  But if you have a chance, please let me know if there&apos;s anything obviously wrong in this patch.&lt;/p&gt;</comment>
                            <comment id="13020505" author="strib" created="Sat, 16 Apr 2011 01:24:45 +0100"  >&lt;p&gt;(By the way, the patch is against the 3.3.3 release, not the trunk.)&lt;/p&gt;</comment>
                            <comment id="13023368" author="vishalmlst" created="Fri, 22 Apr 2011 21:02:11 +0100"  >&lt;p&gt;Hi Jeremy, Camille,&lt;/p&gt;

&lt;p&gt;The patch that Jeremy attached will fix the problem, but it will result in incrementing cversion() for every delete operation that fails with NoNodeException. That is, an attempt to delete a node that does not exist will also increment the cversion. Am I correct?&lt;/p&gt;

&lt;p&gt;If yes, then do you think it would be better to change &lt;blockquote&gt;&lt;p&gt;public void deleteNode(String path, long zxid)&lt;/p&gt;&lt;/blockquote&gt; to &lt;blockquote&gt;&lt;p&gt;public void deleteNode(String path, long zxid, boolean forceIncrementCversion)&lt;/p&gt;&lt;/blockquote&gt;.&lt;/p&gt;

&lt;p&gt;If forceIncrementCversion is set, the code will work similar to Jeremy&apos;s patch. ZkDataBase.processTxn() will always set the flag to false. FileTxnSnapLog.processTransaction() will always set the flag to true. We will also need to add third argument to DataTree.processTxn().&lt;/p&gt;

&lt;p&gt;Questions for Camille:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Why does this have to be in DataTree.deleteNode() and cannot be part of exception handling at the higher layer? Isn&apos;t this a special case for Txn exception handling rather than deleting the node from DT?&lt;/li&gt;
	&lt;li&gt;You mentioned that your test resulted in overwriting the nodes instead of causing NODEXIST. Is this because of the same bug?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13023466" author="fournc" created="Sat, 23 Apr 2011 00:57:05 +0100"  >&lt;p&gt;I think it could and possibly should be in the exception handling at the higher layer. I haven&apos;t had much of a chance to look through it in details yet. I think there&apos;s definitely still some work to be done here, if you have a better idea it would be cool to see it.&lt;/p&gt;

&lt;p&gt;Which test are you referring to? I realized after posting that one of my tests was writing to a different node name entirely instead of overwriting a node name so that was a human operator problem.&lt;/p&gt;</comment>
                            <comment id="13029990" author="vishalmlst" created="Fri, 6 May 2011 17:08:13 +0100"  >&lt;p&gt;Hi Camille, Jeremy,&lt;/p&gt;

&lt;p&gt;I have attached a patch that I think should fix the problem that Camille&lt;br/&gt;
pointed out.&lt;/p&gt;

&lt;p&gt;There are subtle effects of this patch that needs to be carefully&lt;br/&gt;
reviewed:&lt;/p&gt;

&lt;p&gt;1. Previously, DataTree.processTxn() did not return error if&lt;br/&gt;
create/delete failed with nodeexist/nonode exception (the if condition&lt;br/&gt;
was a bit strange also). I think we should not do this. Per my&lt;br/&gt;
understanding, such a failure can occur only when we are replaying the&lt;br/&gt;
transactions. It should not occur when the server is doing live&lt;br/&gt;
transactions (unless there is a bug). So processTxn should return&lt;br/&gt;
error even in this case to the caller. The caller should decided&lt;br/&gt;
whether to ignore these errors or not. In FileTxnSnapLog we handle the&lt;br/&gt;
error by incrementing cversion of the parent. In FinalRequestProcessor&lt;br/&gt;
we do not do anything special, but we do not ignore the error as well.&lt;/p&gt;

&lt;p&gt;2. We could increment cversion in DeleteNode itself (as I mentioned in&lt;br/&gt;
my previous comment). But I think changes in the attached patch is a&lt;br/&gt;
better approach. I would like to confirm whether not incrementing&lt;br/&gt;
cversion in DeleteNode() is going to introduce any synchronization&lt;br/&gt;
issue (since the lock on the parent will be released and then&lt;br/&gt;
reacquired). I don&apos;t think there is any problem here, but it will be&lt;br/&gt;
good if you can confirm this.&lt;/p&gt;

&lt;p&gt;I noticed that the same bug can occur while creating a node as&lt;br/&gt;
well. Patch handles create and delete.&lt;/p&gt;

&lt;p&gt;I was able to test this patch using the snapshots and logs that Jermey&lt;br/&gt;
had attached. I had to revert the logs to the state where this bug&lt;br/&gt;
would be seen the first time. I ended up doing: rm &amp;#42;.1d8&amp;#42; &amp;#42;.1d9&amp;#42;&lt;/p&gt;

&lt;p&gt;Then I can see that &quot;create -s /zkrsm/000000000000002d_record test&quot;&lt;br/&gt;
succeeds with this patch (and fails without).&lt;/p&gt;

&lt;p&gt;I have not thought about writing a test for this yet (sounds complex to me).&lt;/p&gt;

&lt;p&gt;Thanks.&lt;br/&gt;
-Vishal&lt;/p&gt;</comment>
                            <comment id="13029992" author="vishalmlst" created="Fri, 6 May 2011 17:09:05 +0100"  >&lt;p&gt;Submitting path for trunk. Does not inlcude test.&lt;/p&gt;</comment>
                            <comment id="13030009" author="hadoopqa" created="Fri, 6 May 2011 17:34:17 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12478444/ZOOKEEPER-1046.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12478444/ZOOKEEPER-1046.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1099329.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/251//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/251//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/251//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/251//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/251//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/251//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13030050" author="fournc" created="Fri, 6 May 2011 18:40:57 +0100"  >&lt;p&gt;Hey Vishal,&lt;/p&gt;

&lt;p&gt;Looking at the patch at a glance it looks good to me. Would be nice to have just a flat unit test against the DataTree incrementCversion. Is there any way to take those logs that Jeremy provided and turn them into a test for this fix? It would be somewhat heavy I&apos;ll admit but it&apos;s a somewhat significant bug and I think it warrants a good test.&lt;/p&gt;</comment>
                            <comment id="13031711" author="fournc" created="Wed, 11 May 2011 15:02:55 +0100"  >&lt;p&gt;Hey Vishal,&lt;/p&gt;

&lt;p&gt;Any chance you could get some sort of test for this soon? It looks like it will be a merge conflict with &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-965&quot; title=&quot;Need a multi-update command to allow multiple znodes to be updated safely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-965&quot;&gt;&lt;del&gt;ZOOKEEPER-965&lt;/del&gt;&lt;/a&gt; so it would be good to have this in first since it is a rather nasty bug and I&apos;d like to make sure we don&apos;t make the same mistake in the multi-txn space.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13032777" author="vishalmlst" created="Fri, 13 May 2011 01:53:05 +0100"  >&lt;p&gt;I will upload a test soon.&lt;/p&gt;</comment>
                            <comment id="13033038" author="vishalmlst" created="Fri, 13 May 2011 14:40:27 +0100"  >&lt;p&gt;+ tests&lt;/p&gt;</comment>
                            <comment id="13033039" author="vishalmlst" created="Fri, 13 May 2011 14:41:55 +0100"  >&lt;p&gt;Added tests. Submitting patch for trunk.&lt;/p&gt;</comment>
                            <comment id="13033049" author="hadoopqa" created="Fri, 13 May 2011 15:13:32 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12479099/ZOOKEEPER-1046.patch1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12479099/ZOOKEEPER-1046.patch1&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1099329.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 16 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/263//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/263//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/263//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/263//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/263//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/263//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13033249" author="fournc" created="Fri, 13 May 2011 20:54:27 +0100"  >&lt;p&gt;Looks great Vishal! +1 from me&lt;/p&gt;</comment>
                            <comment id="13036998" author="phunt" created="Fri, 20 May 2011 19:49:26 +0100"  >&lt;p&gt;It&apos;s not clear to me at this point, is this being fixed on 3.3 and trunk? (&quot;fix for&quot; indicates trunk only) Which patch is which? (typically we indicate in the patch file name if it&apos;s for a branch, vs the &quot;simple&quot; name if for trunk)&lt;/p&gt;</comment>
                            <comment id="13037047" author="breed" created="Fri, 20 May 2011 21:00:29 +0100"  >&lt;p&gt;+1 great job figuring out the problem and fixing it! looks good to me.&lt;/p&gt;</comment>
                            <comment id="13037302" author="hudson" created="Sat, 21 May 2011 11:56:21 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #1189 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/ZooKeeper-trunk/1189/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/ZooKeeper-trunk/1189/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1046&quot; title=&quot;Creating a new sequential node results in a ZNODEEXISTS error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1046&quot;&gt;&lt;del&gt;ZOOKEEPER-1046&lt;/del&gt;&lt;/a&gt;: Creating a new sequential node results in a ZNODEEXISTS error&lt;/p&gt;

&lt;p&gt;camille : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1125581&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1125581&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/persistence/FileTxnSnapLog.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/DataTree.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/LoadFromLogTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/DataTreeTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13037626" author="fournc" created="Sun, 22 May 2011 17:43:21 +0100"  >&lt;p&gt;Patrick, I missed your comment in my rushing on Friday. Do we want to push this into the 3.3 branch as well?&lt;/p&gt;</comment>
                            <comment id="13037683" author="breed" created="Mon, 23 May 2011 01:40:06 +0100"  >&lt;p&gt;yes, we should get this into the 3.3 branch.&lt;/p&gt;</comment>
                            <comment id="13039388" author="fournc" created="Wed, 25 May 2011 23:28:45 +0100"  >&lt;p&gt;So I&apos;m trying to get this patch working in 3.3, and I notice the following:&lt;/p&gt;

&lt;p&gt;One of the tests in the patch is a modification of LoadFromLogTest, which was introduced to show fixes for &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-882&quot; title=&quot;Startup loads last transaction from snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-882&quot;&gt;&lt;del&gt;ZOOKEEPER-882&lt;/del&gt;&lt;/a&gt;. &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-882&quot; title=&quot;Startup loads last transaction from snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-882&quot;&gt;&lt;del&gt;ZOOKEEPER-882&lt;/del&gt;&lt;/a&gt; claims to have been fixed on 3.3.3 and 3.4, but the test is not there in the 3.3.3 branch. When we port fixes from trunk to branches, are we not also porting the tests?&lt;/p&gt;</comment>
                            <comment id="13044330" author="fournc" created="Sat, 4 Jun 2011 17:58:47 +0100"  >&lt;p&gt;3.3 branch patch&lt;/p&gt;</comment>
                            <comment id="13044331" author="fournc" created="Sat, 4 Jun 2011 17:59:42 +0100"  >&lt;p&gt;I think I got the code into a 3.3 patch. If someone could take a look and ok it I will push it back into the branch.&lt;/p&gt;</comment>
                            <comment id="13044332" author="hadoopqa" created="Sat, 4 Jun 2011 18:01:47 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12481458/ZOOKEEPER-1046-for333&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12481458/ZOOKEEPER-1046-for333&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1125581.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 14 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/305//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/305//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13046596" author="breed" created="Thu, 9 Jun 2011 16:01:10 +0100"  >&lt;p&gt;i was reviewing this code again, and i think we still have a problem. the txns are supposed to be idempotent, but the way we maintain the cversion is not idempotent. i think it is possible for different replicas to have different cversions for the same znode.&lt;/p&gt;

&lt;p&gt;i think the ultimate fix is to encode the cversion of the parent into the create and delete txns.&lt;/p&gt;</comment>
                            <comment id="13046704" author="vishalmlst" created="Thu, 9 Jun 2011 18:54:18 +0100"  >&lt;p&gt;Does this imply a transaction log version upgrade?&lt;/p&gt;</comment>
                            <comment id="13046720" author="breed" created="Thu, 9 Jun 2011 19:16:53 +0100"  >&lt;p&gt;yes, it would require a transaction log and protocol upgrade.&lt;/p&gt;</comment>
                            <comment id="13046893" author="fournc" created="Thu, 9 Jun 2011 23:54:28 +0100"  >&lt;p&gt;Do we want to try to do this as part of 3.4? Are you guys addressing this in some of your other patches?&lt;/p&gt;</comment>
                            <comment id="13046899" author="breed" created="Thu, 9 Jun 2011 23:59:01 +0100"  >&lt;p&gt;i 3.4 would be a good time to do it since we are doing a small protocol change in the initial handshake.&lt;/p&gt;</comment>
                            <comment id="13048693" author="fournc" created="Mon, 13 Jun 2011 19:21:03 +0100"  >&lt;p&gt;OK. So who wants to do this? Should I pull this patch out of trunk and only apply it to 3.3? I&apos;d like to get this cleared up and finalized so we know the bug and the related bugs are all fixed.&lt;/p&gt;</comment>
                            <comment id="13049181" author="breed" created="Tue, 14 Jun 2011 14:43:48 +0100"  >&lt;p&gt;yes, i think we should stick with this patch for 3.3. i think it might be better to do a patch based on what is already in trunk rather than reverting. we should definitely get the protocol change into 3.4.0. i&apos;ll try to get to it today.&lt;/p&gt;</comment>
                            <comment id="13049197" author="fournc" created="Tue, 14 Jun 2011 15:21:47 +0100"  >&lt;p&gt;Is this going to force me to write some kind of upgrade script for the ZK servers I have running 3.3.3?&lt;/p&gt;</comment>
                            <comment id="13049288" author="breed" created="Tue, 14 Jun 2011 18:20:45 +0100"  >&lt;p&gt;no, i think we need to back it backwards compatible with 3.3.x, so we need to be able to process txns without the parent cversion. so, no upgrade needed.&lt;/p&gt;</comment>
                            <comment id="13049290" author="breed" created="Tue, 14 Jun 2011 18:22:01 +0100"  >&lt;p&gt;making a blocker to ensure that it gets into 3.4.0&lt;/p&gt;</comment>
                            <comment id="13049607" author="breed" created="Wed, 15 Jun 2011 05:47:48 +0100"  >&lt;p&gt;it turns out that the fix is really easy and small and easy to make backwards compatible except for one killer problem: closeSession. The closeSession may do a massive amount of deletes, so potentially we would need to go through and figure out everything to delete and send a cversion for each.&lt;/p&gt;

&lt;p&gt;i&apos;ve been looking and i think we can simplify things. cversion is only used to pick suffixes for sequential nodes, so we really only need to increment on creates. if we did this, the fix would really become trivial and would also make the numbering of creates sequential.&lt;/p&gt;

&lt;p&gt;of course this is the only way we use it, others may use it for something else. it would be an api semantic break.&lt;/p&gt;</comment>
                            <comment id="13049774" author="fournc" created="Wed, 15 Jun 2011 14:58:11 +0100"  >&lt;p&gt;It&apos;s ok with me to make the change and ignore deletes.&lt;/p&gt;</comment>
                            <comment id="13049814" author="fpj" created="Wed, 15 Jun 2011 16:30:09 +0100"  >&lt;p&gt;If cversion counts the number of created children, we can always learn the number of deleted children by subtracting the number of current children from cversion, no? I was also wondering if there is any use case you&apos;re aware of in which it needs to have both counted. &lt;/p&gt;

&lt;p&gt;So far the proposal of counting only creations seems good to me.&lt;/p&gt;</comment>
                            <comment id="13049817" author="breed" created="Wed, 15 Jun 2011 16:36:31 +0100"  >&lt;p&gt;nice observation flavio! i haven&apos;t seen anyone using cversion outside of the sequence number on sequence znodes.&lt;/p&gt;</comment>
                            <comment id="13050070" author="phunt" created="Wed, 15 Jun 2011 23:04:31 +0100"  >&lt;p&gt;I strongly oppose changing the semantics of cversion. Certainly not in 3.3, as part of a minor upgrade perhaps. While we (the core code) only use it for sequence numbering, there is no telling what users are using it for, and switching it out from under them is a very bad idea IMO. It may lead to hard to track down issues for users, users who appreciate our rock steady api.&lt;/p&gt;

&lt;p&gt;Can we use Flavio&apos;s suggestion to:&lt;br/&gt;
1) do what Ben is suggesting, fix cversion in StatPersisted to only track creates&lt;br/&gt;
2) update the cversion in Stat as Flavio is suggesting before passing to the user&lt;/p&gt;

&lt;p&gt;this would maintain the semantics on the client side. Downside is that it&apos;s a bit of a hack (not sure if it would even work, given we have to translate in both directions, to/from user). How bad I don&apos;t know - thoughts?&lt;/p&gt;</comment>
                            <comment id="13050078" author="breed" created="Wed, 15 Jun 2011 23:21:30 +0100"  >&lt;p&gt;two clarifying points:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;this is not for 3.3. this would be a 3.4 change. we will stick with camille&apos;s fix for 3.3&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;we never get the cversion from the user. you can&apos;t do conditional ops with it or pass it in any of the calls.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13050090" author="phunt" created="Wed, 15 Jun 2011 23:39:25 +0100"  >&lt;p&gt;Ok, thanks for the clarification. In that case what do you think about this for 3.4+ ? Is it going to be possible to do this right, but also w/o too much overhead? (ie simply) vs the gains of changing the API? 3.4 I&apos;m less worried about the semantic change, but I&apos;d still like to avoid it if reasonably possible...&lt;/p&gt;</comment>
                            <comment id="13050222" author="breed" created="Thu, 16 Jun 2011 06:19:06 +0100"  >&lt;p&gt;actually, flavio&apos;s suggestion can go in quite well. we track the cversion in the persistentStat and there is one function that fills in Stat and we can do the fixup there: cversion*2 - numChildren. it will work and it isn&apos;t really that messy. the only thing i don&apos;t like is that it might confuse core developers to see a different cversion on disk than they see coming back from requests.&lt;/p&gt;</comment>
                            <comment id="13050431" author="fournc" created="Thu, 16 Jun 2011 15:05:50 +0100"  >&lt;p&gt;I checked in the fix for the 3.3 branch&lt;br/&gt;
svn commit: r1136440&lt;/p&gt;

</comment>
                            <comment id="13050558" author="phunt" created="Thu, 16 Jun 2011 17:47:04 +0100"  >&lt;p&gt;@breed yet more debt for those looking for things to complain about. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Still, I&apos;m willing to take the heat if it&apos;s going to benefit users. My suggestion would be to document it in multiple places - in the jute definition file, and in the method you mention. Reference this JIRA in those comments.&lt;/p&gt;</comment>
                            <comment id="13052993" author="breed" created="Wed, 22 Jun 2011 02:57:18 +0100"  >&lt;p&gt;this patch makes the CreateTxn idempotent and uses camille&apos;s workaround with older txns.&lt;/p&gt;</comment>
                            <comment id="13053005" author="hadoopqa" created="Wed, 22 Jun 2011 03:26:43 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12483386/ZOOKEEPER-1046_2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12483386/ZOOKEEPER-1046_2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1138213.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 30 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The patch appears to cause tar ant target to fail.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/345//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/345//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/345//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/345//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/345//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/345//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13053007" author="fournc" created="Wed, 22 Jun 2011 03:37:25 +0100"  >&lt;p&gt;To be fair, I only found the bug, Vishal K wrote the fix. Will take a look at this tomorrow am.&lt;/p&gt;</comment>
                            <comment id="13053345" author="fournc" created="Wed, 22 Jun 2011 18:11:52 +0100"  >&lt;p&gt;Looked at the patch. Besides a couple extraneous printlns it looks ok to me. Shall I remove these myself and commit this to trunk?&lt;/p&gt;</comment>
                            <comment id="13053371" author="breed" created="Wed, 22 Jun 2011 19:17:18 +0100"  >&lt;p&gt;oops, i missed those. yeah if you could remove and commit that would be great. btw, does the 3.3 patch still need to go in?&lt;/p&gt;</comment>
                            <comment id="13053379" author="fournc" created="Wed, 22 Jun 2011 19:26:23 +0100"  >&lt;p&gt;Checked in 3.3 last thursday (1136440)&lt;/p&gt;

&lt;p&gt;Should we be worried about the -1 javac from jenkins? I don&apos;t know what that error means since clearly this thing can compile if it can pass tests.&lt;/p&gt;</comment>
                            <comment id="13053385" author="fournc" created="Wed, 22 Jun 2011 19:37:24 +0100"  >&lt;p&gt;removed printlns&lt;/p&gt;</comment>
                            <comment id="13053399" author="hadoopqa" created="Wed, 22 Jun 2011 20:04:15 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12483478/zookeeper-1046-3&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12483478/zookeeper-1046-3&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1138213.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 30 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The patch appears to cause tar ant target to fail.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/347//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/347//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/347//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/347//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/347//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/347//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13053412" author="fournc" created="Wed, 22 Jun 2011 20:24:48 +0100"  >&lt;p&gt;Ah, here is the error:&lt;/p&gt;

&lt;p&gt;zookeeperbuildcontrib.compile:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; contrib: loggraph&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; Compiling 34 source files to /grid/0/hudson/hudson-slave/workspace/PreCommit-ZOOKEEPER-Build/trunk/build/contrib/loggraph/classes&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /grid/0/hudson/hudson-slave/workspace/PreCommit-ZOOKEEPER-Build/trunk/src/contrib/loggraph/src/java/org/apache/zookeeper/graph/TxnLogSource.java:185: deserializeTxn(byte[],org.apache.zookeeper.txn.TxnHeader) in org.apache.zookeeper.server.util.SerializeUtils cannot be applied to (org.apache.jute.InputArchive,org.apache.zookeeper.txn.TxnHeader)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; 		Record r = SerializeUtils.deserializeTxn(iab, hdr);&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; 		                         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /grid/0/hudson/hudson-slave/workspace/PreCommit-ZOOKEEPER-Build/trunk/src/contrib/loggraph/src/java/org/apache/zookeeper/graph/TxnLogSource.java:333: deserializeTxn(byte[],org.apache.zookeeper.txn.TxnHeader) in org.apache.zookeeper.server.util.SerializeUtils cannot be applied to (org.apache.jute.InputArchive,org.apache.zookeeper.txn.TxnHeader)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; 		Record r = SerializeUtils.deserializeTxn(iab, hdr);&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; 		                         ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; Note: Some input files use unchecked or unsafe operations.&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; Note: Recompile with -Xlint:unchecked for details.&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; 2 errors&lt;/p&gt;
</comment>
                            <comment id="13053425" author="hadoopqa" created="Wed, 22 Jun 2011 20:51:01 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12483488/zookeeper-1046-4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12483488/zookeeper-1046-4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1138213.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 30 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The patch appears to cause tar ant target to fail.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/348//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/348//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/348//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/348//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/348//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/348//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13053457" author="hadoopqa" created="Wed, 22 Jun 2011 21:34:17 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12483497/zookeeper-1046-5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12483497/zookeeper-1046-5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1138595.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 35 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/349//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/349//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/349//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/349//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/349//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/349//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13053656" author="breed" created="Thu, 23 Jun 2011 05:56:38 +0100"  >&lt;p&gt;+1 good find. sorry i missed the contrib.&lt;/p&gt;</comment>
                            <comment id="13053942" author="fournc" created="Thu, 23 Jun 2011 17:05:12 +0100"  >&lt;p&gt;committed to trunk: &lt;br/&gt;
New Revision: 1138957&lt;br/&gt;
New Revision: 1138958 (jute file)&lt;/p&gt;</comment>
                            <comment id="13054361" author="hudson" created="Fri, 24 Jun 2011 11:56:23 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #1223 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/1223/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/1223/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1046&quot; title=&quot;Creating a new sequential node results in a ZNODEEXISTS error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1046&quot;&gt;&lt;del&gt;ZOOKEEPER-1046&lt;/del&gt;&lt;/a&gt;: Creating a new sequential node results in a ZNODEEXISTS error&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1046&quot; title=&quot;Creating a new sequential node results in a ZNODEEXISTS error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1046&quot;&gt;&lt;del&gt;ZOOKEEPER-1046&lt;/del&gt;&lt;/a&gt;: Creating a new sequential node results in a ZNODEEXISTS error&lt;/p&gt;

&lt;p&gt;camille : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1138958&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1138958&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/src/zookeeper.jute&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;camille : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1138957&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1138957&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/persistence/FileTxnSnapLog.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/SerializationPerfTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/DeserializationPerfTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/util/SerializeUtils.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/DataTreeTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/contrib/loggraph/src/java/org/apache/zookeeper/graph/TxnLogSource.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/ReadOnlyModeTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/DataNode.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/DataTree.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/persistence/FileTxnLog.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/LogFormatter.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/LoadFromLogTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Follower.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/DataTreeUnitTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/LearnerHandler.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Learner.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/upgrade/UpgradeSnapShotV1.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Observer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13055028" author="mahadev" created="Sun, 26 Jun 2011 07:37:15 +0100"  >&lt;p&gt;Camille/Ben, did you forget to resolve thei jira? Is this already committed to 3.4 release?&lt;/p&gt;</comment>
                            <comment id="13055170" author="fournc" created="Sun, 26 Jun 2011 21:42:14 +0100"  >&lt;p&gt;trunk:&lt;br/&gt;
New Revision: 1138957&lt;br/&gt;
New Revision: 1138958 (jute file)&lt;br/&gt;
3.3:&lt;br/&gt;
svn commit: r1136440&lt;/p&gt;</comment>
                            <comment id="13060760" author="vishalmlst" created="Wed, 6 Jul 2011 19:53:34 +0100"  >&lt;p&gt;Hi Ben, Camille,&lt;/p&gt;

&lt;p&gt;Sorry for the delayed response. I don&apos;t think this patch fixes the bug entirely.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&amp;#8212; src/java/main/org/apache/zookeeper/server/persistence/FileTxnSnapLog.java	(revision 1138571)&lt;br/&gt;
+++ src/java/main/org/apache/zookeeper/server/persistence/FileTxnSnapLog.java	(working copy)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;br/&gt;
+        if ((hdr.getType() == OpCode.create &amp;amp;&amp;amp;&lt;br/&gt;
+                rc.err == Code.NODEEXISTS.intValue()) &amp;amp;&amp;amp;&lt;br/&gt;
+                ((CreateTxn)txn).getParentCVersion() == -1) { &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The if condition above is applied only when we are using older version of CreateTxn. Don&apos;t we need the part that sets the value for cversion when ((CreateTxn)txn).getParentCVersion() is &amp;gt; 0? Looks like we need an else here that sets parent cversion to the cversion in createTxn. Am I missing something?&lt;/p&gt;

&lt;p&gt;-Vishal&lt;/p&gt;</comment>
                            <comment id="13060766" author="vishalmlst" created="Wed, 6 Jul 2011 20:01:18 +0100"  >&lt;p&gt;Reopening this bug based on my previous comment. &lt;/p&gt;</comment>
                            <comment id="13060846" author="fournc" created="Wed, 6 Jul 2011 22:16:22 +0100"  >&lt;p&gt;I think you are right, Vishal, good catch. The perils of making changes without reproducible tests! Do you want to submit a fix for it?&lt;/p&gt;</comment>
                            <comment id="13061339" author="vishalmlst" created="Thu, 7 Jul 2011 15:24:44 +0100"  >&lt;p&gt;I can work on the patch. I will see if we can have a test that fails without the patch.&lt;/p&gt;</comment>
                            <comment id="13063593" author="vishalmlst" created="Tue, 12 Jul 2011 00:07:54 +0100"  >&lt;p&gt;&lt;br/&gt;
Attaching patch for trunk. For some reason some of the core tests are failing for me (and also on hudson). The test that is relevant to this patch is passing.&lt;/p&gt;</comment>
                            <comment id="13063594" author="vishalmlst" created="Tue, 12 Jul 2011 00:08:49 +0100"  >&lt;p&gt;for trunk.&lt;/p&gt;</comment>
                            <comment id="13063609" author="hadoopqa" created="Tue, 12 Jul 2011 00:34:43 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12486118/ZOOKEEPER-1046-6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12486118/ZOOKEEPER-1046-6.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1144087.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 16 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/389//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/389//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/389//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/389//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/389//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/389//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13063952" author="fournc" created="Tue, 12 Jul 2011 16:25:38 +0100"  >&lt;p&gt;Looks great Vishal, thanks for seeing this through. Only question is whether we want to increase the log level to info from debug in the case that we see the NODEEXISTS failure in FileTxnSnapLog. I suspect we want to leave it at debug, if you agree I&apos;ll just correct that and check it in.&lt;/p&gt;</comment>
                            <comment id="13064002" author="vishalmlst" created="Tue, 12 Jul 2011 18:04:07 +0100"  >&lt;p&gt;Hi Camille,&lt;/p&gt;

&lt;p&gt;Thanks. I am ok with that change. I am hoping it won&apos;t be too much of an effort for you as last time to merge this in 3.3.&lt;/p&gt;</comment>
                            <comment id="13064025" author="fournc" created="Tue, 12 Jul 2011 18:32:52 +0100"  >&lt;p&gt;Nah, since it only applies to the 3.4 release (ben&apos;s change is just for 3.4), it is no effort at all. Thanks!&lt;/p&gt;</comment>
                            <comment id="13064555" author="fournc" created="Wed, 13 Jul 2011 14:51:17 +0100"  >&lt;p&gt;Checked in Vishal&apos;s fix: r1146025 - in /zookeeper/trunk: ./ src/java/main/org/apache/zookeeper/server/ src/java/main/org/apache/zookeeper/server/persistence/ src/java/test/org/apache/zookeeper/test/&lt;/p&gt;</comment>
                            <comment id="13064829" author="mahadev" created="Wed, 13 Jul 2011 21:47:37 +0100"  >&lt;p&gt;camille/vishal, &lt;br/&gt;
  Are we waiting for this to be ported to 3.3 branch before resolving this? &lt;/p&gt;</comment>
                            <comment id="13064839" author="fournc" created="Wed, 13 Jul 2011 22:03:41 +0100"  >&lt;p&gt;I&apos;m waiting on the build to run successfully before I resolve it.&lt;/p&gt;</comment>
                            <comment id="13064844" author="mahadev" created="Wed, 13 Jul 2011 22:05:32 +0100"  >&lt;p&gt;great, thanks!&lt;/p&gt;</comment>
                            <comment id="13065177" author="hudson" created="Thu, 14 Jul 2011 11:56:42 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #1243 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/1243/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/1243/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1046&quot; title=&quot;Creating a new sequential node results in a ZNODEEXISTS error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1046&quot;&gt;&lt;del&gt;ZOOKEEPER-1046&lt;/del&gt;&lt;/a&gt;: Creating a new sequential node results in a ZNODEEXISTS error&lt;/p&gt;

&lt;p&gt;camille : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1146025&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1146025&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/persistence/FileTxnSnapLog.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/DataTree.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/LoadFromLogTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/DataTreeTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13139007" author="tdunning" created="Sat, 29 Oct 2011 01:27:28 +0100"  >&lt;p&gt;Camille, &lt;/p&gt;

&lt;p&gt;I think you are right.  The code for multi needs to handle whatever it has to in order to guarantee idempotency.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12486118" name="ZOOKEEPER-1046-6.patch" size="8587" author="vishalmlst" created="Tue, 12 Jul 2011 00:07:54 +0100"/>
                            <attachment id="12481458" name="ZOOKEEPER-1046-for333" size="13497" author="fournc" created="Sat, 4 Jun 2011 17:58:47 +0100"/>
                            <attachment id="12478444" name="ZOOKEEPER-1046.patch" size="8530" author="vishalmlst" created="Fri, 6 May 2011 17:08:13 +0100"/>
                            <attachment id="12476501" name="ZOOKEEPER-1046.patch" size="1434" author="strib" created="Sat, 16 Apr 2011 01:19:19 +0100"/>
                            <attachment id="12479099" name="ZOOKEEPER-1046.patch1" size="13488" author="vishalmlst" created="Fri, 13 May 2011 14:40:27 +0100"/>
                            <attachment id="12476295" name="ZOOKEEPER-1046.tgz" size="4249612" author="strib" created="Thu, 14 Apr 2011 02:44:18 +0100"/>
                            <attachment id="12483386" name="ZOOKEEPER-1046_2.patch" size="26271" author="breed" created="Wed, 22 Jun 2011 02:57:18 +0100"/>
                            <attachment id="12483478" name="zookeeper-1046-3" size="25942" author="fournc" created="Wed, 22 Jun 2011 19:37:24 +0100"/>
                            <attachment id="12483488" name="zookeeper-1046-4.patch" size="27030" author="fournc" created="Wed, 22 Jun 2011 20:29:03 +0100"/>
                            <attachment id="12483497" name="zookeeper-1046-5.patch" size="28735" author="fournc" created="Wed, 22 Jun 2011 21:06:55 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 13 Apr 2011 14:39:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47502</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxztgn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32757</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>sequential znodeexists</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>