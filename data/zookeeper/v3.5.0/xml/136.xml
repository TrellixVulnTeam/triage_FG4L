<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:46:45 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-136/ZOOKEEPER-136.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-136] sync causes hang in all followers of quorum</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-136</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;The attached test causes all of the followers of a quorum to hang. Leader continues to function correctly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12403781">ZOOKEEPER-136</key>
            <summary>sync causes hang in all followers of quorum</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="breed">Benjamin Reed</assignee>
                                    <reporter username="phunt">Patrick Hunt</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Sep 2008 19:27:46 +0100</created>
                <updated>Sun, 26 Oct 2008 01:10:42 +0000</updated>
                            <resolved>Fri, 3 Oct 2008 14:12:35 +0100</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12628693" author="phunt" created="Fri, 5 Sep 2008 19:35:27 +0100"  >&lt;p&gt;The TestSync test fails on my ubuntu 1core laptop.&lt;/p&gt;

&lt;p&gt;the test basically:&lt;/p&gt;

&lt;p&gt;starts a 5 server quroum&lt;/p&gt;

&lt;p&gt;starts a client against each server (so 5 clients)&lt;/p&gt;

&lt;p&gt;each client does the following (async ops) on a node it owns:&lt;br/&gt;
1) create node&lt;br/&gt;
2) sync node&lt;br/&gt;
3) setdata node&lt;br/&gt;
4) sync node&lt;br/&gt;
5) delete node&lt;br/&gt;
6) sync node&lt;br/&gt;
7) wait for all results of ops 1-6 to complete&lt;/p&gt;

&lt;p&gt;each client does this 100 times in a loop then exits&lt;/p&gt;

&lt;p&gt;I am seeing that in most cases the client attached to the leader runs to &lt;br/&gt;
completion successfully.&lt;/p&gt;

&lt;p&gt;However the clients attached to the followers stall out (eventually TIMEOUT) waiting for the 1) operation to return. &lt;/p&gt;</comment>
                            <comment id="12628694" author="phunt" created="Fri, 5 Sep 2008 19:37:33 +0100"  >&lt;p&gt;look at time index 2008-09-05 10:53:03,911&lt;/p&gt;</comment>
                            <comment id="12628979" author="breed" created="Sun, 7 Sep 2008 16:51:54 +0100"  >&lt;p&gt;There are two problems in the code. First, the pendingSyncs hashtable assumes there will only be one pending request for a change operation. This is not a valid assumption. The syncHandler also assumes a single outstanding request for a given session since it removes the session handler from the table.&lt;/p&gt;

&lt;p&gt;I think a fix needs to get rid of both hashtables since it is very hard to do reliably. Instead we should attach information to Request to hang triggers to a list of SyncRequests. We should also tuck away the FollowerHandle to talk to in a sync specific subclass of Request.&lt;/p&gt;

&lt;p&gt;I tried doing the above and it worked out pretty well from a code understandability sense, but I still working on making test cases pass.&lt;/p&gt;</comment>
                            <comment id="12629067" author="phunt" created="Mon, 8 Sep 2008 05:34:44 +0100"  >&lt;p&gt;Ben please use this updated patch file for the basis of your fix.&lt;/p&gt;

&lt;p&gt;This patch includes everything from the last patch except:&lt;/p&gt;

&lt;p&gt;1) patched against latest svn head&lt;br/&gt;
2) cleans up a number of LOG messages, in particular adds a number of DEBUG level logs that help in tracking down issues when things go wrong.&lt;/p&gt;
</comment>
                            <comment id="12629193" author="phunt" created="Mon, 8 Sep 2008 17:28:04 +0100"  >&lt;p&gt;Ben is working on the fix.&lt;/p&gt;</comment>
                            <comment id="12629389" author="breed" created="Tue, 9 Sep 2008 06:02:28 +0100"  >&lt;p&gt;This patch includes the tests that Pat wrote and the fix for the problem.&lt;/p&gt;

&lt;p&gt;The fix involves three things:&lt;/p&gt;

&lt;p&gt;1) The leader creates a FollowerSyncRequest that contains a reference to the FollowerHandler doing the sync. This allows us to get rid of the handler hashmap.&lt;/p&gt;

&lt;p&gt;2) The pendingSyncs uses a List to track multiple syncs per change&lt;/p&gt;

&lt;p&gt;3) CommitRequest processor was changed to take a boolean to flag whether to wait for syncs to come from the leader.&lt;/p&gt;</comment>
                            <comment id="12629561" author="phunt" created="Tue, 9 Sep 2008 19:15:42 +0100"  >&lt;p&gt;Looks like some files are missing from the patch. In particular SyncTest.java, perhaps you need to svn add (them)?&lt;/p&gt;</comment>
                            <comment id="12630096" author="breed" created="Thu, 11 Sep 2008 06:33:06 +0100"  >&lt;p&gt;Added missing SyncTest.&lt;/p&gt;</comment>
                            <comment id="12633371" author="fpj" created="Mon, 22 Sep 2008 17:24:28 +0100"  >&lt;p&gt;This patch is great! It adds a FollowerSyncRequest class to represent in-flight sync operations, and it cleans up a bit the logic on the leader side. Now, there are several  modifications related to debugging messages, which don&apos;t seem to be always related to the problem is this jira. This is fine, though. I just commented because they make the patch look a lot more complex than it really is.&lt;/p&gt;

&lt;p&gt;Something I&apos;d like to understand is the functionality of matchSyncs. Why do we need a boolean flag to decide whether to process or not? Is this to differentiate the processing of sync on a leader and on a follower? In any case, it is probably a good idea to insert a comment  explaining.&lt;/p&gt;

&lt;p&gt;The comment that leads the code of SyncTest.java seems to be copied from elsewhere. Should we remove it and replace with a more representative comment?&lt;/p&gt;</comment>
                            <comment id="12635980" author="breed" created="Wed, 1 Oct 2008 10:07:17 +0100"  >&lt;p&gt;Fixed the comments suggested by Flavio. Updated the patch to trunk.&lt;/p&gt;</comment>
                            <comment id="12636626" author="fpj" created="Fri, 3 Oct 2008 14:12:35 +0100"  >&lt;p&gt;+1, the patch is good. I have committed already.&lt;/p&gt;</comment>
                            <comment id="12636808" author="hudson" created="Sat, 4 Oct 2008 12:17:31 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #103 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/103/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/103/&lt;/a&gt;)&lt;br/&gt;
    .patch&lt;/p&gt;</comment>
                            <comment id="12642732" author="phunt" created="Sun, 26 Oct 2008 01:10:42 +0000"  >&lt;p&gt;3.0.0 has been released, closing issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12391272" name="ZOOKEEPER-136.patch" size="44119" author="breed" created="Wed, 1 Oct 2008 10:07:17 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 7 Sep 2008 15:51:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48031</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzwav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33217</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>