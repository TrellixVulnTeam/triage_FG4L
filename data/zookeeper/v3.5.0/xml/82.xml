<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:43:48 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-82/ZOOKEEPER-82.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-82] Make the ZooKeeperServer more DI friendly</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-82</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;Proposed changes were discussed in &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/hadoop-zookeeper-dev/200807.mbox/%3Caf2843cd0807180907v44b310bg232be99ac0b47a27@mail.gmail.com%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;this mailing list thread&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;Basic goals are: &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Decouple the current configuration system from the public API.  I&lt;br/&gt;
see stuff like ZooKeeperServer being coupled to ServerConfig a bit.&lt;/li&gt;
	&lt;li&gt;Allow the use of setter injection in addition to constructor&lt;br/&gt;
injection. This is the most important thing needed to let spring more&lt;br/&gt;
easily configure the objects.&lt;/li&gt;
	&lt;li&gt;Move the main() methods out of the ZooKeeperServer class.&lt;/li&gt;
&lt;/ul&gt;


</description>
                <environment></environment>
        <key id="12400685">ZOOKEEPER-82</key>
            <summary>Make the ZooKeeperServer more DI friendly</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chirino">Hiram Chirino</assignee>
                                    <reporter username="chirino">Hiram Chirino</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Jul 2008 20:14:33 +0100</created>
                <updated>Sun, 26 Oct 2008 01:10:41 +0000</updated>
                            <resolved>Fri, 15 Aug 2008 18:25:41 +0100</resolved>
                                                    <fixVersion>3.0.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12615375" author="chirino" created="Mon, 21 Jul 2008 20:16:41 +0100"  >&lt;p&gt;Attaching patch that implements most of what was proposed.&lt;/p&gt;</comment>
                            <comment id="12615381" author="chirino" created="Mon, 21 Jul 2008 20:26:48 +0100"  >&lt;p&gt;While implementing this.. some smelly issues kinda poped out at me.  &lt;/p&gt;

&lt;p&gt;The jmx stuff wants to be able to access the client port, to avoid tight coupling the jmx stuff to the ServerConfig stuff, I added a clientPort field to the ZKServer.  Now that seems a little smelly cause I can imagine that the ZKServer could in theory one day be extended to operate on multiple ports.&lt;/p&gt;

&lt;p&gt;In QuorumPeer, the constructor used to initialize sockets and other usefull bits.  To support setter based injection, I moved this initialization to the start() method, so that users can:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
QuorumPeer qp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; QuorumPeer();
qp.setDataLogDir( dir );
.... &lt;span class=&quot;code-comment&quot;&gt;// more setter injection
&lt;/span&gt;qp.start();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The big difference is that QuorumPeer used to throw an IOException if the initialization failed, now that exception occurs on qp.start() instead and it is wrapped up as a RuntimeException since it&apos;s extending the Thread.start() method which does not allow IOExceptions to be thrown.&lt;/p&gt;

&lt;p&gt;Perhaps QuorumPeer should implement Runnable instead of extending Thread so that a start() method can be defined which does have the right signature. &lt;/p&gt;
</comment>
                            <comment id="12615465" author="phunt" created="Tue, 22 Jul 2008 00:19:57 +0100"  >&lt;p&gt;Assigned to Hiram.&lt;/p&gt;</comment>
                            <comment id="12616025" author="chirino" created="Wed, 23 Jul 2008 14:57:51 +0100"  >&lt;p&gt;Anybody have a chance to review the patch?&lt;/p&gt;</comment>
                            <comment id="12616164" author="phunt" created="Wed, 23 Jul 2008 18:09:17 +0100"  >&lt;p&gt;select &quot;submit patch&quot; so that it will be more visible in jira as needing to be reviewed/voted.&lt;/p&gt;

&lt;p&gt;btw, I documented the zk &quot;howtocontribute&quot; process last night:&lt;br/&gt;
&lt;a href=&quot;http://wiki.apache.org/hadoop/ZooKeeper/HowToContribute&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/hadoop/ZooKeeper/HowToContribute&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="12616770" author="phunt" created="Fri, 25 Jul 2008 06:59:52 +0100"  >&lt;p&gt;After applying this patch the zkServer.sh (trunk/bin) script fails due to main method being removed from quorum peer. Also the javadoc in QuorumPeer is referencing &quot;main&quot; method which no longer exists - was main removed accidentally? main was also removed from zookeeperserver which is the standalone server.&lt;/p&gt;

&lt;p&gt;I think we should document the public api methods which were added to zookeeperserver &amp;amp; quorumpeer classes.&lt;/p&gt;

&lt;p&gt;I like your idea of moving from extending thread to implementing runnable if it can be done with minimal impact on existing (user) code... esp since it means we don&apos;t hide the previously checked exceptions as unchecked.&lt;/p&gt;

&lt;p&gt;Note: I&apos;m not familiar with jmx, Andrew should review the updated patch, might be issues there I&apos;m not aware of, I&apos;ll add him to the watch list.&lt;/p&gt;</comment>
                            <comment id="12616954" author="chirino" created="Fri, 25 Jul 2008 18:12:53 +0100"  >&lt;p&gt;Weird the patch did not change QuorumPeer at all.  QuorumPeer did not currently have a main method. Seem someone else moved it to ManagedQuorumPeer.  But in my next patch I&apos;ll move those java docs and update the scripts.&lt;/p&gt;

&lt;p&gt;Yes main was moved from ZooKeeperServer to new class which my patch failed to include.  Sorry I&apos;ll to a attach a new patch asap. Will also add some doco for the getters/setters.&lt;/p&gt;

</comment>
                            <comment id="12617025" author="chirino" created="Fri, 25 Jul 2008 20:46:33 +0100"  >&lt;p&gt;Attaching updated patch.&lt;/p&gt;</comment>
                            <comment id="12617026" author="chirino" created="Fri, 25 Jul 2008 20:47:02 +0100"  >&lt;p&gt;Attaching updated patch.&lt;/p&gt;</comment>
                            <comment id="12617028" author="chirino" created="Fri, 25 Jul 2008 20:48:23 +0100"  >&lt;p&gt;created issue &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-100&quot; title=&quot;Avoid extending Thread in the public ZooKeeper API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-100&quot;&gt;ZOOKEEPER-100&lt;/a&gt; to track that Thread change idea.&lt;/p&gt;</comment>
                            <comment id="12617997" author="phunt" created="Tue, 29 Jul 2008 23:33:32 +0100"  >&lt;p&gt;I&apos;m still unable to apply this patch, cancelling:&lt;/p&gt;

&lt;p&gt;1) I get the following error during the patch&lt;/p&gt;

&lt;p&gt;patch -p0 &amp;lt; /home/phunt/Desktop/&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-82&quot; title=&quot;Make the ZooKeeperServer more DI friendly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-82&quot;&gt;&lt;del&gt;ZOOKEEPER-82&lt;/del&gt;&lt;/a&gt;-b.patch &lt;br/&gt;
patching file src/java/main/org/apache/zookeeper/ZooKeeper.java&lt;br/&gt;
Reversed (or previously applied) patch detected!  Assume -R? &lt;span class=&quot;error&quot;&gt;&amp;#91;n&amp;#93;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;I forced the patch, then fixed up the rejected patch issue by hand but there are still problems, &lt;/p&gt;

&lt;p&gt;2) the build is still failing (seems that the main QuroumPeerMain is referencing code in jmx module which is not included in the ant build of main (jmx code that is)):&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerMain.java:27: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; symbol  : class ObservableNIOServerCnxn&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; location: package org.apache.zookeeper.server&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; import org.apache.zookeeper.server.ObservableNIOServerCnxn;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                   ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerMain.java:92: package ObservableNIOServerCnxn does not exist&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                     return new ObservableNIOServerCnxn.Factory(getClientPort());&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                                       ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; 2 errors&lt;/p&gt;

</comment>
                            <comment id="12620439" author="phunt" created="Wed, 6 Aug 2008 22:49:33 +0100"  >&lt;p&gt;I took the liberty of updating the patch for the following:&lt;/p&gt;

&lt;p&gt;1) fixed the use of ObservableNIOServerCnxn in favor of NIOServerCnxn factory.&lt;br/&gt;
2) recreated the patch - applies cleanly (on my system at least).&lt;/p&gt;

&lt;p&gt;If the changes are acceptable please submit for review.&lt;/p&gt;</comment>
                            <comment id="12622381" author="phunt" created="Wed, 13 Aug 2008 23:47:54 +0100"  >&lt;p&gt;I&apos;m +1 on this patch btw, looks like a good change.&lt;/p&gt;</comment>
                            <comment id="12622405" author="mahadev" created="Thu, 14 Aug 2008 01:52:54 +0100"  >&lt;p&gt;+1 patch looks good ... we will need to update our wiki documentation to reflect the changes in this patch... &lt;/p&gt;</comment>
                            <comment id="12622929" author="mahadev" created="Fri, 15 Aug 2008 18:25:41 +0100"  >&lt;p&gt;I just committed this. Thanks Hiram.&lt;/p&gt;</comment>
                            <comment id="12623634" author="hudson" created="Tue, 19 Aug 2008 12:02:11 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #58 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/58/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/58/&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="12642704" author="phunt" created="Sun, 26 Oct 2008 01:10:41 +0000"  >&lt;p&gt;3.0.0 has been released, closing issues.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12401015">ZOOKEEPER-94</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12387684" name="ZOOKEEPER-82-b.patch" size="72079" author="phunt" created="Wed, 6 Aug 2008 22:49:33 +0100"/>
                            <attachment id="12386915" name="ZOOKEEPER-82-b.patch" size="68234" author="chirino" created="Fri, 25 Jul 2008 20:47:02 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 21 Jul 2008 23:19:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48063</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzynr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33599</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>