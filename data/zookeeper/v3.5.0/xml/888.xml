<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:45:22 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-888/ZOOKEEPER-888.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-888] c-client / zkpython: Double free corruption on node watcher</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-888</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;the c-client / zkpython wrapper invokes already freed watcher callback&lt;/p&gt;

&lt;p&gt;steps to reproduce:&lt;br/&gt;
  0. start a zookeper server on your machine&lt;br/&gt;
  1. run the attached python script&lt;br/&gt;
  2. suspend the zookeeper server process (e.g. using `pkill -STOP -f org.apache.zookeeper.server.quorum.QuorumPeerMain` )&lt;br/&gt;
  3. wait until the connection and the node observer fired with a session event&lt;br/&gt;
  4. resume the zookeeper server process  (e.g. using `pkill -CONT -f org.apache.zookeeper.server.quorum.QuorumPeerMain` )&lt;/p&gt;

&lt;p&gt;-&amp;gt; the client tries to dispatch the node observer function again, but it was already freed -&amp;gt; double free corruption&lt;/p&gt;</description>
                <environment></environment>
        <key id="12476669">ZOOKEEPER-888</key>
            <summary>c-client / zkpython: Double free corruption on node watcher</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mr_luk">Lukas</assignee>
                                    <reporter username="mr_luk">Lukas</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Oct 2010 14:26:52 +0100</created>
                <updated>Wed, 23 Nov 2011 19:22:44 +0000</updated>
                            <resolved>Tue, 19 Oct 2010 20:02:22 +0100</resolved>
                                    <version>3.3.1</version>
                                    <fixVersion>3.3.2</fixVersion>
                    <fixVersion>3.3.3</fixVersion>
                    <fixVersion>3.4.0</fixVersion>
                                    <component>c client</component>
                    <component>contrib-bindings</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12918514" author="mr_luk" created="Wed, 6 Oct 2010 14:28:21 +0100"  >&lt;p&gt;Example code for triggering the bug&lt;/p&gt;</comment>
                            <comment id="12918561" author="phunt" created="Wed, 6 Oct 2010 17:06:23 +0100"  >&lt;p&gt;Borderline blocker, Henry any insight on this? Something that can be addressed for 3.3.2?&lt;/p&gt;</comment>
                            <comment id="12918880" author="mr_luk" created="Thu, 7 Oct 2010 11:52:23 +0100"  >&lt;p&gt;Seems to demonstrate the same issue.&lt;/p&gt;</comment>
                            <comment id="12919131" author="austin" created="Fri, 8 Oct 2010 02:24:37 +0100"  >&lt;p&gt;Path that prevents freeing a watcher in response to a session event, per the feedback in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-890&quot; title=&quot;C client invokes watcher callbacks multiple times&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-890&quot;&gt;&lt;del&gt;ZOOKEEPER-890&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12919552" author="austin" created="Sun, 10 Oct 2010 02:51:33 +0100"  >&lt;p&gt;Improved patch attached. Before, watcher_dispatch would unconditionally free non-global watcher objects.&lt;/p&gt;

&lt;p&gt;Any number of recoverable session state change events may be sent to the watcher. This change frees the watcher only on the last callback- a data change event or unrecoverable session state change.&lt;/p&gt;</comment>
                            <comment id="12921105" author="henryr" created="Thu, 14 Oct 2010 21:10:25 +0100"  >&lt;p&gt;The patch looks good to me - thanks! &lt;/p&gt;

&lt;p&gt;Could you add a test case that verifies the correct behaviour, if possible? (I appreciate it can be hard to fake unrecoverable session errors). We keep circling around the correct behaviour for this code block, and I&apos;d like to capture it in a test suite.&lt;/p&gt;</comment>
                            <comment id="12921216" author="austin" created="Fri, 15 Oct 2010 05:12:39 +0100"  >&lt;p&gt;Updated &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-888&quot; title=&quot;c-client / zkpython: Double free corruption on node watcher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-888&quot;&gt;&lt;del&gt;ZOOKEEPER-888&lt;/del&gt;&lt;/a&gt;.patch with the following changes:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Fixed zookeeper.is_unrecoverable to return the correct value, it was returning false in all cases.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added watcher_test.py to cover the issue this patch fixes. Verified that it crashes before patching and succeeds afterward.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12922209" author="henryr" created="Mon, 18 Oct 2010 19:46:48 +0100"  >&lt;p&gt;The patch as it stands relies on &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-853&quot; title=&quot;Make zookeeper.is_unrecoverable return True or False and not an integer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-853&quot;&gt;&lt;del&gt;ZOOKEEPER-853&lt;/del&gt;&lt;/a&gt; (which it fixes) which is not in 3.3 as it is a small API change - it changes is_unrecoverable to return Python True or False, rather than ZINVALIDSTATE. &lt;/p&gt;

&lt;p&gt;So I&apos;m not certain about what to do here - we try not to change APIs between minor versions. However, this is a very minor change, and this patch fixes a significant bug. I&apos;m inclined to commit both 853 and this patch to 3.3 as well as trunk, and put a note in the release notes. &lt;/p&gt;

&lt;p&gt;Any objections?&lt;/p&gt;</comment>
                            <comment id="12922355" author="phunt" created="Tue, 19 Oct 2010 00:34:24 +0100"  >&lt;p&gt;Can we backport the 853 change into 3.3, but not change the API? Big overhead or straightforward/simple?&lt;/p&gt;</comment>
                            <comment id="12922418" author="austin" created="Tue, 19 Oct 2010 04:51:35 +0100"  >&lt;p&gt;Patch based on the 3.3 branch attached (&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-888&quot; title=&quot;c-client / zkpython: Double free corruption on node watcher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-888&quot;&gt;&lt;del&gt;ZOOKEEPER-888&lt;/del&gt;&lt;/a&gt;-3.3.patch). Verified that unit tests pass with the changes, including the new watcher_test.&lt;/p&gt;</comment>
                            <comment id="12922670" author="henryr" created="Tue, 19 Oct 2010 20:01:26 +0100"  >&lt;p&gt;I just committed this to origin/branch-3.3 and origin/trunk. &lt;/p&gt;

&lt;p&gt;Thanks both!&lt;/p&gt;</comment>
                            <comment id="12922909" author="hudson" created="Wed, 20 Oct 2010 11:51:48 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #972 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/ZooKeeper-trunk/972/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/ZooKeeper-trunk/972/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-888&quot; title=&quot;c-client / zkpython: Double free corruption on node watcher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-888&quot;&gt;&lt;del&gt;ZOOKEEPER-888&lt;/del&gt;&lt;/a&gt;: c-client / zkpython: Double free corruption on node&lt;br/&gt;
watcher (Austin Shoemaker via henryr)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12461931">ZOOKEEPER-740</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12476748">ZOOKEEPER-890</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12457518" name="ZOOKEEPER-888-3.3.patch" size="4449" author="austin" created="Tue, 19 Oct 2010 04:51:35 +0100"/>
                            <attachment id="12457228" name="ZOOKEEPER-888.patch" size="4634" author="austin" created="Fri, 15 Oct 2010 05:12:38 +0100"/>
                            <attachment id="12456502" name="resume-segfault.py" size="912" author="mr_luk" created="Wed, 6 Oct 2010 14:28:21 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 6 Oct 2010 16:06:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47562</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxztvz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32826</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>