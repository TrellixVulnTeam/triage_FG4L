<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:43:52 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-795/ZOOKEEPER-795.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-795] eventThread isn&apos;t shutdown after a connection &quot;session expired&quot; event coming</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-795</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I notice a problem with the eventThread located in ClientCnxn.java file.&lt;br/&gt;
The eventThread isn&apos;t shutdown after a connection &quot;session expired&quot; event coming (i.e. never receive EventOfDeath).&lt;/p&gt;

&lt;p&gt;When a session timeout occurs and the session is marked as expired, the connexion is fully closed (socket, SendThread...) expect for the eventThread.&lt;br/&gt;
As a result, if i create a new zookeeper object and connect through it, I got a zombi thread which will never be kill (as for the previous zookeeper object, the state is already close, calling close again don&apos;t do anything).&lt;/p&gt;

&lt;p&gt;So everytime I will create a new zookeeper connection after a expired session, I will have a one more zombi EventThread.&lt;/p&gt;

&lt;p&gt;How to reproduce :&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Start a zookeeper client connection in debug mode&lt;/li&gt;
	&lt;li&gt;Pause the jvm enough time to the expired event occur&lt;/li&gt;
	&lt;li&gt;Watch for example with jvisualvm the list of threads, the sendThread is succesfully killed, but the EventThread go to wait state for a infinity of time&lt;/li&gt;
	&lt;li&gt;if you reopen a new zookeeper connection, and do again the previous steps, another EventThread will be present in infinite wait state&lt;/li&gt;
&lt;/ul&gt;




</description>
                <environment>&lt;p&gt;ubuntu 10.04&lt;/p&gt;</environment>
        <key id="12468037">ZOOKEEPER-795</key>
            <summary>eventThread isn&apos;t shutdown after a connection &quot;session expired&quot; event coming</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dorserg">Sergey Doroshenko</assignee>
                                    <reporter username="mbarcikowski">mathieu barcikowski</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Jun 2010 11:12:26 +0100</created>
                <updated>Thu, 13 Jun 2013 19:28:19 +0100</updated>
                            <resolved>Tue, 17 Aug 2010 21:05:18 +0100</resolved>
                                    <version>3.3.1</version>
                                    <fixVersion>3.3.2</fixVersion>
                    <fixVersion>3.4.0</fixVersion>
                                    <component>java client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12883316" author="phunt" created="Mon, 28 Jun 2010 22:36:13 +0100"  >&lt;p&gt;A second user reported this issue to me. &lt;/p&gt;

&lt;p&gt;When we fix this we should also address the event thread naming. Where the user creates a new session from within the event thread context we end up with a very long thread name (we keep appending the thread name to the parent thread... so main-event-event-event-event, etc...)&lt;/p&gt;</comment>
                            <comment id="12883608" author="dlord" created="Tue, 29 Jun 2010 17:50:41 +0100"  >&lt;p&gt;Here is a test class that illustrates the problem using Thread#suspend and Thread#resume to simulate long GC times or other halted JVM problems.  There is a simple wrapper around a ZooKeeper client handle that will connect another client in the event that its managed client receives an Expired event.  The longer that the test program runs the more runaway EventThreads will be created and displayed.&lt;/p&gt;

&lt;p&gt;The only dependencies are on the ZooKeeper libraries.&lt;/p&gt;</comment>
                            <comment id="12886733" author="dorserg" created="Fri, 9 Jul 2010 15:57:43 +0100"  >&lt;p&gt;This simple patch fixes both issues.&lt;br/&gt;
No tests included, verified with Daniel&apos;s class. Not sure if we need yet another 20-seconds test for this.&lt;/p&gt;</comment>
                            <comment id="12887854" author="mahadev" created="Tue, 13 Jul 2010 18:11:36 +0100"  >&lt;p&gt;ben, can you take a look at this?&lt;/p&gt;</comment>
                            <comment id="12891304" author="dorserg" created="Thu, 22 Jul 2010 20:54:54 +0100"  >&lt;p&gt;Has anybody had a chance to look at the patch?&lt;/p&gt;</comment>
                            <comment id="12893510" author="breed" created="Thu, 29 Jul 2010 06:25:06 +0100"  >&lt;p&gt;i&apos;ve added a test. (added to the existing session expiration test, so it shouldn&apos;t add any running time to the tests)&lt;/p&gt;</comment>
                            <comment id="12894679" author="hadoopqa" created="Mon, 2 Aug 2010 21:00:19 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12450795/ZOOKEEPER-795.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12450795/ZOOKEEPER-795.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 980576.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/101/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/101/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/101/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/101/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/101/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/101/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12895577" author="mahadev" created="Thu, 5 Aug 2010 08:11:28 +0100"  >&lt;p&gt;I have committed this to trunk. but the patch does not apply 3.3.2.&lt;/p&gt;

&lt;p&gt;ben can you provide a patch for 3.3.2? &lt;/p&gt;

&lt;p&gt;thanks&lt;/p&gt;</comment>
                            <comment id="12897366" author="mahadev" created="Wed, 11 Aug 2010 19:24:08 +0100"  >&lt;p&gt;ben, pinging again, can you provide a patch for 3.3.2?&lt;/p&gt;</comment>
                            <comment id="12897853" author="phunt" created="Thu, 12 Aug 2010 18:39:40 +0100"  >&lt;p&gt;This is blocking a release candidate for 3.3.2, if we can get this in soon I&apos;ll start running through the release process.&lt;/p&gt;</comment>
                            <comment id="12899553" author="breed" created="Tue, 17 Aug 2010 21:05:18 +0100"  >&lt;p&gt;Committed revision 986470. in branch 3.3&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12652695">DOSGI-191</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12448324" name="ExpiredSessionThreadLeak.java" size="8429" author="dlord" created="Tue, 29 Jun 2010 17:50:41 +0100"/>
                            <attachment id="12450795" name="ZOOKEEPER-795.patch" size="4503" author="breed" created="Thu, 29 Jul 2010 06:25:05 +0100"/>
                            <attachment id="12449085" name="ZOOKEEPER-795.patch" size="2099" author="dorserg" created="Fri, 9 Jul 2010 15:57:42 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 28 Jun 2010 21:36:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47595</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzu4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32864</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>