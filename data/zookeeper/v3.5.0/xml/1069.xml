<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:43:22 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1069/ZOOKEEPER-1069.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1069] Calling shutdown() on a QuorumPeer too quickly can lead to a corrupt log</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1069</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;I&apos;ve only seen this happen once.  In order to restart Zookeeper with a new set of servers, we have a wrapper class that calls shutdown() on an existing QuorumPeer, and then starts a new one with a new set of servers.  Specifically, our shutdown code looks like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt;(_quorum_peer) {
    _quorum_peer.shutdown();
    FastLeaderElection fle = (FastLeaderElection) _quorum_peer.getElectionAlg();
    fle.shutdown();  &lt;span class=&quot;code-comment&quot;&gt;// I think &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is unnecessary
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      _quorum_peer.getTxnFactory().commit();
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (java.nio.channels.ClosedChannelException e) {
      &lt;span class=&quot;code-comment&quot;&gt;// ignore
&lt;/span&gt;    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;One time, our wrapper class started one QuorumPeer, and then had to shut it down and start a new one very soon after the QuorumPeer transitioned into a FOLLOWING state.  When the new QuorumPeer tried to read in the latest log from disk, it encountered a bogus magic number of all zeroes:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2011-05-18 22:42:29,823 10467 [pool-1-thread-2] FATAL org.apache.zookeeper.server.quorum.QuorumPeer  - Unable to load database on disk
java.io.IOException: Transaction log: /var/cloudnet/data/zookeeper/version-2/log.700000001 has invalid magic number 0 != 1514884167
        at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.inStreamCreated(FileTxnLog.java:510)
        at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.createInputArchive(FileTxnLog.java:527)
        at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.goToNextLog(FileTxnLog.java:493)
        at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.next(FileTxnLog.java:576)
        at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.init(FileTxnLog.java:479)
        at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.&amp;lt;init&amp;gt;(FileTxnLog.java:454)
        at org.apache.zookeeper.server.persistence.FileTxnLog.read(FileTxnLog.java:325)
        at org.apache.zookeeper.server.persistence.FileTxnSnapLog.restore(FileTxnSnapLog.java:126)
        at org.apache.zookeeper.server.ZKDatabase.loadDataBase(ZKDatabase.java:222)
        at org.apache.zookeeper.server.quorum.QuorumPeer.start(QuorumPeer.java:398)
...
2011-05-18 22:42:29,823 10467 [pool-1-thread-2] ERROR com.nicira.onix.zookeeper.Zookeeper  - Unexpected exception
java.lang.RuntimeException: Unable to run quorum server 
        at org.apache.zookeeper.server.quorum.QuorumPeer.start(QuorumPeer.java:401)
        at com.nicira.onix.zookeeper.Zookeeper.StartZookeeper(Zookeeper.java:198)
        at com.nicira.onix.zookeeper.Zookeeper.RestartZookeeper(Zookeeper.java:277)
        at com.nicira.onix.zookeeper.ZKRPCService.setServers(ZKRPC.java:83)
        at com.nicira.onix.zookeeper.Zkrpc$ZKRPCService.callMethod(Zkrpc.java:8198)
        at com.nicira.onix.rpc.RPC$10.run(RPC.java:534)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.Thread.run(Thread.java:662)
Caused by: java.io.IOException: Transaction log: /var/cloudnet/data/zookeeper/version-2/log.700000001 has invalid magic number 0 != 1514884167
        at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.inStreamCreated(FileTxnLog.java:510)
        at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.createInputArchive(FileTxnLog.java:527)
        at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.goToNextLog(FileTxnLog.java:493)
        at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.next(FileTxnLog.java:576)
        at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.init(FileTxnLog.java:479)
        at org.apache.zookeeper.server.persistence.FileTxnLog$FileTxnIterator.&amp;lt;init&amp;gt;(FileTxnLog.java:454)
        at org.apache.zookeeper.server.persistence.FileTxnLog.read(FileTxnLog.java:325)
        at org.apache.zookeeper.server.persistence.FileTxnSnapLog.restore(FileTxnSnapLog.java:126)
        at org.apache.zookeeper.server.ZKDatabase.loadDataBase(ZKDatabase.java:222)
        at org.apache.zookeeper.server.quorum.QuorumPeer.start(QuorumPeer.java:398)
        ... 8 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I looked into the code a bit, and I believe the problem comes from the fact that QuorumPeer.shutdown() does not join() on this before returning.  Here&apos;s the scenario I think can happen:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;QuorumPeer.run() notices it is in the FOLLOWING state, makes a new Follower, and calls Follower.followLeader(), which starts connecting to the leader.&lt;/li&gt;
	&lt;li&gt;In the main program thread, QuorumPeer.shutdown() is called.&lt;/li&gt;
	&lt;li&gt;Through a complicated series of calls, this eventually leads to FollowerZooKeeperServer.shutdown() being called.&lt;/li&gt;
	&lt;li&gt;This method calls SyncRequestProcess.shutdown(), which joins on this and returns.  However, it&apos;s possible that the SyncRequestProcessor thread hasn&apos;t yet been started because followLeader() hasn&apos;t yet called Learner.syncWithLeader(), which hasn&apos;t yet called ZooKeeperServer.startup(), which actually starts the thread.  Thus, the join would have no request, though a requestOfDeath is added to the queued requests list (possibly behind other requests).&lt;/li&gt;
	&lt;li&gt;Back in the main thread, FileTxnSnapLog.commit() is called, which doesn&apos;t do much because the processor hasn&apos;t processed anything yet.&lt;/li&gt;
	&lt;li&gt;Finally, ZooKeeperServer.startup is called in the QuorumPeer.run() thread, starting up the SyncRequestProcessor thread.&lt;/li&gt;
	&lt;li&gt;That thread appends some request to the log.  The log doesn&apos;t exist yet, so it creates a new one, padding it with zeroes.&lt;/li&gt;
	&lt;li&gt;Now either the SyncRequestProcessor hits the requestOfDeath or the whole QuorumPeer object is deleted.  It exits that thread without ever committing the log to disk (or the new QuorumPeer tries to read the log before the old thread gets to commit anything), and the log ends up with all zeroes instead of a proper magic number.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I haven&apos;t yet looked into whether there&apos;s an easy way to join() on the QuorumPeer thread from shutdown(), so that it won&apos;t go on to start the processor threads after it&apos;s been shutdown.  I wanted to check with the group first and see if anyone else agrees this could be a problem.&lt;/p&gt;

&lt;p&gt;I marked this as minor since I think almost no one else uses Zookeeper this way, but it&apos;s pretty important to me personally.&lt;/p&gt;

&lt;p&gt;I will upload a log file showing this behavior shortly.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux, ZK 3.3.3, 3-node cluster.&lt;/p&gt;</environment>
        <key id="12508120">ZOOKEEPER-1069</key>
            <summary>Calling shutdown() on a QuorumPeer too quickly can lead to a corrupt log</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vishalmlst">Vishal Kher</assignee>
                                    <reporter username="strib">Jeremy Stribling</reporter>
                        <labels>
                            <label>persistence</label>
                            <label>shutdown</label>
                    </labels>
                <created>Tue, 24 May 2011 00:53:31 +0100</created>
                <updated>Wed, 23 Nov 2011 19:22:21 +0000</updated>
                            <resolved>Sun, 17 Jul 2011 15:36:48 +0100</resolved>
                                    <version>3.3.3</version>
                                    <fixVersion>3.3.4</fixVersion>
                    <fixVersion>3.4.0</fixVersion>
                                    <component>quorum</component>
                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13038329" author="strib" created="Tue, 24 May 2011 01:09:15 +0100"  >&lt;p&gt;Here&apos;s a log showing this behavior, along with the log file that got produced (all zeroes, I think).&lt;/p&gt;</comment>
                            <comment id="13038343" author="strib" created="Tue, 24 May 2011 02:04:16 +0100"  >&lt;p&gt;This appears like it might be a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1060&quot; title=&quot;QuorumPeer takes a long time to shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1060&quot;&gt;&lt;del&gt;ZOOKEEPER-1060&lt;/del&gt;&lt;/a&gt;; if so, sorry for not finding it earlier.  Feel free to close if so; I&apos;ll try out the recommended fix in that JIRA in my setup.&lt;/p&gt;</comment>
                            <comment id="13038649" author="phunt" created="Tue, 24 May 2011 17:35:55 +0100"  >&lt;p&gt;Thanks for the feedback Jeremy, can you provide feedback on &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1060&quot; title=&quot;QuorumPeer takes a long time to shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1060&quot;&gt;&lt;del&gt;ZOOKEEPER-1060&lt;/del&gt;&lt;/a&gt; as to whether you have/had success with that patch?&lt;/p&gt;</comment>
                            <comment id="13038661" author="strib" created="Tue, 24 May 2011 17:55:40 +0100"  >&lt;p&gt;I added a comment there, but as I mentioned, we&apos;ve only hit this once in months of testing, and unfortunately I don&apos;t have the time to try to carefully reproduce it.  I will update if I ever see the problem again even with this patch, but based on my analysis of the logs I&apos;m pretty sure these issues are related.&lt;/p&gt;</comment>
                            <comment id="13038831" author="vishalmlst" created="Tue, 24 May 2011 22:46:41 +0100"  >
&lt;p&gt;I think this is serious bug. 1060 is just interrupting&lt;br/&gt;
QuorumPeer if it is waiting in poll() in lookForLeader().&lt;/p&gt;

&lt;p&gt;This bug I think is because of incorrect use of Java FileChannel and&lt;br/&gt;
BufferedOutputStream which is causing data to be flushed to the log&lt;br/&gt;
out of order.&lt;/p&gt;

&lt;p&gt;From FileTxnLog.append():&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;br/&gt;
    fhdr.serialize(oa, &quot;fileheader&quot;); &amp;lt;====== Buffered write&lt;br/&gt;
    currentSize = fos.getChannel().position();&lt;br/&gt;
    streamsToFlush.add(fos);&lt;br/&gt;
   }&lt;br/&gt;
   padFile(fos);&lt;/p&gt;&lt;/blockquote&gt;


&lt;p&gt;From Util.padLogFile()&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;f.getChannel().write(fill, currentSize-fill.remaining());  &amp;lt;========= Non buffered write&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;A failure after call to padLogFile, but before flushing the&lt;br/&gt;
BufferedOutputStream will lead to this bug. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I am raising the priority of this bug.&lt;br/&gt;
Please correct me if I am wrong.&lt;/p&gt;</comment>
                            <comment id="13038840" author="vishalmlst" created="Tue, 24 May 2011 22:53:54 +0100"  >&lt;p&gt;Jeremy,&lt;/p&gt;

&lt;p&gt;Can I suggest a better usage of QuorumPeer for embedded ZK? &lt;/p&gt;

&lt;p&gt;Start a thread (main) which calls QuorumPeerMain.initializeAndRun()&lt;/p&gt;

&lt;p&gt;In your application&apos;s shutdown method do:&lt;br/&gt;
quorumpeer.shutdown();&lt;br/&gt;
main.join();&lt;/p&gt;

&lt;p&gt;initializeAndrun() invokes runFromConfig() which does a quorumpeer.join.&lt;/p&gt;

&lt;p&gt;I think we need a standardize APIs for embedded ZK. I will open a JIRA for that.&lt;/p&gt;</comment>
                            <comment id="13038855" author="strib" created="Tue, 24 May 2011 23:15:51 +0100"  >&lt;p&gt;Thanks for the suggestion, but calling initializeAndRun() would mean that we&apos;d have to write our config out to a file, right?  Right now our config gets transferred to the wrapper class via RPC from another program.  We could of course write it all to a file after its transferred, but it seems like a waste of code.&lt;/p&gt;

&lt;p&gt;The other problem is that we need to be able to transition between 1 node cluster and 3 node clusters (and back), so we&apos;d need a similar method for ZooKeeperServer.  Maybe there is one and I just haven&apos;t found it yet.&lt;/p&gt;

&lt;p&gt;Could I just do a QuorumPeer.join() from my own shutdown method?&lt;/p&gt;</comment>
                            <comment id="13038867" author="vishalmlst" created="Tue, 24 May 2011 23:32:54 +0100"  >&lt;blockquote&gt;
&lt;p&gt;Could I just do a QuorumPeer.join() from my own shutdown method?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, that should work. BTW, why are you calling commit after shutdown?&lt;/p&gt;</comment>
                            <comment id="13038868" author="strib" created="Tue, 24 May 2011 23:39:24 +0100"  >&lt;blockquote&gt;
&lt;p&gt;Yeah, that should work. BTW, why are you calling commit after shutdown?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If I remember correctly, I think I ran into this problem a really long time ago, and I figured it was because I was shutting down the QuorumPeer without giving it a chance to commit to disk.  (A cursory glance at shutdown() didn&apos;t show anything that was committing the log.)  Should a QuorumPeer.join() (plus a fix for this bug) be enough to guarantee that everything gets pushed consistently do disk?&lt;/p&gt;</comment>
                            <comment id="13039449" author="vishalmlst" created="Thu, 26 May 2011 01:32:01 +0100"  >&lt;p&gt;Attaching patch. &lt;/p&gt;

&lt;p&gt;The bug can be reproduced by  killing the server after call to padLog. Verified that the patch fixes the problem (server can read the magic number after restart).&lt;/p&gt;</comment>
                            <comment id="13039450" author="vishalmlst" created="Thu, 26 May 2011 01:32:33 +0100"  >&lt;p&gt;Submitting patch for trunk.&lt;/p&gt;</comment>
                            <comment id="13039460" author="fournc" created="Thu, 26 May 2011 01:58:55 +0100"  >&lt;p&gt;The patch looks ok but could the test perhaps simulate creating a transaction log, appending the magic number, then verifying the log looks good without calling close? FileTxnLog.append is a public method so should be pretty easy to do.&lt;/p&gt;</comment>
                            <comment id="13039544" author="hadoopqa" created="Thu, 26 May 2011 08:11:19 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12480487/ZOOKEEPER-1069&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12480487/ZOOKEEPER-1069&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1125581.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 7 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/291//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/291//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/291//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/291//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/291//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/291//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13039919" author="vishalmlst" created="Thu, 26 May 2011 21:53:02 +0100"  >&lt;p&gt;need a better test.&lt;/p&gt;</comment>
                            <comment id="13039921" author="vishalmlst" created="Thu, 26 May 2011 21:55:35 +0100"  >&lt;p&gt;Hi Camille,&lt;/p&gt;

&lt;p&gt;Attaching patch with modified test.&lt;/p&gt;</comment>
                            <comment id="13039944" author="hadoopqa" created="Thu, 26 May 2011 22:24:55 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12480581/ZOOKEEPER-1069.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12480581/ZOOKEEPER-1069.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1125581.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/295//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/295//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/295//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/295//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/295//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/295//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13039963" author="fournc" created="Thu, 26 May 2011 23:11:15 +0100"  >&lt;p&gt;Looks good Vishal, +1 from me.&lt;br/&gt;
The LoadFromLogTest is not in 3.3.3. Do we want to apply this just to trunk, or to trunk and 3.3.3 minus the test?&lt;/p&gt;</comment>
                            <comment id="13039978" author="vishalmlst" created="Thu, 26 May 2011 23:48:40 +0100"  >&lt;p&gt;Thanks. I would think path for both &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1046&quot; title=&quot;Creating a new sequential node results in a ZNODEEXISTS error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1046&quot;&gt;&lt;del&gt;ZOOKEEPER-1046&lt;/del&gt;&lt;/a&gt; and this bug need to go on 3.3. I think you pointed out earlier about some issues while porting to 3.3. I also think &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-975&quot; title=&quot;new peer goes in LEADING state even if ensemble is online&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-975&quot;&gt;&lt;del&gt;ZOOKEEPER-975&lt;/del&gt;&lt;/a&gt; needs to go in 3.3.  I am not clear about the rationale behind which patch goes to which version.&lt;/p&gt;</comment>
                            <comment id="13039982" author="fournc" created="Thu, 26 May 2011 23:54:03 +0100"  >&lt;p&gt;I&apos;m not either. Could someone else chime in on the process for this?&lt;/p&gt;</comment>
                            <comment id="13040000" author="breed" created="Fri, 27 May 2011 01:04:16 +0100"  >&lt;p&gt;the basic rule i that only bug fixes go into old releases. usually we try to commit bug fixes to both the latest branch and to trunk.&lt;/p&gt;</comment>
                            <comment id="13044780" author="hudson" created="Mon, 6 Jun 2011 11:57:12 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #1205 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/ZooKeeper-trunk/1205/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/ZooKeeper-trunk/1205/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1069&quot; title=&quot;Calling shutdown() on a QuorumPeer too quickly can lead to a corrupt log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1069&quot;&gt;&lt;del&gt;ZOOKEEPER-1069&lt;/del&gt;&lt;/a&gt;: Calling shutdown() on a QuorumPeer too quickly can lead to a corrupt log&lt;/p&gt;

&lt;p&gt;camille : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1132489&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1132489&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/persistence/FileTxnLog.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/LoadFromLogTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13048429" author="henryr" created="Sun, 12 Jun 2011 21:09:31 +0100"  >&lt;p&gt;Was a bit hasty closing this, I see that Camille is still trying to backport this to 3.3.3.&lt;/p&gt;</comment>
                            <comment id="13048692" author="fournc" created="Mon, 13 Jun 2011 19:19:58 +0100"  >&lt;p&gt;I will try to finish this up later this week.&lt;/p&gt;</comment>
                            <comment id="13049289" author="fpj" created="Tue, 14 Jun 2011 18:21:26 +0100"  >&lt;p&gt;It should be 3.3.4 and not 3.3.3 (thanks for pointing out, Mahadev).&lt;/p&gt;</comment>
                            <comment id="13066607" author="mahadev" created="Sun, 17 Jul 2011 10:09:34 +0100"  >&lt;p&gt;Camille/Falvio,&lt;br/&gt;
 Any progress on this? Can we close this now?&lt;/p&gt;</comment>
                            <comment id="13066613" author="fpj" created="Sun, 17 Jul 2011 11:51:55 +0100"  >&lt;p&gt;My understanding is that we have committed a patch for this jira to trunk, but there is still a patch missing for the 3.3 branch. Is there anyone working on a patch for 3.3? Camille, Vishal?&lt;/p&gt;</comment>
                            <comment id="13066651" author="fournc" created="Sun, 17 Jul 2011 15:22:53 +0100"  >&lt;p&gt;Whoops sorry, somehow I lost this one. Will take a look today.&lt;/p&gt;</comment>
                            <comment id="13066655" author="fournc" created="Sun, 17 Jul 2011 15:31:13 +0100"  >&lt;p&gt;Ok the only merge needed now is deleting the LOG statement from the test (relies on slf4j) so I&apos;m just going to check it in.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12506759">ZOOKEEPER-1060</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12480487" name="ZOOKEEPER-1069" size="2872" author="vishalmlst" created="Thu, 26 May 2011 01:32:01 +0100"/>
                            <attachment id="12480188" name="ZOOKEEPER-1069.log" size="63690" author="strib" created="Tue, 24 May 2011 01:09:15 +0100"/>
                            <attachment id="12480581" name="ZOOKEEPER-1069.patch" size="2708" author="vishalmlst" created="Thu, 26 May 2011 21:55:35 +0100"/>
                            <attachment id="12480189" name="log.700000001.gz" size="65164" author="strib" created="Tue, 24 May 2011 01:09:15 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 24 May 2011 16:35:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47492</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxztc7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32737</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>