<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:40:47 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1400/ZOOKEEPER-1400.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1400] Allow logging via callback instead of raw FILE pointer</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1400</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;The existing logging framework inside the C client uses a raw FILE*. Using a FILE* is very limiting and potentially dangerous. A safer alternative is to just provide a callback that the C client will call for each message. In our environment, we saw some really nasty issues with multiple threads all connecting to zookeeper via the C Client related to the use of a raw FILE*. Specifically, if the FILE * is closed and that file descriptor is reused by the kernel before the C client is notified then the C client will use it&apos;s static global logStream pointer for subsequent logging messages. That FILE* is now a loose cannon! In our environment, we saw zookeeper log messages ending up in other sockets and even in our core data path. Clearly this is dangerous. In our particular case, we&apos;d omitted a call to zoo_set_log_stream(NULL) to notify C client that the FILE* has been closed. However, even with that bug fixed, there&apos;s still a race condition where log messages in flight may be sent before the C client is notified of the FILE closure, and the same problem can happen.&lt;/p&gt;

&lt;p&gt;Other issues we&apos;ve seen involved multiple threads, wherein one would close the FILE*, and that&apos;s a global change that affects all threads connected within that process. That&apos;s a pretty nasty limitation as well.&lt;/p&gt;

&lt;p&gt;My proposed change is to allow setting a callback for log messages. A callback is used in preference to a raw FILE*. If no callback is set, then it will fallback to the existing FILE*. If that&apos;s not set, then it falls back to stderr as it always has.&lt;/p&gt;

&lt;p&gt;While refactoring this code, I removed the need for the double parens in all the LOG macros as that wasn&apos;t necessary and didn&apos;t fit with my new approach.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux&lt;/p&gt;</environment>
        <key id="12543913">ZOOKEEPER-1400</key>
            <summary>Allow logging via callback instead of raw FILE pointer</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="michim">Michi Mutsuzaki</assignee>
                                    <reporter username="marshall">Marshall McMullen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Feb 2012 22:18:34 +0000</created>
                <updated>Wed, 21 Aug 2013 12:06:45 +0100</updated>
                            <resolved>Wed, 21 Aug 2013 10:41:27 +0100</resolved>
                                    <version>3.5.0</version>
                                    <fixVersion>3.5.0</fixVersion>
                                    <component>c client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13215121" author="marshall" created="Thu, 23 Feb 2012 22:20:02 +0000"  >&lt;p&gt;Please see attached path that provides my new proposed functionality.&lt;/p&gt;</comment>
                            <comment id="13215686" author="tyree731" created="Fri, 24 Feb 2012 15:44:39 +0000"  >&lt;p&gt;This is a really great change. I&apos;ve gone so far as to both create a global FILE* singleton instance to prevent race conditions from closing the handle and to create a pipe that is written to from a FILE* and read from a part of my code to deal with this interface&apos;s shortcomings. If we&apos;re going this far, might I also suggest we add logging on a per connection basis? For a large application using Zookeeper, there might be multiple consumers/connections who want to manage logs each in their own special way.&lt;/p&gt;</comment>
                            <comment id="13215748" author="marshall" created="Fri, 24 Feb 2012 17:15:41 +0000"  >&lt;p&gt;Thanks for the great feedback. I absolutely agree that the logging should be on a connection basis. I was hesitant to make an even more drastic change than I already had. Do you think changing the logging to be per-connection should be a separate JIRA or does it make sense to do it as part of this case as well?&lt;/p&gt;</comment>
                            <comment id="13230364" author="tyree731" created="Thu, 15 Mar 2012 17:54:13 +0000"  >&lt;p&gt;Sorry for the delay&lt;/p&gt;

&lt;p&gt;I think that would make sense to be a separate JIRA. As far as your change goes it looks good, but a couple of points:&lt;/p&gt;

&lt;p&gt;+    char* buf = get_format_log_buffer();&lt;/p&gt;

&lt;p&gt;This means there is now a limit on log size that wasn&apos;t there before. Have you made sure this buffer can handle all possible log messages?&lt;/p&gt;

&lt;p&gt;Also, you made a bunch of formatting changes that seem tangential to the change itself, like the following:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;static const char* dbgLevelStr[]=
{&quot;ZOO_INVALID&quot;,&quot;ZOO_ERROR&quot;,&quot;ZOO_WARN&quot;,
-            &quot;ZOO_INFO&quot;,&quot;ZOO_DEBUG&quot;}
&lt;p&gt;;&lt;br/&gt;
+    char* buf = get_format_log_buffer();&lt;br/&gt;
+    if(!buf)&lt;br/&gt;
+        return;&lt;br/&gt;
+&lt;br/&gt;
+    static const char* dbgLevelStr[] = &lt;/p&gt;
{&quot;ZOO_INVALID&quot;,
+                                        &quot;ZOO_ERROR&quot;,
+                                        &quot;ZOO_WARN&quot;,
+                                        &quot;ZOO_INFO&quot;,
+                                        &quot;ZOO_DEBUG&quot;}
&lt;p&gt;;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Maybe those should be reserved for a separate change just to keep things tidy?&lt;/p&gt;</comment>
                            <comment id="13263546" author="michim" created="Fri, 27 Apr 2012 10:49:49 +0100"  >&lt;p&gt;Hi Marshall,&lt;/p&gt;

&lt;p&gt;Sorry for the late response. This is a great patch! Here are my comments:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The documentation for &lt;tt&gt;zoo_set_log_callback()&lt;/tt&gt; should make it clear that the callback will be invoked by multiple threads and therefore it needs to be thread-safe.&lt;/li&gt;
	&lt;li&gt;We probably want to log something if &lt;tt&gt;get_format_log_buffer()&lt;/tt&gt; returns NULL, something similar to &quot;format_log_message: Unable to allocate memory buffer&quot;.&lt;/li&gt;
	&lt;li&gt;Do you need to pass &lt;tt&gt;FORMAT_LOG_BUF_SIZE-1&lt;/tt&gt; to &lt;tt&gt;snprintf()&lt;/tt&gt;, or would &lt;tt&gt;FORMAT_LOG_BUF_SIZE&lt;/tt&gt; work? I thought &lt;tt&gt;snprintf()&lt;/tt&gt; guarantees that the output is null-terminated.&lt;/li&gt;
	&lt;li&gt;This patch should be unit-tested (now that it&apos;s much easier to unit test the logging code with the callback &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;).&lt;/li&gt;
	&lt;li&gt;It would be great if you can share how you are using the callback for your logging on our wiki page. I&apos;m pretty sure many people will find it very useful.&lt;/li&gt;
	&lt;li&gt;&lt;blockquote&gt;
&lt;p&gt;While refactoring this code, I removed the need for the double parens in all the LOG macros as that wasn&apos;t necessary and didn&apos;t fit with my new approach.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Cool!&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Regarding Stephen&apos;s comment:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Yes, please put per-connection logging on a separate jira.&lt;/li&gt;
	&lt;li&gt;&lt;blockquote&gt;
&lt;p&gt;This means there is now a limit on log size that wasn&apos;t there before. Have you made sure this buffer can handle all possible log messages?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The longest line I got from the unit test was less than 500 characters. I also eyeballed all the LOG_* calls, and they all look much less than 4096 characters. It&apos;s difficult to be absolutely sure since the log message is not fixed length, but I think it would be ok.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;&lt;blockquote&gt;
&lt;p&gt;Maybe those should be reserved for a separate change just to keep things tidy?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, I generally prefer patches without cosmetic changes.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thanks!&lt;br/&gt;
--Michi &lt;/p&gt;</comment>
                            <comment id="13399533" author="marshall" created="Fri, 22 Jun 2012 20:25:50 +0100"  >&lt;p&gt;This updated patch incorporates Stephen&apos;s suggestion of making the log callback per-handle. There is still a zoo_set_log_callback function, but it now takes a zhandle_t* to associate the callback with.&lt;/p&gt;

&lt;p&gt;I&apos;ve also added a zookeeper_init2 which is the same as zookeeper_init but adds an extra argument for the log callback.&lt;/p&gt;</comment>
                            <comment id="13399535" author="marshall" created="Fri, 22 Jun 2012 20:28:00 +0100"  >&lt;p&gt;BTW, I haven&apos;t yet had time to address the additional very good comments from Stephen and Michi. Been super swamped at work... I&apos;ll add an updated patch which addresses their concerns when things quiet down for me a bit.&lt;/p&gt;</comment>
                            <comment id="13399539" author="hadoopqa" created="Fri, 22 Jun 2012 20:31:49 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12533092/ZOOKEEPER-1400.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12533092/ZOOKEEPER-1400.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1351541.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 13 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1108//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1108//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13399670" author="marshall" created="Fri, 22 Jun 2012 23:19:18 +0100"  >&lt;p&gt;My patch should apply cleanly to trunk.&lt;/p&gt;</comment>
                            <comment id="13399673" author="marshall" created="Fri, 22 Jun 2012 23:21:11 +0100"  >&lt;p&gt;Oops, I had other patches in my version so the patch isn&apos;t perfect. I&apos;ll get a new version updated momentarily.&lt;/p&gt;</comment>
                            <comment id="13399699" author="marshall" created="Sat, 23 Jun 2012 00:03:31 +0100"  >&lt;p&gt;Updated patch that should apply cleanly to trunk.&lt;/p&gt;</comment>
                            <comment id="13399721" author="hadoopqa" created="Sat, 23 Jun 2012 00:38:07 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12533125/ZOOKEEPER-1400-1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12533125/ZOOKEEPER-1400-1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1351541.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 13 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1111//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1111//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1111//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1111//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1111//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1111//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13505568" author="hadoopqa" created="Wed, 28 Nov 2012 15:42:48 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12533125/ZOOKEEPER-1400-1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12533125/ZOOKEEPER-1400-1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1414566.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 13 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1275//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1275//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13657228" author="tyree731" created="Tue, 14 May 2013 18:22:31 +0100"  >&lt;p&gt;This was a great patch. Any way we could rework it so it applies cleanly and get it tested/submitted?&lt;/p&gt;</comment>
                            <comment id="13657237" author="marshall" created="Tue, 14 May 2013 18:27:34 +0100"  >&lt;p&gt;Yes, agree. We use this heavily internally and maintaining this patch every time I upgrade zookeeper locally it getting to be a pain. So I&apos;d really like to get this integrated into zookeeper proper.&lt;/p&gt;

&lt;p&gt;I&apos;ve got some time over the next day or so. I will get this updated and think on how to do some testing against it.&lt;/p&gt;
</comment>
                            <comment id="13657239" author="fpj" created="Tue, 14 May 2013 18:28:38 +0100"  >&lt;p&gt;Hi Stephen, Would you or Marshall have time to work on a new version of the patch that applies to trunk? &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michim&quot; class=&quot;user-hover&quot; rel=&quot;michim&quot;&gt;Michi Mutsuzaki&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mahadev&quot; class=&quot;user-hover&quot; rel=&quot;mahadev&quot;&gt;Mahadev konar&lt;/a&gt;, would one of you guys have time to take a look at this patch?&lt;/p&gt;</comment>
                            <comment id="13657245" author="marshall" created="Tue, 14 May 2013 18:30:23 +0100"  >&lt;p&gt;I&apos;ll get an updated version of the patch ready today.&lt;/p&gt;

&lt;p&gt;Will take more time to add a couple unit tests around this. Shouldn&apos;t be too hard though.&lt;/p&gt;</comment>
                            <comment id="13657464" author="marshall" created="Tue, 14 May 2013 21:27:37 +0100"  >&lt;p&gt;Updated patch to apply to tip of trunk 1482502 and added some unit tests.&lt;/p&gt;</comment>
                            <comment id="13657486" author="marshall" created="Tue, 14 May 2013 21:36:57 +0100"  >&lt;p&gt;In my latest patch in addition to updating to apply to trunk cleanly, I also added 3 tests (localized to one function for convenience) and addressed Stephen and Michi&apos;s earlier comments.&lt;/p&gt;</comment>
                            <comment id="13657506" author="hadoopqa" created="Tue, 14 May 2013 21:59:11 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12583204/ZOOKEEPER-1400.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12583204/ZOOKEEPER-1400.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1482318.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 16 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1479//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1479//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1479//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1479//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1479//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1479//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13657515" author="marshall" created="Tue, 14 May 2013 22:14:20 +0100"  >&lt;p&gt;This failed test is unrelated: &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1629&quot; title=&quot;testTransactionLogCorruption occasionally fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1629&quot;&gt;&lt;del&gt;ZOOKEEPER-1629&lt;/del&gt;&lt;/a&gt;: org.apache.zookeeper.server.TruncateCorruptionTest.testTransactionLogCorruption&lt;/p&gt;</comment>
                            <comment id="13657520" author="tyree731" created="Tue, 14 May 2013 22:25:13 +0100"  >&lt;p&gt;Looked over your change Marshall, thanks for the extremely quick response! Some questions:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Why in create_completion_entry do you LOG_ERROR to LOG_STREAM instead of LOGCALLBACK? Sometimes logging to the callback and sometimes not seems like confusing behavior for an end user.&lt;/li&gt;
	&lt;li&gt;Why did you change resolve_hosts to be static? If it works with it being static, then it probably should be static, just curious of the reasoning.&lt;/li&gt;
	&lt;li&gt;You use variadic macros with log_message, and a GCC extension of them at that. Assuming you switch to the C99 way of doing them, does the Zookeeper library target C99? Would this work on Windows?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13657839" author="marshall" created="Wed, 15 May 2013 04:12:32 +0100"  >&lt;p&gt;Updated patch to address latest comments.&lt;/p&gt;</comment>
                            <comment id="13657844" author="marshall" created="Wed, 15 May 2013 04:21:06 +0100"  >&lt;p&gt;Stephen - thanks for the quick review. As to your questions:&lt;/p&gt;

&lt;p&gt;1.Why in create_completion_entry do you LOG_ERROR to LOG_STREAM instead of LOGCALLBACK? Sometimes logging to the callback and sometimes not seems like confusing behavior for an end user.&lt;/p&gt;

&lt;p&gt;That was an oversight. Didn&apos;t have a zhandle* in create_competion_entry so that was probably the easy solution at the time. I&apos;ve updated the patch to pass the zhandle* through to create_completion_entry so we can use LOGCALLBACK like everywhere else consistently.&lt;/p&gt;

&lt;p&gt;2.Why did you change resolve_hosts to be static? If it works with it being static, then it probably should be static, just curious of the reasoning.&lt;/p&gt;

&lt;p&gt;It&apos;s not a publicly documented function and does not appear in zookeeper.h and is not called anywhere outside of zookeeper.c. And there&apos;s no rational reason for that to be a public function that I could think of as it&apos;s very much internal. That said, it&apos;s definitely a tangental change so I will revert that part if that&apos;s a deal breaker for anyone. But I don&apos;t think it should be.&lt;/p&gt;

&lt;p&gt;3.You use variadic macros with log_message, and a GCC extension of them at that. Assuming you switch to the C99 way of doing them, does the Zookeeper library target C99? Would this work on Windows?&lt;/p&gt;

&lt;p&gt;Not sure what you mean here... I&apos;m not using any variadic macros. Perhaps you&apos;re referring to my use of vsnprintf? Frankly I don&apos;t do anything on windows so I often forget about it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. I am far from an expert in the &lt;em&gt;windows&lt;/em&gt; way to do this, but a quick google turned up:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://msdn.microsoft.com/en-us/library/w05tbk72%28VS.71%29.aspx&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://msdn.microsoft.com/en-us/library/w05tbk72%28VS.71%29.aspx&lt;/a&gt; &lt;br/&gt;
_vscprintf returns the number of characters that would be generated if the string pointed to by the list of arguments was printed or sent to a file or buffer using the specified formatting codes. The value returned does not include the terminating null character.&lt;/p&gt;

&lt;p&gt;Wonder why they went to the trouble to implement this instead of just implementing vsnprintf and comply with C99.&lt;/p&gt;

&lt;p&gt;Anyhow, clarify for me if that is what you&apos;re referring to. As I don&apos;t have any access to a windows machine or compiler would need someone interested in that to assist testing out my proposed solution.&lt;/p&gt;</comment>
                            <comment id="13657890" author="hadoopqa" created="Wed, 15 May 2013 05:23:24 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12583269/ZOOKEEPER-1400.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12583269/ZOOKEEPER-1400.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1482318.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 16 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1480//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1480//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1480//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1480//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1480//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1480//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13657891" author="marshall" created="Wed, 15 May 2013 05:28:03 +0100"  >&lt;p&gt;One of my new tests failed after my latest refactor. I&apos;ll look at this when I get a few minutes.&lt;/p&gt;</comment>
                            <comment id="13658336" author="tyree731" created="Wed, 15 May 2013 14:10:20 +0100"  >&lt;p&gt;re: question 3, this is in your latest patch:&lt;/p&gt;

&lt;p&gt;+#define LOG_ERROR(_cb, _msg...) if(logLevel&amp;gt;=ZOO_LOG_LEVEL_ERROR) \&lt;br/&gt;
+    log_message(&lt;em&gt;cb, ZOO_LOG_LEVEL_ERROR, __LINE&lt;/em&gt;&lt;em&gt;, __func&lt;/em&gt;_, _msg)&lt;/p&gt;

&lt;p&gt;Specifically the line _msg... and its usage in log_message, from the GCC documentation (&lt;a href=&quot;http://gcc.gnu.org/onlinedocs/cpp/Variadic-Macros.html):&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://gcc.gnu.org/onlinedocs/cpp/Variadic-Macros.html):&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&quot;If your macro is complicated, you may want a more descriptive name for the variable argument than _&lt;em&gt;VA_ARGS&lt;/em&gt;_. CPP permits this, as an extension. You may write an argument name immediately before the &#8216;...&#8217;; that name is used for the variable argument.&quot;&lt;/p&gt;

&lt;p&gt;Does that clarify my question, or am I crazy?&lt;/p&gt;</comment>
                            <comment id="13658447" author="marshall" created="Wed, 15 May 2013 16:21:28 +0100"  >&lt;p&gt;Change variadic macros to use _&lt;em&gt;VA_ARGS&lt;/em&gt;_ instead of GCC extension of named variadic args parameter.&lt;/p&gt;</comment>
                            <comment id="13658452" author="marshall" created="Wed, 15 May 2013 16:25:50 +0100"  >&lt;p&gt;Stephen - Ah, you are absolutely correct. I thought you were referring to the function log_message not the wrapper macros that call into log_message. Yes, I was using a GCC extension (didn&apos;t actually know that wasn&apos;t standard to C99). I&apos;ve revised the patch to use normal _&lt;em&gt;VA_ARGS&lt;/em&gt;_. I think the current method should work on windows, but as I have no access to a windows machine or compiler I can&apos;t verify that. I assume the pre-commit job doesn&apos;t actually try to build this on windows and that only happens after a jira is committed... that&apos;s a shame.&lt;/p&gt;

&lt;p&gt;At any rate, I&apos;ve updated the patch. I want to see if the unit test fails again. It did not fail for me locally on my machine. My test is probably too particular in the number of messages it expects to be logged. Other code paths may trigger a log message non deterministically and cause the test to fail. If that&apos;s the case I will loosen things up.&lt;/p&gt;


</comment>
                            <comment id="13658652" author="marshall" created="Wed, 15 May 2013 19:41:13 +0100"  >&lt;p&gt;Trying to resubmit patch to get it to run again.&lt;/p&gt;</comment>
                            <comment id="13658873" author="marshall" created="Wed, 15 May 2013 22:53:26 +0100"  >&lt;p&gt;Can anyone explain why my latest patch isn&apos;t getting test on Jenkins? &lt;/p&gt;</comment>
                            <comment id="13658881" author="fpj" created="Wed, 15 May 2013 23:04:38 +0100"  >&lt;p&gt;Build is running but failing, check this out:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1481/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1481/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13658886" author="marshall" created="Wed, 15 May 2013 23:12:23 +0100"  >&lt;p&gt;Interesting... I am used to seeing the test results show up in the jira. Has that changed?&lt;/p&gt;</comment>
                            <comment id="13658889" author="fpj" created="Wed, 15 May 2013 23:16:17 +0100"  >&lt;p&gt;The build aborted, that&apos;s why it didn&apos;t report:&lt;/p&gt;

&lt;p&gt;Build timed out (after 62 minutes). Marking the build as aborted.&lt;br/&gt;
Build was aborted&lt;/p&gt;

&lt;p&gt;Most likely it is not related to your patch.&lt;/p&gt;</comment>
                            <comment id="13658950" author="marshall" created="Wed, 15 May 2013 23:48:06 +0100"  >&lt;p&gt;Is there a way to get it to run again? Very confused...&lt;/p&gt;</comment>
                            <comment id="13658985" author="fpj" created="Thu, 16 May 2013 00:09:48 +0100"  >&lt;p&gt;I haven&apos;t had a chance to do it, but perhaps you could have a look at the console output of the failed build (1481) to see if you can spot the exact problem.&lt;/p&gt;

&lt;p&gt;To resubmit, just cancel the patch and submit it again. &lt;/p&gt;</comment>
                            <comment id="13659009" author="marshall" created="Thu, 16 May 2013 00:26:04 +0100"  >&lt;p&gt;Updated patch to address failing? unit test&lt;/p&gt;</comment>
                            <comment id="13659354" author="fpj" created="Thu, 16 May 2013 09:30:48 +0100"  >&lt;p&gt;It could actually be something related to this patch, but I&apos;m not sure:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Build timed out (after 62 minutes). Marking the build as aborted.
     [exec]      [exec] /bin/bash: line 5: 21011 Terminated              ZKROOT=/home/jenkins/jenkins-slave/workspace/PreCommit-ZOOKEEPER-Build/trunk/src/c/../.. CLASSPATH=$CLASSPATH:$CLOVER_HOME/lib/clover.jar ${dir}$tst
Build was aborted
     [exec]      [exec] FAIL: zktest-mt
     [exec]      [exec] ==========================================
     [exec]      [exec] 1 of 2 tests failed
     [exec]      [exec] Please report to user@zookeeper.apache.org
     [exec]      [exec] ==========================================
     [exec]      [exec] make[1]: *** [check-TESTS] Error 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Note that it says that zktest-mt has failed. I have also been trying to have it running the patch of &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1642&quot; title=&quot;Leader loading database twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1642&quot;&gt;&lt;del&gt;ZOOKEEPER-1642&lt;/del&gt;&lt;/a&gt; unsuccessfully, so it might be something else.&lt;/p&gt;</comment>
                            <comment id="13661252" author="marshall" created="Sat, 18 May 2013 04:25:19 +0100"  >&lt;p&gt;Finally had time to look at this again. Was a problem in the new unit and how they continually started/stopped ZK server and ZK client connection. Broke things out into separate tests and problems went away.&lt;/p&gt;</comment>
                            <comment id="13661263" author="hadoopqa" created="Sat, 18 May 2013 05:01:48 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12583720/ZOOKEEPER-1400.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12583720/ZOOKEEPER-1400.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1483440.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 16 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1485//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1485//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1485//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1485//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1485//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1485//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13661267" author="marshall" created="Sat, 18 May 2013 05:14:21 +0100"  >&lt;p&gt;I think everyone&apos;s concerns are addressed and resolved at this point. Please let me know if that&apos;s not the case.&lt;/p&gt;

&lt;p&gt;Would love to get this integrated into trunk sooner rather than later as it does address a very serious potential security issue. And maintaining this patch is becoming problematic as code continues to diverge... thanks!&lt;/p&gt;</comment>
                            <comment id="13661679" author="michim" created="Sun, 19 May 2013 23:04:36 +0100"  >&lt;p&gt;+1. Thank you for the great patch, Marshall!&lt;/p&gt;
</comment>
                            <comment id="13661680" author="michim" created="Sun, 19 May 2013 23:09:08 +0100"  >&lt;p&gt;Merged to trunk in r1484357.&lt;/p&gt;</comment>
                            <comment id="13661703" author="marshall" created="Mon, 20 May 2013 02:32:38 +0100"  >&lt;p&gt;Thanks very much for getting this committed Michi. Really glad to have this off my maintenance plate &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="13661897" author="hudson" created="Mon, 20 May 2013 11:59:19 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #1932 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/1932/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/1932/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1400&quot; title=&quot;Allow logging via callback instead of raw FILE pointer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1400&quot;&gt;&lt;del&gt;ZOOKEEPER-1400&lt;/del&gt;&lt;/a&gt;. Allow logging via callback instead of raw FILE pointer (Marshall McMullen via michim) (Revision 1484357)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
michim : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1484357&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1484357&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/c/include/zookeeper.h&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/c/include/zookeeper_log.h&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/c/src/load_gen.c&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/c/src/mt_adaptor.c&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/c/src/zk_adaptor.h&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/c/src/zk_log.c&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/c/src/zookeeper.c&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/c/tests/PthreadMocks.h&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/c/tests/TestClient.cc&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/c/tests/TestOperations.cc&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/c/tests/Util.h&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13662082" author="marshall" created="Mon, 20 May 2013 16:31:19 +0100"  >&lt;p&gt;Was this a patch failure or a test failure? Let me know what I can do to help.&lt;/p&gt;</comment>
                            <comment id="13662168" author="fpj" created="Mon, 20 May 2013 18:16:27 +0100"  >&lt;p&gt;Apparently the failure indicated is because of this test:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.zookeeper.server.TruncateCorruptionTest.testTransactionLogCorruption
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It sounds like it is due to &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1629&quot; title=&quot;testTransactionLogCorruption occasionally fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1629&quot;&gt;&lt;del&gt;ZOOKEEPER-1629&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13691389" author="michim" created="Sun, 23 Jun 2013 09:41:30 +0100"  >&lt;p&gt;It looks like some functions in mt_adaptor.c uses the zh variable without defining it. Windows compiler complains about this.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; handle_error(SOCKET sock, &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt;* message)
 {
        LOG_ERROR(LOGCALLBACK(zh), &lt;span class=&quot;code-quote&quot;&gt;&quot;%s. %d&quot;&lt;/span&gt;,message, WSAGetLastError());
        closesocket (sock);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; -1;
 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13691830" author="fpj" created="Mon, 24 Jun 2013 10:24:58 +0100"  >&lt;p&gt;I&apos;m observing the same when trying to compile it with VS 2012.&lt;/p&gt;</comment>
                            <comment id="13709055" author="michim" created="Mon, 15 Jul 2013 23:15:21 +0100"  >&lt;p&gt;This patch fixes windows compilation issues introduced by this JIRA. After applying this patch, we still need to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1679&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1679&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="13709158" author="hadoopqa" created="Tue, 16 Jul 2013 00:18:42 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12592421/ZOOKEEPER-1400.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12592421/ZOOKEEPER-1400.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1503101.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1518//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1518//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1518//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1518//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1518//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1518//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13709219" author="hadoopqa" created="Tue, 16 Jul 2013 01:02:43 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12592441/ZOOKEEPER-1400.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12592441/ZOOKEEPER-1400.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1503101.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1520//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1520//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1520//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1520//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1520//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1520//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13709244" author="michim" created="Tue, 16 Jul 2013 01:18:05 +0100"  >&lt;p&gt;This patch fixes compilation errors, so there are no new tests.&lt;/p&gt;</comment>
                            <comment id="13745162" author="fpj" created="Tue, 20 Aug 2013 18:28:35 +0100"  >&lt;p&gt;I&apos;ve given this patch a try along with &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1679&quot; title=&quot;c client: use -Wdeclaration-after-statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1679&quot;&gt;&lt;del&gt;ZOOKEEPER-1679&lt;/del&gt;&lt;/a&gt; and it works fine, +1.&lt;/p&gt;

&lt;p&gt;I still get a lot of warnings on Visual Studio 2012, though.&lt;/p&gt;</comment>
                            <comment id="13745896" author="fpj" created="Wed, 21 Aug 2013 10:41:27 +0100"  >&lt;p&gt;Committed revision 1516123.&lt;/p&gt;</comment>
                            <comment id="13745943" author="hudson" created="Wed, 21 Aug 2013 12:06:45 +0100"  >&lt;p&gt;SUCCESS: Integrated in ZooKeeper-trunk #2030 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2030/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2030/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1400&quot; title=&quot;Allow logging via callback instead of raw FILE pointer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1400&quot;&gt;&lt;del&gt;ZOOKEEPER-1400&lt;/del&gt;&lt;/a&gt;. Allow logging via callback instead of raw FILE pointer (michi via fpj) (fpj: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1516123&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1516123&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/c/src/mt_adaptor.c&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/c/src/zk_log.c&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12592441" name="ZOOKEEPER-1400.patch" size="4670" author="michim" created="Tue, 16 Jul 2013 00:22:25 +0100"/>
                            <attachment id="12592421" name="ZOOKEEPER-1400.patch" size="5017" author="michim" created="Mon, 15 Jul 2013 23:15:21 +0100"/>
                            <attachment id="12583720" name="ZOOKEEPER-1400.patch" size="70698" author="marshall" created="Sat, 18 May 2013 04:25:19 +0100"/>
                            <attachment id="12583401" name="ZOOKEEPER-1400.patch" size="71208" author="marshall" created="Thu, 16 May 2013 00:26:04 +0100"/>
                            <attachment id="12583330" name="ZOOKEEPER-1400.patch" size="71683" author="marshall" created="Wed, 15 May 2013 16:21:28 +0100"/>
                            <attachment id="12583269" name="ZOOKEEPER-1400.patch" size="71671" author="marshall" created="Wed, 15 May 2013 04:12:32 +0100"/>
                            <attachment id="12583204" name="ZOOKEEPER-1400.patch" size="67849" author="marshall" created="Tue, 14 May 2013 21:27:37 +0100"/>
                            <attachment id="12533092" name="ZOOKEEPER-1400.patch" size="60575" author="marshall" created="Fri, 22 Jun 2012 20:25:50 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 24 Feb 2012 15:44:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>229151</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxun8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2585</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>