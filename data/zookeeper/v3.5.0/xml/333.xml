<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:41:36 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-333/ZOOKEEPER-333.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-333] helgrind thread issues identified in mt c client code</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-333</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;helgrind generated a number of issues, I pulled a bunch of them. Most are related to the test, some are really issues with the mt zk client code though:&lt;/p&gt;

&lt;p&gt;valgrind --tool=helgrind --log-file=helgrind_mt.out ./zktest-mt&lt;/p&gt;


&lt;p&gt;==31294== Thread #2: pthread_cond_&lt;/p&gt;
{timed}wait called with un-held mutex&lt;br/&gt;
==31294==    at 0x4027F8F: pthread_cond_wait@* (hg_intercepts.c:560)&lt;br/&gt;
==31294==    by 0x404D881: pthread_cond_wait@GLIBC_2.0 (in /lib/tls/i686/cmov/libpthread-2.8.90.so)&lt;br/&gt;
==31294==    by 0x4028037: pthread_cond_wait@* (hg_intercepts.c:574)&lt;br/&gt;
==31294==    by 0x809EBB7: pthread_cond_wait (PthreadMocks.cc:54)&lt;br/&gt;
==31294==    by 0x80ABCF6: notify_thread_ready (mt_adaptor.c:136)&lt;br/&gt;
==31294==    by 0x80ABE90: do_io (mt_adaptor.c:277)&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
==31294== Possible data race during write of size 4 at 0x42E9A58&lt;br/&gt;
==31294==    at 0x8050D83: terminateZookeeperThreads(_zhandle*) (ZKMocks.cc:518)&lt;br/&gt;
==31294==    by 0x805543B: DeliverWatchersWrapper::call(_zhandle*, int, int, char const*, watcher_object_list**) (ZKMocks.cc:261)&lt;br/&gt;
==31294==    by 0x80520F7: __wrap_deliverWatchers (ZKMocks.cc:220)&lt;br/&gt;
==31294==    by 0x80A287B: process_completions (zookeeper.c:1393)&lt;br/&gt;
==31294==    by 0x80ABDAA: do_completion (mt_adaptor.c:332)&lt;br/&gt;
&lt;br/&gt;
==31294== Possible data race during write of size 4 at 0xBEFF5F30&lt;br/&gt;
==31294==    at 0x80589AF: Zookeeper_watchers::ConnectionWatcher::~ConnectionWatcher() (TestWatchers.cc:54)&lt;br/&gt;
==31294==    by 0x805D062: Zookeeper_watchers::testDefaultSessionWatcher1() (TestWatchers.cc:438)&lt;br/&gt;
==31294==    by 0x805608C: CppUnit::TestCaller&amp;lt;Zookeeper_watchers&amp;gt;::runTest() (TestCaller.h:166)&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
==31294== Possible data race during write of size 4 at 0x42EB104&lt;br/&gt;
==31294==    at 0x80A03EE: queue_completion (zookeeper.c:1776)&lt;br/&gt;
==31294==    by 0x80A3A44: zookeeper_process (zookeeper.c:1598)&lt;br/&gt;
==31294==    by 0x80AC00B: do_io (mt_adaptor.c:309)&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
==31294== Thread #29: pthread_cond_{timed}
&lt;p&gt;wait called with un-held mutex&lt;br/&gt;
==31294==    at 0x4027F8F: pthread_cond_wait@* (hg_intercepts.c:560)&lt;br/&gt;
==31294==    by 0x404D881: pthread_cond_wait@GLIBC_2.0 (in /lib/tls/i686/cmov/libpthread-2.8.90.so)&lt;br/&gt;
==31294==    by 0x4028037: pthread_cond_wait@* (hg_intercepts.c:574)&lt;br/&gt;
==31294==    by 0x809EBB7: pthread_cond_wait (PthreadMocks.cc:54)&lt;br/&gt;
==31294==    by 0x80AB9B3: wait_sync_completion (mt_adaptor.c:82)&lt;br/&gt;
==31294==    by 0x80A1E82: zoo_wget (zookeeper.c:2517)&lt;br/&gt;
==31294==    by 0x80A1F13: zoo_get (zookeeper.c:2497)&lt;/p&gt;




</description>
                <environment></environment>
        <key id="12415825">ZOOKEEPER-333</key>
            <summary>helgrind thread issues identified in mt c client code</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mahadev">Mahadev konar</assignee>
                                    <reporter username="phunt">Patrick Hunt</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Feb 2009 21:56:25 +0000</created>
                <updated>Wed, 8 Jul 2009 21:24:00 +0100</updated>
                            <resolved>Thu, 12 Mar 2009 00:31:45 +0000</resolved>
                                                    <fixVersion>3.1.1</fixVersion>
                    <fixVersion>3.2.0</fixVersion>
                                    <component>c client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12678385" author="mahadev" created="Tue, 3 Mar 2009 18:31:26 +0000"  >&lt;p&gt;i found some more while running helgrind... attacching the filtered output.&lt;/p&gt;</comment>
                            <comment id="12679629" author="cdarroch" created="Fri, 6 Mar 2009 16:16:26 +0000"  >&lt;p&gt;Some of these look to be innocuous on a first glance, such as &quot;wait called with un-held mutex&quot; in wait_sync_completion().  I suppose the issue here might be that wait_sync_completion() doesn&apos;t check the return value from pthread_mutex_lock() before proceeding, but in practice I believe one can reasonably assume it always succeeds.&lt;/p&gt;

&lt;p&gt;One thing that might help a bit would be to have a reference to the C code which produced this output because it refers to line numbers in the code.  Was the run against 3.1.0 or against a snapshot from trunk?  If the latter, do you know the SVN revision number?&lt;/p&gt;</comment>
                            <comment id="12679667" author="mahadev" created="Fri, 6 Mar 2009 17:49:54 +0000"  >&lt;p&gt;chris,&lt;br/&gt;
 the run was from the trunk. I dont have a revision number but i think their hasnt been any code change to the source files after I uploaded the traces. So the line numbers should match.&lt;/p&gt;</comment>
                            <comment id="12679676" author="phunt" created="Fri, 6 Mar 2009 18:13:08 +0000"  >&lt;p&gt;This latest gzip&apos;d helgrind output file is from svn trunk:&lt;/p&gt;

&lt;p&gt;At revision 751008.&lt;/p&gt;

&lt;p&gt;Note: the tests hang at the following step:&lt;/p&gt;

&lt;p&gt;Zookeeper_operations::testOperationsAndDisconnectConcurrently1^CKilled&lt;/p&gt;

&lt;p&gt;I had to ctrl-c the test to stop. Perhaps this means helgrind is tickling a bad problem(s)? We should re run helgrind after resolving the basic issues currently in the log, and see if this hang still occurrs. Perhaps you guys could also look at the test in question to see if anything catches your eye? The test should not be failing.&lt;/p&gt;</comment>
                            <comment id="12679677" author="phunt" created="Fri, 6 Mar 2009 18:14:34 +0000"  >&lt;p&gt;ps. I&apos;m on ubuntu intrepid ibex latest, single core cpu.&lt;/p&gt;</comment>
                            <comment id="12679682" author="mahadev" created="Fri, 6 Mar 2009 18:34:24 +0000"  >&lt;p&gt;Helgrind: Fatal internal error &amp;#8211; cannot continue.&lt;br/&gt;
Helgrind: mk_SHVAL_ShR(tset=8192,lset=1): FAILED&lt;br/&gt;
Helgrind: max allowed tset=8191, lset=131071&lt;br/&gt;
Helgrind: program has too many thread sets or lock sets to track.&lt;/p&gt;


&lt;p&gt;this is the error generated by helgrind when it hangs with the tests and is not able to run all of the tests.&lt;/p&gt;</comment>
                            <comment id="12680645" author="mahadev" created="Tue, 10 Mar 2009 22:09:15 +0000"  >&lt;p&gt;most of the traces in the helgrind output seem harmless to me. This patch has some minor changes (declaring the head pointers of lists as volatile, which we keep checking in different threads without locking), which might cause some problems. the others I think is fine.&lt;/p&gt;</comment>
                            <comment id="12681115" author="phunt" created="Thu, 12 Mar 2009 00:31:45 +0000"  >&lt;p&gt;Looks good, +1.&lt;/p&gt;

&lt;p&gt;Committed revision 752711.&lt;br/&gt;
Committed revision 752726.&lt;/p&gt;</comment>
                            <comment id="12681686" author="hudson" created="Fri, 13 Mar 2009 11:44:40 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #253 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/253/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/253/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12401871" name="ZOOKEEPER-333.patch" size="644" author="mahadev" created="Tue, 10 Mar 2009 22:09:15 +0000"/>
                            <attachment id="12401326" name="helgrind_mt.out" size="22896" author="mahadev" created="Tue, 3 Mar 2009 18:31:26 +0000"/>
                            <attachment id="12401637" name="helgrind_mt.out.gz" size="16446" author="phunt" created="Fri, 6 Mar 2009 18:13:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 3 Mar 2009 18:31:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47896</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzvrb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33129</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>