<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:48:50 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-356/ZOOKEEPER-356.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-356] Masking bookie failure during writes to a ledger</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-356</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;The idea of this jira is to work out the changes necessary to make a client mask the failure of a bookie while writing to a ledger. I&apos;m submitting a preliminary patch, but before I submit a final one, I need to have 288 committed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12419642">ZOOKEEPER-356</key>
            <summary>Masking bookie failure during writes to a ledger</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fpj">Flavio Junqueira</assignee>
                                    <reporter username="fpj">Flavio Junqueira</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Mar 2009 12:18:30 +0000</created>
                <updated>Wed, 8 Jul 2009 21:24:02 +0100</updated>
                            <resolved>Wed, 24 Jun 2009 06:08:17 +0100</resolved>
                                                    <fixVersion>3.2.0</fixVersion>
                                    <component>contrib-bookkeeper</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12715983" author="fpj" created="Wed, 3 Jun 2009 17:54:26 +0100"  >&lt;p&gt;I have started regenerating this patch to apply against trunk. it is not ready yet, though.&lt;/p&gt;</comment>
                            <comment id="12716604" author="fpj" created="Fri, 5 Jun 2009 13:55:41 +0100"  >&lt;p&gt;This is a fully functional patch. It copes with bookie failures during writes, and handles those changes during reads. It also includes a unit test.&lt;/p&gt;</comment>
                            <comment id="12716670" author="fpj" created="Fri, 5 Jun 2009 18:02:12 +0100"  >&lt;p&gt;It was a pretty stupid idea to use a static array of instances for QuorumOpMonitor. That was causing my new test to fail when trying to run multiple times (nothing to do with the test, just that it was keeping instances across runs). Now I&apos;m able to run the failure test four times, failing each time a different bookie.&lt;/p&gt;</comment>
                            <comment id="12716739" author="fpj" created="Fri, 5 Jun 2009 21:01:21 +0100"  >&lt;p&gt;Made some changes to log messages.&lt;/p&gt;</comment>
                            <comment id="12716740" author="fpj" created="Fri, 5 Jun 2009 21:02:23 +0100"  >&lt;p&gt;This is a pretty significant to the BookKeeper code. Please review it carefully.&lt;/p&gt;</comment>
                            <comment id="12716793" author="breed" created="Sat, 6 Jun 2009 00:48:04 +0100"  >&lt;p&gt;flavio is the zookeeper layout of bookkeeper documented somewhere? it would help a lot with the review.&lt;/p&gt;</comment>
                            <comment id="12716907" author="fpj" created="Sat, 6 Jun 2009 21:42:45 +0100"  >&lt;p&gt;You might want to take a look at &quot;org.apache.bookkeeper.client.BKDefs.java&quot; for the ZooKeeper paths we use.&lt;/p&gt;</comment>
                            <comment id="12717250" author="fpj" created="Mon, 8 Jun 2009 14:36:40 +0100"  >&lt;p&gt;For some strange reason, Hudson didn&apos;t check this patch, and it is no in the queue either, so I&apos;m resubmitting.&lt;/p&gt;</comment>
                            <comment id="12717470" author="hadoopqa" created="Mon, 8 Jun 2009 23:31:45 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12410019/ZOOKEEPER-356.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12410019/ZOOKEEPER-356.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 782792.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 18 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/104/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/104/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/104/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/104/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/104/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/104/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12717865" author="breed" created="Wed, 10 Jun 2009 00:36:04 +0100"  >&lt;p&gt;-1 wow you did a lot of work flavio. big patch, so i found a couple of problems. (some i might just be confused about.) it shouldn&apos;t be much to fix:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;in LedgerOutputStream why are you interrupting the thread on BKExceptions&lt;/li&gt;
	&lt;li&gt;in the tests, why are you catching and just logging BKExceptions? shouldn&apos;t those make the tests fail?&lt;/li&gt;
	&lt;li&gt;i think &lt;em&gt;down&lt;/em&gt; should be volatile in BookieServer&lt;/li&gt;
	&lt;li&gt;why do you pass a BookieHandle to BookieClient&lt;/li&gt;
	&lt;li&gt;in BookKeeper you should probably catch NumberFormatException when you call Long.parseLong its one of those things are are really hard to debug if it happens&lt;/li&gt;
	&lt;li&gt;could you add a comment to the top of BookKeeper to explain how the different znodes are used? it will really help the next person&lt;/li&gt;
	&lt;li&gt;i think &lt;em&gt;stop&lt;/em&gt; and &lt;em&gt;incoming&lt;/em&gt; should be updated and read in the same synchronized block right?&lt;/li&gt;
	&lt;li&gt;in LedgerManager @return says getItem returns a long rather than String&lt;/li&gt;
	&lt;li&gt;are next and errorCounter used in ClientCB?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;very nice job on using the state machine to process the asynchronous calls!&lt;/p&gt;</comment>
                            <comment id="12721688" author="fpj" created="Fri, 19 Jun 2009 09:13:36 +0100"  >&lt;p&gt;There are three important parts to this patch:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;&apos;&apos;BookieHandle/BookieClient&apos;&apos;: A BookieHandle has to guarantee that all requests either get a correct response from a bookie or they get errored out. In particular, it is important to guarantee that when the bookie corresponding to a BookieHandle crashes that it has no pending request in incomingQueue. In this patch, we call cleanQueue() to error out all requests and errorOut() on BookieClient to make sure again that all requests get a response;&lt;/li&gt;
	&lt;li&gt;&apos;&apos;LedgerHandle&apos;&apos;: This patch implements modifications to LedgerHandle that manipulate the ensemble according to observed failures. It changes the set of bookies over time, and writes to ZooKeeper when there has been a change to the ensemble;&lt;/li&gt;
	&lt;li&gt;&apos;&apos;BookKeeper and LedgerManagementProcessor&quot;: When opening a ledger, we have to read the information on changes to the ensemble from ZooKeeper and set up all data structures to guarantee that we read entries from the correct set of bookies.&lt;/li&gt;
&lt;/ol&gt;

</comment>
                            <comment id="12721743" author="hadoopqa" created="Fri, 19 Jun 2009 12:17:21 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12411198/ZOOKEEPER-356.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12411198/ZOOKEEPER-356.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 786317.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 18 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/126/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/126/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/126/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/126/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/126/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/126/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12723150" author="breed" created="Tue, 23 Jun 2009 17:03:24 +0100"  >&lt;p&gt;just a couple of things:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;in BookieHandle, why doesn&apos;t stop get set to true on shutdown?&lt;/li&gt;
	&lt;li&gt;you need to check all your uses of LOG.info most of them seem to really be LOG.debug&lt;/li&gt;
	&lt;li&gt;in ClientCBWorker stop should be volatile&lt;/li&gt;
	&lt;li&gt;in LedgerHandle shouldn&apos;t add/removeBookie be synchronized?&lt;/li&gt;
	&lt;li&gt;in QuorumEngine should idCounter be synchronized?&lt;/li&gt;
	&lt;li&gt;In BookieClient you do a new IOException(), you should provide some hint of the problem in the constructor&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12723191" author="fpj" created="Tue, 23 Jun 2009 18:09:55 +0100"  >&lt;p&gt;Thanks, Ben. Here are my answers to your concerns:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;If we set stop to true, then the STOP signal (issued from sendStop()) will never be processed;&lt;/li&gt;
	&lt;li&gt;I have checked them, and changed some. Please let me know if you still see any that is not ok;&lt;/li&gt;
	&lt;li&gt;Done;&lt;/li&gt;
	&lt;li&gt;It is not necessary, we only add in the beginning, when opening or creating a ledger, and we remove while adding entries to a ledger, after creating a ledger;&lt;/li&gt;
	&lt;li&gt;Done. It slows the client down significantly, though;&lt;/li&gt;
	&lt;li&gt;Done.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;[ Show &#187; ]&lt;br/&gt;
Benjamin Reed added a comment - 23/Jun/09 09:03 AM just a couple of things:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;in BookieHandle, why doesn&apos;t stop get set to true on shutdown?&lt;/li&gt;
	&lt;li&gt;you need to check all your uses of LOG.info most of them seem to really be LOG.debug&lt;/li&gt;
	&lt;li&gt;in ClientCBWorker stop should be volatile&lt;/li&gt;
	&lt;li&gt;in LedgerHandle shouldn&apos;t add/removeBookie be synchronized?&lt;/li&gt;
	&lt;li&gt;in QuorumEngine should idCounter be synchronized?&lt;/li&gt;
	&lt;li&gt;In BookieClient you do a new IOException(), you should provide some hint of the problem in the constructor&lt;/li&gt;
&lt;/ul&gt;


</comment>
                            <comment id="12723239" author="fpj" created="Tue, 23 Jun 2009 19:31:28 +0100"  >&lt;p&gt;Synchronizing LedgerHandle::removeBookie().&lt;/p&gt;</comment>
                            <comment id="12723439" author="breed" created="Wed, 24 Jun 2009 06:08:17 +0100"  >&lt;p&gt;Committed revision 787907.&lt;/p&gt;</comment>
                            <comment id="12723546" author="hudson" created="Wed, 24 Jun 2009 13:46:16 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #356 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/356/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/356/&lt;/a&gt;)&lt;br/&gt;
    . Masking bookie failure during writes to a ledger&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12411562" name="ZOOKEEPER-356.patch" size="135073" author="fpj" created="Tue, 23 Jun 2009 19:31:28 +0100"/>
                            <attachment id="12411551" name="ZOOKEEPER-356.patch" size="135213" author="fpj" created="Tue, 23 Jun 2009 18:02:34 +0100"/>
                            <attachment id="12411198" name="ZOOKEEPER-356.patch" size="134098" author="fpj" created="Fri, 19 Jun 2009 09:13:36 +0100"/>
                            <attachment id="12410019" name="ZOOKEEPER-356.patch" size="97987" author="fpj" created="Fri, 5 Jun 2009 21:01:20 +0100"/>
                            <attachment id="12410002" name="ZOOKEEPER-356.patch" size="98162" author="fpj" created="Fri, 5 Jun 2009 18:02:27 +0100"/>
                            <attachment id="12409981" name="ZOOKEEPER-356.patch" size="94613" author="fpj" created="Fri, 5 Jun 2009 14:01:32 +0100"/>
                            <attachment id="12409980" name="ZOOKEEPER-356.patch" size="79960" author="fpj" created="Fri, 5 Jun 2009 13:55:41 +0100"/>
                            <attachment id="12409795" name="ZOOKEEPER-356.patch" size="13672" author="fpj" created="Wed, 3 Jun 2009 17:54:25 +0100"/>
                            <attachment id="12403800" name="ZOOKEEPER-BOOKKEEPER-356.patch" size="52384" author="fpj" created="Fri, 27 Mar 2009 12:22:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 5 Jun 2009 23:48:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47876</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzy27:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33502</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>