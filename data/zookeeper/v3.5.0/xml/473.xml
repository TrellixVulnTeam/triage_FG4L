<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:52:30 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-473/ZOOKEEPER-473.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-473] cleanup junit tests to eliminate false positives due to &quot;socket reuse&quot; and failure to close client</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-473</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;The junit tests will occasionally fail on hudson due to a few problems:&lt;/p&gt;

&lt;p&gt;1) socket in use - sometimes the code/testcode will fail to close a socket, either that or tcp wait&lt;br/&gt;
 kicks in and the kernel holds onto the socket, either way subsequent tests that use this same&lt;br/&gt;
port will fail&lt;/p&gt;

&lt;p&gt;2) sometimes the tests fail to close clients, this results in clients attempting to re-connect to&lt;br/&gt;
the server started as part of a subsequent test (the timeout is very long). this causes a few&lt;br/&gt;
problems, typically extra load on the server or more likely unusual changes to the server that the&lt;br/&gt;
next test(s) don&apos;t expect. also causes problems when trying to debug the test as the old clients&lt;br/&gt;
spew messages into the log.&lt;/p&gt;

&lt;p&gt;we see this on hudson, occasionally failures. We also saw this when working on &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-397&quot; title=&quot;mainline tests conversion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-397&quot;&gt;&lt;del&gt;ZOOKEEPER-397&lt;/del&gt;&lt;/a&gt;, the testng&lt;br/&gt;
port. testng does not support &quot;fork mode&quot; for running the tests. as a result all the tests (all) run in a single&lt;br/&gt;
vm instance, start to finish. so this problem is exacerbated significantly in that case. this patch only&lt;br/&gt;
fixes the problem in junit btw, it does not move to testng&lt;/p&gt;</description>
                <environment></environment>
        <key id="12430517">ZOOKEEPER-473</key>
            <summary>cleanup junit tests to eliminate false positives due to &quot;socket reuse&quot; and failure to close client</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="phunt">Patrick Hunt</assignee>
                                    <reporter username="phunt">Patrick Hunt</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Jul 2009 17:46:15 +0100</created>
                <updated>Fri, 26 Mar 2010 17:24:55 +0000</updated>
                            <resolved>Thu, 16 Jul 2009 23:10:12 +0100</resolved>
                                    <version>3.2.0</version>
                                    <fixVersion>3.3.0</fixVersion>
                                    <component>tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12731566" author="phunt" created="Wed, 15 Jul 2009 18:18:25 +0100"  >&lt;p&gt;this patch addresses the stated problems.&lt;/p&gt;

&lt;p&gt;Additional note &amp;#8211; I&apos;ve moved all of the log4j output to a logfile in the build/test/logs directory.&lt;/p&gt;

&lt;p&gt;this was necessary for testng since it considers &quot;stdout&quot; special - and we were logging all&lt;br/&gt;
of the log4j to the console previously. I think this change is an improvement because:&lt;/p&gt;

&lt;p&gt;1) hudson console information will be much easier to view (currently huge)&lt;br/&gt;
2) there&apos;s a single file to open/view for all log output. in general this is convienient&lt;br/&gt;
 and specifically it&apos;s nice if you are trying to see if a test at time t is causing problems&lt;br/&gt;
with a subsequent t+n test (like for this jira)&lt;br/&gt;
3) the junit test output log files for each test now are much more readable/parsable, they&lt;br/&gt;
contain just the results of the test (incl excep) and any stdout/stderr.&lt;/p&gt;


&lt;p&gt;Please review and commit asap.&lt;/p&gt;</comment>
                            <comment id="12731720" author="mahadev" created="Wed, 15 Jul 2009 23:37:59 +0100"  >&lt;p&gt;the patch looks good... this should finally get the tests running on my mac (it used to fail because of the bind exceptions, mac isnt that good at releasing ports). I had 2 comments - &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I think we should still keep the systemoutput/log in the same file and let hudson have the output as a huge file, the only reason being that it allows the system otuputs to match with the logging using log4j. I would be useful to see all the logging and sys output/ error in a single file for a given test. what do you think?&lt;/li&gt;
	&lt;li&gt;also, another check does @Test tags work with javac 1.5? I am not sure if we still want to support 1.5.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12732066" author="phunt" created="Thu, 16 Jul 2009 19:21:56 +0100"  >&lt;p&gt;latest patch moves back to console for test log4j output&lt;/p&gt;</comment>
                            <comment id="12732167" author="phunt" created="Thu, 16 Jul 2009 22:15:46 +0100"  >&lt;p&gt;btw &amp;#8211; @Test is fine with 1.5 - we had that in most places already, this patch just adds to a few tests that were missing.&lt;/p&gt;</comment>
                            <comment id="12732203" author="mahadev" created="Thu, 16 Jul 2009 23:10:12 +0100"  >&lt;p&gt;I just committed this. thanks pat.&lt;/p&gt;</comment>
                            <comment id="12735502" author="hudson" created="Mon, 27 Jul 2009 08:04:42 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #393 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/393/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/393/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12429955">ZOOKEEPER-460</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12413716" name="ZOOKEEPER-473.patch" size="110607" author="phunt" created="Thu, 16 Jul 2009 19:21:56 +0100"/>
                            <attachment id="12413578" name="ZOOKEEPER-473.patch" size="112700" author="phunt" created="Wed, 15 Jul 2009 18:18:25 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 15 Jul 2009 22:37:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47790</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzxsv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33460</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>