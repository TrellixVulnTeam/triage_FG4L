<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:41:21 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1535/ZOOKEEPER-1535.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1535] ZK Shell/Cli re-executes last command on exit</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1535</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;In the ZK 3.4.3 release&apos;s version of zkCli.sh, the last command that was executed is &lt;b&gt;re&lt;/b&gt;-executed when you &lt;tt&gt;ctrl+d&lt;/tt&gt; out of the shell. In the snippet below, &lt;tt&gt;ls&lt;/tt&gt; is executed, and then &lt;tt&gt;ctrl+d&lt;/tt&gt; is triggered (inserted below to illustrate), the output from &lt;tt&gt;ls&lt;/tt&gt; appears again, due to the command being re-run. &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[zk: zookeeper.example.com:2181(CONNECTED) 0] ls /blah
[foo]
[zk: zookeeper.example.com:2181(CONNECTED) 1] &amp;lt;ctrl+d&amp;gt; [foo]
$
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;zookeeper-3.4.3 release&lt;/p&gt;</environment>
        <key id="12603538">ZOOKEEPER-1535</key>
            <summary>ZK Shell/Cli re-executes last command on exit</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="eribeiro">Edward Ribeiro</assignee>
                                    <reporter username="stuhood">Stu Hood</reporter>
                        <labels>
                            <label>cli</label>
                            <label>shell</label>
                            <label>zkcli</label>
                            <label>zkcli.sh</label>
                    </labels>
                <created>Wed, 15 Aug 2012 00:56:40 +0100</created>
                <updated>Mon, 29 Sep 2014 08:10:03 +0100</updated>
                            <resolved>Mon, 31 Dec 2012 03:21:28 +0000</resolved>
                                                    <fixVersion>3.4.6</fixVersion>
                    <fixVersion>3.5.0</fixVersion>
                                    <component>scripts</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13539690" author="eribeiro" created="Wed, 26 Dec 2012 21:01:11 +0000"  >&lt;p&gt;I have looked into this issue and it&apos;s related to the lines 347-348 of the run() method in file ZooKeeperMain.java:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   boolean watch = processCmd(cl);
   if (!watch) {
      System.exit(0);
   }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The REPL is executed in a &quot;while ((line = (...)) != null)&quot; loop. Therefore when the user issue &amp;lt;ctrl+d&amp;gt; the flow jumps out of loop, but before ending execution it runs the code above, that seems redundant, imo. &lt;/p&gt;

&lt;p&gt;The issue shows up because the &quot;cl&quot; object still points to the last executed command even though the &quot;line&quot; variable (that  populates the &quot;cl&quot; object) is already null. Looking at svn logs and studying the control flow, it looks like the this snippet  lost its usefulness during successive code modifications (last one that affected it: &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-82&quot; title=&quot;Make the ZooKeeperServer more DI friendly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-82&quot;&gt;&lt;del&gt;ZOOKEEPER-82&lt;/del&gt;&lt;/a&gt;), because its job is already done by executeLine() calls in the loop.&lt;/p&gt;

&lt;p&gt;My suggestion would be to get rid of this code block, but I would like to hear what you think about it. There&apos;s any situation where this snippet would be relevant?&lt;/p&gt;</comment>
                            <comment id="13540944" author="eribeiro" created="Sat, 29 Dec 2012 17:40:13 +0000"  >&lt;p&gt;I am submitting two mutually exclusive patches for your consideration:&lt;/p&gt;

&lt;p&gt;1. The first one just removes the snippet of code I cited previously, but I would be really glad if you could analyse it and see if it&apos;s safe to remove or not. I didn&apos;t see  any counterexample for not getting rid of it.&lt;/p&gt;

&lt;p&gt;2. The second one is a &apos;hack&apos; that populates  the &apos;dirty&apos; cl object by a &quot;quit&quot; command when leaving the loop, so that it can at least close the connection on ctrl+d. My favorite is the first one, but I left it up to you to decide if any of them is worth committing. &lt;/p&gt;</comment>
                            <comment id="13541171" author="hadoopqa" created="Sun, 30 Dec 2012 22:30:37 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12562681/ZOOKEEPER-1535-2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12562681/ZOOKEEPER-1535-2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1425215.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1318//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1318//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1318//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1318//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1318//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1318//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13541184" author="eribeiro" created="Sun, 30 Dec 2012 23:39:24 +0000"  >&lt;p&gt;I didn&apos;t provide any tests because it requires the use of zkCli.sh and I didn&apos;t find any test using it. I simulated and checked my fix iteratively. How do I justify this? Remember, I am the n00b here. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;

&lt;p&gt;The steps I followed to simulate and fix the bug were:&lt;br/&gt;
1. start zkCli.sh&lt;br/&gt;
2. Type one or more commands (ls, history, etc) and then press CTRL+D. It should reexecute the last command I issued;&lt;br/&gt;
3. After applying the patch, I re-execute steps 1-2, but it closes the connection and leaves the CLI without executing the latest command a second time. &lt;/p&gt;

&lt;p&gt;Besides, the two patches I&apos;ve uploaded are different fixes of the same problem. I think the first version is the better, but I would like to hear what you think about it.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Ed&lt;/p&gt;</comment>
                            <comment id="13541205" author="fournc" created="Mon, 31 Dec 2012 01:06:51 +0000"  >&lt;p&gt;OK patch #1 looks ok to me. It looks like this is leftover from some really old code refactorings that should have been removed when Henry put in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-386&quot; title=&quot;improve java cli shell&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-386&quot;&gt;&lt;del&gt;ZOOKEEPER-386&lt;/del&gt;&lt;/a&gt;. I&apos;ve tested the command line and it all looks good without this so I&apos;m going to put it onto trunk and 3.4 for good measure.&lt;/p&gt;</comment>
                            <comment id="13541223" author="hudson" created="Mon, 31 Dec 2012 02:10:17 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #1789 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/1789/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/1789/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1535&quot; title=&quot;ZK Shell/Cli re-executes last command on exit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1535&quot;&gt;&lt;del&gt;ZOOKEEPER-1535&lt;/del&gt;&lt;/a&gt;. ZK Shell/Cli re-executes last command on exit (Edward Ribeiro via camille) (Revision 1427034)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
camille : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1427034&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1427034&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/ZooKeeperMain.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13541269" author="eribeiro" created="Mon, 31 Dec 2012 04:50:29 +0000"  >&lt;p&gt;Cool. Thanks for the support and readiness, Camille.&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13541270" author="eribeiro" created="Mon, 31 Dec 2012 04:50:31 +0000"  >&lt;p&gt;Cool. Thanks for the support and readiness, Camille.&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13541271" author="eribeiro" created="Mon, 31 Dec 2012 04:50:31 +0000"  >&lt;p&gt;Cool. Thanks for the support and readiness, Camille.&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13933764" author="fpj" created="Thu, 13 Mar 2014 18:17:08 +0000"  >&lt;p&gt;Closing issues after releasing 3.4.6.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12702282">ZOOKEEPER-1897</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12706368">HBASE-10903</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12562680" name="ZOOKEEPER-1535-1.patch" size="507" author="eribeiro" created="Sat, 29 Dec 2012 17:40:13 +0000"/>
                            <attachment id="12562681" name="ZOOKEEPER-1535-2.patch" size="472" author="eribeiro" created="Sat, 29 Dec 2012 17:40:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 26 Dec 2012 21:01:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242175</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxwdsn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12722</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>