<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:41:54 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1624/ZOOKEEPER-1624.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1624] PrepRequestProcessor abort multi-operation incorrectly</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1624</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;We found this issue when trying to issue multiple instances of the following multi-op concurrently&lt;/p&gt;

&lt;p&gt;multi &lt;/p&gt;
{
1. create sequential node /a- 
2. create node /b
}

&lt;p&gt;The expected result is that only the first multi-op request should success and the rest of request should fail because /b is already exist&lt;/p&gt;

&lt;p&gt;However, the reported result is that the subsequence multi-op failed because of sequential node creation failed which is not possible.&lt;/p&gt;

&lt;p&gt;Below is the return code for each sub-op when issuing 3 instances of the above multi-op asynchronously&lt;/p&gt;

&lt;p&gt;1. ZOK, ZOK&lt;br/&gt;
2. ZOK, ZNODEEXISTS,&lt;br/&gt;
3. ZNODEEXISTS, ZRUNTIMEINCONSISTENCY,&lt;/p&gt;

&lt;p&gt;When I added more debug log. The cause is that PrepRequestProcessor rollback outstandingChanges of the second multi-op incorrectly causing sequential node name generation to be incorrect. Below is the sequential node name generated by PrepRequestProcessor&lt;/p&gt;

&lt;p&gt;1. create /a-0001&lt;br/&gt;
2. create /a-0003&lt;br/&gt;
3. create /a-0001&lt;/p&gt;

&lt;p&gt;The bug is getPendingChanges() method. In failed to copied ChangeRecord for the parent node (&quot;/&quot;).  So rollbackPendingChanges() cannot restore the right previous change record of the parent node when aborting the second multi-op&lt;/p&gt;

&lt;p&gt;The impact of this bug is that sequential node creation on the same parent node may fail until the previous one is committed. I am not sure if there is other implication or not.  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12628149">ZOOKEEPER-1624</key>
            <summary>PrepRequestProcessor abort multi-operation incorrectly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thawan">Thawan Kooburat</assignee>
                                    <reporter username="thawan">Thawan Kooburat</reporter>
                        <labels>
                            <label>zk-review</label>
                    </labels>
                <created>Fri, 18 Jan 2013 03:11:10 +0000</created>
                <updated>Thu, 13 Mar 2014 18:16:57 +0000</updated>
                            <resolved>Thu, 10 Oct 2013 20:06:12 +0100</resolved>
                                                    <fixVersion>3.4.6</fixVersion>
                    <fixVersion>3.5.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13556940" author="thawan" created="Fri, 18 Jan 2013 03:46:49 +0000"  >&lt;p&gt;Since we don&apos;t have async multi-op in Java, the unit test have to be in c-client unit test  &lt;/p&gt;</comment>
                            <comment id="13556954" author="hadoopqa" created="Fri, 18 Jan 2013 04:20:09 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12565429/ZOOKEEPER-1624.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12565429/ZOOKEEPER-1624.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1434978.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1343//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1343//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1343//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1343//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1343//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1343//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13557586" author="thawan" created="Fri, 18 Jan 2013 20:44:16 +0000"  >&lt;p&gt;Any multi-op expert can help on initial feedback?&lt;/p&gt;</comment>
                            <comment id="13569098" author="thawan" created="Fri, 1 Feb 2013 21:20:41 +0000"  >&lt;p&gt;Clean up wait counter so that future test can run correctly&lt;/p&gt;</comment>
                            <comment id="13569107" author="fournc" created="Fri, 1 Feb 2013 21:27:09 +0000"  >&lt;p&gt;I started looking at this. I am very unhappy that we have to write a C client test to reveal a bug in our Java core. I&apos;m working on writing a java test to replicate because we really should not have to rely on tests that should only be for the client side code to test our server.&lt;/p&gt;</comment>
                            <comment id="13569121" author="thawan" created="Fri, 1 Feb 2013 21:38:26 +0000"  >&lt;p&gt;It should be simple to replicate if &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1572&quot; title=&quot;Add an async interface for multi request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1572&quot;&gt;&lt;del&gt;ZOOKEEPER-1572&lt;/del&gt;&lt;/a&gt; is committed to trunk.  We just need async functionality to test this. &lt;/p&gt;</comment>
                            <comment id="13569136" author="fournc" created="Fri, 1 Feb 2013 21:51:39 +0000"  >&lt;p&gt;Oh that&apos;s great Thawan, I will see about getting 1572 committed so we can get an easy Java-side test for this bug.&lt;/p&gt;</comment>
                            <comment id="13569138" author="yuzhihong@gmail.com" created="Fri, 1 Feb 2013 21:53:02 +0000"  >&lt;p&gt;The fix would be backported to 3.4, right ?&lt;/p&gt;</comment>
                            <comment id="13569147" author="hadoopqa" created="Fri, 1 Feb 2013 21:58:56 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12567638/ZOOKEEPER-1624.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12567638/ZOOKEEPER-1624.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1438375.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    -1 release audit.  The applied patch generated 26 release audit warnings (more than the trunk&apos;s current 24 warnings).&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1375//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1375//testReport/&lt;/a&gt;&lt;br/&gt;
Release audit warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1375//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1375//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1375//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1375//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1375//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1375//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13580987" author="fournc" created="Tue, 19 Feb 2013 03:19:45 +0000"  >&lt;p&gt;Can we get a test for this in Java now that &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1572&quot; title=&quot;Add an async interface for multi request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1572&quot;&gt;&lt;del&gt;ZOOKEEPER-1572&lt;/del&gt;&lt;/a&gt; has been committed? I can&apos;t get the cppunit build to run and I&apos;m uncomfortable approving a patch where I can&apos;t see the tests fail and pass.&lt;/p&gt;</comment>
                            <comment id="13581715" author="thawan" created="Tue, 19 Feb 2013 22:48:06 +0000"  >&lt;p&gt;A version of with Java unit test.  &lt;/p&gt;

&lt;p&gt;Since this version relies on &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1572&quot; title=&quot;Add an async interface for multi request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1572&quot;&gt;&lt;del&gt;ZOOKEEPER-1572&lt;/del&gt;&lt;/a&gt;, it can only be applied to trunk.  For 3.4.6, we have to use the previous version. &lt;/p&gt;</comment>
                            <comment id="13581737" author="hadoopqa" created="Tue, 19 Feb 2013 23:17:55 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12570018/ZOOKEEPER-1624.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12570018/ZOOKEEPER-1624.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1447621.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1398//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1398//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1398//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1398//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1398//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1398//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13581869" author="fournc" created="Wed, 20 Feb 2013 02:04:22 +0000"  >&lt;p&gt;This new patch still doesn&apos;t seem to have the Java test.&lt;/p&gt;</comment>
                            <comment id="13581874" author="thawan" created="Wed, 20 Feb 2013 02:14:37 +0000"  >&lt;p&gt;Oops uploaded the wrong file.  This one should have it &lt;/p&gt;</comment>
                            <comment id="13581899" author="hadoopqa" created="Wed, 20 Feb 2013 02:45:38 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12570055/ZOOKEEPER-1624.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12570055/ZOOKEEPER-1624.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1447982.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1400//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1400//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1400//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1400//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1400//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1400//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13581948" author="thawan" created="Wed, 20 Feb 2013 04:57:31 +0000"  >&lt;p&gt;This is a direct port of c-client test. However, I found that it cannot detect the bug because of a timing issue. I think it is because both server and client are in the same process for Java unit test, each multi request will get committed before the next one arrive, so the bug won&apos;t occur.&lt;/p&gt;

&lt;p&gt;On the other hand, with c-client test, the bug is always reproducible in my box.    &lt;/p&gt;

&lt;p&gt;If anyone can help me on Java test I will be appreciated. &lt;/p&gt;</comment>
                            <comment id="13581968" author="hadoopqa" created="Wed, 20 Feb 2013 05:29:17 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12570079/ZOOKEEPER-1624.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12570079/ZOOKEEPER-1624.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1447982.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1402//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1402//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1402//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1402//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1402//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1402//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13750061" author="fpj" created="Mon, 26 Aug 2013 13:53:30 +0100"  >&lt;p&gt;I was wondering about what to do with this jira. We need to work on the java test case, and on top of it decide what to do for the 3.4 branch. I believe that we didn&apos;t check in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1572&quot; title=&quot;Add an async interface for multi request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1572&quot;&gt;&lt;del&gt;ZOOKEEPER-1572&lt;/del&gt;&lt;/a&gt; to the 3.4. branch because &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mahadev&quot; class=&quot;user-hover&quot; rel=&quot;mahadev&quot;&gt;Mahadev konar&lt;/a&gt; said that we don&apos;t check in new features into an ongoing branch. Well, in this case, I&apos;d say we should so that we can cleanly apply this patch, unless we come up with a way of testing that does not rely on the async multi api. &lt;/p&gt;

&lt;p&gt;On the java test case, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thawan&quot; class=&quot;user-hover&quot; rel=&quot;thawan&quot;&gt;Thawan Kooburat&lt;/a&gt; says that it doesn&apos;t pass, but the last run on jenkins returned +1 for the core unit tests. Did you mean to say that it doesn&apos;t pass reliably?&lt;/p&gt;

&lt;p&gt;Could you people give me some feedback here, please, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thawan&quot; class=&quot;user-hover&quot; rel=&quot;thawan&quot;&gt;Thawan Kooburat&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fournc&quot; class=&quot;user-hover&quot; rel=&quot;fournc&quot;&gt;Camille Fournier&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13768874" author="fpj" created="Mon, 16 Sep 2013 23:25:50 +0100"  >&lt;p&gt;@thawan, Could you give me some feedback here as well, please?&lt;/p&gt;

&lt;p&gt;As for the Java test, I was thinking that to make a multi-op transaction fail reliably, you could use check() with a znode, version pair that doesn&apos;t match, which will cause the transaction to fail. If the transaction also includes the creation of a sequential znode, then you should be able to trigger this bug, no?&lt;/p&gt;</comment>
                            <comment id="13768992" author="thawan" created="Tue, 17 Sep 2013 01:11:02 +0100"  >&lt;p&gt;For Java, I think the best approach is to unit test the PrepRequestProcessor itself directly (and mock the rest of system). With this approach, we won&apos;t need async interface.  I haven&apos;t have time to rewrite the test yet but if we want this in 3.4.6, I will find some time to work on it after I am done with ZK-1551,1552&lt;/p&gt;</comment>
                            <comment id="13769576" author="fpj" created="Tue, 17 Sep 2013 15:55:33 +0100"  >&lt;p&gt;I&apos;d like to have this one in for 3.4.6 if possible.&lt;/p&gt;</comment>
                            <comment id="13789358" author="fpj" created="Tue, 8 Oct 2013 17:33:57 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thawan&quot; class=&quot;user-hover&quot; rel=&quot;thawan&quot;&gt;Thawan Kooburat&lt;/a&gt;, would you have time to generate a patch for 3.4.6?&lt;/p&gt;</comment>
                            <comment id="13789376" author="fournc" created="Tue, 8 Oct 2013 17:48:47 +0100"  >&lt;p&gt;The problem is that &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1572&quot; title=&quot;Add an async interface for multi request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1572&quot;&gt;&lt;del&gt;ZOOKEEPER-1572&lt;/del&gt;&lt;/a&gt; is necessary for the test he wrote for this. Do we want to push that into 3.4.6?&lt;/p&gt;</comment>
                            <comment id="13789385" author="phunt" created="Tue, 8 Oct 2013 17:55:52 +0100"  >&lt;p&gt;We typically don&apos;t add features in fix releases.&lt;/p&gt;</comment>
                            <comment id="13789388" author="fournc" created="Tue, 8 Oct 2013 17:58:16 +0100"  >&lt;p&gt;Right. So should we push the patch without the Java test in 3.4.6?&lt;/p&gt;</comment>
                            <comment id="13789627" author="phunt" created="Tue, 8 Oct 2013 21:08:40 +0100"  >&lt;p&gt;Can a test not be created that meets the criteria?&lt;/p&gt;</comment>
                            <comment id="13789664" author="fpj" created="Tue, 8 Oct 2013 21:33:39 +0100"  >&lt;p&gt;I understand that we typically don&apos;t add new features to bug fix releases, but I don&apos;t really see a problem with having &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1572&quot; title=&quot;Add an async interface for multi request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1572&quot;&gt;&lt;del&gt;ZOOKEEPER-1572&lt;/del&gt;&lt;/a&gt; into b3.4, it is not really a whole new feature.&lt;/p&gt;</comment>
                            <comment id="13789692" author="thawan" created="Tue, 8 Oct 2013 21:59:06 +0100"  >&lt;p&gt;As I already comment earlier, the current Java test doesn&apos;t actually catch the bug due to timing issue.  I guess, I will have to rewrite it to test PrepRequestProcessor directly (which is probably not going to rely on &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1572&quot; title=&quot;Add an async interface for multi request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1572&quot;&gt;&lt;del&gt;ZOOKEEPER-1572&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;If you want to commit this now,  the patch itself has a proper and reliable (at least on my box) unit test in C.  Our test infrastructure do run C unit test and report the result right?  I agree with Camile that it would be nice to have Java test for server-side functionality but it isn&apos;t strictly needed right? &lt;/p&gt;</comment>
                            <comment id="13789807" author="fournc" created="Tue, 8 Oct 2013 23:48:00 +0100"  >&lt;p&gt;I&apos;m comfortable with pushing the patch for 3.4 without the Java test. &lt;/p&gt;</comment>
                            <comment id="13789821" author="phunt" created="Wed, 9 Oct 2013 00:01:56 +0100"  >&lt;blockquote&gt;&lt;p&gt;it is not really a whole new feature&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;fwiw a public facing client API change that adds async support to multi is a feature imo.&lt;/p&gt;</comment>
                            <comment id="13789833" author="fpj" created="Wed, 9 Oct 2013 00:37:07 +0100"  >&lt;p&gt;Given the recent set of comments, I&apos;m not sure it matters, but my point was simply that adding async calls for a feature that already exists is not really adding a whole new feature, just extending the scope of an existing one. For me, the feature is multi. But fine if we can make progress without it.&lt;/p&gt;</comment>
                            <comment id="13789855" author="fournc" created="Wed, 9 Oct 2013 01:05:14 +0100"  >&lt;p&gt;patch for 3.4&lt;/p&gt;</comment>
                            <comment id="13789887" author="hadoopqa" created="Wed, 9 Oct 2013 01:44:51 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12607473/ZOOKEEPER-1624-3.4&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12607473/ZOOKEEPER-1624-3.4&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1530166.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1662//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1662//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13791632" author="fournc" created="Thu, 10 Oct 2013 17:21:37 +0100"  >&lt;p&gt;This patch just makes it apply to 3.4 and removes the Java test. If there are no objections I&apos;ll check it in.&lt;/p&gt;</comment>
                            <comment id="13791635" author="fpj" created="Thu, 10 Oct 2013 17:22:50 +0100"  >&lt;p&gt;No objection on my end.&lt;/p&gt;</comment>
                            <comment id="13791856" author="hudson" created="Thu, 10 Oct 2013 20:02:29 +0100"  >&lt;p&gt;SUCCESS: Integrated in ZooKeeper-trunk #2085 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2085/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2085/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1624&quot; title=&quot;PrepRequestProcessor abort multi-operation incorrectly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1624&quot;&gt;&lt;del&gt;ZOOKEEPER-1624&lt;/del&gt;&lt;/a&gt;. PrepRequestProcessor abort multi-operation incorrectly. (thawan via camille) (camille: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1531061&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1531061&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/c/tests/TestMulti.cc&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/PrepRequestProcessor.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/test/MultiAsyncTransactionTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13933716" author="fpj" created="Thu, 13 Mar 2014 18:16:57 +0000"  >&lt;p&gt;Closing issues after releasing 3.4.6.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12607473" name="ZOOKEEPER-1624-3.4" size="4320" author="fournc" created="Wed, 9 Oct 2013 01:05:14 +0100"/>
                            <attachment id="12570079" name="ZOOKEEPER-1624.patch" size="9928" author="thawan" created="Wed, 20 Feb 2013 04:57:31 +0000"/>
                            <attachment id="12570055" name="ZOOKEEPER-1624.patch" size="9760" author="thawan" created="Wed, 20 Feb 2013 02:14:37 +0000"/>
                            <attachment id="12570018" name="ZOOKEEPER-1624.patch" size="4233" author="thawan" created="Tue, 19 Feb 2013 22:48:06 +0000"/>
                            <attachment id="12567638" name="ZOOKEEPER-1624.patch" size="4233" author="thawan" created="Fri, 1 Feb 2013 21:20:41 +0000"/>
                            <attachment id="12565429" name="ZOOKEEPER-1624.patch" size="4026" author="thawan" created="Fri, 18 Jan 2013 03:46:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 18 Jan 2013 04:20:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>305000</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz1rzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>254379</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>