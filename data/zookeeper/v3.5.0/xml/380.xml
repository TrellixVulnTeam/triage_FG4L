<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:47:11 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-380/ZOOKEEPER-380.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-380] bookkeeper should have a streaming api so that its easier to store checpoints/snapshots in bookkeeper.</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-380</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;currently, bookkeeper api allows just a bytes interface which is &lt;br/&gt;
ld.write(bytes).&lt;/p&gt;

&lt;p&gt;We should have an interface like &lt;/p&gt;

&lt;p&gt;Stream s = ledger.createStream() (I am not very sure of the interface right now but will post a more concrete one after giving it a little more thought)&lt;/p&gt;

&lt;p&gt;now this stream can be used to wirte checkpoints as &lt;br/&gt;
s.write(bytes)&lt;br/&gt;
and then closed to s.close() to close the snapshot. &lt;br/&gt;
This api could use the current api to implement snapshots as chunks of bytes (buffered by stream s) that can be written via ld.write(bytes).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12423626">ZOOKEEPER-380</key>
            <summary>bookkeeper should have a streaming api so that its easier to store checpoints/snapshots in bookkeeper.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mahadev">Mahadev konar</assignee>
                                    <reporter username="mahadev">Mahadev konar</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Apr 2009 22:12:02 +0100</created>
                <updated>Wed, 8 Jul 2009 21:24:03 +0100</updated>
                            <resolved>Wed, 6 May 2009 10:02:14 +0100</resolved>
                                    <version>3.1.0</version>
                    <version>3.1.1</version>
                                    <fixVersion>3.2.0</fixVersion>
                                    <component>contrib-bookkeeper</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12703948" author="mahadev" created="Wed, 29 Apr 2009 02:44:48 +0100"  >&lt;p&gt;I am attaching a patch which changes the current bookkeeper api to move all the reading and writing to ledgerhandle rather than using BooKKeeper api. The BooKKeeper api acts like a bookkeeper handle which can be used to create/open ledgers. THe reading and writing can then be done using ledgerhandle api.&lt;/p&gt;

&lt;p&gt;I havent yet finished my streaming api. I wnated to make some changes to the bookkeeper api so that it easier to use and can be extended to write a streaming interface on the ledgerhandle.&lt;/p&gt;

&lt;p&gt;comments?&lt;/p&gt;</comment>
                            <comment id="12704234" author="mahadev" created="Wed, 29 Apr 2009 19:29:14 +0100"  >&lt;p&gt;this patch incorporates &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-365&quot; title=&quot;javadoc is wrong for setLast in LedgerHandle&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-365&quot;&gt;&lt;del&gt;ZOOKEEPER-365&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="12704630" author="fpj" created="Thu, 30 Apr 2009 14:25:59 +0100"  >&lt;p&gt;This looks great, Mahadev. I&apos;m uploading a new version of the patch that makes two modifications to yous:&lt;/p&gt;

&lt;p&gt;1- It includes the CloseTest of patch 387;&lt;br/&gt;
2- CloseTest does not work with your original patch due to a concurrency problem when closing ClientCBWorker from a LedgerHandle::close() call. I have fixed it by keeping a counter and maintaining an instance of ClientCBWorker as long as there is at least one ledger open and using it.&lt;/p&gt;

&lt;p&gt;I have also removed the QuorumEngine::stop variable. This variable was necessary with old code, but not necessary with this current version.&lt;/p&gt;</comment>
                            <comment id="12704892" author="mahadev" created="Fri, 1 May 2009 05:43:26 +0100"  >&lt;p&gt;THis patch implements a streaming api extending OutputStream and InputStream on top of ledgerhandles.&lt;/p&gt;

&lt;p&gt;The way to use it is &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
LedgerHandle lh = BooKKeeper.createLedger()
LedgerOutputStream los = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LedgerOutputStream(lh);
los.write() ...........

los.close()
lh.close()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;for using the inputstream is similar&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
LedgerHandle lh = BooKKepeer.openLedger()
LedgerInputStream lis = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LedgerInputStream(lh);
lis.read(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]);
lis.close();
lh.close();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This patch does not have tests. I will add tests with the next patch. comments?&lt;/p&gt;</comment>
                            <comment id="12705148" author="fpj" created="Fri, 1 May 2009 23:09:22 +0100"  >&lt;p&gt;It looks good so far, Mahadev. One comment I have is that in LedgerInputStream you probably don&apos;t want to  read a whole ledger before you start making bytes available to the application as the constructors in the patch do. A ledger might have a large number of entries (or bytes) and you may want to bring entries incrementally as the application consumes bytes. One way of dealing with this issue is to have LedgerInputStream::refill also reading new entries instead of only checking if there are more entries in the LedgerSequence object le.&lt;/p&gt;</comment>
                            <comment id="12705179" author="mahadev" created="Sat, 2 May 2009 00:28:28 +0100"  >&lt;p&gt;here&apos;s a patch with  tests &lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added tests&lt;/li&gt;
	&lt;li&gt;implemented flavios suggestion of doing readentries in pieces, didnt know that it was buffered at the client side&lt;/li&gt;
	&lt;li&gt;change log4j so that only info level loggin is done in testing&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12705187" author="hadoopqa" created="Sat, 2 May 2009 00:59:11 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12407050/ZOOKEEPER-380.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12407050/ZOOKEEPER-380.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 769885.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/59/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/59/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/59/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/59/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/59/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/59/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12705596" author="fpj" created="Mon, 4 May 2009 14:58:48 +0100"  >&lt;p&gt;It looks very good. I just have a few minor comments:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The increment in LedgerInputStream can be larger, say 100 or even 1000;&lt;/li&gt;
	&lt;li&gt;I wonder if LedgerInputStream and LedgerOutputStream should be part of the client package. I don&apos;t have a strong argument for having this change, but it might be better given the organization we have currently;&lt;/li&gt;
	&lt;li&gt;I think we should delete org.apache.bookkeeper.client.LedgerStream. Your implementation supersedes that one.&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="12705796" author="mahadev" created="Mon, 4 May 2009 23:31:54 +0100"  >&lt;p&gt;attached patch with flavios suggestions &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;increased the increment to 50 ( &amp;lt; 100 since in the woest case want to reduce the memory footprint)&lt;/li&gt;
	&lt;li&gt;still leaving them in streaming package&lt;/li&gt;
	&lt;li&gt;done&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="12705842" author="hadoopqa" created="Tue, 5 May 2009 01:18:07 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12407191/ZOOKEEPER-380.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12407191/ZOOKEEPER-380.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 769885.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/61/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/61/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/61/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/61/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/61/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-vesta.apache.org/61/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12705855" author="mahadev" created="Tue, 5 May 2009 02:26:41 +0100"  >&lt;p&gt;the -1 is due to seg fault in the c tests (unrelated to this patch). I am still working with QA to fix this (since no core file is generated yet ).... &lt;/p&gt;</comment>
                            <comment id="12706356" author="fpj" created="Wed, 6 May 2009 10:02:14 +0100"  >&lt;p&gt;Thanks, Mahadev. I assumed that the change to log4j.properties was accidental, so I did not include it in the commit.&lt;/p&gt;</comment>
                            <comment id="12706511" author="mahadev" created="Wed, 6 May 2009 17:56:23 +0100"  >&lt;p&gt;the log4j wasnt accidental ... the default if set to trace, and should be set to info. It causes a huge logging in the tests and anway the default should be INFO..&lt;/p&gt;</comment>
                            <comment id="12707392" author="hudson" created="Fri, 8 May 2009 17:02:12 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #303 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/303/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/303/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12424141">ZOOKEEPER-387</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12422018">ZOOKEEPER-365</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12407191" name="ZOOKEEPER-380.patch" size="75567" author="mahadev" created="Mon, 4 May 2009 23:31:54 +0100"/>
                            <attachment id="12407050" name="ZOOKEEPER-380.patch" size="72094" author="mahadev" created="Sat, 2 May 2009 00:28:28 +0100"/>
                            <attachment id="12406987" name="ZOOKEEPER-380.patch" size="67066" author="mahadev" created="Fri, 1 May 2009 05:43:26 +0100"/>
                            <attachment id="12406923" name="ZOOKEEPER-380.patch" size="56757" author="fpj" created="Thu, 30 Apr 2009 14:25:59 +0100"/>
                            <attachment id="12406810" name="ZOOKEEPER-380.patch" size="45491" author="mahadev" created="Wed, 29 Apr 2009 19:29:14 +0100"/>
                            <attachment id="12406728" name="ZOOKEEPER-380.patch" size="44729" author="mahadev" created="Wed, 29 Apr 2009 02:44:48 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 30 Apr 2009 13:25:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47859</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10342"><![CDATA[Incompatible change]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzy0n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33495</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>