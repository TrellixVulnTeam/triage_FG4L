<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:43:35 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1750/ZOOKEEPER-1750.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1750] Race condition producing NPE in NIOServerCnxn.toString</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1750</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt; The socket is closed and the variable &quot;sock&quot; is set to null for normal reasons, but the toString method is called before &quot;sock&quot; can be set again, producing a NullPointerException.&lt;/p&gt;

&lt;p&gt;Stack trace: &lt;/p&gt;

&lt;p&gt;2013-08-29 01:49:19,991 6277 &lt;span class=&quot;error&quot;&gt;&amp;#91;CommitProcWorkThread-3&amp;#93;&lt;/span&gt; WARN org.apache.zookeeper.server.WorkerService  - Unexpected exception&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
    at org.apach.zookeeper.server.NIOServerCnxn.toString(NIOServerCnxn.java:961)&lt;br/&gt;
    at java.lang.String.valueOf(String.java:2854)&lt;br/&gt;
    at java.lang.StringBuilder.append(StringBuilder.java:128)&lt;br/&gt;
    at org.apache.zookeeper.server.NIOServerCnxn.process(NIOServerCnxn.java:1104)&lt;br/&gt;
    at org.apache.zookeeper.server.WatchManager.triggerWatch(WatchManager.java:120)&lt;br/&gt;
    at org.apache.zookeeper.server.WatchManager.triggerWatch(WatchManager.java:92)&lt;br/&gt;
    at org.apache.zookeeper.server.DataTree.createNode(DataTree.java:544)&lt;br/&gt;
    at org.apache.zookeeper.server.DataTree.processTxn(DataTree.java:805)&lt;br/&gt;
    at org.apache.zookeeper.server.ZKDatabase.processTxn(ZKDatabase.java:319)&lt;br/&gt;
    at org.apache.zookeeper.server.ZooKeeperServer.processTxn(ZooKeeperServer.java:967)&lt;br/&gt;
    at org.apache.zookeeper.server.FinalRequestProcessor.processRequest(FinalRequestProcessor.java:115)&lt;br/&gt;
    at org.apache.zookeeper.server.quorum.Leader$ToBeAppliedRequestProcessor.processRequest(Leader.java:859)&lt;br/&gt;
    at org.apache.zookeeper.server.quorum.CommitProcessor$CommitWorkRequest.doWork(CommitProcessor.java:271)&lt;br/&gt;
    at org.apache.zookeeper.server.WorkerService$ScheduledWorkRequest.run(WorkerService.java:152)&lt;br/&gt;
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)&lt;br/&gt;
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)&lt;br/&gt;
    at java.lang.Thread.run(Thread.java:722)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12666416">ZOOKEEPER-1750</key>
            <summary>Race condition producing NPE in NIOServerCnxn.toString</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rakeshr">Rakesh R</assignee>
                                    <reporter username="helen">Helen Hastings</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Aug 2013 23:57:04 +0100</created>
                <updated>Thu, 13 Mar 2014 18:16:54 +0000</updated>
                            <resolved>Sat, 5 Oct 2013 00:16:49 +0100</resolved>
                                    <version>3.5.0</version>
                                    <fixVersion>3.4.6</fixVersion>
                    <fixVersion>3.5.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="13761191" author="rakeshr" created="Sun, 8 Sep 2013 05:36:39 +0100"  >&lt;p&gt;Used sock.isOpen() instead of nullifying sock=null. Please help me to review the changes. Thanks. The problem exists in 3.4 branch also.&lt;/p&gt;</comment>
                            <comment id="13761629" author="rakeshr" created="Mon, 9 Sep 2013 06:25:12 +0100"  >&lt;p&gt;Updated latest patch.&lt;/p&gt;</comment>
                            <comment id="13761729" author="hadoopqa" created="Mon, 9 Sep 2013 10:45:12 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12602090/0002-ZOOKEEPER-1750-trunk-version.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12602090/0002-ZOOKEEPER-1750-trunk-version.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1520436.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1570//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1570//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1570//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1570//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1570//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1570//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13762365" author="michim" created="Mon, 9 Sep 2013 23:05:36 +0100"  >&lt;p&gt;+1 Thanks Rakesh.&lt;/p&gt;

&lt;p&gt;This patch doesn&apos;t apply to branch-3.4. Rakesh, could you generate a separate patch for branch-3.4?&lt;/p&gt;</comment>
                            <comment id="13762782" author="rakeshr" created="Tue, 10 Sep 2013 07:33:28 +0100"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michi009&quot; class=&quot;user-hover&quot; rel=&quot;michi009&quot;&gt;Michi Mutsuzaki&lt;/a&gt; for the interest.&lt;br/&gt;
Hi, I think there is potential problem in the test case assertion which I done in the patch.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; cnxnStr = serverCnxn.toString();
                serverCnxn.close();
                Assert.assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;Connection mismatches!&quot;&lt;/span&gt;, cnxnStr,
                        serverCnxn.toString());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;NIOServerCnxn#toString is using &apos;sock.socket().getRemoteSocketAddress()&apos; and  this api is returning &apos;null&apos; randomly. I think we should change it like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                    serverCnxn.toString();
                } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
                    Assert.fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Shouldn&apos;t &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; getting connection details&quot;&lt;/span&gt;);
                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I could see its committed in trunk version. Could you please help to change this, otw it may leads random failures. Whats the approach to do the necessary changes?&lt;/p&gt;</comment>
                            <comment id="13762790" author="rakeshr" created="Tue, 10 Sep 2013 07:43:56 +0100"  >&lt;p&gt;Updated patch for 3.4 version. Please have a look at it.&lt;/p&gt;</comment>
                            <comment id="13762798" author="hadoopqa" created="Tue, 10 Sep 2013 07:52:24 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12602296/0003-ZOOKEEPER-1750-branch-3_4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12602296/0003-ZOOKEEPER-1750-branch-3_4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1521308.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1571//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1571//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13762955" author="hudson" created="Tue, 10 Sep 2013 12:06:55 +0100"  >&lt;p&gt;SUCCESS: Integrated in ZooKeeper-trunk #2050 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2050/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2050/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1750&quot; title=&quot;Race condition producing NPE in NIOServerCnxn.toString&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1750&quot;&gt;&lt;del&gt;ZOOKEEPER-1750&lt;/del&gt;&lt;/a&gt; Race condition producing NPE in NIOServerCnxn.toString&lt;br/&gt;
(Rakesh R via michim) (michim: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1521308&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1521308&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/NIOServerCnxn.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/NIOServerCnxnTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13763293" author="michim" created="Tue, 10 Sep 2013 18:53:41 +0100"  >&lt;p&gt;Hi Rakesh,&lt;/p&gt;

&lt;p&gt;Please submit the patch to this jira. I&apos;ll review it and check it in.&lt;/p&gt;

&lt;p&gt;By the way, does anybody know how to specify the target branch for the pre-commit build?&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13763901" author="rakeshr" created="Wed, 11 Sep 2013 04:03:04 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michi009&quot; class=&quot;user-hover&quot; rel=&quot;michi009&quot;&gt;Michi Mutsuzaki&lt;/a&gt; Could you please see the updated patch for the changes. Thanks&lt;/p&gt;</comment>
                            <comment id="13763945" author="hadoopqa" created="Wed, 11 Sep 2013 05:09:14 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12602502/0004-ZOOKEEPER-1750-trunk-version-modified-test-case-assertion.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12602502/0004-ZOOKEEPER-1750-trunk-version-modified-test-case-assertion.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1521308.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1572//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1572//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1572//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1572//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1572//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1572//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13764866" author="michim" created="Wed, 11 Sep 2013 23:20:08 +0100"  >&lt;p&gt;+1 for both 0003-&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1750&quot; title=&quot;Race condition producing NPE in NIOServerCnxn.toString&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1750&quot;&gt;&lt;del&gt;ZOOKEEPER-1750&lt;/del&gt;&lt;/a&gt;&lt;del&gt;branch-3_4.patch and 0004&lt;/del&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1750&quot; title=&quot;Race condition producing NPE in NIOServerCnxn.toString&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1750&quot;&gt;&lt;del&gt;ZOOKEEPER-1750&lt;/del&gt;&lt;/a&gt;-trunk-version-modified-test-case-assertion.patch. Thanks Rakesh!&lt;/p&gt;</comment>
                            <comment id="13765340" author="hudson" created="Thu, 12 Sep 2013 12:12:04 +0100"  >&lt;p&gt;SUCCESS: Integrated in ZooKeeper-trunk #2053 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2053/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2053/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1750&quot; title=&quot;Race condition producing NPE in NIOServerCnxn.toString&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1750&quot;&gt;&lt;del&gt;ZOOKEEPER-1750&lt;/del&gt;&lt;/a&gt; Handle NIOServerCnxn#toString returning null (Rakesh R via michim) (michim: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1522079&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1522079&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/NIOServerCnxnTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13933700" author="fpj" created="Thu, 13 Mar 2014 18:16:54 +0000"  >&lt;p&gt;Closing issues after releasing 3.4.6.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12602030" name="0001-ZOOKEEPER-1750-trunk-version.patch" size="5184" author="rakeshr" created="Sun, 8 Sep 2013 05:32:23 +0100"/>
                            <attachment id="12602090" name="0002-ZOOKEEPER-1750-trunk-version.patch" size="5434" author="rakeshr" created="Mon, 9 Sep 2013 06:25:12 +0100"/>
                            <attachment id="12602296" name="0003-ZOOKEEPER-1750-branch-3_4.patch" size="4966" author="rakeshr" created="Tue, 10 Sep 2013 07:43:56 +0100"/>
                            <attachment id="12602502" name="0004-ZOOKEEPER-1750-trunk-version-modified-test-case-assertion.patch" size="1583" author="rakeshr" created="Wed, 11 Sep 2013 04:01:35 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 8 Sep 2013 04:36:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>346355</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzhkin:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>346656</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>