<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:49:15 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-288/ZOOKEEPER-288.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-288] Cleanup and fixes to BookKeeper</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-288</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;We observed one race condition when multiple threads try to write concurrently. This patch should fix it.  I will also remove some commented code.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12413867">ZOOKEEPER-288</key>
            <summary>Cleanup and fixes to BookKeeper</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fpj">Flavio Junqueira</assignee>
                                    <reporter username="fpj">Flavio Junqueira</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Feb 2009 11:49:47 +0000</created>
                <updated>Wed, 8 Jul 2009 21:23:56 +0100</updated>
                            <resolved>Wed, 1 Apr 2009 22:51:41 +0100</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>3.2.0</fixVersion>
                                    <component>contrib-bookkeeper</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12669933" author="fpj" created="Tue, 3 Feb 2009 11:54:11 +0000"  >&lt;p&gt;Having one instance of MessageDigest on QuorumOpMonitor is also causing reads to fail a few times upon a large number of reads.&lt;/p&gt;</comment>
                            <comment id="12672264" author="fpj" created="Tue, 10 Feb 2009 13:56:53 +0000"  >&lt;p&gt;One ByteBuffer allocation.&lt;/p&gt;</comment>
                            <comment id="12688666" author="fpj" created="Tue, 24 Mar 2009 12:52:21 +0000"  >&lt;p&gt;Patch includes several critical changes:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;New security scheme: ledger and mac keys;&lt;/li&gt;
	&lt;li&gt;Optimized reads: client sends request to just a quorum;&lt;/li&gt;
	&lt;li&gt;Fixes the problem with reads that triggered this jira.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12689169" author="breed" created="Wed, 25 Mar 2009 17:22:57 +0000"  >&lt;p&gt;looks good. i&apos;d like to see a couple of changes before we commit it:&lt;/p&gt;

&lt;p&gt;1) you have genSecurePadding() in two different classes. for maintainability, you should only have it in one place.&lt;/p&gt;

&lt;p&gt;2) in genLedgerKey and genMacKey, why do you allocate a byte array, do the copy and then do the digest.update(), rather than calling digest.update() twice? i think it makes is simpler and more readable. &lt;/p&gt;

&lt;p&gt;3) MasterKeys should start with a lower case letter. you never remove from MasterKeys, so you should probably make that a WeakHashMap, so that it can get GCed.&lt;/p&gt;

&lt;p&gt;4) are the masterkeys stored with the ledger fragment? i couldn&apos;t find it.&lt;/p&gt;</comment>
                            <comment id="12689443" author="fpj" created="Thu, 26 Mar 2009 10:52:46 +0000"  >&lt;p&gt;Thanks, Ben.&lt;/p&gt;

&lt;p&gt;&amp;gt; &amp;gt; 1) you have genSecurePadding() in two different classes. for maintainability, you should only have it in one place.&lt;/p&gt;

&lt;p&gt;Those methods are not necessary anymore, so I have just removed them in the new patch I&apos;m uploading.&lt;/p&gt;

&lt;p&gt;&amp;gt; &amp;gt; 2) in genLedgerKey and genMacKey, why do you allocate a byte array, do the copy and then do the &lt;br/&gt;
&amp;gt; &amp;gt; digest.update(), rather than calling digest.update() twice? i think it makes is simpler and more readable.&lt;/p&gt;

&lt;p&gt;When profiling BK, I noticed that reducing the number of calls to update increases performance by a notch, so I&apos;ve been following this strategy of only calling update once. I don&apos;t have a strong argument for why that happens, so I can go either way.&lt;/p&gt;

&lt;p&gt;&amp;gt; &amp;gt; 3) MasterKeys should start with a lower case letter. you never remove from MasterKeys, so you should probably &lt;br/&gt;
&amp;gt; &amp;gt; make that a WeakHashMap, so that it can get GCed.&lt;/p&gt;

&lt;p&gt;Done. Do you think that &quot;ledgers&quot; in Bookie.java should also be a WeakHashMap? &lt;/p&gt;

&lt;p&gt;&amp;gt; &amp;gt; 4) are the masterkeys stored with the ledger fragment? i couldn&apos;t find it.&lt;/p&gt;

&lt;p&gt;Currently it is not stored with the fragment. Do you think it should?&lt;/p&gt;

</comment>
                            <comment id="12694598" author="breed" created="Wed, 1 Apr 2009 17:01:14 +0100"  >&lt;p&gt;+1. ready to commit. i think the ledgers should be in a weakhashmap, but that is a separate issue. i&apos;ve opened up a separate jira for 4)&lt;/p&gt;</comment>
                            <comment id="12694773" author="mahadev" created="Wed, 1 Apr 2009 22:51:41 +0100"  >&lt;p&gt;I just committed this. Thanks flavio.&lt;br/&gt;
It would be better to file different jira&apos;s and patches so that we could have more descriptive jira&apos;s and useful release notes from svn log.&lt;/p&gt;

</comment>
                            <comment id="12695717" author="hudson" created="Sat, 4 Apr 2009 12:50:53 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #271 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/271/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/271/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12403707" name="ZOOKEEPER-BOOKKEEPER-288.patch" size="61832" author="fpj" created="Thu, 26 Mar 2009 10:53:59 +0000"/>
                            <attachment id="12403512" name="ZOOKEEPER-BOOKKEEPER-288.patch" size="61743" author="fpj" created="Tue, 24 Mar 2009 12:52:21 +0000"/>
                            <attachment id="12399367" name="ZOOKEEPER-BOOKKEEPER-288.patch" size="24909" author="fpj" created="Tue, 3 Feb 2009 16:42:58 +0000"/>
                            <attachment id="12399351" name="ZOOKEEPER-BOOKKEEPER-288.patch" size="4150" author="fpj" created="Tue, 3 Feb 2009 11:51:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 25 Mar 2009 17:22:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47920</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzy7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33527</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>New security scheme: ledger and mac keys;&lt;br/&gt;
Optimized reads: client sends request to just a quorum;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>