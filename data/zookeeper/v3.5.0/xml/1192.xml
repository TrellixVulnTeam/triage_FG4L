<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:42:15 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1192/ZOOKEEPER-1192.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1192] Leader.waitForEpochAck() checks waitingForNewEpoch instead of checking electionFinished</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1192</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;A follower/leader should block in Leader.waitForEpochAck() until either electingFollowers contains a quorum and electionFinished=true or until a timeout occurs. A timeout means that a quorum of followers didn&apos;t ack the epoch on time, which is an error. &lt;/p&gt;

&lt;p&gt;But the check in Leader.waitForEpochAck() is &quot;if (waitingForNewEpoch) throw...&quot; and this will never be triggered, even if the wait statement just timed out,  because Leader.getEpochToPropose() completes and sets waitingForNewEpoch to false before Leader.waitForEpochAck() is invoked.&lt;/p&gt;

&lt;p&gt;Instead of &quot;if (waitingForNewEpoch) throw&quot; the condition in Leader.waitForEpochAck() should be &quot;if (!electionFinished) throw&quot;.&lt;br/&gt;
The guarded block introduced in ZK-1191 should be checking !electionFinished.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12523506">ZOOKEEPER-1192</key>
            <summary>Leader.waitForEpochAck() checks waitingForNewEpoch instead of checking electionFinished</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shralex">Alexander Shraer</assignee>
                                    <reporter username="shralex">Alexander Shraer</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Sep 2011 03:00:24 +0100</created>
                <updated>Wed, 23 Nov 2011 19:22:06 +0000</updated>
                            <resolved>Sat, 5 Nov 2011 06:15:12 +0000</resolved>
                                                    <fixVersion>3.4.0</fixVersion>
                    <fixVersion>3.5.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                            <comments>
                            <comment id="13107592" author="hadoopqa" created="Mon, 19 Sep 2011 03:33:42 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12495007/zookeeper-1192.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12495007/zookeeper-1192.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1172406.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/558//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/558//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/558//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/558//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/558//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/558//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13107949" author="phunt" created="Mon, 19 Sep 2011 17:31:06 +0100"  >&lt;p&gt;It would be good to have a test for this.&lt;/p&gt;</comment>
                            <comment id="13108149" author="shralex" created="Mon, 19 Sep 2011 22:08:11 +0100"  >&lt;p&gt;Includes a test that makes sure that leader doesn&apos;t adopt a new epoch that it proposed if it didn&apos;t get a quorum of followers to ack this epoch.&lt;/p&gt;</comment>
                            <comment id="13108151" author="shralex" created="Mon, 19 Sep 2011 22:09:42 +0100"  >&lt;p&gt;the new test is Zab1_0Test.testAbandonBeforeACKEpoch(). It fails without the patch and passes with the patch.&lt;/p&gt;</comment>
                            <comment id="13108173" author="hadoopqa" created="Mon, 19 Sep 2011 22:34:08 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12495146/zookeeper-1192-ver1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12495146/zookeeper-1192-ver1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1172406.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/564//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/564//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/564//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/564//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/564//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/564//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13109887" author="breed" created="Wed, 21 Sep 2011 22:23:40 +0100"  >&lt;p&gt;+1 looks great alex. i think it is ready to commit. do you want it committed to the 3.4 branch mahadev?&lt;/p&gt;</comment>
                            <comment id="13112340" author="breed" created="Thu, 22 Sep 2011 06:37:46 +0100"  >&lt;p&gt;the patch with the tabs and ^Ms fixed&lt;/p&gt;</comment>
                            <comment id="13112350" author="hadoopqa" created="Thu, 22 Sep 2011 07:04:17 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12496069/ZOOKEEPER-1192.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12496069/ZOOKEEPER-1192.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1172406.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/577//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/577//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/577//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/577//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/577//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/577//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13112515" author="hudson" created="Thu, 22 Sep 2011 14:00:08 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #1311 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/1311/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/1311/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1191&quot; title=&quot;Synchronization issue - wait not in guarded block&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1191&quot;&gt;&lt;del&gt;ZOOKEEPER-1191&lt;/del&gt;&lt;/a&gt;. Synchronization issue - wait not in guarded block&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1192&quot; title=&quot;Leader.waitForEpochAck() checks waitingForNewEpoch instead of checking electionFinished&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1192&quot;&gt;&lt;del&gt;ZOOKEEPER-1192&lt;/del&gt;&lt;/a&gt;. Leader.waitForEpochAck() checks waitingForNewEpoch instead of checking electionFinished&lt;/p&gt;

&lt;p&gt;breed : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1173949&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1173949&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Leader.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/Zab1_0Test.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13141538" author="fournc" created="Tue, 1 Nov 2011 20:29:40 +0000"  >&lt;p&gt;Can this issue be closed?&lt;/p&gt;</comment>
                            <comment id="13141569" author="shralex" created="Tue, 1 Nov 2011 20:45:15 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #1311 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/1311/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/1311/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1191&quot; title=&quot;Synchronization issue - wait not in guarded block&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1191&quot;&gt;&lt;del&gt;ZOOKEEPER-1191&lt;/del&gt;&lt;/a&gt;. Synchronization issue - wait not in guarded block&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1192&quot; title=&quot;Leader.waitForEpochAck() checks waitingForNewEpoch instead of checking electionFinished&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1192&quot;&gt;&lt;del&gt;ZOOKEEPER-1192&lt;/del&gt;&lt;/a&gt;. Leader.waitForEpochAck() checks waitingForNewEpoch instead of checking electionFinished&lt;/p&gt;</comment>
                            <comment id="13144571" author="fournc" created="Sat, 5 Nov 2011 04:31:16 +0000"  >&lt;p&gt;Why wasn&apos;t this committed to 3.4? This seems like something that is definitely needed for future patches to work. Specifically, I&apos;m having quite a time with 1264 and I suspect we&apos;ll have issues with 1270/1194. We really need to get some coherence here, bugs in election logic should absolutely be going into the 3.4 branch, not just trunk.&lt;/p&gt;</comment>
                            <comment id="13144572" author="fournc" created="Sat, 5 Nov 2011 04:32:32 +0000"  >&lt;p&gt;Please make sure this is put in 3.4 as well.&lt;/p&gt;</comment>
                            <comment id="13144606" author="mahadev" created="Sat, 5 Nov 2011 06:15:12 +0000"  >&lt;p&gt;Just merged this into 3.4 branch. Thanks Alex.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12496069" name="ZOOKEEPER-1192.patch" size="6469" author="breed" created="Thu, 22 Sep 2011 06:37:46 +0100"/>
                            <attachment id="12495146" name="zookeeper-1192-ver1.patch" size="6281" author="shralex" created="Mon, 19 Sep 2011 22:08:11 +0100"/>
                            <attachment id="12495007" name="zookeeper-1192.patch" size="1797" author="shralex" created="Mon, 19 Sep 2011 03:07:58 +0100"/>
                    </attachments>
                <subtasks>
                            <subtask id="12523448">ZOOKEEPER-1191</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 19 Sep 2011 02:33:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzsxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32671</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>