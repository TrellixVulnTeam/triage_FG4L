<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:52:24 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1807/ZOOKEEPER-1807.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1807] Observers spam each other creating connections to the election addr</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1807</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I noticed today that my Observers are spamming each other trying to open connections to the election port. I&apos;ve got tons of these:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-11-01 22:19:45,819 - DEBUG [WorkerSender[myid=13]] - There is a connection already for server 9
2013-11-01 22:19:45,819 - DEBUG [WorkerSender[myid=13]] - There is a connection already for server 10
2013-11-01 22:19:45,819 - DEBUG [WorkerSender[myid=13]] - There is a connection already for server 6
2013-11-01 22:19:45,819 - DEBUG [WorkerSender[myid=13]] - There is a connection already for server 12
2013-11-01 22:19:45,819 - DEBUG [WorkerSender[myid=13]] - There is a connection already for server 14
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and so and so on ad nauseam. &lt;/p&gt;

&lt;p&gt;Now, looking around I found this inside FastLeaderElection.java from when you committed &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-107&quot; title=&quot;Allow dynamic changes to server cluster membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-107&quot;&gt;&lt;del&gt;ZOOKEEPER-107&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;     private void sendNotifications() {
-        for (QuorumServer server : self.getVotingView().values()) {
-            long sid = server.id;
-
+        for (long sid : self.getAllKnownServerIds()) {
+            QuorumVerifier qv = self.getQuorumVerifier();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is that really desired? I suspect that is what&apos;s causing Observers to try to connect to each other (as opposed as just connecting to participants). I&apos;ll give it a try now and let you know. (Also, we use observer ids that are &amp;gt; 0, and I saw some parts of the code that might not deal with that assumption - so it could be that too..). &lt;/p&gt;</description>
                <environment></environment>
        <key id="12677175">ZOOKEEPER-1807</key>
            <summary>Observers spam each other creating connections to the election addr</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="shralex">Alexander Shraer</assignee>
                                    <reporter username="rgs">Raul Gutierrez Segales</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Nov 2013 23:32:47 +0000</created>
                <updated>Sun, 12 Apr 2015 00:05:35 +0100</updated>
                                                            <fixVersion>3.5.2</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                <comments>
                            <comment id="13811771" author="shralex" created="Fri, 1 Nov 2013 23:46:03 +0000"  >&lt;p&gt;Hi Raul,&lt;/p&gt;

&lt;p&gt;ZK-107 allows changing server roles. In one config a server is an observer, in the next one it may be a follower. I haven&apos;t looked closely, but I think the intention was to talk with everyone you know to try to get the most up-to-date config information. Instead of reverting this to the previous code, consider adding a check (regardless of whether this is an observer/participant server) that won&apos;t attempt to create a connection if one is already there to the same server with the same election address (election addresses may change from one view to the next). &lt;/p&gt;

&lt;p&gt;The code should handle observer id &amp;gt; 0, please file a JIRA if you find that there is a problem somewhere.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Alex&lt;/p&gt;
</comment>
                            <comment id="13811782" author="rgs" created="Fri, 1 Nov 2013 23:51:30 +0000"  >&lt;p&gt;Oh - fair enough. So I suspect QuorumCnxManager isn&apos;t doing the right thing then. Will take look. Thanks for the quick reply!&lt;/p&gt;</comment>
                            <comment id="13811798" author="rgs" created="Sat, 2 Nov 2013 00:13:37 +0000"  >&lt;p&gt;Actually - my initial assessment was wrong (the spammy &quot;there is already a connection..&quot; message  confused me).I am seeing an excess in traffic between Observers through the election port, but it&apos;s not due to connection attempts. I&apos;ll come back with the actual messages. Sorry if this isn&apos;t actually related to &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-107&quot; title=&quot;Allow dynamic changes to server cluster membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-107&quot;&gt;&lt;del&gt;ZOOKEEPER-107&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13811800" author="fpj" created="Sat, 2 Nov 2013 00:20:48 +0000"  >&lt;p&gt;It would be good to understand if this is a bug that affects the 3.4 branch as well and if it is a blocker, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgs&quot; class=&quot;user-hover&quot; rel=&quot;rgs&quot;&gt;Raul Gutierrez Segales&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13811802" author="rgs" created="Sat, 2 Nov 2013 00:23:28 +0000"  >&lt;p&gt;Yes - absolutely &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;Flavio Junqueira&lt;/a&gt;. The amount of traffic that I am seeing between Observers through the election port is... scary. I am still trying to figure out what is going on. Will be back in a bit when I have a proper analysis. &lt;/p&gt;</comment>
                            <comment id="13811838" author="thawan" created="Sat, 2 Nov 2013 01:38:30 +0000"  >&lt;p&gt;In our internal deployment, the host list in zoo.cfg for each observer only have the participants and itself.  This helps address this issue a bit but obviously, in 3.5 world, this won&apos;t work if you want to promote an observer to a participant. &lt;/p&gt;</comment>
                            <comment id="13811849" author="rgs" created="Sat, 2 Nov 2013 02:38:57 +0000"  >&lt;p&gt;Okey - this seems to actually be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-107&quot; title=&quot;Allow dynamic changes to server cluster membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-107&quot;&gt;&lt;del&gt;ZOOKEEPER-107&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;.  I added some debugging logging and I&apos;ve see that the spam, to all Observers, are the notifications:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-11-02 02:33:21,341 - INFO  [WorkerSender[myid=13]] - will send: leader = 3, zxid = 558362464215, electionEpoch = 5, state = OBSERVING, sid = 9, peerEpoch = 130, configData = [B@5a0c0ce6
2013-11-02 02:33:21,341 - INFO  [WorkerSender[myid=13]] - will send: leader = 3, zxid = 558362464215, electionEpoch = 5, state = OBSERVING, sid = 12, peerEpoch = 130, configData = [B@4d22fe39
2013-11-02 02:33:21,341 - INFO  [WorkerSender[myid=13]] - will send: leader = 3, zxid = 558362464215, electionEpoch = 5, state = OBSERVING, sid = 6, peerEpoch = 130, configData = [B@346077bf
2013-11-02 02:33:21,341 - INFO  [WorkerSender[myid=13]] - will send: leader = 3, zxid = 558362464215, electionEpoch = 5, state = OBSERVING, sid = 13, peerEpoch = 130, configData = [B@2955b776
2013-11-02 02:33:21,341 - INFO  [WorkerSender[myid=13]] - will send: leader = 3, zxid = 558362464215, electionEpoch = 5, state = OBSERVING, sid = 11, peerEpoch = 130, configData = [B@3a7fb92d
2013-11-02 02:33:21,341 - INFO  [WorkerSender[myid=13]] - will send: leader = 3, zxid = 558362464215, electionEpoch = 5, state = OBSERVING, sid = 14, peerEpoch = 130, configData = [B@1756575c
2013-11-02 02:33:21,341 - INFO  [WorkerSender[myid=13]] - will send: leader = 3, zxid = 558362464215, electionEpoch = 5, state = OBSERVING, sid = 13, peerEpoch = 130, configData = [B@258164fc
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see, it&apos;s sending tons of notifications per second. Not good &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;With this diff in FastLeaderElection.java (i.e.: a revert of part of your change):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;     private void sendNotifications() {
-        for (long sid : self.getAllKnownServerIds()) {
+        for (QuorumServer server : self.getVotingView().values()) {
+            long sid = server.id;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;observers, of course, don&apos;t get spammed. I am guessing some condition is failing for Observers that assumes the notifications are fresh and sends them repeatedly?&lt;/p&gt;</comment>
                            <comment id="13811850" author="rgs" created="Sat, 2 Nov 2013 02:40:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;Flavio Junqueira&lt;/a&gt;: I think this is 3.5.0 specific since it goes away whilst reverting those bits from &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-107&quot; title=&quot;Allow dynamic changes to server cluster membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-107&quot;&gt;&lt;del&gt;ZOOKEEPER-107&lt;/del&gt;&lt;/a&gt; (there is a chance I am overlooking something, of course, and it&apos;s some other thing). But this is most likely a blocker for the 3.5.0 release though. &lt;/p&gt;</comment>
                            <comment id="13811851" author="rgs" created="Sat, 2 Nov 2013 02:44:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thawan&quot; class=&quot;user-hover&quot; rel=&quot;thawan&quot;&gt;Thawan Kooburat&lt;/a&gt;: should omitting the Observers from zoo.cfg actually make any difference? If so we should document it somewhere (unless it already is is). In my case, where I do explicitly enumerate them I don&apos;t get observers-to-observers connections on the election port once I remove the bits I mentioned above in FLE (so it seems to me it isn&apos;t). &lt;/p&gt;</comment>
                            <comment id="13811858" author="rgs" created="Sat, 2 Nov 2013 03:29:46 +0000"  >&lt;p&gt;I think what&apos;s happening is that when we send the initial notifications to all members, as opposed to just voting members as it was before, we trigger off a self-replicating cascade of notifications. Each Observers gets the notification and then by virtue of:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;                        /*                                                                                                                            
                         * If it is from a non-voting server (such as an observer or                                                                  
                         * a non-voting follower), respond right away.                                                                                
                         */
                        if(!self.getVotingView().containsKey(response.sid)){
                           .....
                        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;it replies back to each Observer and so on.  So sounds to me that this needs to match what we have  in sendNotifications and actually check response.sid against self.getAllKnownServerIds() to avoid the endless echoing of notifications that I am seeing.&lt;/p&gt;

&lt;p&gt;Thoughts &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;Flavio Junqueira&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="13811859" author="rgs" created="Sat, 2 Nov 2013 03:43:08 +0000"  >&lt;p&gt;The attached patch prevents sending replies back when we are an Observer. Since &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-107&quot; title=&quot;Allow dynamic changes to server cluster membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-107&quot;&gt;&lt;del&gt;ZOOKEEPER-107&lt;/del&gt;&lt;/a&gt; we send notifications to Observers because they can be promoted to Participants. But to avoid replicating replies forver (i.e.: an observer sends a notification and the receiving observer then sends another one and so on) we don&apos;t have to send notifications when we are a LearnerType.OBSERVER. &lt;/p&gt;</comment>
                            <comment id="13811865" author="hadoopqa" created="Sat, 2 Nov 2013 04:24:27 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12611737/ZOOKEEPER-1807.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12611737/ZOOKEEPER-1807.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1535491.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1733//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1733//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1733//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1733//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1733//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1733//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13811902" author="shralex" created="Sat, 2 Nov 2013 08:38:54 +0000"  >&lt;p&gt;Thanks Raul. This seems like a bit of an overkill - you&apos;re eliminating observer to observer responses. Would be better to understand what causes it to spin and to send notifications in normal rate like for participants.&lt;/p&gt;</comment>
                            <comment id="13811993" author="rgs" created="Sat, 2 Nov 2013 14:03:23 +0000"  >&lt;p&gt;Well, if we really need observer to observer responses, for reconfig purposes I presume, then should we be sending them to observers not in LOOKING state? See the conditions that apply when responding to participants in the lines below my patch.&lt;/p&gt;

&lt;p&gt;But even still with that being correct it might be too much overhead for large Observers deployments. Should this be optional?&lt;/p&gt;</comment>
                            <comment id="13812073" author="shralex" created="Sat, 2 Nov 2013 17:07:33 +0000"  >&lt;p&gt;what if we remove the &quot;if(!self.getVotingView().containsKey(response.sid)){&quot;&lt;br/&gt;
and always run the else code ?&lt;/p&gt;</comment>
                            <comment id="13812074" author="shralex" created="Sat, 2 Nov 2013 17:09:55 +0000"  >&lt;p&gt;regarding overhead - if I understand the &quot;else&quot; code correctly, it will only send a message if one of them is LOOKING, so I&apos;m not sure that the overhead is excessive. &lt;/p&gt;</comment>
                            <comment id="13812100" author="rgs" created="Sat, 2 Nov 2013 18:35:50 +0000"  >&lt;p&gt;Yeah - I think you are right. In this &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-107&quot; title=&quot;Allow dynamic changes to server cluster membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-107&quot;&gt;&lt;del&gt;ZOOKEEPER-107&lt;/del&gt;&lt;/a&gt; world in which observers can be promoted, etc the initial if() doesn&apos;t make sense anymore. I&apos;ll submit a new patch so we can think about it a bit more.&lt;/p&gt;

&lt;p&gt;With regards of the overhead and making all of this optional, well if you have &amp;gt; 100 observers restarted at once you&apos;ll have a large of notifications traffic. But I guess within the limits of tolerable.&lt;/p&gt;</comment>
                            <comment id="13812111" author="rgs" created="Sat, 2 Nov 2013 18:51:15 +0000"  >&lt;p&gt;As discussed with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;, we now need to apply the same response logic for voting and non-voting members.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;Flavio Junqueira&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thawan&quot; class=&quot;user-hover&quot; rel=&quot;thawan&quot;&gt;Thawan Kooburat&lt;/a&gt; - thoughts?&lt;/p&gt;</comment>
                            <comment id="13812123" author="hadoopqa" created="Sat, 2 Nov 2013 19:30:45 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12611781/ZOOKEEPER-1807.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12611781/ZOOKEEPER-1807.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1535491.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1735//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1735//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1735//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1735//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1735//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1735//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13813044" author="rgs" created="Mon, 4 Nov 2013 17:45:01 +0000"  >&lt;p&gt;Added a few minor cosmetic cleanups.&lt;/p&gt;

&lt;p&gt;My main concern is that even with this you would still have loops when a pair of observers is in LOOKING state. One way of cutting the loop would be fencing:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;recvqueue.offer(n);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;with:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;if (self.getLearnerType() == LearnerType.OBSERVER) { ... }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but I am unsure how well that plays with all the valid config transitions that can happen with &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-107&quot; title=&quot;Allow dynamic changes to server cluster membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-107&quot;&gt;&lt;del&gt;ZOOKEEPER-107&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="13813071" author="shralex" created="Mon, 4 Nov 2013 18:10:57 +0000"  >&lt;p&gt;probably there&apos;s not going to be any more of a loop than for participants.&lt;br/&gt;
if you think this is not acceptable for observers, it would be sufficient to reply only when the sending server has a bigger config version (the one in QuorumVerifier) than the potential receiver. Otherwise there&apos;s no benefit for the receiver in terms of learning about new configs. &lt;/p&gt;
</comment>
                            <comment id="13813077" author="rgs" created="Mon, 4 Nov 2013 18:22:26 +0000"  >&lt;p&gt;Thanks for the quick comment Alex. Yeah sounds to me that might be acceptable. Again, for huge deployments it might be a bit of concern since you&apos;ll be putting extra pressure on the cluster after, say, a big network partition. Thoughts? Cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thawan&quot; class=&quot;user-hover&quot; rel=&quot;thawan&quot;&gt;Thawan Kooburat&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;Flavio Junqueira&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="13813085" author="hadoopqa" created="Mon, 4 Nov 2013 18:31:55 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12611988/ZOOKEEPER-1807.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12611988/ZOOKEEPER-1807.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1535491.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1740//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1740//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1740//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1740//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1740//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1740//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13813104" author="rgs" created="Mon, 4 Nov 2013 18:49:31 +0000"  >&lt;p&gt;Here&apos;s how notification traffic (on election port 3888 in my case) goes down with the patch (i.e.: without the notifications loop). It&apos;s pretty dramatic so I&apos;d say this is definitely a blocker for 3.5.0. &lt;/p&gt;</comment>
                            <comment id="13813108" author="hadoopqa" created="Mon, 4 Nov 2013 18:55:32 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12611999/notifications-loop.png&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12611999/notifications-loop.png&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1535491.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1741//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1741//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13813111" author="thawan" created="Mon, 4 Nov 2013 18:57:08 +0000"  >&lt;p&gt;I believe we have a much different concern using large number of observers. In our internal deployment, we did a few hacks which essentially kill all observer-to-observer communication. Observers only observe the result of election algorithm. We also add random delay when observer try to reconnect, so that participants has a chance to synchronize with the leader and form the quorum before the observers take away the leader&apos;s bandwidth. &lt;/p&gt;

&lt;p&gt;My understanding is that with our leader election algorithm, you need to broadcast your vote whenever your current vote change, so this will generate a lot of message during the initial phase of the algorithm. Also, N x N communication needed by LE is not going to scale for large deployment.  For me, I don&apos;t think promoting observer to participant is going to be a common case (only needed for DR purpose), it would be acceptable to have optional flag to disable that feature in order to reduce LE overhead with large number of observers.&lt;/p&gt;</comment>
                            <comment id="13813247" author="shralex" created="Mon, 4 Nov 2013 20:45:11 +0000"  >&lt;p&gt;Sorry for the confusion, everyone, but it seems that for reconfiguration purposes its only important to send a notification (containing new config) to a server if its a participant either in the current or in the next configuration. Only in that case we may need to convince him to adopt its new role as a participant and help form a quorum. So perhaps the attached patch could work. What do you think ?&lt;/p&gt;</comment>
                            <comment id="13813253" author="rgs" created="Mon, 4 Nov 2013 20:51:57 +0000"  >&lt;p&gt;Btw - where&apos;s the canonical definition of how reconfiguration &lt;b&gt;should&lt;/b&gt; work? Is it this implementation or are their docs somewhere else? If so, lets make sure that with this change we sync them up. If the behavior of reconfiguration is defined by the implementation then can we have more comments with this patch? I.e.: to who do we send notifications and what are we expecting, etc. Just to make sure that who ever hacks next on FLE doesn&apos;t lose sight of these constraints. &lt;/p&gt;</comment>
                            <comment id="13813287" author="shralex" created="Mon, 4 Nov 2013 21:22:29 +0000"  >&lt;p&gt;This part is described in Section 3.2 of the paper: &lt;a href=&quot;https://www.usenix.org/system/files/conference/atc12/atc12-final74.pdf&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://www.usenix.org/system/files/conference/atc12/atc12-final74.pdf&lt;/a&gt;&lt;br/&gt;
Of course the paper doesn&apos;t talk about FastLeaderElection and things like that. So the actual implementation needs to have comments, and it does have them in many places, here we should probably explain some more. &lt;/p&gt;</comment>
                            <comment id="13813294" author="hadoopqa" created="Mon, 4 Nov 2013 21:26:46 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12612023/ZOOKEEPER-1807-alex.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12612023/ZOOKEEPER-1807-alex.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1535491.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1742//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1742//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1742//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1742//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1742//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1742//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13813944" author="abranzyck" created="Tue, 5 Nov 2013 14:33:04 +0000"  >&lt;p&gt;My son was playing with the keyboard yesterday and he assigned this JIRA to me. I hope this is the worst part of the mess.&lt;/p&gt;</comment>
                            <comment id="13814488" author="shralex" created="Wed, 6 Nov 2013 01:17:46 +0000"  >&lt;p&gt;I was thinking about this some more but couldn&apos;t come up with a scenario that would require more than just sending notifications to the participants of the &lt;b&gt;current&lt;/b&gt; view during FLE, like it was before ZK-107, so I&apos;m reverting this change for now in the attached patch. During the process I added two tests that involve observers and reconfigurations, and found a small NullPointer bug in QuorumPeer which is also fixed here. &lt;/p&gt;

&lt;p&gt;Note that a leader would still have to contact both old and new view to commit a reconfig when it comes up, so its important that new observer/participants know who the chosen leader is, and I think they will know because we start them with a configuration containing the previous one and themselves, so they will initiate a connection to previous config servers and get FLE responses with leader info.&lt;/p&gt;

&lt;p&gt;The change made in ZK-107 quoted in this Jira had an issue that we&apos;re still only waiting for a quorum of the current view before terminating FLE, so all the extra messages may have just as well be lost or never sent... So either we wait for both old and new quorums in FLE or send just to old servers like before. &lt;/p&gt;

&lt;p&gt;Also, notice that the configuration being sent is the committed one, not the proposed one. So if a server A is a participant in the new view (maybe it was an observer in the old view but it doesn&apos;t matter), then anyone able to convince it that its a participant has already adopted the new config (knows that it was committed) and so sees A as a participant and will send a message to A even if it just sends the notification to all participants of its current view.&lt;/p&gt;

&lt;p&gt;Not complete sure I have this right, so if you think that I&apos;m wrong please let me know. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=breed&quot; class=&quot;user-hover&quot; rel=&quot;breed&quot;&gt;Benjamin Reed&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;Flavio Junqueira&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="13814516" author="hadoopqa" created="Wed, 6 Nov 2013 01:56:39 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12612295/ZOOKEEPER-1807-ver2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12612295/ZOOKEEPER-1807-ver2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1538853.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1745//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1745//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1745//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1745//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1745//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1745//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13815511" author="shralex" created="Thu, 7 Nov 2013 00:49:30 +0000"  >&lt;p&gt;seems like I&apos;ve already found and solved the same QuorumPeer NPE bug in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1783&quot; title=&quot;Distinguish initial configuration from first established configuration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1783&quot;&gt;&lt;del&gt;ZOOKEEPER-1783&lt;/del&gt;&lt;/a&gt;, so once that one is committed I&apos;ll update the patch on this JIRA.&lt;/p&gt;</comment>
                            <comment id="13816152" author="rgs" created="Thu, 7 Nov 2013 17:23:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;: do you think that, perhaps, adding a comment elaborating a bit more on the rationale of notifications and the state of the new/old config would be worthwhile? I am thinking the comment should be along sendNotifications().&lt;/p&gt;</comment>
                            <comment id="13816157" author="rgs" created="Thu, 7 Nov 2013 17:31:39 +0000"  >&lt;p&gt;(could we get a reviewboard for this? some inline comments below)&lt;/p&gt;

&lt;p&gt;For:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+        // start server 3 with new config
+        zk[2] = new ZooKeeper(&quot;127.0.0.1:&quot; + ports[2][2], ClientBase.CONNECTION_TIMEOUT, this);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think the zk&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; assignment goes before the comment. &lt;/p&gt;

&lt;p&gt;For:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
+        for (int i=2; i&amp;lt;3; i++) {
+            Assert.assertTrue(&quot;waiting for server &quot;+ i + &quot; being up&quot;,
+                ClientBase.waitForServerUp(&quot;127.0.0.1:&quot; + ports[i][2],
+                        CONNECTION_TIMEOUT * 2));
+            ReconfigTest.testServerHasConfig(zk[i], allServersNext, null);  
+        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;i&amp;lt;= 3? Or no loop if you only want it to loop one time I guess.&lt;/p&gt;

&lt;p&gt;Also the ports assignment loop and the currentQuorumCfgSection creation are repeated in testObserverConvertedToParticipantDuringFLE and testCurrentObserverIsParticipantInNewConfig; mind DRY-ing this up a bit by putting those in private methods? (i.e.: generatePorts() and generateInitialConfig() or such such). &lt;/p&gt;
</comment>
                            <comment id="13816173" author="hadoopqa" created="Thu, 7 Nov 2013 17:45:12 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12612635/ZOOKEEPER-1807-ver3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12612635/ZOOKEEPER-1807-ver3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1539529.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1749//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1749//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1749//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1749//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1749//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1749//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13816253" author="shralex" created="Thu, 7 Nov 2013 18:53:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/15317/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/15317/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;thanks for the comments, Raul.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;Flavio Junqueira&lt;/a&gt; Raul and others, please see if my comment makes sense&lt;/p&gt;</comment>
                            <comment id="13816316" author="hadoopqa" created="Thu, 7 Nov 2013 19:29:11 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12612664/ZOOKEEPER-1807-ver4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12612664/ZOOKEEPER-1807-ver4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1539529.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1750//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1750//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1750//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1750//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1750//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1750//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13816797" author="hadoopqa" created="Thu, 7 Nov 2013 23:37:58 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12612698/ZOOKEEPER-1807-ver5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12612698/ZOOKEEPER-1807-ver5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1539529.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1751//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1751//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1751//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1751//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1751//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1751//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13823924" author="rgs" created="Fri, 15 Nov 2013 18:41:34 +0000"  >&lt;p&gt;I am happy to give the RB a shipit but I would prefer to have more feedback/reviews from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thawan&quot; class=&quot;user-hover&quot; rel=&quot;thawan&quot;&gt;Thawan Kooburat&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;Flavio Junqueira&lt;/a&gt; since they are more familiar with the internals of FLE. &lt;/p&gt;</comment>
                            <comment id="13838518" author="rgs" created="Wed, 4 Dec 2013 02:29:03 +0000"  >&lt;p&gt;Guys, can we get some input here? cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thawan&quot; class=&quot;user-hover&quot; rel=&quot;thawan&quot;&gt;Thawan Kooburat&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;Flavio Junqueira&lt;/a&gt;. Happy to trade some review karma &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13942447" author="michim" created="Thu, 20 Mar 2014 22:47:32 +0000"  >&lt;p&gt;I changed the priority to &apos;blocker&apos;. We should get this fixed in 3.5.0.&lt;/p&gt;</comment>
                            <comment id="13942527" author="hadoopqa" created="Thu, 20 Mar 2014 23:39:40 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12612698/ZOOKEEPER-1807-ver5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12612698/ZOOKEEPER-1807-ver5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1577756.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1971//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1971//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1971//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1971//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1971//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1971//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13968053" author="breed" created="Mon, 14 Apr 2014 05:01:41 +0100"  >&lt;p&gt;+1 looks good to me. it would be nice if &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;Flavio Junqueira&lt;/a&gt; gave it a glance though &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13968190" author="fpj" created="Mon, 14 Apr 2014 10:43:19 +0100"  >&lt;p&gt;There is probably something I&apos;m missing here, but observers still need to receive notifications. They don&apos;t need to receive notifications from other observers, that&apos;s right, but we shouldn&apos;t be sending notifications only among the voting servers. If the server is voting in the view, then it should send to everyone. If the server is an observer, it should only receive from voting members. Does this logic sound right to you guys? Otherwise, let me know what I&apos;m missing here. &lt;/p&gt;</comment>
                            <comment id="13968547" author="rgs" created="Mon, 14 Apr 2014 18:30:10 +0100"  >&lt;p&gt;I agree with your logic &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;Flavio Junqueira&lt;/a&gt; but I don&apos;t see where the RB doesn&apos;t agree with you. Isn&apos;t Alex&apos;s change exactly what you say:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;     private void sendNotifications() {
-        for (long sid : self.getAllKnownServerIds()) {
+        for (long sid : self.getVotingView().keySet()) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Only have voting members send notifications, but have everyone receive them. No?&lt;/p&gt;</comment>
                            <comment id="13968548" author="rgs" created="Mon, 14 Apr 2014 18:31:02 +0100"  >&lt;p&gt;Maybe you looked at the initial comments, which implied that Observers shouldn&apos;t receive notifications? I think what we agreed of in the end is:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/15317/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/15317/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Which I think aligns with what you said. &lt;/p&gt;</comment>
                            <comment id="13968562" author="shralex" created="Mon, 14 Apr 2014 18:40:58 +0100"  >&lt;p&gt;Hi Flavio, Raul,&lt;/p&gt;

&lt;p&gt;Befor ZK-107 the line was &quot; for (QuorumServer server : self.getVotingView().values()) {&quot;&lt;br/&gt;
This patch basically brings this back. So if I understand correctly this wasn&apos;t sending notifications to observers before.&lt;br/&gt;
But - everyone will send notifications to followers and if a follower receives a message it will respond directly, even to an observer. My reasoning is that FLE terminates once we have a quorum of the last committed config. So we could only &lt;br/&gt;
possibly need votes from followers in the last committed config. Not from observers. Observers may contact followers through the same logic and get updated but this is not enforced by the termination rule of FLE. In the attached test the observer finds out that he really is a follower (whose vote is needed).&lt;/p&gt;

&lt;p&gt;Alex&lt;/p&gt;</comment>
                            <comment id="13968579" author="fpj" created="Mon, 14 Apr 2014 18:53:36 +0100"  >&lt;p&gt;I&apos;m actually getting it from the patch:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;self.getVotingView().keySet()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13968588" author="shralex" created="Mon, 14 Apr 2014 18:58:09 +0100"  >&lt;p&gt;Flavio, I think Raul&apos;s comment actually doesn&apos;t reflect the latest patch, but if you read my last comment this may clarify things&lt;/p&gt;</comment>
                            <comment id="13968610" author="fpj" created="Mon, 14 Apr 2014 19:18:18 +0100"  >&lt;p&gt;yeah, I probably don&apos;t have it fresh enough in my head. in FLE.lookForLeader(), we set the state of server looking like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;self.setPeerState((proposedLeader == self.getId()) ?
                                        ServerState.LEADING: learningState());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;learning state can be following or observing. don&apos;t observers need to receive notifications too to be able to leave lookForLeader?&lt;/p&gt;</comment>
                            <comment id="13968638" author="shralex" created="Mon, 14 Apr 2014 19:33:18 +0100"  >&lt;p&gt;Yeah, and I think observers will indeed get a notification - they will sendNotifications to followers and the followers will respond directly to them. I meant that the termPredicate only needs followers to elect a leader.&lt;/p&gt;</comment>
                            <comment id="13968654" author="rgs" created="Mon, 14 Apr 2014 19:42:14 +0100"  >&lt;p&gt;Sorry guys - I totally mixed things up. FWIW, this is what we&apos;ve been using for a couple of months now:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
diff --git a/src/java/main/org/apache/zookeeper/server/quorum/FastLeaderElection.java b/src/java/main/org/apache/zookeeper/server/quorum/FastLeaderEle
index 9876c3d..38ae999 100644
--- a/src/java/main/org/apache/zookeeper/server/quorum/FastLeaderElection.java
+++ b/src/java/main/org/apache/zookeeper/server/quorum/FastLeaderElection.java
@@ -582,7 +582,7 @@ public class FastLeaderElection implements Election {
      * Send notifications to all peers upon a change in our vote
      */
     private void sendNotifications() {
-        for (long sid : self.getAllKnownServerIds()) {
+        for (long sid : self.getCurrentAndNextConfigVoters()) {
             QuorumVerifier qv = self.getQuorumVerifier();
             ToSend notmsg = new ToSend(ToSend.mType.notification,
                     proposedLeader,
diff --git a/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java b/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java
index 8926a82..06cf7d4 100644
--- a/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java
+++ b/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java
@@ -1112,12 +1112,12 @@ public class QuorumPeer extends Thread implements QuorumStats.Provider {
        return getQuorumVerifier().getObservingMembers();
     }
 
-    public synchronized Set&amp;lt;Long&amp;gt; getAllKnownServerIds(){
-       Set&amp;lt;Long&amp;gt; tmp = new HashSet&amp;lt;Long&amp;gt;(getQuorumVerifier().getAllMembers().keySet());
+    public synchronized Set&amp;lt;Long&amp;gt; getCurrentAndNextConfigVoters(){
+       Set&amp;lt;Long&amp;gt; voterIds = new HashSet&amp;lt;Long&amp;gt;(getQuorumVerifier().getVotingMembers().keySet());
        if (getLastSeenQuorumVerifier()!=null) {
-           tmp.addAll(getLastSeenQuorumVerifier().getAllMembers().keySet());
+          voterIds.addAll(getLastSeenQuorumVerifier().getVotingMembers().keySet());
        }
-       return tmp;
+       return voterIds;
     }
     
     /**
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13968664" author="shralex" created="Mon, 14 Apr 2014 19:50:14 +0100"  >&lt;p&gt;I think sending to just current config voters is good enough. I don&apos;t think Old-&amp;gt;New notifications are needed:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if next config is not committed, no point in notifying them - we need the current config to come up anyway.&lt;/li&gt;
	&lt;li&gt;if next config is committed, they&apos;ll notify whoever&apos;s a voter in next config.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Servers in current config only need to make sure they let all potential voters in current config know that they need their vote.&lt;/p&gt;

&lt;p&gt;I think the point is that observers will also execute sendNotifications, so they will talk with followers this way, just not with other observers.&lt;/p&gt;</comment>
                            <comment id="13970146" author="fpj" created="Tue, 15 Apr 2014 23:40:49 +0100"  >&lt;p&gt;Participants passively send notifications to observers. In FLE, we have this when as server receives a notification:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;                        /*
                         * If it is from a non-voting server (such as an observer or 
                         * a non-voting follower), respond right away. 
                         */
                        if(!self.getVotingView().containsKey(response.sid)){
                            Vote current = self.getCurrentVote();
                            QuorumVerifier qv = self.getQuorumVerifier();
                            ToSend notmsg = new ToSend(ToSend.mType.notification,
                                    current.getId(),
                                    current.getZxid(),
                                    logicalclock,
                                    self.getPeerState(),
                                    response.sid,
                                    current.getPeerEpoch(),
                                    qv.toString().getBytes());

                            sendqueue.offer(notmsg);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So it sounds fine if we do as Alex suggests: send only to participants of the current config.&lt;/p&gt;</comment>
                            <comment id="13970172" author="shralex" created="Wed, 16 Apr 2014 00:04:51 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;Flavio Junqueira&lt;/a&gt; is that a +1 ? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13972086" author="shralex" created="Thu, 17 Apr 2014 00:29:22 +0100"  >&lt;p&gt;resubmitting to trigger automatic tests&lt;/p&gt;</comment>
                            <comment id="13972120" author="hadoopqa" created="Thu, 17 Apr 2014 01:11:21 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12640553/ZOOKEEPER-1807-ver5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12640553/ZOOKEEPER-1807-ver5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1587818.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2046//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2046//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2046//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2046//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2046//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2046//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13972376" author="shralex" created="Thu, 17 Apr 2014 08:54:12 +0100"  >&lt;p&gt;The failing test raises a couple of interesting issues...&lt;br/&gt;
Mainly I think there is a &quot;race&quot; between the completion of FLE where we only require a quorum of old config and the establishment of new leader where we&apos;d need both old and new quorums if we&apos;re recovering from a failed reconfig. It looks like we should ensure that we at least have a quorum of new config before ending FLE and moving to the next stage where we actually need this quorum. &lt;/p&gt;

&lt;p&gt;Here are two scenarios where this seems important.&lt;/p&gt;

&lt;p&gt;Suppose we have A, B in old config and A, B, C, D, E in new one.&lt;br/&gt;
Suppose A, B rebooted during reconfig and will now have to recover (commit or join the new config).&lt;/p&gt;

&lt;p&gt;Case 1 (the failing test): C, D, E committed the reconfig. If A and B don&apos;t establish connection to C, D, E before completing FLE they won&apos;t find out about the new config being committed and will continuously try and fail to complete the reconfig (they&apos;ll fail because they won&apos;t get a quorum of new config). Its sort of ok since C, D, E are up and running, and possibly C D E will eventually contact A and B, but perhaps we should avoid this scenario anyway. By ensuring that A,B talk with a quorum of new config during FLE we guarantee that they switch to new config and not try to establish a leader in old one. &lt;/p&gt;

&lt;p&gt;Case 2: if C, D, E hasn&apos;t committed the new config and are actually trying to connect to A and B, but A and B could complete FLE before hearing from C, D, E they may again end up giving up and returning to FLE because they have no quorum of new config. &lt;/p&gt;

&lt;p&gt;So perhaps we should send the notifications to new config too and enforce having a quorum of new config before FLE is complete...&lt;/p&gt;</comment>
                            <comment id="13972903" author="fpj" created="Thu, 17 Apr 2014 13:59:18 +0100"  >&lt;blockquote&gt;&lt;p&gt;possibly C D E will eventually contact A and B&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;QCM in C D E will keep trying to send notifications to A B, no? If so, they will learn of the new config as soon as one of C D E connect to them. It doesn&apos;t seem so bad and perhaps it is not worth delaying FLE by enforcing a quorum of both old and new configs. What do you think?  &lt;/p&gt;

</comment>
                            <comment id="14058735" author="fpj" created="Fri, 11 Jul 2014 14:00:49 +0100"  >&lt;p&gt;Ping, I don&apos;t think we have converged here yet, have we?&lt;/p&gt;</comment>
                            <comment id="14062797" author="shralex" created="Tue, 15 Jul 2014 23:50:21 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;Flavio Junqueira&lt;/a&gt;, I&apos;m trying to test your theory that new servers will continue to ping old ones until they connect. This scenario (I described in my previous message) comes up in the testNextConfigAlreadyActive in ReconfigRecoveryTest, which fails with the latest patch. &lt;/p&gt;

&lt;p&gt;it seems that servers 2 3 4 try to contact 0 and 1 but only once or twice and then stop trying. Do you know why this could be happening ? or where the retry logic implemented ? the log below is everything I get with respect to connection attempts, even if I wait longer.&lt;/p&gt;

&lt;p&gt;3 Opening channel to server 0&lt;br/&gt;
2 Opening channel to server 0&lt;br/&gt;
2 Cannot open channel to 0 at election address localhost/127.0.0.1:11223&lt;br/&gt;
3 Cannot open channel to 0 at election address localhost/127.0.0.1:11223&lt;br/&gt;
3 Opening channel to server 1&lt;br/&gt;
2 Opening channel to server 1&lt;br/&gt;
3 Cannot open channel to 1 at election address localhost/127.0.0.1:11226&lt;br/&gt;
3 Opening channel to server 2&lt;br/&gt;
2 Cannot open channel to 1 at election address localhost/127.0.0.1:11226&lt;br/&gt;
3 Connected to server 2&lt;br/&gt;
2 Opening channel to server 3&lt;br/&gt;
2 Connected to server 3&lt;br/&gt;
4 Opening channel to server 0&lt;br/&gt;
4 Cannot open channel to 0 at election address localhost/127.0.0.1:11223&lt;br/&gt;
4 Opening channel to server 1&lt;br/&gt;
4 Cannot open channel to 1 at election address localhost/127.0.0.1:11226&lt;br/&gt;
4 Opening channel to server 2&lt;br/&gt;
4 Connected to server 2&lt;br/&gt;
2 Opening channel to server 4&lt;br/&gt;
2 Connected to server 4&lt;br/&gt;
3 Opening channel to server 4&lt;br/&gt;
3 Connected to server 4&lt;br/&gt;
2 Opening channel to server 0&lt;br/&gt;
4 Opening channel to server 3&lt;br/&gt;
4 Connected to server 3&lt;br/&gt;
2 Cannot open channel to 0 at election address localhost/127.0.0.1:11223&lt;br/&gt;
2 Opening channel to server 1&lt;br/&gt;
2 Cannot open channel to 1 at election address localhost/127.0.0.1:11226&lt;br/&gt;
4 Opening channel to server 3&lt;br/&gt;
4 Connected to server 3&lt;br/&gt;
2 Opening channel to server 0&lt;br/&gt;
2 Cannot open channel to 0 at election address localhost/127.0.0.1:11223&lt;br/&gt;
2 Opening channel to server 1&lt;br/&gt;
2 Cannot open channel to 1 at election address localhost/127.0.0.1:11226&lt;br/&gt;
3 Opening channel to server 0&lt;br/&gt;
3 Cannot open channel to 0 at election address localhost/127.0.0.1:11223&lt;br/&gt;
3 Opening channel to server 1&lt;br/&gt;
3 Cannot open channel to 1 at election address localhost/127.0.0.1:11226&lt;br/&gt;
0 Opening channel to server 1&lt;br/&gt;
0 Cannot open channel to 1 at election address localhost/127.0.0.1:11226&lt;br/&gt;
0 Opening channel to server 1&lt;br/&gt;
0 Cannot open channel to 1 at election address localhost/127.0.0.1:11226&lt;br/&gt;
1 Opening channel to server 0&lt;br/&gt;
1 Connected to server 0&lt;/p&gt;</comment>
                            <comment id="14064762" author="shralex" created="Thu, 17 Jul 2014 10:56:16 +0100"  >&lt;p&gt;Latest patch implements the idea of sending notifications to current and next config followers, and accordingly also waiting for responses.&lt;/p&gt;</comment>
                            <comment id="14064812" author="hadoopqa" created="Thu, 17 Jul 2014 11:47:12 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12656256/ZOOKEEPER-1807-ver6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12656256/ZOOKEEPER-1807-ver6.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1611309.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 87 new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2196//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2196//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2196//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2196//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2196//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2196//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14065005" author="fpj" created="Thu, 17 Jul 2014 16:13:40 +0100"  >&lt;p&gt;I checked QCM and it indeed only keeps trying to connect while it is executing lookForLeader, so your observation is right. The approach you propose seems right to me.&lt;/p&gt;

&lt;p&gt;I also checked the test failure and the test that failed is NioNettySuiteHammerTest. It timed out, so it is hard to say if it is related to this patch or not, although I&apos;ve seen this same test failure with another patch recently. I&apos;m not sure what&apos;s causing it, so we might want to consider committing this patch and trying to figure out the hammer test problem separately.&lt;/p&gt;

&lt;p&gt;What do you think? &lt;/p&gt;</comment>
                            <comment id="14065087" author="shralex" created="Thu, 17 Jul 2014 17:35:45 +0100"  >&lt;p&gt;Thanks for checking this. I ran the failing test locally twice and it passes. I&apos;m not sure what happened with the findBugs failure, it doesn&apos;t look related to the patch, maybe a different version of findbugs started running ? &lt;br/&gt;
if you think its ok, we could commit it.&lt;/p&gt;</comment>
                            <comment id="14065543" author="fpj" created="Thu, 17 Jul 2014 22:02:47 +0100"  >&lt;p&gt;We should get this in. The findbugs problem isn&apos;t related to this patch, and it is appearing in every patch that has been submitted in the past few days. I had a look at the findbugs report in any case and couldn&apos;t see anything related to this patch. &lt;/p&gt;</comment>
                            <comment id="14066529" author="fpj" created="Fri, 18 Jul 2014 18:04:47 +0100"  >&lt;p&gt;hey alex, would you mind cleaning up the patch a bit? There are some formatting problems and empty spaces, like:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-        HashSet&amp;lt;Long&amp;gt; set = new HashSet&amp;lt;Long&amp;gt;();
+      SyncedLearnerTracker voteSet = new SyncedLearnerTracker();
+      voteSet.addQuorumVerifier(self.getQuorumVerifier());
+      if (self.getLastSeenQuorumVerifier() != null 
+              &amp;amp;&amp;amp; self.getLastSeenQuorumVerifier().getVersion() &amp;gt; self.getQuorumVerifier().getVersion()) {
+          voteSet.addQuorumVerifier(self.getLastSeenQuorumVerifier());
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this case there are more spaces for the hashset line than the others. There are also spurious spaces like at the end of the closing curly brace above, and some empty lines with spaces across the patch.&lt;/p&gt;</comment>
                            <comment id="14066621" author="shralex" created="Fri, 18 Jul 2014 18:50:05 +0100"  >&lt;p&gt;I re-formatted (using Eclipse&apos;s formatting) the new code, and the entire ReconfigRecoveryTest. Besides that the ver7 patch is the same as ver6.&lt;/p&gt;</comment>
                            <comment id="14066706" author="hadoopqa" created="Fri, 18 Jul 2014 19:35:38 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12656544/ZOOKEEPER-1807-ver7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12656544/ZOOKEEPER-1807-ver7.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1611732.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 87 new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2199//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2199//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2199//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2199//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2199//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/2199//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14066724" author="fpj" created="Fri, 18 Jul 2014 19:49:26 +0100"  >&lt;p&gt;+1, thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;. Committed revision 1611765.&lt;/p&gt;</comment>
                            <comment id="14067486" author="hudson" created="Sat, 19 Jul 2014 12:24:17 +0100"  >&lt;p&gt;SUCCESS: Integrated in ZooKeeper-trunk #2378 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2378/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2378/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1807&quot; title=&quot;Observers spam each other creating connections to the election addr&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1807&quot;&gt;ZOOKEEPER-1807&lt;/a&gt;. Observers spam each other creating connections to the election addr (Alex Shraer via fpj) (fpj: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1611765&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1611765&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/FastLeaderElection.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/QuorumPeerTestBase.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/ReconfigRecoveryTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14069024" author="phunt" created="Mon, 21 Jul 2014 19:44:28 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;Flavio Junqueira&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt; please take a look at the recent test failure, a test introduced by this jira:&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/view/S-Z/view/ZooKeeper/job/ZooKeeper-trunk/2380/testReport/junit/org.apache.zookeeper.server.quorum/ReconfigRecoveryTest/testCurrentObserverIsParticipantInNewConfig/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/S-Z/view/ZooKeeper/job/ZooKeeper-trunk/2380/testReport/junit/org.apache.zookeeper.server.quorum/ReconfigRecoveryTest/testCurrentObserverIsParticipantInNewConfig/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14209834" author="fpj" created="Thu, 13 Nov 2014 14:31:33 +0000"  >&lt;p&gt;Reopening this issue due to test case failure&lt;/p&gt;</comment>
                            <comment id="14490056" author="rakeshr" created="Fri, 10 Apr 2015 19:21:48 +0100"  >&lt;p&gt;Any update on this issue as this issue is marked as blocker for 3.5.1.&lt;/p&gt;</comment>
                            <comment id="14490322" author="rgs" created="Fri, 10 Apr 2015 21:41:14 +0100"  >&lt;p&gt;Was the build failure transient? The build logs are gone...&lt;/p&gt;</comment>
                            <comment id="14490726" author="michim" created="Sat, 11 Apr 2015 03:20:33 +0100"  >&lt;p&gt;I haven&apos;t seen this failure for a while, but I&apos;m not sure anything was done to fix this. How about moving this to 3.5.2?&lt;/p&gt;</comment>
                            <comment id="14490810" author="michim" created="Sat, 11 Apr 2015 06:50:32 +0100"  >&lt;p&gt;i take that back, here is a failure from 2 days ago: &lt;a href=&quot;https://builds.apache.org/view/S-Z/view/ZooKeeper/job/ZooKeeper-trunk/2654/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/S-Z/view/ZooKeeper/job/ZooKeeper-trunk/2654/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14491249" author="shralex" created="Sun, 12 Apr 2015 00:05:35 +0100"  >&lt;p&gt;The test consistently passes locally for me, and I don&apos;t have access to the build machine so I&apos;m not sure how to debug this. &lt;br/&gt;
Does it fail for anyone else ?&lt;/p&gt;

&lt;p&gt;One interesting thing (although probably unrelated) is that there is &quot;Processing stat command&quot; 3000 times in the log. Are so many stat invocations expected ?&lt;/p&gt;

</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12672660">ZOOKEEPER-1783</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12612023" name="ZOOKEEPER-1807-alex.patch" size="1758" author="shralex" created="Mon, 4 Nov 2013 20:45:11 +0000"/>
                            <attachment id="12612295" name="ZOOKEEPER-1807-ver2.patch" size="10156" author="shralex" created="Wed, 6 Nov 2013 01:17:46 +0000"/>
                            <attachment id="12612635" name="ZOOKEEPER-1807-ver3.patch" size="9204" author="shralex" created="Thu, 7 Nov 2013 17:07:11 +0000"/>
                            <attachment id="12612664" name="ZOOKEEPER-1807-ver4.patch" size="10578" author="shralex" created="Thu, 7 Nov 2013 18:53:34 +0000"/>
                            <attachment id="12640553" name="ZOOKEEPER-1807-ver5.patch" size="10553" author="shralex" created="Thu, 17 Apr 2014 00:29:22 +0100"/>
                            <attachment id="12656256" name="ZOOKEEPER-1807-ver6.patch" size="24149" author="shralex" created="Thu, 17 Jul 2014 11:02:01 +0100"/>
                            <attachment id="12656544" name="ZOOKEEPER-1807-ver7.patch" size="39012" author="shralex" created="Fri, 18 Jul 2014 18:50:05 +0100"/>
                            <attachment id="12611988" name="ZOOKEEPER-1807.patch" size="12047" author="rgs" created="Mon, 4 Nov 2013 17:45:01 +0000"/>
                            <attachment id="12611999" name="notifications-loop.png" size="44936" author="rgs" created="Mon, 4 Nov 2013 18:49:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 1 Nov 2013 23:46:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>356550</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzjb7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>356838</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>