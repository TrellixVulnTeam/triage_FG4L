<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:50:27 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-425/ZOOKEEPER-425.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-425] Add OSGi metadata to zookeeper.jar</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-425</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;After adding OSGi metadata to zookeeper.jar it can be used as both an OSGi bundle as well as an ordinary jar file. &lt;br/&gt;
In the CXF/DOSGi project the buildsystem does this using the maven-bundle-plugin: &lt;a href=&quot;http://svn.apache.org/repos/asf/cxf/dosgi/trunk/discovery/distributed/zookeeper-wrapper/pom.xml&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/cxf/dosgi/trunk/discovery/distributed/zookeeper-wrapper/pom.xml&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The MANIFEST.MF generated by maven-bundle-plugin is attached to this bug, this works for the CXF/DOSGi project.&lt;br/&gt;
If your buildsystem isn&apos;t using maven, I would advise to use bnd (&lt;a href=&quot;http://www.aqute.biz/Code/Bnd&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.aqute.biz/Code/Bnd&lt;/a&gt;). BND defines its own ant task in which you should be able to use more or less the same instructions as were used in maven:&lt;br/&gt;
&amp;lt;instructions&amp;gt;&lt;br/&gt;
  &amp;lt;Bundle-Name&amp;gt;ZooKeeper bundle&amp;lt;/Bundle-Name&amp;gt;&lt;br/&gt;
  &amp;lt;Bundle-Description&amp;gt;This bundle contains the ZooKeeper library&amp;lt;/Bundle-Description&amp;gt;&lt;br/&gt;
  &amp;lt;Bundle-SymbolicName&amp;gt;org.apache.hadoop.zookeeper&amp;lt;/Bundle-SymbolicName&amp;gt;&lt;br/&gt;
  &amp;lt;Bundle-Version&amp;gt;3.1.1&amp;lt;/Bundle-Version&amp;gt;&lt;br/&gt;
  &amp;lt;Import-Package&amp;gt;*&amp;lt;/Import-Package&amp;gt;&lt;br/&gt;
  &amp;lt;Export-Package&amp;gt;*;version=3.1.1&amp;lt;/Export-Package&amp;gt;&lt;br/&gt;
&amp;lt;/instructions&amp;gt;&lt;/p&gt;

&lt;p&gt;Oh and one other thing. Is it really necessary to put the source code in the Jar file too? I would put that in a separate source distribution &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;See also: &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/hadoop-zookeeper-user/200905.mbox/%3c4A2009B1.3030603@yahoo-inc.com%3e&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/hadoop-zookeeper-user/200905.mbox/%3c4A2009B1.3030603@yahoo-inc.com%3e&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12426928">ZOOKEEPER-425</key>
            <summary>Add OSGi metadata to zookeeper.jar</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bosschaert">David Bosschaert</assignee>
                                    <reporter username="bosschaert">David Bosschaert</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Jun 2009 15:28:22 +0100</created>
                <updated>Thu, 2 May 2013 03:29:22 +0100</updated>
                            <resolved>Thu, 26 Nov 2009 13:37:28 +0000</resolved>
                                                    <fixVersion>3.3.0</fixVersion>
                                    <component>build</component>
                        <due></due>
                            <votes>6</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="12715540" author="bosschaert" created="Tue, 2 Jun 2009 15:29:49 +0100"  >&lt;p&gt;The manifest generated by the CXF/DOSGi build system.&lt;/p&gt;</comment>
                            <comment id="12776532" author="bosschaert" created="Wed, 11 Nov 2009 17:41:48 +0000"  >&lt;p&gt;I&apos;ll also have a look at how to run the zookeeper server in OSGi.&lt;/p&gt;</comment>
                            <comment id="12776538" author="breed" created="Wed, 11 Nov 2009 17:58:56 +0000"  >&lt;p&gt;sorry i didn&apos;t notice this sooner. this is a great idea, and certainly reasonable. i think the import and export packages statement is incorrect. we should list the exact dependencies.&lt;/p&gt;</comment>
                            <comment id="12776548" author="bosschaert" created="Wed, 11 Nov 2009 18:06:53 +0000"  >&lt;p&gt;Hi Benjamin. Did you actually take a look at the attached MANIFEST.MF? Are the import and export statements in there correct? What is in the XML above is just the maven-bundle-plugin/BND instructions to create the exact list by introspection &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
If you think it would be better to explicitly list everything when creating the manifest, please state what you would like to see in there.&lt;/p&gt;</comment>
                            <comment id="12776592" author="phunt" created="Wed, 11 Nov 2009 19:24:47 +0000"  >&lt;p&gt;A dumb q: adding this to the manifest of the zk jar will have no effect on non-osgi containers (etc...) correct?&lt;/p&gt;

&lt;p&gt;Also, re the original question &quot;Is it really necessary to put the source code in the Jar file too&quot;:&lt;br/&gt;
  notice that in the trunk we have changed things a bit since this jira was created. We still have&lt;br/&gt;
  the original jar which includes sources, but we also have an additional binary only jar (class files) in addition&lt;br/&gt;
  to separate source and javadoc jars. You will see this in the &quot;package&quot; target of the latest build.xml&lt;br/&gt;
  This was added for Maven &amp;#8211; we should be sure to include the manifest changes to those jars&lt;br/&gt;
  (just the jars containing class files  I guess?)&lt;/p&gt;</comment>
                            <comment id="12776610" author="breed" created="Wed, 11 Nov 2009 19:47:09 +0000"  >&lt;p&gt;right these are osgi specific tags that will get ignored normally.&lt;/p&gt;</comment>
                            <comment id="12776614" author="breed" created="Wed, 11 Nov 2009 19:52:04 +0000"  >&lt;p&gt;oh sorry david. so i still have the same concern with the full manifest.mf, but before that i was wondering: are you trying to provide the bundle so that other bundles can use zookeeper or so that the bundle can start up a zookeeper server?&lt;/p&gt;

&lt;p&gt;most of the packages imported and exported are internal to zookeeper and should be kept private. if we want to just provide access to the client API we should just list org.apache.zookeeper and org.apache.zookeeper.data (possibly org.apache.zookeeper.version). we should also use the script to set the version rather than hard code it. if you want to start the server, we should really have a separate package with just the classes/interfaces needed to manage a server instance and export that.&lt;/p&gt;

&lt;p&gt;the only import we need is log4j. is there already a standard log4j bundle?&lt;/p&gt;</comment>
                            <comment id="12777017" author="bosschaert" created="Thu, 12 Nov 2009 15:23:17 +0000"  >&lt;p&gt;Hi Benjamin, that helps. I&apos;ll play around with that explicit subset.&lt;br/&gt;
What I really need is both. Provide client access to the Zookeeper API, but also a way to start the server. To do that we may not have to expose those server classes at all. One thing we could do is add an activator to the zookeeper jar and have it use the OSGI Configuration Admin to control the zookeeper server. It should be possible to do this without changing it being a plain jar too.&lt;br/&gt;
Anyway - I&apos;ll try to find some time over the next while to play with this and will let you know how far I get.&lt;/p&gt;</comment>
                            <comment id="12779994" author="bosschaert" created="Thu, 19 Nov 2009 14:04:37 +0000"  >&lt;p&gt;The attached patch (named zk_patch3.patch) implements some of the functionality. Its not fully finished yet, I&apos;m attaching it at this point to get some feedback.&lt;/p&gt;

&lt;p&gt;The patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Adds the OSGi Metadata to the MANIFEST.MF&lt;/li&gt;
	&lt;li&gt;Can be used as just a library bundle if you want to write a zookeeper client in another OSGi bundle.&lt;/li&gt;
	&lt;li&gt;Can be used to run the zookeeper server. To do this the server has to be configured. Configuration is handled through the OSGi Configuration Admin service. The bundle has an optional dependency on this service and registers an org.osgi.service.cm.ManagedService service to be configured by CM. The PID for this service is org.apache.zookeeper and all of the configuration variables are the same as in the non-OSGi zoo.cfg file (it uses the same ServerConfig class to handle them).&lt;br/&gt;
All configuration properties have defaults provided, except for the &apos;clientPort&apos; one, which has to be provided through Config Admin. For the data directory the OSGi Bundle-private storage directory is used by default.&lt;/li&gt;
	&lt;li&gt;The jar has an OSGi BundleActivator class, which will be triggered if run on an OSGi framework.&lt;/li&gt;
	&lt;li&gt;BTW the zookeeper.jar stil also works as a POJ (plain old Jar &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;note that I updated the ivy.xml file to pull in two OSGi jars that are needed at build time. However they don&apos;t need to be redistributed with the zookeeper jar as they are provided by the OSGi framework.&lt;/p&gt;

&lt;p&gt;There are still a few open questions that I have:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;In OSGi things should really be (re)configurable at runtime. This means that the Configuration Admin Service may call your ManagedService.updated() callback with changed properties at any time. I guess the easiest (but not necessarily the most elegant) way to handle this is by taking down the ZooKeeperServerMain and relaunching it with the modified properties. ZooKeeperServerMain has a shutdown() method that I could use for this. Would that be the best idea?&lt;/li&gt;
	&lt;li&gt;I&apos;m not (yet) familiar with the cluster setup and am wondering whether the configuration approach that I took also works in that case.&lt;br/&gt;
I also intend to provide some unit tests before closing this off.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;BTW I haven&apos;t gone into detail how the OSGi Configuration Admin service typically works. Let me know if I need to provide more info on that.&lt;/p&gt;</comment>
                            <comment id="12780001" author="maguro" created="Thu, 19 Nov 2009 14:32:02 +0000"  >&lt;p&gt;I would like to be informed when the Zookeeper service is started/stopped in the OSGi framework so that I can perform some &quot;extender&quot; like tasks in tandem.  Would it be a good idea to publish a management interface to the service registry when Zookeeper is started by the &lt;tt&gt;ManagedService&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="12780012" author="bosschaert" created="Thu, 19 Nov 2009 14:46:11 +0000"  >&lt;p&gt;Hi Alan, that sounds like a useful idea to me and using a service in the OSGi Service Registry sounds like a really good approach but I personally think that this should be a separate bug/enhancement. Let&apos;s get the basics working first &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12780024" author="maguro" created="Thu, 19 Nov 2009 15:19:24 +0000"  >&lt;p&gt;Sure.  I saw that we were adding a bundle activator and deployment via Configuration Admin Service so I wasn&apos;t sure where we were drawing the line here.  Issue added.&lt;/p&gt;</comment>
                            <comment id="12780219" author="breed" created="Thu, 19 Nov 2009 19:27:37 +0000"  >&lt;p&gt;david, nice work. i think we should break this patch into possibly three parts:&lt;/p&gt;

&lt;p&gt;1) manifest update to just export the right packages&lt;br/&gt;
2) an activator that registers a ZooKeeper object as a service. (this would be a client object)&lt;br/&gt;
3) an activator that starts up a server.&lt;/p&gt;

&lt;p&gt;you seem to be ignoring 2). it might be useful to have the bundles of an osgi framework share a ZooKeeper object. maybe not though. sharing makes it nice to get a preconfigured connected ZooKeeper object from the service registry.&lt;/p&gt;

&lt;p&gt;we can&apos;t really support 3) properly right now. it is possible to shutdown a server and start it back up. the interfaces aren&apos;t very well exposed but the tests do it. a bigger problem is that we have System.exits in our code, and even if the bundle doesn&apos;t have permission to call System.exit, not exiting can cause bad things to happen.&lt;/p&gt;

&lt;p&gt;i would suggest focusing this issue on 1) and possibly 2), but leave 3) for a separate issue.&lt;/p&gt;</comment>
                            <comment id="12780227" author="phunt" created="Thu, 19 Nov 2009 19:39:08 +0000"  >&lt;p&gt;1) would go into build.xml&lt;/p&gt;

&lt;p&gt;2) &amp;amp; 3) would be in a contrib package, correct? src/contrib/osgi &amp;#8211; or is this stuff typically implementation&lt;br/&gt;
specific such as src/contrib/felix ? (assuming not the latter)&lt;/p&gt;</comment>
                            <comment id="12780278" author="bosschaert" created="Thu, 19 Nov 2009 21:34:33 +0000"  >&lt;p&gt;Let me explain the context of my work. For the OSGi Remote Services Admin Service (an OSGi specification based on the Distributed OSGi RFC 119 work) we are working on the Reference Implementation in CXF (&lt;a href=&quot;http://cxf.apache.org/distributed-osgi.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://cxf.apache.org/distributed-osgi.html&lt;/a&gt;). The Reference Implementation supports the Discovery concepts of the Remote Service specification and for the implementation we make use of ZooKeeper.&lt;/p&gt;

&lt;p&gt;In our code, we use zookeeper in two ways: &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;In zookeeper client code. This code resides in bundles that import the org.apache.zookeeper and org.apache.zookeeper.data&lt;/li&gt;
	&lt;li&gt;We also need to be able to run the zookeeper server from inside an OSGi bundle&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So this is really cases 1 &amp;amp; 3 above.&lt;/p&gt;

&lt;p&gt;I think we all agree on 1, and I can certainly put that in a separate patch.&lt;/p&gt;

&lt;p&gt;On part 2 - this is the one that Alan filed &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-584&quot; title=&quot;ZooKeeper service instance should be registered in the OSGi registry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-584&quot;&gt;ZOOKEEPER-584&lt;/a&gt; for, right? This is a case that I don&apos;t need at this point, and therefore I probably don&apos;t understand what the best way to realize it is. I understand that this can be quite useful and registering a &apos;trivial&apos; zookeeper object in the service registry is easy, but I guess what Alan is really looking for is an object from which he can get some management information. I really see this as a separate issue and one possibly best solved by someone who actually has a need for this.&lt;/p&gt;

&lt;p&gt;The code that I attached does address part 3 somewhat, although I agree that it could be better. However it&apos;s a start. The zookeeper server starts and can be configured. I can try to make the shutdown/restart on reconfiguration work as well. I haven&apos;t been troubled by the System.exits() yet. It works well enough for me at the moment, although it could be improved. Could we not do the improvement over time in the future, starting off with something that works a bit like in my patch and then making it better over time?&lt;/p&gt;

&lt;p&gt;Patrick, on your comment re a contrib package. First of all the code is not specific to an osgi container and should work equally in all osgi frameworks. Do you mean just putting the source code in a separate location or are you also thinking of putting it in a separate jar file? I would suggest putting the Activator and ManagedService in the ordinary zookeeper.jar. Outside of an OSGi framework these classes are simply ignored, but when the jar is used as an OSGi bundle they are automatically found and used. If you put it in a separate jar you will have to deploy 2 bundles before you can run the zookeeper server in an OSGi framework, which is possible but you&apos;d have to export org.apache.zookeeper.server which is currently internal to make it work. Besides these two classes are currently only about 5kb in total.&lt;/p&gt;</comment>
                            <comment id="12781369" author="bosschaert" created="Mon, 23 Nov 2009 11:34:33 +0000"  >&lt;p&gt;The patch named &apos;buildxmlpatch.patch&apos; contains changes to the build.xml to cover case 1.&lt;/p&gt;

&lt;p&gt;It does an export-package of &lt;br/&gt;
  org.apache.zookeeper.server&lt;br/&gt;
  org.apache.zookeeper.server.quorum&lt;br/&gt;
to make it possible to launch the server process from a separate bundle. &lt;/p&gt;

&lt;p&gt;If the general feeling is that the Zookeeper codebase isn&apos;t ready for case 3, I&apos;m happy to host my Activator/ManageService elsewhere until it is ready for it.&lt;/p&gt;</comment>
                            <comment id="12781441" author="maguro" created="Mon, 23 Nov 2009 16:00:29 +0000"  >&lt;p&gt;Just curious, no &quot;uses&quot; clauses?&lt;/p&gt;</comment>
                            <comment id="12781445" author="bosschaert" created="Mon, 23 Nov 2009 16:10:15 +0000"  >&lt;p&gt;Yes, I agree that it would be better to put uses clauses on the Export-Package declaration. However, you really need a tool such as BND (&lt;a href=&quot;http://www.aqute.biz/Code/Bnd&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.aqute.biz/Code/Bnd&lt;/a&gt;) (or the maven-bundle-plugin which uses bnd) to generate these for you. Putting them in by hand is hard, error prone and difficult to maintain (IMHO). &lt;/p&gt;

&lt;p&gt;I already mention BND in the patch and would be happy to update it to get ant to use BND if people think this would be good. We can then let BND generate the uses clauses for us.&lt;/p&gt;</comment>
                            <comment id="12781578" author="hadoopqa" created="Mon, 23 Nov 2009 19:43:48 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12425830/buildxmlpatch.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12425830/buildxmlpatch.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 882744.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no tests are needed for this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/74/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/74/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/74/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/74/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/74/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/74/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12781843" author="bosschaert" created="Tue, 24 Nov 2009 09:55:31 +0000"  >&lt;p&gt;Wow - that&apos;s excellent! An automated patch review process!&lt;br/&gt;
This patch only contains additional attributes to the zookeeper.jar file. The best way to write tests for them will be as part of a system test that&apos;s using the jar as a bundle in a real OSGi container. Does the zookeeper infrastructure have such an area?&lt;/p&gt;

&lt;p&gt;Another way to write tests would simply be to check that the headers are there. This would be easier to do, but it would require that the tests can expect the zookeeper.jar file in a well-known location. For this the jar has to be created before those tests are run. Is there such a phase in the zookeeper build system?&lt;/p&gt;</comment>
                            <comment id="12782018" author="maguro" created="Tue, 24 Nov 2009 16:41:15 +0000"  >&lt;p&gt;Why not use PAX Exam?&lt;/p&gt;</comment>
                            <comment id="12782045" author="breed" created="Tue, 24 Nov 2009 17:30:15 +0000"  >&lt;p&gt;+1 to commit. no need for tests in this case. once we do the activator we will need test for that which will also cover the meta data as well. (the automatic testing is cool though isn&apos;t it?) unless there are any objections i think this is ready to commit.&lt;/p&gt;</comment>
                            <comment id="12782053" author="phunt" created="Tue, 24 Nov 2009 17:35:55 +0000"  >&lt;p&gt;Just to summarize - what&apos;s being applied here (patch)? Just buildxmlpatch.patch and nothing else (the other attachments are obsolete?)&lt;/p&gt;

&lt;p&gt;I agree that no new test is necessary, but it would be interesting to know how to try this out. Is there a way to load this into something like Apache Felix yet, or does that have to wait for the follow-on jira? (I would suggest - please create one and link it to this jira)&lt;/p&gt;</comment>
                            <comment id="12782058" author="breed" created="Tue, 24 Nov 2009 17:46:42 +0000"  >&lt;p&gt;yes just the buildxml.patch, the service instance will be registered in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-584&quot; title=&quot;ZooKeeper service instance should be registered in the OSGi registry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-584&quot;&gt;ZOOKEEPER-584&lt;/a&gt; and we will need to pull in felix for that test. i would think that the activator for &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-584&quot; title=&quot;ZooKeeper service instance should be registered in the OSGi registry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-584&quot;&gt;ZOOKEEPER-584&lt;/a&gt; will go into a contrib and will will build its own little jar file. that way we only need to pull in felix for the contrib not for the whole of zookeeper.&lt;/p&gt;</comment>
                            <comment id="12782351" author="bosschaert" created="Wed, 25 Nov 2009 10:14:49 +0000"  >&lt;p&gt;Hi Patrick,&lt;/p&gt;

&lt;p&gt;You can already use this as-is in Felix or Equinox (or any other OSGi container). The value that the metadata in the buildxml.patch provides is that it exports (and imports) packages the OSGi way, which means that you can build a zookeeper client in its own bundle that pulls in the zookeeper classes using OSGi dependency management.&lt;/p&gt;

&lt;p&gt;Here&apos;s a quick example of how to use it (using Felix 2.0.0):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;.../felix-framework-2.0.0&amp;gt;java -jar bin/felix.jar

Welcome to Felix
================

-&amp;gt; start http:&lt;span class=&quot;code-comment&quot;&gt;//www.springsource.com/repository/app/bundle/version/download?name=com.springsource.org.apache.log4j&amp;amp;version=1.2.15&amp;amp;type=binary
&lt;/span&gt;Bundle ID: 4
-&amp;gt; start file:&lt;span class=&quot;code-comment&quot;&gt;///.../zookeeper/build/zookeeper-3.3.0.jar
&lt;/span&gt;-&amp;gt; ps
START LEVEL 1
   ID   State         Level  Name
[   0] [Active     ] [    0] &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt; Bundle (2.0.0)
[   1] [Active     ] [    1] Apache Felix Bundle Repository (1.4.1)
[   2] [Active     ] [    1] Apache Felix Shell Service (1.4.0)
[   3] [Active     ] [    1] Apache Felix Shell TUI (1.4.0)
[   4] [Active     ] [    1] Apache Log4J (1.2.15)
[   5] [Active     ] [    1] ZooKeeper Bundle (3.3.0)

-&amp;gt; inspect &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; requirement 5
org.apache.hadoop.zookeeper [5] imports packages:
-------------------------------------------------
org.osgi.framework; version=1.5.0 -&amp;gt; org.apache.felix.framework [0]
org.osgi.util.tracker; version=1.4.0 -&amp;gt; org.apache.felix.framework [0]
javax.management; version=1.6.0 -&amp;gt; org.apache.felix.framework [0]
org.apache.log4j; version=1.2.15 -&amp;gt; com.springsource.org.apache.log4j [4]

-&amp;gt; inspect &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; capability 5
org.apache.hadoop.zookeeper [5] exports packages:
-------------------------------------------------
org.apache.zookeeper; version=3.3.0
org.apache.zookeeper.data; version=3.3.0
org.apache.zookeeper.version; version=3.3.0
org.apache.zookeeper.server; version=3.3.0
org.apache.zookeeper.server.quorum; version=3.3.0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As you can see the Log4J dependency is provided through a Log4J bundle. I&apos;m using one straight from the SpringSource bundle repository (the SpringSource guys have turned many libraries into OSGi bundles), but you may also be able to find a Log4J bundle elsewhere.&lt;br/&gt;
After installing the Zookeeper Bundle (the jar is now also an OSGi bundle) you can see that it uses OSGi imports to satisfy its dependencies (e.g. it links to bundle 4 for its log4j imports) and it exports the zookeeper packages. The way to use them in OSGi-based clients is simply through imports (as &lt;a href=&quot;http://svn.apache.org/repos/asf/cxf/dosgi/trunk/discovery/distributed/cxf-discovery/src/main/java/org/apache/cxf/dosgi/discovery/zookeeper/FindInZooKeeperCustomizer.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;here&lt;/a&gt;), but additionally the client bundle will have Import-Package statements for the zookeeper packages in its manifest.&lt;/p&gt;</comment>
                            <comment id="12782895" author="breed" created="Thu, 26 Nov 2009 13:37:28 +0000"  >&lt;p&gt;Committed revision 884554.&lt;br/&gt;
thank you david!&lt;/p&gt;</comment>
                            <comment id="12783621" author="hudson" created="Mon, 30 Nov 2009 11:39:35 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #558 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/558/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/558/&lt;/a&gt;)&lt;/p&gt;
</comment>
                            <comment id="12859697" author="ccustine" created="Thu, 22 Apr 2010 08:32:38 +0100"  >&lt;p&gt;As of 3.3.0, I see the OSGI meta data in the tar.gz download from the Apache mirrors, but it is not in the zookeeper-3.3.0.jar artifact that is deployed to the maven central repository here:  &lt;a href=&quot;http://repo2.maven.org/maven2/org/apache/hadoop/zookeeper/3.3.0/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://repo2.maven.org/maven2/org/apache/hadoop/zookeeper/3.3.0/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12859894" author="phunt" created="Thu, 22 Apr 2010 17:56:02 +0100"  >&lt;p&gt;Chris thanks for the report, new jira created to address: &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-749&quot; title=&quot;OSGi metadata not included in binary only jar&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-749&quot;&gt;&lt;del&gt;ZOOKEEPER-749&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12462783">ZOOKEEPER-749</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12441199">ZOOKEEPER-584</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12409667" name="MANIFEST.MF" size="3826" author="bosschaert" created="Tue, 2 Jun 2009 15:29:49 +0100"/>
                            <attachment id="12425830" name="buildxmlpatch.patch" size="1806" author="bosschaert" created="Mon, 23 Nov 2009 11:34:33 +0000"/>
                            <attachment id="12425484" name="zk_patch3.patch" size="9940" author="bosschaert" created="Thu, 19 Nov 2009 14:04:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 11 Nov 2009 17:58:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47828</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzxwn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33477</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>osgi</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>