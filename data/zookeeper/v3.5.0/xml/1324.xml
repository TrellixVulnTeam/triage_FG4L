<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:50:01 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1324/ZOOKEEPER-1324.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1324] Remove Duplicate NEWLEADER packets from the Leader to the Follower.</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1324</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description></description>
                <environment></environment>
        <key id="12534519">ZOOKEEPER-1324</key>
            <summary>Remove Duplicate NEWLEADER packets from the Leader to the Follower.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fpj">Flavio Junqueira</assignee>
                                    <reporter username="mahadev">Mahadev konar</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Dec 2011 18:39:17 +0000</created>
                <updated>Thu, 13 Mar 2014 18:17:02 +0000</updated>
                            <resolved>Tue, 14 May 2013 13:29:13 +0100</resolved>
                                    <version>3.5.0</version>
                                    <fixVersion>3.4.6</fixVersion>
                    <fixVersion>3.5.0</fixVersion>
                                    <component>quorum</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                <comments>
                            <comment id="13543358" author="thawan" created="Thu, 3 Jan 2013 22:26:52 +0000"  >&lt;p&gt;no-whitespace-changes version of the patch (so indentation may not be correct)&lt;/p&gt;</comment>
                            <comment id="13543362" author="thawan" created="Thu, 3 Jan 2013 22:30:47 +0000"  >&lt;p&gt;The same patch but with the whitespace changes (by Eclipse)&lt;/p&gt;</comment>
                            <comment id="13543365" author="thawan" created="Thu, 3 Jan 2013 22:32:56 +0000"  >&lt;p&gt;I was tracking down why I saw some followers taking snapshot 2 times during quorum forming and found that this is the problem. The fix is according to what Flavio suggested in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1319&quot; title=&quot;Missing data after restarting+expanding a cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1319&quot;&gt;&lt;del&gt;ZOOKEEPER-1319&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13543395" author="thawan" created="Thu, 3 Jan 2013 22:59:42 +0000"  >&lt;p&gt;version with the right whitespace&lt;/p&gt;</comment>
                            <comment id="13543411" author="hadoopqa" created="Thu, 3 Jan 2013 23:29:35 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12563186/ZOOKEEPER-1324.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12563186/ZOOKEEPER-1324.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1427034.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1319//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1319//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1319//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1319//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1319//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1319//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13543521" author="eribeiro" created="Fri, 4 Jan 2013 02:02:32 +0000"  >&lt;p&gt;Thawan, have you looked at &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1498&quot; title=&quot;Zab1.0 sends NEWLEADER packet twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1498&quot;&gt;&lt;del&gt;ZOOKEEPER-1498&lt;/del&gt;&lt;/a&gt;? It seems to be a duplicate of this issue. See if it&apos;s okay to mark it as duplicate, please?&lt;/p&gt;</comment>
                            <comment id="13545541" author="fpj" created="Mon, 7 Jan 2013 00:48:24 +0000"  >&lt;p&gt;I understand I suggested this solution previously, but I find a bit hacky. Let me think some more about this and see if I can come up with something better. It would be great if we could just use the one the leader is queuing already. In the case we end up committing this patch, I suggest we add a comment explaining why we have that if statement. Otherwise, in the future, we might end up wondering what it is doing there.&lt;/p&gt;</comment>
                            <comment id="13546887" author="fpj" created="Tue, 8 Jan 2013 13:41:01 +0000"  >&lt;p&gt;What about this change? I still need to clean up the patch, so it is not final yet, but the change I&apos;m proposing can be reviewed.&lt;/p&gt;</comment>
                            <comment id="13547301" author="thawan" created="Tue, 8 Jan 2013 21:35:52 +0000"  >&lt;p&gt;I understand the fact that you want to treat NEWLEADER like another proposal and reuse existing facility to handle it. However, treating this like a normal proposal also comes with some issues.&lt;br/&gt;
1. Currently procesAck() have to a special logic to handle NEWLEADER proposal, it need to start up ZK server&lt;br/&gt;
2. We are sending NEWLEADER proposal implicitly as part of sending outstanding proposals to the learners. Now you have to keep adding NEWLEADER back into outstanding proposals whenever a new learner joins the quorum since it is removed whenever NEWLEADER packet is committed.&lt;br/&gt;
3. There is no need to for observers to see outstanding proposals. This is minor optimization, but we don&apos;t send outstanding proposals to the observer in startForwarding() in our internal branch. &lt;/p&gt;

&lt;p&gt;If we really want to clean this up, I suggested that we do it another way around. I think queuing NEWLEADER packet into the packet queue explicitly make the code easier to follow. Additional, we may factor out NEWLEADER to use its own method for collecting the votes similar to waitForEpochAck(), so that we don&apos;t overload processAck() and outstanding proposals to do multiple things. Let me know what you think&lt;/p&gt;</comment>
                            <comment id="13547355" author="fpj" created="Tue, 8 Jan 2013 22:35:25 +0000"  >&lt;p&gt;Having a different method for collecting the ack and not overloading processAck sounds great. On adding NEWLEADER to the packet queue, I need a confirmation to make sure I understand your proposal. I think you&apos;re suggesting that we replace adding a new leader proposal to outstandingProposals in #lead() with a barrier method that waits for enough acks to return, but we keep adding NEWLEADER to the queue in LearnerHandler as we have today.&lt;/p&gt;</comment>
                            <comment id="13549144" author="thawan" created="Wed, 9 Jan 2013 22:52:29 +0000"  >&lt;p&gt;This is the first revision of the fix. Below are some thought about the diff&lt;/p&gt;

&lt;p&gt;1. This change also prevent the leader from counting Observer&apos;s NEWLEADER_ACK causing the quorum to form prematurely. I will submit a unit test in a separate jira&lt;/p&gt;

&lt;p&gt;2. I just noticed that the learner send ACK back to leader for both NEWLEADER and UPTODATE. I don&apos;t think UPTODATE&apos;s ack is part of the protocol, but didn&apos;t want to change it&lt;/p&gt;

&lt;p&gt;3. After LearnerHandler call waitForNewLeaderAck(), it still wait and check if ZK server is started or not. I don&apos;t think we need that check anymore but it doesn&apos;t hurt to leave it as well. &lt;/p&gt;</comment>
                            <comment id="13549163" author="hadoopqa" created="Wed, 9 Jan 2013 23:07:16 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12564047/ZOOKEEPER-1324.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12564047/ZOOKEEPER-1324.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1427034.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1327//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1327//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1327//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1327//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1327//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1327//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13549198" author="thawan" created="Wed, 9 Jan 2013 23:44:05 +0000"  >&lt;p&gt;Fix findbugs warning and check that NEWLEADER&apos;s ACK is from the correct epoch&lt;/p&gt;</comment>
                            <comment id="13549219" author="fpj" created="Thu, 10 Jan 2013 00:12:24 +0000"  >&lt;p&gt;It looks pretty good, Thawan, thanks for coming up with it fast. &lt;/p&gt;

&lt;p&gt;I was planning on removing that ack in learner handler after receiving UPTODATE. I believe it is there for backward compatibility with the 3.3 branch. &lt;/p&gt;

&lt;p&gt;I was also wondering about the synchronization of startZKServer. That whole block of code was previously synchronized in processAck, but if I&apos;m reading it right only lastCommitted can have concurrent accesses in that block, is it right?  &lt;/p&gt;</comment>
                            <comment id="13549224" author="hadoopqa" created="Thu, 10 Jan 2013 00:16:57 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12564058/ZOOKEEPER-1324.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12564058/ZOOKEEPER-1324.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1427034.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1328//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1328//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1328//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1328//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1328//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1328//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13549267" author="thawan" created="Thu, 10 Jan 2013 01:22:01 +0000"  >&lt;p&gt;synchronization of lastCommitted is based on findbugs warning. &lt;/p&gt;

&lt;p&gt;My understanding is that leader object is used to lock the entire request processing pipeline. So it might be safer to do synchronized the entire method in order to guarantee that lastCommitted and DB&apos;s zxid is set atomically when the server start (and the system start processing request).  &lt;/p&gt;</comment>
                            <comment id="13549345" author="thawan" created="Thu, 10 Jan 2013 04:01:09 +0000"  >&lt;p&gt;Fix synchronization and print list of supporting followers when quorum is formed&lt;/p&gt;</comment>
                            <comment id="13549348" author="hadoopqa" created="Thu, 10 Jan 2013 04:27:09 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12564118/ZOOKEEPER-1324.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12564118/ZOOKEEPER-1324.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1427034.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1329//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1329//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1329//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1329//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1329//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1329//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13550454" author="fpj" created="Thu, 10 Jan 2013 21:38:18 +0000"  >&lt;p&gt;Thanks, Thawan. +1, it looks good to me.&lt;/p&gt;</comment>
                            <comment id="13554357" author="fpj" created="Tue, 15 Jan 2013 21:14:11 +0000"  >&lt;p&gt;Committed revision 1433651.&lt;/p&gt;</comment>
                            <comment id="13554937" author="hudson" created="Wed, 16 Jan 2013 11:00:16 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #1804 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/1804/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/1804/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1324&quot; title=&quot;Remove Duplicate NEWLEADER packets from the Leader to the Follower.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1324&quot;&gt;&lt;del&gt;ZOOKEEPER-1324&lt;/del&gt;&lt;/a&gt;. Remove Duplicate NEWLEADER packets from the Leader to the Follower. (thawan via fpj) (Revision 1433651)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
fpj : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1433651&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1433651&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Leader.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/LearnerHandler.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/Zab1_0Test.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13555805" author="shralex" created="Thu, 17 Jan 2013 03:27:50 +0000"  >&lt;p&gt;Hi Thawan, Flavio and Patrick.&lt;/p&gt;

&lt;p&gt;Unfortunately, this patch (committed yesterday) creates a big problem for me. In order to merge ZK-107 with it I basically need to re-implement ZK-1324, and I don&apos;t feel I&apos;m the expert on ZK-1324. Since ZK-107 is a much much bigger patch, and since it is ready to be committed for months now, I suggest to roll back ZK-1324, commit ZK-107 and have ZK-1324 re-implemented on top by someone who understand what this patch is about. I&apos;m really sorry about this Thawan, its not your fault, and I can help re-implementing it, I just think that playing continuous catchup having me re-implement such subtle code committed by others like in ZK-1324 is a very bad idea...&lt;/p&gt;

&lt;p&gt;Best Regards,&lt;br/&gt;
Alex&lt;/p&gt;</comment>
                            <comment id="13556035" author="fpj" created="Thu, 17 Jan 2013 10:15:09 +0000"  >&lt;p&gt;Hi Alex,&lt;/p&gt;

&lt;p&gt;This is indeed kind of unfortunate. I gave it a number of days between +1&apos;ing it and committing so that people could also review and comment. No one did, so I committed it. In general, I agree that you don&apos;t have to understand what every single patch that touches zk core does in detail, but it would be great if you could scan the list for issues that could affect &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-107&quot; title=&quot;Allow dynamic changes to server cluster membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-107&quot;&gt;&lt;del&gt;ZOOKEEPER-107&lt;/del&gt;&lt;/a&gt; and flag it by linking the jiras. There are other jiras coming that could affect &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-107&quot; title=&quot;Allow dynamic changes to server cluster membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-107&quot;&gt;&lt;del&gt;ZOOKEEPER-107&lt;/del&gt;&lt;/a&gt;, like &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1549&quot; title=&quot;Data inconsistency when follower is receiving a DIFF with a dirty snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1549&quot;&gt;ZOOKEEPER-1549&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1551&quot; title=&quot;Observers ignore txns that come after snapshot and UPTODATE &quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1551&quot;&gt;&lt;del&gt;ZOOKEEPER-1551&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1552&quot; title=&quot;Enable sync request processor in Observer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1552&quot;&gt;&lt;del&gt;ZOOKEEPER-1552&lt;/del&gt;&lt;/a&gt;, so we need to keep it in mind. We haven&apos;t been doing a good job with marking the components that jiras affect, so I&apos;ll try to be more careful about that.&lt;/p&gt;

&lt;p&gt;I&apos;d rather not revert this patch, but I&apos;d say that we can help you port the patch. If Thawan doesn&apos;t have the time, I&apos;ll help you out. &lt;/p&gt;</comment>
                            <comment id="13556150" author="shralex" created="Thu, 17 Jan 2013 13:12:32 +0000"  >&lt;p&gt;Hi Flavio,&lt;/p&gt;

&lt;p&gt;You&apos;re right, I should have paid closer attention. But I actually did notice this JIRA and wrote Patrick about two weeks ago that I&apos;m concerned about several JIRAs touching the same code as ZK-107 and that we should commit ZK-107 ASAP. At some point I think we need a lock/freeze on significant other changes to commit ZK-107, otherwise its an endless catch-up.&lt;/p&gt;

&lt;p&gt;Regarding this specific patch. I&apos;m not sure what it means to &quot;port the patch&quot;. The code in Leader.java and a few other files that is changed by ZK-1324 was restructured and then modified in subtle ways ZK-107. I really believe that the easiest and cleanest way to merge is to have ZK-107 as a starting point and implement ZK-1324 relative to it (on top of it), and not the other way. It is of course possible that Thawan or you do that on your local machine (you can use the latest ZK-107 patch) but then the re-implementation of ZK-1324 will be part of ZK-107. I think this is not a good solution, since ZK-1324 will be spread across two JIRAs and it will be difficult to find problems later In both these JIRAs. &lt;/p&gt;

&lt;p&gt;Alex&lt;/p&gt;</comment>
                            <comment id="13556233" author="fpj" created="Thu, 17 Jan 2013 14:53:28 +0000"  >&lt;p&gt;You should have written on the jira directly instead of going through a private channel with Pat. I&apos;m of course aware of your effort, but it is easy to forget when it is not marked explicitly in the jira. Let me also say that if we had created a 107 branch as I suggested a while back, we could be marking jiras to produce versions of the patches for that branch. &lt;/p&gt;

&lt;p&gt;As for what to do now, I&apos;m not sure what the best course of action is. I don&apos;t like the idea of reverting the commit, but at the same time I feel bad about giving you more work to do. I&apos;d like to hear what the others involved in this discussion have to say about it.&lt;/p&gt;

</comment>
                            <comment id="13556477" author="thawan" created="Thu, 17 Jan 2013 19:04:48 +0000"  >&lt;p&gt;I skim through ZK-107 and I think the core logic that this patch try to fix doesn&apos;t conflict with ZK-107, but I guess it would need a rewrite. I am fine with any approach, we can also move this patch down to 3.4 and recreate a jira/patch to fix this again in 3.5 &lt;/p&gt;</comment>
                            <comment id="13556672" author="phunt" created="Thu, 17 Jan 2013 22:32:52 +0000"  >&lt;p&gt;Alex (et. al.) - how close is 107 to being ready for commit? If it&apos;s still a ways off then reverting this one patch isn&apos;t going to help much in the grander scheme of things.&lt;/p&gt;

&lt;p&gt;Thawan/Flavio - If we revert 1324 then apply 107 how much work is it to get 1324 patch working again? Based on Thawan&apos;s comments it doesn&apos;t seem like it&apos;s too big an issue for you to do.&lt;/p&gt;</comment>
                            <comment id="13556689" author="shralex" created="Thu, 17 Jan 2013 22:46:08 +0000"  >&lt;p&gt;Hi Patrick, IMHO 107 is pretty much ready for commit. Michi is working on the missing C tests, and I&apos;m meeting him this weekend to try to finish this together. So hopefully next week its going to be completely ready. We also need to commit ZK-1620 so that my tests pass. &lt;/p&gt;</comment>
                            <comment id="13556764" author="fpj" created="Thu, 17 Jan 2013 23:45:19 +0000"  >&lt;p&gt;Just to review what I&apos;m reading here:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;No one is against reverting and Alex strongly prefers reverting, so we&apos;ll do it, yes?&lt;/li&gt;
	&lt;li&gt;This jira is not marked for 3.4.6, but Thawan mentions the 3.4 branch in his comment. Should the latest patch be committed to 3.4.6? It sounds like it should, so I&apos;m marking it, but please let me know if you disagree.&lt;/li&gt;
	&lt;li&gt;We will work a different patch for 3.5.0 based on &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-107&quot; title=&quot;Allow dynamic changes to server cluster membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-107&quot;&gt;&lt;del&gt;ZOOKEEPER-107&lt;/del&gt;&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;If there is any concern about these points, please comment. &lt;/p&gt;</comment>
                            <comment id="13556780" author="fpj" created="Fri, 18 Jan 2013 00:14:14 +0000"  >&lt;p&gt;Reverted previous commit (Committed revision 1434978.). Need to provide a patch on top of &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-107&quot; title=&quot;Allow dynamic changes to server cluster membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-107&quot;&gt;&lt;del&gt;ZOOKEEPER-107&lt;/del&gt;&lt;/a&gt; and commit current patch to branch 3.4. &lt;/p&gt;</comment>
                            <comment id="13557243" author="fpj" created="Fri, 18 Jan 2013 14:30:12 +0000"  >&lt;p&gt;Committed to branch 3.4. Committed revision 1435159.&lt;/p&gt;</comment>
                            <comment id="13637934" author="fpj" created="Mon, 22 Apr 2013 12:27:00 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thawan&quot; class=&quot;user-hover&quot; rel=&quot;thawan&quot;&gt;Thawan Kooburat&lt;/a&gt; Should we wrap up this jira? I&apos;ve checked that there are conflicts, so the latest patch has gone stale. Do you have time to generate a patch for trunk or you want me to do it?&lt;/p&gt;</comment>
                            <comment id="13638349" author="abranzyck" created="Mon, 22 Apr 2013 20:20:43 +0100"  >&lt;p&gt;This patch skips adding the NEWLEADER quorum packet in Leader.startForwarding, since it will be added in LearnerHandler a few lines below the call to Leader.startForwarding.&lt;/p&gt;</comment>
                            <comment id="13638353" author="abranzyck" created="Mon, 22 Apr 2013 20:22:59 +0100"  >&lt;p&gt;The Zab1.0 tests are modified, since they checked for the NEWLEADER packet to be duplicated.&lt;/p&gt;</comment>
                            <comment id="13638371" author="abranzyck" created="Mon, 22 Apr 2013 20:48:24 +0100"  >&lt;p&gt;I hope submitting a proposal patch for a JIRA assigned to someone else is no problem. I prepared this for the duplicate JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1694&quot; title=&quot;ZooKeeper Leader sends a repeated NEWLEADER quorum packet to followers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1694&quot;&gt;&lt;del&gt;ZOOKEEPER-1694&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13638380" author="hadoopqa" created="Mon, 22 Apr 2013 21:01:38 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12579889/ZOOKEEPER-1324.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12579889/ZOOKEEPER-1324.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1463329.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1464//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1464//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1464//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1464//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1464//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1464//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13638442" author="fpj" created="Mon, 22 Apr 2013 22:22:19 +0100"  >&lt;p&gt;German, In the other jira, I suggested that you had a look at what has been done so far in this jira and if you had any concern with the patch that has been proposed, that you please raise it. Could you please have a look at the latest patch proposed before yours add comments to this jira? If you make any additions, please do it on top of the patch that has been proposed and reviewed. In the case you make any modification, please explain it in the jira.&lt;/p&gt;

&lt;p&gt;In the case you haven&apos;t done it yet, I suggest you have a look at the &quot;how to contribute&quot; page:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/ZOOKEEPER/HowToContribute&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://cwiki.apache.org/confluence/display/ZOOKEEPER/HowToContribute&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13638811" author="abranzyck" created="Tue, 23 Apr 2013 06:53:58 +0100"  >&lt;p&gt;OK, I see now that you meant the patch on the 3.4 branch.&lt;br/&gt;
I have read the &quot;how to contribute&quot; page, but I will do it again more carefully.&lt;/p&gt;</comment>
                            <comment id="13639177" author="fpj" created="Tue, 23 Apr 2013 16:47:18 +0100"  >&lt;p&gt;Here is a preliminary patch for trunk. I have tried to port the latest one from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thawan&quot; class=&quot;user-hover&quot; rel=&quot;thawan&quot;&gt;Thawan Kooburat&lt;/a&gt;, but the changes due to &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-107&quot; title=&quot;Allow dynamic changes to server cluster membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-107&quot;&gt;&lt;del&gt;ZOOKEEPER-107&lt;/del&gt;&lt;/a&gt; made it non-trivial. I&apos;d really like perhaps &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt; to also have a look at it to make sure I&apos;m not breaking anything badly for the reconfiguration mechanism. &lt;/p&gt;

&lt;p&gt;One test failed for me: ReconfigRecoveryTest. I haven&apos;t had a chance to look too closely into it, though. If anyone has an idea, I&apos;d like to hear, otherwise I&apos;ll have a look at it again later on.&lt;/p&gt;

</comment>
                            <comment id="13639750" author="shralex" created="Tue, 23 Apr 2013 23:47:58 +0100"  >&lt;p&gt;Hi Flavio, &lt;/p&gt;

&lt;p&gt;Sure, I can definitely go over the patch&lt;/p&gt;</comment>
                            <comment id="13646732" author="marshall" created="Wed, 1 May 2013 18:26:27 +0100"  >&lt;p&gt;Alex, have you had a chance to go over this patch yet? We&apos;re seeing this problem in our production environment and would love to get this addressed as soon as possible.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13647239" author="shralex" created="Thu, 2 May 2013 04:33:00 +0100"  >&lt;p&gt;Hi Flavio,&lt;/p&gt;

&lt;p&gt;All the reconfiguration-related code that was executed when a NEWLEADER message gets enough acks is now omitted in the patch (previously this was in Leader.java, tryToCommit(), the &quot;else&quot; clause of &quot;if ((zxid &amp;amp; 0xffffffffL) != 0)&quot;). This is important for reconfiguration recovery - the leader discovers a new configuration during recovery and must apply it by executing this code. Its quite possible that this causes the reconfiguration recovery tests to fail.&lt;/p&gt;

&lt;p&gt;There is a related new comment about this &quot;if&quot; in processAck() that I didn&apos;t fully understand. &lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Alex&lt;/p&gt;</comment>
                            <comment id="13647330" author="abranzyck" created="Thu, 2 May 2013 06:57:32 +0100"  >&lt;p&gt;Hello all,&lt;br/&gt;
I hope I don&apos;t bother you too much with this comment, given that I don&apos;t actually understand most of the code in the current proposed patch.&lt;br/&gt;
It seems to me that this is a problem in 3.4 and it should be corrected with as few changes as possible. Other improvements should go to 3.5. And it seems to me that the problem is that NEWLEADER gets both inserted in the outstandingProposals and sent to the follower directly. So apparently, this could be solved with the very small change bellow. It just skips the inserting of NEWLEADER in the outstanding proposals and keeps all the current processing. Line numbers might not be exact, since it was done for trunk a few weeks ago.&lt;br/&gt;
I could propose it on top of the current patch, but it would mean removing all of it (except where it changes the test case), without really understanding what it is doing, and adding these few lines.&lt;br/&gt;
Could anybody, maybe Flavio, please explain where I get this problem wrong?&lt;br/&gt;
Best regards,&lt;br/&gt;
Germ&#225;n Blanco.&lt;br/&gt;
&amp;#8212; src/java/main/org/apache/zookeeper/server/quorum/Leader.java	(revision 1470391)&lt;br/&gt;
+++ src/java/main/org/apache/zookeeper/server/quorum/Leader.java	(working copy)&lt;br/&gt;
@@ -1116,10 +1116,11 @@&lt;br/&gt;
             List&amp;lt;Long&amp;gt;zxids = new ArrayList&amp;lt;Long&amp;gt;(outstandingProposals.keySet());&lt;br/&gt;
             Collections.sort(zxids);&lt;br/&gt;
             for (Long zxid: zxids) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (zxid &amp;lt;= lastSeenZxid) {&lt;br/&gt;
+                QuorumPacket qp = outstandingProposals.get(zxid).packet;&lt;br/&gt;
+                if ((zxid &amp;lt;= lastSeenZxid) || (qp.getType() == Leader.NEWLEADER)) 
{
                     continue;
                 }&lt;/li&gt;
	&lt;li&gt;handler.queuePacket(outstandingProposals.get(zxid).packet);&lt;br/&gt;
+                handler.queuePacket(qp);&lt;br/&gt;
             }&lt;br/&gt;
         }&lt;br/&gt;
         if (handler.getLearnerType() == LearnerType.PARTICIPANT) {&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13647365" author="fpj" created="Thu, 2 May 2013 08:27:55 +0100"  >&lt;p&gt;German, This issue has already been resolved for branch 3.4, check this out:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1324?focusedCommentId=13557243&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13557243&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1324?focusedCommentId=13557243&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13557243&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We are now working on the patch for trunk.&lt;/p&gt;</comment>
                            <comment id="13647369" author="fpj" created="Thu, 2 May 2013 08:51:49 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt; Thanks a lot for having a look at the new patch. Part of this patch was moving a bit of code around. In the original patch prior to &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-107&quot; title=&quot;Allow dynamic changes to server cluster membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-107&quot;&gt;&lt;del&gt;ZOOKEEPER-107&lt;/del&gt;&lt;/a&gt; getting in, we were removing this &quot;if ((zxid &amp;amp; 0xffffffffL) != 0)&quot; because were not calling tryToCommit for the newleader proposal any longer. When looking at the trunk code, it seemed to me that you had some duplicate code in the else block because you needed to have it executed for both branches (if ((zxid &amp;amp; 0xffffffffL) != 0) succeeds or not). But, because we removed this check &quot;if ((zxid &amp;amp; 0xffffffffL) != 0)&quot;, we don&apos;t have to duplicate that piece of code any longer, and it is executed in the case that the request a reconfig one.&lt;/p&gt;

&lt;p&gt;For completeness, the duplicated bit of code I&apos;m referring to is this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
QuorumVerifier newQV = self.getLastSeenQuorumVerifier();
               
&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; designatedLeader = getDesignatedLeader(p, zxid);                                         
               
self.processReconfig(newQV, designatedLeader, zk.getZxid(), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (designatedLeader != self.getId()) {
        allowedToCommit = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;One bit that I just realized while writing this post is that the else block in the current trunk code is executed even if the request is not a reconfig request. Is this correct? Note that we don&apos;t process the newleader proposal in this method any longer. &lt;/p&gt;

&lt;p&gt;The other thing I was thinking is that if it is really incorrect, then the tests should have captured. Assuming that I need to fix the patch, it would be nice to determine why the reconfig tests didn&apos;t capture it and fix the tests. &lt;/p&gt;</comment>
                            <comment id="13647380" author="shralex" created="Thu, 2 May 2013 09:23:18 +0100"  >&lt;p&gt;Hi Flavio,&lt;/p&gt;

&lt;p&gt;no problem! yes, this is the code I&apos;m referring to. Right, this will run if the packet is not &lt;br/&gt;
reconfig (the &quot;else&quot; clause), specifically when the leader finds out an outstanding reconfig&lt;br/&gt;
it must complete during recovery. &lt;/p&gt;

&lt;p&gt;A recap of how this part of the recovery process works - the leader sends the new config it must complete to others inside a NEWLEADER message (see LearnerHandler where the NEWLEADER message is constructed), and once it has enough acks this code you quote is executed so that it applies the config to itself. The NEWLEADER acts as a reconfig proposal, and the UPTODATE message acts as a reconfig &quot;commit&quot;. So - this code must still be executed somewhere in a similar situation as before (i.e., where you have enough acks for NEWLEADER). Actually, I totally missed the fact that startForwarding sends out the outstandingProposals, so for example I&apos;m not putting the configuration in the NEWLEADER message which was inserted into the outstandingProposals queue in Leader.java - I&apos;m guessing that this duplicate NEWLEADER message is a problem for reconfig recovery too! &lt;/p&gt;

&lt;p&gt;BTW, could you please address the other part of German&apos;s comment ? Why wouldn&apos;t his proposed change solve the issue (skip the NEWLEADER message in the startForwarding() where you send all messages in the outstaningProposals) ? I think if you explain it&apos;ll help us understand better what you guys are doing in this patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Alex&lt;/p&gt;


</comment>
                            <comment id="13647398" author="fpj" created="Thu, 2 May 2013 10:41:41 +0100"  >&lt;p&gt;It sounds like German&apos;s approach is pretty much the same I had proposed previously in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1319&quot; title=&quot;Missing data after restarting+expanding a cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1319&quot;&gt;&lt;del&gt;ZOOKEEPER-1319&lt;/del&gt;&lt;/a&gt;. You can also check this comment in this same jira:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1324?focusedCommentId=13543365&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13543365&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1324?focusedCommentId=13543365&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13543365&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thawan&quot; class=&quot;user-hover&quot; rel=&quot;thawan&quot;&gt;Thawan Kooburat&lt;/a&gt; gives a good summary of the changes proposed here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1324?focusedCommentId=13547301&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13547301&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1324?focusedCommentId=13547301&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13547301&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1324?focusedCommentId=13549144&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13549144&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1324?focusedCommentId=13549144&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13549144&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13647408" author="fpj" created="Thu, 2 May 2013 11:14:17 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt; Most of the else block has been moved to startZkServer. I have not moved the reconfig part, though, but from what I&apos;m getting in your comments, it sounds like we should. &lt;/p&gt;

&lt;p&gt;I also just remembered that one of the reconfig tests failed, so perhaps this is the cause. &lt;/p&gt;</comment>
                            <comment id="13647411" author="shralex" created="Thu, 2 May 2013 11:19:18 +0100"  >&lt;p&gt;Yeah, I think German is proposing the same thing as in your link, and it seems that its a one-line solution to the duplicate NEWLEADER problem.&lt;/p&gt;

&lt;p&gt;A few thoughts about Thawan&apos;s comments:&lt;/p&gt;

&lt;p&gt;I agree that it would be better not to send outstandingProposals to observers and not to ack UPTODATE messages, but these seem like separate issues from this JIRA&apos;s purpose. &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the following is already done in the trunk (part of ZK-107):&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&amp;gt;1. This change also prevent the leader from counting Observer&apos;s NEWLEADER_ACK causing the &lt;br/&gt;
&amp;gt; quorum to form prematurely. I will submit a unit test in a separate jira&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I don&apos;t fully understand the following comment, don&apos;t think it works this way:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&amp;gt; 2. We are sending NEWLEADER proposal implicitly as part of sending outstanding proposals to &lt;br/&gt;
&amp;gt; the learners. Now you have to keep adding NEWLEADER back into outstanding proposals whenever &amp;gt; a new learner joins the quorum since it is removed whenever NEWLEADER packet is committed.&lt;/p&gt;

&lt;p&gt;If I understand correctly, when a new learner joins an already established leader we don&apos;t need to commit a NEWLEADER message, so no need to put it in outstanding proposals.&lt;/p&gt;

&lt;p&gt;So it seems like the main remaining motivation for this patch is decoupling the ACK processing for NEWLEADER from the ACK processing of other messages. &lt;/p&gt;
</comment>
                            <comment id="13647907" author="fpj" created="Thu, 2 May 2013 22:12:05 +0100"  >&lt;blockquote&gt;&lt;p&gt;I agree that it would be better not to send outstandingProposals to observers and not to ack UPTODATE messages, but these seem like separate issues from this JIRA&apos;s purpose. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure, it&apos;s a good observation, but I think we ended up not doing anything about it, at least I can&apos;t see anything related to it in the patch. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The following is already done in the trunk (part of ZK-107): 1. This change also prevent the leader from counting Observer&apos;s NEWLEADER_ACK causing the quorum to form prematurely. I will submit a unit test in a separate jira&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This seems to be part of the merge, it would be good if you could check that it is not conflicting with what was done in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-107&quot; title=&quot;Allow dynamic changes to server cluster membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-107&quot;&gt;&lt;del&gt;ZOOKEEPER-107&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;We are sending NEWLEADER proposal implicitly as part of sending outstanding proposals to the learners. Now you have to keep adding NEWLEADER back into outstanding proposals whenever a new learner joins the quorum since it is removed whenever NEWLEADER packet is committed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There was probably some confusion here, I don&apos;t think there is anything in the patch trying to do things this way. We simply remove the line that adds newleader to outstandingProposals.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;So it seems like the main remaining motivation for this patch is decoupling the ACK processing for NEWLEADER from the ACK processing of other messages. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is the main motivation for me.&lt;/p&gt;

&lt;p&gt;I&apos;ll produce a new patch shortly.&lt;/p&gt;</comment>
                            <comment id="13647942" author="shralex" created="Thu, 2 May 2013 22:52:18 +0100"  >&lt;p&gt;Regarding the membership check - I think this is done here in the patch:&lt;/p&gt;

&lt;p&gt;            if (learnerType == LearnerType.PARTICIPANT) &lt;/p&gt;
{
                newLeaderProposal.addAck(sid);
            }

&lt;p&gt;the implementation of addAck already checks that sid is a voting member of each required config of newLeaderProposal before counting the ack for that config. So the extra check above is not necessary (although it doesn&apos;t hurt).&lt;/p&gt;</comment>
                            <comment id="13647961" author="thawan" created="Thu, 2 May 2013 23:08:43 +0100"  >&lt;blockquote&gt;&lt;p&gt;We are sending NEWLEADER proposal implicitly as part of sending outstanding proposals to the learners. Now you have to keep adding NEWLEADER back into outstanding proposals whenever a new learner joins the quorum since it is removed whenever NEWLEADER packet is committed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is just a response to the initial attempt to fix this bug in this patch (&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12563751/ZOOKEEPER-1324.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12563751/ZOOKEEPER-1324.patch&lt;/a&gt;) where we try to reuse processAck to collect votes for NEWLEADER_ACK.&lt;/p&gt;


&lt;p&gt;Comments about the latest patch:&lt;br/&gt;
1. in 3.4 version of this patch,  we have an if statement to ignore UPDATE_ACK ((zxid &amp;amp; 0xffffffffL) == 0) in processAck(). Looking at the code, the learner from both 3.4 and 3.5 still sending UPTODATE_ACK, so I think we still need to have that similar logic unless it is needed by reconfiguration.    &lt;/p&gt;

&lt;p&gt;2. (Minor) in ackSetsToString(), can you change the delimiter from &quot;:&quot; to &quot;,&quot; to match 3.4 branch? &lt;/p&gt;


</comment>
                            <comment id="13647962" author="fpj" created="Thu, 2 May 2013 23:09:27 +0100"  >&lt;blockquote&gt;&lt;p&gt;Regarding the membership check - I think this is done here in the patch&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I have fixed it in the new patch I uploaded. When you mentioned a check for observers, I thought it was related to outstanding proposals. The one you point out is in the processing of acks, right?&lt;/p&gt;

&lt;p&gt;In any case, have a look at the new patch, please. Special attention to Leader#startZkServer(). &lt;/p&gt;

&lt;p&gt;All tests pass with this patch for me.&lt;/p&gt;</comment>
                            <comment id="13647973" author="shralex" created="Thu, 2 May 2013 23:21:35 +0100"  >&lt;p&gt;One case where this &quot;if&quot; actually changed behavior is when sid is switching from being Observer to being Participant. The &quot;if&quot; would see that sid is an Ovserver in the current config and prevent sid from counting towards the new-config too, where sid is actually a Participant. &lt;/p&gt;

&lt;p&gt;I&apos;m not 100% sure what the right thing to do here. On one hand, acking a NEWLEADER message means that state transfer is complete, Observer or not, so why not count this guy&apos;s vote. On the other hand, he is not yet a participant, and in the normal (non-recovery) case we wouldn&apos;t count its vote (he wouldn&apos;t send any). &lt;/p&gt;

&lt;p&gt;My intuition is that both options are safe in this case since the ACK means state transfer complete, and for liveness its better to allow it to vote, i.e., to remove the if as Flavio now did.&lt;/p&gt;</comment>
                            <comment id="13647988" author="shralex" created="Thu, 2 May 2013 23:39:04 +0100"  >&lt;p&gt;Thawan, I think that (zxid &amp;amp; 0xffffffffL) == 0 means its a NEWLEADER ack, not UPTODATE ack.&lt;br/&gt;
See how the zxid of NEWLEADER message is chosen in leader.lead() &lt;/p&gt;</comment>
                            <comment id="13648049" author="thawan" created="Fri, 3 May 2013 01:16:33 +0100"  >&lt;p&gt;Both NEWLEADER_ACK and UPTODATE_ACK is using the same zxid. See Learner.java line 322,476-477 (&lt;a href=&quot;http://svn.apache.org/viewvc/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Learner.java?revision=1453693&amp;amp;view=markup&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Learner.java?revision=1453693&amp;amp;view=markup&lt;/a&gt;). I think the new code should check of package type instead of checking zxid. It will make the code clearer.  &lt;/p&gt;

</comment>
                            <comment id="13648057" author="shralex" created="Fri, 3 May 2013 01:27:12 +0100"  >&lt;p&gt;I see. I wonder if it&apos;ll break anything not to send the UPTODATE ACK at all. I don&apos;t think its needed by the protocol.&lt;/p&gt;</comment>
                            <comment id="13648263" author="fpj" created="Fri, 3 May 2013 09:15:55 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thawan&quot; class=&quot;user-hover&quot; rel=&quot;thawan&quot;&gt;Thawan Kooburat&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;in 3.4 version of this patch, we have an if statement to ignore UPDATE_ACK ((zxid &amp;amp; 0xffffffffL) == 0) in processAck(). Looking at the code, the learner from both 3.4 and 3.5 still sending UPTODATE_ACK, so I think we still need to have that similar logic unless it is needed by reconfiguration. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We still have that if statement. The one I was talking about previously that has been removed is in Leader#tryToCommit().&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;acking a NEWLEADER message means that state transfer is complete, Observer or not, so why not count this guy&apos;s vote. On the other hand, he is not yet a participant, and in the normal (non-recovery) case we wouldn&apos;t count its vote (he wouldn&apos;t send any). &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In the case you describe, I thought that the observer (changing to participant) should actually be able to vote because we also need a quorum for the new config, which may also come in a newleader message, no? If this is correct, then we shouldn&apos;t have the if statement.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think that (zxid &amp;amp; 0xffffffffL) == 0 means its a NEWLEADER ack, not UPTODATE ack.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You&apos;re both right. We send a second ack after the uptodate, and it uses the same zxid. It is there for backward compatibility reasons, the ack itself is strictly necessary for the correctness of the protocol.&lt;/p&gt;

&lt;p&gt;Once we decide what to do with the if statement Alex referred to, I&apos;ll make any necessary changes and upload a new patch.&lt;/p&gt;</comment>
                            <comment id="13648264" author="fpj" created="Fri, 3 May 2013 09:16:41 +0100"  >&lt;p&gt;Cancelling patch to address comments. &lt;/p&gt;</comment>
                            <comment id="13648329" author="shralex" created="Fri, 3 May 2013 12:15:25 +0100"  >&lt;p&gt;&amp;gt; In the case you describe, I thought that the observer (changing to participant) should &lt;br/&gt;
&amp;gt; actually be able to vote because we also need a quorum for the new config, which may also come &lt;br/&gt;
&amp;gt; in a newleader message, no? If this is correct, then we shouldn&apos;t have the if statement.&lt;/p&gt;

&lt;p&gt;Yes, that&apos;s why I also think that for sake of liveness we should let him vote and remove the if as you did. I was just pointing out that this is slightly different than what we do for the normal case, when this is a reconfig op and not a NEWLEADER message. In that case this server&lt;br/&gt;
wouldn&apos;t even be able to vote since observers don&apos;t vote. Anyway, seems like he should vote if possible, so the if should not be there.&lt;/p&gt;




</comment>
                            <comment id="13648510" author="fpj" created="Fri, 3 May 2013 16:47:49 +0100"  >&lt;p&gt;There is really only the minor change that Thawan has requested, everything else is the same. Is this patch ready to go?&lt;/p&gt;</comment>
                            <comment id="13650254" author="hadoopqa" created="Tue, 7 May 2013 00:53:27 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12581700/ZOOKEEPER-1324.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12581700/ZOOKEEPER-1324.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1463329.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1468//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1468//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1468//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1468//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1468//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1468//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13656099" author="phunt" created="Mon, 13 May 2013 17:45:33 +0100"  >&lt;p&gt;This has been committed to branch-3.4, is it ready for trunk?&lt;/p&gt;</comment>
                            <comment id="13656173" author="fpj" created="Mon, 13 May 2013 18:55:32 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shralex&quot; class=&quot;user-hover&quot; rel=&quot;shralex&quot;&gt;Alexander Shraer&lt;/a&gt; has reviewed it, but has not +1 it. Alex? It would be nice if &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thawan&quot; class=&quot;user-hover&quot; rel=&quot;thawan&quot;&gt;Thawan Kooburat&lt;/a&gt; could +1 it too, since he originated the initial patch and I have modified it to apply to trunk with the &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-107&quot; title=&quot;Allow dynamic changes to server cluster membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-107&quot;&gt;&lt;del&gt;ZOOKEEPER-107&lt;/del&gt;&lt;/a&gt; changes. &lt;/p&gt;</comment>
                            <comment id="13656437" author="shralex" created="Mon, 13 May 2013 22:56:22 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13656528" author="thawan" created="Tue, 14 May 2013 00:37:38 +0100"  >&lt;p&gt;+1 for me.  &lt;/p&gt;

&lt;p&gt;Minor suggestion is to incorporate some portion of Alex&apos;s comment(&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1324?focusedCommentId=13647380&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13647380&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1324?focusedCommentId=13647380&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13647380&lt;/a&gt;) into the code itself.  Since the processReconfig() is now moved into startZkServer() and it might hard to trace back to its origin in the future.  &lt;/p&gt;</comment>
                            <comment id="13656557" author="fpj" created="Tue, 14 May 2013 00:58:46 +0100"  >&lt;p&gt;Added a comment as requested. Is it ok?&lt;/p&gt;</comment>
                            <comment id="13656603" author="thawan" created="Tue, 14 May 2013 01:50:48 +0100"  >&lt;p&gt;Thanks, we should commit this one&lt;/p&gt;</comment>
                            <comment id="13657007" author="fpj" created="Tue, 14 May 2013 13:29:13 +0100"  >&lt;p&gt;Trunk commit: Committed revision 1482318.&lt;/p&gt;</comment>
                            <comment id="13657014" author="fpj" created="Tue, 14 May 2013 13:39:59 +0100"  >&lt;p&gt;Latest patch didn&apos;t apply cleanly to me, so I&apos;m uploading what I have committed.&lt;/p&gt;</comment>
                            <comment id="13658244" author="hudson" created="Wed, 15 May 2013 12:04:57 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #1926 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/1926/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/1926/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1324&quot; title=&quot;Remove Duplicate NEWLEADER packets from the Leader to the Follower.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1324&quot;&gt;&lt;del&gt;ZOOKEEPER-1324&lt;/del&gt;&lt;/a&gt;. Remove Duplicate NEWLEADER packets &lt;br/&gt;
from the Leader to the Follower. (Thawan, fpj via fpj) (Revision 1482318)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
fpj : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1482318&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1482318&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Leader.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/LearnerHandler.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/Zab1_0Test.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13933735" author="fpj" created="Thu, 13 Mar 2014 18:17:02 +0000"  >&lt;p&gt;Closing issues after releasing 3.4.6.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12643906">ZOOKEEPER-1694</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12645566">ZOOKEEPER-1697</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12401266">ZOOKEEPER-107</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12565476" name="ZOOKEEPER-1324-branch-3.4.patch" size="12216" author="fpj" created="Fri, 18 Jan 2013 14:30:12 +0000"/>
                            <attachment id="12583118" name="ZOOKEEPER-1324-trunk-committed.patch" size="19361" author="fpj" created="Tue, 14 May 2013 13:39:59 +0100"/>
                            <attachment id="12583038" name="ZOOKEEPER-1324.patch" size="18838" author="fpj" created="Tue, 14 May 2013 00:58:46 +0100"/>
                            <attachment id="12581700" name="ZOOKEEPER-1324.patch" size="18477" author="fpj" created="Fri, 3 May 2013 16:47:49 +0100"/>
                            <attachment id="12581617" name="ZOOKEEPER-1324.patch" size="18477" author="fpj" created="Thu, 2 May 2013 23:04:55 +0100"/>
                            <attachment id="12580062" name="ZOOKEEPER-1324.patch" size="17897" author="fpj" created="Tue, 23 Apr 2013 16:47:18 +0100"/>
                            <attachment id="12564118" name="ZOOKEEPER-1324.patch" size="11841" author="thawan" created="Thu, 10 Jan 2013 04:01:09 +0000"/>
                            <attachment id="12564058" name="ZOOKEEPER-1324.patch" size="11777" author="thawan" created="Wed, 9 Jan 2013 23:44:05 +0000"/>
                            <attachment id="12564047" name="ZOOKEEPER-1324.patch" size="11288" author="thawan" created="Wed, 9 Jan 2013 22:30:38 +0000"/>
                            <attachment id="12563751" name="ZOOKEEPER-1324.patch" size="8067" author="fpj" created="Tue, 8 Jan 2013 13:41:01 +0000"/>
                            <attachment id="12563186" name="ZOOKEEPER-1324.patch" size="2543" author="thawan" created="Thu, 3 Jan 2013 22:59:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Jan 2013 22:26:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>220241</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzslz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32619</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>