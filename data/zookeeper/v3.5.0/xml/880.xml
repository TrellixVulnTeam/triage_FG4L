<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:45:20 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-880/ZOOKEEPER-880.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-880] QuorumCnxManager$SendWorker grows without bounds</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-880</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;We&apos;re seeing an issue where one server in the ensemble has a steady growing number of QuorumCnxManager$SendWorker threads up to a point where the OS runs out of native threads, and at the same time we see a lot of exceptions in the logs.  This is on 3.2.2 and our config looks like:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;tickTime=3000
dataDir=/somewhere_thats_not_tmp
clientPort=2181
initLimit=10
syncLimit=5
server.0=sv4borg9:2888:3888
server.1=sv4borg10:2888:3888
server.2=sv4borg11:2888:3888
server.3=sv4borg12:2888:3888
server.4=sv4borg13:2888:3888
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The issue is on the first server. I&apos;m going to attach threads dumps and logs in moment.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12475256">ZOOKEEPER-880</key>
            <summary>QuorumCnxManager$SendWorker grows without bounds</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vishalmlst">Vishal Kher</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Sep 2010 00:40:46 +0100</created>
                <updated>Wed, 23 Nov 2011 19:22:01 +0000</updated>
                            <resolved>Wed, 16 Mar 2011 18:49:33 +0000</resolved>
                                    <version>3.4.0</version>
                                    <fixVersion>3.4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12915546" author="jdcryans" created="Tue, 28 Sep 2010 00:42:32 +0100"  >&lt;p&gt;Attaching the logs of the problematic server (sv4borg9) that I restarted this afternoon and the logs from one of the other servers from that point. Also attaching the jstack of first server.&lt;/p&gt;</comment>
                            <comment id="12915553" author="jdcryans" created="Tue, 28 Sep 2010 00:54:07 +0100"  >&lt;p&gt;Also we checked dmesg, syslog, df, ifconfig, ethtool, and ifstat for anything unusual and nothing obvious comes out.&lt;/p&gt;</comment>
                            <comment id="12915559" author="jdcryans" created="Tue, 28 Sep 2010 00:59:01 +0100"  >&lt;p&gt;Oh but it looks like the process on sv4borg9 is generating a lot of IO (50% on one CPU on average according to top). Seems to be mostly writes.&lt;/p&gt;</comment>
                            <comment id="12915625" author="fpj" created="Tue, 28 Sep 2010 06:44:09 +0100"  >&lt;p&gt;J-D, Has it happened just once or it is reproducible? Does it also happen with 3.3?&lt;/p&gt;</comment>
                            <comment id="12915627" author="jdcryans" created="Tue, 28 Sep 2010 06:52:07 +0100"  >&lt;p&gt;It&apos;s currently happening (currently at 344 threads and growing, was at 76 when I created this jira), it&apos;s still there when I bounce the peer, and it does happen on 3.3.1 too.&lt;/p&gt;</comment>
                            <comment id="12915634" author="phunt" created="Tue, 28 Sep 2010 07:14:15 +0100"  >&lt;blockquote&gt;&lt;p&gt;one server in the ensemble has a steady growing number of QuorumCnxManager$SendWorker threads &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;to be overly clear - this is happening on just 1 server, the other servers on the cluster are not seeing this, is that right?&lt;/p&gt;

&lt;p&gt;any insight on GC and JVM activity. Are there significant pauses on the GC, or perhaps swapping of that jvm?  How active is the JVM? How active (cpu) are the other processes on this host? You mentioned they are using 50% disk, what about cpu? &lt;/p&gt;

&lt;p&gt;Is there a way you could move the ZK datadir on that host to an unused spindle and see if that helps at all?&lt;/p&gt;

&lt;p&gt;If I understood correctly the JVM hosting the ZK server is hosting other code as well, is that right? You mentioned something about hbase managing the ZK server, could you elaborate on that as well?&lt;/p&gt;
</comment>
                            <comment id="12915832" author="jdcryans" created="Tue, 28 Sep 2010 17:59:32 +0100"  >&lt;blockquote&gt;&lt;p&gt;to be overly clear - this is happening on just 1 server, the other servers on the cluster are not seeing this, is that right?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, sv4borg9.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;any insight on GC and JVM activity. Are there significant pauses on the GC, or perhaps swapping of that jvm? How active is the JVM? How active (cpu) are the other processes on this host? You mentioned they are using 50% disk, what about cpu?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No swapping, GC activity is normal as far as I can tell by the GC log, 1 active CPU for that process according to top (the rest of the cpus are idle most of the time).  &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If I understood correctly the JVM hosting the ZK server is hosting other code as well, is that right? You mentioned something about hbase managing the ZK server, could you elaborate on that as well?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That machine is also the Namenode, JobTracker and HBase master (all in their own JVMs). The only thing special is that the quorum peers are started by HBase.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is there a way you could move the ZK datadir on that host to an unused spindle and see if that helps at all?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ll look into that.&lt;/p&gt;</comment>
                            <comment id="12915838" author="phunt" created="Tue, 28 Sep 2010 18:18:05 +0100"  >&lt;p&gt;JD tried moving the datadirectory to another disk (new datadir), that didn&apos;t help, same problem. Also note: the snapshot file is ~2mb in size.&lt;/p&gt;</comment>
                            <comment id="12915848" author="jdcryans" created="Tue, 28 Sep 2010 18:36:30 +0100"  >&lt;p&gt;Here&apos;s a new run, at TRACE-level, starting from a fresh log and a cleaned up dataDir on a different disk.&lt;/p&gt;</comment>
                            <comment id="12915849" author="breed" created="Tue, 28 Sep 2010 18:37:27 +0100"  >&lt;p&gt;is there an easy way to reproduce this?&lt;/p&gt;</comment>
                            <comment id="12915850" author="jdcryans" created="Tue, 28 Sep 2010 18:40:11 +0100"  >&lt;blockquote&gt;&lt;p&gt;is there an easy way to reproduce this?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Unfortunately none I can see... we have 5 clusters that use the same hardware and ZK configurations and we only find this issue on this cluster, on this specific node, although all the other nodes of that cluster have the same InterruptedExceptions (but aren&apos;t leaking SendWorkers).&lt;/p&gt;</comment>
                            <comment id="12916544" author="phunt" created="Thu, 30 Sep 2010 17:30:42 +0100"  >&lt;p&gt;I tried reproducing this with 5 servers on my laptop and using check_tcp that I compiled. I can&apos;t get it to happen. However I do notice a large number of connections (from nagios to election port) in the SYN_RECV state (some in close_wait as well).&lt;/p&gt;

&lt;p&gt;JD - can you turn off nagios, restart the effected server (clear the log4j logs as well), then look to see if the problem is still occuring? update this jira with the logs from the &quot;bad&quot; server and one other (at least) would be helpful. Thanks!&lt;/p&gt;</comment>
                            <comment id="12916546" author="phunt" created="Thu, 30 Sep 2010 17:40:43 +0100"  >&lt;p&gt;This issue sounds very similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-883&quot; title=&quot;Idle cluster increasingly consumes CPU resources&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-883&quot;&gt;&lt;del&gt;ZOOKEEPER-883&lt;/del&gt;&lt;/a&gt; &amp;#8211; they are also using Nagios to monitor the election port in that case as well.&lt;/p&gt;</comment>
                            <comment id="12917685" author="vishalmlst" created="Mon, 4 Oct 2010 18:59:43 +0100"  >&lt;p&gt;While debugging for &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-822&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-822&lt;/a&gt; I found that senderWorkerMap would not have an entry for a server, but there will be a RecvWorker and SendWorker thread running for the server. In my case, this was seen when the leader died (i.e., during leader election). However, I think this can happen when a peer disconnects from another peer. The cause was incorrect handling of add/remove of entries from senderWorkerMap, which is exposed due to race conditions in QuorumCnxManager. There is a patch available for &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-822&quot; title=&quot;Leader election taking a long time  to complete&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-822&quot;&gt;&lt;del&gt;ZOOKEEPER-822&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I am not sure if the &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-822&quot; title=&quot;Leader election taking a long time  to complete&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-822&quot;&gt;&lt;del&gt;ZOOKEEPER-822&lt;/del&gt;&lt;/a&gt; is causing trouble here as well. I just wanted to point out the possibility.&lt;/p&gt;</comment>
                            <comment id="12931457" author="tsuna" created="Fri, 12 Nov 2010 17:38:09 +0000"  >&lt;p&gt;Bumping up the severity.  This took down one of our clusters again.&lt;/p&gt;</comment>
                            <comment id="12931464" author="fpj" created="Fri, 12 Nov 2010 17:43:38 +0000"  >&lt;p&gt;Benoit, just to clarify, is this also due to monitoring or scanning?&lt;/p&gt;</comment>
                            <comment id="12933602" author="vishalmlst" created="Thu, 18 Nov 2010 23:07:03 +0000"  >&lt;p&gt;Hi Benoit,&lt;/p&gt;

&lt;p&gt;May I suggest to see if you can reproduce this problem with 3.3.3&lt;br/&gt;
(with patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-822&quot; title=&quot;Leader election taking a long time  to complete&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-822&quot;&gt;&lt;del&gt;ZOOKEEPER-822&lt;/del&gt;&lt;/a&gt;)? I was going through&lt;br/&gt;
QuorumCnxManager.java for 3.2.2. It clearly leaks a SendWorker thread&lt;br/&gt;
for every other connection.&lt;/p&gt;

&lt;p&gt;After receiving a connection from a peer, it creates a new thread and&lt;br/&gt;
inserts its reference in senderWorkerMap.&lt;/p&gt;

&lt;p&gt;            SendWorker sw = new SendWorker(s, sid);&lt;br/&gt;
            RecvWorker rw = new RecvWorker(s, sid);&lt;br/&gt;
            sw.setRecv(rw);&lt;/p&gt;

&lt;p&gt;            SendWorker vsw = senderWorkerMap.get(sid);&lt;br/&gt;
            senderWorkerMap.put(sid, sw);&lt;/p&gt;

&lt;p&gt;Then it kills the old thread for the peer (created from earlier&lt;br/&gt;
connection)&lt;/p&gt;

&lt;p&gt;            if(vsw != null)&lt;br/&gt;
                vsw.finish();&lt;/p&gt;

&lt;p&gt;However, the SendWorker.finish method removes an entry from&lt;br/&gt;
            senderWorkerMap. This results in removing a reference for&lt;br/&gt;
            recently created SendWorker thread.&lt;br/&gt;
            senderWorkerMap.remove(sid);&lt;/p&gt;


&lt;p&gt;Thus, it will end up removing both the entries. As a result, one thread&lt;br/&gt;
will be leaked for every other connection.&lt;/p&gt;

&lt;p&gt;If you count the number of error messages in&lt;br/&gt;
hbase-hadoop-zookeeper-sv4borg9.log, you will see that messages from&lt;br/&gt;
RecvWorker is approximately twice of SendWorker. I think this proves&lt;br/&gt;
the point.&lt;/p&gt;

&lt;p&gt;$:/tmp/hadoop # grep &quot;RecvWorker&quot;  hbase-hadoop-zookeeper-sv4borg9.log | wc -l&lt;br/&gt;
60&lt;br/&gt;
$:/tmp/hadoop # grep &quot;SendWorker&quot;  hbase-hadoop-zookeeper-sv4borg9.log | wc -l&lt;br/&gt;
32&lt;/p&gt;

&lt;p&gt;-Vishal&lt;/p&gt;</comment>
                            <comment id="12933718" author="fpj" created="Fri, 19 Nov 2010 08:18:22 +0000"  >&lt;p&gt;One problem here is that we had some discussions over IRC and the information is not reflected here. &lt;/p&gt;

&lt;p&gt;If you have a look at the logs, you&apos;ll observe this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
2010-09-28 10:31:22,227 DEBUG org.apache.zookeeper.server.quorum.QuorumCnxManager: Connection request /10.10.20.5:41861
2010-09-28 10:31:22,227 DEBUG org.apache.zookeeper.server.quorum.QuorumCnxManager: Connection request: 0
2010-09-28 10:31:22,227 DEBUG org.apache.zookeeper.server.quorum.QuorumCnxManager: Address of remote peer: 0
2010-09-28 10:31:22,229 WARN org.apache.zookeeper.server.quorum.QuorumCnxManager: Connection broken:
java.io.IOException: Channel eof
        at org.apache.zookeeper.server.quorum.QuorumCnxManager$RecvWorker.run(QuorumCnxManager.java:595)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If I remember the discussion with J-D correctly, that node trying to connect is running Nagios. My conjecture at the time was that the IOException was killing the receiver thread, but not the sender thread (RecvWorker.finish() does not close its SendWorker counterpart).&lt;/p&gt;

&lt;p&gt;Your point is good, but it sounds like that the race you mention would have to be triggered continuously to cause the number of SendWorker threads to grow steadily. It sounds unlikely to me.&lt;/p&gt;</comment>
                            <comment id="12933829" author="vishalmlst" created="Fri, 19 Nov 2010 15:10:41 +0000"  >&lt;p&gt;Hi Flavio,&lt;/p&gt;

&lt;p&gt;You are right.  We can see RecvWorker leaving but no messages from SendWorker.&lt;/p&gt;

&lt;p&gt;2010-09-27 16:02:59,111 WARN org.apache.zookeeper.server.quorum.QuorumCnxManager: Connection broken:&lt;br/&gt;
java.io.IOException: Channel eof&lt;br/&gt;
    at org.apache.zookeeper.server.quorum.QuorumCnxManager$RecvWorker.run(QuorumCnxManager.java:595)&lt;br/&gt;
2010-09-27 16:02:59,162 WARN org.apache.zookeeper.server.quorum.QuorumCnxManager: Connection broken:&lt;br/&gt;
java.io.IOException: Channel eof&lt;br/&gt;
    at org.apache.zookeeper.server.quorum.QuorumCnxManager$RecvWorker.run(QuorumCnxManager.java:595)&lt;br/&gt;
2010-09-27 16:03:14,269 WARN org.apache.zookeeper.server.quorum.QuorumCnxManager: Connection broken:&lt;br/&gt;
java.io.IOException: Channel eof&lt;br/&gt;
    at org.apache.zookeeper.server.quorum.QuorumCnxManager$RecvWorker.run(QuorumCnxManager.java:595)&lt;/p&gt;

&lt;p&gt;I thought that RecvWorker in  3.3.1 called sw.finish() before exiting. Adding this call in RecvWorker should fix this problem.&lt;/p&gt;


&lt;p&gt;-Vishal&lt;/p&gt;</comment>
                            <comment id="12933842" author="vishalmlst" created="Fri, 19 Nov 2010 15:45:23 +0000"  >&lt;p&gt;Leader has the same problem as well. LearnerHandler expects a QuorumPacket to be received as the first packet after connection. However, if Nagios was monitoring server port as well, then one would expect to see a lot of such messages:&lt;br/&gt;
                LOG.error(&quot;First packet &quot; + qp.toString()&lt;br/&gt;
                        + &quot; is not FOLLOWERINFO or OBSERVERINFO!&quot;);&lt;/p&gt;

&lt;p&gt;Is Nagios not monitoring the server port?&lt;/p&gt;</comment>
                            <comment id="12933871" author="jdcryans" created="Fri, 19 Nov 2010 17:13:48 +0000"  >&lt;p&gt;Nagios is monitoring all 5 ensemble members the exact same way (checking connectivity on all 3 ports), although only 1 machine shows the issue. We tried stopping the monitoring on the problematic machine, but still got a growing number of threads.&lt;/p&gt;</comment>
                            <comment id="12933891" author="phunt" created="Fri, 19 Nov 2010 18:01:23 +0000"  >&lt;p&gt;Flavio (and others) we should update the docs to include details on which ports can/should be monitored, and which ports should NOT be monitored (or if monitoring is supported any conditions).&lt;/p&gt;

&lt;p&gt;Can we update the docs as part of any patch/fix? Thanks.&lt;/p&gt;</comment>
                            <comment id="12933897" author="tsuna" created="Fri, 19 Nov 2010 18:14:33 +0000"  >&lt;p&gt;Do we agree that monitoring wasn&apos;t causing the issue?  As JD said, even after we stopped it, the problem re-occurred.&lt;/p&gt;</comment>
                            <comment id="12933928" author="fpj" created="Fri, 19 Nov 2010 19:32:57 +0000"  >&lt;p&gt;I think we agree that monitoring alone was not causing the issue. But, your logs indicate that there were some orphan threads due to the monitoring, and we can see it from excerpts of your logs like the one I posted above. Without the monitoring, the same problem is being triggered, though, but apparently in a different way and it is not clear why. You can see it from all the &quot;Channel eof&quot; messages on the log. &lt;/p&gt;

&lt;p&gt;To solve this issue, we need to understand the following:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;What&apos;s causing those IOExceptions?&lt;/li&gt;
	&lt;li&gt;Why are we even starting a new connection if there is no leader election going on?&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Do you folks have any idea if there is anything in your environment that could be causing those TCP connections to break? &lt;/p&gt;</comment>
                            <comment id="12933941" author="vishalmlst" created="Fri, 19 Nov 2010 19:59:45 +0000"  >

&lt;p&gt;The root cause of frequent disconnect needs to be resolved. In the mean time, I have fixed the problem that was causing the leak of every other thread of SendWorker.&lt;/p&gt;

&lt;p&gt;I tested the patch by connecting to 3888 on one of the servers using telnet.&lt;/p&gt;

&lt;p&gt;2010-11-19 14:51:10,081 - INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;/10.17.119.101:3888:QuorumCnxManager$Listener@477&amp;#93;&lt;/span&gt; - Received connection request /10.16.251.39:2074&lt;br/&gt;
2010-11-19 14:51:14,364 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;/10.17.119.101:3888:QuorumCnxManager$SendWorker@553&amp;#93;&lt;/span&gt; - Address of remote peer: 8103510703875099187&lt;br/&gt;
2010-11-19 14:51:19,440 - WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-7:QuorumCnxManager$RecvWorker@726&amp;#93;&lt;/span&gt; - Connection broken for id 8103510703875099187, my id = 1, error = &lt;br/&gt;
java.io.IOException: Received packet with invalid packet: 218824692&lt;br/&gt;
	at org.apache.zookeeper.server.quorum.QuorumCnxManager$RecvWorker.run(QuorumCnxManager.java:711)&lt;br/&gt;
2010-11-19 14:51:19,441 - WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-7:QuorumCnxManager$RecvWorker@730&amp;#93;&lt;/span&gt; - Interrupting SendWorker   &amp;lt;============= SendWorker is getting killed.&lt;br/&gt;
2010-11-19 14:51:19,442 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-7:QuorumCnxManager$SendWorker@571&amp;#93;&lt;/span&gt; - Calling finish for 8103510703875099187&lt;br/&gt;
2010-11-19 14:51:19,443 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-7:QuorumCnxManager$SendWorker@591&amp;#93;&lt;/span&gt; - Removing entry from senderWorkerMap sid=8103510703875099187&lt;br/&gt;
2010-11-19 14:51:19,443 - WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-6:QuorumCnxManager$SendWorker@643&amp;#93;&lt;/span&gt; - Interrupted while waiting for message on queue&lt;br/&gt;
java.lang.InterruptedException&lt;br/&gt;
	at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.reportInterruptAfterWait(AbstractQueuedSynchronizer.java:1899)&lt;br/&gt;
	at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:1976)&lt;br/&gt;
	at java.util.concurrent.ArrayBlockingQueue.poll(ArrayBlockingQueue.java:342)&lt;br/&gt;
	at org.apache.zookeeper.server.quorum.QuorumCnxManager$SendWorker.run(QuorumCnxManager.java:631)&lt;br/&gt;
2010-11-19 14:51:19,456 - DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-6:QuorumCnxManager$SendWorker@571&amp;#93;&lt;/span&gt; - Calling finish for 8103510703875099187&lt;br/&gt;
2010-11-19 14:51:19,457 - WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-6:QuorumCnxManager$SendWorker@652&amp;#93;&lt;/span&gt; - Send worker leaving thread&lt;/p&gt;

&lt;p&gt;Can you see if this fixes the problem?&lt;/p&gt;</comment>
                            <comment id="12933943" author="vishalmlst" created="Fri, 19 Nov 2010 20:01:16 +0000"  >&lt;p&gt;patch for trunk&lt;/p&gt;</comment>
                            <comment id="12933967" author="hadoopqa" created="Fri, 19 Nov 2010 20:32:45 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12460041/ZOOKEEPER-880.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12460041/ZOOKEEPER-880.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1036967.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 8 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/39//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/39//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/39//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/39//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/39//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/39//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12934533" author="phunt" created="Mon, 22 Nov 2010 17:58:41 +0000"  >&lt;p&gt;We really should have a test for this case. Vishal can you add it? (the more the better)&lt;/p&gt;</comment>
                            <comment id="12934542" author="phunt" created="Mon, 22 Nov 2010 18:35:50 +0000"  >&lt;p&gt;JD said he saw this even with monitoring confirmed off. So that&apos;s the acid test. JD said he would test this patch soonest. (thanks all!) &lt;/p&gt;</comment>
                            <comment id="12934700" author="jdcryans" created="Tue, 23 Nov 2010 01:57:56 +0000"  >&lt;p&gt;+1 It fixes the leak. Thanks!&lt;/p&gt;</comment>
                            <comment id="12965344" author="vishalmlst" created="Tue, 30 Nov 2010 19:03:39 +0000"  >&lt;p&gt;Thanks for verifying the patch. Do you know why the servers kept disconnecting from each other?&lt;/p&gt;

&lt;p&gt;Patrick - I will attach a patch with a test shortly. How do I get around the findbugs issues. I haven&apos;t touch any of the reported code.&lt;/p&gt;</comment>
                            <comment id="12965347" author="jdcryans" created="Tue, 30 Nov 2010 19:06:54 +0000"  >&lt;p&gt;@Vishal We haven&apos;t figured that out yet... &lt;/p&gt;</comment>
                            <comment id="12965349" author="vishalmlst" created="Tue, 30 Nov 2010 19:08:43 +0000"  >&lt;p&gt;Submitting patch with a test.&lt;/p&gt;
</comment>
                            <comment id="12965351" author="vishalmlst" created="Tue, 30 Nov 2010 19:10:54 +0000"  >&lt;p&gt;with junit. haven&apos;t fixed eariler findbugs  since they are not in the related code path.&lt;/p&gt;</comment>
                            <comment id="12965367" author="hadoopqa" created="Tue, 30 Nov 2010 19:33:14 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12464977/ZOOKEEPER-880.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12464977/ZOOKEEPER-880.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1038827.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 7 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/57//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/57//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/57//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/57//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/57//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/57//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12965400" author="vishalmlst" created="Tue, 30 Nov 2010 20:16:32 +0000"  >&lt;p&gt;I dont think the test failure is realted to my changes.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;      &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; /grid/0/hudson/hudson-slave/workspace/PreCommit-ZOOKEEPER-Build/trunk/src/c/tests/TestClient.cc:363: Assertion: equality assertion failed &lt;span class=&quot;error&quot;&gt;&amp;#91;Expected: -101, Actual  : -4&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;      &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; Failures !!!&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;      &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; Run: 33   Failure total: 1   Failures: 1   Errors: 0&lt;/p&gt;

&lt;p&gt;The tests that I added seemed to pass&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 2010-11-30 19:19:52,796 &lt;span class=&quot;error&quot;&gt;&amp;#91;myid:&amp;#93;&lt;/span&gt; - INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main:JUnit4ZKTestRunner$LoggedInvokeMethod@56&amp;#93;&lt;/span&gt; - FINISHED TEST METHOD testWorkerThreads&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 2010-11-30 19:19:52,796 &lt;span class=&quot;error&quot;&gt;&amp;#91;myid:&amp;#93;&lt;/span&gt; - INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main:ZKTestCase$1@59&amp;#93;&lt;/span&gt; - SUCCEEDED testWorkerThreads&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 2010-11-30 19:19:52,796 &lt;span class=&quot;error&quot;&gt;&amp;#91;myid:&amp;#93;&lt;/span&gt; - INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main:ZKTestCase$1@54&amp;#93;&lt;/span&gt; - FINISHED testWorkerThreads&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 5, Failures: 0, Errors: 0, Time elapsed: 202.307 sec&lt;/p&gt;

</comment>
                            <comment id="12968604" author="vishalmlst" created="Tue, 7 Dec 2010 07:05:12 +0000"  >&lt;p&gt;Reattaching  patch after minor changes. Can someone review it and help with findbugs issue?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="12968613" author="hadoopqa" created="Tue, 7 Dec 2010 07:36:09 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12465666/ZOOKEEPER-880.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12465666/ZOOKEEPER-880.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1040752.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 7 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/62//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/62//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/62//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/62//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/62//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/62//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12977114" author="vishalmlst" created="Tue, 4 Jan 2011 05:02:31 +0000"  >&lt;p&gt;Can someone review this patch and help with findbugs issue?   Jean-Daniel has already given +1 to the patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="12980168" author="mahadev" created="Tue, 11 Jan 2011 16:36:33 +0000"  >&lt;p&gt;+1, the patch looks good.&lt;/p&gt;</comment>
                            <comment id="12980169" author="mahadev" created="Tue, 11 Jan 2011 16:37:01 +0000"  >&lt;p&gt;Vishal, Ill just run ant test on 3.3.3 and will commit it today.&lt;/p&gt;</comment>
                            <comment id="12980224" author="mahadev" created="Tue, 11 Jan 2011 18:16:26 +0000"  >&lt;p&gt;Sorry, I just saw that flavio had already reviewed the patch. Vishal/Flavio, can you guys please comment on the jira when you add a review board request and when you review it? Its easier to track on a jira than the mailing list.&lt;/p&gt;</comment>
                            <comment id="12980225" author="mahadev" created="Tue, 11 Jan 2011 18:16:51 +0000"  >&lt;p&gt;also the links to it .&lt;/p&gt;</comment>
                            <comment id="12980288" author="mahadev" created="Tue, 11 Jan 2011 19:41:26 +0000"  >&lt;p&gt;the patch does not apply to 3.3.3 branch. Vishal can you please generate a patch against 3.3.3 as well incorporating flavios comments? This should be a blocker for 3.3.3 release.&lt;/p&gt;</comment>
                            <comment id="12980562" author="vishalmlst" created="Wed, 12 Jan 2011 05:09:04 +0000"  >&lt;p&gt;Mahadev, Thanks for reviewing the patch. I believe you are referring to the patch for 932 on the reviewboard.&lt;br/&gt;
932 includes the fix for this bug as well (it is in the same code path that I reworked and the tests are similar as well). How about we wait till 932 is approved (it is in the final review stages)?&lt;/p&gt;</comment>
                            <comment id="12986863" author="vishalmlst" created="Wed, 26 Jan 2011 06:42:57 +0000"  >&lt;p&gt;Mahadev,&lt;/p&gt;

&lt;p&gt;I am not sure which review comments you are referring to. Flavio is yet to review this particular patch. Considering that we are looking to get 3.3.3 out, do you want me to port this patch to 3.3.3 or do you want to wait till Flavio reviews 932. Both (932 and this patch) touch the same code. 932 also includes a fix for this bug. Ideally, I prefer 932 to be reviewed so that we will get both the bugs fixed in 3.3.3.&lt;/p&gt;</comment>
                            <comment id="12988687" author="vishalmlst" created="Mon, 31 Jan 2011 08:36:44 +0000"  >&lt;p&gt;Mahadev,&lt;/p&gt;

&lt;p&gt;How do I generate a patch for &quot;branch 3.3.3&quot;? Do you mean 3.3 (&lt;a href=&quot;http://svn.apache.org/repos/asf/zookeeper/branches/branch-3.3/)?&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/zookeeper/branches/branch-3.3/)?&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12988830" author="mahadev" created="Mon, 31 Jan 2011 18:23:53 +0000"  >&lt;p&gt;vishal,&lt;br/&gt;
 Sorry i meant, 3.3 branch.&lt;/p&gt;</comment>
                            <comment id="12989047" author="vishalmlst" created="Tue, 1 Feb 2011 05:22:39 +0000"  >&lt;p&gt;Patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-900&quot; title=&quot;FLE implementation should be improved to use non-blocking sockets&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-900&quot;&gt;ZOOKEEPER-900&lt;/a&gt; is not applied to 3.3. Without this patch QuorumCnxManager can block indefinitely in SocketChannel.read() (see &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-900&quot; title=&quot;FLE implementation should be improved to use non-blocking sockets&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-900&quot;&gt;ZOOKEEPER-900&lt;/a&gt; for more details). I would suggest to include this patch in 3.3.3 as well. If you agree, I will integrate patches for &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-900&quot; title=&quot;FLE implementation should be improved to use non-blocking sockets&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-900&quot;&gt;ZOOKEEPER-900&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-880&quot; title=&quot;QuorumCnxManager$SendWorker grows without bounds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-880&quot;&gt;&lt;del&gt;ZOOKEEPER-880&lt;/del&gt;&lt;/a&gt; and submit for review. Let me know.&lt;/p&gt;</comment>
                            <comment id="12990957" author="fpj" created="Sat, 5 Feb 2011 11:32:34 +0000"  >&lt;p&gt;Hi Vishal, Let me see I&apos;m getting the flow of patches right. &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-880&quot; title=&quot;QuorumCnxManager$SendWorker grows without bounds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-880&quot;&gt;&lt;del&gt;ZOOKEEPER-880&lt;/del&gt;&lt;/a&gt; will probably conflict with &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-932&quot; title=&quot;Move blocking read/write calls to SendWorker and RecvWorker Threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-932&quot;&gt;ZOOKEEPER-932&lt;/a&gt;, right? You&apos;re suggesting then that we have &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-880&quot; title=&quot;QuorumCnxManager$SendWorker grows without bounds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-880&quot;&gt;&lt;del&gt;ZOOKEEPER-880&lt;/del&gt;&lt;/a&gt; in 3.3.3, and that you regenerate &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-932&quot; title=&quot;Move blocking read/write calls to SendWorker and RecvWorker Threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-932&quot;&gt;ZOOKEEPER-932&lt;/a&gt; for trunk? In this case, we have that:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;We need two patches for &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-880&quot; title=&quot;QuorumCnxManager$SendWorker grows without bounds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-880&quot;&gt;&lt;del&gt;ZOOKEEPER-880&lt;/del&gt;&lt;/a&gt;, one for 3.3.3 and one for 3.4.0;&lt;/li&gt;
	&lt;li&gt;We need one patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-932&quot; title=&quot;Move blocking read/write calls to SendWorker and RecvWorker Threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-932&quot;&gt;ZOOKEEPER-932&lt;/a&gt; for 3.4.0;&lt;/li&gt;
	&lt;li&gt;The 3.4.0 patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-932&quot; title=&quot;Move blocking read/write calls to SendWorker and RecvWorker Threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-932&quot;&gt;ZOOKEEPER-932&lt;/a&gt; depends on the patch for 3.4.0 for &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-880&quot; title=&quot;QuorumCnxManager$SendWorker grows without bounds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-880&quot;&gt;&lt;del&gt;ZOOKEEPER-880&lt;/del&gt;&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I&apos;m just trying to understand what we have to commit for which release and the order. If what I describe matches your proposal, then it is is good for me. &lt;/p&gt;</comment>
                            <comment id="12991286" author="vishalmlst" created="Mon, 7 Feb 2011 07:02:56 +0000"  >&lt;p&gt;Hi flavio,&lt;/p&gt;

&lt;p&gt;Ideally, I would like to have 932 part of 3.3.3 as well. But since 932 is not a blocker (and not approved yet), I understand if it doesn&apos;t get in 3.3.3.&lt;/p&gt;

&lt;p&gt;The order/dependency of patches that you have described is correct. Patch for 932 in a way depends on 880, but it will override 880 since it includes a fix for 880 as well. So we won&apos;t have to do any additional &quot;merge&quot; of 880 with 932. We will first commit 880 and then 932 to trunk.&lt;/p&gt;

&lt;p&gt;Also, I think patch for 900 needs to go in 3.3.3.&lt;/p&gt;</comment>
                            <comment id="12997947" author="mahadev" created="Tue, 22 Feb 2011 18:27:32 +0000"  >&lt;p&gt;vishal, &lt;br/&gt;
  for 3.3 is it possible to have a patch for this issue? (Just 880)? I think we can move &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-932&quot; title=&quot;Move blocking read/write calls to SendWorker and RecvWorker Threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-932&quot;&gt;ZOOKEEPER-932&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-900&quot; title=&quot;FLE implementation should be improved to use non-blocking sockets&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-900&quot;&gt;ZOOKEEPER-900&lt;/a&gt; to trunk. &lt;/p&gt;</comment>
                            <comment id="12998068" author="vishalmlst" created="Tue, 22 Feb 2011 22:35:51 +0000"  >&lt;p&gt;Hi Mahadev,&lt;/p&gt;

&lt;p&gt;Sure. I will send out the patch for 3.3. asap.&lt;/p&gt;</comment>
                            <comment id="12998070" author="mahadev" created="Tue, 22 Feb 2011 22:38:39 +0000"  >&lt;p&gt;thanks vishal.&lt;/p&gt;</comment>
                            <comment id="12998489" author="vishalmlst" created="Wed, 23 Feb 2011 18:27:57 +0000"  >&lt;p&gt;Submitting patch for 3.3 branch.&lt;br/&gt;
Testing done:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ant test-core-java&lt;/li&gt;
	&lt;li&gt;Ran CnxManagerTest 15 times&lt;/li&gt;
	&lt;li&gt;Created 3 node cluster. Rebooted leader several times. Verified thread count.&lt;/li&gt;
	&lt;li&gt;systest&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12998492" author="mahadev" created="Wed, 23 Feb 2011 18:31:13 +0000"  >&lt;p&gt;thanks Vishal!&lt;/p&gt;</comment>
                            <comment id="12998493" author="vishalmlst" created="Wed, 23 Feb 2011 18:31:29 +0000"  >&lt;p&gt;submitting patch&lt;/p&gt;</comment>
                            <comment id="12998495" author="mahadev" created="Wed, 23 Feb 2011 18:33:55 +0000"  >&lt;p&gt;+1 the patch looks good to me. Ill leave the committing to ben!&lt;/p&gt;</comment>
                            <comment id="12998497" author="hadoopqa" created="Wed, 23 Feb 2011 18:42:02 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12471761/ZOOKEEPER-880-3.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12471761/ZOOKEEPER-880-3.3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1072085.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/156//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/156//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12998555" author="breed" created="Wed, 23 Feb 2011 21:28:58 +0000"  >&lt;p&gt;thanx for backporting vishal!&lt;/p&gt;</comment>
                            <comment id="12998602" author="breed" created="Wed, 23 Feb 2011 23:19:14 +0000"  >&lt;p&gt;Committed revision 1073983.&lt;/p&gt;</comment>
                            <comment id="13004187" author="vishalmlst" created="Tue, 8 Mar 2011 20:28:53 +0000"  >&lt;p&gt;For some reason the patch didn&apos;t get committed to trunk. Reopening to submit patch to trunk.&lt;/p&gt;</comment>
                            <comment id="13004189" author="vishalmlst" created="Tue, 8 Mar 2011 20:29:44 +0000"  >&lt;p&gt;Changing version tags.&lt;/p&gt;</comment>
                            <comment id="13004244" author="vishalmlst" created="Tue, 8 Mar 2011 21:54:02 +0000"  >&lt;p&gt;Submitting patch for trunk.&lt;/p&gt;</comment>
                            <comment id="13006577" author="hadoopqa" created="Mon, 14 Mar 2011 19:04:02 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12473063/ZOOKEEPER-trunk-880&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12473063/ZOOKEEPER-trunk-880&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1074995.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/187//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/187//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/187//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/187//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/187//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-ZOOKEEPER-Build/187//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13007568" author="breed" created="Wed, 16 Mar 2011 17:08:50 +0000"  >&lt;p&gt;+1 looks good vishal. does this patch fix other issues as well? (like &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-939&quot; title=&quot;the threads number of a zookeeper is increased all the time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-939&quot;&gt;&lt;del&gt;ZOOKEEPER-939&lt;/del&gt;&lt;/a&gt;?)&lt;/p&gt;</comment>
                            <comment id="13007622" author="breed" created="Wed, 16 Mar 2011 18:49:33 +0000"  >&lt;p&gt;Committed revision 1082260.&lt;/p&gt;</comment>
                            <comment id="13007887" author="hudson" created="Thu, 17 Mar 2011 10:54:30 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #1124 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/ZooKeeper-trunk/1124/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/ZooKeeper-trunk/1124/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-880&quot; title=&quot;QuorumCnxManager$SendWorker grows without bounds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-880&quot;&gt;&lt;del&gt;ZOOKEEPER-880&lt;/del&gt;&lt;/a&gt;. QuorumCnxManager$SendWorker grows without bounds&lt;/p&gt;</comment>
                            <comment id="13008608" author="vishalmlst" created="Fri, 18 Mar 2011 20:08:19 +0000"  >&lt;p&gt;Hi Ben,&lt;/p&gt;

&lt;p&gt;The patch might fix &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-939&quot; title=&quot;the threads number of a zookeeper is increased all the time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-939&quot;&gt;&lt;del&gt;ZOOKEEPER-939&lt;/del&gt;&lt;/a&gt;. However, &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-939&quot; title=&quot;the threads number of a zookeeper is increased all the time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-939&quot;&gt;&lt;del&gt;ZOOKEEPER-939&lt;/del&gt;&lt;/a&gt; does not describe how they ran into this situation (and has not attached logs). &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-939&quot; title=&quot;the threads number of a zookeeper is increased all the time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-939&quot;&gt;&lt;del&gt;ZOOKEEPER-939&lt;/del&gt;&lt;/a&gt;  can be closed if the problem is not seen after this patch.&lt;/p&gt;

&lt;p&gt;-Vishal&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12480225">ZOOKEEPER-934</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12480773">ZOOKEEPER-939</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12475489">ZOOKEEPER-883</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12455853" name="TRACE-hbase-hadoop-zookeeper-sv4borg9.log.gz" size="575370" author="jdcryans" created="Tue, 28 Sep 2010 18:36:29 +0100"/>
                            <attachment id="12471761" name="ZOOKEEPER-880-3.3.patch" size="8643" author="vishalmlst" created="Wed, 23 Feb 2011 18:27:57 +0000"/>
                            <attachment id="12465666" name="ZOOKEEPER-880.patch" size="8635" author="vishalmlst" created="Tue, 7 Dec 2010 07:05:12 +0000"/>
                            <attachment id="12464977" name="ZOOKEEPER-880.patch" size="8691" author="vishalmlst" created="Tue, 30 Nov 2010 19:08:43 +0000"/>
                            <attachment id="12460041" name="ZOOKEEPER-880.patch" size="2073" author="vishalmlst" created="Fri, 19 Nov 2010 19:59:45 +0000"/>
                            <attachment id="12473063" name="ZOOKEEPER-trunk-880" size="14118" author="vishalmlst" created="Tue, 8 Mar 2011 21:54:02 +0000"/>
                            <attachment id="12455777" name="hbase-hadoop-zookeeper-sv4borg12.log.gz" size="3002" author="jdcryans" created="Tue, 28 Sep 2010 00:42:32 +0100"/>
                            <attachment id="12455778" name="hbase-hadoop-zookeeper-sv4borg9.log.gz" size="4392" author="jdcryans" created="Tue, 28 Sep 2010 00:42:32 +0100"/>
                            <attachment id="12455779" name="jstack" size="36411" author="jdcryans" created="Tue, 28 Sep 2010 00:42:32 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 28 Sep 2010 05:44:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47567</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxztxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32834</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>