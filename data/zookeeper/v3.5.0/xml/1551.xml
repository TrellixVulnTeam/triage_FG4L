<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:49:38 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1551/ZOOKEEPER-1551.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1551] Observers ignore txns that come after snapshot and UPTODATE </title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1551</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;In Learner.java, txns which comes after the learner has taken the snapshot (after NEWLEADER packet) are stored in packetsNotCommitted. The follower has special logic to apply these txns at the end of syncWithLeader() method. However, the observer will ignore these txns completely, causing data inconsistency. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12609708">ZOOKEEPER-1551</key>
            <summary>Observers ignore txns that come after snapshot and UPTODATE </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thawan">Thawan Kooburat</assignee>
                                    <reporter username="thawan">Thawan Kooburat</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Oct 2012 01:57:32 +0100</created>
                <updated>Thu, 13 Mar 2014 18:17:01 +0000</updated>
                            <resolved>Tue, 8 Oct 2013 17:34:35 +0100</resolved>
                                    <version>3.4.3</version>
                                    <fixVersion>3.4.6</fixVersion>
                    <fixVersion>3.5.0</fixVersion>
                                    <component>quorum</component>
                    <component>server</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13466610" author="thawan" created="Mon, 1 Oct 2012 02:40:36 +0100"  >&lt;p&gt;This is patch is created using --ignore-all-space flag, since my editor is configured to trim all white spaces. So the indentation is incorrect in one place.&lt;/p&gt;

&lt;p&gt;We recently found this issue since we enabled  sync request processor in the observer (&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1552&quot; title=&quot;Enable sync request processor in Observer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1552&quot;&gt;&lt;del&gt;ZOOKEEPER-1552&lt;/del&gt;&lt;/a&gt;). So we saw that the snapshot is invalid in some machines.    &lt;/p&gt;
</comment>
                            <comment id="13466611" author="thawan" created="Mon, 1 Oct 2012 02:46:22 +0100"  >&lt;p&gt;The change to Leader.java is just for optimization. I don&apos;t think it break the compatibility. &lt;/p&gt;</comment>
                            <comment id="13466613" author="hadoopqa" created="Mon, 1 Oct 2012 03:09:38 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12547189/ZOOKEEPER-1551.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12547189/ZOOKEEPER-1551.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1391526.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1198//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1198//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1198//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1198//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1198//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1198//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13467213" author="fpj" created="Mon, 1 Oct 2012 22:39:12 +0100"  >&lt;p&gt;I&apos;d like to ask a couple of quick clarifications about this patch if you don&apos;t mind:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Given that in Learner both follower and observer need to commit transactions after the snapshot, do we really need different code for follower and observer?&lt;/li&gt;
	&lt;li&gt;Observers also need to receive outstanding proposals, since commits do not have the proposals themselves, so I was wondering if the last optimization introduced in Leader is actually correct.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Thanks! &lt;/p&gt;</comment>
                            <comment id="13467403" author="thawan" created="Tue, 2 Oct 2012 03:01:54 +0100"  >&lt;p&gt;1. If we do a bit of refactoring on ObserverZookeeperServer, then it should be able to use the same logic. However, this will also require us keep track of pendingTxns like FollowerZookeeperServer which have a separate method for logRequest() and commit(). &lt;/p&gt;

&lt;p&gt;2. During normal operation, observers receive in-flight txns via INFORM packets which include the request itself. So the request from outstanding proposals will eventually reach the observer as INFORM packet after startForwarding() is called. There is no need for observer to receive these proposals.&lt;/p&gt;

&lt;p&gt;I intended to have this patch on-top of &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1552&quot; title=&quot;Enable sync request processor in Observer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1552&quot;&gt;&lt;del&gt;ZOOKEEPER-1552&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13468819" author="fpj" created="Wed, 3 Oct 2012 21:49:30 +0100"  >&lt;p&gt;Thanks for the clarifications. I actually forgot that we send the transaction with INFORM. &lt;/p&gt;

&lt;p&gt;I was wondering about this part of the code:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+                    if (!snapshotTaken) {
+                        // Apply to db directly if we haven&apos;t taken the snapshot
+                        zk.processTxn(packet.hdr, packet.rec);
+                    } else {
+                        packetsNotCommitted.add(packet);
+                        packetsCommitted.add(qp.getZxid());
+                    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;INFORM is supposed to inform an observer of a committed transaction, so why keep them as not committed? I&apos;m getting the impression that this is related to the issue of &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1549&quot; title=&quot;Data inconsistency when follower is receiving a DIFF with a dirty snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1549&quot;&gt;ZOOKEEPER-1549&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13468843" author="thawan" created="Wed, 3 Oct 2012 22:18:33 +0100"  >&lt;p&gt;This is to make &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1552&quot; title=&quot;Enable sync request processor in Observer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1552&quot;&gt;&lt;del&gt;ZOOKEEPER-1552&lt;/del&gt;&lt;/a&gt; works correctly.  Previously, Observer only create a snapshot after sync-up and never write to disk at all. &lt;/p&gt;

&lt;p&gt;We need to log INFORM packets, which come after the snapshot is taken, to disk like the followers. So that on the next restart, these txns won&apos;t be missing (if the observer is restarted before the next snapshot)  &lt;/p&gt;

&lt;p&gt;The patch has 5 lines commented in the unit test (Since it requires &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1552&quot; title=&quot;Enable sync request processor in Observer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1552&quot;&gt;&lt;del&gt;ZOOKEEPER-1552&lt;/del&gt;&lt;/a&gt;) which will cover this case. &lt;/p&gt;</comment>
                            <comment id="13471021" author="fpj" created="Sat, 6 Oct 2012 15:17:44 +0100"  >&lt;p&gt;I understand that this patch reflects the follower behavior. However, as per &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1549&quot; title=&quot;Data inconsistency when follower is receiving a DIFF with a dirty snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1549&quot;&gt;ZOOKEEPER-1549&lt;/a&gt;, this behavior is not correct because a snapshot at that point might contain uncommitted state. If we commit this patch, then we will need to fix it in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1559&quot; title=&quot;Learner should not snapshot uncommitted state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1559&quot;&gt;ZOOKEEPER-1559&lt;/a&gt;. What do you think?&lt;/p&gt;

</comment>
                            <comment id="13471706" author="thawan" created="Mon, 8 Oct 2012 19:02:01 +0100"  >&lt;p&gt;I think this patch is very critical and we need to fix it as soon as possible since data inconsistency occur quite frequent in our environment due to this bug. &lt;/p&gt;

&lt;p&gt;The current patch doesn&apos;t break the compatibility so we can commit it. Then, we can revisit/rewrite this logic as needed to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1559&quot; title=&quot;Learner should not snapshot uncommitted state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1559&quot;&gt;ZOOKEEPER-1559&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="13471831" author="fpj" created="Mon, 8 Oct 2012 21:22:14 +0100"  >&lt;p&gt;Sounds fine. I&apos;d like to have closer look at the tests, but otherwise it looks good to me.&lt;/p&gt;</comment>
                            <comment id="13531236" author="fpj" created="Thu, 13 Dec 2012 17:49:16 +0000"  >&lt;p&gt;The patch looks mostly good to me. I have three comments:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;The leading spaces of Leader.java and Learner.java are not right. Also about format, there are very long lines in the test part of the patch.&lt;/li&gt;
	&lt;li&gt;I don&apos;t understand why @Test is commented out for TestUnecessarySnap. Is it accidental?&lt;/li&gt;
	&lt;li&gt;If this condition holds &quot;(p.hdr.getZxid() != zxid)&quot; it sounds like we need to do more than just logging a warn, no? What about throwing an exception here?&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13591246" author="thawan" created="Sat, 2 Mar 2013 03:27:32 +0000"  >&lt;p&gt;Also need to validate that snapshot data is correct&lt;/p&gt;</comment>
                            <comment id="13591262" author="thawan" created="Sat, 2 Mar 2013 03:48:05 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Fixed indentation&lt;/li&gt;
	&lt;li&gt;Fixed incorrect comments&lt;/li&gt;
	&lt;li&gt;Rebase with trunk&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I only print warning message since I use the same code block that we use to print warning message when we get out-of-order txn. Also, it will print false positive message when receiving the first message. Since this code block is going to be rewritten anyway in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1549&quot; title=&quot;Data inconsistency when follower is receiving a DIFF with a dirty snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1549&quot;&gt;ZOOKEEPER-1549&lt;/a&gt;, so I don&apos;t want to put more effort on it. &lt;/p&gt;

&lt;p&gt;I think this patch will go to 3.4.6 only but generate patch based on trunk so that I can trigger unit test&lt;/p&gt;</comment>
                            <comment id="13591348" author="hadoopqa" created="Sat, 2 Mar 2013 07:59:35 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12571724/ZOOKEEPER-1551.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12571724/ZOOKEEPER-1551.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1448007.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1415//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1415//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1415//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1415//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1415//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1415//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13592043" author="mahadev" created="Mon, 4 Mar 2013 07:41:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;Flavio Junqueira&lt;/a&gt; would you be able to review the latest patch?&lt;/p&gt;</comment>
                            <comment id="13649707" author="fpj" created="Mon, 6 May 2013 13:48:07 +0100"  >&lt;p&gt;I have generated a new version of this patch that applies to trunk. The previous patch that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thawan&quot; class=&quot;user-hover&quot; rel=&quot;thawan&quot;&gt;Thawan Kooburat&lt;/a&gt; generated has also been affected by the &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-107&quot; title=&quot;Allow dynamic changes to server cluster membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-107&quot;&gt;&lt;del&gt;ZOOKEEPER-107&lt;/del&gt;&lt;/a&gt; changes. &lt;/p&gt;

&lt;p&gt;This patch depends on &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1552&quot; title=&quot;Enable sync request processor in Observer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1552&quot;&gt;&lt;del&gt;ZOOKEEPER-1552&lt;/del&gt;&lt;/a&gt; and I verified that the patch there applies to trunk. &lt;/p&gt;

&lt;p&gt;Now I&apos;m a bit confused about the fix versions of these issues. This one says 3.4.6 and 3.5.0. &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1552&quot; title=&quot;Enable sync request processor in Observer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1552&quot;&gt;&lt;del&gt;ZOOKEEPER-1552&lt;/del&gt;&lt;/a&gt; says 3.5.0. This comments from Thawan:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1551?focusedCommentId=13591262&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13591262&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1551?focusedCommentId=13591262&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13591262&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;says that it might be for 3.4.6 only. To me it sounds like it should be in 3.5.0, since &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1552&quot; title=&quot;Enable sync request processor in Observer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1552&quot;&gt;&lt;del&gt;ZOOKEEPER-1552&lt;/del&gt;&lt;/a&gt; is an improvement, having it in 3.4.6 is optional. Any opinion here?&lt;/p&gt;</comment>
                            <comment id="13650430" author="thawan" created="Tue, 7 May 2013 03:49:14 +0100"  >&lt;p&gt;This patch depends on &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1552&quot; title=&quot;Enable sync request processor in Observer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1552&quot;&gt;&lt;del&gt;ZOOKEEPER-1552&lt;/del&gt;&lt;/a&gt; for unit testing purpose. If we don&apos;t want to put 1552 into 3.4 branch, then we just need to modify the unit test to verify the observer via its in-memory db instead of reading from data dir.&lt;/p&gt;

&lt;p&gt;For 3.5, this problem will be fixed as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1549&quot; title=&quot;Data inconsistency when follower is receiving a DIFF with a dirty snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1549&quot;&gt;ZOOKEEPER-1549&lt;/a&gt; I think we can also commit this to trunk as well.  &lt;/p&gt;</comment>
                            <comment id="13650961" author="fpj" created="Tue, 7 May 2013 16:27:52 +0100"  >&lt;p&gt;I&apos;m really confuse about all the sequence of jiras that we need to get it. According to my bookkeeping, we have: &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1413&quot; title=&quot;Use on-disk transaction log for learner sync up&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1413&quot;&gt;&lt;del&gt;ZOOKEEPER-1413&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1549&quot; title=&quot;Data inconsistency when follower is receiving a DIFF with a dirty snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1549&quot;&gt;ZOOKEEPER-1549&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1552&quot; title=&quot;Enable sync request processor in Observer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1552&quot;&gt;&lt;del&gt;ZOOKEEPER-1552&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1642&quot; title=&quot;Leader loading database twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1642&quot;&gt;&lt;del&gt;ZOOKEEPER-1642&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1667&quot; title=&quot;Watch event isn&amp;#39;t handled correctly when a client reestablish to a server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1667&quot;&gt;&lt;del&gt;ZOOKEEPER-1667&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1674&quot; title=&quot;There is no need to clear &amp;amp; load the database across leader election&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1674&quot;&gt;ZOOKEEPER-1674&lt;/a&gt;. Am I missing any? Now, I&apos;d like to understand which order we need to follow to get them in. Should we have a discussion on the dev list about it?&lt;/p&gt;</comment>
                            <comment id="13659067" author="thawan" created="Thu, 16 May 2013 01:13:14 +0100"  >&lt;p&gt;Here is the list of dependencies and status of the blocker patch which I am involved with &lt;br/&gt;
3.4.6 blocker issues:  &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1549&quot; title=&quot;Data inconsistency when follower is receiving a DIFF with a dirty snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1549&quot;&gt;ZOOKEEPER-1549&lt;/a&gt; -&amp;gt; partially fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1558&quot; title=&quot;Leader should not snapshot uncommitted state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1558&quot;&gt;&lt;del&gt;ZOOKEEPER-1558&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1551&quot; title=&quot;Observers ignore txns that come after snapshot and UPTODATE &quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1551&quot;&gt;&lt;del&gt;ZOOKEEPER-1551&lt;/del&gt;&lt;/a&gt; -&amp;gt; fixed but depends on &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1552&quot; title=&quot;Enable sync request processor in Observer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1552&quot;&gt;&lt;del&gt;ZOOKEEPER-1552&lt;/del&gt;&lt;/a&gt;.  If we don&apos;t want to include &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1552&quot; title=&quot;Enable sync request processor in Observer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1552&quot;&gt;&lt;del&gt;ZOOKEEPER-1552&lt;/del&gt;&lt;/a&gt;,the patch need more work&lt;/p&gt;

&lt;p&gt;3.5 blocker issues: &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1549&quot; title=&quot;Data inconsistency when follower is receiving a DIFF with a dirty snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1549&quot;&gt;ZOOKEEPER-1549&lt;/a&gt; -&amp;gt; need rework and also depends on &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1413&quot; title=&quot;Use on-disk transaction log for learner sync up&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1413&quot;&gt;&lt;del&gt;ZOOKEEPER-1413&lt;/del&gt;&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1642&quot; title=&quot;Leader loading database twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1642&quot;&gt;&lt;del&gt;ZOOKEEPER-1642&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1551&quot; title=&quot;Observers ignore txns that come after snapshot and UPTODATE &quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1551&quot;&gt;&lt;del&gt;ZOOKEEPER-1551&lt;/del&gt;&lt;/a&gt; -&amp;gt; fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1549&quot; title=&quot;Data inconsistency when follower is receiving a DIFF with a dirty snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1549&quot;&gt;ZOOKEEPER-1549&lt;/a&gt; and depends on &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1552&quot; title=&quot;Enable sync request processor in Observer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1552&quot;&gt;&lt;del&gt;ZOOKEEPER-1552&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We might need to discuss in dev list to get all the block issue resolved&lt;/p&gt;</comment>
                            <comment id="13767292" author="thawan" created="Sat, 14 Sep 2013 02:56:23 +0100"  >&lt;p&gt;Upload 3.4 patch&lt;/p&gt;</comment>
                            <comment id="13782622" author="thawan" created="Tue, 1 Oct 2013 05:28:47 +0100"  >&lt;p&gt;Rebase and enable test that depends on &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1552&quot; title=&quot;Enable sync request processor in Observer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1552&quot;&gt;&lt;del&gt;ZOOKEEPER-1552&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13782634" author="hadoopqa" created="Tue, 1 Oct 2013 05:58:39 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12606039/ZOOKEEPER-1551-trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12606039/ZOOKEEPER-1551-trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1527775.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1610//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1610//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1610//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1610//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1610//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1610//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13783386" author="fpj" created="Tue, 1 Oct 2013 22:42:12 +0100"  >&lt;p&gt;There was one test failure and it seems related to this patch. &lt;/p&gt;</comment>
                            <comment id="13783416" author="fpj" created="Tue, 1 Oct 2013 23:21:04 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thawan&quot; class=&quot;user-hover&quot; rel=&quot;thawan&quot;&gt;Thawan Kooburat&lt;/a&gt;, I also tried to compile with the b3.4 patch and it fails. The patch applies, but it looks like a few things have changed. &lt;/p&gt;</comment>
                            <comment id="13783471" author="thawan" created="Wed, 2 Oct 2013 00:20:44 +0100"  >&lt;p&gt;yeah, I will look into it and update the patch&lt;/p&gt;</comment>
                            <comment id="13783620" author="thawan" created="Wed, 2 Oct 2013 04:57:31 +0100"  >&lt;p&gt;Testing is failing because syncEnabled is not enable by default when QuorumPeer object is created directly.&lt;/p&gt;</comment>
                            <comment id="13784458" author="fpj" created="Wed, 2 Oct 2013 22:31:29 +0100"  >&lt;p&gt;I think you meant to submit this patch, yes? Also, will you update the b3.4 patch?&lt;/p&gt;</comment>
                            <comment id="13784537" author="hadoopqa" created="Wed, 2 Oct 2013 23:18:06 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12606246/ZOOKEEPER-1551-trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12606246/ZOOKEEPER-1551-trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1528586.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1630//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1630//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1630//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1630//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1630//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/1630//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13785623" author="fpj" created="Thu, 3 Oct 2013 23:47:14 +0100"  >&lt;p&gt;I have generated a patch for b3.4, I hope it is ok. Could you please review it, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thawan&quot; class=&quot;user-hover&quot; rel=&quot;thawan&quot;&gt;Thawan Kooburat&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13786706" author="thawan" created="Fri, 4 Oct 2013 23:44:34 +0100"  >&lt;p&gt;b3.4 patch looks good for me (+1). If the trunk patch also looks good to you, I will commit the patch   &lt;/p&gt;</comment>
                            <comment id="13787225" author="fpj" created="Sat, 5 Oct 2013 15:12:48 +0100"  >&lt;p&gt;+1 for the trunk patch.&lt;/p&gt;</comment>
                            <comment id="13788871" author="thawan" created="Tue, 8 Oct 2013 04:21:57 +0100"  >&lt;p&gt;committed to 3.5.0 and 3.4.6&lt;/p&gt;</comment>
                            <comment id="13789047" author="fpj" created="Tue, 8 Oct 2013 09:44:28 +0100"  >&lt;p&gt;b3.4: 1530035&lt;br/&gt;
trunk: 1530029&lt;/p&gt;</comment>
                            <comment id="13789110" author="hudson" created="Tue, 8 Oct 2013 12:12:32 +0100"  >&lt;p&gt;SUCCESS: Integrated in ZooKeeper-trunk #2082 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/2082/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/2082/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1551&quot; title=&quot;Observers ignore txns that come after snapshot and UPTODATE &quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1551&quot;&gt;&lt;del&gt;ZOOKEEPER-1551&lt;/del&gt;&lt;/a&gt;. Observers ignore txns that come after snapshot and UPTODATE (thawan, fpj via thawan) (thawan: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1530029&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1530029&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Leader.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Learner.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeer.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/Zab1_0Test.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13933733" author="fpj" created="Thu, 13 Mar 2014 18:17:01 +0000"  >&lt;p&gt;Closing issues after releasing 3.4.6.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12609709">ZOOKEEPER-1552</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12603175" name="ZOOKEEPER-1551-3.4.patch" size="17663" author="thawan" created="Sat, 14 Sep 2013 02:56:23 +0100"/>
                            <attachment id="12606669" name="ZOOKEEPER-1551-b3.4.patch" size="20270" author="fpj" created="Thu, 3 Oct 2013 23:47:14 +0100"/>
                            <attachment id="12606246" name="ZOOKEEPER-1551-trunk.patch" size="21279" author="thawan" created="Wed, 2 Oct 2013 04:57:31 +0100"/>
                            <attachment id="12606039" name="ZOOKEEPER-1551-trunk.patch" size="20658" author="thawan" created="Tue, 1 Oct 2013 05:28:47 +0100"/>
                            <attachment id="12581877" name="ZOOKEEPER-1551-trunk.patch" size="20915" author="fpj" created="Mon, 6 May 2013 13:38:18 +0100"/>
                            <attachment id="12571724" name="ZOOKEEPER-1551.patch" size="17810" author="thawan" created="Sat, 2 Mar 2013 03:48:05 +0000"/>
                            <attachment id="12547189" name="ZOOKEEPER-1551.patch" size="17200" author="thawan" created="Mon, 1 Oct 2012 02:40:36 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 1 Oct 2012 02:09:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>239554</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxulov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2333</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>