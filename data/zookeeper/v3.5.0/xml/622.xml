<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:44:33 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-622/ZOOKEEPER-622.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-622] Test for pending watches in send_set_watches should be moved</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-622</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;Valgrind found:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;==2357== Conditional jump or move depends on uninitialised value(s)&lt;br/&gt;
==2357==    at 0x807FDCA: check_events (zookeeper.c:1180)&lt;br/&gt;
==2357==    by 0x808043A: zookeeper_process (zookeeper.c:1775)&lt;br/&gt;
==2357==    by 0x806A21B: Zookeeper_close::testCloseConnected1() (TestZookeeperClose.cc:161)&lt;br/&gt;
==2357==    by 0x806C6BF: CppUnit::TestCaller&amp;lt;Zookeeper_close&amp;gt;::runTest() (TestCaller.h:166)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;zookeeper.c:1180 was the first if in send_set_watches.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12443191">ZOOKEEPER-622</key>
            <summary>Test for pending watches in send_set_watches should be moved</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="breed">Benjamin Reed</assignee>
                                    <reporter username="stevechy">Steven Cheng</reporter>
                        <labels>
                    </labels>
                <created>Sat, 12 Dec 2009 22:22:59 +0000</created>
                <updated>Fri, 26 Mar 2010 17:25:08 +0000</updated>
                            <resolved>Sat, 6 Mar 2010 05:35:08 +0000</resolved>
                                                    <fixVersion>3.3.0</fixVersion>
                                    <component>c client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12789807" author="stevechy" created="Sat, 12 Dec 2009 22:26:03 +0000"  >&lt;p&gt;This patch moves the check for outstanding watches in send_set_watches, going to try to figure out how to test this later, any suggestions?&lt;/p&gt;</comment>
                            <comment id="12789830" author="mahadev" created="Sun, 13 Dec 2009 01:05:18 +0000"  >&lt;p&gt;this looks like a critical problem. This could cause setwatches never to be set if the count is initialized to 0 for all the three watches. We should definitely have a test  case for this. How about setting a watch on a zookeeper server and shutting it down and making sure that the watch gets fired on the second server it reconnects to? &lt;/p&gt;</comment>
                            <comment id="12790534" author="stevechy" created="Tue, 15 Dec 2009 02:53:31 +0000"  >&lt;p&gt;Sounds good Mahadev, I&apos;ll get started on it.&lt;/p&gt;</comment>
                            <comment id="12800956" author="mahadev" created="Fri, 15 Jan 2010 22:30:13 +0000"  >&lt;p&gt;steve, any update on this? we should try to get this into 3.3.0&lt;/p&gt;</comment>
                            <comment id="12801264" author="stevechy" created="Sat, 16 Jan 2010 20:07:02 +0000"  >&lt;p&gt;Looks like I need to add multi server handling to the C tests to manage this, I&apos;ll try to get a rough cut done and post the patch.&lt;/p&gt;</comment>
                            <comment id="12801294" author="stevechy" created="Sat, 16 Jan 2010 23:04:13 +0000"  >&lt;p&gt;Started on adding multi server testing for C client, started creating the scripts, got stuck. main() in TestDriver.cc will always start the single server.&lt;/p&gt;

&lt;p&gt;This patch has the scripts that I created so far.&lt;/p&gt;

&lt;p&gt;It looks like adding this will need quite a few changes.  Should I open a new JIRA?&lt;/p&gt;</comment>
                            <comment id="12803407" author="phunt" created="Thu, 21 Jan 2010 18:34:01 +0000"  >&lt;p&gt;Ben, can you look at this as well? seems related to the close?&lt;/p&gt;</comment>
                            <comment id="12805378" author="hadoopqa" created="Wed, 27 Jan 2010 06:14:21 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12430524/ZOOKEEPER-622.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12430524/ZOOKEEPER-622.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 903483.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 36 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    -1 release audit.  The applied patch generated 6 release audit warnings (more than the trunk&apos;s current 1 warnings).&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/60/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/60/testReport/&lt;/a&gt;&lt;br/&gt;
Release audit warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/60/artifact/trunk/patchprocess/releaseAuditDiffWarnings.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/60/artifact/trunk/patchprocess/releaseAuditDiffWarnings.txt&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/60/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/60/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/60/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/60/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12805515" author="breed" created="Wed, 27 Jan 2010 14:34:52 +0000"  >&lt;p&gt;good catch steven and excellent patch! will you put the license header in the generateCfgs.sh script? will you also put the header at the end of localserverlist (making it a footer &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; to avoid a release warning?&lt;/p&gt;</comment>
                            <comment id="12805524" author="breed" created="Wed, 27 Jan 2010 14:55:29 +0000"  >&lt;p&gt;sorry, i looked at this a bit more closely and i realized that we can&apos;t really assume that there is a /tmp. we should be using  $&lt;/p&gt;
{base_dir}
&lt;p&gt;/build/tmp/ i&apos;ll take a whack at fixing the zkMultiServer.sh.&lt;/p&gt;</comment>
                            <comment id="12805631" author="breed" created="Wed, 27 Jan 2010 20:03:40 +0000"  >&lt;p&gt;hey steven, it appears the test case isn&apos;t testing anything. can you clarify how it works?&lt;/p&gt;</comment>
                            <comment id="12805746" author="stevechy" created="Thu, 28 Jan 2010 02:07:05 +0000"  >&lt;p&gt;Hi Ben, sorry about that, this was just a rough cut patch, I got stuck when I tried to add zkMultiServer.sh into the tests since the Zookeeper server gets started in main() rather than in the test classes, so I posted it here to see if I was on the right track.   Not sure if that was the right thing to do, mainly didn&apos;t want to go through and start changing all of the test setup without checking first.&lt;/p&gt;

&lt;p&gt;If there isn&apos;t anything wrong with moving the Zookeeper server startup into the setup() methods of the test classes, I can probably get the patch starting up multiple servers in /tmp and the basic test in place after some work.  To handle $base_dir I was planning to generate the config files somewhere in $base_dir and point the server to them.&lt;/p&gt;</comment>
                            <comment id="12829180" author="breed" created="Wed, 3 Feb 2010 18:40:53 +0000"  >&lt;p&gt;sorry steven, i didn&apos;t notice that you had commented. yes, please finish the test you can make simplifying assumptions such as /tmp and i can help you clean it up once things are working. thanx!&lt;/p&gt;</comment>
                            <comment id="12837138" author="stevechy" created="Tue, 23 Feb 2010 08:21:19 +0000"  >&lt;p&gt;A working test case for watch transfer with multiple hosts.  I left testScript in there because it is quite useful for basic sanity testing for the scripts.&lt;/p&gt;
</comment>
                            <comment id="12837139" author="stevechy" created="Tue, 23 Feb 2010 08:32:59 +0000"  >&lt;p&gt;This patch works but is still in rough shape!  The multi host test servers are started on separate ports and are running concurrently with the single host test server.  Would be helpful to make this more clear.&lt;/p&gt;

&lt;p&gt;Paths still hardcoded to /tmp.&lt;/p&gt;

&lt;p&gt;zooX.cfg are in the patch but are generated by generateCfgs.sh&lt;/p&gt;

&lt;p&gt;I encountered a ZCONNECTIONLOSS from an operation executed after the client reconnects to a new host.  Adds an awkward section to the test case.  I guess in some sense the client should not be oblivious to one of these &quot;lucky&quot; disconnect/reconnect situations.&lt;/p&gt;
</comment>
                            <comment id="12840857" author="breed" created="Wed, 3 Mar 2010 20:24:52 +0000"  >&lt;p&gt;this is the patch with just the bug fix in it. the system test has been moved to the related jira.&lt;/p&gt;</comment>
                            <comment id="12840978" author="hadoopqa" created="Thu, 4 Mar 2010 00:44:52 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12437783/ZOOKEEPER-622.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12437783/ZOOKEEPER-622.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 918757.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no tests are needed for this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/77/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/77/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/77/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/77/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/77/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h7.grid.sp2.yahoo.net/77/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12842187" author="hadoopqa" created="Sat, 6 Mar 2010 05:26:07 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12437783/ZOOKEEPER-622.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12437783/ZOOKEEPER-622.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 919640.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no tests are needed for this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/132/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/132/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/132/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/132/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/132/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Zookeeper-Patch-h8.grid.sp2.yahoo.net/132/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12842192" author="mahadev" created="Sat, 6 Mar 2010 05:35:08 +0000"  >&lt;p&gt;I just committed this. thanks ben and steven.&lt;/p&gt;</comment>
                            <comment id="12842243" author="hudson" created="Sat, 6 Mar 2010 10:49:12 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #716 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/716/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/ZooKeeper-trunk/716/&lt;/a&gt;)&lt;br/&gt;
    . Test for pending watches in send_set_watches should be moved (ben and steven via mahadev)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12458016">ZOOKEEPER-685</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12437783" name="ZOOKEEPER-622.patch" size="1490" author="breed" created="Wed, 3 Mar 2010 20:24:52 +0000"/>
                            <attachment id="12436686" name="ZOOKEEPER-622.patch" size="22133" author="stevechy" created="Tue, 23 Feb 2010 08:21:19 +0000"/>
                            <attachment id="12430524" name="ZOOKEEPER-622.patch" size="19979" author="stevechy" created="Sat, 16 Jan 2010 23:04:13 +0000"/>
                            <attachment id="12427836" name="ZOOKEEPER-622.patch" size="1490" author="stevechy" created="Sat, 12 Dec 2009 22:26:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 13 Dec 2009 01:05:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47688</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzupz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32961</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>