<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:48:16 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1107/ZOOKEEPER-1107.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1107] automating log and snapshot cleaning</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1107</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;I like to have ZK itself manage the amount of snapshots and logs kept,  instead of relying on the PurgeTxnLog utility.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12511371">ZOOKEEPER-1107</key>
            <summary>automating log and snapshot cleaning</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lakshman">Laxman</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Jun 2011 15:48:22 +0100</created>
                <updated>Wed, 23 Nov 2011 19:22:43 +0000</updated>
                            <resolved>Fri, 2 Sep 2011 21:51:29 +0100</resolved>
                                    <version>3.3.3</version>
                                    <fixVersion>3.4.0</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13053986" author="phunt" created="Thu, 23 Jun 2011 18:22:21 +0100"  >&lt;p&gt;Can you give some rational for this change? Is PTL not sufficient?&lt;/p&gt;

&lt;p&gt;Also see this JIRA, which would make such changes obsolete: &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-323&quot; title=&quot;Log file reuse&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-323&quot;&gt;ZOOKEEPER-323&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;here are some reasons I can remember we do it this way:&lt;br/&gt;
1) keep things simple, eg cron job with a basic script that could do whatever it likes re cleanup - thereby conforming to whatever requirements the operator might have (which will typ be very different from the concerns of the developers)&lt;br/&gt;
2) don&apos;t cleanup unless the operator explicitly requests - ensures we don&apos;t lose data, say the operator is backing up every month, but the default is for zk to cleanup every hour (etc...)&lt;/p&gt;


&lt;p&gt;I don&apos;t see a problem with adding this as long as it&apos;s off by default, obv configurable through the zk config file. What sorts of functionality would be provided by this feature?&lt;/p&gt;

</comment>
                            <comment id="13054187" author="junrao" created="Fri, 24 Jun 2011 01:11:34 +0100"  >&lt;p&gt;There is nothing wrong with having a cron job. It just that there is one more command and one more job for the ops to remember. &lt;/p&gt;</comment>
                            <comment id="13054265" author="lakshman" created="Fri, 24 Jun 2011 07:43:18 +0100"  >&lt;p&gt;Snap and logs clean is a nice to have feature as part of zookeeper rather as a cron.&lt;/p&gt;

&lt;p&gt;I&apos;ve considered the following points apart from the one mentioned by Jun.&lt;br/&gt;
a) Cron jobs are difficult to debug in case of any issue.&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;Yet another process, Logs - Just my personal view&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;b) I would like to run cron job only when zookeeper is running. It will be difficult to manage two different processes &lt;span class=&quot;error&quot;&gt;&amp;#91;from an Operation Management perspective&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;c) &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;don&apos;t cleanup unless the operator explicitly requests &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We can still maintain this by making it configurable.&lt;/p&gt;

&lt;p&gt;Correct me if my understanding is wrong.&lt;/p&gt;

&lt;p&gt;Following is the implementation I&apos;ve in mind.&lt;br/&gt;
a) Number of snapshots to retain and &lt;br/&gt;
b) A purge task will be spawned at the startup.&lt;/p&gt;

&lt;p&gt;I can submit a patch based on suggestions.&lt;/p&gt;</comment>
                            <comment id="13057208" author="lakshman" created="Wed, 29 Jun 2011 13:49:50 +0100"  >&lt;p&gt;Attached the draft version of the patch.&lt;br/&gt;
@Jun &amp;amp; Pat : Please review and give your suggestions to refine it further.&lt;/p&gt;</comment>
                            <comment id="13057224" author="hadoopqa" created="Wed, 29 Jun 2011 14:35:21 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12484646/ZOOKEEPER-1107.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12484646/ZOOKEEPER-1107.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1140017.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The patch appears to cause tar ant target to fail.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to cause Findbugs (version 1.3.9) to fail.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/356//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/356//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/356//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/356//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13057746" author="lakshman" created="Thu, 30 Jun 2011 11:49:05 +0100"  >&lt;p&gt;Updated the patch for the following&lt;br/&gt;
a) Cleared the findbugs noticed in testcode.&lt;br/&gt;
b) Updated the zoo_sample.cfg&lt;br/&gt;
c) Cleared javac warnings.&lt;/p&gt;</comment>
                            <comment id="13057762" author="hadoopqa" created="Thu, 30 Jun 2011 12:31:03 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12484758/ZOOKEEPER-1107.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12484758/ZOOKEEPER-1107.1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1140017.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/361//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/361//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/361//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/361//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/361//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/361//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13057853" author="hadoopqa" created="Thu, 30 Jun 2011 15:41:09 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12484774/ZOOKEEPER-1107.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12484774/ZOOKEEPER-1107.2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1140017.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/362//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/362//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/362//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/362//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/362//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/362//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13058575" author="hadoopqa" created="Fri, 1 Jul 2011 15:31:21 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12484869/ZOOKEEPER-1107.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12484869/ZOOKEEPER-1107.3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1141746.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/365//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/365//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/365//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/365//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/365//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/365//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13058988" author="lakshman" created="Sat, 2 Jul 2011 07:01:10 +0100"  >&lt;blockquote&gt;&lt;p&gt;-1 core tests. The patch failed core unit tests.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There are no test failures in the report.&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/365//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/365//testReport/&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;All Tests
Package    Duration    Fail    (diff)    Skip    (diff)    Total    (diff)    
org.apache.zookeeper  0.79 sec 0  0  19 +4 
org.apache.zookeeper.server  9.1 sec 0  0  26  
org.apache.zookeeper.server.quorum  1 min 45 sec 0  0  8  
org.apache.zookeeper.test  14 min 0  0  272 -2 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13060730" author="phunt" created="Wed, 6 Jul 2011 19:08:40 +0100"  >&lt;p&gt;The C tests failed: (unfort they are not reported in the test results, you have to check the console output)&lt;/p&gt;

&lt;p&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;      &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; make&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: *** No rule to make target `tests/TestMulti.cc&apos;, needed by `zktest_st-TestMulti.o&apos;.  Stop.&lt;/p&gt;

&lt;p&gt;iirc this was due to a bad commit in the mainline - not you. I&apos;ll kick off another patch build for this.&lt;/p&gt;</comment>
                            <comment id="13060753" author="hadoopqa" created="Wed, 6 Jul 2011 19:39:11 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12484869/ZOOKEEPER-1107.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12484869/ZOOKEEPER-1107.3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1142377.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/368//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/368//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/368//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/368//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/368//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/368//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13061654" author="jiraposter@reviews.apache.org" created="Fri, 8 Jul 2011 00:10:17 +0100"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1043/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for zookeeper, Patrick Hunt, Benjamin Reed, and Mahadev Konar.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;I like to have ZK itself manage the amount of snapshots and logs kept, instead of relying on the PurgeTxnLog utility.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; title=&quot;automating log and snapshot cleaning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1107&quot;&gt;&lt;del&gt;ZOOKEEPER-1107&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ./conf/zoo_sample.cfg 1141901 &lt;br/&gt;
  ./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java PRE-CREATION &lt;br/&gt;
  ./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java 1141901 &lt;br/&gt;
  ./src/java/test/org/apache/zookeeper/ZooKeeperPurgeTest.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1043/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;test added, passing hudson qa bot.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Patrick&lt;/p&gt;
</comment>
                            <comment id="13061673" author="jiraposter@reviews.apache.org" created="Fri, 8 Jul 2011 00:34:17 +0100"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1043/#review1000&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#review1000&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Are people just supposed to create their own new ZooKeeperPurger and call start on it? I don&apos;t see any hooks for starting this anywhere, or even a main method to use to start it. Would be nice to give that to people so they have a utility they can run easily.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Camille&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-07-07 23:10:13, Patrick Hunt wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1043/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-07-07 23:10:13)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for zookeeper, Patrick Hunt, Benjamin Reed, and Mahadev Konar.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I like to have ZK itself manage the amount of snapshots and logs kept, instead of relying on the PurgeTxnLog utility.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; title=&quot;automating log and snapshot cleaning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1107&quot;&gt;&lt;del&gt;ZOOKEEPER-1107&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./conf/zoo_sample.cfg 1141901 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java 1141901 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/test/org/apache/zookeeper/ZooKeeperPurgeTest.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1043/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;test added, passing hudson qa bot.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Patrick&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13061675" author="jiraposter@reviews.apache.org" created="Fri, 8 Jul 2011 00:42:16 +0100"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1043/#review998&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#review998&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;The documentation (src/docs) need to be updated - specifically the cleanup section in the admin guide.&lt;/p&gt;

&lt;p&gt;Have you considered hooking this into JMX or the 4letterwords? It would be nice for operators to get basic information. In JMX they could also control the settings... consider for a follow-on JIRA?&lt;/p&gt;


&lt;p&gt;./conf/zoo_sample.cfg&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2060&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2060&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    My personal belief is that this should be turned off by default - i.e. comment out the parameters in the sample config.&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2081&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2081&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    should this be in zookeeper or zookeeper.server ?&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2080&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2080&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    consider calling this something more descriptive - perhaps &quot;DatadirCleanupManager&quot; or similar...&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2069&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2069&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    enum?&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2070&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2070&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    use TimeUnit&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2076&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2076&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    perhaps this should be done in start?&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2074&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2074&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    move this check to the start method.&lt;/p&gt;

&lt;p&gt;    1) INFO level log if turned off&lt;br/&gt;
    2) exit the thread if turned off&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2073&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2073&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    this formatting is not very nice, please adjust it a bit.&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2075&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2075&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I see tests, which is great, however where is this method being called in ZooKeeper server code proper? (what I mean is the server doesn&apos;t seem to be running this)&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2079&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2079&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    given we are tracking the state shouldn&apos;t we be testing that here?&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2077&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2077&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I would rather we check if the state is started. (log warning if not)&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2078&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2078&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Zookeeper should be referred to as &quot;ZooKeeper&quot;&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2067&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2067&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    specify explicit default, 3?&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2068&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2068&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    specify explicit default - e.g. 0.&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2065&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2065&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    the docs should reflect that this only controls the number of snaps to keep, the logs are purged based on the corresponding purged snaps.&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2066&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2066&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    what does &quot;time&quot; refer to. elapsed time? what are the units.&lt;/p&gt;



&lt;p&gt;./src/java/test/org/apache/zookeeper/ZooKeeperPurgeTest.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2082&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2082&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Nice!&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Patrick&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-07-07 23:10:13, Patrick Hunt wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1043/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-07-07 23:10:13)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for zookeeper, Patrick Hunt, Benjamin Reed, and Mahadev Konar.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I like to have ZK itself manage the amount of snapshots and logs kept, instead of relying on the PurgeTxnLog utility.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; title=&quot;automating log and snapshot cleaning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1107&quot;&gt;&lt;del&gt;ZOOKEEPER-1107&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./conf/zoo_sample.cfg 1141901 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java 1141901 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/test/org/apache/zookeeper/ZooKeeperPurgeTest.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1043/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;test added, passing hudson qa bot.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Patrick&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13061676" author="jiraposter@reviews.apache.org" created="Fri, 8 Jul 2011 00:44:16 +0100"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java, lines 74-77&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line74&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line74&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     move this check to the start method.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     1) INFO level log if turned off&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     2) exit the thread if turned off&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sorry, meant exit the start method if turned off (don&apos;t start the timer/task).&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Patrick&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1043/#review998&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#review998&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-07-07 23:10:13, Patrick Hunt wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1043/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-07-07 23:10:13)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for zookeeper, Patrick Hunt, Benjamin Reed, and Mahadev Konar.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I like to have ZK itself manage the amount of snapshots and logs kept, instead of relying on the PurgeTxnLog utility.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; title=&quot;automating log and snapshot cleaning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1107&quot;&gt;&lt;del&gt;ZOOKEEPER-1107&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./conf/zoo_sample.cfg 1141901 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java 1141901 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/test/org/apache/zookeeper/ZooKeeperPurgeTest.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1043/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;test added, passing hudson qa bot.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Patrick&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13061677" author="jiraposter@reviews.apache.org" created="Fri, 8 Jul 2011 00:44:18 +0100"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:34:13, Camille Fournier wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; Are people just supposed to create their own new ZooKeeperPurger and call start on it? I don&apos;t see any hooks for starting this anywhere, or even a main method to use to start it. Would be nice to give that to people so they have a utility they can run easily.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Heh, you beat me to it. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I think it should be started by the server, but the config defaults should have it turned off (time=0) by default. (more in my comments)&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Patrick&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1043/#review1000&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#review1000&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-07-07 23:10:13, Patrick Hunt wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1043/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-07-07 23:10:13)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for zookeeper, Patrick Hunt, Benjamin Reed, and Mahadev Konar.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I like to have ZK itself manage the amount of snapshots and logs kept, instead of relying on the PurgeTxnLog utility.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; title=&quot;automating log and snapshot cleaning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1107&quot;&gt;&lt;del&gt;ZOOKEEPER-1107&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./conf/zoo_sample.cfg 1141901 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java 1141901 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/test/org/apache/zookeeper/ZooKeeperPurgeTest.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1043/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;test added, passing hudson qa bot.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Patrick&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13061842" author="lakshman" created="Fri, 8 Jul 2011 09:32:27 +0100"  >&lt;p&gt;Thanks for your review Pat and Camille. Soon, I will fix all your comments and upload new patch.&lt;/p&gt;</comment>
                            <comment id="13065061" author="lakshman" created="Thu, 14 Jul 2011 06:51:49 +0100"  >&lt;p&gt;One more thing to be taken care.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Use slf4j in the new classes. &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-850&quot; title=&quot;Switch from log4j to slf4j&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-850&quot;&gt;&lt;del&gt;ZOOKEEPER-850&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13065810" author="lakshman" created="Fri, 15 Jul 2011 10:36:54 +0100"  >&lt;p&gt;Attached the reworked patch after fixing the review comments.&lt;/p&gt;</comment>
                            <comment id="13065819" author="jiraposter@reviews.apache.org" created="Fri, 15 Jul 2011 10:57:59 +0100"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; The documentation (src/docs) need to be updated - specifically the cleanup section in the admin guide.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; Have you considered hooking this into JMX or the 4letterwords? It would be nice for operators to get basic information. In JMX they could also control the settings... consider for a follow-on JIRA?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fixed the documentation part.&lt;/p&gt;

&lt;p&gt;@Pat: I guess I&apos;m not clear about how &quot;hooking into JMX or 4 letter-words&quot; will be helpful. Can you please explain this idea? I can takeup this task in separate JIRA.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ./conf/zoo_sample.cfg, lines 15-21&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/diff/1/?file=22148#file22148line15&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff/1/?file=22148#file22148line15&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     My personal belief is that this should be turned off by default - i.e. comment out the parameters in the sample config.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fixed. Also, renamed the configuration keys to make them inline with existing.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ./src/java/test/org/apache/zookeeper/ZooKeeperPurgeTest.java, line 37&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/diff/1/?file=22151#file22151line37&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff/1/?file=22151#file22151line37&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Nice!&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Corrected code format issues.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java, lines 384-385&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/diff/1/?file=22150#file22150line384&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff/1/?file=22150#file22150line384&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     what does &quot;time&quot; refer to. elapsed time? what are the units.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fixed.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java, lines 374-375&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/diff/1/?file=22150#file22150line374&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff/1/?file=22150#file22150line374&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     the docs should reflect that this only controls the number of snaps to keep, the logs are purged based on the corresponding purged snaps.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fixed. Comments are moved to applicable class DatadirCleanupManager and also documented in admin guide as suggested.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java, line 73&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/diff/1/?file=22150#file22150line73&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff/1/?file=22150#file22150line73&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     specify explicit default - e.g. 0.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fixed.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java, line 72&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/diff/1/?file=22150#file22150line72&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff/1/?file=22150#file22150line72&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     specify explicit default, 3?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fixed.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java, line 142&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line142&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line142&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Zookeeper should be referred to as &quot;ZooKeeper&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fixed. Redundant information in logs has been removed.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java, line 118&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line118&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line118&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I would rather we check if the state is started. (log warning if not)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fixed.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java, line 104&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line104&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line104&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     given we are tracking the state shouldn&apos;t we be testing that here?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fixed.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java, line 103&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line103&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line103&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I see tests, which is great, however where is this method being called in ZooKeeper server code proper? (what I mean is the server doesn&apos;t seem to be running this)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Called in QuorumPeerMain. Changes included in the latest patch. &lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java, lines 83-86&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line83&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line83&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     this formatting is not very nice, please adjust it a bit.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fixed in all the places.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java, lines 74-77&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line74&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line74&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     move this check to the start method.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     1) INFO level log if turned off&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     2) exit the thread if turned off&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sorry, meant exit the start method if turned off (don&apos;t start the timer/task).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fixed.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java, line 66&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line66&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line66&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     perhaps this should be done in start?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fixed.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java, line 45&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line45&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line45&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     use TimeUnit&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fixed.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java, lines 39-43&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line39&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line39&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     enum?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Introduced new enum PurgeTaskStatus.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java, line 38&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line38&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line38&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     consider calling this something more descriptive - perhaps &quot;DatadirCleanupManager&quot; or similar...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Renamed the source file and test file as well.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; ./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java, line 19&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line19&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff/1/?file=22149#file22149line19&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     should this be in zookeeper or zookeeper.server ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Moved both source and test files to zookeeper.server package.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Laxman&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1043/#review998&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#review998&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-07-07 23:10:13, Patrick Hunt wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1043/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-07-07 23:10:13)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for zookeeper, Patrick Hunt, Benjamin Reed, and Mahadev Konar.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I like to have ZK itself manage the amount of snapshots and logs kept, instead of relying on the PurgeTxnLog utility.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; title=&quot;automating log and snapshot cleaning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1107&quot;&gt;&lt;del&gt;ZOOKEEPER-1107&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./conf/zoo_sample.cfg 1141901 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java 1141901 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/test/org/apache/zookeeper/ZooKeeperPurgeTest.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1043/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;test added, passing hudson qa bot.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Patrick&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13065922" author="hadoopqa" created="Fri, 15 Jul 2011 14:35:53 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12486574/ZOOKEEPER-1107.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12486574/ZOOKEEPER-1107.4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1146961.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/396//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/396//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/396//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/396//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/396//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/396//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13067962" author="jiraposter@reviews.apache.org" created="Tue, 19 Jul 2011 21:58:57 +0100"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-07-07 23:40:32, Patrick Hunt wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; The documentation (src/docs) need to be updated - specifically the cleanup section in the admin guide.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; Have you considered hooking this into JMX or the 4letterwords? It would be nice for operators to get basic information. In JMX they could also control the settings... consider for a follow-on JIRA?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Laxman Ch wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Fixed the documentation part.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;@Pat: I guess I&apos;m not clear about how &quot;hooking into JMX or 4 letter-words&quot; will be helpful. Can you please explain this idea? I can takeup this task in separate JIRA.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;both JMX and 4letterwords provide insight to the operator into the runtime status of the system&lt;br/&gt;
&lt;a href=&quot;http://zookeeper.apache.org/doc/r3.3.3/zookeeperAdmin.html#sc_zkCommands&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://zookeeper.apache.org/doc/r3.3.3/zookeeperAdmin.html#sc_zkCommands&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://zookeeper.apache.org/doc/r3.3.3/zookeeperJMX.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://zookeeper.apache.org/doc/r3.3.3/zookeeperJMX.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;what I was suggesting is that you could allow such insight into the cleanup task - for example is the process running, when the last time it ran, a history of the files cleaned up and when, stop the task, restart, etc...&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Patrick&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1043/#review998&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#review998&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-07-07 23:10:13, Patrick Hunt wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1043/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-07-07 23:10:13)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for zookeeper, Patrick Hunt, Benjamin Reed, and Mahadev Konar.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I like to have ZK itself manage the amount of snapshots and logs kept, instead of relying on the PurgeTxnLog utility.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; title=&quot;automating log and snapshot cleaning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1107&quot;&gt;&lt;del&gt;ZOOKEEPER-1107&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./conf/zoo_sample.cfg 1141901 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/main/org/apache/zookeeper/ZooKeeperPurger.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java 1141901 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/test/org/apache/zookeeper/ZooKeeperPurgeTest.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1043/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;test added, passing hudson qa bot.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Patrick&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13067966" author="jiraposter@reviews.apache.org" created="Tue, 19 Jul 2011 22:04:58 +0100"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1043/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-07-19 21:04:20.729172)&lt;/p&gt;


&lt;p&gt;Review request for zookeeper, Patrick Hunt, Benjamin Reed, and Mahadev Konar.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Updated with &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; title=&quot;automating log and snapshot cleaning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1107&quot;&gt;&lt;del&gt;ZOOKEEPER-1107&lt;/del&gt;&lt;/a&gt;.4.patch&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;I like to have ZK itself manage the amount of snapshots and logs kept, instead of relying on the PurgeTxnLog utility.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; title=&quot;automating log and snapshot cleaning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1107&quot;&gt;&lt;del&gt;ZOOKEEPER-1107&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ./conf/zoo_sample.cfg 1146568 &lt;br/&gt;
  ./src/docs/src/documentation/content/xdocs/zookeeperAdmin.xml 1146568 &lt;br/&gt;
  ./src/java/main/org/apache/zookeeper/server/DatadirCleanupManager.java PRE-CREATION &lt;br/&gt;
  ./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java 1146568 &lt;br/&gt;
  ./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerMain.java 1146568 &lt;br/&gt;
  ./src/java/test/org/apache/zookeeper/server/DatadirCleanupManagerTest.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1043/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;test added, passing hudson qa bot.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Patrick&lt;/p&gt;
</comment>
                            <comment id="13067981" author="jiraposter@reviews.apache.org" created="Tue, 19 Jul 2011 22:30:57 +0100"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1043/#review1116&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#review1116&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;This is looking pretty close!&lt;/p&gt;


&lt;p&gt;./conf/zoo_sample.cfg&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2277&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2277&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I think something like&lt;/p&gt;

&lt;p&gt;    datadircleanupmanager.snapRetainCount&lt;br/&gt;
    and&lt;br/&gt;
    datadircleanupmanager.purgeInterval&lt;/p&gt;

&lt;p&gt;    would be better here &amp;#8211; less ambiguous&lt;/p&gt;

&lt;p&gt;    (in general we need to cleanup our configuration naming/handling at some point)&lt;/p&gt;



&lt;p&gt;./src/docs/src/documentation/content/xdocs/zookeeperAdmin.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2281&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2281&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    mention that this is &quot;new in 3.4.0&quot; &amp;#8211; see some of the other parameters such as &quot;clientPortAddress&quot; for an example of how to do this.&lt;/p&gt;



&lt;p&gt;./src/docs/src/documentation/content/xdocs/zookeeperAdmin.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2278&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2278&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    something like the following?&lt;/p&gt;

&lt;p&gt;    the &amp;lt;..&amp;gt;snapretaincount&amp;lt;..&amp;gt; most recent snapshots ...&lt;/p&gt;



&lt;p&gt;./src/docs/src/documentation/content/xdocs/zookeeperAdmin.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2279&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2279&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    replace &quot;purges&quot; with &quot;deletes&quot;?&lt;/p&gt;



&lt;p&gt;./src/docs/src/documentation/content/xdocs/zookeeperAdmin.xml&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2280&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2280&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    do you mean something like:&lt;/p&gt;

&lt;p&gt;    &quot;Default is 3. Minimum value is 3.&quot;&lt;/p&gt;

&lt;p&gt;    I think this would be a bit more obvious. Might also be good if we print a warning if user sets to less than 3 (and specify we are using 3)&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/server/DatadirCleanupManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2282&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2282&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    can we add a class javadoc describing this class?&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/server/DatadirCleanupManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2283&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2283&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    should be &quot;DataDirCleanupManager.class&quot; not nioservercnxn.class.&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/server/DatadirCleanupManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2285&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2285&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    move this to QPC, check it there, print a warning if user sets below this, and set the config field to this MIN.&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/server/DatadirCleanupManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2286&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2286&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    if we set this in the constructor we can define these as final.&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/server/DatadirCleanupManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2284&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2284&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    rather than add a dependency on QPC, could we pass these 4 parameters into a constructor for this class? Notice how this also makes your tests easier (no need to meddle with config).&lt;/p&gt;


&lt;p&gt;    shouldn&apos;t we check the state before starting?&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/server/DatadirCleanupManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2287&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2287&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    move this to QPC&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/server/DatadirCleanupManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2288&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2288&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I&apos;d move this to the constructor of this class.&lt;/p&gt;



&lt;p&gt;./src/java/main/org/apache/zookeeper/server/DatadirCleanupManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2289&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2289&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    nit - formatting is a bit off, typ&lt;/p&gt;

&lt;p&gt;    if (foo &amp;lt; bar) &lt;/p&gt;
{
        ...
    }




&lt;p&gt;./src/java/main/org/apache/zookeeper/server/DatadirCleanupManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1043/#comment2292&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/#comment2292&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    final&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Patrick&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-07-19 21:04:20, Patrick Hunt wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1043/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-07-19 21:04:20)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for zookeeper, Patrick Hunt, Benjamin Reed, and Mahadev Konar.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I like to have ZK itself manage the amount of snapshots and logs kept, instead of relying on the PurgeTxnLog utility.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; title=&quot;automating log and snapshot cleaning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1107&quot;&gt;&lt;del&gt;ZOOKEEPER-1107&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./conf/zoo_sample.cfg 1146568 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/docs/src/documentation/content/xdocs/zookeeperAdmin.xml 1146568 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/main/org/apache/zookeeper/server/DatadirCleanupManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java 1146568 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerMain.java 1146568 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;./src/java/test/org/apache/zookeeper/server/DatadirCleanupManagerTest.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1043/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;test added, passing hudson qa bot.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Patrick&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13067983" author="phunt" created="Tue, 19 Jul 2011 22:31:28 +0100"  >&lt;p&gt;I&apos;ve provided some additional f/b through RB.&lt;/p&gt;</comment>
                            <comment id="13068244" author="lakshman" created="Wed, 20 Jul 2011 10:44:15 +0100"  >&lt;p&gt;Thanks for your thorough review Pat.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;datadircleanupmanager.snapRetainCount&lt;br/&gt;
and&lt;br/&gt;
datadircleanupmanager.purgeInterval&lt;/p&gt;

&lt;p&gt;would be better here &#8211; less ambiguous&lt;/p&gt;

&lt;p&gt;(in general we need to cleanup our configuration naming/handling at some point)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In my opinion, prefixing with &quot;datadircleanupmanager&quot; makes the configurations too long. How about naming this feature as &quot;autopurge&quot; prefixing with feature rather than class name like autopurge.snapRetainCount and autopurge.purgeInterval.&lt;/p&gt;</comment>
                            <comment id="13069474" author="lakshman" created="Fri, 22 Jul 2011 10:59:23 +0100"  >&lt;p&gt;Pat, any suggestion on this or shall I submit a patch as per my comments?&lt;/p&gt;</comment>
                            <comment id="13069861" author="phunt" created="Sat, 23 Jul 2011 01:36:01 +0100"  >&lt;p&gt;Yes, I like the &quot;autopurge&quot; prefix much better, good idea!&lt;/p&gt;

&lt;p&gt;Please do update the patch/RB and I&apos;ll take a look.&lt;/p&gt;</comment>
                            <comment id="13072198" author="lakshman" created="Thu, 28 Jul 2011 07:20:41 +0100"  >&lt;p&gt;Updated the patch based on review comments.&lt;/p&gt;</comment>
                            <comment id="13084982" author="lakshman" created="Mon, 15 Aug 2011 08:37:21 +0100"  >&lt;p&gt;uploading patch again to get tested by qa bot.&lt;/p&gt;</comment>
                            <comment id="13084990" author="hadoopqa" created="Mon, 15 Aug 2011 09:03:20 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12490409/ZOOKEEPER-1107.5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12490409/ZOOKEEPER-1107.5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1157698.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/459//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/459//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/459//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/459//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/459//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/459//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13095396" author="jiraposter@reviews.apache.org" created="Thu, 1 Sep 2011 17:42:09 +0100"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1043/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-09-01 16:40:46.185217)&lt;/p&gt;


&lt;p&gt;Review request for zookeeper, Patrick Hunt, Benjamin Reed, and Mahadev Konar.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;updated to 1107.5 patch&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;I like to have ZK itself manage the amount of snapshots and logs kept, instead of relying on the PurgeTxnLog utility.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; title=&quot;automating log and snapshot cleaning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1107&quot;&gt;&lt;del&gt;ZOOKEEPER-1107&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  ./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerMain.java 1149082 &lt;br/&gt;
  ./src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java 1149082 &lt;br/&gt;
  ./src/java/main/org/apache/zookeeper/server/DatadirCleanupManager.java PRE-CREATION &lt;br/&gt;
  ./conf/zoo_sample.cfg 1149082 &lt;br/&gt;
  ./src/docs/src/documentation/content/xdocs/zookeeperAdmin.xml 1149082 &lt;br/&gt;
  ./src/java/test/org/apache/zookeeper/server/DatadirCleanupManagerTest.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1043/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1043/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;test added, passing hudson qa bot.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Patrick&lt;/p&gt;
</comment>
                            <comment id="13095421" author="hadoopqa" created="Thu, 1 Sep 2011 18:02:09 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12490409/ZOOKEEPER-1107.5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12490409/ZOOKEEPER-1107.5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1163106.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/484//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/484//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/484//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/484//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/484//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/484//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13095627" author="phunt" created="Thu, 1 Sep 2011 22:47:01 +0100"  >&lt;p&gt;two small updates - one to the conf file and one to the admin guide.&lt;/p&gt;</comment>
                            <comment id="13095630" author="phunt" created="Thu, 1 Sep 2011 22:53:10 +0100"  >&lt;p&gt;@laxman - I made two small updates &amp;#8211; the patch now looks good to me and I feel is ready to commit. &lt;/p&gt;

&lt;p&gt;However one thing I realized during this last review - it might be the case that people would want finer grain control on the frequency of purge (say they are getting large numbers of writes/second). So really having the period specified in minutes rather than hours is what I&apos;m thinking.&lt;/p&gt;

&lt;p&gt;Does this make sense to you? Would you mind updating the patch for this? (my reading of TimerTask indicates that only a single purge operation would be running at any time, ie they will not run concurrently if I set the interval to be 1 minute and it takes more than a minute to purge, can you confirm?)&lt;/p&gt;</comment>
                            <comment id="13095792" author="lakshman" created="Fri, 2 Sep 2011 07:14:53 +0100"  >&lt;p&gt;Thanks very much for your review and update Pat.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;having the period specified in minutes rather than hours&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;1) In our case we have gone for this approach as disk is running out of space after long run say 30 days and even longer. Initially we thought of providing purge interval in days. But, considering the testability and your point of finer level of granularity only we have gone for hours.&lt;/p&gt;

&lt;p&gt;2) Say, for 3 days interval, user would prefer to configure 72 (hours) rather 4320 (minutes). Just trying to balance usability and granularity.&lt;/p&gt;

&lt;p&gt;Please let me know your thoughts on this. If you feel we need more granularity for some other usecase, surely I can update the patch.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;(my reading of TimerTask indicates that only a single purge operation would be running at any time, ie they will not run concurrently if I set the interval to be 1 minute and it takes more than a minute to purge, can you confirm?)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, verified the behavior of Java Timer. Timer will be running in one single thread and no two invocations will be running concurrently. Verified the same through debug points.&lt;/p&gt;</comment>
                            <comment id="13096077" author="phunt" created="Fri, 2 Sep 2011 17:04:47 +0100"  >&lt;p&gt;@laxman sounds reasonable to me. If no one else objects I&apos;ll commit this.&lt;/p&gt;</comment>
                            <comment id="13096292" author="phunt" created="Fri, 2 Sep 2011 21:51:29 +0100"  >&lt;p&gt;Thanks Laxman! Committed to 3.4.0&lt;/p&gt;</comment>
                            <comment id="13096463" author="hudson" created="Sat, 3 Sep 2011 00:18:56 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk-jdk7 #14 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk-jdk7/14/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk-jdk7/14/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; title=&quot;automating log and snapshot cleaning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1107&quot;&gt;&lt;del&gt;ZOOKEEPER-1107&lt;/del&gt;&lt;/a&gt;. automating log and snapshot cleaning (Laxman via phunt)&lt;/p&gt;

&lt;p&gt;phunt : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1164708&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1164708&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/conf/zoo_sample.cfg&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/docs/src/documentation/content/xdocs/zookeeperAdmin.xml&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/DatadirCleanupManager.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerMain.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/DatadirCleanupManagerTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13096630" author="hudson" created="Sat, 3 Sep 2011 11:56:03 +0100"  >&lt;p&gt;Integrated in ZooKeeper-trunk #1293 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/1293/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/1293/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1107&quot; title=&quot;automating log and snapshot cleaning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1107&quot;&gt;&lt;del&gt;ZOOKEEPER-1107&lt;/del&gt;&lt;/a&gt;. automating log and snapshot cleaning (Laxman via phunt)&lt;/p&gt;

&lt;p&gt;phunt : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1164708&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1164708&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/conf/zoo_sample.cfg&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/docs/src/documentation/content/xdocs/zookeeperAdmin.xml&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/DatadirCleanupManager.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerConfig.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/QuorumPeerMain.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/DatadirCleanupManagerTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                                                <inwardlinks description="is superceded by">
                                        <issuelink>
            <issuekey id="12415176">ZOOKEEPER-323</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12484758" name="ZOOKEEPER-1107.1.patch" size="16293" author="lakshman" created="Thu, 30 Jun 2011 11:49:05 +0100"/>
                            <attachment id="12484774" name="ZOOKEEPER-1107.2.patch" size="15618" author="lakshman" created="Thu, 30 Jun 2011 15:11:54 +0100"/>
                            <attachment id="12484869" name="ZOOKEEPER-1107.3.patch" size="15300" author="lakshman" created="Fri, 1 Jul 2011 15:06:04 +0100"/>
                            <attachment id="12486574" name="ZOOKEEPER-1107.4.patch" size="17787" author="lakshman" created="Fri, 15 Jul 2011 10:36:18 +0100"/>
                            <attachment id="12490409" name="ZOOKEEPER-1107.5.patch" size="16996" author="lakshman" created="Mon, 15 Aug 2011 08:35:18 +0100"/>
                            <attachment id="12488067" name="ZOOKEEPER-1107.5.patch" size="16996" author="lakshman" created="Thu, 28 Jul 2011 07:16:43 +0100"/>
                            <attachment id="12492674" name="ZOOKEEPER-1107.6.patch" size="18262" author="phunt" created="Thu, 1 Sep 2011 22:47:01 +0100"/>
                            <attachment id="12484646" name="ZOOKEEPER-1107.patch" size="14373" author="lakshman" created="Wed, 29 Jun 2011 14:21:20 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 23 Jun 2011 17:22:21 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3997</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzx07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33331</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>