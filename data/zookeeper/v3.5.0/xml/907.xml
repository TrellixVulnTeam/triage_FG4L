<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:41:13 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-907/ZOOKEEPER-907.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-907] Spurious &quot;KeeperErrorCode = Session moved&quot; messages</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-907</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;The sync request does not set the session owner in Request.&lt;/p&gt;

&lt;p&gt;As a result, the leader keeps printing:&lt;br/&gt;
2010-07-01 10:55:36,733 - INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;ProcessThread:-1:PrepRequestProcessor@405&amp;#93;&lt;/span&gt; - Got user-level KeeperException when processing sessionid:0x298d3b1fa90000 type:sync: cxid:0x6 zxid:0xfffffffffffffffe txntype:unknown reqpath:/ Error Path:null Error:KeeperErrorCode = Session moved&lt;/p&gt;</description>
                <environment></environment>
        <key id="12477893">ZOOKEEPER-907</key>
            <summary>Spurious &quot;KeeperErrorCode = Session moved&quot; messages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vishalmlst">Vishal Kher</assignee>
                                    <reporter username="vishalmlst">Vishal Kher</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Oct 2010 19:27:19 +0100</created>
                <updated>Wed, 23 Nov 2011 19:22:29 +0000</updated>
                            <resolved>Thu, 4 Nov 2010 16:29:28 +0000</resolved>
                                    <version>3.3.1</version>
                                    <fixVersion>3.3.2</fixVersion>
                    <fixVersion>3.4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12923081" author="phunt" created="Wed, 20 Oct 2010 19:33:54 +0100"  >&lt;p&gt;sounds like a blocker to me. can this be easily addressed? I&apos;d still like to get 3.3.2 out asap. &lt;/p&gt;</comment>
                            <comment id="12923088" author="vishalmlst" created="Wed, 20 Oct 2010 19:50:01 +0100"  >&lt;p&gt;attaching patch.&lt;/p&gt;</comment>
                            <comment id="12923095" author="phunt" created="Wed, 20 Oct 2010 19:57:19 +0100"  >&lt;p&gt;Nice. Thanks! Can you include a test? Something like this really should have had a test already... great if you could add one.&lt;br/&gt;
(also hate to mention but the path on the patch is messed up (long prefix), can you address that as well?)&lt;/p&gt;</comment>
                            <comment id="12923107" author="vishalmlst" created="Wed, 20 Oct 2010 20:14:43 +0100"  >&lt;p&gt;sure, I will write a test.&lt;/p&gt;

&lt;p&gt;What do you think is the effect of this bug? In PrepRequestProcessor.pRequest(), the leader will not pass sync request to nextProcessor. Does that mean that sync did not succeed?&lt;/p&gt;</comment>
                            <comment id="12923200" author="breed" created="Wed, 20 Oct 2010 23:16:47 +0100"  >&lt;p&gt;yes, this will fail the sync. it will not get passed through the pipeline. it will give you a partial sync though &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12923211" author="breed" created="Wed, 20 Oct 2010 23:54:26 +0100"  >&lt;p&gt;wow, that is a really dumb error! vishal, could i ask you to modify your patch to avoid code duplication?&lt;br/&gt;
we should probably have &quot;Request si;&quot; outside of the if, and then just set si inside the if statement, and then do the setOwner and submit after the if block to avoid code duplication. that way, if we make another change in the future, we don&apos;t run into this again.&lt;/p&gt;

&lt;p&gt;let me know if you need help with the test.&lt;/p&gt;</comment>
                            <comment id="12923627" author="vishalmlst" created="Thu, 21 Oct 2010 21:51:38 +0100"  >&lt;p&gt;Ben,&lt;/p&gt;

&lt;p&gt;What do you mean by partial sync? Will the follower still sync with the leader?&lt;/p&gt;

&lt;p&gt;Can you explain how sync works?  I was going throught the code flow. I traced the sync call, but I could find the place that performs the data transfer between the leader and follwer.&lt;/p&gt;

&lt;p&gt;I will cleanup the patch. As per the test goes,  I am not sure what is the best way to check if a server has received a request with null owner. I was planning to add a test that will initiate all zk client requests. In SessionTrackerImpl.checkesession(), set a flag if it sees a null owner. At the end of the test, fail the test if the flag is set. Any suggestions?&lt;/p&gt;

&lt;p&gt;-Vishal&lt;/p&gt;</comment>
                            <comment id="12923895" author="breed" created="Fri, 22 Oct 2010 17:15:47 +0100"  >&lt;p&gt;sync doesn&apos;t cause any additional traffic over the atomic broadcast. it just makes sure that the all of the in-process transactions have be sent to the follower. when that error happens, the error will be sent back to the follower ordered after all of the completed transactions. so rather than being able to see the result of all requests initiated before the sync, the follower will see all requests completed before the sync. that is why i referred to it as a partial sync.&lt;/p&gt;

&lt;p&gt;i&apos;m really having problems trying to reproduce this error. can you describe more how it happened? i would like to have an end-to-end test rather than the test of a particular implementation so that this error doesn&apos;t pop up if the implementation changes. looking at the code it seems like it should happen everytime the sync request is sent to a follower, but that doesn&apos;t seem to be the case.&lt;/p&gt;</comment>
                            <comment id="12924200" author="vishalmlst" created="Sat, 23 Oct 2010 14:47:43 +0100"  >&lt;p&gt;Let the client connect to the follower. Make sure that sync is your first request.&lt;/p&gt;

&lt;p&gt;To catch this bug you need a test that for each zk client command connects to the follower, issues the request, and disconnects.&lt;/p&gt;</comment>
                            <comment id="12924633" author="vishalmlst" created="Mon, 25 Oct 2010 18:12:15 +0100"  >&lt;p&gt;Attaching cleaned-up patch.&lt;br/&gt;
Ben, let me know what you think about the test that I suggested.&lt;/p&gt;</comment>
                            <comment id="12925474" author="phunt" created="Wed, 27 Oct 2010 18:36:56 +0100"  >&lt;p&gt;Cancelling the patch - still needs a test.&lt;/p&gt;

&lt;p&gt;Ben could you get back on Vishal&apos;s question? (see latest comment)&lt;/p&gt;</comment>
                            <comment id="12925487" author="breed" created="Wed, 27 Oct 2010 19:20:21 +0100"  >&lt;p&gt;the test case should connect to a follower and do a sync.&lt;/p&gt;

&lt;p&gt;i cannot reproduce this problem. if i connect to the leader or the follower and issue a sync() the return code is always 0.&lt;/p&gt;</comment>
                            <comment id="12925512" author="vishalmlst" created="Wed, 27 Oct 2010 20:07:57 +0100"  >&lt;p&gt;Which return code are you referring to? You will see this message in the log file of the reader. It is not passed on to the caller anywhere.&lt;/p&gt;</comment>
                            <comment id="12925536" author="breed" created="Wed, 27 Oct 2010 21:21:08 +0100"  >&lt;p&gt;a sorry, i misunderstood the issue. so your client that issues the sync gets a zero return code, but you see that message in the log. right?&lt;/p&gt;</comment>
                            <comment id="12925540" author="breed" created="Wed, 27 Oct 2010 21:23:48 +0100"  >&lt;p&gt;ah got it. ok i was able to reproduce it: the client connects to the follower, issues a sync, the error message shows up in the log of the leader. so there is an additional bug here &amp;#8211; why is the client not getting the session moved error.&lt;/p&gt;</comment>
                            <comment id="12925541" author="vishalmlst" created="Wed, 27 Oct 2010 21:31:55 +0100"  >&lt;p&gt;It did occur to me. I thought this was by design for sync? sync() is an async call. So the caller never gets any exceptions unless a callback is specified.&lt;br/&gt;
I might be worng here though, I am still reading the code to understand how sync works.&lt;/p&gt;</comment>
                            <comment id="12925976" author="breed" created="Thu, 28 Oct 2010 23:38:09 +0100"  >&lt;p&gt;Ah, I see the problem. There are actually two problems: 1) when sync() get&apos;s an error it is not propagated back to the caller. 2) this problem.&lt;/p&gt;

&lt;p&gt;They problem is that 1) is preventing us from writing a test case. We need to fix 1) and then we can write the test for 2).&lt;/p&gt;</comment>
                            <comment id="12925978" author="vishalmlst" created="Thu, 28 Oct 2010 23:44:22 +0100"  >&lt;p&gt;Hi Ben,&lt;/p&gt;

&lt;p&gt;Do you plan the change the sync() api? Right now sycn() only thorws IllegalArgumentException. &lt;/p&gt;</comment>
                            <comment id="12926004" author="mahadev" created="Fri, 29 Oct 2010 00:46:22 +0100"  >&lt;p&gt;ben, can is &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-915&quot; title=&quot;Errors that happen during sync() processing at the leader do not get propagated back to the client.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-915&quot;&gt;ZOOKEEPER-915&lt;/a&gt; also marked for 3.3.2 then? &lt;/p&gt;</comment>
                            <comment id="12926404" author="breed" created="Fri, 29 Oct 2010 19:43:49 +0100"  >&lt;p&gt;may i propose accepting this patch without a test case? (we can see that it fixes the problem.) that way we can get 3.3.2 out. once &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-915&quot; title=&quot;Errors that happen during sync() processing at the leader do not get propagated back to the client.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-915&quot;&gt;ZOOKEEPER-915&lt;/a&gt; goes it the tests should cover this issue.&lt;/p&gt;</comment>
                            <comment id="12927020" author="mahadev" created="Mon, 1 Nov 2010 15:59:10 +0000"  >&lt;p&gt;thats ok with me ben. Can you review and +1 the patch it its all good to go?&lt;/p&gt;
</comment>
                            <comment id="12928127" author="breed" created="Thu, 4 Nov 2010 05:25:47 +0000"  >&lt;p&gt;+1 looks great vishal thanx for the fix!&lt;/p&gt;</comment>
                            <comment id="12928265" author="breed" created="Thu, 4 Nov 2010 16:29:28 +0000"  >&lt;p&gt;Committed revision 1031051.&lt;br/&gt;
Committed revision 1031064.&lt;/p&gt;</comment>
                            <comment id="12928558" author="hudson" created="Fri, 5 Nov 2010 10:52:46 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #991 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/ZooKeeper-trunk/991/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/ZooKeeper-trunk/991/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-907&quot; title=&quot;Spurious &amp;quot;KeeperErrorCode = Session moved&amp;quot; messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-907&quot;&gt;&lt;del&gt;ZOOKEEPER-907&lt;/del&gt;&lt;/a&gt;. Spurious &quot;KeeperErrorCode = Session moved&quot; messages&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12478629">ZOOKEEPER-915</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12457690" name="ZOOKEEPER-907.patch" size="641" author="vishalmlst" created="Wed, 20 Oct 2010 19:50:00 +0100"/>
                            <attachment id="12457979" name="ZOOKEEPER-907.patch_v2" size="1316" author="vishalmlst" created="Mon, 25 Oct 2010 18:12:15 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 20 Oct 2010 18:33:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47553</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzttr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32816</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>