<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:52:07 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/ZOOKEEPER-1293/ZOOKEEPER-1293.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[ZOOKEEPER-1293] Remove unused readyToStart from Leader.java</title>
                <link>https://issues.apache.org/jira/browse/ZOOKEEPER-1293</link>
                <project id="12310801" key="ZOOKEEPER">ZooKeeper</project>
                    <description>&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1194&quot; title=&quot;Two possible race conditions during leader establishment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1194&quot;&gt;&lt;del&gt;ZOOKEEPER-1194&lt;/del&gt;&lt;/a&gt; readyToStart is no longer used.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12530821">ZOOKEEPER-1293</key>
            <summary>Remove unused readyToStart from Leader.java</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shralex">Alexander Shraer</assignee>
                                    <reporter username="shralex">Alexander Shraer</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Nov 2011 05:31:14 +0000</created>
                <updated>Sat, 7 Jan 2012 01:24:22 +0000</updated>
                            <resolved>Fri, 6 Jan 2012 01:33:36 +0000</resolved>
                                                    <fixVersion>3.5.0</fixVersion>
                                    <component>server</component>
                    <component>tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13177563" author="hadoopqa" created="Fri, 30 Dec 2011 05:25:01 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12503020/ZOOKEEPER-1293.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12503020/ZOOKEEPER-1293.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1225352.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/871//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/871//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/871//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/871//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/871//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/871//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13177762" author="phunt" created="Fri, 30 Dec 2011 21:15:22 +0000"  >&lt;p&gt;I didn&apos;t dig deep, but readyToStart was volatile, cnxAcceptor is not, isn&apos;t that a problem? How about in the context of &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1194&quot; title=&quot;Two possible race conditions during leader establishment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1194&quot;&gt;&lt;del&gt;ZOOKEEPER-1194&lt;/del&gt;&lt;/a&gt;? (I mean, was a bug introduced there wrt replacing the ref to readyToStart)&lt;/p&gt;</comment>
                            <comment id="13177806" author="shralex" created="Fri, 30 Dec 2011 22:56:55 +0000"  >&lt;p&gt;Hi Patrick, &lt;/p&gt;

&lt;p&gt;readyToStart was used in waitForEpochAck to check that the leader passed a certain point in the code (right before getEpochToPropose), and this check was not sufficient because it doesn&apos;t mean that the leader reached the getEpochToPropose or the waitForEpochAck barrier. ZK-1194 fixed this by explicitly checking that the leader reached the right barrier, so it no longer checks readyToStart. &lt;/p&gt;

&lt;p&gt;The only place where readyToStart is still used is in Zab1_0Test.java, where it is read to check that Leader.lead() passed cnxAcceptor.start(). As far as I understand, checking that leader.cnxAcceptor.isAlive() achieves the same (it might actually be better if cnxAcceptor.start() doesn&apos;t atomically make cnxAcceptor alive).&lt;/p&gt;

&lt;p&gt;Happy New Year!&lt;br/&gt;
Alex&lt;/p&gt;</comment>
                            <comment id="13177809" author="shralex" created="Fri, 30 Dec 2011 22:59:38 +0000"  >&lt;p&gt;by &quot;better&quot; I mean that the test is now more conservative&lt;/p&gt;</comment>
                            <comment id="13177815" author="phunt" created="Fri, 30 Dec 2011 23:09:04 +0000"  >&lt;p&gt;Hi Alexander, yes, I get that. My point though was that readyToStart was volatile, while cnxAcceptor is not. Leader is setting cnxAcceptor just prior to setting readyToStart.&lt;/p&gt;

&lt;p&gt;My concern is that cnxAcceptor will be null from the view of any other thread than the leader, given there is no longer any explicit barrier. Is this not correct?&lt;/p&gt;</comment>
                            <comment id="13177837" author="shralex" created="Fri, 30 Dec 2011 23:44:29 +0000"  >&lt;p&gt;I see. I agree that this creates a race on cnxAcceptor (although in practice I don&apos;t think this is harmful in this case since its used just to check whether to proceed or invoke another Thread.sleep(20)). &lt;/p&gt;

&lt;p&gt;We could just make cnxAcceptor volatile ?&lt;/p&gt;</comment>
                            <comment id="13177838" author="shralex" created="Fri, 30 Dec 2011 23:48:37 +0000"  >&lt;p&gt;wrt to ZK-1194 I don&apos;t believe there was a bug introduced since we use synchronized for connectingFollowers and electingFollowers &lt;/p&gt;</comment>
                            <comment id="13177840" author="phunt" created="Fri, 30 Dec 2011 23:59:59 +0000"  >&lt;p&gt;Perhaps this would be a good place/time to refactor the code a bit, exposing a method from Leader rather than accessing fields of Leader directly? You could verify the synchronization as part of the fix. (unfortunately I didn&apos;t have time to look at it in more depth myself).&lt;/p&gt;</comment>
                            <comment id="13178125" author="hadoopqa" created="Sun, 1 Jan 2012 06:57:37 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12509002/ZOOKEEPER-1293-ver2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12509002/ZOOKEEPER-1293-ver2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1225927.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/873//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/873//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/873//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/873//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/873//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-ZOOKEEPER-Build/873//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13181029" author="phunt" created="Fri, 6 Jan 2012 01:33:36 +0000"  >&lt;p&gt;lgtm, thanks Alexander!&lt;/p&gt;</comment>
                            <comment id="13181235" author="hudson" created="Fri, 6 Jan 2012 10:57:24 +0000"  >&lt;p&gt;Integrated in ZooKeeper-trunk #1419 (See &lt;a href=&quot;https://builds.apache.org/job/ZooKeeper-trunk/1419/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/ZooKeeper-trunk/1419/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1293&quot; title=&quot;Remove unused readyToStart from Leader.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1293&quot;&gt;&lt;del&gt;ZOOKEEPER-1293&lt;/del&gt;&lt;/a&gt;. Remove unused readyToStart from Leader.java (Alex Shraer via phunt)&lt;/p&gt;

&lt;p&gt;phunt : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1227927&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1227927&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/main/org/apache/zookeeper/server/quorum/Leader.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/trunk/src/java/test/org/apache/zookeeper/server/quorum/Zab1_0Test.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13181504" author="shralex" created="Fri, 6 Jan 2012 18:38:44 +0000"  >&lt;p&gt;thanks Patrick!&lt;/p&gt;</comment>
                            <comment id="13181755" author="phunt" created="Sat, 7 Jan 2012 01:24:22 +0000"  >&lt;p&gt;No thanks necessary. Thank you for contributing. Regards.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12509002" name="ZOOKEEPER-1293-ver2.patch" size="2122" author="shralex" created="Sat, 31 Dec 2011 23:28:00 +0000"/>
                            <attachment id="12508981" name="ZOOKEEPER-1293-ver2.patch" size="2122" author="shralex" created="Sat, 31 Dec 2011 06:36:48 +0000"/>
                            <attachment id="12503020" name="ZOOKEEPER-1293.patch" size="1825" author="shralex" created="Wed, 9 Nov 2011 05:34:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 30 Dec 2011 05:25:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>216559</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzwsf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33296</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>