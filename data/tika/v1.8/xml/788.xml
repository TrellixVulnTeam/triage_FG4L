<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:34:38 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-788/TIKA-788.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-788] DWG parser infinite loop on possibly corrupt file</title>
                <link>https://issues.apache.org/jira/browse/TIKA-788</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;When parsing some dwg items, it is possible that the parser may cause itself to go into an infinite loop.&lt;/p&gt;

&lt;p&gt;Attached is the file causing the problem.&lt;/p&gt;

&lt;p&gt;Here is a possible patch that will at least proceed until an error is thrown.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;=== modified file &apos;tika-parsers/src/main/java/org/apache/tika/parser/dwg/DWGParser.java&apos;
--- tika-parsers/src/main/java/org/apache/tika/parser/dwg/DWGParser.java        2011-11-24 11:30:33 +0000
+++ tika-parsers/src/main/java/org/apache/tika/parser/dwg/DWGParser.java        2011-11-25 05:27:41 +0000
@@ -274,8 +274,10 @@
             return false;
         }
         while (toSkip &amp;gt; 0) {
-            byte[] skip = new byte[Math.min((int) toSkip, 0x4000)];
-            IOUtils.readFully(stream, skip);
+            byte[] skip = new byte[(int) Math.min(toSkip, 0x4000)];
+            if (IOUtils.readFully(stream, skip) == -1) {
+               return false; //invalid skip
+            }
             toSkip -= skip.length;
         }
         return true;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12532672">TIKA-788</key>
            <summary>DWG parser infinite loop on possibly corrupt file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stas.shaposhnikov">Stas Shaposhnikov</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Nov 2011 05:37:16 +0000</created>
                <updated>Mon, 2 Mar 2015 01:48:17 +0000</updated>
                                            <version>1.0</version>
                                                    <component>parser</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13167963" author="tcm" created="Tue, 13 Dec 2011 00:07:25 +0000"  >&lt;p&gt;We get the same error with a few dwg files that can be read by AutoCAD just fine. This is the signature and header of such a file:&lt;/p&gt;

&lt;p&gt;41 43 31 30 32 31 00 00 00 00 00 01 03 A0 0D 00 00 1B 01 20 00 00 1B 01 00 00 00 00 00 00 00 00 80 0C 00 00 20 62 00 00 80 00 00 00 00 5F 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00&lt;/p&gt;

&lt;p&gt;The problem is &quot;80 0C 00 00 20 62 00&quot; at 0x20 which should indicate where the Metadata begins, however the number is far too big (107889578478720) and especially too big for a cast to int in the section Stas modified. While Stas&apos; change solves the problem of the infinite loop, there could be a more robust way. As mentioned, AutoCAD manages to open the file. Anyways, we&apos;d be content with Stas&apos; patch applied.&lt;/p&gt;</comment>
                            <comment id="13404576" author="gagravarr" created="Sat, 30 Jun 2012 18:27:43 +0100"  >&lt;p&gt;I&apos;ve had a go at this in r1355780, changing the logic to skip the header section if the apparent offset is over 10mb (the header is normally very close to the start of the file, so this shouldn&apos;t affect real files)&lt;/p&gt;

&lt;p&gt;What would be good is if we could get one of these problematic files, along with the metadata that AutoCAD reports for it (ideally the same set of test values that our other sample files have). We can then hopefully work out how to distinguish the two kinds of files, and how to find the metadata in these ones.&lt;/p&gt;</comment>
                            <comment id="13643932" author="c_koell" created="Sun, 28 Apr 2013 08:57:14 +0100"  >&lt;p&gt;Could someone have a look at the provided patch please.&lt;br/&gt;
greets&lt;/p&gt;</comment>
                            <comment id="13652888" author="gagravarr" created="Thu, 9 May 2013 12:55:07 +0100"  >&lt;p&gt;Claus - an alternate version of the patch was applied last year in r1355780. As stated in my comment then, we really do need to get our hands on one of these problematic files, along with details of what AutoCAD reports the metadata to be for them, before we can write a unit test and consider this properly closed.&lt;/p&gt;</comment>
                            <comment id="13784029" author="seegler" created="Wed, 2 Oct 2013 15:47:37 +0100"  >&lt;p&gt;Here is another instance. Not sure this is related to the issue reported&lt;/p&gt;

&lt;p&gt;pool-1-thread-1&quot; prio=10 tid=0x00007f07e03c1000 nid=0x1cec runnable &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00007f07c9b64000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: RUNNABLE&lt;br/&gt;
        at java.io.FileInputStream.readBytes(Native Method)&lt;br/&gt;
        at java.io.FileInputStream.read(FileInputStream.java:242)&lt;br/&gt;
        at java.io.BufferedInputStream.fill(BufferedInputStream.java:235)&lt;br/&gt;
        at java.io.BufferedInputStream.read1(BufferedInputStream.java:275)&lt;br/&gt;
        at java.io.BufferedInputStream.read(BufferedInputStream.java:334)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;locked &amp;lt;0x00000000e63e24d0&amp;gt; (a java.io.BufferedInputStream)&lt;br/&gt;
        at org.apache.tika.io.ProxyInputStream.read(ProxyInputStream.java:99)&lt;br/&gt;
        at java.io.FilterInputStream.read(FilterInputStream.java:133)&lt;br/&gt;
        at org.apache.tika.io.TailStream.read(TailStream.java:117)&lt;br/&gt;
        at org.apache.tika.io.TailStream.skip(TailStream.java:140)&lt;br/&gt;
        at org.apache.tika.parser.mp3.MpegStream.skipStream(MpegStream.java:283)&lt;br/&gt;
        at org.apache.tika.parser.mp3.MpegStream.skipFrame(MpegStream.java:160)&lt;br/&gt;
        at org.apache.tika.parser.mp3.Mp3Parser.getAllTagHandlers(Mp3Parser.java:193)&lt;br/&gt;
        at org.apache.tika.parser.mp3.Mp3Parser.parse(Mp3Parser.java:71)&lt;br/&gt;
        at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)&lt;br/&gt;
        at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)&lt;br/&gt;
        at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:120)&lt;br/&gt;
        at org.apache.tika.parser.ParserDecorator.parse(ParserDecorator.java:91)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14342609" author="tpalsulich" created="Mon, 2 Mar 2015 01:48:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=seegler&quot; class=&quot;user-hover&quot; rel=&quot;seegler&quot;&gt;Seegler Ittyavirah&lt;/a&gt;, it looks like your stack trace is related to parsing an mp3 file.&lt;/p&gt;

&lt;p&gt;Does anyone have a dwg file that triggers this error? Ideally, they would also have the set of Metadata values extracted by AutoCAD.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12672304">TIKA-1179</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 13 Dec 2011 00:07:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>218405</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx1mv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16584</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>