<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:27:41 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-340/TIKA-340.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-340] Provide full Tika bundle</title>
                <link>https://issues.apache.org/jira/browse/TIKA-340</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;To easily deploy Tika and especially the Tika parsers, it would be convenient to have an almost complete bundle consisting of Tika Core, Tika Parsers as well as the most important parser dependencies. Any remaining dependencies not included with the bundle should be declared as optional import to not fail bundle resolution if one or the other (or all) import(s) is missing.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12442070">TIKA-340</key>
            <summary>Provide full Tika bundle</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="fmeschbe">Felix Meschberger</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Dec 2009 10:39:15 +0000</created>
                <updated>Thu, 3 Dec 2009 07:26:54 +0000</updated>
                            <resolved>Wed, 2 Dec 2009 17:43:14 +0000</resolved>
                                    <version>0.5</version>
                                    <fixVersion>0.6</fixVersion>
                                    <component>packaging</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12784165" author="fmeschbe" created="Tue, 1 Dec 2009 10:42:10 +0000"  >&lt;p&gt;Patch providing a tika-full project which creates an almost complete bundle of the dependencies.&lt;/p&gt;

&lt;p&gt;The dependencies included are derived from the included dependencies of the Tika App project but omit some embeddings, which should be shared in the framework (most importantly the XML oriented APIs like W3C DOM and SAX).&lt;/p&gt;</comment>
                            <comment id="12784176" author="fmeschbe" created="Tue, 1 Dec 2009 11:08:43 +0000"  >&lt;p&gt;Note: On my machine, I had to increase the Java heap memory size to prevent the build from aborting with an OutOfMemory Exception. I set the maximum heap size to 512MB and the build ultimately used 400MB.&lt;/p&gt;</comment>
                            <comment id="12784272" author="jukkaz" created="Tue, 1 Dec 2009 16:02:32 +0000"  >&lt;p&gt;Excellent, thanks! I committed the patch in revision 885807.&lt;/p&gt;

&lt;p&gt;Would you mind if we rather called the package tika-bundle or tika-osgi instead of tika-full? I think that would make it easier to distinguish between this package and the tika-app jar that&apos;s also a &quot;full&quot; package.&lt;/p&gt;

&lt;p&gt;Some further improvements would be to automatically wire all logging to the OSGi log service and to make it possible for Tika to automatically leverage Parser implementations from other bundles.&lt;/p&gt;</comment>
                            <comment id="12784283" author="jukkaz" created="Tue, 1 Dec 2009 16:36:59 +0000"  >&lt;p&gt;Is there a particular reason why you configured some of the dependencies to be inlined and some to be just included as embedded jar files? Unless there&apos;s a good reason not to do so, I&apos;d go for a fully inlined package to keep the jar structure simpler.&lt;/p&gt;</comment>
                            <comment id="12784648" author="fmeschbe" created="Wed, 2 Dec 2009 06:10:06 +0000"  >&lt;p&gt;Thanks for committing.&lt;/p&gt;

&lt;p&gt;&amp;gt; Would you mind if we rather called the package tika-bundle or tika-osgi instead of tika-full?&lt;/p&gt;

&lt;p&gt;Not at all ...&lt;/p&gt;

&lt;p&gt;&amp;gt; Some further improvements would be to automatically wire all logging to the OSGi log service&lt;/p&gt;

&lt;p&gt;Well the bundle as it stands currently has imports for Log4J and Commons Logging. Both APIs are generally available from some logging support bundle, for example the Sling Log Service implementation or PAX logging. I am not sure, whether it is worth it to try to converge the logging approaches into OSGi LogService in the Tika Bundle itself.&lt;/p&gt;

&lt;p&gt;&amp;gt; some of the dependencies to be inlined&lt;/p&gt;

&lt;p&gt;Generally I came to like to embed JAR files. This makes it a lot easier to inspect the JAR files and AFAICT has no drawbacks on usability in an OSGi environment. I have inline one JAR file because I had to exclude an incomplete org.w3c.dom package, which would have caused resolution issues.&lt;/p&gt;

&lt;p&gt;OTOH if you would deem the jarfile useful in general, that is non-OSGi, environments, it would probably make perfect sense to inline the embedded libraries. In this case, though, the name of the library should probably not contain the words &quot;osgi&quot; or &quot;bundle&quot;. WDYT ?&lt;/p&gt;</comment>
                            <comment id="12784661" author="fmeschbe" created="Wed, 2 Dec 2009 06:50:18 +0000"  >&lt;p&gt;Here is a patch against trunk inlining all previously embedded libraries.&lt;/p&gt;

&lt;p&gt;Interestingly now the jar file grows from 20MB to 25MB ... (well, out of my belly both sizes are horrendous given the task at hand; but that is probably another story &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; )&lt;/p&gt;</comment>
                            <comment id="12784761" author="jukkaz" created="Wed, 2 Dec 2009 10:53:24 +0000"  >&lt;p&gt;Re: logging; AFAIUI using the OSGi log service directly makes it possible for the log backend to sort out log messages based on the bundle from which they originated. That doesn&apos;t seem possible if we just depend on a support bundle that exposes the commons-logging API.&lt;/p&gt;

&lt;p&gt;Re: size; Yep, that&apos;s another story. See &lt;a href=&quot;http://jukkaz.wordpress.com/2009/10/16/putting-poi-on-a-diet/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://jukkaz.wordpress.com/2009/10/16/putting-poi-on-a-diet/&lt;/a&gt; for the gory details.&lt;/p&gt;

&lt;p&gt;Re: inlining; The double compression of embedded jars explains the size difference you&apos;re seeing. That double compression seems a bit troublesome to me given the large number of non-class resources (PDF font mapping data, OOXML schemas, etc.) we have there. Ideally the classloader should be able to load such resources on demand without having to uncompress the entire archive. But I guess OSGi runtimes may already avoid that problem in similar ways as servlet containers do with embedded jars in WEB-INF/lib.&lt;/p&gt;</comment>
                            <comment id="12784798" author="fmeschbe" created="Wed, 2 Dec 2009 12:35:20 +0000"  >&lt;p&gt;Re: logging:&lt;/p&gt;

&lt;p&gt;Yes, that might be true &amp;#8211; still there is some API to implement and if you mplement logging based on LogService you loose all the log categories previously used because the OSGi LogService does not have such a concept.&lt;/p&gt;

&lt;p&gt;Also, if you want to reuse the library in non-OSGi environments using the LogService will not work and create an OSGi dependency.&lt;/p&gt;

&lt;p&gt;Re: size:&lt;/p&gt;

&lt;p&gt;I knew there is some activity in this area. Thanks for the pointer.&lt;/p&gt;

&lt;p&gt;Re: inlining&lt;/p&gt;

&lt;p&gt;Why is the double compression troublesome ? &lt;/p&gt;

&lt;p&gt;What the OSGI framework actually does, is unpacking the bundle jar. Thus embedded libaries are unpacked into jar files, that is unpacking is not recursive. Then the regaluar classes are loaded regularly while the embedded JAR files are loaded as JAR URLs. &lt;/p&gt;

&lt;p&gt;Thus in the end, it might even be better to embed the libraries than to inline them.&lt;/p&gt;

&lt;p&gt;But this decision depends on whether you want to use the result of the build in a non-OSGi environment or not. If you only target OSGi frameworks, then I would go for embedded libraries. Otherwise I would go for inlined libraries at the expense of 20% of the size of the resulting JAR file.&lt;/p&gt;</comment>
                            <comment id="12784839" author="kkrugler" created="Wed, 2 Dec 2009 14:17:32 +0000"  >&lt;p&gt;Funny, I was just looking at the size of the Hadoop job jar I generate for Bixo. It was suddenly 26MB, and pushing it up to EC2 was taking a long time.&lt;/p&gt;

&lt;p&gt;As Jukka&apos;s blog post says, it&apos;s all about the ooxml-schemas-1.0.jar file - almost 14MB. And the 2.5MB xmlbeans-2.3.0.jar that this schema jar depends on. Excluding POI would cut about 18MB from my 26MB, which I might need to do (as an option for a smaller build).&lt;/p&gt;</comment>
                            <comment id="12784855" author="ab" created="Wed, 2 Dec 2009 14:45:53 +0000"  >&lt;p&gt;Vast majority of classes in these JARs are never used. Perhaps one of the steps in preparing this bundle could be to pass it through a code shrinker, such as Proguard (&lt;a href=&quot;http://proguard.sourceforge.net&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://proguard.sourceforge.net&lt;/a&gt;) - not to obfuscate it, but simply to remove unused cruft.&lt;/p&gt;</comment>
                            <comment id="12784860" author="fmeschbe" created="Wed, 2 Dec 2009 14:53:54 +0000"  >&lt;p&gt;Interesting idea, there is even a maven plugin at &lt;a href=&quot;http://pyx4me.com/pyx4me-maven-plugins/proguard-maven-plugin/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://pyx4me.com/pyx4me-maven-plugins/proguard-maven-plugin/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12784911" author="jukkaz" created="Wed, 2 Dec 2009 17:32:23 +0000"  >&lt;p&gt;OK, you have a better view of the best practices for logging with OSGi. See the attached osgi-logging.patch for a quick and dirty experiment of what we could do if we did want to directly use the OSGi log service.&lt;/p&gt;

&lt;p&gt;If the OSGi runtimes already unpack the bundle jar, then I have no problem with the embedded jars. Could we even avoid inlining the tika-core and tika-parsers jars, or is that something that&apos;s needed for the Export-Package rules to work? If the latter, can we exclude org.apache.tika.parser subpackages from being exported so that only tika-core gets inlined?&lt;/p&gt;

&lt;p&gt;Let&apos;s take the size issue to tika-dev@.&lt;/p&gt;</comment>
                            <comment id="12784927" author="jukkaz" created="Wed, 2 Dec 2009 17:43:14 +0000"  >&lt;p&gt;I&apos;ve renamed the bundle to tika-bundle. With that I think we have all the basics in place so I&apos;m resolving this issue as Fixed. Thanks for the contribution!&lt;/p&gt;

&lt;p&gt;Let&apos;s use followup issues to track the further improvements/features that have already been mentioned.&lt;/p&gt;</comment>
                            <comment id="12785204" author="fmeschbe" created="Thu, 3 Dec 2009 07:13:28 +0000"  >&lt;p&gt;&amp;gt; Could we even avoid inlining the tika-core and tika-parsers jars&lt;/p&gt;

&lt;p&gt;Yes, I will create a new issue with patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12426636" name="TIKA-340-2.patch" size="1218" author="fmeschbe" created="Wed, 2 Dec 2009 06:50:18 +0000"/>
                            <attachment id="12426523" name="TIKA-340.patch" size="17598" author="fmeschbe" created="Tue, 1 Dec 2009 10:42:10 +0000"/>
                            <attachment id="12426686" name="osgi-logging.patch" size="14280" author="jukkaz" created="Wed, 2 Dec 2009 17:32:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Dec 2009 16:02:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4520</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx4dz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17030</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>