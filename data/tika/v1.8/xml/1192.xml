<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:29:52 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-1192/TIKA-1192.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-1192] ArrayIndexOutOfBoundsException: 9 parsing RTF</title>
                <link>https://issues.apache.org/jira/browse/TIKA-1192</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;When trying to parse an RTF file I&apos;m getting the following exception. I am not able to attach the file for privacy reasons:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.ArrayIndexOutOfBoundsException: 9
                           TextExtractor.java:872 org.apache.tika.parser.rtf.TextExtractor.processControlWord
                           TextExtractor.java:566 org.apache.tika.parser.rtf.TextExtractor.parseControlWord
                           TextExtractor.java:492 org.apache.tika.parser.rtf.TextExtractor.parseControlToken
                           TextExtractor.java:459 org.apache.tika.parser.rtf.TextExtractor.extract
                           TextExtractor.java:448 org.apache.tika.parser.rtf.TextExtractor.extract
                                RTFParser.java:56 org.apache.tika.parser.rtf.RTFParser.parse
                                 (Unknown Source) sun.reflect.NativeMethodAccessorImpl.invoke0
                 NativeMethodAccessorImpl.java:57 sun.reflect.NativeMethodAccessorImpl.invoke
             DelegatingMethodAccessorImpl.java:43 sun.reflect.DelegatingMethodAccessorImpl.invoke
                                  Method.java:606 java.lang.reflect.Method.invoke
                                Reflector.java:93 clojure.lang.Reflector.invokeMatchingMethod
                                Reflector.java:28 clojure.lang.Reflector.invokeInstanceMethod
                               tika_parser.clj:20 rtf-parser.tika-parser/parse
               form-init2921349737948661927.clj:1 rtf-parser.tika-parser/eval4200
                               Compiler.java:6619 clojure.lang.Compiler.eval
                               Compiler.java:6582 clojure.lang.Compiler.eval
                                    core.clj:2852 clojure.core/eval
                                     main.clj:259 clojure.main/repl[fn]
                                     main.clj:259 clojure.main/repl[fn]
                                     main.clj:277 clojure.main/repl[fn]
                                     main.clj:277 clojure.main/repl
                                 RestFn.java:1096 clojure.lang.RestFn.invoke
                        interruptible_eval.clj:56 clojure.tools.nrepl.middleware.interruptible-eval/evaluate[fn]
                                     AFn.java:159 clojure.lang.AFn.applyToHelper
                                     AFn.java:151 clojure.lang.AFn.applyTo
                                     core.clj:617 clojure.core/apply
                                    core.clj:1788 clojure.core/with-bindings*
                                  RestFn.java:425 clojure.lang.RestFn.invoke
                        interruptible_eval.clj:41 clojure.tools.nrepl.middleware.interruptible-eval/evaluate
                       interruptible_eval.clj:171 clojure.tools.nrepl.middleware.interruptible-eval/interruptible-eval[fn]
                                    core.clj:2330 clojure.core/comp[fn]
                       interruptible_eval.clj:138 clojure.tools.nrepl.middleware.interruptible-eval/run-next[fn]
                                      AFn.java:24 clojure.lang.AFn.run
                     ThreadPoolExecutor.java:1145 java.util.concurrent.ThreadPoolExecutor.runWorker
                      ThreadPoolExecutor.java:615 java.util.concurrent.ThreadPoolExecutor$Worker.run
                                  Thread.java:724 java.lang.Thread.run
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12677872">TIKA-1192</key>
            <summary>ArrayIndexOutOfBoundsException: 9 parsing RTF</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="dkincaid">Dave Kincaid</reporter>
                        <labels>
                            <label>rtf</label>
                    </labels>
                <created>Wed, 6 Nov 2013 21:31:41 +0000</created>
                <updated>Fri, 30 May 2014 14:41:07 +0100</updated>
                            <resolved>Sat, 9 Nov 2013 11:29:04 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.5</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13816898" author="dkincaid" created="Fri, 8 Nov 2013 01:43:58 +0000"  >&lt;p&gt;I think I&apos;ve tracked down the source of the defect and have a potential fix. I&apos;d like someone with a little more RTF knowledge verify it however.&lt;/p&gt;

&lt;p&gt;The file that is throwing the exception during parse has the following text in the header:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{\list\listtemplateid67698707
{\listlevel\levelnfc0\levelfollow0\levelstartat1{\leveltext \&apos;02\&apos;00.}{\levelnumbers \&apos;01}}
{\listlevel\levelnfc0\levelfollow0\levelstartat1{\leveltext \&apos;02\&apos;01.}{\levelnumbers \&apos;01}}
{\listlevel\levelnfc0\levelfollow0\levelstartat1{\leveltext \&apos;02\&apos;02.}{\levelnumbers \&apos;01}}
{\listlevel\levelnfc0\levelfollow0\levelstartat1{\leveltext \&apos;02\&apos;03.}{\levelnumbers \&apos;01}}
{\listlevel\levelnfc0\levelfollow0\levelstartat1{\leveltext \&apos;02\&apos;04.}{\levelnumbers \&apos;01}}
{\listlevel\levelnfc0\levelfollow0\levelstartat1{\leveltext \&apos;02\&apos;05.}{\levelnumbers \&apos;01}}
{\listlevel\levelnfc0\levelfollow0\levelstartat1{\leveltext \&apos;02\&apos;06.}{\levelnumbers \&apos;01}}
{\listlevel\levelnfc0\levelfollow0\levelstartat1{\leveltext \&apos;02\&apos;07.}{\levelnumbers \&apos;01}}
{\listlevel\levelnfc0\levelfollow0\levelstartat1{\leveltext \&apos;02\&apos;08.}{\levelnumbers \&apos;01}}
{\listname List1382206859_1;}\listid1991665056
}
}
{\*\listoverridetable
{\listoverride\listid1991665054\listoverridecount9
{\lfolevel\listoverrideformat\listoverridestartat
{\listlevel\levelnfc23\levelfollow0\levelstartat1{\leveltext \&apos;01\&apos;b7}{\levelnumbers}\f2\fcs1\f2\af2\fcs0\rtlch\f2\af2\ltrch}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;what&apos;s happening is that in TextExtractor.java line 867 the listTableLevel counter isn&apos;t being reset to -1 when it goes into the list override table, so it gets incremented to 9 which is not valid.&lt;/p&gt;

&lt;p&gt;I think the fix is to change the conditional on line 1072 to reset listTableLevel to -1 on equals(&quot;listoverride&quot;) in addition to equals(&quot;list&quot;). I&apos;ll try to attach a patch file against the source for 1.4.&lt;/p&gt;</comment>
                            <comment id="13816899" author="dkincaid" created="Fri, 8 Nov 2013 01:45:49 +0000"  >&lt;p&gt;Please have someone knowledgeable about RTF look at this to make sure the listTableLevel is getting reset in the correct place.&lt;/p&gt;</comment>
                            <comment id="13817171" author="mikemccand" created="Fri, 8 Nov 2013 10:48:19 +0000"  >&lt;p&gt;Thanks Dave, this patch looks correct.  Does that RTF fragment above provoke the exception?  If so, we could make a test case from that?&lt;/p&gt;</comment>
                            <comment id="13817273" author="dkincaid" created="Fri, 8 Nov 2013 13:32:18 +0000"  >&lt;p&gt;Thanks. Yes, when that fragment is part of an RTF file it provokes the exception, so if you could put it into a valid RTF file it should throw the exception.&lt;/p&gt;</comment>
                            <comment id="13817472" author="mikemccand" created="Fri, 8 Nov 2013 17:09:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;Yes, when that fragment is part of an RTF file it provokes the exception, so if you could put it into a valid RTF file it should throw the exception.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm, I&apos;ve tried that (quickly) but so far cannot provoke it ... I&apos;d really prefer to commit a test case along w/ this fix ...&lt;/p&gt;</comment>
                            <comment id="13817511" author="dkincaid" created="Fri, 8 Nov 2013 17:52:08 +0000"  >&lt;p&gt;I should be able to put a test case together tonight or over the weekend.&lt;/p&gt;</comment>
                            <comment id="13817512" author="mikemccand" created="Fri, 8 Nov 2013 17:54:24 +0000"  >&lt;p&gt;Thanks Dave.&lt;/p&gt;</comment>
                            <comment id="13817938" author="dkincaid" created="Sat, 9 Nov 2013 01:40:51 +0000"  >&lt;p&gt;Attaching test case&lt;/p&gt;</comment>
                            <comment id="13818109" author="mikemccand" created="Sat, 9 Nov 2013 11:29:04 +0000"  >&lt;p&gt;Thanks Dave, I just committed this.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12715199">TIKA-1305</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12612953" name="testRTFListOverride.rtf" size="31792" author="dkincaid" created="Sat, 9 Nov 2013 01:40:51 +0000"/>
                            <attachment id="12612952" name="tika-1192-test-case.patch" size="901" author="dkincaid" created="Sat, 9 Nov 2013 01:40:51 +0000"/>
                            <attachment id="12612757" name="tika-1192.patch" size="783" author="dkincaid" created="Fri, 8 Nov 2013 01:45:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 8 Nov 2013 10:48:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357247</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzjfif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357537</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>