<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:38:45 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-1217/TIKA-1217.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-1217] Integrate with Java-7 FileTypeDetector API</title>
                <link>https://issues.apache.org/jira/browse/TIKA-1217</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;It would be useful if Tika natively provided Java-7 FileTypeDetector &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; implementations. Adding the corresponding META-INF/services/java.nio.file.spi.FileTypeDetector files would allow the use of Files.probeContentType &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; without any specific links to Tika for this functionality.&lt;/p&gt;

&lt;p&gt;If you do not want to rely on Java-7 for the core, then this could be added as an extension module.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/nio/file/spi/FileTypeDetector.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://docs.oracle.com/javase/7/docs/api/java/nio/file/spi/FileTypeDetector.html&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#probeContentType(java.nio.file.Path&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#probeContentType(java.nio.file.Path&lt;/a&gt;)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12687968">TIKA-1217</key>
            <summary>Integrate with Java-7 FileTypeDetector API</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="p_ansell">Peter Ansell</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Jan 2014 23:37:46 +0000</created>
                <updated>Mon, 13 Jan 2014 22:49:35 +0000</updated>
                                                                            <component>detector</component>
                    <component>mime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13866722" author="jukkaz" created="Thu, 9 Jan 2014 15:45:58 +0000"  >&lt;p&gt;Nice idea!&lt;/p&gt;

&lt;p&gt;I think putting such a feature to a separate tika-java7 component (included in the build only when using Java 7 or higher) for now is the best solution, as otherwise we&apos;d need to raise the requirements on build environments. Once we do do that at some point in future, the component can be merged into tika-core.&lt;/p&gt;</comment>
                            <comment id="13867205" author="p_ansell" created="Thu, 9 Jan 2014 22:41:56 +0000"  >&lt;p&gt;Patch to add FileTypeDetector implementation&lt;/p&gt;</comment>
                            <comment id="13867207" author="p_ansell" created="Thu, 9 Jan 2014 22:42:20 +0000"  >&lt;p&gt;Patch can also be reviewed at GitHub:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/ansell/tika/compare/apache:trunk...ansell:TIKA-1217&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/ansell/tika/compare/apache:trunk...ansell:TIKA-1217&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13867228" author="gagravarr" created="Thu, 9 Jan 2014 22:57:20 +0000"  >&lt;p&gt;Minor thing, but the section &quot;// Then open an InputStream if necessary&quot; would probably be more efficient if you used a File not a Stream. TikaInputStream will open the stream as needed, but for those things which need a File it&apos;ll be more efficient if the File is known (else it&apos;ll have to spool to a temp file)&lt;/p&gt;</comment>
                            <comment id="13867236" author="p_ansell" created="Thu, 9 Jan 2014 23:05:08 +0000"  >&lt;p&gt;New version of patch checking File instead of InputStream&lt;/p&gt;</comment>
                            <comment id="13867244" author="p_ansell" created="Thu, 9 Jan 2014 23:08:13 +0000"  >&lt;p&gt;Nick: New version of the patch uses Path.toFile() to get a file reference instead of Files.newInputStream.&lt;/p&gt;</comment>
                            <comment id="13869780" author="jukkaz" created="Mon, 13 Jan 2014 18:14:14 +0000"  >&lt;p&gt;Thanks! I committed the patch in revision 1557795.&lt;/p&gt;

&lt;p&gt;Before we resolve this as fixed, I think it would be better to use &lt;tt&gt;detect(File)&lt;/tt&gt; directly, without first trying type detection based on just the file name. Name-based type lookup is less accurate than file-based, and AFAICT there are few applications where  file type lookup is performance-critical (and if it is, like in a directory browser, the results are often cached). And assuming the file-based lookup was conditional on the existence of the file, a client could still do name-only lookups by prepending a fictional directory name to the path passed to the &lt;tt&gt;probeContentType()&lt;/tt&gt; call. WDYT?&lt;/p&gt;</comment>
                            <comment id="13869889" author="lewismc" created="Mon, 13 Jan 2014 19:52:24 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=p_ansell&quot; class=&quot;user-hover&quot; rel=&quot;p_ansell&quot;&gt;Peter Ansell&lt;/a&gt;, how can I test this patch out? It was on my TODO but slipped over the weekend. Thank you&lt;/p&gt;</comment>
                            <comment id="13870087" author="p_ansell" created="Mon, 13 Jan 2014 22:49:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jukkaz&quot; class=&quot;user-hover&quot; rel=&quot;jukkaz&quot;&gt;Jukka Zitting&lt;/a&gt; The rationale for checking first on filename, in a Java-7 context, was that Path objects do not hold File Descriptors. Hence, a content type detection method taking a Path object may also be able to avoid getting a File Descriptor.&lt;/p&gt;

&lt;p&gt;However, if there is an unacceptable loss in fidelity by checking first on the filename then feel free to remove that clause, as it isn&apos;t critical to the functionality for me.&lt;/p&gt;

&lt;p&gt;There cannot, however, easily be two different implementations in the same module, as java.util.ServiceLoader isn&apos;t ordered so it cannot preference one over the other. In addition, there are no OpenOptions or LinkOptions attached to Files.probeContentType as there are with other methods such as Files.isRegularFile. That makes it difficult for users to pass in their preferences about how Files.probeContentType should operate (ie, whether it should try to avoid getting a file descriptor if possible, or not to follow symbolic links).&lt;/p&gt;

&lt;p&gt;If we wanted to do a second implementation that always used File it would be perfectly possible, but it would need to go in a separate module to distinguish between the META-INF/services files based on which module is loaded. We would also have to rename the current module from tika-java7 to something more specific.&lt;/p&gt;

&lt;p&gt;As you say, in a performance critical application, the results will be cached to avoid duplication, so it isn&apos;t a big deal in the greater scheme of things.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lewismc&quot; class=&quot;user-hover&quot; rel=&quot;lewismc&quot;&gt;Lewis John McGibbney&lt;/a&gt; You can find the patch that Jukka committed in the Tika trunk if you want to test it, but it isn&apos;t necessary to do it now if you have other things to do. &lt;a href=&quot;https://github.com/apache/tika/commit/39370848b8bd9214dc4b7720539edc0eb595300c&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/tika/commit/39370848b8bd9214dc4b7720539edc0eb595300c&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12622282" name="TIKA-1217-v2.patch" size="13154" author="p_ansell" created="Thu, 9 Jan 2014 23:05:08 +0000"/>
                            <attachment id="12622274" name="TIKA-1217.patch" size="13164" author="p_ansell" created="Thu, 9 Jan 2014 22:41:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 9 Jan 2014 15:45:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>366975</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzl3tj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>367285</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>