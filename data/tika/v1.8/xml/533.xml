<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:37:01 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-533/TIKA-533.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-533] Mis-detection of zip files as application/vnd.apple.iwork</title>
                <link>https://issues.apache.org/jira/browse/TIKA-533</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;It appears that, at least in some circumstances, a zip file containing only another zip file is being mis-detected as  application/vnd.apple.iwork.&lt;br/&gt;
In addition, for such files, the command-line parser does not return any output at all.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 7 64-bit, latest Tika build as of 18th Oct 2010.&lt;/p&gt;</environment>
        <key id="12477585">TIKA-533</key>
            <summary>Mis-detection of zip files as application/vnd.apple.iwork</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="geoff.jarrad">Geoff Jarrad</reporter>
                        <labels>
                    </labels>
                <created>Sun, 17 Oct 2010 23:22:19 +0100</created>
                <updated>Thu, 2 Aug 2012 10:33:36 +0100</updated>
                            <resolved>Thu, 10 Feb 2011 13:07:10 +0000</resolved>
                                    <version>0.8</version>
                                    <fixVersion>0.9</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12921910" author="geoff.jarrad" created="Sun, 17 Oct 2010 23:23:38 +0100"  >&lt;p&gt;Simple zip file containing a zip of an HTML file, demonstrating the specified bug.&lt;/p&gt;</comment>
                            <comment id="12921915" author="gagravarr" created="Sun, 17 Oct 2010 23:50:20 +0100"  >&lt;p&gt;We should probably add an option to the CLI to use the container aware detector - that&apos;d fix this case, and if we&apos;re parsing the file anyway the extra detection work will even out the reduction in parser work.&lt;/p&gt;

&lt;p&gt;Geoff - if you use the container aware detector in your code, rather than the plain mime one, does that fix the problem for you?&lt;/p&gt;</comment>
                            <comment id="12921930" author="geoff.jarrad" created="Mon, 18 Oct 2010 01:20:22 +0100"  >&lt;p&gt;No, using the ContainerAwareDetector doesn&apos;t seem to change the detected content-type. My quick code test looks like this:&lt;/p&gt;

&lt;p&gt;      String url = &quot;file:/D:/debug-experiments/debug-corpus/zip-within-zip.zip&quot;;&lt;br/&gt;
      URL source = new URL(url);&lt;br/&gt;
      Metadata metadata = new Metadata();&lt;br/&gt;
      InputStream stream = source.openStream();&lt;br/&gt;
      AutoDetectParser a = new AutoDetectParser();&lt;br/&gt;
      ContainerAwareDetector c = new ContainerAwareDetector(a.getDetector());&lt;br/&gt;
      MediaType mt = c.detect(stream, metadata);&lt;br/&gt;
      System.out.printf(&quot;Detected media-type=%s\n&quot;, mt);&lt;/p&gt;

&lt;p&gt;The output for me is:&lt;/p&gt;

&lt;p&gt;Detected media-type=application/vnd.apple.iwork&lt;/p&gt;

&lt;p&gt;I acknowledge that I might be misusing the ContainerAwareDetector. In my usual code (due to the fact that Tika does not detect UTF-16 encoded XML as XML), I have been extracting the byte header myself and calling AutoDetectParser.getDetector().getMimeType(header) directly. This doesn&apos;t currently seem to be possible with the ContainerAwareDetector, hence I haven&apos;t been using it.&lt;/p&gt;</comment>
                            <comment id="12922038" author="jukkaz" created="Mon, 18 Oct 2010 11:05:14 +0100"  >&lt;p&gt;The magic byte pattern we added in &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-402&quot; title=&quot;Support for iWork documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-402&quot;&gt;&lt;del&gt;TIKA-402&lt;/del&gt;&lt;/a&gt; for detecting iWork documents seems to be too eager, as it matches also this document. Note that the test file being itself a part of a zip archive makes no difference; it is detected as application/vnd.apple.iwork even as a standalone document.&lt;/p&gt;

&lt;p&gt;I removed the application/vnd.apple.iwork magic byte pattern in revision 1023712, which should solve your problem. It looks like we should instead use a container-aware detector also for iWork, as I had to also disable a few iWork test cases that would no longer correctly detect the format.&lt;/p&gt;</comment>
                            <comment id="12922581" author="gagravarr" created="Tue, 19 Oct 2010 15:58:03 +0100"  >&lt;p&gt;I&apos;ve added iWork support to the container aware detector in r1024255. It&apos;s a little evil, but it&apos;s fast and low memory, and maybe someone can improve it later on!&lt;/p&gt;</comment>
                            <comment id="12922601" author="gagravarr" created="Tue, 19 Oct 2010 16:55:47 +0100"  >&lt;p&gt;In r1024291 I&apos;ve also added the --container-aware-detector flag to the Tika CLI&lt;/p&gt;</comment>
                            <comment id="12922608" author="jukkaz" created="Tue, 19 Oct 2010 17:29:54 +0100"  >&lt;p&gt;Updated issue summary to better highlight that this is a problem with the application/vnd.apple.iwork type.&lt;/p&gt;

&lt;p&gt;&amp;gt; It&apos;s a little evil, but it&apos;s fast and low memory, and maybe someone can improve it later on!&lt;/p&gt;

&lt;p&gt;Those are the best kinds of changes. Incremental improvements FTW!&lt;/p&gt;

&lt;p&gt;BTW, I think we might as well make container-aware detection enabled by default in the CLI.&lt;/p&gt;</comment>
                            <comment id="12922642" author="gagravarr" created="Tue, 19 Oct 2010 18:51:34 +0100"  >&lt;p&gt;I can&apos;t see any more TODOs in the container detector code, so I guess it&apos;s good to go!&lt;/p&gt;

&lt;p&gt;We should probably provide a commandline option to let people switch back, and we&apos;ll want to do the gui too&lt;/p&gt;</comment>
                            <comment id="12926837" author="chrismattmann" created="Mon, 1 Nov 2010 05:30:57 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;pushing out to 0.9 &amp;#8211; there&apos;s no patch for this yet and it&apos;s 0.8 release time&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12993042" author="jukkaz" created="Thu, 10 Feb 2011 13:07:10 +0000"  >&lt;p&gt;This is already resolved as discussed above.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12457397" name="zip-within-zip.zip" size="299" author="geoff.jarrad" created="Sun, 17 Oct 2010 23:23:37 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 17 Oct 2010 22:50:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4328</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx37b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16838</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>