<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:29:24 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-851/TIKA-851.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-851] M4V and M4A detection invalid</title>
                <link>https://issues.apache.org/jira/browse/TIKA-851</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;When the mime type of an M4V file is detected using its name only, it returns video/x-m4v.  When it is detected using the InputStream (hence utilising the MagicDetector), it incorrectly returns video/quicktime.&lt;/p&gt;

&lt;p&gt;Using the sample M4V file from Apple&apos;s &lt;a href=&quot;http://support.apple.com/kb/HT1425&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;knowledge base&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;TikaTest.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class TikaTest {

	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
		&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; userHome = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;user.home&quot;&lt;/span&gt;);

		File file = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(userHome + &lt;span class=&quot;code-quote&quot;&gt;&quot;/Desktop/sample_iPod.m4v&quot;&lt;/span&gt;);

		InputStream is = TikaInputStream.get(file);

		Detector detector = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultDetector(
			MimeTypes.getDefaultMimeTypes());

		Metadata metadata = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Metadata();

		metadata.set(Metadata.RESOURCE_NAME_KEY, file.getName());

		&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;File + filename: &quot;&lt;/span&gt; + detector.detect(is, metadata));

		&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;File only:       &quot;&lt;/span&gt; + detector.detect(is, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Metadata()));

		&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Filename only:   &quot;&lt;/span&gt; + detector.detect(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, metadata));
	}

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Renders the output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
File + filename: video/quicktime
File only:       video/quicktime
Filename only:   video/x-m4v
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Moreover, if the same test is run against an M4A file, the results are even more incorrect:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
File + filename: video/quicktime
File only:       video/quicktime
Filename only:   application/octet-stream
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12540036">TIKA-851</key>
            <summary>M4V and M4A detection invalid</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="achow">Alexander Chow</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Jan 2012 13:10:14 +0000</created>
                <updated>Sat, 28 Jan 2012 20:18:19 +0000</updated>
                            <resolved>Fri, 27 Jan 2012 14:53:41 +0000</resolved>
                                    <version>1.0</version>
                                    <fixVersion>1.1</fixVersion>
                                    <component>mime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13194790" author="gagravarr" created="Fri, 27 Jan 2012 14:30:31 +0000"  >&lt;p&gt;I&apos;m not sure if we&apos;re going to be able to differentiate between .mov, .mp4 and .m4v with only mime magic, as I believe they all use the same container format&lt;/p&gt;

&lt;p&gt;We may need to look at a detector that opens the files up and checks them in a container aware manner&lt;/p&gt;</comment>
                            <comment id="13194813" author="gagravarr" created="Fri, 27 Jan 2012 14:53:26 +0000"  >&lt;p&gt;It looks like most files (not sure if it&apos;s all of them though) have a ftyp atom at byte 4. This has &quot;ftyp&quot; followed by a 4 byte (space padded if needed) string of the main type. There&apos;s a list of the common ones at &lt;a href=&quot;http://www.ftyps.com/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.ftyps.com/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve added more specific matches for the common types in r1236700. Using the tika-app jar, I can now correctly detect mp4 video, Apple m4v video, mp4 audio and old quicktime movs (using the lower priority fallback)&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if the ftyp atom has to be first or not, if it isn&apos;t then this detection won&apos;t work. Longer term, a proper file format aware detector would be best, ideally one that can also understand the rest of the format to report on different streams etc&lt;/p&gt;</comment>
                            <comment id="13194828" author="achow" created="Fri, 27 Jan 2012 15:05:35 +0000"  >&lt;p&gt;I&apos;ve added a patch file that I think should fix the problem for both M4V and M4A.&lt;/p&gt;

&lt;p&gt;According to &lt;a href=&quot;http://atomicparsley.sourceforge.net/mpeg-4files.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;AtomParsley&lt;/a&gt;, &quot;The ftyp atom is ALWAYS first.&quot;  This seems to corroborate with Apple&apos;s &lt;a href=&quot;http://developer.apple.com/library/mac/#documentation/QuickTime/QTFF/QTFFChap2/qtff2.html#//apple_ref/doc/uid/TP40000939-CH204-SW1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;spec&lt;/a&gt; discussion on &quot;The Movie Profile Atom&quot;.&lt;/p&gt;</comment>
                            <comment id="13194829" author="achow" created="Fri, 27 Jan 2012 15:08:26 +0000"  >&lt;p&gt;Sorry Nick, I didn&apos;t notice you update the SVN.  It looks like you need to change your mime type though from audio/x-mp4a to audio/x-m4a.&lt;/p&gt;</comment>
                            <comment id="13194854" author="gagravarr" created="Fri, 27 Jan 2012 15:37:28 +0000"  >&lt;p&gt;From &lt;a href=&quot;http://developer.apple.com/library/mac/#documentation/QuickTime/QTFF/QTFFChap1/qtff1.html#//apple_ref/doc/uid/TP40000939-CH203-BBCGDDDF&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://developer.apple.com/library/mac/#documentation/QuickTime/QTFF/QTFFChap1/qtff1.html#//apple_ref/doc/uid/TP40000939-CH203-BBCGDDDF&lt;/a&gt;&lt;br/&gt;
&quot;Generally speaking, atoms can be present in any order. Do not conclude that a particular atom is not present until you have parsed all the atoms in the file.&lt;/p&gt;

&lt;p&gt;An exception is the file type atom, which typically identifies the file as a QuickTime movie. If present, this atom precedes any movie atom, movie data, preview, or free space atoms. If you encounter one of these other atom types prior to finding a file type atom, you may assume the file type atom is not present. (This atom is introduced in the QuickTime File Format Specification for 2004, and is not present in QuickTime movie files created prior to 2004).&quot;&lt;/p&gt;

&lt;p&gt;So, if there is a ftyp atom, it should be first, and if the first atom isn&apos;t a ftyp then there isn&apos;t one. The AtomParsely link is handy, that should help with producing a metadata extracting parser&lt;/p&gt;</comment>
                            <comment id="13194891" author="gagravarr" created="Fri, 27 Jan 2012 16:26:04 +0000"  >&lt;p&gt;I&apos;ve added the audio/x-m4a alias in r1236734.&lt;/p&gt;</comment>
                            <comment id="13195001" author="achow" created="Fri, 27 Jan 2012 18:42:04 +0000"  >&lt;p&gt;Thanks Nick for adding the alias.&lt;/p&gt;</comment>
                            <comment id="13195027" author="achow" created="Fri, 27 Jan 2012 19:11:25 +0000"  >&lt;p&gt;Nick, although you add the ftyp for M4B (the bookmarkable format), you don&apos;t take into account its extension .m4b.  Do you think you can add that?&lt;/p&gt;</comment>
                            <comment id="13195587" author="gagravarr" created="Sat, 28 Jan 2012 17:59:52 +0000"  >&lt;p&gt;I&apos;ve added the m4b extension to audio/mp4 in r1237113.&lt;/p&gt;</comment>
                            <comment id="13195616" author="achow" created="Sat, 28 Jan 2012 20:18:19 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12512174" name="TIKA-851.patch" size="986" author="achow" created="Fri, 27 Jan 2012 15:05:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 27 Jan 2012 14:30:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>225539</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx18v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16521</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>