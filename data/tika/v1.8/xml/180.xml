<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:36:34 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-180/TIKA-180.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-180] XHTMLContentHandler unable to extract text from MSWord file</title>
                <link>https://issues.apache.org/jira/browse/TIKA-180</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;the issue is reproducible with Solr svn / ExtractingRequestHandler + patch SOLR.284 and tika all versions&lt;br/&gt;
I tried with some MSWord files but didn&apos;t try with xls or ppt files. &lt;/p&gt;

&lt;p&gt;See below an example of MSWord indexing with curl that returns an exception :&lt;/p&gt;

&lt;p&gt;  seb@gueuze:~$ curl &lt;a href=&quot;http://localhost:8983/solr/update/extract?ext.idx.attr=false&amp;amp;ext.def.fl=text&amp;amp;ext.extract.only=true&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://localhost:8983/solr/update/extract?ext.idx.attr=false\&amp;amp;ext.def.fl=text\&amp;amp;ext.extract.only=true&lt;/a&gt; -F &quot;myfile=@/tmp/TMB.doc&quot;&amp;lt;html&amp;gt;                                                                                                                                           &lt;br/&gt;
&amp;lt;head&amp;gt;                                                                                                                                           &lt;br/&gt;
&amp;lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=ISO-8859-1&quot;/&amp;gt;                                                                        &lt;br/&gt;
&amp;lt;title&amp;gt;Error 500 &amp;lt;/title&amp;gt;                                                                                                                        &lt;br/&gt;
&amp;lt;/head&amp;gt;                                                                                                                                          &lt;br/&gt;
&amp;lt;body&amp;gt;&amp;lt;h2&amp;gt;HTTP ERROR: 500&amp;lt;/h2&amp;gt;&amp;lt;pre&amp;gt;java.io.IOException: The character &apos;&apos; is an invalid XML character                                             &lt;/p&gt;

&lt;p&gt;org.apache.solr.common.SolrException: java.io.IOException: The character &apos;&apos; is an invalid XML character&lt;br/&gt;
        at org.apache.solr.handler.ExtractingDocumentLoader.load(ExtractingDocumentLoader.java:160)    &lt;br/&gt;
        at org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.java:54)&lt;br/&gt;
        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:131)               &lt;br/&gt;
        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1313)                                           &lt;br/&gt;
        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:303)                     &lt;br/&gt;
        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:232)                    &lt;br/&gt;
        at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1089)             &lt;br/&gt;
        at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:365)                            &lt;br/&gt;
        at org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)                         &lt;br/&gt;
        at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181)                            &lt;br/&gt;
        at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:712)                            &lt;br/&gt;
        at org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:405)                               &lt;br/&gt;
        at org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:211)        &lt;br/&gt;
        at org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java:114)                      &lt;br/&gt;
        at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:139)                            &lt;br/&gt;
        at org.mortbay.jetty.Server.handle(Server.java:285)                                                    &lt;br/&gt;
        at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:502)                             &lt;br/&gt;
        at org.mortbay.jetty.HttpConnection$RequestHandler.content(HttpConnection.java:835)                    &lt;br/&gt;
        at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:641)&lt;br/&gt;
        at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:202)&lt;br/&gt;
        at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:378)&lt;br/&gt;
        at org.mortbay.jetty.bio.SocketConnector$Connection.run(SocketConnector.java:226)&lt;br/&gt;
        at org.mortbay.thread.BoundedThreadPool$PoolThread.run(BoundedThreadPool.java:442)&lt;br/&gt;
Caused by: java.io.IOException: The character &apos;&apos; is an invalid XML character&lt;br/&gt;
        at org.apache.xml.serialize.BaseMarkupSerializer.characters(Unknown Source)&lt;br/&gt;
        at org.apache.tika.sax.ContentHandlerDecorator.characters(ContentHandlerDecorator.java:85)&lt;br/&gt;
        at org.apache.tika.sax.XHTMLContentHandler.characters(XHTMLContentHandler.java:130)&lt;br/&gt;
        at org.apache.tika.sax.XHTMLContentHandler.element(XHTMLContentHandler.java:136)&lt;br/&gt;
        at org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:78)&lt;br/&gt;
        at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:108)&lt;br/&gt;
        at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:80)&lt;br/&gt;
        at org.apache.solr.handler.ExtractingDocumentLoader.load(ExtractingDocumentLoader.java:146)&lt;br/&gt;
        ... 22 more&lt;br/&gt;
&amp;lt;/pre&amp;gt;&lt;br/&gt;
&amp;lt;p&amp;gt;RequestURI=/solr/update/extract&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;&amp;lt;i&amp;gt;&amp;lt;small&amp;gt;&amp;lt;a href=&quot;http://jetty.mortbay.org/&quot;&amp;gt;Powered by Jetty://&amp;lt;/a&amp;gt;&amp;lt;/small&amp;gt;&amp;lt;/i&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;br/&amp;gt;&lt;/p&gt;

&lt;p&gt;After investigation, it seems that OfficeParser returns text and ISO control characters.&lt;br/&gt;
I don&apos;t know where is the best place to fix the issue (POI, tika OfficeParser, etc)&lt;br/&gt;
following a lazy patch that remove ISO control characters and try again when an exception occur&lt;/p&gt;

&lt;p&gt;  &amp;#8212; src/main/java/org/apache/tika/sax/XHTMLContentHandler.java  (r&#233;vision 723972)&lt;br/&gt;
+++ src/main/java/org/apache/tika/sax/XHTMLContentHandler.java  (copie de travail)&lt;br/&gt;
@@ -132,7 +132,19 @@&lt;/p&gt;

&lt;p&gt;     public void element(String name, String value) throws SAXException {&lt;br/&gt;
         startElement(name);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;characters(value);&lt;br/&gt;
+        try 
{
+               characters(value);
+        }
&lt;p&gt; catch (Exception e) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+               int len = value.length();+               StringBuffer buffer = new StringBuffer();++               while (len &amp;gt; 0) {
+                if (!Character.isISOControl(value.charAt(len-1)))
+                     buffer.append(value.charAt(len-1));
+                len--;
+            }+            characters(buffer.toString());+        }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;         endElement(name);&lt;br/&gt;
     }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;



</description>
                <environment>&lt;p&gt;linux. SUN JVM 1.5.0_16-b02&lt;br/&gt;
Binary file indexing with Solr and Tika&lt;/p&gt;</environment>
        <key id="12410158">TIKA-180</key>
            <summary>XHTMLContentHandler unable to extract text from MSWord file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="sebastien michel">S&#233;bastien Michel</reporter>
                        <labels>
                    </labels>
                <created>Sun, 7 Dec 2008 19:47:08 +0000</created>
                <updated>Fri, 22 May 2009 23:04:55 +0100</updated>
                            <resolved>Wed, 7 Jan 2009 16:28:38 +0000</resolved>
                                    <version>0.2</version>
                    <version>0.3</version>
                                    <fixVersion>0.3</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12654347" author="sebastien michel" created="Mon, 8 Dec 2008 08:30:45 +0000"  >&lt;p&gt;However the parsing is OK with tika cli &lt;/p&gt;</comment>
                            <comment id="12661624" author="jukkaz" created="Wed, 7 Jan 2009 16:28:38 +0000"  >&lt;p&gt;I added a SafeContentHandler decorator class that prevents invalid XML characters (currently just the &amp;lt;0x20 control characters) from being outputted. This is important for any downstream applications that expect strict XML output from Tika.&lt;/p&gt;

&lt;p&gt;I also made XHTMLContentHandler extend SafeContentHandler so all XHTML produced by Tika will automatically be &quot;safe&quot; XML.&lt;/p&gt;

&lt;p&gt;Using the SafeContentHandler class is lossy (all invalid XML characters are replaced with spaces), but this shouldn&apos;t be a problem as the purpose of Tika is to extract text instead of binary data from input documents.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12395512" name="TMB.doc" size="78848" author="sebastien michel" created="Sun, 7 Dec 2008 19:50:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 7 Jan 2009 16:28:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4681</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx5dj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17190</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>