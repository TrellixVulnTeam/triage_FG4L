<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:28:34 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-1014/TIKA-1014.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-1014] Allow custom MimeTypesReader</title>
                <link>https://issues.apache.org/jira/browse/TIKA-1014</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;The current MimeTypesReader is package protected with private fields.  It would be great to allow subclassing this Reader to support custom behavior.  In particular:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;error handling&lt;/li&gt;
	&lt;li&gt;custom XML tags&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12613995">TIKA-1014</key>
            <summary>Allow custom MimeTypesReader</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ryantxu">Ryan McKinley</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Oct 2012 06:01:31 +0000</created>
                <updated>Mon, 29 Apr 2013 15:20:28 +0100</updated>
                            <resolved>Mon, 29 Apr 2013 15:20:28 +0100</resolved>
                                                    <fixVersion>1.4</fixVersion>
                                    <component>mime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13486677" author="ryantxu" created="Tue, 30 Oct 2012 06:07:51 +0000"  >&lt;p&gt;Here is a &lt;b&gt;rough&lt;/b&gt; patch that adds an error handling class and some hooks to wire it up.&lt;/p&gt;

&lt;p&gt;The default class is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class MimeTypesReaderErrorHandler {

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void onMimeTypeError(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name, MimeTypes types, MimeTypeException e) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SAXException {
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SAXException(e);
  }
  
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void onGlobError(MimeType type, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; pattern, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isRegex, MimeTypes types, MimeTypeException ex) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SAXException {
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SAXException(ex);
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This adds a function to MimeTypesFactory:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; MimeTypes create(Iterable&amp;lt;InputStream&amp;gt; inputStreams, MimeTypesReaderErrorHandler errors)
            &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, MimeTypeException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I don&apos;t really like the name, but I am posting this here to see what people think and any suggestions on how to support lenient parsing.&lt;/p&gt;

&lt;p&gt;thanks&lt;br/&gt;
ryan&lt;/p&gt;

</comment>
                            <comment id="13633266" author="ryantxu" created="Tue, 16 Apr 2013 20:56:29 +0100"  >&lt;p&gt;after working with this for a while, I think a more general approach is a better idea&lt;/p&gt;</comment>
                            <comment id="13633269" author="ryantxu" created="Tue, 16 Apr 2013 20:58:19 +0100"  >&lt;p&gt;If people are OK with the direction of this, I will add tests etc...&lt;/p&gt;</comment>
                            <comment id="13633285" author="ryantxu" created="Tue, 16 Apr 2013 21:06:30 +0100"  >&lt;p&gt;previous patch was missing the simple test&lt;/p&gt;</comment>
                            <comment id="13633316" author="gagravarr" created="Tue, 16 Apr 2013 21:37:43 +0100"  >&lt;p&gt;At first glance the new patch looks promising. Any chance you could also do a unit test that shows off the error handling changes? That would both provide test coverage, and give us some example code using it to help review/understand&lt;/p&gt;</comment>
                            <comment id="13633400" author="ryantxu" created="Tue, 16 Apr 2013 22:37:08 +0100"  >&lt;p&gt;updated patch with an error handling example.&lt;/p&gt;

&lt;p&gt;In this example, the custom reader reads two files that have conflicting glob patters.  The custom handler just logs the warning without failing:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void handleError(MimeType type, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; err, Exception ex, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; qName, Attributes attributes) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SAXException {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(ERROR_BAD_GLOB.equals(err)) {
        ignorePatterns.add( type.toString() + &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;gt;&amp;gt;&quot;&lt;/span&gt; + attributes.getValue(PATTERN_ATTR));
      }
      &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SAXException(ex);
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="13633411" author="gagravarr" created="Tue, 16 Apr 2013 22:42:47 +0100"  >&lt;p&gt;That all seems to make sense to me. Let&apos;s wait a few days in case anyone has any suggested improvements, before applying the patch. (In case we forget, please ping if there have been no alternate suggestions in 5 days and the patch hasn&apos;t been applied by then!)&lt;/p&gt;</comment>
                            <comment id="13633417" author="ryantxu" created="Tue, 16 Apr 2013 22:45:57 +0100"  >&lt;p&gt;changed approach to new functions for each error type:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void handleMimeError(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; input, MimeTypeException ex, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; qName, Attributes attributes) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SAXException {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SAXException(ex);
    }
    
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void handleGlobError(MimeType type, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; pattern, MimeTypeException ex, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; qName, Attributes attributes) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SAXException {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SAXException(ex);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13633418" author="ryantxu" created="Tue, 16 Apr 2013 22:47:02 +0100"  >&lt;p&gt;Thanks Nick &amp;#8211; lets let it settle and loop back in a week or so unless there is more feedback.&lt;/p&gt;</comment>
                            <comment id="13640795" author="ryantxu" created="Wed, 24 Apr 2013 19:58:59 +0100"  >&lt;p&gt;Hi Nick &amp;#8211; let me know if you need anything else from me. &lt;/p&gt;

&lt;p&gt;Thanks!&lt;br/&gt;
ryan&lt;/p&gt;</comment>
                            <comment id="13643196" author="gagravarr" created="Fri, 26 Apr 2013 21:06:14 +0100"  >&lt;p&gt;Silence... So I think we&apos;re good to go! I&apos;m just about to board a plane now, but I&apos;ll try to apply the patch later this weekend, assuming someone else doesn&apos;t beat me to it!&lt;/p&gt;</comment>
                            <comment id="13644510" author="gagravarr" created="Mon, 29 Apr 2013 15:20:28 +0100"  >&lt;p&gt;Thanks for this patch, applied in r1477097.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12551308" name="TIKA-1014-CustomErrorHandling.patch" size="10591" author="ryantxu" created="Tue, 30 Oct 2012 06:07:51 +0000"/>
                            <attachment id="12579023" name="TIKA-1014-CustomMimeTypesReader.patch" size="8658" author="ryantxu" created="Tue, 16 Apr 2013 22:45:57 +0100"/>
                            <attachment id="12579020" name="TIKA-1014-CustomMimeTypesReader.patch" size="9446" author="ryantxu" created="Tue, 16 Apr 2013 22:37:08 +0100"/>
                            <attachment id="12579003" name="TIKA-1014-CustomMimeTypesReader.patch" size="6392" author="ryantxu" created="Tue, 16 Apr 2013 21:06:30 +0100"/>
                            <attachment id="12579000" name="TIKA-1014-CustomMimeTypesReader.patch" size="3315" author="ryantxu" created="Tue, 16 Apr 2013 20:57:22 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 16 Apr 2013 20:37:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253108</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy7647:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>75801</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>