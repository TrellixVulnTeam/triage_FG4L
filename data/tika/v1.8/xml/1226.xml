<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:31:55 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-1226/TIKA-1226.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-1226] PDFTextStripper fails while getting data of PDF form fields of type PDSignatureField</title>
                <link>https://issues.apache.org/jira/browse/TIKA-1226</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;I have a PDF document that contains a filled in form. Among the various fields of type text and radio button there are multiple fields for digital signatures. When I load this document into tika-app I get the following exception:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: java.lang.RuntimeException: Can&apos;t get signature as String, use getSignature() instead.
	at org.apache.pdfbox.pdmodel.interactive.form.PDSignatureField.getValue(PDSignatureField.java:131)
	at org.apache.tika.parser.pdf.PDF2XHTML.addFieldString(PDF2XHTML.java:467)
	at org.apache.tika.parser.pdf.PDF2XHTML.processAcroField(PDF2XHTML.java:425)
	at org.apache.tika.parser.pdf.PDF2XHTML.extractAcroForm(PDF2XHTML.java:411)
	at org.apache.tika.parser.pdf.PDF2XHTML.endDocument(PDF2XHTML.java:184)
	at org.apache.pdfbox.util.PDFTextStripper.writeText(PDFTextStripper.java:330)
	at org.apache.tika.parser.pdf.PDF2XHTML.process(PDF2XHTML.java:95)
	at org.apache.tika.parser.pdf.PDFParser.parse(PDFParser.java:143)
	at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)
	... 43 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem seems to be that PDF2XHTML seems to expect that it can call getValue() on all PDField objects. According to the PDFBox 1.8.3 java doc this is not true for the sub class PDSignatureField:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://pdfbox.apache.org/docs/1.8.3/javadocs/org/apache/pdfbox/pdmodel/interactive/form/PDSignatureField.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://pdfbox.apache.org/docs/1.8.3/javadocs/org/apache/pdfbox/pdmodel/interactive/form/PDSignatureField.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The java doc says that getSignature() should be called instead. &lt;/p&gt;

&lt;p&gt;Assuming that the information inside the signature is not relevant for the extraction process and can be discarded the following patch helps:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Index: tika-parsers/src/main/java/org/apache/tika/parser/pdf/PDF2XHTML.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
&amp;lt;+&amp;gt;UTF-8
===================================================================
--- tika-parsers/src/main/java/org/apache/tika/parser/pdf/PDF2XHTML.java	(revision 1560617)
+++ tika-parsers/src/main/java/org/apache/tika/parser/pdf/PDF2XHTML.java	(revision )
@@ -40,6 +40,7 @@
 import org.apache.pdfbox.pdmodel.interactive.documentnavigation.outline.PDOutlineNode;
 import org.apache.pdfbox.pdmodel.interactive.form.PDAcroForm;
 import org.apache.pdfbox.pdmodel.interactive.form.PDField;
+import org.apache.pdfbox.pdmodel.interactive.form.PDSignatureField;
 import org.apache.pdfbox.util.PDFTextStripper;
 import org.apache.pdfbox.util.TextPosition;
 import org.apache.tika.exception.TikaException;
@@ -464,7 +465,9 @@
           }
           String value = &quot;&quot;;
           try {
+              if (!(field instanceof PDSignatureField)) {
-              value = field.getValue();
+                  value = field.getValue();
+              }
           } catch (IOException e) {
                //swallow
           }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="12690745">TIKA-1226</key>
            <summary>PDFTextStripper fails while getting data of PDF form fields of type PDSignatureField</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tallison@mitre.org">Tim Allison</assignee>
                                    <reporter username="uknela">Eric Knauel</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Jan 2014 10:59:57 +0000</created>
                <updated>Mon, 27 Jan 2014 13:27:21 +0000</updated>
                            <resolved>Mon, 27 Jan 2014 13:27:21 +0000</resolved>
                                    <version>1.5</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13880130" author="tallison@mitre.org" created="Thu, 23 Jan 2014 17:49:18 +0000"  >&lt;p&gt;Eric,&lt;br/&gt;
  Thank you for reporting this.  I&apos;ll make the fix shortly.  Are you able to share your document as a test case?  Thank you, again.&lt;/p&gt;</comment>
                            <comment id="13880273" author="tallison@mitre.org" created="Thu, 23 Jan 2014 19:42:08 +0000"  >&lt;p&gt;How about we grab the name? &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;              if (field instanceof PDSignatureField){
                  PDSignature sig = ((PDSignatureField)field).getSignature();
                  if (sig != null){
                      value = sig.getName();
                  }
              } else {
                  value = field.getValue();
              }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Should we also grab the contactinfo, location, the date or the reason?&lt;/p&gt;</comment>
                            <comment id="13880877" author="uknela" created="Fri, 24 Jan 2014 10:27:01 +0000"  >&lt;p&gt;Tim,&lt;/p&gt;

&lt;p&gt;I&apos;ve uploaded a test PDF document that contains a field of type signature. That&apos;s not the original document that led to the error but it produces the same stack trace. The form data is empty and document is not signed. Somehow I couldn&apos;t get the PDF editor to set the permission for signing to true. (This permission was enabled in my original document, but I can&apos;t publish the document.)&lt;/p&gt;

&lt;p&gt;I think it would be useful to grab information on the signer from the PDF!&lt;/p&gt;</comment>
                            <comment id="13881383" author="tallison@mitre.org" created="Fri, 24 Jan 2014 20:20:01 +0000"  >&lt;p&gt;Thank you for the test file.  I&apos;ll use that in the formal test.  I used another doc for dev that I unfortunately can&apos;t share.  Does this format look good?  My dev doc only had name and date, but the other info would also show up if it existed...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;div class=&quot;acroform&quot;&amp;gt;
	&amp;lt;ol&amp;gt;
		&amp;lt;li altName=&quot;name&quot;&amp;gt;Name: my name&amp;lt;/li&amp;gt;
		&amp;lt;li&amp;gt;
			&amp;lt;ol type=&quot;signaturedata&quot;&amp;gt;	
				&amp;lt;li signdata=&quot;date&quot;&amp;gt;2014-01-17T11:57:26-0500&amp;lt;/li&amp;gt;
				&amp;lt;li signdata=&quot;name&quot;&amp;gt;my name&amp;lt;/li&amp;gt;
			&amp;lt;/ol&amp;gt;
		&amp;lt;/li&amp;gt;
	&amp;lt;/ol&amp;gt;
&amp;lt;/div&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13882661" author="uknela" created="Mon, 27 Jan 2014 09:36:15 +0000"  >&lt;p&gt;Tim, that looks very good to me!&lt;/p&gt;</comment>
                            <comment id="13882797" author="tallison@mitre.org" created="Mon, 27 Jan 2014 13:12:18 +0000"  >&lt;p&gt;Committed: r1561661.  Keeping fingers crossed that Jenkins is in a better mood this morning.  &lt;/p&gt;

&lt;p&gt;Eric, many thanks for raising this issue, diagnosing the cause and creating the test doc!   &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12625030" name="pdf-form-with-signature-field-empty.pdf" size="36220" author="uknela" created="Fri, 24 Jan 2014 10:27:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 23 Jan 2014 17:49:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>369483</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzlj73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>369788</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>