<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:34:37 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-782/TIKA-782.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-782] Add support for parsing binary data in RTF files</title>
                <link>https://issues.apache.org/jira/browse/TIKA-782</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;The current RTF parser doesn&apos;t process \bin control words yet. These control words are followed by a specific amount of binary data. Because of this, the RTF parser trips over some of these bytes in a number of (classified) documents.&lt;/p&gt;

&lt;p&gt;I&apos;ve implemented processing of the \bin control word, but it required of the core parsing algorithm. IMHO, it also improved readability of the code. I hope you will accept this patch. Please let me know if the patch requires modifications.&lt;/p&gt;

&lt;p&gt;Apart from the \bin code word, this patch also makes the parser stop after reading the document-closing &apos;}&apos; character. In a number of files (again, classified), the parser would include non-readable characters that appeared after this closing brace.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12531173">TIKA-782</key>
            <summary>Add support for parsing binary data in RTF files</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="arjohn">Arjohn Kampman</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Nov 2011 20:09:23 +0000</created>
                <updated>Thu, 17 Nov 2011 20:34:25 +0000</updated>
                            <resolved>Thu, 17 Nov 2011 20:34:25 +0000</resolved>
                                    <version>1.0</version>
                                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13148710" author="arjohn" created="Fri, 11 Nov 2011 20:10:02 +0000"  >&lt;p&gt;Patch adding \bin support.&lt;/p&gt;</comment>
                            <comment id="13150718" author="arjohn" created="Tue, 15 Nov 2011 19:45:29 +0000"  >&lt;p&gt;improved patch&lt;/p&gt;</comment>
                            <comment id="13150719" author="arjohn" created="Tue, 15 Nov 2011 19:46:52 +0000"  >&lt;p&gt;I&apos;ve attached an improved patch that actually reads the binary data into an array. Apparently, InputStream.skip(long) can read past the file limit and pretend to have skipped to specified number of bytes.&lt;/p&gt;</comment>
                            <comment id="13152041" author="mikemccand" created="Thu, 17 Nov 2011 13:31:53 +0000"  >&lt;p&gt;These changes look great!&lt;/p&gt;

&lt;p&gt;Cutover to PushbackInputStream, and then using this to lookahead to&lt;br/&gt;
find &apos;*&apos; after &apos;{&apos; to know we should ignore the group state, is&lt;br/&gt;
great; much simpler than before.&lt;/p&gt;

&lt;p&gt;I like the new broken out methods for parsing control token/word, hex&lt;br/&gt;
char.&lt;/p&gt;

&lt;p&gt;Since addOutputByte now takes int instead of byte, could you add an&lt;br/&gt;
assert that the int is &quot;in bounds&quot; for byte?&lt;/p&gt;

&lt;p&gt;It makes me nervous creating a new StringBuilder and String for every&lt;br/&gt;
control word; can we go back to our own reused char[] buffer/ equals&lt;br/&gt;
method?&lt;/p&gt;

&lt;p&gt;Instead of allocating a full byte[] for the &quot;bin&quot; control word, can we&lt;br/&gt;
say allocate (up to) a fixed buffer size and read in chunks until&lt;br/&gt;
we&apos;ve skipped that many bytes?  This way if an RTF doc has massive&lt;br/&gt;
embedded binary data we don&apos;t use lots of RAM when skipping it.&lt;/p&gt;</comment>
                            <comment id="13152076" author="arjohn" created="Thu, 17 Nov 2011 14:34:32 +0000"  >&lt;p&gt;I&apos;ll make the necessary changes.&lt;/p&gt;

&lt;p&gt;Do you mind if I changed the &amp;lt;long&amp;gt; parameter of processControlWord() to an &amp;lt;int&amp;gt;.There&apos;s a comment above that method that says:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;// Param is long because spec says max value is 1+ Integer.MAX_VALUE!&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;However, Microsoft&apos;s RTF 1.9.1 specs says:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The range of the values for the number is nominally -32768 through 32767, i.e., a signed 16-bit integer. A small number of control words take values in the range&#8204; &#8722;2,147,483,648 to 2,147,483,647 (32-bit signed integer).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is exactly the range of Java&apos;s int. Not sure which spec the comment is referring to though.&lt;/p&gt;</comment>
                            <comment id="13152119" author="mikemccand" created="Thu, 17 Nov 2011 16:15:09 +0000"  >
&lt;blockquote&gt;&lt;p&gt;I&apos;ll make the necessary changes.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Do you mind if I changed the &amp;lt;long&amp;gt; parameter of processControlWord() to an &amp;lt;int&amp;gt;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hrm, the 1.8 spec says this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;The parameter can be a positive or negative number. The range of the
values for the number is generally &#8211;32767 through 32767. However, Word
tends to restrict the range to &#8211;31680 through 31680 and also allows
values in the range &#8211;2,147,483,648 to 2,147,483,648 for a small number
of keywords (specifically \bin, \revdttm, and some picture
properties). An RTF parser must allow an arbitrary string of digits as
a legal value for a keyword (providing it does not exceed value ranges
noted earlier). 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But you&apos;re right the 1.9 spec changed the max to&lt;br/&gt;
Integer.MAX_VALUE... I guess they changed it for 1.9, and this was a&lt;br/&gt;
&quot;bug&quot; in the 1.8 spec &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;So I think int is safe!&lt;/p&gt;</comment>
                            <comment id="13152205" author="arjohn" created="Thu, 17 Nov 2011 18:42:24 +0000"  >&lt;p&gt;New patch with the requested changes.&lt;/p&gt;</comment>
                            <comment id="13152246" author="mikemccand" created="Thu, 17 Nov 2011 19:12:44 +0000"  >&lt;p&gt;OK looks great Arjohn!  Do you have an example RTF doc with \bin that we can use as a test case...?&lt;/p&gt;</comment>
                            <comment id="13152252" author="arjohn" created="Thu, 17 Nov 2011 19:20:06 +0000"  >&lt;p&gt;Unfortunately, the one that I used is confidential. I&apos;ve searching for another file but didn&apos;t fine one yet. Apparently, most images are encoded as hex values. I&apos;ll let you know if I manage to find one.&lt;/p&gt;

&lt;p&gt;As an alternative, I can extend an existing rtf file with a fake binary section. Would that work for you?&lt;/p&gt;</comment>
                            <comment id="13152273" author="arjohn" created="Thu, 17 Nov 2011 19:38:24 +0000"  >&lt;p&gt;Bingo, found one in the published Enron data. It&apos;s an RTF with the Enron logo. No text though.&lt;/p&gt;</comment>
                            <comment id="13152288" author="mikemccand" created="Thu, 17 Nov 2011 20:08:42 +0000"  >&lt;p&gt;That works for me: pre-patch we extract this binary content as if it were text; post patch we extract nothing.  I&apos;ll add a test case based on this and commit....&lt;/p&gt;

&lt;p&gt;Thanks Arjohn!&lt;/p&gt;</comment>
                            <comment id="13152298" author="mikemccand" created="Thu, 17 Nov 2011 20:34:25 +0000"  >&lt;p&gt;I made minor edits (fixing up whitespace; removing unused param), and whittled back the test case to a smaller size while still showing fail + pass.&lt;/p&gt;

&lt;p&gt;Thanks Arjohn!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12503414" name="bin.patch" size="29225" author="arjohn" created="Fri, 11 Nov 2011 20:10:02 +0000"/>
                            <attachment id="12503783" name="bin2.patch" size="30069" author="arjohn" created="Tue, 15 Nov 2011 19:45:29 +0000"/>
                            <attachment id="12504093" name="bin3.patch" size="18569" author="arjohn" created="Thu, 17 Nov 2011 18:42:24 +0000"/>
                            <attachment id="12504106" name="logo.zip" size="17988" author="arjohn" created="Thu, 17 Nov 2011 19:38:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 17 Nov 2011 13:31:53 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>216910</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx1o7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16590</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>