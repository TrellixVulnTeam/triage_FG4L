<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:30:32 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-490/TIKA-490.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-490] Support for adding language profiles dynamically</title>
                <link>https://issues.apache.org/jira/browse/TIKA-490</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;Currently the Tika LanguageIdentifier loads language profiles thorugh a hardcoded static block in the java code.&lt;/p&gt;

&lt;p&gt;It would be better to make this configurable, so you could add your own languages without recompiling.&lt;/p&gt;

&lt;p&gt;Suggested approach:&lt;br/&gt;
Remove the static code block loading all languages. Instead look for a tika.languageidentification.properties file on classpath.&lt;br/&gt;
Now the user can simply make his/her own (additional) language profile files, put them on the classpath together with a properties file and off you go!&lt;/p&gt;

&lt;p&gt;Also, once you make it configurable, there might be an issue of having the profiles as static members, as you will force the same behaviour for the whole VM. A static Map of Maps could solve this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12472157">TIKA-490</key>
            <summary>Support for adding language profiles dynamically</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chrismattmann">Chris A. Mattmann</assignee>
                                    <reporter username="janhoy">Jan H&#248;ydahl</reporter>
                        <labels>
                    </labels>
                <created>Sat, 21 Aug 2010 12:50:26 +0100</created>
                <updated>Mon, 1 Nov 2010 05:21:17 +0000</updated>
                            <resolved>Mon, 1 Nov 2010 05:21:17 +0000</resolved>
                                    <version>0.7</version>
                                    <fixVersion>0.8</fixVersion>
                                    <component>languageidentifier</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="12901035" author="janhoy" created="Sat, 21 Aug 2010 16:24:17 +0100"  >&lt;p&gt;Here is my first patch (against current trunk 987074) which adds a properties file for languages list, and initializes profiles in constructor. I also made the new initProfiles() public so that it is possible to programmatically re-load the profiles if you have changed the property file, without restarting the JavaVM.&lt;/p&gt;

&lt;p&gt;I also changed the URL for ISO639 to a more complete version, and extracted some strings into constants.&lt;/p&gt;

&lt;p&gt;Also added a JDK logger to add some output. Did not use log4j or slf4j because those would require new dependencies and hurt backwards drop-in compatibility. We now log what languages get initalized and from which property file, which will aid in debugging.&lt;/p&gt;

&lt;p&gt;All existing tests PASS. No API changes are done which breaks backward compatibility.&lt;/p&gt;

&lt;p&gt;It would be great if someone could test it and commit it in time for 0.8, as I suspect to use it with Solr with some custom language profiles.&lt;/p&gt;</comment>
                            <comment id="12901077" author="janhoy" created="Sat, 21 Aug 2010 19:53:19 +0100"  >&lt;p&gt;Changed initProfiles() to a static method, and also made the Properties object static. Re-ran tests.&lt;/p&gt;</comment>
                            <comment id="12901170" author="chrismattmann" created="Sun, 22 Aug 2010 15:39:48 +0100"  >&lt;p&gt;Hi Jan,&lt;/p&gt;

&lt;p&gt;I don&apos;t get the point of the override properties part. What does it buy us? The way you&apos;ve set it up, it also loads from the classpath just like the language identifier properties proper file, so, it shouldn&apos;t be any more arduous to just mod that file if necessary (since they both are classpath loaded). &lt;/p&gt;

&lt;p&gt;Let me know what you think. I&apos;ve reviewed the rest of the patch it looks good and I&apos;m ready to commit it, sans the override part.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Chris&lt;/p&gt;</comment>
                            <comment id="12901176" author="janhoy" created="Sun, 22 Aug 2010 16:44:42 +0100"  >&lt;p&gt;(Adding same comment to this issue as I sent to mailing list)&lt;/p&gt;

&lt;p&gt;My rationale for the override part is as follows:&lt;/p&gt;

&lt;p&gt;The default properties file will be embedded within tika-xx.jar. I assume most people are not keen to unpack and repack JARs to make a config change. We COULD put a similar named properties file at another location, but then the user needs to make sure that location is EARLIER in classpath than the JAR file. In the case of e.g. Solr (Tomcat, Jetty..) it is not obvious how to ensure this, and to avoid any confusion about class-loader peculiarities, it&apos;s more straight-forward to look for an override file.&lt;/p&gt;

&lt;p&gt;Take Solr as an example. The user would then put the override properties file along with his new language profiles in a folder $SOLR_HOME/lib/org/apache/tika/language/&lt;/p&gt;</comment>
                            <comment id="12901178" author="chrismattmann" created="Sun, 22 Aug 2010 16:49:53 +0100"  >&lt;p&gt;Interesting. What why couldn&apos;t we just name the file the same thing, then? Would this be putting it up as a gamble to the Classloader?&lt;/p&gt;</comment>
                            <comment id="12901179" author="chrismattmann" created="Sun, 22 Aug 2010 17:02:58 +0100"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;see my updated patch. I&apos;ve replaced all logging in the patch with TikaExceptions and proper handling. We don&apos;t want to have any logging in tika-core. If logging needs to happen it can happen downstream in the clients of the functionality provided by core. I also decided I&apos;m fine with the override file notion (thanks for the explanation, Jan!). If there are no objections I&apos;d like to commit this in the next 24 hours.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12901180" author="janhoy" created="Sun, 22 Aug 2010 17:05:53 +0100"  >&lt;p&gt;Either solution is OK by me.&lt;/p&gt;

&lt;p&gt;But from my experience classpath problems in application servers can cause a headache, and therefore I tried to be as explicit as possible.&lt;/p&gt;

&lt;p&gt;It would of course work to put a tika.language.properties file on classpath as well, if you know it&apos;s earlier in classpath than the tika jar.&lt;/p&gt;

&lt;p&gt;Or we could name the jar-internal properties file tika.language.default.properties, and let people override through tika.language.properties &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll leave the decision up to you. Remove the override if you feel strong about it.&lt;/p&gt;</comment>
                            <comment id="12901185" author="chrismattmann" created="Sun, 22 Aug 2010 17:29:05 +0100"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;updated patch. I decided against throwing TikaExceptions, and just decided to throw an IOException if there was a problem loading the props file containing the profile default information. This makes the &lt;b&gt;real&lt;/b&gt; exception the one that&apos;s exposed to the consumer of this API, which makes more sense. I don&apos;t like returning null in ProfilingWriter#getLanguage, but I couldn&apos;t think of anything more elegant at this time. So, I documented that there&apos;s a possibility that that method could return null now, so a caller should plan accordingly.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If there are no objections, I&apos;ll commit this in the next 24 hrs.&lt;/p&gt;</comment>
                            <comment id="12901218" author="janhoy" created="Mon, 23 Aug 2010 00:15:52 +0100"  >&lt;p&gt;Been thinking a bit more, and attaching a (in my eyes) approved patch.&lt;/p&gt;

&lt;p&gt;Those who override the config, they need better logging, else they&apos;re in the dark as to what happened.&lt;br/&gt;
Since we cannot use a log framework, I&apos;ve added a way to detect and fetch errors through the API.&lt;/p&gt;

&lt;p&gt;Also I&apos;ve removed the throw of IOException in constructor. Since there is only a risk of that particular exception being thrown if the property file does not exist, in my opinion this will NEVER happen. So we should not force people to catch it. Also, it is better to keep backward API compatibility for all the existing applications out there. Users that override config will not either get the IOException since - if their tika.language.override.properties does not exist, tika will load the built-in one. And if the property file exists but is faulty, you&apos;ll not get IOException either. If there are errors in the properties file, you can test that through the new methods, and even ask for a list of languages that are successfully initialized.&lt;/p&gt;

&lt;p&gt;Changes in the attached patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;public static boolean hasErrors()&lt;/li&gt;
	&lt;li&gt;public static String getErrors()&lt;/li&gt;
	&lt;li&gt;public static Set&amp;lt;String&amp;gt; getSupportedLanguages()&lt;/li&gt;
	&lt;li&gt;Constructor no longer throws IOException&lt;/li&gt;
	&lt;li&gt;Added better comments to public methods, including a warning for isReasonablyCertain() and short texts&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Sample output from a test application:&lt;br/&gt;
Supported languages: &lt;span class=&quot;error&quot;&gt;&amp;#91;is, da, it, no, hu, th, de, el, fi, pt, pl, sv, fr, en, ru, et, es, nl&amp;#93;&lt;/span&gt;&lt;br/&gt;
Number of languages supported: 18&lt;br/&gt;
Has errors? true&lt;br/&gt;
    Language xx (Unknown) not initialized. Message: Failed trying to load language profile for language &quot;xx&quot;. Error: null&lt;/p&gt;</comment>
                            <comment id="12901220" author="chrismattmann" created="Mon, 23 Aug 2010 00:26:56 +0100"  >&lt;p&gt;Hi Jan:&lt;/p&gt;

&lt;p&gt;I like your approach! Definitely a nice set of improvements. I noticed though in the patch there are still places (the unit tests) where we check for Exceptions &amp;#8211; this isn&apos;t needed anymore since your updates obviate any exception being thrown. No worries, I&apos;ll address this when I commit your patch. Looks good to me. I plan to commit this sometime tonight or tomorrow.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Chris&lt;/p&gt;</comment>
                            <comment id="12901222" author="janhoy" created="Mon, 23 Aug 2010 00:43:14 +0100"  >&lt;p&gt;Yepp, I saw that.&lt;/p&gt;

&lt;p&gt;This patch removes the try&apos;s from test.&lt;br/&gt;
I also removed the call to initProfiles() from constructor, as we now call it statically, and we no longer throw IOException in constructor, so we don&apos;t need it there for that purpose.&lt;/p&gt;

&lt;p&gt;I also took the freedom of adding a simple getter&lt;br/&gt;
public double getDistance()&lt;br/&gt;
I know that it is not directly related to this issue, so feel free to discard it and I will create a new ticket fir it.&lt;br/&gt;
But given its low risk and high gain... at least until &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-369&quot; title=&quot;Improve accuracy of language detection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-369&quot;&gt;TIKA-369&lt;/a&gt; is implemented.&lt;br/&gt;
it would let the consumer decide what is certain enough for his use case. by e.g. computing normalized distance based on text length.&lt;br/&gt;
An alternative is to mark it as deprecated and semi-internal, as the numerical value will probably change with &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-369&quot; title=&quot;Improve accuracy of language detection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-369&quot;&gt;TIKA-369&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12901231" author="jukkaz" created="Mon, 23 Aug 2010 02:06:51 +0100"  >&lt;p&gt;I wonder why we&apos;d need these extra properties files in the first place. As an alternative, how about if we just added an optional Map&amp;lt;String, LanguageProfile&amp;gt; argument to the LanguageIdentifier constructors, so applications that want to add new languages or customize the default profiles can easily do so. Such an approach would be much more flexible and less error-prone (no need for extra logging) than using properties files, and an application that needs runtime configuration of language profiles can still implement its own properties files for this purpose.&lt;/p&gt;</comment>
                            <comment id="12901243" author="chrismattmann" created="Mon, 23 Aug 2010 03:56:42 +0100"  >&lt;p&gt;Hey Jukka:&lt;/p&gt;

&lt;p&gt;+1, let me take a crack at addressing your issues. I think we can make this look like the way that the Parsers are dynamically loaded, including the API support for it.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Chris&lt;/p&gt;</comment>
                            <comment id="12901335" author="janhoy" created="Mon, 23 Aug 2010 10:55:38 +0100"  >&lt;p&gt;Jukka,&lt;/p&gt;

&lt;p&gt;Your idea for programmatic adding of profiles is good for some integration scenarios.&lt;/p&gt;

&lt;p&gt;My original intent with filing this issue however, was to support the case where an (end) user or integrator needs to add support for a new langue on the fly without programming.&lt;/p&gt;

&lt;p&gt;For me as a Search engine Consultant I can then add say Sami Language support to Solr extracting request handler by placing one property file and one Language profile file on the classpath. With a constructor only this would require code change to Solr.&lt;/p&gt;

&lt;p&gt;So we can add constructor but please don&apos;t remove property file.&lt;/p&gt;</comment>
                            <comment id="12912464" author="janhoy" created="Mon, 20 Sep 2010 14:58:42 +0100"  >&lt;p&gt;Updated patch which adds ability to load your own map of LanguageProfile-s programmatically. I chose to do that not via a constructor, but rather a new signature for for initProfiles(), which will replace the profiles map with the one provided.&lt;/p&gt;

&lt;p&gt;The public API after this patch will be:&lt;br/&gt;
    // Existing&lt;br/&gt;
    public LanguageIdentifier(LanguageProfile profile)&lt;br/&gt;
    public LanguageIdentifier(String content)&lt;br/&gt;
    public String getLanguage()&lt;br/&gt;
    public boolean isReasonablyCertain()&lt;br/&gt;
    public String toString()&lt;/p&gt;

&lt;p&gt;    // New from patch&lt;br/&gt;
    public static void initProfiles()&lt;br/&gt;
    public static void initProfiles(Map&amp;lt;String, LanguageProfile&amp;gt; profilesMap)&lt;br/&gt;
    public static void clearProfiles()&lt;br/&gt;
    public static void addProfile(String language, LanguageProfile profile)&lt;br/&gt;
    public static Set&amp;lt;String&amp;gt; getSupportedLanguages()&lt;br/&gt;
    public static boolean hasErrors()&lt;br/&gt;
    public static String getErrors()&lt;/p&gt;

&lt;p&gt;None of the original signatures are changed.&lt;br/&gt;
You can now initialize language profiles in these ways:&lt;br/&gt;
A) Loading tika.language.properties and profiles from jar file (default, equivalent to v0.7)&lt;br/&gt;
B) Loading tika.language.override.properties from classpath and profiles from classpath (nice for integrators)&lt;br/&gt;
C) Dynamic from client code, using addProfile and/or initProfiles(Map&amp;lt;String, LanguageProfile&amp;gt;)&lt;/p&gt;

&lt;p&gt;PS: I removed the getDistance() method again, since it&apos;s exposing internal value. Already available through toString() for those who need it. Also removed the &quot;force&quot; parameter to initProfiles() as it&apos;s not needed - we always want to init from scratch.&lt;/p&gt;</comment>
                            <comment id="12912466" author="janhoy" created="Mon, 20 Sep 2010 15:04:20 +0100"  >&lt;p&gt;Replacing with correct patch&lt;/p&gt;</comment>
                            <comment id="12917718" author="janhoy" created="Mon, 4 Oct 2010 20:12:19 +0100"  >&lt;p&gt;Chris, Jukka,&lt;/p&gt;

&lt;p&gt;Are we approaching a solution on this one?&lt;/p&gt;</comment>
                            <comment id="12917733" author="chrismattmann" created="Mon, 4 Oct 2010 20:59:42 +0100"  >&lt;p&gt;Hi Jan:&lt;/p&gt;

&lt;p&gt;I&apos;ve been a bit bogged down lately but plan on looking at this later in the week and trying to resolve it then.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Chris&lt;/p&gt;</comment>
                            <comment id="12926826" author="chrismattmann" created="Mon, 1 Nov 2010 05:21:17 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I applied the latest patch from Jan in r1029556. Ultimately we should move to a service-provider like mechanism on this though the existing patch is quite close to that mechanism in the end. It would be nice to just have language profiles picked up dynamically on the classpath, but this is good enough for now. Thanks Jan!&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12452745" name="TIKA-490.Mattmann.082210.2.patch.txt" size="10865" author="chrismattmann" created="Sun, 22 Aug 2010 17:29:05 +0100"/>
                            <attachment id="12452744" name="TIKA-490.Mattmann.082210.patch.txt" size="10711" author="chrismattmann" created="Sun, 22 Aug 2010 17:02:58 +0100"/>
                            <attachment id="12452761" name="TIKA-490.janhoy.082310.patch" size="12444" author="janhoy" created="Mon, 23 Aug 2010 00:43:14 +0100"/>
                            <attachment id="12452760" name="TIKA-490.janhoy.082310.patch" size="12446" author="janhoy" created="Mon, 23 Aug 2010 00:15:52 +0100"/>
                            <attachment id="12455041" name="TIKA-490.janhoy.092010.patch" size="14337" author="janhoy" created="Mon, 20 Sep 2010 15:04:19 +0100"/>
                            <attachment id="12455040" name="TIKA-490.janhoy.092010.patch" size="14597" author="janhoy" created="Mon, 20 Sep 2010 14:58:41 +0100"/>
                            <attachment id="12452719" name="TIKA-490.patch" size="8338" author="janhoy" created="Sat, 21 Aug 2010 19:53:19 +0100"/>
                            <attachment id="12452709" name="TIKA-490.patch" size="8279" author="janhoy" created="Sat, 21 Aug 2010 16:24:17 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 22 Aug 2010 14:39:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4371</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx3gv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16881</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>