<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:35:28 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-966/TIKA-966.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-966] org.apache.tika.Tika missing from tika-bundle-1.2.jar</title>
                <link>https://issues.apache.org/jira/browse/TIKA-966</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;In version 0.9 I was able to use the org.apache.tika.Tika class in my OSGi application simply by including the tika-bundle.&lt;/p&gt;

&lt;p&gt;I am now trying to move to version 1.2 and this class is missing from the tika-bundle-1.2.jar&lt;/p&gt;

&lt;p&gt;The top level documentation says &quot;Tika bundle. An OSGi bundle that includes everything you need to use all Tika functionality in an OSGi environment.&quot; so I think that this should be continued to included.&lt;/p&gt;

&lt;p&gt;I tried including the tika-core-1.2.jar into my application, but even after fiddling with various start levels I can&apos;t get the Tika class to find the parsers in the tika-bundle.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12600865">TIKA-966</key>
            <summary>org.apache.tika.Tika missing from tika-bundle-1.2.jar</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="karasiuk">Gary Karasiuk</reporter>
                        <labels>
                    </labels>
                <created>Tue, 31 Jul 2012 15:08:35 +0100</created>
                <updated>Sun, 5 Aug 2012 18:14:23 +0100</updated>
                            <resolved>Sun, 5 Aug 2012 18:14:23 +0100</resolved>
                                    <version>1.2</version>
                                    <fixVersion>1.3</fixVersion>
                                    <component>packaging</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13425794" author="jukkaz" created="Tue, 31 Jul 2012 15:21:01 +0100"  >&lt;p&gt;In 1.0 we excluded tika-core from tika-bundle as it works better that way with dynamically loaded parser services. Unfortunately it looks like we forgot to update the relevant documentation.&lt;/p&gt;

&lt;p&gt;You should be able to get your deployment working simply by including tika-core in addition to tika-bundle.&lt;/p&gt;</comment>
                            <comment id="13426046" author="karasiuk" created="Tue, 31 Jul 2012 20:30:27 +0100"  >&lt;p&gt;&amp;gt;&amp;gt; You should be able to get your deployment working simply by including tika-core in addition to tika-bundle.&lt;/p&gt;

&lt;p&gt;I did try adding the tika-core bundle to my application, but the AutoDetectParser could not find any of the &quot;real&quot; parsers. I tried forcing the tika-bundle to autostart, but that didn&apos;t help.&lt;/p&gt;

&lt;p&gt;It would be great to get some instructions on how to do this. &lt;/p&gt;</comment>
                            <comment id="13426142" author="karasiuk" created="Tue, 31 Jul 2012 22:19:33 +0100"  >&lt;p&gt;Using the 1.2 version of Tika, here is the stack trace of creating a new Tika() object.&lt;/p&gt;


&lt;p&gt;Thread &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; (Suspended (breakpoint at line 50 in DefaultParser))	&lt;br/&gt;
	DefaultParser.getDefaultParsers(ServiceLoader) line: 50	&lt;br/&gt;
	DefaultParser.&amp;lt;init&amp;gt;(MediaTypeRegistry, ServiceLoader) line: 73	&lt;br/&gt;
	TikaConfig.getDefaultParser(MimeTypes, ServiceLoader) line: 70	&lt;br/&gt;
	TikaConfig.&amp;lt;init&amp;gt;() line: 170	&lt;br/&gt;
	TikaConfig.getDefaultConfig() line: 268	&lt;br/&gt;
	Tika.&amp;lt;init&amp;gt;() line: 93	&lt;br/&gt;
	Indexer.run(ParametersResolved) line: 80	&lt;br/&gt;
	Launcher.start(IApplicationContext) line: 45	&lt;br/&gt;
	EclipseAppHandle.run(Object) line: 196	&lt;br/&gt;
	EclipseAppLauncher.runApplication(Object) line: 110	&lt;br/&gt;
	EclipseAppLauncher.start(Object) line: 79	&lt;br/&gt;
	EclipseStarter.run(Object) line: 344	&lt;br/&gt;
	EclipseStarter.run(String[], Runnable) line: 179	&lt;br/&gt;
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available &lt;span class=&quot;error&quot;&gt;&amp;#91;native method&amp;#93;&lt;/span&gt;	&lt;br/&gt;
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	&lt;br/&gt;
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	&lt;br/&gt;
	Method.invoke(Object, Object...) line: 601	&lt;br/&gt;
	Main.invokeFramework(String[], URL[]) line: 622	&lt;br/&gt;
	Main.basicRun(String[]) line: 577	&lt;br/&gt;
	Main.run(String[]) line: 1410	&lt;br/&gt;
	Main.main(String[]) line: 1386	&lt;/p&gt;

&lt;p&gt;The list of parsers that comes back is an empty list. No where in this code path are the dynamically added parsers referenced.&lt;/p&gt;</comment>
                            <comment id="13426678" author="jukkaz" created="Wed, 1 Aug 2012 15:57:04 +0100"  >&lt;blockquote&gt;&lt;p&gt;No where in this code path are the dynamically added parsers referenced.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s as it should be. Instead of looking up available parser services once when the instance is created, Tika does so only when you actually ask it to parse something. That way parser services can dynamically come and go without the need to acquire new Tika instances that match the currently available services.&lt;/p&gt;

&lt;p&gt;Note that for the dynamic parser service lookups to work properly, the tika-core bundle needs to be &lt;b&gt;started&lt;/b&gt; instead of just &lt;b&gt;resolved&lt;/b&gt;. See also &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-951&quot; title=&quot;Bundle activation policy for Eclipse&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-951&quot;&gt;&lt;del&gt;TIKA-951&lt;/del&gt;&lt;/a&gt; where the same question came up recently.&lt;/p&gt;</comment>
                            <comment id="13426740" author="karasiuk" created="Wed, 1 Aug 2012 17:38:58 +0100"  >&lt;p&gt;&amp;gt;&amp;gt; That&apos;s as it should be.&lt;/p&gt;

&lt;p&gt;I did START the bundle, and I did watch the service references being added to the ServiceLoader. BUT, even though the dynamic parsers where added to the ServiceLoader they are not used anywhere in the stack trace that I posted. If you look at the stack trace you will see that only the statically added parsers (of which there are none) are added.&lt;/p&gt;</comment>
                            <comment id="13426746" author="karasiuk" created="Wed, 1 Aug 2012 17:49:39 +0100"  >&lt;p&gt;Essentially running this code:&lt;/p&gt;

&lt;p&gt;Tika tika = new Tika();&lt;br/&gt;
Metadata metadata = new Metadata();&lt;br/&gt;
InputStream in = an input stream on a PDF file&lt;br/&gt;
contents = tika.parseToString(in, metadata, -1);&lt;/p&gt;

&lt;p&gt;sets contents to an empty string. &lt;/p&gt;
</comment>
                            <comment id="13426748" author="jukkaz" created="Wed, 1 Aug 2012 17:50:14 +0100"  >&lt;p&gt;You&apos;re looking at the wrong place. The dynamic parser services are looked up in &lt;tt&gt;DefaultParser.getParsers()&lt;/tt&gt; separately for each &lt;tt&gt;parse()&lt;/tt&gt; call, not in the static &lt;tt&gt;.getDefaultParsers()&lt;/tt&gt; method that&apos;s called only once during initialization.&lt;/p&gt;</comment>
                            <comment id="13426752" author="jukkaz" created="Wed, 1 Aug 2012 17:53:27 +0100"  >&lt;p&gt;See also the &lt;a href=&quot;http://svn.apache.org/repos/asf/tika/trunk/tika-bundle/src/test/java/org/apache/tika/bundle/BundleIT.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BundleIT&lt;/a&gt; test case that we use to automatically verify that code like the one you describe works also in an OSGi environment.&lt;/p&gt;</comment>
                            <comment id="13427340" author="karasiuk" created="Thu, 2 Aug 2012 15:16:00 +0100"  >&lt;p&gt;I am still investigating this. This may turn out to be a bug in the Eclipse plug-in development environment. &lt;/p&gt;

&lt;p&gt;I created a small test bundle, that has this test method:&lt;/p&gt;


&lt;p&gt;	private void testParse() {&lt;br/&gt;
		Tika tika = new Tika();&lt;br/&gt;
		Metadata meta = new Metadata();&lt;br/&gt;
		InputStream in = null;&lt;br/&gt;
		String html = &quot;&amp;lt;html&amp;gt;&amp;lt;body&amp;gt;&amp;lt;p&amp;gt;A test HTML document.&amp;lt;/p&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&quot;;&lt;br/&gt;
		try &lt;/p&gt;
{
			in = new ByteArrayInputStream(html.getBytes());
			String contents = tika.parseToString(in, meta, -1);
			System.err.printf(&quot;length of contents %d\n&quot;, contents.length());
			System.err.println(&quot;contents: &quot; + contents);
		}
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{
			e.printStackTrace();
		}
&lt;p&gt;	&lt;br/&gt;
		finally {&lt;br/&gt;
			try &lt;/p&gt;
{if (in != null)in.close();}
&lt;p&gt;			catch (IOException e){}&lt;br/&gt;
		}&lt;br/&gt;
	}&lt;/p&gt;

&lt;p&gt;When I run it inside of Eclipse I get this output:&lt;/p&gt;

&lt;p&gt;GRK - start of test&lt;br/&gt;
length of contents 0&lt;br/&gt;
contents: &lt;br/&gt;
GRK - end of test&lt;/p&gt;

&lt;p&gt;When I export the application, and run it as a standalone OSGi application I get this (correct) output:&lt;/p&gt;

&lt;p&gt;GRK - start of test&lt;br/&gt;
length of contents 22&lt;br/&gt;
contents: A test HTML document.&lt;/p&gt;

&lt;p&gt;GRK - end of test&lt;/p&gt;</comment>
                            <comment id="13427355" author="karasiuk" created="Thu, 2 Aug 2012 15:44:40 +0100"  >&lt;p&gt;FYI - I created this bug report:&lt;br/&gt;
&lt;a href=&quot;https://bugs.eclipse.org/bugs/show_bug.cgi?id=386498&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://bugs.eclipse.org/bugs/show_bug.cgi?id=386498&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;to determine if this is an Eclipse problem. This bug report contains my testcase as an attachment.&lt;/p&gt;</comment>
                            <comment id="13427467" author="karasiuk" created="Thu, 2 Aug 2012 18:16:48 +0100"  >&lt;p&gt;I think I am on to something here.&lt;/p&gt;

&lt;p&gt;Whether this works or not depends on the order that the bundles are activated. This order (at least in some environments is a race condition). &lt;/p&gt;

&lt;p&gt;In order to work, you must ensure that the tika-core bundle is started BEFORE the tika-bundle. This should be documented!&lt;/p&gt;

&lt;p&gt;There may be a better way to do this, but I added the following code to my bundle:&lt;/p&gt;


&lt;p&gt;		Bundle[] bundles = context.getBundles();&lt;br/&gt;
		Bundle tikaCore = null;&lt;br/&gt;
		Bundle tikaBundle = null;&lt;br/&gt;
		for (Bundle b : bundles)&lt;/p&gt;
{
			if (tikaCore == null &amp;amp;&amp;amp; &quot;org.apache.tika.core&quot;.equals(b.getSymbolicName()))tikaCore = b;
			if (tikaBundle == null &amp;amp;&amp;amp; &quot;org.apache.tika.bundle&quot;.equals(b.getSymbolicName()))tikaBundle = b;
		}

&lt;p&gt;		if (tikaCore != null)tikaCore.start();&lt;br/&gt;
		if (tikaBundle != null)tikaBundle.start();&lt;/p&gt;

&lt;p&gt;Now at least the right parser gets called.&lt;/p&gt;

&lt;p&gt;Unfortunately it is still one step forward one step backwards. The PDF parser is now being called, but it throws this error: &lt;br/&gt;
java.lang.NoClassDefFoundError: org/apache/commons/logging/LogFactory&lt;/p&gt;</comment>
                            <comment id="13428882" author="jukkaz" created="Sun, 5 Aug 2012 18:14:23 +0100"  >&lt;p&gt;I updated Tika documentation to more accurately describe the current version of &lt;tt&gt;tika-bundle&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The start sequence problem you describe is most likely just a matter of timing in your test case. Tika uses a &lt;tt&gt;ServiceTracker&lt;/tt&gt; to keep track of all available parser services, so the order in which the bundles are started shouldn&apos;t matter.&lt;/p&gt;

&lt;p&gt;Since your test case as included in the Eclipse bug report you filed runs already in the &lt;em&gt;activator&lt;/em&gt;, I suspect that you&apos;re simply experiencing a race condition where the parser services have not yet become available by the time your test code runs. The explicit &lt;tt&gt;tikaBundle.start()&lt;/tt&gt; call you show in the last comment breaks this race by forcing the bundle to finish activating itself before your test case is run.&lt;/p&gt;

&lt;p&gt;A better solution would be to move your test code out of the activator to a place where it gets invoked only once all relevant bundles are active. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 31 Jul 2012 14:21:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242306</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxwi9b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>13445</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>