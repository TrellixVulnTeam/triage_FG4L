<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:30:48 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-934/TIKA-934.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-934] Tika in server mode stops responding and reports NPE over and over in logs</title>
                <link>https://issues.apache.org/jira/browse/TIKA-934</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;We run tika in server mode via:&lt;/p&gt;

&lt;p&gt;/usr/java/jdk/bin/java -Dlog4j.app.name=-server -Djavax.xml.soap.MessageFactory=com.sun.xml.messaging.saaj.soap.ver1_1.SOAPMessageFactory1_1Impl -Dfile.encoding=UTF-8 -Djava.net.preferIPv4Stack=true -server -Xms256M -Xmx768M -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/var/log/oom/content-extractor-8983.dump.1 -server -Xms500M -Xmx500M -jar /opt/tika/tika-app-1.1.jar --text --encoding=UTF-8 --server 8983&lt;/p&gt;

&lt;p&gt;Our client talks to this over port 8983. We pass data via the socket and get the responses back. However, sometimes, tika will get into a bad state and stop responding. &lt;br/&gt;
When this happens, we see this in the logs over and over. &lt;/p&gt;

&lt;p&gt;2012-05-24_20:12:33.88573 Caused by: java.lang.NullPointerException&lt;br/&gt;
2012-05-24_20:12:33.88576       at org.apache.tika.sax.XHTMLContentHandler.lazyEndHead(XHTMLContentHandler.java:157)&lt;br/&gt;
2012-05-24_20:12:33.88580       at org.apache.tika.sax.XHTMLContentHandler.startElement(XHTMLContentHandler.java:237)&lt;br/&gt;
2012-05-24_20:12:33.88584       at org.apache.tika.sax.XHTMLContentHandler.startElement(XHTMLContentHandler.java:274)&lt;br/&gt;
2012-05-24_20:12:33.88589       at org.apache.tika.parser.microsoft.WordExtractor.handleParagraph(WordExtractor.java:186)&lt;br/&gt;
2012-05-24_20:12:33.88593       at org.apache.tika.parser.microsoft.WordExtractor.parse(WordExtractor.java:97)&lt;br/&gt;
2012-05-24_20:12:33.88597       at org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:185)&lt;br/&gt;
2012-05-24_20:12:33.88602       at org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:160)&lt;br/&gt;
2012-05-24_20:12:33.88606       at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)&lt;br/&gt;
2012-05-24_20:12:33.88611       ... 4 more&lt;br/&gt;
2012-05-24_20:12:49.28441 org.apache.tika.exception.TikaException: Unexpected RuntimeException from org.apache.tika.parser.microsoft.OfficeParse&lt;br/&gt;
r@6906daba&lt;br/&gt;
2012-05-24_20:12:49.28458       at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:244)&lt;br/&gt;
2012-05-24_20:12:49.28466       at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)&lt;br/&gt;
2012-05-24_20:12:49.28477       at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:120)&lt;br/&gt;
2012-05-24_20:12:49.28489       at org.apache.tika.cli.TikaCLI$OutputType.process(TikaCLI.java:130)&lt;br/&gt;
2012-05-24_20:12:49.28497       at org.apache.tika.cli.TikaCLI$TikaServer$1.run(TikaCLI.java:735)&lt;br/&gt;
2012-05-24_20:12:49.28509 Caused by: java.lang.NullPointerException&lt;br/&gt;
2012-05-24_20:12:49.28516       at org.apache.tika.sax.XHTMLContentHandler.lazyEndHead(XHTMLContentHandler.java:157)&lt;br/&gt;
2012-05-24_20:12:49.28524       at org.apache.tika.sax.XHTMLContentHandler.startElement(XHTMLContentHandler.java:237)&lt;br/&gt;
2012-05-24_20:12:49.28532       at org.apache.tika.sax.XHTMLContentHandler.startElement(XHTMLContentHandler.java:274)&lt;br/&gt;
2012-05-24_20:12:49.28541       at org.apache.tika.parser.microsoft.WordExtractor.handleParagraph(WordExtractor.java:186)&lt;br/&gt;
2012-05-24_20:12:49.28550       at org.apache.tika.parser.microsoft.WordExtractor.parse(WordExtractor.java:97)&lt;br/&gt;
2012-05-24_20:12:49.28558       at org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:185)&lt;br/&gt;
2012-05-24_20:12:49.28565       at org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:160)&lt;br/&gt;
2012-05-24_20:12:49.28577       at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)&lt;br/&gt;
2012-05-24_20:12:49.28585       ... 4 more&lt;/p&gt;

&lt;p&gt;We have tried to figure out what causes this with no success. We only know that once the server gets into this state, there is no recourse but to restart the tika service.&lt;/p&gt;

&lt;p&gt;Other instances of tika we have running in the test environment continue to work. There is some combination of content or work that causes&lt;br/&gt;
tika to destabilize. Our working theory is that perhaps tika server is not thread safe and that may be causing this behavior.&lt;/p&gt;</description>
                <environment>&lt;p&gt;CentOS 5.x&lt;/p&gt;</environment>
        <key id="12557732">TIKA-934</key>
            <summary>Tika in server mode stops responding and reports NPE over and over in logs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="rtulloh">Rob Tulloh</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 May 2012 22:25:57 +0100</created>
                <updated>Sat, 30 Jun 2012 13:15:12 +0100</updated>
                            <resolved>Sat, 30 Jun 2012 13:15:11 +0100</resolved>
                                    <version>1.1</version>
                                    <fixVersion>1.2</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13285068" author="rtulloh" created="Tue, 29 May 2012 20:59:09 +0100"  >&lt;p&gt;Additional evidence of re-entrancy issues:&lt;/p&gt;

&lt;p&gt;2012-05-22_19:10:39.31249 Caused by: java.util.ConcurrentModificationException&lt;br/&gt;
2012-05-22_19:10:39.31253       at java.util.HashMap$HashIterator.nextEntry(HashMap.java:793)&lt;br/&gt;
2012-05-22_19:10:39.31257       at java.util.HashMap$KeyIterator.next(HashMap.java:828)&lt;br/&gt;
2012-05-22_19:10:39.31262       at java.util.AbstractCollection.toArray(AbstractCollection.java:171)&lt;br/&gt;
2012-05-22_19:10:39.31266       at org.apache.tika.metadata.Metadata.names(Metadata.java:171)&lt;br/&gt;
2012-05-22_19:10:39.31270       at org.apache.tika.sax.XHTMLContentHandler.lazyEndHead(XHTMLContentHandler.java:156)&lt;br/&gt;
2012-05-22_19:10:39.31275       at org.apache.tika.sax.XHTMLContentHandler.startElement(XHTMLContentHandler.java:237)&lt;br/&gt;
2012-05-22_19:10:39.31280       at org.apache.tika.sax.XHTMLContentHandler.startElement(XHTMLContentHandler.java:281)&lt;br/&gt;
2012-05-22_19:10:39.31285       at org.apache.tika.parser.pdf.PDF2XHTML.startPage(PDF2XHTML.java:128)&lt;br/&gt;
2012-05-22_19:10:39.31289       at org.apache.pdfbox.util.PDFTextStripper.processPage(PDFTextStripper.java:420)&lt;br/&gt;
2012-05-22_19:10:39.31293       at org.apache.pdfbox.util.PDFTextStripper.processPages(PDFTextStripper.java:366)&lt;br/&gt;
2012-05-22_19:10:39.31296       at org.apache.pdfbox.util.PDFTextStripper.writeText(PDFTextStripper.java:322)&lt;br/&gt;
2012-05-22_19:10:39.31300       at org.apache.tika.parser.pdf.PDF2XHTML.process(PDF2XHTML.java:63)&lt;br/&gt;
2012-05-22_19:10:39.31304       at org.apache.tika.parser.pdf.PDFParser.parse(PDFParser.java:140)&lt;br/&gt;
2012-05-22_19:10:39.31308       at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)&lt;br/&gt;
2012-05-22_19:10:39.31312       ... 4 more&lt;/p&gt;</comment>
                            <comment id="13404478" author="jukkaz" created="Sat, 30 Jun 2012 13:15:12 +0100"  >&lt;p&gt;Thanks for the report! This was indeed the case, the CLI would keep just a single global Metadata instance, which ended up causing trouble when running in server mode. I fixed than in revision 1355719 by making the CLI use per-document Metadata instances.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 30 Jun 2012 12:15:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>243076</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx0qf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16438</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>