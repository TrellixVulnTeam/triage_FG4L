<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:33:36 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-1461/TIKA-1461.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-1461] Bad mime detection of certain JAR file</title>
                <link>https://issues.apache.org/jira/browse/TIKA-1461</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;Given this &quot;ordinary&quot; Java JAR file&lt;br/&gt;
&lt;a href=&quot;https://maven.atlassian.com/content/groups/public/com/atlassian/support/healthcheck/support-healthcheck-plugin/1.0.3/support-healthcheck-plugin-1.0.3.jar&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://maven.atlassian.com/content/groups/public/com/atlassian/support/healthcheck/support-healthcheck-plugin/1.0.3/support-healthcheck-plugin-1.0.3.jar&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Manually inspected and tested it, it is a Jar file and is valid one.&lt;/p&gt;

&lt;p&gt;Still, Tika Core&apos;s Detector detects it as type &lt;tt&gt;application/x-msdownload; format=pe&lt;/tt&gt;. Tthe detection is &quot;hinted&quot; with file name, hence &quot;jar&quot; hint is present, still it&apos;s not detected as desired &lt;tt&gt;application/java-archive&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;IMO, this happens due to the problem with priority of &lt;tt&gt;application/x-msdownload; format=pe&lt;/tt&gt;, which is 55. If it would be 50, the &quot;mediation&quot; would kick in, see &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1292&quot; title=&quot;Inconsistent priorities in bundled tika-mimetypes.xml&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1292&quot;&gt;&lt;del&gt;TIKA-1292&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;Changing/overriding magic priority is not possible using &lt;tt&gt;custom-mimetypes.xml&lt;/tt&gt; is also not possible.&lt;/p&gt;

&lt;p&gt;Unsure what the correct solution is here, nor how to circumvent this without patching Tika.&lt;/p&gt;

&lt;p&gt;The problem affects versions 1.5 but also 1.6, but we target 1.6.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12751348">TIKA-1461</key>
            <summary>Bad mime detection of certain JAR file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="cstamas">Cservenak, Tamas</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Oct 2014 10:15:36 +0000</created>
                <updated>Wed, 29 Oct 2014 20:09:58 +0000</updated>
                            <resolved>Wed, 29 Oct 2014 19:23:54 +0000</resolved>
                                    <version>1.6</version>
                                    <fixVersion>1.7</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14188216" author="cstamas" created="Wed, 29 Oct 2014 10:29:19 +0000"  >&lt;p&gt;Seems this change in &lt;tt&gt;custom-mimetypes.xml&lt;/tt&gt; solves the problem:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  &amp;lt;mime-type type=&quot;application/java-archive&quot;&amp;gt;
    &amp;lt;sub-class-of type=&quot;application/zip&quot;/&amp;gt;
    &amp;lt;glob pattern=&quot;*.jar&quot;/&amp;gt;
    &amp;lt;magic priority=&quot;55&quot;&amp;gt;
      &amp;lt;match value=&quot;PK\003\004&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
      &amp;lt;match value=&quot;PK\005\006&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
      &amp;lt;match value=&quot;PK\x07\x08&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;
    &amp;lt;/magic&amp;gt;
  &amp;lt;/mime-type&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This change basically adds a magic to &lt;tt&gt;application/java-archive&lt;/tt&gt; (that basically has none, it inherits from &lt;tt&gt;application/zip&lt;/tt&gt;) with priority of 55. Hence, later hinting done in &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1292&quot; title=&quot;Inconsistent priorities in bundled tika-mimetypes.xml&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1292&quot;&gt;&lt;del&gt;TIKA-1292&lt;/del&gt;&lt;/a&gt; selects &lt;tt&gt;application/java-archive&lt;/tt&gt; over &lt;tt&gt;application/x-msdownload;format=pe&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14188455" author="cstamas" created="Wed, 29 Oct 2014 15:29:46 +0000"  >&lt;p&gt;Scratch that above, it made all ZIPs appear as JARs. Fix was instead to re-add ZIPs with higher priority magic (basically copied the entry for Tika&apos;s XML to custom-mimetypes.xml.&lt;/p&gt;</comment>
                            <comment id="14188479" author="gagravarr" created="Wed, 29 Oct 2014 15:47:46 +0000"  >&lt;p&gt;Do you know the license of that file? And/or of a different jar that is apache / bsd licensed that shows the problem?&lt;/p&gt;

&lt;p&gt;Before we go about making changes for this, we really want to add a unit test so we can ensure it is properly fixed, but equally importantly remains fixed into the future!&lt;/p&gt;</comment>
                            <comment id="14188487" author="cstamas" created="Wed, 29 Oct 2014 15:55:46 +0000"  >&lt;p&gt;Don&apos;t know of any other JAR that shows the problem.&lt;/p&gt;

&lt;p&gt;The POM seems to be licensed as &quot;BSD License&quot;, according to parent POM it inherits:&lt;br/&gt;
&lt;a href=&quot;https://maven.atlassian.com/content/groups/public/com/atlassian/pom/public-pom/3.0.6/public-pom-3.0.6.pom&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://maven.atlassian.com/content/groups/public/com/atlassian/pom/public-pom/3.0.6/public-pom-3.0.6.pom&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14188555" author="gagravarr" created="Wed, 29 Oct 2014 16:48:49 +0000"  >&lt;p&gt;I&apos;ve just tried with a recent snapshot build, and both with and without the filename the Tika app is able to correctly detect the type:&lt;/p&gt;

&lt;p&gt;$ java -jar tika-app-1.7-SNAPSHOT.jar --detect /tmp/support-healthcheck-plugin-1.0.3.jar &lt;br/&gt;
application/java-archive&lt;br/&gt;
$ java -jar tika-app-1.7-SNAPSHOT.jar --detect &amp;lt; /tmp/support-healthcheck-plugin-1.0.3.jar &lt;br/&gt;
application/java-archive&lt;/p&gt;

&lt;p&gt;Any chance you could retest with a recent nightly build / build from svn trunk, and see if we&apos;ve already solved this?&lt;/p&gt;</comment>
                            <comment id="14188779" author="cstamas" created="Wed, 29 Oct 2014 18:43:58 +0000"  >&lt;p&gt;Nick, tika-app is known to be OK with detecting this file (see Nexus issue comments). But, we use tika-core only, that unlike tika-app, has limited set of detectors, and AFAIK relies on tika-mimetypes.xml solely (plus we use custom-mimetypes.xml too). Tike-Core alone does produce this problem.&lt;/p&gt;

&lt;p&gt;Please see comments on original Nexus issue&lt;br/&gt;
&lt;a href=&quot;https://issues.sonatype.org/browse/NEXUS-7603&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.sonatype.org/browse/NEXUS-7603&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14188831" author="gagravarr" created="Wed, 29 Oct 2014 19:23:54 +0000"  >&lt;p&gt;Fixed in r1635263. To be a valid PE file, it needs to start with MZ too. Magic tweaked and test files added accordingly, thanks!&lt;/p&gt;</comment>
                            <comment id="14188892" author="hudson" created="Wed, 29 Oct 2014 19:55:31 +0000"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.7 #290 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.7/290/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.7/290/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1461&quot; title=&quot;Bad mime detection of certain JAR file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1461&quot;&gt;&lt;del&gt;TIKA-1461&lt;/del&gt;&lt;/a&gt; PE files must also have the MZ header at the start, so tweak magic and add positive and negative mime magic detection tests for it (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1635263&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1635263&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-core/src/main/resources/org/apache/tika/mime/tika-mimetypes.xml&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/java/org/apache/tika/mime/TestMimeTypes.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/resources/test-documents/testJAR_with_PEHDR.jar&lt;br/&gt;
Very small Windows exe for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1461&quot; title=&quot;Bad mime detection of certain JAR file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1461&quot;&gt;&lt;del&gt;TIKA-1461&lt;/del&gt;&lt;/a&gt;, generated with Visual Studio 2008 with advice from &lt;a href=&quot;http://www.phreedom.org/research/tinype/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.phreedom.org/research/tinype/&lt;/a&gt; (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1635257&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1635257&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/resources/test-documents/testTinyPE.exe&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14188912" author="hudson" created="Wed, 29 Oct 2014 20:09:58 +0000"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.6 #270 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.6/270/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.6/270/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1461&quot; title=&quot;Bad mime detection of certain JAR file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1461&quot;&gt;&lt;del&gt;TIKA-1461&lt;/del&gt;&lt;/a&gt; PE files must also have the MZ header at the start, so tweak magic and add positive and negative mime magic detection tests for it (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1635263&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1635263&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-core/src/main/resources/org/apache/tika/mime/tika-mimetypes.xml&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/java/org/apache/tika/mime/TestMimeTypes.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/resources/test-documents/testJAR_with_PEHDR.jar&lt;br/&gt;
Very small Windows exe for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1461&quot; title=&quot;Bad mime detection of certain JAR file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1461&quot;&gt;&lt;del&gt;TIKA-1461&lt;/del&gt;&lt;/a&gt;, generated with Visual Studio 2008 with advice from &lt;a href=&quot;http://www.phreedom.org/research/tinype/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.phreedom.org/research/tinype/&lt;/a&gt; (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1635257&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1635257&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/resources/test-documents/testTinyPE.exe&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 29 Oct 2014 15:47:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzvkwv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>