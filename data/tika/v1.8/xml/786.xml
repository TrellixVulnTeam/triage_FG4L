<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:34:32 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-786/TIKA-786.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-786] Tika CLI --detect returns incorrect content-type for files with altered extensions</title>
                <link>https://issues.apache.org/jira/browse/TIKA-786</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;From a discussion on the user mailing list on Nov. 11 2011, where the following was requested as a new bug: Tika CLI will return incorrect content type information when called with --detect for files that have had their extensions modified (and nothing else).  MS Word (.doc) documents that have their extension changed to .xls or .ppt will be incorrectly detected as Excel or PowerPoint documents, whereas the --metadata option will determine the content type correctly (as application/msword), based on the actual contents of these mis-named files.  The same also occurs with other types of MS Office 2003 documents, and could possibly occur with a wide range of document types.  To quote Nick B., from the user mailing list: &quot;If you look at the TestMediaTypes class you&apos;ll see what you can get with just the mime magic and filenames, and then there&apos;s TestContainerAwareDetector which shows the correct detection happening by using the extra detectors available&quot;.   &lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows&lt;/p&gt;</environment>
        <key id="12532108">TIKA-786</key>
            <summary>Tika CLI --detect returns incorrect content-type for files with altered extensions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jfm.apache">John Mastarone</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Nov 2011 02:42:11 +0000</created>
                <updated>Mon, 21 Nov 2011 13:16:06 +0000</updated>
                            <resolved>Mon, 21 Nov 2011 13:16:06 +0000</resolved>
                                    <version>1.1</version>
                                    <fixVersion>1.1</fixVersion>
                                    <component>cli</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13154103" author="gagravarr" created="Mon, 21 Nov 2011 10:31:26 +0000"  >&lt;p&gt;In r1204435, I&apos;ve added some failing+disabled unit tests for this. If you re-enable the tests on lines 81-83 and 127-129, you&apos;ll see this issue&lt;/p&gt;</comment>
                            <comment id="13154110" author="gagravarr" created="Mon, 21 Nov 2011 10:43:26 +0000"  >&lt;p&gt;The problem seems to be with how DefaultDetector handles conflicting detection, which is different to how the previous ContainerAwareDetector did so&lt;/p&gt;

&lt;p&gt;Previously, the logic was to ask the container detectors to review the file. If they had a good match, that was used as the mimetype. Only if the container ones didn&apos;t know would the mime magic+filename detection (provided by MimeTypes) be used&lt;/p&gt;

&lt;p&gt;Under the new DefaultDetector system, this has changed. Instead, each detector is tried in turn, and while detectors are allowed to specialise a file they are not permitted to change it completely (if a previous one was wrong)&lt;/p&gt;

&lt;p&gt;It looks like this DefaultDetector logic will need to be changed, to allow detectors such as the container ones to override incorrect (typically filename based) detection&lt;/p&gt;</comment>
                            <comment id="13154127" author="jukkaz" created="Mon, 21 Nov 2011 11:50:20 +0000"  >&lt;p&gt;Hmm, I didn&apos;t think of such a case when doing the DefaultDetector logic. My idea was that more accurate container detectors would just refine a more generic detection result from the basic detectors that are always run first. In this case though the basic detector ends up giving wrong results, which breaks my logic.&lt;/p&gt;

&lt;p&gt;Since the container detectors give practically always correct results, I guess it&apos;s fine to always use their results. Or perhaps even better, we could check the detectors in reverse order so that the most accurate detection result is used as the starting point and less accurate detection based on things like the file name could only refine the detection result to a more specific media type.&lt;/p&gt;</comment>
                            <comment id="13154130" author="gagravarr" created="Mon, 21 Nov 2011 12:03:28 +0000"  >&lt;p&gt;Do we have any control over the ordering though? My hunch is that user supplied ones should probably be used in preference to Tika ones, and the parser based detectors in Tika should be used in preference to the Mime Type ones&lt;/p&gt;

&lt;p&gt;One situation where the mimetype detection is better is with truncated files. Here the container detector can just say &quot;looks like one of mine, can&apos;t tell you any more&quot; while the mimetype one can use the filename to fill in the rest. I&apos;ve a feeling that at least some people pass in only the first few kb of files for detection, to ensure it&apos;s fast, so their use case would want the MimeTypes detector logic based on filename to kick in to specialise.&lt;/p&gt;</comment>
                            <comment id="13154135" author="jukkaz" created="Mon, 21 Nov 2011 12:33:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;Do we have any control over the ordering though?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Some. The type database always comes first, which for most use cases should be good enough.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;One situation where the mimetype detection is better is with truncated files.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right. The good thing about the container detectors is that they only give a result (other than application/octet-stream) if they&apos;re really sure about the detection result. So with the proposed reverse detection order the type database would always be consulted last and be able to provide a fallback result in case none of the more accurate detectors worked.&lt;/p&gt;</comment>
                            <comment id="13154145" author="gagravarr" created="Mon, 21 Nov 2011 12:58:21 +0000"  >&lt;p&gt;I&apos;ve had a go at solving this in r1204476, by having DefaultDetector order them differently, based on the discussions here. (The reversing is done here, rather than in CompositeDetector, as that seems to make more sense to me)&lt;/p&gt;

&lt;p&gt;This has allowed me to enable the previously failing tests for this issue, and all other tests still pass&lt;/p&gt;</comment>
                            <comment id="13154154" author="jukkaz" created="Mon, 21 Nov 2011 13:08:39 +0000"  >&lt;p&gt;Cool, looks good. I was simultaneously approaching this from a slightly different angle (see &lt;a href=&quot;https://github.com/jukka/tika/commit/97a15bdcd79549d3c5147b7b8f9b6f46a9bb8fc5&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/jukka/tika/commit/97a15bdcd79549d3c5147b7b8f9b6f46a9bb8fc5&lt;/a&gt;), but your changes look nicer (I like the way you can give preference to non-Tika detectors) so let&apos;s go with that.&lt;/p&gt;</comment>
                            <comment id="13154158" author="gagravarr" created="Mon, 21 Nov 2011 13:16:06 +0000"  >&lt;p&gt;Explanation added to CHANGES in r1204479, so I think this is now resolved&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 21 Nov 2011 10:31:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>217844</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx1nb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16586</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>