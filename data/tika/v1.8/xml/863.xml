<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:32:35 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-863/TIKA-863.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-863] MailContentHandler should not create AutoDetectParser on each call</title>
                <link>https://issues.apache.org/jira/browse/TIKA-863</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;MailContentHandler is called from RFC822Parser, and it creates AutoDetectParser on each call to parse(...). The process of creating AutoDetectParser involves reading TikaConfig (not cached), which in turn involves parsing XML config files. Apart from the fact that this process is wasteful and heavy, in addition in a highly concurrent setup it leads to multiple threads blocking on SAX parser creation.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12542973">TIKA-863</key>
            <summary>MailContentHandler should not create AutoDetectParser on each call</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ab">Andrzej Bialecki </reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Feb 2012 00:09:02 +0000</created>
                <updated>Sat, 30 Jun 2012 18:40:54 +0100</updated>
                            <resolved>Sat, 30 Jun 2012 18:40:53 +0100</resolved>
                                    <version>1.1</version>
                                    <fixVersion>1.2</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13209905" author="ab" created="Fri, 17 Feb 2012 00:13:07 +0000"  >&lt;p&gt;Patch to address this issue. AutoDetectParser instance is cached in ParseContext.&lt;/p&gt;

&lt;p&gt;All tests pass with this patch. An application that I&apos;m testing with this patch experienced a 12x speedup in mail parsing.&lt;/p&gt;</comment>
                            <comment id="13210205" author="gagravarr" created="Fri, 17 Feb 2012 12:11:41 +0000"  >&lt;p&gt;I&apos;m not sure if we should be setting it as AutoDetectParser.class on the context or not. &lt;/p&gt;

&lt;p&gt;Part of me thinks that we should be setting it as Parser.class, if the user hasn&apos;t already set one. However, there is an issue that the parser set for that may be expecting something slightly different, eg an embedded document rather than effectively the core document, though you could argue that the mime contents are all embedded.&lt;/p&gt;

&lt;p&gt;The second worry is with attaching additional objects to the ParseContext automatically. A user may choose to not set a recursing parser on the ParseContext, because they don&apos;t want embedded resources. If we add one, and the email contains a word document with an embedded excel spreadsheet, then suddenly because we added a Parser to the context recursion will trigger&lt;/p&gt;</comment>
                            <comment id="13210221" author="ab" created="Fri, 17 Feb 2012 12:47:39 +0000"  >&lt;p&gt;I see your point, it makes sense - no hidden surprises. However, I think the part of the patch that simply checks whether an existing AutoDetectParser has been provided and uses it if present, is still useful and makes a huge difference.&lt;/p&gt;</comment>
                            <comment id="13210236" author="gagravarr" created="Fri, 17 Feb 2012 12:57:31 +0000"  >&lt;p&gt;I&apos;m not sure what the best way is to provide an AutoDetectParser for this case though. &lt;/p&gt;

&lt;p&gt;MailContentHandler does seem to me to behave differently to cases like Zip, which have multiple sub-parts, and it is different to cases like word-with-excel&lt;/p&gt;

&lt;p&gt;Maybe we should check for an AutoDetectParser on the context, use that if given, and if not lazy-create + cache a default one on the parser, and supply that through to the mail content handler?&lt;/p&gt;</comment>
                            <comment id="13210242" author="ab" created="Fri, 17 Feb 2012 13:04:25 +0000"  >&lt;p&gt;This would work in my case, too. Though the same pattern would have to be applied in other places where Tika creates heavy parsers (not to mention the TikaConfig re-creation on each get ... quite costly), so I think a convenience method should be provided to avoid repeating the same logic in various places.&lt;/p&gt;</comment>
                            <comment id="13210245" author="gagravarr" created="Fri, 17 Feb 2012 13:13:30 +0000"  >&lt;p&gt;We could check for the TikaConfig on the ParseContext, which if present could be used when creating parsers / detectors etc inside Parsers?&lt;/p&gt;</comment>
                            <comment id="13220812" author="ab" created="Fri, 2 Mar 2012 10:06:58 +0000"  >&lt;p&gt;Nick, is there a chance of this making 1.1 ? Should I prepare another patch? though IIRC Jukka has changed in the meantime the way TikaConfig is inited...&lt;/p&gt;</comment>
                            <comment id="13404580" author="gagravarr" created="Sat, 30 Jun 2012 18:40:43 +0100"  >&lt;p&gt;Should be fixed in r1355782. We now avoid creating a new AutoDetectParser (and implicit TikaConfig) for each part in a RFC822 message. Instead, check for one on the ParseContext, otherwise cache the TikaConfig for the lifetime of the message being parsed, and grab the parser from that.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12514912" name="TIKA-863.patch" size="2712" author="ab" created="Fri, 17 Feb 2012 00:13:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 17 Feb 2012 12:11:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>228259</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx167:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16509</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>