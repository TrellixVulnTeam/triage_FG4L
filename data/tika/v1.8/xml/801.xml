<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:36:10 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-801/TIKA-801.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-801] ContentHandlerDecorator outputs invalid element</title>
                <link>https://issues.apache.org/jira/browse/TIKA-801</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;ul&gt;
	&lt;li&gt;Start Tika GUI&lt;/li&gt;
	&lt;li&gt;try opening test-outlook.msg (from tika-parsers test resources)&lt;/li&gt;
	&lt;li&gt;the following exception is thrown:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.tika.exception.TikaException: Unexpected RuntimeException from org.apache.tika.parser.microsoft.OfficeParser@12e14ebc
	at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:245)
	at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:243)
	at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:120)
	at org.apache.tika.gui.TikaGUI.handleStream(TikaGUI.java:320)
	at org.apache.tika.gui.TikaGUI.openFile(TikaGUI.java:279)
	at org.apache.tika.gui.TikaGUI.actionPerformed(TikaGUI.java:238)
	at javax.swing.AbstractButton.fireActionPerformed(AbstractButton.java:2028)
	at javax.swing.AbstractButton$Handler.actionPerformed(AbstractButton.java:2351)
	at javax.swing.DefaultButtonModel.fireActionPerformed(DefaultButtonModel.java:387)
	at javax.swing.DefaultButtonModel.setPressed(DefaultButtonModel.java:242)
	at javax.swing.AbstractButton.doClick(AbstractButton.java:389)
	at javax.swing.plaf.basic.BasicMenuItemUI.doClick(BasicMenuItemUI.java:809)
	at com.apple.laf.AquaMenuItemUI.doClick(AquaMenuItemUI.java:137)
	at javax.swing.plaf.basic.BasicMenuItemUI$Handler.mouseReleased(BasicMenuItemUI.java:850)
	at java.awt.Component.processMouseEvent(Component.java:6373)
	at javax.swing.JComponent.processMouseEvent(JComponent.java:3267)
	at java.awt.Component.processEvent(Component.java:6138)
	at java.awt.Container.processEvent(Container.java:2085)
	at java.awt.Component.dispatchEventImpl(Component.java:4735)
	at java.awt.Container.dispatchEventImpl(Container.java:2143)
	at java.awt.Component.dispatchEvent(Component.java:4565)
	at java.awt.LightweightDispatcher.retargetMouseEvent(Container.java:4621)
	at java.awt.LightweightDispatcher.processMouseEvent(Container.java:4282)
	at java.awt.LightweightDispatcher.dispatchEvent(Container.java:4212)
	at java.awt.Container.dispatchEventImpl(Container.java:2129)
	at java.awt.Window.dispatchEventImpl(Window.java:2478)
	at java.awt.Component.dispatchEvent(Component.java:4565)
	at java.awt.EventQueue.dispatchEventImpl(EventQueue.java:679)
	at java.awt.EventQueue.access$000(EventQueue.java:85)
	at java.awt.EventQueue$1.run(EventQueue.java:638)
	at java.awt.EventQueue$1.run(EventQueue.java:636)
	at java.security.AccessController.doPrivileged(Native Method)
	at java.security.AccessControlContext$1.doIntersectionPrivilege(AccessControlContext.java:87)
	at java.security.AccessControlContext$1.doIntersectionPrivilege(AccessControlContext.java:98)
	at java.awt.EventQueue$2.run(EventQueue.java:652)
	at java.awt.EventQueue$2.run(EventQueue.java:650)
	at java.security.AccessController.doPrivileged(Native Method)
	at java.security.AccessControlContext$1.doIntersectionPrivilege(AccessControlContext.java:87)
	at java.awt.EventQueue.dispatchEvent(EventQueue.java:649)
	at java.awt.EventDispatchThread.pumpOneEventForFilters(EventDispatchThread.java:296)
	at java.awt.EventDispatchThread.pumpEventsForFilter(EventDispatchThread.java:211)
	at java.awt.EventDispatchThread.pumpEventsForHierarchy(EventDispatchThread.java:201)
	at java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:196)
	at java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:188)
	at java.awt.EventDispatchThread.run(EventDispatchThread.java:122)
Caused by: java.lang.NullPointerException
	at com.sun.org.apache.xml.internal.serializer.ToHTMLStream.endElement(ToHTMLStream.java:907)
	at com.sun.org.apache.xalan.internal.xsltc.trax.TransformerHandlerImpl.endElement(TransformerHandlerImpl.java:273)
	at org.apache.tika.sax.ContentHandlerDecorator.endElement(ContentHandlerDecorator.java:136)
	at org.apache.tika.gui.TikaGUI$2.endElement(TikaGUI.java:519)
	at org.apache.tika.sax.TeeContentHandler.endElement(TeeContentHandler.java:94)
	at org.apache.tika.sax.ContentHandlerDecorator.endElement(ContentHandlerDecorator.java:136)
	at org.apache.tika.sax.SecureContentHandler.endElement(SecureContentHandler.java:256)
	at org.apache.tika.sax.ContentHandlerDecorator.endElement(ContentHandlerDecorator.java:136)
	at org.apache.tika.sax.ContentHandlerDecorator.endElement(ContentHandlerDecorator.java:136)
	at org.apache.tika.sax.ContentHandlerDecorator.endElement(ContentHandlerDecorator.java:136)
	at org.apache.tika.sax.SafeContentHandler.endElement(SafeContentHandler.java:273)
	at org.apache.tika.sax.XHTMLContentHandler.endDocument(XHTMLContentHandler.java:213)
	at org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:159)
	at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:243)
	... 44 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The same file is parsed without any errors when not in GUI mode.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12533872">TIKA-801</key>
            <summary>ContentHandlerDecorator outputs invalid element</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="ab">Andrzej Bialecki </reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 Dec 2011 12:36:26 +0000</created>
                <updated>Fri, 9 Dec 2011 18:49:17 +0000</updated>
                            <resolved>Fri, 9 Dec 2011 18:49:17 +0000</resolved>
                                    <version>1.0</version>
                    <version>1.1</version>
                                    <fixVersion>1.1</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13162781" author="mikemccand" created="Mon, 5 Dec 2011 13:47:42 +0000"  >&lt;p&gt;This is happening because the OfficeParser is producing a 2nd body endElement (ie &amp;lt;/body&amp;gt;) without a matching body (&amp;lt;body&amp;gt;) startElement.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-715&quot; title=&quot;Some parsers produce non-well-formed XHTML SAX events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-715&quot;&gt;TIKA-715&lt;/a&gt; would have caught this earlier... when I enable the asserts from there, and run TikaCLI to extract text from this doc, indeed I hit:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception in thread &quot;main&quot; java.lang.AssertionError: end tag=body with no startElement
	at org.apache.tika.sax.SafeContentHandler.verifyEndElement(SafeContentHandler.java:219)
	at org.apache.tika.sax.SafeContentHandler.endElement(SafeContentHandler.java:270)
	at org.apache.tika.sax.XHTMLContentHandler.endDocument(XHTMLContentHandler.java:213)
	at org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:159)
	at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)
	at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)
	at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:120)
	at org.apache.tika.cli.TikaCLI$OutputType.process(TikaCLI.java:130)
	at org.apache.tika.cli.TikaCLI.process(TikaCLI.java:397)
	at org.apache.tika.cli.TikaCLI.main(TikaCLI.java:101)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(There&apos;s also a 2nd mismatched &amp;lt;/html&amp;gt; tag).&lt;/p&gt;

&lt;p&gt;But... I don&apos;t know why OfficeParser is producing a mismatched &amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt; for this document!&lt;/p&gt;

&lt;p&gt;Maybe, it&apos;s invoking a sub-parser but failing to wrap the ContentHandler with EndDocumentShieldingContentHandler?  (OpenDocumentParser uses EndDocumentShieldingContentHandler for this same reason...).&lt;/p&gt;</comment>
                            <comment id="13162795" author="jukkaz" created="Mon, 5 Dec 2011 14:13:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;EndDocumentShieldingContentHandler&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;IMHO we shouldn&apos;t be using the EDSCH mechanism. As noted by Nick in &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-646&quot; title=&quot;tika command line can&amp;#39;t extract metadata for OOXML files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-646&quot;&gt;&lt;del&gt;TIKA-646&lt;/del&gt;&lt;/a&gt;, the correct fix for cases like this would be to update the parsers to generate the metadata &lt;b&gt;before&lt;/b&gt; they call endDocument. The EDSCH solution only fixes the symptoms but not the root cause of the problem.&lt;/p&gt;</comment>
                            <comment id="13164877" author="pahill" created="Thu, 8 Dec 2011 00:39:46 +0000"  >&lt;p&gt;If I am having the same problem, as suggested by Mike McCandless on the user list.  Then it is easy to reproduce.  No attachments required.  Just forward an e-mail 2 or 3 times to your self within Outlook, then copy and past onto your filesystem to create an msg file.  My 1st example was from last year or older, so the latest Outlook is NOT required.&lt;/p&gt;

&lt;p&gt;Then drop onto Tika-app 1.0 (but not 0.7, 0.9, 0.10) and you get the following&lt;/p&gt;

&lt;p&gt;org.apache.tika.exception.TikaException: Unexpected RuntimeException from org.apache.tika.parser.microsoft.OfficeParser@97de276&lt;br/&gt;
	at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:244)&lt;br/&gt;
	at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)&lt;br/&gt;
	at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:120)&lt;br/&gt;
	at org.apache.tika.gui.TikaGUI.handleStream(TikaGUI.java:320)&lt;br/&gt;
	at org.apache.tika.gui.TikaGUI.openFile(TikaGUI.java:279)&lt;br/&gt;
	at org.apache.tika.gui.ParsingTransferHandler.importFiles(ParsingTransferHandler.java:94)&lt;br/&gt;
	at org.apache.tika.gui.ParsingTransferHandler.importData(ParsingTransferHandler.java:77)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at com.sun.org.apache.xml.internal.serializer.ToHTMLStream.endElement(Unknown Source)&lt;br/&gt;
	at com.sun.org.apache.xalan.internal.xsltc.trax.TransformerHandlerImpl.endElement(Unknown Source)&lt;br/&gt;
	at org.apache.tika.sax.ContentHandlerDecorator.endElement(ContentHandlerDecorator.java:136)&lt;br/&gt;
	at org.apache.tika.gui.TikaGUI$2.endElement(TikaGUI.java:519)&lt;br/&gt;
	at org.apache.tika.sax.TeeContentHandler.endElement(TeeContentHandler.java:94)&lt;br/&gt;
	at org.apache.tika.sax.ContentHandlerDecorator.endElement(ContentHandlerDecorator.java:136)&lt;br/&gt;
	at org.apache.tika.sax.SecureContentHandler.endElement(SecureContentHandler.java:256)&lt;br/&gt;
	at org.apache.tika.sax.ContentHandlerDecorator.endElement(ContentHandlerDecorator.java:136)&lt;br/&gt;
	at org.apache.tika.sax.ContentHandlerDecorator.endElement(ContentHandlerDecorator.java:136)&lt;br/&gt;
	at org.apache.tika.sax.ContentHandlerDecorator.endElement(ContentHandlerDecorator.java:136)&lt;br/&gt;
	at org.apache.tika.sax.SafeContentHandler.endElement(SafeContentHandler.java:273)&lt;br/&gt;
	at org.apache.tika.sax.XHTMLContentHandler.endDocument(XHTMLContentHandler.java:213)&lt;br/&gt;
	at org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:178)&lt;br/&gt;
	at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)&lt;br/&gt;
	... 41 more&lt;/p&gt;
</comment>
                            <comment id="13164879" author="pahill" created="Thu, 8 Dec 2011 00:43:22 +0000"  >&lt;p&gt;The attached file stack dumps in Tika 1.0 as of 2011-12-05 Tika-app-1.0 Release (not the nightly build).&lt;/p&gt;</comment>
                            <comment id="13165288" author="mikemccand" created="Thu, 8 Dec 2011 15:59:17 +0000"  >
&lt;p&gt;Actually this isn&apos;t a problem of a parser outputting metadata after&lt;br/&gt;
startDocument...&lt;/p&gt;

&lt;p&gt;The problem, for both of the test docs, is that the Outlook message&lt;br/&gt;
has a chunk of RTF text and so OutlookExtractor recurses into the&lt;br/&gt;
RTFParser.&lt;/p&gt;

&lt;p&gt;RTFParser then calls start/endDocument itself.&lt;/p&gt;

&lt;p&gt;I can fix this by having RTFParser expose a separate parse method,&lt;br/&gt;
with control over whether or not it should call start/endDocument&lt;br/&gt;
itself; that seems to fix these two test docs.&lt;/p&gt;

&lt;p&gt;However, if the Outlook message has an HTML chunk, it&apos;s also broken:&lt;br/&gt;
try running TikaGUI on&lt;br/&gt;
tika-parsers/src/test/resources/test-documents/testMSG_chinese.msg&lt;br/&gt;
(that&apos;s an HTML Outlook message).&lt;/p&gt;

&lt;p&gt;How can/should we fix that one?  It&apos;s tagsoup that&apos;s calling&lt;br/&gt;
.endDocument...&lt;/p&gt;</comment>
                            <comment id="13165291" author="jukkaz" created="Thu, 8 Dec 2011 16:09:14 +0000"  >&lt;p&gt;See the org.apache.tika.sax.EmbeddedContentHandler class. It&apos;s explicitly designed for cases like this.&lt;br/&gt;
The ParsingEmbeddedDocumentExtractor class has an example of how to use EmbeddedContentHandler.&lt;/p&gt;</comment>
                            <comment id="13165530" author="mikemccand" created="Thu, 8 Dec 2011 20:34:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;See the org.apache.tika.sax.EmbeddedContentHandler class. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Excellent!&lt;/p&gt;

&lt;p&gt;I did that (patch attached) and these RTF/HTML Outlook docs are now fine through TikaGUI.&lt;/p&gt;</comment>
                            <comment id="13165579" author="pahill" created="Thu, 8 Dec 2011 21:23:55 +0000"  >&lt;p&gt;Thanks Jukka and Michael. Your quick response is appreciated.&lt;/p&gt;</comment>
                            <comment id="13166148" author="jukkaz" created="Fri, 9 Dec 2011 13:25:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;patch attached&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Looks good, +1.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12506547" name="FW  Testing.msg" size="25600" author="pahill" created="Thu, 8 Dec 2011 00:43:22 +0000"/>
                            <attachment id="12506652" name="TIKA-801.patch" size="5296" author="mikemccand" created="Thu, 8 Dec 2011 20:34:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 5 Dec 2011 13:47:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>219598</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx1jz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16571</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>