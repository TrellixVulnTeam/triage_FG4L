<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:38:12 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-567/TIKA-567.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-567] Temporary file leak in TikaInputStream</title>
                <link>https://issues.apache.org/jira/browse/TIKA-567</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;The TikaInputStream.get(InputStream) method can end up leaking temporary files in cases like the Detector classes that will not close the returned stream.&lt;/p&gt;

&lt;p&gt;There should be a mechanism to signal that a potential TikaInputStream wrapper will no longer be used even if the underlying stream should not be closed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12492096">TIKA-567</key>
            <summary>Temporary file leak in TikaInputStream</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="jukkaz">Jukka Zitting</reporter>
                        <labels>
                    </labels>
                <created>Sun, 5 Dec 2010 13:18:31 +0000</created>
                <updated>Thu, 2 Aug 2012 10:33:36 +0100</updated>
                            <resolved>Wed, 19 Jan 2011 12:41:38 +0000</resolved>
                                    <version>0.8</version>
                                    <fixVersion>0.9</fixVersion>
                                    <component>general</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12983395" author="dbenson" created="Tue, 18 Jan 2011 21:41:55 +0000"  >&lt;p&gt;We upgraded from Tika 0.8 to 0.9-SNAPSHOT because of &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-548&quot; title=&quot;PDF content extracted as single line&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-548&quot;&gt;&lt;del&gt;TIKA-548&lt;/del&gt;&lt;/a&gt;, but the temporary file leak is causing large indexing jobs to run out of file handles (even after bumping up fs.file-max = 65535). I would suspect this would be a major concern for anyone else indexing millions of PDFs. Can this be addressed? Thanks&lt;/p&gt;</comment>
                            <comment id="12983683" author="jukkaz" created="Wed, 19 Jan 2011 12:41:38 +0000"  >&lt;p&gt;I&apos;ve added a TemporaryFiles class that can be used with TikaInputStream when the close() method is not called:&lt;/p&gt;

&lt;p&gt;    TemporaryFiles tmp = new TemporaryFiles();&lt;br/&gt;
    try &lt;/p&gt;
{
        TikaInputStream stream = TikaInputStream.get(..., tmp);
        // process stream but don&apos;t close it
    }
&lt;p&gt; finally &lt;/p&gt;
{
        tmp.dispose();
    }

&lt;p&gt;This makes sure that any temporary files created by TikaInputStream are correctly removed when no longer used.&lt;/p&gt;

&lt;p&gt;This construct is not needed in cases where you know that the close() method will be called on the TikaInputStream instance.&lt;/p&gt;

&lt;p&gt;I also modified all existing Tika code to use this new construct where appropriate. Now a &quot;mvn clean install&quot; or another test run leaves no temporary files behind. Resolving as fixed.&lt;/p&gt;</comment>
                            <comment id="12983784" author="jukkaz" created="Wed, 19 Jan 2011 16:35:57 +0000"  >&lt;p&gt;To clarify, there&apos;s normally no need to use the TemporaryFiles construct in client code, it&apos;s mostly for internal Tika code.&lt;/p&gt;</comment>
                            <comment id="12983789" author="dbenson" created="Wed, 19 Jan 2011 16:50:52 +0000"  >&lt;p&gt;Still seeing some temporary files get created. I&apos;ve uploaded one here:&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/786436&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gist.github.com/786436&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12983799" author="jukkaz" created="Wed, 19 Jan 2011 17:09:57 +0000"  >&lt;p&gt;These +~JFxxx.tmp files are a result of a bug in java.awt.Font. See &lt;a href=&quot;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6380357&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6380357&lt;/a&gt; for details.&lt;/p&gt;

&lt;p&gt;There&apos;s nothing much we can do about this problem in Tika, so your best option is to upgrade to a more recent Java version.&lt;/p&gt;</comment>
                            <comment id="12983802" author="dbenson" created="Wed, 19 Jan 2011 17:19:49 +0000"  >&lt;p&gt;We&apos;re running:&lt;br/&gt;
java version &quot;1.6.0_21&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_21-b06)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 17.0-b16, mixed mode)&lt;/p&gt;

&lt;p&gt;But will upgrade to latest (23) and see if that helps.&lt;/p&gt;</comment>
                            <comment id="12983834" author="dbenson" created="Wed, 19 Jan 2011 18:54:58 +0000"  >&lt;p&gt;Still seeing the temporary files getting created on latest JDK&lt;br/&gt;
java version &quot;1.6.0_23&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_23-b05)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 19.0-b09, mixed mode)&lt;/p&gt;</comment>
                            <comment id="12983841" author="jukkaz" created="Wed, 19 Jan 2011 19:02:23 +0000"  >&lt;p&gt;Can you check if files stay around also after you terminate the JVM? If not, then they&apos;re not really leaking. AFAIUI the java.awt.Font class that creates these files uses them to back a static internal font cache, so they&apos;ll normally only get removed when the JVM exits.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 18 Jan 2011 21:41:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4296</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx2zr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16804</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>