<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:39:12 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-482/TIKA-482.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-482] Refactor image and jpeg parsers for access to MetadataExtractor API</title>
                <link>https://issues.apache.org/jira/browse/TIKA-482</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;When I added support for more image metadata in &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-472&quot; title=&quot;Extract image title, description and author&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-472&quot;&gt;&lt;del&gt;TIKA-472&lt;/del&gt;&lt;/a&gt;, i realized&lt;br/&gt;
the current design had some restrictions:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I could not access the typed getters from Metadata Extractor, such&lt;br/&gt;
as getDate (to format iso date) and getStringArray (for keywords).&lt;/li&gt;
	&lt;li&gt;The handler function was called one field at a time which prevents&lt;br/&gt;
logic where one field depends on the value of another (there is for&lt;br/&gt;
example record versions and fields that specify encoding)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;See attached patch. It refactors TiffExtractor to MetadataExtractorExtractor.&lt;br/&gt;
The patch also includes the date fix, see &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-451#action_12898794&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TIKA-451#action_12898794&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We can later add more Extractors using other libraries, and map to parsers based on format. For example we already use ImageIO in ImageParser so maybe there should be an ImageIOExtractor.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12471789">TIKA-482</key>
            <summary>Refactor image and jpeg parsers for access to MetadataExtractor API</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="solsson">Staffan Olsson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Aug 2010 09:15:21 +0100</created>
                <updated>Sat, 7 Jul 2012 20:47:04 +0100</updated>
                            <resolved>Sat, 7 Jul 2012 20:47:04 +0100</resolved>
                                    <version>0.7</version>
                                    <fixVersion>1.2</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12899327" author="solsson" created="Tue, 17 Aug 2010 09:18:54 +0100"  >&lt;p&gt;Was developed as several commits at &lt;a href=&quot;http://github.com/solsson/tika&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://github.com/solsson/tika&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12905930" author="gagravarr" created="Fri, 3 Sep 2010 16:03:49 +0100"  >&lt;p&gt;Thanks for this patch&lt;/p&gt;

&lt;p&gt;I&apos;ve applied it with a few tweaks in r992319.&lt;/p&gt;

&lt;p&gt;The two main changes were:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Different name for the Exif parser class - ImageMetadataExtractor seemed a better name than MetadataExtractorExtractor&lt;/li&gt;
	&lt;li&gt;Original and default dates done slightly differently. This was with &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-504&quot; title=&quot;Support XMP metadata keys for more of the common EXIF tags&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-504&quot;&gt;&lt;del&gt;TIKA-504&lt;/del&gt;&lt;/a&gt; in mind, but we should maybe think about which is the right set of date related properties to map onto&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ll keep this issue open for now, as it looks from your Git repo that you&apos;ve some more cool new refactorings to come along shortly!&lt;/p&gt;</comment>
                            <comment id="12906352" author="solsson" created="Sun, 5 Sep 2010 17:03:06 +0100"  >&lt;p&gt;I&apos;ve looked through your commits briefly but haven&apos;t had time to merge it into my branch yet.&lt;/p&gt;

&lt;p&gt;I couldn&apos;t spot the difference in Exif Date/Time, what is it?&lt;/p&gt;

&lt;p&gt;A test seems to be missing, namely &lt;a href=&quot;http://github.com/solsson/tika/blob/trunk/tika-parsers/src/test/java/org/apache/tika/parser/image/ImageMetadataExtractorTest.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://github.com/solsson/tika/blob/trunk/tika-parsers/src/test/java/org/apache/tika/parser/image/ImageMetadataExtractorTest.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m working on adding real XMP extraction support for images, but waiting for &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-806&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/PDFBOX-806&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="12906370" author="solsson" created="Sun, 5 Sep 2010 20:07:52 +0100"  >&lt;p&gt;I see the difference in date now:&lt;/p&gt;

&lt;p&gt;         assertEquals(&quot;Date/Time Original for when the photo was taken, unspecified time zone&quot;,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&quot;2009-08-11T09:09:45&quot;, metadata.get(Metadata.DATE));&lt;br/&gt;
+                &quot;2009-08-11T09:09:45&quot;, metadata.get(Metadata.ORIGINAL_DATE));&lt;br/&gt;
         assertEquals(&quot;This image has different Date/Time than Date/Time Original, so it is probably modification date&quot;,&lt;/li&gt;
	&lt;li&gt;&quot;2009-10-02T23:02:49&quot;, metadata.get(Metadata.LAST_MODIFIED));&lt;br/&gt;
+                &quot;2009-10-02T23:02:49&quot;, metadata.get(Metadata.DATE));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I don&apos;t agree to this change, because the javadocs of DublinCore.DATE say &quot;Typically, Date will be associated with the creation or availability of the resource&quot;.&lt;/p&gt;</comment>
                            <comment id="12906375" author="solsson" created="Sun, 5 Sep 2010 20:44:28 +0100"  >&lt;p&gt;Tried to merge both efforts in&lt;br/&gt;
&lt;a href=&quot;http://github.com/solsson/tika/commit/9aaff18305abf352b355b1ef8de753bdc2e6b5b5&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://github.com/solsson/tika/commit/9aaff18305abf352b355b1ef8de753bdc2e6b5b5&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Merging was difficult because my patch was in the same commit as some additional changes, so I had to manually extract those changes into my fork.&lt;/p&gt;</comment>
                            <comment id="12906483" author="gagravarr" created="Mon, 6 Sep 2010 12:31:10 +0100"  >&lt;p&gt;I couldn&apos;t include ImageMetadataExtractorTest as it uses new features of the extractor that weren&apos;t in the patch...&lt;/p&gt;

&lt;p&gt;Looking at your latest git patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I think we do need all the random metadata as-is, since that is all there has been for a while, and anyone currently using tika will be using those&lt;/li&gt;
	&lt;li&gt;Could ExifOldStyleHandler and ExifHandler be merged? I guess ExifOldStyleHandler would want to be switched from tag iterator to directory.containsTag though?&lt;/li&gt;
	&lt;li&gt;For the keywords, would it not be better to use the tika metadata multiple-value support, rather than underscore stuff?&lt;/li&gt;
	&lt;li&gt;What else is needed do you think before we could apply this?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;On the date thing, maybe the right thing to do is:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;EXIF original date -&amp;gt; Metadata.DATE, Metadata.CREATION_DATE&lt;/li&gt;
	&lt;li&gt;EXIF date -&amp;gt; Metadata.LAST_MODIFIED&lt;br/&gt;
Would that make more sense to you?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12907097" author="solsson" created="Wed, 8 Sep 2010 06:41:26 +0100"  >&lt;p&gt;Merged EXIF parsing so now all fields are processed the same way, in:&lt;br/&gt;
&lt;a href=&quot;http://github.com/solsson/tika/commit/e61048c177560b8aa5585fd5b1d9194f446bec65&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://github.com/solsson/tika/commit/e61048c177560b8aa5585fd5b1d9194f446bec65&lt;/a&gt;&lt;br/&gt;
and some minor additions in:&lt;br/&gt;
&lt;a href=&quot;http://github.com/solsson/tika/commit/c22107201178064ffd2260ca9136cb0d57c46d1f&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://github.com/solsson/tika/commit/c22107201178064ffd2260ca9136cb0d57c46d1f&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://github.com/solsson/tika/commit/880c0eb11f8410296d9b1401afef2dc37abbaf24&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://github.com/solsson/tika/commit/880c0eb11f8410296d9b1401afef2dc37abbaf24&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Set dates as Nick suggested:&lt;br/&gt;
&lt;a href=&quot;http://github.com/solsson/tika/commit/866d396497dd7b95329f465d8cb220ad2899dc8b&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://github.com/solsson/tika/commit/866d396497dd7b95329f465d8cb220ad2899dc8b&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Handling keywords as multi-value since:&lt;br/&gt;
&lt;a href=&quot;http://github.com/solsson/tika/commit/9742c826a5edad6d0288b83d3653735dd85b116f&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://github.com/solsson/tika/commit/9742c826a5edad6d0288b83d3653735dd85b116f&lt;/a&gt;&lt;br/&gt;
Note:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Assertions for &quot;subject&quot; field and unicode characters in description may need to be commented out until XMP support is merged.&lt;/li&gt;
	&lt;li&gt;This commit disables the copying of all fields for reasons stated in the commit comment.&lt;br/&gt;
Can it be done like in PDFParser, with only the fields that are not explicitly mapped?&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="12907386" author="solsson" created="Wed, 8 Sep 2010 20:57:56 +0100"  >&lt;p&gt;Copy all fields are back, almost... Solved the backwards compatibility issue in&lt;br/&gt;
&lt;a href=&quot;http://github.com/solsson/tika/commit/770a453acff9a490c27c6a2fd01828c7ddd5fde1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://github.com/solsson/tika/commit/770a453acff9a490c27c6a2fd01828c7ddd5fde1&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12916167" author="gagravarr" created="Wed, 29 Sep 2010 16:11:49 +0100"  >&lt;p&gt;Staffan - do you think this is now stable enough to apply? If so, could you please upload a patch + tick the license grant box, and I&apos;ll review + hopefully commit!&lt;/p&gt;</comment>
                            <comment id="12916481" author="solsson" created="Thu, 30 Sep 2010 15:07:23 +0100"  >&lt;p&gt;Attached a combined svn patch for the fixes above.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Added XMP parsing of Title, Subject and Description with encoding support&lt;/li&gt;
	&lt;li&gt;Date extraction to Dublin Core fields matches javadoc for the fields&lt;/li&gt;
	&lt;li&gt;All EXIF parsing done the same way&lt;/li&gt;
	&lt;li&gt;EXIF tags that are mapped to fields of the same name unless the name is a defined Tika field (for backwards compatibility &amp;#8211; they should have been added with a namespace such as &quot;exif:&quot; from the start)&lt;/li&gt;
	&lt;li&gt;multi-value keywords&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Questions:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Reading the same input stream twice in JpegParser and TiffParser, is this how to do it in Tika?&lt;/li&gt;
	&lt;li&gt;Finding out if a string is a defined Tika field, is the new class necessary?&lt;/li&gt;
	&lt;li&gt;What if the parsing of an exif field throws exception, should we attempt to extract the remaining fields anyway?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12918850" author="solsson" created="Thu, 7 Oct 2010 10:13:57 +0100"  >&lt;p&gt;New version of testTIFF needed for the added tests. Metadata diff:&lt;br/&gt;
9c9&lt;br/&gt;
&amp;lt; Exif.Image.StripOffsets                      Long        2  8 19208&lt;br/&gt;
&amp;#8212;&lt;br/&gt;
&amp;gt; Exif.Image.StripOffsets                      Long        2  3084 22284&lt;br/&gt;
17a18,19&lt;br/&gt;
&amp;gt; Exif.Image.XMLPacket                         Byte      2500  (Binary value suppressed)&lt;br/&gt;
&amp;gt; Xmp.dc.subject                               XmpBag      2  cat, garden&lt;/p&gt;</comment>
                            <comment id="12922448" author="solsson" created="Tue, 19 Oct 2010 06:56:21 +0100"  >&lt;p&gt;I&apos;ve had this running for quite a while now and it looks stable. If the patch is too complex I suggest (again) that we remove the non-namespaced EXIF fields. It will break backwards compatibility as you said Nick, but Tika is still 0.X and the names of EXIF fields differ between cameras anyway. I suggest copying all the fields with an &quot;exif:&quot; prefix instead, as there would be no risk for conflicts with defined fields and the raw output of all metadata fields would be clearer.&lt;/p&gt;</comment>
                            <comment id="12922535" author="gagravarr" created="Tue, 19 Oct 2010 13:18:58 +0100"  >&lt;p&gt;Sorry for the delay Staffan. I&apos;ve done a quick review and it looked fine, and I&apos;m hoping to do a longer review + commit early next week (it&apos;s been a crazy busy fortnight...)&lt;/p&gt;</comment>
                            <comment id="12930631" author="gagravarr" created="Wed, 10 Nov 2010 16:00:15 +0000"  >&lt;p&gt;Sorry for the delay in finally reviewing this, now committed to Tika in r1033546.&lt;/p&gt;

&lt;p&gt;I agree with your code comments about MetadataFields being both useful and more widely usable than just for the image stuff. Maybe someone like Jukka could cast an eye over it, and decide if it&apos;s better off being a core part of the Metadata object, or staying in a separate helper class as now but put elsewhere.&lt;/p&gt;

&lt;p&gt;I&apos;ll keep this bug open until we&apos;ve decided where to put the class&lt;/p&gt;

&lt;p&gt;Thanks for all the work on the improvements though!&lt;/p&gt;</comment>
                            <comment id="12930703" author="jukkaz" created="Wed, 10 Nov 2010 18:40:25 +0000"  >&lt;p&gt;Staffan, I notice that some of the files are missing Apache license files. I assume it&apos;ll be OK to add them.&lt;/p&gt;

&lt;p&gt;I&apos;ll take a deeper look at the changes in a moment. At first glance this looks great!&lt;/p&gt;</comment>
                            <comment id="12930730" author="solsson" created="Wed, 10 Nov 2010 19:32:06 +0000"  >&lt;p&gt;Yes, it&apos;s all meant for Apache license&lt;/p&gt;</comment>
                            <comment id="13408759" author="jukkaz" created="Sat, 7 Jul 2012 20:47:04 +0100"  >&lt;blockquote&gt;&lt;p&gt;I&apos;ll take a deeper look at the changes in a moment.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Took a lot longer than expected. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Anyway, nothing to add from me for now, so resolving as fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12452266" name="TIKA-451-DublinCore_and_TIKA-482.patch" size="34922" author="solsson" created="Tue, 17 Aug 2010 09:18:54 +0100"/>
                            <attachment id="12456009" name="TIKA-482_exif_and_xmp.patch" size="67372" author="solsson" created="Thu, 30 Sep 2010 14:54:26 +0100"/>
                            <attachment id="12456010" name="testJPEG_commented_pspcs2mac.jpg" size="26173" author="solsson" created="Thu, 30 Sep 2010 14:54:26 +0100"/>
                            <attachment id="12456011" name="testJPEG_commented_xnviewmp026.jpg" size="13910" author="solsson" created="Thu, 30 Sep 2010 14:54:26 +0100"/>
                            <attachment id="12456582" name="testTIFF.tif" size="25584" author="solsson" created="Thu, 7 Oct 2010 10:13:57 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 3 Sep 2010 15:03:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4379</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx3in:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16889</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>