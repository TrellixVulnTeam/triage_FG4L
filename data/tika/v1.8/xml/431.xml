<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:29:16 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-431/TIKA-431.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-431] Tika currently misuses the HTTP Content-Encoding header, and does not seem to use the charset part of the Content-Type header properly.</title>
                <link>https://issues.apache.org/jira/browse/TIKA-431</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;Tika currently misuses the HTTP Content-Encoding header, and does not seem to use the charset part of the Content-Type header properly.&lt;/p&gt;

&lt;p&gt;Content-Encoding is not for the charset. It is for values like gzip, deflate, compress, or identity.&lt;/p&gt;

&lt;p&gt;Charset is passed in with the Content-Type. For instance: text/html; charset=iso-8859-1&lt;/p&gt;

&lt;p&gt;Tika should, in my opinion, do the following:&lt;/p&gt;

&lt;p&gt;1. Stop using Content-Encoding, unless it wants me to be able to pass in gzipped content in an input stream.&lt;/p&gt;

&lt;p&gt;2. Parse and understand charset=... declarations if passed in the Metadata object&lt;/p&gt;

&lt;p&gt;3. Return charset=... declarations in the Metadata object if a charset is detected.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12465148">TIKA-431</key>
            <summary>Tika currently misuses the HTTP Content-Encoding header, and does not seem to use the charset part of the Content-Type header properly.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="egh">Erik Hetzner</reporter>
                        <labels>
                    </labels>
                <created>Fri, 21 May 2010 18:57:20 +0100</created>
                <updated>Thu, 2 May 2013 03:30:54 +0100</updated>
                            <resolved>Sun, 8 Jul 2012 23:47:29 +0100</resolved>
                                                    <fixVersion>1.2</fixVersion>
                                    <component>general</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12870079" author="egh" created="Fri, 21 May 2010 19:01:31 +0100"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-341&quot; title=&quot;Use charset in CONTENT_TYPE metadata when detecting the character encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-341&quot;&gt;&lt;del&gt;TIKA-341&lt;/del&gt;&lt;/a&gt;, apparently my suggestion (2) above is implemented already.&lt;/p&gt;

&lt;p&gt;Thank you for anticipating this issue in advance! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12871567" author="jukkaz" created="Wed, 26 May 2010 09:45:17 +0100"  >&lt;p&gt;Agreed, we should be using the charset parameter of the media type instead of the Content-Encoding header.&lt;/p&gt;

&lt;p&gt;AFAICT we need to adjust the HtmlParser, MboxParser and TXTParser classes to do this. Any volunteers?&lt;/p&gt;</comment>
                            <comment id="12871824" author="kkrugler" created="Wed, 26 May 2010 18:10:39 +0100"  >&lt;p&gt;I should have some time soon to do a once-over on a bunch of encoding-related issues.&lt;/p&gt;</comment>
                            <comment id="13103121" author="janhoy" created="Mon, 12 Sep 2011 23:14:37 +0100"  >&lt;p&gt;ping()&lt;br/&gt;
We&apos;ve just got bitten by this, any chance for a fix for v1.0?&lt;/p&gt;</comment>
                            <comment id="13103144" author="kkrugler" created="Mon, 12 Sep 2011 23:41:36 +0100"  >&lt;p&gt;Hi Jan - sorry for the delay. Would end of week be soon enough?&lt;/p&gt;

&lt;p&gt;&amp;#8211; Ken&lt;/p&gt;</comment>
                            <comment id="13103469" author="gagravarr" created="Tue, 13 Sep 2011 09:55:08 +0100"  >&lt;p&gt;Any chance someone could work up a failing unit test for this, so when Ken&apos;s fix is done we&apos;ll be able to verify it works (and ensure it doesn&apos;t get broken in future!)&lt;/p&gt;</comment>
                            <comment id="13104875" author="janhoy" created="Wed, 14 Sep 2011 22:06:27 +0100"  >&lt;p&gt;End of week is good. As soon as 1.0 gets released, I&apos;ll try to get it into next Solr release..&lt;/p&gt;</comment>
                            <comment id="13106651" author="kkrugler" created="Fri, 16 Sep 2011 19:14:35 +0100"  >&lt;p&gt;This is a pretty big change, so I&apos;m going to let the patch sit for a bit.&lt;/p&gt;

&lt;p&gt;This should also address &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-539&quot; title=&quot;Encoding detection is too biased by encoding in meta tag&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-539&quot;&gt;TIKA-539&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13106893" author="kkrugler" created="Sat, 17 Sep 2011 00:02:12 +0100"  >&lt;p&gt;Some other things I should have mentioned with regards to this patch:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Anybody who was returning the charset via CONTENT_ENCODING now returns it via CONTENT_TYPE, in the ...; charset=xxx parameter.&lt;/li&gt;
	&lt;li&gt;If the charset is specified via Metadata.CONTENT_TYPE, and it&apos;s valid (supported, etc) then TXTParser will no longer use ICU4J&apos;s charset detector code. This is to match the behavior of the HtmlParser code, and the essence of &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-539&quot; title=&quot;Encoding detection is too biased by encoding in meta tag&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-539&quot;&gt;TIKA-539&lt;/a&gt;. We could revisit this, if people feel that depending on things like server response headers is too risky.&lt;/li&gt;
	&lt;li&gt;The charset detection algorithm in HtmlParser matches what was proposed/discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-539&quot; title=&quot;Encoding detection is too biased by encoding in meta tag&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-539&quot;&gt;TIKA-539&lt;/a&gt;. Namely the &amp;lt;meta&amp;gt; tag or incoming metadata content-type charset is used if it&apos;s valid, and only exists in one or the other, or is the same in both. Otherwise ICU4J is used.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13107130" author="rcmuir" created="Sat, 17 Sep 2011 14:22:20 +0100"  >&lt;p&gt;Shouldnt the charset from the http response header instead be supplied to CharsetDetector.setDeclaredEncoding&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://icu-project.org/apiref/icu4j/com/ibm/icu/text/CharsetDetector.html#setDeclaredEncoding(java.lang.String&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://icu-project.org/apiref/icu4j/com/ibm/icu/text/CharsetDetector.html#setDeclaredEncoding(java.lang.String&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Seems bad to trust this completely.&lt;/p&gt;</comment>
                            <comment id="13107214" author="kkrugler" created="Sat, 17 Sep 2011 20:17:45 +0100"  >&lt;p&gt;Hi Robert,&lt;/p&gt;

&lt;p&gt;I&apos;m assuming you&apos;re talking about the case where all we have is the server response header (versus the case where it&apos;s in the HTML meta tag), right?&lt;/p&gt;

&lt;p&gt;If so, then I agree with you - I think it would be better to not trust that. Given what I&apos;ve seen coming back from web servers, they lie too often &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Though the iCU detection code isn&apos;t very good either, as I found out after doing an analysis.&lt;/p&gt;

&lt;p&gt;Anyway, if I made that change, then the current code would go ahead and pass it as the hint to ICU.&lt;/p&gt;
</comment>
                            <comment id="13107228" author="rcmuir" created="Sat, 17 Sep 2011 20:52:38 +0100"  >&lt;p&gt;I&apos;m not sure even if its in both that it should be trusted, e.g. some logic like:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;if there is a charset in either or header or meta tag, or both and its the same, use it as setDeclaredEncoding (suggestion)&lt;/li&gt;
	&lt;li&gt;if there is any ambiguity, then its clearly wrong already, and dont setDeclaredEncoding to anything.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13107234" author="rcmuir" created="Sat, 17 Sep 2011 21:14:35 +0100"  >&lt;blockquote&gt;
&lt;p&gt;Though the iCU detection code isn&apos;t very good either, as I found out after doing an analysis.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Really? what kind of analysis? Other tests seem to show these statistical techniques work pretty well (98% or 99%), though I havent looked too hard into their methodology.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://philip.html5.org/data/charsets.html#sniffing-bytes&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://philip.html5.org/data/charsets.html#sniffing-bytes&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cs229.stanford.edu/proj2007/KimPark-AutomaticDetectionOfCharacterEncodingAndLanguages.pdf&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://cs229.stanford.edu/proj2007/KimPark-AutomaticDetectionOfCharacterEncodingAndLanguages.pdf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I think thats a lot more accurate than web server configurations or meta tags.&lt;/p&gt;</comment>
                            <comment id="13107272" author="kkrugler" created="Sat, 17 Sep 2011 23:01:44 +0100"  >&lt;p&gt;For analysis, I used Tika charset detection and compared to &amp;lt;meta&amp;gt; http-equiv charset. See my email to the Tika list with subject &quot;HUG talk on Public Terabyte Dataset project&quot;.&lt;/p&gt;

&lt;p&gt;As I mentioned in that post, it&apos;s possible my analysis had errors, but the results weren&apos;t great for % of time that ICU4J matched the meta tag charset. When I looked at miss-matches manually, they mostly seemed to be issues with ICU, versus a bad meta tag charset.&lt;/p&gt;

&lt;p&gt;From the page at &lt;a href=&quot;http://philip.html5.org/data/charsets.html#sniffing-bytes&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://philip.html5.org/data/charsets.html#sniffing-bytes&lt;/a&gt;, I don&apos;t see stats on comparing various declared encodings (e.g. what percentage of the time did response header == meta == detected), which would be useful.&lt;/p&gt;

&lt;p&gt;I&apos;ve got some crawl data which, if I had time, I could run through a similar analysis but this time dump out all of the cases where ICU (with and without hints) differs from both.&lt;/p&gt;</comment>
                            <comment id="13107273" author="kkrugler" created="Sat, 17 Sep 2011 23:02:54 +0100"  >&lt;p&gt;Re &quot;if there is any ambiguity, then its clearly wrong already&quot;. If there&apos;s ambiguity between the response header and the meta tag, then it&apos;s clear that one is wrong, but in my experience meta tags are a lot more accurate than the server response headers.&lt;/p&gt;</comment>
                            <comment id="13409093" author="jukkaz" created="Sun, 8 Jul 2012 23:47:29 +0100"  >&lt;p&gt;In revision 1358858 I made the text and html parsers return character encoding information in the charset parameter of the returned content type. The content encoding field is still present for backwards compatibility, but I added a note to the CHANGES.txt mentioning that it should be considered deprecated.&lt;/p&gt;</comment>
                            <comment id="13421711" author="tssk" created="Tue, 24 Jul 2012 20:51:46 +0100"  >&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;it seems that I created duplicate issue &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-952&quot; title=&quot;HTML meta tags ignored for encoding detection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-952&quot;&gt;&lt;del&gt;TIKA-952&lt;/del&gt;&lt;/a&gt; (which I closed).&lt;/p&gt;

&lt;p&gt;But I am not sure why Content-Encoding and charset parameter values differ. Shoudn&apos;t they be the same?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12598169">TIKA-952</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12610143">TIKA-1001</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12478375">TIKA-539</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12603289">TIKA-974</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12494835" name="TIKA-431.patch" size="29904" author="kkrugler" created="Fri, 16 Sep 2011 19:14:34 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 26 May 2010 08:45:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4430</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxuz0n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4496</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>