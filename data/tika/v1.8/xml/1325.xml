<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:37:12 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-1325/TIKA-1325.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-1325] Move the font metadata definitions to properties</title>
                <link>https://issues.apache.org/jira/browse/TIKA-1325</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;As noticed while working on &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1182&quot; title=&quot;Out of memory exception when parsing TTF file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1182&quot;&gt;&lt;del&gt;TIKA-1182&lt;/del&gt;&lt;/a&gt;, the AFM font parser has a bunch of hard coded strings it uses as metadata keys, while the TTF font parser doesn&apos;t have many&lt;/p&gt;

&lt;p&gt;We should switch these to being proper Properties, with definitions from a well known standard (+ compatibility fallbacks), and have both use largely the same set&lt;/p&gt;</description>
                <environment></environment>
        <key id="12718818">TIKA-1325</key>
            <summary>Move the font metadata definitions to properties</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="gagravarr">Nick Burch</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Jun 2014 11:50:52 +0100</created>
                <updated>Sun, 22 Mar 2015 14:56:32 +0000</updated>
                                            <version>1.5</version>
                    <version>1.6</version>
                                                    <component>metadata</component>
                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="14019809" author="hudson" created="Fri, 6 Jun 2014 13:48:58 +0100"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.7 #26 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.7/26/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.7/26/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1325&quot; title=&quot;Move the font metadata definitions to properties&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1325&quot;&gt;TIKA-1325&lt;/a&gt; Temp fix - pull out some of the font metadata keys to string constants, and rename the test (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1600860&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1600860&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/main/java/org/apache/tika/parser/font/AdobeFontMetricParser.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/java/org/apache/tika/parser/font/AdobeFontMetricParserTest.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/java/org/apache/tika/parser/font/FontParsersTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14019817" author="hudson" created="Fri, 6 Jun 2014 14:07:19 +0100"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.6 #26 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.6/26/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.6/26/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1325&quot; title=&quot;Move the font metadata definitions to properties&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1325&quot;&gt;TIKA-1325&lt;/a&gt; Temp fix - pull out some of the font metadata keys to string constants, and rename the test (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1600860&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1600860&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/main/java/org/apache/tika/parser/font/AdobeFontMetricParser.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/java/org/apache/tika/parser/font/AdobeFontMetricParserTest.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/java/org/apache/tika/parser/font/FontParsersTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14019921" author="gagravarr" created="Fri, 6 Jun 2014 16:25:27 +0100"  >&lt;p&gt;As of r1600917, the AFM and TTF parsers now largely use the same set of plain text keys, and we have unit tests for both. &lt;/p&gt;

&lt;p&gt;Next step is to identify a suitable external standard, then define metadata properties based on that (including backwards compatible keys using the current naming), and then convert the parsers to use those&lt;/p&gt;</comment>
                            <comment id="14019948" author="hudson" created="Fri, 6 Jun 2014 16:44:37 +0100"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.7 #28 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.7/28/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.7/28/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1325&quot; title=&quot;Move the font metadata definitions to properties&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1325&quot;&gt;TIKA-1325&lt;/a&gt; Have the TTF parser pull out a little bit more, and have it do so similar to the AFM one does, plus add some TTF tests (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1600917&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1600917&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/main/java/org/apache/tika/parser/font/AdobeFontMetricParser.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/main/java/org/apache/tika/parser/font/TrueTypeParser.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/java/org/apache/tika/parser/font/FontParsersTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14019965" author="hudson" created="Fri, 6 Jun 2014 17:03:09 +0100"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.6 #28 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.6/28/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.6/28/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1325&quot; title=&quot;Move the font metadata definitions to properties&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1325&quot;&gt;TIKA-1325&lt;/a&gt; Have the TTF parser pull out a little bit more, and have it do so similar to the AFM one does, plus add some TTF tests (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1600917&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1600917&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/main/java/org/apache/tika/parser/font/AdobeFontMetricParser.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/main/java/org/apache/tika/parser/font/TrueTypeParser.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/java/org/apache/tika/parser/font/FontParsersTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14019970" author="tallison@mitre.org" created="Fri, 6 Jun 2014 17:09:01 +0100"  >&lt;p&gt;Nick,&lt;br/&gt;
  Thank you for fixing this.  I just tried to build with both:&lt;/p&gt;

&lt;p&gt;java version &quot;1.6.0_30&quot; and &lt;br/&gt;
java version &quot;1.7.0_40&quot;&lt;/p&gt;

&lt;p&gt;on Red Hat Enterprise Linux Server release 6.5 (Santiago)&lt;/p&gt;

&lt;p&gt;I got this:&lt;br/&gt;
Failed tests:   testTTFParsing(org.apache.tika.parser.font.FontParsersTest): expected:&amp;lt;1904-01-01T0&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;:00:00Z&amp;gt; but was:&amp;lt;1904-01-01T0&lt;span class=&quot;error&quot;&gt;&amp;#91;5&amp;#93;&lt;/span&gt;:00:00Z&amp;gt;&lt;/p&gt;

&lt;p&gt;Looks about the same amount as our time zone differences with BST? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14019980" author="gagravarr" created="Fri, 6 Jun 2014 17:14:38 +0100"  >&lt;p&gt;I didn&apos;t change the date parts, I just added a test which touched them...&lt;/p&gt;

&lt;p&gt;We currently fetch a Date object from FontBox, then pass that into the Tika Metadata for an internalDate property&lt;/p&gt;

&lt;p&gt;Any chance you could step into the code in your &quot;non standard&quot; timezone, and see if you can work out if it&apos;s a problem with FontBox, or a problem with how we&apos;re using the date that fontbox gives us?&lt;/p&gt;</comment>
                            <comment id="14019985" author="tallison@mitre.org" created="Fri, 6 Jun 2014 17:16:01 +0100"  >&lt;p&gt;Will do.&lt;/p&gt;</comment>
                            <comment id="14020025" author="tallison@mitre.org" created="Fri, 6 Jun 2014 17:46:48 +0100"  >&lt;p&gt;Looks like Fontbox/TTFDataStream isn&apos;t setting a timezone, so it defaults to &quot;default&quot; timezone.  My nonstandard default is different from your standard default. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    /**
     * Read an eight &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; international date.
     * 
     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; An signed &lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt;.
     * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException If there is an error reading the data.
     */
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Calendar readInternationalDate() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
    {
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; secondsSince1904 = readLong();
        GregorianCalendar cal = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GregorianCalendar(1904, 0, 1);
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; millisFor1904 = cal.getTimeInMillis();
        millisFor1904 += (secondsSince1904 * 1000);
        cal.setTimeInMillis(millisFor1904);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; cal;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In Tika&apos;s DateUtils, we specify UTC:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; formatDate(Date date) {
        Calendar calendar = GregorianCalendar.getInstance(UTC, Locale.US);
        calendar.setTime(date);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Should we comment out:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;1904-01-01T00:00:00Z&quot;&lt;/span&gt;,   metadata.get(Metadata.CREATION_DATE));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14020116" author="gagravarr" created="Fri, 6 Jun 2014 18:42:36 +0100"  >&lt;p&gt;I&apos;d prefer not to comment out the test, as I think it is good to check we&apos;re getting back what&apos;s in the file. I&apos;d rather we fixed the test to pass everywhere!&lt;/p&gt;

&lt;p&gt;Any chance you could search through the list archives and/or svn, and see what we&apos;ve done elsewhere when it comes to testing date times coming from files that don&apos;t store timezone information?&lt;/p&gt;</comment>
                            <comment id="14020261" author="tallison@mitre.org" created="Fri, 6 Jun 2014 20:16:46 +0100"  >&lt;p&gt;More code than I&apos;d like...&lt;/p&gt;

&lt;p&gt;Let me know if this works in a standard timezone. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14025187" author="gagravarr" created="Mon, 9 Jun 2014 14:37:17 +0100"  >&lt;p&gt;I couldn&apos;t help but think there ought to be a better way to handle this...&lt;/p&gt;

&lt;p&gt;Checking some of the exif related tests, they do something a little more succinct with a GregorianCalendar instance&lt;/p&gt;

&lt;p&gt;However, I also found in the TestMetadata class the test testGetSetDateUnspecifiedTimezone, which seems to suggest that the parser isn&apos;t supplying the date quite correctly as there shouldn&apos;t be a Z timezone qualifier on it when the format doesn&apos;t start with a timezone. I&apos;ll investigate...&lt;/p&gt;</comment>
                            <comment id="14025196" author="tallison@mitre.org" created="Mon, 9 Jun 2014 14:48:42 +0100"  >&lt;p&gt;Agreed and agreed.  Thank you.  It looks like PDFBox-2122 will set TimeZone to UTC soon.  Both the Apple &lt;a href=&quot;https://www.google.com/url?sa=t&amp;amp;rct=j&amp;amp;q=&amp;amp;esrc=s&amp;amp;frm=1&amp;amp;source=web&amp;amp;cd=2&amp;amp;cad=rja&amp;amp;uact=8&amp;amp;ved=0CCwQFjAB&amp;amp;url=https%3A%2F%2Fdeveloper.apple.com%2Ffonts%2FTTRefMan%2FRM06%2FChap6.html&amp;amp;ei=JbuVU56IDKrgsAT0roDQBQ&amp;amp;usg=AFQjCNF8E9E2b8EkUItZYKvXZHPZ7A_FXw&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;apple &lt;/a&gt; and Microsoft  [ microsoft | &lt;a href=&quot;http://www.google.com/url?sa=t&amp;amp;rct=j&amp;amp;q=&amp;amp;esrc=s&amp;amp;frm=1&amp;amp;source=web&amp;amp;cd=1&amp;amp;cad=rja&amp;amp;uact=8&amp;amp;ved=0CCAQFjAA&amp;amp;url=http%3A%2F%2Fwww.microsoft.com%2Ftypography%2Ftt%2Fttf_spec%2Fttch02.doc&amp;amp;ei=FbqVU4_rE5S-sQTytYCYBw&amp;amp;usg=AFQjCNEQzC7L5oC8uFzWKFwHM5r0hJNHnw&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.google.com/url?sa=t&amp;amp;rct=j&amp;amp;q=&amp;amp;esrc=s&amp;amp;frm=1&amp;amp;source=web&amp;amp;cd=1&amp;amp;cad=rja&amp;amp;uact=8&amp;amp;ved=0CCAQFjAA&amp;amp;url=http%3A%2F%2Fwww.microsoft.com%2Ftypography%2Ftt%2Fttf_spec%2Fttch02.doc&amp;amp;ei=FbqVU4_rE5S-sQTytYCYBw&amp;amp;usg=AFQjCNEQzC7L5oC8uFzWKFwHM5r0hJNHnw&lt;/a&gt;] specs don&apos;t specify UTC, but I&apos;d imagine that is what is meant...but my imagination is not something to code from. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14025202" author="gagravarr" created="Mon, 9 Jun 2014 14:58:58 +0100"  >&lt;p&gt;I hope that the change in r1601385 has solved it - I&apos;ve added support for setting a Metadata date object from a Calendar (previously only a Date), which includes timezone shuffling as appropriate&lt;/p&gt;</comment>
                            <comment id="14025205" author="tilman" created="Mon, 9 Jun 2014 15:02:52 +0100"  >&lt;p&gt;It is &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2122&quot; title=&quot;FontBox&amp;#39;s TTFDataStream doesn&amp;#39;t set timezone in readInternationalDate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2122&quot;&gt;&lt;del&gt;PDFBOX-2122&lt;/del&gt;&lt;/a&gt;, and I can do the change described there anytime, but I need a test. I&apos;ll be awake for at least 6 hours from now on and be at or near my computer. I&apos;d do the change only if one of you people can test this quickly so I can revert this quickly if I&apos;m wrong.&lt;/p&gt;</comment>
                            <comment id="14025251" author="hudson" created="Mon, 9 Jun 2014 16:00:40 +0100"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.7 #33 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.7/33/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.7/33/&lt;/a&gt;)&lt;br/&gt;
Provide explicit DateUtil support for formatting Dates in an unknown timezone, matching what TestMetadata checks detail, and allow for setting a Metadata date value from a Calendar. Finally, use this for the TTF dates, to hopefully solve the &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1325&quot; title=&quot;Move the font metadata definitions to properties&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1325&quot;&gt;TIKA-1325&lt;/a&gt; test problem (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1601385&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1601385&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-core/src/main/java/org/apache/tika/metadata/Metadata.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-core/src/main/java/org/apache/tika/utils/DateUtils.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-core/src/test/java/org/apache/tika/metadata/TestMetadata.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/main/java/org/apache/tika/parser/font/TrueTypeParser.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14025262" author="hudson" created="Mon, 9 Jun 2014 16:11:10 +0100"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.6 #33 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.6/33/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.6/33/&lt;/a&gt;)&lt;br/&gt;
Provide explicit DateUtil support for formatting Dates in an unknown timezone, matching what TestMetadata checks detail, and allow for setting a Metadata date value from a Calendar. Finally, use this for the TTF dates, to hopefully solve the &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1325&quot; title=&quot;Move the font metadata definitions to properties&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1325&quot;&gt;TIKA-1325&lt;/a&gt; test problem (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1601385&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1601385&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-core/src/main/java/org/apache/tika/metadata/Metadata.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-core/src/main/java/org/apache/tika/utils/DateUtils.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-core/src/test/java/org/apache/tika/metadata/TestMetadata.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/main/java/org/apache/tika/parser/font/TrueTypeParser.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14025287" author="tallison@mitre.org" created="Mon, 9 Jun 2014 16:26:55 +0100"  >&lt;p&gt;Doh!  Same issue for those of us in non-standard land. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Failed tests:   testTTFParsing(org.apache.tika.parser.font.FontParsersTest): expected:&amp;lt;1904-01-01T0&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;:00:00Z&amp;gt; but was:&amp;lt;1904-01-01T0&lt;span class=&quot;error&quot;&gt;&amp;#91;5&amp;#93;&lt;/span&gt;:00:00Z&amp;gt;&lt;/p&gt;

&lt;p&gt;As of now, FontBox is setting the Calendar to my default timezone:&lt;br/&gt;
1904-01-01T00:00:00 (EDT)&lt;/p&gt;

&lt;p&gt;When setTimeZone(UTC) in formatDate is called, this converts the calendar to UTC and the value is now: 1904-01-01T05:00:00Z &lt;/p&gt;

&lt;p&gt;I like the addition of formatDate(Calendar ...), and I like that it converts/normalizes to UTC.&lt;/p&gt;

&lt;p&gt;For this one test case, though, I think we need to add some modifications to the test case until &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2122&quot; title=&quot;FontBox&amp;#39;s TTFDataStream doesn&amp;#39;t set timezone in readInternationalDate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2122&quot;&gt;&lt;del&gt;PDFBOX-2122&lt;/del&gt;&lt;/a&gt; is fixed.  One simple thing we could do (given that we know the source of the issue) is to set the default time zone to UTC before parser.parse:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
         &lt;span class=&quot;code-comment&quot;&gt;//until PDFBOX-2122 is fixed, we need to set a common &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
&lt;/span&gt;         &lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the sake of &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; test.
&lt;/span&gt;        TimeZone defaultTimeZone = TimeZone.getDefault();
        TimeZone.setDefault(TimeZone.getTimeZone(&lt;span class=&quot;code-quote&quot;&gt;&quot;UTC&quot;&lt;/span&gt;));

        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            parser.parse(stream, handler, metadata, context);
        } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
            stream.close();
        }
        TimeZone.setDefault(defaultTimeZone);


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14025293" author="gagravarr" created="Mon, 9 Jun 2014 16:32:06 +0100"  >&lt;p&gt;Setting the Timezone in the test for now would work for me, are you happy to put that in and remove the commenting-out of the date lines that I&apos;ve just added?&lt;/p&gt;</comment>
                            <comment id="14025305" author="hudson" created="Mon, 9 Jun 2014 16:45:55 +0100"  >&lt;p&gt;UNSTABLE: Integrated in tika-trunk-jdk1.7 #34 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.7/34/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.7/34/&lt;/a&gt;)&lt;br/&gt;
Comment out the date related tests for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1325&quot; title=&quot;Move the font metadata definitions to properties&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1325&quot;&gt;TIKA-1325&lt;/a&gt;, to avoid problems with timezone matching in dates while we await a PDFBox fix (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1601407&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1601407&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-core/src/main/java/org/apache/tika/utils/DateUtils.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/java/org/apache/tika/parser/font/FontParsersTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14025309" author="tallison@mitre.org" created="Mon, 9 Jun 2014 17:00:22 +0100"  >&lt;p&gt;Happy to do so.  I can&apos;t get a clean build, though because of something going on in tika bundle:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running org.apache.tika.bundle.BundleIT
54 [main] INFO org.ops4j.pax.exam.spi.DefaultExamSystem - Pax Exam System (Version: 2.2.0) created.
Jun 09, 2014 11:56:56 AM org.ops4j.pax.url.mvn.internal.AetherBasedResolver resolve
INFO: Resolved (org.junit:com.springsource.org.junit:jar:4.4.0) as .....m2/repository/org/junit/com.springsource.org.junit/4.4.0/com.springsource.org.junit-4.4.0.jar
ERROR: Bundle org.apache.tika.bundle [7] Error starting file:.../tika-bundle/target/test-bundles/tika-bundle.jar (org.osgi.framework.BundleException: Unresolved constraint in bundle org.apache.tika.bundle [7]: Unable to resolve 7.0: missing requirement [7.0] osgi.wiring.package; (osgi.wiring.package=net.jcip.annotations))
org.osgi.framework.BundleException: Unresolved constraint in bundle org.apache.tika.bundle [7]: Unable to resolve 7.0: missing requirement [7.0] osgi.wiring.package; (osgi.wiring.package=net.jcip.annotations)
        at org.apache.felix.framework.Felix.resolveBundleRevision(Felix.java:3818)
        at org.apache.felix.framework.Felix.startBundle(Felix.java:1868)
        at org.apache.felix.framework.Felix.setActiveStartLevel(Felix.java:1191)
        at org.apache.felix.framework.FrameworkStartLevelImpl.run(FrameworkStartLevelImpl.java:295)
        at java.lang.Thread.run(Thread.java:724)
1445 [main] ERROR org.ops4j.pax.exam.junit.JUnit4TestRunner - Exception
org.ops4j.pax.exam.TestContainerException: java.lang.reflect.InvocationTargetException
        at org.ops4j.pax.exam.raw.extender.intern.ProbeInvokerImpl.injectContextAndInvoke(ProbeInvokerImpl.java:118)
        at org.ops4j.pax.exam.raw.extender.intern.ProbeInvokerImpl.findAndInvoke(ProbeInvokerImpl.java:71)
        at org.ops4j.pax.exam.raw.extender.intern.ProbeInvokerImpl.call(ProbeInvokerImpl.java:58)
        at org.ops4j.pax.exam.nat.internal.NativeTestContainer.call(NativeTestContainer.java:83)
        at org.ops4j.pax.exam.spi.reactors.EagerSingleStagedReactor.invoke(EagerSingleStagedReactor.java:85)
        at org.ops4j.pax.exam.junit.JUnit4TestRunner$2.evaluate(JUnit4TestRunner.java:259)
        at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
        at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
        at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
        at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
        at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
        at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
        at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
        at org.ops4j.pax.exam.junit.JUnit4TestRunner.run(JUnit4TestRunner.java:86)
        at org.apache.maven.surefire.junit4.JUnit4TestSet.execute(JUnit4TestSet.java:53)
        at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:123)
        at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:104)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:606)
        at org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:164)
        at org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:110)
        at org.apache.maven.surefire.booter.SurefireStarter.invokeProvider(SurefireStarter.java:175)
        at org.apache.maven.surefire.booter.SurefireStarter.runSuitesInProcessWhenForked(SurefireStarter.java:107)
        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:68)
Caused by: java.lang.reflect.InvocationTargetException
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:606)
        at org.ops4j.pax.exam.raw.extender.intern.ProbeInvokerImpl.injectContextAndInvoke(ProbeInvokerImpl.java:112)
        ... 27 more
Caused by: java.lang.AssertionError: Bundle not activated expected:&amp;lt;32&amp;gt; but was:&amp;lt;2&amp;gt;
        at org.junit.Assert.fail(Assert.java:74)
        at org.junit.Assert.failNotEquals(Assert.java:448)
        at org.junit.Assert.assertEquals(Assert.java:102)
        at org.junit.Assert.assertEquals(Assert.java:323)
        at org.apache.tika.bundle.BundleIT.testBundleLoaded(BundleIT.java:78)
        ... 32 more
Tests run: 6, Failures: 1, Errors: 0, Skipped: 3, Time elapsed: 1.776 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14025310" author="hudson" created="Mon, 9 Jun 2014 17:04:31 +0100"  >&lt;p&gt;UNSTABLE: Integrated in tika-trunk-jdk1.6 #34 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.6/34/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.6/34/&lt;/a&gt;)&lt;br/&gt;
Comment out the date related tests for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1325&quot; title=&quot;Move the font metadata definitions to properties&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1325&quot;&gt;TIKA-1325&lt;/a&gt;, to avoid problems with timezone matching in dates while we await a PDFBox fix (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1601407&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1601407&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-core/src/main/java/org/apache/tika/utils/DateUtils.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/java/org/apache/tika/parser/font/FontParsersTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14025316" author="tallison@mitre.org" created="Mon, 9 Jun 2014 17:10:34 +0100"  >&lt;p&gt;Sorry, didn&apos;t mean to pile on with Hudson!  Let me know when the bundle stuff is fixed, and I&apos;ll commit the few modifications to FontParsersTest.  Thank you!&lt;/p&gt;</comment>
                            <comment id="14025324" author="tilman" created="Mon, 9 Jun 2014 17:14:30 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2122&quot; title=&quot;FontBox&amp;#39;s TTFDataStream doesn&amp;#39;t set timezone in readInternationalDate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2122&quot;&gt;&lt;del&gt;PDFBOX-2122&lt;/del&gt;&lt;/a&gt; has been fixed.&lt;/p&gt;</comment>
                            <comment id="14025375" author="tallison@mitre.org" created="Mon, 9 Jun 2014 18:14:56 +0100"  >&lt;p&gt;Default timezone is now set in the test case as of r1601444.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gagravarr&quot; class=&quot;user-hover&quot; rel=&quot;gagravarr&quot;&gt;Nick Burch&lt;/a&gt;, again, my apologies for piling on.  Thank you for your help with this!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;Tilman Hausherr&lt;/a&gt;, thank you!&lt;/p&gt;</comment>
                            <comment id="14025434" author="hudson" created="Mon, 9 Jun 2014 18:47:10 +0100"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.7 #36 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.7/36/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.7/36/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1325&quot; title=&quot;Move the font metadata definitions to properties&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1325&quot;&gt;TIKA-1325&lt;/a&gt;: small workaround until we can integrate &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2122&quot; title=&quot;FontBox&amp;#39;s TTFDataStream doesn&amp;#39;t set timezone in readInternationalDate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2122&quot;&gt;&lt;del&gt;PDFBOX-2122&lt;/del&gt;&lt;/a&gt;. Default timezone is now set and then unset for ttf test in FontParsers test. (tallison: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1601444&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1601444&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/java/org/apache/tika/parser/font/FontParsersTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14025462" author="hudson" created="Mon, 9 Jun 2014 19:04:31 +0100"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.6 #36 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.6/36/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.6/36/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1325&quot; title=&quot;Move the font metadata definitions to properties&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1325&quot;&gt;TIKA-1325&lt;/a&gt;: small workaround until we can integrate &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2122&quot; title=&quot;FontBox&amp;#39;s TTFDataStream doesn&amp;#39;t set timezone in readInternationalDate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2122&quot;&gt;&lt;del&gt;PDFBOX-2122&lt;/del&gt;&lt;/a&gt;. Default timezone is now set and then unset for ttf test in FontParsers test. (tallison: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1601444&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1601444&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/java/org/apache/tika/parser/font/FontParsersTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14372076" author="tpalsulich" created="Fri, 20 Mar 2015 20:51:43 +0000"  >&lt;p&gt;Does anyone know of an external standard for these metadata keys? Or, can we close this off?&lt;/p&gt;</comment>
                            <comment id="14374985" author="gagravarr" created="Sun, 22 Mar 2015 14:56:32 +0000"  >&lt;p&gt;I think we either need to find an external standard, or invent our own. Currently I think we&apos;re still on plain strings, when we really want properties (external or ours)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12718886">PDFBOX-2122</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12648701" name="TIKA-1325_TimeZone.patch" size="2301" author="tallison@mitre.org" created="Fri, 6 Jun 2014 20:16:45 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 6 Jun 2014 12:48:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>397017</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzq7gv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>397135</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>