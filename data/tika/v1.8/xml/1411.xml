<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:37:03 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-1411/TIKA-1411.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-1411] Temporary 7z file leak</title>
                <link>https://issues.apache.org/jira/browse/TIKA-1411</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;When working with a 7z file, the created TikaInputStream is not closed inside PackageParser. Also, it is prematurely wrapping the stream into a CloseShieldInputStream, so it will never be a TikaInputStream and always wrapped into a BufferedInputStream. Proposed change:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void parse(
            InputStream stream, ContentHandler handler,
            Metadata metadata, ParseContext context)
            &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, SAXException, TikaException {
       
        &lt;span class=&quot;code-comment&quot;&gt;// Ensure that the stream supports the mark feature
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (! TikaInputStream.isTikaInputStream(stream))
            stream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedInputStream(stream);
        
        
        TemporaryResources tmp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TemporaryResources();
        ArchiveInputStream ais = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            ArchiveStreamFactory factory = context.get(ArchiveStreamFactory.class, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArchiveStreamFactory());
            &lt;span class=&quot;code-comment&quot;&gt;// At the end we want to close the archive stream to release
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// any associated resources, but the underlying document stream
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// should not be closed
&lt;/span&gt;            ais = factory.createArchiveInputStream(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CloseShieldInputStream(stream));
            
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (StreamingNotSupportedException sne) {
            &lt;span class=&quot;code-comment&quot;&gt;// Most archive formats work on streams, but a few need files
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sne.getFormat().equals(ArchiveStreamFactory.SEVEN_Z)) {
                &lt;span class=&quot;code-comment&quot;&gt;// Rework as a file, and wrap
&lt;/span&gt;                stream.reset();
                TikaInputStream tstream = TikaInputStream.get(stream, tmp);
                
                &lt;span class=&quot;code-comment&quot;&gt;// Pending a fix &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; COMPRESS-269, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; bit is a little nasty
&lt;/span&gt;                ais = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SevenZWrapper(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SevenZFile(tstream.getFile()));
                
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            	tmp.close();
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TikaException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unknown non-streaming format &quot;&lt;/span&gt; + sne.getFormat(), sne);
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ArchiveException e) {
        	tmp.close();
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TikaException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to unpack document stream&quot;&lt;/span&gt;, e);
        }

        MediaType type = getMediaType(ais);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!type.equals(MediaType.OCTET_STREAM)) {
            metadata.set(CONTENT_TYPE, type.toString());
        }

        &lt;span class=&quot;code-comment&quot;&gt;// Use the delegate parser to parse the contained document
&lt;/span&gt;        EmbeddedDocumentExtractor extractor = context.get(
                EmbeddedDocumentExtractor.class,
                &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ParsingEmbeddedDocumentExtractor(context));

        XHTMLContentHandler xhtml = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; XHTMLContentHandler(handler, metadata);
        xhtml.startDocument();

        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            ArchiveEntry entry = ais.getNextEntry();
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (entry != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!entry.isDirectory()) {
                    parseEntry(ais, entry, extractor, xhtml);
                }
                entry = ais.getNextEntry();
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
            ais.close();
            tmp.close();
        }

        xhtml.endDocument();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I would be nice if &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1246&quot; title=&quot;Include LastModifiedDate in metadata of archive entries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1246&quot;&gt;&lt;del&gt;TIKA-1246&lt;/del&gt;&lt;/a&gt; (very simple) was resolved together.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12739705">TIKA-1411</key>
            <summary>Temporary 7z file leak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lfcnassif">Luis Filipe Nassif</reporter>
                        <labels>
                    </labels>
                <created>Sat, 6 Sep 2014 17:54:59 +0100</created>
                <updated>Sat, 15 Nov 2014 13:50:07 +0000</updated>
                            <resolved>Mon, 8 Sep 2014 22:59:54 +0100</resolved>
                                    <version>1.6</version>
                                    <fixVersion>1.7</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14125966" author="gagravarr" created="Mon, 8 Sep 2014 20:32:06 +0100"  >&lt;p&gt;Any chance you could produce a patch file of your proposed fix? (It&apos;s hard to work out what needs changing from the code you&apos;ve posted)&lt;/p&gt;</comment>
                            <comment id="14126047" author="lfcnassif" created="Mon, 8 Sep 2014 21:31:35 +0100"  >&lt;p&gt;Patch attached.&lt;/p&gt;</comment>
                            <comment id="14126184" author="gagravarr" created="Mon, 8 Sep 2014 22:59:54 +0100"  >&lt;p&gt;Thanks ! Applied in r1623593.&lt;/p&gt;</comment>
                            <comment id="14126241" author="hudson" created="Mon, 8 Sep 2014 23:49:34 +0100"  >&lt;p&gt;FAILURE: Integrated in tika-trunk-jdk1.7 #201 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.7/201/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.7/201/&lt;/a&gt;)&lt;br/&gt;
Patch from Luis Filipe Nassif from &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1411&quot; title=&quot;Temporary 7z file leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1411&quot;&gt;&lt;del&gt;TIKA-1411&lt;/del&gt;&lt;/a&gt; - Avoid 7z file leak through use of TemporaryResources (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1623593&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1623593&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/main/java/org/apache/tika/parser/pkg/PackageParser.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14126273" author="hudson" created="Tue, 9 Sep 2014 00:12:07 +0100"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.6 #179 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.6/179/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.6/179/&lt;/a&gt;)&lt;br/&gt;
Patch from Luis Filipe Nassif from &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1411&quot; title=&quot;Temporary 7z file leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1411&quot;&gt;&lt;del&gt;TIKA-1411&lt;/del&gt;&lt;/a&gt; - Avoid 7z file leak through use of TemporaryResources (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1623593&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1623593&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/main/java/org/apache/tika/parser/pkg/PackageParser.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12755056">TIKA-1474</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12667236" name="TIKA-1411.patch" size="3659" author="lfcnassif" created="Mon, 8 Sep 2014 21:31:35 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 8 Sep 2014 19:32:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hztmiv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>