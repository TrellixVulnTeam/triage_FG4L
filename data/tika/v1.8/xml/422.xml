<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:37:33 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-422/TIKA-422.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-422] Wrong charset conversion in some RTF documents.</title>
                <link>https://issues.apache.org/jira/browse/TIKA-422</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;RTF parser uses javax.swing.text.rtf, but it sucks.&lt;/p&gt;

&lt;p&gt;It doesn&apos;t support &apos;\ansicpg&apos; tag (cite from RTF file format specification:&lt;br/&gt;
&quot;This keyword represents the default ANSI code page used to perform the Unicode to ANSI conversion when writing RTF text&quot;).&lt;/p&gt;

&lt;p&gt;Unfortunately Windows WordPad saves nonascii characters using \ansicpg instead of supported by javax.swing.text.rtf unicode characters.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12464120">TIKA-422</key>
            <summary>Wrong charset conversion in some RTF documents.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="bartex">Piotr Bartosiewicz</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 May 2010 09:52:15 +0100</created>
                <updated>Thu, 2 Aug 2012 10:33:38 +0100</updated>
                            <resolved>Tue, 1 Feb 2011 16:16:42 +0000</resolved>
                                    <version>0.7</version>
                                    <fixVersion>0.9</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>4</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="12865705" author="bartex" created="Mon, 10 May 2010 09:59:22 +0100"  >&lt;p&gt;Example of problematic file attached. Tika should extract &lt;br/&gt;
&quot;za&#380;&#243;&#322;&#263; g&#281;&#347;l&#261; ja&#378;&#324; ZA&#379;&#211;&#321;&#262; G&#280;&#346;L&#260; JA&#377;&#323;&quot; but I got&lt;br/&gt;
&quot;za &#191; &#243; &#179; &#230; g &#234; &#347; l &#185; ja &#378; &#241; ZA &#175; &#211; &#163; &#198; G &#202; &#346; L &#165; JA &#377; &#209;&quot;&lt;/p&gt;</comment>
                            <comment id="12866559" author="jukkaz" created="Wed, 12 May 2010 14:05:09 +0100"  >&lt;p&gt;Does anyone know an alternative RTF parser in Java with a friendly license &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;? It looks like there&apos;s little we can do about this as long as we&apos;re stuck with the Swing RTF parser.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://www.apache.org/legal/resolved.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.apache.org/legal/resolved.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12874025" author="leszekp" created="Tue, 1 Jun 2010 15:19:50 +0100"  >&lt;p&gt;Look RTFParser.jj at &lt;a href=&quot;http://www.koders.com/noncode/fid69741D7970C9D0BA22243871D7E5682434A2A19E.aspx&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.koders.com/noncode/fid69741D7970C9D0BA22243871D7E5682434A2A19E.aspx&lt;/a&gt; - seems to be Apache licensed. Also RTFPlainTextExtractor.java is Apache licensed but RTFParserDelegate.java is LGPL (a bit strange)??? However it is rather a simple interface which may be rewritten.&lt;/p&gt;

&lt;p&gt;After some hacking I was able to try this parser. It correctly extracts Polish diactric characters. It also inserts extra spaces into text in table cells (see &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-392&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TIKA-392&lt;/a&gt;)&lt;br/&gt;
But it failed on some big rtf file claiming that it is syntactically incorrect. Anyway it seems much better for non-english texts.&lt;/p&gt;</comment>
                            <comment id="12919550" author="shinsuke" created="Sun, 10 Oct 2010 02:11:30 +0100"  >&lt;p&gt;Attached a patch to convert \&apos;XX into \uXXXX before processing it by RTFEditorKit.&lt;/p&gt;

&lt;p&gt;RTFEditorKit supports unicode character only. &lt;br/&gt;
So, I could not get a correct text from Japanese RTF file. &lt;br/&gt;
It works by this fix.&lt;/p&gt;</comment>
                            <comment id="12920362" author="cristian.vat" created="Tue, 12 Oct 2010 22:41:29 +0100"  >&lt;p&gt;Attached updated version of the patch.&lt;/p&gt;

&lt;p&gt;Changed isUnicode to include characters not from 255 but from 127 upwards. RTF is 7-bit.&lt;/p&gt;</comment>
                            <comment id="12920365" author="cristian.vat" created="Tue, 12 Oct 2010 22:46:43 +0100"  >&lt;p&gt;Clarification:&lt;/p&gt;

&lt;p&gt;The previous patch added some extra spaces after/between special (encoded) characters such that &quot;&#220;bersicht&quot; got transformed into &quot;&#220; bersicht&quot;&lt;br/&gt;
This is because some characters are encoded using the hex notation &quot;\&apos;hh&quot; so they should not have spaces after the text run, but they are lower than 255.&lt;br/&gt;
As stated in the specification, RTF is 7-bit, so actually everything above 127 will be encoded as \&apos;hh in the file.&lt;/p&gt;

&lt;p&gt;Also, regarding the charset conversion:&lt;/p&gt;

&lt;p&gt;I tried with some documents in Czech with which I had problems before and now they are correctly extracted if I test using a RTF file created using WordPad.&lt;br/&gt;
However, with RTF files output from Microsoft Word there are still some issues. Hope to investigate more tomorrow.&lt;/p&gt;</comment>
                            <comment id="12920410" author="cristian.vat" created="Wed, 13 Oct 2010 01:52:43 +0100"  >&lt;p&gt;Attached new patch.&lt;/p&gt;

&lt;p&gt;Added test for checking space after umlaut/encoded character issue.&lt;br/&gt;
Added test for checking extraction of Czech characters from an RTF file created from WordPad. (text sample from Czech wikipedia)&lt;/p&gt;

&lt;p&gt;Also added a test with same conditions and text, but with RTF file exported from Word2010.&lt;/p&gt;

&lt;p&gt;Extraction changes:&lt;/p&gt;

&lt;p&gt;Added a special condition when parsing the font table, to not stop at spaces if we detect we are in a font definition. That&apos;s basically done by checking if we have a font-family in the previous string.&lt;br/&gt;
From what I saw this fixes some problems I had with files exported from Word2007 until Word2010, where the font table definitions were expanded/complicated.&lt;/p&gt;</comment>
                            <comment id="12921078" author="cristian.vat" created="Thu, 14 Oct 2010 19:53:52 +0100"  >&lt;p&gt;Attached new patch.&lt;/p&gt;

&lt;p&gt;Previous patch broke &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-392&quot; title=&quot;RTF parser smashes words together in subsequent table cells&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-392&quot;&gt;&lt;del&gt;TIKA-392&lt;/del&gt;&lt;/a&gt; when previous cell ended in an encoded character.&lt;br/&gt;
Fixed by adding extra spaces at the end of each cell. This may result in extra spaces, but I found no other way to do it. And at least for some use-cases the spaces are not important.&lt;/p&gt;

&lt;p&gt;Also added a test to know if it breaks again.&lt;br/&gt;
Test checks if all cells in a table are in correct order and have spaces between them. There are also cells with encoded characters.&lt;/p&gt;</comment>
                            <comment id="12921110" author="cristian.vat" created="Thu, 14 Oct 2010 21:34:14 +0100"  >&lt;p&gt;Anyone mind looking over the patch so far?&lt;br/&gt;
It seems to solve most problems I encountered with encodings in RTF files.&lt;/p&gt;</comment>
                            <comment id="12923460" author="alless" created="Thu, 21 Oct 2010 15:36:51 +0100"  >&lt;p&gt;Thanks a lot for the patch. It works fine for the most of documents. &lt;br/&gt;
But it seems to fail parsing files that contain curly brackets inside (see attached test_with_curly_brackes.rtf for example). &lt;br/&gt;
Not patched tika read this file without errors.&lt;/p&gt;</comment>
                            <comment id="12933340" author="bartex" created="Thu, 18 Nov 2010 07:41:32 +0000"  >&lt;p&gt;Patch looks OK except one thing. Patched rtf woks much slower than the original because for every document the temporary file is created. The stream should be stored in memory for a small documents - see how it is done in tika.utils.RereadableInputStream.&lt;/p&gt;</comment>
                            <comment id="12973170" author="cristian.vat" created="Mon, 20 Dec 2010 10:58:43 +0000"  >&lt;p&gt;New patch.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Fixed curly brackets exception.&lt;/li&gt;
	&lt;li&gt;Added handling also for &quot;\afN&quot; font setting instead of only &quot;\fN&quot;&lt;/li&gt;
	&lt;li&gt;Reset last font when entering colortbl, fixed a bug with some documents&lt;/li&gt;
	&lt;li&gt;Handled \deffN default font definition&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All tests pass and also some special documents I had look ok.&lt;br/&gt;
Using memory for small files would be good, but not needed in my use-case.&lt;/p&gt;</comment>
                            <comment id="12989267" author="jukkaz" created="Tue, 1 Feb 2011 16:16:42 +0000"  >&lt;p&gt;Nice work, thanks! And sorry for the delay in responding. I committed the patch in revision 1066081.&lt;/p&gt;</comment>
                            <comment id="13085013" author="mikemccand" created="Mon, 15 Aug 2011 11:13:35 +0100"  >&lt;p&gt;Reading through this, I noticed that we didn&apos;t add a test case from the test_with_curly_brackets.rtf... attached patch adds it.  The only oddity is that the original assert I added (commented out) fails, because we apparently add an extra space around the braces.&lt;/p&gt;</comment>
                            <comment id="13086404" author="chrismattmann" created="Wed, 17 Aug 2011 16:48:10 +0100"  >&lt;p&gt;Committed Mike&apos;s patch in r1158779. Thanks, Mike!&lt;/p&gt;</comment>
                            <comment id="13086428" author="mikemccand" created="Wed, 17 Aug 2011 17:25:04 +0100"  >&lt;p&gt;Thanks Chris!&lt;/p&gt;

&lt;p&gt;It was Alex Skochin that created this test originally (test_with_curly_brackets.rtf, above); I just noticed that his example was never committed so I made a new patch for it...&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12466621" name="RTFParser.patch" size="66060" author="cristian.vat" created="Mon, 20 Dec 2010 10:58:43 +0000"/>
                            <attachment id="12457180" name="RTFParser.patch" size="64670" author="cristian.vat" created="Thu, 14 Oct 2010 19:53:52 +0100"/>
                            <attachment id="12457032" name="RTFParser.patch" size="61826" author="cristian.vat" created="Wed, 13 Oct 2010 01:52:43 +0100"/>
                            <attachment id="12457015" name="RTFParser.patch" size="21218" author="cristian.vat" created="Tue, 12 Oct 2010 22:41:29 +0100"/>
                            <attachment id="12456785" name="RTFParser.patch" size="21218" author="shinsuke" created="Sun, 10 Oct 2010 02:11:30 +0100"/>
                            <attachment id="12490419" name="TIKA-422.patch" size="10273" author="mikemccand" created="Mon, 15 Aug 2011 11:13:34 +0100"/>
                            <attachment id="12444101" name="test-windows-1250.rtf" size="278" author="bartex" created="Mon, 10 May 2010 09:59:22 +0100"/>
                            <attachment id="12457761" name="test_with_curly_brackets.rtf" size="8857" author="alless" created="Thu, 21 Oct 2010 15:36:51 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 12 May 2010 13:05:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4439</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx3vr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16948</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>