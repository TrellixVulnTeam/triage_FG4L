<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:34:11 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-830/TIKA-830.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-830] Tika.parseToString() causes ForkParser to try to serialize itself</title>
                <link>https://issues.apache.org/jira/browse/TIKA-830</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description></description>
                <environment></environment>
        <key id="12536274">TIKA-830</key>
            <summary>Tika.parseToString() causes ForkParser to try to serialize itself</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lacostej">Jerome Lacoste</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Dec 2011 11:42:10 +0000</created>
                <updated>Wed, 16 May 2012 22:47:31 +0100</updated>
                            <resolved>Wed, 16 May 2012 22:47:30 +0100</resolved>
                                    <version>1.0</version>
                                    <fixVersion>1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13175400" author="lacostej" created="Fri, 23 Dec 2011 12:27:42 +0000"  >&lt;p&gt;The fix, and a refactor&lt;/p&gt;</comment>
                            <comment id="13175401" author="lacostej" created="Fri, 23 Dec 2011 12:28:33 +0000"  >&lt;p&gt;Again the patches, with the proper license grant,&lt;/p&gt;</comment>
                            <comment id="13175622" author="jukkaz" created="Fri, 23 Dec 2011 23:45:19 +0000"  >&lt;p&gt;I&apos;m not sure if we should try to support passing a ForkParser as an argument to the Tika constructor.&lt;br/&gt;
The ForkParser expects the &quot;real&quot; parser instance to be passed in the ParseContext, which isn&apos;t currently supported by the Tika facade.&lt;/p&gt;

&lt;p&gt;Instead of adding workarounds like this, I&apos;d rather consider whether we want to extend the Tika facade to explicitly support forked parsing as a special mode. Personally I&apos;d rather recommend people who need the ForkParser functionality to use the class directly instead of through the Tika facade (that&apos;s intended to be just a simple entry point for basic Tika functionality).&lt;/p&gt;</comment>
                            <comment id="13175882" author="gagravarr" created="Mon, 26 Dec 2011 04:07:38 +0000"  >&lt;p&gt;If we&apos;re not going to support the ForkParser like this, maybe we should add a check with a helpful error message? (rather than breaking in a slightly obscure manner as now)&lt;/p&gt;</comment>
                            <comment id="13176596" author="lacostej" created="Wed, 28 Dec 2011 10:39:25 +0000"  >&lt;p&gt;From a desing PoV I find it strange that a special parser isn&apos;t supported. In order to write integration tests for either fork parsing or non fork parsing I have to duplicate a big part of the Tika class.&lt;/p&gt;

&lt;p&gt;Another fix I had in mind was to modify Tika#parseToString() to do something like&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  context.set(Parser.class, parser.getUnderlyingParser();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;with parser.getUnderlyingParser() returning this in AbstractParser, but overriden to return the underlying parser in ForkParser.&lt;/p&gt;

&lt;p&gt;Does that make more sense than the ForkParser modifying the ParseContext ?&lt;/p&gt;</comment>
                            <comment id="13176702" author="jukkaz" created="Wed, 28 Dec 2011 16:51:57 +0000"  >&lt;p&gt;The problem here is the basic assumption that the Tika facade class makes about how the configured parser will use the instance passed in the ParseContext.&lt;/p&gt;

&lt;p&gt;By default (and before we added the constructor that allows a custom parser to be given) the Tika facade will construct and use an AutoDetectParser based on all the available and/or configured format-specific parsers. Format-specific parsers that support embedded documents expect the ParseContext to contain a parser instance that they can delegate parsing tasks to, so to support parsing of embedded documents the Tika facade passes the configured parser instance through the ParseContext.&lt;/p&gt;

&lt;p&gt;The ForkParser on the other hand assumes that anything in the ParseContext is serializable so that it can be sent to the forked JVM process for use from there. Passing a ForkParser instance to the forked JVM like through the ParseContext could easily trigger a recursion of new JVM forks being created, which is why the ForkParser by design is not serializable.&lt;/p&gt;

&lt;p&gt;I agree with Nick that the resulting error message could certainly be better, but I don&apos;t it&apos;s a good idea to change the basic design of either ForkParser or the Tika facade class in this respect.&lt;/p&gt;

&lt;p&gt;If we want the Tika facade class to support forked parsing, I think it would be better to add a separate flag for that to explicitly make the facade class create and use a ForkParser instance based on the configured normal Parser instance. However, the ForkParser is a pretty complex tool that practically always needs custom configuration (java command, memory limits, class loader, etc.), which is why I don&apos;t think we should expose it through the Tika facade that&apos;s mostly designed for simpler use cases.&lt;/p&gt;

&lt;p&gt;PS. Instead of the instanceof check we now have in ForkParser (thanks for that, BTW!), it might be a better idea to check for errors from trying to serialize the ParseContext. That&apos;ll capture a muhc wider range of cases where a ForkParser instance or some other non-serializable resource is being passed to a forked JVM.&lt;/p&gt;</comment>
                            <comment id="13177021" author="gagravarr" created="Thu, 29 Dec 2011 06:36:51 +0000"  >&lt;p&gt;I think the ForkParser instanceof check is a good validation to have, with a helpful error&lt;/p&gt;

&lt;p&gt;In r1225448 I&apos;ve updated ForkClient / ForkParser to have a more helpful message if we can&apos;t serialize any of the Parser.parse arguments (eg the ParseContext), along with a unit test&lt;/p&gt;</comment>
                            <comment id="13177088" author="jukkaz" created="Thu, 29 Dec 2011 09:33:41 +0000"  >&lt;p&gt;Excellent, thanks Nick!&lt;/p&gt;</comment>
                            <comment id="13277175" author="gagravarr" created="Wed, 16 May 2012 22:47:30 +0100"  >&lt;p&gt;I believe this was fixed in Tika 1.1 so I&apos;m marking it as fixed, please re-open though if it&apos;s still an issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12508528" name="0005-TIKA-830-Tike.parseToString-caused-ForkParser-to-try.patch" size="5567" author="lacostej" created="Fri, 23 Dec 2011 12:28:33 +0000"/>
                            <attachment id="12508529" name="0006-TIKA-830-refactor-tests-for-clarity.patch" size="5287" author="lacostej" created="Fri, 23 Dec 2011 12:28:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 23 Dec 2011 23:45:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>221957</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx1dj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16542</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>