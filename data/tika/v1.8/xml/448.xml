<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:34:08 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-448/TIKA-448.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-448] Tika FLVParser hangs</title>
                <link>https://issues.apache.org/jira/browse/TIKA-448</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;I am crawling a site with Nutch and creating an index using SOLR.&lt;/p&gt;

&lt;p&gt;After happy crawling for a couple of hours, my Nutch Parse phase hangs. A thread dump shows:&lt;/p&gt;

&lt;p&gt;&quot;Thread-12&quot; prio=10 tid=0xb4974000 nid=0x1b1b runnable &lt;span class=&quot;error&quot;&gt;&amp;#91;0xb4a50000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: RUNNABLE&lt;br/&gt;
        at java.io.FilterInputStream.skip(FilterInputStream.java:125)&lt;br/&gt;
        at org.apache.tika.parser.video.FLVParser.parse(FLVParser.java:246)&lt;br/&gt;
        at org.apache.nutch.parse.tika.TikaParser.getParse(TikaParser.java:95)&lt;br/&gt;
        at org.apache.nutch.parse.ParseUtil.parse(ParseUtil.java:82)&lt;br/&gt;
        at org.apache.nutch.parse.ParseSegment.map(ParseSegment.java:85)&lt;br/&gt;
        at org.apache.nutch.parse.ParseSegment.map(ParseSegment.java:41)&lt;br/&gt;
        at org.apache.hadoop.mapred.MapRunner.run(MapRunner.java:50)&lt;br/&gt;
        at org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:358)&lt;br/&gt;
        at org.apache.hadoop.mapred.MapTask.run(MapTask.java:307)&lt;br/&gt;
        at org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:177)&lt;/p&gt;

&lt;p&gt;The only reason I see why the code might be stuck there is when skip(datalen - skiplen) returns 0 for whatever reason in org.apache.tika.parser.video.FLVParser.parse around line 246:&lt;/p&gt;

&lt;p&gt;                // Tag was not metadata, skip over data we cannot handle&lt;br/&gt;
                for (int skiplen = 0; skiplen &amp;lt; datalen&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;
{
                    long currentSkipLen = datainput.skip(datalen - skiplen);
                    skiplen += currentSkipLen;
                }

&lt;p&gt;As I don&apos;t know which FLV was downloaded that caused the problem I cannot easily create a testcase.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux JDK 1.6u13, Nutch 1.1&lt;/p&gt;</environment>
        <key id="12468178">TIKA-448</key>
            <summary>Tika FLVParser hangs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="jeroenv">Jeroen van Vianen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Jun 2010 18:23:07 +0100</created>
                <updated>Fri, 7 Oct 2011 09:53:04 +0100</updated>
                            <resolved>Fri, 7 Oct 2011 09:53:04 +0100</resolved>
                                    <version>0.7</version>
                                    <fixVersion>1.0</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12883660" author="jnioche" created="Tue, 29 Jun 2010 20:18:58 +0100"  >&lt;p&gt;I have seen similar cases with FLV when the content fetched by Nutch had been trimmed. Setting the log level to debug should give you more information about which URL is problematic.&lt;br/&gt;
One simple workaround for cases like these (apart from filtering on *.flv of course) is to use the skip record options in Hadoop &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  skipRecordsOptions=&lt;span class=&quot;code-quote&quot;&gt;&quot;-D mapred.skip.attempts.to.start.skipping=2 -D mapred.skip.map.max.skip.records=1&quot;&lt;/span&gt;
  ./nutch parse $commonOptions $skipRecordsOptions $hdfspath/segments/$SEGMENT
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;this will skip the problematic entries after a couple of retries.&lt;/p&gt;

&lt;p&gt;Of course preventing the flv parser to loop would be even better. I&apos;ll see if I can reproduce the problem later&lt;/p&gt;</comment>
                            <comment id="12883675" author="jeroenv" created="Tue, 29 Jun 2010 21:04:15 +0100"  >&lt;p&gt;I patched my tika-parsers.jar with the above patch. It at least solved my problem, but I&apos;m not sure whether this is because of the offending (corrupt?) FLV not being fetched during my current nutch run or because of the patch solving the problem.&lt;/p&gt;

&lt;p&gt;@Julien: thanks for the tip&lt;/p&gt;</comment>
                            <comment id="12883858" author="jukkaz" created="Wed, 30 Jun 2010 10:28:45 +0100"  >&lt;p&gt;The InputStream.skip() method can always return 0 if it wants, see &lt;a href=&quot;https://issues.apache.org/jira/browse/IO-203&quot; title=&quot;Add skipFully() method for InputStreams&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-203&quot;&gt;&lt;del&gt;IO-203&lt;/del&gt;&lt;/a&gt; for related discussion.&lt;/p&gt;

&lt;p&gt;It might be easiest to simply always read() the tag content into memory instead of trying to skip() it. The performance and memory overhead shouldn&apos;t be too high.&lt;/p&gt;</comment>
                            <comment id="13122630" author="jukkaz" created="Fri, 7 Oct 2011 09:53:04 +0100"  >&lt;p&gt;Fixed in revision 1179964.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12448350" name="FLVParser.patch" size="1083" author="jeroenv" created="Tue, 29 Jun 2010 21:04:15 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 29 Jun 2010 19:18:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4413</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx3q7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16923</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>