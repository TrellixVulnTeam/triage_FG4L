<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:35:07 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-736/TIKA-736.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-736] OpenOffice parser: master footer text isn&apos;t extracted</title>
                <link>https://issues.apache.org/jira/browse/TIKA-736</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;If I edit the footer text on the master slide of an OpenOffice presentation, I see that text rendered on the slide, but it&apos;s not extracted by Tika.&lt;/p&gt;

&lt;p&gt;Digging into the document, curiously the footer text is in the styles.xml, under office:master-styles -&amp;gt; style:master-page -&amp;gt; draw:frame -&amp;gt; draw:text-box -&amp;gt; text&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.  I think somehow we&apos;re not linking up each slide&apos;s master text elements to that slide, similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-712&quot; title=&quot;Master slide text isn&amp;#39;t extracted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-712&quot;&gt;TIKA-712&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12525402">TIKA-736</key>
            <summary>OpenOffice parser: master footer text isn&apos;t extracted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Sat, 1 Oct 2011 11:32:15 +0100</created>
                <updated>Tue, 17 Dec 2013 16:35:06 +0000</updated>
                            <resolved>Fri, 28 Oct 2011 19:03:41 +0100</resolved>
                                                    <fixVersion>1.0</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13118719" author="mikemccand" created="Sat, 1 Oct 2011 11:34:04 +0100"  >&lt;p&gt;Patch with failing test case.&lt;/p&gt;</comment>
                            <comment id="13118783" author="gagravarr" created="Sat, 1 Oct 2011 13:45:40 +0100"  >&lt;p&gt;It&apos;s probably not worth putting too much work into our OpenOffice parser at the moment. As soon as the ODFToolkit podling does their first incubating release, we&apos;ll switch to using a parser based on that.&lt;/p&gt;</comment>
                            <comment id="13118825" author="mikemccand" created="Sat, 1 Oct 2011 15:41:50 +0100"  >&lt;p&gt;OK that makes sense; hopefully it&apos;s not too long...&lt;/p&gt;</comment>
                            <comment id="13118828" author="gagravarr" created="Sat, 1 Oct 2011 15:57:36 +0100"  >&lt;p&gt;Looking at our current parser, we don&apos;t touch the styles part, only meta and content. I think that rather than trying to add this in, we&apos;re best off waiting (+helping!) for the first odf toolkit incubating release, then switch to a full featured parser much as we have for the POI powered ones.&lt;/p&gt;</comment>
                            <comment id="13133995" author="thetaphi" created="Mon, 24 Oct 2011 12:41:58 +0100"  >&lt;p&gt;The current ODF parser is very lightweight and memory efficient (I hope ODFToolkit uses a streaming API, too, comparable with SAX).It is very elegant, but limited. I would be against a parser like the OpenXML one that builds huge DOM/Object trees as this is also somehow a &quot;security-leak&quot;, if your parser gets a huge document that don&apos;t fits in memory and crashes you app.&lt;/p&gt;

&lt;p&gt;The current parser streams the document XMLs through the SAX API and converts it to HTML by replacing element names and doing some structural modifications (I wrote that one a few years ago and donated it to TIKA). I have no problem with nuking it once ODFToolkit is out, but please, please, please use a streaming API without large DOM/Object trees and temporary files. Optionally leave both parsers available (I would also take care of the current one).&lt;/p&gt;</comment>
                            <comment id="13134003" author="gagravarr" created="Mon, 24 Oct 2011 12:58:10 +0100"  >&lt;p&gt;Uwe - this might be best discussed on the &quot;Tika is waiting for ODFToolkit to improve ODF file format processing&quot; thread on the ODF Toolkit dev list&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/incubator-odf-dev/201110.mbox/%3CCAFJd6yTAQ=gR=Q_TGqYOrhCYjZ7EmfMzuvUXfD0ipGwAUtNh3Q@mail.gmail.com%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/incubator-odf-dev/201110.mbox/%3CCAFJd6yTAQ=gR=Q_TGqYOrhCYjZ7EmfMzuvUXfD0ipGwAUtNh3Q@mail.gmail.com%3E&lt;/a&gt;&amp;gt; - that&apos;s where you&apos;ll find people who know what ODF Toolkit can and can&apos;t do and offer!&lt;/p&gt;</comment>
                            <comment id="13135862" author="mikemccand" created="Wed, 26 Oct 2011 11:55:05 +0100"  >&lt;p&gt;This turned out to be fairly simple to fix, so I worked out a patch,&lt;br/&gt;
and I think it&apos;s worth fixing in our current ODF parser, since we&apos;re&lt;br/&gt;
not sure when we&apos;ll cutover to the ODFToolkit based solution.&lt;/p&gt;

&lt;p&gt;Basically I also recurse into styles.xml, using the content parser. It&lt;br/&gt;
doesn&apos;t seem to have the same &quot;problem&quot; as PPT/PPTX (&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-712&quot; title=&quot;Master slide text isn&amp;#39;t extracted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-712&quot;&gt;TIKA-712&lt;/a&gt;), where&lt;br/&gt;
we the get boiler plate text out, except in one case that I could find&lt;br/&gt;
(page numbers would output &amp;lt;number&amp;gt; placeholder text), so I fixed&lt;br/&gt;
OpenDocumentContentParser to not output text for text:page-number&lt;br/&gt;
elements  (Seeparately, I noticed we don&apos;t properly extract page&lt;br/&gt;
numbers for ODP files today... I&apos;ll open a new issue.)&lt;/p&gt;

&lt;p&gt;I also noticed because the OpenDocumentParser is strictly streaming&lt;br/&gt;
(single-pass through the ZipFile), we can easily fail to insert the&lt;br/&gt;
meta tags into the output XHTML, if we encounter &quot;meta.xml&quot; after&lt;br/&gt;
&quot;content.xml&quot;.  This is maybe not so bad, because the metadata will&lt;br/&gt;
still have the fields... but we could fix it, by using random-access&lt;br/&gt;
ZipFile instead if we had already opened a ZipFile (eg&lt;br/&gt;
AutoDetectParser), or if the IS is a TIS with a File.  I put a TODO to&lt;br/&gt;
do this...&lt;/p&gt;

&lt;p&gt;Also, I moved up the XHTMLContentHandler wrapping into&lt;br/&gt;
OpenDocumentParser (from OpenDocumentContentParser), so that we don&apos;t &lt;br/&gt;
emit head/body tags twice.  I think we also need to do this for&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-735&quot; title=&quot;OpenOffice parser: embedded OLE docs are extracted at the end, as extra &amp;lt;html&amp;gt;...&amp;lt;/html&amp;gt;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-735&quot;&gt;TIKA-735&lt;/a&gt; too.&lt;/p&gt;

&lt;p&gt;This fix is not perfect, since (just like &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-712&quot; title=&quot;Master slide text isn&amp;#39;t extracted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-712&quot;&gt;TIKA-712&lt;/a&gt;, for ppt/pptx) it&lt;br/&gt;
outputs the master text only once (as if it were its own slide),&lt;br/&gt;
instead of inlining it into each slide that referenced that master,&lt;br/&gt;
but I think it&apos;s at least better than what we have today (no master&lt;br/&gt;
text is extracted)... progress not perfection.&lt;/p&gt;</comment>
                            <comment id="13135996" author="thetaphi" created="Wed, 26 Oct 2011 15:02:12 +0100"  >&lt;p&gt;Hi Michael,&lt;/p&gt;

&lt;p&gt;thanks for this simple improvement. Can you also check that parsing styles.xml of e.g. writer or calc documents does no harm?&lt;/p&gt;

&lt;p&gt;About the order: I have it somewhere in the back of my head, that the order of files in the ZIP file is somehow part of the standard. At least I know, that the MIME_TYPE file must be the first one in the ZIP file, to make detection of format easy. As far as I remember there was also the requirement that the metadata.xml must come before the contents.xml. Unfortunately I am not able to download the ODF spec and verify this, maybe you have one mentioning this.&lt;/p&gt;

&lt;p&gt;I still dont get the reason for problems with metadata if the order of files is different. The metadata is parsed to another structure and not the HTMLContentHandler, so where is the problem is content comes first? The Metadata object should be filled in all cases once the parsing process is finished.&lt;/p&gt;</comment>
                            <comment id="13136070" author="mikemccand" created="Wed, 26 Oct 2011 17:13:43 +0100"  >&lt;blockquote&gt;&lt;p&gt;Can you also check that parsing styles.xml of e.g. writer or calc documents does no harm?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good idea, Uwe!; I tested this.&lt;/p&gt;

&lt;p&gt;On a fresh Writer (.odt) doc, no text comes out of the styles.xml&lt;br/&gt;
(good).  If I then edit the footer, Tika misses that text today, but&lt;br/&gt;
the patch gets it (I added a test).&lt;/p&gt;

&lt;p&gt;On a fresh Calc (.ods) doc, there is some minor &quot;placeholder&quot; text:&lt;/p&gt;

&lt;p&gt;&amp;lt;pre&amp;gt;&lt;br/&gt;
  &amp;lt;p&amp;gt;???&amp;lt;/p&amp;gt;&lt;br/&gt;
  &amp;lt;p&amp;gt;Page&amp;lt;/p&amp;gt;&lt;br/&gt;
  &amp;lt;p&amp;gt;??? (???)&amp;lt;/p&amp;gt;&lt;br/&gt;
  &amp;lt;p&amp;gt;10/26/2011, 11:13:57&amp;lt;/p&amp;gt;&lt;br/&gt;
  &amp;lt;p&amp;gt;Page  / 99 &amp;lt;/p&amp;gt;&lt;br/&gt;
&amp;lt;/pre&amp;gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve fixed the &quot;99&quot; by also filtering for &quot;text:page-count&quot; in ODCP;&lt;br/&gt;
the date/time is apparently when the doc was created; I think the rest&lt;br/&gt;
of the boiler plate text is acceptable?  EG, you can see this text&lt;br/&gt;
(Page 1) when you do Page Preview or print...&lt;/p&gt;

&lt;p&gt;When I then edited the footer in the Calc doc, Tika misses that text&lt;br/&gt;
today, but the patch gets it (I added a test for this too).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;About the order: I have it somewhere in the back of my head, that the order of files in the ZIP file is somehow part of the standard. At least I know, that the MIME_TYPE file must be the first one in the ZIP file, to make detection of format easy.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I haven&apos;t been able to find mention of this in the spec... I&apos;m looking&lt;br/&gt;
at &lt;a href=&quot;http://docs.oasis-open.org/office/v1.1/OS/OpenDocument-v1.1.odt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://docs.oasis-open.org/office/v1.1/OS/OpenDocument-v1.1.odt&lt;/a&gt; and&lt;br/&gt;
it just describes the general ZIP format as far as I can tell...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I still dont get the reason for problems with metadata if the order of files is different.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Oh, this is because XHTMLContentHandler, on seeing the end of header /&lt;br/&gt;
start of body will output &amp;lt;meta&amp;gt; tags for all metadata present in the&lt;br/&gt;
Metadata class at that time.  So... if new entries are added to&lt;br/&gt;
Metadata after the body tag is started they won&apos;t make it into the&lt;br/&gt;
&amp;lt;head&amp;gt;...&amp;lt;/head&amp;gt;.  Looks like this was done under &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-478&quot; title=&quot;HtmlParser can emit &amp;lt;head&amp;gt; elements inside of &amp;lt;body&amp;gt; block&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-478&quot;&gt;&lt;del&gt;TIKA-478&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13136090" author="thetaphi" created="Wed, 26 Oct 2011 17:36:13 +0100"  >&lt;blockquote&gt;
&lt;p&gt;Oh, this is because XHTMLContentHandler, on seeing the end of header /&lt;br/&gt;
start of body will output &amp;lt;meta&amp;gt; tags for all metadata present in the&lt;br/&gt;
Metadata class at that time. So... if new entries are added to&lt;br/&gt;
Metadata after the body tag is started they won&apos;t make it into the&lt;br/&gt;
&amp;lt;head&amp;gt;...&amp;lt;/head&amp;gt;. Looks like this was done under &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-478&quot; title=&quot;HtmlParser can emit &amp;lt;head&amp;gt; elements inside of &amp;lt;body&amp;gt; block&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-478&quot;&gt;&lt;del&gt;TIKA-478&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Oh that was long after may initial submission of this parser &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I was not aware that the metadata is now also replicated into the HTML head, in addition to the separate Metadata class.&lt;/p&gt;

&lt;p&gt;With the current parser it can also happen that the footer/header/masterslide comes before or after the main text, depending on order of files. But for indexing purposes like Lucene its not an issue at all - this was the only reason the original version of this parser was created for (as always for PANGAEA), so order did not have any effect.&lt;/p&gt;

&lt;p&gt;We could work around the whole thing without the need for a random access ZIP file, if we could only serialize the body and insert the body later (e.g. using a caching sax filter)? In general the text-only part is much smaller than a zip file with large 1000dpi images, so somehow caching it might not be an issue (of course not the whole dom tree) &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12525435">TIKA-737</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12647122">SOLR-4809</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12685163">TIKA-1211</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12500861" name="TIKA-736.patch" size="10349" author="mikemccand" created="Wed, 26 Oct 2011 11:55:05 +0100"/>
                            <attachment id="12497278" name="TIKA-736.patch" size="1984" author="mikemccand" created="Sat, 1 Oct 2011 11:34:04 +0100"/>
                            <attachment id="12497277" name="testMasterFooter.odp" size="13975" author="mikemccand" created="Sat, 1 Oct 2011 11:34:04 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 1 Oct 2011 12:45:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>41798</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx1yf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16636</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>