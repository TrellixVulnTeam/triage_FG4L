<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:28:37 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-1404/TIKA-1404.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-1404] tika-app server leaking temporary files when converting Word97 (doc)</title>
                <link>https://issues.apache.org/jira/browse/TIKA-1404</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;When converting Word97 documents (*.doc), tika-server reproducibly leaves behind temporary files.&lt;/p&gt;

&lt;p&gt;Steps to reproduce:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Start &lt;tt&gt;tika-app-1.5.jar&lt;/tt&gt; in &lt;tt&gt;--server&lt;/tt&gt; mode&lt;/li&gt;
	&lt;li&gt;Send a &lt;tt&gt;*.doc&lt;/tt&gt; file to server for conversion&lt;/li&gt;
	&lt;li&gt;Stop tika-server using CTRL+C or &lt;tt&gt;kill -15&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;For example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
lukas@host:~&amp;gt; java -jar tika-app-1.5.jar -v --server --port 8077 --text

# ...

lukas@host:/tmp&amp;gt; ls -lah apache-tika-*
ls: cannot access apache-tika-*: No such file or directory
lukas@host:/tmp&amp;gt;
lukas@host:/tmp&amp;gt; netcat 127.0.0.1 8077 &amp;lt; simple_word97.doc
Simple Word-97 Document
Lorem Ipsum.
lukas@host:/tmp&amp;gt; ls -lah apache-tika-*
-rw-r--r-- 1 lukas users 22K 2014-08-29 15:48 apache-tika-2457738389388821864.tmp

# after conversion is done, tmp file handles are still open

lukas@host:/tmp&amp;gt; lsof | grep tika
java   29857   lukas   32r   REG   104,2  28628386  4571740 /home/lukas/tika-app-1.5.jar
java   29857   lukas   85r   REG   104,2     22528  8604717 /tmp/apache-tika-2457738389388821864.tmp
java   29857   lukas   86r   REG   104,2     22528  8604717 /tmp/apache-tika-2457738389388821864.tmp

# stop tika-server...

^C
lukas@host:~&amp;gt;

# ...

lukas@host:/tmp&amp;gt; lsof | grep tika
lukas@host:/tmp&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;No exceptions are thrown, and the plaintext is being extracted correctly from the document, but temporary files are still left behind every single time.&lt;/p&gt;

&lt;p&gt;This obviously is a major issue in a production environment when converting thousands of documents a day. Our temp directories are filling up rapidly, and we had to configure cron jobs to clean up after Tika on most of our production servers. I wasn&apos;t able to reproduce this issue using &lt;tt&gt;tika-app-1.5.jar&lt;/tt&gt; in non-server mode. However, booting up a JVM for every single conversion is just too slow.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux (observed on CentOS 6.5 and SuSE SLES 11)&lt;/p&gt;</environment>
        <key id="12737805">TIKA-1404</key>
            <summary>tika-app server leaking temporary files when converting Word97 (doc)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gagravarr">Nick Burch</assignee>
                                    <reporter username="lukasgraf">Lukas Graf</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Aug 2014 15:34:57 +0100</created>
                <updated>Sun, 31 Aug 2014 20:52:01 +0100</updated>
                            <resolved>Sun, 31 Aug 2014 17:21:27 +0100</resolved>
                                    <version>1.5</version>
                    <version>1.7</version>
                                    <fixVersion>1.7</fixVersion>
                                    <component>cli</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14115286" author="lukasgraf" created="Fri, 29 Aug 2014 15:36:04 +0100"  >&lt;p&gt;Word97 document used to reproduce the issue&lt;/p&gt;</comment>
                            <comment id="14115294" author="gagravarr" created="Fri, 29 Aug 2014 15:41:34 +0100"  >&lt;p&gt;Any chance you could re-test with a recent nightly build? (Or failing that, wait about a week and try with 1.6, which&apos;ll hopefully be out by then)&lt;/p&gt;

&lt;p&gt;It&apos;s possible that the updates to Apache POI included since 1.5 will solve this&lt;/p&gt;</comment>
                            <comment id="14115296" author="lukasgraf" created="Fri, 29 Aug 2014 15:48:37 +0100"  >&lt;p&gt;I&apos;ll certainly give it a try (I&apos;m not a Java developer though, but I should manage to build tika from source). What I&apos;m a bit unsure about: There seem to be different standalone Tika server implementations around. I used &lt;tt&gt;tika-app-1.5.jar&lt;/tt&gt; with the  &lt;tt&gt;--server&lt;/tt&gt; argument, but there also seems to be a &lt;a href=&quot;http://wiki.apache.org/tika/TikaJAXRS&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;TikaJAXRS&lt;/a&gt; server which seems to be invoked differently. If I just check out the source and build, which one will I get?&lt;/p&gt;</comment>
                            <comment id="14115299" author="gagravarr" created="Fri, 29 Aug 2014 15:51:04 +0100"  >&lt;p&gt;Also, since you mention production - you might be better off using the Tika Server JaxRS server instead of the Tika App in server mode. As of 1.6 the Tika Server should have all the features that the app does, plus additional ones, and is more suited to heavy use&lt;/p&gt;</comment>
                            <comment id="14115309" author="lukasgraf" created="Fri, 29 Aug 2014 16:05:00 +0100"  >&lt;p&gt;Excellent, thank you for that recommendation. I will try both those things (see if I can find a recent nightly build of tika-app or build it from source), and test if I also encounter the issue with Tika Server JaxRS. It&apos;ll probably take me a couple hours though to get back to you.&lt;/p&gt;</comment>
                            <comment id="14115397" author="gagravarr" created="Fri, 29 Aug 2014 17:22:07 +0100"  >&lt;p&gt;If you build from source / a svn checkout, you&apos;ll find the tika app jar in tika-app/target and the tika server jar (no war yet, there&apos;s a ticket for that) in tika-server/target&lt;/p&gt;

&lt;p&gt;Otherwise, snapshot builds are available to download from the CI server - &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.7/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.7/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14116001" author="lukasgraf" created="Fri, 29 Aug 2014 23:56:28 +0100"  >&lt;p&gt;I&apos;m still able to reproduce this using a recent nightly build of tika-app (&lt;tt&gt;tika-app-1.7-20140829.084009-126.jar&lt;/tt&gt;).&lt;/p&gt;</comment>
                            <comment id="14116690" author="lukasgraf" created="Sun, 31 Aug 2014 10:51:54 +0100"  >&lt;p&gt;I just tested with the JaxRS Tika server, and I cannot reproduce this issue with it.&lt;/p&gt;

&lt;p&gt;I grabbed the &lt;tt&gt;Apache Tika server&lt;/tt&gt; artifact for the latest build from Jenkins, &lt;tt&gt;tika-server-1.7-20140831.080858-126.jar&lt;/tt&gt;, and invoked the conversion with &lt;tt&gt;curl -T simple_word97.doc &lt;a href=&quot;http://localhost:9998/tika&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://localhost:9998/tika&lt;/a&gt; --header &quot;Content-type: application/msword&quot;&lt;/tt&gt; - no temp files left behind.&lt;/p&gt;

&lt;p&gt;But I now realize I may have mislabeled the bug report: The &quot;Tika Server&quot; component seems to refer to the JaxRS server, the issue however only affects the &lt;tt&gt;tika-app&lt;/tt&gt; component run in &lt;tt&gt;--server&lt;/tt&gt; mode.&lt;/p&gt;</comment>
                            <comment id="14116810" author="gagravarr" created="Sun, 31 Aug 2014 17:20:22 +0100"  >&lt;p&gt;The tika-app server code was missing a call to close the input, which I&apos;ve fixed in r1621604. I now no longer see the temp files when following your reproduction steps&lt;/p&gt;</comment>
                            <comment id="14116817" author="hudson" created="Sun, 31 Aug 2014 17:47:57 +0100"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.7 #187 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.7/187/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.7/187/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1404&quot; title=&quot;tika-app server leaking temporary files when converting Word97 (doc)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1404&quot;&gt;&lt;del&gt;TIKA-1404&lt;/del&gt;&lt;/a&gt; The tika-app in server mode needs to close the TikaInputStream when done with it, to avoid leaking temp files (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1621604&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1621604&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14116819" author="hudson" created="Sun, 31 Aug 2014 18:03:44 +0100"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.6 #166 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.6/166/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.6/166/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1404&quot; title=&quot;tika-app server leaking temporary files when converting Word97 (doc)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1404&quot;&gt;&lt;del&gt;TIKA-1404&lt;/del&gt;&lt;/a&gt; The tika-app in server mode needs to close the TikaInputStream when done with it, to avoid leaking temp files (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1621604&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1621604&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14116870" author="lukasgraf" created="Sun, 31 Aug 2014 20:52:01 +0100"  >&lt;p&gt;Indeed, I tested again with the latest snapshot containing your commit, I can&apos;t reproduce the issue anymore either. Thank you for your quick response!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12665348" name="simple_word97.doc" size="22528" author="lukasgraf" created="Fri, 29 Aug 2014 15:36:04 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 29 Aug 2014 14:41:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hztcjz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>