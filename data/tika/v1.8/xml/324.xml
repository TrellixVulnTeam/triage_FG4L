<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:32:49 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-324/TIKA-324.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-324] Tika CLI mangles utf-8 content in text (-t) mode (on Mac OS X)</title>
                <link>https://issues.apache.org/jira/browse/TIKA-324</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>
&lt;p&gt;When using the -t flag to tika, multi-byte content is destroyed in the output.&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;


&lt;p&gt;$ java -jar tika-app-0.4.jar -t ./test.txt&lt;br/&gt;
I?t?rn?ti?n?liz?ti?n&lt;/p&gt;

&lt;p&gt;$ java -jar tika-app-0.4.jar -x ./test.txt&lt;br/&gt;
&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
&amp;lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&amp;gt;&lt;br/&gt;
&amp;lt;head&amp;gt;&lt;br/&gt;
&amp;lt;title/&amp;gt;&lt;br/&gt;
&amp;lt;/head&amp;gt;&lt;br/&gt;
&amp;lt;body&amp;gt;&lt;br/&gt;
&amp;lt;p&amp;gt;I&#241;t&#235;rn&#226;ti&#244;n&#224;liz&#230;ti&#248;n&lt;br/&gt;
&amp;lt;/p&amp;gt;&lt;br/&gt;
&amp;lt;/body&amp;gt;&lt;br/&gt;
&amp;lt;/html&amp;gt;&lt;/p&gt;



&lt;p&gt;see also:  &lt;a href=&quot;http://drupal.org/node/622508#comment-2267918&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://drupal.org/node/622508#comment-2267918&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Mac OS 10.5, java version &quot;1.6.0_15&quot;&lt;/p&gt;</environment>
        <key id="12440749">TIKA-324</key>
            <summary>Tika CLI mangles utf-8 content in text (-t) mode (on Mac OS X)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="pwolanin">Peter Wolanin</reporter>
                        <labels>
                    </labels>
                <created>Sun, 15 Nov 2009 17:52:45 +0000</created>
                <updated>Fri, 27 Nov 2009 17:27:50 +0000</updated>
                            <resolved>Fri, 27 Nov 2009 15:11:57 +0000</resolved>
                                    <version>0.3</version>
                    <version>0.4</version>
                    <version>0.5</version>
                                    <fixVersion>0.6</fixVersion>
                                    <component>cli</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <timeoriginalestimate seconds="7200">2h</timeoriginalestimate>
                            <timeestimate seconds="7200">2h</timeestimate>
                                        <comments>
                            <comment id="12778132" author="pwolanin" created="Sun, 15 Nov 2009 17:53:25 +0000"  >&lt;p&gt;attaching little test ext file.&lt;/p&gt;</comment>
                            <comment id="12778133" author="pwolanin" created="Sun, 15 Nov 2009 17:56:06 +0000"  >&lt;p&gt;Examining the TikaCLI.java code, the xhtml versus text output is handled very differently.  I&apos;m not sure why the text one fails, but it seems to be easily rectified by applying the trasformer using &quot;text&quot; as the method.&lt;/p&gt;</comment>
                            <comment id="12778134" author="pwolanin" created="Sun, 15 Nov 2009 17:59:56 +0000"  >
&lt;p&gt;Attached is a patch against Tika 0.4.  It resolves the bug for me, at least for the simple test case.&lt;/p&gt;


&lt;p&gt;$ java -jar tika-app-0.4.jar -t ./test.txt &lt;br/&gt;
I&#241;t&#235;rn&#226;ti&#244;n&#224;liz&#230;ti&#248;n&lt;/p&gt;

&lt;p&gt;$ java -jar tika-app-0.4.jar -x ./test.txt &lt;br/&gt;
&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
&amp;lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&amp;gt;&lt;br/&gt;
&amp;lt;head&amp;gt;&lt;br/&gt;
&amp;lt;title/&amp;gt;&lt;br/&gt;
&amp;lt;/head&amp;gt;&lt;br/&gt;
&amp;lt;body&amp;gt;&lt;br/&gt;
&amp;lt;p&amp;gt;I&#241;t&#235;rn&#226;ti&#244;n&#224;liz&#230;ti&#248;n&lt;br/&gt;
&amp;lt;/p&amp;gt;&lt;br/&gt;
&amp;lt;/body&amp;gt;&lt;br/&gt;
&amp;lt;/html&amp;gt;&lt;/p&gt;

</comment>
                            <comment id="12778135" author="pwolanin" created="Sun, 15 Nov 2009 18:08:21 +0000"  >&lt;p&gt;note:  test string origin is:  &lt;a href=&quot;http://intertwingly.net/stories/2004/04/14/i18n.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://intertwingly.net/stories/2004/04/14/i18n.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12778140" author="pwolanin" created="Sun, 15 Nov 2009 18:19:49 +0000"  >&lt;p&gt;The bug is confirmed as present in 0.3 also.&lt;/p&gt;

&lt;p&gt;$ java -jar tika-0.3.jar -t ./test.txt &lt;br/&gt;
I?t?rn?ti?n?liz?ti?n&lt;/p&gt;</comment>
                            <comment id="12778144" author="pwolanin" created="Sun, 15 Nov 2009 18:38:18 +0000"  >&lt;p&gt;The code in the TikaCLI.java seems to have changed in trunk - not clear if the bug is still present.&lt;/p&gt;

&lt;p&gt;TikaGUI.java has something very similar to the code as altered in this patch, yet it correctly renders the test string in 0.4.  The output seems to go via a StringWriter rather than directly to System.out, which my make the difference?&lt;/p&gt;</comment>
                            <comment id="12778148" author="pwolanin" created="Sun, 15 Nov 2009 18:44:19 +0000"  >&lt;p&gt;Bug is still present in trunk (and code tagged for 0.5)&lt;/p&gt;


&lt;p&gt;$ java -jar tika-app/target/tika-app-0.6-SNAPSHOT.jar -t ./test.txt&lt;br/&gt;
I?t?rn?ti?n?liz?ti?n&lt;/p&gt;
</comment>
                            <comment id="12778156" author="pwolanin" created="Sun, 15 Nov 2009 19:05:09 +0000"  >
&lt;p&gt;Here is a patch for tika 0.5/trunk that resolves the bug (1 line change) and a revised patch for 0.4 that sets indent to &quot;true&quot; for consistency.&lt;/p&gt;

&lt;p&gt;For a quick test PDF - look at:  &lt;a href=&quot;http://nlp.stanford.edu/IR-book/pdf/00front.pdf&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://nlp.stanford.edu/IR-book/pdf/00front.pdf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Without the patch, the math symbols like &#969;,&#969;k are obliterated.&lt;/p&gt;</comment>
                            <comment id="12778912" author="jukkaz" created="Tue, 17 Nov 2009 14:51:37 +0000"  >&lt;p&gt;The problem here is that the default --text output uses the default encoding, which AFAIK for Java on Mac OS X is &lt;br/&gt;
MacRoman even though OS X otherwise uses UTF-8. This is why all non-MacRoman characters get turned to question marks when printed to the console.&lt;/p&gt;

&lt;p&gt;The proposed patch changes the output encoding to UTF-8 (the default for TransformerHandler) for all platforms, which can cause problems on platforms with different default encodings.&lt;/p&gt;

&lt;p&gt;The reason why --text behaves differently from --xml and --html is that the latter are considered to output binary data that either contains explicit encoding information (&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt; for --xml) or works around the encoding issue in other ways (I&amp;ntilde;t&amp;euml;rn&amp;acirc;ti&amp;ocirc;n&amp;agrave;liz&amp;aelig;ti&amp;oslash;n for --html). The --text output is expected to be consumable by default text processing tools of the platform (grep  &quot;I&#241;t&#235;rn&#226;ti&#244;n&#224;liz&#230;ti&#248;n&quot;), so it needs to use the correct character encoding.&lt;/p&gt;

&lt;p&gt;To avoid breaking things on other platforms, I suggest that we only override the default encoding on Mac OS X, like this:&lt;/p&gt;

&lt;p&gt;Index: tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java	(revision 880772)&lt;br/&gt;
+++ tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java	(working copy)&lt;br/&gt;
@@ -228,6 +228,10 @@&lt;br/&gt;
             throws UnsupportedEncodingException {&lt;br/&gt;
         if (encoding != null) &lt;/p&gt;
{
             return new OutputStreamWriter(System.out, encoding);
+        }
&lt;p&gt; else if (System.getProperty(&quot;os.name&quot;)&lt;br/&gt;
+                .toLowerCase().startsWith(&quot;mac os x&quot;)) &lt;/p&gt;
{
+            // TIKA-324: Override the default encoding on Mac OS X
+            return new OutputStreamWriter(System.out, &quot;UTF-8&quot;);
         }
&lt;p&gt; else &lt;/p&gt;
{
             return new OutputStreamWriter(System.out);
         }</comment>
                            <comment id="12778915" author="jukkaz" created="Tue, 17 Nov 2009 14:53:35 +0000"  >&lt;p&gt;Hmm, the above patch doesn&apos;t look too good in HTML.. I&apos;ve attached it as the &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-324&quot; title=&quot;Tika CLI mangles utf-8 content in text (-t) mode (on Mac OS X)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-324&quot;&gt;&lt;del&gt;TIKA-324&lt;/del&gt;&lt;/a&gt;-macosx.patch file.&lt;/p&gt;</comment>
                            <comment id="12778923" author="jukkaz" created="Tue, 17 Nov 2009 15:05:53 +0000"  >&lt;p&gt;This fix won&apos;t make it in Tika 0.5, but see &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-277&quot; title=&quot;Tika stand alone CLI --possibility to specify output encoding (--text)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-277&quot;&gt;&lt;del&gt;TIKA-277&lt;/del&gt;&lt;/a&gt; for the new --encoding option that allows you to work around this issue:&lt;/p&gt;

&lt;p&gt;$ java -jar tika-app-0.5.jar --text --encoding=UTF-8 ./test.txt&lt;br/&gt;
I&#241;t&#235;rn&#226;ti&#244;n&#224;liz&#230;ti&#248;n&lt;/p&gt;</comment>
                            <comment id="12778926" author="pwolanin" created="Tue, 17 Nov 2009 15:10:30 +0000"  >
&lt;p&gt;In fact for tika 0.4 it looks like it works already to pass this option to java:&lt;/p&gt;


&lt;p&gt;-Dfile.encoding=UTF8&lt;/p&gt;

&lt;p&gt;$java -Dfile.encoding=UTF8 -jar orig-tika-app-0.4.jar -t ./test.txt&lt;br/&gt;
I&#241;t&#235;rn&#226;ti&#244;n&#224;liz&#230;ti&#248;n&lt;/p&gt;</comment>
                            <comment id="12778928" author="pwolanin" created="Tue, 17 Nov 2009 15:12:47 +0000"  >&lt;p&gt;Also, this is not a Mac-only problem- I have the same issue, for example, on CentOS using java version &quot;1.6.0_04&quot;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;root@i:~&amp;#93;&lt;/span&gt; java -jar tika-app-0.4.jar -t test.txt &lt;br/&gt;
I?t?rn?ti?n?liz?ti?n&lt;/p&gt;</comment>
                            <comment id="12778945" author="jukkaz" created="Tue, 17 Nov 2009 15:43:50 +0000"  >&lt;p&gt;Yes, the -Dfile.encoding option forces Java to use that encoding as the default for all IO.&lt;/p&gt;

&lt;p&gt;Can you check what your default encoding is on CentOS? That&apos;s normally set in the LANG environment variable, so running &quot;echo $LANG&quot; should give the information.&lt;/p&gt;</comment>
                            <comment id="12778951" author="pwolanin" created="Tue, 17 Nov 2009 15:53:28 +0000"  >&lt;p&gt;on Mac OS 10.5 it looks correct:&lt;br/&gt;
$echo $LANG&lt;br/&gt;
en_US.UTF-8&lt;/p&gt;


&lt;p&gt;on CentOS 5, no value is set:&lt;br/&gt;
echo $LANG&lt;/p&gt;


&lt;p&gt;If I set that value on CenOS (to the same as my Mac) then output is correct:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;root@i:~&amp;#93;&lt;/span&gt; export LANG=en_US.UTF-8&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;root@i:~&amp;#93;&lt;/span&gt; java -jar tika-app-0.4.jar -t test.txt &lt;br/&gt;
I&#241;t&#235;rn&#226;ti&#244;n&#224;liz&#230;ti&#248;n&lt;/p&gt;


</comment>
                            <comment id="12783118" author="jukkaz" created="Fri, 27 Nov 2009 15:11:57 +0000"  >&lt;p&gt;OK. I&apos;ve committed the latest patch to trunk. The code now never uses the default platform encoding on Mac OS X, opting instead for UTF-8 as the default. People can still override the setting with an explicit --encoding argument.&lt;/p&gt;

&lt;p&gt;For the CentOS case I recommend just setting the LANG environment variable correctly, as that&apos;s used also by other programs and there is no other easy way for Tika or Java to figure out which encoding should be used on that platform.&lt;/p&gt;</comment>
                            <comment id="12783134" author="pwolanin" created="Fri, 27 Nov 2009 17:02:05 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;edit: deleted incorrect info&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="12783137" author="pwolanin" created="Fri, 27 Nov 2009 17:27:50 +0000"  >&lt;p&gt;Here&apos;s a little follow-up patch for the README file to document this further.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12425021" name="TIKA-324-0.5.patch" size="586" author="pwolanin" created="Sun, 15 Nov 2009 19:05:09 +0000"/>
                            <attachment id="12426290" name="TIKA-324-README.patch" size="850" author="pwolanin" created="Fri, 27 Nov 2009 17:27:50 +0000"/>
                            <attachment id="12425225" name="TIKA-324-macosx.patch" size="781" author="jukkaz" created="Tue, 17 Nov 2009 14:53:35 +0000"/>
                            <attachment id="12425022" name="TIKA-324.patch" size="1044" author="pwolanin" created="Sun, 15 Nov 2009 19:05:09 +0000"/>
                            <attachment id="12425015" name="TIKA-324.patch" size="1055" author="pwolanin" created="Sun, 15 Nov 2009 17:59:56 +0000"/>
                            <attachment id="12425014" name="test.txt" size="28" author="pwolanin" created="Sun, 15 Nov 2009 17:53:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 17 Nov 2009 14:51:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4536</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx4hj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17046</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>