<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:31:21 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-791/TIKA-791.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-791] Fix the detection of protected OOXML files</title>
                <link>https://issues.apache.org/jira/browse/TIKA-791</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-437&quot; title=&quot;OfficeParser: support for write-protected xlsx files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-437&quot;&gt;&lt;del&gt;TIKA-437&lt;/del&gt;&lt;/a&gt; patch allowed Tika to work with OOXML files protected with the default VelvetSweatshop password. I feel there is room for improvement.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;The POIFSContainerDetector lies when it sees such a file. It should be able to mark it as x-tika-ooxml&lt;/li&gt;
	&lt;li&gt;The OOXMLParser can&apos;t work with such a file. It should:
	&lt;ol&gt;
		&lt;li&gt;If it&apos;s protected with the default password - it should be decrypted and processed normally.&lt;/li&gt;
		&lt;li&gt;If it&apos;s protected with a non-default password - the file should be marked as protected, no weird exceptions should appear.&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Therefore I&apos;d like to add an &apos;if&apos; to POIFSContainerDetector which returns x-tika-ooxml, and some code to OOXMLParser, which would be similar to the code currently residing in OfficeParser. After this improvement both the OfficeParser and the OOXMLParser will treat such files in the same way.&lt;/p&gt;

&lt;p&gt;When I have that, I can add a hack in my application, which will say &quot;If the type is x-tika-ooxml and the name-based detection is a specialization of ooxml, then use the name-based detection&quot;. This will be a workaround for the fact that in MimeTypes, magic always trumps the name. With that, the encrypted DOCX files will appear with the normal DOCX mimetype in my app.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 7 64 bit&lt;/p&gt;</environment>
        <key id="12532729">TIKA-791</key>
            <summary>Fix the detection of protected OOXML files</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="antoni.mylka">Antoni Mylka</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Nov 2011 15:46:59 +0000</created>
                <updated>Wed, 14 Dec 2011 13:23:14 +0000</updated>
                            <resolved>Wed, 14 Dec 2011 13:23:14 +0000</resolved>
                                    <version>1.1</version>
                                    <fixVersion>1.1</fixVersion>
                                    <component>mime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13157205" author="antoni.mylka" created="Fri, 25 Nov 2011 15:50:21 +0000"  >&lt;p&gt;A ZIP file with the patch and some test documents. They differ from the ones in test-documents folder in that they&apos;re are protected by a non-default password. The protectedFile.xlsx for instance ins protected with a default password. I made those example files myself.&lt;/p&gt;</comment>
                            <comment id="13157212" author="gagravarr" created="Fri, 25 Nov 2011 15:56:32 +0000"  >&lt;p&gt;Maybe we should add a new tika specific mimetype for encrypted ooxml documents?&lt;/p&gt;

&lt;p&gt;This would extend from tika-ooxml, but the (ole2 based) OfficeParser could claim it. That would allow it to decrypt and recurse as now, but would also permit the mime type detection to correct to the specific kind based on the filename?&lt;/p&gt;

&lt;p&gt;I&apos;m not sure we want to duplicate the protected document logic between OfficeParser and OOXMLParser though, I think we want to keep it all in one place. OfficeParser seems like the right point for it to me, as it&apos;s all within the OLE2 layer at that point.&lt;/p&gt;</comment>
                            <comment id="13157216" author="antoni.mylka" created="Fri, 25 Nov 2011 16:04:53 +0000"  >&lt;p&gt;A specific mime type seems like a better idea indeed. I&apos;ll update the patch and tests.&lt;/p&gt;</comment>
                            <comment id="13158375" author="antoni.mylka" created="Mon, 28 Nov 2011 12:29:20 +0000"  >&lt;p&gt;Attached an updated patch which uses a new media type &quot;application/x-tika-ooxml-protected&quot; for protected OOXML files with the OLE2 magic. This allowed me to implement my own detector which does:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;if mimeTypes says ms-office
and poi says ooxml-protected 
and name implies an ooxml subtype
then return the type implied by name
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Right now it can&apos;t be done with any of the built-in Tika Detectors. If you think it would be a good idea then perhaps, this would warrant a new issue.&lt;/p&gt;</comment>
                            <comment id="13158444" author="gagravarr" created="Mon, 28 Nov 2011 13:33:54 +0000"  >&lt;p&gt;One thing - I&apos;m not sure that we should be returning the same mimetype for a regular .xlsx file and a password protected .xlsx file. One is zip based, one is encrypted ole2. I&apos;d say it&apos;s a similar situation to us not returning the same mimetype for .tar and .tar.gz - while they are both technically tar files, one is directly tar and the other is a wrapper tar that needs unpacking first. In this case, the protected ooxml files need special handling before they turn into normal ooxml files, so I don&apos;t believe we should be treating them interchangeably &lt;/p&gt;</comment>
                            <comment id="13158447" author="gagravarr" created="Mon, 28 Nov 2011 13:36:55 +0000"  >&lt;p&gt;Patch looks good! After tweaking some of the comments, and adding the missing entry to tika-mimetypes, I&apos;ve gone ahead and committed it in r1207152.&lt;/p&gt;

&lt;p&gt;Now to use the same model to solve &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-790&quot; title=&quot;Reduce duplication between POIFSDocumentType (in OfficeParser) and POIFSContainerDetector&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-790&quot;&gt;&lt;del&gt;TIKA-790&lt;/del&gt;&lt;/a&gt;...&lt;/p&gt;</comment>
                            <comment id="13169330" author="antheque" created="Wed, 14 Dec 2011 13:23:14 +0000"  >&lt;p&gt;This seems fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12505325" name="tika-791-ver2.zip" size="117761" author="antoni.mylka" created="Mon, 28 Nov 2011 12:29:20 +0000"/>
                            <attachment id="12505119" name="tika-791.zip" size="120179" author="antoni.mylka" created="Fri, 25 Nov 2011 15:50:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 25 Nov 2011 15:56:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>218462</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx1m7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16581</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>