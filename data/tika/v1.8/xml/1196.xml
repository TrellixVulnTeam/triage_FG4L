<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:29:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-1196/TIKA-1196.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-1196] JAX-RS server only responds to queries to/from http://localhost</title>
                <link>https://issues.apache.org/jira/browse/TIKA-1196</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;I&apos;m not sure if this is a problem with the Tika JAX-RS server, or with how it uses CXF under the hood. Anyway:&lt;/p&gt;

&lt;p&gt;I have a large text extraction job (10-15 million documents) that I&apos;m using the web service for. It would be nice to be able to distribute this horizontally across multiple nodes to speed up the processing. I had thought to have a job queue with a couple consumers, farming out PUT requests across several Tika web service endpoints.&lt;/p&gt;

&lt;p&gt;But the JAX-RS web service will only respond to queries made to &lt;tt&gt;&lt;a href=&quot;http://localhost:9998/tika&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://localhost:9998/tika&lt;/a&gt;&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I can&apos;t call &lt;tt&gt;&lt;a href=&quot;http://hostname:9998/tika&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hostname:9998/tika&lt;/a&gt;&lt;/tt&gt; &amp;#8211; even if it&apos;s still a local operation.&lt;/p&gt;

&lt;p&gt;Here is a list of things I&apos;ve tried:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I changed line 89 of TikaServerCLI.java to compute the name of the host at runtime. No go: the server starts up, and immediately terminates.&lt;/li&gt;
	&lt;li&gt;I changed line 89 of TikaServerCLI.java to be a hostname (not a FQDN), and re-compiled:
	&lt;ul&gt;
		&lt;li&gt;&lt;tt&gt;mvn compile -rf :tika-server&lt;/tt&gt; compiles successfully. Start up the server, and it terminates, just like when I tried to compute the hostname at runtime&lt;/li&gt;
		&lt;li&gt;&lt;tt&gt;mvn install&lt;/tt&gt; from the topmost Tika directory gets the service responding to both &lt;tt&gt;&lt;a href=&quot;http://hostname:9998/tika&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hostname:9998/tika&lt;/a&gt;&lt;/tt&gt; and &lt;tt&gt;&lt;a href=&quot;http://hostname.domain.net:9998/tika&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hostname.domain.net:9998/tika&lt;/a&gt;&lt;/tt&gt; (Seemed weird, this is why I was thinking it was further up the chain in CXF?)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In a perfect world:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The server should respond to any valid calls that make sense:
	&lt;ul&gt;
		&lt;li&gt;127.0.0.1&lt;/li&gt;
		&lt;li&gt;localhost&lt;/li&gt;
		&lt;li&gt;hostname&lt;/li&gt;
		&lt;li&gt;host.domain.tld&lt;/li&gt;
		&lt;li&gt;ip_address&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;A &lt;tt&gt;hostname&lt;/tt&gt; invocation parameter could be used to limit what the service responds to when it&apos;s started up. (A very optional, nice-to-have.)&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment>&lt;p&gt;Mac OS X, Windows Server 2008&lt;/p&gt;</environment>
        <key id="12679570">TIKA-1196</key>
            <summary>JAX-RS server only responds to queries to/from http://localhost</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="rianjs">Rian Stockbower</reporter>
                        <labels>
                            <label>JAXRS</label>
                            <label>hostname</label>
                            <label>web-service</label>
                    </labels>
                <created>Sat, 16 Nov 2013 14:27:25 +0000</created>
                <updated>Tue, 25 Mar 2014 16:21:50 +0000</updated>
                            <resolved>Wed, 29 Jan 2014 18:13:44 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.5</fixVersion>
                                    <component>server</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13824526" author="gagravarr" created="Sat, 16 Nov 2013 16:24:41 +0000"  >&lt;p&gt;I think the problem isn&apos;t the hostname, it&apos;s the interface bound to. By default it comes up just listening on the loopback 127.0.0.1 interface and not any others:&lt;/p&gt;

&lt;p&gt;   $ netstat  -nl | grep 9998&lt;br/&gt;
   tcp6       0      0 127.0.0.1:9998          :::*                    LISTEN&lt;/p&gt;

&lt;p&gt;However, I can call it just fine by loopback IP, so it&apos;s not the host header:&lt;/p&gt;

&lt;p&gt;   $ curl -T test.pdf &lt;a href=&quot;http://127.0.0.1:9998/meta&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://127.0.0.1:9998/meta&lt;/a&gt;&lt;br/&gt;
   &quot;dcterms:modified&quot;,&quot;2003-01-28T18:56:48Z&quot;&lt;br/&gt;
   &quot;meta:creation-date&quot;,&quot;2001-12-28T17:15:34Z&quot;&lt;br/&gt;
   &quot;meta:save-date&quot;,&quot;2003-01-28T18:56:48Z&quot;&lt;br/&gt;
   &quot;dc:creator&quot;,&quot;gbish&quot;&lt;br/&gt;
   &quot;Last-Modified&quot;,&quot;2003-01-28T18:56:48Z&quot;&lt;br/&gt;
   (snip)&lt;/p&gt;

&lt;p&gt;So, I think we need to provide an option to bind to all interfaces instead of just loopback&lt;/p&gt;</comment>
                            <comment id="13824538" author="rianjs" created="Sat, 16 Nov 2013 17:10:28 +0000"  >&lt;p&gt; I&apos;m new to this, but it looks like there&apos;s no way to call JAXRSServerFactoryBean.setAddress with anything except a literal string. There doesn&apos;t seem to be a way to give it a list of valid hostnames.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cxf.apache.org/javadoc/latest/org/apache/cxf/endpoint/AbstractEndpointFactory.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://cxf.apache.org/javadoc/latest/org/apache/cxf/endpoint/AbstractEndpointFactory.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13824887" author="gagravarr" created="Sun, 17 Nov 2013 15:45:29 +0000"  >&lt;p&gt;What about &quot;*&quot;, that&apos;s often used to mean listen on everything&lt;/p&gt;

&lt;p&gt;Otherwise, you&apos;ll probably need to join the CXF User mailing list, and ask them there what we should be doing to listen across all interfaces&lt;/p&gt;</comment>
                            <comment id="13824939" author="rianjs" created="Sun, 17 Nov 2013 20:01:41 +0000"  >&lt;p&gt;Unfortunately that didn&apos;t work. I&apos;ve just emailed the CXF user list.&lt;/p&gt;</comment>
                            <comment id="13824948" author="sergey_beryozkin" created="Sun, 17 Nov 2013 20:44:56 +0000"  >&lt;p&gt;Hi. A number of fixes have been applied to CXF code dealing with the HTTP host resolution across multiple releases. &lt;br/&gt;
I think users sometimes use &quot;0.0.0.0&quot; instead of the host name or simply use the relative address. Rian, can you please try CXF 2.7.7 ?  &lt;br/&gt;
Cheers, Sergey&lt;/p&gt;</comment>
                            <comment id="13824956" author="rianjs" created="Sun, 17 Nov 2013 21:13:48 +0000"  >&lt;p&gt;That worked, Sergey. Changing localhost to 0.0.0.0 now lets me hit the service using any valid address.&lt;/p&gt;</comment>
                            <comment id="13824977" author="rianjs" created="Sun, 17 Nov 2013 22:27:50 +0000"  >&lt;p&gt;I&apos;ve attached a patch file that just changes localhost to 0.0.0.0, which allows users to hit the endpoint using any valid IP or hostname.&lt;/p&gt;

&lt;p&gt;Attempting to move the JAX-RS server to CXF 2.7.8 is a little beyond my skill.&lt;/p&gt;</comment>
                            <comment id="13824978" author="gagravarr" created="Sun, 17 Nov 2013 22:30:50 +0000"  >&lt;p&gt;I&apos;m not sure if that should be an option, or if it&apos;s OK to change the default?&lt;/p&gt;</comment>
                            <comment id="13824982" author="rianjs" created="Sun, 17 Nov 2013 22:45:51 +0000"  >&lt;p&gt;It seems weird to restrict access to the endpoint to only loopback addresses.&lt;/p&gt;

&lt;p&gt;That said, I&apos;m working on something a little more interesting/robust.&lt;/p&gt;</comment>
                            <comment id="13824985" author="rianjs" created="Sun, 17 Nov 2013 23:00:13 +0000"  >&lt;p&gt;Disregard my first patch. This one changes the default behavior to make the service respond to any valid hostname/ip address. It also adds a CLI parameter to control the address with instructions for the user on how to restrict usage to only loopback addresses.&lt;/p&gt;</comment>
                            <comment id="13824999" author="rianjs" created="Sun, 17 Nov 2013 23:53:22 +0000"  >&lt;p&gt;Patch C fixes a careless error where the default port was always used, regardless of what was specified by the user.&lt;/p&gt;</comment>
                            <comment id="13825254" author="sergey_beryozkin" created="Mon, 18 Nov 2013 10:33:41 +0000"  >&lt;p&gt;Rian, thanks for the patch. I&apos;d prefer going for a &apos;host&apos; option only and keep the default to &apos;localhost&apos; as Nick also suggested. &lt;br/&gt;
You are right it does not make much sense for cases where clients are not collocated, but in those cases we are most likely also have to care about the secure HTTPS. Making sure the server can run in the secure mode is a separate issue IMHO (can be done via configuring CXF Jetty connectors or supporting the war deployments with the containers taking care of HTTPS)&lt;br/&gt;
Thanks. Sergey&lt;/p&gt;</comment>
                            <comment id="13825332" author="rianjs" created="Mon, 18 Nov 2013 14:05:57 +0000"  >&lt;p&gt;I can put it back to localhost, but I&apos;m not sure &lt;em&gt;why&lt;/em&gt; that&apos;s desirable. (Other than that&apos;s the way it was.) What&apos;s the reasoning behind having it limited to loopback addresses by default? This is not the behavior I would expect as a user. As a user, I would expect it to work like a web service: it does something when I make a semantically valid call to it.&lt;/p&gt;

&lt;p&gt;From an operational perspective, there&apos;s some added complexity as well: when I deploy this to N nodes, I&apos;ll have to have my invocation script compute the local hostname before launching the service. Admittedly this is a small problem, but I don&apos;t see why it needs to be a problem at all.&lt;/p&gt;

&lt;p&gt;What am I missing here?&lt;/p&gt;</comment>
                            <comment id="13825357" author="sergey_beryozkin" created="Mon, 18 Nov 2013 14:42:01 +0000"  >&lt;p&gt;IMHO what needs to be decided upon is: what is more important for Tika Server, for it supporting all the possible host variations out of the box or expect the users do more work when the server is accessed remotely. If the security is not an issue for the Server then it does not make sense to keep the local host by default a lot, but if it is then opening it up completely by default does not seem right - it would seem reasonable to me for users actually having to do more work in such cases, with the host calculation requiring the least of effort &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, and with setting up the server certificates taking the most of effort&lt;/p&gt;</comment>
                            <comment id="13825370" author="rianjs" created="Mon, 18 Nov 2013 14:55:26 +0000"  >&lt;p&gt;Those are more or less my thoughts. I&apos;ll solicit comments from the Tika users mailing list.&lt;/p&gt;</comment>
                            <comment id="13839706" author="rianjs" created="Thu, 5 Dec 2013 02:16:48 +0000"  >&lt;p&gt;Radio silence from the Tika mailing list. Can we get my latest patch rolled in?&lt;/p&gt;</comment>
                            <comment id="13840066" author="sergey_beryozkin" created="Thu, 5 Dec 2013 13:16:42 +0000"  >&lt;p&gt;Rian, for now I&apos;ve introduced a &apos;host&apos; property defaulted to &apos;localhost&apos;. I won&apos;t have issues if the team settles on 0.0.0.0 by default, I just can&apos;t make that decision given that I&apos;ve not been actively involved&lt;/p&gt;

&lt;p&gt;Thanks, Sergey&lt;/p&gt;</comment>
                            <comment id="13840086" author="rianjs" created="Thu, 5 Dec 2013 13:48:42 +0000"  >&lt;p&gt;Sounds reasonable. Thanks, Sergey.&lt;/p&gt;

&lt;p&gt;-Rian&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12679648">TIKA-1197</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12614305" name="tika-1196.patch" size="854" author="rianjs" created="Sun, 17 Nov 2013 22:27:50 +0000"/>
                            <attachment id="12614306" name="tika-1196b.patch" size="2342" author="rianjs" created="Sun, 17 Nov 2013 23:00:13 +0000"/>
                            <attachment id="12614310" name="tika-1196c.patch" size="2320" author="rianjs" created="Sun, 17 Nov 2013 23:53:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 16 Nov 2013 16:24:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>358930</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzjpvz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>359220</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>