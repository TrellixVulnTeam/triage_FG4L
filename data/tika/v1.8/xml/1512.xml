<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:35:42 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-1512/TIKA-1512.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-1512] WordParser fails on many Word files</title>
                <link>https://issues.apache.org/jira/browse/TIKA-1512</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;WordParser fail on some word files. A negative value is sent to substring&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Linux 64bit&lt;br/&gt;
OpenJDK Runtime Environment (IcedTea 2.4.4) (suse-24.13.5-x86_64)&lt;br/&gt;
OpenJDK 64-Bit Server VM (build 24.45-b08, mixed mode)&lt;br/&gt;
and&lt;br/&gt;
java version &quot;1.6.0&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment&lt;br/&gt;
IBM J9 VM (build 2.4, JRE 1.6.0 IBM J9 2.4 Linux amd64-64 (JIT enabled, AOT enabled)&lt;/p&gt;
</environment>
        <key id="12766780">TIKA-1512</key>
            <summary>WordParser fails on many Word files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="tuxbox">F Seid</reporter>
                        <labels>
                    </labels>
                <created>Mon, 12 Jan 2015 06:59:32 +0000</created>
                <updated>Mon, 30 Mar 2015 14:54:55 +0100</updated>
                                            <version>1.5</version>
                    <version>1.6</version>
                    <version>1.7</version>
                    <version>1.8</version>
                                                    <component>parser</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="14273266" author="tuxbox" created="Mon, 12 Jan 2015 07:03:19 +0000"  >&lt;p&gt;Seems i (still) have this or a very similar Problem (to &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-109&quot; title=&quot;WordParser fails on some Word files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-109&quot;&gt;&lt;del&gt;TIKA-109&lt;/del&gt;&lt;/a&gt;). On some Word files i get an java.lang.StringIndexOutOfBoundsException.&lt;br/&gt;
I get this errors a lot since tika 1.5 (1.4 was ok) up to snapshots of 1.7 and 1.8.&lt;br/&gt;
Can somebody help?&lt;br/&gt;
Exception in thread &quot;main&quot; org.apache.tika.exception.TikaException: Unexpected RuntimeException from org.apache.tika.parser.microsoft.OfficeParser@522fca87&lt;br/&gt;
at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:258)&lt;br/&gt;
at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:256)&lt;br/&gt;
at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:120)&lt;br/&gt;
at org.apache.tika.cli.TikaCLI$OutputType.process(TikaCLI.java:146)&lt;br/&gt;
at org.apache.tika.cli.TikaCLI.process(TikaCLI.java:440)&lt;br/&gt;
at org.apache.tika.cli.TikaCLI.main(TikaCLI.java:116)&lt;br/&gt;
Caused by: java.lang.StringIndexOutOfBoundsException: String index out of range: -1&lt;br/&gt;
at java.lang.String.substring(String.java:1911)&lt;br/&gt;
at org.apache.tika.parser.microsoft.WordExtractor.handleSpecialCharacterRuns(WordExtractor.java:407)&lt;br/&gt;
at org.apache.tika.parser.microsoft.WordExtractor.handleParagraph(WordExtractor.java:256)&lt;br/&gt;
at org.apache.tika.parser.microsoft.WordExtractor.handleParagraph(WordExtractor.java:196)&lt;br/&gt;
at org.apache.tika.parser.microsoft.WordExtractor.parse(WordExtractor.java:105)&lt;br/&gt;
at org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:201)&lt;br/&gt;
at org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:172)&lt;br/&gt;
at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:256)&lt;/p&gt;</comment>
                            <comment id="14273486" author="gagravarr" created="Mon, 12 Jan 2015 11:08:10 +0000"  >&lt;p&gt;Do you have a very small sample file that triggers the problem?&lt;/p&gt;</comment>
                            <comment id="14273515" author="tuxbox" created="Mon, 12 Jan 2015 11:48:48 +0000"  >&lt;p&gt;Sorry, but i cannot share those files. &lt;/p&gt;

&lt;p&gt;But it helped to put another check&lt;br/&gt;
in the if clause above WordExtractor.java:407 to see if lastIndexOf is&lt;br/&gt;
behind indexOf(&apos;&quot;&apos;).&lt;/p&gt;</comment>
                            <comment id="14273586" author="gagravarr" created="Mon, 12 Jan 2015 13:27:02 +0000"  >&lt;p&gt;I worry that might be solving the symptom not the problem&lt;/p&gt;

&lt;p&gt;Any chance you could step into a problem file with a debugger, and let us know what the text of each character run in a problematic paragraph are?&lt;/p&gt;</comment>
                            <comment id="14273632" author="tuxbox" created="Mon, 12 Jan 2015 14:19:52 +0000"  >&lt;p&gt;text var is like this on error (shown via jdb):&lt;/p&gt;

&lt;p&gt;text = &quot; HYPERLINK &quot;http://foo?bar=t&amp;amp;faa=&lt;a href=&quot;http://fbb/abc.html&amp;amp;fbb=tata&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://fbb/abc.html&amp;amp;fbb=tata&lt;/a&gt; &quot;&lt;/p&gt;</comment>
                            <comment id="14273681" author="gagravarr" created="Mon, 12 Jan 2015 15:14:00 +0000"  >&lt;p&gt;What about subsequent runs - I&apos;m wondering where the closing quote is for the hyperlink?&lt;/p&gt;

&lt;p&gt;Also, does the text contain the whole of the URL, or is it truncated at all?&lt;/p&gt;

&lt;p&gt;If you open the file in Word and do a save-as, does the file then parse properly, or does the problem remain?&lt;/p&gt;

&lt;p&gt;If you open the file in Word, does the hyperlink work properly in Word?&lt;/p&gt;</comment>
                            <comment id="14382010" author="genstr" created="Thu, 26 Mar 2015 15:03:56 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I guess I found the cause of this error.&lt;br/&gt;
Code of &lt;b&gt;WordExtractor&lt;/b&gt; class:&lt;/p&gt;

&lt;p&gt;         if((text.startsWith(&quot;HYPERLINK&quot;) || text.startsWith(&quot; HYPERLINK&quot;))&lt;br/&gt;
                 &amp;amp;&amp;amp; text.indexOf(&apos;&quot;&apos;) &amp;gt; -1) {&lt;br/&gt;
             String url = text.substring(                                                         // &lt;b&gt;It&apos;s failing here&lt;/b&gt;&lt;br/&gt;
                   text.indexOf(&apos;&quot;&apos;) + 1,&lt;br/&gt;
                   text.lastIndexOf(&apos;&quot;&apos;)&lt;br/&gt;
             );&lt;br/&gt;
             xhtml.startElement(&quot;a&quot;, &quot;href&quot;, url);&lt;br/&gt;
             for(CharacterRun cr : texts) &lt;/p&gt;
{
                handleCharacterRun(cr, skipStyling, xhtml);
             }
&lt;p&gt;             xhtml.endElement(&quot;a&quot;);&lt;br/&gt;
          } else &lt;/p&gt;
{
            ...
          }

&lt;p&gt;I have a number of such failing docs and some of hyperlinks looks like this:&lt;/p&gt;

&lt;p&gt;HYPERLINK &quot;http://www.accountingresearchmanager.com/wk/rm.nsf/0/7C2AE86AEDF358A1652577740025E00A?OpenDocument&#8221;      (last quote &lt;b&gt;inclined&lt;/b&gt;)&lt;br/&gt;
That&apos;s why we have here java.lang.&lt;b&gt;StringIndexOutOfBoundsException: String index out of range: -1&lt;/b&gt; for second quote.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure whether such quotes are correct and is this content or code issue.&lt;br/&gt;
I think better solution here will be to replace inclined quotes before string snippet extraction:&lt;/p&gt;

&lt;p&gt;text = &lt;b&gt;text.replace(&apos;&#8221;&apos;, &apos;&quot;&apos;);&lt;/b&gt;&lt;br/&gt;
String url = text.substring(&lt;br/&gt;
                   text.indexOf(&apos;&quot;&apos;),&lt;br/&gt;
                   text.lastIndexOf(&apos;&quot;&apos;)&lt;/p&gt;


&lt;p&gt;Best Regards,&lt;br/&gt;
Yauheni Salopiy&lt;/p&gt;</comment>
                            <comment id="14382093" author="tallison@mitre.org" created="Thu, 26 Mar 2015 15:57:34 +0000"  >&lt;p&gt;Thank you, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Genstr&quot; class=&quot;user-hover&quot; rel=&quot;Genstr&quot;&gt;Yauheni Salopiy&lt;/a&gt; for this info, do you happen to have a document you could share?  This may be a related but different issue (or it may be the same), and it would be great to have a doc from the wild for our unit tests.&lt;/p&gt;</comment>
                            <comment id="14382127" author="genstr" created="Thu, 26 Mar 2015 16:12:14 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40mitre.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@mitre.org&quot;&gt;Tim Allison&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Unfortunately these documents are the property of my customer and can&apos;t share them with You.&lt;br/&gt;
But I&apos;ll ask our content team to produce test document or provide some publically available for You tommorow.&lt;/p&gt;

&lt;p&gt;Let me know if You have any questions.&lt;/p&gt;

&lt;p&gt;Best Regards,&lt;br/&gt;
Yauheni Salopiy&lt;/p&gt;</comment>
                            <comment id="14382167" author="tallison@mitre.org" created="Thu, 26 Mar 2015 16:34:51 +0000"  >&lt;p&gt;Duh.  We have 115 of these exceptions in govdocs1.  I&apos;ll dig some of those out.  I don&apos;t want to add those to our unit tests, but we can at least play with those.&lt;/p&gt;

&lt;p&gt;If you could submit a mockup, that would still be very helpful for our unit tests.  Thank you!&lt;/p&gt;</comment>
                            <comment id="14382240" author="genstr" created="Thu, 26 Mar 2015 17:09:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40mitre.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@mitre.org&quot;&gt;Tim Allison&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Sure. I created mock document.&lt;br/&gt;
Please, see attached &lt;b&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1512&quot; title=&quot;WordParser fails on many Word files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1512&quot;&gt;TIKA-1512&lt;/a&gt;.doc&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Best regards,&lt;br/&gt;
Yauheni Salopiy&lt;/p&gt;</comment>
                            <comment id="14383118" author="tallison@mitre.org" created="Fri, 27 Mar 2015 01:01:07 +0000"  >&lt;p&gt;I looked at a handful of docs from govdocs that have this exception.  I haven&apos;t yet seen &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Genstr&quot; class=&quot;user-hover&quot; rel=&quot;Genstr&quot;&gt;Yauheni Salopiy&lt;/a&gt;&apos;s issue, but that seems fairly straightforward to fix.  The rest have no ending double quote.&lt;/p&gt;

&lt;p&gt;They seem either to end in \r (which is sneaky with println!), or they appear to be truncated at 244 characters (5 examples over 2 documents of 244 character truncation). &lt;br/&gt;
For the short ones, a hexeditor shows that there is an ending double quote after the \u000D=\r, but POI is not apparently capturing the &quot;.&lt;/p&gt;

&lt;p&gt;For cases with 244 characters...when you add in HYPERLINK, spaces and a dquote, the text lengths are 257, a number curiously similar to a rather familiar number.  With a hexeditor, you can see that the long hyperlinks just end, then there is a \u0020 and \u0014 (special text boundary markers, I assume?), and the regular text starts up again.&lt;/p&gt;

&lt;p&gt;For 040044.doc, this what I get when I print text before the exception:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;HYPERLINK &quot;http://www.nib.org\r
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For 046839.doc, I get this:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;HYPERLINK &quot;http://web23.epnet.com/citation.asp?tb=1&amp;amp;_ug=dbs+0+ln+en%2Dus+sid+A7E7DA92%2D0BCF%2D42B2%2D807F%2D81A01D77748E%40sessionmgr3%2Dsessionmgr4+B360&amp;amp;_us=bs+TX++perceived++And+++inhibitors++And+++mathematics+db+0+ds+TX++perceived++And+++inhibitors++A 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At the Tika level, I think we should be more defensive about calling substring.  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gagravarr&quot; class=&quot;user-hover&quot; rel=&quot;gagravarr&quot;&gt;Nick Burch&lt;/a&gt;, if you&apos;d be able to take a look at the POI level to see if something is going wrong there, that&apos;d be great!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tuxbox&quot; class=&quot;user-hover&quot; rel=&quot;tuxbox&quot;&gt;F Seid&lt;/a&gt;,  can you tell us if the original link happened to end in \r or if the link was really long?&lt;/p&gt;</comment>
                            <comment id="14383125" author="tallison@mitre.org" created="Fri, 27 Mar 2015 01:04:18 +0000"  >&lt;p&gt;docs referenced&lt;/p&gt;</comment>
                            <comment id="14383162" author="tallison@mitre.org" created="Fri, 27 Mar 2015 01:30:43 +0000"  >&lt;p&gt;For the few I tried, the short links do work in the original .doc file, but the long links don&apos;t.&lt;/p&gt;</comment>
                            <comment id="14386697" author="tallison@mitre.org" created="Mon, 30 Mar 2015 14:31:09 +0100"  >&lt;p&gt;Temporary fix ignoring tests and excluding test docs derived from govdocs1 in r1670090.  Added test and doc for hyperlink ending in double smart quotes, with thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Genstr&quot; class=&quot;user-hover&quot; rel=&quot;Genstr&quot;&gt;Yauheni Salopiy&lt;/a&gt; for creating that test doc!&lt;/p&gt;</comment>
                            <comment id="14386716" author="genstr" created="Mon, 30 Mar 2015 14:48:19 +0100"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40mitre.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@mitre.org&quot;&gt;Tim Allison&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Thank You very much &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Best Regards,&lt;br/&gt;
Yauheni Salopiy&lt;/p&gt;</comment>
                            <comment id="14386720" author="hudson" created="Mon, 30 Mar 2015 14:49:28 +0100"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.7 #584 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.7/584/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.7/584/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1512&quot; title=&quot;WordParser fails on many Word files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1512&quot;&gt;TIKA-1512&lt;/a&gt; temporary workaround.  Currently not including test docs or tests that derive from govdocs1 (tallison: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1670090&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1670090&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/main/java/org/apache/tika/parser/microsoft/WordExtractor.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/java/org/apache/tika/parser/microsoft/WordParserTest.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/resources/test-documents/testWORD_closingSmartQInHyperLink.doc&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                            <outwardlinks description="is a clone of">
                                        <issuelink>
            <issuekey id="12385079">TIKA-109</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12707539" name="016723.doc" size="69632" author="tallison@mitre.org" created="Thu, 26 Mar 2015 17:07:04 +0000"/>
                            <attachment id="12707663" name="040044.doc" size="710144" author="tallison@mitre.org" created="Fri, 27 Mar 2015 01:04:18 +0000"/>
                            <attachment id="12707664" name="046839.doc" size="382976" author="tallison@mitre.org" created="Fri, 27 Mar 2015 01:04:18 +0000"/>
                            <attachment id="12707540" name="TIKA-1512.doc" size="26624" author="Genstr" created="Thu, 26 Mar 2015 17:09:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 12 Jan 2015 11:08:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzy4jb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>