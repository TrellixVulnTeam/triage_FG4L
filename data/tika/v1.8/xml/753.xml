<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:38:03 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-753/TIKA-753.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-753] Improve performance when parsing embedded Office docs</title>
                <link>https://issues.apache.org/jira/browse/TIKA-753</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description></description>
                <environment></environment>
        <key id="12527246">TIKA-753</key>
            <summary>Improve performance when parsing embedded Office docs</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikemccand">Michael McCandless</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Oct 2011 19:27:13 +0100</created>
                <updated>Thu, 20 Oct 2011 13:37:00 +0100</updated>
                            <resolved>Thu, 20 Oct 2011 13:37:00 +0100</resolved>
                                                    <fixVersion>1.0</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13127758" author="mikemccand" created="Fri, 14 Oct 2011 19:29:04 +0100"  >&lt;p&gt;I noticed that when we parse an embedded Office document, it&apos;s&lt;br/&gt;
inefficient because we take the NPOIFileSystem we had already parsed&lt;br/&gt;
(from the full document) and write the &quot;sub-directory&quot; containing the&lt;br/&gt;
embedded document to a temp file, only to re-parse it again once we&apos;ve&lt;br/&gt;
recursed to the inner detector/parser.&lt;/p&gt;

&lt;p&gt;I worked out a patch to instead just directly pass the sub-directory&lt;br/&gt;
of the embedded document directly to the inner detector/parser.&lt;/p&gt;

&lt;p&gt;This gives a good speedup in my test case: I have a private test set&lt;br/&gt;
of 2,080 Word docs; parsing them (and their embedded docs) takes 16.1&lt;br/&gt;
on trunk and 10.7 sec with this patch &amp;#8211; 34% faster (best of 10).&lt;/p&gt;

&lt;p&gt;The change has a few parts:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Fixed all Office parsers to alternatively directly take the&lt;br/&gt;
    document root (DirectoryNode); this was straightforward (but&lt;br/&gt;
    touched a lot of sources) because internally these parsers were&lt;br/&gt;
    extracting that root anyway.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Fixed AbstractPOIFSExtractor to not do the serialization to a temp&lt;br/&gt;
    file and instead put the document&apos;s root on an otherwise empty&lt;br/&gt;
    (new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;) TikaInputStream as the openContainer.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Fixed OfficeParser and POIFSContainerDetector to recognize a&lt;br/&gt;
    DirectoryNode on the incoming TikaInputStream, and parse/detect&lt;br/&gt;
    that directly.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The one catch I hit was a failure in POIContainerExtractionTest, due&lt;br/&gt;
to already-fixed bug 51949 in POI (NPE on double-close of&lt;br/&gt;
ZipFileZipEntrySource); I added a workaround in&lt;br/&gt;
ParsingEmbeddedDocumentExtractor for this, with a TODO to remove the&lt;br/&gt;
workaround once POI releases and we upgrade.  It&apos;s important to remove&lt;br/&gt;
that because we are double-opening the ZIP archive now for embedded&lt;br/&gt;
OOXML docs...&lt;/p&gt;

&lt;p&gt;I also converted a couple if/else string equal chains into HashMap&lt;br/&gt;
lookups.&lt;/p&gt;</comment>
                            <comment id="13127761" author="mikemccand" created="Fri, 14 Oct 2011 19:30:16 +0100"  >&lt;p&gt;Patch.&lt;/p&gt;</comment>
                            <comment id="13128135" author="gagravarr" created="Sat, 15 Oct 2011 12:18:09 +0100"  >&lt;p&gt;Patch looks fine to me&lt;/p&gt;

&lt;p&gt;I&apos;ve added a static constructor on Ole10Native to create from a DirectoryNode, as well as POIFSFileSystem, which&apos;ll let that bit be tidied up later&lt;/p&gt;</comment>
                            <comment id="13128145" author="mikemccand" created="Sat, 15 Oct 2011 13:27:08 +0100"  >&lt;p&gt;Awesome, thanks Nick!&lt;/p&gt;

&lt;p&gt;I&apos;ll add a TODO where we use Ole10Native to cutover to DirectoryNode once we upgrade POI.  And then I guess leave this issue open after committing to remind us to go back and do these two TODOs...&lt;/p&gt;</comment>
                            <comment id="13128924" author="mikemccand" created="Mon, 17 Oct 2011 16:00:46 +0100"  >&lt;p&gt;OK I committed this; I&apos;ll leave it open so we remember to do the TODOs on next POI upgrade.&lt;/p&gt;</comment>
                            <comment id="13131561" author="mikemccand" created="Thu, 20 Oct 2011 13:37:00 +0100"  >&lt;p&gt;I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-757&quot; title=&quot;Address TODOs when we upgrade to next POI release (3.8 beta 5)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-757&quot;&gt;&lt;del&gt;TIKA-757&lt;/del&gt;&lt;/a&gt; as the blanket issue for addressing TODOs on next POI upgrade so I think we can now resolve this one.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12499081" name="TIKA-753.patch" size="36134" author="mikemccand" created="Fri, 14 Oct 2011 19:30:16 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 15 Oct 2011 11:18:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>85634</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx1un:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16619</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>