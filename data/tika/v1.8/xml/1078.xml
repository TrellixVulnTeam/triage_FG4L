<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:36:24 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-1078/TIKA-1078.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-1078] TikaCLI: invalid characters in embedded document name causes FNFE when trying to save</title>
                <link>https://issues.apache.org/jira/browse/TIKA-1078</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;Attached document hits this on Windows:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;C:\&amp;gt;java.exe -jar tika-app-1.3.jar -z -x c:\data\idit\T-DS_Excel2003-PPT2003_1.xls
Extracting &apos;file0.png&apos; (image/png) to .\file0.png
Extracting &apos;file1.emf&apos; (application/x-emf) to .\file1.emf
Extracting &apos;file2.jpg&apos; (image/jpeg) to .\file2.jpg
Extracting &apos;file3.emf&apos; (application/x-emf) to .\file3.emf
Extracting &apos;file4.wmf&apos; (application/x-msmetafile) to .\file4.wmf
Extracting &apos;MBD0016BDE4/?&#163;&#9786;.bin&apos; (application/octet-stream) to .\MBD0016BDE4\?&#163;&#9786;.bin
Exception in thread &quot;main&quot; org.apache.tika.exception.TikaException: TIKA-198: Illegal IOException from org.apache.tika.parser.microsoft.OfficeParser@75f875f8
        at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:248)
        at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)
        at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:120)
        at org.apache.tika.cli.TikaCLI$OutputType.process(TikaCLI.java:139)
        at org.apache.tika.cli.TikaCLI.process(TikaCLI.java:415)
        at org.apache.tika.cli.TikaCLI.main(TikaCLI.java:109)
Caused by: java.io.FileNotFoundException: .\MBD0016BDE4\?&#163;&#9786;.bin (The filename, directory name, or volume label syntax is incorrect.)
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:205)
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:156)
        at org.apache.tika.cli.TikaCLI$FileEmbeddedDocumentExtractor.parseEmbedded(TikaCLI.java:722)
        at org.apache.tika.parser.microsoft.AbstractPOIFSExtractor.handleEmbeddedOfficeDoc(AbstractPOIFSExtractor.java:201)
        at org.apache.tika.parser.microsoft.ExcelExtractor.parse(ExcelExtractor.java:158)
        at org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:194)
        at org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:161)
        at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)
        ... 5 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;TikaCLI manages to create the sub-directory, but because the embedded fileName has invalid (for Windows) characters, it fails.&lt;/p&gt;

&lt;p&gt;On Linux it runs fine.&lt;/p&gt;

&lt;p&gt;I think somehow ... we have to sanitize the embedded file name ...&lt;/p&gt;</description>
                <environment></environment>
        <key id="12630872">TIKA-1078</key>
            <summary>TikaCLI: invalid characters in embedded document name causes FNFE when trying to save</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Feb 2013 13:21:59 +0000</created>
                <updated>Tue, 25 Mar 2014 16:21:47 +0000</updated>
                            <resolved>Tue, 14 Jan 2014 10:28:56 +0000</resolved>
                                                    <fixVersion>1.5</fixVersion>
                                    <component>cli</component>
                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13667851" author="chrismattmann" created="Mon, 27 May 2013 17:56:57 +0100"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;push to 1.5, get ready for 1.4 RC #1.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13868987" author="stefanofornari" created="Sun, 12 Jan 2014 10:05:01 +0000"  >&lt;p&gt;I&apos;d like to fix this one as a way to get familiar with tika.&lt;br/&gt;
I have a couple of questions:&lt;/p&gt;

&lt;p&gt;1. As far as I understand it (and based on the tests I have done) the problem here is with special characters not allowed in file names by the different file systems, not to special (i.e. not ASCII or UTF8) characters. can anyone confirm?&lt;br/&gt;
2. Is there any general policy in tika development I should follow wrt java version? shall I stick to a particular version of java, or can I go with Java 7?&lt;/p&gt;
</comment>
                            <comment id="13869021" author="mikemccand" created="Sun, 12 Jan 2014 12:15:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;d like to fix this one as a way to get familiar with tika.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Wonderful!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;1. As far as I understand it (and based on the tests I have done) the problem here is with special characters not allowed in file names by the different file systems, not to special (i.e. not ASCII or UTF8) characters. can anyone confirm?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, I think so.  I.e., each OS/filesystem imposes its own restrictions on what characters are allowed in a filename.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;2. Is there any general policy in tika development I should follow wrt java version? shall I stick to a particular version of java, or can I go with Java 7?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Tika must work with Java 6 ... so you can use Java 7 for development, but before committing we need to make sure it works on Java 6 as well.&lt;/p&gt;</comment>
                            <comment id="13869053" author="stefanofornari" created="Sun, 12 Jan 2014 14:08:47 +0000"  >&lt;p&gt;I have the patch ready. I can not find a way to attach it here, I am posting it to the dev list. I followed a more conservative approach so that the characters that may be reserved by a operating system or file systems are turned into an hex code. This because this is transparent to all platforms and the behaviour will be the same on all platform.&lt;/p&gt;</comment>
                            <comment id="13869073" author="kkrugler" created="Sun, 12 Jan 2014 16:11:42 +0000"  >&lt;p&gt;Attaching for Stefano&lt;/p&gt;</comment>
                            <comment id="13869205" author="mikemccand" created="Mon, 13 Jan 2014 00:30:26 +0000"  >&lt;p&gt;Thanks Stefano!&lt;/p&gt;

&lt;p&gt;Can you fix the license header on the two new files to match the current sources?  Thanks.&lt;/p&gt;

&lt;p&gt;Also, we don&apos;t normally include @ author tags.&lt;/p&gt;

&lt;p&gt;Maybe use a HashSet instead of an array for RESERVED, so it&apos;s not an O(N) lookup per character?  Also, since you check for &amp;lt; &apos; &apos;, you shouldn&apos;t need any entries &amp;lt; 0x20?&lt;/p&gt;

&lt;p&gt;Sometimes (rarely?), attachment filenames have their own sub-directories, and the code today will happily .mkdirs those subdirectories, but it looks like with this patch we now replace / and \ with their hex equivalents, instead?  I think that&apos;s OK...&lt;/p&gt;</comment>
                            <comment id="13870125" author="stefanofornari" created="Mon, 13 Jan 2014 23:35:53 +0000"  >&lt;p&gt;Hi Michael,&lt;br/&gt;
thanks for the review. I took into account all your comments. About the directory structure, I reverted my change now that I understood better the original behaviour. I think the original behaviour is cleaner and nicer.&lt;/p&gt;

&lt;p&gt;attaching the new patch.&lt;/p&gt;</comment>
                            <comment id="13870603" author="mikemccand" created="Tue, 14 Jan 2014 10:28:56 +0000"  >&lt;p&gt;Thanks Stefano, I made one small change (added generics: HashSet&amp;lt;Character&amp;gt;) and committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12567997" name="T-DS_Excel2003-PPT2003_1.xls" size="1433600" author="mikemccand" created="Tue, 5 Feb 2013 13:22:35 +0000"/>
                            <attachment id="12622730" name="tika-1078-2.patch" size="8731" author="stefanofornari" created="Mon, 13 Jan 2014 23:35:45 +0000"/>
                            <attachment id="12622545" name="tika-1078.patch" size="8495" author="kkrugler" created="Sun, 12 Jan 2014 16:11:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 27 May 2013 16:56:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>311368</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzbl2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>311714</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>