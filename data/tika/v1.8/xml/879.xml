<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:35:47 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-879/TIKA-879.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-879] Detection problem: message/rfc822 file is detected as text/plain.</title>
                <link>https://issues.apache.org/jira/browse/TIKA-879</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;When using &lt;tt&gt;DefaultDetector&lt;/tt&gt; mime type for &lt;tt&gt;.eml&lt;/tt&gt; files is different (you can test it on &lt;tt&gt;testRFC822&lt;/tt&gt; and &lt;tt&gt;testRFC822_base64&lt;/tt&gt; in &lt;tt&gt;tika-parsers/src/test/resources/test-documents/&lt;/tt&gt;).&lt;/p&gt;

&lt;p&gt;Main reason for such behavior is that only magic detector is really works for such files. Even if you set &lt;tt&gt;CONTENT_TYPE&lt;/tt&gt; in metadata or some &lt;tt&gt;.eml&lt;/tt&gt; file name in &lt;tt&gt;RESOURCE_NAME_KEY&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;As I found &lt;tt&gt;MediaTypeRegistry.isSpecializationOf(&quot;message/rfc822&quot;, &quot;text/plain&quot;)&lt;/tt&gt; returns &lt;tt&gt;false&lt;/tt&gt;, so detection by &lt;tt&gt;MimeTypes.detect(...)&lt;/tt&gt; works only by magic.&lt;/p&gt;</description>
                <environment>&lt;p&gt;linux 3.2.9&lt;br/&gt;
oracle jdk7, openjdk7, sun jdk6&lt;/p&gt;</environment>
        <key id="12547381">TIKA-879</key>
            <summary>Detection problem: message/rfc822 file is detected as text/plain.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="grossws">Konstantin Gribov</reporter>
                        <labels>
                            <label>new-parser</label>
                    </labels>
                <created>Wed, 21 Mar 2012 13:44:02 +0000</created>
                <updated>Wed, 22 Apr 2015 19:10:23 +0100</updated>
                                            <version>1.0</version>
                    <version>1.1</version>
                    <version>1.2</version>
                                                    <component>metadata</component>
                    <component>mime</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13502287" author="vladimir_l" created="Wed, 21 Nov 2012 20:30:49 +0000"  >&lt;p&gt;I&apos;ve got the same problem: trying to parse Outlook Express file: *.eml and get default &quot;text/plain&quot; Content-Type instead of expected &quot;message/rfc822&quot;&lt;/p&gt;

&lt;p&gt;I&apos;m using &lt;tt&gt;org.apache.tika.parser.AutoDetectParser&lt;/tt&gt; with default settings and during debugging came to the same conclusion as a reporter of this issue: &quot;MediaTypeRegistry.isSpecializationOf(&quot;message/rfc822&quot;, &quot;text/plain&quot;) returns false&quot;.&lt;/p&gt;

&lt;p&gt;If there is a way to vote for this bug to be fixed, or easy work around, please share it with us!&lt;/p&gt;</comment>
                            <comment id="13502393" author="vladimir_l" created="Wed, 21 Nov 2012 22:48:57 +0000"  >&lt;p&gt;I figured out where the root of problem lays on.&lt;br/&gt;
The original Tika configuration for &quot;message/rfc822&quot; is following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;mime-type type=&lt;span class=&quot;code-quote&quot;&gt;&quot;message/rfc822&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;magic priority=&lt;span class=&quot;code-quote&quot;&gt;&quot;50&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match value=&lt;span class=&quot;code-quote&quot;&gt;&quot;Relay-Version:&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match value=&lt;span class=&quot;code-quote&quot;&gt;&quot;#!\ rnews&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match value=&lt;span class=&quot;code-quote&quot;&gt;&quot;N#!\ rnews&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match value=&lt;span class=&quot;code-quote&quot;&gt;&quot;Forward\ to&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match value=&lt;span class=&quot;code-quote&quot;&gt;&quot;Pipe\ to&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match value=&lt;span class=&quot;code-quote&quot;&gt;&quot;Return-Path:&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match value=&lt;span class=&quot;code-quote&quot;&gt;&quot;From:&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match value=&lt;span class=&quot;code-quote&quot;&gt;&quot;Received:&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;Message-ID:&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;Date:&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/magic&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;glob pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;*.eml&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;glob pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;*.mime&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;glob pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;*.mht&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;glob pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;*.mhtml&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/mime-type&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Unfortunately the e-mail message I&apos;m testing with has following header:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
x-store-info:J++/JTCzmObr++wNraA4 .....
Authentication-Results: something.com; sender-id= ......
X-SID-PRA: vladimir_l@example.com
X-SID-Result: Pass
X-DKIM-Result: None
X-AUTH-Result: PASS
X-Message-Status: n:n
X-Message-Delivery: Vj0xLjE7dXM .....
X-Message-Info: aKlYzGSc+Ll01bU5 ....
Received: from mailout- ....
Received: (qmail invoked by alias); 21 Nov 2012 20:11:35 -0000
Received: from mp017. ....
X-Authenticated: #2407 ....
X-Provags-ID: V01U2FsdGVkX ....
Received: (qmail 22194 invoked by uid 0); 21 Nov 2012 20:11:34 -0000
Received: from ....
Content-Type: text/plain; charset=&lt;span class=&quot;code-quote&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;
Date: Wed, 21 Nov 2012 21:11:32 +0100
From: &lt;span class=&quot;code-quote&quot;&gt;&quot;Vladimir L.&quot;&lt;/span&gt; &amp;lt;vladimir_l@example.com&amp;gt;
Message-ID: &amp;lt;20121121201132.74140@example.com&amp;gt;
MIME-Version: 1.0
Subject: JUnit test message
To: vladimir_l@something.com
X-Flags: 0001
X-Mailer: WWW-Mail 6100 (Global Message Exchange)
X-Priority: 3
Content-Transfer-Encoding: 8bit
Return-Path: vladimir_l@example.com
X-OriginalArrivalTime: 21 Nov 2012 20:11:36.0285 ....

Dear Vladimir .....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see none of the mentioned patterns is matching since they are all configured with offset=&quot;0&quot;&lt;br/&gt;
However the e-mail header defines the Content-Type: text/plain, which i assume influence the initial content type detection.&lt;br/&gt;
The &lt;tt&gt;&amp;lt;sub-class-of type=&quot;text/plain&quot;/&amp;gt;&lt;/tt&gt; is not defined in mime-type definition, therefore auto-detection via extension *.eml fails for aforementioned reason of this issue.&lt;/p&gt;

&lt;p&gt;The current workaround for me is following:&lt;br/&gt;
1. Create &lt;tt&gt;custom-mimetypes.xml&lt;/tt&gt; as described here: &lt;a href=&quot;http://tika.apache.org/1.0/parser_guide.html#Add_your_MIME-Type&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://tika.apache.org/1.0/parser_guide.html#Add_your_MIME-Type&lt;/a&gt;&lt;br/&gt;
2. Add redefinition for &quot;message/rfc822&quot; mime-type as following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;mime-type type=&lt;span class=&quot;code-quote&quot;&gt;&quot;message/rfc822&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;magic priority=&lt;span class=&quot;code-quote&quot;&gt;&quot;50&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match value=&lt;span class=&quot;code-quote&quot;&gt;&quot;Relay-Version:&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match value=&lt;span class=&quot;code-quote&quot;&gt;&quot;#!\ rnews&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match value=&lt;span class=&quot;code-quote&quot;&gt;&quot;N#!\ rnews&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match value=&lt;span class=&quot;code-quote&quot;&gt;&quot;Forward\ to&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match value=&lt;span class=&quot;code-quote&quot;&gt;&quot;Pipe\ to&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match value=&lt;span class=&quot;code-quote&quot;&gt;&quot;Return-Path:&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0:2000&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match value=&lt;span class=&quot;code-quote&quot;&gt;&quot;From:&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match value=&lt;span class=&quot;code-quote&quot;&gt;&quot;Received:&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0:2000&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match value=&lt;span class=&quot;code-quote&quot;&gt;&quot;Message-ID:&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0:2000&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;match value=&lt;span class=&quot;code-quote&quot;&gt;&quot;Date:&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; offset=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/magic&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;glob pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;*.eml&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;glob pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;*.mime&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;glob pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;*.mht&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;glob pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;*.mhtml&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;sub-class-of type=&lt;span class=&quot;code-quote&quot;&gt;&quot;text/plain&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/mime-type&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note the offset settings for &lt;b&gt;Message-ID:&lt;/b&gt;, &lt;b&gt;Return-Path:&lt;/b&gt;, and &lt;b&gt;Received:&lt;/b&gt;&lt;br/&gt;
I decided to leave fall-back to extension detection through definition of super-class &lt;tt&gt;text/plain&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Hope this will help you to go around this issue too.&lt;/p&gt;

&lt;p&gt;Good luck,&lt;br/&gt;
vladimir&lt;/p&gt;</comment>
                            <comment id="14256970" author="wastl-nagel" created="Tue, 23 Dec 2014 13:39:30 +0000"  >&lt;p&gt;I&apos;ve run into the same problem with an .eml file written by Thunderbird (see attachment).&lt;/p&gt;

&lt;p&gt;RFC822 states (&lt;a href=&quot;http://tools.ietf.org/html/rfc822#section-4.1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://tools.ietf.org/html/rfc822#section-4.1&lt;/a&gt;) that header fields can appear in any order:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Note: Due to an artifact of the notational conventions, the syntax indicates that, when present, some fields, must be in a particular order.  Header fields are NOT required to occur in any particular order, except that the message body must occur AFTER the headers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If one of the &quot;optional&quot; fields (according to RFC822), esp. &quot;extension-field&quot; (&quot;X-...&quot;) or any &quot;user-defined-field&quot;, is the first field in the header the mime magic does not work. &lt;/p&gt;

&lt;p&gt;Adding &lt;tt&gt;&amp;lt;sub-class-of type=&quot;text/plain&quot;/&amp;gt;&lt;/tt&gt; would solve the problem only partially: if any text file is named *.eml, it is always recognized as message/rfc822 independent from its content. Is the file name/extension a strong indicator?&lt;/p&gt;

&lt;p&gt;Or would it be possible to relax the MIME magic and allow additional header fields at the beginning?&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;check for the &lt;tt&gt;field: value&lt;/tt&gt; structure first&lt;/li&gt;
	&lt;li&gt;then check for (some) required fields (&quot;Date:&quot;, &quot;From:&quot;) but also if not immediately at beginning&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14256984" author="lfcnassif" created="Tue, 23 Dec 2014 14:06:37 +0000"  >&lt;p&gt;I have had this issue too with a lot of files and currently I am using the same workaround as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vladimir_l&quot; class=&quot;user-hover&quot; rel=&quot;vladimir_l&quot;&gt;Vladimir L.&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14257888" author="gagravarr" created="Wed, 24 Dec 2014 03:17:29 +0000"  >&lt;p&gt;I&apos;ve done something a little different in r1647721 as a partial workaround - I&apos;ve added a new mimetype of text/x-tika-text-based-message which is a parent of the 3 text-based message/ mimetypes (most of the message/ mimetypes are not text based). With that in place, Vladimir&apos;s test email is now correctly detected when it has a .eml extension. (I think that this parent probably is more semantically meaningful than text/plain, which is why I went for it)&lt;/p&gt;

&lt;p&gt;However, this doesn&apos;t solve the &quot;detection without filename&quot; issue, and some other related mail detection problems (eg multipart/signed). We might therefore want to think about adding a new mail detector, along the lines of the one suggested in this Stack Overflow question from a few weeks back - &lt;a href=&quot;http://stackoverflow.com/questions/27397807/tika-detect-multipart-signed&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://stackoverflow.com/questions/27397807/tika-detect-multipart-signed&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14257918" author="hudson" created="Wed, 24 Dec 2014 03:41:39 +0000"  >&lt;p&gt;UNSTABLE: Integrated in tika-trunk-jdk1.7 #387 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.7/387/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.7/387/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-879&quot; title=&quot;Detection problem: message/rfc822 file is detected as text/plain.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-879&quot;&gt;TIKA-879&lt;/a&gt; Add a new parent mime type, for the text based message formats, of text/x-tika-text-based-message, which allows Thunderbird messages to be correctly detected as they now show up as being text based not binary based in the hierarchy (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1647721&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1647721&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-core/src/main/resources/org/apache/tika/mime/tika-mimetypes.xml&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/java/org/apache/tika/mime/TestMimeTypes.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14257927" author="hudson" created="Wed, 24 Dec 2014 03:59:28 +0000"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.6 #372 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.6/372/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.6/372/&lt;/a&gt;)&lt;br/&gt;
Missing test file from &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-879&quot; title=&quot;Detection problem: message/rfc822 file is detected as text/plain.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-879&quot;&gt;TIKA-879&lt;/a&gt; (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1647725&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1647725&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/resources/test-documents/testThunderbirdEml.eml&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-879&quot; title=&quot;Detection problem: message/rfc822 file is detected as text/plain.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-879&quot;&gt;TIKA-879&lt;/a&gt; Add a new parent mime type, for the text based message formats, of text/x-tika-text-based-message, which allows Thunderbird messages to be correctly detected as they now show up as being text based not binary based in the hierarchy (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1647721&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1647721&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-core/src/main/resources/org/apache/tika/mime/tika-mimetypes.xml&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/java/org/apache/tika/mime/TestMimeTypes.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14257953" author="hudson" created="Wed, 24 Dec 2014 04:41:47 +0000"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.7 #388 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.7/388/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.7/388/&lt;/a&gt;)&lt;br/&gt;
Missing test file from &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-879&quot; title=&quot;Detection problem: message/rfc822 file is detected as text/plain.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-879&quot;&gt;TIKA-879&lt;/a&gt; (nick: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1647725&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1647725&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/test/resources/test-documents/testThunderbirdEml.eml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14258264" author="lfcnassif" created="Wed, 24 Dec 2014 14:08:37 +0000"  >&lt;p&gt;Nick,&lt;br/&gt;
Could we add the extended offsets proposed by Wladimir? I am using 0:1000 range with the same patterns as him. It helped a lot to detect mails without extension and I am getting no false positives.&lt;/p&gt;</comment>
                            <comment id="14342670" author="tpalsulich" created="Mon, 2 Mar 2015 03:37:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lfcnassif&quot; class=&quot;user-hover&quot; rel=&quot;lfcnassif&quot;&gt;Luis Filipe Nassif&lt;/a&gt;, that seems like a reasonable solution. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gagravarr&quot; class=&quot;user-hover&quot; rel=&quot;gagravarr&quot;&gt;Nick Burch&lt;/a&gt;, any objections to widening the range of the offset for magic detection?&lt;/p&gt;</comment>
                            <comment id="14342738" author="gagravarr" created="Mon, 2 Mar 2015 04:52:14 +0000"  >&lt;p&gt;It might be good to try the widened versions with Tika Batch, to see if on a wide range of files it causes any noticable slowdown or false positives?&lt;/p&gt;

&lt;p&gt;I still think this isn&apos;t a file format that can be fully reliably detected with mime magic alone, and ideally we do need a dedicated detector for it as mentioned above, to fully solve this and related (eg multipart/signed) detection&lt;/p&gt;</comment>
                            <comment id="14501468" author="chrismattmann" created="Sat, 18 Apr 2015 17:53:31 +0100"  >&lt;p&gt;So &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeremybmerrill&quot; class=&quot;user-hover&quot; rel=&quot;jeremybmerrill&quot;&gt;Jeremy B. Merrill&lt;/a&gt; proposed &lt;a href=&quot;https://github.com/apache/tika/pull/40&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/tika/pull/40&lt;/a&gt; as a solution to this. Nick, Konstantin - can you guys take a look and see if we can figure out how to get that included since we have code now that is fixing this.&lt;/p&gt;</comment>
                            <comment id="14505132" author="lfcnassif" created="Tue, 21 Apr 2015 16:37:44 +0100"  >&lt;p&gt;Maybe we could keep the original magics and ADD the widened versions with a &quot;\n&quot; prefix to decrease the number of false positives (I have got a small number of them)? Could you try the widened magics with govdocs1 &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40mitre.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@mitre.org&quot;&gt;Tim Allison&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14505269" author="tallison@mitre.org" created="Tue, 21 Apr 2015 18:00:03 +0100"  >&lt;p&gt;Y, will do. Results probably tomorrow.&lt;/p&gt;

&lt;p&gt;This?&lt;br/&gt;
&amp;lt;mime-type type=&quot;message/rfc822&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;magic priority=&quot;50&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;match value=&quot;Relay-Version:&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;match value=&quot;#!\ rnews&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;match value=&quot;N#!\ rnews&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;match value=&quot;Forward\ to&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;match value=&quot;Pipe\ to&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;match value=&quot;Return-Path:&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;match value=&quot;\nReturn-Path:&quot; type=&quot;string&quot; offset=&quot;0:1000&quot;/&amp;gt;&lt;br/&gt;
     &amp;lt;match value=&quot;From:&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;match value=&quot;Received:&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;&lt;br/&gt;
     &amp;lt;match value=&quot;\nReceived:&quot; type=&quot;string&quot; offset=&quot;0:1000&quot;/&amp;gt;&lt;br/&gt;
     &amp;lt;match value=&quot;Message-ID:&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;match value=&quot;\nMessage-ID:&quot; type=&quot;string&quot; offset=&quot;0:1000&quot;/&amp;gt;&lt;br/&gt;
     &amp;lt;match value=&quot;Date:&quot; type=&quot;string&quot; offset=&quot;0&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/magic&amp;gt;&lt;br/&gt;
    &amp;lt;glob pattern=&quot;*.eml&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;glob pattern=&quot;*.mime&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;glob pattern=&quot;*.mht&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;glob pattern=&quot;*.mhtml&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;sub-class-of type=&quot;text/plain&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;/mime-type&amp;gt;&lt;/p&gt;</comment>
                            <comment id="14505367" author="lfcnassif" created="Tue, 21 Apr 2015 18:52:43 +0100"  >&lt;p&gt;Yes, thank you very much for testing with govdocs1 (&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gagravarr&quot; class=&quot;user-hover&quot; rel=&quot;gagravarr&quot;&gt;Nick Burch&lt;/a&gt;&apos;s suggestion)!&lt;/p&gt;</comment>
                            <comment id="14505368" author="lfcnassif" created="Tue, 21 Apr 2015 18:52:44 +0100"  >&lt;p&gt;Yes, thank you very much for testing with govdocs1 (&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gagravarr&quot; class=&quot;user-hover&quot; rel=&quot;gagravarr&quot;&gt;Nick Burch&lt;/a&gt;&apos;s suggestion)!&lt;/p&gt;</comment>
                            <comment id="14507577" author="tallison@mitre.org" created="Wed, 22 Apr 2015 19:10:23 +0100"  >&lt;p&gt;Only about ~300 more rfc822 files.  I&apos;ll manually review some to see if the increase is good or bad.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12820178">TIKA-1602</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12688849" name="TIKA-879-thunderbird.eml" size="758" author="wastl-nagel" created="Tue, 23 Dec 2014 13:39:30 +0000"/>
                            <attachment id="12727295" name="mime_diffs_A_to_B.html" size="1294" author="tallison@mitre.org" created="Wed, 22 Apr 2015 19:10:23 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 21 Nov 2012 20:30:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>232539</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx12n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16493</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>