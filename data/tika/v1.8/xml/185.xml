<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:32:03 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-185/TIKA-185.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-185] XML files with (unsatisfied) SYSTEM entities can not be extracted</title>
                <link>https://issues.apache.org/jira/browse/TIKA-185</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;When trying to extract an XPI file (Firefox extenstion, which probably is not a best candidate for extract) I got the below exception.&lt;br/&gt;
It was caused by SYSTEM entities refering the chrome:// protocol.&lt;br/&gt;
However, obviously any XML file that contains SYSTEM entities which can not be accessed at the time of extraction will not be extracted properly.&lt;/p&gt;

&lt;p&gt;Here is the stack trace:&lt;/p&gt;

&lt;p&gt;java.net.MalformedURLException: unknown protocol: chrome&lt;br/&gt;
   at java.net.URL.&amp;lt;init&amp;gt;(URL.java:574)&lt;br/&gt;
   at java.net.URL.&amp;lt;init&amp;gt;(URL.java:464)&lt;br/&gt;
   at java.net.URL.&amp;lt;init&amp;gt;(URL.java:413)&lt;br/&gt;
   at org.apache.xerces.impl.XMLEntityManager.setupCurrentEntity(Unknown Source)&lt;br/&gt;
   at org.apache.xerces.impl.XMLEntityManager.startEntity(Unknown Source)&lt;br/&gt;
   at org.apache.xerces.impl.XMLEntityManager.startEntity(Unknown Source)&lt;br/&gt;
   at org.apache.xerces.impl.XMLDTDScannerImpl.startPE(Unknown Source)&lt;br/&gt;
   at org.apache.xerces.impl.XMLDTDScannerImpl.skipSeparator(Unknown Source)&lt;br/&gt;
   at org.apache.xerces.impl.XMLDTDScannerImpl.scanDecls(Unknown Source)&lt;br/&gt;
   at org.apache.xerces.impl.XMLDTDScannerImpl.scanDTDInternalSubset(Unknown Source)&lt;br/&gt;
   at org.apache.xerces.impl.XMLDocumentScannerImpl$DTDDispatcher.dispatch(Unknown Source)&lt;br/&gt;
   at org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)&lt;br/&gt;
   at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)&lt;br/&gt;
   at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)&lt;br/&gt;
   at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)&lt;br/&gt;
   at org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)&lt;br/&gt;
   at javax.xml.parsers.SAXParser.parse(SAXParser.java:395)&lt;br/&gt;
   at javax.xml.parsers.SAXParser.parse(SAXParser.java:198)&lt;br/&gt;
   at org.apache.tika.parser.xml.XMLParser.parse(XMLParser.java:57)&lt;br/&gt;
   at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:108)&lt;br/&gt;
   at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:80)&lt;br/&gt;
   at org.apache.tika.parser.pkg.PackageParser.parseEntry(PackageParser.java:93)&lt;br/&gt;
   at org.apache.tika.parser.pkg.ZipParser.parse(ZipParser.java:56)&lt;br/&gt;
   at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:108)&lt;br/&gt;
   at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:80)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12411956">TIKA-185</key>
            <summary>XML files with (unsatisfied) SYSTEM entities can not be extracted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="arusin">Andrzej Rusin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Jan 2009 15:29:08 +0000</created>
                <updated>Fri, 22 May 2009 23:04:55 +0100</updated>
                            <resolved>Thu, 15 Jan 2009 23:56:28 +0000</resolved>
                                    <version>0.2</version>
                                    <fixVersion>0.3</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12662009" author="arusin" created="Thu, 8 Jan 2009 15:41:26 +0000"  >&lt;p&gt;Minimal test case for the issue.&lt;/p&gt;

&lt;p&gt;xmlTest.xml: when blah.xml is present at time of extracting (with any content, eg &quot;blah&quot;), everything works OK, otherwise not.&lt;/p&gt;

&lt;p&gt;xmlTest2.xml: always fails because chrome protocol is not defined. However there exist xml files using this protocol, eg in Firefox plugins.&lt;/p&gt;</comment>
                            <comment id="12662187" author="jukkaz" created="Fri, 9 Jan 2009 00:20:54 +0000"  >&lt;p&gt;We probably should prevent Tika and the parsers it invokes from trying to access any external entities when parsing XML (or any other file formats for that matter). The only input for content extraction should be the input stream and input metadata passed to the parse() method.&lt;/p&gt;</comment>
                            <comment id="12662195" author="chrismattmann" created="Fri, 9 Jan 2009 00:39:38 +0000"  >&lt;p&gt;+1.&lt;/p&gt;

&lt;p&gt;I think we open up a whole horde of other tangential issues if we are dealing with external validation and protocols. Let&apos;s apply KISS principles here. Perhaps this can be attacked at the protocol layer, in some other fashion?&lt;/p&gt;

&lt;p&gt;Cheers, &lt;br/&gt;
Chris&lt;/p&gt;</comment>
                            <comment id="12662283" author="thetaphi" created="Fri, 9 Jan 2009 09:04:23 +0000"  >&lt;p&gt;o.a.t.parser.opendocument.NSNormalizerContentHandler has a fix for OpenDocument files coming from OpenOffice 1.0 that have exactly this problem. In principal it could be used here, too.&lt;/p&gt;

&lt;p&gt;But in my opinion, this is not the general case for TIKA, it should be handled on the application level, that passes the XML file in (e.g. by using an additional content handler decorator, that handles the external entities). For OpenDocument it is OK, because it is a problem of the parser itsself (because it is the parser for &lt;b&gt;that&lt;/b&gt; type of documents).&lt;/p&gt;

&lt;p&gt;Uwe&lt;/p&gt;</comment>
                            <comment id="12662291" author="arusin" created="Fri, 9 Jan 2009 09:23:59 +0000"  >&lt;p&gt;I agree with Jukka that we should prevent accessing the external entities. &lt;/p&gt;

&lt;p&gt;Reasons:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;we can by no means guarantee the existence of external entities for &quot;flat&quot; files,&lt;/li&gt;
	&lt;li&gt;the situation gets even worse with xmls inside zip files,&lt;/li&gt;
	&lt;li&gt;and the strange protocols like chrome.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I was trying to fix the problem by adding a EntityResolver, but it did not work for me. Maybe my DummyEntityResolver was not smart enough &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;SAXParser parser = factory.newSAXParser();&lt;br/&gt;
parser.getXMLReader().setEntityResolver(new DummyEntityResolver());&lt;br/&gt;
parser.parse(....&lt;/p&gt;


&lt;p&gt;Also, I experimented with SaxParserFactory features like this:&lt;/p&gt;

&lt;p&gt;factory.setFeature(&quot;http://xml.org/sax/features/external-general-entities&quot;, false);&lt;br/&gt;
factory.setFeature(&quot;http://xml.org/sax/features/external-parameter-entities&quot;, false);&lt;/p&gt;

&lt;p&gt;The exception became different, but the entities still did not resolve.&lt;/p&gt;</comment>
                            <comment id="12662292" author="arusin" created="Fri, 9 Jan 2009 09:28:06 +0000"  >&lt;p&gt;Uwe,&lt;/p&gt;

&lt;p&gt;How do you imagine passing the XML handling decorator to AutoDetectParser?&lt;/p&gt;

&lt;p&gt;Shouldn&apos;t the AutoDetectParser be as &quot;safe&quot; as possible by default?&lt;/p&gt;</comment>
                            <comment id="12662317" author="peter.becker.de" created="Fri, 9 Jan 2009 10:52:40 +0000"  >&lt;p&gt;I believe we (colleagues and I working on Docco) had this problem solved a while ago, but I don&apos;t remember the details. Looking at the old code it seems we ended up implementing a subclass of SAX&apos;s DefaultHandler:&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;http://tockit.svn.sourceforge.net/viewvc/tockit/trunk/java/applications/docco/source/org/tockit/docco/documenthandler/SaxTextContentParser.java?revision=1012&amp;amp;view=markup&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://tockit.svn.sourceforge.net/viewvc/tockit/trunk/java/applications/docco/source/org/tockit/docco/documenthandler/SaxTextContentParser.java?revision=1012&amp;amp;view=markup&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here is the calling class:&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;http://tockit.svn.sourceforge.net/viewvc/tockit/trunk/java/applications/docco/source/org/tockit/docco/documenthandler/XmlDocumentHandler.java?revision=1013&amp;amp;view=markup&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://tockit.svn.sourceforge.net/viewvc/tockit/trunk/java/applications/docco/source/org/tockit/docco/documenthandler/XmlDocumentHandler.java?revision=1013&amp;amp;view=markup&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Commit message #667 claims:&lt;/p&gt;

&lt;p&gt;&quot;The XML parser now ignores all external references completely &amp;#8211; this seems to be the only safe way to make sure we don&apos;t run into problems.&quot;&lt;/p&gt;

&lt;p&gt;BTW: there might be other useful stuff in that directory, I haven&apos;t really worked on the code lately and I don&apos;t know Tika&apos;s capabilities in detail either.&lt;/p&gt;

&lt;p&gt;HTH.&lt;/p&gt;</comment>
                            <comment id="12662333" author="thetaphi" created="Fri, 9 Jan 2009 11:33:08 +0000"  >&lt;p&gt;Andrzej: The code must not be included into AutoDetectParser, it must be in XMLParser. In principle, to provide a general &quot;external entity no-op resolver&quot;, the code from OpenOffice could be copied to the DefaultHandler given to the XMLParser in the TIKA xml parser.&lt;/p&gt;

&lt;p&gt;The problem with this is: Sometimes external entities can be resolved or must be resolved. We have for example some documentents, that contain entities like &quot;&amp;amp;includeSomething;&quot; that are externally defined in a file that is linked by URL. Without these entities a lot of information gots lost. In my opinion, the entity resolver in TIKA should work like this:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try to resolve the entity as a URL (new URL(...)), if malformed URL return an empty StringReader. If it works return the result of the URLs inputStream. If some other extensions occur (FileNotFound etc.) return empty StringReader.&lt;/li&gt;
	&lt;li&gt;If resolving as URL does not work try to return a FileInputStream() on the system ID. If that also fails, return empty StringReader.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This resolving mechanism tries to get as much from the external entity. If returning of the empty StringReader makes the XML invalid, then the parser stops later (so it does not break more).&lt;/p&gt;

&lt;p&gt;I may create a patch for the XML parser. If we include this code directly into the XML parser, the resolving mechanism of OpenDocument may get removed (because the one from the XML reader could be reused).&lt;/p&gt;

&lt;p&gt;Uwe&lt;/p&gt;</comment>
                            <comment id="12662335" author="arusin" created="Fri, 9 Jan 2009 11:39:25 +0000"  >&lt;p&gt;Uwe,&lt;/p&gt;

&lt;p&gt;I agree that the system entities should be processed, if possible.&lt;br/&gt;
I think that your approach is perfect.&lt;/p&gt;</comment>
                            <comment id="12662341" author="arusin" created="Fri, 9 Jan 2009 12:01:15 +0000"  >&lt;p&gt;Uwe, Jukka:&lt;br/&gt;
I just notoced that I agreed to both of you ideas, which are contrary.&lt;/p&gt;

&lt;p&gt;So:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if we are concerned about security, simplicity, etc, we should totally ignore the system entities,&lt;/li&gt;
	&lt;li&gt;if we are concerned about system entities content, we could try to resolve them.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think that this behaviour can be made configurable by means of the tika-config.xml file.&lt;/p&gt;</comment>
                            <comment id="12662364" author="jukkaz" created="Fri, 9 Jan 2009 13:36:11 +0000"  >&lt;p&gt;I&apos;m strongly against resolving any external references in Tika, at least by default. It opens up a whole can of worms (for example, what if I make an external reference to /etc/passwd) and pretty much breaks the simple input-output contract of the parse() method.&lt;/p&gt;

&lt;p&gt;There could be a configuration option in XMLParser that enables external entity resolution, but it should definitely be off by default.&lt;/p&gt;</comment>
                            <comment id="12662451" author="davemeikle" created="Fri, 9 Jan 2009 18:01:37 +0000"  >&lt;p&gt;+1 to not resolving external references.&lt;/p&gt;

&lt;p&gt;If this appears to be a sought after feature we need to think carefully about including it and definitely not by default, IMHO.&lt;/p&gt;</comment>
                            <comment id="12664333" author="jukkaz" created="Thu, 15 Jan 2009 23:56:28 +0000"  >&lt;p&gt;Fixed in revision 734861.&lt;/p&gt;

&lt;p&gt;I implemented an OfflineContentHandler decorator class that makes the XML parser silently replace all external entities with nothing. This decorator is now used in all places where Tika uses an XML parser on input documents.&lt;/p&gt;

&lt;p&gt;I also enable the secure processing feature &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; that&apos;s designed to prevent XML bombs from breaking the system.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/XMLConstants.html#FEATURE_SECURE_PROCESSING&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://java.sun.com/j2se/1.5.0/docs/api/javax/xml/XMLConstants.html#FEATURE_SECURE_PROCESSING&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12397430" name="xmlTest.xml" size="102" author="arusin" created="Thu, 8 Jan 2009 15:41:26 +0000"/>
                            <attachment id="12397431" name="xmlTest2.xml" size="111" author="arusin" created="Thu, 8 Jan 2009 15:41:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 9 Jan 2009 00:20:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4676</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx5cf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17185</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>