<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:29:14 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-1109/TIKA-1109.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-1109] Metadata not extracted before the content in OOXML (pptx)</title>
                <link>https://issues.apache.org/jira/browse/TIKA-1109</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;It seems that when processing OOXML documents, the metadata is only read after the text. This means it&apos;s impossible to use the medata while processing the text. I think it would be more useful to have the metadata populated first.&lt;/p&gt;

&lt;p&gt;As a symptom:&lt;/p&gt;

&lt;p&gt;java -jar tika-app-1.3.jar test-classes/test-documents/testPPT.pptx&lt;/p&gt;

&lt;p&gt;outputs only as metadata:&lt;/p&gt;

&lt;p&gt;&amp;lt;meta name=&quot;Content-Length&quot; content=&quot;36518&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;meta name=&quot;Content-Type&quot; content=&quot;application/vnd.openxmlformats-officedocument.presentationml.presentation&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;meta name=&quot;resourceName&quot; content=&quot;testPPT.pptx&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;while there is more medata in the file (e.g. &amp;lt;dc:title&amp;gt;Attachment Test&amp;lt;/dc:title&amp;gt;).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12643181">TIKA-1109</key>
            <summary>Metadata not extracted before the content in OOXML (pptx)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dbr">Daniel Bonniot de Ruisselet</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Thu, 18 Apr 2013 12:06:06 +0100</created>
                <updated>Wed, 23 Apr 2014 07:25:06 +0100</updated>
                            <resolved>Thu, 27 Jun 2013 13:41:04 +0100</resolved>
                                                    <fixVersion>1.5</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13635091" author="gagravarr" created="Thu, 18 Apr 2013 12:13:01 +0100"  >&lt;p&gt;This is a limitation of using the tika-app jar. The tika-app jar will give you either metadata (-&lt;del&gt;metadata) or text (&lt;/del&gt;-text / --xml). Tika itself generates both at the same time, so for more advanced uses you&apos;ll be better off calling the API directly yourself.&lt;/p&gt;</comment>
                            <comment id="13635096" author="dbr" created="Thu, 18 Apr 2013 12:23:14 +0100"  >&lt;p&gt;Nick, thanks a lot for your answer. I do use the API, and I see the same behaviour: when my ContentHandler is called on the text data, the metadata is not set (yet). It is only set when endDocument is called. Am I doing something wrong?&lt;/p&gt;

&lt;p&gt;Looking at:&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/tika-parsers/src/main/java/org/apache/tika/parser/microsoft/ooxml/OOXMLExtractorFactory.java?revision=1339390&amp;amp;view=markup&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/tika-parsers/src/main/java/org/apache/tika/parser/microsoft/ooxml/OOXMLExtractorFactory.java?revision=1339390&amp;amp;view=markup&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and specifically:&lt;/p&gt;

&lt;p&gt;108                 // We need to get the content first, but not end &lt;br/&gt;
109	            //  the document just yet&lt;br/&gt;
110	            EndDocumentShieldingContentHandler handler = &lt;br/&gt;
111	               new EndDocumentShieldingContentHandler(baseHandler);&lt;br/&gt;
112	            extractor.getXHTML(handler, metadata, context);&lt;br/&gt;
113	&lt;br/&gt;
114	            // Now we can get the metadata&lt;br/&gt;
115	            extractor.getMetadataExtractor().extract(metadata);&lt;/p&gt;

&lt;p&gt;It seems to me that metadata is read only after the text, which explains the behaviour. Why is this needed? Am I misunderstanding something?&lt;/p&gt;</comment>
                            <comment id="13667853" author="chrismattmann" created="Mon, 27 May 2013 17:56:57 +0100"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;push to 1.5, get ready for 1.4 RC #1.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13693097" author="gagravarr" created="Tue, 25 Jun 2013 15:56:04 +0100"  >&lt;p&gt;Some parsers fetch the metadata first, some do it after the text, some populate the metadata as they make their way through the file, and some do a mixture! The current parser contract is on that the metadata will be populated by the end of the call to parse, not that it will be available during the parsing. It&apos;s up to the person writing the parser to do what makes most sense for their format.&lt;/p&gt;

&lt;p&gt;If you need all the metadata before you process the text, you&apos;ll need to buffer the sax events yourself, sorry.&lt;/p&gt;</comment>
                            <comment id="13694521" author="dbr" created="Thu, 27 Jun 2013 07:21:15 +0100"  >&lt;p&gt;Nick, thanks a lot for your explanation. If I understand correctly, what you are saying is that in general it cannot be guaranteed that the metadata is available during parsing, since that will depend on the format whether that&apos;s possible or not. That makes complete sense.&lt;/p&gt;

&lt;p&gt;Here I am asking specifically about the OOXML formats, with an example pptx file. As I understand the OOXML formats are zip files containing xml files. In test-classes/test-documents/testPPT.pptx, the metadata seems to be inside docProps/core.xml. Would it be possible to read the metadata first from there, before starting the parsing?&lt;/p&gt;</comment>
                            <comment id="13694612" author="gagravarr" created="Thu, 27 Jun 2013 11:52:43 +0100"  >&lt;p&gt;For ooxml files, the metadata is mostly in a few different xml files within the zip. For excel, there&apos;s also a few bits stored in the main spreadsheet / sheet stream too...&lt;/p&gt;

&lt;p&gt;Not sure if it would break things if we did most of the metadata fetching first. Could you try moving the metadata line up, and see if the unit tests all still pass?&lt;/p&gt;</comment>
                            <comment id="13694659" author="dbr" created="Thu, 27 Jun 2013 13:25:45 +0100"  >&lt;p&gt;I tried it. It broke two tests (same cause): as you mentioned, in excel the metadata for TikaMetadataKeys.PROTECTED is populated during parsing. I made a change in how that is implemented, and:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Building Apache Tika 1.5-SNAPSHOT&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-remote-resources-plugin:1.2.1:process (default) @ tika ---&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Reactor Summary:&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Apache Tika parent ................................ SUCCESS &lt;span class=&quot;error&quot;&gt;&amp;#91;0.806s&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Apache Tika core .................................. SUCCESS &lt;span class=&quot;error&quot;&gt;&amp;#91;8.418s&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Apache Tika parsers ............................... SUCCESS &lt;span class=&quot;error&quot;&gt;&amp;#91;26.857s&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Apache Tika XMP ................................... SUCCESS &lt;span class=&quot;error&quot;&gt;&amp;#91;0.789s&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Apache Tika application ........................... SUCCESS &lt;span class=&quot;error&quot;&gt;&amp;#91;3.336s&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Apache Tika OSGi bundle ........................... SUCCESS &lt;span class=&quot;error&quot;&gt;&amp;#91;1.204s&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Apache Tika server ................................ SUCCESS &lt;span class=&quot;error&quot;&gt;&amp;#91;5.312s&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Apache Tika ....................................... SUCCESS &lt;span class=&quot;error&quot;&gt;&amp;#91;0.014s&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; BUILD SUCCESS&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Total time: 47.498s&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Finished at: Thu Jun 27 14:10:50 CEST 2013&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Final Memory: 27M/1930M&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;dbonniot@naming:~/world/tika$ svn diff | diffstat&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;main/java/org/apache/tika/parser/microsoft/ooxml/OOXMLExtractorFactory.java       |   11 -&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;main/java/org/apache/tika/parser/microsoft/ooxml/XSSFExcelExtractorDecorator.java |   36 ++----&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;test/java/org/apache/tika/parser/microsoft/ooxml/OOXMLParserTest.java             |   56 ++++++++++&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;3 files changed, 74 insertions&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/add.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, 29 deletions&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/forbidden.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;dbonniot@naming:~/world/tika$ svn diff &amp;gt; /tmp/&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1109&quot; title=&quot;Metadata not extracted before the content in OOXML (pptx)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1109&quot;&gt;&lt;del&gt;TIKA-1109&lt;/del&gt;&lt;/a&gt;.patch&lt;/tt&gt;&lt;/p&gt;


&lt;p&gt;The logic is OOXMLExtractorFactory is now simpler, since I could remove the extra shielding, which I suppose was made necessary by the previous ordering.&lt;/p&gt;

&lt;p&gt;And the metadata for OOXML formats is now available at parse time, as tested by the added test to OOXMLParserTest &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13694674" author="gagravarr" created="Thu, 27 Jun 2013 13:41:04 +0100"  >&lt;p&gt;Thanks for the patch, making life easier for downstream users AND tidying the code at the same time is always a win &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Applied (with a slight comment tweak) in r1497332.&lt;/p&gt;</comment>
                            <comment id="13977887" author="rwesten" created="Wed, 23 Apr 2014 07:22:37 +0100"  >&lt;p&gt;To workaround the reported issues I created an own bundle for Tika 1.5 &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. This bundle does not embed commons-compress, xz, commons-codec, commons-io as those are anyway required by other Apache Stanbol modules and therefore guaranteed to be around in the OSGI environment. Not sure if Tika would like to embed those to avoid dependencies to other bundles.&lt;/p&gt;

&lt;p&gt;If you like me to create a patch for 1.5 or 1.6-SNAPSHOT just leave a short comment.&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://svn.apache.org/repos/asf/stanbol/branches/release-0.12/commons/tikabundle/pom.xml&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/stanbol/branches/release-0.12/commons/tikabundle/pom.xml&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13977888" author="rwesten" created="Wed, 23 Apr 2014 07:25:06 +0100"  >&lt;p&gt;Sorry ... the link to &lt;a href=&quot;https://issues.apache.org/jira/browse/STANBOL-1171&quot; title=&quot;Update to Tika 1.5&quot; class=&quot;issue-link&quot; data-issue-key=&quot;STANBOL-1171&quot;&gt;&lt;del&gt;STANBOL-1171&lt;/del&gt;&lt;/a&gt; and the above comment where added to the wrong issue. Please delete them if possible. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12673214">STANBOL-1171</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12589893" name="TIKA-1109.patch" size="6497" author="dbr" created="Thu, 27 Jun 2013 13:26:55 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 18 Apr 2013 11:13:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>323591</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzdohj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>323936</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>