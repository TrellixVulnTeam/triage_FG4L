<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:39:25 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-1369/TIKA-1369.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-1369] Date parsing and thread safety in ImageMetadataExtractor</title>
                <link>https://issues.apache.org/jira/browse/TIKA-1369</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;The &lt;tt&gt;ImageMetadataExtractor&lt;/tt&gt; uses a static instance of &lt;tt&gt;SimpleDateFormat&lt;/tt&gt;.  This is not thread safe.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;ImageMetadataExtractor.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; class ExifHandler &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; DirectoryHandler {
        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SimpleDateFormat DATE_UNSPECIFIED_TZ = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleDateFormat(&lt;span class=&quot;code-quote&quot;&gt;&quot;yyyy-MM-dd&apos;T&apos;HH:mm:ss&quot;&lt;/span&gt;);
        ...
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void handleDateTags(Directory directory, Metadata metadata)
                &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; MetadataException {
            &lt;span class=&quot;code-comment&quot;&gt;// Date/Time Original overrides value from ExifDirectory.TAG_DATETIME
&lt;/span&gt;            Date original = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (directory.containsTag(ExifSubIFDDirectory.TAG_DATETIME_ORIGINAL)) {
                original = directory.getDate(ExifSubIFDDirectory.TAG_DATETIME_ORIGINAL);
                &lt;span class=&quot;code-comment&quot;&gt;// Unless we have GPS time we don&apos;t know the time zone so date must be set
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// as ISO 8601 datetime without timezone suffix (no Z or +/-)
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (original != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; datetimeNoTimeZone = DATE_UNSPECIFIED_TZ.format(original); &lt;span class=&quot;code-comment&quot;&gt;// Same time zone as Metadata Extractor uses
&lt;/span&gt;                    metadata.set(TikaCoreProperties.CREATED, datetimeNoTimeZone);
                    metadata.set(Metadata.ORIGINAL_DATE, datetimeNoTimeZone);
                }
            }
       ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is not the first time that SDF has caused problems: &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-495&quot; title=&quot;Metadata constructor is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-495&quot;&gt;&lt;del&gt;TIKA-495&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-864&quot; title=&quot;Metadata.formatDate causes blocking in concurrent use&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-864&quot;&gt;&lt;del&gt;TIKA-864&lt;/del&gt;&lt;/a&gt;. In the discussion there the idea of using alternative thread-safe (and faster) formatters from either Joda time or Commons Lang were dismissed because they would add too many dependencies. Given that Tika already has a fairly large laundry list of dependencies to parse content, adding one more JAR to make sure things don&apos;t break is probably a good idea.&lt;/p&gt;

&lt;p&gt;In addition, because no timezone or locale are specified by either Tika&apos;s formatter or the call to com.drew.metadata.Directory it can wreak havok during randomized testing. Given that the timezone is unknown, why not just default it to UTC and let the caller guess the timezone? As it stands I have to reparse all of the dates into UTC to get stable behavior across timezones.&lt;/p&gt;</description>
                <environment>&lt;p&gt;OS X 10.9.4 Java 7_60&lt;/p&gt;</environment>
        <key id="12727360">TIKA-1369</key>
            <summary>Date parsing and thread safety in ImageMetadataExtractor</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chrismattmann">Chris A. Mattmann</assignee>
                                    <reporter username="jgibson">John Gibson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Jul 2014 17:04:35 +0100</created>
                <updated>Tue, 7 Oct 2014 12:55:14 +0100</updated>
                            <resolved>Sat, 4 Oct 2014 03:23:39 +0100</resolved>
                                    <version>1.5</version>
                                    <fixVersion>1.7</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="14062288" author="gagravarr" created="Tue, 15 Jul 2014 17:41:40 +0100"  >&lt;p&gt;General comment - adding more dependencies to the Tika Parsers subproject is normally fine (as long as there&apos;s a reason!), it&apos;s adding them to Tika Core that we generally try to avoid&lt;/p&gt;</comment>
                            <comment id="14077561" author="papgyo" created="Tue, 29 Jul 2014 10:51:49 +0100"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I&apos;ve sent a pull request on github to fix this: &lt;a href=&quot;https://github.com/chrismattmann/tika/pull/1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/chrismattmann/tika/pull/1&lt;/a&gt;, I hope I sent it to the proper person, if not, where should I send it?&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Vilmos&lt;/p&gt;</comment>
                            <comment id="14077578" author="gagravarr" created="Tue, 29 Jul 2014 11:20:51 +0100"  >&lt;p&gt;Please send the pull request to the main github repo - &lt;a href=&quot;https://github.com/apache/tika/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/tika/&lt;/a&gt; - or post a patch here&lt;/p&gt;

&lt;p&gt;Please see the Contributing to Apache Tika page - &lt;a href=&quot;http://tika.apache.org/contribute.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://tika.apache.org/contribute.html&lt;/a&gt; - for more on the various supported ways to build / test / contribute enhancements and fixes!&lt;/p&gt;</comment>
                            <comment id="14077584" author="githubbot" created="Tue, 29 Jul 2014 11:24:30 +0100"  >&lt;p&gt;GitHub user vilmospapp opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/tika/pull/15&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/tika/pull/15&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1369&quot; title=&quot;Date parsing and thread safety in ImageMetadataExtractor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1369&quot;&gt;&lt;del&gt;TIKA-1369&lt;/del&gt;&lt;/a&gt; Resolve thread safety issue in ImageMetadataExtractor &lt;/p&gt;

&lt;p&gt;    Hi,&lt;/p&gt;

&lt;p&gt;    This fix tries to resolve &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1369&quot; title=&quot;Date parsing and thread safety in ImageMetadataExtractor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1369&quot;&gt;&lt;del&gt;TIKA-1369&lt;/del&gt;&lt;/a&gt; with handle thread safety by ThreadLocal and avoid other library dependencies.&lt;/p&gt;

&lt;p&gt;    I have run the test cases, so it seems correct to me, though I haven&apos;t found any other occurrence of ThreadLocal in Tika&apos;s source, so perhaps it&apos;s against your general patterns.&lt;/p&gt;

&lt;p&gt;    Regards,&lt;br/&gt;
    Vilmos&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/vilmospapp/tika&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/vilmospapp/tika&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1369&quot; title=&quot;Date parsing and thread safety in ImageMetadataExtractor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1369&quot;&gt;&lt;del&gt;TIKA-1369&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/tika/pull/15.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/tika/pull/15.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #15&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 3a9575fc56a6463b4378b14820e9079352bb1848&lt;br/&gt;
Author: Vilmos Papp &amp;lt;papp.gyorgy.vilmos@gmail.com&amp;gt;&lt;br/&gt;
Date:   2014-07-23T09:18:50Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1369&quot; title=&quot;Date parsing and thread safety in ImageMetadataExtractor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1369&quot;&gt;&lt;del&gt;TIKA-1369&lt;/del&gt;&lt;/a&gt; Make SimpleDateFormat usage thread safe&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14077587" author="papgyo" created="Tue, 29 Jul 2014 11:28:30 +0100"  >&lt;p&gt;Hi Nick,&lt;/p&gt;

&lt;p&gt;Thanks, for the quick answer. I prefer pull request over attachments of patches.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Vilmos&lt;/p&gt;</comment>
                            <comment id="14108981" author="papgyo" created="Mon, 25 Aug 2014 11:12:01 +0100"  >&lt;p&gt;Hi Nick,&lt;/p&gt;

&lt;p&gt;Did you manage to take a look at my fix?&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Vilmos&lt;/p&gt;</comment>
                            <comment id="14110391" author="gagravarr" created="Tue, 26 Aug 2014 07:44:28 +0100"  >&lt;p&gt;I think this might&apos;ve already been handled through &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1387&quot; title=&quot;Add forbidden-apis checker to TIKA build&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1387&quot;&gt;&lt;del&gt;TIKA-1387&lt;/del&gt;&lt;/a&gt; - as of r1617796 there&apos;s a note that since we get a new ExifHandler on each file parsed, and since the SimpleDateFormat is (now) ExifHandler scoped, I think that should see us thread safe now?&lt;/p&gt;</comment>
                            <comment id="14110444" author="papgyo" created="Tue, 26 Aug 2014 08:39:44 +0100"  >&lt;p&gt;Hi Nick,&lt;/p&gt;

&lt;p&gt;Yes, that should fix it, I think.&lt;/p&gt;</comment>
                            <comment id="14110542" author="gagravarr" created="Tue, 26 Aug 2014 10:30:01 +0100"  >&lt;p&gt;If you could confirm, then close this ticket + pull request, that&apos;d be great, thanks!&lt;/p&gt;</comment>
                            <comment id="14110592" author="papgyo" created="Tue, 26 Aug 2014 11:44:44 +0100"  >&lt;p&gt;Hi Nick,&lt;/p&gt;

&lt;p&gt;In ImageMetadataExtrctorTest there are a test cases where new ExifHanlders created like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ExifSubIFDDirectory exif = mock(ExifSubIFDDirectory.class);
         when(exif.containsTag(ExifSubIFDDirectory.TAG_DATETIME_ORIGINAL)).thenReturn(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        GregorianCalendar calendar = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GregorianCalendar(TimeZone.getDefault(), Locale.getDefault());
        calendar.setTimeInMillis(0);
        calendar.set(2000, 0, 1, 0, 0, 0);
         when(exif.getDate(ExifSubIFDDirectory.TAG_DATETIME_ORIGINAL)).thenReturn(
                calendar.getTime()); &lt;span class=&quot;code-comment&quot;&gt;// jvm &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; timezone as in Metadata Extractor
&lt;/span&gt;         Metadata metadata = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Metadata();
         
         &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ImageMetadataExtractor.ExifHandler().handle(exif, metadata);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What happens if we cache ExifHandler like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ImageMetadataExtractor.ExifHandler cachedHandler = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ImageMetadataExtractor.ExifHandler();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And use it like this (possibly several times for different metadata):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
cachedHandler.handle(exif, metadata);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This seems to me a valid scenario, and as caching an object for later usage should be fine, perhaps the original thread safety issue could occur, but I should create a test case for it to prove it or prove that it not occurs.&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="14110602" author="gagravarr" created="Tue, 26 Aug 2014 12:04:58 +0100"  >&lt;p&gt;I would defer to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgauss&quot; class=&quot;user-hover&quot; rel=&quot;rgauss&quot;&gt;Ray Gauss II&lt;/a&gt; on that, he&apos;s more of the expert on this bit of the codebase!&lt;/p&gt;</comment>
                            <comment id="14158893" author="githubbot" created="Sat, 4 Oct 2014 03:22:23 +0100"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/tika/pull/15&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/tika/pull/15&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14158895" author="chrismattmann" created="Sat, 4 Oct 2014 03:23:22 +0100"  >&lt;p&gt;I merged the pull request in r1629347. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=papgyo&quot; class=&quot;user-hover&quot; rel=&quot;papgyo&quot;&gt;Vilmos Papp&lt;/a&gt;! If &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgauss&quot; class=&quot;user-hover&quot; rel=&quot;rgauss&quot;&gt;Ray Gauss II&lt;/a&gt; sees other things to merge, or update, please go for it, just trying to close out our Github issues and thank people for their contributions!&lt;/p&gt;</comment>
                            <comment id="14158896" author="chrismattmann" created="Sat, 4 Oct 2014 03:23:39 +0100"  >&lt;p&gt;merged in r1629347.&lt;/p&gt;</comment>
                            <comment id="14158904" author="hudson" created="Sat, 4 Oct 2014 03:45:43 +0100"  >&lt;p&gt;UNSTABLE: Integrated in tika-trunk-jdk1.7 #245 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.7/245/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.7/245/&lt;/a&gt;)&lt;br/&gt;
Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1369&quot; title=&quot;Date parsing and thread safety in ImageMetadataExtractor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1369&quot;&gt;&lt;del&gt;TIKA-1369&lt;/del&gt;&lt;/a&gt;: Resolve thread safety issue in ImageMetadataExtractor. Contributed by Vilmos Papp &amp;lt;papp.gyorgy.vilmos@gmail.com&amp;gt;. This closes #15. (mattmann: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1629347&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1629347&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/main/java/org/apache/tika/parser/image/ImageMetadataExtractor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14158912" author="hudson" created="Sat, 4 Oct 2014 04:02:40 +0100"  >&lt;p&gt;UNSTABLE: Integrated in tika-trunk-jdk1.6 #224 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.6/224/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.6/224/&lt;/a&gt;)&lt;br/&gt;
Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1369&quot; title=&quot;Date parsing and thread safety in ImageMetadataExtractor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1369&quot;&gt;&lt;del&gt;TIKA-1369&lt;/del&gt;&lt;/a&gt;: Resolve thread safety issue in ImageMetadataExtractor. Contributed by Vilmos Papp &amp;lt;papp.gyorgy.vilmos@gmail.com&amp;gt;. This closes #15. (mattmann: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1629347&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1629347&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-parsers/src/main/java/org/apache/tika/parser/image/ImageMetadataExtractor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14160234" author="githubbot" created="Mon, 6 Oct 2014 13:14:08 +0100"  >&lt;p&gt;GitHub user vilmospapp opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/tika/pull/17&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/tika/pull/17&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1369&quot; title=&quot;Date parsing and thread safety in ImageMetadataExtractor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1369&quot;&gt;&lt;del&gt;TIKA-1369&lt;/del&gt;&lt;/a&gt; Avoid ThreadLocal usage from Memory Leak&lt;/p&gt;

&lt;p&gt;    Hi @chrismattmann ,&lt;/p&gt;

&lt;p&gt;    Based on our discussion from &lt;a href=&quot;https://github.com/apache/tika/pull/15&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/tika/pull/15&lt;/a&gt; I&apos;ve added the ThreadLocal clean up part, so theoretically it won&apos;t suffer from the scenario that @grossws mentioned.&lt;/p&gt;

&lt;p&gt;    Cheers,&lt;br/&gt;
    Vilmos&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/vilmospapp/tika&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/vilmospapp/tika&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1369&quot; title=&quot;Date parsing and thread safety in ImageMetadataExtractor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1369&quot;&gt;&lt;del&gt;TIKA-1369&lt;/del&gt;&lt;/a&gt;-2&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/tika/pull/17.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/tika/pull/17.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #17&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit f95fad94619946ef1d4fe7cf407deab6317ad2fd&lt;br/&gt;
Author: Vilmos Papp &amp;lt;papp.gyorgy.vilmos@gmail.com&amp;gt;&lt;br/&gt;
Date:   2014-10-06T12:10:14Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1369&quot; title=&quot;Date parsing and thread safety in ImageMetadataExtractor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1369&quot;&gt;&lt;del&gt;TIKA-1369&lt;/del&gt;&lt;/a&gt; Avoid ThreadLocal usage from Memory Leak&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14161801" author="githubbot" created="Tue, 7 Oct 2014 12:55:14 +0100"  >&lt;p&gt;Github user vilmospapp closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/tika/pull/17&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/tika/pull/17&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 15 Jul 2014 16:41:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>405466</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzrmu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>405491</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>