<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:38:07 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-560/TIKA-560.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-560] Improve detection of .mht, Foxmail, and OOXML files</title>
                <link>https://issues.apache.org/jira/browse/TIKA-560</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;I would like to address the following issues&lt;/p&gt;

&lt;p&gt;1. Reduce the priority of the text/html magics. WIth the default priority I have lots of .eml, .emlx, mbox and .mht files which contain html content but should not be classified as XML. The reason for that is that the HTML magic looks for &amp;lt;html&amp;gt; between 0 and 8192 offsets. In Aperture we solved this with an allowsWhiteSpace switch, so that the &amp;lt;html&amp;gt; can be prepended with whitespace but not with other content. Since there is no such switch in Tika, I suggest reducing the priority of the magic in tika-mimetypes. I attach an .mht file from the Aperture test document suite which exhibits the problem.&lt;/p&gt;

&lt;p&gt;2. Add support for detecting Foxmail. They come from Foxmail, a mail client popular in china, they are roughly the same as mbox, but use a different separator. &lt;/p&gt;

&lt;p&gt;3. In case of OOXML files, the container aware detector computes the mimetype by taking the part of &lt;span class=&quot;error&quot;&gt;&amp;#91;Content_Types.xml&amp;#93;&lt;/span&gt;, namely:&lt;/p&gt;

&lt;p&gt;&amp;lt;Default Extension=&quot;bin&quot; ContentType=&quot;application/vnd.ms-excel.sheet.binary.macroEnabled.main&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;then it takes the default content type and returns it with the part after the last dot removed. There are two issues with this approach&lt;/p&gt;

&lt;p&gt; a. some documents use macroEnabled, while other use macroenabled so the case is not standard&lt;br/&gt;
 b. the &quot;official&quot; mime types, contain a &apos;12&apos; suffix at the end, as shown at: &lt;a href=&quot;http://technet.microsoft.com/en-us/library/ee309278%28office.12%29.aspx&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://technet.microsoft.com/en-us/library/ee309278%28office.12%29.aspx&lt;/a&gt;. I suggest to standardize on lowercase and add the &apos;12&apos; to the appropriate files.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12480941">TIKA-560</key>
            <summary>Improve detection of .mht, Foxmail, and OOXML files</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="antoni.mylka">Antoni Mylka</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Nov 2010 19:11:06 +0000</created>
                <updated>Wed, 1 Dec 2010 08:37:32 +0000</updated>
                            <resolved>Wed, 1 Dec 2010 07:35:04 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12935844" author="antoni.mylka" created="Thu, 25 Nov 2010 19:18:17 +0000"  >&lt;p&gt;A patch with my solution proposal, and the test documents.&lt;/p&gt;</comment>
                            <comment id="12936057" author="gagravarr" created="Fri, 26 Nov 2010 16:46:39 +0000"  >&lt;p&gt;The microsoft docs show the macro versions with a capital E, but Tika&apos;s mimetypes.xml goes for the lower case. I&apos;m minded to do the same from the detector&lt;/p&gt;</comment>
                            <comment id="12936070" author="gagravarr" created="Fri, 26 Nov 2010 18:10:36 +0000"  >&lt;p&gt;Looking at the patch, what&apos;s the reason for the changes to ContainerAwareDetector relating to lacking an input stream? The whole point of the detector is to look inside the file to help identify it, if you don&apos;t have the file to hand then one wouldn&apos;t expect you to be using it... Is there another use case that would call for it though?&lt;/p&gt;</comment>
                            <comment id="12936090" author="antoni.mylka" created="Fri, 26 Nov 2010 20:27:53 +0000"  >&lt;p&gt;MimeTypes, when you pass a null stream - uses the name to identify the file. I wanted to use the ContainerAwareDetector as a &quot;better MimeTypes&quot;. So the use case for supporting null stream is the same as the use case for supporting null stream in MimeTypes - use only the name for identification. Otherwise I need to add additional code to use ContainerAwareDetector if I know the stream, but MimeTypes directly if I only want name-based identification. Allowing null in ContainerAwareDetector seemed more user-friendly to me.&lt;/p&gt;

&lt;p&gt;As for the lower case, this is a paragraph from RFC 2045&lt;/p&gt;

&lt;p&gt;   The type, subtype, and parameter names are not case sensitive.  For&lt;br/&gt;
   example, TEXT, Text, and TeXt are all equivalent top-level media&lt;br/&gt;
   types.  &lt;/p&gt;

&lt;p&gt;So the &quot;proper&quot; way is to &lt;b&gt;remember&lt;/b&gt; to use equalsIgnoreCase whenever comparing mime types, but this doesn&apos;t work if you have a set and try to determine if a given mime type is in a set. E.g. a set of &quot;document&quot; mime types, or a set of &quot;mimetypes openable on this machine&quot; or a set of &quot;mime types editable on this machine&quot;. In such case I need to &lt;b&gt;remember&lt;/b&gt; to lower-case the strings in the set, and then to lower-case the strings before checking. &lt;/p&gt;

&lt;p&gt;In my humble opinion using lower case for mime types is more user-friendly.&lt;/p&gt;
</comment>
                            <comment id="12965428" author="antoni.mylka" created="Tue, 30 Nov 2010 20:47:59 +0000"  >&lt;p&gt;It seems that when applying changes to tika-mimetypes.xml in revision 1039496 the modification for application/vnd.ms-excel.sheet.binary.macroenabled.12 got overlooked. I just created a binary workbook with Excel2007 and it definitely is an OpenXML file. Please change the parent type of application/vnd.ms-excel.sheet.binary.macroenabled.12 to application/x-tika-ooxml&lt;/p&gt;</comment>
                            <comment id="12965500" author="gagravarr" created="Wed, 1 Dec 2010 00:20:46 +0000"  >&lt;p&gt;I skipped one which looked to be incorrectly switching an OLE2 filetype to an OOXML one. For the file you think is wrong, any chance you could upload an example one for us to double check against?&lt;/p&gt;</comment>
                            <comment id="12965592" author="antoni.mylka" created="Wed, 1 Dec 2010 07:32:40 +0000"  >&lt;p&gt;It&apos;s about detecting the testEXCEL.xlsb file with plain MimeTypes using both name and data. The example file is already in test-documents, just try detecting it with both name and data. The xlsb case is also covered in &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-562&quot; title=&quot;In tika-mimetypes.xml OpenXML types should have x-tika-ooxml as their parent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-562&quot;&gt;&lt;del&gt;TIKA-562&lt;/del&gt;&lt;/a&gt;. I&apos;d rather close this issue, and concentrate on &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-562&quot; title=&quot;In tika-mimetypes.xml OpenXML types should have x-tika-ooxml as their parent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-562&quot;&gt;&lt;del&gt;TIKA-562&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12965594" author="antoni.mylka" created="Wed, 1 Dec 2010 07:35:04 +0000"  >&lt;p&gt;This is fixed from my POV, if you don&apos;t want to accept null stream in ContainerAwareDetector and my unit test classes - I can live with that, though I would really advise to test detection with both name and data. The XLSB problem can be continued in &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-562&quot; title=&quot;In tika-mimetypes.xml OpenXML types should have x-tika-ooxml as their parent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-562&quot;&gt;&lt;del&gt;TIKA-562&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12965617" author="jukkaz" created="Wed, 1 Dec 2010 08:37:32 +0000"  >&lt;p&gt;Agreed with Antoni about accepting a null stream in ContainerAwareDetector. The Detector contract specifies that detectors should accept null streams, so even if a ContainerAwareDetector can do nothing useful in such cases, it&apos;s still best to degrade gracefully to avoid unexpected problems when combining or decorating detectors from various different sources. I added the extra condition in revision 1040893.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12460471" name="test-documents.zip" size="250458" author="antoni.mylka" created="Thu, 25 Nov 2010 19:18:16 +0000"/>
                            <attachment id="12460470" name="tika-560.patch" size="8640" author="antoni.mylka" created="Thu, 25 Nov 2010 19:18:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 26 Nov 2010 16:46:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4302</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx31b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16811</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>