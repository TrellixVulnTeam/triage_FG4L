<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:37:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-374/TIKA-374.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-374] AutoDetectParser not thread-safe?</title>
                <link>https://issues.apache.org/jira/browse/TIKA-374</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;We are using Tika 0.5 to parse files that are added to a Lucene index.  If we assign multiple threads to the parsing task we find that the AutoDetectParser.parse() method occasionally fails to return.  In our case, it appears that a HashMap inside Xerces gets corrupted, causing an infinite loop inside HashMap.get().  This seems to be a concurrency problem; we have not seen the issue when running single threaded.&lt;/p&gt;

&lt;p&gt;Other posts have stated that AutoDetectParser is thread-safe.  A quick look at the source code shows that an AutoDetectParser holds a MimeTypes which holds an XmlRootExtractor which holds a SAXParser.  As a result, a single SAXParser instance can end up simultaneously parsing documents in multiple threads.  The Java 1.4 SAXParser JavaDoc clearly states that &quot;An implementation of SAXParser is NOT guaranteed to behave as per the specification if it is used concurrently by two or more threads.&quot;  More recent versions of the JavaDoc have removed the warning, though the presence of &quot;setProperty()&quot; certainly means that a SAXParser is not immutable.  As you can see from the stack trace below, properties seem to be the issue in this case.&lt;/p&gt;

&lt;p&gt;We&apos;ve tried to work around the issue by constructing a new AutoDetectParser for each file we parse, but this doesn&apos;t solve the problem.  Multiple AutoDectectParsers can still end up sharing a single instance of MimeTypes, because TikaConfig holds a MimeTypes instance statically (&lt;cite&gt;) and updates it without synchronization (&lt;/cite&gt;).&lt;/p&gt;

&lt;p&gt;java.lang.Thread.State: RUNNABLE&lt;br/&gt;
             at java.util.HashMap.get(HashMap.java:303)&lt;br/&gt;
             at org.apache.xerces.util.ParserConfigurationSettings.getProperty(ParserConfigurationSettings.java:224)&lt;br/&gt;
             at org.apache.xerces.impl.dtd.XMLDTDProcessor.reset(XMLDTDProcessor.java:344)&lt;br/&gt;
             at org.apache.xerces.parsers.XML11Configuration.reset(XML11Configuration.java:984)&lt;br/&gt;
             at org.apache.xerces.parsers.XML11Configuration.parse(XML11Configuration.java:806)&lt;br/&gt;
             at org.apache.xerces.parsers.XML11Configuration.parse(XML11Configuration.java:768)&lt;br/&gt;
             at org.apache.xerces.parsers.XMLParser.parse(XMLParser.java:108)&lt;br/&gt;
             at org.apache.xerces.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1196)&lt;br/&gt;
             at org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:555)&lt;br/&gt;
             at org.apache.xerces.jaxp.SAXParserImpl.parse(SAXParserImpl.java:289)&lt;br/&gt;
             at javax.xml.parsers.SAXParser.parse(SAXParser.java:198)&lt;br/&gt;
             at org.apache.tika.detect.XmlRootExtractor.extractRootElement(XmlRootExtractor.java:63)&lt;br/&gt;
             at org.apache.tika.mime.MimeTypes.getMimeType(MimeTypes.java:237)&lt;br/&gt;
             at org.apache.tika.mime.MimeTypes.detect(MimeTypes.java:534)&lt;br/&gt;
             at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:92)&lt;br/&gt;
             at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:114)&lt;br/&gt;
             at org.labkey.search.model.LuceneSearchServiceImpl.preprocess(LuceneSearchServiceImpl.java:170)&lt;br/&gt;
             at org.labkey.search.model.AbstractSearchService.preprocess(AbstractSearchService.java:664)&lt;br/&gt;
             at org.labkey.search.model.AbstractSearchService.getPreprocessedItem(AbstractSearchService.java:737)&lt;br/&gt;
             at org.labkey.search.model.AbstractSearchService$7.run(AbstractSearchService.java:773)&lt;br/&gt;
             at java.lang.Thread.run(Thread.java:637)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Dell E6400 (dual-core) running 64-bit Windows 7.  Also reproduced on an 8-processor Mac OS/X server.&lt;/p&gt;</environment>
        <key id="12446754">TIKA-374</key>
            <summary>AutoDetectParser not thread-safe?</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="adam@labkey.com">Adam Rauch</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Jan 2010 23:58:17 +0000</created>
                <updated>Wed, 27 Jan 2010 18:15:33 +0000</updated>
                            <resolved>Wed, 27 Jan 2010 18:15:33 +0000</resolved>
                                    <version>0.5</version>
                                    <fixVersion>0.7</fixVersion>
                                    <component>mime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12805600" author="jukkaz" created="Wed, 27 Jan 2010 18:15:33 +0000"  >&lt;p&gt;Thanks for the accurate analysis of the problem. I fixed this in revision 903775 by making each call to XmlRootExtractor.extractRootElement() use a new SAXParser instance.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 27 Jan 2010 18:15:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4486</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxx46f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16996</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>