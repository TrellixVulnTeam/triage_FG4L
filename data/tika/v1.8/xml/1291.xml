<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:36:51 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/TIKA-1291/TIKA-1291.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[TIKA-1291] Invalid JSON output on CLI</title>
                <link>https://issues.apache.org/jira/browse/TIKA-1291</link>
                <project id="12310631" key="TIKA">Tika</project>
                    <description>&lt;p&gt;Getting the metadata via CLI from tika with output format set to JSON gives sometimes invalid JSON. I only found float/array errors here in jira and thus created this ticket with a new case.&lt;/p&gt;

&lt;p&gt;In my case the file that lead to invalid JSON output was a PNG file (that I unfortunately can&apos;t provide for testing):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{ &quot;Application Record Version&quot;:4, 
&quot;Component 1&quot;:&quot;Y component: Quantization table 0, Sampling factors 2 horiz/2 vert&quot;, 
&quot;Component 2&quot;:&quot;Cb component: Quantization table 1, Sampling factors 1 horiz/1 vert&quot;, 
&quot;Component 3&quot;:&quot;Cr component: Quantization table 1, Sampling factors 1 horiz/1 vert&quot;, 
&quot;Compression Type&quot;:&quot;Baseline&quot;, 
&quot;Content-Length&quot;:113081, 
&quot;Content-Type&quot;:&quot;image/jpeg&quot;, 
&quot;Data Precision&quot;:&quot;8 bits&quot;, 
&quot;IPTC-NAA record&quot;:&quot;24 bytes binary data&quot;, 
&quot;Image Height&quot;:&quot;479 pixels&quot;, 
&quot;Image Width&quot;:&quot;671 pixels&quot;, 
&quot;Number of Components&quot;:3, 
&quot;Resolution Units&quot;:&quot;inch&quot;, 
&quot;Unknown tag (0x02f0)&quot;:35,0,556,479, 
&quot;X Resolution&quot;:&quot;220 dots&quot;, 
&quot;Y Resolution&quot;:&quot;220 dots&quot;, 
&quot;resourceName&quot;:18, 
&quot;tiff:BitsPerSample&quot;:8, 
&quot;tiff:ImageLength&quot;:479, 
&quot;tiff:ImageWidth&quot;:671 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;Unknown tag (0x02f0)&quot;:35,0,556,479, &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; is invalid JSON.&lt;/p&gt;

&lt;p&gt;It would be nice if there&apos;s always valid json output from tika. For other cases that might not be catched via fixes by this ticket it would be nice to have a CLI argument/option that disables the output of certain (unknown?) fields or allows giving a whitelist of fieldnames to output. That way users can bridge the time until new releases of tika by being more specific on the shell. If that feature already exists I apology for not having found it directly and a hint to the CLI option would be nice.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12712574">TIKA-1291</key>
            <summary>Invalid JSON output on CLI</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tallison@mitre.org">Tim Allison</assignee>
                                    <reporter username="graste">Steffen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 May 2014 14:27:23 +0100</created>
                <updated>Wed, 28 May 2014 17:15:35 +0100</updated>
                            <resolved>Wed, 28 May 2014 15:29:30 +0100</resolved>
                                    <version>1.4</version>
                    <version>1.5</version>
                                    <fixVersion>1.6</fixVersion>
                                    <component>cli</component>
                    <component>metadata</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13991874" author="gagravarr" created="Wed, 7 May 2014 15:43:02 +0100"  >&lt;p&gt;The TikaCLI uses com.google.gson.Gson to handle the JSON output, which ought to be doing the escaping etc. Any chance you could step through that in a debugger on your problem file, and see if you can spot if it&apos;s a bug in Gson, or a bug in how we call it?&lt;/p&gt;

&lt;p&gt;Longer term, we have two different Metadata-to-JSON converters, one in the Tika CLI, and one in the Tika Server. We may want to look into combining that into a single common set of logic, along with more unit tests for edge cases&lt;/p&gt;

&lt;p&gt;As for filtering, the Tika CLI JSON output generally goes for one line per key/value pair, so there&apos;s always the old &lt;tt&gt;| grep -v blah&lt;/tt&gt; option!&lt;/p&gt;</comment>
                            <comment id="13992634" author="graste" created="Thu, 8 May 2014 10:58:56 +0100"  >&lt;p&gt;Thanks for your reply. Unfortunately I can&apos;t debug the problem here, but I sent you an email with the image file to ease debugging on your side.&lt;/p&gt;</comment>
                            <comment id="14010526" author="tallison@mitre.org" created="Wed, 28 May 2014 01:01:16 +0100"  >&lt;p&gt;Will fix tomorrow. Thank you for reporting this!&lt;/p&gt;</comment>
                            <comment id="14011089" author="tallison@mitre.org" created="Wed, 28 May 2014 14:42:33 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gagravarr&quot; class=&quot;user-hover&quot; rel=&quot;gagravarr&quot;&gt;Nick Burch&lt;/a&gt;, the issue was with our calling code.  We had custom code to parse numbers.  If the full string could be parsed as a number (by NumberFormat), then we treated it as a single value and didn&apos;t run it through GSON.  The code didn&apos;t take into account this case: namely a number with commas is parsed by NumberFormat as a number.&lt;/p&gt;

&lt;p&gt;I think we should get rid of our custom handling and rely on GSON (until proven guilty). &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Any objections?&lt;/p&gt;

&lt;p&gt;In a follow on patch/issue, I agree that we should centralize our GSON handling of Metadata (and other objects?).&lt;/p&gt;</comment>
                            <comment id="14011136" author="tallison@mitre.org" created="Wed, 28 May 2014 15:29:30 +0100"  >&lt;p&gt;r1598023.  Let me know if there are any surprises.&lt;/p&gt;</comment>
                            <comment id="14011246" author="hudson" created="Wed, 28 May 2014 17:04:23 +0100"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.7 #7 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.7/7/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.7/7/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1291&quot; title=&quot;Invalid JSON output on CLI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1291&quot;&gt;&lt;del&gt;TIKA-1291&lt;/del&gt;&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1310&quot; title=&quot;Parse error - fb:admins property&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1310&quot;&gt;&lt;del&gt;TIKA-1310&lt;/del&gt;&lt;/a&gt; fix bug in JSON output from CLI (tallison: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1598023&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1598023&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-app/src/main/java/org/apache/tika/io&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-app/src/main/java/org/apache/tika/io/json&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-app/src/main/java/org/apache/tika/io/json/JsonMetadataSerializer.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-app/src/test/java/org/apache/tika/cli/TikaCLITest.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-app/src/test/resources/test-data/testJsonMultipleInts.html&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14011258" author="hudson" created="Wed, 28 May 2014 17:15:35 +0100"  >&lt;p&gt;SUCCESS: Integrated in tika-trunk-jdk1.6 #7 (See &lt;a href=&quot;https://builds.apache.org/job/tika-trunk-jdk1.6/7/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/tika-trunk-jdk1.6/7/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1291&quot; title=&quot;Invalid JSON output on CLI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1291&quot;&gt;&lt;del&gt;TIKA-1291&lt;/del&gt;&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1310&quot; title=&quot;Parse error - fb:admins property&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1310&quot;&gt;&lt;del&gt;TIKA-1310&lt;/del&gt;&lt;/a&gt; fix bug in JSON output from CLI (tallison: &lt;a href=&quot;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1598023&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/tika/trunk/?view=rev&amp;amp;rev=1598023&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/tika/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-app/src/main/java/org/apache/tika/io&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-app/src/main/java/org/apache/tika/io/json&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-app/src/main/java/org/apache/tika/io/json/JsonMetadataSerializer.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-app/src/test/java/org/apache/tika/cli/TikaCLITest.java&lt;/li&gt;
	&lt;li&gt;/tika/trunk/tika-app/src/test/resources/test-data/testJsonMultipleInts.html&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12716509">TIKA-1310</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 7 May 2014 14:43:02 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>390890</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzp6kf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>391125</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>