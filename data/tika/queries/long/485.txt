If a file has a POI magic number but the call to  new POIFSFileSystem(new FileInputStream(stream.getFile())); throws an exception because the file is broken - the entire process will fail. A simple try-catch around the call to POIFSContainerDetector.detect would allow the ContainerAwareDetector to return a meaningful result