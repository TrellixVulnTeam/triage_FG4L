<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:25:49 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-675/MAHOUT-675.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-675] LuceneIterator throws an IllegalStateException when a null TermFreqVector is encountered for a document instead of skipping to the next one</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-675</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;The org.apache.mahout.utils.vectors.lucene.LuceneIterator currently throws an IllegalStateException if it encounters a document with a null term frequency vector for the target field in the computeNext() method. That is problematic for people who are developing text mining applications on top of lucene as it forces them to check that the documents that they are adding to their lucene indexes actually have terms for the target field. While that check may sound reasonable, it actually is not in practice.&lt;/p&gt;

&lt;p&gt;Lucene in most cases will apply an analyzer to a field in a document as it is added to the index. The StandardAnalyzer is pretty lenient and barely removes any terms. In most cases though, if you want to have better text mining performance, you will create your own custom analyzer. For example, in my current work with document clustering, in order to generate tighter clusters and have more human readable top terms, I am using a stop word list specific to my subject domain and I am filtering out terms that contain numbers. The net result is that some of my documents have no terms for the target field which is a desirable outcome. When I attempt to dump the lucene vectors though, I encounter an IllegalStateException because of those documents.&lt;/p&gt;

&lt;p&gt;Now it is possible for me to check the TokenStream of the target field before I insert into my index however, if we were to follow that approach, it means for each of my applications, I would have to perform this check. That isn&apos;t a great practice as someone could be experimenting with custom analyzers to improve text mining performance and then encounter this exception without any real indication that it was due to the custom analyzer.&lt;/p&gt;

&lt;p&gt;I believe a better approach is to log a warning with the field id of the problem document and then skip to the next one. That way, a warning will be in the logs and the lucene vector dump process will not halt.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12504570">MAHOUT-675</key>
            <summary>LuceneIterator throws an IllegalStateException when a null TermFreqVector is encountered for a document instead of skipping to the next one</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tdunning">Ted Dunning</assignee>
                                    <reporter username="cpjordan79">Chris Jordan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Apr 2011 18:27:10 +0100</created>
                <updated>Sat, 21 May 2011 04:19:01 +0100</updated>
                            <resolved>Mon, 25 Apr 2011 12:39:13 +0100</resolved>
                                                    <fixVersion>0.5</fixVersion>
                                    <component>Integration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13021135" author="cpjordan79" created="Mon, 18 Apr 2011 18:31:19 +0100"  >&lt;p&gt;I have patch the LuceneIterator. It is a mild change that also adds a Logger instance.&lt;/p&gt;</comment>
                            <comment id="13021288" author="srowen" created="Mon, 18 Apr 2011 22:45:38 +0100"  >&lt;p&gt;I looked at this recently and agree this sounds like at least equally reasonable behavior.&lt;/p&gt;</comment>
                            <comment id="13021366" author="cpjordan79" created="Tue, 19 Apr 2011 01:51:03 +0100"  >&lt;p&gt;I have attached a minor addition to my patch. It was brought up by Ted Dunning in the dev list that we could also configure an exception to be thrown after X percentage of error document have been encountered. I made this percentage a float as if the corpus is considerably large, in the order of a million or more, one percent could be too much.&lt;/p&gt;

&lt;p&gt;Since the previous patch has been applied, should I open a new ticket, repull the repo, and create a new patch?&lt;/p&gt;</comment>
                            <comment id="13021425" author="srowen" created="Tue, 19 Apr 2011 07:49:49 +0100"  >&lt;p&gt;Patches should always be against head but I can figure this one out.&lt;/p&gt;</comment>
                            <comment id="13021501" author="hudson" created="Tue, 19 Apr 2011 10:07:27 +0100"  >&lt;p&gt;Integrated in Mahout-Quality #760 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Mahout-Quality/760/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/Mahout-Quality/760/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-675&quot; title=&quot;LuceneIterator throws an IllegalStateException when a null TermFreqVector is encountered for a document instead of skipping to the next one&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-675&quot;&gt;&lt;del&gt;MAHOUT-675&lt;/del&gt;&lt;/a&gt; part 2, throw an exception if too many errors&lt;/p&gt;</comment>
                            <comment id="13021796" author="tdunning" created="Tue, 19 Apr 2011 21:54:04 +0100"  >&lt;p&gt;I think we need to limit the amount of logging.  Patch coming for review.&lt;/p&gt;</comment>
                            <comment id="13021797" author="tdunning" created="Tue, 19 Apr 2011 21:55:03 +0100"  >&lt;p&gt;This does exponential backoff on the logging to limit log file size in pathological cases.&lt;/p&gt;</comment>
                            <comment id="13021893" author="cpjordan79" created="Wed, 20 Apr 2011 02:14:52 +0100"  >&lt;p&gt;Thanks Ted. I made a couple minor revision. There was a small bug with the logging logic.&lt;/p&gt;</comment>
                            <comment id="13021894" author="cpjordan79" created="Wed, 20 Apr 2011 02:15:44 +0100"  >&lt;p&gt;I tested this patch against my own data set that contains noise documents it works.&lt;/p&gt;</comment>
                            <comment id="13021896" author="tdunning" created="Wed, 20 Apr 2011 02:31:09 +0100"  >&lt;p&gt;Chris,&lt;/p&gt;

&lt;p&gt;Good catch on the initialization.&lt;/p&gt;

&lt;p&gt;I will make the test more robust.&lt;/p&gt;</comment>
                            <comment id="13021900" author="tdunning" created="Wed, 20 Apr 2011 02:47:17 +0100"  >&lt;p&gt;Incorporating Chris&apos; comments, slightly robustified.&lt;/p&gt;

&lt;p&gt;Chris,&lt;/p&gt;

&lt;p&gt;Is there a good way to write a test case for the LuceneIterator?&lt;/p&gt;

&lt;p&gt;Once we have that, I am happy to commit this.&lt;/p&gt;

&lt;p&gt;On style issues, you can just reuse the same patch name.  JIRA handles that very nicely.&lt;/p&gt;</comment>
                            <comment id="13022047" author="gsingers" created="Wed, 20 Apr 2011 10:37:37 +0100"  >&lt;p&gt;I don&apos;t agree that we should just swallow the exception.  While I understand Chris&apos; point and can see the use case for it at times, in most instances the lack of a vector is an error and it should be treated as such.  I think this should be reverted and we should perhaps supply two options: one that logs and one that throws the exception.&lt;/p&gt;</comment>
                            <comment id="13022147" author="cpjordan79" created="Wed, 20 Apr 2011 15:19:14 +0100"  >&lt;p&gt;Ted - I am working on a new unit test for this functionality and should have it done shortly.&lt;/p&gt;

&lt;p&gt;Grant - Well we can actually just make the default value for the maximum percentage of error documents to be 0. That will force developers that want to swallow this exception set the percentage.&lt;/p&gt;

&lt;p&gt;I get where you are coming from Grant however, when you are building a Lucene index, it is not entirely intuitive to filter out documents that have no legit terms in their respective term vectors. You basically have to apply your analyzer twice. Once to check that the document has terms in its vector and once to add it to the index. This issue really manifests itself when you are creating custom analyzers which is important if you are doing anything more than just basic text mining; the StandardAnalyzer that is provide by Lucene is not adequate for actual real production text mining.&lt;/p&gt;

&lt;p&gt;I think the default 0 percentage for error documents should satisfy your needs Grant while allowing people that doing more aggressive text mining operations the flexibility that they need.&lt;/p&gt;</comment>
                            <comment id="13022198" author="tdunning" created="Wed, 20 Apr 2011 17:30:26 +0100"  >&lt;p&gt;Chris,&lt;/p&gt;

&lt;p&gt;Great stuff.  Thanks for the effort.&lt;/p&gt;

&lt;p&gt;Grant,&lt;/p&gt;

&lt;p&gt;Even in the database world, bulk import utilities allow for some percentage of ill-formed records.  For example, with mysql&apos;s import utility, note the --force option ( &lt;a href=&quot;http://dev.mysql.com/doc/refman/5.1/en/mysqlimport.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dev.mysql.com/doc/refman/5.1/en/mysqlimport.html&lt;/a&gt; ).  With Oracle&apos;s SQL*Loader, note the error limit option which has a default of 50 ( &lt;a href=&quot;http://www.cs.umbc.edu/portal/help/oracle8/server.815/a67792/ch06.htm&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.cs.umbc.edu/portal/help/oracle8/server.815/a67792/ch06.htm&lt;/a&gt; ).&lt;/p&gt;

&lt;p&gt;My experience is that the text world is a bit wilder and woolier than the SQL world and that legacy data issues often require a bit of bending of the rules.&lt;/p&gt;</comment>
                            <comment id="13022334" author="gsingers" created="Wed, 20 Apr 2011 20:47:24 +0100"  >&lt;p&gt;I fully agree with all the points, I just don&apos;t think it should be the default to only log the exception.  Users should explicitly state that they want to ignore a potential error condition.  Sounds like default 0% is the way to go.&lt;/p&gt;</comment>
                            <comment id="13022756" author="cpjordan79" created="Thu, 21 Apr 2011 15:11:46 +0100"  >&lt;p&gt;I added a unit test for checking that the exception is properly thrown if there are too many noise documents. I needed to update LuceneIterable to have an additional constructor that could take a maxPercentErrorDocs parameter. I also adjusted LuceneIterator so that by default it will throw an exception when it encounters a noise document.&lt;/p&gt;

&lt;p&gt;Once this patch get merged in, I will update the patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-671&quot; title=&quot;Refactor org.apache.mahout.utils.vectors.lucene.Driver into a POJO&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-671&quot;&gt;&lt;del&gt;MAHOUT-671&lt;/del&gt;&lt;/a&gt; so the driver will be able to configure maxPercentErrorDocs as well.&lt;/p&gt;</comment>
                            <comment id="13022798" author="tdunning" created="Thu, 21 Apr 2011 16:56:26 +0100"  >&lt;p&gt;OK.&lt;/p&gt;

&lt;p&gt;I will take this on this morning.  It will take me a few minutes to make sure I have all the patches in place.&lt;/p&gt;</comment>
                            <comment id="13022804" author="tdunning" created="Thu, 21 Apr 2011 17:04:25 +0100"  >&lt;p&gt;Chris,&lt;/p&gt;

&lt;p&gt;It looks like you didn&apos;t tick off the &quot;License this code to the ASF checkbox&quot;.&lt;/p&gt;

&lt;p&gt;Can you confirm it is OK to license this under the Apache License?&lt;/p&gt;</comment>
                            <comment id="13022808" author="cpjordan79" created="Thu, 21 Apr 2011 17:11:28 +0100"  >&lt;p&gt;Oops, sorry about that :-/&lt;/p&gt;

&lt;p&gt;Yes, it is definitely ok to license this under the Apache License.&lt;/p&gt;</comment>
                            <comment id="13022824" author="tdunning" created="Thu, 21 Apr 2011 17:44:30 +0100"  >&lt;p&gt;Chris,  Thanks for that.&lt;/p&gt;

&lt;p&gt;Meanwhile, the patch applies and builds and tests cleanly.  I will commit in a few minutes.&lt;/p&gt;</comment>
                            <comment id="13023159" author="hudson" created="Fri, 22 Apr 2011 09:47:26 +0100"  >&lt;p&gt;Integrated in Mahout-Quality #769 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Mahout-Quality/769/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/Mahout-Quality/769/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12476632" name="MAHOUT-675" size="1409" author="cpjordan79" created="Mon, 18 Apr 2011 18:31:19 +0100"/>
                            <attachment id="12476677" name="MAHOUT-675-1" size="3257" author="cpjordan79" created="Tue, 19 Apr 2011 01:51:03 +0100"/>
                            <attachment id="12476813" name="MAHOUT-675-1.patch" size="2305" author="cpjordan79" created="Wed, 20 Apr 2011 02:14:52 +0100"/>
                            <attachment id="12477016" name="MAHOUT-675.patch" size="7999" author="cpjordan79" created="Thu, 21 Apr 2011 17:26:53 +0100"/>
                            <attachment id="12476815" name="MAHOUT-675.patch" size="5069" author="tdunning" created="Wed, 20 Apr 2011 02:47:17 +0100"/>
                            <attachment id="12476780" name="MAHOUT-675.patch" size="4984" author="tdunning" created="Tue, 19 Apr 2011 21:55:03 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 18 Apr 2011 21:45:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9387</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy3o7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22746</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>