<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:20:41 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-11/MAHOUT-11.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-11] Static fields used throughout clustering code (Canopy, K-Means).</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-11</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;I file this as a bug, even though I&apos;m not 100% sure it is one. In the currect code the information is exchanged via static fields (for example, distance measure and thresholds for Canopies are static field). Is it always true in Hadoop that one job runs inside one JVM with exclusive access? I haven&apos;t seen it anywhere in Hadoop documentation and my impression was that everything uses JobConf to pass configuration to jobs, but jobs are configured on a per-object basis (a job is an object, a mapper is an object and everything else is basically an object).&lt;/p&gt;

&lt;p&gt;If it&apos;s possible for two jobs to run in parallel inside one JVM then this is a limitation and bug in our code that needs to be addressed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12390325">MAHOUT-11</key>
            <summary>Static fields used throughout clustering code (Canopy, K-Means).</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="drew.farris">Drew Farris</assignee>
                                    <reporter username="dweiss">Dawid Weiss</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Mar 2008 09:35:48 +0000</created>
                <updated>Sat, 21 May 2011 04:24:17 +0100</updated>
                            <resolved>Thu, 10 Dec 2009 09:40:59 +0000</resolved>
                                    <version>0.1</version>
                                    <fixVersion>0.3</fixVersion>
                                    <component>Clustering</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12779455" author="srowen" created="Wed, 18 Nov 2009 13:55:09 +0000"  >&lt;p&gt;I agree with this, this is bad design. I will take on this old issue to try to patch up.&lt;/p&gt;</comment>
                            <comment id="12779893" author="srowen" created="Thu, 19 Nov 2009 09:21:37 +0000"  >&lt;p&gt;I looked at this in depth and think it is going to happen to work in many cases, but not all. It doesn&apos;t attempt to share data via these statics &amp;#8211; I think. This is some global configuration about how the algorithm works that, actually, every Mapper sets and overwrites.&lt;/p&gt;

&lt;p&gt;If they&apos;re all setting the same values, this doesn&apos;t fail. &lt;b&gt;But we don&apos;t know that&lt;/b&gt; &amp;#8211; we have no guarantee Hadoop isn&apos;t running mappers for several jobs in one JVM. Then this would be a serious bug as two jobs would be overwriting each others&apos; parameters continuously.&lt;/p&gt;

&lt;p&gt;Really there are two separable concerns here:&lt;br/&gt;
1) Representing one canopy&lt;br/&gt;
2) Implementing the canopy algorithm&lt;/p&gt;

&lt;p&gt;These are bundled together into one class, with the static stuff representing the algorithm and the non-static stuff representing the canopy. I think these should be explicitly separated so it&apos;s clear where this data lives. Having it live in static-land gets confusing to think about in a distributed environment &amp;#8211; and leads to subtle bugs that may not be immediately obvious.&lt;/p&gt;

&lt;p&gt;Having got halfway through a patch, it&apos;s looking like a lot of surgery I&apos;m not qualified to do, so I am not going to proceed on this.&lt;/p&gt;

&lt;p&gt;I think it&apos;s a hard to ignore issue &amp;#8211; who wrote this and what do you think?&lt;/p&gt;</comment>
                            <comment id="12780146" author="isabel" created="Thu, 19 Nov 2009 17:19:49 +0000"  >&lt;p&gt;Not the original author of the source, but still managed to get the static fields out of the k-means clustering code. All unit-tests are still passing. However I would feel a lot better, if someone else double-checked the changes made.&lt;/p&gt;

&lt;p&gt;Looking at the code, I spotted some more points that could benefit from being revisited (e.g. usage of deprecated MapReduce APIs and introduction of status reports). But this should be done in a separate issue.&lt;/p&gt;</comment>
                            <comment id="12780402" author="drew.farris" created="Fri, 20 Nov 2009 03:08:18 +0000"  >&lt;p&gt;Isabel, I reviewed the changes and they look great. The refactoring of the code into KMeansClusterer is especially nice. &lt;/p&gt;

&lt;p&gt;Would there be a benefit to passing the output collector into KMeansClusterer.(emitPointToNearestCluster|outputPointWithClusterInfo) methods directly? It would reduce the amount of object creation/garbage collection, which I suspect is worth being concerned with in this case because a Pair&amp;lt;?,?&amp;gt; is created per point per iteration and per point for the clustering. It should not impact testability of these methods because OutputCollector&amp;lt;?,?&amp;gt; is an interface which can either be mocked or stubbed.&lt;/p&gt;

&lt;p&gt;Also agree that the use of deprecated MapReduce APIs should be handled elsewhere, likely across all usages if possible.&lt;/p&gt;

&lt;p&gt;I&apos;m going to try a run on some real data with your patch applied this evening, if I run into any problems I&apos;ll follow up.&lt;/p&gt;</comment>
                            <comment id="12780476" author="isabel" created="Fri, 20 Nov 2009 07:33:22 +0000"  >&lt;p&gt;First of all, thanks for the review.&lt;/p&gt;

&lt;p&gt;Passing the output collector directly - Jepp, makes sense. Will change and resubmit the patch.&lt;/p&gt;

&lt;p&gt;Tests with real data: Big thanks for that.&lt;/p&gt;

&lt;p&gt;Isabel&lt;/p&gt;</comment>
                            <comment id="12780510" author="srowen" created="Fri, 20 Nov 2009 10:54:33 +0000"  >&lt;p&gt;Yes that&apos;s certainly looking good. The &quot;good&quot; news is the Canopy jobs need the same treatment, as do a few others!&lt;/p&gt;</comment>
                            <comment id="12780884" author="drew.farris" created="Sat, 21 Nov 2009 02:07:31 +0000"  >&lt;p&gt;FWIW, I&apos;m running into some strangeness of some sort, it seems that emitPointToNearestCluster is only looking at a single cluster although my -k is set to 100 for my input. I&apos;m tracking it down, it could be a problem unrelated to this patch.&lt;/p&gt;</comment>
                            <comment id="12780909" author="drew.farris" created="Sat, 21 Nov 2009 04:24:22 +0000"  >&lt;p&gt;Found the problem, which I believe is isolated to the case where kmeans cluster uses random seed clusters as a basis for clustering.&lt;/p&gt;

&lt;p&gt;In RandomSeedGenerator, no cluster ids are assigned, so all clusters generated get an id of zero when being written to the sequence file. If all cluster id&apos;s are zero, KmeansClusterer.outputPointWithClusterInfo winds up assigning all points to the same cluster. This issue was hidden previously because Cluster id&apos;s were assigned in the Cluster(Vector) constructor. &lt;/p&gt;

&lt;p&gt;I&apos;ve attached a small patch for RandomSeedGenerator. This should probably be accompanied by a unit test, but I haven&apos;t had the chance to put one together.&lt;/p&gt;
</comment>
                            <comment id="12781762" author="drew.farris" created="Tue, 24 Nov 2009 04:09:19 +0000"  >&lt;p&gt;Attached a patch that takes Isabel&apos;s original patch to remove static fields in kmeans clustering, makes the discussed change for the output collectors, cleans up some warnings and unused instance of the convergenceDelta variable. Fixes the RandomSeedGenerator in kmeans clustering and adds a unit test for it. Also, KMeansClusterer no longer extends Cluster &amp;#8211; it wasn&apos;t necessary to do so.&lt;/p&gt;

&lt;p&gt;Isabel, are you planning on taking a crack at the rest of the clustering code that uses static fields? I&apos;m finding this issue a great way to become familiar with the code, and if you&apos;re not already intending to work on it, I could give it a try.&lt;/p&gt;
</comment>
                            <comment id="12782470" author="isabel" created="Wed, 25 Nov 2009 15:57:41 +0000"  >&lt;p&gt;Drew, go ahead then.&lt;/p&gt;</comment>
                            <comment id="12783293" author="drew.farris" created="Sat, 28 Nov 2009 21:50:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-11&quot; title=&quot;Static fields used throughout clustering code (Canopy, K-Means).&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-11&quot;&gt;&lt;del&gt;MAHOUT-11&lt;/del&gt;&lt;/a&gt;-all-cleanup-20091128.patch eliminates the use of static fields for configuration in the clustering code in all cases where it was present: canopy, kmeans, fuzzykmeans and meanshift. It retains Isabel&apos;s original patch to the kmeans package, with the exception of the items discussed previously, and adds similar changes to the other packages. It also includes the fix to and unit test for RandomSeedGenerator previously included.&lt;/p&gt;

&lt;p&gt;Applied against rev 883446, all unit tests are passing, and I&apos;ve run the kmeans code on real data. It would be really great if someone could double check the changes and comment.&lt;/p&gt;</comment>
                            <comment id="12784280" author="drew.farris" created="Tue, 1 Dec 2009 16:24:04 +0000"  >&lt;p&gt;see attached: &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-11&quot; title=&quot;Static fields used throughout clustering code (Canopy, K-Means).&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-11&quot;&gt;&lt;del&gt;MAHOUT-11&lt;/del&gt;&lt;/a&gt;-all-cleanup-20091128.patch&lt;/p&gt;</comment>
                            <comment id="12785985" author="isabel" created="Fri, 4 Dec 2009 16:19:17 +0000"  >&lt;p&gt;Applies cleanly and builds w/o unit test failures here.&lt;/p&gt;

&lt;p&gt;The changes look all good to me. Great work, Drew.&lt;/p&gt;

&lt;p&gt;One question though: In the TestMeanShift test (lines 301 and 304) you removed the canopyId adjustments - could you please explain what was the reason this was necessary?&lt;/p&gt;

&lt;p&gt;I would like to commit this patch next week if noone objects.&lt;/p&gt;</comment>
                            <comment id="12786144" author="drew.farris" created="Fri, 4 Dec 2009 20:36:21 +0000"  >&lt;p&gt;Thanks very much for the review Isabel. &lt;/p&gt;

&lt;p&gt;Regarding the canopyId adjustments in TestMeanShift: Prior to the patch, classes like Canopy and MeanShiftCanopy assigned their ids in their constructors using a static field. I&apos;ve changed this so that classes that create Canopy/MeanShiftCanopy objects are responsible for assigning cluster ids. As a result, there is no longer a need to offset the canopy id&apos;s in TestMeanShift because both the reference set and map/reduce (clusterer) generated canopies start are able to generate canopies starting at an id of 0.&lt;/p&gt;

&lt;p&gt;Using the static fields in the Classes themselves and then having to work around that in the unit tests felt a little funny to me. It could be limiting in cases where id&apos;s must be assigned from some external source, or perhaps to be consistent in a distributed environment. More specifically it seemed to go along with the spirit of the original issue and pushing the responsibility for id management up to the users of the classes seems like a good thing.&lt;/p&gt;

&lt;p&gt;FWIW, While reviewing this, I happened to noticed that the nextCanopyId field could be removed from MeanShiftCanopyClusterer entirely. Can you fix this prior to commit Isabel, or should I submit another patch?&lt;/p&gt;</comment>
                            <comment id="12788129" author="isabel" created="Wed, 9 Dec 2009 15:45:21 +0000"  >&lt;p&gt;I&apos;ll make the changes before committing - no need to submit a new patch version.&lt;/p&gt;</comment>
                            <comment id="12788626" author="isabel" created="Thu, 10 Dec 2009 09:40:59 +0000"  >&lt;p&gt;Committed. Thanks Drew for your help.&lt;/p&gt;</comment>
                            <comment id="12788672" author="isabel" created="Thu, 10 Dec 2009 11:09:10 +0000"  >&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12425704" name="MAHOUT-11-RandomSeedGenerator.patch" size="819" author="drew.farris" created="Sat, 21 Nov 2009 04:24:22 +0000"/>
                            <attachment id="12426338" name="MAHOUT-11-all-cleanup-20091128.patch" size="155316" author="drew.farris" created="Sat, 28 Nov 2009 21:50:25 +0000"/>
                            <attachment id="12425931" name="MAHOUT-11-kmeans-cleanup.patch" size="3296571" author="drew.farris" created="Tue, 24 Nov 2009 04:09:19 +0000"/>
                            <attachment id="12425492" name="MAHOUT-11.patch" size="39571" author="isabel" created="Thu, 19 Nov 2009 17:19:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 18 Nov 2009 13:55:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10055</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy7r3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23407</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>