<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:22:47 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-838/MAHOUT-838.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-838] Make the confusion matrix writable to a file when testing classifiers</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-838</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;If you have a lot of labels for a classifier, the confusion matrix is hard to fit in terminal window.  Would be nice if we could write it out to a file.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12526525">MAHOUT-838</key>
            <summary>Make the confusion matrix writable to a file when testing classifiers</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean Owen</assignee>
                                    <reporter username="gsingers">Grant Ingersoll</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Oct 2011 23:17:35 +0100</created>
                <updated>Thu, 9 Feb 2012 14:00:48 +0000</updated>
                            <resolved>Fri, 4 Nov 2011 11:20:11 +0000</resolved>
                                                    <fixVersion>0.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13124685" author="lancenorskog" created="Tue, 11 Oct 2011 05:51:10 +0100"  >&lt;p&gt;Something like &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12498512/12498512_bayes-cm-10.html&quot; title=&quot;bayes-cm-10.html attached to MAHOUT-838&quot;&gt;this&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;, for example?&lt;/p&gt;

&lt;p&gt;A tip for those of you who can use tools: find the Easter egg.&lt;/p&gt;
</comment>
                            <comment id="13124721" author="lancenorskog" created="Tue, 11 Oct 2011 07:04:04 +0100"  >&lt;p&gt;This is I think feature-complete&amp;amp;tested. Needs looking and Apache headers.&lt;/p&gt;</comment>
                            <comment id="13128616" author="joekumar" created="Mon, 17 Oct 2011 04:06:24 +0100"  >&lt;p&gt;Lance,&lt;br/&gt;
I just tried applying your patch and ran the TestClassifier as below&lt;br/&gt;
$./bin/mahout testclassifier   -m /tmp/mahout-work-joekumar/20news-bydate/bayes-model   -d /tmp/mahout-work-joekumar/20news-bydate/bayes-test-input   -type bayes   -ng 1   -source hdfs   -method mapreduce -cm 20newsconfusion&lt;br/&gt;
and got the below exception&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.lang.Error: Unresolved compilation problem: &lt;br/&gt;
	The method getMatrix() is undefined for the type ConfusionMatrix	at org.apache.mahout.classifier.bayes.mapreduce.bayes.BayesClassifierDriver.confusionMatrixSeqFileExport(BayesClassifierDriver.java:144)&lt;br/&gt;
	at org.apache.mahout.classifier.bayes.mapreduce.bayes.BayesClassifierDriver.runJob(BayesClassifierDriver.java:94)&lt;br/&gt;
	at org.apache.mahout.classifier.bayes.TestClassifier.classifyParallel(TestClassifier.java:291)&lt;br/&gt;
	at org.apache.mahout.classifier.bayes.TestClassifier.main(TestClassifier.java:194)&lt;br/&gt;
...&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;I searched in the patch file to see an implementation getMatrix() but couldnt find any. Is there a dependent patch or something ? plz let me know if i&apos;m missing something&lt;/p&gt;

&lt;p&gt;Currently when TestClassifier is run with method option as mapreduce, it doesnt print the Summary. Printing a confusion matrix similar to the screenshot you have attached in this task would be great.&lt;/p&gt;

&lt;p&gt;thanks&lt;br/&gt;
Joe.&lt;/p&gt;</comment>
                            <comment id="13130326" author="joekumar" created="Wed, 19 Oct 2011 04:03:06 +0100"  >&lt;p&gt;Patch in Mahout-812 has to be applied before applying this patch&lt;/p&gt;</comment>
                            <comment id="13133241" author="lancenorskog" created="Sat, 22 Oct 2011 05:22:48 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-812&quot; title=&quot;Allow ConfusionMatrix to be Writable (via MatrixWritable)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-812&quot;&gt;&lt;del&gt;MAHOUT-812&lt;/del&gt;&lt;/a&gt; was committed on Oct. 3. If your checkout is up-to-date, you should not need to apply it.&lt;/p&gt;</comment>
                            <comment id="13133255" author="lancenorskog" created="Sat, 22 Oct 2011 07:00:04 +0100"  >&lt;p&gt;Replace these files with the uploaded versions;&lt;br/&gt;
ConfusionMatrix.java&lt;br/&gt;
MatrixWritable.java&lt;/p&gt;

&lt;p&gt;Then, apply the &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-838&quot; title=&quot;Make the confusion matrix writable to a file when testing classifiers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-838&quot;&gt;&lt;del&gt;MAHOUT-838&lt;/del&gt;&lt;/a&gt;_mini.patch. &lt;/p&gt;

&lt;p&gt;Somehow, my patch generation and applying tools are wildly confused by the previous patch. Also, they do not give the option to merely replace a file. Perhaps it because it is Friday. Perhaps it is because I&apos;m using Cygwin. Perhaps it is merely because &lt;em&gt;I am bad&lt;/em&gt;. Whatever the reason, I cannot create that standard patch for this upgrade. &lt;/p&gt;</comment>
                            <comment id="13133355" author="srowen" created="Sat, 22 Oct 2011 13:34:18 +0100"  >&lt;p&gt;Lance I tried just this, but I still get compile errors. Your posted ConfusionMatrix.java and MatrixWritable.java are identical to HEAD, but are missing methods the new code requires.&lt;/p&gt;

&lt;p&gt;Where is cmdump.props used? is it needed?&lt;/p&gt;

&lt;p&gt;It feels like the matrix and confusion matrix dumper have similar roles. I&apos;d imagine they both go in examples, or both in integration? Integration feels a bit righter.&lt;/p&gt;

&lt;p&gt;Finally I&apos;d have a run at scrubbing style &amp;#8211; there are some unused imports, unthrown exceptions, constants that aren&apos;t static or final, etc.&lt;/p&gt;

&lt;p&gt;Once you sort out your env, make up another omnibus patch here with all relevant changes.&lt;/p&gt;</comment>
                            <comment id="13133811" author="lancenorskog" created="Mon, 24 Oct 2011 03:50:11 +0100"  >&lt;p&gt;Redone. Everything applies, compiles, runs as doc&apos;d.&lt;br/&gt;
Formatted acc&apos;d to the Lucene format prescribed on the wiki.&lt;br/&gt;
All files have Apache header.&lt;/p&gt;</comment>
                            <comment id="13133866" author="srowen" created="Mon, 24 Oct 2011 08:14:48 +0100"  >&lt;p&gt;OK, better. Now we&apos;re to small items. Javadoc must start with /** or it isn&apos;t javadoc. Always put braces on conditionals. Why are you making all the Maps into LinkedHashMap? I don&apos;t see a reason to order by access time. I see stanzas like:&lt;/p&gt;

&lt;p&gt;		String cmPath = params.get(&quot;confusionMatrix&quot;);&lt;br/&gt;
	        cmPath = &quot;/tmp&quot;;&lt;/p&gt;

&lt;p&gt;This can&apos;t be right can it &amp;#8211; are there still remanants of debugging code? likewise I see lines like &quot;object.hashCode();&quot; which are no-ops.&lt;/p&gt;

&lt;p&gt;You have a comment about using AbstractJob methods &amp;#8211; yes, can this be done upfront?&lt;/p&gt;

&lt;p&gt;What&apos;s the purpose of PrintConfusionMatrix? it seems like the other two new Dumper classes fulfill the role outlined in this JIRA.&lt;/p&gt;</comment>
                            <comment id="13135889" author="joekumar" created="Wed, 26 Oct 2011 13:11:48 +0100"  >&lt;p&gt;Lance, &lt;br/&gt;
In the attached html file, the confusion matrix has a summary with the labels and the Correct instance count with the % When I run testClassifier, I couldnt see this summary in the output. I exec the testclassifier as below ./bin/mahout testclassifier -m /tmp/mahout-work-joekumar/20news-bydate/bayes-model -d /tmp/mahout-work-joekumar/20news-bydate/bayes-test-input -type bayes -ng 1 -source hdfs -method mapreduce -cm 20newconfuxion &lt;/p&gt;

&lt;p&gt;The summary is printed in the console when we run the testclassifier in a sequential mode. The toString() of ResultAnalyzer implements the summary info that is being printed in the console. Should we make the summary info as part of the ConfusionMatrix ? Should this be a separate JIRA issue ? In the end, it&apos;d be good to be able to print / write the summary along with the matrix. plz let me know what the best approach would be. &lt;/p&gt;

&lt;p&gt;Joe.&lt;/p&gt;</comment>
                            <comment id="13139559" author="lancenorskog" created="Sun, 30 Oct 2011 07:47:47 +0000"  >&lt;p&gt;This is roughly what I uploaded last time and marked &apos;Patch Available&apos; (I thought). Weird.&lt;/p&gt;

&lt;p&gt;Ok, I&apos;m pretty happy with this one. Print* is folded into ConfusionMatrixDumper. Both Dumpers are AbstractJob.&lt;/p&gt;

&lt;p&gt;One quirk: AbstractJob does not support optional inputPath or outputPath when you use those convenience methods. &lt;/p&gt;

&lt;p&gt;It&apos;s a lot more streamlined as to options and features. The options to pick what tables you want are gone: you get all four HTML outputs. The low-level print methods for all are public static. Only MatrixDumper does CSV.&lt;/p&gt;</comment>
                            <comment id="13139560" author="lancenorskog" created="Sun, 30 Oct 2011 07:51:47 +0000"  >&lt;p&gt;Joe-&lt;/p&gt;

&lt;p&gt;I see your point. I have code to extract the summary in the patch. I don&apos;t know where it should go. The toString() method is not the right place for what ConfusionMatrix does now. It should be a separate static method, I think.&lt;/p&gt;

&lt;p&gt;Lance&lt;/p&gt;</comment>
                            <comment id="13139691" author="srowen" created="Sun, 30 Oct 2011 18:17:57 +0000"  >&lt;p&gt;I&apos;m still seeing minor issues, like funny indentation, making all HashMap into LinkedHashMap (why?) and using &quot;+0.000001&quot; for rounding. Is this going to be suitable for committing or should we just let it hang out in this JIRA?&lt;/p&gt;</comment>
                            <comment id="13139712" author="tdunning" created="Sun, 30 Oct 2011 19:08:30 +0000"  >&lt;p&gt;No.  I think both of those issues (LinkedHashMap and bad rounding) are black-ball issues.&lt;/p&gt;

&lt;p&gt;They are going to have to be fixed eventually.  Might as well be now.&lt;/p&gt;

&lt;p&gt;For explanation, the principle behind the data type issue is that the declared type of a variable should be the weakest type possible to allow more polymorphism and freedom of implementation in other places.  For instance, List arguments should be Iterable if possible instead of List or ArrayList and Map&apos;s should be Maps rather than HashMap or LinkedHashMap unless there is a &lt;b&gt;really&lt;/b&gt; strong reason otherwise.&lt;/p&gt;

&lt;p&gt;For the rounding, it is simply a matter of correctness.  Adding a small number and then truncating is just not right.  THis is due to a number of reasons, but the short form reason is that floating point arithmetic is more complicated than it looks.  Doing rounding right in all the corner cases is harder than it looks and doing it wrong leads to code that behaves in very surprising and bad ways; these corner cases are they way they are in floating point math for very good reasons.&lt;/p&gt;</comment>
                            <comment id="13139955" author="lancenorskog" created="Mon, 31 Oct 2011 06:31:22 +0000"  >&lt;p&gt;Above comments are implemented. &lt;/p&gt;

&lt;p&gt;The ConfusionMatrix default column thing is clumsy. This printing code decides that if there are no unclassified items, then the user did not intend to have unclassified items.&lt;/p&gt;

&lt;p&gt;The MatrixDumper does row &amp;amp; column headers from the matrix now.&lt;/p&gt;
</comment>
                            <comment id="13141114" author="srowen" created="Tue, 1 Nov 2011 12:51:53 +0000"  >&lt;p&gt;Lance, there are still unresolved issues in this patch. For example, look at the &quot;/tmp&quot; issue I noted earlier. And now for example you&apos;re making a LinkedHashMap into a HashMap when I&apos;m not sure that&apos;s correct.&lt;/p&gt;

&lt;p&gt;To close this out, I will try to put this into a committable form on my end, and if it&apos;s all pretty minor I&apos;ll just commit it to move forward.&lt;/p&gt;</comment>
                            <comment id="13141147" author="srowen" created="Tue, 1 Nov 2011 13:14:29 +0000"  >&lt;p&gt;OK, um, somehow when I applied the patch, the IDE showed me the change as of the last time I applied the patch. Another application worked. So some comments were out of date, but not all.&lt;/p&gt;

&lt;p&gt;I think there are a number of small style issues with this patch, but it&apos;s close. Here is my proposal.&lt;/p&gt;</comment>
                            <comment id="13141963" author="srowen" created="Wed, 2 Nov 2011 06:45:43 +0000"  >&lt;p&gt;This patch still doesn&apos;t work for me &amp;#8211; tests still fail. If this patch is a bit of a struggle, we can consider leaving it in JIRA but otherwise closing it.&lt;/p&gt;</comment>
                            <comment id="13143685" author="lancenorskog" created="Fri, 4 Nov 2011 02:01:49 +0000"  >&lt;p&gt;There&apos;s something very wrong with how I&apos;m uploading. What I have is not what you are getting. I&apos;ll look into it.&lt;/p&gt;
</comment>
                            <comment id="13143784" author="lancenorskog" created="Fri, 4 Nov 2011 06:38:45 +0000"  >&lt;p&gt;The November 1 patch is correct:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12501764/MAHOUT-838.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12501764/MAHOUT-838.patch&lt;/a&gt;&lt;br/&gt;
md5: 41577c6103f8feaf3b44dee9efe53255&lt;/p&gt;

&lt;p&gt;Apply this to a fresh trunk. All of the tests run, and the two jobs run.&lt;/p&gt;

&lt;p&gt;There is one line that changes a HashMap to a LinkedHashMap, and that should not be there. Formatting problems- some existing code has funny indentation and this patch corrects it. Other than that, this is finished.&lt;/p&gt;

</comment>
                            <comment id="13143925" author="srowen" created="Fri, 4 Nov 2011 11:20:11 +0000"  >&lt;p&gt;OK that looks pretty good. Committed with some tweaks.&lt;/p&gt;</comment>
                            <comment id="13144456" author="lancenorskog" created="Fri, 4 Nov 2011 23:31:59 +0000"  >&lt;p&gt;Missing MatrixDumper app.&lt;/p&gt;</comment>
                            <comment id="13144458" author="lancenorskog" created="Fri, 4 Nov 2011 23:32:39 +0000"  >&lt;p&gt;Now we&apos;re all set to ditch matrix labels and re-implement it all &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13144548" author="hudson" created="Sat, 5 Nov 2011 03:43:33 +0000"  >&lt;p&gt;Integrated in Mahout-Quality #1151 (See &lt;a href=&quot;https://builds.apache.org/job/Mahout-Quality/1151/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Mahout-Quality/1151/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-838&quot; title=&quot;Make the confusion matrix writable to a file when testing classifiers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-838&quot;&gt;&lt;del&gt;MAHOUT-838&lt;/del&gt;&lt;/a&gt; add MatrixDumper&lt;/p&gt;

&lt;p&gt;srowen : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1197822&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1197822&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/mahout/trunk/integration/src/main/java/org/apache/mahout/utils/MatrixDumper.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12523469">MAHOUT-812</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12500301" name="ConfusionMatrix.java" size="8263" author="lancenorskog" created="Sat, 22 Oct 2011 07:00:04 +0100"/>
                            <attachment id="12501764" name="MAHOUT-838.patch" size="42296" author="srowen" created="Tue, 1 Nov 2011 13:14:28 +0000"/>
                            <attachment id="12501573" name="MAHOUT-838.patch" size="50000" author="lancenorskog" created="Mon, 31 Oct 2011 06:31:22 +0000"/>
                            <attachment id="12501502" name="MAHOUT-838.patch" size="42699" author="lancenorskog" created="Sun, 30 Oct 2011 07:47:47 +0000"/>
                            <attachment id="12500396" name="MAHOUT-838.patch" size="54701" author="lancenorskog" created="Mon, 24 Oct 2011 03:50:40 +0100"/>
                            <attachment id="12498522" name="MAHOUT-838.patch" size="47771" author="lancenorskog" created="Tue, 11 Oct 2011 07:03:14 +0100"/>
                            <attachment id="12500304" name="MAHOUT-838_mini.patch" size="41943" author="lancenorskog" created="Sat, 22 Oct 2011 07:01:50 +0100"/>
                            <attachment id="12502548" name="MatrixDumper.java" size="4948" author="lancenorskog" created="Fri, 4 Nov 2011 23:31:59 +0000"/>
                            <attachment id="12500302" name="MatrixWritable.java" size="5218" author="lancenorskog" created="Sat, 22 Oct 2011 07:00:04 +0100"/>
                            <attachment id="12498512" name="bayes-cm-10.html" size="9893" author="lancenorskog" created="Tue, 11 Oct 2011 05:51:10 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 11 Oct 2011 04:51:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56990</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy2nz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22583</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>