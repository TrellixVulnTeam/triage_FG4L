<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:19:40 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-1130/MAHOUT-1130.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-1130] Wrong logic in org.apache.mahout.clustering.kmeans.RandomSeedGenerator</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-1130</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;There is following code in line 101:&lt;/p&gt;

&lt;p&gt;              } else if (random.nextInt(currentSize + 1) != 0) { // with chance 1/(currentSize+1) pick new element&lt;/p&gt;

&lt;p&gt;but it actually means pick new element with chance currentSize/(currentSize+1)&lt;br/&gt;
so generator takes initial centers from the end of source data file.&lt;/p&gt;

&lt;p&gt;It seems that chance of replace vector in output set should decrease with number of processed input vectors&lt;/p&gt;</description>
                <environment>&lt;p&gt;mahout 0.7 from maven central&lt;/p&gt;</environment>
        <key id="12624816">MAHOUT-1130</key>
            <summary>Wrong logic in org.apache.mahout.clustering.kmeans.RandomSeedGenerator</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ssc">Sebastian Schelter</assignee>
                                    <reporter username="andrey.davydov">Andrey Davydov</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Dec 2012 13:45:16 +0000</created>
                <updated>Mon, 3 Feb 2014 08:06:03 +0000</updated>
                            <resolved>Tue, 12 Mar 2013 07:53:17 +0000</resolved>
                                    <version>0.7</version>
                                    <fixVersion>0.8</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13537027" author="andrey.davydov" created="Thu, 20 Dec 2012 14:02:28 +0000"  >&lt;p&gt;Problem added after fixig &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-900&quot; title=&quot;RandomSeedGenerator samples / output k texts incorrectly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-900&quot;&gt;&lt;del&gt;MAHOUT-900&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13537050" author="tdunning" created="Thu, 20 Dec 2012 14:48:21 +0000"  >&lt;p&gt;Andrey,&lt;/p&gt;

&lt;p&gt;I think you are correct, but we clearly have a missing test here.&lt;/p&gt;

&lt;p&gt;Is this functionality exposed enough that it would be susceptible to a unit test?&lt;/p&gt;

&lt;p&gt;Could you write such a test?&lt;/p&gt;</comment>
                            <comment id="13537058" author="tdunning" created="Thu, 20 Dec 2012 14:57:54 +0000"  >&lt;p&gt;A quick look indicates that, yes, this function is a public static.&lt;/p&gt;

&lt;p&gt;Andrey,  &lt;/p&gt;

&lt;p&gt;I am completely swamped.  The test needed here would be very simple.  It would need a sequence file &lt;br/&gt;
with test data.  This could be created at runtime from synthetic data or could be in the test resources&lt;br/&gt;
directory.  Then the test would run through the data several times picking a small number of seeds&lt;br/&gt;
from this data file and recording whether the last vector in the input appears in the sample.  If the&lt;br/&gt;
input sample is large-ish (say 10,000 vectors) and the sample small (10 or so), then the last vector&lt;br/&gt;
should only appear in the sample rarely (1/1000 times).  With the bug as you assert it, the last vector&lt;br/&gt;
would be in the sample with very high probability.&lt;/p&gt;

&lt;p&gt;If you add up the number of times the last few vectors appear in the sample, you should&lt;br/&gt;
either get a small number (correct) or a big number (incorrect).  This should be a very&lt;br/&gt;
sensitive test.&lt;/p&gt;

&lt;p&gt;I don&apos;t have time to do this.  Do you?  It would really help the projet to get this right.&lt;/p&gt;</comment>
                            <comment id="13537080" author="andrey.davydov" created="Thu, 20 Dec 2012 15:30:32 +0000"  >&lt;p&gt;I found this bug while I worked with 6500 vectors sample and I want to generate 30 initial clusters. I made more then 50 experiments. Every time all results was with id more then 5000.&lt;/p&gt;

&lt;p&gt;I can investigate more, but only on new year vacations (in Russia we have free week in the beginig of year). Also I can implement unit test and make some calculus to find way to achive best distribution of clusters.&lt;/p&gt;</comment>
                            <comment id="13599193" author="ssc" created="Mon, 11 Mar 2013 19:52:48 +0000"  >&lt;p&gt;This thing is really, really broken. I wrote a small test mimicing the way the seeds are picked. When I make it pick 10 items from a 100k candidates, it always picks them from the last 100...&lt;/p&gt;

&lt;p&gt;Try &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;: 99973 99981 99988 99991 99992 99993 99995 99997 99998 99999 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: 99976 99983 99986 99990 99991 99993 99994 99996 99997 99998 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;: 99957 99984 99986 99987 99989 99993 99994 99997 99998 99999 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt;: 99969 99975 99976 99984 99985 99988 99994 99995 99998 99999 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;4&amp;#93;&lt;/span&gt;: 99967 99971 99978 99990 99991 99992 99994 99995 99997 99998 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;5&amp;#93;&lt;/span&gt;: 99935 99981 99987 99988 99990 99991 99996 99997 99998 99999 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;6&amp;#93;&lt;/span&gt;: 99967 99971 99988 99990 99991 99992 99995 99997 99998 99999 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;7&amp;#93;&lt;/span&gt;: 99986 99987 99989 99991 99992 99993 99995 99997 99998 99999 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;8&amp;#93;&lt;/span&gt;: 99967 99982 99988 99991 99992 99993 99996 99997 99998 99999 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;9&amp;#93;&lt;/span&gt;: 99960 99981 99984 99986 99988 99995 99996 99997 99998 99999 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;10&amp;#93;&lt;/span&gt;: 99969 99974 99977 99988 99991 99993 99994 99997 99998 99999 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;11&amp;#93;&lt;/span&gt;: 99969 99977 99986 99991 99992 99993 99994 99995 99996 99998 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;12&amp;#93;&lt;/span&gt;: 99980 99984 99989 99991 99992 99994 99995 99997 99998 99999 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;13&amp;#93;&lt;/span&gt;: 99968 99971 99988 99990 99991 99992 99996 99997 99998 99999 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;14&amp;#93;&lt;/span&gt;: 99938 99976 99978 99985 99986 99989 99991 99993 99995 99997 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;15&amp;#93;&lt;/span&gt;: 99981 99984 99990 99992 99994 99995 99996 99997 99998 99999 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;16&amp;#93;&lt;/span&gt;: 99966 99976 99983 99985 99989 99991 99995 99996 99997 99999 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;17&amp;#93;&lt;/span&gt;: 99969 99972 99973 99981 99987 99988 99991 99994 99998 99999 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;18&amp;#93;&lt;/span&gt;: 99976 99984 99987 99990 99991 99992 99994 99996 99998 99999 &lt;br/&gt;
Try &lt;span class=&quot;error&quot;&gt;&amp;#91;19&amp;#93;&lt;/span&gt;: 99982 99987 99989 99992 99993 99994 99996 99997 99998 99999 &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testSeedSelection() {

  &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; k = 10;
  &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[] candidates = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[100000];
  &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numExperiments = 20;

  &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; n = 0; n &amp;lt; candidates.length; n++) {
    candidates[n] = n;
  }

  &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; experiment = 0; experiment &amp;lt; numExperiments; experiment++) {
    Random random = RandomUtils.getRandom(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis());

    List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; seeds = Lists.newArrayListWithCapacity(k);

    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; candidate : candidates) {

      &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; currentSize = seeds.size();
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (currentSize &amp;lt; k) {
        seeds.add(candidate);

      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (random.nextInt(currentSize + 1) != 0) {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; indexToRemove = random.nextInt(currentSize); &lt;span class=&quot;code-comment&quot;&gt;// evict one chosen randomly
&lt;/span&gt;        seeds.remove(indexToRemove);
        seeds.add(candidate);
      }
    }

    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.print(&lt;span class=&quot;code-quote&quot;&gt;&quot;Try [&quot;&lt;/span&gt; + experiment + &lt;span class=&quot;code-quote&quot;&gt;&quot;]: &quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; seed : seeds) {
      &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.print(seed + &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt;);
    }
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println();
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13599361" author="ssc" created="Mon, 11 Mar 2013 21:47:39 +0000"  >&lt;p&gt;Patch that makes the RandomSeedGenerator use reservoir sampling to pick a uniform sample of seed vectors. Can someone have a look at it?&lt;/p&gt;</comment>
                            <comment id="13599512" author="tdunning" created="Tue, 12 Mar 2013 00:02:42 +0000"  >&lt;p&gt;Sebastian,&lt;/p&gt;

&lt;p&gt;I see no patch here.  Is it late at night where you are?&lt;/p&gt;</comment>
                            <comment id="13599754" author="srowen" created="Tue, 12 Mar 2013 06:18:52 +0000"  >&lt;p&gt;The problem was really the != 0. I&apos;m sure something else like this was fixed elsewhere. Your change looks correct and avoids a second random choice. I don&apos;t have the source here. Make sure index is 1 based for this to work. You might search for other similar code and apply this to all. &lt;/p&gt;</comment>
                            <comment id="13599831" author="hudson" created="Tue, 12 Mar 2013 08:38:17 +0000"  >&lt;p&gt;Integrated in Mahout-Quality #1899 (See &lt;a href=&quot;https://builds.apache.org/job/Mahout-Quality/1899/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Mahout-Quality/1899/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-1130&quot; title=&quot;Wrong logic in org.apache.mahout.clustering.kmeans.RandomSeedGenerator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-1130&quot;&gt;&lt;del&gt;MAHOUT-1130&lt;/del&gt;&lt;/a&gt; Wrong logic in org.apache.mahout.clustering.kmeans.RandomSeedGenerator (Revision 1455420)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
ssc : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1455420&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1455420&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/clustering/kmeans/RandomSeedGenerator.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12573185" name="MAHOUT-1130.patch" size="2817" author="ssc" created="Mon, 11 Mar 2013 21:47:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 20 Dec 2012 14:48:21 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>301324</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz0ma7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>247617</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>