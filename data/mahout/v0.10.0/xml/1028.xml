<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:18:52 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-1028/MAHOUT-1028.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-1028] seq2sparse n-gram weighting creates malformed vectors which crashes kmeans</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-1028</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;I think I found the root but not sure what needs fixing.&lt;/p&gt;

&lt;p&gt;I took out n-gram generation and the vector now looks like this:&lt;br/&gt;
Key: &lt;a href=&quot;https://farfetchers.com/category/collections/source/brice-berard:&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://farfetchers.com/category/collections/source/brice-berard:&lt;/a&gt;&lt;br/&gt;
Value: &lt;a href=&quot;https://farfetchers.com/category/collections/source/brice-berard:&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://farfetchers.com/category/collections/source/brice-berard:&lt;/a&gt;&lt;/p&gt;
{701:0.5484552974788475,1876:0.6020428878306935,3620:0.5802940184767269}

&lt;p&gt;This works in clustering.&lt;/p&gt;

&lt;p&gt;It doesn&apos;t seem like a malformed vector should crash clustering (it apparently doesn&apos;t in mahout 0.6) but it looks like something in seq2sparse&apos;s n-gram weighting does cause a malformed vector.&lt;/p&gt;

&lt;p&gt;I&apos;ll file a JIRA&lt;/p&gt;

&lt;p&gt;On 6/5/12 11:48 AM, Pat Ferrel wrote:&lt;br/&gt;
&amp;gt; Using seqdumper on the TFIDF vectors, that vector is indeed in the list&lt;br/&gt;
&amp;gt; Key: &lt;a href=&quot;https://farfetchers.com/category/collections/source/brice-berard:&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://farfetchers.com/category/collections/source/brice-berard:&lt;/a&gt;&lt;br/&gt;
&amp;gt; Value: &lt;a href=&quot;https://farfetchers.com/category/collections/source/brice-berard:&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://farfetchers.com/category/collections/source/brice-berard:&lt;/a&gt;{&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; Looking in the seqfiles we find the document in part-00005 of 10 in no particular part of the file.&lt;br/&gt;
&amp;gt; Key: &lt;a href=&quot;https://farfetchers.com/category/collections/source/brice-berard:&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://farfetchers.com/category/collections/source/brice-berard:&lt;/a&gt;&lt;br/&gt;
&amp;gt; Value: ::Title::&lt;br/&gt;
&amp;gt; Brice Berard | FarFetchers.com&lt;br/&gt;
&amp;gt; Blog Posts&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; On the chance that this originates in seq2sparse I&apos;ll try changing options until the vector looks different. and try clustering again.&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; On 6/5/12 10:43 AM, Pat Ferrel wrote:&lt;br/&gt;
&amp;gt;&amp;gt; I&apos;m not completely sure what I&apos;m looking at but...&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; In iterateSeq on iteration #1  of processing vectors/tfidf-vectors it reads&lt;br/&gt;
&amp;gt;&amp;gt; vector = &quot;https://farfetchers.com/category/collections/source/brice-berard:{&quot;&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; it&apos;s a named vector where the  url is the name, the value is &quot;{&quot;, which looks wrong and when that is classified to get a probability it gets&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; probabilities = &quot;&lt;/p&gt;
{0:NaN,1:NaN,2:NaN,3:NaN,4:NaN,5:NaN,6:NaN,7:NaN,8:NaN,9:NaN,10:NaN,11:NaN,12:NaN,13:NaN,14:NaN,15:NaN,16:NaN,17:NaN,18:NaN,19:NaN}
&lt;p&gt;&quot;&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; That causes the probabilities.maxValueIndex() = -1 and everything dies.&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; vector looks wrong, doesn&apos;t it? Truncated?&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; I went back to try the same on mahout 0.6 but iterateSeq does not get called though I used -xm sequential on both runs. I can&apos;t see kmeans-clusters/clusters-0 being created on mahout 0.6 either. Is that part of the refactoring?&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; On 6/4/12 3:07 PM, Pat Ferrel wrote:&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; Some things to try:&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; - Have you verified the contents of your input vectors actually have data in them?&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; * YES, from the other email you know that the data works fine in 0.6&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; - Can you run the cluster dumper on the b3/kmeans-clusters/clusters-0 contents?&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; * YES, It is attached from trunk&apos;s clusterdump after the failure of kmeans, of course. A simple data set fortunately.&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; - Is it possible to run the sequential version (-xm sequential)? If it is you could run it in a debugger to gain more insight.&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; * YES, will report back.&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; On 6/4/12 2:19 PM, Jeff Eastman wrote:&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt; It looks like the probabilities vector returned by AbstractClusteringPolicy.classify() has no non-zero elements. In this case, AbstractClusteringPolicy.select()&apos;s call to AbstractVector.maxValueIndex() is returning -1 and that is causing the exception.&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt; How could this happen? I&apos;m not exactly sure, but consider that the probabilities vector is calculated in AbstractClusteringPolicy.classify() by calling DistanceMeasureCluster.pdf() on each of the prior clusters in b3/kmeans-clusters/clusters-0. With a CosineDistanceMeasure I don&apos;t see how this could ever return zero. Certainly, some of your vectors will match the prior cluster centers exactly (they were sampled from the input) and those values would return pdf==1. Even if the cosine distance was 1 the pdf would be 0.5.&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt; Some things to try:&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt; - Have you verified the contents of your input vectors actually have data in them?&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt; - Can you run the cluster dumper on the b3/kmeans-clusters/clusters-0 contents?&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt; - Is it possible to run the sequential version (-xm sequential)? If it is you could run it in a debugger to gain more insight.&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt; Jeff&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt; On 6/4/12 12:05 PM, Pat Ferrel wrote:&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; Using the CLI to kmeans from several trunk versions I get an error I don&apos;t understand.  When the job died the b3/canopy-centroids/clusters-0-final contained the random-seeds file generated by the kmeans driver and the b3/kmeans-clusters/clusters-0 had several part files but b3/kmeans-clusters/clusters-1 was empty. When I look through the code from the trace it doesn&apos;t make much sense.&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; Command line:&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; mahout kmeans&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;   -i b3/vectors/tfidf-vectors/&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;   -k 20&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;   -c b3/canopy-centroids/clusters-0-final&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;   -cl&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;   -o b3/kmeans-clusters&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;   -ow&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;   -cd 0.01&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;   -x 30&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;   -dm org.apache.mahout.common.distance.CosineDistanceMeasure&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; Error:&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 12/06/04 07:55:03 INFO common.AbstractJob: Command line arguments: {--clustering=null, --clusters=&lt;span class=&quot;error&quot;&gt;&amp;#91;b3/canopy-centroids/clusters-0-final&amp;#93;&lt;/span&gt;, --convergenceDelta=&lt;span class=&quot;error&quot;&gt;&amp;#91;0.01&amp;#93;&lt;/span&gt;, --distanceMeasure=&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.mahout.common.distance.CosineDistanceMeasure&amp;#93;&lt;/span&gt;, --endPhase=&lt;span class=&quot;error&quot;&gt;&amp;#91;2147483647&amp;#93;&lt;/span&gt;, --input=&lt;span class=&quot;error&quot;&gt;&amp;#91;b3/vectors/tfidf-vectors/&amp;#93;&lt;/span&gt;, --maxIter=&lt;span class=&quot;error&quot;&gt;&amp;#91;30&amp;#93;&lt;/span&gt;, --method=&lt;span class=&quot;error&quot;&gt;&amp;#91;mapreduce&amp;#93;&lt;/span&gt;, --numClusters=&lt;span class=&quot;error&quot;&gt;&amp;#91;20&amp;#93;&lt;/span&gt;, --output=&lt;span class=&quot;error&quot;&gt;&amp;#91;b3/kmeans-clusters&amp;#93;&lt;/span&gt;, --overwrite=null, --startPhase=&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, --tempDir=&lt;span class=&quot;error&quot;&gt;&amp;#91;temp&amp;#93;&lt;/span&gt;}&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 2012-06-04 07:55:03.752 java&lt;span class=&quot;error&quot;&gt;&amp;#91;67308:1903&amp;#93;&lt;/span&gt; Unable to load realm info from SCDynamicStore&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 12/06/04 07:55:03 INFO common.HadoopUtil: Deleting b3/canopy-centroids/clusters-0-final&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 12/06/04 07:55:04 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 12/06/04 07:55:04 INFO compress.CodecPool: Got brand-new compressor&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 12/06/04 07:55:04 INFO kmeans.RandomSeedGenerator: Wrote 20 vectors to b3/canopy-centroids/clusters-0-final/part-randomSeed&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 12/06/04 07:55:04 INFO kmeans.KMeansDriver: Input: b3/vectors/tfidf-vectors Clusters In: b3/canopy-centroids/clusters-0-final/part-randomSeed Out: b3/kmeans-clusters Distance: org.apache.mahout.common.distance.CosineDistanceMeasure&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 12/06/04 07:55:04 INFO kmeans.KMeansDriver: convergence: 0.01 max Iterations: 30 num Reduce Tasks: org.apache.mahout.math.VectorWritable Input Vectors: {}&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 12/06/04 07:55:04 INFO compress.CodecPool: Got brand-new decompressor&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; Cluster Iterator running iteration 1 over priorPath: b3/kmeans-clusters/clusters-0&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 12/06/04 07:55:05 INFO input.FileInputFormat: Total input paths to process : 1&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 12/06/04 07:55:05 INFO mapred.JobClient: Running job: job_local_0001&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 12/06/04 07:55:06 INFO mapred.MapTask: io.sort.mb = 100&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 12/06/04 07:55:08 INFO mapred.MapTask: data buffer = 79691776/99614720&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 12/06/04 07:55:08 INFO mapred.MapTask: record buffer = 262144/327680&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 12/06/04 07:55:08 INFO mapred.JobClient:  map 0% reduce 0%&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 12/06/04 07:55:09 WARN mapred.LocalJobRunner: job_local_0001&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; org.apache.mahout.math.IndexException: Index -1 is outside allowable range of [0,20)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at org.apache.mahout.math.AbstractVector.set(AbstractVector.java:439)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at org.apache.mahout.clustering.iterator.AbstractClusteringPolicy.select(AbstractClusteringPolicy.java:44)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at org.apache.mahout.clustering.iterator.CIMapper.map(CIMapper.java:52)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at org.apache.mahout.clustering.iterator.CIMapper.map(CIMapper.java:18)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:144)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:764)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at org.apache.hadoop.mapred.MapTask.run(MapTask.java:370)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:212)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 12/06/04 07:55:09 INFO mapred.JobClient: Job complete: job_local_0001&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; 12/06/04 07:55:09 INFO mapred.JobClient: Counters: 0&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; Exception in thread &quot;main&quot; java.lang.InterruptedException: Cluster Iteration 1 failed processing b3/kmeans-clusters/clusters-1&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at org.apache.mahout.clustering.iterator.ClusterIterator.iterateMR(ClusterIterator.java:186)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at org.apache.mahout.clustering.kmeans.KMeansDriver.buildClusters(KMeansDriver.java:229)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at org.apache.mahout.clustering.kmeans.KMeansDriver.run(KMeansDriver.java:149)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at org.apache.mahout.clustering.kmeans.KMeansDriver.run(KMeansDriver.java:108)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:65)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at org.apache.mahout.clustering.kmeans.KMeansDriver.main(KMeansDriver.java:49)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at org.apache.hadoop.util.ProgramDriver$ProgramDescription.invoke(ProgramDriver.java:68)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at org.apache.hadoop.util.ProgramDriver.driver(ProgramDriver.java:139)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;     at org.apache.mahout.driver.MahoutDriver.main(MahoutDriver.java:195)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;using trunk snapshot about June 1. &lt;/p&gt;</environment>
        <key id="12559433">MAHOUT-1028</key>
            <summary>seq2sparse n-gram weighting creates malformed vectors which crashes kmeans</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="pferrel">Pat Ferrel</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Jun 2012 20:15:32 +0100</created>
                <updated>Sat, 16 Jun 2012 10:35:14 +0100</updated>
                            <resolved>Sat, 9 Jun 2012 01:47:01 +0100</resolved>
                                    <version>0.7</version>
                                    <fixVersion>0.7</fixVersion>
                                    <component>Clustering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13289654" author="pferrel" created="Tue, 5 Jun 2012 20:22:34 +0100"  >&lt;p&gt;The command line that creates the malformed vector is &lt;/p&gt;

&lt;p&gt;mahout seq2sparse     -i b3/seqfiles/     -o b3/vectors/     -ow -chunk 2000     -x 40     -seq     -n 2     -nv     -ng 2     -ml 2000&lt;/p&gt;

&lt;p&gt;When you run &lt;/p&gt;

&lt;p&gt;mahout seq2sparse     -i b3/seqfiles/     -o b3/vectors/     -ow -chunk 2000     -x 40     -seq     -n 2     -nv&lt;/p&gt;

&lt;p&gt;The vector looks fine and clustering doesn&apos;t die. Attaching the output of seqdumper on the part that contains the doc for this vector.&lt;/p&gt;</comment>
                            <comment id="13289657" author="pferrel" created="Tue, 5 Jun 2012 20:24:37 +0100"  >&lt;p&gt;seqdumper output for the part that contains the doc that is turned into a malformed vector&lt;/p&gt;</comment>
                            <comment id="13291986" author="hudson" created="Fri, 8 Jun 2012 21:55:41 +0100"  >&lt;p&gt;Integrated in Mahout-Quality #1534 (See &lt;a href=&quot;https://builds.apache.org/job/Mahout-Quality/1534/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Mahout-Quality/1534/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-1028&quot; title=&quot;seq2sparse n-gram weighting creates malformed vectors which crashes kmeans&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-1028&quot;&gt;&lt;del&gt;MAHOUT-1028&lt;/del&gt;&lt;/a&gt;: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added zero vector corner case detection to 2 other CosineDistanceMeasure&lt;/li&gt;
	&lt;li&gt;All tests run (Revision 1346993)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-1028&quot; title=&quot;seq2sparse n-gram weighting creates malformed vectors which crashes kmeans&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-1028&quot;&gt;&lt;del&gt;MAHOUT-1028&lt;/del&gt;&lt;/a&gt;: &lt;/li&gt;
	&lt;li&gt;Added unit test that produced a NaN pdf value with zero vector and/or zero cluster center&lt;/li&gt;
	&lt;li&gt;Added zero vector corner case detection to CosineDistanceMeasure&lt;/li&gt;
	&lt;li&gt;All tests run (Revision 1346978)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
jeastman : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1346993&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1346993&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/common/distance/CosineDistanceMeasure.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;jeastman : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1346978&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1346978&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/common/distance/CosineDistanceMeasure.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/test/java/org/apache/mahout/clustering/iterator/TestClusterClassifier.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13292136" author="robinanil" created="Sat, 9 Jun 2012 01:46:54 +0100"  >&lt;p&gt;Ah. &lt;/p&gt;

&lt;p&gt;ml is supposed to be something small like 1. Its an exponential scale, anything &amp;gt;1 means important ngram. I am sure &amp;gt; 2000 means empty, and you are creating empty vectors.&lt;br/&gt;
Similarly you are doing max df percent of 40. So you are ending up with empty vectors.&lt;/p&gt;

&lt;p&gt;mahout seq2sparse -i b3/seqfiles/ -o b3/vectors/ -ow -chunk 2000 -x 40 -seq -n 2 -nv -ng 2 -ml 2000&lt;/p&gt;</comment>
                            <comment id="13292359" author="pferrel" created="Sat, 9 Jun 2012 16:20:41 +0100"  >&lt;p&gt;Yes, these are the settings I use on a much larger crawl, here I&apos;m using them on a small one for quick experimentation. My understanding was that a very large ml would create less n-grams and only really really important ones, which is what I want. There is always the individual words that should be used in the vector when the n-grams don&apos;t pass the ml test. Or so I thought.&lt;/p&gt;

&lt;p&gt;In short large ml means less terms in the vector but I thought never less than the number of words. So large ml should never create 0 vector, am I wrong? &lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12531003" name="dmp" size="40986" author="pferrel" created="Tue, 5 Jun 2012 20:24:37 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 8 Jun 2012 20:55:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>243583</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy1i7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22395</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>