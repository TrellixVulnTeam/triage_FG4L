<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:17:33 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-235/MAHOUT-235.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-235] GenericSorting.java also needs replacing</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-235</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;It looks like GenericSorting.java is more code of the same dubious parentage that needs the same treatment.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12444409">MAHOUT-235</key>
            <summary>GenericSorting.java also needs replacing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gsingers">Grant Ingersoll</assignee>
                                    <reporter username="bmargulies">Benson Margulies</reporter>
                        <labels>
                    </labels>
                <created>Thu, 31 Dec 2009 01:38:43 +0000</created>
                <updated>Sat, 21 May 2011 04:24:05 +0100</updated>
                            <resolved>Tue, 5 Jan 2010 19:49:19 +0000</resolved>
                                    <version>0.2</version>
                                    <fixVersion>0.3</fixVersion>
                                    <component>Math</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12795664" author="bmargulies" created="Thu, 31 Dec 2009 20:33:04 +0000"  >&lt;p&gt;This doesn&apos;t work, and I&apos;m a bit stumped.&lt;/p&gt;</comment>
                            <comment id="12795704" author="tdunning" created="Thu, 31 Dec 2009 23:23:37 +0000"  >&lt;p&gt;I just looked at this.  Didn&apos;t find the problem, but did make some comments in the code and clarified it a bit.  My guess is that the main partition loop leaves b and c in the wrong order.  If i get another chance to look at this, I will put in some assertions that match what I think the loop invariants should be.  That will probably make things obvious.&lt;/p&gt;

&lt;p&gt;Here is my commented version fo the key sort routine:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  private static void quickSort0(int start, int end, IntComparator comp, Swapper swap) {
    int length = end - start;
    if (length &amp;lt; 7) {
      insertionSort(start, end, comp, swap);
      return;
    }
    int middle = (start + end) / 2;
    if (length &amp;gt; 7) {
      int bottom = start;
      int top = end - 1;
      if (length &amp;gt; 40) {
        // for lots of data, bottom, middle and top are medians near the beginning, middle or end of the data
        int skosh = length / 8;
        bottom = med3(bottom, bottom + skosh, bottom + (2 * skosh), comp);
        middle = med3(middle - skosh, middle, middle + skosh, comp);
        top = med3(top - (2 * skosh), top - skosh, top, comp);
      }
      middle = med3(bottom, middle, top, comp);
    }

    int partitionIndex = middle; // an index, not a value.

    // regions from a to b and from c to d are what we will recursively sort
    int a, b, c, d;
    a = b = start;
    c = d = end - 1;
    while (b &amp;lt;= c) {
      // copy all values equal to the partition value to before a..b.  In the process, advance b
      // as long as values less than the partition or equal are found, also stop when a..b collides with c..d
      int comparison = comp.compare(b, partitionIndex);
      while (b &amp;lt;= c &amp;amp;&amp;amp; comparison &amp;lt;= 0) {
        if (comparison == 0) {
          swap.swap(a, b);
          a++;
        }
        b++;
        comparison = comp.compare(b, partitionIndex);
      }
      // at this point [start..a) has partition values, [a..b) has values &amp;lt; partition
      // also, either b&amp;gt;c or v[b] &amp;gt; partition value

      comparison = comp.compare(c, partitionIndex);
      while (c &amp;gt;= b &amp;amp;&amp;amp; comparison &amp;gt;= 0) {
        if (comparison == 0) {
          swap.swap(c, d);
          d--;
        }
        c--;
        comparison = comp.compare(c, partitionIndex);
      }
      // now we also know that [d..end] contains partition values,
      // [c..d) contains values &amp;gt; partition value
      // also, either b&amp;gt;c or (v[b] &amp;gt; partition OR v[c] &amp;lt; partition)

      if (b &amp;lt;= c) {
        // v[b] &amp;gt; partition OR v[c] &amp;lt; partition
        // swapping will let us continue to grow the two regions
        swap.swap(b, c);
        b++;
        c--;
      }
    }
    // now we know
    // b = c+1
    // [start..a) and [d..end) contain partition value
    // all of [a..b) are less than partition
    // all of [c..d) are greater than partition

    // shift [a..b) to beginning
    length = Math.min(a - start, b - a);
    int l = start;
    int h = b - length;
    while (length-- &amp;gt; 0) {
      swap.swap(l, h);
      l++;
      h++;
    }

    // shift [c..d) to end
    length = Math.min(d - c, end - 1 - d);
    l = b;
    h = end - length;
     while (length-- &amp;gt; 0) {
      swap.swap(l, h);
      l++;
      h++;
    }

    // recurse left and right
    length = b - a;
    if (length &amp;gt; 0) {
      quickSort0(start, start + length, comp, swap);
    }

    length = d - c;
    if (length &amp;gt; 0) {
      quickSort0(end - length, end, comp, swap);
    }
  }

  /**
   * In-place insertion sort that is fast for pre-sorted data.
   *
   * @param start Where to start sorting (inclusive)
   * @param end   Where to stop (exclusive)
   * @param comp  Sort order.
   * @param swap  How to swap items.
   */
  private static void insertionSort(int start, int end, IntComparator comp, Swapper swap) {
    for (int i = start + 1; i &amp;lt; end; i++) {
      for (int j = i; j &amp;gt; start &amp;amp;&amp;amp; comp.compare(j - 1, j) &amp;gt; 0; j--) {
        swap.swap(j - 1, j);
      }
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12795707" author="bimargulies@gmail.com" created="Thu, 31 Dec 2009 23:56:33 +0000"  >&lt;p&gt;the odd thing is that I got here by modifying&lt;br/&gt;
one of the many working copies to use an&lt;br/&gt;
external swapper.&lt;/p&gt;

&lt;p&gt;On Dec 31, 2009, at 6:24 PM, &quot;Ted Dunning (JIRA)&quot; &amp;lt;jira@apache.org&amp;gt;  &lt;/p&gt;
</comment>
                            <comment id="12795807" author="bmargulies" created="Sat, 2 Jan 2010 01:05:18 +0000"  >&lt;p&gt;I think I see the problem, it&apos;s the partitionValue. In all the working versions, that is a VALUE, not an index. And the value is captured, even as the cell it came from might get swapped. &lt;/p&gt;</comment>
                            <comment id="12795811" author="bmargulies" created="Sat, 2 Jan 2010 01:46:48 +0000"  >&lt;p&gt;Here is an IP-clean replacement for the GenericSorting quicksort and the first raft of templatization of the hash table code.&lt;/p&gt;</comment>
                            <comment id="12795812" author="bmargulies" created="Sat, 2 Jan 2010 01:47:16 +0000"  >&lt;p&gt;Please ignore oops.patch and take the main patch.&lt;/p&gt;</comment>
                            <comment id="12796172" author="bmargulies" created="Mon, 4 Jan 2010 12:44:13 +0000"  >&lt;p&gt;Here&apos;s the correct patch&lt;/p&gt;</comment>
                            <comment id="12796173" author="bmargulies" created="Mon, 4 Jan 2010 12:44:35 +0000"  >&lt;p&gt;I had still posted the wrong patch. Correct patch now available.&lt;/p&gt;</comment>
                            <comment id="12796521" author="drew.farris" created="Tue, 5 Jan 2010 04:01:25 +0000"  >&lt;p&gt;Ok, applied patch against r895535 by running the following from the top level mahout directory:&lt;/p&gt;

&lt;p&gt;patch -p0 -E &amp;lt; patch.235.take2.diff&lt;/p&gt;

&lt;p&gt;Full build and tests complete successfully for me.&lt;/p&gt;
</comment>
                            <comment id="12796816" author="srowen" created="Tue, 5 Jan 2010 19:49:19 +0000"  >&lt;p&gt;OK committed, per Benson&lt;/p&gt;</comment>
                            <comment id="12796847" author="bmargulies" created="Tue, 5 Jan 2010 21:00:19 +0000"  >&lt;p&gt;looks good, please go ahead and resolve.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12429264" name="235_and_hash_bases.patch" size="100840" author="bmargulies" created="Sat, 2 Jan 2010 01:46:48 +0000"/>
                            <attachment id="12429217" name="oops.diff" size="6181" author="bmargulies" created="Thu, 31 Dec 2009 20:33:03 +0000"/>
                            <attachment id="12429337" name="patch.235.take2.diff" size="101078" author="bmargulies" created="Mon, 4 Jan 2010 12:44:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 31 Dec 2009 23:23:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9830</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy6db:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23183</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>