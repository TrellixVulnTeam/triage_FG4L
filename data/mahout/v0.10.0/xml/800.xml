<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:24:50 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-800/MAHOUT-800.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-800] bin/mahout attempts cluster mode  if HADOOP_CONF_DIR is set plausibly (and hence appended to classpath), even with MAHOUT_LOCAL set and no HADOOP_HOME</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-800</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;(This began as a build-reuters.sh bug report, but the problem seemed deeper; please excuse the narrative format here)&lt;/p&gt;

&lt;p&gt;Summary: both examples/bin/build-reuters.sh and bin/mahout will attempt cluster mode if HADOOP_CONF_DIR env variable points at a Hadoop conf/ directory, because bin/mahout appends it to Java&apos;s classpath. This seems to trigger something in Mahout Java that will to try to use the cluster, without this being explicitly requested.&lt;/p&gt;

&lt;p&gt;There have been reports (Jeff Eastman, myself; &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/mahout-user/201108.mbox/%3CCAFNgM+Y4twNVL_RSyNb+hGhoAu0xW917YfUTW3a5-m=Z0dynDA@mail.gmail.com%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/mahout-user/201108.mbox/%3CCAFNgM+Y4twNVL_RSyNb+hGhoAu0xW917YfUTW3a5-m=Z0dynDA@mail.gmail.com%3E&lt;/a&gt; ) of build-reuters.sh attempting cluster mode, even while claiming - &quot;MAHOUT_LOCAL is set, running locally&quot;. (or for that matter in slight variant conditions, &quot;no HADOOP_HOME set, running locally&quot;).&lt;/p&gt;

&lt;p&gt;Experimenting here with a fresh trunk install, clean ~/.m2/ on a laptop with a pseudo-cluster Hadoop configuration available, I find HADOOP_CONF_DIR seems to be the key.&lt;/p&gt;

&lt;p&gt;When HADOOP_CONF_DIR is set to a working value (regardless of whether cluster is running), and regardless of HADOOP_HOME and MAHOUT_LOCAL, build-reuters.sh tries to use the cluster. Aside: this is not the same as it using non-clustering local Hadoop, since I see errors such as &quot;11/09/02 09:27:10 INFO ipc.Client: Retrying connect to server: localhost/127.0.0.1:9000. Already tried 1 time(s).&quot; unless the cluster is up. If the cluster is up and accessible, I&apos;ll see java.io.IOException instead, presumably since the files aren&apos;t there.&lt;/p&gt;

&lt;p&gt;If I do &apos;export HADOOP_CONF_DIR=&apos; then build-reuters.sh (both kmeans and lda modes) runs OK without real Hadoop.&lt;/p&gt;

&lt;p&gt;If I retry with a bogus value for HADOOP_CONF_DIR e.g. /foo, this also seems fine. Only when it finds a Hadoop installation does it get confused.&lt;/p&gt;

&lt;p&gt;Minimally I&apos;d consider this a documentation issue. Nothing in build_reuters.sh script mentions role of HADOOP_CONF_DIR. Reading build-reuters.sh I get the impression both clustered and local modes are possible; however mailing list discussion leave me ensure whether clustered mode is still supposed to work in trunk.&lt;/p&gt;


&lt;p&gt;Tests: (with no HADOOP_HOME set)&lt;/p&gt;

&lt;p&gt;Running these extracts from build-reuters.sh in examples/bin/ after having previously run build-reuters.sh to fetch data...&lt;/p&gt;

&lt;p&gt;#this one runs OK&lt;br/&gt;
MAHOUT_LOCAL=true HADOOP_CONF_DIR=/foo ../../bin/mahout seqdirectory \&lt;br/&gt;
        -i mahout-work/reuters-out -o mahout-work/reuters-out-seqdir -c UTF-8 -chunk 5&lt;/p&gt;

&lt;p&gt;#this fails (assuming there&apos;s a Hadoop there) by attempting clustered mode: &apos;Call to localhost/127.0.0.1:9000 failed...&apos;&lt;/p&gt;

&lt;p&gt;MAHOUT_LOCAL=true HADOOP_CONF_DIR=$HOME/working/hadoop/hadoop-0.20.2/conf ../../bin/mahout seqdirectory \&lt;br/&gt;
        -i mahout-work/reuters-out -o mahout-work/reuters-out-seqdir -c UTF-8 -chunk 5&lt;/p&gt;


&lt;p&gt;Same thing with seq2sparse&lt;/p&gt;

&lt;p&gt;#fails, localhost:9000&lt;br/&gt;
HADOOP_CONF_DIR=$HOME/working/hadoop/hadoop-0.20.2/conf MAHOUT_LOCAL=true ../../bin/mahout seq2sparse \&lt;br/&gt;
    -i mahout-work/reuters-out-seqdir/ -o mahout-work/reuters-out-seqdir-sparse-kmeans&lt;/p&gt;

&lt;p&gt;#runs locally just fine (because of bad hadoop conf path)&lt;br/&gt;
HADOOP_CONF_DIR=$HOME/bad/path/working/hadoop/hadoop-0.20.2/conf MAHOUT_LOCAL=true ../../bin/mahout seq2sparse \&lt;br/&gt;
    -i mahout-work/reuters-out-seqdir/ -o mahout-work/reuters-out-seqdir-sparse-kmeans&lt;/p&gt;

&lt;p&gt;I get same behaviour from &apos;../../bin/mahout kmeans&apos; too, so the problem seems general, not driver-specific. &lt;/p&gt;

&lt;p&gt;All this seems to contradict the notes in ../../bin/mahout, i.e.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;MAHOUT_LOCAL       set to anything other than an empty string to force&lt;/li&gt;
	&lt;li&gt;mahout to run locally even if&lt;/li&gt;
	&lt;li&gt;HADOOP_CONF_DIR and HADOOP_HOME are set&lt;/li&gt;
&lt;/ol&gt;




&lt;p&gt;Digging into bin/mahout it seems the accidental clustering happens deeper into java-land, not in the .sh; it&apos;s not invoking hadoop directly there. We get this far:&lt;/p&gt;

&lt;p&gt;  exec &quot;$JAVA&quot; $JAVA_HEAP_MAX $MAHOUT_OPTS -classpath &quot;$CLASSPATH&quot; $CLASS &quot;$@&quot;&lt;/p&gt;

&lt;p&gt;I compared the Java commandlines generated by successful vs accidentally-cluster-invoking runs of bin/mahout ...it seems the only difference is whether a hadoop conf directory is on the classpath that&apos;s passed to Java.&lt;/p&gt;

&lt;p&gt;If I blank out with &apos;HADOOP_CONF_DIR=&apos;, and &apos;HADOOP_HOME=&apos; and then run &lt;/p&gt;

&lt;p&gt;MAHOUT_LOCAL=true ../../bin/mahout kmeans \&lt;br/&gt;
    -i mahout-work/reuters-out-seqdir-sparse-kmeans/tfidf-vectors/ \&lt;br/&gt;
    -c mahout-work/reuters-kmeans-clusters \&lt;br/&gt;
    -o mahout-work/reuters-kmeans \&lt;br/&gt;
    -x 10 -k 20 -ow&lt;/p&gt;

&lt;p&gt;...against an edited version of bin/mahout that appends a hadoop conf dir to the classpath, i.e.&lt;/p&gt;

&lt;p&gt;  exec &quot;$JAVA&quot; $JAVA_HEAP_MAX $MAHOUT_OPTS -classpath &quot;$CLASSPATH:/Users/danbri/working/hadoop/hadoop-0.20.2/conf&quot; $CLASS &quot;$@&quot;&lt;/p&gt;

&lt;p&gt;This is enough to get &quot;Exception in thread &quot;main&quot; java.io.IOException: Call to localhost/127.0.0.1:9000 failed on local exception: java.io.EOFException&quot;&lt;/p&gt;

&lt;p&gt;(...and if I remove the /conf path from classpath, we&apos;re back to expected behaviours).&lt;/p&gt;

&lt;p&gt;Not sure whether it&apos;s best to patch this in bin/mahout, or in the Java (perhaps the former might mask issues that&apos;ll cause later confusion?)&lt;/p&gt;

&lt;p&gt;Perhaps only do &lt;/p&gt;

&lt;p&gt;  CLASSPATH=$&lt;/p&gt;
{CLASSPATH}
&lt;p&gt;:$HADOOP_CONF_DIR&lt;/p&gt;

&lt;p&gt;if we&apos;re not seeing MAHOUT_LOCAL?&lt;/p&gt;</description>
                <environment>&lt;p&gt;OSX; java version &quot;1.6.0_26&quot;&lt;/p&gt;</environment>
        <key id="12521160">MAHOUT-800</key>
            <summary>bin/mahout attempts cluster mode  if HADOOP_CONF_DIR is set plausibly (and hence appended to classpath), even with MAHOUT_LOCAL set and no HADOOP_HOME</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean Owen</assignee>
                                    <reporter username="danbri">Dan Brickley</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Sep 2011 09:41:47 +0100</created>
                <updated>Thu, 9 Feb 2012 14:01:03 +0000</updated>
                            <resolved>Fri, 23 Sep 2011 10:00:39 +0100</resolved>
                                                    <fixVersion>0.6</fixVersion>
                                    <component>Examples</component>
                    <component>Integration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13095870" author="danbri" created="Fri, 2 Sep 2011 09:57:54 +0100"  >&lt;p&gt;The simplest thing that made the problem go away.&lt;/p&gt;</comment>
                            <comment id="13113276" author="srowen" created="Fri, 23 Sep 2011 10:00:39 +0100"  >&lt;p&gt;I&apos;m not so familiar with this, but your case makes sense. Hearing no objections I&apos;ll commit.&lt;/p&gt;</comment>
                            <comment id="13113354" author="hudson" created="Fri, 23 Sep 2011 13:04:30 +0100"  >&lt;p&gt;Integrated in Mahout-Quality #1058 (See &lt;a href=&quot;https://builds.apache.org/job/Mahout-Quality/1058/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Mahout-Quality/1058/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-800&quot; title=&quot;bin/mahout attempts cluster mode  if HADOOP_CONF_DIR is set plausibly (and hence appended to classpath), even with MAHOUT_LOCAL set and no HADOOP_HOME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-800&quot;&gt;&lt;del&gt;MAHOUT-800&lt;/del&gt;&lt;/a&gt; in local mode don&apos;t use Hadoop classpath&lt;/p&gt;

&lt;p&gt;srowen : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1174600&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1174600&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/mahout/trunk/bin/mahout&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12492725" name="MAHOUT-800.patch" size="704" author="danbri" created="Fri, 2 Sep 2011 09:57:54 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 23 Sep 2011 09:00:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9263</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy2wf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22621</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>