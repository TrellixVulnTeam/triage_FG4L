<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:22:45 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-834/MAHOUT-834.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-834] rowsimilarityjob doesn&apos;t clean it&apos;s temp dir, and fails when seeing it again</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-834</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;If I do this:&lt;/p&gt;

&lt;p&gt;mahout rowsimilarity --input matrixified/matrix --output sims/ --numberOfColumns 27684 --similarityClassname SIMILARITY_LOGLIKELIHOOD --excludeSelfSimilarity&lt;/p&gt;

&lt;p&gt;then clean my output and rerun,&lt;/p&gt;

&lt;p&gt;rm -rf sims/ # (though this step doesn&apos;t even seem needed)&lt;/p&gt;

&lt;p&gt;then try again:&lt;/p&gt;

&lt;p&gt;mahout rowsimilarity --input matrixified/matrix --output sims/ --numberOfColumns 27684 --similarityClassname SIMILARITY_LOGLIKELIHOOD --excludeSelfSimilarity&lt;/p&gt;

&lt;p&gt;The temp files left from the first run make a re-run impossible - we get: &quot;Exception in thread &quot;main&quot; org.apache.hadoop.mapred.FileAlreadyExistsException: Output directory temp/weights already exists&quot;.&lt;/p&gt;

&lt;p&gt;Manually deleting the temp directory fixes this.&lt;/p&gt;

&lt;p&gt;I get same behaviour if I explicitly pass in a --tempdir path, e.g.:&lt;/p&gt;

&lt;p&gt;mahout rowsimilarity --input matrixified/matrix --output sims/ --numberOfColumns 27684 --similarityClassname SIMILARITY_LOGLIKELIHOOD --excludeSelfSimilarity --tempDir tmp2/&lt;/p&gt;

&lt;p&gt;Presumably something like HadoopUtil.delete(getConf(),tempDirPath) is needed somewhere?  (and maybe --overwrite too ?)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12526375">MAHOUT-834</key>
            <summary>rowsimilarityjob doesn&apos;t clean it&apos;s temp dir, and fails when seeing it again</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="smarthi">Suneel Marthi</assignee>
                                    <reporter username="danbri">Dan Brickley</reporter>
                        <labels>
                    </labels>
                <created>Sun, 9 Oct 2011 14:37:43 +0100</created>
                <updated>Sat, 16 Jun 2012 10:35:22 +0100</updated>
                            <resolved>Mon, 7 May 2012 15:16:46 +0100</resolved>
                                    <version>0.6</version>
                    <version>0.7</version>
                                    <fixVersion>0.7</fixVersion>
                                    <component>Integration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13123687" author="danbri" created="Sun, 9 Oct 2011 14:39:20 +0100"  >&lt;p&gt;ignore &apos;(though this step doesn&apos;t even seem needed)&apos;, this was a mistake; the org.apache.hadoop.mapred.FileAlreadyExistsException happens at the end of the job. Main point I think still stands.&lt;/p&gt;</comment>
                            <comment id="13123759" author="ssc" created="Sun, 9 Oct 2011 20:30:40 +0100"  >&lt;p&gt;Isn&apos;t that the standard behavior of all jobs? Maybe we should a generic option that makes a job delete the temp dir if it already exists.&lt;/p&gt;</comment>
                            <comment id="13133981" author="srowen" created="Mon, 24 Oct 2011 12:19:14 +0100"  >&lt;p&gt;Out of interest, I tried making all jobs delete their temp output. Many fail as they chain together and do use previous jobs&apos; intermediate output, it seems. Certainly the tests inspect this output.&lt;/p&gt;

&lt;p&gt;This is just my own preferences or habits speaking here, but I&apos;m accustomed to these big jobs tend to leave all their output and logs and such around for inspection and possible debugging, and left to the caller to decide when and how to clean up.&lt;/p&gt;

&lt;p&gt;Certainly I think the current behavior is reasonable, and needs to stay the default behavior. Could there be a flag? sure. It seems almost harder to write (into all jobs), document, debug and support a flag that&apos;s just replacing one &quot;delete&quot; line of code or script somewhere.&lt;/p&gt;

&lt;p&gt;I think it&apos;s a defensible idea; I would lean towards leaving it as-is though. Making a mistake here just gives you an exception that reasonably clearly states the problem. Making a mistake the other way might be surprising or undesirable as it&apos;s deleting stuff.&lt;/p&gt;</comment>
                            <comment id="13133983" author="danbri" created="Mon, 24 Oct 2011 12:26:21 +0100"  >&lt;p&gt;Makes sense. Should --overwrite wipe out temp dirs, typically? Or cleanup is left for outside scripting?&lt;/p&gt;</comment>
                            <comment id="13133989" author="srowen" created="Mon, 24 Oct 2011 12:32:42 +0100"  >&lt;p&gt;Oh, probably so. I didn&apos;t know about this option. Anything that requests to overwrite output also probably intends to overwrite temp files. Is there a spot that&apos;s not happening?&lt;/p&gt;</comment>
                            <comment id="13134007" author="danbri" created="Mon, 24 Oct 2011 13:06:39 +0100"  >&lt;p&gt;I&apos;ve just gone back to do some tests. I composed a new commandline,&lt;/p&gt;

&lt;p&gt;mahout rowsimilarity --input matrixified/matrix --output sims_foo/ --numberOfColumns 27684 --similarityClassname SIMILARITY_LOGLIKELIHOOD --excludeSelfSimilarity&lt;/p&gt;

&lt;p&gt;...where sims_foo/ is a new home for output. However because the previous run was from the same base directory, we get &quot;Exception in thread &quot;main&quot; org.apache.hadoop.mapred.FileAlreadyExistsException: Output directory temp/weights already exists&quot; &lt;/p&gt;

&lt;p&gt;This leads me to think that a cleaner pattern would be for these &apos;temp&apos; files to be packaged inside the output directory. That seems quite common in other jobs, eg. clustering you get all the iterations in different subdirs, and when generating sparse vectors, the output directory has something along these lines: &quot;df-count		dictionary.file-0	frequency.file-0	tf-vectors		tfidf-vectors		tokenized-documents	wordcount&quot;. But in both cases, the mess is constrained to live within the output dir.&lt;/p&gt;

&lt;p&gt;To answer your question, &quot;11/10/24 14:04:20 ERROR common.AbstractJob: Unexpected --overwrite while processing Job-Specific Options:&quot; ... it seems rowsimilarity doesn&apos;t offer this option. Neither does the rowid job - my (mistakenly designed) patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-839&quot; title=&quot;rowid job failing (when parsing options)  &quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-839&quot;&gt;&lt;del&gt;MAHOUT-839&lt;/del&gt;&lt;/a&gt; also tried to sneak in --overwrite there.&lt;/p&gt;

&lt;p&gt;As a user, it does seem counter-intuitive for any use of &apos;mahout rowsimilarity&apos; in a given directory to create a temp/ right there, blocking any re-runs of that same-named job unless the intermediate files are wiped; perhaps I might want to run the job twice over the same data, using different similarity measures? For the reasons you give above, keeping the files around makes sense, but I&apos;d suggest having them live beneath the output dir by default.&lt;/p&gt;</comment>
                            <comment id="13134120" author="srowen" created="Mon, 24 Oct 2011 15:52:05 +0100"  >&lt;p&gt;On the one hand I&apos;m reluctant to mix output and intermediate output. You make a good point that cluster iterations before the final one could be considered intermediate results, but are in the output folder. I don&apos;t know how much it changes things to move it all under output; there&apos;s still the question of whether it&apos;s overwritten or not. And then you&apos;re more strongly tying together whether the output and temp both stay or are deleted.&lt;/p&gt;

&lt;p&gt;I&apos;d rather avoid change unless there&apos;s a clear deficiency. I&apos;m also trying to avoid surprise; in Hadoop-land, which is historically based on HDFS, which is a write-once sort of storage system, things tend to prefer to not be deleted. For example Hadoop will refuse by default to overwrite anything as you see. I think not-overwriting is a fine default to follow.&lt;/p&gt;

&lt;p&gt;Well, you proposed a flag. And there&apos;s apparently already an --overwrite flag in circulation in some jobs to control this behavior. How about we port and extend that to cover temp/output &amp;#8211; does that substantially answer the issue here? It would avoid changes to current behavior which people might be used to.&lt;/p&gt;</comment>
                            <comment id="13195934" author="smarthi" created="Mon, 30 Jan 2012 04:56:46 +0000"  >&lt;p&gt;1. What was the outcome of this thread? I am having the same issue and had opened a Jira ticket - Mahout-964 (much before I saw this thread).  I do agree that the RowSimilarityJob needs an overwrite option to cleanup the output and temp folders from a  previous run.&lt;/p&gt;

&lt;p&gt;2. Another concern I have is if the input similarity measure specified is not a valid one, like for example:-&lt;/p&gt;

&lt;p&gt;mahout rowsimilarity --input matrixified/matrix --output sims_foo/ --numberOfColumns 27684 --similarityClassname SIMILARITY_COS --excludeSelfSimilarity&lt;/p&gt;

&lt;p&gt;then RowSimilarityJob should exit immediately instead of going ahead with trying to execute the Normalizer, CooccurrencesMapper and UnsymmetrifyMapper.&lt;/p&gt;

&lt;p&gt;3. The &apos;excludeSelfSimilarity&apos; option needs to be given an explicit value of &apos;true&apos; or &apos;false&apos; otherwise the following always defaults to &apos;false&apos;&lt;/p&gt;

&lt;p&gt;mahout rowsimilarity --input matrixified/matrix --output sims_foo/ --numberOfColumns 27684 --similarityClassname SIMILARITY_COSINE --excludeSelfSimilarity&lt;/p&gt;

&lt;p&gt;This is inconsistent with the way --overwrite option works. Merely specifying --excludeSelfSimilarity on the Commandline does not set it to &apos;true&apos;.&lt;/p&gt;


</comment>
                            <comment id="13196472" author="smarthi" created="Mon, 30 Jan 2012 22:13:57 +0000"  >&lt;p&gt;Added --overwrite to the RowSimilarityJob CLI to be able to overwrite the output folders.&lt;/p&gt;

&lt;p&gt;Added call to HadoopUtil.delete(getConf(), getTempPath()) to always clear the temporary path.&lt;/p&gt;</comment>
                            <comment id="13196474" author="smarthi" created="Mon, 30 Jan 2012 22:15:56 +0000"  >&lt;p&gt;This patch only has the fix for the issue that was originally raised, i.e - &apos;RowSimilarityJob doesn&apos;t clean its temp directory, and fails when seeing it again&apos;.  I&apos;ll open a separate jira for the other issues I had reported.&lt;/p&gt;</comment>
                            <comment id="13269570" author="smarthi" created="Mon, 7 May 2012 13:37:56 +0100"  >&lt;p&gt;Per Sebastian&apos;s feedback, fixed the patch to only delete the temp outputif the -ow option has been specified.&lt;/p&gt;</comment>
                            <comment id="13269817" author="hudson" created="Mon, 7 May 2012 18:52:10 +0100"  >&lt;p&gt;Integrated in Mahout-Quality #1465 (See &lt;a href=&quot;https://builds.apache.org/job/Mahout-Quality/1465/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Mahout-Quality/1465/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-834&quot; title=&quot;rowsimilarityjob doesn&amp;#39;t clean it&amp;#39;s temp dir, and fails when seeing it again&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-834&quot;&gt;&lt;del&gt;MAHOUT-834&lt;/del&gt;&lt;/a&gt; rowsimilarityjob doesn&apos;t clean it&apos;s temp dir, and fails when seeing it again (Revision 1335032)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
ssc : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1335032&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1335032&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/math/hadoop/similarity/cooccurrence/RowSimilarityJob.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12525838" name="Mahout-834.patch" size="1953" author="smarthi" created="Mon, 7 May 2012 13:38:41 +0100"/>
                            <attachment id="12512478" name="Mahout-834.patch" size="1937" author="smarthi" created="Mon, 30 Jan 2012 22:11:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 9 Oct 2011 19:30:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>50943</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy2ov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22587</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>