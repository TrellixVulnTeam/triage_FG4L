<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:21:40 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-666/MAHOUT-666.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-666] DistributedSparseMatrix should clean up after itself when doing times(Vector) and timesSquared(Vector)</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-666</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;The directories created during the times() and timesSquared() methods in DistributedSparseMatrix leave behind a lot of cruft. While the individual files are tagged with deleteOnExit, but the directories are not. Also, but not deleting them until JVM exit, a job that does repeated matrix/vector multiplies, like DistributedLanczosSolver, creates a lot of temp files that stick around for the whole run, even though the results they contain are read once and then never again. &lt;/p&gt;

&lt;p&gt;Our cluster admins enforce both file count and size quotas, so since 5 temp files/directories are created on each iteration of DistributedLanczosSolver, we&apos;re constantly bumping into the quota with large SVDs. &lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux x86_64 2.6.18, Mac OS 10.6 64-bit, Hadoop 0.20.2, Java 1.6&lt;/p&gt;</environment>
        <key id="12504007">MAHOUT-666</key>
            <summary>DistributedSparseMatrix should clean up after itself when doing times(Vector) and timesSquared(Vector)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jake.mannix">Jake Mannix</assignee>
                                    <reporter username="jtraupman">Jonathan Traupman</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Apr 2011 03:23:45 +0100</created>
                <updated>Sat, 21 May 2011 04:19:03 +0100</updated>
                            <resolved>Fri, 15 Apr 2011 11:24:07 +0100</resolved>
                                    <version>0.5</version>
                                    <fixVersion>0.5</fixVersion>
                                    <component>Math</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <timeoriginalestimate seconds="14400">4h</timeoriginalestimate>
                            <timeestimate seconds="14400">4h</timeestimate>
                                        <comments>
                            <comment id="13018676" author="jtraupman" created="Tue, 12 Apr 2011 03:26:35 +0100"  >&lt;p&gt;Patch based on revision 1091276. Verified application to fresh copy of trunk. Verified all tests pass.&lt;/p&gt;</comment>
                            <comment id="13018678" author="jtraupman" created="Tue, 12 Apr 2011 03:29:26 +0100"  >&lt;p&gt;Here is a patch for this issue. I added a new configuration property that allows you to ask for eager deletion of temp files. If this property is set to true, it will delete the temp files before returning the resulting vector in times(Vector) and timesSquared(Vector). If the property is left unset, it defaults to false, where the old behavior remains for backward compatibility.&lt;/p&gt;

&lt;p&gt;I did not change the transpose() or times(Matrix) methods, since it seems you&apos;ll generally want to keep around a matrix result.&lt;/p&gt;

&lt;p&gt;I added two unit tests to verify both the old and the new behavior for both methods and to check that the change does not affect the results of the computation.&lt;/p&gt;

&lt;p&gt;All unit tests pass.&lt;/p&gt;</comment>
                            <comment id="13018680" author="jake.mannix" created="Tue, 12 Apr 2011 03:51:38 +0100"  >&lt;p&gt;There are few things I like more about open source software than having somebody file a bug against your code and simultaneously submit a patch which fixes it and has new unit tests.&lt;/p&gt;

&lt;p&gt;I&apos;ll try this out and get it committed asap.&lt;/p&gt;</comment>
                            <comment id="13018720" author="jake.mannix" created="Tue, 12 Apr 2011 06:05:38 +0100"  >&lt;p&gt;Committed revision 1091292&lt;/p&gt;</comment>
                            <comment id="13018890" author="jtraupman" created="Tue, 12 Apr 2011 17:21:28 +0100"  >&lt;p&gt;Wow, that was fast. &lt;/p&gt;

&lt;p&gt;I forgot to mention in my upload that it might be reasonable to just make this cleanup code the default (i.e. get rid of the conf paramater), since the directories that get created have random names and are thus hard for any external computation to access. I&apos;m not familiar enough with the users of this code to make that call, though, so I took the &quot;do no harm&quot; approach.&lt;/p&gt;

&lt;p&gt;If you think it&apos;s worthwhile to just always clean up, I&apos;ll make the requisite changes and send another patch.&lt;/p&gt;</comment>
                            <comment id="13018908" author="tdunning" created="Tue, 12 Apr 2011 18:05:05 +0100"  >&lt;blockquote&gt;
&lt;p&gt;If you think it&apos;s worthwhile to just always clean up, I&apos;ll make the requisite changes and send another patch.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;yes.  I think it is very worthwhile.&lt;/p&gt;</comment>
                            <comment id="13018914" author="jake.mannix" created="Tue, 12 Apr 2011 18:18:07 +0100"  >&lt;p&gt;You&apos;re probably right, actually.  The temp directory which contains the output vectors from times() and timesSquared() is ephemerally named, and not even saved as a variable.  So there is no code which could know where that file is serialized, actually.  Unless it was just looking for all subdirectories (sorted by lex) of DistributedRowMatrix#outputTmpBasePath, I guess.&lt;/p&gt;

&lt;p&gt;But yeah, I think once &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-319&quot; title=&quot;SVD solvers should be gracefully stoppable/restartable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-319&quot;&gt;&lt;del&gt;MAHOUT-319&lt;/del&gt;&lt;/a&gt; is done, we can just set this to be the default.  &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-319&quot; title=&quot;SVD solvers should be gracefully stoppable/restartable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-319&quot;&gt;&lt;del&gt;MAHOUT-319&lt;/del&gt;&lt;/a&gt; will make sure that the outputs go to sensible places which are reusable (and may just be accomplished via essentially &quot;mv &amp;lt;tmpdir&amp;gt; &amp;lt;newdir&amp;gt;&quot;, and this cleanup code will just be sanity checking to verify the old directory is gone).&lt;/p&gt;</comment>
                            <comment id="13019048" author="jtraupman" created="Tue, 12 Apr 2011 22:08:15 +0100"  >&lt;p&gt;So I have a new patch that reverses the default and discards the temp files unless an option is specified to keep them around. I also removed the two deleteOnExit() calls in TimesSquaredJob since they are redundant if we&apos;re removing the root temp directory. This has the added benefit of keeping the actual file contents around if the &quot;keep temp files&quot; conf parameter is specified, which I imagine might be useful for debugging. &lt;/p&gt;

&lt;p&gt;What is the best way to submit this patch? Shall I upload it to this issue or just create a new one?&lt;/p&gt;</comment>
                            <comment id="13019095" author="tdunning" created="Tue, 12 Apr 2011 23:38:05 +0100"  >&lt;p&gt;Upload it to the same issue with the same file name and everything is&lt;br/&gt;
pretty.  JIRA will retain your old patch and mark it as superseded.&lt;/p&gt;

&lt;p&gt;On Tue, Apr 12, 2011 at 2:09 PM, Jonathan Traupman (JIRA)&lt;/p&gt;
</comment>
                            <comment id="13019104" author="jtraupman" created="Wed, 13 Apr 2011 00:14:54 +0100"  >&lt;p&gt;OK. Since Jake already accepted, applied and committed the previous patch, should I base the new one off the current trunk version (r1091593) or off of the same version as the original patch (r1091276)?&lt;/p&gt;</comment>
                            <comment id="13019105" author="jake.mannix" created="Wed, 13 Apr 2011 00:22:42 +0100"  >&lt;p&gt;Yes, base a patch off of trunk, or else it will be pretty hard for us to apply it. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13019123" author="tdunning" created="Wed, 13 Apr 2011 01:01:26 +0100"  >&lt;p&gt;Base any patch against trunk.&lt;/p&gt;</comment>
                            <comment id="13019167" author="jtraupman" created="Wed, 13 Apr 2011 03:27:37 +0100"  >&lt;p&gt;This is an updated patch that supersedes the previous one. Removal of temp files is now the default behavior and I changed the conf parameter name to reflect this. When the parameter is set to keep the temp files around, but the directories and the sequence files are retained.&lt;/p&gt;

&lt;p&gt;Patch applied to trunk (r1091565).&lt;/p&gt;

&lt;p&gt;All unit tests pass.&lt;/p&gt;</comment>
                            <comment id="13019168" author="jtraupman" created="Wed, 13 Apr 2011 03:28:03 +0100"  >&lt;p&gt;Updated patch with new default behavior.&lt;/p&gt;</comment>
                            <comment id="13019169" author="jtraupman" created="Wed, 13 Apr 2011 03:28:39 +0100"  >&lt;p&gt;New patch supersedes the original one with same name.&lt;/p&gt;</comment>
                            <comment id="13020296" author="hudson" created="Fri, 15 Apr 2011 14:10:37 +0100"  >&lt;p&gt;Integrated in Mahout-Quality #750 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Mahout-Quality/750/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/Mahout-Quality/750/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-666&quot; title=&quot;DistributedSparseMatrix should clean up after itself when doing times(Vector) and timesSquared(Vector)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-666&quot;&gt;&lt;del&gt;MAHOUT-666&lt;/del&gt;&lt;/a&gt; updated patch to clarify default behavior&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12476205" name="mahout-666.patch" size="5810" author="jtraupman" created="Wed, 13 Apr 2011 03:27:37 +0100"/>
                            <attachment id="12476080" name="mahout-666.patch" size="7193" author="jtraupman" created="Tue, 12 Apr 2011 03:26:35 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 12 Apr 2011 02:51:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9396</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy3q7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22755</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>