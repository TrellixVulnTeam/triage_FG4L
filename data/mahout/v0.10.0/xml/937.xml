<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:18:47 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-937/MAHOUT-937.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-937] Collocations Job Partitioner not being configured properly</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-937</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;The first pass of the collocations discovery job (as described by CollocDriver.generateCollocations) uses the org.apache.mahout.vectorizer.collocations.llr.GramKeyPartitioner partitioner. &lt;/p&gt;

&lt;p&gt;This partitoner has an instance variable offset that is supposed to be set by a call to setOffsets() but this call is never made (not sure why? is this method expected to be called by the Hadoop framework itself?) &lt;/p&gt;

&lt;p&gt;The offset not being set results in getPartition always returning 0 and so all intermediate data is sent to the one reducer. &lt;/p&gt;

&lt;p&gt;I couldn&apos;t quite understand what this partitioning was meant to be doing, but simply hashing the Grams primary string representation (ie without the leading &apos;type&apos; byte) does what is required...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class GramKeyPartitioner &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Partitioner&amp;lt;GramKey, Gram&amp;gt; {

  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; getPartition(GramKey key, Gram value, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numPartitions) {
    &lt;span class=&quot;code-comment&quot;&gt;// exclude first &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; which is the key type 
&lt;/span&gt;    &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] keyBytesWithoutTypeByte = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[key.getPrimaryLength()-1]; 
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.arraycopy(key.getBytes(), 1, keyBytesWithoutTypeByte, 0, keyBytesWithoutTypeByte.length); 
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; hash = WritableComparator.hashBytes(keyBytesWithoutTypeByte, keyBytesWithoutTypeByte.length);
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (hash &amp;amp; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MAX_VALUE) % numPartitions;    
  }
  
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</description>
                <environment></environment>
        <key id="12536475">MAHOUT-937</key>
            <summary>Collocations Job Partitioner not being configured properly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean Owen</assignee>
                                    <reporter username="mat_kelcey">Mat Kelcey</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Dec 2011 06:29:28 +0000</created>
                <updated>Thu, 9 Feb 2012 14:00:47 +0000</updated>
                            <resolved>Thu, 29 Dec 2011 03:21:03 +0000</resolved>
                                    <version>0.5</version>
                                    <fixVersion>0.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13176684" author="srowen" created="Wed, 28 Dec 2011 15:32:39 +0000"  >&lt;p&gt;I agree this looks like it can&apos;t be right. The methods aren&apos;t called, and the result hashes 0 bytes every time. I think the simplest thing is to even avoid copying the byte array; here&apos;s my proposed patch, which has the same result. Tests pass. I&apos;ll commit soon if there are no objections since it seems like this can only be a fix, based on the semantics the tests imply.&lt;/p&gt;</comment>
                            <comment id="13176691" author="mat_kelcey" created="Wed, 28 Dec 2011 15:48:28 +0000"  >&lt;p&gt;I should have checked WritableComparator.hashBytes first, for some reason I had it in my head that the hashing was special. Thanks!&lt;/p&gt;</comment>
                            <comment id="13177031" author="hudson" created="Thu, 29 Dec 2011 07:00:19 +0000"  >&lt;p&gt;Integrated in Mahout-Quality #1278 (See &lt;a href=&quot;https://builds.apache.org/job/Mahout-Quality/1278/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Mahout-Quality/1278/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-937&quot; title=&quot;Collocations Job Partitioner not being configured properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-937&quot;&gt;&lt;del&gt;MAHOUT-937&lt;/del&gt;&lt;/a&gt; make partitioner send to different reducers (as intended it seems) by just using the hash of primary bytes&lt;/p&gt;

&lt;p&gt;srowen : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1225420&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1225420&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/vectorizer/collocations/llr/GramKeyPartitioner.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12508730" name="GramKeyPartitioner.java" size="1670" author="mat_kelcey" created="Wed, 28 Dec 2011 06:31:09 +0000"/>
                            <attachment id="12508768" name="MAHOUT-937.patch" size="2116" author="srowen" created="Wed, 28 Dec 2011 15:32:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 28 Dec 2011 15:32:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>222158</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy21z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22484</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>