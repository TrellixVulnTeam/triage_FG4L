<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:23:11 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-604/MAHOUT-604.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-604] Bayes Classifier fails on data other than training data</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-604</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;The Bayes Classifier throws an exception when tested with different data than the training data.&lt;/p&gt;




</description>
                <environment></environment>
        <key id="12497420">MAHOUT-604</key>
            <summary>Bayes Classifier fails on data other than training data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean Owen</assignee>
                                    <reporter username="lancenorskog">Lance Norskog</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Feb 2011 04:39:32 +0000</created>
                <updated>Sat, 21 May 2011 04:18:48 +0100</updated>
                            <resolved>Tue, 15 Feb 2011 07:57:40 +0000</resolved>
                                    <version>0.4</version>
                                    <fixVersion>0.5</fixVersion>
                                    <component>Classification</component>
                        <due>Fri, 25 Feb 2011 00:00:00 +0000</due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12989510" author="lancenorskog" created="Wed, 2 Feb 2011 04:41:53 +0000"  >&lt;p&gt;Scenario: I was trying out the Wikipedia Bayes classifier example from the wiki. After downloading the full wikipedia set and splitting it into 1.1m chunks, I used  chunk-0001.xml as training data and chunk-0002.xml as test data. I preprocessed both test and training data with the countries.txt file. &lt;/p&gt;

&lt;p&gt;When I test against the same data I trained on (chunk-0001.xml), I get this:&lt;br/&gt;
 =======================================================&lt;br/&gt;
Summary&lt;br/&gt;
-------------------------------------------------------&lt;br/&gt;
Correctly Classified Instances          :          5       83.3333%&lt;br/&gt;
Incorrectly Classified Instances        :          1       16.6667%&lt;br/&gt;
Total Classified Instances              :          6&lt;/p&gt;

&lt;p&gt;=======================================================&lt;br/&gt;
Confusion Matrix&lt;br/&gt;
-------------------------------------------------------&lt;br/&gt;
a      b      c         &amp;lt;--Classified as&lt;br/&gt;
0      1      0          |  1           a     = algeria&lt;br/&gt;
0      5      0          |  5           b     = united_states&lt;br/&gt;
0      0      0          |  0           c     = unknown&lt;br/&gt;
Default Category: unknown: 2&lt;/p&gt;


&lt;p&gt;When I test with this on a different input set (chunk-0002.xml), I get this:&lt;/p&gt;

&lt;p&gt;Running on hadoop, using HADOOP_HOME=/lucid/lance/open/hadoop-0.20.2&lt;br/&gt;
No HADOOP_CONF_DIR set, using /lucid/lance/open/hadoop-0.20.2/conf&lt;br/&gt;
11/01/31 23:49:16 INFO bayes.TestClassifier: Loading model from:&lt;/p&gt;
{basePath=../datasets/wikipedia_train1/, classifierType=bayes,
alpha_i=1.0, dataSource=hdfs, gramSize=1, verbose=false,
encoding=UTF-8, defaultCat=unknown,
testDirPath=../datasets/wikipedia_input2}
&lt;p&gt;11/01/31 23:49:16 INFO bayes.TestClassifier: Testing Bayes Classifier&lt;br/&gt;
11/01/31 23:49:16 INFO io.SequenceFileModelReader:&lt;br/&gt;
&lt;a href=&quot;file:/lucid/lance/open/datasets/wikipedia_train1/trainer-weights/Sigma_j/part-00000&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/lucid/lance/open/datasets/wikipedia_train1/trainer-weights/Sigma_j/part-00000&lt;/a&gt;&lt;br/&gt;
11/01/31 23:49:16 INFO io.SequenceFileModelReader:&lt;br/&gt;
&lt;a href=&quot;file:/lucid/lance/open/datasets/wikipedia_train1/trainer-weights/Sigma_k/part-00000&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/lucid/lance/open/datasets/wikipedia_train1/trainer-weights/Sigma_k/part-00000&lt;/a&gt;&lt;br/&gt;
11/01/31 23:49:16 INFO io.SequenceFileModelReader:&lt;br/&gt;
&lt;a href=&quot;file:/lucid/lance/open/datasets/wikipedia_train1/trainer-weights/Sigma_kSigma_j/part-00000&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/lucid/lance/open/datasets/wikipedia_train1/trainer-weights/Sigma_kSigma_j/part-00000&lt;/a&gt;&lt;br/&gt;
11/01/31 23:49:16 INFO io.SequenceFileModelReader: 24.58041375116976&lt;br/&gt;
11/01/31 23:49:16 INFO io.SequenceFileModelReader:&lt;br/&gt;
&lt;a href=&quot;file:/lucid/lance/open/datasets/wikipedia_train1/trainer-thetaNormalizer/part-00000&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/lucid/lance/open/datasets/wikipedia_train1/trainer-thetaNormalizer/part-00000&lt;/a&gt;&lt;br/&gt;
11/01/31 23:49:16 INFO io.SequenceFileModelReader:&lt;br/&gt;
&lt;a href=&quot;file:/lucid/lance/open/datasets/wikipedia_train1/trainer-tfIdf/trainer-tfIdf/part-00000&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/lucid/lance/open/datasets/wikipedia_train1/trainer-tfIdf/trainer-tfIdf/part-00000&lt;/a&gt;&lt;br/&gt;
11/01/31 23:49:17 INFO datastore.InMemoryBayesDatastore: algeria&lt;br/&gt;
-30159.939567094563 78146.01904096449 -0.38594339081156&lt;br/&gt;
11/01/31 23:49:17 INFO datastore.InMemoryBayesDatastore: united_states&lt;br/&gt;
-78146.01904096449 78146.01904096449 -1.0&lt;br/&gt;
Exception in thread &quot;main&quot; java.lang.NullPointerException&lt;br/&gt;
 at org.apache.mahout.classifier.ConfusionMatrix.getCount(ConfusionMatrix.java:99)&lt;br/&gt;
 at org.apache.mahout.classifier.ConfusionMatrix.incrementCount(ConfusionMatrix.java:115)&lt;br/&gt;
 at org.apache.mahout.classifier.ConfusionMatrix.incrementCount(ConfusionMatrix.java:119)&lt;br/&gt;
 at org.apache.mahout.classifier.ConfusionMatrix.addInstance(ConfusionMatrix.java:87)&lt;br/&gt;
 at org.apache.mahout.classifier.ResultAnalyzer.addInstance(ResultAnalyzer.java:69)&lt;br/&gt;
 at org.apache.mahout.classifier.bayes.TestClassifier.classifySequential(TestClassifier.java:266)&lt;br/&gt;
 at org.apache.mahout.classifier.bayes.TestClassifier.main(TestClassifier.java:186)&lt;br/&gt;
 at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
 at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
 at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
 at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
 at org.apache.hadoop.util.ProgramDriver$ProgramDescription.invoke(ProgramDriver.java:68)&lt;br/&gt;
 at org.apache.hadoop.util.ProgramDriver.driver(ProgramDriver.java:139)&lt;br/&gt;
 at org.apache.mahout.driver.MahoutDriver.main(MahoutDriver.java:187)&lt;br/&gt;
 at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
 at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
 at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
 at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
 at org.apache.hadoop.util.RunJar.main(RunJar.java:156)&lt;/p&gt;</comment>
                            <comment id="12992443" author="srowen" created="Wed, 9 Feb 2011 11:31:10 +0000"  >&lt;p&gt;Lance can we get any more info on this? The exception in question, to start.&lt;/p&gt;</comment>
                            <comment id="12992947" author="lancenorskog" created="Thu, 10 Feb 2011 09:14:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;Lance can we get any more info on this? The exception in question, to start.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The first comment has all the details, and a stack trace. I&apos;ll rerun it on my setup- maybe my test data got corrupted somehow.&lt;/p&gt;</comment>
                            <comment id="12992952" author="srowen" created="Thu, 10 Feb 2011 09:19:26 +0000"  >&lt;p&gt;Oops. Whatever link I clicked last time must have sent me straight to some sub-section of the issue in the new JIRA layout. It appeared to have no comments. In any event, yes I bet you can spot the small bug an suggested a way to handle the null here. Patches are great.&lt;/p&gt;</comment>
                            <comment id="12992961" author="robinanil" created="Thu, 10 Feb 2011 09:31:27 +0000"  >&lt;p&gt;Could you list down the steps you followed. I am not able to reproduce this issue&lt;/p&gt;

&lt;p&gt;Robin&lt;/p&gt;</comment>
                            <comment id="12993482" author="srowen" created="Fri, 11 Feb 2011 13:21:21 +0000"  >&lt;p&gt;This sounds like &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-569&quot; title=&quot;Category names with spaces cause NullPointerException in ConfusionMatrix when testing classifier&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-569&quot;&gt;&lt;del&gt;MAHOUT-569&lt;/del&gt;&lt;/a&gt; but is not quite the same. I think it&apos;s another issue that&apos;s been uncovered.&lt;/p&gt;

&lt;p&gt;This is the problem in ConfusionMatrix.getCount(). labelMap.get(classifiedLabel) is null. &lt;/p&gt;

&lt;p&gt;The Preconditions call looks like it&apos;s attempting to check for that, but the check seems wrong:&lt;br/&gt;
!labelMap.containsKey(correctLabel) || labelMap.containsKey(classifiedLabel) || defaultLabel.equals(classifiedLabel)&lt;/p&gt;

&lt;p&gt;It seems like it would want to verify that the map contained both keys, but that&apos;s not what it says. The check for &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-569&quot; title=&quot;Category names with spaces cause NullPointerException in ConfusionMatrix when testing classifier&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-569&quot;&gt;&lt;del&gt;MAHOUT-569&lt;/del&gt;&lt;/a&gt; changed this check but not that logic.&lt;/p&gt;

&lt;p&gt;It still doesn&apos;t answer why it would be called with invalid input, but, fixing this is a first step perhaps. Am I on the right track?&lt;/p&gt;</comment>
                            <comment id="12994282" author="srowen" created="Mon, 14 Feb 2011 13:14:27 +0000"  >&lt;p&gt;I think this corrects and clarifies the Preconditions check in a way that avoids this NPE. You can try it out Lance to confirm?&lt;/p&gt;</comment>
                            <comment id="12994576" author="lancenorskog" created="Mon, 14 Feb 2011 23:58:48 +0000"  >&lt;p&gt;Yes, it works now. It classifies against both the training and test data.&lt;/p&gt;</comment>
                            <comment id="12994725" author="hudson" created="Tue, 15 Feb 2011 09:34:47 +0000"  >&lt;p&gt;Integrated in Mahout-Quality #629 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Mahout-Quality/629/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/Mahout-Quality/629/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-604&quot; title=&quot;Bayes Classifier fails on data other than training data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-604&quot;&gt;&lt;del&gt;MAHOUT-604&lt;/del&gt;&lt;/a&gt; avoid an NPE by updating Preconditions check&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12470993" name="MAHOUT-604.patch" size="1872" author="srowen" created="Mon, 14 Feb 2011 13:14:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 9 Feb 2011 11:31:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9457</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy43b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22814</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>