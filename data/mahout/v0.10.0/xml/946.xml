<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:18:05 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-946/MAHOUT-946.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-946] Map-reduce job status often left unchecked</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-946</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;I&apos;ve run into a few places in Mahout where mapreduce jobs can fail and their status won&apos;t be checked, so processing will continue on.  This sometimes obscures the root problem.  I&apos;ve tracked down a bunch of places where this problem exists, and tried to fix the code to do something reasonable (return -1 status code, throw exception, etc.) when jobs fail.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12538460">MAHOUT-946</key>
            <summary>Map-reduce job status often left unchecked</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean Owen</assignee>
                                    <reporter username="tcp">tom pierce</reporter>
                        <labels>
                    </labels>
                <created>Sun, 15 Jan 2012 22:40:09 +0000</created>
                <updated>Sat, 16 Jun 2012 10:35:17 +0100</updated>
                            <resolved>Wed, 8 Feb 2012 17:17:27 +0000</resolved>
                                    <version>0.6</version>
                                    <fixVersion>0.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13186626" author="lancenorskog" created="Mon, 16 Jan 2012 00:01:04 +0000"  >&lt;p&gt;Don&apos;t forget the example shell scripts!&lt;/p&gt;</comment>
                            <comment id="13187264" author="tcp" created="Mon, 16 Jan 2012 22:29:12 +0000"  >&lt;p&gt;Making sure the examples halt at appropriate places looks like it could be pretty involved.  For example, the first program where I added exit-code checks (asf-email-examples.sh) would not fail early, even when given a non-existant input directory.  Digging in, I found the java code (SequenceFilesFromMailArchives and MailProcessor) is happy to skip &quot;missing&quot; files during processing, even if that leads to 0 input records overall.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure I have the time/bandwidth to audit all of these.  Can we split that off into another JIRA (or maybe several for different examples)?&lt;/p&gt;</comment>
                            <comment id="13187369" author="lancenorskog" created="Tue, 17 Jan 2012 01:38:48 +0000"  >&lt;p&gt;Yup, you&apos;re right. Shell script should be a separate project.&lt;/p&gt;

&lt;p&gt;One thing that jumps out at me is refactoring. The AbstractJob class is a toolkit for common tasks. It has a lot of kit for maybe the first 1/3 of the code to set up and run a job from the command line.  Could it also have a &quot;run job and fail nicely&quot; method?&lt;/p&gt;</comment>
                            <comment id="13187755" author="tcp" created="Tue, 17 Jan 2012 15:31:07 +0000"  >&lt;p&gt;Interesting thought - right now it seems to me the simplest &quot;drop in&quot; convenience method would be a (better-named) runAndThrowExceptionOnFailure().  There could also be a version that returned a status code, but I think most locations that use status codes also run multiple jobs.  So you still have to check the return value at many of the call-sites, just like with Job.waitForCompletion().  &lt;/p&gt;

&lt;p&gt;Some of these classes are also not AbstractJobs (though in some cases they should probably be converted - not sure it would make sense in all cases), some return some non-status value from the method that fires of the MR job, etc.  Maybe a static util method would make more sense?&lt;/p&gt;

&lt;p&gt;Taking a long view, I&apos;d actually prefer to see most of these call sites re-worked to use return codes, rather than bake in exceptions.  Probably not pragmatic, though.  Sometimes done is the best color.  &lt;/p&gt;

&lt;p&gt;Absent objections in the next day or so, I&apos;ll do something along the lines of static Job.waitForCompletion wrappers in AbstractJob.  &lt;/p&gt;</comment>
                            <comment id="13188152" author="lancenorskog" created="Wed, 18 Jan 2012 00:48:09 +0000"  >&lt;p&gt;A job shutdown method should remember to remove intermediate files, and if it fails remove the output. A job should be able to override the &quot;run the job&quot; method with extra cleanups. &lt;/p&gt;</comment>
                            <comment id="13194873" author="tcp" created="Fri, 27 Jan 2012 15:55:43 +0000"  >&lt;p&gt;I thought about this some more and realized in many cases you might want opposite behavior (delete the intermediate files unless something broke - in that case save them for analysis).&lt;/p&gt;

&lt;p&gt;In the end, I added a way to accumulate a list of Paths and clean those paths at the end of processing, but left accumulation and triggering deletion as subclass responsibilities.&lt;/p&gt;</comment>
                            <comment id="13195416" author="lancenorskog" created="Sat, 28 Jan 2012 04:48:49 +0000"  >&lt;p&gt;Sweet!&lt;/p&gt;</comment>
                            <comment id="13202848" author="srowen" created="Tue, 7 Feb 2012 21:57:43 +0000"  >&lt;p&gt;I like it all, except I&apos;m not sure about the cleanup methods. I think as you say the job can manage that if it needs to clean up; at least, that&apos;s how it works now.&lt;/p&gt;</comment>
                            <comment id="13202917" author="dlyubimov" created="Tue, 7 Feb 2012 23:06:14 +0000"  >&lt;blockquote&gt;&lt;p&gt;Some of these classes are also not AbstractJobs (though in some cases they should probably be converted - not sure it would make sense in all cases), some return some non-status value from the method that fires of the MR job, etc. Maybe a static util method would make more sense?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Static util method would probably make more sense. &lt;/p&gt;

&lt;p&gt;My current view of AbstractJob is that it is mixing two disparate concerns in one implementation: a Tool (pipeline bootstrap) in a sense of handing off the default Configuration, to which end it has a lot of helper methods, and a distinct MR job. Due to this, it is hard (or at least inconsistent) to use it as a base for a separate and highly specific step in multistep pipelines. &lt;/p&gt;

&lt;p&gt;Static method would not require AbstractJob as a base, so static drop-in is probably a better approach at this point.&lt;/p&gt;</comment>
                            <comment id="13203290" author="lancenorskog" created="Wed, 8 Feb 2012 05:38:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;My current view of AbstractJob is that it is mixing two disparate concerns in one implementation: a Tool (pipeline bootstrap) in a sense of handing off the default Configuration, to which end it has a lot of helper methods, and a distinct MR job&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;There are some single-threaded AbstractJob apps. It handles so much argument processing nonsense that it is useful for that alone.&lt;/p&gt;</comment>
                            <comment id="13203694" author="tcp" created="Wed, 8 Feb 2012 16:03:01 +0000"  >&lt;p&gt;I agree that the cleanup stuff seems a bit awkward as is.&lt;/p&gt;

&lt;p&gt;I&apos;d like to see the checks get in, and I think halting execution on job failure is something folks can agree is an improvement.  It might be harder to settle on consensus for job cleanup strategies.  &lt;/p&gt;

&lt;p&gt;Would it make sense at this point to integrate the earlier patch, without the cleanups, and split off utility methods for cleanup to another ticket?  If so I&apos;ll volunteer to open a new issue and submit an initial patch to address the cleanup issue.&lt;/p&gt;</comment>
                            <comment id="13203755" author="srowen" created="Wed, 8 Feb 2012 17:17:27 +0000"  >&lt;p&gt;Agree, that much is done and committed now.&lt;/p&gt;</comment>
                            <comment id="13203986" author="hudson" created="Wed, 8 Feb 2012 21:09:47 +0000"  >&lt;p&gt;Integrated in Mahout-Quality #1341 (See &lt;a href=&quot;https://builds.apache.org/job/Mahout-Quality/1341/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Mahout-Quality/1341/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-946&quot; title=&quot;Map-reduce job status often left unchecked&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-946&quot;&gt;&lt;del&gt;MAHOUT-946&lt;/del&gt;&lt;/a&gt; (missed one file)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-946&quot; title=&quot;Map-reduce job status often left unchecked&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-946&quot;&gt;&lt;del&gt;MAHOUT-946&lt;/del&gt;&lt;/a&gt; Don&apos;t ignore failed MR status&lt;/p&gt;

&lt;p&gt;srowen : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1241992&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1241992&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/classifier/naivebayes/test/TestNaiveBayesDriver.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;srowen : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1241988&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1241988&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/cf/taste/hadoop/als/DatasetSplitter.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/cf/taste/hadoop/als/FactorizationEvaluator.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/cf/taste/hadoop/als/ParallelALSFactorizationJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/cf/taste/hadoop/als/RecommenderJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/cf/taste/hadoop/item/RecommenderJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/cf/taste/hadoop/preparation/PreparePreferenceMatrixJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/cf/taste/hadoop/pseudo/RecommenderJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/cf/taste/hadoop/similarity/item/ItemSimilarityJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/cf/taste/hadoop/slopeone/SlopeOneAverageDiffsJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/classifier/df/mapreduce/Classifier.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/classifier/df/tools/FrequenciesJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/classifier/naivebayes/training/TrainNaiveBayesJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/clustering/spectral/common/AffinityMatrixInputJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/clustering/spectral/common/MatrixDiagonalizeJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/clustering/spectral/common/UnitVectorizerJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/clustering/spectral/common/VectorMatrixMultiplicationJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/clustering/spectral/eigencuts/EigencutsAffinityCutsJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/clustering/spectral/eigencuts/EigencutsSensitivityJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/fpm/pfpgrowth/PFPGrowth.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/ga/watchmaker/MahoutEvaluator.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/graph/AdjacencyMatrixJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/graph/linkanalysis/RandomWalk.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/math/hadoop/similarity/cooccurrence/RowSimilarityJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/math/hadoop/stats/BasicStats.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/math/stats/entropy/ConditionalEntropy.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/math/stats/entropy/Entropy.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/vectorizer/DictionaryVectorizer.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/vectorizer/DocumentProcessor.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/vectorizer/HighDFWordsPruner.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/vectorizer/SimpleTextEncodingVectorizer.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/vectorizer/collocations/llr/CollocDriver.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/vectorizer/common/PartialVectorMerger.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/vectorizer/tfidf/TFIDFConverter.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/examples/src/main/java/org/apache/mahout/cf/taste/example/email/MailToPrefsDriver.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/examples/src/main/java/org/apache/mahout/classifier/bayes/WikipediaDatasetCreatorDriver.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/examples/src/main/java/org/apache/mahout/classifier/email/PrepEmailVectorsDriver.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/examples/src/main/java/org/apache/mahout/fpm/pfpgrowth/dataset/KeyBasedStringTupleGrouper.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/examples/src/main/java/org/apache/mahout/ga/watchmaker/cd/hadoop/CDMahoutEvaluator.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/examples/src/main/java/org/apache/mahout/ga/watchmaker/cd/tool/CDInfosTool.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/examples/src/main/java/org/apache/mahout/text/WikipediaToSequenceFile.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/integration/src/main/java/org/apache/mahout/clustering/conversion/InputDriver.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/integration/src/main/java/org/apache/mahout/clustering/conversion/meanshift/InputDriver.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/integration/src/main/java/org/apache/mahout/clustering/evaluation/RepresentativePointsDriver.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/integration/src/main/java/org/apache/mahout/text/TextParagraphSplittingJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/integration/src/main/java/org/apache/mahout/utils/SplitInputJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/integration/src/main/java/org/apache/mahout/utils/regex/RegexConverterDriver.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12512183" name="MAHOUT-946.patch" size="56278" author="tcp" created="Fri, 27 Jan 2012 15:55:43 +0000"/>
                            <attachment id="12510644" name="MAHOUT-946.patch" size="49552" author="tcp" created="Sun, 15 Jan 2012 22:42:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 16 Jan 2012 00:01:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>223964</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy1zz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22475</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>