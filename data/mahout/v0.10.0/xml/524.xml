<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:16:15 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-524/MAHOUT-524.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-524] DisplaySpectralKMeans example fails</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-524</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;I&apos;ve committed a new display example that attempts to push the standard mixture of models data set through spectral k-means. After some tweaking of configuration arguments and a bug fix in EigenCleanupJob it runs spectral k-means to completion. The display example is expecting 2-d clustered points and the example is producing 5-d points. Additional I/O work is needed before this will play with the rest of the clustering algorithms. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12477094">MAHOUT-524</key>
            <summary>DisplaySpectralKMeans example fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="magsol">Shannon Quinn</assignee>
                                    <reporter username="jeastman">Jeff Eastman</reporter>
                        <labels>
                            <label>clustering</label>
                            <label>k-means</label>
                            <label>visualization</label>
                    </labels>
                <created>Tue, 12 Oct 2010 04:31:46 +0100</created>
                <updated>Sun, 12 Feb 2012 13:55:02 +0000</updated>
                            <resolved>Wed, 4 Jan 2012 14:58:05 +0000</resolved>
                                    <version>0.4</version>
                    <version>0.5</version>
                                    <fixVersion>0.6</fixVersion>
                                    <component>Clustering</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                            <comments>
                            <comment id="12920226" author="hudson" created="Tue, 12 Oct 2010 16:00:44 +0100"  >&lt;p&gt;Integrated in Mahout-Quality #392 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Mahout-Quality/392/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/Mahout-Quality/392/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-524&quot; title=&quot;DisplaySpectralKMeans example fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-524&quot;&gt;&lt;del&gt;MAHOUT-524&lt;/del&gt;&lt;/a&gt;: Moved numEigensWritten initialization out of loop. SpectralKMeans now runs to completion but display routing is expecting a 2-d vector and is getting a 5-d vector. Not clustering the original input points. More to test but CleanEigensJob is working.&lt;/p&gt;</comment>
                            <comment id="12922552" author="jeastman" created="Tue, 19 Oct 2010 14:31:14 +0100"  >&lt;p&gt;This does not impact 0.4 usability as spectral clustering is still experimental and needs I/O. The display routine could be removed for hygiene but I prefer to leave it in with a caveat that it is part of several work-in-progress issues to integrate spectral clustering into the rest of the clustering portfolio.&lt;/p&gt;</comment>
                            <comment id="12982681" author="srowen" created="Mon, 17 Jan 2011 15:55:25 +0000"  >&lt;p&gt;Jeff sounds like there is no outstanding issue here at the moment, or something more to track here?&lt;/p&gt;</comment>
                            <comment id="12982737" author="jeastman" created="Mon, 17 Jan 2011 17:06:20 +0000"  >&lt;p&gt;The Display algorithm now runs without errors but the 2 clusters it produces are clearly not what I was expecting. Probably a gross misunderstanding on my part and a final output processing step that needs to be invented. &lt;/p&gt;</comment>
                            <comment id="12982912" author="hudson" created="Mon, 17 Jan 2011 23:07:41 +0000"  >&lt;p&gt;Integrated in Mahout-Quality #567 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Mahout-Quality/567/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/Mahout-Quality/567/&lt;/a&gt;)&lt;/p&gt;
</comment>
                            <comment id="12983278" author="magsol" created="Tue, 18 Jan 2011 17:27:22 +0000"  >&lt;p&gt;No, there&apos;s definitely something wrong here. I&apos;ve attached some synthetic data I generated - concentric circles of 2D points, which spectral clustering is particularly good at correctly grouping. The &quot;raw&quot; file contains 450 raw data points in 3 separate circles (feel free to plot them to take a look). The affinities are generated by providing a cutoff in terms of Euclidean distance - say, 2.0 - where any point that has a distance of &amp;lt; 2 is given an affinity (here using the Gaussian kernel, gives a nice &lt;span class=&quot;error&quot;&gt;&amp;#91;0, 1&amp;#93;&lt;/span&gt; affinity), and everything else is set to 0 (enforces sparsity in the affinity matrix). Plus, I constructed the data specifically such that the points between circles have a minimum distance of 2.&lt;/p&gt;

&lt;p&gt;Unfortunately, if you run SpectralKMeans on the aff.txt file, other than the tightly-packed cluster in the middle it doesn&apos;t do a particularly good job of identifying the other two clusters (points 0-149 should have the same ID, as well as points 150-299, and 300-449). Obviously there is still something amiss; a good place to start is to take a look at the eigenvectors generated by the LanczosSolver. If everything is behaving as it should, these should show piecewise constancy: that is, each 150 consecutive elements in the 450-element vectors should have about the same value. If this is not the case, we&apos;re either generating affinities incorrectly, or there&apos;s a problem with the algorithm itself.&lt;/p&gt;

&lt;p&gt;Also, I noticed when attempting to run the program that it often doesn&apos;t show the entire list of available and required arguments. I couldn&apos;t reliably determine a cause; often it would show just 1 of the required arguments, but if I supplied some of the required arguments and left out others, it would display all of them. I&apos;m assuming this is a bug; any idea where I could find it?&lt;/p&gt;</comment>
                            <comment id="12984534" author="magsol" created="Fri, 21 Jan 2011 02:26:04 +0000"  >&lt;p&gt;In case anyone was interested, I wrote a quick script that visualizes the labelings. Not really much insight to be had other than to confirm that it doesn&apos;t work quite right yet.&lt;/p&gt;</comment>
                            <comment id="13016065" author="srowen" created="Tue, 5 Apr 2011 19:28:27 +0100"  >&lt;p&gt;There does seem to be a bug here so don&apos;t think this should be closed. But it&apos;s a problem with the examples code it seems if anything. And I don&apos;t know if there&apos;s reason to suspect there can be more investigation in a few weeks before 0.5? if not, probably best to push it down the road. Obviously would be great to get any progress in before the upcoming release.&lt;/p&gt;</comment>
                            <comment id="13038468" author="srowen" created="Tue, 24 May 2011 10:20:03 +0100"  >&lt;p&gt;It seems like there&apos;s an issue here that should be fixed with some priority.&lt;/p&gt;</comment>
                            <comment id="13038608" author="magsol" created="Tue, 24 May 2011 16:05:28 +0100"  >&lt;p&gt;+1, I&apos;m on it.&lt;/p&gt;

&lt;p&gt;I&apos;m a little unclear as to the context of the initial Hudson comment: the display method is expecting 2D vectors, but getting 5D ones?&lt;/p&gt;</comment>
                            <comment id="13086595" author="jeastman" created="Wed, 17 Aug 2011 22:06:27 +0100"  >&lt;p&gt;The original example was extracting 5 eigenvectors and thus returned 5-d results. I changed it to extract 2 vectors and it used to run but displayed incorrect results.&lt;/p&gt;

&lt;p&gt;I&apos;m (still since pre 0.5 testing, IIRC) getting a FileNotFoundException in the bowels of DRM.times while running this in local Hadoop mode. I wonder if it is possible to add a --method sequential implementation for SpectralKMeans to help separate the algorithmetic issues from the file bookkeeping ones?&lt;/p&gt;

&lt;p&gt;We have a sequential Lanczos implementation...&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.lang.IllegalStateException: java.io.FileNotFoundException: File &lt;a href=&quot;file:/home/dev/workspace/mahout/examples/output/calculations/laplacian-33/tmp/data&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/home/dev/workspace/mahout/examples/output/calculations/laplacian-33/tmp/data&lt;/a&gt; does not exist.&lt;br/&gt;
	at org.apache.mahout.math.hadoop.DistributedRowMatrix.times(DistributedRowMatrix.java:222)&lt;br/&gt;
	at org.apache.mahout.math.decomposer.lanczos.LanczosSolver.solve(LanczosSolver.java:104)&lt;br/&gt;
	at org.apache.mahout.math.hadoop.decomposer.DistributedLanczosSolver.runJob(DistributedLanczosSolver.java:72)&lt;br/&gt;
	at org.apache.mahout.clustering.spectral.kmeans.SpectralKMeansDriver.run(SpectralKMeansDriver.java:155)&lt;br/&gt;
	at org.apache.mahout.clustering.display.DisplaySpectralKMeans.main(DisplaySpectralKMeans.java:72)&lt;br/&gt;
Caused by: java.io.FileNotFoundException: File &lt;a href=&quot;file:/home/dev/workspace/mahout/examples/output/calculations/laplacian-33/tmp/data&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/home/dev/workspace/mahout/examples/output/calculations/laplacian-33/tmp/data&lt;/a&gt; does not exist.&lt;br/&gt;
	at org.apache.hadoop.fs.RawLocalFileSystem.getFileStatus(RawLocalFileSystem.java:371)&lt;br/&gt;
	at org.apache.hadoop.fs.FilterFileSystem.getFileStatus(FilterFileSystem.java:245)&lt;br/&gt;
	at org.apache.hadoop.mapred.SequenceFileInputFormat.listStatus(SequenceFileInputFormat.java:51)&lt;br/&gt;
	at org.apache.hadoop.mapred.FileInputFormat.getSplits(FileInputFormat.java:211)&lt;br/&gt;
	at org.apache.hadoop.mapred.JobClient.writeOldSplits(JobClient.java:929)&lt;br/&gt;
	at org.apache.hadoop.mapred.JobClient.writeSplits(JobClient.java:921)&lt;br/&gt;
	at org.apache.hadoop.mapred.JobClient.access$500(JobClient.java:170)&lt;br/&gt;
	at org.apache.hadoop.mapred.JobClient$2.run(JobClient.java:838)&lt;br/&gt;
	at org.apache.hadoop.mapred.JobClient$2.run(JobClient.java:791)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
	at javax.security.auth.Subject.doAs(Subject.java:396)&lt;br/&gt;
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1059)&lt;br/&gt;
	at org.apache.hadoop.mapred.JobClient.submitJobInternal(JobClient.java:791)&lt;br/&gt;
	at org.apache.hadoop.mapred.JobClient.submitJob(JobClient.java:765)&lt;br/&gt;
	at org.apache.hadoop.mapred.JobClient.runJob(JobClient.java:1200)&lt;br/&gt;
	at org.apache.mahout.math.hadoop.DistributedRowMatrix.times(DistributedRowMatrix.java:214)&lt;br/&gt;
	... 4 more&lt;/p&gt;</comment>
                            <comment id="13092642" author="lancenorskog" created="Mon, 29 Aug 2011 06:25:03 +0100"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;I&apos;m documenting the Display outputs and it would be nice to have all of them &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13095021" author="lancenorskog" created="Thu, 1 Sep 2011 01:18:52 +0100"  >&lt;p&gt;Running DisplaySpectralKMeans gives this error:&lt;/p&gt;

&lt;p&gt;FileNotFound:Exception&lt;br/&gt;
examples/output/calculations/laplacian-48/tmp/data not found&lt;/p&gt;

&lt;p&gt;In fact, the data is stored here:&lt;/p&gt;

&lt;p&gt;examples/output/calculations/laplacian-48/tmp/1314835934416372000/DistributedMatrix.times.inputVector/&lt;/p&gt;

&lt;p&gt;Also, the directory with &quot;diagonal&quot; does not have a number; it assumes it is underneath a job-unique path:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
examples/output/calculations:

diagonal	laplacian-48	seqfile-160
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(The jobs create unique directories with a random 8-bit number.)&lt;/p&gt;

&lt;p&gt;Any hints on exactly which API call is wrong?&lt;/p&gt;</comment>
                            <comment id="13102165" author="magsol" created="Sat, 10 Sep 2011 23:17:12 +0100"  >&lt;p&gt;I believe this is the exact problem Dan Brickley picked up on his thread to the users list; I&apos;m working on this. The problem is somewhere in the SpectralKMeansDriver in how I set up the Paths that are used. Will update this week.&lt;/p&gt;</comment>
                            <comment id="13102171" author="danbri" created="Sun, 11 Sep 2011 00:08:08 +0100"  >&lt;p&gt;Not sure if you&apos;re mixing me and Danny Bickson, but I&apos;ve certainly seen these errors mentioning tmp/data paths, ... but the problem was when attempting spectral clustering; I didn&apos;t get as far as having any results to display.&lt;/p&gt;</comment>
                            <comment id="13102380" author="magsol" created="Mon, 12 Sep 2011 00:48:38 +0100"  >&lt;p&gt;I&apos;ve been tooling around with this code for a few hours now and cannot figure out where the pesky &quot;/data&quot; is being appended to the overall path...or why the second Path that Lance mentioned isn&apos;t what is actually being used. It has to be somewhere in the Lanczos solver code (filtering into the DistributedRowMatrix and its TimesSquaredJob, as the latter is what is actually causing the exception), but in all my searching and println()-ing of paths I can&apos;t seem to find it.&lt;/p&gt;

&lt;p&gt;Just prior to the TimesSquaredJob kicking off, the Lanczos solver outputs that is it &quot;Finding 4 singular vectors&quot;, followed by this output:&lt;/p&gt;

&lt;p&gt;11/09/11 19:28:42 INFO mapred.FileInputFormat: Total input paths to process : 2&lt;/p&gt;

&lt;p&gt;which is very confusing to me, since in the TimesSquaredJob &quot;createTimesSquaredJobConf()&quot; method, there is only one invocation of FileInputFormat.addInputPath(). This mysterious second input path may very well be the cause of the problems, but again I just can&apos;t seem to find where it&apos;s added.&lt;/p&gt;

&lt;p&gt;I&apos;m going to keep looking, but any help in finding this bug would be greatly appreciated.&lt;/p&gt;</comment>
                            <comment id="13102404" author="magsol" created="Mon, 12 Sep 2011 02:36:25 +0100"  >&lt;p&gt;Just for grins, I tried:&lt;/p&gt;

&lt;p&gt;FileInputFormat.getInputPaths(conf).length&lt;/p&gt;

&lt;p&gt;right before the TimesSquareJob started, and it was 1, not 2. Ever more confused.&lt;/p&gt;</comment>
                            <comment id="13103497" author="danbri" created="Tue, 13 Sep 2011 10:48:13 +0100"  >&lt;p&gt;I had a look around, failed to find a string in the mahout java source corresponding to that path; presume it&apos;s coming from an included module or config file.&lt;/p&gt;

&lt;p&gt;Hadoop btw has &lt;/p&gt;

&lt;p&gt;./io/MapFile.java:  public static final String DATA_FILE_NAME = &quot;data&quot;;&lt;/p&gt;

&lt;p&gt;though I don&apos;t see any direct use of MapFile or DATA_FILE_NAME, I&apos;m only grepping around textually; Eclipse might have smarter tooling. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://lucene.472066.n3.nabble.com/Overhauled-org-apache-mahout-cf-taste-hadoop-item-td745286.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.472066.n3.nabble.com/Overhauled-org-apache-mahout-cf-taste-hadoop-item-td745286.html&lt;/a&gt; suggests mapfile isn&apos;t so much used any more, so this might be a false lead.&lt;/p&gt;</comment>
                            <comment id="13107633" author="lancenorskog" created="Mon, 19 Sep 2011 06:47:21 +0100"  >&lt;p&gt;Possibly a little help. When run from the command line via mvn exec, this is the error log. Note that&lt;br/&gt;
a) an exception happens in an early m/r pass, and &lt;br/&gt;
b) the exception is ignored by the full job executor.&lt;br/&gt;
(MacOS X &quot;Kitty Liver&quot;)&lt;/p&gt;

&lt;p&gt;&lt;em&gt;lance$ MAVENOPTS=Xmx1000m mvn -q exec:java -Dexec.mainClass=&quot;org.apache.mahout.clustering.display.DisplaySpectralKMeans&quot;&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SLF4J: &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; path contains multiple SLF4J bindings.
SLF4J: Found binding in [jar:file:/Users/lancenorskog/.m2/repository/org/slf4j/slf4j-log4j12/1.6.1/slf4j-log4j12-1.6.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: Found binding in [jar:file:/Users/lancenorskog/.m2/repository/org/slf4j/slf4j-jcl/1.6.1/slf4j-jcl-1.6.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: See http:&lt;span class=&quot;code-comment&quot;&gt;//www.slf4j.org/codes.html#multiple_bindings &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; an explanation.
&lt;/span&gt;11/09/18 22:25:26 INFO common.HadoopUtil: Deleting samples
11/09/18 22:25:26 INFO common.HadoopUtil: Deleting output
11/09/18 22:25:26 INFO display.DisplayClustering: Generating 500 samples m=[1.0, 1.0] sd=3.0
11/09/18 22:25:26 INFO display.DisplayClustering: Generating 300 samples m=[1.0, 0.0] sd=0.5
11/09/18 22:25:26 INFO display.DisplayClustering: Generating 300 samples m=[0.0, 2.0] sd=0.1
11/09/18 22:25:28 WARN mapred.JobClient: Use GenericOptionsParser &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; parsing the arguments. Applications should implement Tool &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the same.
11/09/18 22:25:28 WARN mapred.JobClient: No job jar file set.  User classes may not be found. See JobConf(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;) or JobConf#setJar(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;).
11/09/18 22:25:28 INFO input.FileInputFormat: Total input paths to process : 1
11/09/18 22:25:28 INFO mapred.JobClient: Running job: job_local_0001
11/09/18 22:25:28 INFO mapred.MapTask: io.sort.mb = 100
*11/09/18 22:25:29 WARN mapred.LocalJobRunner: job_local_0001
java.lang.OutOfMemoryError: Java heap space
	at org.apache.hadoop.mapred.MapTask$MapOutputBuffer.&amp;lt;init&amp;gt;(MapTask.java:949)
	at org.apache.hadoop.mapred.MapTask$NewOutputCollector.&amp;lt;init&amp;gt;(MapTask.java:674)
	at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:756)
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:370)
	at org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:212)*
11/09/18 22:25:29 INFO mapred.JobClient:  map 0% reduce 0%
11/09/18 22:25:29 INFO mapred.JobClient: Job complete: job_local_0001
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13107635" author="lancenorskog" created="Mon, 19 Sep 2011 06:49:41 +0100"  >&lt;p&gt;For completeness, the log when running under Eclipse is attached as EclipseLog_20110918.txt&lt;/p&gt;</comment>
                            <comment id="13107640" author="lancenorskog" created="Mon, 19 Sep 2011 06:59:22 +0100"  >&lt;p&gt;As for 5-d points v.s. 2-d points, SVD does a great job, followed by random projection.&lt;/p&gt;</comment>
                            <comment id="13107668" author="srowen" created="Mon, 19 Sep 2011 08:38:55 +0100"  >&lt;p&gt;This is just an OutOfMemoryError. You have to tell Maven to use more memory for its JVM or else most M/R jobs will fail like this locally. Use MAVEN_OPTS=-Xmx1g . I&apos;m afraid this isn&apos;t the issue.&lt;/p&gt;</comment>
                            <comment id="13108324" author="lancenorskog" created="Tue, 20 Sep 2011 03:01:46 +0100"  >&lt;p&gt;1) I hiked the memory up to 2g, same result. Is it possible the option did not transmit to the JVM that runs the job?&lt;br/&gt;
2) I did not have this problem under Eclipse.&lt;/p&gt;

&lt;p&gt;In a separate investigation, running the &lt;em&gt;spectralkmeans&lt;/em&gt; mahout job gives the attached command-line failure log attached as SpectralKMeans_fail_20110919.txt. Yes, this is the &apos;get jars out to the hadoop executor&apos; problem. The &apos;job&apos; jar does not seem to do what it needs. Again, note that one failure does not cause the whole job to exit. I submit that there are multiple problems inside the job, and somehow there is a problem where the main job configurations do not get transmitted to a subsidiary executor.&lt;/p&gt;


</comment>
                            <comment id="13108353" author="danbri" created="Tue, 20 Sep 2011 04:58:16 +0100"  >&lt;p&gt;re job jar error, see &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-428&quot; title=&quot;KMeansDriver: No job jar file set leads to ClassNotFoundException: org.apache.mahout.clustering.kmeans.KMeansMapper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-428&quot;&gt;&lt;del&gt;MAHOUT-428&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-197&quot; title=&quot;LDADriver: No job jar file set leads to ClassNotFoundException: org.apache.mahout.clustering.lda.LDAMapper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-197&quot;&gt;&lt;del&gt;MAHOUT-197&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;draft patch: &lt;a href=&quot;https://raw.github.com/gist/1200439/4ad433b51e9d963cff5d500d974fa5cb6904b9c3/gistfile1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://raw.github.com/gist/1200439/4ad433b51e9d963cff5d500d974fa5cb6904b9c3/gistfile1.txt&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;I posted a patch that got me past those errors in the recent mailing list thread &apos;Spectral clustering - a bundle of issues&apos;. I&apos;ll paste the relevant chunk of my email below. see &lt;a href=&quot;http://comments.gmane.org/gmane.comp.apache.mahout.user/9319&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://comments.gmane.org/gmane.comp.apache.mahout.user/9319&lt;/a&gt;&lt;/p&gt;


&lt;hr /&gt;

&lt;p&gt;Trying to run &lt;a href=&quot;https://cwiki.apache.org/MAHOUT/spectral-clustering.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://cwiki.apache.org/MAHOUT/spectral-clustering.html&lt;/a&gt;&lt;br/&gt;
... seems perhaps some code rot?&lt;/p&gt;

&lt;p&gt;Can anyone else report success with Spectral clustering against recent trunk?&lt;/p&gt;

&lt;p&gt;Trying bin/mahout spectralkmeans -k 2 -i speccy -o specout --maxIter&lt;br/&gt;
10 --dimensions 37&lt;/p&gt;

&lt;p&gt;...with the small example affinity file we discussed yesterday, I hit&lt;br/&gt;
a series of problems.&lt;/p&gt;

&lt;p&gt;data: &lt;a href=&quot;http://danbri.org/2011/mahout/afftest.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://danbri.org/2011/mahout/afftest.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;1. As I mentioned in comments in&lt;br/&gt;
&lt;a href=&quot;http://spectrallyclustered.wordpress.com/2010/07/14/sprint-3-quick-update/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://spectrallyclustered.wordpress.com/2010/07/14/sprint-3-quick-update/&lt;/a&gt;&lt;br/&gt;
(both for local pseudo-cluster, and a real one) I had to patch in&lt;br/&gt;
calls to job.setJarByClass before job.waitForCompletion. This problem&lt;br/&gt;
occured for others elsewhere in Mahout, e.g. &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-428&quot; title=&quot;KMeansDriver: No job jar file set leads to ClassNotFoundException: org.apache.mahout.clustering.kmeans.KMeansMapper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-428&quot;&gt;&lt;del&gt;MAHOUT-428&lt;/del&gt;&lt;/a&gt; and&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-197&quot; title=&quot;LDADriver: No job jar file set leads to ClassNotFoundException: org.apache.mahout.clustering.lda.LDAMapper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-197&quot;&gt;&lt;del&gt;MAHOUT-197&lt;/del&gt;&lt;/a&gt;, but I presume it can&apos;t be hitting everyone. From grepping&lt;br/&gt;
around, this might not be the only component missing setJarByClass&lt;br/&gt;
calls. Or is this just me, somehow?&lt;/p&gt;

&lt;p&gt;2. Newlines in the input data made it fail, but the associated warning&lt;br/&gt;
from AffinityMatrixInputMapper was very vague. I&apos;d suggest allowing&lt;br/&gt;
those and #-comments, but maybe not a good idea to make per-component&lt;br/&gt;
syntax designs? Suggest also it&apos;s worth printing the problem line (see&lt;br/&gt;
patch below) when complaining.&lt;/p&gt;

&lt;p&gt;3. Failing to load the affinity matrix (surely a requirement for&lt;br/&gt;
further progress?) does not seem to halt the job, I see exceptions&lt;br/&gt;
mixed in with ongoing processing (until a later problem hits us).&lt;br/&gt;
Transcript: &lt;a href=&quot;https://gist.github.com/1200455&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gist.github.com/1200455&lt;/a&gt; ... actually it wasn&apos;t&lt;br/&gt;
clear if the newline problem was more of a warning, and other rows&lt;br/&gt;
from the input data were accepted. In which case, reporting them as&lt;br/&gt;
java.io.IOException seems a bit draconian. So maybe bits of the input&lt;br/&gt;
file were in fact loaded. It would be great to clarify what expected&lt;br/&gt;
behaviour is.&lt;/p&gt;


&lt;p&gt;4. After all that, the job still fails. Full transcript here:&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/1200428&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gist.github.com/1200428&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Excerpt: (I&apos;ve added a bit more reporting output in a few places)&lt;/p&gt;

&lt;p&gt;11/09/07 14:25:06 INFO common.VectorCache: Loading vector from:&lt;br/&gt;
specout/calculations/diagonal/part-r-00000&lt;br/&gt;
Exception in thread &quot;main&quot; java.util.NoSuchElementException&lt;br/&gt;
       at com.google.common.collect.AbstractIterator.next(AbstractIterator.java:152)&lt;br/&gt;
       at org.apache.mahout.clustering.spectral.common.VectorCache.load(VectorCache.java:121)&lt;/p&gt;

&lt;p&gt;However that file does exist in hdfs, and seqdumper seems to accept&lt;br/&gt;
it; it just seems empty:&lt;/p&gt;

&lt;p&gt;Input Path: specout/calculations/diagonal/part-r-00000&lt;br/&gt;
Key class: class org.apache.hadoop.io.NullWritable Value Class: class&lt;br/&gt;
org.apache.mahout.math.VectorWritable&lt;br/&gt;
Count: 0&lt;/p&gt;

&lt;p&gt;I&apos;ve posted an informal composite patch at&lt;br/&gt;
&lt;a href=&quot;https://raw.github.com/gist/1200439/4ad433b51e9d963cff5d500d974fa5cb6904b9c3/gistfile1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://raw.github.com/gist/1200439/4ad433b51e9d963cff5d500d974fa5cb6904b9c3/gistfile1.txt&lt;/a&gt;&lt;br/&gt;
 ... if you can confirm the above issues and a breakdown into JIRAs,&lt;br/&gt;
I&apos;ll attach cleaner patches where appropriate.&lt;/p&gt;</comment>
                            <comment id="13108386" author="srowen" created="Tue, 20 Sep 2011 07:07:10 +0100"  >&lt;p&gt;Lance, in your command line you use &quot;MAVENOPTS&quot; and not &quot;MAVEN_OPTS&quot;. Is that the issue?&lt;/p&gt;

&lt;p&gt;I think I agree with Dan&apos;s patch, but wonder how these jobs ever worked otherwise? But yes everything needs to call setJar() or setJarByClass(). AbstractJob takes care of this for almost all the M/Rs in the project; these are not using it.&lt;/p&gt;

&lt;p&gt;I think you&apos;re welcome to propose patches for your improvements #2 and #3. I don&apos;t know the answer for #4: if it&apos;s OK for there to be nothing in the vector cache at this point, the code shouldn&apos;t assume there is. And if the cache should have something I don&apos;t know why there isn&apos;t.&lt;/p&gt;</comment>
                            <comment id="13108486" author="hudson" created="Tue, 20 Sep 2011 10:52:31 +0100"  >&lt;p&gt;Integrated in Mahout-Quality #1051 (See &lt;a href=&quot;https://builds.apache.org/job/Mahout-Quality/1051/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Mahout-Quality/1051/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-524&quot; title=&quot;DisplaySpectralKMeans example fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-524&quot;&gt;&lt;del&gt;MAHOUT-524&lt;/del&gt;&lt;/a&gt; added danbri&apos;s setJarByClass() patch and logging&lt;/p&gt;

&lt;p&gt;srowen : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1172995&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1172995&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/clustering/spectral/common/AffinityMatrixInputJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/clustering/spectral/common/AffinityMatrixInputMapper.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/clustering/spectral/common/MatrixDiagonalizeJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/clustering/spectral/common/UnitVectorizerJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/clustering/spectral/common/VectorCache.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/clustering/spectral/common/VectorMatrixMultiplicationJob.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13108721" author="magsol" created="Tue, 20 Sep 2011 14:57:39 +0100"  >&lt;p&gt;Sean: #4 is actually an off-by-one error that is the result of specifying &quot;dimensions 37&quot; when they are indexed in the input file as 1-37, when the program is expecting 0-36. Changing the input parameter to &quot;dimensions 38&quot; is kind of a fix, although it will result in the first row and first column of Mahout&apos;s internal representation of the affinity matrix to be all 0s.&lt;/p&gt;

&lt;p&gt;Regarding the jobs, I have no idea how they ran previously; I never ran into that problem when first writing the jobs. Apparently there&apos;s a widely-employed use-case I simply didn&apos;t test?&lt;/p&gt;

&lt;p&gt;Beyond that, still can&apos;t find the source of the error in the attached EclipseLog; wherever that &quot;/tmp&quot; is being appended at the end, it isn&apos;t in any of the core Mahout code.&lt;/p&gt;</comment>
                            <comment id="13108739" author="srowen" created="Tue, 20 Sep 2011 15:25:04 +0100"  >&lt;p&gt;OK is there an easy fix for your first point? Seems like a matter of input parsing&lt;/p&gt;</comment>
                            <comment id="13108742" author="magsol" created="Tue, 20 Sep 2011 15:31:12 +0100"  >&lt;p&gt;The full fix is &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-518&quot; title=&quot;Implement Affinity Preprocessing for Eigencuts and Spectral KMeans&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-518&quot;&gt;&lt;del&gt;MAHOUT-518&lt;/del&gt;&lt;/a&gt; (in progress), where you no longer have to input affinity but instead raw data. I can certainly edit the affinity input for the time being, but once 518 is finished this point will be moot.&lt;/p&gt;</comment>
                            <comment id="13109295" author="lancenorskog" created="Wed, 21 Sep 2011 07:17:30 +0100"  >&lt;p&gt;Yes, it was MAVEN_OPTS; that one helps.&lt;/p&gt;

&lt;p&gt;With today&apos;s patch (Sep. 20, 2011 setting the job jars), I get (eventually) this error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
11/09/20 23:10:35 INFO mapred.JobClient: Running job: job_201109191821_0016
11/09/20 23:10:36 INFO mapred.JobClient:  map 0% reduce 0%
11/09/20 23:11:01 INFO mapred.JobClient:  map 100% reduce 0%
11/09/20 23:11:15 INFO mapred.JobClient: Task Id : attempt_201109191821_0016_r_000000_0, Status : FAILED
Shuffle Error: Exceeded MAX_FAILED_UNIQUE_FETCHES; bailing-out.
11/09/20 23:11:15 WARN mapred.JobClient: Error reading task outputHost is down
11/09/20 23:11:15 WARN mapred.JobClient: Error reading task outputHost is down
11/09/20 23:12:00 INFO mapred.JobClient: Task Id : attempt_201109191821_0016_r_000000_1, Status : FAILED
Shuffle Error: Exceeded MAX_FAILED_UNIQUE_FETCHES; bailing-out.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I stripped aff.txt down to a file with 20 nodes, and get the above error. This is on a single-node cluster on my laptop. Is it possible to run this job on such a small device? (If not, then DisplaySpectralKMeans as a Swing app might not be realistic &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="13109296" author="srowen" created="Wed, 21 Sep 2011 07:23:10 +0100"  >&lt;p&gt;That again looks like an environment issue; the reducer couldn&apos;t get data off the mapper. I don&apos;t know why in this case; you&apos;d have to dig in to logs. I&apos;d restart your cluster.&lt;/p&gt;</comment>
                            <comment id="13132104" author="jeastman" created="Thu, 20 Oct 2011 23:12:40 +0100"  >&lt;p&gt;I&apos;ve found where the /data is being added to the input path: its in SequenceFileInputFormat.listStatus(JobConf). Here is where MapFile.DATA_FILE_NAME is appended to get the dataFile path. This seems to not be the source of the problem; however, rather I&apos;m looking in DRM.times() where it calls TimesSquaredJob.createTimesJobConf(...). Looks to me like this method is setting the conf feature &quot;DistributedMatrix.times.inputVector&quot; to the correct file path (examples/output/calculations/laplacian-25/tmp/&amp;lt;ts&amp;gt;/DistributedMatrix.times.inputVector/&amp;lt;ts&amp;gt;), but is not setting the job&apos;s input paths, since FileInputFormat.getInputPaths(new JobConf(conf)) returns only &quot;examples/output/calculations/laplacian-25&quot;.&lt;/p&gt;

&lt;p&gt;By the time the thread gets to listStatus() after kicking off DRM.times(), the JobConf input paths contain only &quot;examples/output/calculations/laplacian-113/tmp&quot; and /data is appended to that.&lt;/p&gt;

&lt;p&gt;The whole handling of Configurations and JobConfs is very twisted and difficult to follow.&lt;/p&gt;</comment>
                            <comment id="13132810" author="jeastman" created="Fri, 21 Oct 2011 17:40:40 +0100"  >&lt;p&gt;All of this is buried inside of DistributedLanczosSolver. Either the problem resides in there and should impact all users of DLS or it is in the SpectralKMeansDriver setup which invokes the DLS. Turns out the DLS.runJob(...) method employed (line 65) is only called by spectral clustering (KMeans and Eigencuts). The one other caller, DLS.runJob(...) (line 80) is itself never called.&lt;/p&gt;

&lt;p&gt;Just looking at the invocation site (SpectralKMeansDriver.run() line 155, I see two file paths being passed into DLS.runJob(...): the lanczosSeqFiles path is output/calculations/eigenvectors-17, the desired output path, and the LanczosState is constructed with L, a DRM with inputPath examples/output/calculations/laplacian-89. This is the input path which is failing in getFileStatus and causing the exception. Both of these look reasonable to me.&lt;/p&gt;

&lt;p&gt;There are; however, several different Configuration objects being manipulated by SKMD. I&apos;m suspicious there is something horked in one of them which is causing the DLS file not found.&lt;/p&gt;</comment>
                            <comment id="13132867" author="danbri" created="Fri, 21 Oct 2011 18:51:31 +0100"  >&lt;p&gt;re Sean&apos;s &quot;I&apos;d restart your cluster.&quot;; should it be fine to run the whole thing in MAHOUT_LOCAL=true mode, and bypass any complexity / issues from having a separate Hadoop cluster / pseudo-cluster?&lt;/p&gt;</comment>
                            <comment id="13132870" author="jeastman" created="Fri, 21 Oct 2011 18:55:43 +0100"  >&lt;p&gt;I&apos;m running in the Eclipse debugger, debugging DisplaySpectralKMeans. This runs in local mode, and fails as reported above.&lt;/p&gt;</comment>
                            <comment id="13133524" author="magsol" created="Sun, 23 Oct 2011 01:11:27 +0100"  >&lt;p&gt;If there are two DLS.runJob() methods and the spectral code is the only bit of code that calls one of the two runJob() methods, then in the interest of making the codebase just a tiny bit more maintainable I would vote for switching out the runJob() invoked by the spectral code and deleting the other one in DLS entirely.&lt;/p&gt;

&lt;p&gt;Regarding your tracing of the DRM.times() method, I was having the same problem: the fact that there exist so many chained job constructors makes it difficult to follow. Is there any way we could simplify TimesSquaredJob? Are each of those job creation methods called multiple times throughout the code base?&lt;/p&gt;

&lt;p&gt;Regarding this issue, it sounds like the problem either resides in TimesSquared not correctly setting the path as you mentioned (but this begs the question why no other algorithm which uses DRM.times() is running into the same problem), or the Configuration voodoo in SKMD is causing problems.&lt;/p&gt;

&lt;p&gt;I&apos;ll investigate the manipulation of Configuration objects in SKMD this week. If you have any thoughts on the other points, please let me know.&lt;/p&gt;</comment>
                            <comment id="13141973" author="danbri" created="Wed, 2 Nov 2011 07:07:11 +0000"  >&lt;p&gt;Shannon, &quot;I&apos;ll investigate the manipulation of Configuration objects in SKMD&quot; ... did you get a chance to do that? &lt;/p&gt;</comment>
                            <comment id="13142461" author="gsingers" created="Wed, 2 Nov 2011 19:59:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is there any way we could simplify TimesSquaredJob&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Seems like there is an awful log of deprecated Hadoop stuff in there.&lt;/p&gt;</comment>
                            <comment id="13142477" author="gsingers" created="Wed, 2 Nov 2011 20:16:24 +0000"  >&lt;p&gt;Tracing into the Hadoop code, this &quot;data&quot; dir gets appended via a MapFile.  For some reason it thinks it has a MapFile here, so it points to something is not getting configured correctly.&lt;/p&gt;</comment>
                            <comment id="13142510" author="gsingers" created="Wed, 2 Nov 2011 20:57:18 +0000"  >&lt;p&gt;REalizing now that Jeff already said that above.  Digging deeper, however, it seems to me that the issue is Hadoop is not expecting there to be a directory (tmp) in that directory.  From the looks of it, we just want the part-m-**** file in there, but file status is also returning the tmp dir that gets created when we do:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
DistributedRowMatrix L =
        VectorMatrixMultiplicationJob.runJob(affSeqFiles, D,
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(outputCalc, &lt;span class=&quot;code-quote&quot;&gt;&quot;laplacian-&quot;&lt;/span&gt; + (&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.nanoTime() &amp;amp; 0xFF)));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;on line 142 of SpectralKMeansDriver.  I wonder if we simply put that tmp directory elsewhere, or make sure that it is deleted when that job is done and all will be well?&lt;/p&gt;

&lt;p&gt;Perhaps a red herring, testing more.&lt;/p&gt;</comment>
                            <comment id="13142530" author="gsingers" created="Wed, 2 Nov 2011 21:07:22 +0000"  >&lt;p&gt;Making this change does indeed get us well past that problem and leads to:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Exception in thread &quot;main&quot; java.lang.NullPointerException&lt;br/&gt;
	at org.apache.mahout.math.DenseVector.assign(DenseVector.java:133)&lt;br/&gt;
	at org.apache.mahout.math.decomposer.lanczos.LanczosSolver.solve(LanczosSolver.java:160)&lt;br/&gt;
	at org.apache.mahout.math.hadoop.decomposer.DistributedLanczosSolver.runJob(DistributedLanczosSolver.java:72)&lt;br/&gt;
	at org.apache.mahout.clustering.spectral.kmeans.SpectralKMeansDriver.run(SpectralKMeansDriver.java:155)&lt;br/&gt;
	at org.apache.mahout.clustering.display.DisplaySpectralKMeans.main(DisplaySpectralKMeans.java:72)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at com.intellij.rt.execution.application.AppMain.main(AppMain.java:120)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not sure if that is a direct correlation to my change or not, but continue to debug&lt;/p&gt;</comment>
                            <comment id="13142539" author="magsol" created="Wed, 2 Nov 2011 21:11:43 +0000"  >&lt;p&gt;I&apos;m just now getting in on this (my environment completely died after a failed attempt to upgrade from Ubuntu 10.04 to 10.10...). Could the NullPointerException have anything to do SKMD invoking the runJob() in the LanczosSolver that I alluded to in my previous comment, i.e. the one for which SKMD is the only caller?&lt;/p&gt;</comment>
                            <comment id="13142545" author="gsingers" created="Wed, 2 Nov 2011 21:15:54 +0000"  >&lt;p&gt;patch so far, never mind the DisplayMinHash stuff, as I forgot to clean it up&lt;/p&gt;</comment>
                            <comment id="13142557" author="gsingers" created="Wed, 2 Nov 2011 21:24:09 +0000"  >&lt;p&gt;The NPE is from one of the rowJ values being null (the 4th one).  Line 156 in Lanzcos:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; Vector rowJ = state.getBasisVector(j);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This looks like an issue in Lanzcos.  Namely, we are assuming the size of the basis vectors from the state matches the same size of the ejCol stuff.  Of course, this might mean SKMD is doing something wrong.  Perhaps Jake can weigh in here.&lt;/p&gt;</comment>
                            <comment id="13142583" author="gsingers" created="Wed, 2 Nov 2011 21:45:39 +0000"  >&lt;p&gt;in this particular case, the state has 4 basis vectors, but the &quot;size&quot; that j is being iterated over is 1100.  Someone isn&apos;t going to be happy.  I can see the easy fix (don&apos;t loop past that), but I don&apos;t know enough about Lanczos or SKMD to know whether what we are seeing is an artifact of SKMD or if this is a bug in Lanzcos.&lt;/p&gt;</comment>
                            <comment id="13142586" author="gsingers" created="Wed, 2 Nov 2011 21:47:19 +0000"  >&lt;p&gt;I guess the 1100 comes from how we are calling all of this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SpectralKMeansDriver.run(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Configuration(), affinities, output, 1100, 2, measure, convergenceDelta, maxIter);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13142588" author="gsingers" created="Wed, 2 Nov 2011 21:49:50 +0000"  >&lt;p&gt;Seems the numDims == 1100 there is supposed to be the size of the affinity matrix, which is what we have generated from the sample data, so I guess that makes sense.&lt;/p&gt;</comment>
                            <comment id="13142597" author="gsingers" created="Wed, 2 Nov 2011 21:55:34 +0000"  >&lt;p&gt;This gets past the Lanczos issue by checking the size.  __ I HAVE NO IDEA IF THIS IS VALID MATHEMATICALLY__, but it does show results!&lt;/p&gt;</comment>
                            <comment id="13142616" author="gsingers" created="Wed, 2 Nov 2011 22:09:13 +0000"  >&lt;p&gt;Of course, the results don&apos;t really speak well of SKM, but at least there are some results!&lt;/p&gt;</comment>
                            <comment id="13142620" author="magsol" created="Wed, 2 Nov 2011 22:14:59 +0000"  >&lt;p&gt;Similar results were actually what this issue was &lt;b&gt;originally&lt;/b&gt; created to solve, before code rot created the other problems. The fact that I got actual clustering results when I was testing this code two summers ago would seem to imply that it&apos;s an API issue; DisplaySKM vs SKMDriver data format clashes would be my first guess.&lt;/p&gt;

&lt;p&gt;I applied your patch but I&apos;m having trouble following where you fixed the Lanczos issue (though from within Eclipse I&apos;m getting OutOfMemory errors...).&lt;/p&gt;</comment>
                            <comment id="13142624" author="jeastman" created="Wed, 2 Nov 2011 22:18:54 +0000"  >&lt;p&gt;This result looks like the original result I got when it worked for a while. I&apos;m treating the SKMD output as though it were clusters like the other Display routines. I think this is not correct but I don&apos;t understand what is wrong.&lt;/p&gt;</comment>
                            <comment id="13142629" author="jake.mannix" created="Wed, 2 Nov 2011 22:26:57 +0000"  >&lt;p&gt;I don&apos;t really know anything about the way that SKMD works, so all I can weight in is what&apos;s going on in Lanczos:&lt;/p&gt;

&lt;p&gt;You take an input matrix with some number of rows (this number doesn&apos;t matter, doesn&apos;t show up anywhere) and numCols columns (this number matters a lot).  You want desiredRank eigenvectors to pop out in the end.  So you start with some initial basisVector (number 0), and you iterate again and again taking your input corpus.timesSquared(basisIminusOne) (resultant vector is of size numCols), do some orthogonalization against previous vectors, hang onto this vector.&lt;/p&gt;

&lt;p&gt;Eventually you have desiredRank basisVectors, arranged in the LanczosState object in a Map&amp;lt;Integer,Vector&amp;gt; (it could be a Matrix, certainly, it is, but we&apos;re just hanging onto it before building a matrix soon enough).  Meanwhile, we&apos;re building up a desiredRank x desiredRank tri-diagonal (ie very sparse) matrix using these basis vectors and their inner products.&lt;/p&gt;

&lt;p&gt;Now we ask COLT to get the eigenvectors and eigenvalues of the tridiagonal matrix, there will be desiredRank eigenvalues, and desiredRank eigenVectors (each of dimension desiredRank).&lt;/p&gt;

&lt;p&gt;Here we get to where you&apos;re getting an NPE.  We walk along the desiredRank^2 values in the eigenvector matrix (&quot;eigenVects&quot;), and for each of 0... desiredRank, we grab the basisVector (we have desiredRank of them, each of size numCols) and add a linear multiple of it onto something which will be the final eigenvector we&apos;ll return at the end of the day.&lt;/p&gt;

&lt;p&gt;What is SKMD doing?  &lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;code&amp;#93;&lt;/span&gt;&lt;br/&gt;
    LanczosState state = new LanczosState(L, overshoot, numDims, solver.getInitialVector(L));&lt;br/&gt;
    Path lanczosSeqFiles = new Path(outputCalc, &quot;eigenvectors-&quot; + (System.nanoTime() &amp;amp; 0xFF));&lt;br/&gt;
    solver.runJob(conf,&lt;br/&gt;
                  state,&lt;br/&gt;
                  overshoot,&lt;br/&gt;
                  true,&lt;br/&gt;
                  lanczosSeqFiles.toString());&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;code&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;We&apos;re making a LanczosState with specifying numCols = overshoot, desiredRank = numDims.&lt;/p&gt;

&lt;p&gt;Then we run the solver with desiredRank = overshoot.&lt;/p&gt;

&lt;p&gt;Looks like this is inconsistent, the desiredRank should be the same?&lt;/p&gt;</comment>
                            <comment id="13142633" author="gsingers" created="Wed, 2 Nov 2011 22:33:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;I applied your patch but I&apos;m having trouble following where you fixed the Lanczos issue (though from within Eclipse I&apos;m getting OutOfMemory errors...).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, up your heap to 1024M&lt;/p&gt;</comment>
                            <comment id="13142635" author="gsingers" created="Wed, 2 Nov 2011 22:36:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;I applied your patch but I&apos;m having trouble following where you fixed the Lanczos issue&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I put in a sanity check at&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; size = ejCol.size();
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; j = 0; j &amp;lt; size; j++) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;so that we don&apos;t overrun the basis vector size.  &lt;/p&gt;

&lt;p&gt;however, based on Jake&apos;s comments, I&apos;d say that is a symptom of us calling the job wrong.&lt;/p&gt;</comment>
                            <comment id="13143510" author="magsol" created="Thu, 3 Nov 2011 20:33:17 +0000"  >&lt;p&gt;After implementing the same code in Python, my suspicions are actually that the clusters of the K-means at the conclusion of the spectral algorithm are throwing off the final results shown in DisplaySKM. Regular K-means is running on the spectral data: the top k-eigenvectors of the affinities, rather than the original data. I don&apos;t know K-means well enough to know for sure, but my guess is that all the distance measurements that come back in its output format are relative to the spectral data, rather than the original data. So what you see in the end-result graph are circles around where the spectral data are.&lt;/p&gt;

&lt;p&gt;That&apos;d be my first guess, anyway. I&apos;m working on a couple things to help with this: a sequential version of spectral k-means, and a job to read raw data (text format: whitespace or comma-separated n-dimensional points) and convert it to affinities (a la issue 518, finally!). Hopefully these will help diagnose spectral k-means.&lt;/p&gt;

&lt;p&gt;But if it is a data issue, I&apos;m not sure how we can translate the distance measurements on the spectral data back onto the original data for the DisplaySKM code. I would argue, though, that since spectral k-means doesn&apos;t operate on the same GMM-type basis that regular K-means does, overlaying K gaussians isn&apos;t really what we want here, anyway. If at all possible, my suggestion would be colored dots to indicate the clusters. &lt;/p&gt;</comment>
                            <comment id="13143512" author="gsingers" created="Thu, 3 Nov 2011 20:36:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;If at all possible, my suggestion would be colored dots to indicate the clusters.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There is no requirement that we have to draw circles or leverage the old code, we just need something that works.&lt;/p&gt;</comment>
                            <comment id="13155303" author="danbri" created="Tue, 22 Nov 2011 17:58:49 +0000"  >&lt;p&gt;(hmm this issue seems something of a proxy for general code rot and problems with the spectral piece of Mahout)&lt;/p&gt;

&lt;p&gt;Where are we with this? I see &quot;a symptom of us calling the job wrong&quot;, and &quot;throwing off the final results&quot;. Is the problem purely in the displaying of spectral k-means, or something deeper e.g. if I want eigenvectors and values of laplacian re-representation of an affinity matrix, is the underlying code in a happy state?&lt;/p&gt;</comment>
                            <comment id="13155306" author="magsol" created="Tue, 22 Nov 2011 18:04:00 +0000"  >&lt;p&gt;Unknown. Still coding up a way of coloring the dots rather than drawing circles.&lt;/p&gt;</comment>
                            <comment id="13163860" author="rozemarys" created="Tue, 6 Dec 2011 21:20:38 +0000"  >&lt;p&gt;Hi! I am new to Mahout and I have been trying to use the K-means Spectral Clustering, but I ran into the problem described in the comments above: the Lancsoz solver tries to input the output of the VectorMatrixMultipliction as a &quot;calculations/laplacian-166/tmp/data&quot; file, instead of the &quot;calculations/laplacian-166/part-m-00000&quot;.&lt;br/&gt;
I was wondering if currently there is a way to a run the Spectral Clustering.&lt;/p&gt;</comment>
                            <comment id="13164713" author="kevinfindlay" created="Wed, 7 Dec 2011 21:23:53 +0000"  >&lt;p&gt;Slightly confused I have checked that the Mahout-524 patches are included in my current build of the trunk.&lt;/p&gt;

&lt;p&gt;However I still get the file not fount error &quot;tmp/data&quot; as decribed in the Subtask.&lt;/p&gt;

&lt;p&gt;Have I got the versions right?&lt;/p&gt;</comment>
                            <comment id="13164871" author="magsol" created="Thu, 8 Dec 2011 00:28:03 +0000"  >&lt;p&gt;I believe you and Rozemary need to apply the patch that is attached to this issue to get past the &quot;tmp/data&quot; error. It stems from the Lanczos solver, but is likely a symptom of being called by SKM incorrectly.&lt;/p&gt;

&lt;p&gt;I&apos;m still working on the patch for this, will hopefully be done soon...&lt;/p&gt;</comment>
                            <comment id="13176190" author="magsol" created="Tue, 27 Dec 2011 14:48:37 +0000"  >&lt;p&gt;This patch includes the contents of Grant&apos;s Nov 11 patch, which fixes the &quot;/tmp/data&quot; path error. It also adds a few methods to DisplayClustering.java to color the points according to their cluster assignments, rather than drawing ellipses around the cluster centroids. Finally, it includes minor edits of SKMD in terms of the output format.&lt;/p&gt;</comment>
                            <comment id="13176203" author="danbri" created="Tue, 27 Dec 2011 15:07:51 +0000"  >&lt;p&gt;Great to see this getting wrapped up. Can you suggest what commandline(s) and test input others might try to verify this?&lt;/p&gt;

&lt;p&gt;I have some py-generated afftest.txt left from previous investigations but forget its exact origins.&lt;/p&gt;

&lt;p&gt;I also have some real world similarity data with labeled items; how would I use those?&lt;/p&gt;</comment>
                            <comment id="13176876" author="jeastman" created="Wed, 28 Dec 2011 23:11:38 +0000"  >&lt;p&gt;Shannon, is this patch ready to commit? I&apos;ve installed it and verified that DisplaySpectralKMeans is indeed finding clusters. By increasing the numClusters from 2 to 3 it now does a credible job of finding the 3 clusters present in the generated data.&lt;/p&gt;</comment>
                            <comment id="13177385" author="hudson" created="Thu, 29 Dec 2011 20:55:26 +0000"  >&lt;p&gt;Integrated in Mahout-Quality #1279 (See &lt;a href=&quot;https://builds.apache.org/job/Mahout-Quality/1279/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Mahout-Quality/1279/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-524&quot; title=&quot;DisplaySpectralKMeans example fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-524&quot;&gt;&lt;del&gt;MAHOUT-524&lt;/del&gt;&lt;/a&gt;: committing patch since Shannon has no internet. All tests run&lt;/p&gt;

&lt;p&gt;jeastman : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1225596&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1225596&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/clustering/spectral/common/VectorMatrixMultiplicationJob.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/clustering/spectral/kmeans/SpectralKMeansDriver.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/examples/src/main/java/org/apache/mahout/clustering/display/DisplayClustering.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/examples/src/main/java/org/apache/mahout/clustering/display/DisplaySpectralKMeans.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/math/src/main/java/org/apache/mahout/math/decomposer/lanczos/LanczosSolver.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/math/src/main/java/org/apache/mahout/math/decomposer/lanczos/LanczosState.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13206256" author="danbri" created="Sat, 11 Feb 2012 20:34:54 +0000"  >&lt;p&gt;I just tried spectral k-means with some wikipedia/dbpedia data (1.0 affinities for every page and topic category URL pair in the Wiki. Data came from &lt;a href=&quot;http://downloads.dbpedia.org/3.7/en/article_categories_en.nt.bz2&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://downloads.dbpedia.org/3.7/en/article_categories_en.nt.bz2&lt;/a&gt; and is dropped in the Web at &lt;a href=&quot;http://danbri.org/2012/spectral/dbpedia/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://danbri.org/2012/spectral/dbpedia/&lt;/a&gt; (I posted .csv plus an int-to-URL dictionary file).&lt;/p&gt;

&lt;p&gt;My best guess at commandline (running this w/ today&apos;s trunk + a fresh 0.20.203.0 hadoop pseudo-cluster) was this:&lt;/p&gt;

&lt;p&gt;mahout spectralkmeans -i wiki/ -o output1 -k 20 -d 4192499 --maxIter 10    (where hdfs wiki/ subdir contains the .csv data file)&lt;/p&gt;

&lt;p&gt;Unfortunately I&apos;m hitting one of the various problems discussed above. If anyone else can reproduce this, perhaps a fresh JIRA is needed.&lt;/p&gt;

&lt;p&gt;It gets stuck after the first job, with an essentially empty seqfile. Full transcript here: &lt;a href=&quot;https://gist.github.com/1804016&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gist.github.com/1804016&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(checked with &quot;mahout seqdumper --seqFile output1/calculations/diagonal/part-r-00000&quot;)&lt;/p&gt;

&lt;p&gt;This is essentially the same experience I had back in Sept (see above) running a similar test. &lt;/p&gt;</comment>
                            <comment id="13206416" author="danbri" created="Sun, 12 Feb 2012 13:55:02 +0000"  >&lt;p&gt;Shannon informs me I&apos;m getting this error because node IDs must be counted from zero. I&apos;ve updated the wiki to say this more explicitly. So this JIRA can stay closed, phew.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12502050" name="ASF.LICENSE.NOT.GRANTED--screenshot-1.jpg" size="47458" author="gsingers" created="Wed, 2 Nov 2011 22:09:13 +0000"/>
                            <attachment id="12495016" name="EclipseLog_20110918.txt" size="14178" author="lancenorskog" created="Mon, 19 Sep 2011 06:50:20 +0100"/>
                            <attachment id="12508680" name="MAHOUT-524.patch" size="12972" author="magsol" created="Tue, 27 Dec 2011 14:48:37 +0000"/>
                            <attachment id="12502048" name="MAHOUT-524.patch" size="5057" author="gsingers" created="Wed, 2 Nov 2011 21:55:34 +0000"/>
                            <attachment id="12502041" name="MAHOUT-524.patch" size="9163" author="gsingers" created="Wed, 2 Nov 2011 21:15:54 +0000"/>
                            <attachment id="12495183" name="SpectralKMeans_fail_20110919.txt" size="6235" author="lancenorskog" created="Tue, 20 Sep 2011 03:05:08 +0100"/>
                            <attachment id="12468658" name="aff.txt" size="2491312" author="magsol" created="Tue, 18 Jan 2011 17:27:21 +0000"/>
                            <attachment id="12468659" name="raw.txt" size="13958" author="magsol" created="Tue, 18 Jan 2011 17:27:22 +0000"/>
                            <attachment id="12468940" name="spectralkmeans.png" size="44213" author="magsol" created="Fri, 21 Jan 2011 02:26:03 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12508360">MAHOUT-712</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 12 Oct 2010 15:00:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9538</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy4l3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22894</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>