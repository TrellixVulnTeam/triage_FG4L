<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:18:08 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-945/MAHOUT-945.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-945] The variance calculation of Random forest regression tree</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-945</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;Hi, Mukai&lt;br/&gt;
  Thanks for your efforts in expand the RF to regression. However, I have a doubt about your implementation regarding to Regressionsplit.java. The variance method &lt;br/&gt;
&quot;&lt;br/&gt;
 private static double variance(double[] s, double[] ss, double[] dataSize) {&lt;br/&gt;
    double var = 0;&lt;br/&gt;
    for (int i = 0; i &amp;lt; s.length; i++) {&lt;br/&gt;
      if (dataSize&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; &amp;gt; 0) &lt;/p&gt;
{
        var += ss[i] - ((s[i] * s[i]) / dataSize[i]);
      }
&lt;p&gt;    }&lt;br/&gt;
    return var;&lt;br/&gt;
  }&lt;br/&gt;
&quot;&lt;/p&gt;

&lt;p&gt;While the variance in my mind should be something like &lt;br/&gt;
var += ss&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;/dataSize&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; - ((s&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; * s&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;) / (dataSize&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;*dataSize&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;));&lt;/p&gt;

&lt;p&gt;Please help correct me if I am wrong. Thanks&lt;/p&gt;</description>
                <environment></environment>
        <key id="12538041">MAHOUT-945</key>
            <summary>The variance calculation of Random forest regression tree</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean Owen</assignee>
                                    <reporter username="fayue1015">Wang Yue</reporter>
                        <labels>
                            <label>Regressionsplit.java</label>
                    </labels>
                <created>Wed, 11 Jan 2012 12:00:07 +0000</created>
                <updated>Mon, 3 Feb 2014 08:06:09 +0000</updated>
                            <resolved>Tue, 12 Mar 2013 23:14:32 +0000</resolved>
                                    <version>0.6</version>
                                    <fixVersion>0.8</fixVersion>
                                    <component>Classification</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                    <timeoriginalestimate seconds="172800">48h</timeoriginalestimate>
                            <timeestimate seconds="172800">48h</timeestimate>
                                        <comments>
                            <comment id="13186174" author="ikumasa mukai" created="Sat, 14 Jan 2012 11:59:05 +0000"  >&lt;p&gt;At Ted-san&apos;s suggestion on &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-943&quot; title=&quot;Improbe the way to make the split point on DF.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-943&quot;&gt;&lt;del&gt;MAHOUT-943&lt;/del&gt;&lt;/a&gt;,&lt;br/&gt;
I made a patch for using Welford&apos;s method to calc the variances.&lt;/p&gt;</comment>
                            <comment id="13186184" author="srowen" created="Sat, 14 Jan 2012 12:15:47 +0000"  >&lt;p&gt;That&apos;s good, but the new implementation just duplicates two other implementations of Welford&apos;s method in the code base. Can we not just use RunningAverageAndStdDev?&lt;/p&gt;</comment>
                            <comment id="13186196" author="ikumasa mukai" created="Sat, 14 Jan 2012 13:03:58 +0000"  >&lt;p&gt;Appreciate your quick checking.&lt;/p&gt;

&lt;p&gt;Of cause I checked RunningAverageAndStdDev according your advice and I found we could use.&lt;/p&gt;

&lt;p&gt;But for reducing the time consumption to calc the standard deviation, I didn&apos;t use.(for our regression logic, variance is only needed.)&lt;/p&gt;

&lt;p&gt;How do you feel about it?&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;</comment>
                            <comment id="13186485" author="fayue1015" created="Sun, 15 Jan 2012 11:59:32 +0000"  >&lt;p&gt;Hi, Ikumaso Mukai,&lt;br/&gt;
  Thanks for your improvement, I realize that you actually implement the new online version of variance calculation according to &lt;a href=&quot;http://en.wikipedia.org/wiki/Algorithms_for_calculating_variance&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://en.wikipedia.org/wiki/Algorithms_for_calculating_variance&lt;/a&gt;, however, the problem I indicate still exists, that is, the final variance should divide by n(which is sample size.) So, I would suggest to modify the third last line of following code, do you think so?&lt;/p&gt;

&lt;p&gt;+  /**&lt;br/&gt;
+   * Calculator for variance calculation&lt;br/&gt;
+   */&lt;br/&gt;
+  private static class VarianceCalculator {&lt;br/&gt;
+&lt;br/&gt;
+    private int n;&lt;br/&gt;
+    private double mean;&lt;br/&gt;
+    private double var;&lt;br/&gt;
+    &lt;br/&gt;
+    void add(double value) &lt;/p&gt;
{
+      n++;
+      double oldMean = mean;
+      mean += (value - mean) / n;
+      double diff = (value - mean) * (value - oldMean);
+      var += diff;
+    }
&lt;p&gt;+&lt;br/&gt;
+    double getVariance() &lt;/p&gt;
{
+      return var/n;   //// suggested by Wang Yue

+    }
&lt;p&gt;+  } &lt;/p&gt;</comment>
                            <comment id="13186881" author="ikumasa mukai" created="Mon, 16 Jan 2012 11:48:14 +0000"  >&lt;p&gt;Hi wang-san.&lt;br/&gt;
Thank you for your comment and sorry for not replying your point.&lt;/p&gt;

&lt;p&gt;But, for just building trees, I think it is better not to divide by &quot;n&quot;.&lt;br/&gt;
Because it (dividing by &quot;n&quot;) will produce rounding errors when calculating the gains&lt;br/&gt;
and this does not change the logic. &lt;/p&gt;

&lt;p&gt;It is grest if you check this.&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;</comment>
                            <comment id="13187050" author="fayue1015" created="Mon, 16 Jan 2012 18:01:49 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I would still doubt the correctness of not dividing by n because of round error. &lt;/p&gt;

&lt;p&gt;Please correct me if I am wrong.&lt;/p&gt;

&lt;p&gt;Below is a counter example.&lt;/p&gt;

&lt;p&gt;Here is how I illustrate &lt;/p&gt;

&lt;p&gt;generate 110 numbers, with two groups &lt;br/&gt;
first group with 10 numbers &lt;br/&gt;
t1=rnorm(10,1,1)&lt;br/&gt;
&amp;gt; var(t1)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; 1.667472&lt;/p&gt;

&lt;p&gt;second group 100 numbers.&lt;br/&gt;
t2=rnorm(100,1,0.5)&lt;br/&gt;
&amp;gt; var(t2)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; 0.1928758&lt;/p&gt;

&lt;p&gt;The overall variance 110 numbers&lt;br/&gt;
&amp;gt; t=c(t1,t2)&lt;br/&gt;
&amp;gt; var(t)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; 0.2339202&lt;/p&gt;

&lt;p&gt;Above split represent first way of split the 110 numbers.&lt;/p&gt;

&lt;p&gt;one group with 10,  variance 1.66  your calculated variance is 16.6&lt;br/&gt;
second group with 100, variance 0.19. your calculated variance is 19&lt;br/&gt;
overall variance 0.233 your calculated variance is  25.63    &lt;/p&gt;

&lt;p&gt;your calculated variance  reduced = 25.63-(16.6+19) = ~10&lt;br/&gt;
real variance reduced is 0.233-(1.66+0.19) = -1.62&lt;/p&gt;

&lt;p&gt;Second split &lt;br/&gt;
&amp;gt; tt2=t2&lt;span class=&quot;error&quot;&gt;&amp;#91;1:10&amp;#93;&lt;/span&gt;&lt;br/&gt;
&amp;gt; var(tt2)&lt;br/&gt;
0.1673325&lt;br/&gt;
&amp;gt; tt1=c(t2&lt;span class=&quot;error&quot;&gt;&amp;#91;11:100&amp;#93;&lt;/span&gt;,t1)&lt;br/&gt;
&amp;gt; var(tt1)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; 0.3757684&lt;/p&gt;

&lt;p&gt;one group with 10,  variance 0.167  your calculated variance is 1.67&lt;br/&gt;
second group with 100, variance 0.375. your calculated variance is  37.5&lt;br/&gt;
overall variance  0.233  your calculated variance is  25.63&lt;/p&gt;

&lt;p&gt;your calculated variance reduced  = 25.63-(1.67+37.5) = -13&lt;br/&gt;
0.233-(0.167+0.375) = -~0.3x&lt;/p&gt;

&lt;p&gt;your program will choose the first split while the real split may be second split.&lt;/p&gt;
</comment>
                            <comment id="13187883" author="ikumasa mukai" created="Tue, 17 Jan 2012 18:58:14 +0000"  >&lt;p&gt;Hi wang-san.&lt;br/&gt;
Thank you for your detailed explanation.&lt;/p&gt;

&lt;p&gt;It is the point that we must use the weighted average, right?&lt;/p&gt;

&lt;p&gt;If I stick to use the total values for calc on your example,&lt;br/&gt;
the 1st split should be calced like 25.63-(16.6*11+19*1.1) and &lt;br/&gt;
the 2nd split should be 25.63-(1.67*11+37.5*1.1).&lt;/p&gt;

&lt;p&gt;Could I catch your suggestion?&lt;/p&gt;</comment>
                            <comment id="13187920" author="fayue1015" created="Tue, 17 Jan 2012 19:28:15 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
   Partly Yes, I would say my point is that when we calculate the variance, we should divide the size &quot;n&quot;, otherwise, it will cause errors.&lt;br/&gt;
   When I ask why you did not divide the size n, your answer is that it will cause rounding error. &lt;br/&gt;
   I would say this is not very sound. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;   If you stick to use the total values or your original code, then calculation for the first split is 25.63-(1.67+37.5) = -13&lt;br/&gt;
   How do I get this formula?&lt;br/&gt;
   Recall that your original code did not divide the size n(here is 110.) so your code will obtain the total variance  as 25.63, first group variance is 1.67, second group variance is 37.5 while real variance is 25.63/110 = 0.233. 1.67/10=0.167, 37.5/100=0.375&lt;br/&gt;
   Hope this clarifies.&lt;/p&gt;
</comment>
                            <comment id="13190903" author="ikumasa mukai" created="Mon, 23 Jan 2012 06:54:26 +0000"  >&lt;p&gt;Hi&lt;br/&gt;
I made a new patch which has the Wang-san&apos;s point. Thank you Wang-san.&lt;/p&gt;

&lt;p&gt;On this, I adopt using FullRunningAverageAndStdDev instead of the own code for calculating the variances.&lt;/p&gt;

&lt;p&gt;And for the performance, this patch has the modification on FullRunningAverageAndStdDev.&lt;/p&gt;

&lt;p&gt;It is nice if you would check whether the modification is acceptable.&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;</comment>
                            <comment id="13201399" author="fayue1015" created="Mon, 6 Feb 2012 17:01:58 +0000"  >&lt;p&gt;Hi, Mukai&lt;br/&gt;
  Thanks for your efforts. I feel it is ok for your modification. I have a&lt;br/&gt;
question about the decision tree building.&lt;br/&gt;
  Do you know the meaning of  option &quot;complementary&quot; using mahout to build&lt;br/&gt;
the random forest?&lt;/p&gt;

&lt;p&gt;On Mon, Jan 23, 2012 at 6:55 AM, Ikumasa Mukai (Updated) (JIRA) &amp;lt;&lt;/p&gt;



&lt;p&gt;&amp;#8211; &lt;br/&gt;
Regards, Wang Yue&lt;br/&gt;
PhD Starts From 08 Fall&lt;br/&gt;
NUS  Graduate School for Integrative Sciences and Engineering, NUS&lt;br/&gt;
Email: wangyue@nus.edu.sg&lt;br/&gt;
Homepage: &lt;a href=&quot;https://sites.google.com/site/fayue1015/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://sites.google.com/site/fayue1015/&lt;/a&gt;&lt;br/&gt;
HP:    +65 81022515&lt;/p&gt;</comment>
                            <comment id="13202236" author="ikumasa mukai" created="Tue, 7 Feb 2012 11:17:52 +0000"  >&lt;p&gt;Hi Wang-san.&lt;br/&gt;
Thank you for your checking.&lt;/p&gt;

&lt;p&gt;I think my patch will be committed if the modification on FullRunningAverageAndStdDev can be accepted.&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;</comment>
                            <comment id="13284596" author="ikumasa mukai" created="Tue, 29 May 2012 02:32:44 +0100"  >&lt;p&gt;I have checked the latest patch can be applied to revision 1235053.&lt;/p&gt;</comment>
                            <comment id="13399411" author="srowen" created="Fri, 22 Jun 2012 17:12:25 +0100"  >&lt;p&gt;I can take this up. I don&apos;t understand the need for the change in FullRunningAverageAndStdDev. If you don&apos;t want to calculate stdev, use FullRunningAverage.&lt;/p&gt;</comment>
                            <comment id="13405805" author="ikumasa mukai" created="Tue, 3 Jul 2012 12:11:18 +0100"  >&lt;p&gt;Thank you for your checking.&lt;br/&gt;
OK. I had checked both methods and could understand the same result could be calced.&lt;br/&gt;
I will attach a new patch using FullRunningAverage on this issue.&lt;/p&gt;</comment>
                            <comment id="13408937" author="ikumasa mukai" created="Sun, 8 Jul 2012 16:06:52 +0100"  >&lt;p&gt;I&apos;ve made a new patch using FullRunningAverage with new test case.&lt;/p&gt;</comment>
                            <comment id="13600677" author="hudson" created="Wed, 13 Mar 2013 00:54:32 +0000"  >&lt;p&gt;Integrated in Mahout-Quality #1902 (See &lt;a href=&quot;https://builds.apache.org/job/Mahout-Quality/1902/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Mahout-Quality/1902/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-945&quot; title=&quot;The variance calculation of Random forest regression tree&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-945&quot;&gt;&lt;del&gt;MAHOUT-945&lt;/del&gt;&lt;/a&gt; improve regression calculation for regression DF split (Revision 1455749)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
srowen : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1455749&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1455749&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/classifier/df/split/RegressionSplit.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/test/java/org/apache/mahout/classifier/df/split/RegressionSplitTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12537358">MAHOUT-943</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12535571" name="MAHOUT-945.patch" size="11964" author="ikumasa mukai" created="Sun, 8 Jul 2012 16:06:52 +0100"/>
                            <attachment id="12511476" name="MAHOUT-945.patch" size="12651" author="ikumasa mukai" created="Mon, 23 Jan 2012 06:54:26 +0000"/>
                            <attachment id="12510574" name="MAHOUT-945.patch" size="9708" author="ikumasa mukai" created="Sat, 14 Jan 2012 11:59:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 14 Jan 2012 11:59:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>223547</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy207:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22476</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>