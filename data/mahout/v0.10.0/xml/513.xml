<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:19:59 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-513/MAHOUT-513.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-513] ClusterEvaluator inter-cluster density returns NaN</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-513</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;Hi Jeff,&lt;/p&gt;

&lt;p&gt;I&apos;ve been trying out the ClusterEvaluator class today since your recent changes, and I&apos;m running into a problem whereby the average intra-cluster density can be set to NaN. Looking into it, it seems to happen for clusters containing points which are very close to the centroid.  For example, I have a cluster with:&lt;/p&gt;

&lt;p&gt;Centroid:&lt;/p&gt;

{0:0.6075199543688895,1:-0.3165058387409551,2:0.2027106147825682,3:-21.246338574215706,4:-5.875047828899212,5:-0.9835694086952028,6:0.2794019939470805,7:-0.36402079609289717,8:0.5201946127074457,9:-0.47084217746293855,10:-0.14380397719670499,11:-0.10441028152861193,12:0.0698485086335405,13:0.014286758874801297}

&lt;p&gt;and one of the representative points (3 per cluster):&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0.6075199543688894, -0.31650583874095506, 0.2027106147825682, -21.2463385742157, -5.875047828899212, -0.9835694086952026, 0.27940199394708054, -0.36402079609289706, 0.5201946127074457, -0.47084217746293855, -0.14380397719670499, -0.10441028152861194, 0.06984850863354047, 0.014286758874801297&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;As far as I can tell from debugging, the representative points look identical to the centroid of this cluster, but I&apos;m assuming there&apos;s some small difference as &quot;if (!vector.equals(clusterI.getCenter()))&quot; in ClusterEvaluator.invalidCluster() is always returning false for these points, and so the cluster isn&apos;t pruned from the list.&lt;/p&gt;

&lt;p&gt;Later on, in ClusterEvaluator.intraClusterDensity(), the &quot;min&quot; and &quot;max&quot; distances are ending up with the same value, and the density from &quot;double density = (sum / count - min) / (max - min);&quot; is calculated as NaN, e.g. here are the values I&apos;m getting:&lt;/p&gt;

&lt;p&gt;min = max = 1.5397509610616733E-7&lt;br/&gt;
count = 3&lt;br/&gt;
sum = 4.61925288318502E-7&lt;br/&gt;
max - min: 0.0&lt;br/&gt;
count - min: 2.9999998460249038&lt;br/&gt;
(sum / count - min) = 0.0&lt;/p&gt;

&lt;p&gt;This then causes avgDensity to be calculated as NaN. I&apos;m not sure what the solution is here, should invalidCluster() check that the the difference between the centroid and the candidate representative point is greater than a certain threshold, which would cause such a cluster to be pruned? Or is the fix in the intraClusterDensity() calculation to handle the case where min = max?&lt;/p&gt;

&lt;p&gt;BTW would you prefer that I create a Jira to record these issues, or is it okay to send them to the dev list as I&apos;ve been doing?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Derek&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12475310">MAHOUT-513</key>
            <summary>ClusterEvaluator inter-cluster density returns NaN</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jeastman">Jeff Eastman</assignee>
                                    <reporter username="jeastman">Jeff Eastman</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Sep 2010 16:20:40 +0100</created>
                <updated>Sun, 31 Oct 2010 15:50:32 +0000</updated>
                            <resolved>Thu, 30 Sep 2010 15:54:04 +0100</resolved>
                                    <version>0.3</version>
                                    <fixVersion>0.4</fixVersion>
                                    <component>Clustering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12915786" author="jeastman" created="Tue, 28 Sep 2010 16:29:55 +0100"  >&lt;p&gt;Hi Derek,&lt;/p&gt;

&lt;p&gt;Thanks for your help on this new (experimental) code! If a particular cluster actually has no points assigned to it by one of the clustering jobs, then the centroid of the cluster will be repeated n times in its representative points and the (max-min) will fail as you note. Dirichlet does this quite often, as there are usually more models allocated than receive points in an iteration. The invalidCluster method is attempting to detect this degenerate situation and remove all clusters that would mess up the calculations.&lt;/p&gt;

&lt;p&gt;In your situation, I gather your representative points are so close to the centroid that (max-min) becomes zero while the centroid vector equality test returns false because there is still some small difference. My hunch is that these clusters need to be pruned too, and adding an epsilon test to invalidCluster would be the right choice. Otherwise, one would have to return a very large number for the normalized density of that cluster and it would radically skew the intra-cluster density average. OTOH, if your clusters really do have distinct representative points you might want a very large intra-cluster density. I&apos;m open to suggestions here. NaN is clearly not helpful.&lt;/p&gt;

&lt;p&gt;Is this a text-clustering problem you are working?&lt;/p&gt;</comment>
                            <comment id="12915814" author="derekocallaghan" created="Tue, 28 Sep 2010 17:24:30 +0100"  >&lt;p&gt;Hi Jeff,&lt;/p&gt;

&lt;p&gt;In this case it appears that there are ~20 points in the cluster, and they&apos;re all almost identical to each other. It&apos;s a text-clustering problem, using reduced dimensionality, and these original 20 points have almost identical terms. I&apos;m not sure either what the solution is, this is an acceptable cluster which so happens to be quite dense, so it&apos;d be good to see this in the results. Having said that, the average density will then be skewed as you say, as the remaining clusters in this case are nowhere near as dense. I need to think about it a bit more.&lt;/p&gt;

&lt;p&gt;I&apos;m also getting a couple of strange values in the CDbwEvaluator, I suspect it could be a similar issue but I haven&apos;t had a chance to confirm it yet.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Derek&lt;/p&gt;</comment>
                            <comment id="12915895" author="hudson" created="Tue, 28 Sep 2010 20:54:11 +0100"  >&lt;p&gt;Integrated in Mahout-Quality #344 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Mahout-Quality/344/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/Mahout-Quality/344/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-513&quot; title=&quot;ClusterEvaluator inter-cluster density returns NaN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-513&quot;&gt;&lt;del&gt;MAHOUT-513&lt;/del&gt;&lt;/a&gt;: Added a sequential version of representativePoints extraction. Changed other tests to use it. All tests run&lt;/p&gt;</comment>
                            <comment id="12915982" author="hudson" created="Wed, 29 Sep 2010 01:37:02 +0100"  >&lt;p&gt;Integrated in Mahout-Quality #346 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Mahout-Quality/346/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/Mahout-Quality/346/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-513&quot; title=&quot;ClusterEvaluator inter-cluster density returns NaN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-513&quot;&gt;&lt;del&gt;MAHOUT-513&lt;/del&gt;&lt;/a&gt;: Reviewed calculations from paper in detail, making some changes that seemed needed. All tests run but I&apos;m still not very confident in the computed numbers&lt;/p&gt;</comment>
                            <comment id="12916216" author="hudson" created="Wed, 29 Sep 2010 18:56:09 +0100"  >&lt;p&gt;Integrated in Mahout-Quality #347 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Mahout-Quality/347/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/Mahout-Quality/347/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-513&quot; title=&quot;ClusterEvaluator inter-cluster density returns NaN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-513&quot;&gt;&lt;del&gt;MAHOUT-513&lt;/del&gt;&lt;/a&gt;: hopefully fixed weighting of vectors by adding weightedX&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-513&quot; title=&quot;ClusterEvaluator inter-cluster density returns NaN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-513&quot;&gt;&lt;del&gt;MAHOUT-513&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Created interface GaussianAccumulator and two concrete implementations:&lt;/li&gt;
	&lt;li&gt;RunningSumsGaussianAccumulator uses running sums approach&lt;/li&gt;
	&lt;li&gt;OnlineGaussianAccumulator uses Knuth (Welford) approach&lt;/li&gt;
	&lt;li&gt;Added unit test thereof which produces significant std deviations and drastically-odd&lt;br/&gt;
  variances. I&apos;m committing this so it can get more eyeballs. It is not used anywhere yet.&lt;/li&gt;
	&lt;li&gt;Refactored CDbwClusterEvaluator to use RunningSumsGaussianAccumulator and&lt;br/&gt;
  existing tests continue to run&lt;/li&gt;
	&lt;li&gt;Cleaned up logging in various clustering algorithms to increase use of debug vs. info&lt;br/&gt;
  to reduce log clutter&lt;br/&gt;
All tests run.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12916237" author="hudson" created="Wed, 29 Sep 2010 19:55:22 +0100"  >&lt;p&gt;Integrated in Mahout-Quality #348 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Mahout-Quality/348/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/Mahout-Quality/348/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-513&quot; title=&quot;ClusterEvaluator inter-cluster density returns NaN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-513&quot;&gt;&lt;del&gt;MAHOUT-513&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;removed weighting from GaussianAccumulator.observe(). It&apos;s not needed for&lt;br/&gt;
CDbw and is problematic in the OnlineGaussianAccumulator.  Tests all run.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-513&quot; title=&quot;ClusterEvaluator inter-cluster density returns NaN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-513&quot;&gt;&lt;del&gt;MAHOUT-513&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;fixed bug in OnlineGaussianAccumulator.getStd()&lt;/li&gt;
	&lt;li&gt;added test of variance&lt;br/&gt;
all tests now run, though std/variance results are different than with RunningSums&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12916497" author="jeastman" created="Thu, 30 Sep 2010 15:54:04 +0100"  >&lt;p&gt;Replacing the standard deviation computation and some other algorithm changes seem to have resolved this issue. Marking Fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 28 Sep 2010 16:24:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9550</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy4nj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22905</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>