<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:16:02 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-1083/MAHOUT-1083.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-1083] CIReducer in kmeans doesn&apos;t work well</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-1083</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;the function &quot;reduce&quot; in mahout-0.7-kmeans-CIReducer.java doesn&apos;t work well as it looks like.&lt;/p&gt;

&lt;p&gt;  protected void reduce(IntWritable key, Iterable&amp;lt;ClusterWritable&amp;gt; values, Context context) throws IOException,&lt;br/&gt;
      InterruptedException {&lt;br/&gt;
    Iterator&amp;lt;ClusterWritable&amp;gt; iter = values.iterator();&lt;br/&gt;
    ClusterWritable first = null;&lt;br/&gt;
    while (iter.hasNext()) {&lt;br/&gt;
      ClusterWritable cw = iter.next();&lt;br/&gt;
      if (first == null) &lt;/p&gt;
{
        first = cw;
      }
&lt;p&gt; else &lt;/p&gt;
{
        first.getValue().observe(cw.getValue());
      }
&lt;p&gt;    }&lt;br/&gt;
    List&amp;lt;Cluster&amp;gt; models = new ArrayList&amp;lt;Cluster&amp;gt;();&lt;br/&gt;
    models.add(first.getValue());&lt;br/&gt;
    classifier = new ClusterClassifier(models, policy);&lt;br/&gt;
    classifier.close();&lt;br/&gt;
    context.write(key, first);&lt;br/&gt;
  }&lt;/p&gt;




&lt;p&gt;Apparently&#65292; the variable &quot;first&quot; will collect all output data of maps. Actually but, the value of &quot;first&quot; will change after the code &quot;ClusterWritable cw = iter.next();&quot;, same with this new variable &quot;cw&quot;! I don&apos;t why but running result shows that the code runs looks like this:&quot;ClusterWritable cw = first = iter.next();&quot;.&lt;br/&gt;
is &quot;cw&quot; a reference a to &quot;iter&quot;?&lt;br/&gt;
is &quot;iter.next&quot; just change the value of &quot;iter&quot; itself to the next?&lt;/p&gt;</description>
                <environment>&lt;p&gt;hadoop-2.0.0-alpha: pseudo cluster and single node cluster    hadoop-1.0.3: pseudo cluster    hadoop-0.20.2:pseudo cluster mahout:    mahout-0.7 os:    ubuntu 11.04 jdk:    jdk1.6.0_27&lt;/p&gt;</environment>
        <key id="12609332">MAHOUT-1083</key>
            <summary>CIReducer in kmeans doesn&apos;t work well</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="liutengfei">liutengfei</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Sep 2012 02:19:16 +0100</created>
                <updated>Mon, 3 Feb 2014 08:06:07 +0000</updated>
                            <resolved>Fri, 28 Sep 2012 10:38:46 +0100</resolved>
                                    <version>0.7</version>
                                    <fixVersion>0.8</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13465044" author="jeastman" created="Thu, 27 Sep 2012 21:23:30 +0100"  >&lt;p&gt;Oh Yikes! This is another example of the Hadoop platform reusing a single instance of the Writable every time another one is read from the input stream. Every time iter.next() is called, the same object (cw == first) will be returned. This does not show up in unit tests because only a single reducer is ever used. It explains exactly the odd clustering behavior you have observed.&lt;/p&gt;

&lt;p&gt;Here&apos;s a patch that &lt;b&gt;may&lt;/b&gt; fix the problem. I believe that ClusterWritable will create a new instance for its value instVar even if the same ClusterWritable is used.&lt;/p&gt;

&lt;p&gt;Please try this and see if it resolves the issue.&lt;/p&gt;</comment>
                            <comment id="13465496" author="liutengfei" created="Fri, 28 Sep 2012 10:38:30 +0100"  >&lt;p&gt;it works, thanks a lot.&lt;/p&gt;</comment>
                            <comment id="13466137" author="hudson" created="Sat, 29 Sep 2012 08:03:00 +0100"  >&lt;p&gt;Integrated in Mahout-Quality #1678 (See &lt;a href=&quot;https://builds.apache.org/job/Mahout-Quality/1678/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Mahout-Quality/1678/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-1083&quot; title=&quot;CIReducer in kmeans doesn&amp;#39;t work well&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-1083&quot;&gt;&lt;del&gt;MAHOUT-1083&lt;/del&gt;&lt;/a&gt;: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;committed patch to CIReducer that was producing odd results&lt;/li&gt;
	&lt;li&gt;changed test count from 3 to 4 to cause mean shift test to pass&lt;/li&gt;
	&lt;li&gt;all tests now run again (Revision 1391752)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
jeastman : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1391752&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1391752&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/clustering/iterator/CIReducer.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/clustering/iterator/ClusterWritable.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/test/java/org/apache/mahout/clustering/meanshift/TestMeanShift.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12546897" name="MAHOUT-1083.patch" size="1818" author="jeastman" created="Thu, 27 Sep 2012 21:23:30 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 27 Sep 2012 20:23:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242138</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxwdjz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12683</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>