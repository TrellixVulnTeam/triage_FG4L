<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:27:08 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-1417/MAHOUT-1417.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-1417] Random decision forest implementation fails in Hadoop 2</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-1417</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;We&apos;ve observed two errors in the RDF implementation, one of which stops it from working on Hadoop 2 (at least I think it is Hadoop 2 only), and one of which just makes the workload quite imbalanced.&lt;/p&gt;

&lt;p&gt;A key piece of logic in PartialBuilder.java queries mapred.map.tasks to know the total number of mappers. However this has never been guaranteed to be set to the number of mappers; it is how a caller sets a default number of mappers, which may be overridden by Hadoop, and which defaults to 1. &lt;/p&gt;

&lt;p&gt;I suspect that this may have actually been set, in some or all cases, to the number of mappers in Hadoop 1, but I am not sure. Certainly, sometimes it will happen to be set to a value that equals the number of mappers used.&lt;/p&gt;

&lt;p&gt;But when it doesn&apos;t it causes the distribution of trees to mappers to be quite wrong. For example, with 20 trees and 8 mappers in one example, I find that mapred.map.tasks=1. Logging messages indicate that mapper 0 handles all trees (0-19), mapper 1 handles non-existent 20-39, etc.&lt;/p&gt;

&lt;p&gt;The result is that most mappers do nothing and one does everything. This results in empty part-m-xxxxx files. And, that in turn fails the job. (This part I also suspect is new, or situation-specific, behavior in Hadoop 2. In any event, this code should never have idle mappers and fixing that avoids whatever is going on there.)&lt;/p&gt;

&lt;p&gt;There&apos;s a second less serious issue in how trees are assigned to mappers. When the number of trees is not a multiple of the number of mappers, the remainer is assigned entirely to mapper 0. So with 20 trees and 8 mappers, all mappers build 2 trees, but mapper 0 builds 6. This is unnecessarily imbalanced.&lt;/p&gt;

&lt;p&gt;Patch coming once I can verify the fix, but current proposal is to:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Compute the number of maps ahead of time using TextInputFormat and set mapred.map.tasks&lt;/li&gt;
	&lt;li&gt;Fix the method that computes trees per mapper to spread as evenly as possible (i.e. all mappers build either N or N+1 trees)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;CDH 4.5.0.1 + Mahout 0.7+patches&lt;/p&gt;</environment>
        <key id="12694942">MAHOUT-1417</key>
            <summary>Random decision forest implementation fails in Hadoop 2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="srowen">Sean Owen</reporter>
                        <labels>
                            <label>classifier</label>
                            <label>random-decision-forests</label>
                            <label>rdf</label>
                    </labels>
                <created>Thu, 13 Feb 2014 08:37:12 +0000</created>
                <updated>Mon, 13 Apr 2015 11:19:55 +0100</updated>
                            <resolved>Sun, 16 Feb 2014 05:58:50 +0000</resolved>
                                    <version>0.7</version>
                    <version>0.8</version>
                    <version>0.9</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>Classification</component>
                        <due>Fri, 21 Feb 2014 00:00:00 +0000</due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="13900826" author="srowen" created="Thu, 13 Feb 2014 22:44:26 +0000"  >&lt;p&gt;Patch attached shortly.&lt;/p&gt;

&lt;p&gt;I also found that the mapper can time out while building forests, so, added a call to progress() between each tree.&lt;/p&gt;</comment>
                            <comment id="13902643" author="smarthi" created="Sun, 16 Feb 2014 05:58:50 +0000"  >&lt;p&gt;Patch committed to trunk.&lt;/p&gt;</comment>
                            <comment id="13902646" author="hudson" created="Sun, 16 Feb 2014 06:25:24 +0000"  >&lt;p&gt;FAILURE: Integrated in Mahout-Quality #2477 (See &lt;a href=&quot;https://builds.apache.org/job/Mahout-Quality/2477/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Mahout-Quality/2477/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-1417&quot; title=&quot;Random decision forest implementation fails in Hadoop 2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-1417&quot;&gt;&lt;del&gt;MAHOUT-1417&lt;/del&gt;&lt;/a&gt;: Random decision forest implementation fails in Hadoop 2 (smarthi: rev 1568726)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/mahout/trunk/CHANGELOG&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/classifier/df/mapreduce/partial/PartialBuilder.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/classifier/df/mapreduce/partial/Step1Mapper.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13902653" author="hudson" created="Sun, 16 Feb 2014 07:30:44 +0000"  >&lt;p&gt;SUCCESS: Integrated in Mahout-Quality #2478 (See &lt;a href=&quot;https://builds.apache.org/job/Mahout-Quality/2478/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Mahout-Quality/2478/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-1417&quot; title=&quot;Random decision forest implementation fails in Hadoop 2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-1417&quot;&gt;&lt;del&gt;MAHOUT-1417&lt;/del&gt;&lt;/a&gt;: changed EasyMock.createMock() to EasyMock.createNiceMock() to suppress assertion failure. (smarthi: rev 1568731)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/mahout/trunk/core/src/test/java/org/apache/mahout/classifier/df/mapreduce/partial/Step1MapperTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13903074" author="srowen" created="Mon, 17 Feb 2014 08:53:20 +0000"  >&lt;p&gt;Ah thanks for catching that test failure!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12628877" name="MAHOUT-1417.patch" size="3605" author="srowen" created="Thu, 13 Feb 2014 22:44:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 16 Feb 2014 05:58:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>373450</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzm7jz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>373750</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>