<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:20:36 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-191/MAHOUT-191.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-191] NPE while creating term vectors with an index on a field that does not exist in all the documents</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-191</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;(based on the message from here: &lt;a href=&quot;http://www.nabble.com/Creating-Vectors-from-Text-tt24298643.html#a26090263&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/Creating-Vectors-from-Text-tt24298643.html#a26090263&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;I checked out mahout from trunk and tried to create term frequency vector from a lucene index and ran into this..&lt;/p&gt;

&lt;p&gt;09/10/27 17:36:10 INFO lucene.Driver: Output File: /Users/shoeseal/DATA/luc2tvec.out&lt;br/&gt;
09/10/27 17:36:11 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable&lt;br/&gt;
09/10/27 17:36:11 INFO compress.CodecPool: Got brand-new compressor&lt;br/&gt;
Exception in thread &quot;main&quot; java.lang.NullPointerException&lt;br/&gt;
        at org.apache.mahout.utils.vectors.lucene.LuceneIterable$TDIterator.next(LuceneIterable.java:109)&lt;br/&gt;
        at org.apache.mahout.utils.vectors.lucene.LuceneIterable$TDIterator.next(LuceneIterable.java:1)&lt;br/&gt;
        at org.apache.mahout.utils.vectors.io.SequenceFileVectorWriter.write(SequenceFileVectorWriter.java:40)&lt;br/&gt;
        at org.apache.mahout.utils.vectors.lucene.Driver.main(Driver.java:200)&lt;/p&gt;

&lt;p&gt;I am running this from Eclipse (snow leopard with JDK 6), on an index that has field with stored term vectors..&lt;/p&gt;

&lt;p&gt;my input parameters for Driver are:&lt;br/&gt;
--dir &amp;lt;path&amp;gt;/smallidx/ --output &amp;lt;path&amp;gt;/luc2tvec.out --idField id_field&lt;br/&gt;
 --field field_with_TV --dictOut &amp;lt;path&amp;gt;/luc2tvec.dict --max 50  --weight tf&lt;/p&gt;

&lt;p&gt;Luke shows the following info on the fields I am using:&lt;br/&gt;
 id_field is indexed, stored, omit norms&lt;br/&gt;
 field_with_TV is indexed, tokenized, stored, term vector &lt;/p&gt;</description>
                <environment>&lt;p&gt;mac, snow leopard, eclipse galileo, jdk 6&lt;/p&gt;</environment>
        <key id="12439251">MAHOUT-191</key>
            <summary>NPE while creating term vectors with an index on a field that does not exist in all the documents</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean Owen</assignee>
                                    <reporter username="sushil_kb">Sushil Bajracharya</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Oct 2009 08:14:54 +0000</created>
                <updated>Sat, 21 May 2011 04:24:11 +0100</updated>
                            <resolved>Mon, 7 Dec 2009 07:34:47 +0000</resolved>
                                    <version>0.3</version>
                                    <fixVersion>0.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12770825" author="sushil_kb" created="Wed, 28 Oct 2009 08:16:10 +0000"  >&lt;p&gt;It seems that the problem is because that not all the documents in my index has the field that I am using to get term vectors from. I made the following changes to make this work, but I am not sure if thats the right way. I wanted to get this work to run the LDA topic modeling using the output from the Driver.&lt;/p&gt;

&lt;p&gt;Index: utils/src/main/java/org/apache/mahout/utils/vectors/io/SequenceFileVectorWriter.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; utils/src/main/java/org/apache/mahout/utils/vectors/io/SequenceFileVectorWriter.java (revision 830343)&lt;br/&gt;
+++ utils/src/main/java/org/apache/mahout/utils/vectors/io/SequenceFileVectorWriter.java (working copy)&lt;br/&gt;
@@ -42,7 +42,7 @@&lt;br/&gt;
         break;&lt;br/&gt;
       }&lt;br/&gt;
       //point.write(dataOut);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;writer.append(new LongWritable(recNum++), point);&lt;br/&gt;
+      if(point!=null) writer.append(new LongWritable(recNum++), point);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     }&lt;br/&gt;
     return recNum;&lt;br/&gt;
Index: utils/src/main/java/org/apache/mahout/utils/vectors/lucene/LuceneIterable.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; utils/src/main/java/org/apache/mahout/utils/vectors/lucene/LuceneIterable.java (revision 830343)&lt;br/&gt;
+++ utils/src/main/java/org/apache/mahout/utils/vectors/lucene/LuceneIterable.java (working copy)&lt;br/&gt;
@@ -104,6 +104,10 @@&lt;br/&gt;
       try {&lt;br/&gt;
         indexReader.getTermFreqVector(doc, field, mapper);&lt;br/&gt;
         result = mapper.getVector();&lt;br/&gt;
+        &lt;br/&gt;
+        if (result == null)&lt;br/&gt;
+         return null;&lt;br/&gt;
+        &lt;br/&gt;
         if (idField != null) {&lt;br/&gt;
           String id = indexReader.document(doc, idFieldSelector).get(idField);&lt;br/&gt;
           result.setName(id);&lt;/p&gt;</comment>
                            <comment id="12771408" author="kshashi" created="Thu, 29 Oct 2009 12:43:17 +0000"  >&lt;p&gt;I noticed a different problem for empty field. TFDFMapper returned vector for previous non-empty document.  This happens because  setExpectations() is not getting called on empty documents. &lt;/p&gt;

&lt;p&gt;I have attached a patch to addres the same.  Couldn&apos;t find a better way. If you know, please update accordingly. &lt;/p&gt;</comment>
                            <comment id="12786657" author="srowen" created="Sun, 6 Dec 2009 17:31:37 +0000"  >&lt;p&gt;So, may I submit these on y&apos;all&apos;s behalf? Not clear on the status here.&lt;/p&gt;</comment>
                            <comment id="12786782" author="kshashi" created="Mon, 7 Dec 2009 05:06:13 +0000"  >&lt;p&gt;Yeah, this can be committed.&lt;/p&gt;</comment>
                            <comment id="12786807" author="srowen" created="Mon, 7 Dec 2009 07:34:47 +0000"  >&lt;p&gt;Committed variant on patches on behalf of submitters. Did not override the standard setDocumentNumber() method since this seems to be available in Lucene now and undesirable to cut off calls to super.setDocumentNumber()?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12423422" name="MAHOUT-191-patch.txt" size="1352" author="sushil_kb" created="Wed, 28 Oct 2009 08:19:04 +0000"/>
                            <attachment id="12423576" name="MAHOUT-191.patch" size="2030" author="kshashi" created="Thu, 29 Oct 2009 12:39:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 29 Oct 2009 12:43:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9874</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy6n3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23227</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>