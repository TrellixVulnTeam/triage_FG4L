<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:15:52 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-910/MAHOUT-910.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-910] Improve sampling in SamplingCandidateItemStrategy, optimize intersection computations</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-910</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;Per the lengthy discussion on the mailing list about optimizing SamplingCandidateItemStrategy and related code, I&apos;m opening this placeholder issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12533655">MAHOUT-910</key>
            <summary>Improve sampling in SamplingCandidateItemStrategy, optimize intersection computations</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean Owen</assignee>
                                    <reporter username="srowen">Sean Owen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Dec 2011 16:46:36 +0000</created>
                <updated>Thu, 9 Feb 2012 14:01:08 +0000</updated>
                            <resolved>Wed, 7 Dec 2011 10:24:52 +0000</resolved>
                                    <version>0.5</version>
                                    <fixVersion>0.6</fixVersion>
                                    <component>Collaborative Filtering</component>
                        <due>Fri, 9 Dec 2011 00:00:00 +0000</due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13161752" author="hudson" created="Fri, 2 Dec 2011 17:57:44 +0000"  >&lt;p&gt;Integrated in Mahout-Quality #1217 (See &lt;a href=&quot;https://builds.apache.org/job/Mahout-Quality/1217/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Mahout-Quality/1217/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-910&quot; title=&quot;Improve sampling in SamplingCandidateItemStrategy, optimize intersection computations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-910&quot;&gt;&lt;del&gt;MAHOUT-910&lt;/del&gt;&lt;/a&gt; prelude: commit some clear wins in optimizing calls to intersectionSize()&lt;/p&gt;

&lt;p&gt;srowen : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1209577&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1209577&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/cf/taste/impl/model/GenericBooleanPrefDataModel.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/cf/taste/impl/similarity/TanimotoCoefficientSimilarity.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/integration/src/main/java/org/apache/mahout/cf/taste/impl/model/cassandra/CassandraDataModel.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13161952" author="lancenorskog" created="Sat, 3 Dec 2011 00:19:36 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; userIDs1.size() &amp;lt; userIDs2.size() ?
   userIDs2.intersectionSize(userIDs1) :
   userIDs1.intersectionSize(userIDs2);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Could this optimization be pushed into FastIDSet?&lt;/p&gt;</comment>
                            <comment id="13162086" author="srowen" created="Sat, 3 Dec 2011 09:51:35 +0000"  >&lt;p&gt;Yeah you could; in a few cases the caller already knows the size or it can be included in another if statement, so I left it out.&lt;/p&gt;</comment>
                            <comment id="13162094" author="srowen" created="Sat, 3 Dec 2011 10:57:19 +0000"  >&lt;p&gt;This is what I&apos;m proposing to increase sample-ability. Now sampling applies also to items per user, not just users.&lt;/p&gt;</comment>
                            <comment id="13162761" author="srowen" created="Mon, 5 Dec 2011 13:04:39 +0000"  >&lt;p&gt;Now, samples all three things: user&apos;s item, those items&apos; users, and those users&apos; items.&lt;/p&gt;</comment>
                            <comment id="13162899" author="srowen" created="Mon, 5 Dec 2011 17:47:11 +0000"  >&lt;p&gt;Daniel says:&lt;/p&gt;

&lt;p&gt;Hi Sean,&lt;br/&gt;
I have been playing around with your patch. It looks good.&lt;br/&gt;
From the little testing I did, I can also say that the recommendations seem&lt;br/&gt;
to be more accurate than in my initial proposal (#4).&lt;/p&gt;

&lt;p&gt;I just have one suggestion though. I think the current parameters (int&lt;br/&gt;
defaultMaxPrefsPerItemConsidered, int userItemCountMultiplier) are not so&lt;br/&gt;
clear and don&apos;t give enough control over the sampling.&lt;br/&gt;
I would introduce two other parameters (it won&apos;t be backwards-compatible&lt;br/&gt;
though) -&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;maxSourcePrefsConsidered: which will be used&lt;br/&gt;
in conjunction with SamplingLongPrimitiveIterator to do #1.&lt;/li&gt;
	&lt;li&gt;maxFinalPrefs : which will set the value for &apos;int max&apos; in your patch&lt;br/&gt;
(i.e. get rid of max = (int) Math.max(defaultMaxPrefsPerItemConsidered,&lt;br/&gt;
userItemCountMultiplier * Math.log(Math.max(dataModel.getNumUsers(),&lt;br/&gt;
dataModel.getNumItems()))); )&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In the future it would be possible to add a strategy that will affect the&lt;br/&gt;
way maxSourcePrefsConsidered is sampled. For example, most recent items or&lt;br/&gt;
least recent items or random sampling (like we have now). Even though that&lt;br/&gt;
might not be the place to do so.. (since it&apos;s not in the context of the&lt;br/&gt;
user)&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="13162901" author="srowen" created="Mon, 5 Dec 2011 17:51:08 +0000"  >&lt;p&gt;I agree. Since we have three samplings here, the simplest thing is to expose three settings to control each of them individually.&lt;br/&gt;
Right now one setting is exposed, as two numbers. I could just clone (and rename) that pair of parameters so that they can be tuned individually. I could keep the 2-arg constructor and have it set all 3 pairs of parameters to the single pair given, to preserve a bit of backward-compatibility. (Behavior is still quite different though.)&lt;/p&gt;

&lt;p&gt;I think we can endlessly add hook after hook and strategy inside strategies; at some point I&apos;d probably say it&apos;s easier for you to maintain your own copy with particular behavior changes if you really need to. At least it&apos;d be better to see it&apos;s opening up support for a broad class of use cases.&lt;/p&gt;</comment>
                            <comment id="13163055" author="srowen" created="Mon, 5 Dec 2011 21:27:07 +0000"  >&lt;p&gt;See comments on next file.&lt;/p&gt;</comment>
                            <comment id="13163057" author="srowen" created="Mon, 5 Dec 2011 21:29:25 +0000"  >&lt;p&gt;It changed so much it might be easier to read the new source file. Here I&apos;ve gone another way: three parameters to control, but they&apos;re all just the &quot;factor&quot; from Sebstian&apos;s previous code. It lets you specify limits of the form f*log&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_down.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, so limits are logarithmic in the number of items/users. How&apos;s this?&lt;/p&gt;

&lt;p&gt;There&apos;s no overall cap since it is determined by these three values.&lt;/p&gt;</comment>
                            <comment id="13163080" author="tdunning" created="Mon, 5 Dec 2011 21:53:02 +0000"  >&lt;p&gt;Sounds like this will down-sample at least some items from users with few items.&lt;/p&gt;

&lt;p&gt;I would recommend not eliminating any items from users with a small number of items and sampling to a hard limit above that.&lt;/p&gt;</comment>
                            <comment id="13163085" author="srowen" created="Mon, 5 Dec 2011 22:00:46 +0000"  >&lt;p&gt;It&apos;s still computing some maximum (for each of three different things) and allowing everything if the number of things is less than the max, and only sampling if it exceeds the max. I think it&apos;s the same idea as before in this regard. Or are you questioning the default &apos;factor&apos;? I picked 5. Right now if you have about 10,000 items, it will sample when a user exceeds 5*ln(10000) ~= 46 items.&lt;/p&gt;</comment>
                            <comment id="13163743" author="srowen" created="Tue, 6 Dec 2011 19:01:38 +0000"  >&lt;p&gt;If I&apos;ve understood Ted right then I&apos;m not hearing objection to taking this approach. We can modify it more later. Anyone mind if I get this in?&lt;/p&gt;</comment>
                            <comment id="13164227" author="danielz" created="Wed, 7 Dec 2011 08:08:34 +0000"  >&lt;p&gt;I think the latest implementation looks great. It gives very fine control over the sampling.&lt;br/&gt;
However I do have to agree with Ted. In my code, I had to create a hack for users with few items. Otherwise they would get very little to no recommendations.&lt;/p&gt;</comment>
                            <comment id="13164250" author="srowen" created="Wed, 7 Dec 2011 09:21:10 +0000"  >&lt;p&gt;Isn&apos;t this just a matter of setting the limits as you like? To be clear, any set smaller than a given limit is not sampled.&lt;/p&gt;</comment>
                            <comment id="13164253" author="danielz" created="Wed, 7 Dec 2011 09:30:47 +0000"  >&lt;p&gt;Ok, I see what you mean. Then I find the solution very suitable (at least for the problem I had.. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Do you plan to commit it anytime soon?&lt;/p&gt;</comment>
                            <comment id="13164348" author="ssc" created="Wed, 7 Dec 2011 12:14:46 +0000"  >&lt;p&gt;Is it possible to get the same behavior as in &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-914&quot; title=&quot;Provide a non-distributed counterpart of the sampling which is applied in the distributed item similarity computation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-914&quot;&gt;&lt;del&gt;MAHOUT-914&lt;/del&gt;&lt;/a&gt; with the latest version?&lt;/p&gt;</comment>
                            <comment id="13164352" author="srowen" created="Wed, 7 Dec 2011 12:22:17 +0000"  >&lt;p&gt;Yes, you would just set a very high value for the first and third limits, and set your desired limit for the second one. I think it&apos;s a superset of the original implementation and yours.&lt;/p&gt;

&lt;p&gt;It occurs to me we need a reliable way to specify &quot;no limit&quot;. And you&apos;re using log base 2 instead of e, which maybe makes more sense. Why don&apos;t I bake those two ideas in &amp;#8211; then I think it&apos;s the same thing?&lt;/p&gt;</comment>
                            <comment id="13164370" author="ssc" created="Wed, 7 Dec 2011 12:55:14 +0000"  >&lt;p&gt;That would be great. I&apos;d also suggest that only sampling the items per user should be the default behaviour.&lt;/p&gt;</comment>
                            <comment id="13164392" author="hudson" created="Wed, 7 Dec 2011 13:45:25 +0000"  >&lt;p&gt;Integrated in Mahout-Quality #1233 (See &lt;a href=&quot;https://builds.apache.org/job/Mahout-Quality/1233/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Mahout-Quality/1233/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-910&quot; title=&quot;Improve sampling in SamplingCandidateItemStrategy, optimize intersection computations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-910&quot;&gt;&lt;del&gt;MAHOUT-910&lt;/del&gt;&lt;/a&gt; revamp sampling candidate strategy to expose sampling of items, items&apos; users, and those users&apos; items&lt;/p&gt;

&lt;p&gt;srowen : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1211377&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1211377&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/cf/taste/impl/recommender/SamplingCandidateItemsStrategy.java&lt;/li&gt;
	&lt;li&gt;/mahout/trunk/core/src/test/java/org/apache/mahout/cf/taste/impl/recommender/SamplingCandidateItemsStrategyTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13164485" author="hudson" created="Wed, 7 Dec 2011 16:25:05 +0000"  >&lt;p&gt;Integrated in Mahout-Quality #1234 (See &lt;a href=&quot;https://builds.apache.org/job/Mahout-Quality/1234/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Mahout-Quality/1234/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-910&quot; title=&quot;Improve sampling in SamplingCandidateItemStrategy, optimize intersection computations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-910&quot;&gt;&lt;del&gt;MAHOUT-910&lt;/del&gt;&lt;/a&gt; merge ideas from &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-914&quot; title=&quot;Provide a non-distributed counterpart of the sampling which is applied in the distributed item similarity computation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-914&quot;&gt;&lt;del&gt;MAHOUT-914&lt;/del&gt;&lt;/a&gt;, better docs, new no-limit arg, different defaults from Sebastian&lt;/p&gt;

&lt;p&gt;srowen : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1211439&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1211439&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/mahout/trunk/core/src/main/java/org/apache/mahout/cf/taste/impl/recommender/SamplingCandidateItemsStrategy.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12506167" name="MAHOUT-910.patch" size="8138" author="srowen" created="Mon, 5 Dec 2011 21:27:07 +0000"/>
                            <attachment id="12506110" name="MAHOUT-910.patch" size="7277" author="srowen" created="Mon, 5 Dec 2011 13:04:39 +0000"/>
                            <attachment id="12505979" name="MAHOUT-910.patch" size="6710" author="srowen" created="Sat, 3 Dec 2011 10:57:19 +0000"/>
                            <attachment id="12506168" name="SamplingCandidateItemsStrategy.java" size="5208" author="srowen" created="Mon, 5 Dec 2011 21:29:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 2 Dec 2011 17:57:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>219382</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy27z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22511</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>