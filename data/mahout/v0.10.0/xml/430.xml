<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:16:58 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-430/MAHOUT-430.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-430] AbstractSimilarity improperly computes vector metrics</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-430</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;Looking at the userSimilarity and itemSimilarity methods in AbstractSimilarity, both compute metrics over each User&apos;s/Tool&apos;s PreferenceArrays, metrics like &apos;sumX&apos; and &apos;sumY&apos;. The algorithms go through each PreferenceArray in a single loop, comparing indexes to make sure we don&apos;t fall off the end. Eventually, we get to the end of an array, which is caught here:&lt;/p&gt;

&lt;p&gt;if (compare &amp;lt;= 0) {&lt;br/&gt;
  if (++xPrefIndex &amp;gt;= xLength) &lt;/p&gt;
{
    break;
  }
&lt;p&gt;...&lt;/p&gt;

&lt;p&gt;The problem is, the metrics may not be correct when the break occurs. Specifically, for the other array, the one that we &lt;b&gt;didn&apos;t&lt;/b&gt; fall off the end of, the metrics don&apos;t reflect the preferences we have not yet visited. In the example above, if yPrefLength&amp;lt;yLength, then sumY2 is too low. One fix is to do something like this:&lt;/p&gt;

&lt;p&gt;if (compare &amp;lt;= 0) {&lt;br/&gt;
  if (++xPrefIndex &amp;gt;= xLength) &lt;/p&gt;
{
    sumY2 += squareSumRest(yPrefs,yPrefIndex);
    break;
  }
&lt;p&gt;...&lt;/p&gt;

&lt;p&gt;private double squareSumRest(Preference[] preferences, int startingFrom) {&lt;br/&gt;
  double squareSum = 0;&lt;br/&gt;
  for(int i = startingFrom; i &amp;lt; preferences.length; i++)&lt;/p&gt;
{
    double val = preferences[i].getValue();
    squareSum += val*val;
  }
&lt;p&gt;  return squareSum;&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;I believe that the problem affects the sumX and sumY variables (and probably sumXYdiff2), but not the sumXY, sumX2, or sumY2 variables.&lt;/p&gt;

&lt;p&gt;A couple of comments about these two methods:&lt;br/&gt;
1) They&apos;re really hard to reason about. Isn&apos;t there a simpler implementation?&lt;br/&gt;
2) The two methods are very similar. Can&apos;t they be combined somehow?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12468000">MAHOUT-430</key>
            <summary>AbstractSimilarity improperly computes vector metrics</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean Owen</assignee>
                                    <reporter username="emerson">Emerson Murphy-HIll</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Jun 2010 02:23:12 +0100</created>
                <updated>Sun, 31 Oct 2010 15:49:48 +0000</updated>
                            <resolved>Tue, 29 Jun 2010 09:10:07 +0100</resolved>
                                    <version>0.4</version>
                                    <fixVersion>0.4</fixVersion>
                                    <component>Collaborative Filtering</component>
                        <due>Wed, 30 Jun 2010 04:00:00 +0000</due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12883088" author="srowen" created="Mon, 28 Jun 2010 10:54:54 +0100"  >&lt;p&gt;But once you fall off the end of one, the remaining data points in the other array are irrelevant, since they have no counterpart in the one that ended. These metrics are only computed over the item/users that are common to both.&lt;/p&gt;

&lt;p&gt;You can write a test to double-check but after looking at it again I&apos;m certain it&apos;s correct.&lt;/p&gt;

&lt;p&gt;It&apos;s probably the fastest implementation possible, and because of that, not the shortest. I don&apos;t think it&apos;s too messy, but have a crack at improving it while not comprising speed if you like. This is the best I could do after years of looking at this method.&lt;/p&gt;

&lt;p&gt;The duplication is unfortunate but hard to refactor because they&apos;re doing slightly different things actually. Again open to suggestions but I have stared at this for a long time and, given the priority for speed, not been able to do better.&lt;/p&gt;</comment>
                            <comment id="12883130" author="emerson" created="Mon, 28 Jun 2010 13:49:32 +0100"  >&lt;p&gt;You are right in that the remaining data points are irrelevant for sumXY. But I believe that the data points &lt;b&gt;are&lt;/b&gt; relevant for sumX and sumY, because these values should be computed for the entirety of both feature arrays.&lt;/p&gt;

&lt;p&gt;This may not be the case for some similarity metrics, but it is for UncenteredCosineSimilarity, which is what I&apos;m working with. For this metric, the full sumX and sumY are necessary, for instance, for computing the magnitude of each preference array (&lt;a href=&quot;http://en.wikipedia.org/wiki/Cosine_similarity&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://en.wikipedia.org/wiki/Cosine_similarity&lt;/a&gt; : here the ||A|| and ||B||).&lt;/p&gt;</comment>
                            <comment id="12883135" author="srowen" created="Mon, 28 Jun 2010 14:01:48 +0100"  >&lt;p&gt;All of these are only defined over dimensions with a value in both vectors. Other dimensions effectively don&apos;t exist. This is just how it is defined and why the sum of those other x or y values does not exist in the computation.&lt;/p&gt;

&lt;p&gt;I think you are viewing missing values as 0 - but existing. While I&apos;d suggest that&apos;s not a good idea for recommendations, this idea is implemented via PreferenceInferrer. Supply one that fills in 0 and you should get what you expect. &lt;/p&gt;</comment>
                            <comment id="12883194" author="emerson" created="Mon, 28 Jun 2010 16:52:48 +0100"  >&lt;p&gt;I see what you mean; I didn&apos;t make the distinction between zero values and missing values.&lt;/p&gt;

&lt;p&gt;But I am actually using a PreferenceInferrer that fills in 0 for missing values. When I do that, the break still happens before the other dimensions are included in the calculations of sumX or sumY.&lt;/p&gt;</comment>
                            <comment id="12883199" author="srowen" created="Mon, 28 Jun 2010 17:01:00 +0100"  >&lt;p&gt;Hmm yeah that doesn&apos;t look right, in the case where you have the inferrer. Let me look at it again tonight and put in a fix if needed or remember why it&apos;s done that way.&lt;/p&gt;</comment>
                            <comment id="12883479" author="hudson" created="Tue, 29 Jun 2010 10:20:55 +0100"  >&lt;p&gt;Integrated in Mahout-Quality #106 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Mahout-Quality/106/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Mahout-Quality/106/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-430&quot; title=&quot;AbstractSimilarity improperly computes vector metrics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-430&quot;&gt;&lt;del&gt;MAHOUT-430&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12883576" author="emerson" created="Tue, 29 Jun 2010 16:05:58 +0100"  >&lt;p&gt;Does the itemSimilarity method have the same issue? I realize that it doesn&apos;t use an inferrer, but it does treat missing values as zero, so I think that it also needs to consider the remainder of not-finished PreferenceArray.&lt;/p&gt;</comment>
                            <comment id="12883578" author="srowen" created="Tue, 29 Jun 2010 16:08:20 +0100"  >&lt;p&gt;Shouldn&apos;t be the same issue, no. Without an inferrer those preferences really don&apos;t exist, so their counterparts don&apos;t exist in the computation.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 28 Jun 2010 09:54:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9633</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy55z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22988</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>