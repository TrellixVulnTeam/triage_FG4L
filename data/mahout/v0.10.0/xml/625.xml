<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:20:06 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-625/MAHOUT-625.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-625] Some of generated patterns have support higher than in reality</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-625</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;It turnes out that some of generated patterns have incorrect support. The returned support is slightly higher than the true one.&lt;br/&gt;
I attached the test, which proves that FPGrowth has a bug. Test is using data (retail) found here: &lt;a href=&quot;http://fimi.ua.ac.be/data/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://fimi.ua.ac.be/data/&lt;/a&gt;&lt;br/&gt;
The pattern (36, 39, 41) occurs in the transactions 572 times (this is also calculated in test), but the FPGrowth returns pattern (36, 39, 41) with support 573.&lt;/p&gt;

&lt;p&gt;Please note that mentioned pattern is not the only one with incorrect support - the test only point out one example to hace something to focus on. There is plenty more patterns with support higher than the real one. The biggest difference I noticed was support 8 higher than the real one for one of patterns.&lt;/p&gt;

&lt;p&gt;Please find attached failing unit test - it&apos;s actually a maven project, which contains test data and is ready to run.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12501153">MAHOUT-625</key>
            <summary>Some of generated patterns have support higher than in reality</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="robinanil">Robin Anil</assignee>
                                    <reporter username="jarek">Jaroslaw Odzga</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Mar 2011 15:24:20 +0000</created>
                <updated>Tue, 31 Mar 2015 23:49:15 +0100</updated>
                            <resolved>Sat, 21 May 2011 04:06:04 +0100</resolved>
                                    <version>0.4</version>
                                    <fixVersion>0.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13005678" author="jarek" created="Fri, 11 Mar 2011 15:26:54 +0000"  >&lt;p&gt;Test which shows that FPGrowth has a bug. The data for test is from &lt;a href=&quot;http://fimi.ua.ac.be/data/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://fimi.ua.ac.be/data/&lt;/a&gt; (retail).&lt;/p&gt;</comment>
                            <comment id="13005770" author="tdunning" created="Fri, 11 Mar 2011 18:25:41 +0000"  >&lt;p&gt;Can you use a portable/standard compressor for this attachment?  7-zip is not widely used.&lt;/p&gt;

&lt;p&gt;Try zip or tar.gz.  Or bzip.&lt;/p&gt;</comment>
                            <comment id="13005779" author="jarek" created="Fri, 11 Mar 2011 18:42:04 +0000"  >&lt;p&gt;Attached test in zip archive&lt;/p&gt;</comment>
                            <comment id="13006196" author="jarek" created="Sun, 13 Mar 2011 13:43:05 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;After a bit of analysis I found the problem. It turned out that the alpha-pruning method had a bug - it was leaving the node attached to it&apos;s parent after pruning. This was causing issues in situation, when tree was pruned multiple times and unattached node landed in header table (this is rare for small data, but pretty common for fairly big number of transactions). In such case, the support of unattached node was counted even though it shouldn&apos;t. I fixed the problem by simply setting the support of such node to 0. Since it can not have any children it doesn&apos;t add to computation time and it is simpler solution that trying to unattach it from it&apos;s parent (parent has an arbitrary ordered list of children).&lt;/p&gt;

&lt;p&gt;I added a comprehensive test, which uses transactions from the retail data from &lt;a href=&quot;http://fimi.ua.ac.be/data/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://fimi.ua.ac.be/data/&lt;/a&gt; (88162 transactions) and compares the results with the results generated by implementation from &lt;a href=&quot;http://www.borgelt.net/fpgrowth.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.borgelt.net/fpgrowth.html&lt;/a&gt;. I added tests for both the serial and parallel (map-reduce) fpgrowth.&lt;/p&gt;

&lt;p&gt;I also noticed that fpgrowth implementation can be optimized by not calculating patterns ending with given attributes multiple times. Depending on for how many features patterns are generated, speedup can be huge. More feature included - greater speedup. For mentioned test data, if all features were selected (i.e. we want to generate patterns for all items in transactions), patterns generation time dropped from 1h 15min to 8sec. For parallel fpgrowth, where the number of requested features is limited the speedup is not that dramatic, but still very high.&lt;/p&gt;

&lt;p&gt;I attached patch (for version 0.5-SNAPSHOT) with all changes (bug fix, comprehensive tests (serial and parallel) and optimization). I hope it&apos;ll find it&apos;s way to the trunk &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13006239" author="robinanil" created="Sun, 13 Mar 2011 18:18:38 +0000"  >&lt;p&gt;Right, I was testing vipuls dataset(&lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-617&quot; title=&quot;FPGrowth/PFPGrowth giving out wrong results. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-617&quot;&gt;&lt;del&gt;MAHOUT-617&lt;/del&gt;&lt;/a&gt;) and was seeing the same issue. Was the header table having the node even after alpha pruning?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I also noticed that fpgrowth implementation can be optimized by not calculating patterns ending with given attributes multiple times. Depending on for how many features patterns are generated, speedup can be huge. More feature included - greater speedup. For mentioned test data, if all features were selected (i.e. we want to generate patterns for all items in transactions), patterns generation time dropped from 1h 15min to 8sec&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This might be useful for single node. For PFPGrowth this used to create issues with exact counts of patterns earlier. There is a lot of code here(:thumbs up&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; for me to verify. Some issues&lt;/p&gt;

&lt;p&gt;1) The dataset needs to have a signed agreement before can include in the Mahout codebase(see the website). Can you add another test to reproduce the test case. See &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-617&quot; title=&quot;FPGrowth/PFPGrowth giving out wrong results. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-617&quot;&gt;&lt;del&gt;MAHOUT-617&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
2) Again the comparison code, use a different dataset.&lt;br/&gt;
3) Can you split the optimization out of this into another patch. I want to test more before checking it in.&lt;br/&gt;
4) Bug fix by setting support = 0 maynot save the extra memory such nodes take. Its good for now, before a permanent solution is found.&lt;/p&gt;
</comment>
                            <comment id="13006240" author="robinanil" created="Sun, 13 Mar 2011 18:19:11 +0000"  >&lt;p&gt;Again Great job! on finding and fixing the bug&lt;/p&gt;</comment>
                            <comment id="13006242" author="robinanil" created="Sun, 13 Mar 2011 18:25:38 +0000"  >&lt;p&gt;Small Nit. You can use the Mahout eclipse formatter available on the how to contribute page(on the Mahout wiki) for newly submitted code.&lt;/p&gt;</comment>
                            <comment id="13006258" author="jarek" created="Sun, 13 Mar 2011 19:20:13 +0000"  >&lt;p&gt;I attached isolated patch for bug fix - it&apos;s one-liner. The rest is for optimization.&lt;br/&gt;
Answering your questions:&lt;br/&gt;
1) Node that was removed was ending up in header table for certain data input - this is the reason for increased support for some of the generated patterns&lt;br/&gt;
2) The author of the dataset writes:&lt;br/&gt;
The data are provided &#8217;as is&#8217;. Basically, any use of the data is allowed as long as the proper&lt;br/&gt;
acknowledgment is provided and a copy of the work is provided to Tom Brijs (see details below).&lt;br/&gt;
I think author mainly thinks of scientific papers when he mentions &quot;copy of work&quot;. I&apos;m not sure if is it enough to drop an email to the author and just ask if dataset can be used in mahout?&lt;br/&gt;
3) I don&apos;t see how we could achieve memory saving since the data is in preallocated array. Removing node is done merely by detaching it from the parent, which could be done, but I think benefit is not worth additional effort of doing it (currently parent has unordered list of children).&lt;br/&gt;
4) As to performance improvement, as I said it is dramatic when number of requested features is high (as in single node scenario or with very big groups in parallel scenario), it is still noticeable even with small number of features. Basically work done is always smaller than before the patch (as patterns for each item are calculated at most once). Obviously in parallel situation, when groups are small, the performance boost will not be that huge. If you notice any issues with it, please let me know.&lt;/p&gt;</comment>
                            <comment id="13006403" author="jarek" created="Mon, 14 Mar 2011 13:35:56 +0000"  >&lt;p&gt;Attached email conversation with author of the data set used in test in which he gave OK for using the data in Mahout.&lt;br/&gt;
I believe it closes the issue of using the data set.&lt;/p&gt;</comment>
                            <comment id="13006892" author="robinanil" created="Tue, 15 Mar 2011 12:27:07 +0000"  >&lt;p&gt;Jaroslaw. Can you submit a final patch with bug fix, test and the dataset. And also move optimization over to a new issue, I want to go test more and maybe add a cmd line flag to enable the optimization. The rest looks fine to commit. &lt;/p&gt;

&lt;p&gt;Thanks again for taking initiative on getting the dataset in. And kudos for the fix. It was not easy to figure out.&lt;/p&gt;</comment>
                            <comment id="13009088" author="jarek" created="Mon, 21 Mar 2011 10:20:23 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Sorry for a long delay, but I was on holidays &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I attached the patch containing fix with tests and test dataset.&lt;br/&gt;
I&apos;ll create separate issue for performance improvement.&lt;/p&gt;</comment>
                            <comment id="13009093" author="jarek" created="Mon, 21 Mar 2011 10:40:29 +0000"  >&lt;p&gt;Created separate issue for performance improvement:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-629&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/MAHOUT-629&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13009689" author="robinanil" created="Tue, 22 Mar 2011 16:11:25 +0000"  >&lt;p&gt;The FPGrowthRetailTest100 takes 1 hour &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; So I am commenting it out before checking it in. Can uncomment after the perf patch is in. PFPGrowthRetail100 test gets benefit from the splitting takes only 93sec&lt;/p&gt;</comment>
                            <comment id="13009759" author="hudson" created="Tue, 22 Mar 2011 18:26:18 +0000"  >&lt;p&gt;Integrated in Mahout-Quality #684 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Mahout-Quality/684/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/Mahout-Quality/684/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-625&quot; title=&quot;Some of generated patterns have support higher than in reality&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-625&quot;&gt;&lt;del&gt;MAHOUT-625&lt;/del&gt;&lt;/a&gt; Fixing support bug in due to dangling item in the header table, Adding tests based on retail data from  &lt;a href=&quot;http://fimi.ua.ac.be/data/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://fimi.ua.ac.be/data/&lt;/a&gt;, Contributed by Jaroslaw Odzga&lt;/p&gt;</comment>
                            <comment id="13037250" author="srowen" created="Sat, 21 May 2011 04:06:04 +0100"  >&lt;p&gt;(It looks like this was actually resolved in the past, and is in 0.5?)&lt;/p&gt;</comment>
                            <comment id="13049660" author="hustnn" created="Wed, 15 Jun 2011 08:21:44 +0100"  >&lt;p&gt;It shows it is resolved in the 0.5 version ,but I don&apos;t see the related code of the patch in version 0.5. &lt;/p&gt;

&lt;p&gt;For example in growth function of FPGrowth.java,&lt;br/&gt;
while (i &amp;lt; headerTableCount) {&lt;br/&gt;
...&lt;br/&gt;
if (attribute == currentAttribute) {&lt;br/&gt;
}&lt;br/&gt;
else&lt;br/&gt;
{}&lt;br/&gt;
}&lt;br/&gt;
 I think just need to computing the condition of currentAttribute,other attribute should be done by other reduce task.&lt;/p&gt;

&lt;p&gt;How do you think of this?&lt;/p&gt;</comment>
                            <comment id="13049672" author="srowen" created="Wed, 15 Jun 2011 09:04:58 +0100"  >&lt;p&gt;Please open a new issue with the patch that would bring HEAD to what you think is right. I/we may have misunderstood and not committed all of what you wanted to see.&lt;/p&gt;</comment>
                            <comment id="13053008" author="hustnn" created="Wed, 22 Jun 2011 03:38:54 +0100"  >&lt;p&gt;I modify the source following the &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-625&quot; title=&quot;Some of generated patterns have support higher than in reality&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-625&quot;&gt;&lt;del&gt;MAHOUT-625&lt;/del&gt;&lt;/a&gt;-patch.txt patch,but I find it become slower than original implementation in version 0.4 using my test datset which every transaction list is very long,for about 1000 columns in one transaction.&lt;/p&gt;


</comment>
                    </comments>
                    <attachments>
                            <attachment id="12483398" name="FPGrowth.java" size="34367" author="hustnn" created="Wed, 22 Jun 2011 03:38:54 +0100"/>
                            <attachment id="12473506" name="MAHOUT-625-patch.txt" size="4381264" author="jarek" created="Sun, 13 Mar 2011 13:44:29 +0000"/>
                            <attachment id="12473514" name="bugfix-patch.txt" size="806" author="jarek" created="Sun, 13 Mar 2011 19:20:43 +0000"/>
                            <attachment id="12473559" name="dataset_ok.txt" size="1116" author="jarek" created="Mon, 14 Mar 2011 13:35:56 +0000"/>
                            <attachment id="12474165" name="final_patch_with_bug_fix_test_and_the_dataset.txt" size="4370420" author="jarek" created="Mon, 21 Mar 2011 10:20:23 +0000"/>
                            <attachment id="12473419" name="mahout-test.zip" size="1539037" author="jarek" created="Fri, 11 Mar 2011 18:42:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 11 Mar 2011 18:25:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9436</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy3yn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22793</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>