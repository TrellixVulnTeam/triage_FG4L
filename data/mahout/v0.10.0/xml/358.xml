<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:24:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-358/MAHOUT-358.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-358] the pref value  field of output of org.apache.mahout.cf.taste.hadoop.item.RecommenderJob has negative</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-358</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;In my test the input pref values all is positive.&lt;br/&gt;
the output score value has negative value ,&lt;/p&gt;</description>
                <environment></environment>
        <key id="12460996">MAHOUT-358</key>
            <summary>the pref value  field of output of org.apache.mahout.cf.taste.hadoop.item.RecommenderJob has negative</summary>
                <type id="6" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/requirement.png">Test</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean Owen</assignee>
                                    <reporter username="huiwenhan">Han Hui Wen </reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Apr 2010 07:07:13 +0100</created>
                <updated>Sun, 31 Oct 2010 15:49:19 +0000</updated>
                            <resolved>Wed, 7 Apr 2010 17:20:14 +0100</resolved>
                                    <version>0.4</version>
                                    <fixVersion>0.4</fixVersion>
                                    <component>Collaborative Filtering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12852725" author="huiwenhan" created="Fri, 2 Apr 2010 07:08:55 +0100"  >&lt;p&gt;the value has negative&lt;/p&gt;</comment>
                            <comment id="12852785" author="srowen" created="Fri, 2 Apr 2010 11:45:13 +0100"  >&lt;p&gt;Having decimal values is normal. Negative values are bizarre though. The co-occurrence matrix and user vector should have nonnegative values, so I can&apos;t see how it gets a negative element from multiplications and additions. I don&apos;t see any obvious problems with the logic.&lt;/p&gt;

&lt;p&gt;I wonder if you can debug, look at the cooccurrence matrix and/or user vectors? make sure neither has negative values?&lt;/p&gt;

&lt;p&gt;I&apos;m trying to imagine wild scenarios, like overflowing an int in the cooccurrence matrix? but you don&apos;t have billions of users...&lt;/p&gt;</comment>
                            <comment id="12852830" author="huiwenhan" created="Fri, 2 Apr 2010 15:18:13 +0100"  >&lt;p&gt;I will do more test next week &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;we only have about 1 million users&lt;/p&gt;</comment>
                            <comment id="12853919" author="huiwenhan" created="Tue, 6 Apr 2010 14:07:43 +0100"  >&lt;p&gt;I used the latest code test again ,&lt;br/&gt;
the final output also is strange.&lt;/p&gt;</comment>
                            <comment id="12853927" author="srowen" created="Tue, 6 Apr 2010 14:24:44 +0100"  >&lt;p&gt;Yes, the very small zero values are now being output. I think it should filter very small zero values instead, which I can add.&lt;/p&gt;

&lt;p&gt;The part I don&apos;t quite understand are the negative values. Do you have negative ratings?&lt;/p&gt;</comment>
                            <comment id="12853929" author="srowen" created="Tue, 6 Apr 2010 14:27:34 +0100"  >&lt;p&gt;Maybe it also clarifies to say: those valus are &lt;b&gt;not&lt;/b&gt; estimated preferences. They can be very large; they are not supposed to be in a certain range.&lt;/p&gt;

&lt;p&gt;The negative values make sense if you have negative ratings, and I suppose we should allow for that.&lt;/p&gt;

&lt;p&gt;In that case, your results seem correct. The only change you may want then is to output very large or small numbers in scientific notation instead of a long string. I can make that change easily.&lt;/p&gt;</comment>
                            <comment id="12853977" author="huiwenhan" created="Tue, 6 Apr 2010 14:46:06 +0100"  >&lt;p&gt;I have no negative ratings.&lt;/p&gt;</comment>
                            <comment id="12853982" author="srowen" created="Tue, 6 Apr 2010 14:59:15 +0100"  >&lt;p&gt;That is truly strange then. The user vectors have nonnegative values, and so does the co-occurrence matrix. Their product can&apos;t have negative values. Something is going wrong somewhere in there.&lt;/p&gt;

&lt;p&gt;I can&apos;t reproduce to check without your data, though if you&apos;re in a position to debug, you&apos;ll have to see why user vectors or the matrix has negative values. I have looked at the code many times and do not see a way this can happen.&lt;/p&gt;</comment>
                            <comment id="12853983" author="huiwenhan" created="Tue, 6 Apr 2010 15:01:20 +0100"  >&lt;p&gt;I will debug and tell you the result .&lt;br/&gt;
Thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12854073" author="huiwenhan" created="Tue, 6 Apr 2010 18:23:02 +0100"  >&lt;p&gt;if use Text as the out format ,everything is ok.&lt;/p&gt;

&lt;p&gt;maybe something is wrong with RecommendedItemsWritable or IdentityReducer.&lt;/p&gt;


&lt;p&gt;public final class RecommenderMapper extends MapReduceBase implements&lt;br/&gt;
    Mapper&amp;lt;LongWritable,VectorWritable,Text,Text&amp;gt;&lt;/p&gt;

&lt;p&gt;  private final Text user = new Text();&lt;br/&gt;
  private final Text recomScore = new Text();&lt;br/&gt;
  private static final String FIELD_SEPERATOR = &quot;,&quot;;&lt;/p&gt;

&lt;p&gt;    //output.collect(userID, new RecommendedItemsWritable(recommendations));&lt;br/&gt;
    for (RecommendedItem recommendation : recommendations)&lt;/p&gt;
    { 
    	user.set(String.valueOf(userID)); 
    	recomScore.set(recommendation.getItemID() + FIELD_SEPERATOR + recommendation.getValue()); 
    	output.collect(user, recomScore); 
    } 

&lt;p&gt;  JobConf recommenderConf = prepareJobConf(userVectorPath, outputPath,&lt;br/&gt;
      SequenceFileInputFormat.class, RecommenderMapper.class, Text.class,&lt;br/&gt;
      Text.class, IdentityReducer.class, Text.class,&lt;br/&gt;
      Text.class, TextOutputFormat.class);&lt;/p&gt;</comment>
                            <comment id="12854077" author="srowen" created="Tue, 6 Apr 2010 18:36:13 +0100"  >&lt;p&gt;You mean that you do not see those negative values? Truly strange, since that means everything&apos;s working except output?&lt;/p&gt;

&lt;p&gt;The output is simple:&lt;/p&gt;

&lt;p&gt;  @Override&lt;br/&gt;
  public String toString() {&lt;br/&gt;
    StringBuilder result = new StringBuilder(200);&lt;br/&gt;
    result.append(&apos;[&apos;);&lt;br/&gt;
    boolean first = true;&lt;br/&gt;
    for (RecommendedItem item : recommended) {&lt;br/&gt;
      if (first) &lt;/p&gt;
{
        first = false;
      }
&lt;p&gt; else &lt;/p&gt;
{
        result.append(&apos;,&apos;);
      }
&lt;p&gt;      result.append(item.getItemID());&lt;br/&gt;
      result.append(&apos;:&apos;);&lt;br/&gt;
      BigDecimal bd = new BigDecimal(item.getValue()).round(ROUNDING);&lt;br/&gt;
      result.append(bd.toPlainString());&lt;br/&gt;
    }&lt;br/&gt;
    result.append(&apos;]&apos;);&lt;br/&gt;
    return result.toString();&lt;br/&gt;
  }&lt;/p&gt;

&lt;p&gt;I can remove the BigDecimal call, which is somewhat new, but still looks entirely correct to me.&lt;/p&gt;

&lt;p&gt;Are you sure the output is really different?&lt;/p&gt;</comment>
                            <comment id="12854317" author="huiwenhan" created="Wed, 7 Apr 2010 04:33:22 +0100"  >&lt;p&gt;&lt;a href=&quot;http://java.sun.com/javase/6/docs/api/java/math/BigDecimal.html#BigDecimal(double&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://java.sun.com/javase/6/docs/api/java/math/BigDecimal.html#BigDecimal(double&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="12854371" author="srowen" created="Wed, 7 Apr 2010 08:56:59 +0100"  >&lt;p&gt;Yes, I know how the method works. That&apos;s as I expected and should give the desired result.&lt;br/&gt;
However for simplicity, I just removed the BigDecimal call, and you can try again. This time it is truly writing exactly what was in the recommended item object.&lt;/p&gt;</comment>
                            <comment id="12854375" author="ssc" created="Wed, 7 Apr 2010 09:23:11 +0100"  >&lt;p&gt;I ran the job with some test data from my company (half a million ratings from an e-commerce platform) and I&apos;m seeing the negative values too.&lt;/p&gt;</comment>
                            <comment id="12854383" author="huiwenhan" created="Wed, 7 Apr 2010 09:41:29 +0100"  >&lt;p&gt;I have some finding :&lt;/p&gt;

&lt;p&gt;I debug as following:&lt;br/&gt;
code:&lt;br/&gt;
  public void map(LongWritable userID,&lt;br/&gt;
                  VectorWritable vectorWritable,&lt;br/&gt;
                  OutputCollector&amp;lt;LongWritable,RecommendedItemsWritable&amp;gt; output,&lt;br/&gt;
                  Reporter reporter) throws IOException {&lt;/p&gt;

&lt;p&gt;    if ((usersToRecommendFor != null) &amp;amp;&amp;amp; !usersToRecommendFor.contains(userID.get())) &lt;/p&gt;
{
      return;
    }
&lt;p&gt;    System.out.println(&quot;user_id:start-----------&quot;+userID.get());&lt;br/&gt;
    Vector userVector = vectorWritable.get();&lt;br/&gt;
    Iterator&amp;lt;Vector.Element&amp;gt; userVectorIterator = userVector.iterateNonZero();&lt;br/&gt;
    Vector recommendationVector = new RandomAccessSparseVector(Integer.MAX_VALUE, 1000);&lt;br/&gt;
    while (userVectorIterator.hasNext()) {&lt;br/&gt;
      Vector.Element element = userVectorIterator.next();&lt;br/&gt;
      int index = element.index();&lt;br/&gt;
      Vector columnVector;&lt;br/&gt;
      try &lt;/p&gt;
{
        columnVector = cooccurrenceColumnCache.get(new IntWritable(index));
      }
&lt;p&gt; catch (TasteException te) {&lt;br/&gt;
        if (te.getCause() instanceof IOException) &lt;/p&gt;
{
          throw (IOException) te.getCause();
        }
&lt;p&gt; else &lt;/p&gt;
{
          throw new IOException(te.getCause());
        }
&lt;p&gt;      }&lt;br/&gt;
      if (columnVector != null) {&lt;br/&gt;
    	  Iterator&amp;lt;Vector.Element&amp;gt; columnVectorIterator = columnVector.iterateNonZero();  //debug here&lt;br/&gt;
    	  while (columnVectorIterator.hasNext()) &lt;/p&gt;
{
    	      Vector.Element element1 = columnVectorIterator.next();
    	      int index1 = element1.index();
    	      double value1 = element1.get();
    	      System.out.println(&quot;before index[&quot;+index1+&quot;]:&quot;+value1);
    	  }
&lt;p&gt;        if (booleanData) &lt;/p&gt;
{ // because &apos;value&apos; is 1.0
          columnVector.addTo(recommendationVector);
        }
&lt;p&gt; else &lt;/p&gt;
{
          double value = element.get();
          System.out.println(value);
          columnVector.times(value).addTo(recommendationVector);
        }
&lt;p&gt;      }&lt;br/&gt;
    }&lt;br/&gt;
    Iterator&amp;lt;Vector.Element&amp;gt; recVectorIterator = recommendationVector.iterateNonZero();  //debug here&lt;br/&gt;
 	  while (recVectorIterator.hasNext()) &lt;/p&gt;
{
	      Vector.Element element2 = recVectorIterator.next();
	      int index2 = element2.index();
	      double value2 = element2.get();
	      System.out.println(&quot;after inex[&quot;+index2+&quot;]:&quot;+value2);
	  }
&lt;p&gt;    Queue&amp;lt;RecommendedItem&amp;gt; topItems = new PriorityQueue&amp;lt;RecommendedItem&amp;gt;(recommendationsPerUser + 1,&lt;br/&gt;
        Collections.reverseOrder());&lt;/p&gt;

&lt;p&gt;    Iterator&amp;lt;Vector.Element&amp;gt; recommendationVectorIterator = recommendationVector.iterateNonZero();&lt;br/&gt;
    LongWritable itemID = new LongWritable();&lt;br/&gt;
    while (recommendationVectorIterator.hasNext()) {&lt;br/&gt;
      Vector.Element element = recommendationVectorIterator.next();&lt;br/&gt;
      int index = element.index();&lt;br/&gt;
      if (userVector.get(index) == 0.0) {&lt;br/&gt;
        if (topItems.size() &amp;lt; recommendationsPerUser) &lt;/p&gt;
{
          indexItemIDMap.get(new IntWritable(index), itemID);
          topItems.add(new GenericRecommendedItem(itemID.get(), (float) element.get()));
        }
&lt;p&gt; else if (element.get() &amp;gt; topItems.peek().getValue()) &lt;/p&gt;
{
          indexItemIDMap.get(new IntWritable(index), itemID);
          topItems.add(new GenericRecommendedItem(itemID.get(), (float) element.get()));
          topItems.poll();
        }
&lt;p&gt;      }&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;    List&amp;lt;RecommendedItem&amp;gt; recommendations = new ArrayList&amp;lt;RecommendedItem&amp;gt;(topItems.size());&lt;br/&gt;
    recommendations.addAll(topItems);&lt;br/&gt;
    Collections.sort(recommendations);&lt;br/&gt;
    output.collect(userID, new RecommendedItemsWritable(recommendations));&lt;br/&gt;
    for (RecommendedItem recommendation : recommendations)&lt;/p&gt;
    { 
    	System.out.println(recommendation.getItemID()+&quot;:&quot;+recommendation.getValue());   //debug here
    	//user.set(String.valueOf(userID)); 
    	//recomScore.set(recommendation.getItemID() + FIELD_SEPERATOR + recommendation.getValue()); 
    	//output.collect(user, recomScore); 
    } 
&lt;p&gt;    System.out.println(&quot;user_id:end-----------&quot;+userID.get());&lt;br/&gt;
  }&lt;/p&gt;

&lt;p&gt;add the out put and the log in attachment &lt;/p&gt;</comment>
                            <comment id="12854384" author="huiwenhan" created="Wed, 7 Apr 2010 09:45:19 +0100"  >&lt;p&gt;please notice user -9021091696683061572&lt;/p&gt;</comment>
                            <comment id="12854387" author="huiwenhan" created="Wed, 7 Apr 2010 09:48:20 +0100"  >&lt;p&gt;it seems that we got the dirty data here;&lt;/p&gt;

&lt;p&gt;recommendations.addAll(topItems);&lt;/p&gt;

&lt;p&gt;or List&amp;lt;RecommendedItem&amp;gt; recommendations has element that we do not fill it.&lt;/p&gt;

&lt;p&gt;I want to get 10 recommendation items,but it exceeds 10 sometime and data is strange.&lt;/p&gt;
</comment>
                            <comment id="12854413" author="huiwenhan" created="Wed, 7 Apr 2010 11:31:23 +0100"  >&lt;p&gt;the simple way to resolve the issue is that construct the output in RecommenderMapper and not use custom writable&lt;/p&gt;

&lt;p&gt;private final Text user = new Text();&lt;br/&gt;
private final Text recomScore = new Text();&lt;/p&gt;


&lt;p&gt;StringBuilder result = new StringBuilder(200);&lt;br/&gt;
result.append(&apos;[&apos;);&lt;br/&gt;
boolean first = true;&lt;br/&gt;
for (RecommendedItem item : recommendations) {&lt;br/&gt;
if (first) &lt;/p&gt;
{ first = false; }
&lt;p&gt; &lt;br/&gt;
else &lt;/p&gt;
{ result.append(&apos;,&apos;); }
&lt;p&gt;result.append(item.getItemID());&lt;br/&gt;
result.append(&apos;:&apos;);&lt;br/&gt;
result.append(item.getValue());&lt;br/&gt;
}&lt;br/&gt;
result.append(&apos;]&apos;);&lt;br/&gt;
user.set(String.valueOf(userID)); &lt;br/&gt;
recomScore.set(result.toString);&lt;br/&gt;
output.collect(userID, recomScore);&lt;/p&gt;</comment>
                            <comment id="12854432" author="srowen" created="Wed, 7 Apr 2010 12:40:33 +0100"  >&lt;p&gt;The output is helpful. I am more confused, we may be talking about different things. userID could well be negative. It&apos;s a long. What is your input like? how are you mapping user IDs to longs? That is not a problem per se, but I would like to understand what your user IDs are like.&lt;/p&gt;

&lt;p&gt;Earlier your output showed negative &lt;b&gt;values&lt;/b&gt;, not &lt;b&gt;IDs&lt;/b&gt;, and that is something I can&apos;t figure out. But we don&apos;t see that here.&lt;/p&gt;

&lt;p&gt;Actually, this output seems correct to me.&lt;/p&gt;


&lt;p&gt;Which are you talking about Sebastian?&lt;/p&gt;

&lt;p&gt;I can&apos;t quite understand why you would see more than 10 recommendations since as you see, the queue is kept to this size in the code above. I can try one or two more changes that try to make the code even more straightforward (e.g. moving the ordering logic in a Comparator, not reusing Writables in case something strange goes on there.)&lt;/p&gt;

&lt;p&gt;Is the change to Text really a solution &amp;#8211; I am not yet clear we&apos;re talking about the same issue. I can&apos;t see how this changes behavior. We&apos;re already seeing that RecommendedItemsWrtiable.toString() is being invoked. I do not see how String.valueOf(long) could return the &apos;right&apos; value, but StringBuffer.append(long) the &apos;wrong&apos; value. They&apos;re calling into the same java.lang code in the end.&lt;/p&gt;

&lt;p&gt;Very very confused here, esp since I cannot reproduce this.&lt;/p&gt;

&lt;p&gt;Could it be a Hadoop version issue? I&apos;m on 0.20.2.&lt;/p&gt;

&lt;p&gt;I will commit any wild-guess changes I can here in a minute in an effort to shed any light.&lt;/p&gt;</comment>
                            <comment id="12854437" author="huiwenhan" created="Wed, 7 Apr 2010 12:56:23 +0100"  >&lt;p&gt;here is the question from test.&lt;/p&gt;

&lt;p&gt;1)  the value has negative in  &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12441008/20100407_steer_item_out_part-00000&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12441008/20100407_steer_item_out_part-00000&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;2) the recommendation count in the output file exceeds the expected count sometimes&lt;/p&gt;

&lt;p&gt;I want 10 recommendations, the file &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12441008/20100407_steer_item_out_part-00000&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12441008/20100407_steer_item_out_part-00000&lt;/a&gt; ,it&apos;s more sometimes&lt;/p&gt;

&lt;p&gt;3) it seems that it  not take the max N items  some times, you can see in the log file &lt;/p&gt;

&lt;p&gt;4) the log seems right ,but the final output file is wrong (negative  and count)&lt;/p&gt;

&lt;p&gt;5) when use Text as output class ,there is no negative ,the recommendation count also is right. &lt;/p&gt;

&lt;p&gt;UserID is ok now .&lt;/p&gt;</comment>
                            <comment id="12854438" author="huiwenhan" created="Wed, 7 Apr 2010 12:58:26 +0100"  >&lt;p&gt;input file  &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12441022/2010_input_steer_item_in_prefs-1.dat&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12441022/2010_input_steer_item_in_prefs-1.dat&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12854445" author="srowen" created="Wed, 7 Apr 2010 13:14:31 +0100"  >&lt;p&gt;1) Your input file shows negative user and item IDs, good, so that is as expected.  The HTML log file you posted also does not show negative values. This is all good.&lt;/p&gt;

&lt;p&gt;2) I can&apos;t quite see why this would happen &amp;#8211;  you see how the code adds, then removes, one item each time when the queue is full. However I just made one change to the Comparator which &lt;b&gt;could&lt;/b&gt; be related. You might try the new code to see if it addresses this.&lt;/p&gt;

&lt;p&gt;3) Same, I am wondering if the comparator is the problem here.&lt;/p&gt;

&lt;p&gt;4 + 5) I agree, and while this is very strange, it seems all your evidence points to this. Can you try my latest code? It still uses a custom writable, but, it uses the exact same to-string routine that the working example does.&lt;/p&gt;

&lt;p&gt;If this does not somehow address the issues, I&apos;ll give up and use Text. This shouldn&apos;t be necesary, and is incorrect from an API perspective, but something working is better than nothing.&lt;/p&gt;</comment>
                            <comment id="12854452" author="ssc" created="Wed, 7 Apr 2010 13:25:40 +0100"  >&lt;p&gt;My results looked kinda strange (maybe I got something wrong?), here&apos;s a sample output line with negative values:&lt;/p&gt;

&lt;p&gt;4725	&lt;span class=&quot;error&quot;&gt;&amp;#91;194614:8.0,178574:8.0,126959:8.0,586593851465007104:7.9832724E-28,448135168:0.0,554696704:0.0,851312640:2.92E-42,4734:0.0,26020003446784:0.0,88808125104128:0.0,143032087216128:4.9351955E-34,310771712:0.0,4192923752129888256:0.0,4211782575569502208:0.0,4678749561932482596:0.0,20431159427072:2.3857E-41,4688247212092686336:8.876E-42,4665729213955833856:8.708E-42,4665729214092410880:0.0,1339257939189301248:2.6403101E-15,0:2.9293609E10,1:1.0442734E-4,8950711844864:6.679E-42,13535:16.0,64277:16.0,69153:16.0,586593851465007104:1.0917835E-27,976241224:0.0,617497120:0.0,1011106336:2.92E-42,4789:0.0,31228707209216:0.0,526558695522304:0.0,49065706389504:4.9351955E-34,314441728:0.0,1592866893205602304:0.0,4088986986675699712:0.0,-7932527793659705308:0.0,20637317857280:1.10651E-40,0:2.14E-42,0:1.19384E-40,136577024:0.0,1354739062908387329:-4.42924794E11,1:1.1437698E-35,1:1000460.0,8950711844864:6.746E-42,95556:10.0,95899:10.0,57319:10.0,586593851465007104:1.3505299E-27,302858528:0.0,1941520672:0.0,851312640:2.92E-42,4830:0.0,242048263258112:0.0,24366435794944:0.0,37370510442496:4.9351955E-34,317063168:0.0,2955840336133357568:1.4E-45,-7583708691820445696:1.4E-45,-7581738366983469020:0.0,20813411516416:1.8913E-41,0:1.1453E-41,0:2.1608E-41,136577024:0.0,1365998061976813570:1.4776256E22,1:5.119846E-28,2:4.1850966E-16,8950711844864:6.81E-42,64277:28.0,9896:8.0,3413:8.0,586593851465007104:1.6408307E-27,187580704:0.0,3670688032:0.0,9150873888:2.92E-42,4873:0.0,8199092568064:0.0,17575006175232:0.0,124906238902272:4.9351955E-34,319946752:1.4E-45,-8312447406524334080:1.4E-45,7469291587688726528:0.0,7912896013545768996:0.0,20998095110144:9.0071E-41,4701758010974797824:3.6774E-41,4683743612465315840:3.9393E-41,4683743612601892864:0.0,1378101485975371776:3.0353137E-30,1:2.05131665E13,1:-5.0857293E-33,8950711844864:6.869E-42,59216:0.0,116360:0.0,157916:0.0,586593851465007104:2.1709452E-27,803487936:0.0,2247311552:0.0,1256407232:2.92E-42,4916:0.0,36443890122752:0.0,42048822444032:0.0,53443370680320:4.9351955E-34,322699264:0.0,-7921760551166803968:0.0,1148417904979476480:0.0,2630102182384371748:0.0,21152713932800:2.8324E-41,4692750811720056832:1.37956E-40,4692750811720056832:4.403E-41,4692750811856633856:0.0,1388516060113666048:126.626465,1:-4.649059E-16,0:5.2475385E-17,8950711844864:6.934E-42,30298:10.0,6835:10.0,30668:10.0,586593851465007104:2.802034E-27,1062420672:0.0,766525632:0.0,1404453056:2.92E-42,4966:0.0,71154723192832:0.0,71373766524928:0.0,17987323035648:4.9351955E-34,326303744:0.0,8632346981731139584:0.0,5418464838655410176:2.8E-45&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="12854453" author="huiwenhan" created="Wed, 7 Apr 2010 13:28:55 +0100"  >&lt;p&gt;please see the screen shot ,&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12441026/screenshot-3.jpg&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12441026/screenshot-3.jpg&lt;/a&gt;&lt;br/&gt;
the value of the final output has negative .&lt;/p&gt;

&lt;p&gt;it may been caused by hadoop , &lt;br/&gt;
maybe in the intermediate phase ,it read and write the float value using write and readFields mothod,&lt;br/&gt;
it use toString method just in the final output .&lt;/p&gt;</comment>
                            <comment id="12854473" author="srowen" created="Wed, 7 Apr 2010 14:02:14 +0100"  >&lt;p&gt;Yes, looks like the same kind of output you posted earlier. Are you using my latest changes?&lt;br/&gt;
Sebastian I&apos;m also very puzzled. It does not seem to be sorted by number, when it is sorted by number in the code. Again try  my very latest change, which I have some reason to suspect would address this. Still pretty confused.&lt;/p&gt;</comment>
                            <comment id="12854482" author="huiwenhan" created="Wed, 7 Apr 2010 14:17:27 +0100"  >&lt;p&gt;hi,Sean&lt;/p&gt;

&lt;p&gt;maybe we need order it in the reduce job and need a reduce implementation .&lt;/p&gt;

&lt;p&gt;maybe map/reduce ruffle the data in the IdentityReducer phase.&lt;/p&gt;</comment>
                            <comment id="12854485" author="huiwenhan" created="Wed, 7 Apr 2010 14:20:37 +0100"  >&lt;p&gt;I tested using the latest code ,it also has negative.&lt;/p&gt;

&lt;p&gt;-8014130140593843068	&lt;span class=&quot;error&quot;&gt;&amp;#91;576620340710744639:-1.2199921E-19,-7951291328374999828:7.480107E-34,48126569744862489:2.384486E23,5238530791562049439:-18.706377,-6651253699672801114:-12.196953,-464715186549278845:1.880351E-20,-6440428942116472673:4.77204192E8,6438740092256274461:-0.0019952098,2643050031313122095:-1.2318361E30,2426032824269149291:-7.472027E35,-2169609120485731243:7.746303E31,-382524493349727536:3.1660177E-28,5087097254091687936:-7.0834307E-28,8301497619465671266:2.3044203E-31,8927269159904309646:2.7101177E27,610401645634619257:-1.3781605E-35,7370696371201048576:4.2912E-41,-4497505405333536768:2.33E-43,-4520727025047240704:1.9914E-41,2211716127952666624:6.623E-41,5612484004861902848:2.587E-41,-4971197659777990656:8.7238E-41,-1046870931778371584:7.325E-42,-355810823770996736:7.294E-42,8391453106506891264:7.5625E-41,1281462743019880448:2.87E-42,-7664059664162844430:3.8694505E-34,1057106694599084032:-6.377059E-25,3248152683699541900:4.2230997E-33,1054050648184134457:2.0395964E-7,5914024482073:8.073283E-22,3405161408365:3.4245277E-22,8798656774456:3.4267796E-35,576628966068045048:-1.6564941,-7382777955725068574:3.869972E-34,-189248019257882624:-1.3256971E-21,4288551937843961224:5.8435236E-11,-3577538155243191233:-4.1629006E-5,576636419702957968:7.3060636E21,-6729228338123451142:3.8709957E-34,-8208622251512428544:-4.9206086E-17,692388284898256100:-1.6553918E-10,501597207358536840:4.2866007E27,610419878133971201:-1.0265883E-29,2211716127952683022:1.2700088E-26,7370696371201048576:4.2912E-41,-4497505405333536768:2.33E-43,-4520727025047240704:8.7238E-41,-1046870931778371584:6.623E-41,5612484004861902848:2.587E-41&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="12854516" author="ssc" created="Wed, 7 Apr 2010 15:31:27 +0100"  >&lt;p&gt;I updated to revision 931566 and everything looks fine now!&lt;/p&gt;</comment>
                            <comment id="12854530" author="huiwenhan" created="Wed, 7 Apr 2010 15:47:32 +0100"  >&lt;p&gt;I see the latest is 931569&lt;/p&gt;</comment>
                            <comment id="12854568" author="huiwenhan" created="Wed, 7 Apr 2010 17:01:05 +0100"  >&lt;p&gt;it&apos;s very good now,thanks Sean! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;only one little issue ,can ignore line that has no recommendations ?&lt;/p&gt;

&lt;p&gt;-2146704409350804772	&lt;span class=&quot;error&quot;&gt;&amp;#91;-5143306609724270245:0.0,-6887672525304767274:0.0,-7869337437647864448:0.0,1143520528292887196:0.0,4565256005884091248:0.0,-403573745216718449:0.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
-2140684086652787668	&lt;span class=&quot;error&quot;&gt;&amp;#91;5066321748533664330:3.33,-6196380629601347193:2.22,1388936500341917293:2.22,-5143306609724270245:2.22,-6887672525304767274:2.22,-403573745216718449:2.22,4000074642144994975:0.0,1471545749001003492:0.0,8619821060300841906:0.0,-8796495370659715938:0.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
-2087578807957211564	&lt;span class=&quot;error&quot;&gt;&amp;#91;3693944382462874249:0.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
-2084997234534227590	[]&lt;br/&gt;
-1994184181161252808	[]&lt;br/&gt;
-1956807977260853620	[]&lt;br/&gt;
-1905139778468734800	[]&lt;br/&gt;
-1897443610249479948	[]&lt;br/&gt;
-1861747039795463904	[]&lt;br/&gt;
-1783644832320395644	[]&lt;br/&gt;
-1759587438285537664	[]&lt;br/&gt;
-1598157027497721376	[]&lt;br/&gt;
-1524111942416072322	[]&lt;br/&gt;
-1508995658783890206	[]&lt;br/&gt;
-1478238285808155750	[]&lt;br/&gt;
-1473372051895027798	[]&lt;br/&gt;
-1360993164612489840	[]&lt;br/&gt;
-1170376071408489552	&lt;span class=&quot;error&quot;&gt;&amp;#91;-8608197272004918866:0.0,-8235449048613678861:0.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
-1106281807063652538	[]&lt;/p&gt;

&lt;p&gt;It seems that &lt;br/&gt;
vector.iterateNonZero() can not skip the zero value.&lt;/p&gt;

&lt;p&gt;also in UserVectorToCooccurrenceReducer, the following code seems does not need. &lt;br/&gt;
because some user has little preferences,if we purge here ,maybe he can not get recommendation. &lt;/p&gt;

&lt;p&gt;      Iterator&amp;lt;Vector.Element&amp;gt; cooccurrences = cooccurrenceRow.iterateNonZero();&lt;br/&gt;
      while (cooccurrences.hasNext()) {&lt;br/&gt;
        Vector.Element element = cooccurrences.next();&lt;br/&gt;
        if (element.get() &amp;lt;= 1.0) &lt;/p&gt;
{ // purge small values
          element.set(0.0);
        }
&lt;p&gt;      }&lt;/p&gt;
</comment>
                            <comment id="12854578" author="srowen" created="Wed, 7 Apr 2010 17:20:14 +0100"  >&lt;p&gt;Great. Thanks much to both of you for your help in debugging this. Obviously it was a pretty subtle issue. This has been very helpful.&lt;/p&gt;

&lt;p&gt;I changed it to not output recs when the list is empty, sure.&lt;/p&gt;</comment>
                            <comment id="12854580" author="huiwenhan" created="Wed, 7 Apr 2010 17:26:09 +0100"  >&lt;p&gt;what&apos;s the reason ? cause by  PriorityQueue?&lt;/p&gt;</comment>
                            <comment id="12854587" author="srowen" created="Wed, 7 Apr 2010 17:38:54 +0100"  >&lt;p&gt;I think the cause must have been related to the PriorityQueue. GenericRecommendedItem implemented Comparable. The problem may have been that it wasn&apos;t quite consistent with equals() since it was determined only on value, not item ID. I switched to a Comparator to implement ordering. I&apos;m still surprised if that was the difference...&lt;/p&gt;

&lt;p&gt;I also tried in a few places using a brand new local Writable object to read values instead of reusing one. I figured maybe I mistook when that was safe to do.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12441008" name="20100407_steer_item_out_part-00000" size="1939446" author="huiwenhan" created="Wed, 7 Apr 2010 09:45:19 +0100"/>
                            <attachment id="12441022" name="2010_input_steer_item_in_prefs-1.dat" size="35304" author="huiwenhan" created="Wed, 7 Apr 2010 12:58:26 +0100"/>
                            <attachment id="12441007" name="attempt_201004011623_0070_m_000000_0.htm" size="247738" author="huiwenhan" created="Wed, 7 Apr 2010 09:45:19 +0100"/>
                            <attachment id="12440601" name="screenshot-1.jpg" size="405359" author="huiwenhan" created="Fri, 2 Apr 2010 09:24:48 +0100"/>
                            <attachment id="12440890" name="screenshot-2.jpg" size="246551" author="huiwenhan" created="Tue, 6 Apr 2010 14:08:19 +0100"/>
                            <attachment id="12441026" name="screenshot-3.jpg" size="452455" author="huiwenhan" created="Wed, 7 Apr 2010 13:21:21 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 2 Apr 2010 10:45:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9707</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy5lz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23060</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>