<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:28:42 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-473/MAHOUT-473.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-473] add parameter -Dmapred.reduce.tasks when call job RowSimilarityJob in RecommenderJob</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-473</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;In RecommenderJob&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;RecommenderJob.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numberOfUsers = TasteHadoopUtils.readIntFromFile(getConf(), countUsersPath);

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (shouldRunNextPhase(parsedArgs, currentPhase)) {
      /* Once DistributedRowMatrix uses the hadoop 0.20 API, we should refactor &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; call to something like
       * &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DistributedRowMatrix(...).rowSimilarity(...) */
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        RowSimilarityJob.main(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] { &lt;span class=&quot;code-quote&quot;&gt;&quot;-Dmapred.input.dir=&quot;&lt;/span&gt; + maybePruneItemUserMatrixPath.toString(),
            &lt;span class=&quot;code-quote&quot;&gt;&quot;-Dmapred.output.dir=&quot;&lt;/span&gt; + similarityMatrixPath.toString(), &lt;span class=&quot;code-quote&quot;&gt;&quot;--numberOfColumns&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(numberOfUsers), &lt;span class=&quot;code-quote&quot;&gt;&quot;--similarityClassname&quot;&lt;/span&gt;, similarityClassname, &lt;span class=&quot;code-quote&quot;&gt;&quot;--maxSimilaritiesPerRow&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(maxSimilaritiesPerItemConsidered + 1), &lt;span class=&quot;code-quote&quot;&gt;&quot;--tempDir&quot;&lt;/span&gt;, tempDirPath.toString() });
      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(&lt;span class=&quot;code-quote&quot;&gt;&quot;item-item-similarity computation failed&quot;&lt;/span&gt;, e);
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We have not passed parameter -Dmapred.reduce.tasks when job RowSimilarityJob.&lt;br/&gt;
It caused all three  RowSimilarityJob sub-jobs run using 1 map and 1 reduce, so the sub jobs can not be scalable.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12471490">MAHOUT-473</key>
            <summary>add parameter -Dmapred.reduce.tasks when call job RowSimilarityJob in RecommenderJob</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="srowen">Sean Owen</assignee>
                                    <reporter username="huiwenhan">Han Hui Wen </reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Aug 2010 06:07:24 +0100</created>
                <updated>Sat, 21 May 2011 04:22:29 +0100</updated>
                            <resolved>Fri, 13 Aug 2010 12:13:18 +0100</resolved>
                                    <version>0.4</version>
                                                    <component>Collaborative Filtering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12898084" author="ssc" created="Fri, 13 Aug 2010 06:13:52 +0100"  >&lt;p&gt;Hui,&lt;/p&gt;

&lt;p&gt;can you supply a .patch file?&lt;/p&gt;

&lt;p&gt;This page tells in detail how to do this: &lt;a href=&quot;https://cwiki.apache.org/confluence/display/MAHOUT/How+To+Contribute&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://cwiki.apache.org/confluence/display/MAHOUT/How+To+Contribute&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12898087" author="huiwenhan" created="Fri, 13 Aug 2010 06:32:46 +0100"  >&lt;p&gt;RowSimilarity can not be scalable&lt;/p&gt;</comment>
                            <comment id="12898093" author="ssc" created="Fri, 13 Aug 2010 06:46:41 +0100"  >&lt;p&gt;Hui,&lt;/p&gt;

&lt;p&gt;Can you follow these steps on this issue:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Modify your local copy of mahout to include the changes you propose&lt;/li&gt;
	&lt;li&gt;build Mahout and run your job again with your modified version&lt;/li&gt;
	&lt;li&gt;upload a patch containing your changes and give us some details on the performance increase you encountered&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Have a look at this website: &lt;a href=&quot;https://cwiki.apache.org/confluence/display/MAHOUT/How+To+Contribute&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://cwiki.apache.org/confluence/display/MAHOUT/How+To+Contribute&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12898176" author="huiwenhan" created="Fri, 13 Aug 2010 11:26:14 +0100"  >&lt;p&gt;added patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12452011/patch_985097.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12452011/patch_985097.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12898183" author="srowen" created="Fri, 13 Aug 2010 12:13:18 +0100"  >&lt;p&gt;It is up to the Hadoop cluster, and the caller, to set values like this.&lt;/p&gt;</comment>
                            <comment id="12898193" author="huiwenhan" created="Fri, 13 Aug 2010 12:35:51 +0100"  >&lt;p&gt;Because RowSimilarityJob run a in separated process ,the properties will lost from the main Job.&lt;/p&gt;

&lt;p&gt;The properties must be set by the RecommenderJob&lt;/p&gt;</comment>
                            <comment id="12898343" author="srowen" created="Fri, 13 Aug 2010 18:56:00 +0100"  >&lt;p&gt;I am not sure what you mean. Settings like &quot;-Dmapred.reduce.tasks&quot; are parameters for Hadoop, not the Mahout job. They are passed on the command line to Hadoop and processed. Hadoop passes them to Mahout, but Mahout doesn&apos;t care about this value usually. But no, they are available.&lt;/p&gt;

&lt;p&gt;You&apos;d have to provide a clear description and patch of what you think the problem is if you think there is still an issue here.&lt;/p&gt;</comment>
                            <comment id="12898939" author="huiwenhan" created="Mon, 16 Aug 2010 15:05:17 +0100"  >&lt;p&gt;1) First  mapred.tasktracker.map.tasks.maximum in  mapred-site.xml is different from  -Dmapred.reduce.tasks in command line or mapred.reduce.tasks in mapred-site.xml .&lt;/p&gt;

&lt;p&gt;The maximum number of map tasks that will be run on a tasktracker at one time is&lt;br/&gt;
controlled by the mapred.tasktracker.map.tasks.maximum property, which defaults to&lt;br/&gt;
two tasks. There is a corresponding property for reduce tasks, mapred.task&lt;br/&gt;
tracker.reduce.tasks.maximum, which also defaults to two tasks.&lt;/p&gt;

&lt;p&gt;mapred.reduce.tasks configures in  mapred-site.xml,the default value is 1.&lt;br/&gt;
Options specified with -D take priority over properties from the configuration&lt;br/&gt;
files. This is very useful: you can put defaults into configuration files, and then override&lt;br/&gt;
them with the -D option as needed. A common example of this is setting the number&lt;br/&gt;
of reducers for a MapReduce job via -D mapred.reduce.tasks=n. This will override the&lt;br/&gt;
number of reducers set on the cluster, or if set in any client-side configuration files.&lt;/p&gt;


&lt;p&gt;Job Initialization&lt;br/&gt;
When the JobTracker receives a call to its submitJob() method, it puts it into an internal&lt;br/&gt;
queue from where the job scheduler will pick it up and initialize it. Initialization involves&lt;br/&gt;
creating an object to represent the job being run, which encapsulates its tasks, and&lt;br/&gt;
bookkeeping information to keep track of the tasks&apos; status and progress .&lt;br/&gt;
To create the list of tasks to run, the job scheduler first retrieves the input splits computed&lt;br/&gt;
by the JobClient from the shared filesystem . It then creates one map task&lt;br/&gt;
for each split. The number of reduce tasks to create is determined by the&lt;br/&gt;
mapred.reduce.tasks property in the JobConf, which is set by the setNumReduce&lt;br/&gt;
Tasks() method, and the scheduler simply creates this number of reduce tasks to be&lt;br/&gt;
run. Tasks are given IDs at this point.&lt;/p&gt;

&lt;p&gt; mapred.reduce.tasks can be configured  file mapred-site.xml  ,but mapred.reduce.tasks in  file mapred-site.xml is used for all reducer JOBs.&lt;br/&gt;
we have all kinds of Job,they have different different data size,different priority.we can not change the mapred-site.xml  file continually.so we need -Dmapred.reduce.tasks parameter in command line to override the  configuration file.&lt;/p&gt;

&lt;p&gt;2)  Parameter like &quot;-Dmapred.reduce.tasks&quot;  passed the RecommenderJob Can not pass to RowSimilarity,&lt;br/&gt;
Because  RowSimilarityJob started another new AbstractJob. RowSimilarityJob  run in a new process, parameters passed to RecommenderJob  can not passed to RowSimilarityJob.&lt;/p&gt;

&lt;p&gt;If we passed -Dmapred.reduce.tasks=6 to RecommenderJob ,all sub jobs (like itemIDIndex,toUserVector,countUsers,itemUserMatrix,maybePruneItemUserMatrix,prePartialMultiply1,prePartialMultiply2,partialMultiply,aggregateAndRecommend) work correctly ,but Job RowSimilarityJob in a new context ,parameter  -Dmapred.reduce.tasks=6 lost when Call RowSimilarityJob ,&lt;br/&gt;
So All 3 sub-jobs of RowSimilarityJob (weights,pairwiseSimilarity,asMatrix) can only run using one reducer.&lt;/p&gt;

</comment>
                            <comment id="12898950" author="huiwenhan" created="Mon, 16 Aug 2010 15:39:38 +0100"  >&lt;p&gt;The Patch as folowing&lt;/p&gt;

&lt;p&gt;In RecommenderJob&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    Job job = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Job(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Configuration(getConf()));
+    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numReduceTasks= job.getNumReduceTasks();


       &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
         RowSimilarityJob.main(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] { &lt;span class=&quot;code-quote&quot;&gt;&quot;-Dmapred.input.dir=&quot;&lt;/span&gt; + maybePruneItemUserMatrixPath.toString(),
            &lt;span class=&quot;code-quote&quot;&gt;&quot;-Dmapred.output.dir=&quot;&lt;/span&gt; + similarityMatrixPath.toString(), &lt;span class=&quot;code-quote&quot;&gt;&quot;--numberOfColumns&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(numberOfUsers), &lt;span class=&quot;code-quote&quot;&gt;&quot;--similarityClassname&quot;&lt;/span&gt;, similarityClassname, &lt;span class=&quot;code-quote&quot;&gt;&quot;--maxSimilaritiesPerRow&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(maxSimilaritiesPerItemConsidered + 1), &lt;span class=&quot;code-quote&quot;&gt;&quot;--tempDir&quot;&lt;/span&gt;, tempDirPath.toString() });
            &lt;span class=&quot;code-quote&quot;&gt;&quot;-Dmapred.output.dir=&quot;&lt;/span&gt; + similarityMatrixPath.toString(), 
+            &lt;span class=&quot;code-quote&quot;&gt;&quot;-Dmapred.reduce.tasks=&quot;&lt;/span&gt; + numReduceTasks,
           &lt;span class=&quot;code-quote&quot;&gt;&quot;--numberOfColumns&quot;&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(numberOfUsers), 
            &lt;span class=&quot;code-quote&quot;&gt;&quot;--similarityClassname&quot;&lt;/span&gt;, similarityClassname, 
            &lt;span class=&quot;code-quote&quot;&gt;&quot;--maxSimilaritiesPerRow&quot;&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(maxSimilaritiesPerItemConsidered + 1), 
            &lt;span class=&quot;code-quote&quot;&gt;&quot;--tempDir&quot;&lt;/span&gt;, tempDirPath.toString() });
       } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
         &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(&lt;span class=&quot;code-quote&quot;&gt;&quot;item-item-similarity computation failed&quot;&lt;/span&gt;, e);
       }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12898964" author="srowen" created="Mon, 16 Aug 2010 16:29:42 +0100"  >&lt;p&gt;I understand. The better change is to actually instantiate and run RowSimilarityJob within RecommenderJob, but before running, pass its Configuration &quot;conf&quot; property object to the child job. Then I think it all works. Sebastian do you mind trying this?&lt;/p&gt;</comment>
                            <comment id="12898970" author="huiwenhan" created="Mon, 16 Aug 2010 16:54:14 +0100"  >&lt;p&gt;yep, running RowSimilarityJob within RecommenderJob is better, otherwise other -D parameters also will lose.&lt;/p&gt;</comment>
                            <comment id="12899761" author="ssc" created="Wed, 18 Aug 2010 08:12:14 +0100"  >&lt;p&gt;Should be working now, can you give it a try Han Hui?&lt;/p&gt;</comment>
                            <comment id="12899800" author="hudson" created="Wed, 18 Aug 2010 10:29:14 +0100"  >&lt;p&gt;Integrated in Mahout-Quality #200 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Mahout-Quality/200/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/Mahout-Quality/200/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-473&quot; title=&quot;add parameter -Dmapred.reduce.tasks when call job RowSimilarityJob in RecommenderJob&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-473&quot;&gt;&lt;del&gt;MAHOUT-473&lt;/del&gt;&lt;/a&gt; add parameter -Dmapred.reduce.tasks when call job RowSimilarityJob in RecommenderJob&lt;/p&gt;</comment>
                            <comment id="12899927" author="huiwenhan" created="Wed, 18 Aug 2010 18:42:53 +0100"  >&lt;p&gt;It can work now ,the -D parameter can pass to RowSimilarityJob .&lt;br/&gt;
Thanks,Sebastian Schelter.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12452370" name="MAHOUT-473.patch" size="3107" author="ssc" created="Wed, 18 Aug 2010 08:10:12 +0100"/>
                            <attachment id="12451995" name="screenshot-1.jpg" size="262845" author="huiwenhan" created="Fri, 13 Aug 2010 06:32:46 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 13 Aug 2010 05:13:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9590</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy4wf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22945</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>