<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:16:03 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MAHOUT-594/MAHOUT-594.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MAHOUT-594] FileWriter may garble non-ASCII output if the environment variable LANG/LC_ALL is not appropriate.</title>
                <link>https://issues.apache.org/jira/browse/MAHOUT-594</link>
                <project id="12310751" key="MAHOUT">Mahout</project>
                    <description>&lt;p&gt;For non-ASCII output data, java.io.FileWriter should be replaced with java.io.OutputStreamWriter in UTF-8.&lt;/p&gt;

&lt;p&gt;For example, if you dump centroids of clusters using ClusterDumper, you may get the following output:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;...
C-0{n=2 c=[brown:2.099, c?t:1.957, dogs:1.916, fox:0.652, jumped:2.099, l?zy:1.884, over:2.099, quick:2.099, red:1.916, ?:0.871, ?:0.871, ?:0.871, ?:0.871] r=[c?t:0.652, fox:0.652, l?zy:1.131, ?:0.871, ?:0.871, ?:0.871, ?:0.871]}
    Top Terms:
        quick                                   =&amp;gt;  2.0986123085021973
        over                                    =&amp;gt;  2.0986123085021973
        jumped                                  =&amp;gt;  2.0986123085021973
        brown                                   =&amp;gt;  2.0986123085021973
        c?t                                     =&amp;gt;   1.957078456878662
        red                                     =&amp;gt;  1.9162907600402832
        dogs                                    =&amp;gt;  1.9162907600402832
        l?zy                                    =&amp;gt;  1.8843144178390503
        ?                                       =&amp;gt;  0.8706584572792053
        ?                                       =&amp;gt;  0.8706584572792053
    Weight:  Point:
    1.0: P(0) = [brown:2.099, dogs:1.916, fox:2.609, jumped:2.099, over:2.099, quick:2.099, red:1.916, ?:2.322, ?:2.322, ?:2.322, ?:2.322]
    1.0: P(1) = [brown:2.099, dogs:1.916, fox:2.609, jumped:2.099, over:2.099, quick:2.099, red:1.916, ?:2.322, ?:2.322, ?:2.322, ?:2.322]
    1.0: P(2) = [brown:2.099, c?t:2.609, dogs:1.916, jumped:2.099, over:2.099, quick:2.099, red:1.916, ?:2.322, ?:2.322, ?:2.322, ?:2.322]
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where &quot;?&quot; characters were garbled by FileWriter. NOTE: this test case is a tweaked version of TestClusterDumper. E.g., lazy =&amp;gt; l&#228;zy&lt;/p&gt;

&lt;p&gt;The cause of this is the line in ClusterDumper.java:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Writer writer = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.outputFile == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OutputStreamWriter(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out) : &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileWriter(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.outputFile);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This can be around by setting the environment variables LC_ALL/LANG to en_US.UTF-8, but many environments have LC_ALL/LANG=C by default, and in some cases, you even may not have choices but C for various reasons.&lt;/p&gt;

&lt;p&gt;To address this issue, I would like to propose to hard code the output encoding to UTF-8 as follows:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Writer writer = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.outputFile == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OutputStreamWriter(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out) : &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OutputStreamWriter(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.outputFile), UTF8);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This way, the output file encoding will not be affected by environments.&lt;/p&gt;

&lt;p&gt;And if this proposal is agreed, a similar fix should be applied to the following files:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;./core/src/main/java/org/apache/mahout/classifier/sgd/ModelSerializer.java&lt;/li&gt;
	&lt;li&gt;./core/src/test/java/org/apache/mahout/fpm/pfpgrowth/PFPGrowthTest.java&lt;/li&gt;
	&lt;li&gt;./examples/src/main/java/org/apache/mahout/classifier/sgd/TrainLogistic.java&lt;/li&gt;
	&lt;li&gt;./examples/src/main/java/org/apache/mahout/clustering/display/DisplaySpectralKMeans.java&lt;/li&gt;
	&lt;li&gt;./utils/src/main/java/org/apache/mahout/clustering/lda/LDAPrintTopics.java&lt;/li&gt;
	&lt;li&gt;./utils/src/main/java/org/apache/mahout/utils/SequenceFileDumper.java&lt;/li&gt;
	&lt;li&gt;./utils/src/main/java/org/apache/mahout/utils/clustering/ClusterDumper.java&lt;/li&gt;
	&lt;li&gt;./utils/src/main/java/org/apache/mahout/utils/vectors/VectorDumper.java&lt;/li&gt;
	&lt;li&gt;./utils/src/main/java/org/apache/mahout/utils/vectors/arff/Driver.java&lt;/li&gt;
	&lt;li&gt;./utils/src/main/java/org/apache/mahout/utils/vectors/lucene/ClusterLabels.java&lt;/li&gt;
	&lt;li&gt;./utils/src/main/java/org/apache/mahout/utils/vectors/lucene/Driver.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Hope not many folks prefer ISO-8859-1 or other &apos;legacy&apos; character sets.&lt;/p&gt;</description>
                <environment>&lt;p&gt;RHL Linux 2.6.18&lt;/p&gt;</environment>
        <key id="12496640">MAHOUT-594</key>
            <summary>FileWriter may garble non-ASCII output if the environment variable LANG/LC_ALL is not appropriate.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean Owen</assignee>
                                    <reporter username="smtakeda">Shige Takeda</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Jan 2011 08:09:44 +0000</created>
                <updated>Sat, 21 May 2011 04:18:50 +0100</updated>
                            <resolved>Wed, 26 Jan 2011 23:22:46 +0000</resolved>
                                    <version>0.4</version>
                                    <fixVersion>0.5</fixVersion>
                                    <component>Integration</component>
                        <due>Fri, 4 Feb 2011 05:00:00 +0000</due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12986297" author="srowen" created="Tue, 25 Jan 2011 09:45:55 +0000"  >&lt;p&gt;Agreed, this change should be made across the board. Nothing should depend on the platform encoding. Do you have a patch?&lt;/p&gt;</comment>
                            <comment id="12986409" author="smtakeda" created="Tue, 25 Jan 2011 14:52:34 +0000"  >&lt;p&gt;I had one for ClusterDumper. Let me try changing all of them.&lt;/p&gt;</comment>
                            <comment id="12987123" author="smtakeda" created="Wed, 26 Jan 2011 18:01:43 +0000"  >&lt;p&gt;In order to minimize the change, I introduced FileWriterUTF8 and FileReaderUTF8 so that all necessary parts just require to replace FileWriter/FileReader with FileWriterUTF8/FileReaderUTF8. &lt;/p&gt;

&lt;p&gt;No additional test case is added, though, no break in the existing test cases are confirmed.&lt;/p&gt;</comment>
                            <comment id="12987285" author="srowen" created="Wed, 26 Jan 2011 23:22:46 +0000"  >&lt;p&gt;I committed a variant on your patch which does the same thing in a different way. Forgive me. I wanted to make some related changes around those lines anyway so found it easier to create my own rendition. There is no more use of FileWriter and FileReader, and that&apos;s good.&lt;/p&gt;</comment>
                            <comment id="12987312" author="smtakeda" created="Thu, 27 Jan 2011 00:30:36 +0000"  >&lt;p&gt;no problem as long as this issue is addressed. thanks!&lt;/p&gt;</comment>
                            <comment id="12987338" author="hudson" created="Thu, 27 Jan 2011 01:38:04 +0000"  >&lt;p&gt;Integrated in Mahout-Quality #588 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Mahout-Quality/588/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/Mahout-Quality/588/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MAHOUT-594&quot; title=&quot;FileWriter may garble non-ASCII output if the environment variable LANG/LC_ALL is not appropriate.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAHOUT-594&quot;&gt;&lt;del&gt;MAHOUT-594&lt;/del&gt;&lt;/a&gt; Replace FileWriter and FileReader usage with idiom that properly specifies character encoding&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12469449" name="0001-set-file-reader-and-writer-character-encoding-to-utf.patch" size="32063" author="smtakeda" created="Wed, 26 Jan 2011 17:59:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 25 Jan 2011 09:45:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9467</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxy45j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22824</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>