Just to check expectations, here is a patch with just one unit test. 