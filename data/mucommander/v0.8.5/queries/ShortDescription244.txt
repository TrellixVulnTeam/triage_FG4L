Encoding detection not working as it should in text viewer/editor