nested queries in function query