<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:19:05 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-1004/SOLR-1004.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-1004] Optimizing the abort command in delta import</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1004</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I have seen that when abort command is called in a deltaImport, in DocBuilder.java, at doDelta functions it&apos;s just checked for abortion at the begining of collectDelta, after that function and at the end of collectDelta.&lt;br/&gt;
The problem I have found is that if there is a big number of documents to modify and abort is called in the middle of delta collection, it will not take effect until all data is collected.&lt;br/&gt;
Same happens when we start deleteting or updating documents. In updating case, there is an abortion check inside buildDocument but, as it is called inside a &quot;while&quot; for all docs to update, it will keep going throw all docs of the bucle and skipping them.&lt;br/&gt;
I propose to do an abortion check inside every loop of data collection and after calling build document in doDelta function.&lt;/p&gt;

&lt;p&gt;In the case of modifing documents, the code in DocBuilder.java would look like:&lt;/p&gt;

&lt;p&gt;    while (pkIter.hasNext()) {&lt;br/&gt;
      Map&amp;lt;String, Object&amp;gt; map = pkIter.next();&lt;br/&gt;
      vri.addNamespace(DataConfig.IMPORTER_NS + &quot;.delta&quot;, map);&lt;br/&gt;
      buildDocument(vri, null, map, root, true, null);&lt;br/&gt;
      pkIter.remove();&lt;br/&gt;
      //check if abortion&lt;br/&gt;
      if (stop.get())&lt;/p&gt;
      {
            allPks = null ;
            pkIter = null ;
            return;
        }     
&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;In the case of document deletion (deleteAll function in DocBuilder): Just       if (stop.get())&lt;/p&gt;
{ break ; }
&lt;p&gt;     at the end of every loop and call this just after deleteAll is called (in doDelta)&lt;br/&gt;
      if (stop.get())&lt;/p&gt;
      {
            allPks = null;
            deletedKeys = null;
            return;

       }

&lt;p&gt;Finally in collect delta:&lt;/p&gt;

&lt;p&gt;      while (true) {&lt;br/&gt;
         //check for abortion&lt;br/&gt;
         if (stop.get())&lt;/p&gt;
{ return myModifiedPks; }
&lt;p&gt;         Map&amp;lt;String, Object&amp;gt; row = entityProcessor.nextModifiedRowKey();&lt;/p&gt;

&lt;p&gt;         if (row == null)&lt;br/&gt;
           break;&lt;br/&gt;
           ...&lt;/p&gt;

&lt;p&gt;And the same for delete-query collection and parent-delta-query collection&lt;/p&gt;

&lt;p&gt;I didn&apos;t atach de patch because is the first time I open an issue and don&apos;t know if you want to code it as I do. Just wanted to explain the idea and how I solved, I think it can be useful for other users.&lt;/p&gt;

</description>
                <environment>&lt;p&gt;Java - Lucene - Solr - DataImportHandler&lt;/p&gt;</environment>
        <key id="12413869">SOLR-1004</key>
            <summary>Optimizing the abort command in delta import</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalinmangar">Shalin Shekhar Mangar</assignee>
                                    <reporter username="sturlese">Marc Sturlese</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Feb 2009 12:18:00 +0000</created>
                <updated>Tue, 10 Nov 2009 15:51:56 +0000</updated>
                            <resolved>Thu, 19 Feb 2009 05:43:37 +0000</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.4</fixVersion>
                                    <component>contrib - DataImportHandler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <timeoriginalestimate seconds="1800">0.5h</timeoriginalestimate>
                            <timeestimate seconds="1800">0.5h</timeestimate>
                                        <comments>
                            <comment id="12674495" author="shalinmangar" created="Wed, 18 Feb 2009 07:12:40 +0000"  >&lt;p&gt;Changes&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Check for abort in nextModifiedRow detection&lt;/li&gt;
	&lt;li&gt;Check for abort in nextDeletedRow&lt;/li&gt;
	&lt;li&gt;Check in doDelta&lt;/li&gt;
	&lt;li&gt;Check getModifiedParentRowKey&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Marc, can you see the patch to ensure all your changes got in?&lt;/p&gt;</comment>
                            <comment id="12674900" author="shalinmangar" created="Thu, 19 Feb 2009 05:43:37 +0000"  >&lt;p&gt;Committed revision 745742.&lt;/p&gt;

&lt;p&gt;Thanks Marc!&lt;/p&gt;</comment>
                            <comment id="12775650" author="gsingers" created="Tue, 10 Nov 2009 15:51:56 +0000"  >&lt;p&gt;Bulk close for Solr 1.4&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12400391" name="SOLR-1004.patch" size="2457" author="shalinmangar" created="Wed, 18 Feb 2009 07:12:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 18 Feb 2009 07:12:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6630</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxnvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20186</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>