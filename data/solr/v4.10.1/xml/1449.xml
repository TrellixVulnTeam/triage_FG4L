<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:26:42 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-1449/SOLR-1449.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-1449] solrconfig.xml syntax to add classpath elements from outside of instanceDir</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1449</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;the idea has been discussed numerous times that it would be nice if there was a way to configure a core to load plugins from specific jars (or &quot;classes&quot; style directories) by path  w/o needing to copy them to the &quot;./lib&quot; dir in the instanceDir.&lt;/p&gt;

&lt;p&gt;The current workaround is &quot;symlinks&quot; but that doesn&apos;t really help the situation of the Solr Release artifacts, where we wind up making numerous copies of jars to support multiple example directories (you can&apos;t have reliable symlinks in zip files)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12436168">SOLR-1449</key>
            <summary>solrconfig.xml syntax to add classpath elements from outside of instanceDir</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Hoss Man</assignee>
                                    <reporter username="hossman">Hoss Man</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Sep 2009 03:17:12 +0100</created>
                <updated>Tue, 10 Nov 2009 15:52:15 +0000</updated>
                            <resolved>Mon, 12 Oct 2009 15:45:39 +0100</resolved>
                                                    <fixVersion>1.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12757787" author="hossman" created="Mon, 21 Sep 2009 03:28:47 +0100"  >&lt;p&gt;Example of how this might work.  It provides support for &quot;regex&quot; based jar selectors in a specified directory (so we can point at jars w/o hardcoding version numbers all over the place) and leaves the door open to a simpler glob style syntax to be added later.&lt;/p&gt;

&lt;p&gt;syntax...&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  &amp;lt;!-- all jars in a directory --&amp;gt;
  &amp;lt;lib dir=&quot;../../dist/solr-cell-lib/&quot; /&amp;gt;
  &amp;lt;!-- any jar in the directory matching the regex --&amp;gt;
  &amp;lt;lib dir=&quot;../../dist/&quot; regex=&quot;apache-solr-cell-(\d|\.)+-.*\.jar&quot; /&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Internally the parsing code is confined to SolrConfig.xml, but a new method has been added to SolrResourceLoader that repalces the ClassLoader with a new one where the parent is fixed on the previous classloader &amp;#8211; it seems a little sketchy, and i would have much rather had SOlrConfig use some new ClassLoaderUtils to build up a comprehensive ClassLoader and then provide it when constructing SolrResourceLoader &amp;#8211; expect SolrConfig doesn&apos;t get to construct SOlrResourceLoader.&lt;/p&gt;

&lt;p&gt;The patch modifies the build.xml file just enough to demonstrate using the solr-cell libs into the example w/o copying them, but i didn&apos;t systematicly fix all the other palces we could use this.&lt;/p&gt;

&lt;p&gt;I also didn&apos;t test the patch exhaustively.&lt;/p&gt;

&lt;p&gt;Note: I&apos;ve marked this issue as Fix for 1.4 to try and give it some visibility before the release since there seems to be some interest in getting the release size smaller &amp;#8211; but unless adequate eyeballs give it a thumbs up and help do some more rigerous testing i&apos;m leary to try and inlcude it now.  (The term &quot;Classloader Hell&quot; exists for a reason &amp;#8211; the upside is i&apos;m 95% sure that even if there winds up being a bug in the nested classloaders, anyone using the existing method (ie: copies their libs) should still work, since that code path should be the same.&lt;/p&gt;</comment>
                            <comment id="12758241" author="shalinmangar" created="Tue, 22 Sep 2009 14:23:24 +0100"  >&lt;blockquote&gt;&lt;p&gt;Note: I&apos;ve marked this issue as Fix for 1.4 to try and give it some visibility before the release since there seems to be some interest in getting the release size smaller&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I haven&apos;t seen the patch yet. But I do not understand why we need to copy the jars in the released artifact. We can have some instructions or scripts (I assume we don&apos;t want ant) to copy the jars to the correct places for running solr-cell examples. Is there a problem with that?&lt;/p&gt;</comment>
                            <comment id="12758274" author="yseeley@gmail.com" created="Tue, 22 Sep 2009 16:37:51 +0100"  >&lt;blockquote&gt;&lt;p&gt;We can have some instructions or scripts (I assume we don&apos;t want ant) to copy the jars to the correct places for running solr-cell examples. Is there a problem with that?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;For the same reason we have an example at all I guess - a better out-of-the-box experience.&lt;/p&gt;

&lt;p&gt;IMO, Solr &lt;b&gt;is&lt;/b&gt; an enterprise search server, not a bunch of jars you wire together yourself to create one.  It would be nice if we could do database import from the same example server... but I think JDBC driver issues (and the necessity to have a database to connect to?) make this tougher.&lt;/p&gt;</comment>
                            <comment id="12758409" author="shalinmangar" created="Tue, 22 Sep 2009 21:15:41 +0100"  >&lt;blockquote&gt;&lt;p&gt;For the same reason we have an example at all I guess - a better out-of-the-box experience.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree with that goal. It&apos;s just that having a regex based class loading from externally located jars, although cool, seems an overly fancy way to solve this particular problem.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It would be nice if we could do database import from the same example server... but I think JDBC driver issues (and the necessity to have a database to connect to?) make this tougher.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The database and the driver jar is checked in. The only issue I guess is that our example is a single-core one and the DIH examples have db, rss and mail each of which requires its own schema.&lt;/p&gt;

&lt;p&gt;The main problem is the mail DIH example. It uses Tika for indexing email attachments and therefore copies all its dependencies. I&apos;m not sure if that is necessary. We can have an option to disable that and document the attachment support in the wiki only. I&apos;m guessing that very few users will actually need to look at that example.&lt;/p&gt;

&lt;p&gt;The other thing that we can do is to offer separate source and binary+example downloads.&lt;/p&gt;</comment>
                            <comment id="12758462" author="hossman" created="Tue, 22 Sep 2009 23:16:34 +0100"  >&lt;p&gt;I feel like these comments aren&apos;t really on topic ... this type of feature has been discussed numerous times on the list as a desirable way for users to specify where a core should look to load plugins without needing to copy jars to a specific hardcoded directory &amp;#8211; particularly when people want to use the same plugins in multiple cores (that have unique instanceDirs)&lt;/p&gt;

&lt;p&gt;Independent of any question of what our releases look like, and what kinds of examples we want to include, these is still a feature that users have been requesting.&lt;/p&gt;

&lt;p&gt;My point about our examples was merely that an &lt;b&gt;additional&lt;/b&gt; use case that would be improved by this feature is that we would be able to have a single copy of any jar in the  release, no matter how many examples wanted to refer to it (which would also make it easier to add examples that would work &quot;as is&quot; without debating the potential increase n the size of the release, or wether we should ask the user to copy the jars, etc...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It&apos;s just that having a regex based class loading from externally located jars, although cool, seems an overly fancy way to solve this particular problem.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;As i already said: that wasn&apos;t a particular goal, just a nice side effect &amp;#8211; but FWIW: the regex based loading was actually the easiest way i found to identify multiple jars &amp;#8211; i was looking for an easy way to do shell style fileglobbing in java and nothing jumped out at me, java.util.regex on the other hand is a stock and easy to use.&lt;/p&gt;</comment>
                            <comment id="12758567" author="shalinmangar" created="Wed, 23 Sep 2009 04:42:54 +0100"  >&lt;blockquote&gt;&lt;p&gt;particularly when people want to use the same plugins in multiple cores (that have unique instanceDirs)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That is taken care of by the sharedLib attribute in solr.xml&lt;/p&gt;</comment>
                            <comment id="12758842" author="yseeley@gmail.com" created="Wed, 23 Sep 2009 20:20:17 +0100"  >&lt;blockquote&gt;&lt;p&gt;repalces the ClassLoader with a new one where the parent is fixed on the previous classloader&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not a classloading expert... but couldn&apos;t this cause things to work differently by changing the order of the &amp;lt;lib&amp;gt; statements?&lt;/p&gt;</comment>
                            <comment id="12759216" author="hossman" created="Thu, 24 Sep 2009 20:06:56 +0100"  >&lt;blockquote&gt;&lt;p&gt;That is taken care of by the sharedLib attribute in solr.xml&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;sharedLib only helps if you want the same plugins in &lt;b&gt;every&lt;/b&gt; core (not just to reuse the same plugins in &lt;em&gt;multiple&lt;/em&gt; cores.  There&apos;s also no way to reload a plugin from the sharedLib (whereas the normal lib for a core does get reloaded when the core is reloaded)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m not a classloading expert... but couldn&apos;t this cause things to work differently by changing the order of the &amp;lt;lib&amp;gt; statements?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Excellent point ... yes you have to declare things in a dependency order.  This didn&apos;t seem like a big deal to me when i first wrote it, but i can see how that could prove very tedious, it could make it impossible to use some sets of jars without having them in a specific set of directories.&lt;/p&gt;

&lt;p&gt;The other option was to maintain a list of all the jars in parallel with the &quot;current&quot; classloader, and replace the classloader anytime new jars were added &amp;#8211; this seemed like a bigger evil to me originally because it made the behavior &lt;b&gt;really&lt;/b&gt; unpredictable if someone tried to use the class loader in the middle of adding more jars (because there would be classes that had been loaded by a classloader that was no longer in use) but frankly: i don&apos;t see how the behavior would really be any weirder then what would currently happen, and it would certainly be nice to make it less dependent on the order things were declared.&lt;/p&gt;

&lt;p&gt;I&apos;ll try to get another patch up today.&lt;/p&gt;</comment>
                            <comment id="12759230" author="shalinmangar" created="Thu, 24 Sep 2009 20:57:35 +0100"  >&lt;blockquote&gt;&lt;p&gt;sharedLib only helps if you want the same plugins in every core (not just to reuse the same plugins in multiple cores. There&apos;s also no way to reload a plugin from the sharedLib (whereas the normal lib for a core does get reloaded when the core is reloaded)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK, that&apos;s true.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;As i already said: that wasn&apos;t a particular goal, just a nice side effect - but FWIW: the regex based loading was actually the easiest way i found to identify multiple jar&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I understand you want to make a core&apos;s lib directory configurable. That is fine. It is the regex based loading that makes me nervous. Why not load all jars in a specified directory?&lt;/p&gt;</comment>
                            <comment id="12759342" author="hossman" created="Fri, 25 Sep 2009 01:39:25 +0100"  >&lt;blockquote&gt;&lt;p&gt;I understand you want to make a core&apos;s lib directory configurable. That is fine. It is the regex based loading that makes me nervous. Why not load all jars in a specified directory?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The way you worded that is part of what i&apos;m trying to fix: &quot;a core&apos;s lib directroy&quot; ... i&apos;m not trying to make the path of a single directory configurable, i&apos;m trying to eliminate the idea that there is a single &quot;lib&quot; dir for a core &amp;#8211; people should be able to load any jars they want, from anywhere they want.&lt;/p&gt;

&lt;p&gt;The regex based selection already supported loading all files in a directory &amp;#8211; that&apos;s the default behavior if no regex is selected &amp;#8211; but in general there are two main reasons i can think of why we should have regex (or glob) support...&lt;/p&gt;

&lt;p&gt;1) so people don&apos;t have to load every jar in a directory just to get some of those jars.  &lt;/p&gt;

&lt;p&gt;slurping up every file in ./lib was fine when we were forcing people to manually create a directory inside the instance dir (if you don&apos;t want it loaded don&apos;t copy it), but if we&apos;re trying to be flexible and allow people to point at jars anywhere then we shouldn&apos;t hobble them by making them get everything in a directory.  it should be possible to have an assload of jars in a big directory and say i only want this subset for this core.&lt;/p&gt;

&lt;p&gt;2) so people don&apos;t have to hardcode jar version info.&lt;/p&gt;

&lt;p&gt;people should have an easy way to say &quot;load the tika jar&quot; in their config, and it should still work even if they delete apache-tika-0.4.jar and repalce it with apache-tika-0.5.jar.  I don&apos;t want to make them hardcode names.&lt;/p&gt;

&lt;p&gt;&amp;#8212;&lt;/p&gt;

&lt;p&gt;I&apos;m not sure why regex matching on filenames makes you &quot;nervous&quot; ...  my best guess is that you&apos;re worried regex mistakes silently not loading the files (since a regex was the only way to laod a single jar explicitly) so in this newest patch i&apos;ve added support for a &quot;path&quot; options instead of dir+regex ... if an explicitly path is used and it can&apos;t be found it&apos;s logged as an error....&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  &amp;lt;!-- all files in dir --&amp;gt;
  &amp;lt;lib dir=&quot;../../dist/solr-cell-lib/&quot; /&amp;gt;
  &amp;lt;!-- all files in dir matching the regex --&amp;gt;
  &amp;lt;lib dir=&quot;../../dist/&quot; regex=&quot;apache-solr-cell-(\d|\.)+-.*\.jar&quot; /&amp;gt;
  &amp;lt;!-- nothing matches, so will be ignored --&amp;gt;
  &amp;lt;lib dir=&quot;/total/crap/dir/ignored&quot; /&amp;gt; 
  &amp;lt;!-- an exact path (jar or classes dir), will log error if not found --&amp;gt;
  &amp;lt;lib path=&quot;../a-jar-that-does-not-exist.jar&quot; /&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This patch also makes the changes i described in my previous comment (removing the dependency on the order that the &apos;lib&apos; dirs are declared)&lt;/p&gt;</comment>
                            <comment id="12759409" author="noble.paul" created="Fri, 25 Sep 2009 07:59:01 +0100"  >&lt;p&gt;I have a few questions in mind. &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Is this an issue which users have reported? in my experience with Solr mailing list, I am yet to see a request  where users wish to add arbitrary directories to classpath&lt;/li&gt;
	&lt;li&gt;How important is this feature to be in 1.4?&lt;/li&gt;
	&lt;li&gt;Users in general have a lot of problems with classloading. Even with the current support with one lib directory I have seen so many users having trouble with classloading . This can only add to that confusion&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; I am not aware of any project which allows this level of configurability for classpath. Most of the users never have to write custom components for Solr. In our organization, I have encountered very few cases where they needed to add custom jars to classpath. Even in cases where they did , they were some trivial jars and it can be put into solr_home/lib anyway.&lt;/p&gt;

&lt;p&gt;I am -1 on adding this to 1.4.&lt;/p&gt;
</comment>
                            <comment id="12759444" author="ehatcher" created="Fri, 25 Sep 2009 10:01:22 +0100"  >&lt;p&gt;I haven&apos;t tried out Hoss&apos; patch, but based on the write-up, I&apos;m +1.&lt;/p&gt;

&lt;p&gt;Having a configurable list of directories to load from will clean up our examples, reduce the size (or installation steps) of our example app.  It will allow various plugins to live in one place and be referred to without having to copy files all over the place.&lt;/p&gt;

&lt;p&gt;I think this is an important feature to get into 1.4.&lt;/p&gt;</comment>
                            <comment id="12759457" author="noble.paul" created="Fri, 25 Sep 2009 10:20:44 +0100"  >&lt;p&gt;Let us get the facts. We may be barking up the wrong tree.&lt;/p&gt;

&lt;p&gt;we have a 116MB distribution out of which the solr.war + single+multicore example is around 4MB .  Most of the users need this 4MB only (99% of the users do not need clustering + solr cell ). If we implement this issue we may cut down the size of the distro by around 20 MB (by eliminating duplication of tika jars).  What we should have is a lighter version (solr.war + example solr home . &amp;lt;4MB and a full version. &lt;/p&gt;

&lt;p&gt;I am sure most of the users will be happy with the minimal solr. The rest of them will happily download the whole thing however big it is.&lt;/p&gt;

&lt;p&gt;This is not to say that we don&apos;t need to reduce the size of the distro. But adding complexity just for this is not really required. Just adding a .sh and .bat file to the tika example we can add jars from external path.&lt;/p&gt;</comment>
                            <comment id="12759966" author="hossman" created="Sun, 27 Sep 2009 00:39:51 +0100"  >&lt;p&gt;Added tests for all the permutations of the solrconfig.xml syntax.&lt;/p&gt;

&lt;p&gt;Also fixed a missing dependency in the build.xml that i didn&apos;t notice before because i hadn&apos;t tried &quot;ant clean test&quot; (previously test depending on a special target for copying the solr cell libs so the SolrExample*Tests would find them, now it just depends on dist-contrib to ensure all the contrib jars/dependencies are in the expected place)&lt;/p&gt;</comment>
                            <comment id="12759969" author="hossman" created="Sun, 27 Sep 2009 01:33:05 +0100"  >&lt;blockquote&gt;&lt;p&gt;Is this an issue which users have reported? in my experience with Solr mailing list, I am yet to see a request where users wish to add arbitrary directories to classpath&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t really feel like searching through the archives at the moment, but it has come up &amp;#8211; i don&apos;t know if anyone has explicitly requested the ability to add arbitrary directories, but there have certainly been discussions about the annoyance of needing to copy and/or symlink jars.&lt;/p&gt;

&lt;p&gt;If nothing else: I&apos;m a user, and i&apos;m requesting it.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;How important is this feature to be in 1.4?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;As i said in my first comment i don&apos;t know.&lt;/p&gt;

&lt;p&gt;It would be nice to have, but i certainly don&apos;t think it&apos;s a blocker ... even with the testing i&apos;ve done, and even with the new tests i added to the patch, and even though the behavior for existing ./lib users hasn&apos;t been changed, i still wouldn&apos;t consider committing unless other people try it out and gave it a thumbs up.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Users in general have a lot of problems with classloading. Even with the current support with one lib directory I have seen so many users having trouble with classloading . This can only add to that confusion&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t really see how this will make confusion about classloading any worse.  most problems i can think of where people have classloader difficulty in solr stem from not understanding where they are suppose to copy their jars &amp;#8211; they tend to get confused about which &quot;lib&quot; directory, particularly with example/lib containing the jetty jars.  Allowing people to put the jar any where they want and point at it by name in the config file should &lt;em&gt;reduce&lt;/em&gt; confusion.&lt;/p&gt;

&lt;p&gt;Besides which: they&apos;re still free to create a ./lib dir and copy jars &amp;#8211; that still works, no configuration needed.&lt;/p&gt;

&lt;p&gt;I agree that the original patch (with the order in the config mattering) would have been confusing for people, but with the more recent patches where all jars are in the same classloader i can&apos;t imagine any situation where this will cause more problems/confusion then forcing people to make a lib dir.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I am sure most of the users will be happy with the minimal solr. The rest of them will happily download the whole thing however big it is.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I &lt;b&gt;REALLY&lt;/b&gt; don&apos;t want to argue the merrits of this issue as if it&apos;s purpose was to decrease the size of the distribution &amp;#8211; it was &lt;em&gt;not&lt;/em&gt; the purpose, it&apos;s just a possible additional benefit &amp;#8211; but i &lt;b&gt;HAVE&lt;/b&gt; to disagree with you on this ... most users may only &lt;em&gt;need&lt;/em&gt; a minimal solr, but we should not passively discourage people from finding features that can make them happier by making those features more complex to get (via an alternate larger download).&lt;/p&gt;

&lt;p&gt;Adding this feature, and using it to reduce the size of the &lt;em&gt;current&lt;/em&gt; examples may not reduce the size of the &lt;em&gt;current&lt;/em&gt; distribution enough to be worth worrying about, that&apos;s fine.  But i&apos;m trying to thing longer term: there have been multiple threads discussing the goal of adding &lt;b&gt;many&lt;/b&gt; more example directories demonstrating cool use cases of solr via interesting permutations of features (DIH, clustering, solr cell, velocity, etc...). This patch (or something like it) is going to be necessary before we can do anything like that.&lt;/p&gt;</comment>
                            <comment id="12759971" author="markrmiller@gmail.com" created="Sun, 27 Sep 2009 01:44:37 +0100"  >&lt;p&gt;+1. I don&apos;t find the pluses overwhelming, but I find pluses. On the other hand, after reading all the comments, I don&apos;t see a single good reason against.&lt;/p&gt;

&lt;p&gt;Its a no brainer to me. I think I might have some time to play with it tomorrow. Will report back if I do.&lt;/p&gt;</comment>
                            <comment id="12760105" author="hossman" created="Sun, 27 Sep 2009 22:29:38 +0100"  >&lt;p&gt;checkpoint patch, new additions...&lt;/p&gt;

&lt;p&gt;1. updated TestConfig to also assert that the existing automatic lib dir support works (i don&apos;t see any evidence that we already had a test for this)&lt;br/&gt;
2. replaced the TODO&apos;s in the example solrconfig.xml with documentation explaining hte new &amp;lt;lib&amp;gt; directives.&lt;br/&gt;
3. updated the README in the example solr home so that the note about ./lib also mentions the &amp;lt;lib&amp;gt; config option&lt;br/&gt;
4. updated the build.xml and example/solrconfig.xml for the clusturing contrib so that they don&apos;t copy just for the example&lt;br/&gt;
5. fixed a small bug in the clustering example schema (that example reuses the main example docs, but wasn&apos;t ignoring unexpected fields which have since been added to those docs on the trunk since the clustering example was added)&lt;/p&gt;</comment>
                            <comment id="12760107" author="yseeley@gmail.com" created="Sun, 27 Sep 2009 22:45:51 +0100"  >&lt;blockquote&gt;&lt;p&gt;&amp;lt;lib dir=&quot;../../dist/&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;As you say, layout is a separate issue from the ability to add multiple lib entries - but should we reference the libs in contrib (where they are actually checked in) rather than dist?  &quot;ant example&quot; doesn&apos;t currently copy anything to dist... and avoiding another copy of those libraries would be nice too.&lt;/p&gt;</comment>
                            <comment id="12760120" author="hossman" created="Sun, 27 Sep 2009 23:36:19 +0100"  >&lt;p&gt;minor update to the previous patch...&lt;/p&gt;

&lt;p&gt;1) the patch command didn&apos;t like the empty files, so now they have a single newline in them.&lt;br/&gt;
2) because of a typo, javadoc-all on the trunk is getting lucking and finding the download clustering jars only if they&apos;ve already been copied to the example/lib ... since the patch stops the copying to example/lib i fixed the topy so it finds them in lib/downloads&lt;/p&gt;</comment>
                            <comment id="12760124" author="hossman" created="Sun, 27 Sep 2009 23:59:01 +0100"  >&lt;blockquote&gt;&lt;p&gt;should we reference the libs in contrib (where they are actually checked in) rather than dist? &quot;ant example&quot; doesn&apos;t currently copy anything to dist... and avoiding another copy of those libraries would be nice too.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;FYI: We already copy them to ./dist/ as part of dist-contrib, and &quot;ant example&quot; already depends on dist-contrib so nothing changed there.&lt;/p&gt;

&lt;p&gt;Ultimately it&apos;s a question of how we want to solve &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1433&quot; title=&quot;files included in release that shouldn&amp;#39;t be&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1433&quot;&gt;&lt;del&gt;SOLR-1433&lt;/del&gt;&lt;/a&gt; ... this patch assumes we keep including the full ./dist structure that we have now for all the jars in our artifacts 9and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1433&quot; title=&quot;files included in release that shouldn&amp;#39;t be&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1433&quot;&gt;&lt;del&gt;SOLR-1433&lt;/del&gt;&lt;/a&gt; could be solved w/o changing that by exclusing the source locations of those libs), but if the solution to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1433&quot; title=&quot;files included in release that shouldn&amp;#39;t be&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1433&quot;&gt;&lt;del&gt;SOLR-1433&lt;/del&gt;&lt;/a&gt; is to not copy libs to ./dist at all then it&apos;s trivial to change the &amp;lt;lib&amp;gt; refs in the solrconfig.xml files to point at the original locations.&lt;/p&gt;</comment>
                            <comment id="12760679" author="hossman" created="Tue, 29 Sep 2009 20:42:04 +0100"  >&lt;p&gt;Quick updated to match trunk (based on the decisions made in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1433&quot; title=&quot;files included in release that shouldn&amp;#39;t be&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1433&quot;&gt;&lt;del&gt;SOLR-1433&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;I just noticed that there are some jars copied into example-DIH - i remember looking at this before and seeing that the hsqldb jar was actaully committed into that directory because it&apos;s only needed to run the exampl, not to compile, but someone i missed noticing that there are two other jars that &lt;b&gt;are&lt;/b&gt; copied at build time ... so we could probably replace those with lib references too. (i&apos;ll try to post another update later today)&lt;/p&gt;</comment>
                            <comment id="12760813" author="hossman" created="Wed, 30 Sep 2009 03:04:19 +0100"  >&lt;p&gt;updated to deal with example-DIH as well &lt;/p&gt;

&lt;p&gt;(i verified that SolrResourceLoader logs that it found all of the jars, but i didn&apos;t actually test the IMAP importing &amp;#8211; i don&apos;t have an IMAP account to try it on)&lt;/p&gt;

&lt;p&gt;Also made a minor addition to the comments in example/solr/conf/solrconfig.xml to make it clear that the entire filename must match the regex (per the semantics of Macther.matches())&lt;/p&gt;</comment>
                            <comment id="12760850" author="noble.paul" created="Wed, 30 Sep 2009 07:52:57 +0100"  >&lt;p&gt;I&apos;m back from vacation and I realize that we have gone a long way in this issue.&lt;/p&gt;

&lt;p&gt;There is an issue &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-919&quot; title=&quot;Cache and reuse the SolrConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-919&quot;&gt;&lt;del&gt;SOLR-919&lt;/del&gt;&lt;/a&gt; which enables re-use of SolrConfig object. To make it work we will have to make SolrConfig agnostic of SolrCore. So, the best solution is to make SolrCore add  the  jars to SolrResourceLoader. So SolrConfig can just return a data structure and SolrCore can decide how to add the jars to the path&lt;/p&gt;</comment>
                            <comment id="12761265" author="hossman" created="Thu, 1 Oct 2009 17:41:31 +0100"  >&lt;p&gt;Noble: if you have any specific suggested improvements for the patch that you think will make eventual work on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-919&quot; title=&quot;Cache and reuse the SolrConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-919&quot;&gt;&lt;del&gt;SOLR-919&lt;/del&gt;&lt;/a&gt; easier, then i&apos;m all ears &amp;#8211; but i&apos;d rather not try to code something in anticipation of a future feature that doesn&apos;t even have a stub patch or fleshed out design yet.&lt;/p&gt;

&lt;p&gt;Even if we don&apos;t make any of the changes suggested in this issue, some very complicated questions are going to have to be answered in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-919&quot; title=&quot;Cache and reuse the SolrConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-919&quot;&gt;&lt;del&gt;SOLR-919&lt;/del&gt;&lt;/a&gt; &amp;#8211; like: should two cores sharing a SolrConfig object and an instanceDir (but with different data dir propertes) share the same resourceloader/classloader, or should they have unique classloaders containing different copies of the same jars from ./lib.   Those types of questions aren&apos;t things we should be attempting to answer in this issue &amp;#8211; but they will ultimately need to be addressed in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-919&quot; title=&quot;Cache and reuse the SolrConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-919&quot;&gt;&lt;del&gt;SOLR-919&lt;/del&gt;&lt;/a&gt;, and they will need to be addressed regardless of what we decide to do here.&lt;/p&gt;

&lt;p&gt;This patch doesn&apos;t change any of the internal public APIs, it just adds support for some new syntax in the config file, so if SolrConfig.initLibs needs to be refactored later to support &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-919&quot; title=&quot;Cache and reuse the SolrConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-919&quot;&gt;&lt;del&gt;SOLR-919&lt;/del&gt;&lt;/a&gt; that will be totally fine.&lt;/p&gt;</comment>
                            <comment id="12761272" author="noble.paul" created="Thu, 1 Oct 2009 18:16:05 +0100"  >&lt;p&gt;the idea is to have separate resourceloaders for each core (they are lightweight) but comomn schema/config objects. &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1293&quot; title=&quot;Support for large no:of cores and faster loading/unloading of cores&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1293&quot;&gt;&lt;del&gt;SOLR-1293&lt;/del&gt;&lt;/a&gt; includes the changes required for this.&lt;/p&gt;</comment>
                            <comment id="12761314" author="hossman" created="Thu, 1 Oct 2009 20:48:47 +0100"  >&lt;p&gt;As i said: these aren&apos;t questions that we should be attempting to answer here - they are about the impacts of potential future features.&lt;/p&gt;

&lt;p&gt;This patch works against the trunk &lt;em&gt;&lt;b&gt;today&lt;/b&gt;&lt;/em&gt; ... SolrConfig currently maintains a reference to a SolrResourceLoader which it &lt;em&gt;may&lt;/em&gt; have instantiated itself in it&apos;s constructor, or it may have received it as a constructor argument &amp;#8211; either way this patch ensures that that SolrResourceLoader gets a consistent classloader based on the Configs that are parsed without needing to make any &quot;initLibs&quot; or &quot;getLibs&quot; style functions public or changing the contract of initializing SolrConfig/SolrResourceLoader.  Even if someone is doing funky old school embedded Solr code where they construct their own SolrConfig objects the &amp;lt;lib&amp;gt; config options will still work.&lt;/p&gt;

&lt;p&gt;If &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-919&quot; title=&quot;Cache and reuse the SolrConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-919&quot;&gt;&lt;del&gt;SOLR-919&lt;/del&gt;&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1293&quot; title=&quot;Support for large no:of cores and faster loading/unloading of cores&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1293&quot;&gt;&lt;del&gt;SOLR-1293&lt;/del&gt;&lt;/a&gt; require refactoring things so that a SolrConfig instance can be reused with different classloaders that&apos;s going to require eliminating some public constructors and Refactoring the contract of when/how a SolrResourceLoader is initialized &amp;#8211; when we do that we can worry about refactoring the code in this patch.&lt;/p&gt;</comment>
                            <comment id="12761488" author="shalinmangar" created="Fri, 2 Oct 2009 07:44:23 +0100"  >&lt;p&gt;Hoss, Noble has been refactoring SolrConfig in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1198&quot; title=&quot;confine all solrconfig.xml parsing to SolrConfig.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1198&quot;&gt;&lt;del&gt;SOLR-1198&lt;/del&gt;&lt;/a&gt; with the end goal being pluggable loading of SolrConfig. This makes &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-919&quot; title=&quot;Cache and reuse the SolrConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-919&quot;&gt;&lt;del&gt;SOLR-919&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1293&quot; title=&quot;Support for large no:of cores and faster loading/unloading of cores&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1293&quot;&gt;&lt;del&gt;SOLR-1293&lt;/del&gt;&lt;/a&gt; easier. But it is also about how we want SolrPlugins to be loaded. Ideally they&apos;d keep configuration in SolrConfig but the actual loading will happen in SolrCore or somewhere else outside.&lt;/p&gt;

&lt;p&gt;A large part of work for &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1198&quot; title=&quot;confine all solrconfig.xml parsing to SolrConfig.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1198&quot;&gt;&lt;del&gt;SOLR-1198&lt;/del&gt;&lt;/a&gt; has been done in 1.4. This patch also marked for 1.4 goes against that example by modifying the resource loader. So we need to ask now what is the function of SolrConfig? Do we want it to load/modify SolrResourceLoader objects or just be a representation of configuration?&lt;/p&gt;</comment>
                            <comment id="12761925" author="hossman" created="Sat, 3 Oct 2009 18:41:52 +0100"  >&lt;blockquote&gt;&lt;p&gt;Noble has been refactoring SolrConfig in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1198&quot; title=&quot;confine all solrconfig.xml parsing to SolrConfig.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1198&quot;&gt;&lt;del&gt;SOLR-1198&lt;/del&gt;&lt;/a&gt; with the end goal being pluggable loading of SolrConfig&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I understand Noble&apos;s goal(s) .. i&apos;m actually really stoked to be moving in that direction and look forward to people being able to provide/reuse their own SolrConfig implementations which may not use XML at all...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;So we need to ask now what is the function of SolrConfig? Do we want it to load/modify SolrResourceLoader objects or just be a representation of configuration?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I disagree that we need to ask that question &quot;now&quot;, in this issue ... that is an important question for other issues (which you and Noble have already referenced).  Those issues are going to face tough decisions about how to deal with the existing contracts of Solr config like all the methods it inherits from Config (including getResourceLoader(), and openResource()) or the fact that all of it&apos;s public constructors are expected to initialize a new SolrResourceLoader.&lt;/p&gt;

&lt;p&gt;When the time comes to make those tough decisions, we will have to make non-back-compat changes to the contracts of SolrConfig and SolrResourceLoader, and document a &apos;new&apos; contract for how to properly initialize them.  &lt;b&gt;THAT&lt;/b&gt; is the appropriate time (in my opinion) to worry about how we should refactoring all the SolrResourceLoader initialization code &amp;#8211; but today, on the trunk, SolrConfig is still responsible for initializing SolrResourceLoader in many cases.  The patch as i wrote it ensures that no matter how a SolrResourceLoader is instantiated, or who instantiates it, if a SolrConfig instance is told to use it, then it gets a class loader based on the options in that SolrConfig.&lt;/p&gt;

&lt;p&gt;This is the simplest possible patch I could think of to make the change desired.  I deliberately avoided making any public API changes to SolrCOnfig or SolrResourceLoader because i didn&apos;t want to commit to who/how the ClassLoader would get those changes &amp;#8211; so in the future (when we have to make/advertise big API changes to SolrConfig to eliminate direct references to SOlrResourceLoader anyway) it will be easy to refactor it (the logic in initLibs) to someplace else and document exactly how the SolrResourceLoader should be initialized cleanly.&lt;/p&gt;

&lt;p&gt;At this point, i personally have no interest in trying to &quot;guess&quot; what the right decisions will be down the road, nor am i interested in writing a more complicated patch that would commit us to that guess with modifications SolrConfig&apos;s public API. As i said in a previous comment...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;if you have any specific suggested improvements for the patch that you think will make eventual work on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-919&quot; title=&quot;Cache and reuse the SolrConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-919&quot;&gt;&lt;del&gt;SOLR-919&lt;/del&gt;&lt;/a&gt; easier, then i&apos;m all ears&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;...but to be more explicit: attach an alternate patch, and i&apos;ll review it.&lt;/p&gt;
</comment>
                            <comment id="12762071" author="markrmiller@gmail.com" created="Mon, 5 Oct 2009 03:27:03 +0100"  >&lt;p&gt;I haven&apos;t had a chance to do any testing yet, but just took some time reviewing the patch.&lt;/p&gt;

&lt;p&gt;1. Should the change in clustering/example/conf/schema.xml be part of this patch?&lt;/p&gt;

&lt;p&gt;Here is a no credit update to the patch that fixes a few small things:&lt;/p&gt;

&lt;p&gt;2. example README formatting&lt;br/&gt;
3. Fix spelling in SolrResourceLoader.addToClassLaoder method&lt;br/&gt;
4. Fix liib spelling in build.xml&lt;/p&gt;

&lt;p&gt;A couple thoughts:&lt;/p&gt;

&lt;p&gt;5. Did you consider just extending URLClassLoader and opening up addUrl rather than replacing the loader? Almost seems nicer - no biggie though.&lt;br/&gt;
6. What about solr.xml&apos;s sharedlib setting? Should it support the same syntax options as the solrconfig lib setting ?&lt;/p&gt;

&lt;p&gt;Hopefully I can do some testing too.&lt;/p&gt;</comment>
                            <comment id="12762072" author="markrmiller@gmail.com" created="Mon, 5 Oct 2009 03:34:06 +0100"  >&lt;p&gt;RE: 5&lt;/p&gt;

&lt;p&gt;hmm .. I guess you&apos;d prob have to add some synchronization that wouldn&apos;t be worth it - forget that.&lt;/p&gt;</comment>
                            <comment id="12762073" author="hossman" created="Mon, 5 Oct 2009 03:37:49 +0100"  >&lt;blockquote&gt;&lt;p&gt;1. Should the change in clustering/example/conf/schema.xml be part of this patch?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;...probably not, i totally forgot i had to make that fix to get the example working.  i&apos;ll try to commit that seperately tonight.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;5. Did you consider just extending URLClassLoader and opening up addUrl rather than replacing the loader? Almost seems nicer - no biggie though.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I went down the road, but i ran into a problem &amp;#8211; i don&apos;t remember the specifics, i was probably doing something stupid, but in trying to figure it out i noticed the caveat about using addURL...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   &quot;The classes that are loaded are by default granted permission only 
    to access the URLs specified when the URLClassLoader was created.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...and figured it was safer just to go this way and document that you should only modify the classloader prior to using the ResourceLoader.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;6. What about solr.xml&apos;s sharedlib setting? Should it support the same syntax options as the&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;solrconfig lib setting ?&lt;/p&gt;

&lt;p&gt;we can always add the syntax to solr.xml as well &amp;#8211; but that gets more challanging because of the persistence options, so i punted on it for now.&lt;/p&gt;</comment>
                            <comment id="12762118" author="noble.paul" created="Mon, 5 Oct 2009 09:55:44 +0100"  >&lt;p&gt;Mark the latest patch does not seem to compile. &lt;br/&gt;
Anyway I propose a simple suggestion&lt;/p&gt;

&lt;p&gt;add a new method to SolrConfig&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; getPaths()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;in the SolrResourceLoader we may just need an extra method addPath(String path)&lt;/p&gt;

&lt;p&gt;i guess this should be good enough&lt;/p&gt;


</comment>
                            <comment id="12762165" author="markrmiller@gmail.com" created="Mon, 5 Oct 2009 13:45:06 +0100"  >&lt;blockquote&gt;&lt;p&gt;Mark the latest patch does not seem to compile. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right - my fault - since my changes are just cosmetic (and the delete liib doesn&apos;t really break anything), I didn&apos;t test.&lt;/p&gt;

&lt;p&gt;SolrConfig.java still has this method misspelling:       getResourceLoader().addToClassLaoder(path);&lt;/p&gt;

&lt;p&gt;Works after that - I won&apos;t attach a new patch though - its just cosmetic fixes. Use Hoss&apos; - he can easily integrate those 3 changes (2 misspellings and some space formatting).&lt;/p&gt;</comment>
                            <comment id="12762704" author="hossman" created="Tue, 6 Oct 2009 18:49:06 +0100"  >&lt;p&gt;updated to trunk (schema.xml change already committed) plus the fixes miller pointed out&lt;/p&gt;</comment>
                            <comment id="12762723" author="hossman" created="Tue, 6 Oct 2009 19:20:52 +0100"  >&lt;blockquote&gt;&lt;p&gt;add a new method to SolrConfig ... public List&amp;lt;String&amp;gt; getPaths() .. in the SolrResourceLoader we may just need an extra method addPath(String path)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I feel like we keep going around in circles on this, i don&apos;t know how to express myself any better...&lt;/p&gt;

&lt;p&gt;1) there should never be a public addPath(String) method on SOlrResourceLoader ... the ClassLoader should be initialized completely before the SolrResourceLoader is used, or really wacky inconsistent classloader behavior can result.&lt;/p&gt;

&lt;p&gt;2) ideally SolrResourceLoader should require that all URLs for the ClassLoader be specified in it&apos;s constructor, so we can keep the ClassLoader final &amp;#8211; but given the existing COnstructors for SOlrCOnfig that&apos;s impossible (sometimes the SolrConfig constructs the SolrResourceLoader, other times the caller constructs the SolrResourceLoader, and then passes it as an argument to the SolrConfig constructor) so in this patch i focused on keeping the changes as minimal as possible, and not altering the public API.&lt;/p&gt;

&lt;p&gt;3) Because of these multiple ways the SolrResourceLoader can be initialized, the SolrCOnfig constructor is in the best position to ensure that the ClassLoader URLs are added as early as possible.  &lt;/p&gt;

&lt;p&gt;4) We could add a &quot;getPaths() method to SolrConfig &amp;#8211; but for back-compatibility we would still need to set those paths on the SolrResourceLoader in the SolrConfig constructor for embedded SOlr users people who might be initializing things in a different order then we do in CoreContainer.&lt;/p&gt;

&lt;p&gt;5) someday, in order to achieve all of the various SolrConfig simplification/reuse goals that have been discussed, we are going to need to make non-back-compat changes to eliminate all references to SolrResourceLoader from SolrConfig &amp;#8211; including eliminating all of the current public constructors from SolrConfig (because they construct a SolrResourceLoader) and then, since everyone will have to change how the instantiate SolrCOnfig objects anyway, it will be easy to change the semantics of initializing a SOlrConfig+SolrCore+SolrResourceLoader so that they make more sense...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   SolrCofig config = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrConfig(...)
   SolrResourceLoader loader = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrResourceLoader(cofig.getLibPaths(), ...)
   ...
   SolrCore = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrCore(config, loader, ...)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...and when we reach that point it will be &lt;b&gt;trivial&lt;/b&gt; to refactor the code added by this patch so that it works that way, because at this point it is all nicely self contained in package protected methods.&lt;/p&gt;

&lt;p&gt;...&lt;/p&gt;

&lt;p&gt;All of this reasoning is why i keep saying: it&apos;s a waste of time to worry about how this code will impact reusable SolrCOnfig options in the &lt;em&gt;future&lt;/em&gt;  since it&apos;s all non-public and can be refactored at any time.&lt;/p&gt;

&lt;p&gt;If someone wants to take my patch and refactor it &lt;em&gt;now&lt;/em&gt; then be my guest ... but unless you plan on massively increasing the scope to completely sever the direct connection between SolrCOnfig and SOlrResourceLoader i can&apos;t imagine how adding SolrCOnfig.getPaths() and making someone besides SOlrConfig responsible for passing those paths to SolrResourceLoader wlll result in a patch that would be any cleaner or easier to maintain moving forward. ... but i&apos;ll be happy to get proven wrong.&lt;/p&gt;
</comment>
                            <comment id="12762855" author="noble.paul" created="Wed, 7 Oct 2009 04:50:49 +0100"  >&lt;p&gt;Actually I was planning to commit &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-919&quot; title=&quot;Cache and reuse the SolrConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-919&quot;&gt;&lt;del&gt;SOLR-919&lt;/del&gt;&lt;/a&gt; in 1.4 itself. My current plan is to make the changes as soon as t 1.4 is released. So the refactoring is going to happen &apos;now&apos; . &lt;/p&gt;

&lt;p&gt;Let me take a look at the patch and see how we can make this &apos;future proof&apos;&lt;/p&gt;</comment>
                            <comment id="12763006" author="noble.paul" created="Wed, 7 Oct 2009 12:20:48 +0100"  >&lt;p&gt;a simpler patch. SolrConfig is agnostic of SolrResourceLoader&lt;/p&gt;</comment>
                            <comment id="12763767" author="hossman" created="Fri, 9 Oct 2009 01:41:34 +0100"  >&lt;blockquote&gt;&lt;p&gt;My current plan is to make the changes as soon as t 1.4 is released. So the refactoring is going to happen &apos;now&apos; .&lt;/p&gt;&lt;/blockquote&gt;


&lt;p&gt;&quot;now&quot; is pre 1.4 ... whatever changes we anticipate making after 1.4 are &quot;later&quot; that was a big part of my point: we can easily refactor all of this after 1.4 is released, we can even do it an hour after 1.4 is released, but i was trying to minimize the number of changes needed to make this work prior to 1.4.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;a simpler patch. SolrConfig is agnostic of SolrResourceLoader&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;How can you even remotely attempt to make that claim? Nothing in your patch does anything to make SolrConfig agnostic of SolrResourceLoader &amp;#8211; SolrConfig still constructs, maintains a refrence to, and provides the a public getter for the SolrResourceLoader.&lt;/p&gt;

&lt;p&gt;To summarize the main differnces i can see between your patch and mine:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;you move the FileFiltering out of SolrResourceLoader - i have no opinion about that, as i said it would be easy to refactor, i don&apos;t really care where that logic is&lt;/li&gt;
	&lt;li&gt;you&apos;ve add a protected getPaths method to SolrConfig which exposes a NamedList of FileFilter objects &amp;#8211; this feels very hackish to me, not just because the method name is very vague, and not just because it uses NamedList in an odd way, but because it changes made to the contents of the directory at runtime would be returned by anyone attempting to use these FileFilters later, but that won&apos;t accurately express the state of the paths when the SolrResourceLoader (that SolrConfig still has a refrence to) was initialized.  Since it&apos;s not certain if this is really what should hapen if/when people re-use a SolrConfig, this may have to change anyway, and illustrates why i felt like it was better not to try and get ahead of ourselves now.&lt;/li&gt;
	&lt;li&gt;You&apos;ve moved the responsibility of modifying the classpath (and completeling the initialization of SolrResourceLoader) to SolrCore...&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;...this last change  demonstrates the &lt;b&gt;exact&lt;/b&gt; bug i explained i was trying to avoid:  An embedded Solr user who constructs their own SolrConfig object will then have an incomplete SolrResourceLoader (with a Classpath that hasn&apos;t been fully intialized yet) which they might use prior to passing that SolrConfig object to hte constructor of SolrCore.&lt;/p&gt;

&lt;p&gt;This may be an esoteric example, and not likely to cause problems for anyone in practice &amp;#8211; but why risk introducing a bug at all when it&apos;s &lt;b&gt;EASIER&lt;/b&gt; to make it work for &lt;em&gt;everyone&lt;/em&gt; by letting SolrConfig be responsible for initializing it?&lt;/p&gt;

&lt;p&gt;Nothing in your patch is going to save work down the road when it comes time to &lt;b&gt;actually&lt;/b&gt; decouple SolrConfig from SolrResourceLoader ... all you&apos;ve done here is make it harder to use SolrConifg today.  At somepoint, to reuse SolrConfigs, we&apos;re going to need to break the existing public SolrConfig constructors, and force legacy embedded Solr users to change the way they construct their SolrCore + SolrConfig + SolrResourceLoader, so why not wait until then to worry about this bullshit so we can fix SolrResourceLoader initialization the &lt;em&gt;right&lt;/em&gt; way by making people construct a SolrConfig &lt;em&gt;before&lt;/em&gt; constructing a SolrResourceLoader and passing the jar paths in to the SolrResourceLoader constructor?!&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Honestly though, it&apos;s a waste of time to keep arguing about any of this now, because it&apos;s really just a moot fucking issue at this point.&lt;/p&gt;


&lt;p&gt;I posted this patch almost 3 weeks ago, hoping I could get at least one other person to test it within a few days, so I could commit it and we could smoke test it on the trunk for at least a week or two before starting the release process for 1.4.  But at this point only Noble and Miller have acknowledged reading the patch &amp;#8211; miller hasn&apos;t acknowledged running/testing it, and noble and I can&apos;t agree on how it should be implemented.  Grant&apos;s goal (last I heard) was to start the release early next week, and even if we all magically agreed on what the best patch looked like, and one or two people stepped up and said they tested it, I still wouldn&apos;t feel comfortable commiting a change to existing functionality like this so close to the release date.&lt;/p&gt;

&lt;p&gt;I think we need to postpone this to 1.5.&lt;/p&gt;
</comment>
                            <comment id="12763769" author="hossman" created="Fri, 9 Oct 2009 01:43:07 +0100"  >&lt;p&gt;Moving to 1.5 due to lack of both testing and consensus on approach.&lt;/p&gt;</comment>
                            <comment id="12764344" author="yseeley@gmail.com" created="Sat, 10 Oct 2009 14:08:55 +0100"  >&lt;p&gt;I&apos;m not quite giving up on this yet... Grant said he&apos;d cut an RC on monday (that&apos;s an informal RC I believe... not the one we would VOTE on)... we&apos;d still have another week before the VOTE to find problems.  Add 3 days and you get Oct 22nd.&lt;/p&gt;

&lt;p&gt;I&apos;d still like to get this in 1.4 if possible since it can reduce our download from 90M to 60M.  It would also help avoid possible accusations of &quot;bloat&quot;.&lt;/p&gt;

&lt;p&gt;I didn&apos;t previously thoroughly review this because Hoss &amp;amp; Mark were both on it... and now Noble too.&lt;br/&gt;
But now I&apos;m going to start re-reading this issue to see if we are truly at an impasse.&lt;/p&gt;</comment>
                            <comment id="12764361" author="yseeley@gmail.com" created="Sat, 10 Oct 2009 19:02:03 +0100"  >&lt;p&gt;OK, at this point, I&apos;ve only been investigating how &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-919&quot; title=&quot;Cache and reuse the SolrConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-919&quot;&gt;&lt;del&gt;SOLR-919&lt;/del&gt;&lt;/a&gt; relates to this issue:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;There are enough issues that it doesn&apos;t look like &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-919&quot; title=&quot;Cache and reuse the SolrConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-919&quot;&gt;&lt;del&gt;SOLR-919&lt;/del&gt;&lt;/a&gt; would be a quick commit after 1.4 is released&lt;br/&gt;
  1. SolrConfig is currently a mix of mutable / immutable - for example CacheConfig contains cumulative stats (in addition to the resource loader of course)&lt;br/&gt;
  2. It&apos;s not clear to me that you want different resource loaders for each shared SolrConfig - people would definitely want to avoid loading more than &lt;br/&gt;
one copy of dictionary based stemmers such as kstemmer or smart_cn.  They also may want true singleton classes, which means a single class loader for their class.  Also, if one shares IndexSchema objects, etc, but doesn&apos;t share the resource loader, isn&apos;t it weird that for a core, some of the objects will not be from it&apos;s ResourceLoader?  Starts smelling like &quot;classloader hell&quot; to me...&lt;br/&gt;
  3. There is a lot of middle ground between using the exact same SolrConfig objects and reparsing XML.  For example, clone type functionallity could be used to either create a new config from an existing one, or wrap a common core.  Immutable stuff could be shallowly copied, while mutable stuff could have their own per-core instance.&lt;/li&gt;
	&lt;li&gt;It doesn&apos;t seem like adding &amp;lt;lib&amp;gt; entries to solrconfig.xml will cause future problems for &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-919&quot; title=&quot;Cache and reuse the SolrConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-919&quot;&gt;&lt;del&gt;SOLR-919&lt;/del&gt;&lt;/a&gt; above and beyond what already exist&lt;/li&gt;
	&lt;li&gt;It seems logical that configuration should be able to affect where/how libraries are loaded.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Noble, if you agree with the last two points, do you have further objections to the last patch that Hoss put up?&lt;br/&gt;
Does anyone else have objections to committing this if it&apos;s properly reviewed by more people?&lt;/p&gt;

&lt;p&gt;If no objections, I&apos;ll move on to actually reviewing and testing this patch with the goal of committing it Monday morning.  In fact I&apos;ll start soon regardless because of the limited time and the async nature of our communication.&lt;/p&gt;</comment>
                            <comment id="12764484" author="yseeley@gmail.com" created="Sun, 11 Oct 2009 17:51:30 +0100"  >&lt;p&gt;Updated patch to trunk.&lt;/p&gt;</comment>
                            <comment id="12764545" author="yseeley@gmail.com" created="Mon, 12 Oct 2009 05:47:33 +0100"  >&lt;p&gt;I&apos;ve been testing this, including multi-core setups that continuously reolad the cores to check for memory/classloader leaks.  Everything looks good.&lt;br/&gt;
Unless there are objections, I&apos;ll commit this monday morning, in time for the first release candidate.&lt;/p&gt;</comment>
                            <comment id="12764546" author="noble.paul" created="Mon, 12 Oct 2009 05:48:43 +0100"  >&lt;blockquote&gt;&lt;p&gt;It doesn&apos;t seem like adding &amp;lt;lib&amp;gt; entries to solrconfig.xml will cause future problems for &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-919&quot; title=&quot;Cache and reuse the SolrConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-919&quot;&gt;&lt;del&gt;SOLR-919&lt;/del&gt;&lt;/a&gt; above and beyond what already exist&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree with the configuration . Though the regex seems to be an overkill .I am yet to see why it would be useful. Moreover , it leaves ambiguity as to what are the jars which got loaded .&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It seems logical that configuration should be able to affect where/how libraries are loaded.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;yes configuration should have a say of the libraries. But the configuration should be a data structure. I see it as a source of information to the system. This will enable users plugin there own SolrConfigs implementations (loaded from external data sources zookeeper etc ).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It&apos;s not clear to me that you want different resource loaders for each shared SolrConfig - people would definitely want to avoid loading more than one copy of dictionary based stemmers such as kstemmer or smart_cn. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;SolrResourceLoader is a lightweight component.  There is no need to couple it with the fact whether  SolrConfig is shared or not. &lt;/p&gt;

&lt;p&gt;My patch is slightly awkward, But that was introduced because of the regex option. Otherwise it would have been simpler. But ,overall , my  patch introduced fewer changes .&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;SolrConfig is currently a mix of mutable / immutable - for example CacheConfig contains cumulative stats (in addition to the resource loader of course)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;SolrConfig holds a reference to the SolrResourceLoader, but it never uses it anywhere internally. The CacheConfig is an anomaly. But that can be rectified . &lt;/p&gt;
</comment>
                            <comment id="12764547" author="noble.paul" created="Mon, 12 Oct 2009 05:51:58 +0100"  >&lt;p&gt;Anyway , I do not wish to delay the  1.4 release by wringing my hand on the specifics of the implementation&lt;/p&gt;</comment>
                            <comment id="12764688" author="yseeley@gmail.com" created="Mon, 12 Oct 2009 15:07:17 +0100"  >&lt;blockquote&gt;&lt;p&gt;Though the regex seems to be an overkill&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure... but regex is built into Java and globbing is not.  Comments in the code say we should implement globbing in the future.&lt;br/&gt;
And since the regex is specified via the &quot;regex&quot; attribute (as opposed to the value of an XML element) it&apos;s perfectly extensible in the future.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;the configuration should be a data structure. I see it as a source of information to the system.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Configuration can also have behavior.  The important part is that is the separation from XML and allowing others to create configuration objects.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;SolrResourceLoader is a lightweight component. There is no need to couple it with the fact whether SolrConfig is shared or not. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Just bringing up that it&apos;s not lightweight if has a separate classloader that loads heavyweight things, and separate classloaders don&apos;t sound like they will work well with cached Schemas... seems like they at least need a common classloader parent for anything loaded by the schema.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;But ,overall , my patch introduced fewer changes .&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s not true though... Hoss pointed out the risk for embedded users.  And it seems like you were bit by this yourself - see CoreContainer.create()... the Schema is created &lt;b&gt;before&lt;/b&gt; the SolrCore is, and thus would not have been using the right classloader.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;SolrConfig holds a reference to the SolrResourceLoader, but it never uses it anywhere internally.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;See above - the schema uses the loader from SolrConfig.&lt;/p&gt;</comment>
                            <comment id="12764700" author="yseeley@gmail.com" created="Mon, 12 Oct 2009 15:45:39 +0100"  >&lt;p&gt;I&apos;ve committed this since it  does not change any public APIs, but only adds the &amp;lt;lib&amp;gt; elements to solrconfig.xml, and does not preclude changing to the approach that Noble took in the future.&lt;/p&gt;</comment>
                            <comment id="12775885" author="gsingers" created="Tue, 10 Nov 2009 15:52:15 +0000"  >&lt;p&gt;Bulk close for Solr 1.4&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12435770">SOLR-1433</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12421827" name="SOLR-1449.patch" size="38926" author="yseeley@gmail.com" created="Sun, 11 Oct 2009 17:51:30 +0100"/>
                            <attachment id="12421516" name="SOLR-1449.patch" size="27023" author="noble.paul" created="Wed, 7 Oct 2009 12:20:48 +0100"/>
                            <attachment id="12421448" name="SOLR-1449.patch" size="29228" author="hossman" created="Tue, 6 Oct 2009 18:49:06 +0100"/>
                            <attachment id="12421246" name="SOLR-1449.patch" size="27693" author="markrmiller@gmail.com" created="Mon, 5 Oct 2009 03:27:03 +0100"/>
                            <attachment id="12420872" name="SOLR-1449.patch" size="30441" author="hossman" created="Wed, 30 Sep 2009 03:04:19 +0100"/>
                            <attachment id="12420821" name="SOLR-1449.patch" size="28429" author="hossman" created="Tue, 29 Sep 2009 20:42:04 +0100"/>
                            <attachment id="12420666" name="SOLR-1449.patch" size="28453" author="hossman" created="Sun, 27 Sep 2009 23:36:19 +0100"/>
                            <attachment id="12420665" name="SOLR-1449.patch" size="26714" author="hossman" created="Sun, 27 Sep 2009 22:29:38 +0100"/>
                            <attachment id="12420641" name="SOLR-1449.patch" size="20065" author="hossman" created="Sun, 27 Sep 2009 00:39:51 +0100"/>
                            <attachment id="12420517" name="SOLR-1449.patch" size="12989" author="hossman" created="Fri, 25 Sep 2009 01:39:25 +0100"/>
                            <attachment id="12420154" name="SOLR-1449.patch" size="11504" author="hossman" created="Mon, 21 Sep 2009 03:28:47 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 22 Sep 2009 13:23:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6205</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxl73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19753</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>