<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:16:36 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-424/SOLR-424.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-424] The ruby output type produces incorrect output for numeric types without a value</title>
                <link>https://issues.apache.org/jira/browse/SOLR-424</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When parsing the Ruby output returned from Solr, if a numerical value has no value in the index, it causes an invalid Ruby hash to be returned.  For instance:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt; 
 &apos;response&apos;=&amp;gt;{&apos;numFound&apos;=&amp;gt;1,&apos;start&apos;=&amp;gt;0,&apos;maxScore&apos;=&amp;gt;4.951244,&apos;docs&apos;=&amp;gt;[
	{
	 &apos;subclass_t&apos;=&amp;gt;&apos;Protocol&apos;,
	 &apos;pk_i&apos;=&amp;gt;1,
	 &apos;id&apos;=&amp;gt;&apos;Protocol:1&apos;,
	 &apos;name_t&apos;=&amp;gt;&apos;Falcipain IC50&apos;,
	 &apos;group_id_i&apos;=&amp;gt;,
	 &apos;score&apos;=&amp;gt;4.951244}]
 }}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;is not a valid hash because &apos;group_id_i&apos; does not resolve to anything.  It should resolve to nil:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt; 
 &apos;response&apos;=&amp;gt;{&apos;numFound&apos;=&amp;gt;1,&apos;start&apos;=&amp;gt;0,&apos;maxScore&apos;=&amp;gt;4.951244,&apos;docs&apos;=&amp;gt;[
	{
	 &apos;subclass_t&apos;=&amp;gt;&apos;Protocol&apos;,
	 &apos;pk_i&apos;=&amp;gt;1,
	 &apos;id&apos;=&amp;gt;&apos;Protocol:1&apos;,
	 &apos;name_t&apos;=&amp;gt;&apos;Falcipain IC50&apos;,
	 &apos;group_id_i&apos;=&amp;gt;nil,
	 &apos;score&apos;=&amp;gt;4.951244}]
 }}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12383479">SOLR-424</key>
            <summary>The ruby output type produces incorrect output for numeric types without a value</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ehatcher">Erik Hatcher</assignee>
                                    <reporter username="kschrader">Kurt Schrader</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Nov 2007 02:24:14 +0000</created>
                <updated>Fri, 10 May 2013 11:40:25 +0100</updated>
                            <resolved>Thu, 19 Jun 2008 22:51:20 +0100</resolved>
                                    <version>1.1.0</version>
                    <version>1.2</version>
                    <version>1.3</version>
                                    <fixVersion>1.3</fixVersion>
                                    <component>clients - ruby - flare</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12546536" author="kschrader" created="Thu, 29 Nov 2007 02:28:14 +0000"  >&lt;p&gt;Here is a patch for the issue.  The code seems to be untested, along with all of the other output types, so I couldn&apos;t find a test case to modify to cover this issue.&lt;/p&gt;</comment>
                            <comment id="12546539" author="yseeley@gmail.com" created="Thu, 29 Nov 2007 02:35:45 +0000"  >&lt;p&gt;I believe the underlying issue is that there isn&apos;t validation during indexing.&lt;br/&gt;
An empty string is not a valid number... if you wish to leave the number out of that document, then leave it entirely out.&lt;/p&gt;

&lt;p&gt;For a legacy lucene index, I think a zero length integer field should map to 0, not null (which is not an integer).&lt;/p&gt;</comment>
                            <comment id="12546541" author="yseeley@gmail.com" created="Thu, 29 Nov 2007 02:41:49 +0000"  >&lt;p&gt;Attaching patch for the output side of things.&lt;/p&gt;</comment>
                            <comment id="12546905" author="kschrader" created="Thu, 29 Nov 2007 21:33:34 +0000"  >&lt;p&gt;The problem with making it zero is that it can cause problems if zero is a valid value.  You don&apos;t want to run a search for records with a value of zero there and have all of the records with no value turn up as well.&lt;/p&gt;</comment>
                            <comment id="12546910" author="yseeley@gmail.com" created="Thu, 29 Nov 2007 21:37:43 +0000"  >&lt;p&gt;If the field has no value, it should not be added to the index.&lt;br/&gt;
Think about a field of type &quot;string&quot;... a zero length string is a valid value and should not be confused for an absent value.&lt;/p&gt;</comment>
                            <comment id="12546923" author="kschrader" created="Thu, 29 Nov 2007 22:26:53 +0000"  >&lt;p&gt;I understand that, but the issue here is how to deal with indexes that have a field with no value in legacy indexes.&lt;br/&gt;
To me it seems more logical to return nil to indicate to the user that their field is invalid.&lt;/p&gt;</comment>
                            <comment id="12549681" author="ehatcher" created="Sat, 8 Dec 2007 10:48:35 +0000"  >&lt;p&gt;I agree with Kurt - nil makes more sense than zero in this case.&lt;/p&gt;</comment>
                            <comment id="12549786" author="yseeley@gmail.com" created="Sun, 9 Dec 2007 02:10:07 +0000"  >&lt;p&gt;But we don&apos;t allow nil as an integer value when indexing (except by accident), so how can it be a valid value coming back out?  The way to represent &quot;no value&quot; in lucene is to leave the value out.&lt;/p&gt;</comment>
                            <comment id="12558069" author="otis" created="Fri, 11 Jan 2008 19:07:04 +0000"  >&lt;p&gt;For what it&apos;s worth, I&apos;ve had 2 additional people say that returning the correct Ruby output would be better...&lt;/p&gt;</comment>
                            <comment id="12565561" author="yourabi" created="Mon, 4 Feb 2008 21:59:54 +0000"  >&lt;p&gt;Since all response writers implement the TextResponseWriter abstract class it seems like it might make more sense to tweak writeVal (line 115)&lt;/p&gt;

&lt;p&gt;from:  if (val==null)&lt;br/&gt;
to:     if (val==null || val.toString().length() == 0 || &quot;&quot;.equals(val.toString())) {&lt;/p&gt;

&lt;p&gt;As Yonik has pointed out &amp;#8211; this is just part of the problem, the other being how did it get to be empty in the first place. Perhaps breaking this up into two separate issues makes more sense?&lt;/p&gt;

&lt;p&gt;Attaching (trivial) patch to TextResponseWriter.&lt;/p&gt;

&lt;p&gt;Feedback please.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Yousef&lt;/p&gt;</comment>
                            <comment id="12565562" author="yourabi" created="Mon, 4 Feb 2008 22:00:29 +0000"  >&lt;p&gt;Tweak line 115 of TextResponseWriter.writeVal() to test not only for null but zero-length strings?&lt;/p&gt;</comment>
                            <comment id="12602842" author="klaasm" created="Fri, 6 Jun 2008 00:11:13 +0100"  >&lt;p&gt;Eric or Yonik, do you want to mentor this for 1.3?&lt;/p&gt;</comment>
                            <comment id="12604980" author="yourabi" created="Fri, 13 Jun 2008 22:40:28 +0100"  >&lt;p&gt;Slightly more correct version. Can someone please comment on the appropriateness of this patch, and what the wishes and desires are to close this bug.&lt;/p&gt;</comment>
                            <comment id="12604988" author="yseeley@gmail.com" created="Fri, 13 Jun 2008 23:01:10 +0100"  >&lt;p&gt;The latest patch would have a non-negligible performance impact (since it calls toString() and trim() on every object)&lt;br/&gt;
and incorrect output (since it would effectively disable zero length strings for any type, including strings).&lt;/p&gt;</comment>
                            <comment id="12604992" author="yourabi" created="Fri, 13 Jun 2008 23:18:18 +0100"  >&lt;p&gt;The other place I was thinking would be the WriteInt implementation in JsonResponseWriter &amp;#8211; do the check there.  Would that make more sense to you? &lt;/p&gt;</comment>
                            <comment id="12606102" author="yseeley@gmail.com" created="Wed, 18 Jun 2008 22:43:44 +0100"  >&lt;p&gt;attaching patch that uses a &quot;null&quot; value for legacy int/long lucene fields only when a zero length string is encountered as the field value.&lt;/p&gt;</comment>
                            <comment id="12606572" author="yseeley@gmail.com" created="Thu, 19 Jun 2008 22:51:20 +0100"  >&lt;p&gt;committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12384238" name="SOLR-424.patch" size="2208" author="yseeley@gmail.com" created="Wed, 18 Jun 2008 22:43:44 +0100"/>
                            <attachment id="12383994" name="TextResponseWriter-424.java.patch" size="766" author="yourabi" created="Fri, 13 Jun 2008 22:40:28 +0100"/>
                            <attachment id="12374715" name="TextResponseWriter-SOLR-424.patch" size="761" author="yourabi" created="Mon, 4 Feb 2008 22:00:29 +0000"/>
                            <attachment id="12370494" name="fix_ruby_output.patch" size="1385" author="kschrader" created="Thu, 29 Nov 2007 02:28:14 +0000"/>
                            <attachment id="12370495" name="zero_length_int.patch" size="819" author="yseeley@gmail.com" created="Thu, 29 Nov 2007 02:41:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 29 Nov 2007 02:35:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7175</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxrf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20761</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>