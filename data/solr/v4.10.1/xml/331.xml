<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:16:22 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-331/SOLR-331.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-331] StringIndexOutOfBoundsException when using synonyms and highlighting</title>
                <link>https://issues.apache.org/jira/browse/SOLR-331</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When searching index using highlighting and synonyms we get the following exception:&lt;/p&gt;

&lt;p&gt;java.lang.StringIndexOutOfBoundsException: String index out of range: 42&lt;br/&gt;
	at java.lang.String.substring(String.java:1935)&lt;br/&gt;
	at org.apache.lucene.search.highlight.Highlighter.getBestTextFragments(Highlighter.java:271)&lt;br/&gt;
	at org.apache.solr.util.HighlightingUtils.doHighlighting(HighlightingUtils.java:266)&lt;br/&gt;
	at org.apache.solr.request.StandardRequestHandler.handleRequest(StandardRequestHandler.java:164)&lt;br/&gt;
	at org.apache.solr.core.SolrCore.execute(SolrCore.java:595)&lt;br/&gt;
	at org.apache.solr.servlet.SolrServlet.doGet(SolrServlet.java:92)&lt;br/&gt;
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:697)&lt;br/&gt;
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:810)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)&lt;br/&gt;
	at org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter(ReplyHeaderFilter.java:96)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)&lt;br/&gt;
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)&lt;br/&gt;
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)&lt;br/&gt;
	at org.jboss.web.tomcat.security.SecurityAssociationValve.invoke(SecurityAssociationValve.java:175)&lt;br/&gt;
	at org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:74)&lt;br/&gt;
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)&lt;br/&gt;
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)&lt;br/&gt;
	at org.jboss.web.tomcat.tc5.jca.CachedConnectionValve.invoke(CachedConnectionValve.java:156)&lt;br/&gt;
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)&lt;br/&gt;
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)&lt;br/&gt;
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)&lt;br/&gt;
	at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)&lt;br/&gt;
	at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)&lt;br/&gt;
	at org.apache.tomcat.util.net.MasterSlaveWorkerThread.run(MasterSlaveWorkerThread.java:112)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;

&lt;p&gt;the problem is reproduceable and permanent with the attached files to this issue. Just use SOLR internal &lt;br/&gt;
&quot;Make a Query&lt;span class=&quot;error&quot;&gt;&amp;#91;Full Interface&amp;#93;&lt;/span&gt;&quot; Admin Interface option and search for:&lt;br/&gt;
Statement: adhs&lt;br/&gt;
Enable Highlighting: X&lt;br/&gt;
Fields to Highlight: content&lt;/p&gt;

&lt;p&gt;e.g.&lt;br/&gt;
&lt;a href=&quot;http://127.0.0.1:8080/solr/select?indent=on&amp;amp;version=2.2&amp;amp;q=adhs&amp;amp;start=0&amp;amp;rows=10&amp;amp;fl=*%2Cscore&amp;amp;qt=standard&amp;amp;wt=standard&amp;amp;explainOther=&amp;amp;hl=on&amp;amp;hl.fl=content&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://127.0.0.1:8080/solr/select?indent=on&amp;amp;version=2.2&amp;amp;q=adhs&amp;amp;start=0&amp;amp;rows=10&amp;amp;fl=*%2Cscore&amp;amp;qt=standard&amp;amp;wt=standard&amp;amp;explainOther=&amp;amp;hl=on&amp;amp;hl.fl=content&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thank you in advance!&lt;/p&gt;

&lt;p&gt;Oliver&lt;/p&gt;</description>
                <environment>&lt;p&gt;JBOSS  4.0.5.GA&lt;br/&gt;
SOLR 1.2 binary release&lt;/p&gt;</environment>
        <key id="12375677">SOLR-331</key>
            <summary>StringIndexOutOfBoundsException when using synonyms and highlighting</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="oliverkuhn">Oliver Kuhn</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Aug 2007 15:31:26 +0100</created>
                <updated>Fri, 10 May 2013 11:41:09 +0100</updated>
                            <resolved>Fri, 10 Aug 2007 16:58:32 +0100</resolved>
                                    <version>1.2</version>
                                    <fixVersion>1.2</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12518724" author="oliverkuhn" created="Thu, 9 Aug 2007 15:34:43 +0100"  >&lt;p&gt;to create index with our data we used: &lt;/p&gt;

&lt;p&gt;curl &lt;a href=&quot;http://127.0.0.1:8080/solr/update&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://127.0.0.1:8080/solr/update&lt;/a&gt; --data-binary @adhs_small.xml -H &quot;Content-type:text/xml; charset=utf-8&quot;&lt;br/&gt;
curl &lt;a href=&quot;http://127.0.0.1:8080/solr/update&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://127.0.0.1:8080/solr/update&lt;/a&gt; --data-binary &quot;&amp;lt;commit /&amp;gt;&quot;&lt;/p&gt;

&lt;p&gt;adhs_small.xml contains our content.&lt;/p&gt;</comment>
                            <comment id="12518769" author="yseeley@gmail.com" created="Thu, 9 Aug 2007 18:34:15 +0100"  >&lt;p&gt;Thanks for the very clear report.&lt;br/&gt;
It looks like WordDelimiterFilter is messing up the offsets.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://localhost:8983/solr/admin/analysis.jsp?nt=name&amp;amp;name=content&amp;amp;highlight=on&amp;amp;val=&amp;amp;qverbose=on&amp;amp;qval=dummy+dummy+dummy+ADHS+dummy&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://localhost:8983/solr/admin/analysis.jsp?nt=name&amp;amp;name=content&amp;amp;highlight=on&amp;amp;val=&amp;amp;qverbose=on&amp;amp;qval=dummy+dummy+dummy+ADHS+dummy&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As a side note, you probably don&apos;t want to be expanding the same synonym list at both index and query time.  And expanding multi-word synonyms (of differing numbers of tokens) at query time doesn&apos;t really work... see the wiki for details on that.&lt;/p&gt;</comment>
                            <comment id="12518782" author="yseeley@gmail.com" created="Thu, 9 Aug 2007 18:55:01 +0100"  >&lt;p&gt;OK, the issue is the offsets for subwords.  For example, WordDelimiterFilter is looking at&lt;br/&gt;
Aufmerksamkeits-Defizite, and it doesn&apos;t know that it&apos;s not part of the original text, so when it creates the sub-token&lt;br/&gt;
Aufmerksamkeits, it sets the offsets to match the length of &quot;Aufmerksamkeits&quot; (which is bigger than the original).&lt;/p&gt;

&lt;p&gt;Some ideas to fix:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Make sure that generated offsets never exceed original offsets (this we should always do).  That will eliminate the exception, but generate highlighting mismatches in some cases.&lt;/li&gt;
	&lt;li&gt;try to recognize non-original tokens like synonyms&lt;br/&gt;
  1) by token type???  but not everyone uses that&lt;br/&gt;
  2) by seeing that the offsets don&apos;t match the token... stemming would cause this, but stemming should always be after WordDelimiterFilter.  Anything else that would cause &quot;length != end-start&quot;?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12518890" author="yseeley@gmail.com" created="Fri, 10 Aug 2007 03:11:36 +0100"  >&lt;p&gt;This patch seems to work fine (not adjusting offsets if they don&apos;t match the original token length)&lt;/p&gt;</comment>
                            <comment id="12519053" author="yseeley@gmail.com" created="Fri, 10 Aug 2007 16:58:32 +0100"  >&lt;p&gt;committed.&lt;/p&gt;</comment>
                            <comment id="12519055" author="oliverkuhn" created="Fri, 10 Aug 2007 17:26:38 +0100"  >&lt;p&gt;Hi Yonik, thanks for the quick answer.. we will try this patch in the near future!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12363549" name="WordDelimiterFilter.patch" size="3422" author="yseeley@gmail.com" created="Fri, 10 Aug 2007 03:11:36 +0100"/>
                            <attachment id="12363492" name="adhs_small.xml" size="227" author="oliverkuhn" created="Thu, 9 Aug 2007 15:34:43 +0100"/>
                            <attachment id="12363491" name="schema.xml" size="13482" author="oliverkuhn" created="Thu, 9 Aug 2007 15:34:43 +0100"/>
                            <attachment id="12363490" name="synonyms.txt" size="678" author="oliverkuhn" created="Thu, 9 Aug 2007 15:34:43 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 9 Aug 2007 17:34:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7261</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxrzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20853</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>