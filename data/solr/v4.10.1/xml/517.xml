<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:19:07 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-517/SOLR-517.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-517] highlighter doesn&apos;t work with hl.requireFieldMatch=true on un-optimized index</title>
                <link>https://issues.apache.org/jira/browse/SOLR-517</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;On un-optimized index, highlighter doesn&apos;t work with hl.requireFieldMatch=true.&lt;/p&gt;

&lt;p&gt;see:&lt;br/&gt;
&lt;a href=&quot;http://www.nabble.com/hl.requireFieldMatch-and-idf-td16324482.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/hl.requireFieldMatch-and-idf-td16324482.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12392633">SOLR-517</key>
            <summary>highlighter doesn&apos;t work with hl.requireFieldMatch=true on un-optimized index</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="koji">Koji Sekiguchi</assignee>
                                    <reporter username="koji">Koji Sekiguchi</reporter>
                        <labels>
                    </labels>
                <created>Sat, 29 Mar 2008 14:29:21 +0000</created>
                <updated>Fri, 10 May 2013 11:40:33 +0100</updated>
                            <resolved>Thu, 21 Aug 2008 19:38:57 +0100</resolved>
                                    <version>1.2</version>
                    <version>1.3</version>
                                    <fixVersion>1.3</fixVersion>
                                    <component>highlighter</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12583325" author="koji" created="Sat, 29 Mar 2008 14:32:45 +0000"  >&lt;p&gt;Attached patch uses QueryScorer(query, fieldName) constructor instead of QueryScorer(query, reader, fieldName) to get QueryScorer instance. This solves the problem.&lt;/p&gt;</comment>
                            <comment id="12583509" author="koji" created="Mon, 31 Mar 2008 01:53:30 +0100"  >&lt;p&gt;Added a test case.&lt;/p&gt;</comment>
                            <comment id="12602857" author="klaasm" created="Fri, 6 Jun 2008 00:36:56 +0100"  >&lt;p&gt;Koji:  Is this resolved?  I seemed to recall that we brought this up on java-dev, but I can&apos;t find the thread at the moment.&lt;/p&gt;

&lt;p&gt;(I don&apos;t think that the right thing to do is remove idf fetching of the terms as your patch proposes)&lt;/p&gt;</comment>
                            <comment id="12602884" author="koji" created="Fri, 6 Jun 2008 03:47:09 +0100"  >&lt;p&gt;just updated patch for current trunk.&lt;/p&gt;</comment>
                            <comment id="12602885" author="koji" created="Fri, 6 Jun 2008 03:48:28 +0100"  >&lt;p&gt;Mike,&lt;/p&gt;

&lt;p&gt;I think we discussed this on solr-user, not java-dev.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.nabble.com/hl.requireFieldMatch-and-idf-td16324482.html#a16324482&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/hl.requireFieldMatch-and-idf-td16324482.html#a16324482&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As I pointed out in the thread, I think Lucene can return negative idf and this is Lucene&apos;s feature.&lt;br/&gt;
Do you agree on this point?&lt;/p&gt;

&lt;p&gt;&amp;gt; (I don&apos;t think that the right thing to do is remove idf fetching of the terms as your patch proposes)&lt;/p&gt;

&lt;p&gt;How about introducing a new hl parameter to choose QueryScorer constructor so that users to avoid negative idf with un-optimized index, instead of just removing idf fetching?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (reqFieldMatch) {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (considerIdf) &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; QueryScorer(query, request.getSearcher().getReader(), fieldName);
  &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; QueryScorer(query, fieldName);
}
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; QueryScorer(query);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12621665" author="markrmiller@gmail.com" created="Tue, 12 Aug 2008 02:14:20 +0100"  >&lt;p&gt;I&apos;d be happy to fix this in the Lucene Highlighter, but what is actually going on to get a negative? By the look of it, I don&apos;t see possible values that could create a negative result - even if you allowed for negative inputs, you could still only get positives, NAN, or Infinity.&lt;/p&gt;

&lt;p&gt;Can you elaborate or make a test case?&lt;/p&gt;

&lt;p&gt;Also, it doesn&apos;t appear helpful to use the IndexReader method unless you want to use those scores for other things (gradient highlighting etc). If you count on that, it can&apos;t be changed, if you don&apos;t it should be changed.&lt;/p&gt;</comment>
                            <comment id="12621667" author="koji" created="Tue, 12 Aug 2008 02:44:02 +0100"  >&lt;blockquote&gt;&lt;p&gt;Can you elaborate or make a test case?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The patch includes a test case that indicates negative idf. If it doesn&apos;t please let me know so that I do double check.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, it doesn&apos;t appear helpful to use the IndexReader method unless you want to use those scores for other things (gradient highlighting etc). If you count on that, it can&apos;t be changed, if you don&apos;t it should be changed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m afraid but I don&apos;t understand what you are saying (current trunk is using IndexReader method).&lt;/p&gt;</comment>
                            <comment id="12621671" author="markrmiller@gmail.com" created="Tue, 12 Aug 2008 03:11:53 +0100"  >&lt;p&gt;Yeah, I had tried to turn that test into duplicate Lucene actions, and I couldn&apos;t replicate the problem. I will give it a whirl with solr when I get a chance.&lt;/p&gt;

&lt;p&gt;What values for totalNumDocs and docFreq are being used when you get the exception? I still don&apos;t see how your seeing a negative there...&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;I&apos;m afraid but I don&apos;t understand what you are saying (current trunk is using IndexReader method).&lt;/p&gt;

&lt;p&gt;If you use the IndexReader method token scoring is done using the idf formula - so you could do highlighting to varying degrees based on the score. There is a cost to this to get the info for the idf calculation and then also the calculation. If you don&apos;t use the IndexReader method, hits are just scored 1 or 0 pretty much. Thats all thats need for basic highlighting. But if no one is using the richer highlighting scores, you pay for nothing.&lt;/p&gt;</comment>
                            <comment id="12621687" author="koji" created="Tue, 12 Aug 2008 05:23:18 +0100"  >&lt;p&gt;Ok, I provided a Lucene program (TestNegativeIdf.java) to show negative idf.&lt;/p&gt;

&lt;p&gt;To see negative idf, do not optimize() (do not uncomment the following line):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void deleteDocument() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    IndexWriter writer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IndexWriter( dir, analyzer, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, MaxFieldLength.LIMITED );
    writer.deleteDocuments( &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Term( &lt;span class=&quot;code-quote&quot;&gt;&quot;t_text1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;del&quot;&lt;/span&gt; ) );
    &lt;span class=&quot;code-comment&quot;&gt;// To see negative idf, keep comment the following line
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;//writer.optimize();
&lt;/span&gt;    writer.close();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You&apos;ll get a null fragment due to negative idf. Easiest way to avoid negative idf, switch the scorer:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// This scorer can &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; negative idf -&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; fragment
&lt;/span&gt;Scorer scorer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; QueryScorer( query, searcher.getIndexReader(), &lt;span class=&quot;code-quote&quot;&gt;&quot;t_text1&quot;&lt;/span&gt; );
&lt;span class=&quot;code-comment&quot;&gt;// This scorer doesn&apos;t use idf (patch version)
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//Scorer scorer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; QueryScorer( query, &lt;span class=&quot;code-quote&quot;&gt;&quot;t_text1&quot;&lt;/span&gt; );&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12621688" author="koji" created="Tue, 12 Aug 2008 05:34:58 +0100"  >&lt;p&gt;updated for current trunk.&lt;/p&gt;</comment>
                            <comment id="12621769" author="markrmiller@gmail.com" created="Tue, 12 Aug 2008 12:02:07 +0100"  >&lt;p&gt;Thanks much Koji - appreciate it and if it is indeed something I can handle at the Lucene highlighter I&apos;ll add an issue soon.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; You&apos;ll get a null fragment due to negative idf. Easiest way to avoid negative idf, switch the scorer:&lt;/p&gt;

&lt;p&gt;Thanks! Thats probably the issue...I was looking for an exception - didn&apos;t realize it emitted a null fragment instead. I&apos;ll dig into things sometime today.&lt;/p&gt;</comment>
                            <comment id="12621778" author="markrmiller@gmail.com" created="Tue, 12 Aug 2008 12:28:59 +0100"  >&lt;p&gt;I&apos;ll take care of it at the Lucene Highlighter level: &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1355&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LUCENE-1355&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks again Koji.&lt;/p&gt;</comment>
                            <comment id="12622026" author="koji" created="Wed, 13 Aug 2008 00:26:56 +0100"  >&lt;p&gt;Thanks Mark for taking care of this issue at Lucene Highlighter level. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12623947" author="koji" created="Wed, 20 Aug 2008 10:48:21 +0100"  >&lt;p&gt;I&apos;ll verify this soon. If &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1355&quot; title=&quot;Using the WeightedTerms option in the Highlighter can cause fragments to be supressed for indexes with deletes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-1355&quot;&gt;&lt;del&gt;LUCENE-1355&lt;/del&gt;&lt;/a&gt; solves this issue, I&apos;ll commit new lucene-highlighter-2.4-dev.jar.&lt;/p&gt;</comment>
                            <comment id="12623976" author="koji" created="Wed, 20 Aug 2008 13:33:30 +0100"  >&lt;p&gt;Hmmm. New lucene-highlighter-2.4-dev.jar solves this issue but causes testPhraseHighlighter junit error:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ ant clean test
     :
    [junit] Running org.apache.solr.highlight.HighlighterTest
    [junit] Tests run: 17, Failures: 0, Errors: 1, Time elapsed: 21.313 sec
    [junit] Test org.apache.solr.highlight.HighlighterTest FAILED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll look into this on tomorrow. &lt;/p&gt;</comment>
                            <comment id="12624134" author="koji" created="Wed, 20 Aug 2008 22:00:35 +0100"  >&lt;p&gt;The cause of the junit error is lack of lucene-memory-2.4-dev.jar. The latest lucene-memory-2.4-dev.jar needs &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-1334&quot; title=&quot;Term improvement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-1334&quot;&gt;&lt;del&gt;LUCENE-1334&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
So we need these changes to be committed (r687014):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ svn status
M      lib\lucene-snowball-2.4-dev.jar
M      lib\lucene-core-2.4-dev.jar
M      lib\lucene-highlighter-2.4-dev.jar
M      lib\lucene-spellchecker-2.4-dev.jar
M      lib\lucene-analyzers-2.4-dev.jar
A      lib\lucene-memory-2.4-dev.jar
M      lib\lucene-queries-2.4-dev.jar
M      src\test\org\apache\solr\highlight\HighlighterTest.java
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;All test pass.&lt;br/&gt;
I&apos;ll commit them tomorrow if there is no objections.&lt;/p&gt;</comment>
                            <comment id="12624446" author="koji" created="Thu, 21 Aug 2008 19:38:18 +0100"  >&lt;p&gt;Committed revision 687825.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12402201">LUCENE-1355</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12388019" name="SOLR-517.patch" size="2082" author="koji" created="Tue, 12 Aug 2008 05:34:58 +0100"/>
                            <attachment id="12383523" name="SOLR-517.patch" size="2092" author="koji" created="Fri, 6 Jun 2008 03:47:09 +0100"/>
                            <attachment id="12378913" name="SOLR-517.patch" size="2092" author="koji" created="Mon, 31 Mar 2008 01:53:30 +0100"/>
                            <attachment id="12378862" name="SOLR-517.patch" size="765" author="koji" created="Sat, 29 Mar 2008 14:32:44 +0000"/>
                            <attachment id="12388018" name="TestNegativeIdf.java" size="3151" author="koji" created="Tue, 12 Aug 2008 05:23:18 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 5 Jun 2008 23:36:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7087</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxqun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20669</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>