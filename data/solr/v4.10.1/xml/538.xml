<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:24:45 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-538/SOLR-538.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-538] CopyField maxLength property</title>
                <link>https://issues.apache.org/jira/browse/SOLR-538</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;As discussed shortly on the mailing list (&lt;a href=&quot;http://www.mail-archive.com/solr-user@lucene.apache.org/msg09807.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.mail-archive.com/solr-user@lucene.apache.org/msg09807.html&lt;/a&gt;), the objective of this task is to add a maxLength property to the CopyField &quot;command&quot;. This property simply limits the number of characters that are copied.&lt;/p&gt;

&lt;p&gt;This is particularly useful to avoid very slow highlighting when the index contains big documents.&lt;/p&gt;

&lt;p&gt;Example :&lt;br/&gt;
&amp;lt;copyField source=&quot;text&quot; dest=&quot;highlight&quot; maxLength=&quot;30000&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;This approach has also the advantage of limiting the index size for large documents (the original text field does not need to be stored and to have term vectors). However, the index is bigger for small documents...&lt;/p&gt;</description>
                <environment></environment>
        <key id="12393893">SOLR-538</key>
            <summary>CopyField maxLength property</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="koji">Koji Sekiguchi</assignee>
                                    <reporter username="dessaigne">Nicolas Dessaigne</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Apr 2008 17:12:20 +0100</created>
                <updated>Tue, 10 Nov 2009 15:51:42 +0000</updated>
                            <resolved>Sun, 30 Nov 2008 04:52:15 +0000</resolved>
                                                    <fixVersion>1.4</fixVersion>
                                    <component>update</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="12588621" author="yorgos" created="Mon, 14 Apr 2008 17:16:11 +0100"  >&lt;p&gt;Should be applied on svn trunk (tested on revision 647855)&lt;/p&gt;</comment>
                            <comment id="12606694" author="yorgos" created="Fri, 20 Jun 2008 10:57:19 +0100"  >&lt;p&gt;Updated for latest trunk (tested on revision 669140)&lt;/p&gt;</comment>
                            <comment id="12621015" author="otis" created="Fri, 8 Aug 2008 20:13:16 +0100"  >&lt;p&gt;This no longer applies.  Could you bring it up to date?  I also noticed new code that introduces new coding style (e.g. tab indentation instead of 2-space indentation) - could you please make it look like the existing Solr code style?&lt;/p&gt;

&lt;p&gt;$ patch -p1 -i CopyFieldMaxLength.patch --dry-run&lt;br/&gt;
patching file src/java/org/apache/solr/schema/CopyField.java&lt;br/&gt;
patching file src/java/org/apache/solr/schema/IndexSchema.java&lt;br/&gt;
Hunk #1 succeeded at 601 with fuzz 2 (offset 44 lines).&lt;br/&gt;
Hunk #2 FAILED at 615.&lt;br/&gt;
Hunk #3 FAILED at 636.&lt;br/&gt;
Hunk #4 FAILED at 650.&lt;br/&gt;
Hunk #5 succeeded at 859 (offset 67 lines).&lt;br/&gt;
Hunk #6 succeeded at 884 (offset 67 lines).&lt;br/&gt;
Hunk #7 succeeded at 1065 (offset 67 lines).&lt;br/&gt;
Hunk #8 FAILED at 1086.&lt;br/&gt;
Hunk #9 succeeded at 1099 (offset 67 lines).&lt;br/&gt;
Hunk #10 succeeded at 1112 (offset 67 lines).&lt;br/&gt;
4 out of 10 hunks FAILED &amp;#8211; saving rejects to file src/java/org/apache/solr/schema/IndexSchema.java.rej&lt;br/&gt;
patching file src/java/org/apache/solr/update/DocumentBuilder.java&lt;br/&gt;
Hunk #2 succeeded at 121 (offset 29 lines).&lt;br/&gt;
Hunk #3 succeeded at 129 (offset 29 lines).&lt;br/&gt;
Hunk #4 succeeded at 219 (offset 29 lines).&lt;br/&gt;
Hunk #5 succeeded at 247 (offset 29 lines).&lt;br/&gt;
Hunk #6 succeeded at 259 (offset 29 lines).&lt;br/&gt;
patching file src/test/org/apache/solr/schema/CopyFieldTest.java&lt;br/&gt;
patching file src/test/test-files/solr/conf/schema-copyfield-test.xml&lt;/p&gt;</comment>
                            <comment id="12621352" author="larsko" created="Mon, 11 Aug 2008 05:24:40 +0100"  >&lt;p&gt;Attaching new patch which applies to current trunk and changes some minor things wrt error handling and testing.&lt;/p&gt;</comment>
                            <comment id="12622879" author="otis" created="Fri, 15 Aug 2008 15:51:59 +0100"  >&lt;p&gt;Lars, do you think you could change those tabs into 2 spaces to follow the code style convention?&lt;/p&gt;

&lt;p&gt;In CopyFieldTest I see things like:&lt;/p&gt;

&lt;p&gt;+              try &lt;/p&gt;
{
+                       new CopyField(null,
+                                       new SchemaField(&quot;destination&quot;, new TextField()), 1000);
+                       fail(&quot;CopyField failed with null SchemaField argument.&quot;);
+               }
&lt;p&gt; catch (IllegalArgumentException e) {&lt;br/&gt;
+                       assertTrue(e.getLocalizedMessage().contains(&quot;can&apos;t be NULL&quot;));&lt;/p&gt;

&lt;p&gt;Does the assertTrue message really accurately describe the exception?  What is null in the above case?  What happens when maxLength=&quot;0&quot;?  The previous/default copy-everything behaviour, right?  Maybe I missed it, but I didn&apos;t see that in any javadocs or comments or the example schema.xml.&lt;/p&gt;</comment>
                            <comment id="12623078" author="larsko" created="Sat, 16 Aug 2008 04:06:51 +0100"  >&lt;p&gt;Attaching new patch which fixes tabs.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Does the assertTrue message really accurately describe the exception? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s actually not the assertTrue message, that&apos;s asserting that the exception message contains that string.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The previous/default copy-everything behaviour, right? Maybe I missed it, but I didn&apos;t see that in any javadocs or comments or the example schema.xml.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ve added a note to the schema.xml. It is also mentioned in the javadocs for the CopyField constructor.&lt;/p&gt;</comment>
                            <comment id="12627558" author="ryguasu" created="Tue, 2 Sep 2008 03:02:57 +0100"  >&lt;p&gt;When I apply this patch, the last line of test-files/solr/conf/schema-copyfield-test.xml seems to get cut off. That is, rather than&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;br/&gt;
 &amp;lt;!-- Similarity is the scoring routine for each document vs a query.&lt;br/&gt;
      A custom similarity may be specified here, but the default is fine&lt;br/&gt;
      for most applications.&lt;br/&gt;
 --&amp;gt;&lt;br/&gt;
 &amp;lt;!-- &amp;lt;similarity class=&quot;org.apache.lucene.search.DefaultSimilarity&quot;/&amp;gt; --&amp;gt;&lt;br/&gt;
&lt;tt&gt;blank line&lt;/tt&gt;&lt;br/&gt;
&amp;lt;/schema&amp;gt;&lt;br/&gt;
&lt;tt&gt;EOF&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;I get&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;br/&gt;
 &amp;lt;!-- Similarity is the scoring routine for each document vs a query.&lt;br/&gt;
      A custom similarity may be specified here, but the default is fine&lt;br/&gt;
      for most applications.&lt;br/&gt;
 --&amp;gt;&lt;br/&gt;
 &amp;lt;!-- &amp;lt;similarity class=&quot;org.apache.lucene.search.DefaultSimilarity&quot;/&amp;gt; --&amp;gt;&lt;br/&gt;
&lt;tt&gt;blank line&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;EOF&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;This makes the XML invalid, and makes &quot;ant test&quot; fail.&lt;/p&gt;

&lt;p&gt;I thought I was just being inept with Windows/TortoiseSVN, but now I&apos;ve had the same thing happen when applying the patch with the patch command on the OS X command line. This makes me suspicious that there might be something wrong with the patch &amp;#8211; though I can&apos;t find anything wrong by looking at it manually. Any thoughts?&lt;/p&gt;</comment>
                            <comment id="12627602" author="larsko" created="Tue, 2 Sep 2008 09:17:07 +0100"  >&lt;blockquote&gt;&lt;p&gt;When I apply this patch, the last line of test-files/solr/conf/schema-copyfield-test.xml seems to get cut off.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sorry, my bad. That&apos;s what you get for modifying diffs manually. I&apos;m attaching a new version which should fix this problem.&lt;/p&gt;</comment>
                            <comment id="12628045" author="ryguasu" created="Wed, 3 Sep 2008 17:37:19 +0100"  >&lt;p&gt;Thanks, Lars; that was fast. I think this patch is going to be handy.&lt;/p&gt;

&lt;p&gt;I&apos;m wondering what people thought about an alternative approach to keeping stored fields from being too large, which would require mucking around with Lucene. In particular, the idea would be to allow field definitions like this:&lt;/p&gt;

&lt;p&gt;&amp;lt;field name=&quot;body&quot; type=&quot;text&quot; indexed=&quot;true&quot; stored=&quot;true&quot;&lt;br/&gt;
     omitNorms=&quot;false&quot; compressed=&quot;true&quot;&lt;br/&gt;
     maxFieldLength=&quot;2000&quot; storeOnlyAnalyzedText=&quot;true&quot;&lt;br/&gt;
/&amp;gt;&lt;/p&gt;

&lt;p&gt;Here we&apos;ve made the normal Lucene maxFieldLength (i.e. # tokens to analyze) configurable a field-by-field basis. And in this declaration we&apos;ve also made it so that what is stored is a function of what is analyzed. (Here if the first 2,000 tokens correspond to the first, say, 8,000 characters, then those 8,000 characters are what&apos;s going to be actually stored in the stored field.) This seems a little more natural than lopping off the text after a fixed number of characters.&lt;/p&gt;

&lt;p&gt;If I could do the above, I&apos;m thinking I would use that single field for both searching and highlighting. But if you wanted a separate field for highlighting (and were willing to have things run slower than with the current patch), then you could do this:&lt;/p&gt;

&lt;p&gt;&amp;lt;field name=&quot;body&quot; type=&quot;text&quot; indexed=&quot;true&quot; stored=&quot;false&quot; omitNorms=&quot;false&quot; /&amp;gt;&lt;br/&gt;
&amp;lt;field name=&quot;highlighting&quot; type=&quot;text&quot; indexed=&quot;false&quot; stored=&quot;true&quot;&lt;br/&gt;
     compressed=&quot;true&quot; maxFieldLength=&quot;2000&quot; storeOnlyAnalyzedText=&quot;true&quot; /&amp;gt;&lt;br/&gt;
&amp;lt;copyField src=&quot;body&quot; dest=&quot;highlighting&quot; /&amp;gt;&lt;/p&gt;</comment>
                            <comment id="12628054" author="larsko" created="Wed, 3 Sep 2008 17:57:05 +0100"  >&lt;p&gt;Interesting idea, but this should probably be a separate issue. It would require more significant changes, for example the update handler should probably warn when the value for a field is truncated etc.&lt;/p&gt;</comment>
                            <comment id="12632966" author="larsko" created="Sat, 20 Sep 2008 15:33:34 +0100"  >&lt;p&gt;Syncing patch with trunk.&lt;/p&gt;</comment>
                            <comment id="12645886" author="ryguasu" created="Fri, 7 Nov 2008 22:00:39 +0000"  >&lt;p&gt;Syncing w/ trunk r712067&lt;/p&gt;</comment>
                            <comment id="12645967" author="koji" created="Sat, 8 Nov 2008 07:50:10 +0000"  >&lt;p&gt;Thank you for the updated patch. I have some comments.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I think this breaks back-compat:&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/java/org/apache/solr/schema/IndexSchema.java
===================================================================
--- src/java/org/apache/solr/schema/IndexSchema.java	(revision 712067)
+++ src/java/org/apache/solr/schema/IndexSchema.java	(working copy)
  :
@@ -654,12 +664,12 @@
    * 
    * @see SolrCoreAware
    */
-  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void registerCopyField( &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; source, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; dest )
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void registerCopyField( &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; source, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; dest, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; maxLength )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the type of maxLength is int (not Integer) right?&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Can you use 2-space indentation instead of tab indentation?&lt;/li&gt;
	&lt;li&gt;Can you change &quot;@since 1.3&quot; javadoc comments to &quot;@since 1.4&quot;?&lt;/li&gt;
	&lt;li&gt;The new attribute &quot;maxLength&quot; may make users confused (number of chars or tokens?). How about using &quot;maxChars&quot; or something?&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="12645968" author="koji" created="Sat, 8 Nov 2008 07:58:12 +0000"  >&lt;p&gt;Attached a patch for branch-1.3. I have a performance issue on a highlight field and I&apos;ll see if this helps for my project in next week (I know that hl.maxAnalyzedChars helps, but I&apos;d like to reduce index size with &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-538&quot; title=&quot;CopyField maxLength property&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-538&quot;&gt;&lt;del&gt;SOLR-538&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="12645983" author="larsko" created="Sat, 8 Nov 2008 14:12:11 +0000"  >&lt;p&gt;Attaching new patch which&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;adds method for backwards compatibility&lt;/li&gt;
	&lt;li&gt;replaces tabs with 2 spaces&lt;/li&gt;
	&lt;li&gt;fixes javadoc&lt;/li&gt;
	&lt;li&gt;renames maxLength to maxChars&lt;br/&gt;
as per Koji&apos;s suggestions.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12649832" author="ryguasu" created="Fri, 21 Nov 2008 22:21:22 +0000"  >&lt;p&gt;Small change to bring Lars&apos; 2008-11-08 version of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-538&quot; title=&quot;CopyField maxLength property&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-538&quot;&gt;&lt;del&gt;SOLR-538&lt;/del&gt;&lt;/a&gt;.patch in sync with trunk r719187&lt;/p&gt;</comment>
                            <comment id="12651156" author="ryguasu" created="Wed, 26 Nov 2008 21:42:30 +0000"  >&lt;p&gt;Same as prev &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-538&quot; title=&quot;CopyField maxLength property&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-538&quot;&gt;&lt;del&gt;SOLR-538&lt;/del&gt;&lt;/a&gt;.patch (2008-11-21 02:21 PM), except with some unneeded carriage return characters removed. (This may be overly cautious, but I don&apos;t want those to cause problems for anyone.)&lt;/p&gt;</comment>
                            <comment id="12651238" author="shalinmangar" created="Thu, 27 Nov 2008 04:05:36 +0000"  >&lt;p&gt;Looking at the watchers, voters and the comments, a lot of people seem to be interested in this issue. Is there any objection on committing it to trunk?&lt;/p&gt;

&lt;p&gt;Koji, since you have used the patch yourself, would you like to take this up?&lt;/p&gt;</comment>
                            <comment id="12651786" author="koji" created="Sun, 30 Nov 2008 04:52:15 +0000"  >&lt;p&gt;Committed revision 721758. Thanks everyone!&lt;/p&gt;</comment>
                            <comment id="12775506" author="gsingers" created="Tue, 10 Nov 2009 15:51:42 +0000"  >&lt;p&gt;Bulk close for Solr 1.4&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12384359" name="CopyFieldMaxLength.patch" size="42994" author="yorgos" created="Fri, 20 Jun 2008 10:57:19 +0100"/>
                            <attachment id="12380074" name="CopyFieldMaxLength.patch" size="58406" author="yorgos" created="Mon, 14 Apr 2008 17:16:11 +0100"/>
                            <attachment id="12393558" name="SOLR-538-for-1.3.patch" size="43048" author="koji" created="Sat, 8 Nov 2008 07:58:12 +0000"/>
                            <attachment id="12394781" name="SOLR-538.patch" size="44277" author="ryguasu" created="Wed, 26 Nov 2008 21:42:30 +0000"/>
                            <attachment id="12394457" name="SOLR-538.patch" size="44319" author="ryguasu" created="Fri, 21 Nov 2008 22:21:22 +0000"/>
                            <attachment id="12393563" name="SOLR-538.patch" size="44568" author="larsko" created="Sat, 8 Nov 2008 14:12:11 +0000"/>
                            <attachment id="12393530" name="SOLR-538.patch" size="43593" author="ryguasu" created="Fri, 7 Nov 2008 22:00:38 +0000"/>
                            <attachment id="12390571" name="SOLR-538.patch" size="43976" author="larsko" created="Sat, 20 Sep 2008 15:33:34 +0100"/>
                            <attachment id="12389332" name="SOLR-538.patch" size="43981" author="larsko" created="Tue, 2 Sep 2008 09:17:07 +0100"/>
                            <attachment id="12388349" name="SOLR-538.patch" size="43981" author="larsko" created="Sat, 16 Aug 2008 04:06:51 +0100"/>
                            <attachment id="12387926" name="SOLR-538.patch" size="43594" author="larsko" created="Mon, 11 Aug 2008 05:24:40 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 14 Apr 2008 16:16:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7068</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxqq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20649</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>