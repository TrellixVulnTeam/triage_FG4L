<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:26:13 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-606/SOLR-606.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-606] spellcheck.colate doesn&apos;t handle multiple tokens properly</title>
                <link>https://issues.apache.org/jira/browse/SOLR-606</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;originally posted as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-572&quot; title=&quot;Spell Checker as a Search Component&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-572&quot;&gt;&lt;del&gt;SOLR-572&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-572?focusedCommentId=12608487#action_12608487&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-572?focusedCommentId=12608487#action_12608487&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;the new spellcheck.collate feature seems to exhibit some strange behaviors when handed a query with multiple tokens.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{
 &quot;responseHeader&quot;:{
  &quot;params&quot;:{
	&quot;q&quot;:&quot;redbull air show&quot;}},
  &quot;spellcheck&quot;:{
   &quot;suggestions&quot;:[
	&quot;redbull&quot;,[
	 &quot;suggestion&quot;,[&quot;redbelly&quot;]],
	&quot;show&quot;,[
	 &quot;suggestion&quot;,[&quot;shot&quot;]],
	&quot;collation&quot;,&quot;redbelly airshotw&quot;]}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;in this case, note the fields are incorrectly concatenated (no space between tokens, left over &apos;w&apos; from input string)&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{
 &quot;responseHeader&quot;:{
  &quot;params&quot;:{
	&quot;q&quot;:&quot;redbull air show&quot;,
	&quot;spellcheck.q&quot;:&quot;redbull air show&quot;}},
 &quot;spellcheck&quot;:{
  &quot;suggestions&quot;:[
	&quot;redbull air show&quot;,[
	 &quot;suggestion&quot;,[&quot;redbull singers&quot;]],
	&quot;collation&quot;,&quot;redbull singersredbull air show&quot;]}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;this is slightly different - the suggestions are still concatenated without a space, but the collation is way off.&lt;/p&gt;

&lt;p&gt;--Geoff&lt;/p&gt;</description>
                <environment>&lt;p&gt;tomcat&lt;/p&gt;</environment>
        <key id="12399108">SOLR-606</key>
            <summary>spellcheck.colate doesn&apos;t handle multiple tokens properly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gsingers">Grant Ingersoll</assignee>
                                    <reporter username="geoff">Geoffrey Young</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Jun 2008 19:22:20 +0100</created>
                <updated>Fri, 10 May 2013 11:39:57 +0100</updated>
                            <resolved>Thu, 14 Aug 2008 19:18:40 +0100</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.3</fixVersion>
                                    <component>spellchecker</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12608604" author="gsingers" created="Thu, 26 Jun 2008 23:13:26 +0100"  >&lt;p&gt;Can you try this patch and post the results?  It doesn&apos;t fix the problem, but I&apos;m having a hard time reproducing it and it adds some more output to the spellcheck.extendedResults=true option.&lt;/p&gt;

&lt;p&gt;Thus, you will need to add extendedResults to your flags.&lt;/p&gt;</comment>
                            <comment id="12608605" author="gsingers" created="Thu, 26 Jun 2008 23:14:55 +0100"  >&lt;p&gt;Also, can you post your spell check configuration?&lt;/p&gt;</comment>
                            <comment id="12608614" author="geoff" created="Thu, 26 Jun 2008 23:22:46 +0100"  >&lt;p&gt;I&apos;m not in charge of any of the environments, so it might take me some time to apply the patch.  hopefully I&apos;ll be able to report back tomorrow.&lt;/p&gt;

&lt;p&gt;if it matters, my spelling field is defined as so:&lt;/p&gt;

&lt;p&gt;    &amp;lt;fieldType name=&quot;spell&quot; class=&quot;solr.TextField&quot; positionIncrementGap=&quot;100&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;analyzer type=&quot;index&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;tokenizer class=&quot;solr.KeywordTokenizerFactory&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;filter class=&quot;solr.LowerCaseFilterFactory&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;/analyzer&amp;gt;&lt;br/&gt;
      &amp;lt;analyzer type=&quot;query&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;tokenizer class=&quot;solr.KeywordTokenizerFactory&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;filter class=&quot;solr.LowerCaseFilterFactory&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;/analyzer&amp;gt;&lt;br/&gt;
    &amp;lt;/fieldType&amp;gt;&lt;/p&gt;

&lt;p&gt;my spellcheck component configuration was straight from the docs, save changing the queryAnalyzerFieldType to match the above.&lt;/p&gt;</comment>
                            <comment id="12608758" author="gsingers" created="Fri, 27 Jun 2008 13:44:10 +0100"  >&lt;p&gt;Hmmm, I suspect the issue is in the type of tokens created.  Let me try that out.&lt;/p&gt;</comment>
                            <comment id="12608770" author="geoff" created="Fri, 27 Jun 2008 14:40:13 +0100"  >&lt;p&gt;results with your patch applied:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{
 &quot;responseHeader&quot;:{
  &quot;status&quot;:0,
  &quot;QTime&quot;:24283},
 &quot;command&quot;:&quot;build&quot;,
 &quot;response&quot;:{&quot;numFound&quot;:0,&quot;start&quot;:0,&quot;docs&quot;:[]
 },
 &quot;spellcheck&quot;:{
  &quot;suggestions&quot;:[
	&quot;queryConversion&quot;,[
	 &quot;token&quot;,[
	  &quot;text&quot;,&quot;redbull&quot;,
	  &quot;start&quot;,0,
	  &quot;end&quot;,7],
	 &quot;token&quot;,[
	  &quot;text&quot;,&quot;air&quot;,
	  &quot;start&quot;,8,
	  &quot;end&quot;,11],
	 &quot;token&quot;,[
	  &quot;text&quot;,&quot;show&quot;,
	  &quot;start&quot;,12,
	  &quot;end&quot;,16]],
	&quot;redbull&quot;,[
	 &quot;numFound&quot;,1,
	 &quot;startOffset&quot;,0,
	 &quot;endOffset&quot;,7,
	 &quot;origFreq&quot;,0,
	 &quot;suggestion&quot;,{
	  &quot;frequency&quot;:1,
	  &quot;word&quot;:&quot;redbelly&quot;}],
	&quot;show&quot;,[
	 &quot;numFound&quot;,1,
	 &quot;startOffset&quot;,12,
	 &quot;endOffset&quot;,16,
	 &quot;origFreq&quot;,0,
	 &quot;suggestion&quot;,{
	  &quot;frequency&quot;:1,
	  &quot;word&quot;:&quot;shot&quot;}],
	&quot;correctlySpelled&quot;,false,
	&quot;collation&quot;,&quot;redbelly airshotw&quot;]}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and with spellcheck.q defined it&apos;s&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{
 &quot;responseHeader&quot;:{
  &quot;status&quot;:0,
  &quot;QTime&quot;:20,
  &quot;params&quot;:{
	&quot;echoParams&quot;:&quot;all&quot;,
	&quot;indent&quot;:&quot;on&quot;,
	&quot;echoParams&quot;:&quot;all&quot;,
	&quot;indent&quot;:&quot;on&quot;,
	&quot;spellcheck.extendedResults&quot;:&quot;true&quot;,
	&quot;q&quot;:&quot;redbull air show&quot;,
	&quot;spellcheck.q&quot;:&quot;redbull air show&quot;,
	&quot;spellcheck.collate&quot;:&quot;true&quot;,
	&quot;spellcheck&quot;:&quot;true&quot;,
	&quot;wt&quot;:&quot;json&quot;}},
 &quot;response&quot;:{&quot;numFound&quot;:0,&quot;start&quot;:0,&quot;docs&quot;:[]
 },
 &quot;spellcheck&quot;:{
  &quot;suggestions&quot;:[
	&quot;queryConversion&quot;,[
	 &quot;token&quot;,[
	  &quot;text&quot;,&quot;redbull air show&quot;,
	  &quot;start&quot;,0,
	  &quot;end&quot;,0]],
	&quot;redbull air show&quot;,[
	 &quot;numFound&quot;,1,
	 &quot;startOffset&quot;,0,
	 &quot;endOffset&quot;,0,
	 &quot;origFreq&quot;,0,
	 &quot;suggestion&quot;,{
	  &quot;frequency&quot;:1,
	  &quot;word&quot;:&quot;redbull singers&quot;}],
	&quot;correctlySpelled&quot;,false,
	&quot;collation&quot;,&quot;redbull singersredbull air show&quot;]}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12609600" author="gsingers" created="Tue, 1 Jul 2008 15:05:56 +0100"  >&lt;p&gt;Hi Geoff,&lt;/p&gt;

&lt;p&gt;Can you comment on the use of the KeywordTokenizer for spelling?  I&apos;m not saying it&apos;s not a bug, but my guess is it is why I&apos;m not seeing the issue w/ my setup.  &lt;a href=&quot;http://wiki.apache.org/solr/SpellCheckerRequestHandler&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/solr/SpellCheckerRequestHandler&lt;/a&gt; has some recommendations on setup of the spell field that are still applicable.&lt;/p&gt;

&lt;p&gt;I&apos;ll try to figure something out for KeywordTokenizer at some point this week or next.&lt;/p&gt;</comment>
                            <comment id="12609607" author="geoff" created="Tue, 1 Jul 2008 15:33:54 +0100"  >&lt;p&gt;sure &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;the choice of keywords is intentional.  I don&apos;t want word suggestions but rather phrase suggestions.&lt;/p&gt;

&lt;p&gt;I&apos;m searching almost exclusively over proper names - band names (&quot;celine dion&quot;), event names (&quot;wicked: a new musical&quot;), venue names (&quot;staples center&quot;), etc.&lt;/p&gt;

&lt;p&gt;in my case, it does me zero good to suggest a phrase that doesn&apos;t exist, even if the word parts do exist independently in my data.&lt;/p&gt;

&lt;p&gt;for example...&lt;/p&gt;

&lt;p&gt;  o &quot;hannah montana&quot; is an &quot;artist&quot;&lt;br/&gt;
  o a user mis-types &quot;hanna montanna&quot;&lt;br/&gt;
  o spellchecker thinks &quot;hanna&quot;  is spelled correctly (based on the presence of &quot;Jake Hanna&quot; among other artists), and suggests &quot;montana&quot; (based on &quot;Montana Rangers&quot;, etc)&lt;br/&gt;
  o spellchecker gives me &quot;hanna montana&quot; as a suggestion... which then also misses since it doesn&apos;t exist (and the stemmer doesn&apos;t seem to catch the trailing &apos;h&apos;, but even if it did, there are other examples I can give)&lt;/p&gt;

&lt;p&gt;not surprisingly, using keywords instead of raw tokens for the dictionary gives me back only &quot;things&quot; that have exact matches, like &quot;hannah montana&quot;, or &quot;aerosmith&quot; for &quot;arrow smith&quot;, &quot;boston red sox&quot; for &quot;boston red socks&quot;, etc.&lt;/p&gt;

&lt;p&gt;I know I&apos;m not doing what most people are interested in, but it&apos;s very important for us to match phrases instead of raw words due to the crazy kinds of ways bands name themselves.&lt;/p&gt;

&lt;p&gt;fwiw,  I found this bug as I was playing around with the new component - for the reasons mentioned above I&apos;m not at all interested in the collation feature, so I don&apos;t consider this a priority for me.  others may stumble upon it, though, which is why I reported it.&lt;/p&gt;

&lt;p&gt;HTH, and thanks for working out the spelling component in general - it&apos;s most excellent.&lt;/p&gt;
</comment>
                            <comment id="12622508" author="dlx" created="Thu, 14 Aug 2008 11:38:41 +0100"  >&lt;p&gt;I recently ran into this exact issue and I found the problem.&lt;br/&gt;
The collation is created by replacing the misspelled tokens with the suggestions using a StringBuilder:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;for (Iterator&amp;lt;Map.Entry&amp;lt;Token, String&amp;gt;&amp;gt; bestIter = best.entrySet().iterator(); bestIter.hasNext();) {
        Map.Entry&amp;lt;Token, String&amp;gt; entry = bestIter.next();
        Token tok = entry.getKey();
        collation.replace(tok.startOffset(), tok.endOffset(), entry.getValue());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see it&apos;s just replacing the relevant tokens in the original query. However, if the length of a suggestion doesn&apos;t equal the length of the original token, all offsets used after that replacement are no longer valid thus randomly yielding incorrect results.&lt;br/&gt;
I fixed that by keeping track of that difference and adding it to the token offsets. For this to work I had to change the HashMap to a LinkedHashMap since this solution depends on the iteration order of the Tokens to correspond to their occurrence in the string.&lt;br/&gt;
I attached a patch reflecting those changes: handler.component.SpellCheckComponent-collate-patch.txt&lt;/p&gt;</comment>
                            <comment id="12622630" author="gsingers" created="Thu, 14 Aug 2008 19:18:40 +0100"  >&lt;p&gt;Committed  revision 685983.  Also added in a unit test that caused it to fail w/o the patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12384802" name="SOLR-606.patch" size="4012" author="gsingers" created="Thu, 26 Jun 2008 23:13:25 +0100"/>
                            <attachment id="12388218" name="handler.component.SpellCheckComponent-collate-patch.txt" size="1495" author="dlx" created="Thu, 14 Aug 2008 11:38:41 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 26 Jun 2008 22:13:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7003</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxqbb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20582</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>