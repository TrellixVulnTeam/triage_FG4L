<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:18:34 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-1270/SOLR-1270.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-1270] Legacy Numeric Field types need to be more consistent in their input/output error checking &amp; documentation</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1270</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>
&lt;p&gt;FloatField, IntField, ByteField, LongField. and DoubleField have inconsistent behavior at response writing time when dealing with &quot;garbage&quot; data in the index.  the behavior should be standardized, and better documented.&lt;/p&gt;

&lt;p&gt;&amp;#8211;&lt;/p&gt;

&lt;p&gt;This issue originally came from my php client issue tracker: &lt;a href=&quot;http://code.google.com/p/solr-php-client/issues/detail?id=13&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://code.google.com/p/solr-php-client/issues/detail?id=13&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;ubuntu 8.04, sun java 6, tomcat 5.5&lt;/p&gt;</environment>
        <key id="12429984">SOLR-1270</key>
            <summary>Legacy Numeric Field types need to be more consistent in their input/output error checking &amp; documentation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="djimenez">Donovan Jimenez</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jul 2009 22:35:25 +0100</created>
                <updated>Tue, 10 Nov 2009 15:52:10 +0000</updated>
                            <resolved>Tue, 4 Aug 2009 21:53:29 +0100</resolved>
                                    <version>1.2</version>
                    <version>1.3</version>
                    <version>1.4</version>
                                    <fixVersion>1.4</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12732220" author="hossman" created="Thu, 16 Jul 2009 23:50:59 +0100"  >
&lt;ul&gt;
	&lt;li&gt;FloatField is doing what it&apos;s suppose to (being fast and trusting the user input)&lt;/li&gt;
	&lt;li&gt;JSONWriter is doing what it&apos;s suppose to (being fast and trusting that the data in the fields is valid.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The only way (i know of) to get invalid JSON output from the JSONWriter from a numeric field is for the client to index invalid data.&lt;/p&gt;

&lt;p&gt;Garbage in, Garbage out.&lt;/p&gt;

&lt;p&gt;If there is a way to make JSONWriter error on a &lt;b&gt;legal&lt;/b&gt; float value, then there is a bug in JSONWriter and we should fix it.  but if the problem is users indexing bogus data, then either the users should clean up their data, or we should add a &quot;ParanoidFloatField&quot; that validates the input (at the expense of performance).&lt;/p&gt;

&lt;p&gt;If you have suggestions for documentation improvements to make users more aware of their responsibilities when using FloatField (and IntField, etc...) they would definitely be appreciated.&lt;/p&gt;
</comment>
                            <comment id="12732294" author="frozen-solid" created="Fri, 17 Jul 2009 02:28:44 +0100"  >&lt;p&gt;The data being indexed is valid.  It is a float value less than 1.  This means a &quot;0.0&quot; or a &quot;0.5&quot; or the like.  The JSONWriter is outputting &quot;.5&quot; and &quot;.0&quot; rather than with the leading zero.  This causes an invalid JSON encode because &quot;.5&quot; is not a valid float in JSON. You need the leading 0 before the decimal.&lt;/p&gt;

&lt;p&gt;You can verify this in the example code that Donovan wrote.&lt;/p&gt;</comment>
                            <comment id="12732330" author="djimenez" created="Fri, 17 Jul 2009 05:14:02 +0100"  >&lt;p&gt;Matt is refering to the code I posted in &lt;a href=&quot;http://code.google.com/p/solr-php-client/issues/detail?id=13#c8&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://code.google.com/p/solr-php-client/issues/detail?id=13#c8&lt;/a&gt; Where I indexed php values null, 0, &quot;0&quot;, and &quot;.0&quot; as FloatField.   &lt;/p&gt;

&lt;p&gt;I agree with Hoss here, the &quot;.0&quot; or null IS garbage according to the JSON numeric (json.org) and Java Floating Point Literal specifations (&lt;a href=&quot;http://java.sun.com/docs/books/jls/second_edition/html/lexical.doc.html#230798&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://java.sun.com/docs/books/jls/second_edition/html/lexical.doc.html#230798&lt;/a&gt;).   &lt;/p&gt;

&lt;p&gt;What I don&apos;t understand is why it wouldn&apos;t be beneficial for the FloatField type to use Float.parseFloat() for value checking at index time. My opinion is that the pro of directly letting the user know their input document does not match the expectations of their schema outweighs the con of  the time it takes to parse the value.  It doesn&apos;t remove the need for separate documentation, but getting the error at index time makes more sense then getting a JSON parsing error when querying. The cause and effect become less detached.&lt;/p&gt;</comment>
                            <comment id="12732344" author="frozen-solid" created="Fri, 17 Jul 2009 05:59:56 +0100"  >&lt;p&gt;Let me clarify a bit, because I don&apos;t think I came across how I meant to.  There are two issues at work here.&lt;/p&gt;

&lt;p&gt;1) The fact that the index lets you add invalid data to an index. Solr should either do it&apos;s best to parse the value as a float that it&apos;s expecting, or it should throw an error saying you gave it invalid data that doesn&apos;t match the field.  If speed is more important that verification, that&apos;s your decision and I can agree with that&lt;/p&gt;

&lt;p&gt;2) When I WAS passing in valid data to the index, I was passing in small float values such as 0.0 and 0.5. Basically, any value &amp;lt; 1.  Solr&apos;s JSONWriter wasn&apos;t returning these values as 0.0 or 0.5, which would be the proper return.  They were returning the value without the leading 0.  By not having the leading 0, php&apos;s JSON decode fails because the value it&apos;s receiving is &quot;.0&quot; or &quot;.5&quot;.  The period before hand it interprets as a string, rather than a decimal, but as long as there was a number before the decimal it was fine (1.5 came out as 1.5 and was interpreted as a float by JSON decode properly.&lt;/p&gt;

&lt;p&gt;These, in my opinion, are the same bug: JSON Writer is returning invalid JSON.  In issue 1, yes it&apos;s because of invalid data in the index.  If the index is bad I cannot expect the JSON to be valid.  In issue 2 the data in SOLR is valid and stored/returned properly as 0.5 with the leading 0, but in the JSON not having the leading 0 is breaking validation and keeping the user from being able to properly decode the JSON string.&lt;/p&gt;</comment>
                            <comment id="12732576" author="yseeley@gmail.com" created="Fri, 17 Jul 2009 16:29:06 +0100"  >&lt;p&gt;I agree we should strive to generate valid transfer syntax, and that is probably more important than maintaining the correct (float) type since that is at a higher level.&lt;/p&gt;

&lt;p&gt;The plain numeric types were really meant for back compatibility with existing Lucene indexes being read by Solr - so trying to normalize during indexing (in Solr) won&apos;t solve all of the problems.  Once the new numeric types in Solr (the Trie based ones) get full support, these plain types should &lt;b&gt;only&lt;/b&gt; be used for back compatibility with older indexes.&lt;/p&gt;

&lt;p&gt;What do people thing about the attached patch?  It tries to always return valid transfer syntax, and not to destroy information, at the cost of not always returning a float type.&lt;/p&gt;</comment>
                            <comment id="12732577" author="yseeley@gmail.com" created="Fri, 17 Jul 2009 16:30:25 +0100"  >&lt;p&gt;targeting to 1.4 since there is a simple proposed patch.  we can move back out if there is a lack of consensus.&lt;/p&gt;</comment>
                            <comment id="12732582" author="frozen-solid" created="Fri, 17 Jul 2009 16:53:15 +0100"  >&lt;p&gt;Personally I think that&apos;s a perfect compromise. As long as the JSON coming back is valid I&apos;m a happy camper and can deal with accidentally indexing invalid data.  The patch looks good to me, with my limited knowledge of Solr&apos;s source.&lt;/p&gt;</comment>
                            <comment id="12732850" author="shalinmangar" created="Sat, 18 Jul 2009 07:02:19 +0100"  >&lt;blockquote&gt;&lt;p&gt;What do people thing about the attached patch? It tries to always return valid transfer syntax, and not to destroy information, at the cost of not always returning a float type.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Patch looks good.&lt;/p&gt;</comment>
                            <comment id="12734263" author="hossman" created="Wed, 22 Jul 2009 20:19:55 +0100"  >&lt;blockquote&gt;&lt;p&gt;What do people thing about the attached patch?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+0&lt;/p&gt;

&lt;p&gt;This slows down query time response writing for the 95% case:  people who have indexed clean data and don&apos;t need it to be sanity checked.  it seems like it violates the whole point of FloatField: be fast and trust the data.&lt;/p&gt;

&lt;p&gt;But if yonik thinks it&apos;s worth the trade off - i won&apos;t argue. &lt;/p&gt;

&lt;p&gt;Personally: if we&apos;re going to make FloatField more paranoid, it seems like validation when input (indexing) would be saner then validating on output since input tends to happen less often then output, and users are typically more concerned about query speed then indexing speed.&lt;/p&gt;

&lt;p&gt;Although it looks like Yonik already made a similar change to IntField and LongField back in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-424&quot; title=&quot;The ruby output type produces incorrect output for numeric types without a value&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-424&quot;&gt;&lt;del&gt;SOLR-424&lt;/del&gt;&lt;/a&gt; (how did i miss seeing that before?) so i guess we should at least make all the basic types consistent. (which means we shouldn&apos;t forget DoubleField and ByteField)&lt;/p&gt;

&lt;p&gt;(In an ideal world, FloatField would have been named &quot;SimpleUncheckedFloatField&quot; and the javadocs would have made it clear that it was for backwards compatibility with existing lucene indexes, that it did no sanity checking of the input, and it&apos;s only distinction from StrField was to preserve metadata about the datatype (ie: float) for use by the response writers.  Then we could have reserved the name &quot;FloatField&quot; for a much more stringent FieldType that sanity checked the data coming in &lt;b&gt;and&lt;/b&gt; going out &amp;#8211; which is essentially what SortableFloatField is)&lt;/p&gt;</comment>
                            <comment id="12734267" author="frozen-solid" created="Wed, 22 Jul 2009 20:34:14 +0100"  >&lt;p&gt;Hoss:  You&apos;re misunderstanding something.  In the case that the float field is less than 1, for example: &quot;0.5&quot;, then the JSON encoder spits out &quot;.0&quot; without the quotes.  This is invalid JSON.  In THIS particular example, the value stored is valid, and the value returned is NOT valid JSON. In order to be valid JSON, a float value of less than 1 needs a preceding 0 before the decimal point or JSON thinks it should be a string and fails reading the value.&lt;/p&gt;

&lt;p&gt;Your argument for not making it more paranoid is fine, I have no problems with that, but when given valid data it should ALSO return valid data and in this case it is not.  &lt;/p&gt;</comment>
                            <comment id="12734335" author="hossman" created="Wed, 22 Jul 2009 22:32:04 +0100"  >&lt;blockquote&gt;&lt;p&gt;Hoss: You&apos;re misunderstanding something.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;i must be&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;for example: &quot;0.5&quot;, then the JSON encoder spits out &quot;.0&quot; without the quotes.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I do not see how that is even remotely possible.  I think there must be a typo there in your comment &amp;#8211; if not, please provide a unit test demonstrating what you are seeing.&lt;/p&gt;

&lt;p&gt;I&apos;m guessing that what you &lt;b&gt;ment&lt;/b&gt; to say, was &quot;if i index the value of &apos;0.5&apos; then JSON outputs &apos;.5&apos;&quot; ... which i&apos;m also not seeing when I attempt it myself (tested using the trunk, indexing docs using raw XML).&lt;/p&gt;

&lt;p&gt;If you are seeing this behavior (input: &apos;0.5&apos;; json output: &apos;.5&apos;) then I suggest there may be a bug in whatever mechanism you are using to create the index (DataImportHandler, CSVUpdateRequestHandler, some client library, acts_as_solr, etc...)  What does the value look like in the XML response? what does the LukeRequestHandler say your indexed values look like (because they should all be exactly the same) ... if your initial data has &apos;0.5&apos; in it but those three handlers all display &apos;.5&apos; then please let us know how you built your index because it sounds like that has a bug)&lt;/p&gt;

&lt;p&gt;The other possibility is that you might have ment to say &quot;if i index the value of &apos;.5&apos; then JSON outputs &apos;.5&apos;&quot; ... which is exactly my point before: garbage in, garbage out.&lt;/p&gt;

&lt;p&gt;&apos;.5&apos; is not the canonical representation of any float value &amp;#8211; there may be some parsers that are tolerant of it (Float.valueOf() in java for example) but that doesn&apos;t mean it&apos;s a legal float value.  parsers can make sense of &apos;0.00006&apos; as well, but that&apos;s not the proper string representation, &apos;6.0E-5&apos; is the correct way to represent that float value as a string.&lt;/p&gt;</comment>
                            <comment id="12734358" author="djimenez" created="Wed, 22 Jul 2009 23:18:41 +0100"  >&lt;p&gt;I&apos;m preferential to doing the check at add document time if one is going to be done at all because it fails early for the user. &lt;/p&gt;

&lt;p&gt;However, I have a counter proposal to changing the FloatField type.&lt;/p&gt;

&lt;p&gt;Since FloatField is meant primarily for legacy purposes, why don&apos;t we change the distributed example schema.xml to not use it for the &quot;float&quot; field type. If we&apos;re going for the 80/20 type mantra, then SortableFloatField is probably what most new users of Solr mean when they want to specify a &quot;float&quot; field.  &lt;/p&gt;

&lt;p&gt;Does that seem like a workable idea to try and remove the confusion around this issue?&lt;/p&gt;
</comment>
                            <comment id="12734375" author="frozen-solid" created="Thu, 23 Jul 2009 00:11:03 +0100"  >&lt;p&gt;I just tried to replicate the problem I was having on a super small, fresh, install of solr, and I can&apos;t duplicate the problem either.  Which means I have no idea what I was doing to cause that.  There&apos;s a chance that since the data that I saw this happening with was coming from a database that there was some sort of float-&amp;gt;string or string-&amp;gt;float screwup when it was coming out of the database into PHP.  I might try and replicate the problem at work and narrow down what was going on a bit further, but I&apos;ll just assume I&apos;ve been wrong about what was going on this whole time. My apologies to Hoss Man.&lt;/p&gt;

&lt;p&gt;Since it seems this is all just invalid in, invalid out and I was mistaken about what was going on, I do think clarification needs to happen somewhere.  As a newer user to Solr, I was confused by two things:&lt;/p&gt;

&lt;p&gt;1) The example schema.xml&apos;s wording is vague for these fields.  When FloatField says it stores/indexes the &quot;text value verbatim&quot; it isn&apos;t easily understood that this also means it does not have to be a valid float. I understood this as meaning it&apos;s still storing/indexing a valid float, and the only difference between it and a sortable version was that FloatField is sorted as text (1,10,11,2,23,3 rather than 1,2,3,10,11,23) and not numerically.  Instead, this should clarify that it is identical to StrField with the exception in how it is output assuming the data is a valid integer, and warn the user that no verification of the input is done. It also would help if this clarifies that it is meant for legacy support and that most users should be using SortableFloatField.&lt;/p&gt;

&lt;p&gt;2) My first index build was done with sfloat.  After the first build was finished, I opened the index in Luke to verify things were being stored and values were being displayed as I expected. When looking at the stored documents in Luke, it was unable to display the sfloat fields, which led me to believe that the sortable float field also wouldn&apos;t be readable when I went to display the output from Solr.  This is when I added a copy field so that I would have both a float and an sfloat thinking I had to search/sort on sfloat, but display the float.  This is when I began having problems.  The Sortable fields should clarify that Solr&apos;s internal form isn&apos;t readable and if lucene apps other than solr try and read those fields it will not be readable, but that Solr&apos;s output will be human readable.&lt;/p&gt;

&lt;p&gt;I would recommend reordering the fields in the example, so that the first field type a new user comes across is the sortable version.  Comment out the non-sortable versions and say they are for legacy support, and to uncomment if for some reason you need to use them. Also warn about sane inputs/outputs.&lt;/p&gt;</comment>
                            <comment id="12738650" author="gsingers" created="Mon, 3 Aug 2009 23:40:17 +0100"  >&lt;p&gt;What&apos;s the status on this?  Is there something to fix or not?&lt;/p&gt;</comment>
                            <comment id="12738655" author="yseeley@gmail.com" created="Mon, 3 Aug 2009 23:44:50 +0100"  >&lt;p&gt;I actually accidentally committed a fix for this along with another commit (but just for float field).&lt;br/&gt;
All of the plain numeric types should probably get the same treatment. &lt;/p&gt;</comment>
                            <comment id="12739116" author="hossman" created="Tue, 4 Aug 2009 20:44:59 +0100"  >&lt;p&gt;revised issue summarydescription to clarify full scope of issue, assigning to yonik&lt;/p&gt;</comment>
                            <comment id="12739118" author="hossman" created="Tue, 4 Aug 2009 20:54:07 +0100"  >&lt;p&gt;FYI: since 1.3 was released, the usages of FloatField (and it&apos;s ilk) in the example schema have already been largely removed.  So i think the big issue here is just making the behavior of the legacy classes consistent, and improving their javadocs.&lt;/p&gt;

&lt;p&gt;Donovan/Matt: FloatField (and it&apos;s ilk) is still listed in the example schema.xml on the trunk, it&apos;s just no longer used in any of the example fields &amp;#8211; so if you think there are improvements to be made to the comments associate with those field types, please give a specific example of how you think it should be documented.&lt;/p&gt;</comment>
                            <comment id="12739123" author="hossman" created="Tue, 4 Aug 2009 20:57:11 +0100"  >&lt;p&gt;sorry, one last comment i forgot to mention before...&lt;/p&gt;

&lt;p&gt;Yonik: i assigned to you to make the final call about how to make all the behavior consistent.  (i&apos;m guessing based on the inadvertent commit you made to FloatField that you prefer they all sanity check on output, but i didn&apos;t want to make any assumptions).  I&apos;m -0 on any sanity checking, but I do agree they should be consistent.&lt;/p&gt;</comment>
                            <comment id="12739152" author="djimenez" created="Tue, 4 Aug 2009 21:42:24 +0100"  >&lt;p&gt;Yonik has already started standardizing output time checking. So keep going there and we&apos;re good.&lt;/p&gt;

&lt;p&gt;The trunk example schema now uses Trie fields for the default numeric types with precisionStep of 0. This should be fine since this seems to be the preferred / suggested field type implementations. The main idea of our argument was that the default make sense for the new user - I believe that change accomplishes this.  So again, we&apos;re good.&lt;/p&gt;

&lt;p&gt;I also see new comments about which example field types are considered legacy -  good. The Trie field also mentions a little about how it generates tokens which can help when examining the index with tools like luke - a point of confusion that matt mentioned - so again, good.  The sortable numeric definitions might benefit from similar info in the comments. Probably the only thing I could offer as a suggestion.&lt;/p&gt;

&lt;p&gt;Personally, I think you could remove more of the unused configuration from the example, but that&apos;s subjective opinion - some people like adding to a minimum, others like to prune from a maximum. I think that solr as a community is of the &quot;let them prune&quot; persuasion.&lt;/p&gt;</comment>
                            <comment id="12739156" author="yseeley@gmail.com" created="Tue, 4 Aug 2009 21:53:29 +0100"  >&lt;p&gt;I&apos;ve committed the same changes for all plain numeric types.  Since these are special cases, the small performance impact is not outweighed by the need to produce valid transfer syntax.&lt;/p&gt;</comment>
                            <comment id="12775803" author="gsingers" created="Tue, 10 Nov 2009 15:52:10 +0000"  >&lt;p&gt;Bulk close for Solr 1.4&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12413826" name="SOLR-1270.patch" size="1195" author="yseeley@gmail.com" created="Fri, 17 Jul 2009 16:29:06 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 16 Jul 2009 22:50:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6378</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxm9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19927</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>