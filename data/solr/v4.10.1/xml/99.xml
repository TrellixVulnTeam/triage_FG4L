<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:16:30 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-99/SOLR-99.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-99] Allow default sort order</title>
                <link>https://issues.apache.org/jira/browse/SOLR-99</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The current search throws an &quot;ArrayIndexOutOfBoundsException&quot; if you specify a sort field but do not include an order.  This is anoying and difficult to debug (when you are starting)&lt;/p&gt;

&lt;p&gt;Here is a patch to avoid the exception and use the default sort order if you only specify a field.  I&apos;m not sure the &apos;null&apos; case was even possible in the current code:&lt;/p&gt;

&lt;p&gt;Index: QueryParsing.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; QueryParsing.java	(revision 494681)&lt;br/&gt;
+++ QueryParsing.java	(working copy)&lt;br/&gt;
@@ -186,13 +186,12 @@&lt;br/&gt;
       }&lt;/p&gt;

&lt;p&gt;       // get the direction of the sort&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;str=parts&lt;span class=&quot;error&quot;&gt;&amp;#91;pos&amp;#93;&lt;/span&gt;;&lt;/li&gt;
	&lt;li&gt;if (&quot;top&quot;.equals(str) || &quot;desc&quot;.equals(str)) 
{
-        top=true;
-      }
&lt;p&gt; else if (&quot;bottom&quot;.equals(str) || &quot;asc&quot;.equals(str)) &lt;/p&gt;
{
-        top=false;
-      }
&lt;p&gt;  else {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;return null;  // must not be a sort command&lt;br/&gt;
+      // by default, top is true, only change it if it is &quot;bottom&quot; or &quot;asc&quot;&lt;br/&gt;
+      if( parts.length &amp;gt; pos ) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+    	  str=parts[pos];+    	  if (&amp;quot;bottom&amp;quot;.equals(str) || &amp;quot;asc&amp;quot;.equals(str)) {
+	         top=false;
+	      }       }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12360146">SOLR-99</key>
            <summary>Allow default sort order</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ryantxu">Ryan McKinley</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Jan 2007 02:04:01 +0000</created>
                <updated>Fri, 10 May 2013 11:41:08 +0100</updated>
                            <resolved>Fri, 12 Jan 2007 22:51:26 +0000</resolved>
                                    <version>1.2</version>
                                    <fixVersion>1.2</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12463530" author="ryantxu" created="Wed, 10 Jan 2007 11:18:44 +0000"  >&lt;p&gt;I apologize... the first version does not pass ConvertedLegacyTest.testABunchOfConvertedStuff()!&lt;/p&gt;

&lt;p&gt;This second version rewrites most of parseSort() and passes the tests.&lt;/p&gt;

&lt;p&gt;I am a bit confused by the old parser because it seems to be handling a legacy paging system.  The javadocs show the sort formats as:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Examples:&lt;/li&gt;
	&lt;li&gt;&amp;lt;pre&amp;gt;&lt;/li&gt;
	&lt;li&gt;top 10                        #take the top 10 by score&lt;/li&gt;
	&lt;li&gt;desc 10                       #take the top 10 by score&lt;/li&gt;
	&lt;li&gt;score desc 10                 #take the top 10 by score&lt;/li&gt;
	&lt;li&gt;weight bottom 10              #sort by weight ascending and take the first 10&lt;/li&gt;
	&lt;li&gt;weight desc                   #sort by weight descending&lt;/li&gt;
	&lt;li&gt;height desc,weight desc       #sort by height descending, and use weight descending to break any ties&lt;/li&gt;
	&lt;li&gt;height desc,weight asc top 20 #sort by height descending, using weight ascending as a tiebreaker&lt;br/&gt;
    *&amp;lt;/pre&amp;gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This puts the &quot;count&quot; in the SortSpec.num field.&lt;/p&gt;

&lt;p&gt;SortSpec.getCount() is only called from:  SolrPluginUtils.doSimpleQuery().  Is this a mistake?  Isn&apos;t the count specified from rows=XXX?&lt;/p&gt;



</comment>
                            <comment id="12463695" author="hossman" created="Wed, 10 Jan 2007 20:17:10 +0000"  >&lt;p&gt;specifying the number of results to return as part of the sort information is in fact some fairly &quot;legacy&quot; behavior that we probably don&apos;t need to worry about supporting (i don&apos;t think anyone has ever used it in the history of Solar/Solr ... but in general i don&apos;t think the proper way to address this bug is to &quot;assume&quot; a default direction if all the user does is specify a field name ... mainly because i don&apos;t know that we can really assume a particular &quot;default&quot; ... failing with an error at query time definitely seems like the right behavior to me ... but we should certainly return a usefull eror message instead of an ArrayIndexOutOfBoundsException.&lt;/p&gt;

&lt;p&gt;In the same way a query which can&apos;t be parsed cleanly generates a ParseException, a sort specification which can&apos;t be parsed cleanly should generate a ParseException (or soemthing like it)&lt;/p&gt;</comment>
                            <comment id="12463702" author="yseeley@gmail.com" created="Wed, 10 Jan 2007 20:27:56 +0000"  >&lt;p&gt;The number was there because I originally thought about allowing a chain of sorts to narrow results, so you could do things like:&lt;/p&gt;

&lt;p&gt;give me TVs with a 50&quot; screen or bigger, then take the bottom 50% by weight, then take the bottom 50% by depth, then give me the top 10 by review rating.&lt;/p&gt;

&lt;p&gt;expressible by the following syntax:&lt;/p&gt;

&lt;p&gt;inches:&lt;span class=&quot;error&quot;&gt;&amp;#91;50 TO *&amp;#93;&lt;/span&gt;; weight bottom 50%; depth bottom 50%; rating top 10&lt;/p&gt;

&lt;p&gt;But I never really got around to implementing that &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Related bugs:  &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-9&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12463740" author="yseeley@gmail.com" created="Wed, 10 Jan 2007 22:43:35 +0000"  >&lt;p&gt;I agree that throwing a ParseException (ideally a SolrException with a code of 400) with a meaningful error message to help out the user is the right way to go.&lt;/p&gt;</comment>
                            <comment id="12463813" author="ryantxu" created="Thu, 11 Jan 2007 06:24:38 +0000"  >
&lt;p&gt;Ok, we all agree, that it should &lt;br/&gt;
1. Throw a reasonable error if something goes wrong&lt;br/&gt;
2. Throw an error if you sort on a non-indexed field (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9&quot; title=&quot;In would be handy if StandardRequestHandler returned an error when a query requested sorting on a non-indexed field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9&quot;&gt;&lt;del&gt;SOLR-9&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;I still think it should have a default sort order (SQL does) but as long as it does not throw an ArrayIndexOutOfBoundsException exception I am happy &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;What should happen with the &apos;legacy&apos; format?&lt;br/&gt;
a. leave it as is.  (perhaps add a comment for the next person who can&apos;t figure out what it does)&lt;br/&gt;
b. get rid of it. &lt;/p&gt;

</comment>
                            <comment id="12464013" author="hossman" created="Thu, 11 Jan 2007 21:00:38 +0000"  >&lt;p&gt;the problem with a default sort order (which ANSI SQL does wrong in my opinion) is that it can lead to &quot;buggy&quot; behavior without making it clear to the user what happened ... users can test their app, get results, and those results might look like they are in the correct order because of the nature of the data (ie: they sort by popularity and all documents currently have no popularity because their application isn&apos;t live yet) and only later do they discover that it&apos;s acctually &quot;defaulting&quot; and the default isn&apos;t what they want.&lt;/p&gt;

&lt;p&gt;as for the legacy format: if it&apos;s not hurting anything, i don&apos;t see any reason to remove it.  if it&apos;s easy to catch the ArrayIndexOutOfBoundsException and rethrow a better aexception without gutting the legacy parsing code, we might as well leave it in.&lt;/p&gt;

&lt;p&gt;if that parsing code is buggy and would require a lot of additional work to get it&apos;s parsing/error handling equally robust, then purning it is probably fine.&lt;/p&gt;</comment>
                            <comment id="12464052" author="ryantxu" created="Thu, 11 Jan 2007 23:46:05 +0000"  >&lt;p&gt;I just attached a new version.  It throws an exception when:&lt;br/&gt;
1) missing sort order&lt;br/&gt;
2) sort on unindexed field (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6&quot; title=&quot;Solr admin stylesheet doesn&amp;#39;t work well with Internet Explorer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6&quot;&gt;&lt;del&gt;SOLR-6&lt;/del&gt;&lt;/a&gt;)&lt;br/&gt;
3) sort on a field it can not find&lt;/p&gt;

&lt;p&gt;It does not assume a default sort order.&lt;/p&gt;

&lt;p&gt;I added some tests.  I did not see any general way to test stuff that should throw exceptions, so i added assertQEx() to AbstractSolrTestCase.&lt;/p&gt;

&lt;p&gt;I added the tests to ConvertedLegacyTest because that is where the other stuff testing sorting happens.&lt;/p&gt;
</comment>
                            <comment id="12464053" author="ryantxu" created="Thu, 11 Jan 2007 23:48:05 +0000"  >&lt;p&gt;oops, by &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6&quot; title=&quot;Solr admin stylesheet doesn&amp;#39;t work well with Internet Explorer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6&quot;&gt;&lt;del&gt;SOLR-6&lt;/del&gt;&lt;/a&gt;, i really mean &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9&quot; title=&quot;In would be handy if StandardRequestHandler returned an error when a query requested sorting on a non-indexed field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9&quot;&gt;&lt;del&gt;SOLR-9&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I appologize in advance for my dyslexia.  Thank goodness for compilers!&lt;/p&gt;</comment>
                            <comment id="12464378" author="yseeley@gmail.com" created="Fri, 12 Jan 2007 22:51:26 +0000"  >&lt;p&gt;Committed.  Thanks Ryan!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12348770" name="DefaultSortOrder.patch" size="7987" author="ryantxu" created="Thu, 11 Jan 2007 23:39:45 +0000"/>
                            <attachment id="12348633" name="DefaultSortOrder.patch" size="5251" author="ryantxu" created="Wed, 10 Jan 2007 11:10:01 +0000"/>
                            <attachment id="12348610" name="DefaultSortOrder.patch" size="767" author="ryantxu" created="Wed, 10 Jan 2007 02:04:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 10 Jan 2007 20:17:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7483</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxten:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21083</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>