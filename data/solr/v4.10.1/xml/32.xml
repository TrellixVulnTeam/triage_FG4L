<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:16:05 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-32/SOLR-32.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-32] Result of select request is not well-formed XML when text field contains non-ASCII chars and ampersand</title>
                <link>https://issues.apache.org/jira/browse/SOLR-32</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Starting with the supplied start.jar, the ampersand from this field is not correctly escaped in the XML search results provided by the select page:&lt;/p&gt;

&lt;p&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
&amp;lt;add&amp;gt;&lt;br/&gt;
  &amp;lt;doc&amp;gt;&lt;br/&gt;
    &amp;lt;field name=&quot;id&quot;&amp;gt;amp-test-one&amp;lt;/field&amp;gt;&lt;br/&gt;
    &amp;lt;field name=&quot;content&quot;&amp;gt;Les &#233;v&#233;nements chez Bonnie &amp;amp; Clyde.&amp;lt;/field&amp;gt;&lt;br/&gt;
  &amp;lt;/doc&amp;gt;&lt;br/&gt;
&amp;lt;/add&amp;gt;&lt;br/&gt;
&amp;lt;/stuff&amp;gt;&lt;/p&gt;

&lt;p&gt;The &quot;content&quot; field is defined as a &quot;text&quot; field in the schema.&lt;/p&gt;

&lt;p&gt;Adding this document to the index and querying on &quot;id:amp-test-one&quot; returns&lt;br/&gt;
...&lt;br/&gt;
 &amp;lt;doc&amp;gt;&lt;br/&gt;
  &amp;lt;str name=&quot;content&quot;&amp;gt;Les &#233;v&#233;nements chez Bonnie &amp;amp; Clyde.&amp;amp; Clyde.&amp;lt;/str&amp;gt;&lt;br/&gt;
  &amp;lt;str name=&quot;id&quot;&amp;gt;amp-test-one&amp;lt;/str&amp;gt;&lt;br/&gt;
 &amp;lt;/doc&amp;gt;&lt;/p&gt;

&lt;p&gt;With first &quot;Bonnie &amp;amp; Clyde&quot; unescaped and then the correct escaped &amp;amp;&lt;/p&gt;

&lt;p&gt;Browsing the index with Luke shows that the field is correctly stored.&lt;/p&gt;

&lt;p&gt;I think this might be a Jetty bug: patching the util/XML class of SOLR to avoid the use of Writer.write(String,start,len) fixes the problem. Maybe the Jetty ServletWriter gets confused by the presence of non-ascii chars?&lt;/p&gt;

&lt;p&gt;Here are my changes in util/XML.java. It looks like the class did use String.substring(...) before, Writer.write might be faster but it seems like it&apos;s broken in that environment.&lt;/p&gt;

&lt;p&gt;Here are my patches to util/XML.java:&lt;/p&gt;

&lt;p&gt;Index: src/java/org/apache/solr/util/XML.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; src/java/org/apache/solr/util/XML.java      (revision 422655)&lt;br/&gt;
+++ src/java/org/apache/solr/util/XML.java      (working copy)&lt;br/&gt;
@@ -159,8 +159,8 @@&lt;br/&gt;
       }&lt;br/&gt;
       if (subst != null) {&lt;br/&gt;
         if (start&amp;lt;i) &lt;/p&gt;
{
-          // out.write(str.substring(start,i));
-          out.write(str, start, i-start);
+          out.write(str.substring(start,i));
+          // out.write(str, start, i-start);
           // n+=i-start;
         }
&lt;p&gt;         out.write(subst);&lt;br/&gt;
@@ -172,8 +172,8 @@&lt;br/&gt;
       out.write(str);&lt;br/&gt;
       // n += str.length();&lt;br/&gt;
     } else if (start&amp;lt;str.length()) &lt;/p&gt;
{
-      // out.write(str.substring(start));
-      out.write(str, start, str.length()-start);
+      out.write(str.substring(start));
+      // out.write(str, start, str.length()-start);
       // n += str.length()-start;
     }
&lt;p&gt;     // return n;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Seen when running with the supplied Jetty container, macosx, JDK  1.5.0_06&lt;/p&gt;</environment>
        <key id="12346082">SOLR-32</key>
            <summary>Result of select request is not well-formed XML when text field contains non-ASCII chars and ampersand</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="bdelacretaz">Bertrand Delacretaz</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Jul 2006 10:06:30 +0100</created>
                <updated>Fri, 10 May 2013 11:39:35 +0100</updated>
                            <resolved>Mon, 17 Jul 2006 18:35:41 +0100</resolved>
                                                    <fixVersion>1.1.0</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12421673" author="yseeley@gmail.com" created="Mon, 17 Jul 2006 18:35:41 +0100"  >&lt;p&gt;Yes, we had been having problems all along with Jetty and it&apos;s UTF-8 writer.&lt;br/&gt;
I just committed this (correctness before performance...)&lt;br/&gt;
Thanks for tracking down the problem!&lt;/p&gt;</comment>
                            <comment id="12421674" author="klaasm" created="Mon, 17 Jul 2006 18:42:51 +0100"  >&lt;p&gt;Just wanted to confirm this problem in my application.  It is an odd interaction with unicode and Jetty&apos;s io stack--it seems to only occur when an offseted write() into a  String with unicode characters that was preceded by a non-unicode write (writing the whole string is fine, as is writing char arrays).&lt;/p&gt;

&lt;p&gt;The attached patch fixed the problem, though it was only necessary to convert the first write() to substring.&lt;/p&gt;</comment>
                            <comment id="12421677" author="yseeley@gmail.com" created="Mon, 17 Jul 2006 19:00:30 +0100"  >&lt;p&gt;Anyone know if this is still a problem in the latest Jetty6?  Someone might want to follow up with them on it.&lt;/p&gt;</comment>
                            <comment id="12589330" author="hossman" created="Wed, 16 Apr 2008 00:56:42 +0100"  >&lt;p&gt;This bug was modified as part of a bulk update using the criteria...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Marked (&quot;Resolved&quot; or &quot;Closed&quot;) and &quot;Fixed&quot;&lt;/li&gt;
	&lt;li&gt;Had no &quot;Fix Version&quot; versions&lt;/li&gt;
	&lt;li&gt;Was listed in the CHANGES.txt for 1.1&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The Fix Version for all 38 issues found was set to 1.1, email notification&lt;br/&gt;
was suppressed to prevent excessive email.&lt;/p&gt;

&lt;p&gt;For a list of all the issues modified, search jira comments for this&lt;br/&gt;
(hopefully) unique string: 20080415hossman3&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 17 Jul 2006 17:35:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7545</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxtt3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21148</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>