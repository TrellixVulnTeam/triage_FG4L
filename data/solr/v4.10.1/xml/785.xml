<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:21:56 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-785/SOLR-785.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-785] Distributed SpellCheckComponent</title>
                <link>https://issues.apache.org/jira/browse/SOLR-785</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Enhance the SpellCheckComponent to run in a distributed (sharded) environment.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12404902">SOLR-785</key>
            <summary>Distributed SpellCheckComponent</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalinmangar">Shalin Shekhar Mangar</assignee>
                                    <reporter username="shalinmangar">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Sep 2008 20:50:23 +0100</created>
                <updated>Wed, 30 Mar 2011 16:45:23 +0100</updated>
                            <resolved>Wed, 9 Dec 2009 13:23:49 +0000</resolved>
                                                    <fixVersion>1.5</fixVersion>
                    <fixVersion>3.1</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>spellchecker</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12710378" author="mwoytowitz" created="Mon, 18 May 2009 15:56:25 +0100"  >&lt;p&gt;This is a patch to enable spellchecking in the distributed setup.&lt;/p&gt;</comment>
                            <comment id="12712562" author="shalinmangar" created="Sun, 24 May 2009 16:28:44 +0100"  >&lt;p&gt;Matthew, thanks for the patch. Can you please include a unit test?&lt;/p&gt;

&lt;p&gt;Also, I&apos;m thinking that we could refactor the Lucene spell checker to fetch the suggestions without the edit distance and find out the top &apos;n&apos; suggestions after performing an edit distance on the aggregator. What do you think?&lt;/p&gt;</comment>
                            <comment id="12783623" author="shalinmangar" created="Mon, 30 Nov 2009 11:49:48 +0000"  >&lt;p&gt;I&apos;m writing a test for this patch.&lt;/p&gt;

&lt;p&gt;With only one shard (say localhost:57369/solr), I get correct results if I do not specify shards parameter. If I specify shards=localhost:57369/solr on the same Solr, I get a different result. Debugging now.&lt;/p&gt;</comment>
                            <comment id="12783748" author="shalinmangar" created="Mon, 30 Nov 2009 17:13:27 +0000"  >&lt;p&gt;Well, there is only finishStage in the patch which is of no use alone. SpellCheckComponent needs to either generate shard requests or piggyback on existing requests to merge the data in finishStage.&lt;/p&gt;

&lt;p&gt;This brings up interesting questions - How do we perform distributed search for SearchComponents which are not added by default to SearchHandler? Only if the chain has QueryComponent, can we modify its requests. Otherwise we must issue new ShardRequests. Is assuming that configuration of the search component chain is the same between all shards OK?&lt;/p&gt;</comment>
                            <comment id="12784104" author="shalinmangar" created="Tue, 1 Dec 2009 07:50:33 +0000"  >&lt;p&gt;As noted on solr-dev, I had misunderstood the behavior. The problem was that I had configured a separate handler for spellcheck and I needed to pass shards.qt to make it work with distributed search.&lt;/p&gt;

&lt;p&gt;So distributed spell check is working and I&apos;m trying to write tests making sure that the response returned by distributed spellcheck is the same as the one returned by non-distributed spellcheck for the various spellcheck parameters.&lt;/p&gt;

&lt;p&gt;In the current patch, distributed spellcheck always returns correctlySpelled=false which non-distributed mode does not. I&apos;ll have a patch ready soon with the test and fixes.&lt;/p&gt;</comment>
                            <comment id="12784158" author="shalinmangar" created="Tue, 1 Dec 2009 10:27:48 +0000"  >&lt;p&gt;There are a couple of problems with the current patch:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;It breaks ties using frequency info even if onlyMorePopular=false&lt;/li&gt;
	&lt;li&gt;If more than one suggestion are returned by a shard (extendedResults=false), it uses the first one and discards the rest&lt;/li&gt;
	&lt;li&gt;It duplicates a lot of response writing code&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Ideally, we&apos;d like to:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Share the same response writing code - Construct a SpellingResult using the shard responses and pass it to the existing toNamedList method so that there is no discrepancy between distributed and non-distributed mode&lt;/li&gt;
	&lt;li&gt;Break ties by the configured distance measure. If distance is same and onlyMorePopular=true, then break ties by frequency (same as how Lucene SpellChecker breaks ties)&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="12784488" author="shalinmangar" created="Tue, 1 Dec 2009 22:40:36 +0000"  >&lt;ol&gt;
	&lt;li&gt;Break ties exactly as Lucene SpellChecker&lt;/li&gt;
	&lt;li&gt;Merge frequency info of original tokens as well as suggestions&lt;/li&gt;
	&lt;li&gt;Create SpellingResult objects after merging data from shards and pass to #toNamedList to write response&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;This is a half baked patch and not fit to be committed. Problems include (but not limited to!) :&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The test case fails for extendedResults=false (something to do how original frequency is added to SpellingResult) as it returns correctlySpelled=false when it shouldn&apos;t.&lt;/li&gt;
	&lt;li&gt;Spellcheck Index corruption in stress tests - race conditions in SpellCheckComponent I guess&lt;/li&gt;
	&lt;li&gt;Not optimized at all - quick hack&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I&apos;m putting this out because I&apos;ll not be able to look at this for the next two days. If someone wants to take this out for a spin, please do.&lt;/p&gt;</comment>
                            <comment id="12785909" author="shalinmangar" created="Fri, 4 Dec 2009 12:45:07 +0000"  >&lt;ol&gt;
	&lt;li&gt;Fixes bugs with response format&lt;/li&gt;
	&lt;li&gt;Fixes another bug with wrong order of results&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;We need to take another look at how the rebuild happens. There seem to be some race conditions which show up when we do stress testing. For now, this patch disables stress tests. I&apos;ll investigate and open other issues for that.&lt;/p&gt;</comment>
                            <comment id="12786496" author="shalinmangar" created="Sat, 5 Dec 2009 20:51:45 +0000"  >&lt;blockquote&gt;
&lt;p&gt;We need to take another look at how the rebuild happens. There seem to be some race conditions which show up when we do stress testing. For now, this patch disables stress tests. I&apos;ll investigate and open other issues for that.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I just noticed the &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2108&quot; title=&quot;SpellChecker file descriptor leak - no way to close the IndexSearcher used by SpellChecker internally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-2108&quot;&gt;&lt;del&gt;LUCENE-2108&lt;/del&gt;&lt;/a&gt; commit. After upgrading the contrib spellcheck jar to lucene trunk, these issues are no longer reproducible. Those changes are not yet ported to the Lucene 2.9 branch but will soon be.&lt;/p&gt;

&lt;p&gt;Do we need to keep Lucene core and contrib versions in sync? It seems like we&apos;ll need to upgrade contrib-spellcheck. Is it necessary to upgrade both core and contrib to latest 2.9 branch or can we just go ahead and upgrade spellcheck (perhaps even to 3.0 since it is compatible).&lt;/p&gt;</comment>
                            <comment id="12786635" author="simonw" created="Sun, 6 Dec 2009 15:57:33 +0000"  >&lt;p&gt;FYI&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Those changes are not yet ported to the Lucene 2.9 branch but will soon be.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done!&lt;/p&gt;
</comment>
                            <comment id="12787078" author="shalinmangar" created="Mon, 7 Dec 2009 19:51:58 +0000"  >&lt;p&gt;Thanks Simon!&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Overrides modifyRequest to enable spellcheck only in GET_TOP_IDS (otherwise we do the spellcheck for each request)&lt;/li&gt;
	&lt;li&gt;Request for at least 5 suggestions from each shard for more accurate merged results&lt;/li&gt;
	&lt;li&gt;Re-enables stress testing (requires &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2108&quot; title=&quot;SpellChecker file descriptor leak - no way to close the IndexSearcher used by SpellChecker internally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-2108&quot;&gt;&lt;del&gt;LUCENE-2108&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;Use LinkedHashMap for &quot;origVsSuggested&quot; map to preserve order of tokens because collation algorithm only works in-order.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;All tests pass.&lt;/p&gt;

&lt;p&gt;This can definitely be optimized further. The four maps can be removed if we can collect by iterating over the tokens in original query (we may need one to cache SpellCheckResponse). However, I have bigger itches to scratch so I&apos;ll leave this here.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit this after a day or two in case somebody wants to review the patch (or improve it).&lt;/p&gt;</comment>
                            <comment id="12787087" author="shalinmangar" created="Mon, 7 Dec 2009 20:17:18 +0000"  >&lt;p&gt;Updating for &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1608&quot; title=&quot;Make it easy to write distributed search test cases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1608&quot;&gt;&lt;del&gt;SOLR-1608&lt;/del&gt;&lt;/a&gt; commit.&lt;/p&gt;</comment>
                            <comment id="12788082" author="shalinmangar" created="Wed, 9 Dec 2009 13:23:49 +0000"  >&lt;p&gt;Committed revision 888796.&lt;/p&gt;

&lt;p&gt;Thanks Matthew!&lt;/p&gt;</comment>
                            <comment id="12872828" author="hossman" created="Fri, 28 May 2010 04:32:52 +0100"  >
&lt;p&gt;Correcting Fix Version based on CHANGES.txt, see this thread for more details...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/lucene-dev/201005.mbox/%3Calpine.DEB.1.10.1005251052040.24672@radix.cryptio.net%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/lucene-dev/201005.mbox/%3Calpine.DEB.1.10.1005251052040.24672@radix.cryptio.net%3E&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13013043" author="gsingers" created="Wed, 30 Mar 2011 16:45:23 +0100"  >&lt;p&gt;Bulk close for 3.1.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12442374">LUCENE-2108</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12441904">SOLR-1608</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12472291">SOLR-2083</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12391793">SOLR-507</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12427223" name="SOLR-785.patch" size="13344" author="shalinmangar" created="Mon, 7 Dec 2009 20:17:18 +0000"/>
                            <attachment id="12427220" name="SOLR-785.patch" size="46593" author="shalinmangar" created="Mon, 7 Dec 2009 19:51:58 +0000"/>
                            <attachment id="12426899" name="SOLR-785.patch" size="45544" author="shalinmangar" created="Fri, 4 Dec 2009 12:45:06 +0000"/>
                            <attachment id="12426591" name="SOLR-785.patch" size="44928" author="shalinmangar" created="Tue, 1 Dec 2009 22:40:36 +0000"/>
                            <attachment id="12408384" name="spelling-shard.patch" size="5618" author="mwoytowitz" created="Mon, 18 May 2009 15:56:25 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 18 May 2009 14:56:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6837</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxp7z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20405</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>