<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:16:44 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-745/SOLR-745.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-745] CoreAdminHandler in bad state after UNLOADing core</title>
                <link>https://issues.apache.org/jira/browse/SOLR-745</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;using 1.3-rc1...&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Start up the multicore example...
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cd example
java -Dsolr.solr.home=multicore -jar start.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Hit the status URL repeatedly: &lt;a href=&quot;http://localhost:8983/solr/admin/cores?action=STATUS&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://localhost:8983/solr/admin/cores?action=STATUS&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Note: no problems in the log&lt;/li&gt;
	&lt;li&gt;unload core0: &lt;a href=&quot;http://localhost:8983/solr/admin/cores?action=UNLOAD&amp;amp;core=core0&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://localhost:8983/solr/admin/cores?action=UNLOAD&amp;amp;core=core0&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;shift-reload on the status URL: &lt;a href=&quot;http://localhost:8983/solr/admin/cores?action=STATUS&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://localhost:8983/solr/admin/cores?action=STATUS&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Note the following exception each time...
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SEVERE: java.util.concurrent.RejectedExecutionException
        at java.util.concurrent.ThreadPoolExecutor$AbortPolicy.rejectedExecution(ThreadPoolExecutor.java:1477)
        at java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:384)
        at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:856)
        at java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:45)
        at java.util.concurrent.Executors$DelegatedExecutorService.submit(Executors.java:606)
        at org.apache.solr.core.SolrCore.getSearcher(SolrCore.java:1062)
        at org.apache.solr.core.SolrCore.getSearcher(SolrCore.java:821)
        at org.apache.solr.request.SolrQueryRequestBase.getSearcher(SolrQueryRequestBase.java:208)
        at org.apache.solr.servlet.cache.HttpCacheHeaderUtil.calcLastModified(HttpCacheHeaderUtil.java:146)
        at org.apache.solr.servlet.cache.HttpCacheHeaderUtil.doCacheHeaderValidation(HttpCacheHeaderUtil.java:220)
        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:224)
        at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1089)
        at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:365)
        at org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)
        at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181)
        at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:712)
        at org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:405)
        at org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:211)
        at org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java:114)
        at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:139)
        at org.mortbay.jetty.Server.handle(Server.java:285)
        at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:502)
        at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:821)
        at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:513)
        at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:208)
        at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:378)
        at org.mortbay.jetty.bio.SocketConnector$Connection.run(SocketConnector.java:226)
        at org.mortbay.thread.BoundedThreadPool$PoolThread.run(BoundedThreadPool.java:442)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Note that the exception doesn&apos;t just happen the first time you reload the status URL, but everytime.&lt;/li&gt;
&lt;/ol&gt;



&lt;p&gt;Marking &quot;Fix in 1.3&quot; until someone smarter then me about CoreAdminHandler says it&apos;s no big deal.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12403461">SOLR-745</key>
            <summary>CoreAdminHandler in bad state after UNLOADing core</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="hossman">Hoss Man</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Sep 2008 02:25:51 +0100</created>
                <updated>Fri, 10 May 2013 11:39:15 +0100</updated>
                            <resolved>Tue, 2 Sep 2008 16:15:48 +0100</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12627364" author="hossman" created="Mon, 1 Sep 2008 02:27:10 +0100"  >&lt;p&gt;On the surface, part of the problem is that CoreAdminHandler should probably be calling SolrQueryResponse.setHttpCaching(false) ... but since it isn&apos;t, HttpCacheHeaderUtil is attempting to get a searcher to determine some headers &amp;#8211; this should be done relative the &quot;adminCore&quot; picked by CoreContainer (at least as far as i can and something seems to get wonky about coreAdmin when a core is UNLOADed.&lt;/p&gt;

&lt;p&gt;In this specific example, it&apos;s just affecting the cache headers, but this seems like it could be simptomatic of a larger more generic problem relating to the &quot;adminCore&quot; ... and i&apos;m not sure how bad that is.&lt;/p&gt;</comment>
                            <comment id="12627419" author="henrib" created="Mon, 1 Sep 2008 10:08:40 +0100"  >&lt;p&gt;Part of it might be in &apos;CoreContainer.getAdminHandler()&apos; which should check that the (previous) admin core is not closed before attempting to (re)use it.&lt;br/&gt;
Adding a check for isClosed() seems necessary.&lt;br/&gt;
Something like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; SolrCore getAdminCore() {
    &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (cores) {
      SolrCore core = adminCore != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? adminCore.get() : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (core != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !core.isClosed()) {
        core.open();
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12627502" author="henrib" created="Mon, 1 Sep 2008 17:34:50 +0100"  >&lt;p&gt;The uploaded patch fixes it (Linux/Ubuntu 8.04/Java 1.6)&lt;/p&gt;</comment>
                            <comment id="12627577" author="hossman" created="Tue, 2 Sep 2008 06:07:51 +0100"  >&lt;p&gt;Maybe i&apos;m missing something but haven&apos;t i seen some docs saying that SolrCores are now ref counted?  &lt;/p&gt;

&lt;p&gt;if CoreContainer is setting the adminCore properly, then shouldn&apos;t it be impossible for anyone else to completely close it?&lt;/p&gt;


</comment>
                            <comment id="12627610" author="henrib" created="Tue, 2 Sep 2008 10:03:31 +0100"  >&lt;p&gt;You are correct, refcounting on cores was introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-647&quot; title=&quot;Do SolrCore.close() in a refcounted way&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-647&quot;&gt;&lt;del&gt;SOLR-647&lt;/del&gt;&lt;/a&gt;. Before this, it was possible to close a core whilst it was serving requests.&lt;/p&gt;

&lt;p&gt;The admin core is &quot;any&quot; core that is used so admin requests can be served (request handling assumes a core exists); it is kept around  through a weak reference to avoid looking for a new one each time an admin request is handled and is only maintained &quot;opened&quot; during execution of the request (like any other request wrt refcounting for that matter; incref - aka open - when we acquire the core, execute the query, decref - aka close - as release). &lt;/p&gt;

&lt;p&gt;The side effect is that the reference can point to a core that is closed but not yet GC-ed thus the bug &amp;amp; the fix.&lt;/p&gt;

&lt;p&gt;As a side note, the java.util.concurrent.RejectedExecutionException is the typical symptom when trying to execute a query on a closed core.&lt;/p&gt;</comment>
                            <comment id="12627708" author="yseeley@gmail.com" created="Tue, 2 Sep 2008 16:15:48 +0100"  >&lt;p&gt;Thanks, I just committed the patch.&lt;/p&gt;

&lt;p&gt;It seems like the admin core thing is a weakness of the current design... a core must remain open at all times in order to serve more core requests - definitely not ideal.  I&apos;m not sure I see an easy fix right now though.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12389305" name="solr-745.patch" size="792" author="henrib" created="Mon, 1 Sep 2008 17:34:50 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 1 Sep 2008 09:08:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6873</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxph3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20446</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>