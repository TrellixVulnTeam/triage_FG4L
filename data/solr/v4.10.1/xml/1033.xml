<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:22:28 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-1033/SOLR-1033.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-1033] DIH transformers should be able to access current entity&apos;s namespace</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1033</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;It can be very useful to reuse the output from a DIH template in other templates and or regex transformers. Currently this cannot be done. The resolver is initialized at the start of the transformer run with what ever values exist for a column name at that instant. As the transformer executes it may define new values for column names. My change is intended to update the hash used by the resolver after each successful transformation.&lt;/p&gt;

&lt;p&gt;This only applies to the template and regex transformers.&lt;/p&gt;</description>
                <environment>&lt;p&gt;All operating systems and software platforms&lt;/p&gt;</environment>
        <key id="12415281">SOLR-1033</key>
            <summary>DIH transformers should be able to access current entity&apos;s namespace</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalinmangar">Shalin Shekhar Mangar</assignee>
                                    <reporter username="fergus">Fergus McMenemie</reporter>
                        <labels>
                    </labels>
                <created>Sat, 21 Feb 2009 13:31:32 +0000</created>
                <updated>Tue, 10 Nov 2009 15:51:58 +0000</updated>
                            <resolved>Wed, 25 Feb 2009 05:28:05 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.4</fixVersion>
                                    <component>contrib - DataImportHandler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="12675560" author="fergus" created="Sat, 21 Feb 2009 13:43:20 +0000"  >&lt;p&gt;A patch to address the issue.&lt;/p&gt;

&lt;p&gt;Yet again, I cannot get one of unit tests to work. I am hoping that folk better than me can point out where I am going wrong!&lt;/p&gt;</comment>
                            <comment id="12675564" author="noble.paul" created="Sat, 21 Feb 2009 15:06:30 +0000"  >&lt;p&gt;the output of one transformer can be consumed from other. &lt;br/&gt;
example&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;entity transformer=&lt;span class=&quot;code-quote&quot;&gt;&quot;TemplateTransformer,RegexTransformer&quot;&lt;/span&gt;&amp;gt;
  &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt; template=&lt;span class=&quot;code-quote&quot;&gt;&quot;hello&quot;&lt;/span&gt;/&amp;gt;
  &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;(.*)&quot;&lt;/span&gt; sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;/entity&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;in this case , the output of TemplateTransformer goes to &apos;a&apos; . The RegexTransformer can read from column &apos;a&apos; and it can be put into column &apos;b&apos; . It is still possible to have another transformer which reads from &apos;b&apos; and puts the value into &apos;c&apos;&lt;/p&gt;

&lt;p&gt;Is this the usecase? or am I missing something?&lt;/p&gt;</comment>
                            <comment id="12675580" author="fergus" created="Sat, 21 Feb 2009 17:06:06 +0000"  >&lt;p&gt;Sorry. I was not as clear as I could have been. No the use case is more&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt; transformer=&lt;span class=&quot;code-quote&quot;&gt;&quot;TemplateTransformer,RegexTransformer&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt; template=&lt;span class=&quot;code-quote&quot;&gt;&quot;hello&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt; template=&lt;span class=&quot;code-quote&quot;&gt;&quot;hello world&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;${e.a}(.*)&quot;&lt;/span&gt; sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;/entity&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12675720" author="fergus" created="Sun, 22 Feb 2009 22:11:29 +0000"  >&lt;p&gt;Following on from Noble&apos;s comments I realised that the test case for regex was not testing or highlighting the use case at all. This patch contains a new working regexp junit test case.&lt;/p&gt;</comment>
                            <comment id="12675753" author="noble.paul" created="Mon, 23 Feb 2009 03:52:32 +0000"  >&lt;p&gt;Fergus, the changes required for TemplateTransformer was clear and your fix is right. &lt;br/&gt;
 Can you give the usecase for RegexTranformer also?&lt;/p&gt;</comment>
                            <comment id="12675801" author="fergus" created="Mon, 23 Feb 2009 07:55:06 +0000"  >&lt;p&gt;Noble,&lt;/p&gt;

&lt;p&gt;Sure. However I need a little help. What is it I need to do?&lt;/p&gt;

&lt;p&gt;  1) reference the examples I posted to solr-user in JIRA?&lt;/p&gt;

&lt;p&gt;  2) simplify/clarify what was posted to solr-user?&lt;/p&gt;

&lt;p&gt;  3) include a snippet in JIRA?&lt;/p&gt;

&lt;p&gt;  4) add example explicitly showing reuse of regex output in another regex?&lt;/p&gt;

&lt;p&gt;  5) or details of the problem I am trying to solve right now?&lt;/p&gt;

&lt;p&gt;I had thought the general case included below was sufficient!&lt;/p&gt;

&lt;p&gt;Regards Fergus.&lt;/p&gt;


&lt;p&gt;&amp;#8211; &lt;/p&gt;

&lt;p&gt;===============================================================&lt;br/&gt;
Fergus McMenemie               Email:fergus@twig.me.uk&lt;br/&gt;
Techmore Ltd                   Phone:(UK) 07721 376021&lt;/p&gt;

&lt;p&gt;Unix/Mac/Intranets             Analyst Programmer&lt;br/&gt;
===============================================================&lt;/p&gt;</comment>
                            <comment id="12675808" author="noble.paul" created="Mon, 23 Feb 2009 08:04:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;Sure. However I need a little help. What is it I need to do?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;A simple usecase with an example which demonstrates the feature .&lt;/p&gt;

&lt;p&gt;The TemplateTransformer example you provided was self explanatory. If you can give a similar one that is more than sufficient.&lt;/p&gt;</comment>
                            <comment id="12675856" author="fergus" created="Mon, 23 Feb 2009 11:32:37 +0000"  >&lt;p&gt;OK here goes. My document contains references to embeded imagery. For each image there is the image itself along with a thumbnail and caption. The source document contains:-&lt;/p&gt;

&lt;p&gt;  &amp;lt;mediaObject vurl=&quot;1043130&quot; imageType=&quot;graphic&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;I have a search application that searches only the captions associated with a given image. It would be nice to populate solr fields with the correct relative path to each image and thumbnails at index time. Problem arises in that although the thumbnail is:&lt;/p&gt;

&lt;p&gt;   s$&lt;/p&gt;
{e.vurl}.jpg&lt;br/&gt;
&lt;br/&gt;
The name of the image itself varies depending on the first letter of the image type imageType! It could be one of &apos;picture&apos; &apos;graphic&apos; &apos;lineDrawing&apos; or &apos;map&apos;. ie:-&lt;br/&gt;
&lt;br/&gt;
   p${e.vurl}
&lt;p&gt;.jpg&lt;br/&gt;
   g$&lt;/p&gt;
{e.vurl}.jpg&lt;br/&gt;
   l${e.vurl}
&lt;p&gt;.jpg&lt;br/&gt;
   m$&lt;/p&gt;
{e.vurl}
&lt;p&gt;.jpg&lt;/p&gt;

&lt;p&gt;My patch would allow the following sort of thing to be added to a data-config. I feel this considerably increases its power and usefulness.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;x&quot;&lt;/span&gt; .... transformer=&lt;span class=&quot;code-quote&quot;&gt;&quot;TemplateTransformer,RegexTransformer&quot;&lt;/span&gt;&amp;gt;
  &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileWebPath&quot;&lt;/span&gt;            template=&lt;span class=&quot;code-quote&quot;&gt;&quot;${jc.fileAbsolutePath}&quot;&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;${dataimporter.request.contentdir}(.*)&quot;&lt;/span&gt; replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;/ford$1&quot;&lt;/span&gt; /&amp;gt;
  &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;vurl&quot;&lt;/span&gt;                          xpath=&lt;span class=&quot;code-quote&quot;&gt;&quot;/record/mediaBlock/mediaObject/@vurl&quot;&lt;/span&gt; /&amp;gt;
  &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;imagetype&quot;&lt;/span&gt;               xpath=&lt;span class=&quot;code-quote&quot;&gt;&quot;/record/mediaBlock/mediaObject/@imageType&quot;&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;^(\w).*&quot;&lt;/span&gt;/&amp;gt;
  &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;imgWebPathICON&quot;&lt;/span&gt;  regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;(.*)/.*&quot;&lt;/span&gt; replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;$1/imagery/s${x.vurl}.jpg&quot;&lt;/span&gt; sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileWebPath&quot;&lt;/span&gt;/&amp;gt;
  &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;imgWebPathFULL&quot;&lt;/span&gt;  regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;(.*)/.*&quot;&lt;/span&gt; replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;$1/imagery/${x.imagetype}${x.vurl}.jpg&quot;&lt;/span&gt;  sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileWebPath&quot;&lt;/span&gt;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12675860" author="noble.paul" created="Mon, 23 Feb 2009 11:57:50 +0000"  >&lt;p&gt;If I am not wrong the output of one transformation in Regextransformer is available in the next transformation , becaus ethe value is added to the same row object . So it should be working if the TemplateTransformer is fixed&lt;/p&gt;</comment>
                            <comment id="12675902" author="fergus" created="Mon, 23 Feb 2009 14:01:47 +0000"  >&lt;p&gt;Not sure I am following what you say. If I number the different steps in my example entity as follows:-&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;x&quot;&lt;/span&gt; .... transformer=&lt;span class=&quot;code-quote&quot;&gt;&quot;TemplateTransformer,RegexTransformer&quot;&lt;/span&gt;&amp;gt;
1  &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileWebPath&quot;&lt;/span&gt;     template=&lt;span class=&quot;code-quote&quot;&gt;&quot;${jc.fileAbsolutePath}&quot;&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;${dataimporter.request.contentdir}(.*)&quot;&lt;/span&gt; replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;/ford$1&quot;&lt;/span&gt; /&amp;gt;
2  &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;vurl&quot;&lt;/span&gt;            xpath=&lt;span class=&quot;code-quote&quot;&gt;&quot;/record/mediaBlock/mediaObject/@vurl&quot;&lt;/span&gt; /&amp;gt;
3  &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;imagetype&quot;&lt;/span&gt;       xpath=&lt;span class=&quot;code-quote&quot;&gt;&quot;/record/mediaBlock/mediaObject/@imageType&quot;&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;^(\w).*&quot;&lt;/span&gt;/&amp;gt;
4  &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;imgWebPathICON&quot;&lt;/span&gt;  regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;(.*)/.*&quot;&lt;/span&gt; replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;$1/imagery/s${x.vurl}.jpg&quot;&lt;/span&gt; sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileWebPath&quot;&lt;/span&gt;/&amp;gt;
5  &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;imgWebPathFULL&quot;&lt;/span&gt;  regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;(.*)/.*&quot;&lt;/span&gt; replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;$1/imagery/${x.imagetype}${x.vurl}.jpg&quot;&lt;/span&gt;  sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileWebPath&quot;&lt;/span&gt;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We see that column 5 involves a regex which in turn involves columns 3 and 2. Column 3 is itself a regex. We therefore have the output from one regex being used within another regex. So as far as I can see we need the fix made to both the TemplateTransformer and the RegexTransformer. &lt;/p&gt;</comment>
                            <comment id="12675953" author="noble.paul" created="Mon, 23 Feb 2009 15:50:38 +0000"  >&lt;p&gt;OK , I see your point. you are constructing the regex replacements themselves with templates. I missed that&lt;/p&gt;

&lt;p&gt;I am wondering , if the system can be modified to have the current entities rows be available always to all transformers. It can be done as a simple change in the EntityprocessorBase#applyTransformers&lt;/p&gt;</comment>
                            <comment id="12675961" author="noble.paul" created="Mon, 23 Feb 2009 16:08:59 +0000"  >&lt;p&gt;This should help all other transformers implicitly support templating&lt;/p&gt;</comment>
                            <comment id="12675969" author="fergus" created="Mon, 23 Feb 2009 16:44:26 +0000"  >&lt;p&gt;Your comment about modifying the system &quot;to have the current entities rows be available always to all transformers&quot; is good and will produce the fastest most efficient code. &lt;/p&gt;

&lt;p&gt;But I need to sure we are not using the term &quot;template&quot; twice in different ways. You say &quot;you are constructing the regex replacements themselves with templates&quot; by which you mean using the $&lt;/p&gt;
{XXX}
&lt;p&gt; syntax and not the output from a templatetransformer?&lt;/p&gt;

&lt;p&gt;Anyway I have backed out my patch and applied yours. Everything seems fine, but I am still testing.&lt;/p&gt;

&lt;p&gt;Thanks very much.&lt;/p&gt;</comment>
                            <comment id="12676165" author="noble.paul" created="Tue, 24 Feb 2009 03:34:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;You say &quot;you are constructing the regex replacements themselves with templates&quot; by which you mean using the ${XXX} syntax and not the output from a templatetransformer?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;when I said &apos;template&apos; I mean any string with $&lt;/p&gt;
{xxx}
&lt;p&gt; content. the &apos;template&apos; attribute is the only value Templatetransformer is interested in.&lt;/p&gt;

&lt;p&gt;Any attribute value in DIH is potentially a template .Some are honoured and some are not. I hope we can consistently make it work across all.&lt;/p&gt;
</comment>
                            <comment id="12676177" author="noble.paul" created="Tue, 24 Feb 2009 04:16:56 +0000"  >&lt;p&gt;the complete patch. XPathEntityprocessor needed some rework&lt;/p&gt;</comment>
                            <comment id="12676222" author="fergus" created="Tue, 24 Feb 2009 09:10:10 +0000"  >&lt;p&gt;Hmmm, some  thoughts and an enhanced patch for your consideration.&lt;/p&gt;

&lt;p&gt;Surely the test cases should still be revised to test the new functionality.&lt;/p&gt;

&lt;p&gt;Also as the XPathEntityProcessor has been revised, I felt this might be the best time to sort some formating typo&apos;s within the error messages.&lt;/p&gt;</comment>
                            <comment id="12676498" author="noble.paul" created="Wed, 25 Feb 2009 04:17:16 +0000"  >&lt;p&gt;Fergus, &lt;br/&gt;
Looks good. Thanks&lt;/p&gt;</comment>
                            <comment id="12676509" author="shalinmangar" created="Wed, 25 Feb 2009 05:26:47 +0000"  >&lt;p&gt;Updating issue title per the final resolution.&lt;/p&gt;

&lt;p&gt;Patch looks good, I&apos;ll commit shortly.&lt;/p&gt;</comment>
                            <comment id="12676511" author="shalinmangar" created="Wed, 25 Feb 2009 05:28:05 +0000"  >&lt;p&gt;Committed revision 747664.&lt;/p&gt;

&lt;p&gt;Thanks Fergus and Noble!&lt;/p&gt;</comment>
                            <comment id="12775668" author="gsingers" created="Tue, 10 Nov 2009 15:51:58 +0000"  >&lt;p&gt;Bulk close for Solr 1.4&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12400845" name="SOLR-1033.patch" size="16456" author="fergus" created="Tue, 24 Feb 2009 09:10:09 +0000"/>
                            <attachment id="12400828" name="SOLR-1033.patch" size="8909" author="noble.paul" created="Tue, 24 Feb 2009 04:16:55 +0000"/>
                            <attachment id="12400766" name="SOLR-1033.patch" size="3660" author="noble.paul" created="Mon, 23 Feb 2009 16:08:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 21 Feb 2009 15:06:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6600</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxnov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20157</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>