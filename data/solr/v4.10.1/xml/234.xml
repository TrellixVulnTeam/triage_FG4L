<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:16:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-234/SOLR-234.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-234] TrimFilter should update the start and end offsets</title>
                <link>https://issues.apache.org/jira/browse/SOLR-234</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;As implemented, the TrimFilter only trims the text.  It does not update the the startOffset and endOffset&lt;/p&gt;

&lt;p&gt;see:&lt;br/&gt;
&lt;a href=&quot;http://www.nabble.com/TrimFilter----t.startOffset%28%29%2C-t.endOffset%28%29-tf3728875.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/TrimFilter----t.startOffset%28%29%2C-t.endOffset%28%29-tf3728875.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12369132">SOLR-234</key>
            <summary>TrimFilter should update the start and end offsets</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ryantxu">Ryan McKinley</assignee>
                                    <reporter username="ryantxu">Ryan McKinley</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 May 2007 20:14:56 +0100</created>
                <updated>Fri, 10 May 2013 11:41:04 +0100</updated>
                            <resolved>Wed, 30 May 2007 01:33:50 +0100</resolved>
                                                    <fixVersion>1.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12495141" author="ryantxu" created="Fri, 11 May 2007 20:31:40 +0100"  >&lt;p&gt;This patch moves the start and end offests by how many spaces where eaten on either site.&lt;/p&gt;

&lt;p&gt;This patch also extracts many of the generally useful token testing bits from TestSynonymFilter (and a few others) into a BaseTokenTestCase, and uses this base class rather then duplicating the helper functions.&lt;/p&gt;
</comment>
                            <comment id="12495146" author="ryantxu" created="Fri, 11 May 2007 21:07:02 +0100"  >&lt;p&gt;Chris points out:&lt;/p&gt;

&lt;p&gt;&quot;in Lucene Token offset information is suppose to reflect exactly where in&lt;br/&gt;
the orriginal stream of date the source of the token was found ... if hte&lt;br/&gt;
token is modified in some way (ie: stemmed, trimmed, etc..)  the offsets&lt;br/&gt;
are suppose to remain the same becuase regardless of the token text&lt;br/&gt;
munging, the orriginal location hsa not actually changed.&quot;&lt;/p&gt;


&lt;p&gt;I&apos;ll move the test refactoring to another issue as that is still useful&lt;/p&gt;</comment>
                            <comment id="12495147" author="yseeley@gmail.com" created="Fri, 11 May 2007 21:13:17 +0100"  >&lt;p&gt;Updating the offsets does seem like the right thing to do.&lt;/p&gt;

&lt;p&gt;I imagine using toCharArray() will be slower than using charAt() given that it will allocate a new array, and the number of charAt() calls will be low in the average case because there will only be a small amount of whitespace.&lt;/p&gt;

&lt;p&gt;Isn&apos;t it annoying that Java never seems to let you do things as efficiently as the class lib itself...&lt;/p&gt;

&lt;p&gt;Another issue here is that the position increment isn&apos;t maintained.&lt;br/&gt;
And let another future issue is that any payloads aren&apos;t maintained (that&apos;s in a newer version of Lucene).&lt;br/&gt;
I&apos;ll bring up the latter issue on the lucene list since I think it&apos;s a bit of a design flaw.&lt;/p&gt;</comment>
                            <comment id="12495153" author="ryantxu" created="Fri, 11 May 2007 21:31:06 +0100"  >&lt;p&gt;&amp;gt; &lt;br/&gt;
&amp;gt; Updating the offsets does seem like the right thing to do.&lt;br/&gt;
&amp;gt; &lt;/p&gt;

&lt;p&gt;My real use case is adding the the trim filter to the pattern tokenizer.  the &apos;correct&apos; answer in my case it to update the offsets.&lt;/p&gt;

&lt;p&gt;The case i can imagine leading to something like &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-42&quot; title=&quot;Highlighting problems with HTMLStripWhitespaceTokenizerFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-42&quot;&gt;&lt;del&gt;SOLR-42&lt;/del&gt;&lt;/a&gt; is if a token is replaced with something that has leading or trailing spaces.  &lt;/p&gt;

&lt;p&gt;Perhaps we could add a parameter to the factory:&lt;/p&gt;

&lt;p&gt; &amp;lt;filter class=&quot;solr.TrimFilterFactory&quot; updateOffests=&quot;true&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;To limit &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-42&quot; title=&quot;Highlighting problems with HTMLStripWhitespaceTokenizerFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-42&quot;&gt;&lt;del&gt;SOLR-42&lt;/del&gt;&lt;/a&gt; style errors, the default could be false.&lt;/p&gt;


&lt;p&gt;&amp;gt; &lt;br/&gt;
&amp;gt; Isn&apos;t it annoying that Java never seems to let you do things as efficiently as the class lib itself...&lt;br/&gt;
&amp;gt; &lt;/p&gt;

&lt;p&gt;&lt;b&gt;especially&lt;/b&gt; for strings!&lt;/p&gt;</comment>
                            <comment id="12495158" author="ryantxu" created="Fri, 11 May 2007 21:43:44 +0100"  >&lt;p&gt;updated to take a n &quot;updateOffsets&quot; argument.&lt;/p&gt;

&lt;p&gt;this uses charAt() rather then toCharArray()&lt;/p&gt;

&lt;p&gt;What should happen with the position increment?&lt;/p&gt;


&lt;p&gt;      if( start &amp;gt; 0 || end &amp;lt; txt.length() ) &lt;/p&gt;
{
        int incr = t.getPositionIncrement();
        t = new Token( t.termText().substring( start, end ),
             t.startOffset()+start,
             t.endOffset()-endOff,
             t.type() );
        
        t.setPositionIncrement( incr ); //+ start ); TODO? what should happen with the offset
      }</comment>
                            <comment id="12495161" author="yseeley@gmail.com" created="Fri, 11 May 2007 21:56:18 +0100"  >&lt;p&gt;&amp;gt; What should happen with the position increment? &lt;br/&gt;
It should remain the same as the original.&lt;/p&gt;

&lt;p&gt;&amp;gt; The case i can imagine leading to something like &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-42&quot; title=&quot;Highlighting problems with HTMLStripWhitespaceTokenizerFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-42&quot;&gt;&lt;del&gt;SOLR-42&lt;/del&gt;&lt;/a&gt; is if a token is replaced with something&lt;br/&gt;
&amp;gt; that has leading or trailing spaces. &lt;/p&gt;

&lt;p&gt;Really whacky, but possible I guess.  I don&apos;t know of any token filters that would do that, unless someone explicitly used a synonym with spaces at the end.  It doesn&apos;t make any sense.&lt;br/&gt;
I&apos;d think that updating the offsets is almost always the right thing to do (and should be the default?), given that spaces will almost always come from the field value itself.&lt;/p&gt;

&lt;p&gt;-Yonik&lt;/p&gt;</comment>
                            <comment id="12495202" author="hossman" created="Sat, 12 May 2007 00:20:52 +0100"  >&lt;p&gt;&amp;gt; I&apos;d think that updating the offsets is almost always the right thing to do (and should be the default?), given that spaces will &lt;br/&gt;
&amp;gt; almost always come from the field value itself.&lt;/p&gt;

&lt;p&gt;i don&apos;t follow your reasoning ... the offsets are suppose to denote where in the original text the Token came from ... a Filter can&apos;t make any assumptions about source of the tokens except the token itself, so i don&apos;t&apos; see why a Filter would by default assume it can muck with the offsets.&lt;/p&gt;

&lt;p&gt;In Ryan&apos;s use case he may want his highlighter-esque code to be able to know how many characters were trimmed off of each end &amp;#8211; and i buy that it makes sense for TrimFilter to have an option to relay that info by modifying the offset &amp;#8211; but joe random user should be able to expect that by default the offsets of the Tokens his tokenizer produces won&apos;t be modified ... i would personally think it&apos;s a bug to get the behavior ryan describes out of a highlighter if i knew that my tokenizer was only spliting on punctuation.&lt;/p&gt;</comment>
                            <comment id="12495209" author="ryantxu" created="Sat, 12 May 2007 01:12:49 +0100"  >
&lt;p&gt;&amp;gt; &lt;br/&gt;
&amp;gt; .. a Filter can&apos;t make any assumptions about source of the tokens except the token itself ...&lt;/p&gt;

&lt;p&gt;I get the basic pattern now:  Tokenizers determin the start/end offsets and Filters just transform the text along the way.  &lt;/p&gt;


&lt;p&gt;&amp;gt; In Ryan&apos;s use case he may want his highlighter-esque code to be able to know ...&lt;br/&gt;
&amp;gt; &lt;/p&gt;

&lt;p&gt;I am fine with either:&lt;/p&gt;

&lt;p&gt;1. leave the TrimFilter as is and do the highlighter-esque code on the highlighting side.  &lt;/p&gt;

&lt;p&gt;2. Add an optional updateOffsets=&quot;true&quot; param, with the default set to &quot;false&quot;&lt;/p&gt;</comment>
                            <comment id="12495213" author="yseeley@gmail.com" created="Sat, 12 May 2007 01:54:45 +0100"  >&lt;p&gt;offsets point back to the original field value for a particular token... and to me, it&apos;s a semantic contract (point to what makes sense in the source). It&apos;s not limited to the offsets generated by the Tokenizer... Analyzers don&apos;t have to use Tokenizers and TokenFilters at all.&lt;/p&gt;

&lt;p&gt;As an example, WordDelimiterFilter modifies offsets when it splits words, and that makese sense to me.&lt;/p&gt;

&lt;p&gt;Another way to think about it is that there is more than one way to solve a problem (construct an analyzer).&lt;br/&gt;
What matters is the tokens that come out the end... not if I did&lt;br/&gt;
a) a tokenizer that split on something followed by a filter that trimmed&lt;br/&gt;
vs&lt;br/&gt;
b) a tokenizer that managed to split on something including discarding the whitespace&lt;/p&gt;

&lt;p&gt;For this specific case, I think it comes down to the likely usecases for the filter, and an argument could be made either way.  I&apos;m fine with either as this is a very minor issue.&lt;/p&gt;</comment>
                            <comment id="12495224" author="hossman" created="Sat, 12 May 2007 04:48:43 +0100"  >&lt;p&gt;yeah ... i&apos;m not saying there aren&apos;t good usecases both ways &amp;#8211; it definitely makes sense to have an option &amp;#8211; i&apos;m just saying that as a general rule TokenFilters shouldn&apos;t be munging offsets ... i don&apos;t see a big difference between TrimFilter and StemmingFilter (where the the stem of &quot;foo   &quot; and &quot;foo      &quot; is &quot;foo&quot;).  so the option should default to off.&lt;/p&gt;</comment>
                            <comment id="12495233" author="ryantxu" created="Sat, 12 May 2007 07:40:11 +0100"  >&lt;p&gt;Unless there are objections, I&apos;d like to add &quot;updateOffsets&quot; as an option to the TrimFilter.&lt;/p&gt;

&lt;p&gt;By default it will &lt;b&gt;not&lt;/b&gt; modify the offsets.&lt;/p&gt;

&lt;p&gt;Depending on how the Tokenizer+Analyzer stream is configured it may or may not make sense, so the option seems reasonable.&lt;/p&gt;</comment>
                            <comment id="12589290" author="hossman" created="Wed, 16 Apr 2008 00:44:42 +0100"  >&lt;p&gt;This bug was modified as part of a bulk update using the criteria...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Marked (&quot;Resolved&quot; or &quot;Closed&quot;) and &quot;Fixed&quot;&lt;/li&gt;
	&lt;li&gt;Had no &quot;Fix Version&quot; versions&lt;/li&gt;
	&lt;li&gt;Was listed in the CHANGES.txt for 1.2&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The Fix Version for all 39 issues found was set to 1.2, email notification&lt;br/&gt;
was suppressed to prevent excessive email.&lt;/p&gt;

&lt;p&gt;For a list of all the issues modified, search jira comments for this&lt;br/&gt;
(hopefully) unique string: 20080415hossman2&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12357135" name="SOLR-234-TrimFilterOffsets.patch" size="18255" author="ryantxu" created="Fri, 11 May 2007 21:43:44 +0100"/>
                            <attachment id="12357130" name="SOLR-234-TrimFilterOffsets.patch" size="16176" author="ryantxu" created="Fri, 11 May 2007 20:31:40 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 11 May 2007 20:13:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7355</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxsl3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20950</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>