<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:26:27 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-49/SOLR-49.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-49] PATCH: XSLTServletFilter</title>
                <link>https://issues.apache.org/jira/browse/SOLR-49</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Patch that implements server-side XSLT transforms of query results.&lt;/p&gt;

&lt;p&gt;The filter is activated by using select/html instead of select/ to run queries, and optionally adding a transform parameter to specify the XSLT transform to use, for example:&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;http://localhost:8983/solr/select/html?q=usage&amp;amp;transform=my.xsl&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://localhost:8983/solr/select/html?q=usage&amp;amp;transform=my.xsl&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In which case my.xsl should be found in solr/conf/xslt/ with the example configuration. The default transform (solr/conf/xslt/query-to-html.xsl) outputs a simplistic HTML format.&lt;/p&gt;

&lt;p&gt;Performance is suboptimal, as the filter reparses the XML output generated by Solr. Modifying the XMLWriter to output to a ContentHandler would be more efficient, but I didn&apos;t have time to go that far.&lt;/p&gt;

&lt;p&gt;The TransformerProvider trivially caches the last Transformer used, could be improved using an LRU cache of several transformers, I haven&apos;t checked if Solr&apos;s infrastructure contains such an animal already.&lt;/p&gt;

&lt;p&gt;The patch is all new files, except for adding this in web.xml before the first &amp;lt;servlet&amp;gt;:&lt;/p&gt;

&lt;p&gt;  &amp;lt;filter&amp;gt;&lt;br/&gt;
    &amp;lt;filter-name&amp;gt;xslt&amp;lt;/filter-name&amp;gt;&lt;br/&gt;
    &amp;lt;filter-class&amp;gt;org.apache.solr.xslt.XSLTServletFilter&amp;lt;/filter-class&amp;gt;&lt;br/&gt;
  &amp;lt;/filter&amp;gt;&lt;/p&gt;

&lt;p&gt;  &amp;lt;!-- apply the XSLT filter when select/html is used to make queries --&amp;gt;  &lt;br/&gt;
  &amp;lt;filter-mapping&amp;gt;&lt;br/&gt;
    &amp;lt;filter-name&amp;gt;xslt&amp;lt;/filter-name&amp;gt;&lt;br/&gt;
    &amp;lt;url-pattern&amp;gt;/select/html/*&amp;lt;/url-pattern&amp;gt;&lt;br/&gt;
  &amp;lt;/filter-mapping&amp;gt; &lt;/p&gt;

&lt;p&gt;I&apos;ve left the client-side XSLT stuff (stylesheet parameter) as is for the moment.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Tested on macosx 10.4.7, JDK 1.5.0_06&lt;/p&gt;</environment>
        <key id="12349941">SOLR-49</key>
            <summary>PATCH: XSLTServletFilter</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Hoss Man</assignee>
                                    <reporter username="bdelacretaz">Bertrand Delacretaz</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Sep 2006 16:52:16 +0100</created>
                <updated>Fri, 10 May 2013 11:39:02 +0100</updated>
                            <resolved>Wed, 18 Oct 2006 18:55:20 +0100</resolved>
                                                    <fixVersion>1.1.0</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12434717" author="bdelacretaz" created="Thu, 14 Sep 2006 16:52:58 +0100"  >&lt;p&gt;New files&lt;/p&gt;</comment>
                            <comment id="12435553" author="yseeley@gmail.com" created="Mon, 18 Sep 2006 20:06:01 +0100"  >&lt;p&gt;Thanks Bertrand, I&apos;ve not used servlet filters before.&lt;/p&gt;

&lt;p&gt;What do people think the tradeoffs are of using a different url &quot;/select/html&quot; vs a different response writer &quot;wt=html&amp;amp;wt.xslt=...&quot;&lt;br/&gt;
?&lt;/p&gt;

&lt;p&gt;Anyone else have opinions on if this should be committed?&lt;/p&gt;</comment>
                            <comment id="12436135" author="bdelacretaz" created="Wed, 20 Sep 2006 08:10:09 +0100"  >&lt;p&gt;In retrospect I think a different response writer is more consistent with the way other output formats are generated, shouldn&apos;t be hard to implement that way.&lt;/p&gt;

&lt;p&gt;The content-type should also be selectable by a request parameter, with text/html as the default I guess.&lt;/p&gt;</comment>
                            <comment id="12436201" author="bdelacretaz" created="Wed, 20 Sep 2006 11:05:48 +0100"  >&lt;p&gt;Here&apos;s a new patch, I&apos;ve reworked the code into an XSLTResponseWriter.&lt;/p&gt;

&lt;p&gt;Must be configured like this in solrconfig.xml:&lt;/p&gt;

&lt;p&gt;  &amp;lt;queryResponseWriter name=&quot;xslt&quot; class=&quot;org.apache.solr.request.XSLTResponseWriter&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;And the following request parameters activate it:&lt;/p&gt;

&lt;p&gt;  wt = xslt&lt;br/&gt;
  tr = my-xslt-transform.xsl&lt;br/&gt;
  ct = text/html (which is the default value)&lt;/p&gt;

&lt;p&gt;(don&apos;t you love terse param names &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The XSLT transform is read using SolrConfig.config.openResource(...), so it must be available in the solr/conf directory when running the Solr example config.&lt;/p&gt;</comment>
                            <comment id="12437055" author="bdelacretaz" created="Sat, 23 Sep 2006 09:50:52 +0100"  >&lt;p&gt;Here&apos;s yet another version which takes the Content-Type from the XSLT transform.&lt;/p&gt;

&lt;p&gt;The code and these instructions replace the previous versions:&lt;/p&gt;

&lt;p&gt;Must be configured like this in solrconfig.xml:&lt;/p&gt;

&lt;p&gt;  &amp;lt;!-- &lt;br/&gt;
    XSLT response writer (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-49&quot; title=&quot;PATCH: XSLTServletFilter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-49&quot;&gt;&lt;del&gt;SOLR-49&lt;/del&gt;&lt;/a&gt;)&lt;br/&gt;
    Changes to XSLT transforms are taken into account every xsltCacheLifetimeSeconds at most.&lt;br/&gt;
   --&amp;gt;&lt;br/&gt;
  &amp;lt;queryResponseWriter &lt;br/&gt;
    name=&quot;xslt&quot; &lt;br/&gt;
    class=&quot;org.apache.solr.request.XSLTResponseWriter&quot;&lt;br/&gt;
    xsltCacheLifetimeSeconds=&quot;5&quot;&lt;br/&gt;
  /&amp;gt;&lt;/p&gt;

&lt;p&gt;The following request parameters activate the XSLTResponseWriter:&lt;/p&gt;

&lt;p&gt;  wt = xslt&lt;br/&gt;
  tr = my-xslt-transform.xsl&lt;/p&gt;

&lt;p&gt;The Content-Type comes from the xsl:output element of the XSLT transform:&lt;/p&gt;

&lt;p&gt;    &amp;lt;xsl:output media-type=&quot;text/html&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;And finally, the TransformerProvider warns about the possible performance implications of its simplistic cache, when first used:&lt;/p&gt;

&lt;p&gt;  ATTENTION: The TransformerProvider&apos;s simplistic XSLT caching mechanism is &lt;br/&gt;
  not appropriate for high load scenarios, unless a single XSLT transform is used &lt;br/&gt;
  and xsltCacheLifetimeSeconds is set to a sufficiently high value.&lt;/p&gt;</comment>
                            <comment id="12442528" author="bdelacretaz" created="Mon, 16 Oct 2006 10:59:32 +0100"  >&lt;p&gt;Here&apos;s the latest incarnation, using a more Solrish way of initializing the response writer. &lt;/p&gt;

&lt;p&gt;The solr-XSLTResponseWriter-20061016.tar.gz attachment replaces all the previous patches.&lt;/p&gt;

&lt;p&gt;I have added an init(NamedList args) method to the QueryResponseWriter (solr-49.patch in the attached file), which means that the solrconfig.xml part has changed:&lt;/p&gt;

&lt;p&gt;&amp;lt;!--&lt;br/&gt;
    XSLT response writer (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-49&quot; title=&quot;PATCH: XSLTServletFilter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-49&quot;&gt;&lt;del&gt;SOLR-49&lt;/del&gt;&lt;/a&gt;)&lt;br/&gt;
    Changes to XSLT transforms are taken into account every  xsltCacheLifetimeSeconds at most.&lt;br/&gt;
   --&amp;gt;&lt;br/&gt;
  &amp;lt;queryResponseWriter&lt;br/&gt;
    name=&quot;xslt&quot;&lt;br/&gt;
    class=&quot;org.apache.solr.request.XSLTResponseWriter&quot;&lt;br/&gt;
   &amp;gt;&lt;br/&gt;
     &amp;lt;int name=&quot;xsltCacheLifetimeSeconds&quot;&amp;gt;5&amp;lt;/int&amp;gt;&lt;br/&gt;
   &amp;lt;/queryResponseWriter&amp;gt; &lt;/p&gt;

&lt;p&gt;Apart from that, the patch works as indicated in my previous comment.&lt;/p&gt;</comment>
                            <comment id="12442978" author="hossman" created="Tue, 17 Oct 2006 18:01:27 +0100"  >&lt;p&gt;I&apos;m going to try and review this again today.&lt;/p&gt;</comment>
                            <comment id="12443083" author="hossman" created="Tue, 17 Oct 2006 22:34:22 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-49&quot; title=&quot;PATCH: XSLTServletFilter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-49&quot;&gt;&lt;del&gt;SOLR-49&lt;/del&gt;&lt;/a&gt;.diff is solr-XSLTResponseWriter-20061016.tar.gz in svn patch form with a few small tweaks...&lt;/p&gt;

&lt;p&gt;1) I removed the javadocs on the init() method in each of the concrete QueryResponseWriter classes so they would inherit the interface docs.&lt;br/&gt;
2) I added a small unit test to demonstrate that the stylesheet was being applied&lt;/p&gt;

&lt;p&gt;I think this is commitable as is, but one small thing occured to me that i wanted to get concensus on first: right now this can be used to expose any file in the $&lt;/p&gt;
{solr.home}/conf by trying to use it as an XSLT ... should it respect the &lt;br/&gt;
&amp;lt;gettableFiles&amp;gt; directive in the solrconfig.xml &amp;#8211; which might be anoying since it requires explicitly listing each file, or should we change this to only look at files in some new ${solr.home}
&lt;p&gt;/xslt (or $&lt;/p&gt;
{solr.home}
&lt;p&gt;/conf/xslt) directory?&lt;/p&gt;

&lt;p&gt;another minor nit: query-to-html.xsl seems like it would render the &quot;query&quot; as html, not the results of the query ... maybe we should just call it &quot;example.xsl&quot; ?&lt;/p&gt;</comment>
                            <comment id="12443085" author="yseeley@gmail.com" created="Tue, 17 Oct 2006 22:42:07 +0100"  >&lt;p&gt;&amp;gt; right now this can be used to expose any file in the $&lt;/p&gt;
{solr.home}
&lt;p&gt;/conf by trying to use it as an XSLT&lt;/p&gt;

&lt;p&gt;It&apos;s good that you noted it, but I think it&apos;s fine for now:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;conf doesn&apos;t contain personal data like logs could...&lt;/li&gt;
	&lt;li&gt;Solr is a backend system with all the doors left wide open... IMO, locking a window isn&apos;t currently worth the effort, esp if it makes it harder to use.&lt;/li&gt;
&lt;/ul&gt;


</comment>
                            <comment id="12443196" author="bdelacretaz" created="Wed, 18 Oct 2006 08:31:57 +0100"  >&lt;p&gt;I&apos;m with Yonik on the security thing, Solr is wide open as is anyway. &lt;/p&gt;

&lt;p&gt;OTOH, forcing the XSLT files to be under conf/xslt would avoid cluttering the conf directory, I think it&apos;s a good idea.&lt;/p&gt;

&lt;p&gt;&amp;gt; query-to-html.xsl seems like it would render the &quot;query&quot; as html...&lt;/p&gt;

&lt;p&gt;You mean that the filename gives this impression, right? No problem with a rename, example.xsl is fine, or maybe xslt-writer-example.xsl.&lt;/p&gt;</comment>
                            <comment id="12443316" author="hossman" created="Wed, 18 Oct 2006 18:55:20 +0100"  >&lt;p&gt;Commited with both the subdirectory change and the rename to &quot;example.xsl&quot;&lt;/p&gt;

&lt;p&gt;Thanks again Bertrand.&lt;/p&gt;</comment>
                            <comment id="12443761" author="bdelacretaz" created="Fri, 20 Oct 2006 10:22:58 +0100"  >&lt;p&gt;Thanks for committing, I have documented this at &lt;a href=&quot;http://wiki.apache.org/solr/XsltResponseWriter&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/solr/XsltResponseWriter&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12589344" author="hossman" created="Wed, 16 Apr 2008 00:56:43 +0100"  >&lt;p&gt;This bug was modified as part of a bulk update using the criteria...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Marked (&quot;Resolved&quot; or &quot;Closed&quot;) and &quot;Fixed&quot;&lt;/li&gt;
	&lt;li&gt;Had no &quot;Fix Version&quot; versions&lt;/li&gt;
	&lt;li&gt;Was listed in the CHANGES.txt for 1.1&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The Fix Version for all 38 issues found was set to 1.1, email notification&lt;br/&gt;
was suppressed to prevent excessive email.&lt;/p&gt;

&lt;p&gt;For a list of all the issues modified, search jira comments for this&lt;br/&gt;
(hopefully) unique string: 20080415hossman3&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12343110" name="SOLR-49.diff" size="21853" author="hossman" created="Tue, 17 Oct 2006 22:34:22 +0100"/>
                            <attachment id="12341455" name="solr-XSLTResponseWriter-20060922.tar.gz" size="3713" author="bdelacretaz" created="Sat, 23 Sep 2006 09:50:52 +0100"/>
                            <attachment id="12342985" name="solr-XSLTResponseWriter-20061016.tar.gz" size="5031" author="bdelacretaz" created="Mon, 16 Oct 2006 10:59:32 +0100"/>
                            <attachment id="12341198" name="solr-XSLTResponseWriter-files.tar.gz" size="1992" author="bdelacretaz" created="Wed, 20 Sep 2006 11:05:48 +0100"/>
                            <attachment id="12340851" name="xslt-filter-files.tar.gz" size="3061" author="bdelacretaz" created="Thu, 14 Sep 2006 16:52:58 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 18 Sep 2006 19:06:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7530</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxtpj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21132</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>