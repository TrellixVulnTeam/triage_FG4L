<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:22:42 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-39/SOLR-39.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-39] Searcher&apos;s getDocListAndSet methods do not accept flags, can cause NPE when writing output</title>
                <link>https://issues.apache.org/jira/browse/SOLR-39</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;SolrIndexSearcher&apos;s getDocListAndSet methods do not accept flags, which can, in some cases, cause a Null Pointer Exception to be thrown when writing the docListAndSet.docList as output.  I came across the issue as I was implementing faceting, see &lt;a href=&quot;http://www.nabble.com/Faceted-Browsing-Question-Discussion-tf1968854.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/Faceted-Browsing-Question-Discussion-tf1968854.html&lt;/a&gt; for the discussion.&lt;/p&gt;

&lt;p&gt;The simplest way to reproduce this is to modify DisMaxRequestHandler, by changing this:&lt;/p&gt;

&lt;p&gt; DocList results = s.getDocList(query, restrictions,&lt;br/&gt;
                                     SolrPluginUtils.getSort(req),&lt;br/&gt;
                                     req.getStart(), req.getLimit(),&lt;br/&gt;
                                     flags);&lt;br/&gt;
      rsp.add(&quot;search-results&quot;,results);&lt;/p&gt;

&lt;p&gt;to&lt;/p&gt;

&lt;p&gt;      DocListAndSet listAndSet= s.getDocListAndSet(query, restrictions,&lt;br/&gt;
                                     SolrPluginUtils.getSort(req),&lt;br/&gt;
                                     req.getStart(), req.getLimit());&lt;br/&gt;
      DocList results = listAndSet.docList;&lt;br/&gt;
      rsp.add(&quot;search-results&quot;,results);&lt;/p&gt;

&lt;p&gt;The root cause appears to be that the scores[] is set to null, so then the DocIterator and its score() method is called, return scores&lt;span class=&quot;error&quot;&gt;&amp;#91;pos-1&amp;#93;&lt;/span&gt; will give null.  When getDocListAndSet(..) is invoked, it eventually can get down to this private method:&lt;/p&gt;

&lt;p&gt;  private DocSet getDocListAndSetNC(DocListAndSet out, Query query, DocSet filter, Sort lsort, int offset, int len, int flags) throws IOException&lt;/p&gt;

&lt;p&gt;In that method, scores is assigned as follows:&lt;/p&gt;

&lt;p&gt;      scores = (flags&amp;amp;GET_SCORES)!=0 ? new float&lt;span class=&quot;error&quot;&gt;&amp;#91;nDocsReturned&amp;#93;&lt;/span&gt; : null;&lt;/p&gt;

&lt;p&gt;Since getDocListAndSet() does not pass flags (except for the implicit GET_DOCSET), scores is assigned as null, which eventually leads to the NullPointerException if you try to output the docList .  The attached patch does not change the underlying mechanism of how scores is assigned, but works around the issue by adding overloaded getDocListAndSet() methods that take an additional flags parameter.  After applying this patch, you can change the relevant bit in DisMaxRequestHandler to:&lt;/p&gt;

&lt;p&gt;      DocListAndSet listAndSet= s.getDocListAndSet(query, restrictions,&lt;br/&gt;
                                     SolrPluginUtils.getSort(req),&lt;br/&gt;
                                     req.getStart(), req.getLimit(), flags);&lt;br/&gt;
      DocList results = listAndSet.docList;&lt;br/&gt;
      rsp.add(&quot;search-results&quot;,results);&lt;/p&gt;

&lt;p&gt;and you will no longer see the NullPointerException&lt;/p&gt;</description>
                <environment></environment>
        <key id="12346656">SOLR-39</key>
            <summary>Searcher&apos;s getDocListAndSet methods do not accept flags, can cause NPE when writing output</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="gludington">Greg Ludington</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Jul 2006 23:44:40 +0100</created>
                <updated>Fri, 10 May 2013 11:40:47 +0100</updated>
                            <resolved>Wed, 26 Jul 2006 01:34:39 +0100</resolved>
                                                    <fixVersion>1.1.0</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12423497" author="yseeley@gmail.com" created="Wed, 26 Jul 2006 01:34:39 +0100"  >&lt;p&gt;Thanks Greg, I just committed this.&lt;/p&gt;</comment>
                            <comment id="12589359" author="hossman" created="Wed, 16 Apr 2008 00:56:44 +0100"  >&lt;p&gt;This bug was modified as part of a bulk update using the criteria...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Marked (&quot;Resolved&quot; or &quot;Closed&quot;) and &quot;Fixed&quot;&lt;/li&gt;
	&lt;li&gt;Had no &quot;Fix Version&quot; versions&lt;/li&gt;
	&lt;li&gt;Was listed in the CHANGES.txt for 1.1&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The Fix Version for all 38 issues found was set to 1.1, email notification&lt;br/&gt;
was suppressed to prevent excessive email.&lt;/p&gt;

&lt;p&gt;For a list of all the issues modified, search jira comments for this&lt;br/&gt;
(hopefully) unique string: 20080415hossman3&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="12346667">SOLR-40</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12337510" name="SolrIndexSearcherdocListAndSet.patch" size="3613" author="gludington" created="Tue, 25 Jul 2006 23:45:02 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 26 Jul 2006 00:34:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7539</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxtrr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21142</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>