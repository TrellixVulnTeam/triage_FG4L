<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:16:19 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-1538/SOLR-1538.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-1538] Solr possible deadlock source (FindBugs report)</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1538</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The code to get the latest accessed items in ConcurrentLRUCache looks like&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;ConcurrentLRUCache.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Map&amp;lt;K, V&amp;gt; getOldestAccessedItems(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; n) {
    markAndSweepLock.lock();
    Map&amp;lt;K, V&amp;gt; result = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LinkedHashMap&amp;lt;K, V&amp;gt;();
    TreeSet&amp;lt;CacheEntry&amp;gt; tree = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TreeSet&amp;lt;CacheEntry&amp;gt;();
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
   ...
    } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
      markAndSweepLock.unlock();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(this method is apparently unused though) and in &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Map&amp;lt;K,V&amp;gt; getLatestAccessedItems(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; n) {
     &lt;span class=&quot;code-comment&quot;&gt;// we need to grab the lock since we are changing lastAccessedCopy
&lt;/span&gt;     markAndSweepLock.lock();
     Map&amp;lt;K,V&amp;gt; result = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LinkedHashMap&amp;lt;K,V&amp;gt;();
     TreeSet&amp;lt;CacheEntry&amp;gt; tree = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TreeSet&amp;lt;CacheEntry&amp;gt;();
     &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The impression is that if an OOM situation occurs on the allocation of the local LinkedHashMap and TreeSet the lock would not be unlocked anymore.&lt;br/&gt;
The quick fix would be to move the lock() call after the allocations, and this does not seem to imply any problem. &lt;/p&gt;</description>
                <environment>&lt;p&gt;platform independent&lt;/p&gt;</environment>
        <key id="12439622">SOLR-1538</key>
            <summary>Solr possible deadlock source (FindBugs report)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Hoss Man</assignee>
                                    <reporter username="riffraff">gabriele renzi</reporter>
                        <labels>
                    </labels>
                <created>Sun, 1 Nov 2009 11:51:43 +0000</created>
                <updated>Thu, 8 Jul 2010 20:55:38 +0100</updated>
                            <resolved>Mon, 11 Jan 2010 23:52:27 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.4.1</fixVersion>
                    <fixVersion>1.5</fixVersion>
                    <fixVersion>3.1</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <timeoriginalestimate seconds="600">10m</timeoriginalestimate>
                            <timeestimate seconds="600">10m</timeestimate>
                                        <comments>
                            <comment id="12772311" author="riffraff" created="Sun, 1 Nov 2009 11:57:36 +0000"  >&lt;p&gt;simply switch order of ollections allocation and lock aquisition, all tests still pass and it makes the locked zone smaller&lt;/p&gt;</comment>
                            <comment id="12798935" author="hossman" created="Mon, 11 Jan 2010 23:46:25 +0000"  >&lt;p&gt;I&apos;m not a threading/locking expert, but this seems straight forward enough.&lt;/p&gt;

&lt;p&gt;All the docs i&apos;ve seen definitely say that a &quot;try&quot; block (with &quot;unlock&quot; in the finally) should be the very next line after any lock() call.&lt;/p&gt;</comment>
                            <comment id="12798938" author="hossman" created="Mon, 11 Jan 2010 23:52:27 +0000"  >&lt;p&gt;Committed revision 898119.&lt;/p&gt;</comment>
                            <comment id="12872690" author="hossman" created="Fri, 28 May 2010 00:09:30 +0100"  >
&lt;p&gt;Correcting Fix Version based on CHANGES.txt, see this thread for more details...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/lucene-dev/201005.mbox/%3Calpine.DEB.1.10.1005251052040.24672@radix.cryptio.net%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/lucene-dev/201005.mbox/%3Calpine.DEB.1.10.1005251052040.24672@radix.cryptio.net%3E&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12873816" author="hossman" created="Mon, 31 May 2010 23:59:43 +0100"  >&lt;p&gt;Committed revision 949885.&lt;/p&gt;

&lt;p&gt;merged to branch-1.4 for 1.4.1&lt;/p&gt;</comment>
                            <comment id="12873817" author="hossman" created="Mon, 31 May 2010 23:59:46 +0100"  >&lt;p&gt;Committed revision 949885.&lt;/p&gt;

&lt;p&gt;merged to branch-1.4 for 1.4.1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12423774" name="SOLR-1538.patch" size="1267" author="riffraff" created="Sun, 1 Nov 2009 11:57:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 Jan 2010 23:46:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6127</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxko7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19668</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>