<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:18:02 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-930/SOLR-930.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-930] SolrCore.close() : Warn in the logger when the internal reference count is &gt; 0</title>
                <link>https://issues.apache.org/jira/browse/SOLR-930</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;SolrCore.close() -&amp;gt; Add a warning statement when the internal reference count is &amp;gt; 0. ( as opposed to 0, as expected ) - &lt;/p&gt;</description>
                <environment>&lt;p&gt;Java 6, Tomcat 6 &lt;/p&gt;</environment>
        <key id="12411012">SOLR-930</key>
            <summary>SolrCore.close() : Warn in the logger when the internal reference count is &gt; 0</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ryantxu">Ryan McKinley</assignee>
                                    <reporter username="kaykay.unique">Karthik K</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Dec 2008 21:34:30 +0000</created>
                <updated>Thu, 22 Jan 2009 14:32:41 +0000</updated>
                            <resolved>Thu, 22 Jan 2009 01:33:10 +0000</resolved>
                                                    <fixVersion>1.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <timeoriginalestimate seconds="3600">1h</timeoriginalestimate>
                            <timeestimate seconds="3600">1h</timeestimate>
                                        <comments>
                            <comment id="12657916" author="kaykay.unique" created="Thu, 18 Dec 2008 21:36:11 +0000"  >&lt;p&gt;&amp;#8212; src/java/org/apache/solr/core/SolrCore.java	(revision 727831)&lt;/p&gt;

&lt;p&gt;   public void close() {&lt;br/&gt;
     int count = refCount.decrementAndGet();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (count &amp;gt; 0) return;&lt;br/&gt;
+    if (count &amp;gt; 0) 
{
+      log.warn(&quot;Attempted close on &quot; + this + &quot; did not succeed because the new reference count &quot; + count + &quot; is &amp;gt; 0. &quot;);
+      return;
+    }&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12657933" author="ryantxu" created="Thu, 18 Dec 2008 22:41:04 +0000"  >&lt;p&gt;added in trunk.&lt;br/&gt;
thanks Kay&lt;/p&gt;</comment>
                            <comment id="12658020" author="shalinmangar" created="Fri, 19 Dec 2008 06:32:39 +0000"  >&lt;p&gt;Ryan, after this commit, I see the following message on almost every request to Solr. Just use the example jetty and request any JSP (stats/info) and you will find the warning in the log. Perhaps this logging is not needed?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;WARNING: Attempted close on org.apache.solr.core.SolrCore@b86944 did not succeed because the &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; reference count 1 is &amp;gt; 0&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12658105" author="kaykay.unique" created="Fri, 19 Dec 2008 15:47:00 +0000"  >&lt;p&gt;I believe the fact that refcount &amp;gt; 0 while closing is still a warning. If this were frequent enough - then probably some other resource manager, after incrementing the count is not decrementing the same after the use . We need to address that separately as opposed to commenting this one out. &lt;/p&gt;</comment>
                            <comment id="12658107" author="ryantxu" created="Fri, 19 Dec 2008 15:53:54 +0000"  >&lt;p&gt;for now, i will just change the log level to &quot;debug&quot;&lt;/p&gt;</comment>
                            <comment id="12658138" author="yseeley@gmail.com" created="Fri, 19 Dec 2008 17:42:56 +0000"  >&lt;p&gt;The count being greater than zero is not an error condition - close() is called on every request.&lt;br/&gt;
This patch should be reverted.&lt;/p&gt;</comment>
                            <comment id="12658140" author="kaykay.unique@gmail.com" created="Fri, 19 Dec 2008 17:58:07 +0000"  >&lt;p&gt;If it were not an error condition - something has to be abnormal since we are not releasing resources / calling closeHooks - upon close and return prematurely right at the beginning of the function. &lt;/p&gt;

&lt;p&gt;So - it indicates a possible resource leak that needs to be looked into, (possibly elsewhere ). &lt;/p&gt;

&lt;p&gt;I am not for reverting / changing the logging level . &lt;/p&gt;
</comment>
                            <comment id="12658144" author="kaykay.unique" created="Fri, 19 Dec 2008 18:20:00 +0000"  >&lt;p&gt;Reopening the issue - since close() is important to keep track of if the SolrCore is active ( if we were to re-register the core ,etc.) &lt;/p&gt;

&lt;p&gt;If count &amp;gt; 0 - close() returns silently as of now. &lt;/p&gt;

&lt;p&gt;If count &amp;lt; 0 , close() logs an error ( previously - it used to throwing an exception at least , to signify that we are into uncharted territory ). &lt;/p&gt;

&lt;p&gt;With the current behavior - it is impossible to actually know if close() indeed completed successfully with counter set to 0, and it will be hard to track memory references / reachability of object during memory leaks with the current behavior. &lt;/p&gt;</comment>
                            <comment id="12658148" author="hossman" created="Fri, 19 Dec 2008 18:45:58 +0000"  >&lt;p&gt;1) i think you are miss-understanding the point of close() ... it&apos;s called by every person who uses the core once they are done with it to indicate they are done with it.  the resources are only truely freed once the count returns to 1 ... note the javadocs of hte method.&lt;/p&gt;

&lt;p&gt;2) if you want to know if all the resources have been freed (ie: everyone using the core has closed it) use &quot;isClosed()&quot;&lt;/p&gt;


&lt;p&gt;perhaps the confusion here is just the legacy name (close() was named back when SolrCore was a singleton i believe).&lt;/p&gt;
</comment>
                            <comment id="12658153" author="kaykay.unique" created="Fri, 19 Dec 2008 18:57:46 +0000"  >&lt;p&gt;Thanks Hoss . That clarifies. &lt;/p&gt;

&lt;p&gt;Added @see to the javadoc to clarify more about it. Also - modified the javadoc about throwing exceptions if refCount &amp;lt; 0  (the code does not do it anymore ). &lt;/p&gt;

&lt;p&gt;The revised patch should be javadoc changes relevant to the part. &lt;/p&gt;</comment>
                            <comment id="12658154" author="kaykay.unique" created="Fri, 19 Dec 2008 18:58:26 +0000"  >&lt;p&gt;Updating javadoc about not throwing exceptions . &lt;/p&gt;

&lt;p&gt;Added @see isClosed() for cross-reference. &lt;/p&gt;</comment>
                            <comment id="12666029" author="hossman" created="Thu, 22 Jan 2009 01:33:10 +0000"  >&lt;p&gt;Kay: @see tags can&apos;t contain &lt;/p&gt;
{@link}
&lt;p&gt; tags (at least not in Javadoc 1.5)&lt;/p&gt;

&lt;p&gt;I took some of the text from your patch and reworked it into some new javadocs that are a bit more explicit about what exactly is going on under the hood...&lt;/p&gt;

&lt;p&gt;Committed revision 736518.&lt;/p&gt;</comment>
                            <comment id="12666154" author="kaykay.unique" created="Thu, 22 Jan 2009 14:32:41 +0000"  >&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Kay: @see tags can&apos;t contain 
{@link}
&lt;p&gt; tags (at least not in Javadoc 1.5)&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;Oops - I was using java 6 (javadoc compiler). Thanks for the clarification in the docs. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12396506" name="SOLR-930.patch" size="1140" author="kaykay.unique" created="Fri, 19 Dec 2008 18:58:26 +0000"/>
                            <attachment id="12396433" name="SOLR-930.patch" size="761" author="kaykay.unique" created="Thu, 18 Dec 2008 21:36:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 18 Dec 2008 22:41:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6703</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxobz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20261</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>