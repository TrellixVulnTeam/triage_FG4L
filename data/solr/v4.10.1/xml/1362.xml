<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:26:24 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-1362/SOLR-1362.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-1362] WordDelimiterFilter position increment bug</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1362</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;WordDelimiterFilter sometimes assigns high position increment values, which inhibits phrase matches.&lt;/p&gt;

&lt;p&gt;If this is a feature and not a bug please change the issue type, and I will change the patch to propose this as an option...&lt;/p&gt;</description>
                <environment></environment>
        <key id="12433008">SOLR-1362</key>
            <summary>WordDelimiterFilter position increment bug</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Aug 2009 17:45:59 +0100</created>
                <updated>Tue, 10 Nov 2009 15:52:13 +0000</updated>
                            <resolved>Wed, 26 Aug 2009 14:34:06 +0100</resolved>
                                                    <fixVersion>1.4</fixVersion>
                                    <component>Schema and Analysis</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12742895" author="yseeley@gmail.com" created="Thu, 13 Aug 2009 18:17:33 +0100"  >&lt;p&gt;Hmmm, at first blush, it seems like we&apos;re just trying to preserve the positioning of the original tokens... so &lt;br/&gt;
&quot;foo !@# bar&quot; will index to &quot;foo (blank) bar&quot;&lt;/p&gt;

&lt;p&gt;Is that the issue?&lt;/p&gt;</comment>
                            <comment id="12742983" author="rcmuir" created="Thu, 13 Aug 2009 22:31:32 +0100"  >&lt;p&gt;yonik, maybe: i am unable to tell from docs/tests if it is a bug or not. from the code (especially the variable name) it looks suspicious.&lt;/p&gt;

&lt;p&gt;but this is what i mean, i guess it could be desirable for some folks? So I could make it another option...?&lt;/p&gt;</comment>
                            <comment id="12742995" author="rcmuir" created="Thu, 13 Aug 2009 23:02:38 +0100"  >&lt;p&gt;fyi this line of code was changed from = to += in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14&quot; title=&quot;Add the ability to preserve the original term when using WordDelimiterFilter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14&quot;&gt;&lt;del&gt;SOLR-14&lt;/del&gt;&lt;/a&gt;, which in general appears to be an unrelated issue &lt;/p&gt;

&lt;p&gt;there is one comment about wdf doing the &quot;wrong thing&quot; with positions, but i cannot tell if it was intentional or not.&lt;/p&gt;</comment>
                            <comment id="12745113" author="yseeley@gmail.com" created="Wed, 19 Aug 2009 17:37:05 +0100"  >&lt;p&gt;I could see perhaps wanting WDF to not create new gaps, but it should normally preserve existing gaps, right?  In which case, a patch would be more complex than conditionally changing &quot;+=&quot; to &quot;=&quot;&lt;/p&gt;</comment>
                            <comment id="12745186" author="rcmuir" created="Wed, 19 Aug 2009 21:29:23 +0100"  >&lt;p&gt;Yonik, in this case I think existing gaps would be preserved with the =&lt;br/&gt;
the question is what should the behavior be for tokens that are all delimiters, currently these are discarded and posInc is incremented for future tokens.&lt;/p&gt;

&lt;p&gt;with the current behavior, if you have &quot;LUCENE / SOLR&quot; (all with posInc=1), this becomes LUCENE (posInc=1), SOLR (posInc=2)&lt;br/&gt;
if you change it to =, if you have &quot;LUCENE / SOLR&quot; (pretend SOLR has posInc=3), the posInc=3 would still be preserved, it would just not become 4.&lt;/p&gt;

&lt;p&gt;its clear to me looking at history its been like this for a long time, so maybe I am incorrect to categorize it as a bug?&lt;br/&gt;
But I found this behavior to be a little unexpected, especially for phrase queries, and given the way the code reads, I wasn&apos;t certain if it was intentional.&lt;/p&gt;</comment>
                            <comment id="12745516" author="yseeley@gmail.com" created="Thu, 20 Aug 2009 18:33:00 +0100"  >&lt;blockquote&gt;&lt;p&gt;Yonik, in this case I think existing gaps would be preserved with the =&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What if the big position increment was on a token that was all delimiters?&lt;/p&gt;

&lt;p&gt;I agree that it makes more sense for &quot;LUCENE / SOLR&quot; to be translated to LUCENE SOLR without a gap though (provided that there are no gaps to start with).&lt;/p&gt;

&lt;p&gt;Should the rule be, subtract 1 from the cumulative position increment if the increment of the current token being added is &amp;gt;=1 ?&lt;/p&gt;</comment>
                            <comment id="12745520" author="rcmuir" created="Thu, 20 Aug 2009 18:39:58 +0100"  >&lt;p&gt;ah, i see your point... &lt;/p&gt;

&lt;p&gt;sounds right to me. i can reformulate the patch/tests in this direction.&lt;/p&gt;

&lt;p&gt;I assume it should be as an option for back compat?&lt;/p&gt;</comment>
                            <comment id="12745541" author="yseeley@gmail.com" created="Thu, 20 Aug 2009 19:21:48 +0100"  >&lt;blockquote&gt;&lt;p&gt;I assume it should be as an option for back compat?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I guess so, yes... there may be configurations where it makes sense.&lt;/p&gt;</comment>
                            <comment id="12745791" author="rcmuir" created="Fri, 21 Aug 2009 05:57:33 +0100"  >&lt;p&gt;I started working on a patch, but found the existing behavior to be more strange than I originally thought.&lt;/p&gt;

&lt;p&gt;there are some bugs in the existing behavior as well, completely separate but along the same lines of this issue.&lt;/p&gt;

&lt;p&gt;So here are some tests, let me know what you think...&lt;/p&gt;</comment>
                            <comment id="12747476" author="yseeley@gmail.com" created="Tue, 25 Aug 2009 17:18:58 +0100"  >&lt;p&gt;Thanks Robert... looking into it.&lt;/p&gt;</comment>
                            <comment id="12747482" author="yseeley@gmail.com" created="Tue, 25 Aug 2009 17:50:47 +0100"  >&lt;p&gt;OK, here&apos;s a patch that increases the consistency.&lt;/p&gt;

&lt;p&gt;From here I think we should subtract 1 for every skipped token that had a position increment of 1.  It&apos;s not possible to fix these bugs and keep back compatibility, so I don&apos;t think we need a config option for this.&lt;/p&gt;</comment>
                            <comment id="12747655" author="rcmuir" created="Tue, 25 Aug 2009 22:23:07 +0100"  >&lt;p&gt;Yonik, thanks! I will work on the skipped token subtraction tonight, but your patch has restored order &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12747730" author="yseeley@gmail.com" created="Wed, 26 Aug 2009 02:21:55 +0100"  >&lt;p&gt;I had implemented the &quot;remove normal posIncr&quot; this morning - just got around to adding a test though.  Seems to work - can you see if this matches your expectations?&lt;/p&gt;

&lt;p&gt;I think about it like this:  position increments serve two purposes... to signify the normal case of tokens being adjacent to each other, and to separate groups of tokens.  In the former case, it makes sense to completely consume the delimiter and keep the resulting tokens next to eachother.  In the later case, we want to preserve the logical separation.&lt;/p&gt;</comment>
                            <comment id="12747752" author="rcmuir" created="Wed, 26 Aug 2009 04:46:45 +0100"  >&lt;blockquote&gt;&lt;p&gt;I had implemented the &quot;remove normal posIncr&quot; this morning - just got around to adding a test though. Seems to work - can you see if this matches your expectations? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I tested some with this patch some and I like this behavior.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think about it like this: position increments serve two purposes... to signify the normal case of tokens being adjacent to each other, and to separate groups of tokens. In the former case, it makes sense to completely consume the delimiter and keep the resulting tokens next to eachother. In the later case, we want to preserve the logical separation.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, I think this fixes the behavior for both purposes.&lt;/p&gt;</comment>
                            <comment id="12747754" author="rcmuir" created="Wed, 26 Aug 2009 04:52:06 +0100"  >&lt;p&gt;actually one last thing Yonik, at the beginning of the processing loop (now i am just nitpicking)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     &lt;span class=&quot;code-comment&quot;&gt;//skip &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; tokens
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (protWords != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; protWords.contains(termBuffer, 0, len)) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; t;
      }

      &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; posInc = t.getPositionIncrement();
      origPosIncrement += posInc;
      ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I should have written testcase, but don&apos;t you think if you have a LUCENE / SOLR where &quot;/&quot; has a huge gap, and SOLR is in &apos;protWords&apos; that this might result in strange behavior?&lt;/p&gt;</comment>
                            <comment id="12747757" author="rcmuir" created="Wed, 26 Aug 2009 05:09:33 +0100"  >&lt;p&gt;patch that moves the protWords check below the posInc calculation, and sets it.&lt;/p&gt;</comment>
                            <comment id="12747940" author="yseeley@gmail.com" created="Wed, 26 Aug 2009 14:34:06 +0100"  >&lt;p&gt;Committed, thanks Robert!&lt;/p&gt;</comment>
                            <comment id="12775843" author="gsingers" created="Tue, 10 Nov 2009 15:52:13 +0000"  >&lt;p&gt;Bulk close for Solr 1.4&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12417699" name="SOLR-1362.patch" size="7192" author="rcmuir" created="Wed, 26 Aug 2009 05:09:33 +0100"/>
                            <attachment id="12417687" name="SOLR-1362.patch" size="6266" author="yseeley@gmail.com" created="Wed, 26 Aug 2009 02:21:55 +0100"/>
                            <attachment id="12417628" name="SOLR-1362.patch" size="6037" author="yseeley@gmail.com" created="Tue, 25 Aug 2009 17:50:47 +0100"/>
                            <attachment id="12416459" name="SOLR-1362.patch" size="3050" author="rcmuir" created="Thu, 13 Aug 2009 17:46:59 +0100"/>
                            <attachment id="12417217" name="SOLR-1362_tests.txt" size="4853" author="rcmuir" created="Fri, 21 Aug 2009 05:57:32 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 13 Aug 2009 17:17:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6289</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxlpr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19837</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>