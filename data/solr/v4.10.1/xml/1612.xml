<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:20:11 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-1612/SOLR-1612.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-1612] Use java.sql.Array to populate Multivalue field in DataImportHandler</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1612</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I am attaching a patch to the JdbcDataSource class which allows the it to populate a multiValued field from a query which returns a java.sql.Array type for a column value.&lt;/p&gt;

&lt;p&gt;In order to make this work, you need to do the following:&lt;/p&gt;

&lt;p&gt;1.  In your schema.xml file, set the &quot;multiValued&quot; attribute to the value &quot;true&quot;&lt;/p&gt;

&lt;p&gt;         &amp;lt;field name=foo&quot; type=&quot;string&quot;  ... multiValued=&quot;true&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;2.  Have your sql query return a sql type of java.sql.Types.ARRAY.  How to do this is very database dependent, but in oracle, you first create a type:&lt;/p&gt;

&lt;p&gt;             create or replace type FOO_TYPE IS TABLE OF VARCHAR2(255);&lt;/p&gt;

&lt;p&gt;      and then when you select the values, you have to use MULTISET and cast to the created type (assuming here that FOO_PARENT_ID is the condition to&lt;br/&gt;
      limit which foos belong to the current record):&lt;/p&gt;

&lt;p&gt;             CAST(MULTISET(SELECT FOO FROM FOOS WHERE FOO_PARENT=FOO_PARENT_ID) AS FOO_TYPE ) MY_FOOS&lt;/p&gt;

&lt;p&gt;The main advantage this has is it can save you a ton of queries over the current method which will fire off an individual query for each document in order to retrieve the values for each multiValued field.  This method executes much faster, and saves alot of database resources.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12441972">SOLR-1612</key>
            <summary>Use java.sql.Array to populate Multivalue field in DataImportHandler</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mattinger">Matt Inger</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Nov 2009 16:45:37 +0000</created>
                <updated>Wed, 16 Apr 2014 13:57:22 +0100</updated>
                                            <version>1.4</version>
                                    <fixVersion>4.9</fixVersion>
                    <fixVersion>Trunk</fixVersion>
                                    <component>contrib - DataImportHandler</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12784203" author="noble.paul" created="Tue, 1 Dec 2009 12:34:53 +0000"  >&lt;p&gt;isn&apos;t it simpler to write a Transformer to achieve this? &lt;/p&gt;</comment>
                            <comment id="12784970" author="mattinger" created="Wed, 2 Dec 2009 19:37:42 +0000"  >&lt;p&gt;Thanks for the suggestion, and I&apos;m in the process of doing that, but I have noticed a few things wrong with the general custom transformer implementation:&lt;/p&gt;

&lt;p&gt;1.  If I package my custom transformer up in it&apos;s own jar file, it seems the ClassLoader is unable to find the Transformer class from dataimporter jar file, so I have&lt;br/&gt;
     to add that to my example/example-DIH/lib directory as well in order to get it to find the Transformer class.&lt;/p&gt;

&lt;p&gt;2.  The implementation of the loading of the Transformer class has a bug in it in regards to how it deals with Simple transformers.  It seems if you extend the Transformer class, you still have to implement the simpler version of the transformRow method:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; transformRow(Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This slice of code, which is in EntityProcessorWrapper, around line 100, is the root of the problem.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; clazz = DocBuilder.loadClass(trans, context.getSolrCore());
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (clazz.newInstance() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Transformer) {
          transformers.add((Transformer) clazz.newInstance());
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
          &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Method meth = clazz.getMethod(TRANSFORM_ROW, Map.class);
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (meth == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; msg = &lt;span class=&quot;code-quote&quot;&gt;&quot;Transformer :&quot;&lt;/span&gt;
                    + trans
                    + &lt;span class=&quot;code-quote&quot;&gt;&quot;does not implement Transformer &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; or does not have a transformRow(Map m)method&quot;&lt;/span&gt;;
            log.error(msg);
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DataImportHandlerException(
                    SEVERE, msg);
          }
          transformers.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ReflectionTransformer(meth, clazz, trans));
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In particular, the class to &quot;clazz.getMethod&quot; DOES NOT return a null value if the method does not exist (at least in JDK 1.5).  It in fact, throws a NoSuchMethodException, which means that I have to have the simpler method no matter whether i&apos;m using it or not.&lt;/p&gt;
</comment>
                            <comment id="12784998" author="mattinger" created="Wed, 2 Dec 2009 21:01:10 +0000"  >&lt;p&gt;Seems the second issues is caused by the class loading problem.  Since I have to include a second copy of the dataimporter jar file in order to resolve the ClassNotFoundException, it fails the &quot;instanceof&quot; condition since the base class of my transformer is not the same Transformer class that the EntityProcessorWrapper is aware of.  As a result, it falls through to else clause, and it ends up requiring the simple  version of the method. &lt;/p&gt;

&lt;p&gt;As a future optimization, this is not the best way to check anyway, you&apos;re better off doing this, which is faster, and doesn&apos;t require an object to be constructed, to check to see if the class extends the Transformer class.  The way you currently have it implemented, it&apos;s needlessly constructing the object twice no matter which type of transformer is being used.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( Transformer.class.isAssignableFrom(clazz) ) {

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12785211" author="noble.paul" created="Thu, 3 Dec 2009 07:38:00 +0000"  >&lt;p&gt;hi Matt, I have made those changes .committed r886690&lt;/p&gt;</comment>
                            <comment id="12785352" author="mattinger" created="Thu, 3 Dec 2009 15:16:39 +0000"  >&lt;p&gt;Any thoughts on how to handle the class loading issue though when constructing the transformer itself?  The way I&apos;m getting around it right now is to run SOLR first, and then find the exploded webapp, and copy my jar into the WEB-INF/lib directory of the exploded webapp.  &lt;/p&gt;</comment>
                            <comment id="12785371" author="noble.paul" created="Thu, 3 Dec 2009 15:58:11 +0000"  >&lt;p&gt;Users usually add their jars into solr.home/lib and it works . If it doesn&apos;t ,it should be a problem&lt;/p&gt;</comment>
                            <comment id="12785389" author="mattinger" created="Thu, 3 Dec 2009 16:51:27 +0000"  >&lt;p&gt;I have placed my .jar file in apache-solr-1.4.0/example/lib and am experience the problem mentioned above.  I&apos;m guessing that for some reason the classloader whcih loads the classes from the lib directory does not have the webapp&apos;s classloader configured as it&apos;s parent classloader.  As a result, when it looks for the superclass of the custom transformer, it can&apos;t find the Transformer abstract class.&lt;/p&gt;</comment>
                            <comment id="12796128" author="noble.paul" created="Mon, 4 Jan 2010 09:33:11 +0000"  >&lt;p&gt;is your issue resolved? Is it not possible to make it a Transformer?&lt;/p&gt;</comment>
                            <comment id="12796211" author="mattinger" created="Mon, 4 Jan 2010 15:29:08 +0000"  >&lt;p&gt;Yes, and I have attached that transformer to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1675&quot; title=&quot;Placing Custom Transform in example/lib directory does not work properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1675&quot;&gt;&lt;del&gt;SOLR-1675&lt;/del&gt;&lt;/a&gt;, and will link to this ticket.  Perhaps it&apos;s useful enough to include directly in the contrib code.&lt;/p&gt;</comment>
                            <comment id="12796530" author="noble.paul" created="Tue, 5 Jan 2010 05:27:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1675&quot; title=&quot;Placing Custom Transform in example/lib directory does not work properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1675&quot;&gt;&lt;del&gt;SOLR-1675&lt;/del&gt;&lt;/a&gt; is a different issue. We can change the description of this issue and commit the transformer as a part of this&lt;/p&gt;</comment>
                            <comment id="12872549" author="hossman" created="Thu, 27 May 2010 23:07:38 +0100"  >&lt;p&gt;Bulk updating 240 Solr issues to set the Fix Version to &quot;next&quot; per the process outlined in this email...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/lucene-dev/201005.mbox/%3Calpine.DEB.1.10.1005251052040.24672@radix.cryptio.net%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/lucene-dev/201005.mbox/%3Calpine.DEB.1.10.1005251052040.24672@radix.cryptio.net%3E&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Selection criteria was &quot;Unresolved&quot; with a Fix Version of 1.5, 1.6, 3.1, or 4.0.  email notifications were suppressed.&lt;/p&gt;

&lt;p&gt;A unique token for finding these 240 issues in the future: hossversioncleanup20100527&lt;/p&gt;</comment>
                            <comment id="13043791" author="rcmuir" created="Fri, 3 Jun 2011 17:47:04 +0100"  >&lt;p&gt;Bulk move 3.2 -&amp;gt; 3.3&lt;/p&gt;</comment>
                            <comment id="13106312" author="rcmuir" created="Fri, 16 Sep 2011 15:50:30 +0100"  >&lt;p&gt;3.4 -&amp;gt; 3.5&lt;/p&gt;</comment>
                            <comment id="13234638" author="hossman" created="Wed, 21 Mar 2012 18:08:41 +0000"  >&lt;p&gt;Bulk of fixVersion=3.6 -&amp;gt; fixVersion=4.0 for issues that have no assignee and have not been updated recently.&lt;/p&gt;

&lt;p&gt;email notification suppressed to prevent mass-spam&lt;br/&gt;
psuedo-unique token identifying these issues: hoss20120321nofix36&lt;/p&gt;</comment>
                            <comment id="13717318" author="steve_rowe" created="Tue, 23 Jul 2013 19:47:51 +0100"  >&lt;p&gt;Bulk move 4.4 issues to 4.5 and 5.0&lt;/p&gt;</comment>
                            <comment id="13971178" author="thetaphi" created="Wed, 16 Apr 2014 13:57:22 +0100"  >&lt;p&gt;Move issue to Solr 4.9.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12443797">SOLR-1675</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12426424" name="SOLR-1612.patch" size="7253" author="mattinger" created="Mon, 30 Nov 2009 16:47:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Dec 2009 12:34:53 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6058</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxk7z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19595</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>