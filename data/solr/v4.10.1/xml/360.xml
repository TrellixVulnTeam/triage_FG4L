<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:21:49 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-360/SOLR-360.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-360] Multithread update client causes exceptions and dropped documents</title>
                <link>https://issues.apache.org/jira/browse/SOLR-360</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;we were doing some performance testing for the updating aspects of solr and ran into what seems to be a large problem.  we&apos;re creating small documents with an id and one field of 1 term only submitting them in batches of 200 with commits every 5000 docs.  when we run the client with 1 thread everything is fine.  when we run it win &amp;gt;1 threads things go south (stack trace is below).  i&apos;ve attached the junit test which shows the problem.  this happens on both a mac and a pc and when running solr in both jetty and tomcat.  i&apos;ll create a junit issue if necessary but i thought i&apos;d see if anyone else had run into this problem first.   &lt;/p&gt;

&lt;p&gt;also, the problem does not seem to surface under solr1.2&lt;/p&gt;

&lt;p&gt;(RyanM suggested it might be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-215&quot; title=&quot;Multiple Solr Cores - remove static singleton&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-215&quot;&gt;&lt;del&gt;SOLR-215&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;(output from junit test)&lt;br/&gt;
Started thread: 0&lt;br/&gt;
Started thread: 1&lt;br/&gt;
org.apache.solr.common.SolrException: Current_state_is_not_among_the_states_START_ELEMENT_&lt;em&gt;ATTRIBUTEvalid_for_getAttributeCount&lt;/em&gt;&lt;em&gt;javalangIllegalStateException_Current_state_is_not_among_the_states_START_ELEMENT&lt;/em&gt;&lt;em&gt;ATTRIBUTEvalid_for_getAttributeCount&lt;/em&gt;&lt;em&gt;at_comsunorgapachexercesinternalimplXMLStreamReaderImplgetAttributeCountXMLStreamReaderImpljava598&lt;/em&gt;&lt;em&gt;at_orgapachesolrhandlerXmlUpdateRequestHandlerreadDocXmlUpdateRequestHandlerjava335&lt;/em&gt;&lt;em&gt;at_orgapachesolrhandlerXmlUpdateRequestHandlerprocessUpdateXmlUpdateRequestHandlerjava181&lt;/em&gt;&lt;em&gt;at_orgapachesolrhandlerXmlUpdateRequestHandlerhandleRequestBodyXmlUpdateRequestHandlerjava109&lt;/em&gt;&lt;em&gt;at_orgapachesolrhandlerRequestHandlerBasehandleRequestRequestHandlerBasejava78&lt;/em&gt;&lt;em&gt;at_orgapachesolrcoreSolrCoreexecuteSolrCorejava804&lt;/em&gt;&lt;em&gt;at_orgapachesolrservletSolrDispatchFilterexecuteSolrDispatchFilterjava193&lt;/em&gt;&lt;em&gt;at_orgapachesolrservletSolrDispatchFilterdoFilterSolrDispatchFilterjava161&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyservletServletHandler$CachedChaindoFilterServletHandlerjava1089&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyservletServletHandlerhandleServletHandlerjava365&lt;/em&gt;&lt;em&gt;at_orgmortbayjettysecuritySecurityHandlerhandleSecurityHandlerjava216&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyservletSessionHandlerhandleSessionHandlerjava181&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyhandlerContextHandlerhandleContextHandlerjava712&lt;/em&gt;&lt;em&gt;at_orgmortbayjettywebappWebAppContexthandleWebAppContextjava405&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyhandlerContextHandlerCollectionhandleContextHandlerCollectionjava211&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyhandlerHandlerCollectionhandleHandlerCollectionjava114&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyhandlerHandlerWrapperhandleHandlerWrapperjava139&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyServerhandleServerjava285&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyHttpConnectionhandleRequestHttpConnectionjava502&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyHttpConnection$RequestHandlercontentHttpConnectionjava835&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyHttpParserparseNextHttpParserjava641&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyHttpParserparseAvailableHttpParserjava208&lt;/em&gt;_at_orgmortbayje&lt;/p&gt;

&lt;p&gt;Current_state_is_not_among_the_states_START_ELEMENT_&lt;em&gt;ATTRIBUTEvalid_for_getAttributeCount&lt;/em&gt;&lt;em&gt;javalangIllegalStateException_Current_state_is_not_among_the_states_START_ELEMENT&lt;/em&gt;&lt;em&gt;ATTRIBUTEvalid_for_getAttributeCount&lt;/em&gt;&lt;em&gt;at_comsunorgapachexercesinternalimplXMLStreamReaderImplgetAttributeCountXMLStreamReaderImpljava598&lt;/em&gt;&lt;em&gt;at_orgapachesolrhandlerXmlUpdateRequestHandlerreadDocXmlUpdateRequestHandlerjava335&lt;/em&gt;&lt;em&gt;at_orgapachesolrhandlerXmlUpdateRequestHandlerprocessUpdateXmlUpdateRequestHandlerjava181&lt;/em&gt;&lt;em&gt;at_orgapachesolrhandlerXmlUpdateRequestHandlerhandleRequestBodyXmlUpdateRequestHandlerjava109&lt;/em&gt;&lt;em&gt;at_orgapachesolrhandlerRequestHandlerBasehandleRequestRequestHandlerBasejava78&lt;/em&gt;&lt;em&gt;at_orgapachesolrcoreSolrCoreexecuteSolrCorejava804&lt;/em&gt;&lt;em&gt;at_orgapachesolrservletSolrDispatchFilterexecuteSolrDispatchFilterjava193&lt;/em&gt;&lt;em&gt;at_orgapachesolrservletSolrDispatchFilterdoFilterSolrDispatchFilterjava161&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyservletServletHandler$CachedChaindoFilterServletHandlerjava1089&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyservletServletHandlerhandleServletHandlerjava365&lt;/em&gt;&lt;em&gt;at_orgmortbayjettysecuritySecurityHandlerhandleSecurityHandlerjava216&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyservletSessionHandlerhandleSessionHandlerjava181&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyhandlerContextHandlerhandleContextHandlerjava712&lt;/em&gt;&lt;em&gt;at_orgmortbayjettywebappWebAppContexthandleWebAppContextjava405&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyhandlerContextHandlerCollectionhandleContextHandlerCollectionjava211&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyhandlerHandlerCollectionhandleHandlerCollectionjava114&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyhandlerHandlerWrapperhandleHandlerWrapperjava139&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyServerhandleServerjava285&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyHttpConnectionhandleRequestHttpConnectionjava502&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyHttpConnection$RequestHandlercontentHttpConnectionjava835&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyHttpParserparseNextHttpParserjava641&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyHttpParserparseAvailableHttpParserjava208&lt;/em&gt;_at_orgmortbayje&lt;/p&gt;

&lt;p&gt;request: &lt;a href=&quot;http://localhost:8983/solr/update?wt=xml&amp;amp;version=2.2&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://localhost:8983/solr/update?wt=xml&amp;amp;version=2.2&lt;/a&gt;&lt;br/&gt;
	at org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:230)&lt;br/&gt;
	at org.apache.solr.client.solrj.request.UpdateRequest.process(UpdateRequest.java:199)&lt;br/&gt;
	at org.apache.solr.client.solrj.impl.BaseSolrServer.add(BaseSolrServer.java:46)&lt;br/&gt;
	at org.apache.solr.client.solrj.impl.BaseSolrServer.add(BaseSolrServer.java:61)&lt;br/&gt;
	at org.apache.solr.client.solrj.embedded.TestJettyLargeVolume$DocThread.run(TestJettyLargeVolume.java:69)&lt;br/&gt;
Exception in thread &quot;DocThread-0&quot; java.lang.AssertionError: DocThread-0---Current_state_is_not_among_the_states_START_ELEMENT_&lt;em&gt;ATTRIBUTEvalid_for_getAttributeCount&lt;/em&gt;&lt;em&gt;javalangIllegalStateException_Current_state_is_not_among_the_states_START_ELEMENT&lt;/em&gt;&lt;em&gt;ATTRIBUTEvalid_for_getAttributeCount&lt;/em&gt;&lt;em&gt;at_comsunorgapachexercesinternalimplXMLStreamReaderImplgetAttributeCountXMLStreamReaderImpljava598&lt;/em&gt;&lt;em&gt;at_orgapachesolrhandlerXmlUpdateRequestHandlerreadDocXmlUpdateRequestHandlerjava335&lt;/em&gt;&lt;em&gt;at_orgapachesolrhandlerXmlUpdateRequestHandlerprocessUpdateXmlUpdateRequestHandlerjava181&lt;/em&gt;&lt;em&gt;at_orgapachesolrhandlerXmlUpdateRequestHandlerhandleRequestBodyXmlUpdateRequestHandlerjava109&lt;/em&gt;&lt;em&gt;at_orgapachesolrhandlerRequestHandlerBasehandleRequestRequestHandlerBasejava78&lt;/em&gt;&lt;em&gt;at_orgapachesolrcoreSolrCoreexecuteSolrCorejava804&lt;/em&gt;&lt;em&gt;at_orgapachesolrservletSolrDispatchFilterexecuteSolrDispatchFilterjava193&lt;/em&gt;&lt;em&gt;at_orgapachesolrservletSolrDispatchFilterdoFilterSolrDispatchFilterjava161&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyservletServletHandler$CachedChaindoFilterServletHandlerjava1089&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyservletServletHandlerhandleServletHandlerjava365&lt;/em&gt;&lt;em&gt;at_orgmortbayjettysecuritySecurityHandlerhandleSecurityHandlerjava216&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyservletSessionHandlerhandleSessionHandlerjava181&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyhandlerContextHandlerhandleContextHandlerjava712&lt;/em&gt;&lt;em&gt;at_orgmortbayjettywebappWebAppContexthandleWebAppContextjava405&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyhandlerContextHandlerCollectionhandleContextHandlerCollectionjava211&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyhandlerHandlerCollectionhandleHandlerCollectionjava114&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyhandlerHandlerWrapperhandleHandlerWrapperjava139&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyServerhandleServerjava285&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyHttpConnectionhandleRequestHttpConnectionjava502&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyHttpConnection$RequestHandlercontentHttpConnectionjava835&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyHttpParserparseNextHttpParserjava641&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyHttpParserparseAvailableHttpParserjava208&lt;/em&gt;_at_orgmortbayje&lt;/p&gt;

&lt;p&gt;Current_state_is_not_among_the_states_START_ELEMENT_&lt;em&gt;ATTRIBUTEvalid_for_getAttributeCount&lt;/em&gt;&lt;em&gt;javalangIllegalStateException_Current_state_is_not_among_the_states_START_ELEMENT&lt;/em&gt;&lt;em&gt;ATTRIBUTEvalid_for_getAttributeCount&lt;/em&gt;&lt;em&gt;at_comsunorgapachexercesinternalimplXMLStreamReaderImplgetAttributeCountXMLStreamReaderImpljava598&lt;/em&gt;&lt;em&gt;at_orgapachesolrhandlerXmlUpdateRequestHandlerreadDocXmlUpdateRequestHandlerjava335&lt;/em&gt;&lt;em&gt;at_orgapachesolrhandlerXmlUpdateRequestHandlerprocessUpdateXmlUpdateRequestHandlerjava181&lt;/em&gt;&lt;em&gt;at_orgapachesolrhandlerXmlUpdateRequestHandlerhandleRequestBodyXmlUpdateRequestHandlerjava109&lt;/em&gt;&lt;em&gt;at_orgapachesolrhandlerRequestHandlerBasehandleRequestRequestHandlerBasejava78&lt;/em&gt;&lt;em&gt;at_orgapachesolrcoreSolrCoreexecuteSolrCorejava804&lt;/em&gt;&lt;em&gt;at_orgapachesolrservletSolrDispatchFilterexecuteSolrDispatchFilterjava193&lt;/em&gt;&lt;em&gt;at_orgapachesolrservletSolrDispatchFilterdoFilterSolrDispatchFilterjava161&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyservletServletHandler$CachedChaindoFilterServletHandlerjava1089&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyservletServletHandlerhandleServletHandlerjava365&lt;/em&gt;&lt;em&gt;at_orgmortbayjettysecuritySecurityHandlerhandleSecurityHandlerjava216&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyservletSessionHandlerhandleSessionHandlerjava181&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyhandlerContextHandlerhandleContextHandlerjava712&lt;/em&gt;&lt;em&gt;at_orgmortbayjettywebappWebAppContexthandleWebAppContextjava405&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyhandlerContextHandlerCollectionhandleContextHandlerCollectionjava211&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyhandlerHandlerCollectionhandleHandlerCollectionjava114&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyhandlerHandlerWrapperhandleHandlerWrapperjava139&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyServerhandleServerjava285&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyHttpConnectionhandleRequestHttpConnectionjava502&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyHttpConnection$RequestHandlercontentHttpConnectionjava835&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyHttpParserparseNextHttpParserjava641&lt;/em&gt;&lt;em&gt;at_orgmortbayjettyHttpParserparseAvailableHttpParserjava208&lt;/em&gt;_at_orgmortbayje&lt;/p&gt;

&lt;p&gt;request: &lt;a href=&quot;http://localhost:8983/solr/update?wt=xml&amp;amp;version=2.2&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://localhost:8983/solr/update?wt=xml&amp;amp;version=2.2&lt;/a&gt;&lt;br/&gt;
	at org.junit.Assert.fail(Assert.java:71)&lt;br/&gt;
	at org.apache.solr.client.solrj.embedded.TestJettyLargeVolume$DocThread.run(TestJettyLargeVolume.java:92)&lt;/p&gt;</description>
                <environment>&lt;p&gt;test fails on both pc + mac, tomcat + jetty all java 1.6&lt;/p&gt;</environment>
        <key id="12378653">SOLR-360</key>
            <summary>Multithread update client causes exceptions and dropped documents</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ryantxu">Ryan McKinley</assignee>
                                    <reporter username="willjohnson3">Will Johnson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Sep 2007 16:11:47 +0100</created>
                <updated>Fri, 10 May 2013 11:40:41 +0100</updated>
                            <resolved>Wed, 19 Sep 2007 21:03:40 +0100</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.3</fixVersion>
                                    <component>update</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12528783" author="willjohnson3" created="Wed, 19 Sep 2007 16:13:58 +0100"  >&lt;p&gt;i&apos;ll work on the patch to make it  cleaner and run with the build process but i wanted to get this up as soon as possible.  if you drop it into /client/java/solrj/test/org/apache/solr/client/solrj/embedded it compiles/runs with eclipse.&lt;/p&gt;</comment>
                            <comment id="12528803" author="yseeley@gmail.com" created="Wed, 19 Sep 2007 16:58:27 +0100"  >&lt;p&gt;Grrr... embedded.&lt;br/&gt;
Does it happen with a standalone server also?&lt;/p&gt;</comment>
                            <comment id="12528804" author="yseeley@gmail.com" created="Wed, 19 Sep 2007 17:00:18 +0100"  >&lt;p&gt;I hacked up a quick python script to try and reproduce this (attaching).... no dice (script works fine).&lt;/p&gt;</comment>
                            <comment id="12528805" author="ryantxu" created="Wed, 19 Sep 2007 17:11:51 +0100"  >&lt;p&gt;This isn&apos;t an embedded problem...  it happens through solrj+jetty&lt;/p&gt;

&lt;p&gt;Right now I&apos;m trying to make it happen on the embedded side to see if I can limit it.  It may be a threading problem with the xml parsing in solrj if things work fine with a python client.&lt;/p&gt;</comment>
                            <comment id="12528843" author="ryantxu" created="Wed, 19 Sep 2007 19:00:15 +0100"  >&lt;p&gt;This appears to be a problem with &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-133&quot; title=&quot;change XmlUpdateRequestHandler to use StAX instead of XPP&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-133&quot;&gt;&lt;del&gt;SOLR-133&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Apparently the XMLInputFactory is not thread safe - it was sharing the same inputFactory for every request.&lt;/p&gt;

&lt;p&gt;Creating a new XMLInputFactory for each requests fixes the problem.&lt;/p&gt;

&lt;p&gt;--------------------------------------&lt;/p&gt;

&lt;p&gt;I looked into the XmlUpdateRequestHandler because this was the errors from (the soon to attach) test:&lt;/p&gt;


&lt;p&gt;The root error running this 5 times with jetty.&lt;br/&gt;
-----------------------------------------------&lt;/p&gt;

&lt;p&gt;SEVERE: java.lang.IllegalStateException: Current state is not among the states START_ELEMENT , ATTRIBUTEvalid for getAttributeCount()&lt;br/&gt;
	at com.sun.org.apache.xerces.internal.impl.XMLStreamReaderImpl.getAttributeCount(XMLStreamReaderImpl.java:661)&lt;/p&gt;

&lt;p&gt;SEVERE: java.lang.ArrayIndexOutOfBoundsException: -1&lt;br/&gt;
	at com.sun.org.apache.xerces.internal.util.NamespaceSupport.getURI(NamespaceSupport.java:237)&lt;/p&gt;

&lt;p&gt;SEVERE: java.lang.NullPointerException&lt;br/&gt;
	at com.sun.org.apache.xerces.internal.impl.XMLEntityScanner.peekChar(XMLEntityScanner.java:485)&lt;/p&gt;

&lt;p&gt;SEVERE: javax.xml.stream.XMLStreamException: ParseError at &lt;span class=&quot;error&quot;&gt;&amp;#91;row,col&amp;#93;&lt;/span&gt;:&lt;span class=&quot;error&quot;&gt;&amp;#91;1,1212&amp;#93;&lt;/span&gt;&lt;br/&gt;
Message: The element type &quot;doc&quot; must be terminated by the matching end-tag &quot;&amp;lt;/doc&amp;gt;&quot;.&lt;br/&gt;
	at com.sun.org.apache.xerces.internal.impl.XMLStreamReaderImpl.next(XMLStreamReaderImpl.java:588)&lt;/p&gt;

&lt;p&gt;Sep 19, 2007 1:39:38 PM org.apache.solr.common.SolrException log&lt;br/&gt;
SEVERE: java.lang.NullPointerException&lt;br/&gt;
	at com.sun.org.apache.xerces.internal.impl.XMLEntityScanner.arrangeCapacity(XMLEntityScanner.java:1598)&lt;/p&gt;


&lt;p&gt;The root error running this 5 times embedded.&lt;br/&gt;
-----------------------------------------------&lt;/p&gt;

&lt;p&gt;SEVERE: javax.xml.stream.XMLStreamException: ParseError at &lt;span class=&quot;error&quot;&gt;&amp;#91;row,col&amp;#93;&lt;/span&gt;:&lt;span class=&quot;error&quot;&gt;&amp;#91;-1,-1&amp;#93;&lt;/span&gt;&lt;br/&gt;
Message: doc started without an add command!&lt;br/&gt;
	at org.apache.solr.handler.XmlUpdateRequestHandler.processUpdate(XmlUpdateRequestHandler.java:182)&lt;/p&gt;

&lt;p&gt;SEVERE: java.lang.NullPointerException&lt;br/&gt;
	at com.sun.org.apache.xerces.internal.impl.XMLEntityScanner.peekChar(XMLEntityScanner.java:485)&lt;/p&gt;

&lt;p&gt;SEVERE: javax.xml.stream.XMLStreamException: ParseError at &lt;span class=&quot;error&quot;&gt;&amp;#91;row,col&amp;#93;&lt;/span&gt;:&lt;span class=&quot;error&quot;&gt;&amp;#91;1,182&amp;#93;&lt;/span&gt;&lt;br/&gt;
Message: doc started without an add command!&lt;br/&gt;
	at org.apache.solr.handler.XmlUpdateRequestHandler.processUpdate(XmlUpdateRequestHandler.java:182)&lt;/p&gt;

&lt;p&gt;org.apache.solr.client.solrj.SolrServerException: org.apache.solr.client.solrj.SolrServerException: javax.xml.stream.XMLStreamException: ParseError at &lt;span class=&quot;error&quot;&gt;&amp;#91;row,col&amp;#93;&lt;/span&gt;:&lt;span class=&quot;error&quot;&gt;&amp;#91;1,158&amp;#93;&lt;/span&gt;&lt;br/&gt;
Message: Attribute name &quot;llowDups&quot; associated with an element type &quot;add&quot; must be followed by the &apos; = &apos; character.&lt;/p&gt;

&lt;p&gt;SEVERE: javax.xml.stream.XMLStreamException: ParseError at &lt;span class=&quot;error&quot;&gt;&amp;#91;row,col&amp;#93;&lt;/span&gt;:&lt;span class=&quot;error&quot;&gt;&amp;#91;1,21855&amp;#93;&lt;/span&gt;&lt;br/&gt;
Message: XML document structures must start and end within the same entity.&lt;br/&gt;
	at com.sun.org.apache.xerces.internal.impl.XMLStreamReaderImpl.next(XMLStreamReaderImpl.java:588)&lt;/p&gt;
</comment>
                            <comment id="12528849" author="yseeley@gmail.com" created="Wed, 19 Sep 2007 19:22:13 +0100"  >&lt;p&gt;Blech. Too bad... factory creation looks pretty slow.&lt;br/&gt;
Apparently all the open-source stax parsers have thread-safe factories once configured.&lt;br/&gt;
(and factories normally should be thread safe in general.)&lt;/p&gt;

&lt;p&gt;Ryan: does the stax impl in 1.6 show this problem, or does this just show with the external stax jars we picked?&lt;/p&gt;</comment>
                            <comment id="12528850" author="ryantxu" created="Wed, 19 Sep 2007 19:28:24 +0100"  >&lt;p&gt;updated will&apos;s test to run as jetty or embedded&lt;/p&gt;</comment>
                            <comment id="12528861" author="ryantxu" created="Wed, 19 Sep 2007 19:53:08 +0100"  >&lt;p&gt;wow... so if I use the open source package:&lt;br/&gt;
FACTORY: com.bea.xml.stream.MXParserFactory@99681b&lt;/p&gt;

&lt;p&gt;no problem&lt;/p&gt;

&lt;p&gt;using the sun package (included in java6) :&lt;br/&gt;
FACTORY: com.sun.xml.internal.stream.XMLInputFactoryImpl@10a3b24&lt;/p&gt;

&lt;p&gt;then it gets threading errors!!&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;- - - -&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;m unable to get java6 to prefer using the bea parser &amp;#8211; I was only able to do that from java 5.&lt;/p&gt;

&lt;p&gt;So... i think we should revert  #577405 and somehow hardcode using the bea parser.  Other ideas?&lt;/p&gt;</comment>
                            <comment id="12528866" author="yseeley@gmail.com" created="Wed, 19 Sep 2007 20:00:05 +0100"  >&lt;p&gt;I&apos;ve done some scanning through the factory code, and I think I see the issue.&lt;br/&gt;
Ryan, could you try &lt;br/&gt;
factory.setProperty(&quot;reuse-instance&quot;, Boolean.FALSE);&lt;br/&gt;
when the factory is first created?&lt;/p&gt;</comment>
                            <comment id="12528875" author="ryantxu" created="Wed, 19 Sep 2007 20:44:07 +0100"  >&lt;p&gt;&quot;reuse-instance&quot; works for java 1.6 but crashes the 1.5 bea factory...&lt;/p&gt;

&lt;p&gt;solution:&lt;/p&gt;

&lt;p&gt;   inputFactory = BaseXMLInputFactory.newInstance();&lt;br/&gt;
    try &lt;/p&gt;
{
      inputFactory.setProperty(&quot;reuse-instance&quot;, Boolean.FALSE);
    }
&lt;p&gt;    catch( IllegalArgumentException ex ) &lt;/p&gt;
{
      // The java 1.5 com.bea.xml does not support this property, but behaves properly in a
      // multi-threaded environment.  Ignore the error for 1.5
      log.info( &quot;Unable to set the &apos;reuse-instance&apos; property for the input factory: &quot;+inputFactory );
    }


&lt;p&gt;commited in rev 577421&lt;/p&gt;

&lt;p&gt;thanks yonik&lt;/p&gt;</comment>
                            <comment id="12528879" author="ryantxu" created="Wed, 19 Sep 2007 21:03:40 +0100"  >&lt;p&gt;This now works for 1.5 &amp;amp; 1.6&lt;/p&gt;

&lt;p&gt;Will - thanks for pointing this out and submitting a test!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12366224" name="SOLR-360-LargeVolumeUpdateTests.patch" size="9823" author="ryantxu" created="Wed, 19 Sep 2007 19:28:24 +0100"/>
                            <attachment id="12366221" name="SOLR-360-UpdateThreadError.patch" size="1601" author="ryantxu" created="Wed, 19 Sep 2007 19:00:09 +0100"/>
                            <attachment id="12366191" name="TestJettyLargeVolume.java" size="2902" author="willjohnson3" created="Wed, 19 Sep 2007 16:13:58 +0100"/>
                            <attachment id="12366210" name="testsolr.py" size="899" author="yseeley@gmail.com" created="Wed, 19 Sep 2007 17:00:03 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 19 Sep 2007 15:58:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7234</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxrt3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20824</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>