<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:23:37 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-352/SOLR-352.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-352] UpdateRequest is duplicating commit and optimize requests</title>
                <link>https://issues.apache.org/jira/browse/SOLR-352</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;UpdateRequest current sets both query args and a update XML message in the POST body.  This causes Solr to do two commit/optimize for each commit/optimize request sent in by SolrJ.  I will be attaching a patch to remove the commit/optimize query args.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12377902">SOLR-352</key>
            <summary>UpdateRequest is duplicating commit and optimize requests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="billa">Bill Au</assignee>
                                    <reporter username="billa">Bill Au</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Sep 2007 18:28:15 +0100</created>
                <updated>Fri, 10 May 2013 11:40:33 +0100</updated>
                            <resolved>Tue, 11 Sep 2007 15:19:54 +0100</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.3</fixVersion>
                                    <component>clients - java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12526197" author="billa" created="Mon, 10 Sep 2007 18:30:57 +0100"  >&lt;p&gt;Patch to remove commit/optimize query args since the request already contain an commit/optimize XML message in the POST body.&lt;/p&gt;</comment>
                            <comment id="12526208" author="ryantxu" created="Mon, 10 Sep 2007 19:04:19 +0100"  >&lt;p&gt;Dooh, thanks Bill&lt;/p&gt;

&lt;p&gt;This patch is slightly different.  Rather then getting rid of the parameters for commit or optimize, it always uses the parameter version and does not send xml.&lt;/p&gt;

&lt;p&gt;This way we can continue to support calling &amp;lt;commit&amp;gt; immediatly after &amp;lt;add&amp;gt; (without sending a second request)&lt;/p&gt;

&lt;p&gt;ryan&lt;/p&gt;</comment>
                            <comment id="12526213" author="billa" created="Mon, 10 Sep 2007 19:35:16 +0100"  >&lt;p&gt;Ryan, I am gettign a NullPointerException when I tried you patch:&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
	at org.apache.solr.common.util.ContentStreamBase$StringStream.&amp;lt;init&amp;gt;(ContentStreamBase.java:137)&lt;br/&gt;
	at org.apache.solr.client.solrj.util.ClientUtils.toContentStreams(ClientUtils.java:59)&lt;br/&gt;
	at org.apache.solr.client.solrj.request.UpdateRequest.getContentStreams(UpdateRequest.java:134)&lt;br/&gt;
	at org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:113)&lt;br/&gt;
	at org.apache.solr.client.solrj.request.UpdateRequest.process(UpdateRequest.java:199)&lt;br/&gt;
	at org.apache.solr.client.solrj.impl.BaseSolrServer.commit(BaseSolrServer.java:79)&lt;br/&gt;
	at org.apache.solr.client.solrj.impl.BaseSolrServer.commit(BaseSolrServer.java:68)&lt;br/&gt;
	at &lt;em&gt;jsp._solrjCommit&lt;/em&gt;_jsp._jspService(solrjCommit.jsp:12)&lt;br/&gt;
	at com.caucho.jsp.JavaPage.service(JavaPage.java:60)&lt;br/&gt;
	at com.caucho.jsp.Page.pageservice(Page.java:570)&lt;br/&gt;
	at com.caucho.server.dispatch.PageFilterChain.doFilter(PageFilterChain.java:179)&lt;br/&gt;
	at com.caucho.server.cache.CacheFilterChain.doFilter(CacheFilterChain.java:209)&lt;br/&gt;
	at com.caucho.server.webapp.WebAppFilterChain.doFilter(WebAppFilterChain.java:173)&lt;br/&gt;
	at com.caucho.server.dispatch.ServletInvocation.service(ServletInvocation.java:229)&lt;br/&gt;
	at com.caucho.server.http.HttpRequest.handleRequest(HttpRequest.java:274)&lt;br/&gt;
	at com.caucho.server.port.TcpConnection.run(TcpConnection.java:511)&lt;br/&gt;
	at com.caucho.util.ThreadPool.runTasks(ThreadPool.java:520)&lt;br/&gt;
	at com.caucho.util.ThreadPool.run(ThreadPool.java:442)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:595)&lt;/p&gt;</comment>
                            <comment id="12526224" author="ryantxu" created="Mon, 10 Sep 2007 20:03:58 +0100"  >&lt;p&gt;did you apply the whole patch?&lt;/p&gt;

&lt;p&gt;It includes a null check at line 59 of ClientUtils.java.&lt;/p&gt;


&lt;p&gt;//--------------------------------------------------------------------------&lt;br/&gt;
Index: client/java/solrj/src/org/apache/solr/client/solrj/util/ClientUtils.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; client/java/solrj/src/org/apache/solr/client/solrj/util/ClientUtils.java    (revision 574315)&lt;br/&gt;
+++ client/java/solrj/src/org/apache/solr/client/solrj/util/ClientUtils.java    (working copy)&lt;br/&gt;
@@ -56,9 +56,12 @@&lt;br/&gt;
    */&lt;br/&gt;
   public static Collection&amp;lt;ContentStream&amp;gt; toContentStreams( final String str, final String contentType )&lt;/p&gt;
   {
+    if( str == null )
+      return null;
+
+    ArrayList&amp;lt;ContentStream&amp;gt; streams = new ArrayList&amp;lt;ContentStream&amp;gt;( 1 );
     ContentStreamBase ccc = new ContentStreamBase.StringStream( str );
     ccc.setContentType( contentType );
-    ArrayList&amp;lt;ContentStream&amp;gt; streams = new ArrayList&amp;lt;ContentStream&amp;gt;();
     streams.add( ccc );
     return streams;
   } </comment>
                            <comment id="12526228" author="billa" created="Mon, 10 Sep 2007 20:18:02 +0100"  >&lt;p&gt;My bad.  Somehow I didn&apos;t pick up the patch to ClientUtils.java.  After taking care of that, both commit and optimize works as expected and only once.  I will commit the latest patch tomorrow morning (so that other folks will have a chance to review/comment).&lt;/p&gt;</comment>
                            <comment id="12526271" author="billa" created="Mon, 10 Sep 2007 22:23:38 +0100"  >&lt;p&gt;Ryan, how does one call &amp;lt;commit&amp;gt; immediately after &amp;lt;add&amp;gt; with a single request?&lt;/p&gt;</comment>
                            <comment id="12526283" author="ryantxu" created="Mon, 10 Sep 2007 23:15:07 +0100"  >&lt;p&gt;I just added some docs to:&lt;br/&gt;
  &lt;a href=&quot;http://wiki.apache.org/solr/Solrj&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/solr/Solrj&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Essentially, you can work with the UpdateRequest directly and use options that are not available in the  SolrServer interface.&lt;/p&gt;

&lt;p&gt;  SolrServer server = ...&lt;/p&gt;

&lt;p&gt;  UpdateRequest req = new UpdateRequest(); &lt;br/&gt;
  req.setAction( UpdateRequest.ACTION.COMMIT, false, false );&lt;br/&gt;
  req.add( docs );&lt;br/&gt;
  UpdateResponse rsp = req.process( server );&lt;/p&gt;

</comment>
                            <comment id="12526284" author="ryantxu" created="Mon, 10 Sep 2007 23:17:57 +0100"  >&lt;p&gt;Note, in solr, this is starting the commit with a request parameter, not &amp;lt;commit/&amp;gt;&lt;/p&gt;

&lt;p&gt; /update?commit=true with post data: &lt;br/&gt;
 &amp;lt;add&amp;gt;&lt;br/&gt;
   ...&lt;br/&gt;
 &amp;lt;/add&amp;gt;&lt;/p&gt;</comment>
                            <comment id="12526463" author="billa" created="Tue, 11 Sep 2007 15:14:27 +0100"  >&lt;p&gt;Thanks Ryan.  I got it to work but I have to add&lt;/p&gt;

&lt;p&gt;req.setOverwrite(true);&lt;/p&gt;

&lt;p&gt;Otherwise, a got an exception from Solr:&lt;/p&gt;

&lt;p&gt;org.apache.solr.common.SolrException: unsupported param combo:add:,allowDups=false,overwritePending=false,overwriteCommitted=false&lt;/p&gt;

&lt;p&gt;unsupported param combo:add:,allowDups=false,overwritePending=false,overwriteCommitted=false&lt;/p&gt;

&lt;p&gt;request: &lt;a href=&quot;http://cn-ewr1-dev40-pi2.cnet.com:7905/solr/update?commit=true&amp;amp;waitFlush=false&amp;amp;waitSearcher=false&amp;amp;wt=xml&amp;amp;version=2.2&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://cn-ewr1-dev40-pi2.cnet.com:7905/solr/update?commit=true&amp;amp;waitFlush=false&amp;amp;waitSearcher=false&amp;amp;wt=xml&amp;amp;version=2.2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So it looks like the combination of default values of allowDups, overwriteCommitted, and overwritePending (all false) in UpdateRequest is not supported by Solr.  Should we change the default to something that is supported (setting overwirte to true)?  I can open a separate bug and take care of that.&lt;/p&gt;</comment>
                            <comment id="12526466" author="billa" created="Tue, 11 Sep 2007 15:19:54 +0100"  >&lt;p&gt;Patch commited (Committed revision 574608).&lt;/p&gt;</comment>
                            <comment id="12526469" author="ryantxu" created="Tue, 11 Sep 2007 15:35:53 +0100"  >&lt;p&gt;yes, lets make the default overwrite=true&lt;/p&gt;

&lt;p&gt;I removed the overwritePending/overwriteCommited options so that adding &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-60&quot; title=&quot;Remove overwritePending, overwriteCommitted flags?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-60&quot;&gt;&lt;del&gt;SOLR-60&lt;/del&gt;&lt;/a&gt; is a non issue for solrj.&lt;/p&gt;

&lt;p&gt;Can you open a new issue?&lt;/p&gt;</comment>
                            <comment id="12526497" author="billa" created="Tue, 11 Sep 2007 16:35:31 +0100"  >&lt;p&gt;I have opened &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-353&quot; title=&quot;default values of UpdateRequest not supported by Solr&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-353&quot;&gt;&lt;del&gt;SOLR-353&lt;/del&gt;&lt;/a&gt; for setting default overwrite=true in UpdateRequest.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12365491" name="solr-352.patch" size="2110" author="ryantxu" created="Mon, 10 Sep 2007 19:04:19 +0100"/>
                            <attachment id="12365489" name="solr-352.patch" size="973" author="billa" created="Mon, 10 Sep 2007 18:30:57 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 10 Sep 2007 18:04:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7241</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxruv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20832</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>