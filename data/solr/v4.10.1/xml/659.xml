<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:19:41 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-659/SOLR-659.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-659] Explicitly set start and rows per shard for more efficient bulk queries across distributed Solr</title>
                <link>https://issues.apache.org/jira/browse/SOLR-659</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The default behavior of setting start and rows on distributed solr (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-303&quot; title=&quot;Distributed Search over HTTP&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-303&quot;&gt;&lt;del&gt;SOLR-303&lt;/del&gt;&lt;/a&gt;) is to set start at 0 across all shards and set rows to start+rows across each shard. This ensures all results are returned for any arbitrary start and rows setting, but during &quot;bulk queries&quot; (where start is incrementally increased and rows is kept consistent) the client would need finer control of the per-shard start and rows parameter as retrieving many thousands of documents becomes intractable as start grows higher.&lt;/p&gt;

&lt;p&gt;Attaching a patch that creates a &amp;amp;shards.start and &amp;amp;shards.rows parameter. If used, the logic that sets rows to start+rows per shard is overridden and each shard gets the exact start and rows set in shards.start and shards.rows. The client will receive up to shards.rows * nShards results and should set rows accordingly. This makes bulk queries across distributed solr possible.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12401013">SOLR-659</key>
            <summary>Explicitly set start and rows per shard for more efficient bulk queries across distributed Solr</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="bwhitman">Brian Whitman</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Jul 2008 15:06:52 +0100</created>
                <updated>Tue, 10 Nov 2009 15:51:43 +0000</updated>
                            <resolved>Mon, 7 Sep 2009 19:30:11 +0100</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.4</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                            <comments>
                            <comment id="12616897" author="bwhitman" created="Fri, 25 Jul 2008 15:07:20 +0100"  >&lt;p&gt;Attaching patch.&lt;/p&gt;</comment>
                            <comment id="12616903" author="bwhitman" created="Fri, 25 Jul 2008 15:17:24 +0100"  >&lt;p&gt;An example of a bulk query using this patch. Without this patch such bulk queries will eventually time out or cause exceptions in the server as too much data is passed back and forth.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; SolrDocumentList blockQuery(SolrQuery q, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; blockSize, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; maxResults) {
    SolrDocumentList allResults = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrDocumentList();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(blockSize &amp;gt; maxResults) { blockSize = maxResults;  }
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=0; i&amp;lt;maxResults; i=i+blockSize) {
      &lt;span class=&quot;code-comment&quot;&gt;// Sets rows of &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; query to the most results that could ever come back - the blockSize * the number of shards
&lt;/span&gt;      q.setRows(blockSize * getNumberOfHosts());
      &lt;span class=&quot;code-comment&quot;&gt;// Don&apos;t set a start on the main query
&lt;/span&gt;      q.setStart(0);
      &lt;span class=&quot;code-comment&quot;&gt;// But &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; set start and rows on the individual shards. 
&lt;/span&gt;      q.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;shards.start&quot;&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(i));
      q.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;shards.rows&quot;&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(blockSize));
      &lt;span class=&quot;code-comment&quot;&gt;// Perform the query.
&lt;/span&gt;      QueryResponse sub = query(q);
      &lt;span class=&quot;code-comment&quot;&gt;// For each returned document (up to blockSize*numberOfHosts() of them), append them to the main result
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(SolrDocument s : sub.getResults()) {
        allResults.add(s);
        &lt;span class=&quot;code-comment&quot;&gt;// Break &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we&apos;ve reached our requested limit
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(allResults.size() &amp;gt; maxResults) { &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;; }
      }
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(allResults.size() &amp;gt; maxResults) { &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;; }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; allResults;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12618785" author="klaasm" created="Thu, 31 Jul 2008 19:09:37 +0100"  >&lt;p&gt;IMO it is too late in the release process for new features.&lt;/p&gt;</comment>
                            <comment id="12629176" author="otis" created="Mon, 8 Sep 2008 15:49:28 +0100"  >&lt;p&gt;This looks simple enough.  I haven&apos;t tried it.  Brian, do you have a unit test you could attach?&lt;/p&gt;

&lt;p&gt;Or would it make more sense to have a custom QueryComponent for something like this? (I don&apos;t know yet)&lt;/p&gt;</comment>
                            <comment id="12671655" author="bwhitman" created="Sun, 8 Feb 2009 17:53:03 +0000"  >&lt;p&gt;New patch syncs w/ trunk&lt;/p&gt;</comment>
                            <comment id="12683803" author="shalinmangar" created="Fri, 20 Mar 2009 09:02:13 +0000"  >&lt;p&gt;If I understand this correctly, it makes bulk queries cheaper at the expense of less precise scoring. But if I&apos;m paging through some results and you modify the shard.start and shard.rows then I&apos;ll get inconsistent results. Is that correct?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The client will receive up to shards.rows * nShards results and should set rows accordingly. This makes bulk queries across distributed solr possible.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I do not understand that. Why will the client get more than rows? Or by client, did you mean the solr server to which the initial request is sent?&lt;/p&gt;</comment>
                            <comment id="12748986" author="yseeley@gmail.com" created="Fri, 28 Aug 2009 22:27:59 +0100"  >&lt;p&gt;I agree this makes sense to enable efficient bulk operations, and also fits in with a past idea I had about mapping shards.param=foo to param=foo during a sub-request.&lt;/p&gt;

&lt;p&gt;I&apos;ll give it a couple of days and commit if there are no objections.&lt;/p&gt;</comment>
                            <comment id="12752235" author="yseeley@gmail.com" created="Mon, 7 Sep 2009 19:30:11 +0100"  >&lt;p&gt;Thanks Brian, I just committed this.&lt;/p&gt;</comment>
                            <comment id="12769114" author="johnsoncr" created="Fri, 23 Oct 2009 08:00:22 +0100"  >&lt;p&gt;This is really helpful to bulk  queries ,but how to handle the pagination of query results.&lt;br/&gt;
e.g.at the first query,I set  shards.start to 0 and set shards.rows to 30,it  may return 50 documents,and i get 30 documents to show ,the other 20 documents is discarded ;then how to get the next 30 documents ?&lt;/p&gt;</comment>
                            <comment id="12775519" author="gsingers" created="Tue, 10 Nov 2009 15:51:43 +0000"  >&lt;p&gt;Bulk close for Solr 1.4&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12399776" name="SOLR-659.patch" size="3319" author="bwhitman" created="Sun, 8 Feb 2009 17:53:03 +0000"/>
                            <attachment id="12386884" name="shards.start_rows.patch" size="3290" author="bwhitman" created="Fri, 25 Jul 2008 15:07:20 +0100"/>
                    </attachments>
                <subtasks>
                            <subtask id="12439140">SOLR-1524</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 31 Jul 2008 18:09:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6955</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxpzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20530</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>