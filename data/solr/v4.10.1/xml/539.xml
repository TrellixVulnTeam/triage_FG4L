<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:24:44 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-539/SOLR-539.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-539] Statistics variable atomicity in RequestHandlerBase</title>
                <link>https://issues.apache.org/jira/browse/SOLR-539</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Writes are not atomic on longs unless they are volatile.   At a minimum, numRequests, numErrors, and totalTime should be marked volatile.  More correct, but higher overhead due to contention and synchronization would be to use AtomicLong.&lt;/p&gt;

&lt;p&gt;There is a minor error in the calculation of avgRequestsPerSecond.  The first operand of the denominator is cast to a float then has a long subtracted from it, in effect casting both longs to floats then performing the subtraction.  It is better to do the subtraction as longs then cast to a float.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12393953">SOLR-539</key>
            <summary>Statistics variable atomicity in RequestHandlerBase</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="otis">Otis Gospodnetic</assignee>
                                    <reporter username="timmsc">Sean Timm</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Apr 2008 04:16:42 +0100</created>
                <updated>Fri, 10 May 2013 11:39:38 +0100</updated>
                            <resolved>Thu, 22 May 2008 03:13:29 +0100</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.3</fixVersion>
                                    <component>highlighter</component>
                    <component>search</component>
                    <component>spellchecker</component>
                    <component>update</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12588885" author="timmsc" created="Tue, 15 Apr 2008 04:18:41 +0100"  >&lt;p&gt;This patch marks numRequests, numErrors, and totalTime volatile.  It also changes the casting in the calculation of avgRequestsPerSecond.&lt;/p&gt;</comment>
                            <comment id="12588886" author="timmsc" created="Tue, 15 Apr 2008 04:19:25 +0100"  >&lt;p&gt;This patch changes numRequests, numErrors, and totalTime to AtomicLongs.  It also changes the casting in the calculation of avgRequestsPerSecond.&lt;/p&gt;</comment>
                            <comment id="12589111" author="timmsc" created="Tue, 15 Apr 2008 15:58:44 +0100"  >&lt;p&gt;I don&apos;t know that I explained the problem with the calculation of avgRequestsPerSecond well.  Here is a code snippet that illustrates the problem:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class CastingTest {
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; args[]) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception{
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; t1 = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; t2 = t1 + 7456L;
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Cast then subtract: &quot;&lt;/span&gt; + ((&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)t2 - t1));
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Subtract then &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;: &quot;&lt;/span&gt; + (&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)(t2 - t1));
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;% java CastingTest
Cast then subtract: 0.0
Subtract then cast: 7456.0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, at least shortly after start up, the way the casting is currently done results in a divide by zero.&lt;/p&gt;
</comment>
                            <comment id="12591506" author="timmsc" created="Wed, 23 Apr 2008 02:27:15 +0100"  >&lt;p&gt;Here is an illustration of the divide by zero bug.  Notice the value of avgRequestsPerSecond.  This is two minutes after server start.&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
stats: 	requests : 4255
        errors : 0
        avgTimePerRequest : 196.68672
        avgRequestsPerSecond : Infinity
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12598888" author="otis" created="Thu, 22 May 2008 03:13:29 +0100"  >&lt;p&gt;Merci.  I applied the volatile variation.&lt;/p&gt;

&lt;p&gt;Committed revision 658977.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12380135" name="RequestHandlerBase-AtomicLong-stats.patch" size="2429" author="timmsc" created="Tue, 15 Apr 2008 04:19:25 +0100"/>
                            <attachment id="12380134" name="RequestHandlerBase-volatile-stats.patch" size="1286" author="timmsc" created="Tue, 15 Apr 2008 04:18:41 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 22 May 2008 02:13:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7067</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxqpz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20648</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>