<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:26:47 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-795/SOLR-795.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-795] spellcheck: buildOnOptimize</title>
                <link>https://issues.apache.org/jira/browse/SOLR-795</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I see that there&apos;s an option to automatically rebuild the spelling index on a commit.  That&apos;s a nice feature that we&apos;ll consider using, but we run commits every few thousand document updates, which would yield ~100 spelling index rebuilds a day.  OTOH, we run an optimize about once/day which seems like a more appropriate schedule for rebuilding the spelling index.&lt;/p&gt;

&lt;p&gt;Is there or could there be an option to rebuild the spelling index on optimize?&lt;/p&gt;

&lt;p&gt;Grant:&lt;br/&gt;
Seems reasonable, could almost do it via the postOptimize call back already in the config, except the SpellCheckComponent&apos;s EvenListener is private static and has an empty postCommit implementation (which is what is called after optimization, since it is just like a commit in many ways)&lt;/p&gt;

&lt;p&gt;Thus, a patch would be needed.&lt;/p&gt;

&lt;p&gt;Shalin:&lt;br/&gt;
postCommit/postOptimize callbacks happen after commit/optimize but before a&lt;br/&gt;
new searcher is opened. Therefore, it is not possible to re-build spellcheck&lt;br/&gt;
index on those events without opening a IndexReader directly on the solr&lt;br/&gt;
index. That is why the event listener in SpellCheckComponent uses the&lt;br/&gt;
newSearcher listener to build on commits.&lt;/p&gt;

&lt;p&gt;I don&apos;t think there is anything in the API currently to do what Jason wants.&lt;/p&gt;

&lt;p&gt;Hoss:&lt;br/&gt;
FWIW: I believe it has to work that way because postCommit events might&lt;br/&gt;
modify the index. (but i&apos;m just guessing)&lt;/p&gt;

&lt;p&gt;couldn&apos;t the Listener&apos;s newSearcher() method just do something like&lt;br/&gt;
this...&lt;/p&gt;

&lt;p&gt;if (rebuildOnlyAfterOptimize &amp;amp;&amp;amp;&lt;br/&gt;
   ! (newSearcher.getReader().isOptimized() &amp;amp;&amp;amp;&lt;br/&gt;
      ! oldSearcher.getReader().isOptimized()) {&lt;br/&gt;
 return;&lt;br/&gt;
} else {&lt;br/&gt;
 // current impl&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;...assuming a new &quot;rebuildOnlyAfterOptimize&quot; option was added?&lt;/p&gt;

&lt;p&gt;Grant:&lt;br/&gt;
That seems reasonable.&lt;/p&gt;

&lt;p&gt;Another thing to think about, is maybe it is useful to provide some event metadata to the events that contain information about what triggered them.  Something like a SolrEvent class such that postCommit looks like&lt;br/&gt;
postCommit(SolrEvent evt)&lt;/p&gt;

&lt;p&gt;and&lt;br/&gt;
public void newSearcher(SolrEvent evt, SolrIndexSearcher newSearcher, SolrIndexSearcher currentSearcher);&lt;/p&gt;

&lt;p&gt;Of course, since SolrEventListener is an interface...&lt;/p&gt;

&lt;p&gt;Shalin:&lt;br/&gt;
Yup, that will work.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12405456">SOLR-795</key>
            <summary>spellcheck: buildOnOptimize</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalinmangar">Shalin Shekhar Mangar</assignee>
                                    <reporter username="jrennie">Jason Rennie</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Sep 2008 13:25:47 +0100</created>
                <updated>Thu, 13 Aug 2009 15:16:46 +0100</updated>
                            <resolved>Tue, 28 Oct 2008 20:00:05 +0000</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.4</fixVersion>
                                    <component>spellchecker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <timeoriginalestimate seconds="7200">2h</timeoriginalestimate>
                            <timeestimate seconds="7200">2h</timeestimate>
                                        <comments>
                            <comment id="12641364" author="shalinmangar" created="Tue, 21 Oct 2008 13:01:55 +0100"  >&lt;p&gt;Marking for 1.4&lt;/p&gt;</comment>
                            <comment id="12642870" author="shalinmangar" created="Mon, 27 Oct 2008 07:53:45 +0000"  >&lt;p&gt;Attached patch to add this feature.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Changes&lt;/b&gt;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&quot;buildOnOptimize&quot; is added as a configuration&lt;/li&gt;
	&lt;li&gt;SpellCheckerListener uses the values of buildOnCommit and buildOnOptimize to decide when to build the index&lt;/li&gt;
	&lt;li&gt;To build index only on optimize, specify buildOnOptimize as true. No need to specify buildOnCommit.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I&apos;ll commit this in a day or two.&lt;/p&gt;</comment>
                            <comment id="12643323" author="shalinmangar" created="Tue, 28 Oct 2008 20:00:05 +0000"  >&lt;p&gt;Committed revision 708653.&lt;/p&gt;

&lt;p&gt;Thanks Jason!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12392855" name="SOLR-795.patch" size="4158" author="shalinmangar" created="Mon, 27 Oct 2008 07:53:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 21 Oct 2008 12:01:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6828</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxp5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20396</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>