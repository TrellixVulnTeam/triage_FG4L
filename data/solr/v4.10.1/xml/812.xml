<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:14:49 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-812/SOLR-812.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-812] JDBC optimizations: setReadOnly, setMaxRows</title>
                <link>https://issues.apache.org/jira/browse/SOLR-812</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I&apos;m looking at the DataImport code as of Solr v1.3 and using it with Postgres and very large data sets and there some improvement suggestions I have.&lt;/p&gt;

&lt;p&gt;1. call setReadOnly(true) on the connection.  DIH doesn&apos;t change the data so this is obvious.&lt;/p&gt;

&lt;p&gt;2. call setAutoCommit(false) on the connection.   (this is needed by Postgres to ensure that the fetchSize hint actually works)&lt;/p&gt;

&lt;p&gt;3. call setMaxRows(X) on the statement which is to be used when the dataimport.jsp debugger is only grabbing X rows.  fetchSize is just a hint and alone it isn&apos;t sufficient.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12406630">SOLR-812</key>
            <summary>JDBC optimizations: setReadOnly, setMaxRows</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalinmangar">Shalin Shekhar Mangar</assignee>
                                    <reporter username="dsmiley">David Smiley</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Oct 2008 20:40:49 +0100</created>
                <updated>Tue, 10 Nov 2009 15:51:49 +0000</updated>
                            <resolved>Sat, 13 Dec 2008 17:39:34 +0000</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.4</fixVersion>
                                    <component>contrib - DataImportHandler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12640463" author="noble.paul" created="Fri, 17 Oct 2008 09:05:20 +0100"  >&lt;blockquote&gt;&lt;p&gt;1. call setReadOnly(true) on the connection. DIH doesn&apos;t change the data so this is obvious.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. call setAutoCommit(false) on the connection. (this is needed by Postgres to ensure that the fetchSize hint actually works)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Actually JdbcDataSource does allow user to pass any query (even update or delete). So if we set it by default . Maybe we should add  attributes readOnly and autoCommit to JdbcDataSource . It is possible to make it on by default . I am just wondering if users are already using it to write also&lt;/p&gt;</comment>
                            <comment id="12648673" author="gnewton" created="Tue, 18 Nov 2008 17:51:34 +0000"  >&lt;p&gt;You might also think about setting &lt;br/&gt;
 setTransactionIsolation(Connection.TRANSACTION_READ_UNCOMMITTED) &lt;br/&gt;
   (see:  &lt;a href=&quot;http://media.datadirect.com/download/docs/ddxquery/allddxq/reference/wwhelp/wwhimpl/common/html/wwhelp.htm?context=Reference&amp;amp;file=grammarwrite7.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://media.datadirect.com/download/docs/ddxquery/allddxq/reference/wwhelp/wwhimpl/common/html/wwhelp.htm?context=Reference&amp;amp;file=grammarwrite7.html&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Only DB2 appears to support TRANSACTION_NONE&lt;/p&gt;

&lt;p&gt;&amp;#8211;&lt;/p&gt;

&lt;p&gt;While from the previous comment JdbcDataSource it appears not to exclusively be a &quot;source&quot;, you should still consider also setting:&lt;br/&gt;
 setHoldability(ResultSet.CLOSE_CURSORS_AT_COMMIT)&lt;/p&gt;

&lt;p&gt;It may reduce the driver resource usage.&lt;/p&gt;

&lt;p&gt;Certainly exposing these and the above in JdbcDataSource via properties would be more flexible to users. But sensible defaults should be set for read-only.&lt;/p&gt;</comment>
                            <comment id="12648685" author="gnewton" created="Tue, 18 Nov 2008 18:13:37 +0000"  >&lt;p&gt;This is a related issue, but since I just got involved with Solr yesterday and got a jira account today, I am reluctant to make a career-limiting error!  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;If it is indeed valid, perhaps someone else can make it a full-fledged separate issue!  &lt;/p&gt;

&lt;p&gt;Perusing: JdbcDataSource  @version $Id: JdbcDataSource.java 696539 2008-09-18 02:16:26Z ryan&lt;br/&gt;
Issue: MySQL fetchSize driver bug&lt;/p&gt;

&lt;p&gt;Both my experience and according to:  &lt;a href=&quot;http://benjchristensen.wordpress.com/2008/05/27/mysql-jdbc-memory-usage-on-large-resultset/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://benjchristensen.wordpress.com/2008/05/27/mysql-jdbc-memory-usage-on-large-resultset/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;MySQL does not handle properly any fetchSize &amp;gt; Integer.MIN_VALUE, and the entire ResultSet is transfered and loaded into memory, which for large ResultSets can result in an out of memory.&lt;/p&gt;

&lt;p&gt;In JdbcDataSource.java:&lt;br/&gt;
 175:  stmt.setFetchSize(batchSize);&lt;/p&gt;

&lt;p&gt;where &lt;br/&gt;
 57:  private int batchSize = FETCH_SIZE;&lt;/p&gt;

&lt;p&gt;and &lt;br/&gt;
 326:    private static final int FETCH_SIZE = 500;&lt;/p&gt;

&lt;p&gt;Is is, this code will invoke this bug for MySQL for large ResultSets. &lt;br/&gt;
Even for smaller ResultSets that do not cause an out of memory error, having all the ResultSet in memory will unnecessarily use up memory.&lt;/p&gt;

&lt;p&gt;The work around for this MySQL issue is:&lt;br/&gt;
  stmt.setFetchSize(Integer.MIN_VALUE);&lt;/p&gt;

&lt;p&gt;From the blog entry, see also:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;http://javaquirks.blogspot.com/2007/12/mysql-streaming-result-set.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://javaquirks.blogspot.com/2007/12/mysql-streaming-result-set.html&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://dev.mysql.com/doc/refman/5.0/en/connector-j-reference-implementation-notes.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dev.mysql.com/doc/refman/5.0/en/connector-j-reference-implementation-notes.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="12648724" author="shalinmangar" created="Tue, 18 Nov 2008 19:49:25 +0000"  >&lt;p&gt;Thanks for going through this Glen. This bug and a workaround is documented in the FAQ page.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://wiki.apache.org/solr/DataImportHandlerFaq&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/solr/DataImportHandlerFaq&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12655615" author="shalinmangar" created="Thu, 11 Dec 2008 11:58:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;Certainly exposing these and the above in JdbcDataSource via properties would be more flexible to users. But sensible defaults should be set for read-only.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Any extra attributes that you specify to the &amp;lt;dataSource&amp;gt; element are passed on to the DriverManager in a Properties object. So if your driver supports url parameters for these optimizations, you can use them right now. However, each driver has a different way of specifying this configuration, so we should support a way of making them configurable.&lt;/p&gt;

&lt;p&gt;I&apos;m not very comfortable with making changes to the default configuration for the sake of backwards-compatibility. But we should make these possible and document their usage.&lt;/p&gt;</comment>
                            <comment id="12655626" author="shalinmangar" created="Thu, 11 Dec 2008 12:35:36 +0000"  >&lt;p&gt;Changes&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Supports the following through configuration (extra attributes in &amp;lt;dataSource&amp;gt; element or solrconfig.xml):
	&lt;ol&gt;
		&lt;li&gt;readOnly&lt;/li&gt;
		&lt;li&gt;autoCommit&lt;/li&gt;
		&lt;li&gt;transactionIsolation&lt;/li&gt;
		&lt;li&gt;holdability&lt;/li&gt;
		&lt;li&gt;maxRows&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
	&lt;li&gt;If readOnly is specified the following are added by default (but they will be overridden if specified explicitly):
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
setAutoCommit(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
setTransactionIsolation(Connection.TRANSACTION_READ_UNCOMMITTED);
setHoldability(ResultSet.CLOSE_CURSORS_AT_COMMIT);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;If &apos;start&apos; and &apos;rows&apos; are specified as request parameters, then we call setMaxRows(start + rows) automatically overriding value specified in configuration&lt;/li&gt;
	&lt;li&gt;No changes are made unless configuration is specified, so it is backwards compatible.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I&apos;d like to commit this in a day or two. We also need to add this documentation to the wiki page.&lt;/p&gt;
</comment>
                            <comment id="12656309" author="shalinmangar" created="Sat, 13 Dec 2008 17:27:27 +0000"  >&lt;p&gt;Fixing a bug with the way maxRows is calculated. It was not being set if &apos;rows&apos; is specified but &apos;start&apos; is not.&lt;/p&gt;</comment>
                            <comment id="12656313" author="shalinmangar" created="Sat, 13 Dec 2008 17:39:34 +0000"  >&lt;p&gt;Committed revision 726241.&lt;/p&gt;

&lt;p&gt;Just to re-iterate, there are no changes in default configuration except that maxRows is set automatically if user specifies &apos;start&apos; and &apos;rows&apos; parameter. Read-only mode has to be enabled explictly and then sane defaults for auto-commit, isolation and holdability are added. We can add readOnly flag to our example configurations on the wiki.&lt;/p&gt;

&lt;p&gt;Thanks David and Glen!&lt;/p&gt;</comment>
                            <comment id="12675145" author="emtrane" created="Thu, 19 Feb 2009 21:50:56 +0000"  >&lt;p&gt;I&apos;m running postgres as well and I finally got rid of my memory issues with this data source configuration:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&amp;lt;dataSource type=&quot;JdbcDataSource&quot; driver=&quot;org.postgresql.Driver&quot; url=&quot;jdbc:postgresql://host/db&quot; user=&quot;user&quot; password=&quot;password&quot; readOnly=&quot;true&quot; autoCommit=&quot;false&quot;  transactionIsolation=&quot;TRANSACTION_READ_COMMITTED&quot;  holdability=&quot;CLOSE_CURSORS_AT_COMMIT&quot;/&amp;gt;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m using v8.3 of postgres server and JDBC driver.&lt;/p&gt;</comment>
                            <comment id="12675227" author="shalinmangar" created="Fri, 20 Feb 2009 03:47:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m running postgres as well and I finally got rid of my memory issues with this data source configuration: &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks for the information Martin. Can you please add this to the DataImportHandlerFaq wiki page?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://wiki.apache.org/solr/DataImportHandlerFaq&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/solr/DataImportHandlerFaq&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12775553" author="gsingers" created="Tue, 10 Nov 2009 15:51:49 +0000"  >&lt;p&gt;Bulk close for Solr 1.4&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12396009" name="SOLR-812.patch" size="7956" author="shalinmangar" created="Sat, 13 Dec 2008 17:27:27 +0000"/>
                            <attachment id="12395831" name="SOLR-812.patch" size="7942" author="shalinmangar" created="Thu, 11 Dec 2008 12:35:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 17 Oct 2008 08:05:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6812</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxp27:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20379</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>