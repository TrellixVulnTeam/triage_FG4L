<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:14:54 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-1798/SOLR-1798.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-1798] Memory leak in FastLRUCache</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1798</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Every time a commit happens two Stats instances &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.solr.common.util.ConcurrentLRUCache.Stats&amp;#93;&lt;/span&gt; are leaking.&lt;/p&gt;

&lt;p&gt;Following code &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.solr.search.FastLRUCache&amp;#93;&lt;/span&gt; to maintain cumulative cache statistics causing this Stats object leak. &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    cumulativeStats = (List&amp;lt;ConcurrentLRUCache.Stats&amp;gt;) persistence;
    cumulativeStats.add(cache.getStats());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Everytime a &lt;b&gt;commit&lt;/b&gt; happens a new cache object is getting created and its stats is added to the list which is not released at all.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12457638">SOLR-1798</key>
            <summary>Memory leak in FastLRUCache</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="lakshman">Laxman</reporter>
                        <labels>
                            <label>cache</label>
                            <label>commit</label>
                            <label>memory_leak</label>
                            <label>search</label>
                    </labels>
                <created>Sat, 27 Feb 2010 09:41:37 +0000</created>
                <updated>Thu, 8 Jul 2010 20:55:54 +0100</updated>
                            <resolved>Sat, 6 Mar 2010 22:49:40 +0000</resolved>
                                    <version>1.4</version>
                    <version>1.5</version>
                                    <fixVersion>1.4.1</fixVersion>
                    <fixVersion>1.5</fixVersion>
                    <fixVersion>3.1</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12839251" author="yseeley@gmail.com" created="Sat, 27 Feb 2010 13:51:27 +0000"  >&lt;p&gt;Thanks Laxman, that does look incorrect.&lt;/p&gt;

&lt;p&gt;Noble - do you remember why a List was used here?&lt;/p&gt;</comment>
                            <comment id="12839253" author="lakshman" created="Sat, 27 Feb 2010 14:37:26 +0000"  >&lt;p&gt;Thanks for quick reponse Yonik.&lt;/p&gt;

&lt;p&gt;Following is our analysis so far which may help us in resolving the issue.&lt;/p&gt;

&lt;p&gt;1) For every commit cache instances are getting created.&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.solr.search.SolrIndexSearcher&amp;#93;&lt;/span&gt;&lt;br/&gt;
2) For each cache config we are maintaining a list of Statistics for aggregation.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;One more observation&lt;/b&gt;&lt;br/&gt;
From the Solr stats page I see all the cache stats as 0 values. Following line of code from FastLRUCache.init looks incorrect.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    cache.setAlive(false);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Because of the above line, all the cache instances created from FastLRUCache are not maintaining any Stats info.&lt;br/&gt;
If this is correct, I dont understand why are we maintaining a list of stats containing zero values.&lt;/p&gt;

&lt;p&gt;Or did I miss something important here?&lt;/p&gt;</comment>
                            <comment id="12842314" author="yseeley@gmail.com" created="Sat, 6 Mar 2010 21:12:57 +0000"  >&lt;p&gt;I think the fix is as simple as this patch.&lt;br/&gt;
Verifying that it fixes it is slightly harder - I&apos;ll try breaking out the profiler.&lt;/p&gt;</comment>
                            <comment id="12842319" author="yseeley@gmail.com" created="Sat, 6 Mar 2010 21:45:49 +0000"  >&lt;p&gt;Hmmm, right - fixes the memory leak, but breaks cumulative stats.&lt;/p&gt;</comment>
                            <comment id="12842331" author="yseeley@gmail.com" created="Sat, 6 Mar 2010 22:45:33 +0000"  >&lt;p&gt;New patch that fixes the cumulative stats by adding in an entry in the list for cumulative stats and incrementing them for every cache that is closed.&lt;/p&gt;

&lt;p&gt;Longer term, we might want a hash set or something (if we start having per-segment caches) but more changes will be necessary then anyway.&lt;/p&gt;</comment>
                            <comment id="12842333" author="yseeley@gmail.com" created="Sat, 6 Mar 2010 22:49:40 +0000"  >&lt;p&gt;committed.&lt;/p&gt;</comment>
                            <comment id="12842380" author="noble.paul" created="Sun, 7 Mar 2010 09:34:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;do you remember why a List was used here?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It was used to collect the cumulative data. I guess the original LRU cache was doing it the same way. It was a wrong decision to make&lt;/p&gt;</comment>
                            <comment id="12872808" author="hossman" created="Fri, 28 May 2010 04:18:30 +0100"  >

&lt;p&gt;Correcting Fix Version based on CHANGES.txt, see this thread for more details...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/lucene-dev/201005.mbox/%3Calpine.DEB.1.10.1005251052040.24672@radix.cryptio.net%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/lucene-dev/201005.mbox/%3Calpine.DEB.1.10.1005251052040.24672@radix.cryptio.net%3E&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12873379" author="hossman" created="Sun, 30 May 2010 05:53:20 +0100"  >&lt;p&gt;Committed revision 949476.&lt;/p&gt;

&lt;p&gt;merging to branch-1.4 for 1.4.1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12438115" name="SOLR-1798.patch" size="4134" author="yseeley@gmail.com" created="Sat, 6 Mar 2010 22:45:33 +0000"/>
                            <attachment id="12438110" name="SOLR-1798.patch" size="391" author="yseeley@gmail.com" created="Sat, 6 Mar 2010 21:12:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 27 Feb 2010 13:51:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5666</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxj5b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19421</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>