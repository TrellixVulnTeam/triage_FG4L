<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:19:17 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-1229/SOLR-1229.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-1229] deletedPkQuery feature does not work when pk and uniqueKey field do not have the same value</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1229</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Problem doing a delta-import such that records marked as &quot;deleted&quot; in the database are removed from Solr using deletedPkQuery.&lt;/p&gt;

&lt;p&gt;Here&apos;s a config I&apos;m using against a mocked test database:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dataConfig&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dataSource driver=&lt;span class=&quot;code-quote&quot;&gt;&quot;com.mysql.jdbc.Driver&quot;&lt;/span&gt; url=&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:mysql://localhost/db&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;document name=&lt;span class=&quot;code-quote&quot;&gt;&quot;tests&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
   &amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;
           pk=&lt;span class=&quot;code-quote&quot;&gt;&quot;board_id&quot;&lt;/span&gt;
           transformer=&lt;span class=&quot;code-quote&quot;&gt;&quot;TemplateTransformer&quot;&lt;/span&gt;
           deletedPkQuery=&lt;span class=&quot;code-quote&quot;&gt;&quot;select board_id from boards where deleted = &apos;Y&apos;&quot;&lt;/span&gt;
           query=&lt;span class=&quot;code-quote&quot;&gt;&quot;select * from boards where deleted = &apos;N&apos;&quot;&lt;/span&gt;
           deltaImportQuery=&lt;span class=&quot;code-quote&quot;&gt;&quot;select * from boards where deleted = &apos;N&apos;&quot;&lt;/span&gt;
           deltaQuery=&lt;span class=&quot;code-quote&quot;&gt;&quot;select * from boards where deleted = &apos;N&apos;&quot;&lt;/span&gt;
           preImportDeleteQuery=&lt;span class=&quot;code-quote&quot;&gt;&quot;datasource:board&quot;&lt;/span&gt;&amp;gt;
     &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt; template=&lt;span class=&quot;code-quote&quot;&gt;&quot;board-${test.board_id}&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
     &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;datasource&quot;&lt;/span&gt; template=&lt;span class=&quot;code-quote&quot;&gt;&quot;board&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
     &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;title&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/entity&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/document&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dataConfig&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that the uniqueKey in Solr is the &quot;id&quot; field.  And its value is a template board-&amp;lt;PK&amp;gt;.&lt;/p&gt;

&lt;p&gt;I noticed the javadoc comments in DocBuilder#collectDelta it says &quot;Note: In our definition, unique key of Solr document is the primary key of the top level entity&quot;.  This of course isn&apos;t really an appropriate assumption.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12428253">SOLR-1229</key>
            <summary>deletedPkQuery feature does not work when pk and uniqueKey field do not have the same value</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ehatcher">Erik Hatcher</assignee>
                                    <reporter username="ehatcher">Erik Hatcher</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Jun 2009 14:54:28 +0100</created>
                <updated>Tue, 10 Nov 2009 15:52:08 +0000</updated>
                            <resolved>Tue, 25 Aug 2009 10:54:49 +0100</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.4</fixVersion>
                                    <component>contrib - DataImportHandler</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12721264" author="ehatcher" created="Thu, 18 Jun 2009 14:55:58 +0100"  >&lt;p&gt;Maybe the pk field returned from deletedPkQuery should be run through the transformation process on the uniqueKey (id in this case) field to get the actual value??&lt;/p&gt;</comment>
                            <comment id="12721349" author="noble.paul" created="Thu, 18 Jun 2009 18:15:58 +0100"  >&lt;p&gt;there is a huge problem w/ the current implementation.&lt;br/&gt;
The whole delta-import process is built like an after thought. I wish to revamp the whole design. so that all the rows returned, deletedPkQuery or deltaQuery etc should also go through the transformations&lt;/p&gt;</comment>
                            <comment id="12722128" author="ehatcher" created="Sat, 20 Jun 2009 04:04:36 +0100"  >&lt;p&gt;FYI - some prior discussion on solr-user too: &lt;a href=&quot;http://www.lucidimagination.com/search/document/b8ef8e2e9e1de005/pk_vs_uniquekey_with_dih_delta_import&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.lucidimagination.com/search/document/b8ef8e2e9e1de005/pk_vs_uniquekey_with_dih_delta_import&lt;/a&gt;, about trying &quot;select concat(&apos;board-&apos;,board_id)  &lt;br/&gt;
from boards where deleted = &apos;Y&apos;&quot;, to no avail.&lt;/p&gt;

</comment>
                            <comment id="12722150" author="noble.paul" created="Sat, 20 Jun 2009 09:24:27 +0100"  >&lt;p&gt;Erik plz let me know if this helps.&lt;/p&gt;
</comment>
                            <comment id="12722258" author="lancenorskog" created="Sat, 20 Jun 2009 21:05:42 +0100"  >&lt;p&gt;Someone with magic powers, please mark this as &quot;to be fixed in Solr 1.4&quot;.&lt;/p&gt;</comment>
                            <comment id="12722266" author="ehatcher" created="Sat, 20 Jun 2009 23:02:17 +0100"  >&lt;p&gt;Noble - that looks like the right thing to add for delta queries, but that didn&apos;t help with the deleted one.  I&apos;ve attached a patch that fixes things in my limited test.  &lt;/p&gt;

&lt;p&gt;We really need to add some unit tests for this - tricky business though.  Lance - do you have some unit tests to add that shows it broken and then fixed with this patch?&lt;/p&gt;</comment>
                            <comment id="12722333" author="noble.paul" created="Sun, 21 Jun 2009 11:20:39 +0100"  >&lt;p&gt;Erik, the fix is not right&lt;/p&gt;

&lt;p&gt;see this&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
key = map.get(dataImporter.getSchema().getUniqueKeyField().getName());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The name of the uniqueKey field in the scema and the one you have in the map does not have to be same. DIH really gives you an option for it to be different. The attribute &apos;pk&apos; is only used for this purpose. &lt;/p&gt;</comment>
                            <comment id="12722345" author="ehatcher" created="Sun, 21 Jun 2009 13:03:27 +0100"  >&lt;p&gt;Noble - they do have to be the same, and that is why applying the transformations as you patched is part of the right answer.  But in order to call writer.deleteDoc(key) in DocBuilder#deleteAll it must use the value of the uniqueKey field, not of the pk one.  That is the crux of the issue here.  In my case, in the example at the top of this issue, the pk field is board_id with a value of &quot;1&quot;, and the id field after applying transformations is &quot;board-1&quot;.  The delete-by-id to Solr must be done using value &quot;board-1&quot; and that is only obtained by looking up the uniqueKey field (id in this example) from the schema and pulling it from the map.&lt;/p&gt;

&lt;p&gt;The latest patch I supplied worked in my test case and I analyzed it through a debugger. &lt;/p&gt;</comment>
                            <comment id="12722354" author="noble.paul" created="Sun, 21 Jun 2009 14:06:06 +0100"  >&lt;blockquote&gt;&lt;p&gt;But in order to call writer.deleteDoc(key) in DocBuilder#deleteAll it must use the value of the uniqueKey field, not of the pk one&lt;/p&gt;&lt;/blockquote&gt;


&lt;p&gt;Why can&apos;t you keep the uniqueKey same as pk  as shown below(it is not used anywhere else (yes there is one other place which is gonna be deprecated) ) . That should solve the problem. DIH is agnostic of the solr primary key . The point is that , the key name does not matter only the value matters . As long as the value is correct, delete should work automatically . &lt;/p&gt;

&lt;p&gt;the following should be just fine&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;
pk=&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="12722359" author="ehatcher" created="Sun, 21 Jun 2009 15:44:20 +0100"  >&lt;p&gt;If the pk attribute is not used, then let&apos;s just remove it altogether.  DIH should NOT be agnostic to Solr&apos;s uniqueKey field though - and it would be silly to mandate users duplicate the uniqueKey setting as DIH pk values when it can just be gotten from the schema.  So -1 to misusing a pk-named attribute this way, when the most intuitive interpretation would be that pk is the Primary Key of the table being indexed.&lt;/p&gt;
</comment>
                            <comment id="12722363" author="ehatcher" created="Sun, 21 Jun 2009 16:03:11 +0100"  >&lt;p&gt;Here&apos;s another patch that removes references to pk from DocBuilder#deleteAll.  &lt;/p&gt;

&lt;p&gt;I&apos;ve just looked for uses of pk myself, and indeed it seems it should be removed.  DIH must know and use the uniqueKey field from the schema for updates/deletes - there is no reason for DIH configs to have to specify it again.&lt;/p&gt;</comment>
                            <comment id="12722364" author="ehatcher" created="Sun, 21 Jun 2009 16:04:42 +0100"  >&lt;p&gt;In my latest patch, I added a comment with a question about the use of the loop in deletelAll.  I don&apos;t see why it is needed.  Noble?&lt;/p&gt;</comment>
                            <comment id="12722427" author="lancenorskog" created="Sun, 21 Jun 2009 22:11:20 +0100"  >&lt;p&gt;There are two bugs in this issue:&lt;/p&gt;

&lt;p&gt;1) The deletedPkQuery must say &quot;select field from table&quot;. It may not say &quot;select expression&quot; or &quot;select field AS FIELD from table&quot;. The former does not work and the latter may work with some databases and not others.  In other words, the first example works and the others fail:&lt;/p&gt;

&lt;p&gt;    deletedPkQuery=&quot;select id from item where EXPRESSION&quot;&lt;br/&gt;
    deletedPkQuery=&quot;select concat(&apos;&apos;,id) from item where EXPRESSION&quot;&lt;br/&gt;
    deletedPkQuery=&quot;select id from item AS ID where EXPRESSION&quot;&lt;br/&gt;
    deletedPkQuery=&quot;select id from item AS ITEM.ID where EXPRESSION&quot;&lt;/p&gt;

&lt;p&gt;2) If a template is used to format the contents of the Solr primary key, that template is declared at the &amp;lt;field&amp;gt; level and is not visible in the parent &amp;lt;entity&amp;gt; level. Since the deletedPkQuery is declared in the &amp;lt;entity&amp;gt; level, it cannot see the field&apos;s template. Thus the template cannot be applied to the results of the deletedPkQuery. Any formatting in the &amp;lt;field&amp;gt; template must be duplicated (in SQL syntax) in the deletedPkQuery. &lt;/p&gt;

&lt;p&gt;This is workaround that achieves the goal of #2: if the Solr primary key is declared as&lt;/p&gt;

&lt;p&gt;    &amp;lt;field name=&quot;id&quot; template=&quot;prefix-$&lt;/p&gt;
{item.id}
&lt;p&gt;&quot;&lt;/p&gt;

&lt;p&gt;then the deletedPkQuery must be declared as&lt;/p&gt;

&lt;p&gt;    deletedPkQuery=&quot;select concat(&apos;prefix&apos;,id) from item where EXPRESSION&quot;&lt;/p&gt;

&lt;p&gt;Because of bug #1, it is not possible to use this workaround.&lt;/p&gt;

&lt;p&gt;The attached patch fixes bug #1, making it possible to use the workaround. It is Erik&apos;s second patch but only with the fix for bug #1. It does not create an automatic way for results of deletedPkQuery to be formatted with the primary key&apos;s template.&lt;/p&gt;
</comment>
                            <comment id="12722441" author="ehatcher" created="Mon, 22 Jun 2009 01:26:46 +0100"  >&lt;p&gt;Lance - your patch misses the all important EntityProcessorWrapper.java changes that both Noble and I contributed in our patches.  That&apos;s needed to make this work!&lt;/p&gt;</comment>
                            <comment id="12722443" author="ehatcher" created="Mon, 22 Jun 2009 01:38:50 +0100"  >&lt;p&gt;I&apos;ve retested my last patch and all works fine in my single record simple test case using the exact configuration (and MySQL DB) as posted here.  I do a full-import, one record goes in.  I do change deleted to &apos;Y&apos; and do a delta-import and the document is removed from Solr.&lt;/p&gt;

&lt;p&gt;Lance - please fall back to my last patch - the applyTransformer call in EntityProcessorWrapper#nextDeletedRow that I added is crucial.  It gives an id=board-1 value which is then used for deletion in DocBuilder#deleteAll.&lt;/p&gt;</comment>
                            <comment id="12722473" author="noble.paul" created="Mon, 22 Jun 2009 04:48:00 +0100"  >&lt;blockquote&gt;&lt;p&gt;If the pk attribute is not used, then let&apos;s just remove it altogether.....&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;hi Erik. you got me wrong.   Let me try to explain. There are two potential names for a field one is the &apos;column&apos; and other is the &apos;name&apos;&lt;/p&gt;

&lt;p&gt;&apos;column&apos; is the name of the field in the source or in DIH. The &apos;name&apos; is the name of that field in Solr.  DIH uses the &apos;name&apos; attribute only when it writes the field to Solr. &lt;/p&gt;

&lt;p&gt;The relation ship between &apos;pk&apos; attribute and the &apos;&amp;lt;uniqueKey&amp;gt;&apos; in Solr  is same . The distinction is important . Otherwise the user will be forced to use the same name in both the db and solr (assuming no transformations are done). &lt;/p&gt;</comment>
                            <comment id="12722495" author="lancenorskog" created="Mon, 22 Jun 2009 08:14:38 +0100"  >&lt;p&gt;Yup, I&apos;ve deleted my patch. After a lot more examination of the code, and combinatoric testing, I see why it works and is the right fix for this incarnation of the DIH.&lt;/p&gt;

&lt;p&gt;And, yes, unit tests for more of these options are on the way!&lt;/p&gt;</comment>
                            <comment id="12722921" author="ehatcher" created="Tue, 23 Jun 2009 02:19:25 +0100"  >&lt;p&gt;Noble - I&apos;m not following your explanation here.  The pk attribute seems like it should simply be removed (and the usages of it refactored to use Solr&apos;s uniqueKey setting when doing updated/deleted activities - that&apos;s the key to the Solr docs after all).&lt;/p&gt;

&lt;p&gt;Regarding &apos;column&apos;/&apos;name&apos; - there are cases where it is quite confusing - where column is used to specify the Solr field name - and that feels wrong to me.  &apos;name&apos; should always be the Solr name, and if it is a templated field, it should be &apos;name&apos;/&apos;template&apos; not &apos;column&apos;/&apos;template&apos;, for example.   &lt;/p&gt;
</comment>
                            <comment id="12722922" author="ehatcher" created="Tue, 23 Jun 2009 02:21:11 +0100"  >&lt;p&gt;I plan on committing this patch later this week.  It fixes the problems we&apos;ve had.   Please review and comment further if there are still holes... but we really should be discussing this with unit tests.  I hope to see some of those this week from Lance.&lt;/p&gt;</comment>
                            <comment id="12722956" author="noble.paul" created="Tue, 23 Jun 2009 05:17:51 +0100"  >&lt;blockquote&gt;&lt;p&gt;he pk attribute seems like it should simply be removed &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The pk attribute IS REQUIRED  for this use case. I guess the solution to your problem is that you set the pk correct as the name you find in the &quot;source row&quot; map. if we remove it every user will be forced to keep the uniquekey same as the name it has in the source DB.&lt;/p&gt;

&lt;p&gt;Take the following usecase&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
   &amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;
           pk=&lt;span class=&quot;code-quote&quot;&gt;&quot;db_id&quot;&lt;/span&gt;
           deletedPkQuery=&lt;span class=&quot;code-quote&quot;&gt;&quot;select db_id from boards where deleted = &apos;Y&apos;&quot;&lt;/span&gt;&amp;gt;
     &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;db_id&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr_id&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/entity&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;elsewhere in solrconfig.xml&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;uniqueKey&amp;gt;&lt;/span&gt;solr_id&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/uniqueKey&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;



&lt;p&gt;if you omit that pk attributethis will fail&lt;/p&gt;</comment>
                            <comment id="12723393" author="ehatcher" created="Wed, 24 Jun 2009 02:05:49 +0100"  >&lt;p&gt;The pk attribute currently is used to track only modified/deleted records during a delta-import.  But only the uniqueKey setting makes sense, and that will get mapped from the transformations applied.  I fail to see how removing pk (and of course refactoring its current uses to the uniqueKey value) will cause problems.  The only thing that matters here is that transformations are applied such that the uniqueKey field value is accurate.  There is nothing in what I&apos;m suggesting here that makes the DB primary key field match the Solr uniqueKey field name.  &lt;/p&gt;

&lt;p&gt;Again, tests are really required so we can be sure we have the bases covered, but it&apos;s been tested pretty thoroughly that my patch fixes a serious issue.&lt;/p&gt;</comment>
                            <comment id="12723427" author="noble.paul" created="Wed, 24 Jun 2009 05:27:25 +0100"  >&lt;p&gt;hi Erik it works in your case , But the usecase I have given above (which is a more normal usecase)&lt;/p&gt;

&lt;p&gt;let me explain with the above example . &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; code is  taken from your patch
&lt;/span&gt; SchemaField uniqueKeyField = dataImporter.getSchema().getUniqueKeyField();
&lt;span class=&quot;code-comment&quot;&gt;// now the value of uniqueKeyField is &apos;solr_id&apos;
&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (uniqueKeyField == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
 &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; key = map.get(uniqueKeyField.getName());
 &lt;span class=&quot;code-comment&quot;&gt;//the map contains {&lt;span class=&quot;code-quote&quot;&gt;&quot;db_id&quot;&lt;/span&gt;-&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;12345&quot;&lt;/span&gt;}
&lt;/span&gt; &lt;span class=&quot;code-comment&quot;&gt;//so key == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;; and it will &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; nothing and &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;
&lt;/span&gt; &lt;span class=&quot;code-comment&quot;&gt;// on the contrary &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; you set the pk=&lt;span class=&quot;code-quote&quot;&gt;&quot;db_id&quot;&lt;/span&gt; , then it works
&lt;/span&gt;




&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12724391" author="noble.paul" created="Fri, 26 Jun 2009 06:45:28 +0100"  >&lt;p&gt;committed r788587&lt;/p&gt;</comment>
                            <comment id="12724462" author="ehatcher" created="Fri, 26 Jun 2009 11:28:51 +0100"  >&lt;p&gt;Noble - I don&apos;t really appreciate you committing a partial patch of this.  What you committed requires us to set pk=&quot;id&quot;, which is just silly and nonsensical.  I&apos;m opening this back up to continue to fix this awkward area of DIH.  &lt;/p&gt;</comment>
                            <comment id="12724471" author="shalinmangar" created="Fri, 26 Jun 2009 11:58:33 +0100"  >&lt;p&gt;Erik, the most common use-case as far as I have seen is that the primary key in tables is different from the uniqueKey in Solr (think about multiple tables with each having a root-entity). Yes, the pk can be transformed (or one can alias it in sql) but this being the most common use-case, I feel pk should be kept as-is.&lt;/p&gt;

&lt;p&gt;Let me give a few possible cases &lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The name of table&apos;s primary key is different from solr&apos;s unique key name and the deletedPkQuery returns only one column (most common use-case)&lt;/li&gt;
	&lt;li&gt;The name of table&apos;s primary key is different from solr&apos;s unique key name and the deletedPkQuery returns multiple columns&lt;/li&gt;
	&lt;li&gt;The name of table&apos;s primary key is same as solr&apos;s unique key name and the deletedPkQuery returns only one column&lt;/li&gt;
	&lt;li&gt;The name of table&apos;s primary key is same as solr&apos;s unique key name and the deletedPkQuery returns multiple columns&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;For #1 &apos;pk&apos; does not matter because we can use the single columns coming back from deletedPkQuery&lt;br/&gt;
For #2, &apos;pk&apos; is required otherwise the user is forced to use a transformer (or alias). For non-database use-cases (there is none right now), there is no aliasing so the user must write a transformer&lt;br/&gt;
For #3, neither &apos;pk&apos; nor &apos;uniqueKey&apos; matters&lt;br/&gt;
For #4, we can use solr&apos;s uniqueKey name (I guess this is your use-case?). I think that this is a rare use-case.&lt;/p&gt;

&lt;p&gt;If at all, we decide to go with uniqueKey only, the right way to do that would be to use the corresponding column-mapping for looking up the unique key. For the example below, we should use &quot;db-id&quot; to lookup in the map returned by deletedPkQuery if solr-id is the uniqueKey in solr:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;db-id&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr-id&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, even though the above approach is the &apos;right&apos; one, it is very tricky and hard to explain to users. Also, there could be multiple columns mapped to same solr key (think about template for unique key for &apos;types&apos; of documents based on a flag column). This may be very error-prone.&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="12724780" author="ehatcher" created="Sat, 27 Jun 2009 02:06:58 +0100"  >&lt;p&gt;In all of those cases, as long as what is returned from the query and run through transformations ends up with a key in the map that is the same as the uniqueKey setting in schema.xml, then all is fine.  I still don&apos;t see a need to set pk=&quot;solr-id&quot;.  Won&apos;t there always be a uniqueKey-named key in that map after transformations are applied?  uniqueKey definitely matters... that&apos;s the field that must be used for deletions, and what I&apos;m consistently seeing mentioned here is that you want to duplicate that by saying pk=&quot;&amp;lt;uniqueKeyFieldName&amp;gt;&quot;, which is unnecessary duplication.  When would you set pk to anything else?&lt;/p&gt;

&lt;p&gt;It&apos;ll be later next week at the earliest, but I hope to get some unit tests contributed so we can discuss this topic through tests rather than prose.&lt;/p&gt;

&lt;p&gt;My use case is exactly the config at the top of this issue, where the uniqueKey value is a templated transformation (because of multiple DIH configurations bringing in various data sources, so the  unique key value must be fabricated to be guaranteed to be unique across different datasources that may have the same primary keys in the databases) - this corresponds to your #1.&lt;/p&gt;</comment>
                            <comment id="12724803" author="noble.paul" created="Sat, 27 Jun 2009 06:35:22 +0100"  >&lt;blockquote&gt;&lt;p&gt;don&apos;t really appreciate you committing a partial patch of this&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I am sorry about this. But, my fix was good enough for the bug&apos;s description. I was planing to open another issue for this.&lt;/p&gt;

&lt;p&gt;Either we should change the descrption to , deprecate &apos;pk&apos; or we can open another issue for the same.&lt;br/&gt;
DIH works as intented to with this fix and the deprecation can be take up .&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Won&apos;t there always be a uniqueKey-named key in that map after transformations..&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The assumption is that transformation is always done. My experience with &apos;&apos;DIH support says that users don&apos;t use it always.Transformer is just a addon .&lt;/p&gt;

&lt;p&gt;Anyway , the right fix would be to find out what is the right mapping in DIH for the given solr &amp;lt;uniqueKey&amp;gt; and use it as a pk. That can definitely be another jira issue&lt;/p&gt;

&lt;p&gt;your thoughts?&lt;/p&gt;</comment>
                            <comment id="12724924" author="lancenorskog" created="Sun, 28 Jun 2009 06:10:27 +0100"  >&lt;p&gt;This patch contains two unit test files addressing the topics of this bug: &lt;br/&gt;
1) database and Solr have different primary key names&lt;br/&gt;
2) solr primary key value is processed with a template&lt;/p&gt;

&lt;p&gt;TestSqlEntityProcessorDelta.java does general tests of delta-import&lt;/p&gt;

&lt;p&gt;TestSqlEntityProcessorDelta2.java does the same tests with a different solr id name and a template for the solr id value.&lt;/p&gt;

&lt;p&gt;Also, there was a mistake in the test fixture which caused delta imports to always empty the index first.&lt;/p&gt;

&lt;p&gt;I believe that these tests should work. Please make all changes necessary so that we have working unit tests for these features, and please change the wiki to match all syntax changes.&lt;/p&gt;</comment>
                            <comment id="12724925" author="lancenorskog" created="Sun, 28 Jun 2009 06:19:17 +0100"  >&lt;p&gt;Also, I recommend that a feature be removed: creating a deltaImportQuery if the user does not declare one. From the wiki:&lt;/p&gt;

&lt;p&gt;&quot;deltaImportQuery : (Only used in delta-import) . If this is not present , DIH tries to construct the import query by(after identifying the delta) modifying the &apos;query&apos; (this is error prone). There is a namespace $&lt;/p&gt;
{dataimporter.delta.&amp;lt;column-name&amp;gt;}
&lt;p&gt; which can be used in this query. e.g: select * from tbl where id=$&lt;/p&gt;
{dataimporter.delta.id}
&lt;p&gt;   Solr1.4.&quot;&lt;/p&gt;

&lt;p&gt;The user should just be required to supply the deltaImportQuery. Now that the deltaImportQuery declaration exists, this &quot;helper feature&quot; is just a trap for the unwary. The phrase &quot;this is error prone&quot; is always a bad sign.&lt;/p&gt;</comment>
                            <comment id="12724987" author="lancenorskog" created="Sun, 28 Jun 2009 20:31:20 +0100"  >&lt;p&gt;Shalin, how can a deletedPkQuery return multiple columns? It is supposed to return a list of Solr uniqueKeys. These are then sent in with the Solr delete-by-id operation.&lt;/p&gt;
</comment>
                            <comment id="12724990" author="ehatcher" created="Sun, 28 Jun 2009 21:00:53 +0100"  >&lt;p&gt;Lance - the SQL query could return more than one column.   A bit non-sensical, but it could be specified that way.  SELECT * FROM BOARDS WHERE deleted=&apos;Y&apos; for example.&lt;/p&gt;

&lt;p&gt;And no, it isn&apos;t supposed to return Solr uniqueKey id&apos;s!!!   That&apos;s the main crux of the dilemma here... how to jive what is returned from a SQL resultset with Solr unique keys.&lt;/p&gt;</comment>
                            <comment id="12725126" author="noble.paul" created="Mon, 29 Jun 2009 12:16:58 +0100"  >&lt;blockquote&gt;&lt;p&gt;Also, I recommend that a feature be removed: creating a deltaImportQuery if the user does not declare one. From the wiki: &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It will be removed. But, we cannot remove it from the wiki until we release 1.4. &lt;/p&gt;</comment>
                            <comment id="12725138" author="noble.paul" created="Mon, 29 Jun 2009 12:49:09 +0100"  >&lt;blockquote&gt;&lt;p&gt;I believe that these tests should work.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;hi Lance, do the testcases run.? or we require some fix to make it work? I applied the patch and the testcases are failing&lt;/p&gt;</comment>
                            <comment id="12725629" author="ehatcher" created="Tue, 30 Jun 2009 14:57:50 +0100"  >&lt;p&gt;Lance - I too get failures with your tests.  Here&apos;s one example:&lt;/p&gt;

&lt;p&gt;junit.framework.AssertionFailedError: query failed XPath: //*&lt;span class=&quot;error&quot;&gt;&amp;#91;@numFound=&amp;#39;0&amp;#39;&amp;#93;&lt;/span&gt; xml response was: &amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
&amp;lt;response&amp;gt;&lt;br/&gt;
&amp;lt;lst name=&quot;responseHeader&quot;&amp;gt;&amp;lt;int name=&quot;status&quot;&amp;gt;0&amp;lt;/int&amp;gt;&amp;lt;int name=&quot;QTime&quot;&amp;gt;1&amp;lt;/int&amp;gt;&amp;lt;lst name=&quot;params&quot;&amp;gt;&amp;lt;str name=&quot;rows&quot;&amp;gt;20&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;start&quot;&amp;gt;0&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;q&quot;&amp;gt;desc:hello OR XtestCompositePk_DeltaImport_replace_nodelete&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;qt&quot;&amp;gt;standard&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;version&quot;&amp;gt;2.2&amp;lt;/str&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;result name=&quot;response&quot; numFound=&quot;1&quot; start=&quot;0&quot;&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;arr name=&quot;desc&quot;&amp;gt;&amp;lt;str&amp;gt;hello&amp;lt;/str&amp;gt;&amp;lt;/arr&amp;gt;&amp;lt;str name=&quot;id&quot;&amp;gt;1&amp;lt;/str&amp;gt;&amp;lt;date name=&quot;timestamp&quot;&amp;gt;2009-06-30T13:55:58.2Z&amp;lt;/date&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;/result&amp;gt;&lt;br/&gt;
&amp;lt;/response&amp;gt;&lt;/p&gt;

&lt;p&gt;	at org.apache.solr.util.AbstractSolrTestCase.assertQ(AbstractSolrTestCase.java:182)&lt;br/&gt;
	at org.apache.solr.util.AbstractSolrTestCase.assertQ(AbstractSolrTestCase.java:172)&lt;br/&gt;
	at org.apache.solr.handler.dataimport.TestSqlEntityProcessorDelta.testCompositePk_DeltaImport_replace_nodelete(TestSqlEntityProcessorDelta.java:194)&lt;/p&gt;

</comment>
                            <comment id="12725810" author="lancenorskog" created="Tue, 30 Jun 2009 22:10:54 +0100"  >&lt;p&gt;I apologize, I did not put it clearly. &lt;/p&gt;

&lt;p&gt;Yes, these tests do not work against the current code base. I believe they are correct tests for the features we have talked about in this issue, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1229&quot; title=&quot;deletedPkQuery feature does not work when pk and uniqueKey field do not have the same value&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1229&quot;&gt;&lt;del&gt;SOLR-1229&lt;/del&gt;&lt;/a&gt;. The code in these tests should work, when this bug is resolved. They will not work with the partial patch currently committed.&lt;/p&gt;

&lt;p&gt;These tests are variations of the original test set. They handle two cases: 1) the solr uniqueKey has a different name than the DB primary key, and 2) the solr uniqueKey&apos;s value is a transformation of the DB primary key&apos;s value.&lt;/p&gt;

&lt;p&gt;In other words, if your code actually works, and passes your by-hand tests, it should then pass all of these tests. If there is something wrong in these tests, please fix it.&lt;/p&gt;

&lt;p&gt;Should you wish to write further tests, the pre/post remove query features at present have no coverage.&lt;/p&gt;</comment>
                            <comment id="12725926" author="noble.paul" created="Wed, 1 Jul 2009 06:17:40 +0100"  >&lt;p&gt;The testcases are wrong.&lt;/p&gt;

&lt;p&gt;take the case of testCompositePk_DeltaImport_empty()&lt;/p&gt;

&lt;p&gt;the uniqueKey is &apos;solr_id&apos; and there is no such field which maps to &apos;solr_id &apos;&lt;/p&gt;

&lt;p&gt;see the mapping&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</comment>
                            <comment id="12725948" author="noble.paul" created="Wed, 1 Jul 2009 07:41:08 +0100"  >&lt;p&gt;Erik, the new fix&lt;/p&gt;

&lt;p&gt;This eliminates the need for &apos;pk&apos; most of the cases.  It tries to identify the corresponding column mapping for the solr uniqueKey.  But the user can override this by specifying the pk attribute if the guess is not going to be correct&lt;/p&gt;</comment>
                            <comment id="12727914" author="noble.paul" created="Tue, 7 Jul 2009 05:50:48 +0100"  >&lt;p&gt;Erik, did you have a chance to look at the fix?&lt;/p&gt;</comment>
                            <comment id="12729657" author="ehatcher" created="Fri, 10 Jul 2009 15:52:10 +0100"  >&lt;p&gt;Latest patch (adapted by Lance).  All tests pass and this will be committed shortly.&lt;/p&gt;</comment>
                            <comment id="12729660" author="ehatcher" created="Fri, 10 Jul 2009 15:56:43 +0100"  >&lt;p&gt;Committed to r792963.  Thanks Lance and Noble for iterating on this.  We&apos;ve at least got it working well enough for our current needs.&lt;/p&gt;</comment>
                            <comment id="12729971" author="noble.paul" created="Sat, 11 Jul 2009 11:42:49 +0100"  >&lt;p&gt;this fix does not allow the user to override the pk key name from the data-config.xml . The deduced key takes precedence. In most cases the pk attribute is not required, but when it is mentioned it should take precedence&lt;/p&gt;</comment>
                            <comment id="12730201" author="lancenorskog" created="Mon, 13 Jul 2009 04:24:55 +0100"  >&lt;p&gt;Noble-&lt;/p&gt;

&lt;p&gt;With this change to DocBuilder.deleteAll(), the Delta2 test runs. With the code in the other order, the two delete operations do not work because the template is not applied. &lt;/p&gt;

&lt;p&gt;Please alter this config file (from unit test Delta2) to embody the use case you mention. The database pk is &apos;id&apos; and the schema pk is &apos;solr_id&apos;.  And please describe the primary key design of the database and solr schemas.&lt;/p&gt;

&lt;p&gt;&amp;lt;dataConfig&amp;gt;&lt;br/&gt;
  &amp;lt;document&amp;gt;&lt;br/&gt;
     &amp;lt;entity name=&quot;x&quot; pk=&quot;id&quot; transformer=&quot;TemplateTransformer&quot;          &lt;br/&gt;
         query=&quot;select * from x&quot;  &lt;br/&gt;
         deletedPkQuery=&quot;select id from x where last_modified &amp;gt; NOW AND deleted=&apos;true&apos;&quot; &lt;br/&gt;
         deltaImportQuery=&quot;select * from x where id=&apos;$&lt;/p&gt;
{dataimporter.delta.id}
&lt;p&gt;&apos;&quot;  &lt;br/&gt;
         deltaQuery=&quot;select id from x where last_modified &amp;gt; NOW&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;field column=&quot;solr_id&quot; template=&quot;prefix-$&lt;/p&gt;
{x.id}&quot;/&amp;gt;&lt;br/&gt;
               &amp;lt;entity name=&quot;y&quot; query=&quot;select * from y where y.A=&apos;${x.id}
&lt;p&gt;&apos;&quot;&amp;gt;&lt;br/&gt;
                  &amp;lt;field column=&quot;desc&quot; /&amp;gt;&lt;br/&gt;
               &amp;lt;/entity&amp;gt;&lt;br/&gt;
      &amp;lt;/entity&amp;gt;&lt;br/&gt;
   &amp;lt;/document&amp;gt;&lt;br/&gt;
&amp;lt;/dataConfig&amp;gt;&lt;/p&gt;</comment>
                            <comment id="12730243" author="noble.paul" created="Mon, 13 Jul 2009 08:40:37 +0100"  >&lt;p&gt;ideally , for your usecases , the pk attribute is not required. So i have removed it. Now it uses the user provided pk if it is not present it falls back to the solr schema uniqueKey&lt;/p&gt;</comment>
                            <comment id="12731780" author="lancenorskog" created="Thu, 16 Jul 2009 04:15:34 +0100"  >&lt;p&gt;Ok - these run. Thanks.&lt;/p&gt;

&lt;p&gt;Just to make sure I understand. The &apos;pk&apos; attribute declares 2 things:  &lt;br/&gt;
    1) that this column must exist for a document to be generated, and &lt;br/&gt;
    2) that this entity is the level where documents are created. Is this true?&lt;/p&gt;

&lt;p&gt;tmpid appears as an unused name merely so that $&lt;/p&gt;
{x.id}
&lt;p&gt; is sent into solr_id. Maybe name=&quot;&quot; would be more clear for this purpose?&lt;/p&gt;

&lt;p&gt;Lance&lt;/p&gt;


</comment>
                            <comment id="12732213" author="lancenorskog" created="Thu, 16 Jul 2009 23:37:22 +0100"  >&lt;p&gt;Something is documented on the wiki but not used: multiple PKs in one entity.&lt;/p&gt;

&lt;p&gt;On the wiki page, see the config file after &quot;Writing a huge deltaQuery&quot; - there is a attribute: &lt;/p&gt;
{pk=&quot;ITEM_ID, CATEGORY_ID&quot;}
&lt;p&gt;There is code to parse this in DataImporter.InitEntity() and store the list in Entity.primaryKeys. But this list of PKs is never used.&lt;/p&gt;

&lt;p&gt;I think the use case for this is that the user requires more fields besides the uniqueKey for a document. Is this right? This is definitely on my list of must-have features. The second field may or may not be declared &quot;required&quot; in the schema, so looking at the schema is not good enough. The field has to be declared &quot;required&quot; in the dataconfig.&lt;/p&gt;

&lt;p&gt;Lance&lt;/p&gt;

&lt;p&gt;(I split this comment out from the previous since they are not related. However, this is another feature inside the same bit of code upon which we are ceaselessly chewing.)&lt;/p&gt;</comment>
                            <comment id="12732433" author="noble.paul" created="Fri, 17 Jul 2009 10:26:59 +0100"  >&lt;blockquote&gt;&lt;p&gt;1) that this column must exist for a document to be generated, and &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;no,&lt;br/&gt;
2) that this entity is the level where documents are created. Is this true?&lt;br/&gt;
no: rootEntity decides that&lt;/p&gt;

&lt;p&gt;pk is currently used for delete. XPathEntityProcessor also uses that to decode if this row is a candidate for a doc&lt;/p&gt;

&lt;p&gt;multiple pk values were supported for deltas (to construct the deltaImportQuery when it is not present  ). That is going to be deprecated from 1.4. &lt;/p&gt;</comment>
                            <comment id="12738816" author="noble.paul" created="Tue, 4 Aug 2009 05:39:20 +0100"  >&lt;p&gt;I guess the latest patch can be committed and this issue can be closed&lt;/p&gt;</comment>
                            <comment id="12739377" author="noble.paul" created="Wed, 5 Aug 2009 09:54:26 +0100"  >&lt;p&gt;I guess the fix was not done&lt;/p&gt;</comment>
                            <comment id="12739424" author="ehatcher" created="Wed, 5 Aug 2009 11:46:29 +0100"  >&lt;p&gt;Do you have a failing test case?&lt;/p&gt;</comment>
                            <comment id="12739444" author="noble.paul" created="Wed, 5 Aug 2009 13:06:32 +0100"  >&lt;p&gt;Nope. The last current trunk  has changed an existing feature. The pk  attribute is ignored. that is why I have reopened it in the first place&lt;/p&gt;</comment>
                            <comment id="12739930" author="lancenorskog" created="Thu, 6 Aug 2009 08:48:27 +0100"  >
&lt;p&gt;There are a couple of other features to remove in this code:&lt;/p&gt;

&lt;p&gt;1) multiple primary keys&lt;br/&gt;
2) deltaImportQuery is created automatically if it is not given in the dataconfig.xml file&lt;/p&gt;

&lt;p&gt;Do we want to attack all of those in this issue?&lt;/p&gt;


</comment>
                            <comment id="12739948" author="noble.paul" created="Thu, 6 Aug 2009 10:07:20 +0100"  >&lt;blockquote&gt;&lt;p&gt;Do we want to attack all of those in this issue?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;we must remove them . Let us have a separate issue for them&lt;/p&gt;</comment>
                            <comment id="12740385" author="lancenorskog" created="Fri, 7 Aug 2009 04:40:00 +0100"  >&lt;p&gt;The Delta2 test handles both of the problems in this issue. Should this issue be closed?&lt;/p&gt;</comment>
                            <comment id="12740433" author="noble.paul" created="Fri, 7 Aug 2009 08:15:26 +0100"  >&lt;p&gt;The issue is reopened because it breaks an existing functionality. The latest patch fixes that&lt;/p&gt;</comment>
                            <comment id="12746546" author="lancenorskog" created="Sun, 23 Aug 2009 03:57:57 +0100"  >&lt;p&gt;Noble, what is this broken functionality? &lt;/p&gt;

&lt;p&gt;I just did a full update and all unit tests work. If you describe the problem I will do the unit test and fix it.&lt;/p&gt;</comment>
                            <comment id="12746584" author="noble.paul" created="Sun, 23 Aug 2009 11:30:11 +0100"  >&lt;blockquote&gt;&lt;p&gt;what is this broken functionality?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Till this fix the user provided &apos;pk&apos; was always honoured. Now, the derived pk can never be overridden. My latest patch has the fix and corresponding changes to the tests. &lt;/p&gt;</comment>
                            <comment id="12747175" author="lancenorskog" created="Tue, 25 Aug 2009 02:45:33 +0100"  >&lt;p&gt;The latest patch works against the latest SVN checkout. Please commit it and close this issue.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="12747333" author="noble.paul" created="Tue, 25 Aug 2009 10:54:49 +0100"  >&lt;p&gt;committed :r807537&lt;/p&gt;</comment>
                            <comment id="12775779" author="gsingers" created="Tue, 10 Nov 2009 15:52:08 +0000"  >&lt;p&gt;Bulk close for Solr 1.4&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12413276" name="SOLR-1229.patch" size="4271" author="noble.paul" created="Mon, 13 Jul 2009 08:40:37 +0100"/>
                            <attachment id="12413121" name="SOLR-1229.patch" size="41926" author="ehatcher" created="Fri, 10 Jul 2009 15:52:10 +0100"/>
                            <attachment id="12412241" name="SOLR-1229.patch" size="2961" author="noble.paul" created="Wed, 1 Jul 2009 07:41:08 +0100"/>
                            <attachment id="12411341" name="SOLR-1229.patch" size="2522" author="ehatcher" created="Sun, 21 Jun 2009 16:03:11 +0100"/>
                            <attachment id="12411323" name="SOLR-1229.patch" size="2070" author="ehatcher" created="Sat, 20 Jun 2009 23:02:17 +0100"/>
                            <attachment id="12411304" name="SOLR-1229.patch" size="791" author="noble.paul" created="Sat, 20 Jun 2009 09:24:27 +0100"/>
                            <attachment id="12412010" name="tests.patch" size="38658" author="lancenorskog" created="Sun, 28 Jun 2009 06:10:27 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 18 Jun 2009 17:15:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6419</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxmj3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19969</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>