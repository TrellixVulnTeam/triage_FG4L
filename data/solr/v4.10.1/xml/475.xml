<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:27:00 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-475/SOLR-475.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-475] multi-valued faceting via un-inverted field</title>
                <link>https://issues.apache.org/jira/browse/SOLR-475</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Facet multi-valued fields via a counting method (like the FieldCache method) on an un-inverted representation of the field.  For each doc, look at it&apos;s terms and increment a count for that term.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12388216">SOLR-475</key>
            <summary>multi-valued faceting via un-inverted field</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Feb 2008 17:35:41 +0000</created>
                <updated>Thu, 13 Aug 2009 15:19:14 +0100</updated>
                            <resolved>Tue, 25 Nov 2008 04:02:54 +0000</resolved>
                                                    <fixVersion>1.4</fixVersion>
                                        <due></due>
                            <votes>4</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="12567181" author="yseeley@gmail.com" created="Fri, 8 Feb 2008 20:01:43 +0000"  >&lt;p&gt;Prototype attached.&lt;br/&gt;
This is completely untested code, and is still missing the solr interface + caching.&lt;br/&gt;
The approach is described in the comments (cut-n-pasted here).&lt;br/&gt;
Any thoughts or comments on the approach?&lt;/p&gt;

&lt;p&gt;I may not have time to immediately work on this (fix the bugs, add tests, hook up to solr, add caching of un-inverted field, etc), so additional contributions in this direction are welcome!&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
 * Final form of the un-inverted field:
 *   Each document points to a list of term numbers that are contained in that document.
 *
 *   Term numbers are in sorted order, and are encoded as variable-length deltas from the
 *   previous term number.  Real term numbers start at 2 since 0 and 1 are reserved.  A
 *   term number of 0 signals the end of the termNumber list.
 *
 *   There is a singe &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[maxDoc()] which either contains a pointer into a &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;
 *   the termNumber lists, or directly contains the termNumber list &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it fits in the 4
 *   bytes of an integer.  If the first &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; in the integer is 1, the next 3 bytes
 *   are a pointer into a &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] where the termNumber list starts.
 *
 *   There are actually 256 &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; arrays, to compensate &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the fact that the pointers
 *   into the &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; arrays are only 3 bytes &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;.  The correct &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; array &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a document
 *   is a function of it&apos;s id.
 *
 *   To save space and speed up faceting, any term that matches enough documents will
 *   not be un-inverted... it will be skipped &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; building the un-inverted field structore,
 *   and will use a set intersection method during faceting.
 *
 *   To further save memory, the terms (the actual string values) are not all stored in
 *   memory, but a TermIndex is used to convert term numbers to term values only
 *   &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the terms needed after faceting has completed.  Only every 128th term value
 *   is stored, along with it&apos;s corresponding term number, and &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is used as an
 *   index to find the closest term and iterate until the desired number is hit (very
 *   much like Lucene&apos;s own internal term index).
 */
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12567191" author="yseeley@gmail.com" created="Fri, 8 Feb 2008 20:32:21 +0000"  >&lt;p&gt;fix single line oops&lt;/p&gt;</comment>
                            <comment id="12646719" author="dbowen" created="Tue, 11 Nov 2008 23:05:54 +0000"  >&lt;p&gt;We are seeing faceting on multi-valued fields as a significant performance problem, so we&apos;d very much like to see something of this sort.&lt;/p&gt;
</comment>
                            <comment id="12647326" author="koji" created="Thu, 13 Nov 2008 16:38:06 +0000"  >&lt;p&gt;Yonik,&lt;br/&gt;
This looks great! I&apos;d like to contribute (unit test, etc.) to move forward.&lt;br/&gt;
Before I write unit tests, I have a couple of questions:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;To initialize TermIndex.index, getEnumerator().close() have to be called, right? (but I cannot find close() call)&lt;/li&gt;
	&lt;li&gt;Can UnInvertedField have searcher instead of reader and remove searcher argument from getCounts()?&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="12650059" author="yseeley@gmail.com" created="Sun, 23 Nov 2008 22:11:30 +0000"  >&lt;p&gt;I&apos;ve finished this implementation and am cleaning it up for contribution.&lt;br/&gt;
In the meantime, I&apos;m attaching the results of some performance tests.&lt;/p&gt;</comment>
                            <comment id="12650071" author="yseeley@gmail.com" created="Sun, 23 Nov 2008 23:02:25 +0000"  >&lt;p&gt;Some further results on a bigger index to show some practical limits.&lt;br/&gt;
This table (JIRA markup format) shows the performance and memory characteristics of facet requests on a 50M document index, for different fields and different numbers of documents being counted in the base query.&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;f10_100_t&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;f100_10_t&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;f1000_5_t&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;f10000_5_t&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;f100000_5_t&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;f100000_10_t&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;field inversion time (sec)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	17.2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	17.9&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	69.4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	87.8&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	133.6&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	388.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;inverted field size (MB)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	68.1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	629.6&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	416.9&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	479.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	589.9&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	807.4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1000 docs facet time (ms)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	7&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	20&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	13	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;16	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;17&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10,000 docs&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	55&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	428	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;22&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	23	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;29&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	28&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;100,000 docs&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	54	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;421&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	35	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;36	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;46	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;56&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1,000,000 docs&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	55&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	431	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;149	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;155&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	249	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;307&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10,000,000 docs&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	54&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 434&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	625&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	625	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1183&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	1620&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;The &quot;profile&quot; of the faceted field is encoded in it&apos;s name.  For example, the field f1000_5_t has 1000 unique values across the whole index and between 0 and 5 values per document.  It took 35 ms to facet on this field when the base query matched 100,000 documents.&lt;/p&gt;


&lt;p&gt;Test Hardware: Commodity PC&lt;br/&gt;
 Processor: AMD Athlon 64 X2 5000+ (2.6GHz dual core)&lt;br/&gt;
Hard Drive: Western Digital Caviar GP WD5000AACS 500GB 5400 to 7200 RPM SATA 3.0Gb/s&lt;br/&gt;
Memory: 8GB DDR2 800 SDRAM (PC2 6400)&lt;br/&gt;
Operating System: Linux - Ubuntu 8.04 desktop, 64 bit version (x86_64)&lt;br/&gt;
Java VM: Sun Java6 (1.6.0_05) 64 bit hotspot (x86_64)&lt;/p&gt;
</comment>
                            <comment id="12650099" author="koji" created="Mon, 24 Nov 2008 02:29:32 +0000"  >&lt;p&gt;How amazing! facet_performance.html shows great improvement on both memory and qps. Great job, Yonik!&lt;/p&gt;</comment>
                            <comment id="12650109" author="yseeley@gmail.com" created="Mon, 24 Nov 2008 05:09:12 +0000"  >&lt;p&gt;Attaching patch with tests.&lt;br/&gt;
This is well tested, so I&apos;ll probably commit relatively soon.&lt;/p&gt;</comment>
                            <comment id="12650453" author="yseeley@gmail.com" created="Tue, 25 Nov 2008 04:02:54 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="12654237" author="yseeley@gmail.com" created="Sun, 7 Dec 2008 20:13:22 +0000"  >&lt;p&gt;update:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;closing of term enumerators (not strictly necessary in Lucene now, so shouldn&apos;t have caused any problems).&lt;/li&gt;
	&lt;li&gt;new fieldValueCache in SolrIndexSearcher&lt;/li&gt;
	&lt;li&gt;uninverted field statistics (per field) available with cache statistics&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12395513" name="SOLR-475.patch" size="16708" author="yseeley@gmail.com" created="Sun, 7 Dec 2008 20:13:22 +0000"/>
                            <attachment id="12394530" name="SOLR-475.patch" size="46052" author="yseeley@gmail.com" created="Mon, 24 Nov 2008 05:09:12 +0000"/>
                            <attachment id="12375107" name="UnInvertedField.java" size="18940" author="yseeley@gmail.com" created="Fri, 8 Feb 2008 20:32:20 +0000"/>
                            <attachment id="12375104" name="UnInvertedField.java" size="18908" author="yseeley@gmail.com" created="Fri, 8 Feb 2008 20:01:34 +0000"/>
                            <attachment id="12394520" name="facet_performance.html" size="37078" author="yseeley@gmail.com" created="Sun, 23 Nov 2008 22:11:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 11 Nov 2008 23:05:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7129</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxr3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20711</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>