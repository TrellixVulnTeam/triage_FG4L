<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:14:50 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-813/SOLR-813.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-813] Add new DoubleMetaphone Filter and Factory</title>
                <link>https://issues.apache.org/jira/browse/SOLR-813</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The existing PhoneticFilter allows for use of the DoubleMetaphone encoder. However, it doesn&apos;t expose the maxCodeLength() setting, and it ignores the alternate encodings that the encoder provides for some words. This new filter is not as generic as the PhoneticFilter, but allows more detailed control over the DoubleMetaphone encoder.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12406701">SOLR-813</key>
            <summary>Add new DoubleMetaphone Filter and Factory</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ryantxu">Ryan McKinley</assignee>
                                    <reporter username="tfeak">Todd Feak</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Oct 2008 18:58:41 +0100</created>
                <updated>Tue, 10 Nov 2009 15:51:49 +0000</updated>
                            <resolved>Sat, 18 Oct 2008 19:39:50 +0100</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.4</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12640602" author="tfeak" created="Fri, 17 Oct 2008 19:01:40 +0100"  >&lt;p&gt;Added patch containing Filter, Factor, and Unit Tests for both.&lt;/p&gt;</comment>
                            <comment id="12640637" author="ryantxu" created="Fri, 17 Oct 2008 20:22:39 +0100"  >&lt;p&gt;rather then create a new Filter for DoubleMetaphone, why not just extend PhoneticFilter to support maxCodeLength?&lt;/p&gt;

&lt;p&gt;Here is a quick untested bit that uses reflection to set the maxCodeLength &amp;#8211; the advantage is that it would also work for &apos;Metaphone&apos; (though i&apos;m not sure anyone uses that).&lt;/p&gt;

&lt;p&gt;Since the reflection only happens once at starup, it is not a big deal.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/java/org/apache/solr/analysis/PhoneticFilterFactory.java
===================================================================
--- src/java/org/apache/solr/analysis/PhoneticFilterFactory.java        (revision 704289)
+++ src/java/org/apache/solr/analysis/PhoneticFilterFactory.java        (working copy)
@@ -17,10 +17,10 @@
 
 &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.apache.solr.analysis;
 
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.lang.reflect.Method;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.HashMap;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.Map;
 
-&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.solr.core.SolrConfig;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.codec.Encoder;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.codec.language.DoubleMetaphone;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.codec.language.Metaphone;
@@ -80,6 +80,13 @@
     
     &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
       encoder = clazz.newInstance();
+      
+      &lt;span class=&quot;code-comment&quot;&gt;// Try to set the maxCodeLength
&lt;/span&gt;+      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; v = args.get( &lt;span class=&quot;code-quote&quot;&gt;&quot;maxCodeLength&quot;&lt;/span&gt; );
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;( v != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ) {
+        Method setter = encoder.getClass().getMethod( &lt;span class=&quot;code-quote&quot;&gt;&quot;setMaxCodeLength&quot;&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.class );
+        setter.invoke( encoder, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt( v ) );
+      }
     } 
     &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
       &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrException( SolrException.ErrorCode.SERVER_ERROR, &lt;span class=&quot;code-quote&quot;&gt;&quot;Error initializing: &quot;&lt;/span&gt;+name + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;+clazz, e );

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12640640" author="tfeak" created="Fri, 17 Oct 2008 20:28:16 +0100"  >&lt;p&gt;Other DoubleMetaphone specific calls are made in the filter. Specifically, it checks to see if there is an alternate encoding for the token, and adds that to the stream as well, if it&apos;s different then the default encoding. This is part of the strength of the DoubleMetaphone implementation that the Phonetic filter doesn&apos;t leverage.&lt;/p&gt;

&lt;p&gt;An additional change that I made that &lt;b&gt;could&lt;/b&gt; be done in the Phonetic filter is blocking empty tokens that are generated on non-alpha strings. This just wraps them all.&lt;/p&gt;</comment>
                            <comment id="12640655" author="ryantxu" created="Fri, 17 Oct 2008 21:41:19 +0100"  >&lt;p&gt;Here is an update that adresses two concerns:&lt;br/&gt;
1. position increments &amp;#8211; this keeps the tokens in sync with the input&lt;br/&gt;
2. previous version would stop processing after a number.  That is: &quot;aaa 1234 bbb&quot; would not process &quot;bbb&quot;&lt;br/&gt;
3. Token types... this changes it to &quot;DoubleMetaphone&quot; rather then &quot;ALPHANUM&quot;&lt;/p&gt;

&lt;p&gt;here is the key part:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isPhonetic = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; v = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(t.termBuffer(), 0, t.termLength());
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; primaryPhoneticValue = encoder.doubleMetaphone(v);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (primaryPhoneticValue.length() &amp;gt; 0) {
        Token token = (Token) t.clone();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;( inject ) {
          token.setPositionIncrement( 0 );
        }
        token.setType( TOKEN_TYPE );
        token.setTermBuffer(primaryPhoneticValue);
        remainingTokens.addLast(token);
        isPhonetic = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
      }

      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; alternatePhoneticValue = encoder.doubleMetaphone(v, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (alternatePhoneticValue.length() &amp;gt; 0
          &amp;amp;&amp;amp; !primaryPhoneticValue.equals(alternatePhoneticValue)) {
        Token token = (Token) t.clone();
        token.setPositionIncrement( 0 );
        token.setType( TOKEN_TYPE );
        token.setTermBuffer(alternatePhoneticValue);
        remainingTokens.addLast(token);
        isPhonetic = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
      }
      
      &lt;span class=&quot;code-comment&quot;&gt;// If we did not add something, then go to the next one...
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;( !isPhonetic ) {
        t = next(in);
        t.setPositionIncrement( t.getPositionIncrement()+1 ); 
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; t;
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12640659" author="ryantxu" created="Fri, 17 Oct 2008 21:48:03 +0100"  >&lt;p&gt;oops, last patch had a bug if the stream ended in a non-phonetic value:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;( !isPhonetic ) {
        t = next(in);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;( t != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ) {
          t.setPositionIncrement( t.getPositionIncrement()+1 ); 
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; t;
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12640792" author="ryantxu" created="Sat, 18 Oct 2008 19:39:50 +0100"  >&lt;p&gt;Added in rev: 705903&lt;br/&gt;
Thanks Todd!&lt;/p&gt;</comment>
                            <comment id="12641032" author="tfeak" created="Mon, 20 Oct 2008 16:04:38 +0100"  >&lt;p&gt;Good catch on that bug and enhancements. I put them in my current implementation. Thank you.&lt;/p&gt;</comment>
                            <comment id="12775554" author="gsingers" created="Tue, 10 Nov 2009 15:51:49 +0000"  >&lt;p&gt;Bulk close for Solr 1.4&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12392380" name="SOLR-813.patch" size="14011" author="ryantxu" created="Fri, 17 Oct 2008 21:48:02 +0100"/>
                            <attachment id="12392379" name="SOLR-813.patch" size="13971" author="ryantxu" created="Fri, 17 Oct 2008 21:41:19 +0100"/>
                            <attachment id="12392366" name="SOLR-813.patch" size="9490" author="tfeak" created="Fri, 17 Oct 2008 19:01:40 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 17 Oct 2008 19:22:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6811</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxp1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20378</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>