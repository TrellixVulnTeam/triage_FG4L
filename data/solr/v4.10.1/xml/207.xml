<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:20:21 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-207/SOLR-207.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-207] snappuller inefficient finding latest snapshot</title>
                <link>https://issues.apache.org/jira/browse/SOLR-207</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;snapinstaller (and snappuller) do the following to find the latest snapshot:&lt;br/&gt;
name=`find $&lt;/p&gt;
{data_dir}
&lt;p&gt; -name snapshot.* -print|grep -v wip|sort -r|head -1`&lt;/p&gt;

&lt;p&gt;This recurses into all of the snapshot directories, doing much more disk-io than is necessary.&lt;br/&gt;
I think it is the cause of bloated kernel memory usage we have seen on some of our Linux boxes, caused&lt;br/&gt;
by kernel dentry and inode caches.   Those caches compete with buffer cache (caching the actual data of the index)&lt;br/&gt;
and can thus decrease performance.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12367068">SOLR-207</key>
            <summary>snappuller inefficient finding latest snapshot</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Apr 2007 16:40:18 +0100</created>
                <updated>Fri, 10 May 2013 11:40:37 +0100</updated>
                            <resolved>Tue, 17 Apr 2007 03:26:44 +0100</resolved>
                                                    <fixVersion>1.2</fixVersion>
                                    <component>replication (scripts)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12488410" author="yseeley@gmail.com" created="Thu, 12 Apr 2007 16:49:50 +0100"  >&lt;p&gt;uses &quot;-maxdepth 1&quot; to avoid recursion.&lt;/p&gt;

&lt;p&gt;Bill - does this look OK?&lt;/p&gt;</comment>
                            <comment id="12488413" author="bdelacretaz" created="Thu, 12 Apr 2007 16:50:48 +0100"  >&lt;p&gt;IIUC the snapshot directories are named like&lt;/p&gt;

&lt;p&gt;  snapshot.YYYYMMDDHHMMSS&lt;/p&gt;

&lt;p&gt;and they are all under the same parent directory.&lt;/p&gt;

&lt;p&gt;If that&apos;s the case, then doing&lt;/p&gt;

&lt;p&gt;  ls -rt $&lt;/p&gt;
{data_dir}
&lt;p&gt;/snapshot.* | head -1&lt;/p&gt;

&lt;p&gt;will return the name of the most recent directory, efficiently.&lt;/p&gt;</comment>
                            <comment id="12488418" author="yseeley@gmail.com" created="Thu, 12 Apr 2007 17:20:15 +0100"  >&lt;p&gt;That&apos;s close to the way it was done in the past, but some people ran into problems because of shell restrictions w.r.t. number or size of the argments passed to the process (because the shell expands the list).&lt;/p&gt;</comment>
                            <comment id="12488420" author="yseeley@gmail.com" created="Thu, 12 Apr 2007 17:29:07 +0100"  >&lt;p&gt;Although, another alternative that doesn&apos;t have the shell expansion problem would be&lt;/p&gt;

&lt;p&gt;ls -r $&lt;/p&gt;
{data_dir}
&lt;p&gt; | grep snapshot&lt;br class=&quot;atl-forced-newline&quot; /&gt;.  | grep -v wip | head -1&lt;/p&gt;
</comment>
                            <comment id="12488468" author="bdelacretaz" created="Thu, 12 Apr 2007 19:44:41 +0100"  >&lt;p&gt;I think find -maxdepth is not supported on Solaris. And the -t option in my previous example was obviously wrong.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if ls -r sorts by filename everywhere (but I have no evidence that it does not).&lt;/p&gt;

&lt;p&gt;The most portable version might be&lt;/p&gt;

&lt;p&gt;  ls $&lt;/p&gt;
{data_dir}
&lt;p&gt; | grep snapshot&lt;br class=&quot;atl-forced-newline&quot; /&gt;. | grep -v wip | sort -r | head -1 &lt;/p&gt;</comment>
                            <comment id="12488469" author="yseeley@gmail.com" created="Thu, 12 Apr 2007 19:47:35 +0100"  >&lt;p&gt;I tried both versions out, and the &quot;find&quot; version was quicker (on Linux at least).&lt;br/&gt;
System time was about the same, but &quot;ls&quot; had much higher user time.&lt;/p&gt;

&lt;p&gt;$ time find . -maxdepth 1 -name &apos;snapshot.*&apos; | grep -v wip | head -1&lt;br/&gt;
./snapshot.20070411235957&lt;/p&gt;

&lt;p&gt;real    0m0.009s&lt;br/&gt;
user    0m0.002s&lt;br/&gt;
sys     0m0.008s&lt;/p&gt;

&lt;p&gt;$ time ls -r . | grep snapshot&lt;br class=&quot;atl-forced-newline&quot; /&gt;. | grep -v wip | head -1&lt;br/&gt;
snapshot.20070412114504&lt;/p&gt;

&lt;p&gt;real    0m0.050s&lt;br/&gt;
user    0m0.043s&lt;br/&gt;
sys     0m0.009s&lt;/p&gt;
</comment>
                            <comment id="12488485" author="yseeley@gmail.com" created="Thu, 12 Apr 2007 20:40:46 +0100"  >&lt;p&gt;&amp;gt; I think find -maxdepth is not supported on Solaris&lt;/p&gt;

&lt;p&gt;Sigh... back to ls then.&lt;/p&gt;</comment>
                            <comment id="12488491" author="billa" created="Thu, 12 Apr 2007 21:28:10 +0100"  >&lt;p&gt;I confirmed that find -maxdepth does not work on Solaris.  So it is back to ls.  We should be OK as long as we don&apos;t use any wildcard that causes expansion.&lt;/p&gt;</comment>
                            <comment id="12488515" author="yseeley@gmail.com" created="Thu, 12 Apr 2007 23:02:15 +0100"  >&lt;p&gt;Updated patch:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;switches back to &quot;ls&quot;,&lt;/li&gt;
	&lt;li&gt;tries to determine if &quot;maxdepth&quot; is supported for the cleanup scripts that need to find -mtime&lt;/li&gt;
	&lt;li&gt;in snappuller, make the master find the latest snapshot instead of sending the complete &quot;ls&quot; across the network.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This has not yet been tested.&lt;/p&gt;</comment>
                            <comment id="12488516" author="yseeley@gmail.com" created="Thu, 12 Apr 2007 23:03:32 +0100"  >&lt;p&gt;re-attaching with ASF perms (in the older JIRA version, the &quot;grant license&quot; option was first, and now it is last... hence I keep clicking the incorrect one)&lt;/p&gt;</comment>
                            <comment id="12489284" author="yseeley@gmail.com" created="Tue, 17 Apr 2007 03:26:44 +0100"  >&lt;p&gt;Tested and committed.&lt;/p&gt;</comment>
                            <comment id="12589289" author="hossman" created="Wed, 16 Apr 2008 00:44:42 +0100"  >&lt;p&gt;This bug was modified as part of a bulk update using the criteria...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Marked (&quot;Resolved&quot; or &quot;Closed&quot;) and &quot;Fixed&quot;&lt;/li&gt;
	&lt;li&gt;Had no &quot;Fix Version&quot; versions&lt;/li&gt;
	&lt;li&gt;Was listed in the CHANGES.txt for 1.2&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The Fix Version for all 39 issues found was set to 1.2, email notification&lt;br/&gt;
was suppressed to prevent excessive email.&lt;/p&gt;

&lt;p&gt;For a list of all the issues modified, search jira comments for this&lt;br/&gt;
(hopefully) unique string: 20080415hossman2&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12355467" name="find_maxdepth.patch" size="2654" author="yseeley@gmail.com" created="Thu, 12 Apr 2007 23:03:32 +0100"/>
                            <attachment id="12355433" name="find_maxdepth.patch" size="2165" author="yseeley@gmail.com" created="Thu, 12 Apr 2007 16:49:50 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 12 Apr 2007 15:50:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7380</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxsqn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20975</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>