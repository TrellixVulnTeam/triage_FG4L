<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:15:10 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-1060/SOLR-1060.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-1060] a new DIH EnityProcessor allowing text file lists of files to be indexed</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1060</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I have finished a new DIH EntityProcessor. It is designed around the idea that whatever demon is used to maintain your content store it is likely to drop a report or log file explaining what has changed within your content store. I wish to use this report file to control the indexing of the new or changed content and the removal of old content. The report files, perhaps from un-tar or un-zip, are likely to reference jpegs and directory stubs which need to be ignored. I assumed a file based content repository but this should be expanded to handle URI&apos;s as well&lt;/p&gt;

&lt;p&gt;I feel that the current FileListEntityProcessor is poorly named. It should be called the dirWalkEntityProcessor or dirCrawlEntityProcessor or such. And this new EntityProcessor should have the name FileListEntityProcessor. However what is done is done. I then came up with manifestEnityProcessor which I thought suited, manifest files are all over the content sets I deal with and the dictionary definition seemed close enough (&quot;ships manifest&quot;). However how about ChangeListEntityProcessor&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
       &amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;jc&quot;&lt;/span&gt;
               processor=&lt;span class=&quot;code-quote&quot;&gt;&quot;ManifestEntityProcessor&quot;&lt;/span&gt;
               baseDir=&lt;span class=&quot;code-quote&quot;&gt;&quot;/Volumes/Techmore/ts/aaa/schema/data&quot;&lt;/span&gt;
               rootEntity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;
               dataSource=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;

               allowRegex=&lt;span class=&quot;code-quote&quot;&gt;&quot;^.*\.xml$&quot;&lt;/span&gt;
               blockRegex=&lt;span class=&quot;code-quote&quot;&gt;&quot;usc2009&quot;&lt;/span&gt;
               manifestFileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;/Volumes/ts/man-find.txt&quot;&lt;/span&gt;
               docAddRegex=&lt;span class=&quot;code-quote&quot;&gt;&quot;.*&quot;&lt;/span&gt;
               &amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The new entity fields are as follows.&lt;/p&gt;

&lt;p&gt;   &lt;b&gt;manifestFileName&lt;/b&gt; is the required location of the manifest file. If this value is relative, it assumed to be relative to baseDir.&lt;/p&gt;

&lt;p&gt;   &lt;b&gt;allowRegex&lt;/b&gt; is an optional attribute that if present discards any line which does not match the regExp&lt;/p&gt;

&lt;p&gt;   &lt;b&gt;blockRegex&lt;/b&gt; is an optional attribute that is applied after any allowRegex and discards any line which matches the regExp&lt;/p&gt;

&lt;p&gt;   &lt;b&gt;docAddRegex&lt;/b&gt; is a required regex to identify lines which when matched should cause docs to be added to the index. As well as matching the line it should also return the portion of the line which contains the filepath as group(1)&lt;/p&gt;

&lt;p&gt;   &lt;b&gt;docDeleteRegex&lt;/b&gt; is an optional value of a regex to identify documents which when matched should be deleted from the index. As well as matching the line it should also return the portion of the line which contains the filepath as group(1) *&lt;b&gt;PLANNED&lt;/b&gt;*&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12416546">SOLR-1060</key>
            <summary>a new DIH EnityProcessor allowing text file lists of files to be indexed</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalinmangar">Shalin Shekhar Mangar</assignee>
                                    <reporter username="fergus">Fergus McMenemie</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Mar 2009 15:30:58 +0000</created>
                <updated>Tue, 10 Nov 2009 15:51:59 +0000</updated>
                            <resolved>Mon, 20 Apr 2009 11:13:39 +0100</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.4</fixVersion>
                                    <component>contrib - DataImportHandler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <timeoriginalestimate seconds="432000">120h</timeoriginalestimate>
                            <timeestimate seconds="432000">120h</timeestimate>
                                        <comments>
                            <comment id="12680753" author="noble.paul" created="Wed, 11 Mar 2009 04:34:18 +0000"  >&lt;p&gt;few comments. &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;ChangeListEntityProcessor is preferred over ManifestEntityProcessor. manifestFileName can be changed to fileName&lt;/li&gt;
	&lt;li&gt;&apos;allowRegex&apos; and blockRegex can be renamed to something else .how about acceptLineRegex and omitLineRegex&lt;/li&gt;
	&lt;li&gt;dataSource=&apos;null&apos; is not required from 1.4 onwards.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12680945" author="fergus" created="Wed, 11 Mar 2009 17:49:41 +0000"  >&lt;p&gt;This is by no means the finished article. It has no test case and only deals with a list file on disk, further the list file can only refer to files that are also on disk. None of the URI stuff is there yet, I guess I ran out of brain power and could not find anything suitable to copy and rework. Having a baseDir feature that seamlessly applies to both www and disk cases is a pain.&lt;/p&gt;

&lt;p&gt;However I have implemented all the suggestions and given it a good testing, works for me.&lt;/p&gt;</comment>
                            <comment id="12681616" author="fergus" created="Fri, 13 Mar 2009 05:32:20 +0000"  >&lt;p&gt;I am working on minor changes to the (now inappropriatly named) HttpDataSource to allow it to access &lt;a href=&quot;file://&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file://&lt;/a&gt; based resources more cleanly. It should IMHO have been called URIDataSource.&lt;/p&gt;

&lt;p&gt;I am also rewriting ChangeListEntityProcessor to allow it to cooperate with a child entity which is using either HttpDataSource or FileDataSource. This cooperation will not be automatic, the person setting up the data-config.xml will need to take account of which datasource the child is using when configuring the parent ChangeListEntityProcessor. And of course IMHO ... FileDataSource should actually have been called diskDataSource or filesysDataSource&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12681620" author="shalinmangar" created="Fri, 13 Mar 2009 05:49:52 +0000"  >&lt;p&gt;I haven&apos;t had a chance to look at the patch yet. But some general comments/questions:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Looks like the ChangeListEntityProcessor is trying to do two things &amp;#8211; read a file line by line and process according to add/delete instructions&lt;/li&gt;
	&lt;li&gt;How about we have a LineEntityProcessor (we can change the name) which just reads text files line by line and a ChangeListEntityProcessor which extends LineEntityProcessor and detects/processes changes according to the regex? This can enable someone to write a CSVTransformer on top of LineEntityProcessor for instance.&lt;/li&gt;
	&lt;li&gt;Is it necessary to change the semantics of HttpDataSource? It was meant to read an HTTP response and one should use FileDataSource for reading files. Why mix the functionalities at all?&lt;/li&gt;
	&lt;li&gt;What is the cooperation that needs to be built with ChangeListEntityProcessor and HTTP/File DataSource?&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="12681629" author="fergus" created="Fri, 13 Mar 2009 06:46:31 +0000"  >&lt;ol&gt;
	&lt;li&gt;Correct.&lt;/li&gt;
	&lt;li&gt;Great idea I am fine with that; but the next patch I submit, will still do both. I will work on seperating them once it is working.&lt;/li&gt;
	&lt;li&gt;Sort of; it either needs a change or we need a new URLDataSource. FileDataSource is fine for reading files from filesystems but it does not handle the &lt;a href=&quot;file://&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file://&lt;/a&gt; syntax. HttpDataSource already half supports reading from &lt;a href=&quot;file://&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file://&lt;/a&gt; locations (if the URL does not contain the protocol string http:// then baseUrl can be used to add any protocol!). But after considering the input from Otis Gospodnetic, Paul Libbrecht and thinking for a bit; It seemed reasonable that the location of the ChangeList could be specified using &lt;a href=&quot;file:///&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:///&lt;/a&gt; of http:// syntax as well as using plain old filesystem syntax. Likewise the lines within the ChangeList could use either URL or filesystem syntax, this in turn also applied to the baseDir.&lt;/li&gt;
	&lt;li&gt;I have been playing about with ChangeListEntityProcessor feeding rows to XPathEntityProcessor. ChangeListEntityProcessor currently supports use of either FileDataSource or HttpDataSource by XPathEntityProcessor. However depending which DataSource is specified within XPathEntityProcessor then ChangeListEntityProcessor needs to be configured to return rows with the approriatle syntax. (i Think!)&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="12681630" author="shalinmangar" created="Fri, 13 Mar 2009 07:26:33 +0000"  >&lt;p&gt;My concern is that we have two data sources whose names identify their respective functionality. With this change FileDataSource becomes redundant and HttpDataSource does not give the impression that it can read files too. I assume that everyone will be generating the changeset using their own sweet tools/programs. Therefore it is a simple task for the changeset generator to generate http/file separately or mark them differently. Then one can use different root entities.&lt;/p&gt;

&lt;p&gt;The ChangeListEntityProcessor should not care whether the changelist contains a filepath or url &amp;#8211; they are all strings to it which should be added to a map and passed along. If it is a delete set, then it should set $deleteDocByQuery or $deleteDocById along with $skipDoc and return. The ChangeListEntityProcessor should not try to collaborate with any other entity. It does not need to know about them just as current EntityProcessor do not know about each other.&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dataConfig&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dataSource name=&lt;span class=&quot;code-quote&quot;&gt;&quot;file&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;FileDataSource&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;document&amp;gt;&lt;/span&gt;
    &amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;changeSet&quot;&lt;/span&gt; processor=&lt;span class=&quot;code-quote&quot;&gt;&quot;ChangeSetEntityProcessor&quot;&lt;/span&gt;
            rootEntity=&lt;span class=&quot;code-quote&quot;&gt;&quot;false&quot;&lt;/span&gt;
            allowRegex=&lt;span class=&quot;code-quote&quot;&gt;&quot;^.*\.xml$&quot;&lt;/span&gt;
            blockRegex=&lt;span class=&quot;code-quote&quot;&gt;&quot;usc2009&quot;&lt;/span&gt;
            manifestFileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;/Volumes/ts/man-find.txt&quot;&lt;/span&gt;
            docAddRegex=&lt;span class=&quot;code-quote&quot;&gt;&quot;.*&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;indexer&quot;&lt;/span&gt; processor=&lt;span class=&quot;code-quote&quot;&gt;&quot;XPathEntityProcessor&quot;&lt;/span&gt;
              dataSource=&lt;span class=&quot;code-quote&quot;&gt;&quot;file&quot;&lt;/span&gt;
              forEach=&lt;span class=&quot;code-quote&quot;&gt;&quot;/root/a&quot;&lt;/span&gt;
              url=&lt;span class=&quot;code-quote&quot;&gt;&quot;${changeSet.filename}&quot;&lt;/span&gt;&amp;gt;

      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/entity&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/entity&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/document&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dataConfig&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here the $&lt;/p&gt;
{changeSet.filename}
&lt;p&gt; is just a normal key/val in the changeSet entity&apos;s row map.&lt;/p&gt;</comment>
                            <comment id="12681637" author="noble.paul" created="Fri, 13 Mar 2009 08:18:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;How about we have a LineEntityProcessor (we can change the name) which just reads text files line by line and a ChangeListEntityProcessor which extends LineEntityProcessor&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Does the ChangeListEntityProcessor have to be an EntityProcessor? EntityProcessors are heavyweight components. They are complex and ugly. What stops it from being a Transformer .  A Transformer is simple and it can do almost everything an EntityProcessor does .  The only thing a Transformer does not do is that it does not usually generate it&apos;s own data from a DataSource &lt;/p&gt;

&lt;p&gt;This is a just a thought.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;. FileDataSource is fine for reading files from filesystems but it does not handle the &lt;a href=&quot;file://&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file://&lt;/a&gt; syntax. HttpDataSource already half supports reading from &lt;a href=&quot;file://&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file://&lt;/a&gt; locations (if the URL does not contain the protocol string http:// then baseUrl can be used to add any protocol!). &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Is it a possibility that the kind of data source is not known in advance? Then the user will be able to configure an appropriate data source for that entity?&lt;/p&gt;</comment>
                            <comment id="12681649" author="fergus" created="Fri, 13 Mar 2009 09:17:27 +0000"  >&lt;p&gt;Oh dear, this is getting complicated!&lt;/p&gt;

&lt;p&gt;&quot;My concern is that we have two data sources whose names identify their respective functionality. With this change FileDataSource becomes redundant and HttpDataSource does not give the impression that it can read files too. I assume that everyone will be generating the changeset using their own sweet tools/programs. Therefore it is a simple task for the changeset generator to generate http/file separately or mark them differently. Then one can use different root entities.&quot;&lt;/p&gt;

&lt;p&gt;Hmmmm, no I am not sure about this. &lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Firstly I agree &quot;FileDataSource becomes redundant and HttpDataSource .. can read files&quot;; bit of a mess really. Ideally I think we need a new dataSource that can read from either a FileSystem or a URI.&lt;/li&gt;
	&lt;li&gt;I the poor old content indexer am often presented with the manifest fait accompli. It comes as part of the update kit, I have little or no control of its format. I would have to organise some middle-ware to sort its format if we restrict DIH. Which would be a pity since the proposed changes should allow solr to directly handle every case I have seen, and I suspect it is well over 80% of the usecase.&lt;/li&gt;
	&lt;li&gt;Even if the lines read from the changelist are simple filepaths, how we access those files will depend on other factors. They could be on a local or remote machine. The lines read from the file will not indicate this. As Nobel implies we may not know this ahead of time, we need to be able to pass parameters into the system which supplies that information.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&amp;lt;thinking out loud&amp;gt;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;We need to be able to &lt;b&gt;read lines&lt;/b&gt; describing changes we &lt;b&gt;may&lt;/b&gt; wish to make to our index from a &lt;a href=&quot;file://&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file://&lt;/a&gt; or a restful web service or URL.&lt;/li&gt;
	&lt;li&gt;The lines read will need analysed for two purposes. a) to identify the portion of the line we are interested in b) to reformat that portion such that it can be passed to the child entity which will in turn pass it to a dataSource.&lt;/li&gt;
	&lt;li&gt;We do not know which dataSource the child entity may be using which make the reformating stage 2b) a bit more tricky. Hence the required cooperation.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;1) and 2a) could be done by changeListEntityProcessor (As Noble says we need an EntityProcessor because it is generating data... without even a datasource!)&lt;br/&gt;
2b) could be done by a transformer, information will need to be available to the transformer to allow it deal with local or remote access. &lt;br/&gt;
3)?????&lt;br/&gt;
&amp;lt;/thinking out loud&amp;gt;&lt;/p&gt;

&lt;p&gt;For the moment I was intending to build 1)2a)2b) into the ChangeListEntityProcessor, it does not appear to be bad. Once done perhaps we can look again at a need to lift 2b) into a separate EntityProcessor or Transformer.&lt;/p&gt;</comment>
                            <comment id="12681653" author="fergus" created="Fri, 13 Mar 2009 09:25:35 +0000"  >&lt;p&gt;Oh and by the way. The &quot;Configuration of HttpDataSource&quot; section of the DIH wiki, where it describes the entity URL attribute,  says...&lt;/p&gt;

&lt;p&gt;&lt;b&gt;url&lt;/b&gt; (required) : The url used to invoke the REST API. (Can be templatized). if the data souce is file this must be the file location&lt;/p&gt;

&lt;p&gt;So I guess the cat is already out of the bag about HttpDataSource reading &lt;a href=&quot;file://&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file://&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12681654" author="noble.paul" created="Fri, 13 Mar 2009 09:34:05 +0000"  >&lt;p&gt;Fergus . it is not a bad idea to have a URIDataSource if that simplifies the problem. The UriDataSource can wrap FiledataSource/HttpDataSource (if that is convenient) . &lt;/p&gt;</comment>
                            <comment id="12681665" author="fergus" created="Fri, 13 Mar 2009 10:07:13 +0000"  >&lt;p&gt;A couple of lines changed to HttpDataSource and we have a UriDataSource!&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (query.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&quot;&lt;/span&gt;)) {
-        url = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URL(query);
-      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
-        url = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URL(baseUrl + query);
-      }
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( URIMETHOD.matcher(query).find()) url = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URL(query);
+      &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; url = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URL(baseUrl + query);
...
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Pattern URIMETHOD = Pattern.compile(&lt;span class=&quot;code-quote&quot;&gt;&quot;\\w{3,}:&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As I said at the start. HttpDataSource already half supports other protocols, its just that it assumes http: when deciding whether to prepend the baseUrl. A minor bug probably. Is it worth wraping? Also; given the cat is already out of the bag, shouldnt we just tweak HttpDataSource?&lt;/p&gt;</comment>
                            <comment id="12681682" author="noble.paul" created="Fri, 13 Mar 2009 11:36:30 +0000"  >&lt;p&gt;OK. Let us do this&lt;/p&gt;

&lt;p&gt;make the change to HttpDataSource and then create a new DataSource URIDataSource extends HttpDataSource.&lt;br/&gt;
 So users can use both in this release .and let us deprecate HttpDataSource  in favor of URIDataSource in the future&lt;/p&gt;</comment>
                            <comment id="12682320" author="fergus" created="Mon, 16 Mar 2009 14:04:12 +0000"  >&lt;p&gt;I have rewritten and tested the ChangeListEntityProcessor such that it supports URL&apos;s. This allows the list of changes to fetched from a local file, a simple URL or any restful type web service. The list of changes must appear as one change per line read, the line can contain an absolute &lt;a href=&quot;file:///&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:///&lt;/a&gt; or http:// pathnames or it can be a relative pathname. The entity attribute baseLocation specifies a prefix to be used with relative pathnames. baseLocation must be a valid URL; &lt;a href=&quot;file:///&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:///&lt;/a&gt; or http:// for the moment. The entity attributes are as follows&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;b&gt;FileName&lt;/b&gt; is the required URL location of the change list. If this value is relative, it assumed to be relative to baseLocation.&amp;lt;/li&amp;gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;acceptLineRegex&lt;/b&gt; is an optional attribute that if present discards any line read from the change list which &lt;b&gt;does not&lt;/b&gt; match the regExp.&amp;lt;/li&amp;gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;omitLineRegex&lt;/b&gt; is an optional attribute that is applied after any acceptLineRegex and discards any line read from the change list which matches the regExp.&amp;lt;/li&amp;gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;docAddRegex&lt;/b&gt; is an optional regex to identify lines which when matched should cause docs to be added to the index. As well as matching the line it should also return the portion of the line which is to be treated as the pathname, as group(1). If not specified the whole line is assumed to be valid pathname.&amp;lt;/li&amp;gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;docDeleteRegex&lt;/b&gt; is an optional value of a regex to identify documents which when matched should be deleted from the index. As well as matching the line it should also return the portion of the line which contains the filepath as group(1) &lt;b&gt;PLANNED WORK see &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1059&quot; title=&quot;Add special variables for deleting documents, skipping rows and transforms in DIH&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1059&quot;&gt;&lt;del&gt;SOLR-1059&lt;/del&gt;&lt;/a&gt;&lt;/b&gt;&amp;lt;/li&amp;gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;baseLocation&lt;/b&gt; is a required prefix added to fileName or lines read from the change list which do not appear to be absolute http:// or &lt;a href=&quot;file:///&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:///&lt;/a&gt; URL&apos;s&amp;lt;/li&amp;gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Here is a sample of the way I used it:-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
       &amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;jc&quot;&lt;/span&gt;
               processor=&lt;span class=&quot;code-quote&quot;&gt;&quot;ChangeListEntityProcessor&quot;&lt;/span&gt;
               acceptLineRegex=&lt;span class=&quot;code-quote&quot;&gt;&quot;^.*\.xml$&quot;&lt;/span&gt;
               omitLineRegex=&lt;span class=&quot;code-quote&quot;&gt;&quot;usc2009&quot;&lt;/span&gt;
               fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/ts/man-findlsurl.txt&quot;&lt;/span&gt;
&lt;/span&gt;               rootEntity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;
               dataSource=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;
               baseLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost/ford/&quot;&lt;/span&gt;
&lt;/span&gt;               docAddRegex=&lt;span class=&quot;code-quote&quot;&gt;&quot;\s+([^ ]*)$&quot;&lt;/span&gt;
               &amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This entity returns a row containing a single &quot;fileAbsolutePath&quot; field for each pathname accepted from the changelist. If the docDeleteRegex was matched then another fields will also be returned $deleteDocId=?? and  $deleteDocQuery=??. What do I need to set these values to?&lt;/p&gt;

&lt;p&gt;I have also created a URLDataSource, it seems to work. However &quot;an expert&quot; had better review what I have done; I am still very inexperienced re Java best practice. On that topic; why did we not rename the existing httpDataSource to URLDataSource and then make httpDataSource a wrapper for URLDataSource?&lt;/p&gt;

&lt;p&gt;Testing with my sample of 40000 documents reveals no noticible slowdown compared with FileListEntiryProcessor.&lt;/p&gt;</comment>
                            <comment id="12682325" author="fergus" created="Mon, 16 Mar 2009 14:20:19 +0000"  >&lt;p&gt;Ooooups. Another version of patch, but formated how ASF like things formated. I forgot to mention that I also changed httpDataSource and fileDataSource as follows&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;harmonised the LOG messages for the individual files processed. Making them equivilent and only outputing at DEBG level.&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;httpDataSource was altered to making it a generic URL reader and of course URLDataSource it merly a wrapper around it.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="12682329" author="shalinmangar" created="Mon, 16 Mar 2009 15:01:19 +0000"  >&lt;p&gt;This is great!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;$deleteDocId=?? and $deleteDocQuery=??. What do I need to set these values to?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Set them to a boolean as a string.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;why did we not rename the existing httpDataSource to URLDataSource and then make httpDataSource a wrapper for URLDataSource?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1. Let&apos;s do this.&lt;/p&gt;</comment>
                            <comment id="12682382" author="noble.paul" created="Mon, 16 Mar 2009 17:34:46 +0000"  >&lt;p&gt;Hi fergus ,&lt;br/&gt;
did you consider splitting the ChangeListEntityProcessor into two&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;LineEntityprocessor and&lt;/li&gt;
	&lt;li&gt;ChangeListEntityprocessor extends LineEntityprocessor&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Tomorrow some one is definitely going to ask for a Line EntityProcessor. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;why did we not rename the existing httpDataSource to URLDataSource&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12682441" author="fergus" created="Mon, 16 Mar 2009 20:06:56 +0000"  >&lt;p&gt;Yes, briefly, I did and could not see how it could be done nicely; however it is quite possible I am misunderstanding things..&lt;/p&gt;

&lt;p&gt;To recap, the idea was to split &quot;ChangeListEntityProcessor&quot; into two halves. The first half would deal with reading lines from a &lt;a href=&quot;file:///&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:///&lt;/a&gt; or http:// locations with features to allow lines to be omitted or accepted. The second half would focus on analyzing the line turning it into add/delete instructions and identifying the portion of the lines which was to be operated on. Is this correct?&lt;/p&gt;

&lt;p&gt;If my understanding is correct. Then if baseLocation was allowed to be empty and &quot;docAddRegex&quot; and &quot;docDeleteRegex&quot; are not supplied then the line from the changelist could be returned by the entity exactly as read from the file. Further; if &quot;acceptLineRegex&quot; and &quot;omitLineRegex&quot; are also undefined then the whole file is returned to the next entity. Would that make it the same as part one?&lt;/p&gt;

&lt;p&gt;I had looked at removing all my code for doing the second half described above, replacing it with a transformers. I guess as long as the templatetransformer can assign to the fields $deleteDocId and $deleteDocQuery then it is do-able. Is the following valid? In the following I always assign to $deleteDocQuery but make $deleteDocId true/false to control actual deletion.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;jc&quot;&lt;/span&gt;
           processor=&lt;span class=&quot;code-quote&quot;&gt;&quot;ChangeListEntityProcessor&quot;&lt;/span&gt;
           fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/ts/man-findlsurl.txt&quot;&lt;/span&gt;
&lt;/span&gt;           rootEntity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;
           baseLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost/ford/&quot;&lt;/span&gt;
&lt;/span&gt;           transformer=&lt;span class=&quot;code-quote&quot;&gt;&quot;TemplateTransformer,RegexTransformer&quot;&lt;/span&gt;&amp;gt;
           &amp;gt;
&amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;                regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;.*(-- find jucy bit--).*&quot;&lt;/span&gt; replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;$1&quot;&lt;/span&gt; \&amp;gt;
&amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;$deleteDocQuery&quot;&lt;/span&gt;   regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;.*(-- find jucy bit--).*&quot;&lt;/span&gt; replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;$1&quot;&lt;/span&gt;      sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;$deleteDocId&quot;&lt;/span&gt;      template=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;   regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;.*(-- find add/del bit--).*&quot;&lt;/span&gt; replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath&quot;&lt;/span&gt;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;?&lt;/p&gt;</comment>
                            <comment id="12682551" author="noble.paul" created="Tue, 17 Mar 2009 04:09:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;To recap, the idea was to split &quot;ChangeListEntityProcessor&quot; into two halves. The first half would ....&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;right&lt;/p&gt;

&lt;p&gt;The second part may become a bit easier with &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1061&quot; title=&quot;Improve RegexTransformer to create multiple columns from regex groups&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1061&quot;&gt;&lt;del&gt;SOLR-1061&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="12682636" author="fergus" created="Tue, 17 Mar 2009 11:20:16 +0000"  >&lt;p&gt;Ok. I will try and see if I can make do as outlined above.&lt;/p&gt;

&lt;p&gt;However I still dont think I have got the use of $deleteDocQuery $deleteDocId understood properly. Shalin says they are a boolean and a string. Yet Solr-1059 implies they are both strings.&lt;/p&gt;

&lt;p&gt;Now following the information from Solr-1059 I think I need to set $deleteDocQuery to a valid Solr query. If so my entity needs to know the solr field name to use and what it contains; I do not have control of these items. I either need to mandate to the user that for deletes to function the field, say &quot;fileAbsolutePath&quot;, has to be defined in the schema.xml and it must be equal to the filename returned by the entity. I am trying to test this today... I am not sure the transformers provide the flexibility I need to do everything.&lt;/p&gt;</comment>
                            <comment id="12682644" author="shalinmangar" created="Tue, 17 Mar 2009 11:39:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;Shalin says they are a boolean and a string. Yet Solr-1059 implies they are both strings.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;del&gt;Sorry for the confusion. I meant that the value should be &quot;true&quot; or &quot;false&quot; (boolean values as a string type)&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;I don&apos;t know what I was thinking when I wrote that. I&apos;m still stuck in the boolean world of $skipDoc etc. Please disregard my mumblings. Yes, they are both strings.&lt;/p&gt;</comment>
                            <comment id="12682802" author="fergus" created="Tue, 17 Mar 2009 21:01:38 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I have the following snippet from my data-config.xml. This is after removing all code from ChangeListEntityProcessor which deals with finding the juicy part of the line. However I get tracebacks when ever I start tomcat saying that my schema.xml has no mention of $deleteQuery. Do I have to declare a field $deleteQuery in my schema.xml; if so it is rather ugly!&lt;/p&gt;

&lt;p&gt;I was wondering if perhaps field/column names beginning with &apos;$&apos; could be considered magic, or some fashion local to data-config.xml and skip whatever check is causing tomcat to bomb. With the new power of transformers I could see a need for &quot;temporary variables&quot; within data-config.xml&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Mar 17, 2009 8:54:31 PM org.apache.solr.handler.dataimport.DataImporter loadDataConfig
INFO: Data Configuration loaded successfully
Mar 17, 2009 8:54:31 PM org.apache.solr.handler.dataimport.DataImportHandler inform
SEVERE: Exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; loading DataImporter
org.apache.solr.handler.dataimport.DataImportHandlerException: There are errors in the Schema
The field :$deleteQuery present in DataConfig does not have a counterpart in Solr Schema

	at org.apache.solr.handler.dataimport.DataImporter.&amp;lt;init&amp;gt;(DataImporter.java:109)
	at org.apache.solr.handler.dataimport.DataImportHandler.inform(DataImportHandler.java:96)
	at org.apache.solr.core.SolrResourceLoader.inform(SolrResourceLoader.java:388)
	at org.apache.solr.core.SolrCore.&amp;lt;init&amp;gt;(SolrCore.java:571)
	at org.apache.solr.core.CoreContainer$Initializer.initialize(CoreContainer.java:122)
	at org.apache.solr.servlet.SolrDispatchFilter.init(SolrDispatchFilter.java:69)
	at org.apache.catalina.core.ApplicationFilterConfig.getFilter(ApplicationFilterConfig.java:223)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;dataConfig&amp;gt;
  &amp;lt;dataSource name=&lt;span class=&quot;code-quote&quot;&gt;&quot;myFILEreader&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;FileDataSource&quot;&lt;/span&gt;/&amp;gt;    
  &amp;lt;dataSource name=&lt;span class=&quot;code-quote&quot;&gt;&quot;myURIreader&quot;&lt;/span&gt;  type=&lt;span class=&quot;code-quote&quot;&gt;&quot;URLDataSource&quot;&lt;/span&gt; /&amp;gt;    
    &amp;lt;document&amp;gt;
      &amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;jc&quot;&lt;/span&gt;
               processor=&lt;span class=&quot;code-quote&quot;&gt;&quot;ChangeListEntityProcessor&quot;&lt;/span&gt;
               acceptLineRegex=&lt;span class=&quot;code-quote&quot;&gt;&quot;^.*\.xml$&quot;&lt;/span&gt;
               omitLineRegex=&lt;span class=&quot;code-quote&quot;&gt;&quot;usc2009&quot;&lt;/span&gt;
               fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/man-findlsurl.txt&quot;&lt;/span&gt;
&lt;/span&gt;	       rootEntity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;
	       dataSource=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;
               baseLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/ford&quot;&lt;/span&gt;
&lt;/span&gt;	       transformer=&lt;span class=&quot;code-quote&quot;&gt;&quot;RegexTransformer&quot;&lt;/span&gt;
	       &amp;gt;
	&amp;lt;!-- the following columns are only defined &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the regex matches --&amp;gt;
	&amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath&quot;&lt;/span&gt;    regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;\s+([^ ]*)$&quot;&lt;/span&gt; replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;${jc.baseLocation}/$1&quot;&lt;/span&gt;  sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;rawLine&quot;&lt;/span&gt;/&amp;gt;
	&amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;$deleteQuery&quot;&lt;/span&gt;        regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;^DELETE\s+&quot;&lt;/span&gt;  replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;${jc.fileAbsolutePath}&quot;&lt;/span&gt; sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;rawLine&quot;&lt;/span&gt;/&amp;gt; 	       

	&amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;x&quot;&lt;/span&gt;
		dataSource=&lt;span class=&quot;code-quote&quot;&gt;&quot;myurireader&quot;&lt;/span&gt;
		processor=&lt;span class=&quot;code-quote&quot;&gt;&quot;XPathEntityProcessor&quot;&lt;/span&gt;
		url=&lt;span class=&quot;code-quote&quot;&gt;&quot;${jc.fileAbsolutePath}&quot;&lt;/span&gt;
		rootEntity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;
		flatten=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;
		stream=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;
		forEach=&lt;span class=&quot;code-quote&quot;&gt;&quot;/record | /record/mediaBlock&quot;&lt;/span&gt;
		transformer=&lt;span class=&quot;code-quote&quot;&gt;&quot;DateFormatTransformer,TemplateTransformer,RegexTransformer&quot;&lt;/span&gt;&amp;gt;

&amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath&quot;&lt;/span&gt;                 template=&lt;span class=&quot;code-quote&quot;&gt;&quot;${jc.fileAbsolutePath}&quot;&lt;/span&gt; /&amp;gt;
&amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileWebPath&quot;&lt;/span&gt;                      template=&lt;span class=&quot;code-quote&quot;&gt;&quot;${jc.fileAbsolutePath}&quot;&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;${dataimporter.request.fordinstalldir}(.*)&quot;&lt;/span&gt; replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;/ford$1&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileWebDir&quot;&lt;/span&gt;                       regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;(.*)/.*&quot;&lt;/span&gt; replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;$1&quot;&lt;/span&gt; sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileWebPath&quot;&lt;/span&gt;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12682897" author="shalinmangar" created="Wed, 18 Mar 2009 03:33:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;However I get tracebacks when ever I start tomcat saying that my schema.xml has no mention of $deleteQuery. Do I have to declare a field $deleteQuery in my schema.xml; if so it is rather ugly!&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;EntityProcessorBase should remove such variables after using them. Glancing at the code, I think we will see the same problem if we put $skipDoc as &quot;false&quot;. We need to update the &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1059&quot; title=&quot;Add special variables for deleting documents, skipping rows and transforms in DIH&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1059&quot;&gt;&lt;del&gt;SOLR-1059&lt;/del&gt;&lt;/a&gt; patch.&lt;/p&gt;</comment>
                            <comment id="12682903" author="noble.paul" created="Wed, 18 Mar 2009 03:55:24 +0000"  >&lt;p&gt;shalin we need to remove the check done in DataImporter for variables being present &lt;/p&gt;</comment>
                            <comment id="12683014" author="fergus" created="Wed, 18 Mar 2009 13:19:06 +0000"  >&lt;p&gt;Thanks for the changes to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1059&quot; title=&quot;Add special variables for deleting documents, skipping rows and transforms in DIH&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1059&quot;&gt;&lt;del&gt;SOLR-1059&lt;/del&gt;&lt;/a&gt;. I am now attempting to test document deletion; it is not going too well!&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Mar 18, 2009 1:12:48 PM org.apache.solr.core.SolrCore execute
INFO: [] webapp=/apache-solr-1.4-dev path=/dataimport params={command=full-&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt;&amp;amp;clean=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;entity=single-delete&amp;amp;single=/Volumes/spare/ts/schema/data/news/fdw2008/jn71796.xml} status=0 QTime=1 
Mar 18, 2009 1:12:48 PM org.apache.solr.handler.dataimport.SolrWriter readIndexerProperties
INFO: Read dataimport.properties
Mar 18, 2009 1:12:48 PM org.apache.solr.handler.dataimport.DataImporter doFullImport
INFO: Starting Full Import
Mar 18, 2009 1:12:48 PM org.apache.solr.handler.dataimport.SolrWriter readIndexerProperties
INFO: Read dataimport.properties
Mar 18, 2009 1:12:48 PM org.apache.solr.handler.dataimport.SolrWriter upload
WARNING: Error creating document : SolrInputDocument[{}]
org.apache.solr.common.SolrException: Document [&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] missing required field: vdkvgwkey
	at org.apache.solr.update.DocumentBuilder.toDocument(DocumentBuilder.java:292)
	at org.apache.solr.update.processor.RunUpdateProcessor.processAdd(RunUpdateProcessorFactory.java:59)
	at org.apache.solr.handler.dataimport.SolrWriter.upload(SolrWriter.java:67)
	at org.apache.solr.handler.dataimport.DataImportHandler$1.upload(DataImportHandler.java:274)
	at org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:373)
	at org.apache.solr.handler.dataimport.DocBuilder.doFullDump(DocBuilder.java:221)
	at org.apache.solr.handler.dataimport.DocBuilder.execute(DocBuilder.java:163)
	at org.apache.solr.handler.dataimport.DataImporter.doFullImport(DataImporter.java:309)
	at org.apache.solr.handler.dataimport.DataImporter.runCmd(DataImporter.java:367)
	at org.apache.solr.handler.dataimport.DataImporter$1.run(DataImporter.java:348)
Mar 18, 2009 1:12:48 PM org.apache.solr.handler.dataimport.SolrWriter upload
WARNING: Error creating document : SolrInputDocument[{}]
org.apache.solr.common.SolrException: Document [&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] missing required field: vdkvgwkey
	at org.apache.solr.update.DocumentBuilder.toDocument(DocumentBuilder.java:292)
	at org.apache.solr.update.processor.RunUpdateProcessor.processAdd(RunUpdateProcessorFactory.java:59)
	at org.apache.solr.handler.dataimport.SolrWriter.upload(SolrWriter.java:67)
	at org.apache.solr.handler.dataimport.DataImportHandler$1.upload(DataImportHandler.java:274)
	at org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:373)
	at org.apache.solr.handler.dataimport.DocBuilder.doFullDump(DocBuilder.java:221)
	at org.apache.solr.handler.dataimport.DocBuilder.execute(DocBuilder.java:163)
	at org.apache.solr.handler.dataimport.DataImporter.doFullImport(DataImporter.java:309)
	at org.apache.solr.handler.dataimport.DataImporter.runCmd(DataImporter.java:367)
	at org.apache.solr.handler.dataimport.DataImporter$1.run(DataImporter.java:348)
Mar 18, 2009 1:12:48 PM org.apache.solr.handler.dataimport.SolrWriter upload
WARNING: Error creating document : SolrInputDocument[{}]
org.apache.solr.common.SolrException: Document [&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] missing required field: vdkvgwkey
	at org.apache.solr.update.DocumentBuilder.toDocument(DocumentBuilder.java:292)
	at org.apache.solr.update.processor.RunUpdateProcessor.processAdd(RunUpdateProcessorFactory.java:59)
	at org.apache.solr.handler.dataimport.SolrWriter.upload(SolrWriter.java:67)
	at org.apache.solr.handler.dataimport.DataImportHandler$1.upload(DataImportHandler.java:274)
	at org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:373)
	at org.apache.solr.handler.dataimport.DocBuilder.doFullDump(DocBuilder.java:221)
	at org.apache.solr.handler.dataimport.DocBuilder.execute(DocBuilder.java:163)
	at org.apache.solr.handler.dataimport.DataImporter.doFullImport(DataImporter.java:309)
	at org.apache.solr.handler.dataimport.DataImporter.runCmd(DataImporter.java:367)
	at org.apache.solr.handler.dataimport.DataImporter$1.run(DataImporter.java:348)
Mar 18, 2009 1:12:48 PM org.apache.solr.handler.dataimport.DocBuilder execute
INFO: Time taken = 0:0:0.41

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;my entity is as follows:-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     &amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;single-delete&quot;&lt;/span&gt;
		 dataSource=&lt;span class=&quot;code-quote&quot;&gt;&quot;myFILEreader&quot;&lt;/span&gt;
		 processor=&lt;span class=&quot;code-quote&quot;&gt;&quot;XPathEntityProcessor&quot;&lt;/span&gt;
		 url=&lt;span class=&quot;code-quote&quot;&gt;&quot;${dataimporter.request.single}&quot;&lt;/span&gt;
		 rootEntity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;
		 flatten=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;
		 stream=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;
		 forEach=&lt;span class=&quot;code-quote&quot;&gt;&quot;/record | /record/mediaBlock&quot;&lt;/span&gt;
		 transformer=&lt;span class=&quot;code-quote&quot;&gt;&quot;RegexTransformer&quot;&lt;/span&gt;&amp;gt;

      &amp;lt;!-- the following columns are only defined &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the regex matches --&amp;gt;
      &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath&quot;&lt;/span&gt;    template=&lt;span class=&quot;code-quote&quot;&gt;&quot;${dataimporter.request.single}&quot;&lt;/span&gt; /&amp;gt; 
      &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;$deleteQuery&quot;&lt;/span&gt;        template=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath:${dataimporter.request.single}&quot;&lt;/span&gt; /&amp;gt; 	       
      &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;vdkvgwkey&quot;&lt;/span&gt;           template=&lt;span class=&quot;code-quote&quot;&gt;&quot;${dataimporter.request.single}&quot;&lt;/span&gt; /&amp;gt; 
      &amp;lt;/entity&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And repeating what was shown in the traceback my test was:-&lt;/p&gt;

&lt;p&gt;get &apos;http://localhost:8080/apache-solr-1.4-dev/dataimport?command=full-import&amp;amp;entity=single-delete&amp;amp;clean=false&amp;amp;single=/Volumes/spare/ts/ford/schema/data/news/fdw2008/jn71796.xml&apos;&lt;/p&gt;</comment>
                            <comment id="12683301" author="noble.paul" created="Thu, 19 Mar 2009 03:54:10 +0000"  >&lt;p&gt;hi Fergus, &lt;br/&gt;
The issue here is that when there is a $deleteQuery /$deleteId is present the document is still tried to be inserted . One way is to do a $skipDoc in the same row. or we can add a check to DIH to avoid inserting doc if the uniqueKey is absent . &lt;/p&gt;

</comment>
                            <comment id="12683346" author="fergus" created="Thu, 19 Mar 2009 06:58:46 +0000"  >&lt;p&gt;I do like SOLR complaining if the ID is missing or not uniqueue. Or I guess I need to set $skipDoc=&quot;true&quot; (is that syntax correct?). However I think that $skipDoc should be invoked internally whenever $deleteQuery /$deleteId is present.&lt;/p&gt;

&lt;p&gt;For the moment I will try $skipDoc=&quot;true&quot; using an extra transform.&lt;/p&gt;</comment>
                            <comment id="12683362" author="noble.paul" created="Thu, 19 Mar 2009 08:37:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;I do like SOLR complaining if the ID is missing&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The only problem with this solution is it may not work if &amp;lt;uniqueKey&amp;gt; is not specifie&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I guess I need to set $skipDoc=&quot;true&quot; (is that syntax correct?).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;yes. &lt;/p&gt;</comment>
                            <comment id="12683435" author="fergus" created="Thu, 19 Mar 2009 11:28:52 +0000"  >&lt;p&gt;Did you notice that besides &amp;lt;uniqueKey&amp;gt; not being specified, that the whole document was empty!&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Mar 18, 2009 1:12:48 PM org.apache.solr.handler.dataimport.SolrWriter upload
WARNING: Error creating document : SolrInputDocument[{}]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12683532" author="fergus" created="Thu, 19 Mar 2009 17:26:51 +0000"  >&lt;p&gt;I have applied the latest version of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1059&quot; title=&quot;Add special variables for deleting documents, skipping rows and transforms in DIH&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1059&quot;&gt;&lt;del&gt;SOLR-1059&lt;/del&gt;&lt;/a&gt; and I just &lt;b&gt;cannot&lt;/b&gt; get delete to work!&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     &amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;single-delete&quot;&lt;/span&gt;
		 dataSource=&lt;span class=&quot;code-quote&quot;&gt;&quot;myURIreader&quot;&lt;/span&gt;
		 processor=&lt;span class=&quot;code-quote&quot;&gt;&quot;XPathEntityProcessor&quot;&lt;/span&gt;
		 url=&lt;span class=&quot;code-quote&quot;&gt;&quot;${dataimporter.request.single}&quot;&lt;/span&gt;
		 rootEntity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;
		 flatten=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;
		 stream=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;
		 forEach=&lt;span class=&quot;code-quote&quot;&gt;&quot;/record | /record/mediaBlock&quot;&lt;/span&gt;
		 transformer=&lt;span class=&quot;code-quote&quot;&gt;&quot;TemplateTransformer&quot;&lt;/span&gt;&amp;gt;

      &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;$skipDoc&quot;&lt;/span&gt;            template=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt; 
      &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath&quot;&lt;/span&gt;    template=&lt;span class=&quot;code-quote&quot;&gt;&quot;${dataimporter.request.single}&quot;&lt;/span&gt; /&amp;gt; 
      &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;$deleteDocByQuery&quot;&lt;/span&gt;   template=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath:${dataimporter.request.single}&quot;&lt;/span&gt; /&amp;gt; 	       
      &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;vdkvgwkey&quot;&lt;/span&gt;           template=&lt;span class=&quot;code-quote&quot;&gt;&quot;${dataimporter.request.single}&quot;&lt;/span&gt; /&amp;gt; 
      &amp;lt;/entity&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And here is a section from the log file showing that after an attempt to wipe the file, it is still there; it was not removed.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Mar 19, 2009 5:24:52 PM org.apache.solr.core.SolrCore execute
INFO: [] webapp=/apache-solr-1.4-dev path=/select params={wt=xml&amp;amp;q=fileAbsolutePath:file\:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml} hits=3 status=0 QTime=10 
&lt;/span&gt;


Mar 19, 2009 5:25:04 PM org.apache.solr.core.SolrCore execute
INFO: [] webapp=/apache-solr-1.4-dev path=/dataimport params={command=full-&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt;&amp;amp;clean=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;entity=single-delete&amp;amp;commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;single=file\:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml} status=0 QTime=0 
&lt;/span&gt;Mar 19, 2009 5:25:04 PM org.apache.solr.handler.dataimport.SolrWriter readIndexerProperties
INFO: Read dataimport.properties
Mar 19, 2009 5:25:04 PM org.apache.solr.handler.dataimport.DataImporter doFullImport
INFO: Starting Full Import
Mar 19, 2009 5:25:04 PM org.apache.solr.handler.dataimport.SolrWriter readIndexerProperties
INFO: Read dataimport.properties
Mar 19, 2009 5:25:04 PM org.apache.solr.handler.dataimport.URLDataSource getData
SEVERE: Exception thrown &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; getting data
java.net.MalformedURLException: no protocol: nullfile\:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml
&lt;/span&gt;	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:567)
	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:464)
	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:413)
	at org.apache.solr.handler.dataimport.URLDataSource.getData(URLDataSource.java:88)
	at org.apache.solr.handler.dataimport.URLDataSource.getData(URLDataSource.java:47)
	at org.apache.solr.handler.dataimport.XPathEntityProcessor.initQuery(XPathEntityProcessor.java:239)
	at org.apache.solr.handler.dataimport.XPathEntityProcessor.fetchNextRow(XPathEntityProcessor.java:182)
	at org.apache.solr.handler.dataimport.XPathEntityProcessor.nextRow(XPathEntityProcessor.java:165)
	at org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:335)
	at org.apache.solr.handler.dataimport.DocBuilder.doFullDump(DocBuilder.java:221)
	at org.apache.solr.handler.dataimport.DocBuilder.execute(DocBuilder.java:163)
	at org.apache.solr.handler.dataimport.DataImporter.doFullImport(DataImporter.java:309)
	at org.apache.solr.handler.dataimport.DataImporter.runCmd(DataImporter.java:367)
	at org.apache.solr.handler.dataimport.DataImporter$1.run(DataImporter.java:348)
Mar 19, 2009 5:25:04 PM org.apache.solr.handler.dataimport.DocBuilder buildDocument
SEVERE: Exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; processing: single-delete document : SolrInputDocument[{}]
org.apache.solr.handler.dataimport.DataImportHandlerException: Exception in invoking url &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; Processing Document # 1
	at org.apache.solr.handler.dataimport.URLDataSource.getData(URLDataSource.java:112)
	at org.apache.solr.handler.dataimport.URLDataSource.getData(URLDataSource.java:47)
	at org.apache.solr.handler.dataimport.XPathEntityProcessor.initQuery(XPathEntityProcessor.java:239)
	at org.apache.solr.handler.dataimport.XPathEntityProcessor.fetchNextRow(XPathEntityProcessor.java:182)
	at org.apache.solr.handler.dataimport.XPathEntityProcessor.nextRow(XPathEntityProcessor.java:165)
	at org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:335)
	at org.apache.solr.handler.dataimport.DocBuilder.doFullDump(DocBuilder.java:221)
	at org.apache.solr.handler.dataimport.DocBuilder.execute(DocBuilder.java:163)
	at org.apache.solr.handler.dataimport.DataImporter.doFullImport(DataImporter.java:309)
	at org.apache.solr.handler.dataimport.DataImporter.runCmd(DataImporter.java:367)
	at org.apache.solr.handler.dataimport.DataImporter$1.run(DataImporter.java:348)
Caused by: java.net.MalformedURLException: no protocol: nullfile\:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml
&lt;/span&gt;	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:567)
	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:464)
	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:413)
	at org.apache.solr.handler.dataimport.URLDataSource.getData(URLDataSource.java:88)
	... 10 more
Mar 19, 2009 5:25:04 PM org.apache.solr.handler.dataimport.DataImporter doFullImport
SEVERE: Full Import failed
org.apache.solr.handler.dataimport.DataImportHandlerException: Exception in invoking url &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; Processing Document # 1
	at org.apache.solr.handler.dataimport.URLDataSource.getData(URLDataSource.java:112)
	at org.apache.solr.handler.dataimport.URLDataSource.getData(URLDataSource.java:47)
	at org.apache.solr.handler.dataimport.XPathEntityProcessor.initQuery(XPathEntityProcessor.java:239)
	at org.apache.solr.handler.dataimport.XPathEntityProcessor.fetchNextRow(XPathEntityProcessor.java:182)
	at org.apache.solr.handler.dataimport.XPathEntityProcessor.nextRow(XPathEntityProcessor.java:165)
	at org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:335)
	at org.apache.solr.handler.dataimport.DocBuilder.doFullDump(DocBuilder.java:221)
	at org.apache.solr.handler.dataimport.DocBuilder.execute(DocBuilder.java:163)
	at org.apache.solr.handler.dataimport.DataImporter.doFullImport(DataImporter.java:309)
	at org.apache.solr.handler.dataimport.DataImporter.runCmd(DataImporter.java:367)
	at org.apache.solr.handler.dataimport.DataImporter$1.run(DataImporter.java:348)
Caused by: java.net.MalformedURLException: no protocol: nullfile\:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml
&lt;/span&gt;	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:567)
	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:464)
	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:413)
	at org.apache.solr.handler.dataimport.URLDataSource.getData(URLDataSource.java:88)
	... 10 more
Mar 19, 2009 5:25:04 PM org.apache.solr.update.DirectUpdateHandler2 rollback
INFO: start rollback
Mar 19, 2009 5:25:04 PM org.apache.solr.update.DirectUpdateHandler2 rollback
INFO: end_rollback
Mar 19, 2009 5:25:04 PM org.apache.solr.update.DirectUpdateHandler2 commit
INFO: start commit(optimize=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,waitFlush=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
Mar 19, 2009 5:25:04 PM org.apache.solr.search.SolrIndexSearcher &amp;lt;init&amp;gt;
INFO: Opening Searcher@281e7e main
Mar 19, 2009 5:25:04 PM org.apache.solr.update.DirectUpdateHandler2 commit
INFO: end_commit_flush
Mar 19, 2009 5:25:04 PM org.apache.solr.search.SolrIndexSearcher warm
INFO: autowarming Searcher@281e7e main from Searcher@7740f6 main
	fieldValueCache{lookups=0,hits=0,hitratio=0.00,inserts=0,evictions=0,size=0,warmupTime=0,cumulative_lookups=0,cumulative_hits=0,cumulative_hitratio=0.00,cumulative_inserts=0,cumulative_evictions=0}
Mar 19, 2009 5:25:04 PM org.apache.solr.search.SolrIndexSearcher warm
INFO: autowarming result &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Searcher@281e7e main
	fieldValueCache{lookups=0,hits=0,hitratio=0.00,inserts=0,evictions=0,size=0,warmupTime=0,cumulative_lookups=0,cumulative_hits=0,cumulative_hitratio=0.00,cumulative_inserts=0,cumulative_evictions=0}
Mar 19, 2009 5:25:04 PM org.apache.solr.search.SolrIndexSearcher warm
INFO: autowarming Searcher@281e7e main from Searcher@7740f6 main
	filterCache{lookups=6,hits=6,hitratio=1.00,inserts=0,evictions=0,size=9,warmupTime=16,cumulative_lookups=25,cumulative_hits=25,cumulative_hitratio=1.00,cumulative_inserts=2,cumulative_evictions=0}
Mar 19, 2009 5:25:04 PM org.apache.solr.search.SolrIndexSearcher warm
INFO: autowarming result &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Searcher@281e7e main
	filterCache{lookups=0,hits=0,hitratio=0.00,inserts=0,evictions=0,size=9,warmupTime=16,cumulative_lookups=25,cumulative_hits=25,cumulative_hitratio=1.00,cumulative_inserts=2,cumulative_evictions=0}
Mar 19, 2009 5:25:04 PM org.apache.solr.search.SolrIndexSearcher warm
INFO: autowarming Searcher@281e7e main from Searcher@7740f6 main
	queryResultCache{lookups=2,hits=2,hitratio=1.00,inserts=7,evictions=0,size=7,warmupTime=8,cumulative_lookups=9,cumulative_hits=7,cumulative_hitratio=0.77,cumulative_inserts=2,cumulative_evictions=0}
Mar 19, 2009 5:25:04 PM org.apache.solr.search.SolrIndexSearcher warm
INFO: autowarming result &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Searcher@281e7e main
	queryResultCache{lookups=0,hits=0,hitratio=0.00,inserts=7,evictions=0,size=7,warmupTime=8,cumulative_lookups=9,cumulative_hits=7,cumulative_hitratio=0.77,cumulative_inserts=2,cumulative_evictions=0}
Mar 19, 2009 5:25:04 PM org.apache.solr.search.SolrIndexSearcher warm
INFO: autowarming Searcher@281e7e main from Searcher@7740f6 main
	documentCache{lookups=18,hits=15,hitratio=0.83,inserts=26,evictions=0,size=26,warmupTime=0,cumulative_lookups=165,cumulative_hits=149,cumulative_hitratio=0.90,cumulative_inserts=16,cumulative_evictions=0}
Mar 19, 2009 5:25:04 PM org.apache.solr.search.SolrIndexSearcher warm
INFO: autowarming result &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Searcher@281e7e main
	documentCache{lookups=0,hits=0,hitratio=0.00,inserts=0,evictions=0,size=0,warmupTime=0,cumulative_lookups=165,cumulative_hits=149,cumulative_hitratio=0.90,cumulative_inserts=16,cumulative_evictions=0}
Mar 19, 2009 5:25:04 PM org.apache.solr.core.QuerySenderListener newSearcher
INFO: QuerySenderListener sending requests to Searcher@281e7e main
Mar 19, 2009 5:25:04 PM org.apache.solr.core.SolrCore execute
INFO: [] webapp=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; path=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; params={rows=10&amp;amp;start=0&amp;amp;q=solr} hits=0 status=0 QTime=6 
Mar 19, 2009 5:25:04 PM org.apache.solr.core.SolrCore execute
INFO: [] webapp=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; path=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; params={rows=10&amp;amp;start=0&amp;amp;q=rocks} hits=90 status=0 QTime=34 
Mar 19, 2009 5:25:04 PM org.apache.solr.core.SolrCore execute
INFO: [] webapp=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; path=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; params={q=&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;+newSearcher+warming+query+from+solrconfig.xml} hits=12327 status=0 QTime=98 
Mar 19, 2009 5:25:04 PM org.apache.solr.core.QuerySenderListener newSearcher
INFO: QuerySenderListener done.
Mar 19, 2009 5:25:04 PM org.apache.solr.core.SolrCore registerSearcher
INFO: [] Registered &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; searcher Searcher@281e7e main
Mar 19, 2009 5:25:04 PM org.apache.solr.search.SolrIndexSearcher close
INFO: Closing Searcher@7740f6 main
	fieldValueCache{lookups=0,hits=0,hitratio=0.00,inserts=0,evictions=0,size=0,warmupTime=0,cumulative_lookups=0,cumulative_hits=0,cumulative_hitratio=0.00,cumulative_inserts=0,cumulative_evictions=0}
	filterCache{lookups=6,hits=6,hitratio=1.00,inserts=0,evictions=0,size=9,warmupTime=16,cumulative_lookups=25,cumulative_hits=25,cumulative_hitratio=1.00,cumulative_inserts=2,cumulative_evictions=0}
	queryResultCache{lookups=2,hits=2,hitratio=1.00,inserts=7,evictions=0,size=7,warmupTime=8,cumulative_lookups=9,cumulative_hits=7,cumulative_hitratio=0.77,cumulative_inserts=2,cumulative_evictions=0}
	documentCache{lookups=18,hits=15,hitratio=0.83,inserts=26,evictions=0,size=26,warmupTime=0,cumulative_lookups=165,cumulative_hits=149,cumulative_hitratio=0.90,cumulative_inserts=16,cumulative_evictions=0}



Mar 19, 2009 5:25:12 PM org.apache.solr.core.SolrCore execute
INFO: [] webapp=/apache-solr-1.4-dev path=/select params={wt=xml&amp;amp;q=fileAbsolutePath:file\:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml} hits=3 status=0 QTime=11 &lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Any hints on what I should try next?&lt;/p&gt;</comment>
                            <comment id="12683546" author="shalinmangar" created="Thu, 19 Mar 2009 18:00:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;I have applied the latest version of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1059&quot; title=&quot;Add special variables for deleting documents, skipping rows and transforms in DIH&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1059&quot;&gt;&lt;del&gt;SOLR-1059&lt;/del&gt;&lt;/a&gt; and I just cannot get delete to work! &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1059&quot; title=&quot;Add special variables for deleting documents, skipping rows and transforms in DIH&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1059&quot;&gt;&lt;del&gt;SOLR-1059&lt;/del&gt;&lt;/a&gt; is now committed to trunk so you do not need to apply the patch anymore. There was a slight change too &amp;#8211; the delete flag variable&lt;br/&gt;
has been renamed to &quot;$deleteDocById&quot; and &quot;$deleteDocByQuery&quot;.&lt;/p&gt;

&lt;p&gt;I see that you are escaping the &apos;:&apos; character. You need to escape it only if you are specifying it in the &apos;q&apos; parameter. For any other parameter (&apos;single&apos; in this case)&lt;br/&gt;
you do not need to escape it. The escaped &apos;:&apos; is causing this exception.&lt;/p&gt;</comment>
                            <comment id="12683558" author="fergus" created="Thu, 19 Mar 2009 18:35:56 +0000"  >&lt;p&gt;Yes, I spotted you had committed &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1059&quot; title=&quot;Add special variables for deleting documents, skipping rows and transforms in DIH&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1059&quot;&gt;&lt;del&gt;SOLR-1059&lt;/del&gt;&lt;/a&gt;. I backed out that patch and did a &quot;svn update&quot;  to get the new changes. I had changed my data-config.xml as shown above as was already using the $deleteDocByQuery. Removing the escaping of the : I get the following:-&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Mar 19, 2009 6:31:27 PM org.apache.solr.core.SolrCore execute
INFO: [] webapp=/apache-solr-1.4-dev path=/dataimport params={command=full-&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt;&amp;amp;clean=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;entity=single-delete&amp;amp;commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;single=file:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml} status=0 QTime=0 
&lt;/span&gt;Mar 19, 2009 6:31:27 PM org.apache.solr.handler.dataimport.SolrWriter readIndexerProperties
INFO: Read dataimport.properties
Mar 19, 2009 6:31:27 PM org.apache.solr.handler.dataimport.DataImporter doFullImport
INFO: Starting Full Import
Mar 19, 2009 6:31:27 PM org.apache.solr.handler.dataimport.SolrWriter readIndexerProperties
INFO: Read dataimport.properties
Mar 19, 2009 6:31:27 PM org.apache.solr.handler.dataimport.DocBuilder execute
INFO: Time taken = 0:0:0.14
Mar 19, 2009 6:31:42 PM org.apache.solr.core.SolrCore execute
INFO: [] webapp=/apache-solr-1.4-dev path=/select params={wt=xml&amp;amp;q=fileAbsolutePath:file\:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml} hits=3 status=0 QTime=11 &lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Any ideas or should I start adding log statements all over the place?&lt;/p&gt;</comment>
                            <comment id="12683567" author="shalinmangar" created="Thu, 19 Mar 2009 18:55:40 +0000"  >&lt;p&gt;I&apos;m not sure what to make of the above log. Are the documents not getting deleted? In your data-config I see that skipDoc is true. No documents will be added at all.&lt;/p&gt;</comment>
                            <comment id="12683577" author="fergus" created="Thu, 19 Mar 2009 19:35:28 +0000"  >&lt;p&gt;Correct documents are not getting deleted. Line 2 from the log shows:-&lt;/p&gt;

&lt;p&gt;   path=/dataimport command=full-import&amp;amp;clean=false&amp;amp;entity=single-delete&amp;amp;commit=true&amp;amp;single=&lt;a href=&quot;file:///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Line 12 is me dong a query for the same document:-&lt;/p&gt;

&lt;p&gt;   path=/select params=&lt;/p&gt;
{wt=xml&amp;amp;q=fileAbsolutePath:file\:///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml}
&lt;p&gt; hits=3 status=0 QTime=11&lt;/p&gt;

&lt;p&gt;which returns three hits. So the documents have not been deleted! Removing the $skipDoc=true and rerunning the delete I get:-&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Mar 19, 2009 7:33:34 PM org.apache.solr.core.SolrCore execute
INFO: [] webapp=/apache-solr-1.4-dev path=/dataimport params={command=full-&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt;&amp;amp;clean=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;entity=single-delete&amp;amp;commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;single=file:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml} status=0 QTime=0 
&lt;/span&gt;Mar 19, 2009 7:33:34 PM org.apache.solr.handler.dataimport.SolrWriter readIndexerProperties
INFO: Read dataimport.properties
Mar 19, 2009 7:33:34 PM org.apache.solr.handler.dataimport.DataImporter doFullImport
INFO: Starting Full Import
Mar 19, 2009 7:33:34 PM org.apache.solr.handler.dataimport.SolrWriter readIndexerProperties
INFO: Read dataimport.properties
Mar 19, 2009 7:33:34 PM org.apache.solr.handler.dataimport.SolrWriter deleteByQuery
INFO: Deleting documents from Solr with query: fileAbsolutePath:file:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml
&lt;/span&gt;Mar 19, 2009 7:33:34 PM org.apache.solr.common.SolrException log
SEVERE: org.apache.lucene.queryParser.ParseException: Cannot parse &apos;fileAbsolutePath:file:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml&apos;: Encountered &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt;: &quot;&quot; at line 1, column 21.
&lt;/span&gt;Was expecting one of:
    &amp;lt;EOF&amp;gt; 
    &amp;lt;AND&amp;gt; ...
    &amp;lt;OR&amp;gt; ...
    &amp;lt;NOT&amp;gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;+&quot;&lt;/span&gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;-&quot;&lt;/span&gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;(&quot;&lt;/span&gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;*&quot;&lt;/span&gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;^&quot;&lt;/span&gt; ...
    &amp;lt;QUOTED&amp;gt; ...
    &amp;lt;TERM&amp;gt; ...
    &amp;lt;FUZZY_SLOP&amp;gt; ...
    &amp;lt;PREFIXTERM&amp;gt; ...
    &amp;lt;WILDTERM&amp;gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;[&quot;&lt;/span&gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;{&quot;&lt;/span&gt; ...
    &amp;lt;NUMBER&amp;gt; ...
    
	at org.apache.lucene.queryParser.QueryParser.parse(QueryParser.java:177)
	at org.apache.solr.search.QueryParsing.parseQuery(QueryParsing.java:74)
	at org.apache.solr.search.QueryParsing.parseQuery(QueryParsing.java:63)
	at org.apache.solr.update.DirectUpdateHandler2.deleteByQuery(DirectUpdateHandler2.java:314)
	at org.apache.solr.update.processor.RunUpdateProcessor.processDelete(RunUpdateProcessorFactory.java:70)
	at org.apache.solr.handler.dataimport.SolrWriter.deleteByQuery(SolrWriter.java:153)
	at org.apache.solr.handler.dataimport.DocBuilder.addFields(DocBuilder.java:449)
	at org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:358)
	at org.apache.solr.handler.dataimport.DocBuilder.doFullDump(DocBuilder.java:221)
	at org.apache.solr.handler.dataimport.DocBuilder.execute(DocBuilder.java:163)
	at org.apache.solr.handler.dataimport.DataImporter.doFullImport(DataImporter.java:309)
	at org.apache.solr.handler.dataimport.DataImporter.runCmd(DataImporter.java:367)
	at org.apache.solr.handler.dataimport.DataImporter$1.run(DataImporter.java:348)

Mar 19, 2009 7:33:34 PM org.apache.solr.handler.dataimport.DataImporter doFullImport
SEVERE: Full Import failed
org.apache.solr.handler.dataimport.DataImportHandlerException: org.apache.solr.common.SolrException: Error parsing Lucene query
	at org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:400)
	at org.apache.solr.handler.dataimport.DocBuilder.doFullDump(DocBuilder.java:221)
	at org.apache.solr.handler.dataimport.DocBuilder.execute(DocBuilder.java:163)
	at org.apache.solr.handler.dataimport.DataImporter.doFullImport(DataImporter.java:309)
	at org.apache.solr.handler.dataimport.DataImporter.runCmd(DataImporter.java:367)
	at org.apache.solr.handler.dataimport.DataImporter$1.run(DataImporter.java:348)
Caused by: org.apache.solr.common.SolrException: Error parsing Lucene query
	at org.apache.solr.search.QueryParsing.parseQuery(QueryParsing.java:84)
	at org.apache.solr.search.QueryParsing.parseQuery(QueryParsing.java:63)
	at org.apache.solr.update.DirectUpdateHandler2.deleteByQuery(DirectUpdateHandler2.java:314)
	at org.apache.solr.update.processor.RunUpdateProcessor.processDelete(RunUpdateProcessorFactory.java:70)
	at org.apache.solr.handler.dataimport.SolrWriter.deleteByQuery(SolrWriter.java:153)
	at org.apache.solr.handler.dataimport.DocBuilder.addFields(DocBuilder.java:449)
	at org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:358)
	... 5 more
Caused by: org.apache.lucene.queryParser.ParseException: Cannot parse &apos;fileAbsolutePath:file:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml&apos;: Encountered &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt;: &quot;&quot; at line 1, column 21.
&lt;/span&gt;Was expecting one of:
    &amp;lt;EOF&amp;gt; 
    &amp;lt;AND&amp;gt; ...
    &amp;lt;OR&amp;gt; ...
    &amp;lt;NOT&amp;gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;+&quot;&lt;/span&gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;-&quot;&lt;/span&gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;(&quot;&lt;/span&gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;*&quot;&lt;/span&gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;^&quot;&lt;/span&gt; ...
    &amp;lt;QUOTED&amp;gt; ...
    &amp;lt;TERM&amp;gt; ...
    &amp;lt;FUZZY_SLOP&amp;gt; ...
    &amp;lt;PREFIXTERM&amp;gt; ...
    &amp;lt;WILDTERM&amp;gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;[&quot;&lt;/span&gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;{&quot;&lt;/span&gt; ...
    &amp;lt;NUMBER&amp;gt; ...
    
	at org.apache.lucene.queryParser.QueryParser.parse(QueryParser.java:177)
	at org.apache.solr.search.QueryParsing.parseQuery(QueryParsing.java:74)
	... 11 more
Mar 19, 2009 7:33:34 PM org.apache.solr.update.DirectUpdateHandler2 rollback
INFO: start rollback
Mar 19, 2009 7:33:34 PM org.apache.solr.update.DirectUpdateHandler2 rollback
INFO: end_rollback
Mar 19, 2009 7:33:34 PM org.apache.solr.update.DirectUpdateHandler2 commit
INFO: start commit(optimize=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,waitFlush=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
Mar 19, 2009 7:33:34 PM org.apache.solr.search.SolrIndexSearcher &amp;lt;init&amp;gt;
INFO: Opening Searcher@86b804 main
Mar 19, 2009 7:33:34 PM org.apache.solr.update.DirectUpdateHandler2 commit
INFO: end_commit_flush
Mar 19, 2009 7:33:34 PM org.apache.solr.search.SolrIndexSearcher warm
INFO: autowarming Searcher@86b804 main from Searcher@281e7e main
	fieldValueCache{lookups=0,hits=0,hitratio=0.00,inserts=0,evictions=0,size=0,warmupTime=0,cumulative_lookups=0,cumulative_hits=0,cumulative_hitratio=0.00,cumulative_inserts=0,cumulative_evictions=0}
Mar 19, 2009 7:33:34 PM org.apache.solr.search.SolrIndexSearcher warm
INFO: autowarming result &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Searcher@86b804 main
	fieldValueCache{lookups=0,hits=0,hitratio=0.00,inserts=0,evictions=0,size=0,warmupTime=0,cumulative_lookups=0,cumulative_hits=0,cumulative_hitratio=0.00,cumulative_inserts=0,cumulative_evictions=0}
Mar 19, 2009 7:33:34 PM org.apache.solr.search.SolrIndexSearcher warm
INFO: autowarming Searcher@86b804 main from Searcher@281e7e main
	filterCache{lookups=6,hits=6,hitratio=1.00,inserts=0,evictions=0,size=9,warmupTime=16,cumulative_lookups=31,cumulative_hits=31,cumulative_hitratio=1.00,cumulative_inserts=2,cumulative_evictions=0}
Mar 19, 2009 7:33:35 PM org.apache.solr.search.SolrIndexSearcher warm
INFO: autowarming result &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Searcher@86b804 main
	filterCache{lookups=0,hits=0,hitratio=0.00,inserts=0,evictions=0,size=9,warmupTime=39,cumulative_lookups=31,cumulative_hits=31,cumulative_hitratio=1.00,cumulative_inserts=2,cumulative_evictions=0}
Mar 19, 2009 7:33:35 PM org.apache.solr.search.SolrIndexSearcher warm
INFO: autowarming Searcher@86b804 main from Searcher@281e7e main
	queryResultCache{lookups=2,hits=2,hitratio=1.00,inserts=7,evictions=0,size=7,warmupTime=8,cumulative_lookups=11,cumulative_hits=9,cumulative_hitratio=0.81,cumulative_inserts=2,cumulative_evictions=0}
Mar 19, 2009 7:33:35 PM org.apache.solr.search.SolrIndexSearcher warm
INFO: autowarming result &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Searcher@86b804 main
	queryResultCache{lookups=0,hits=0,hitratio=0.00,inserts=7,evictions=0,size=7,warmupTime=9,cumulative_lookups=11,cumulative_hits=9,cumulative_hitratio=0.81,cumulative_inserts=2,cumulative_evictions=0}
Mar 19, 2009 7:33:35 PM org.apache.solr.search.SolrIndexSearcher warm
INFO: autowarming Searcher@86b804 main from Searcher@281e7e main
	documentCache{lookups=18,hits=15,hitratio=0.83,inserts=26,evictions=0,size=26,warmupTime=0,cumulative_lookups=183,cumulative_hits=164,cumulative_hitratio=0.89,cumulative_inserts=19,cumulative_evictions=0}
Mar 19, 2009 7:33:35 PM org.apache.solr.search.SolrIndexSearcher warm
INFO: autowarming result &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Searcher@86b804 main
	documentCache{lookups=0,hits=0,hitratio=0.00,inserts=0,evictions=0,size=0,warmupTime=0,cumulative_lookups=183,cumulative_hits=164,cumulative_hitratio=0.89,cumulative_inserts=19,cumulative_evictions=0}
Mar 19, 2009 7:33:35 PM org.apache.solr.core.QuerySenderListener newSearcher
INFO: QuerySenderListener sending requests to Searcher@86b804 main
Mar 19, 2009 7:33:35 PM org.apache.solr.core.SolrCore execute
INFO: [] webapp=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; path=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; params={rows=10&amp;amp;start=0&amp;amp;q=solr} hits=0 status=0 QTime=3 
Mar 19, 2009 7:33:35 PM org.apache.solr.core.SolrCore execute
INFO: [] webapp=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; path=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; params={rows=10&amp;amp;start=0&amp;amp;q=rocks} hits=90 status=0 QTime=16 
Mar 19, 2009 7:33:35 PM org.apache.solr.core.SolrCore execute
INFO: [] webapp=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; path=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; params={q=&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;+newSearcher+warming+query+from+solrconfig.xml} hits=12327 status=0 QTime=96 
Mar 19, 2009 7:33:35 PM org.apache.solr.core.QuerySenderListener newSearcher
INFO: QuerySenderListener done.
Mar 19, 2009 7:33:35 PM org.apache.solr.core.SolrCore registerSearcher
INFO: [] Registered &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; searcher Searcher@86b804 main
Mar 19, 2009 7:33:35 PM org.apache.solr.search.SolrIndexSearcher close
INFO: Closing Searcher@281e7e main
	fieldValueCache{lookups=0,hits=0,hitratio=0.00,inserts=0,evictions=0,size=0,warmupTime=0,cumulative_lookups=0,cumulative_hits=0,cumulative_hitratio=0.00,cumulative_inserts=0,cumulative_evictions=0}
	filterCache{lookups=6,hits=6,hitratio=1.00,inserts=0,evictions=0,size=9,warmupTime=16,cumulative_lookups=31,cumulative_hits=31,cumulative_hitratio=1.00,cumulative_inserts=2,cumulative_evictions=0}
	queryResultCache{lookups=2,hits=2,hitratio=1.00,inserts=7,evictions=0,size=7,warmupTime=8,cumulative_lookups=11,cumulative_hits=9,cumulative_hitratio=0.81,cumulative_inserts=2,cumulative_evictions=0}
	documentCache{lookups=18,hits=15,hitratio=0.83,inserts=26,evictions=0,size=26,warmupTime=0,cumulative_lookups=183,cumulative_hits=164,cumulative_hitratio=0.89,cumulative_inserts=19,cumulative_evictions=0}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="12683589" author="fergus" created="Thu, 19 Mar 2009 19:50:04 +0000"  >&lt;p&gt;Lot of weirdness going on here, do not bother looking into this further ill I get my sort straight!&lt;/p&gt;</comment>
                            <comment id="12683740" author="noble.paul" created="Fri, 20 Mar 2009 04:11:40 +0000"  >&lt;p&gt;hi fergus, &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;if the document is empty it is not tried to be added.&lt;/li&gt;
	&lt;li&gt;There is a new LogTransformer checked into the trunk. you can use that to log any information&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12683839" author="fergus" created="Fri, 20 Mar 2009 10:46:16 +0000"  >&lt;p&gt;Some of my weirdness resolved by a &quot;ant clean&quot;. However I have got myself into a whole pile of regex problems. The RegexTransformer just does not allow me to do what I need, which is to conditionally populate the field $deleteDocByQuery. A snippet from my data-config follows:-&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   &amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;jc&quot;&lt;/span&gt;
	     processor=&lt;span class=&quot;code-quote&quot;&gt;&quot;ChangeListEntityProcessor&quot;&lt;/span&gt;
	     acceptLineRegex=&lt;span class=&quot;code-quote&quot;&gt;&quot;^.*\.xml$&quot;&lt;/span&gt;
	     omitLineRegex=&lt;span class=&quot;code-quote&quot;&gt;&quot;usc2009&quot;&lt;/span&gt;
	     fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/man-findlsurl.txt&quot;&lt;/span&gt;
&lt;/span&gt;	     rootEntity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;
	     dataSource=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;
	     baseLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/ford/schema/&quot;&lt;/span&gt;
&lt;/span&gt;	     transformer=&lt;span class=&quot;code-quote&quot;&gt;&quot;RegexTransformer&quot;&lt;/span&gt;
	     &amp;gt;
      &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath&quot;&lt;/span&gt;    regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;^.*\s+([^ ]*)$&quot;&lt;/span&gt; replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;${jc.baseLocation}/$1&quot;&lt;/span&gt;  sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;rawLine&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;$deleteDocByQuery&quot;&lt;/span&gt;   regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;^DELETE.*&quot;&lt;/span&gt;      replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath:${jc.fileAbsolutePath}&quot;&lt;/span&gt; sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;rawLine&quot;&lt;/span&gt;/&amp;gt; 	       

      &amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;x&quot;&lt;/span&gt;
	      dataSource=&lt;span class=&quot;code-quote&quot;&gt;&quot;myURIreader&quot;&lt;/span&gt;
	      processor=&lt;span class=&quot;code-quote&quot;&gt;&quot;XPathEntityProcessor&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The trouble is that this &lt;/p&gt;

&lt;p&gt;     &amp;lt;field column=&quot;$deleteDocByQuery&quot;   regex=&quot;^DELETE.*&quot;      sourceColName=&quot;rawLine&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;leaves $deleteDocByQuery undefined if the regex is &lt;b&gt;unmatched&lt;/b&gt;; which is good. However&lt;/p&gt;

&lt;p&gt;     &amp;lt;field column=&quot;$deleteDocByQuery&quot;   regex=&quot;^DELETE.*&quot;      sourceColName=&quot;rawLine&quot;     replaceWith=&quot;fileAbsolutePath:$&lt;/p&gt;
{jc.fileAbsolutePath}&quot; /&amp;gt;&lt;br/&gt;
&lt;br/&gt;
leaves $deleteDocByQuery equal to rawLine if the regex is &lt;b&gt;unmatched&lt;/b&gt;. I do not think this is desirable. I tried a work around which, after reading the code, I thought I could get away with&lt;br/&gt;
&lt;br/&gt;
     &amp;lt;field column=&quot;$deleteDocByQuery&quot;   regex=&quot;^DELETE.*&quot;      sourceColName=&quot;rawLine&quot;     replaceWith=&quot;fileAbsolutePath:${jc.fileAbsolutePath}
&lt;p&gt;&quot; groupNames=&quot;$deleteDocByQuery&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;however the presence of the &quot;replaceWith&quot; attribute disables the &quot;groupNames&quot; functionality.&lt;/p&gt;

&lt;p&gt;I think something needs sorted; or at least the documentation needs further clarification.&lt;/p&gt;
</comment>
                            <comment id="12683843" author="noble.paul" created="Fri, 20 Mar 2009 11:06:41 +0000"  >&lt;p&gt;Hi fergus,&lt;br/&gt;
I guess you are trying to do something with in-built Transformers which would be better handled by code (custom/new Transformer). &lt;/p&gt;</comment>
                            <comment id="12683851" author="fergus" created="Fri, 20 Mar 2009 11:44:56 +0000"  >&lt;p&gt;My original patch did all this in the ChangeListEntityProcessor, as an option! However as a seperate issue I do think we have a ambigutiy in the face value behaviour of the following code when a mismatch occurs.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;$deleteDocByQuery&quot;&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;^DELETE.*&quot;&lt;/span&gt; sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;rawLine&quot;&lt;/span&gt;/&amp;gt;
   &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;$deleteDocByQuery&quot;&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;^DELETE.*&quot;&lt;/span&gt; sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;rawLine&quot;&lt;/span&gt; replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath:${jc.fileAbsolutePath}&quot;&lt;/span&gt; /&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;While I do understand that under the hood one is a match and the other a replace. I think that we could to enhance the existing transformer somehow to streamline its interface. After all a new custom/new Transformer would just be a regex by another name. Not sure what to do for the best. 1) I could put my optional code back into ChangeListEntityProcessor? 2) I can also get around the problem with temporary fields, but it is rather ugly:-&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;jc&quot;&lt;/span&gt;
	     processor=&lt;span class=&quot;code-quote&quot;&gt;&quot;ChangeListEntityProcessor&quot;&lt;/span&gt;
	     acceptLineRegex=&lt;span class=&quot;code-quote&quot;&gt;&quot;^.*\.xml$&quot;&lt;/span&gt;
	     omitLineRegex=&lt;span class=&quot;code-quote&quot;&gt;&quot;usc2009&quot;&lt;/span&gt;
	     fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/man-findlsurl.txt&quot;&lt;/span&gt;
&lt;/span&gt;	     rootEntity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;
	     dataSource=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;
	     baseLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/ford/schema/&quot;&lt;/span&gt;
&lt;/span&gt;	     transformer=&lt;span class=&quot;code-quote&quot;&gt;&quot;RegexTransformer&quot;&lt;/span&gt;
	     &amp;gt;
      &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath&quot;&lt;/span&gt;    regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;^.*\s+([^ ]*)$&quot;&lt;/span&gt; replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;${jc.baseLocation}/$1&quot;&lt;/span&gt;  sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;rawLine&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;dummy&quot;&lt;/span&gt;                  regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;^DELETE.*&quot;&lt;/span&gt;      replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath:${jc.fileAbsolutePath}&quot;&lt;/span&gt; sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;rawLine&quot;&lt;/span&gt;/&amp;gt; 	       
      &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;$deleteDocByQuery&quot;&lt;/span&gt;   regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;^fileAbsolutePath:&quot;&lt;/span&gt;  sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;dummy&quot;&lt;/span&gt;/&amp;gt; 	       

      &amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;x&quot;&lt;/span&gt;
	      dataSource=&lt;span class=&quot;code-quote&quot;&gt;&quot;myURIreader&quot;&lt;/span&gt;
	      processor=&lt;span class=&quot;code-quote&quot;&gt;&quot;XPathEntityProcessor&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12683855" author="noble.paul" created="Fri, 20 Mar 2009 12:01:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;leaves $deleteDocByQuery equal to rawLine if the regex is unmatched&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;is it a good idea to not do anything if the regex is not matched? that is do not do the replaceAll()&lt;/p&gt;</comment>
                            <comment id="12683861" author="fergus" created="Fri, 20 Mar 2009 12:24:22 +0000"  >&lt;p&gt;I really dont know, I think it is the syntax that is confusing more than anything else. The first case is clearly a call to a plain olde matcher. The second case is not so clear or explicit; despite your wiki docs which do say you are doing a replace. How about a new RegexTransformer keyword &quot;matcher&quot;?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
1   &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;$deleteDocByQuery&quot;&lt;/span&gt; matcher=&lt;span class=&quot;code-quote&quot;&gt;&quot;^DELETE.*&quot;&lt;/span&gt; sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;rawLine&quot;&lt;/span&gt;/&amp;gt;
2   &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;$deleteDocByQuery&quot;&lt;/span&gt;     regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;^DELETE.*&quot;&lt;/span&gt; sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;rawLine&quot;&lt;/span&gt;/&amp;gt;
3   &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;$deleteDocByQuery&quot;&lt;/span&gt; matcher=&lt;span class=&quot;code-quote&quot;&gt;&quot;^DELETE.*&quot;&lt;/span&gt; sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;rawLine&quot;&lt;/span&gt; replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath:${jc.fileAbsolutePath}&quot;&lt;/span&gt; /&amp;gt;
4   &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;$deleteDocByQuery&quot;&lt;/span&gt;     regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;^DELETE.*&quot;&lt;/span&gt; sourceColName=&lt;span class=&quot;code-quote&quot;&gt;&quot;rawLine&quot;&lt;/span&gt; replaceWith=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath:${jc.fileAbsolutePath}&quot;&lt;/span&gt; /&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;cases 1) and 2) behave identically, with &quot;regex&quot; being deprecated&lt;br/&gt;
cases 3) and 4) differ, case 4) is the existing behavior which boils down to a replace. Case 3) however performs a match first, if the match succeeds then the replace is performed. If the match fails $deleteDocByQuery is unchanged, if it was null, it stays null. &lt;/p&gt;</comment>
                            <comment id="12683862" author="noble.paul" created="Fri, 20 Mar 2009 12:25:53 +0000"  >&lt;p&gt;this should check if the regex matches if not it doesn&apos;t replace&lt;/p&gt;</comment>
                            <comment id="12683882" author="fergus" created="Fri, 20 Mar 2009 13:43:31 +0000"  >&lt;p&gt;This is the latest version of my patch, the principle item of work was ChangeListEntityProcessor.java. However a new URLDataSource.java datasource was added which is almost identical to the now depreciated HttpDataSource.java. I also editied FileDataSource.java to make the log messages equivalent to that produced by URLDataSource.java.&lt;/p&gt;

&lt;p&gt;It is as good as working however I cannot get deleteDocByQuery to function properly.&lt;/p&gt;</comment>
                            <comment id="12683886" author="fergus" created="Fri, 20 Mar 2009 13:52:15 +0000"  >&lt;p&gt;Your patched version of regex seems great; thanks very much. I think that it is better more useful behavior. &lt;/p&gt;

&lt;p&gt;Next.... cant get delete to work. Using a data-config of &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;single-delete&quot;&lt;/span&gt;
		 dataSource=&lt;span class=&quot;code-quote&quot;&gt;&quot;myURIreader&quot;&lt;/span&gt;
		 processor=&lt;span class=&quot;code-quote&quot;&gt;&quot;XPathEntityProcessor&quot;&lt;/span&gt;
		 url=&lt;span class=&quot;code-quote&quot;&gt;&quot;${dataimporter.request.single}&quot;&lt;/span&gt;
		 rootEntity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;
		 stream=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;
		 forEach=&lt;span class=&quot;code-quote&quot;&gt;&quot;/record | /record/mediaBlock&quot;&lt;/span&gt;
		 transformer=&lt;span class=&quot;code-quote&quot;&gt;&quot;TemplateTransformer&quot;&lt;/span&gt;&amp;gt;

      &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath&quot;&lt;/span&gt;    template=&lt;span class=&quot;code-quote&quot;&gt;&quot;${dataimporter.request.single}&quot;&lt;/span&gt; /&amp;gt; 
      &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;$deleteDocByQuery&quot;&lt;/span&gt;   template=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath:${dataimporter.request.single}&quot;&lt;/span&gt; /&amp;gt; 	       
      &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;vdkvgwkey&quot;&lt;/span&gt;           template=&lt;span class=&quot;code-quote&quot;&gt;&quot;${dataimporter.request.single}&quot;&lt;/span&gt; /&amp;gt; 
      &amp;lt;/entity&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;



&lt;p&gt;If I enter&lt;/p&gt;

&lt;p&gt;    get &apos;http://localhost:8080/apache-solr-1.4-dev/dataimport?command=full-import&amp;amp;entity=single-delete&amp;amp;clean=false&amp;amp;commit=true&amp;amp;single=&lt;a href=&quot;file:///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml&lt;/a&gt;&apos;&lt;/p&gt;

&lt;p&gt;I get&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Mar 20, 2009 1:33:36 PM org.apache.solr.core.SolrCore execute
INFO: [] webapp=/apache-solr-1.4-dev path=/select params={wt=xml&amp;amp;q=&lt;span class=&quot;code-quote&quot;&gt;&quot;sea+stallion&quot;&lt;/span&gt;&amp;amp;qt=} hits=10 status=0 QTime=54 
Mar 20, 2009 1:34:01 PM org.apache.solr.core.SolrCore execute
INFO: [] webapp=/apache-solr-1.4-dev path=/dataimport params={command=full-&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt;&amp;amp;clean=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;entity=single-delete&amp;amp;commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;single=file:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml} status=0 QTime=1 
&lt;/span&gt;Mar 20, 2009 1:34:01 PM org.apache.solr.handler.dataimport.SolrWriter readIndexerProperties
INFO: Read dataimport.properties
Mar 20, 2009 1:34:01 PM org.apache.solr.handler.dataimport.DataImporter doFullImport
INFO: Starting Full Import
Mar 20, 2009 1:34:01 PM org.apache.solr.handler.dataimport.SolrWriter readIndexerProperties
INFO: Read dataimport.properties
Mar 20, 2009 1:34:01 PM org.apache.solr.handler.dataimport.SolrWriter deleteByQuery
INFO: Deleting documents from Solr with query: fileAbsolutePath:file:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml
&lt;/span&gt;Mar 20, 2009 1:34:01 PM org.apache.solr.common.SolrException log
SEVERE: org.apache.lucene.queryParser.ParseException: Cannot parse &apos;fileAbsolutePath:file:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml&apos;: Encountered &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt;: &quot;&quot; at line 1, column 21.
&lt;/span&gt;Was expecting one of:
    &amp;lt;EOF&amp;gt; 
    &amp;lt;AND&amp;gt; ...
    &amp;lt;OR&amp;gt; ...
    &amp;lt;NOT&amp;gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;+&quot;&lt;/span&gt; ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;However if I escape the &apos;:&apos; and enter &lt;/p&gt;

&lt;p&gt;    get &apos;http://localhost:8080/apache-solr-1.4-dev/dataimport?command=full-import&amp;amp;entity=single-delete&amp;amp;clean=false&amp;amp;commit=true&amp;amp;single=file\:///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml&apos;&lt;/p&gt;

&lt;p&gt;in this case it looks as though the deleteDocByQuery is being ignored!&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Mar 20, 2009 1:34:22 PM org.apache.solr.core.SolrCore execute
INFO: [] webapp=/apache-solr-1.4-dev path=/dataimport params={command=full-&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt;&amp;amp;clean=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;entity=single-delete&amp;amp;commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;single=file\:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml} status=0 QTime=0 
&lt;/span&gt;Mar 20, 2009 1:34:22 PM org.apache.solr.handler.dataimport.SolrWriter readIndexerProperties
INFO: Read dataimport.properties
Mar 20, 2009 1:34:22 PM org.apache.solr.handler.dataimport.DataImporter doFullImport
INFO: Starting Full Import
Mar 20, 2009 1:34:22 PM org.apache.solr.handler.dataimport.SolrWriter readIndexerProperties
INFO: Read dataimport.properties
Mar 20, 2009 1:34:22 PM org.apache.solr.handler.dataimport.URLDataSource getData
SEVERE: Exception thrown &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; getting data
java.net.MalformedURLException: no protocol: nullfile\:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml
&lt;/span&gt;	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:567)
	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:464)
	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:413)
	at org.apache.solr.handler.dataimport.URLDataSource.getData(URLDataSource.java:88)
	at org.apache.solr.handler.dataimport.URLDataSource.getData(URLDataSource.java:47)
	at org.apache.solr.handler.dataimport.XPathEntityProcessor.initQuery(XPathEntityProcessor.java:239)
	at org.apache.solr.handler.dataimport.XPathEntityProcessor.fetchNextRow(XPathEntityProcessor.java:182)
	at org.apache.solr.handler.dataimport.XPathEntityProcessor.nextRow(XPathEntityProcessor.java:165)
	at org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:335)
	at org.apache.solr.handler.dataimport.DocBuilder.doFullDump(DocBuilder.java:221)
	at org.apache.solr.handler.dataimport.DocBuilder.execute(DocBuilder.java:163)
	at org.apache.solr.handler.dataimport.DataImporter.doFullImport(DataImporter.java:309)
	at org.apache.solr.handler.dataimport.DataImporter.runCmd(DataImporter.java:367)
	at org.apache.solr.handler.dataimport.DataImporter$1.run(DataImporter.java:348)
Mar 20, 2009 1:34:22 PM org.apache.solr.handler.dataimport.DocBuilder buildDocument
SEVERE: Exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; processing: single-delete document : SolrInputDocument[{}]
org.apache.solr.handler.dataimport.DataImportHandlerException: Exception in invoking url &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; Processing Document # 1
	at org.apache.solr.handler.dataimport.URLDataSource.getData(URLDataSource.java:112)
	at org.apache.solr.handler.dataimport.URLDataSource.getData(URLDataSource.java:47)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12688156" author="shalinmangar" created="Sun, 22 Mar 2009 18:48:00 +0000"  >&lt;p&gt;I was having trouble applying the patch as there were some conflicts in HttpDataSource. This patch is in sync with trunk. &lt;/p&gt;</comment>
                            <comment id="12688159" author="shalinmangar" created="Sun, 22 Mar 2009 18:56:44 +0000"  >&lt;p&gt;The ParseException is because when we try to delete the document, the file path being given contains a &apos;:&apos; character. A valid solr query must cannot contain such characters. The best way is to use ClientUtils.escapeQueryChars on the value of the query. I see that you are creating the delete query through a template. Perhaps we need a Evaluator which can escape query characters using ClientUtils.escapeQueryChars method?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;$deleteDocByQuery&quot;&lt;/span&gt;   template=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath:${dataimporter.functions.escapeQueryChars(dataimporter.request.single)}&quot;&lt;/span&gt; /&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12688280" author="fergus" created="Mon, 23 Mar 2009 12:49:28 +0000"  >&lt;p&gt;Down loaded your version of my patch. Thanks for taking a look at it and making the improvements.&lt;/p&gt;

&lt;p&gt;However I still can get things to work. My solr-data.xml is now as follows:-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     &amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;single-delete&quot;&lt;/span&gt;
		 dataSource=&lt;span class=&quot;code-quote&quot;&gt;&quot;myURIreader&quot;&lt;/span&gt;
		 processor=&lt;span class=&quot;code-quote&quot;&gt;&quot;XPathEntityProcessor&quot;&lt;/span&gt;
		 url=&lt;span class=&quot;code-quote&quot;&gt;&quot;${dataimporter.request.single}&quot;&lt;/span&gt;
		 rootEntity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;
		 flatten=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;
		 stream=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;
		 forEach=&lt;span class=&quot;code-quote&quot;&gt;&quot;/record | /record/mediaBlock&quot;&lt;/span&gt;
		 transformer=&lt;span class=&quot;code-quote&quot;&gt;&quot;TemplateTransformer&quot;&lt;/span&gt;&amp;gt;

      &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath&quot;&lt;/span&gt;    template=&lt;span class=&quot;code-quote&quot;&gt;&quot;${dataimporter.request.single}&quot;&lt;/span&gt; /&amp;gt; 
      &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;$deleteDocByQuery&quot;&lt;/span&gt;   template=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAbsolutePath:${dataimporter.functions.escapeQueryChars(dataimporter.request.single)}&quot;&lt;/span&gt; /&amp;gt; 	       
      &amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;vdkvgwkey&quot;&lt;/span&gt;           template=&lt;span class=&quot;code-quote&quot;&gt;&quot;${dataimporter.request.single}&quot;&lt;/span&gt; /&amp;gt; 
      &amp;lt;/entity&amp;gt;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But an attempt to delete a document produces the following..&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Mar 23, 2009 12:45:42 PM org.apache.solr.core.SolrCore execute
INFO: [] webapp=/apache-solr-1.4-dev path=/dataimport params={command=full-&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt;&amp;amp;clean=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;entity=single-delete&amp;amp;commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;single=file:&lt;span class=&quot;code-comment&quot;&gt;///Volumes/spare/ts/janes/schema/janesxml/data/news/jdw/jdw2008/jni71796.xml} status=0 QTime=1 
&lt;/span&gt;Mar 23, 2009 12:45:42 PM org.apache.solr.handler.dataimport.SolrWriter readIndexerProperties
INFO: Read dataimport.properties
Mar 23, 2009 12:45:42 PM org.apache.solr.handler.dataimport.DataImporter doFullImport
INFO: Starting Full Import
Mar 23, 2009 12:45:42 PM org.apache.solr.handler.dataimport.SolrWriter readIndexerProperties
INFO: Read dataimport.properties
Mar 23, 2009 12:45:42 PM org.apache.solr.handler.dataimport.TemplateTransformer transformRow
WARNING: Unable to resolve variable: dataimporter.functions.escapeQueryChars(dataimporter.request.single) &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; parsing expression: fileAbsolutePath:${dataimporter.functions.escapeQueryChars(dataimporter.request.single)}
Mar 23, 2009 12:45:42 PM org.apache.solr.core.SolrDeletionPolicy onInit
INFO: SolrDeletionPolicy.onInit: commits:num=1
	commit{dir=/Volumes/spare/ts/solrnightlyjanes/data/index,segFN=segments_3,version=1237809265075,generation=3,filenames=[_5.nrm, _5.tii, _5.tis, _5.fdx, _5.prx, _5.fdt, _5.fnm, segments_3, _5.frq]
Mar 23, 2009 12:45:42 PM org.apache.solr.core.SolrDeletionPolicy updateCommits
INFO: last commit = 1237809265075
Mar 23, 2009 12:45:42 PM org.apache.solr.handler.dataimport.TemplateTransformer transformRow
WARNING: Unable to resolve variable: dataimporter.functions.escapeQueryChars(dataimporter.request.single) &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; parsing expression: fileAbsolutePath:${dataimporter.functions.escapeQueryChars(dataimporter.request.single)}
Mar 23, 2009 12:45:42 PM org.apache.solr.handler.dataimport.TemplateTransformer transformRow
WARNING: Unable to resolve variable: dataimporter.functions.escapeQueryChars(dataimporter.request.single) &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; parsing expression: fileAbsolutePath:${dataimporter.functions.escapeQueryChars(dataimporter.request.single)}
Mar 23, 2009 12:45:42 PM org.apache.solr.handler.dataimport.DocBuilder commit
INFO: Full Import completed successfully
Mar 23, 2009 12:45:42 PM org.apache.solr.update.DirectUpdateHandler2 commit
INFO: start commit(optimize=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,waitFlush=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12688281" author="shalinmangar" created="Mon, 23 Mar 2009 13:00:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;However I still can get things to work. My solr-data.xml is now as follows:-&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sorry, I was not very clear. I meant that we need to create a new Evaluator which can escape query characters. I&apos;ll create an issue and give a patch.&lt;/p&gt;</comment>
                            <comment id="12688583" author="shalinmangar" created="Tue, 24 Mar 2009 06:28:54 +0000"  >&lt;p&gt;OK I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1083&quot; title=&quot;An Evaluator for escaping query characters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1083&quot;&gt;&lt;del&gt;SOLR-1083&lt;/del&gt;&lt;/a&gt; for this enhancement&lt;/p&gt;</comment>
                            <comment id="12689026" author="fergus" created="Wed, 25 Mar 2009 08:22:14 +0000"  >&lt;p&gt;Here I am at apacheCon. I finally got email going and it looks as though it is going to stop raining.&lt;/p&gt;

&lt;p&gt;And to top it all I have been able to delete documents. Fantastic. Thanks very much. &lt;/p&gt;

&lt;p&gt;I now have very flexable and powerfull functionality that is IMHO miles better than the equivilent functionality in the commercial search engines I  have used.&lt;/p&gt;

&lt;p&gt;However, I tried deleting some documents that dont exist and was wondering if I the full trace back was required. A simple message should be enough?&lt;/p&gt;

&lt;p&gt;I will review and comment the patch and re-upload ASAP.&lt;/p&gt;</comment>
                            <comment id="12694431" author="fergus" created="Wed, 1 Apr 2009 10:08:37 +0100"  >&lt;p&gt;A more complete version of the patch with docs and an expanded regex test case. Ready for submission?&lt;/p&gt;</comment>
                            <comment id="12697463" author="fergus" created="Thu, 9 Apr 2009 11:08:04 +0100"  >&lt;p&gt;Now with test case for the ChangeListEntityProcessor &lt;/p&gt;</comment>
                            <comment id="12697464" author="fergus" created="Thu, 9 Apr 2009 11:09:58 +0100"  >&lt;p&gt;Ooups. Deleted my patch! Uploading again.&lt;/p&gt;</comment>
                            <comment id="12697466" author="fergus" created="Thu, 9 Apr 2009 11:11:00 +0100"  >&lt;p&gt;This time it is right!&lt;/p&gt;</comment>
                            <comment id="12698710" author="shalinmangar" created="Tue, 14 Apr 2009 10:21:35 +0100"  >&lt;p&gt;Fergus, ChangeListEntityProcessor seems to duplicate URIDataSource&apos;s functionality instead of using it. Why is that?&lt;/p&gt;</comment>
                            <comment id="12698767" author="fergus" created="Tue, 14 Apr 2009 14:23:27 +0100"  >&lt;p&gt;Hmmm,&lt;/p&gt;

&lt;p&gt;Are you referring to the fragment of code inside ChangeListEntityProcessor that opens the changelist, and its similarity to the functionality in URIDataSource?&lt;/p&gt;

&lt;p&gt;I had not thought about arranging some kind of nested use of URIDataSource... is that what you are thinking about? &lt;/p&gt;</comment>
                            <comment id="12699273" author="shalinmangar" created="Wed, 15 Apr 2009 17:47:30 +0100"  >&lt;blockquote&gt;&lt;p&gt;Are you referring to the fragment of code inside ChangeListEntityProcessor that opens the changelist, and its similarity to the functionality in URIDataSource?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I had not thought about arranging some kind of nested use of URIDataSource... is that what you are thinking about? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not exactly. EntityProcessors do not access http/files directly. That&apos;s what DataSources are for. The ChangeListEntityProcessor should just use the context.getDataSource() instead of creating URLConnection directly. The only problem with that approach is that the baseLocation must be specified on the &amp;lt;dataSource&amp;gt;. If you really need it to be returned with the row, you can put a template field with its value, assuming the baseLocation is fixed.&lt;/p&gt;

&lt;p&gt;The more I look at this, the more I feel that the name &apos;ChangeListEntityProcessor&apos; is misleading. It doesn&apos;t really do any changes. It is actually what I imagined a LineEntityProcessor would be. It just streams lines one by one after accepting or rejecting some lines with regex. Whatever else you need to do (for your original use-case), can be done with nested entities and/or custom transformers.&lt;/p&gt;

&lt;p&gt;What are the changes to TestRegexTransformer that this patch includes? Are these tests that you wrote for the RegexTransformer improvements/fixes that you found earlier? If yes, we should commit them through a different issue. Same should be done for the URIDataSource and associated changes.&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="12699275" author="shalinmangar" created="Wed, 15 Apr 2009 17:50:13 +0100"  >&lt;p&gt;Also, you should override EntityProcessorBase#destroy and close the reader object in it.&lt;/p&gt;</comment>
                            <comment id="12699309" author="fergus" created="Wed, 15 Apr 2009 19:36:14 +0100"  >&lt;p&gt;Oh boy is this taking ages!. Taking the points in order&lt;/p&gt;

&lt;p&gt;1)OK. I will try and rewrite it again with this point in mind.&lt;/p&gt;

&lt;p&gt;2)This beast has changed its spots big time and I agree its name is now totally inappropriate. It could at a pinch process CSV, tab separated or many other line orientated text formats and the power provided by nested entities and/or custom transformers is considerable. LineEntityProcessor or LineFilterEntityProcessor are good names.&lt;/p&gt;

&lt;p&gt;3) The existing tests with TestRegexTransformer focused on patterns that matched and checked that the expected things happened. My extra tests tested the behavior when patterns failed to match. This was an issue earlier on.&lt;/p&gt;</comment>
                            <comment id="12699311" author="shalinmangar" created="Wed, 15 Apr 2009 19:48:32 +0100"  >&lt;blockquote&gt;&lt;p&gt;Oh boy is this taking ages!. Taking the points in order &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I didn&apos;t mean to overwhelm you. I can pick it up from here. I have a half-cooked patch with the above changes.&lt;/p&gt;</comment>
                            <comment id="12699324" author="fergus" created="Wed, 15 Apr 2009 20:22:10 +0100"  >&lt;p&gt;No! It is a learning process for me. It is just it is taking so long to get it sorted.&lt;/p&gt;

&lt;p&gt;    I will rename the processor&lt;/p&gt;

&lt;p&gt;    I am of course very interested in your patch.&lt;/p&gt;

&lt;p&gt;    I agree the included TestRegexTransformer patch could perhaps be a another JIRA issue. Should I open a new one or reopen &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1080&quot; title=&quot;RegexTransformer should not replace if regex is not matched&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1080&quot;&gt;&lt;del&gt;SOLR-1080&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;    I will add an override for EntityProcessorBase#destroy&lt;/p&gt;</comment>
                            <comment id="12699348" author="shalinmangar" created="Wed, 15 Apr 2009 21:15:31 +0100"  >&lt;p&gt;OK, here&apos;s the patch. Completely untested, sorry.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Removed explicit URLConnection creation. Just use the entity&apos;s data source&lt;/li&gt;
	&lt;li&gt;Does not return baseLocation (because now only the data source knows about it)&lt;/li&gt;
	&lt;li&gt;Removes a lot of stuff that I think we don&apos;t need (and I may be wrong here)&lt;/li&gt;
	&lt;li&gt;Closes the reader in destroy&lt;/li&gt;
	&lt;li&gt;Still has TestRegexTransformer changes&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;All yours now. Big thanks for bearing with me!&lt;/p&gt;</comment>
                            <comment id="12699418" author="fergus" created="Wed, 15 Apr 2009 23:15:31 +0100"  >&lt;p&gt;Hmmm How do I apply your patch&lt;/p&gt;

&lt;p&gt;I tried &quot;patch -p0 &amp;lt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1060&quot; title=&quot;a new DIH EnityProcessor allowing text file lists of files to be indexed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1060&quot;&gt;&lt;del&gt;SOLR-1060&lt;/del&gt;&lt;/a&gt;.patch&quot; and &quot;patch -p1 &amp;lt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1060&quot; title=&quot;a new DIH EnityProcessor allowing text file lists of files to be indexed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1060&quot;&gt;&lt;del&gt;SOLR-1060&lt;/del&gt;&lt;/a&gt;.patch&quot; and it just asked all kind of difficult qustions.&lt;/p&gt;</comment>
                            <comment id="12699549" author="shalinmangar" created="Thu, 16 Apr 2009 07:34:37 +0100"  >&lt;p&gt;This one should work.&lt;/p&gt;

&lt;p&gt;I&apos;ve removed the changes to HttpDataSource (the deprecation) which was causing this funniness.&lt;/p&gt;</comment>
                            <comment id="12699559" author="fergus" created="Thu, 16 Apr 2009 08:24:52 +0100"  >&lt;p&gt;Thanks. It is working fine now.&lt;/p&gt;

&lt;p&gt;I have used it on my data and all seems fine, I am now trying to get the testcase working.&lt;/p&gt;

&lt;p&gt;Are you happy with the name &quot;LineFilterEntityProcessor&quot; or do you prefer &quot;LineEntityProcessor&quot;?&lt;/p&gt;

&lt;p&gt;Also what should I do about the TestRegexTransformer testcase?&lt;/p&gt;</comment>
                            <comment id="12699560" author="shalinmangar" created="Thu, 16 Apr 2009 08:27:56 +0100"  >&lt;blockquote&gt;&lt;p&gt;Are you happy with the name &quot;LineFilterEntityProcessor&quot; or do you prefer &quot;LineEntityProcessor&quot;?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I prefer LineEntityProcessor&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also what should I do about the TestRegexTransformer testcase?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Attach it to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1080&quot; title=&quot;RegexTransformer should not replace if regex is not matched&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1080&quot;&gt;&lt;del&gt;SOLR-1080&lt;/del&gt;&lt;/a&gt;. That can go in immediately.&lt;/p&gt;</comment>
                            <comment id="12699820" author="fergus" created="Thu, 16 Apr 2009 20:25:01 +0100"  >&lt;p&gt;Your patch was almost perfect,&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I sorted comments and other details to suite the new model&lt;/li&gt;
	&lt;li&gt;Renamed the entity to LineEntityProcessor&lt;/li&gt;
	&lt;li&gt;Fixed the unit test module&lt;/li&gt;
	&lt;li&gt;Moved testing of regex stuff elsewhere&lt;/li&gt;
	&lt;li&gt;tested with my own apps&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12700049" author="shalinmangar" created="Fri, 17 Apr 2009 08:33:20 +0100"  >&lt;p&gt;Thanks Fergus.&lt;/p&gt;

&lt;p&gt;Even though LineEntityProcessor was originally conceived by you for reading file/urls from a text file, it does not need to be mentioned in the javadocs. I think it can confuse users. The purpose of LineEntityProcessor is simple, just read line by and line, accept/reject and pass on. The documentation should not be more complicated than that.&lt;/p&gt;

&lt;p&gt;Also look at &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1120&quot; title=&quot;Simplify EntityProcessor API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1120&quot;&gt;&lt;del&gt;SOLR-1120&lt;/del&gt;&lt;/a&gt; that I just opened. There are just so many things in entity processor that even I cannot keep track of. It is a big change but very much needed so let me circle back to this issue after taking care of it.&lt;/p&gt;

&lt;p&gt;Some of the gotchas are:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Right way to clean up. Contrary to my previous comments, destroy is not the right place to do the cleanup.&lt;/li&gt;
	&lt;li&gt;applyTransformer can return multiple rows which are cached in the entity processor base class&lt;/li&gt;
	&lt;li&gt;onError attribute need to be handled correctly e.g. abort, skip, continue&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I&apos;ll take this forward from here.&lt;/p&gt;</comment>
                            <comment id="12700736" author="shalinmangar" created="Mon, 20 Apr 2009 10:59:29 +0100"  >&lt;ol&gt;
	&lt;li&gt;Renamed fileName attribute to url to be consistent with XPathEntityProcessor&lt;/li&gt;
	&lt;li&gt;Renamed omitLineRegex to skipLineRegex (renamed internal variables as well)&lt;/li&gt;
	&lt;li&gt;Updated javadocs to remove mentions of change lists (except in one place)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;All tests pass. I&apos;ll commit this shortly.&lt;/p&gt;</comment>
                            <comment id="12700743" author="shalinmangar" created="Mon, 20 Apr 2009 11:13:39 +0100"  >&lt;p&gt;Committed revision 766638.&lt;/p&gt;

&lt;p&gt;Thanks Fergus!&lt;/p&gt;</comment>
                            <comment id="12775686" author="gsingers" created="Tue, 10 Nov 2009 15:51:59 +0000"  >&lt;p&gt;Bulk close for Solr 1.4&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12419273">SOLR-1083</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12405906" name="SOLR-1060.patch" size="28426" author="shalinmangar" created="Mon, 20 Apr 2009 10:59:29 +0100"/>
                            <attachment id="12405687" name="SOLR-1060.patch" size="27980" author="fergus" created="Thu, 16 Apr 2009 20:25:01 +0100"/>
                            <attachment id="12405622" name="SOLR-1060.patch" size="31473" author="shalinmangar" created="Thu, 16 Apr 2009 07:34:37 +0100"/>
                            <attachment id="12405563" name="SOLR-1060.patch" size="34816" author="shalinmangar" created="Wed, 15 Apr 2009 21:15:31 +0100"/>
                            <attachment id="12405058" name="SOLR-1060.patch" size="38732" author="fergus" created="Thu, 9 Apr 2009 11:11:00 +0100"/>
                            <attachment id="12403395" name="SOLR-1060.patch" size="20406" author="shalinmangar" created="Sun, 22 Mar 2009 18:48:00 +0000"/>
                            <attachment id="12402662" name="SOLR-1060.patch" size="19173" author="fergus" created="Fri, 20 Mar 2009 13:43:31 +0000"/>
                            <attachment id="12402286" name="SOLR-1060.patch" size="13570" author="fergus" created="Mon, 16 Mar 2009 14:20:18 +0000"/>
                            <attachment id="12401948" name="SOLR-1060.patch" size="8268" author="fergus" created="Wed, 11 Mar 2009 17:49:40 +0000"/>
                            <attachment id="12402658" name="regex-fix.patch" size="784" author="noble.paul" created="Fri, 20 Mar 2009 12:25:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 11 Mar 2009 04:34:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6575</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxnj3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20131</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>