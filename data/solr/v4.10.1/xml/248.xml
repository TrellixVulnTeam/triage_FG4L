<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:18:52 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-248/SOLR-248.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-248] Capitalization Filter Factory</title>
                <link>https://issues.apache.org/jira/browse/SOLR-248</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;For tokens that are used in faceting, it is nice to have standard capitalization.  &lt;/p&gt;

&lt;p&gt;I want &quot;Aerial views&quot; and &quot;Aerial Views&quot; to both be: &quot;Aerial Views&quot;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12370112">SOLR-248</key>
            <summary>Capitalization Filter Factory</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ryantxu">Ryan McKinley</assignee>
                                    <reporter username="ryantxu">Ryan McKinley</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 May 2007 05:07:59 +0100</created>
                <updated>Fri, 10 May 2013 11:40:57 +0100</updated>
                            <resolved>Fri, 3 Aug 2007 18:27:00 +0100</resolved>
                                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12498487" author="ryantxu" created="Thu, 24 May 2007 06:29:22 +0100"  >&lt;p&gt;Implementation and test...&lt;/p&gt;

&lt;p&gt;&amp;lt;filter class=&quot;solr.CapitalizationFilterFactory&quot; onlyFirstWord=&quot;false&quot; keep=&quot;and or the is my or de&quot; maxTokenLength=&quot;40&quot; maxWordCount=&quot;4&quot; okPrefix=&quot;McK&quot; forceFirstLetter=&quot;true&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;onlyFirstWord=&quot;false&quot; &amp;#8211; this capatalizes every word&lt;/p&gt;

&lt;p&gt;keep=&quot;and or the is my or de&quot; &amp;#8211; don&apos;t change capitalization for these words&lt;/p&gt;

&lt;p&gt;forceFirstLetter=&quot;true&quot; &amp;#8211; capitalize the first letter of the Token (not word) even if it is in the &quot;keep&quot; list&lt;/p&gt;

&lt;p&gt;maxTokenLength=&quot;40&quot; &amp;#8211; if the token is longer then 40 chars, don&apos;t even try to capitalize it&lt;/p&gt;

&lt;p&gt;maxWordCount=&quot;4&quot; &amp;#8211; if there are more then 4 words, don&apos;t try capitalizing&lt;/p&gt;</comment>
                            <comment id="12498488" author="hossman" created="Thu, 24 May 2007 06:42:28 +0100"  >&lt;p&gt;1) would it make sense for the keep option to refer to a file, using the same format as StopFilter ... that way it&apos;s easy to reuse the same file (which seems like it would be a common case.&lt;/p&gt;

&lt;p&gt;2) what is the point of forceFirstLetter=&quot;true&quot; ? ... if you want to force capitalization, what&apos;s the point of making hte keep list?&lt;/p&gt;

&lt;p&gt;3) is okPrefix going to force the case for things that have that prefix in an alternate case, or only allow that casing to remain (ie: if i index McKeen, Mckeen, mckeen and MCKEEN what tokens do i wind up with?)&lt;/p&gt;</comment>
                            <comment id="12498492" author="ryantxu" created="Thu, 24 May 2007 07:06:59 +0100"  >&lt;p&gt;&amp;gt; &lt;br/&gt;
&amp;gt; 1) would it make sense for the keep option to refer to a file, using the same format as StopFilter ... that way it&apos;s easy to reuse the same file (which seems like it would be a common case.&lt;br/&gt;
&amp;gt; &lt;/p&gt;

&lt;p&gt;probably.  that is a good idea&lt;/p&gt;


&lt;p&gt;&amp;gt; 2) what is the point of forceFirstLetter=&quot;true&quot; ? ... if you want to force capitalization, what&apos;s the point of making hte keep list?&lt;br/&gt;
&amp;gt; &lt;/p&gt;

&lt;p&gt;This is one that came of necessity!&lt;/p&gt;

&lt;p&gt;with keep=&quot;the ...&quot;  and input:&lt;br/&gt;
 &quot;Grand army of the Republic&quot;, &quot;the arts&quot;&lt;/p&gt;

&lt;p&gt;I want: &quot;Grand Army of the Republic&quot; and &quot;The Arts&quot;&lt;/p&gt;

&lt;p&gt;&quot;forceFirstLetter&quot; only applies to the first character in the token, not to each word.&lt;/p&gt;


&lt;p&gt;&amp;gt; 3) is okPrefix going to force the case for things that have that prefix in an alternate case, or only allow that casing to remain (ie: if i index McKeen, Mckeen, mckeen and MCKEEN what tokens do i wind up with?)&lt;br/&gt;
&amp;gt; &lt;/p&gt;

&lt;p&gt;As written, if the prefix matches, it assumes the word capitalization is correct.  For my input data, this is sufficient &amp;#8211; but it should problem do something smarter.&lt;/p&gt;

&lt;p&gt;So, if you index &quot;McKeen, Mckeen, mckeen, MCKEEN and McKEEN&quot;, you would get:&lt;/p&gt;

&lt;p&gt; &quot;McKeen, Mckeen, Mckeen, Mckeen And McKEEN&quot;&lt;/p&gt;

&lt;p&gt;If &quot;okPrefix&quot; was treated as &lt;b&gt;the&lt;/b&gt; capitalization for input where the lowercase prefix matches &quot;mck&quot;, it would give:&lt;/p&gt;

&lt;p&gt; &quot;McKeen, McKeen, McKeen, McKeen And McKeen&quot;&lt;/p&gt;
</comment>
                            <comment id="12498700" author="yseeley@gmail.com" created="Thu, 24 May 2007 17:23:40 +0100"  >&lt;p&gt;Hmmm, this feels slightly strange implementing at the indexing level.&lt;br/&gt;
What are the ads/disads vs just lowercasing for indexing and capitalizing at the presentation/application layer?&lt;/p&gt;</comment>
                            <comment id="12498711" author="ryantxu" created="Thu, 24 May 2007 17:43:48 +0100"  >&lt;p&gt;It is a little strange, but (in my case anyway) i think it makes sense...  &lt;/p&gt;

&lt;p&gt;I am indexing a bunch of metadata from a bunch of libraries (OAI-PMH) &amp;#8211; I want to display the data exactly as it came from the source, but for faceted browsing I need to normalize capitalization.&lt;/p&gt;

&lt;p&gt;Implemented at the indexing level, I can have different values for the stored value and indexed terms.  Also, at the indexing level I can leverage existing Tokenizers and Filters to build the tokens that need capitalization &amp;#8211; it keeps all the configuration in schema.xml and lets the OAI -&amp;gt; solr xml be a simple transformation, this way whoever takes care of this need only learn solr configuration, not ryan+solr configuration. &lt;/p&gt;

&lt;p&gt;If it is not generally useful I can keep it elsewhere - that is why we have the nice plugin framework!&lt;/p&gt;
</comment>
                            <comment id="12498717" author="yseeley@gmail.com" created="Thu, 24 May 2007 18:07:39 +0100"  >&lt;p&gt;&amp;gt; Implemented at the indexing level, I can have different values for the stored value and indexed terms.&lt;br/&gt;
One downside is that it complicates certain things like wildcard or prefix queries (capitalizing the first letter and lowercasing the second is something that the QueryParser does not support).&lt;/p&gt;

&lt;p&gt;You could still store the values verbatim, and index as all lowercase.&lt;br/&gt;
Then the application could capitalize the results it gets back as it sees fit.&lt;br/&gt;
I do see value pushing this type of logic back to the search engine though.&lt;/p&gt;

&lt;p&gt;Of course, I think this might be a more general problem in faceting... what to actually use as a label for display purposes vs what the terms in the index were (think price formatting, labels for more complex facet queries, etc).&lt;/p&gt;</comment>
                            <comment id="12498726" author="ryantxu" created="Thu, 24 May 2007 18:20:34 +0100"  >&lt;p&gt;&amp;gt; &lt;br/&gt;
&amp;gt;&amp;gt; Implemented at the indexing level, I can have different values for the stored value and indexed terms.&lt;br/&gt;
&amp;gt; One downside is that it complicates certain things like wildcard or prefix queries&lt;br/&gt;
&amp;gt;&lt;/p&gt;

&lt;p&gt;currently i&apos;m using copyfield and doing the prefix query on a different field... not great but it works!&lt;/p&gt;

&lt;p&gt;&amp;gt; &lt;br/&gt;
&amp;gt; Of course, I think this might be a more general problem in faceting... what to actually use as a label for display purposes vs what the terms in the index were (think price formatting, labels for more complex facet queries, etc).&lt;br/&gt;
&amp;gt; &lt;/p&gt;

&lt;p&gt;Interesting.  I could index with a lowercase filter then reformat the facet results...  I&apos;ll take a look at that after the deadline passes &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12498817" author="skeptikos" created="Thu, 24 May 2007 21:38:29 +0100"  >&lt;p&gt;While I fully agree that faceting does raise some odd issues stemming from the display of normally-invisible indexed values to humans, and that it  theoretically should be responsibility of the front-end to translate index values into human-readable values, there are great practical advantages in both efficiency and convenience to making the indexed values &quot;pretty&quot;, and to centralize as much of that as possible in the Analysis stage.&lt;/p&gt;

&lt;p&gt;In particular, I will try this and am very likely to put this into use this weekend, so thank you Ryan!  So I&apos;m +1 to adding it to the Solr distribution, though to avoid confusing people it should have a JavaDoc comment explaining that the main use is in faceting to avoid having to introduce such common logic into the presentation-layer.&lt;/p&gt;

&lt;p&gt;Regarding the implementation,&lt;/p&gt;

&lt;p&gt;1. For &apos;keep&apos; and &apos;okPrefix&apos; (and were it not for reverse-compatibility issues, for &apos;words&apos; in StopFilter), it would be nice to have a means to specify either a direct list or a filename in the same parameter.  A simple approach might be something like keep=&quot;word word word...&quot; vs. keep=&quot;&amp;lt;file&quot;, or even keep=&quot;&amp;lt;file &amp;lt;file word word&quot; (with the requirement for backslash-escaping spaces in either)...  Or alternately something like txt:filename (vs. xml:filename, json:filename, etc.) with an unescaped : being significant.&lt;/p&gt;

&lt;p&gt;2. Why is so much of the logic in the Factory?  This drags Solr-specific stuff in when a user might want to use just the Analyzer in a non-Solr context. Wouldn&apos;t it be better in general for Solr Analyzers to be self-complete, with the Factory merely being an adaptor between SolrParams &amp;amp; external resources and the Analyzer&apos;s constructor?&lt;/p&gt;

&lt;p&gt;Also, why is keep in a synchronized map, since there is no mutator?  (I know, picky picky...)&lt;/p&gt;

&lt;p&gt;Good luck with the deadline!&lt;/p&gt;</comment>
                            <comment id="12498834" author="yseeley@gmail.com" created="Thu, 24 May 2007 21:59:55 +0100"  >&lt;p&gt;&amp;gt; Why is so much of the logic in the Factory?&lt;/p&gt;

&lt;p&gt;I haven&apos;t looked at this specific code, but this is my preference in general.  multiple TokenFilters are created per-field instance on the index side, and per-query-term on the search side, so it&apos;s better to pull all the setup you can out of the Filter for performance reasons.&lt;/p&gt;</comment>
                            <comment id="12498841" author="ryantxu" created="Thu, 24 May 2007 22:07:48 +0100"  >&lt;p&gt;&amp;gt; Why is so much of the logic in the Factory? &lt;/p&gt;

&lt;p&gt;It seemed silly to copy the same things over and over for each time the type is indexed or queried...  &lt;/p&gt;

&lt;p&gt;&amp;gt; why is keep in a synchronized map,&lt;/p&gt;

&lt;p&gt;I&apos;m not sure it needs to be, but i was being cautious...   the map is only created once (and never edited) but could be accessed my many threads simultaneously.&lt;/p&gt;

</comment>
                            <comment id="12501409" author="ryantxu" created="Tue, 5 Jun 2007 00:57:27 +0100"  >&lt;p&gt;applies with trunk&lt;/p&gt;</comment>
                            <comment id="12512603" author="ryantxu" created="Fri, 13 Jul 2007 21:09:10 +0100"  >&lt;p&gt;1. Added better javadocs explaining the configuration.&lt;br/&gt;
2. removed synchronized map&lt;br/&gt;
3. put the Filter as a package private class in the Factory file &amp;#8211; since the filter relies on hte factory, it is not particularly useful outsid solr.&lt;/p&gt;

&lt;p&gt;I would like to add this soon&lt;/p&gt;</comment>
                            <comment id="12517591" author="ryantxu" created="Fri, 3 Aug 2007 18:27:00 +0100"  >&lt;p&gt;added a while ago&lt;/p&gt;</comment>
                            <comment id="12579136" author="hossman" created="Sun, 16 Mar 2008 03:23:51 +0000"  >&lt;p&gt;This bug was modified as part of a bulk update using the criteria...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Marked &quot;Resolved&quot; and &quot;Fixed&quot;&lt;/li&gt;
	&lt;li&gt;Had no &quot;Fix Version&quot; versions&lt;/li&gt;
	&lt;li&gt;Was listed in the CHANGES.txt for 1.3 as of today 2008-03-15&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The Fix Version for all 29 issues found was set to 1.3, email notification was suppressed to prevent excessive email.&lt;/p&gt;

&lt;p&gt;For a list of all the issues modified, search jira comments for this (hopefully) unique string: batch20070315hossman1&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12361814" name="SOLR-248-CapitalizationFilter.patch" size="12005" author="ryantxu" created="Fri, 13 Jul 2007 21:09:10 +0100"/>
                            <attachment id="12358908" name="SOLR-248-CapitalizationFilter.patch" size="12005" author="ryantxu" created="Tue, 5 Jun 2007 00:57:27 +0100"/>
                            <attachment id="12358059" name="SOLR-248-CapitalizationFilter.patch" size="12589" author="ryantxu" created="Thu, 24 May 2007 06:29:22 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 24 May 2007 05:42:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7341</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxshz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20936</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>