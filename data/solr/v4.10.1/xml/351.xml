<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:23:37 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-351/SOLR-351.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-351] external value source</title>
                <link>https://issues.apache.org/jira/browse/SOLR-351</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Need a way to rapidly do a bulk update of a single field for use as a component in a function query (no need to be able to search on it).&lt;br/&gt;
Idea: create an ExternalValueSource fieldType that reads it&apos;s values from a file.  The file could be simple id,val records, and stored in the index directory so it would get replicated.  &lt;/p&gt;

&lt;p&gt;Values could optionally be updated more often than the searcher (hashCode/equals should take this into account to prevent caching issues).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12377856">SOLR-351</key>
            <summary>external value source</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Sep 2007 04:10:24 +0100</created>
                <updated>Fri, 10 May 2013 11:39:33 +0100</updated>
                            <resolved>Mon, 12 Jan 2009 13:50:27 +0000</resolved>
                                                    <fixVersion>1.3</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12530820" author="yseeley@gmail.com" created="Thu, 27 Sep 2007 20:45:35 +0100"  >&lt;p&gt;Obstacle #1: how to find the index directory (we really need the solr core passed at some point - perhaps during FieldType.init()?&lt;br/&gt;
It would be nice of a SolrQueryRequest object was passed during all calls to things like getValueSource(), but it may be too late for that (and much more difficult). &lt;/p&gt;</comment>
                            <comment id="12531200" author="hossman" created="Sat, 29 Sep 2007 03:39:58 +0100"  >&lt;p&gt;FieldType is abstract, so we can always add a getValueSource(SolrQueryRequest req, SchemaFIeld field) that delegates to getValueSource(SchemaFIeld field) by default.&lt;/p&gt;

&lt;p&gt;(ditto for the init method if needed ... i almost think we should do both since i can imagine situations where FieldType might want to go ahead and pre-compute some info, but doing something like this would raise a lot of questions about what to do when newSearchers are opened ... might be better to stick with the request type access for now untill we have stronger uses cases for anything else)&lt;/p&gt;</comment>
                            <comment id="12531203" author="yseeley@gmail.com" created="Sat, 29 Sep 2007 04:18:12 +0100"  >&lt;p&gt;&amp;gt; a lot of questions about what to do when newSearchers are opened&lt;br/&gt;
Yeah, it&apos;s not actually getValueSource() where one would normally want the request... ValueSource is like a Query - relatively independent of context.  getValues(IndexReader reader) is where you normally want it.. but there are layers of Lucene in between that know nothing of Solr.&lt;/p&gt;</comment>
                            <comment id="12531250" author="yseeley@gmail.com" created="Sat, 29 Sep 2007 16:26:28 +0100"  >&lt;p&gt;Hmmm, due to pluggable query parsers patch, I pass around the QParser everywhere now, so perhaps&lt;br/&gt;
it is easiest + consistent to extend that to getValueSource.&lt;br/&gt;
public ValueSource getValueSource(SchemaField field, QParser parser)&lt;/p&gt;

&lt;p&gt;Easy change... it&apos;s only called in one place in the source.&lt;/p&gt;</comment>
                            <comment id="12531988" author="yseeley@gmail.com" created="Wed, 3 Oct 2007 03:48:35 +0100"  >&lt;p&gt;OK, the latest &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-334&quot; title=&quot;pluggable query parsers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-334&quot;&gt;&lt;del&gt;SOLR-334&lt;/del&gt;&lt;/a&gt; patch includes external value source.&lt;/p&gt;

&lt;p&gt;Here is what the fieldType in the schema looks like:&lt;br/&gt;
    &amp;lt;fieldType name=&quot;file&quot; class=&quot;solr.ExternalFileField&quot; keyField=&quot;id&quot; defVal=&quot;1&quot; stored=&quot;false&quot; indexed=&quot;false&quot;  valType=&quot;float&quot;/&amp;gt;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;keyField will normally be the unique key field, but it doesn&apos;t have to be.
	&lt;ul&gt;
		&lt;li&gt;it&apos;s OK to have a keyField value that can&apos;t be found in the index&lt;/li&gt;
		&lt;li&gt;it&apos;s OK to have some documents without a keyField in the file (defVal is used as the default)&lt;/li&gt;
		&lt;li&gt;it&apos;s OK for a keyField value to point to multiple documents (no uniqueness requirement)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;valType is a reference to another fieldType to define the value type of this field (must currently be FloatField (float))&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The format of the external file is simply&lt;br/&gt;
keyFieldValue=floatValue&lt;br/&gt;
keyFieldValue=floatValue&lt;/p&gt;

&lt;p&gt;Solr looks for the external file in the index directory under the name of&lt;br/&gt;
external_&amp;lt;fieldname&amp;gt;  or  external_&amp;lt;fieldname&amp;gt;.*&lt;/p&gt;

&lt;p&gt;If any files of the latter pattern appear, the last (after being sorted by name) will be used and previous versions will be deleted.  This is to help support systems where one may not be able to overwrite a file (like Windows, if the file is in use).&lt;/p&gt;

&lt;p&gt;If the external file has already been loaded, and it is changed, those changes will not be visible until a commit has been done.&lt;/p&gt;

&lt;p&gt;The external file may be sorted or unsorted by the key field, but it will be substantially slower (untested) if it isn&apos;t sorted.&lt;/p&gt;</comment>
                            <comment id="12535001" author="yseeley@gmail.com" created="Mon, 15 Oct 2007 23:47:48 +0100"  >&lt;p&gt;Attaching patch (separated out from pluggable query parsers, but still depends on it).&lt;br/&gt;
I&apos;ll commit shortly barring objections.&lt;/p&gt;</comment>
                            <comment id="12535321" author="skeptikos" created="Tue, 16 Oct 2007 20:09:11 +0100"  >&lt;p&gt;My apologies for these last-minute peanut-gallery comments, and especially if they&apos;re completely off-target (I&apos;ve not yet used Function Queries), but reviewing the patch raised these questions and ideas:&lt;/p&gt;

&lt;p&gt;1. Why force a 1:1 mapping between the fieldname and the filename?  Could there ever be a be a situation where multiple fields would want to share the same file, e.g. if if the file is a sampling of a generic weighting function, or even if field-specific if it needs to be shared across multiple Solr instances/cores? &lt;/p&gt;

&lt;p&gt;Within the current structure, an extra file=&quot;&amp;lt;baseFile&amp;gt;&quot; argument to ExternalFieldField and FileFloatSource couldn&apos;t hurt; it could still default to external_&amp;lt;fieldname&amp;gt;, relative paths could still resolve to ffs.indexDir, and the getLatestFile extension logic could still be applied, but specified names with relative or absolute paths would be allowed.&lt;/p&gt;

&lt;p&gt;2. Is ExternalFieldField useful apart from being used as input to function queries, e.g. could one sort or facet against it?&lt;/p&gt;

&lt;p&gt;2a. If not (or even if so), couldn&apos;t one get enhanced flexibility and simplicity by creating a function interface to FileFloatSource that uses a sub-ValueSource to obtain key values?  That way the domain of the mapping function isn&apos;t limited to a literal set of Terms.  For example, a function of the form&lt;/p&gt;

&lt;p&gt;	filemap( &amp;lt;keyFieldName&amp;gt;[, &quot;baseFilePath&quot; )&lt;/p&gt;

&lt;p&gt;could be applied as, for example,&lt;/p&gt;

&lt;p&gt;	boost( filemap( keyField ) )&lt;br/&gt;
        boost( filemap( div( ord( someField ), const( 1426 ) ), &quot;/var/data/termBooster&quot; ) )    &lt;/p&gt;

&lt;p&gt;I&apos;m thinking something like this (added to FunctionQParser):&lt;/p&gt;

&lt;p&gt;   vsParsers.put(&quot;filemap&quot;, new VSParser() {&lt;br/&gt;
      ValueSource parse(FunctionQParser fp) throws ParseException &lt;/p&gt;
{
        ValueSource source = fp.parseValSource();
        fp.sp.expect(&quot;,&quot;);
        String base = fp.sp.getQuotedString();
(would also want to get the default in there)
        return new FileFloatFunction(source, base);
      }
&lt;p&gt;    });&lt;/p&gt;

&lt;p&gt;One would think a FileFloatFunction could extend FieldCacheSource, but I assume there was a good reason the FC code was duplicated rather than references, e.g. limited access.&lt;/p&gt;

&lt;p&gt;2b. If the external file could be useful for sorting/faceting, and if it could be implemented as a Function as above, then perhaps ExternalFieldField could be recast as a more general FunctionField which takes a QueryParser.StrParser string in an attribute?&lt;/p&gt;

&lt;p&gt;  &amp;lt;fieldType name=&quot;file&quot; class=&quot;solr.FunctionField&quot; expression=&quot;filemap(id)&quot; stored=&quot;false&quot; indexed=&quot;false&quot; valType=&quot;float&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;Is there any sense to these (even if the scope is way too large to be implemented in the foreseeable future)?&lt;/p&gt;

&lt;p&gt;I also have some thoughts on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-334&quot; title=&quot;pluggable query parsers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-334&quot;&gt;&lt;del&gt;SOLR-334&lt;/del&gt;&lt;/a&gt; which I&apos;ll write up in a few days.&lt;/p&gt;</comment>
                            <comment id="12536681" author="yseeley@gmail.com" created="Mon, 22 Oct 2007 15:23:46 +0100"  >&lt;p&gt;Thanks for the review JJ, I had missed it earlier somehow (I just committed this code).&lt;/p&gt;

&lt;p&gt;re: specifying filename... yes, I thought it might possibly be useful in the future, esp being able to specify somewhere different than the index directory.  I simply left it out now because nothing is lost in deferring it.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2. Is ExternalFieldField useful apart from being used as input to function queries, e.g. could one sort or facet against it?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not currently.  Perhaps in the future it would be possible to make it searchable... not sure.  And it seems like a good idea to allow sorting by a ValueSource in the future.  Faceting:  yes, I think so (again, in the future).&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2a. If not (or even if so), couldn&apos;t one get enhanced flexibility and simplicity by creating a function interface to FileFloatSource that uses a sub-ValueSource to obtain key values? That way the domain of the mapping function isn&apos;t limited to a literal set of Terms. For example, a function of the form&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmmm, I hadn&apos;t thought of hooking it directly via a new type of function, but that would work.&lt;br/&gt;
add(1, filevalues(&quot;myexternalfilename&quot;,&quot;float&quot;) )&lt;/p&gt;

&lt;p&gt;I&apos;m not sure I understand the form you picked though (a ValueSource param to filemap).&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;One would think a FileFloatFunction could extend FieldCacheSource, but I assume there was a good reason the FC code was duplicated rather than references, e.g. limited access.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right, Lucene doesn&apos;t allow write access to the FieldCache.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2b. If the external file could be useful for sorting/faceting, and if it could be implemented as a Function as above, then perhaps ExternalFieldField could be recast as a more general FunctionField which takes a QueryParser.StrParser string in an attribute?&lt;/p&gt;

&lt;p&gt;&amp;lt;fieldType name=&quot;file&quot; class=&quot;solr.FunctionField&quot; expression=&quot;filemap(id)&quot; stored=&quot;false&quot; indexed=&quot;false&quot; valType=&quot;float&quot;/&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So a FunctionField would be a shortcut or alias to any function query expression... that&apos;s a pretty interesting idea.&lt;br/&gt;
Since the signature for getValueSource now includes the QParser, this should be doable.&lt;/p&gt;</comment>
                            <comment id="12662959" author="shalinmangar" created="Mon, 12 Jan 2009 13:50:27 +0000"  >&lt;p&gt;This issue has been fixed by Yonik in revision 587098 and released with 1.3&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12375797">SOLR-334</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12367785" name="ExternalFileField.patch" size="116204" author="yseeley@gmail.com" created="Mon, 15 Oct 2007 23:47:48 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 29 Sep 2007 02:39:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7242</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxrv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20833</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>