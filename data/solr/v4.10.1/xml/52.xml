<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:24:35 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-52/SOLR-52.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-52] Lazy Field loading</title>
                <link>https://issues.apache.org/jira/browse/SOLR-52</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Add lazy field loading to solr.&lt;/p&gt;

&lt;p&gt;Currently solr reads all stored fields and filters the undesired fields based on the field list.  This is usually not a performance concern, but when using solr to store large numbers of fields, or just one large field (doc contents, eg. for highlighting), it is perceptible.&lt;/p&gt;

&lt;p&gt;Now, there is a concern with the doc cache of SolrIndexSearcher, which assumes it has the whole document in the cache.  To maintain this invariant, it is still the case that all the fields in a document are loaded in a searcher.doc&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; call.  However, if a field set is given to teh method, only the given fields are loaded directly, while the rest are loaded lazily.&lt;/p&gt;

&lt;p&gt;Some concerns about lazy field loading&lt;br/&gt;
  1. Lazy field are only valid while the IndexReader is open.  I believe this is fine since the IndexReader is kept alive by the SolrIndexSearcher, so all docs in the cache have the reader available.  &lt;br/&gt;
  2. It is slower to read a field lazily and retrieve its value later than retrieve it directory to begin with (though I don&apos;t know how much--depends on i/o factors).  We certainly don&apos;t want this to be the common case.  I added an optional call which accumulates all the field likely to be used in the request (highlighting, reponse writing), and populates the IndexSearcher cache a priori.  This has the added advantage of concentrating doc retrieval in a single place, which is nice from a performance testing perspective.&lt;br/&gt;
 3. LazyFields are incompatible with the sundry Field declarations scattered about Solr.  I believe I&apos;ve changed all the necessary locations to Fieldable.&lt;/p&gt;

&lt;p&gt;Comments appreciated&lt;/p&gt;</description>
                <environment></environment>
        <key id="12352674">SOLR-52</key>
            <summary>Lazy Field loading</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="klaasm">Mike Klaas</assignee>
                                    <reporter username="klaasm">Mike Klaas</reporter>
                        <labels>
                    </labels>
                <created>Sat, 7 Oct 2006 04:48:42 +0100</created>
                <updated>Fri, 10 May 2013 11:39:37 +0100</updated>
                            <resolved>Wed, 6 Dec 2006 19:29:33 +0000</resolved>
                                                    <fixVersion>1.1.0</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12440682" author="yseeley@gmail.com" created="Sat, 7 Oct 2006 16:59:34 +0100"  >&lt;p&gt;+1, looks good.&lt;/p&gt;

&lt;p&gt;There are some small backward incompatabilities (any place that returns a Fieldable, like getUniqueKeyField), but it can&apos;t be helped, and it&apos;s fairly expert level anyway.&lt;/p&gt;

&lt;p&gt;My only concern was about a memory increase for lazy-loaded short fields.  I reviewed some of the LazyField code just now, and it looks like this shouldn&apos;t be the case:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;LazyField is an inner class that contains an extra 3 members.   It&apos;s outer class that it will retain a reference to is FieldsReader.    The fieldsReader instance is a member of SegmentReader, and has the same lifetime as the SegmentReader.  Hence the LazyField won&apos;t extend the lifetime of any other objects.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;One thing I did see is the internal char[] buffer used to read the string in LazyField is a member for some reason (hence the data will be stored in the field &lt;b&gt;twice&lt;/b&gt; for some reason).  I think this is probably a bug, and I&apos;ll bring it up on the Lucene list.&lt;/p&gt;

&lt;p&gt;Ideas for future optimizations:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if there is no document cache, change lazy to no-load&lt;/li&gt;
	&lt;li&gt;special cases: if only a single field (like the ID field) is selected out of many documents to be return, consider bypassing doc cache and use LOAD_AND_BREAK if we know there is only a single value.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12440683" author="yseeley@gmail.com" created="Sat, 7 Oct 2006 17:17:21 +0100"  >&lt;p&gt;The one other memory increase I can see from using lazy fields is due to the thread local... a cloned IndexInput (containing a 1K byte buffer + other object overhead).  That shouldn&apos;t be a big deal since it&apos;s related to the number of different threads used to access lazy loaded fields, and not directly to the number of lazy fields themselves.&lt;/p&gt;

&lt;p&gt;In any case, your optimization of retrieving all the fields needed for the request probably prevents many lazy field invocations.&lt;/p&gt;</comment>
                            <comment id="12440945" author="yseeley@gmail.com" created="Mon, 9 Oct 2006 18:56:08 +0100"  >&lt;p&gt;&amp;gt; hence the data will be stored in the field &lt;b&gt;twice&lt;/b&gt; for some reason&lt;/p&gt;

&lt;p&gt;FYI, I just checked in a Lucene fix for this.&lt;/p&gt;</comment>
                            <comment id="12440972" author="klaasm" created="Mon, 9 Oct 2006 21:47:54 +0100"  >&lt;p&gt;updated version of patch.  Addresses some of Hoss&apos; (minor) comments.  Also, the .doc() method of SolrIndexSearcher will added the unique key field unconditionally if it is present in the schema.  IT is used randomly in several places and including checks for it in other places decreases readability. &lt;/p&gt;</comment>
                            <comment id="12440974" author="klaasm" created="Mon, 9 Oct 2006 21:50:31 +0100"  >&lt;p&gt;Note the above patch does not address the issue of lazy field use mismatch between two handlers (see solr-dev)&lt;/p&gt;</comment>
                            <comment id="12442099" author="klaasm" created="Fri, 13 Oct 2006 22:39:08 +0100"  >&lt;p&gt;Moved id field selection out of SolrIndexSearcher.doc()&lt;/p&gt;

&lt;p&gt;Chris: What would you like to see vis-a-vis the many field issues before committing?  Should we put in a global lazy-field-disable option?&lt;/p&gt;</comment>
                            <comment id="12442432" author="yseeley@gmail.com" created="Sun, 15 Oct 2006 23:39:25 +0100"  >&lt;p&gt;FYI, we need a lucene refresh before we use lazy fields because of this:&lt;br/&gt;
&lt;a href=&quot;http://issues.apache.org/jira/browse/LUCENE-683&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/LUCENE-683&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12450179" author="klaasm" created="Wed, 15 Nov 2006 20:01:26 +0000"  >&lt;p&gt;This version adds a solrconfig parameter which allows lazy fields to be enabled or disabled (disabled by default).&lt;/p&gt;

&lt;p&gt;Still needs testing after syncing with lucene changes&lt;/p&gt;</comment>
                            <comment id="12456164" author="hossman" created="Wed, 6 Dec 2006 19:05:06 +0000"  >&lt;p&gt;Mike, how do you feel about these changes so far?&lt;/p&gt;

&lt;p&gt;FWIW: if you still aren&apos;t comfortable resolving, you should probably mark this isssue as &quot;In Progress&quot; so it stays on the radar.&lt;/p&gt;</comment>
                            <comment id="12456173" author="klaasm" created="Wed, 6 Dec 2006 19:29:11 +0000"  >&lt;p&gt;Thanks for reminding me, Hoss.&lt;/p&gt;

&lt;p&gt;Changes committed in r479793.  I will reopen if I discover problems.&lt;/p&gt;</comment>
                            <comment id="12456174" author="klaasm" created="Wed, 6 Dec 2006 19:29:33 +0000"  >&lt;p&gt;committed in r479793&lt;/p&gt;</comment>
                            <comment id="12589336" author="hossman" created="Wed, 16 Apr 2008 00:56:43 +0100"  >&lt;p&gt;This bug was modified as part of a bulk update using the criteria...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Marked (&quot;Resolved&quot; or &quot;Closed&quot;) and &quot;Fixed&quot;&lt;/li&gt;
	&lt;li&gt;Had no &quot;Fix Version&quot; versions&lt;/li&gt;
	&lt;li&gt;Was listed in the CHANGES.txt for 1.1&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The Fix Version for all 38 issues found was set to 1.1, email notification&lt;br/&gt;
was suppressed to prevent excessive email.&lt;/p&gt;

&lt;p&gt;For a list of all the issues modified, search jira comments for this&lt;br/&gt;
(hopefully) unique string: 20080415hossman3&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12353203">LUCENE-683</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12353613">LUCENE-690</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12345072" name="lazyfields_patch.diff" size="35478" author="klaasm" created="Wed, 15 Nov 2006 20:01:26 +0000"/>
                            <attachment id="12342922" name="lazyfields_patch.diff" size="33944" author="klaasm" created="Fri, 13 Oct 2006 22:39:08 +0100"/>
                            <attachment id="12342597" name="lazyfields_patch.diff" size="33169" author="klaasm" created="Mon, 9 Oct 2006 21:47:54 +0100"/>
                            <attachment id="12342491" name="lazyfields_patch.diff" size="32689" author="klaasm" created="Sat, 7 Oct 2006 04:49:13 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 7 Oct 2006 15:59:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7529</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxtov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21129</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>