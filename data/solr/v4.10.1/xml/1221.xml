<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:17:54 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-1221/SOLR-1221.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-1221] Change Solr Highlighting to use the SpanScorer with MultiTerm expansion by default</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1221</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;To improve the out of the box experience of Solr 1.4, I really think we should make this change. You will still be able to turn both off.&lt;/p&gt;

&lt;p&gt;Comments?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12428023">SOLR-1221</key>
            <summary>Change Solr Highlighting to use the SpanScorer with MultiTerm expansion by default</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="markrmiller@gmail.com">Mark Miller</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Jun 2009 18:07:17 +0100</created>
                <updated>Tue, 10 Nov 2009 15:52:08 +0000</updated>
                            <resolved>Sun, 4 Oct 2009 17:29:37 +0100</resolved>
                                                    <fixVersion>1.4</fixVersion>
                                    <component>highlighter</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12720284" author="yseeley@gmail.com" created="Tue, 16 Jun 2009 19:40:29 +0100"  >&lt;p&gt;Seems time to me... does this affect the HTTP API?&lt;/p&gt;</comment>
                            <comment id="12720285" author="mikemccand" created="Tue, 16 Jun 2009 19:42:00 +0100"  >&lt;p&gt;+1 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  Solr&apos;s defaults are important, too.&lt;/p&gt;</comment>
                            <comment id="12720286" author="markrmiller@gmail.com" created="Tue, 16 Jun 2009 19:43:33 +0100"  >&lt;blockquote&gt;&lt;p&gt;does this affect the HTTP API? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, it won&apos;t. Just changes the default setting for two parameters.&lt;/p&gt;</comment>
                            <comment id="12748940" author="gsingers" created="Fri, 28 Aug 2009 19:53:04 +0100"  >&lt;p&gt;Is this going to make it into 1.4?&lt;/p&gt;</comment>
                            <comment id="12753634" author="gsingers" created="Thu, 10 Sep 2009 15:34:50 +0100"  >&lt;p&gt;Looks good to me, the only oddity is the name of the testPhraseHighlighter now tests the non-phrase highlighter.&lt;/p&gt;

&lt;p&gt;Also, testing wise, do we now risk losing tests for the other highlighter?  I&apos;m not that familiar with the phrase highlighter, so maybe all it does is subsume the functionality of the old one and add phrase support, in which case the existing tests are fine.  If it does not do that, though, it seems like we might want to duplicate the tests, with use phrase highlighter set to false for the dups.  Unless, of course, you think the existing single test that turns off the phrase highlighter is sufficient.&lt;/p&gt;</comment>
                            <comment id="12753668" author="markrmiller@gmail.com" created="Thu, 10 Sep 2009 16:46:28 +0100"  >&lt;blockquote&gt;&lt;p&gt;the only oddity is the name of the testPhraseHighlighter now tests the non-phrase highlighter.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Okay, will address.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, testing wise, do we now risk losing tests for the other highlighter?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah - before the phrase highlighter was &quot;undertested&quot; and the default had more, and now&lt;br/&gt;
its the reverse. I suppose ideally, every test would hit both - that gets ugly though - its what&lt;br/&gt;
we do in Lucene. Thats why I am confident in the tests I suppose though - Lucene runs&lt;br/&gt;
both through every test - so the PhraseHighlighter matches the other highlighters functionality&lt;br/&gt;
and adds support for more query types. I think between Lucene and Solr, the tests are sufficient -&lt;br/&gt;
but I couldn&apos;t argue against more coverage here - hard to argue against testing in any form &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12753700" author="gsingers" created="Thu, 10 Sep 2009 17:51:26 +0100"  >&lt;p&gt;Sounds good, Mark.  Please commit when you are ready.&lt;/p&gt;</comment>
                            <comment id="12755484" author="markrmiller@gmail.com" created="Tue, 15 Sep 2009 14:36:14 +0100"  >&lt;p&gt;to trunk&lt;/p&gt;</comment>
                            <comment id="12755486" author="markrmiller@gmail.com" created="Tue, 15 Sep 2009 14:37:36 +0100"  >&lt;blockquote&gt;&lt;p&gt;the only oddity is the name of the testPhraseHighlighter now tests the non-phrase highlighter.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thats actually not true - just looked at the test again - testPhraseHighlighter is the same as it was - it just used to default to off, so for the portion that expected it to be off, I now explicitly turn it off - thats the only change in testPhraseHighlighter.&lt;/p&gt;</comment>
                            <comment id="12759968" author="markrmiller@gmail.com" created="Sun, 27 Sep 2009 00:50:34 +0100"  >&lt;p&gt;fix a compile issue in last patch - param needs to be &quot;true&quot; rather than true.&lt;br/&gt;
also adds changes entry.&lt;/p&gt;

&lt;p&gt;will commit very soon.&lt;/p&gt;</comment>
                            <comment id="12760047" author="markrmiller@gmail.com" created="Sun, 27 Sep 2009 17:14:45 +0100"  >&lt;p&gt;There is a bug to take care of, and a missing piece that Koji pointed out.&lt;/p&gt;</comment>
                            <comment id="12760048" author="markrmiller@gmail.com" created="Sun, 27 Sep 2009 17:17:53 +0100"  >&lt;p&gt;Grrr ... darn it. Its at the Lucene level. NumericQuery doesn&apos;t set the Term for getTerm(), so its not supported by the Span Highlighter. Grrr. Not sure what to do at the moment ...&lt;/p&gt;</comment>
                            <comment id="12760057" author="markrmiller@gmail.com" created="Sun, 27 Sep 2009 17:54:42 +0100"  >&lt;p&gt;Easy enough to side step this bug in Lucene for now - but if we release with pure Lucene 2.9, not sure what I&apos;m going to do here...&lt;/p&gt;</comment>
                            <comment id="12760078" author="markrmiller@gmail.com" created="Sun, 27 Sep 2009 19:27:48 +0100"  >&lt;p&gt;What do people thing about putting in an updated Highlighter jar with a fix?&lt;/p&gt;</comment>
                            <comment id="12760079" author="yseeley@gmail.com" created="Sun, 27 Sep 2009 19:31:58 +0100"  >&lt;blockquote&gt;&lt;p&gt;What do people thing about putting in an updated Highlighter jar with a fix? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1, If there&apos;s not an easy way to work around it in Solr.&lt;/p&gt;</comment>
                            <comment id="12760080" author="markrmiller@gmail.com" created="Sun, 27 Sep 2009 19:35:35 +0100"  >&lt;p&gt;I don&apos;t see one -&lt;/p&gt;

&lt;p&gt;ugly options I can think of -&lt;/p&gt;

&lt;p&gt;1. extend highlighter and duplicate a ton of code with a fix - obviously not really an option&lt;br/&gt;
2. run through the query first and rebuild it without the numericrangequery part&lt;br/&gt;
3. use an overridden version of NumericQuery in Solr that returns a placeholder term from getTerm&lt;/p&gt;

&lt;p&gt;None of these are really viable IMO though.&lt;/p&gt;</comment>
                            <comment id="12760082" author="yseeley@gmail.com" created="Sun, 27 Sep 2009 19:49:11 +0100"  >&lt;p&gt;How can one reproduce this bug?  The query parser produces a normal term query for numeric queries.&lt;/p&gt;

&lt;p&gt;Something like this does not cause an error on trunk:&lt;br/&gt;
&lt;a href=&quot;http://localhost:8983/solr/select?q=popularity:6&amp;amp;hl=true&amp;amp;hl.fl=popularity&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://localhost:8983/solr/select?q=popularity:6&amp;amp;hl=true&amp;amp;hl.fl=popularity&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="12760083" author="markrmiller@gmail.com" created="Sun, 27 Sep 2009 19:52:39 +0100"  >&lt;p&gt;Sorry - should have been more clear.&lt;/p&gt;

&lt;p&gt;The bug is hidden on trunk at the moment - Koji pointed out that I missed a spot, and on trunk right now, queries are being rewritten by default when they shouldnt be.&lt;/p&gt;

&lt;p&gt;Now that you mention it though, the issue is not just with NumericRange (I just assumed that was being gen&apos;d cause I saw the problem with it), but its also going to be with the&lt;br/&gt;
deprecated RangeQuery it looks. &lt;b&gt;edit&lt;/b&gt; actually - since RangeQuery no longer extends MultiTermQuery, it won&apos;t cause the error - it just won&apos;t highlight.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;edit&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;which really argues for a jar update - I can fix all causes with one simple fix - checking if getTerm returns null.&lt;/p&gt;</comment>
                            <comment id="12760084" author="markrmiller@gmail.com" created="Sun, 27 Sep 2009 19:57:00 +0100"  >&lt;p&gt;this patch needs to be applied to finish the issue - but for now it will cause tests to fail.&lt;/p&gt;</comment>
                            <comment id="12760087" author="markrmiller@gmail.com" created="Sun, 27 Sep 2009 20:25:35 +0100"  >&lt;blockquote&gt;&lt;p&gt;The query parser produces a normal term query for numeric queries.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Also, I shouldn&apos;t have said NumericQuery - NumericRangeQuery - sorry again.&lt;/p&gt;</comment>
                            <comment id="12760111" author="thetaphi" created="Sun, 27 Sep 2009 23:03:00 +0100"  >&lt;p&gt;deprec ConstantScoreRangeQuery (if ever used in Solr) would also have the problem... (but it extends TermRangeQuery, so should be catched before).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;3. use an overridden version of NumericQuery in Solr that returns a placeholder term from getTerm&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;would not work (final and no ctors).&lt;/p&gt;</comment>
                            <comment id="12760112" author="markrmiller@gmail.com" created="Sun, 27 Sep 2009 23:06:35 +0100"  >&lt;blockquote&gt;&lt;p&gt;deprec ConstantScoreRangeQuery (if ever used in Solr) would also have the problem... (but it extends TermRangeQuery, so should be catched before).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right - anything that extends TermRangeQuery should be fine. It has special handling.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;would not work (final and no ctors).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks - I actually saw that when I was messing with the Highlighter earlier today, but I didn&apos;t put 2 and 2 together.&lt;br/&gt;
Sounds like the updated Highlighter jar is the solution.&lt;/p&gt;</comment>
                            <comment id="12760114" author="thetaphi" created="Sun, 27 Sep 2009 23:10:49 +0100"  >&lt;p&gt;Does RangeQuery really need to be highlighted? It is not used anywhere in Solr (I removed all occurences in the issue about TermRangeQuery), so why handle it?&lt;/p&gt;

&lt;p&gt;In Lucene, the fix would only be needed for highlighting in 2.9.1, 3.0 will have no RangeQuery anymore.&lt;/p&gt;</comment>
                            <comment id="12760127" author="markrmiller@gmail.com" created="Mon, 28 Sep 2009 00:19:18 +0100"  >&lt;blockquote&gt;&lt;p&gt;In Lucene, the fix would only be needed for highlighting in 2.9.1, 3.0 will have no RangeQuery anymore.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You can have custom queryparsers in Solr, so you can&apos;t say definitely its not used.&lt;/p&gt;

&lt;p&gt;Whether I&apos;m concerned about it depends on if we a 2.9.1 - if we do, I&apos;ll fix it. If we don&apos;t I won&apos;t.&lt;/p&gt;</comment>
                            <comment id="12761348" author="yseeley@gmail.com" created="Thu, 1 Oct 2009 22:18:35 +0100"  >&lt;p&gt;OK, here&apos;s a potential workaround... simply wraps the NumericRangeQuery in another query and delegates everything.  Since it won&apos;t be an instanceof MultiTermQuery, it shouldn&apos;t trigger any bugs in the highlighters.&lt;/p&gt;

&lt;p&gt;I tried starting off with a MultiTermQuery that delegated to the contained NRQ, but it turned out to be impossible because MTQ.getEnum is protected - so can&apos;t delegate.&lt;/p&gt;

&lt;p&gt;The easiest solution would have been just subclassing NRQ - Lucene shouldn&apos;t make stuff like this so hard... we should simply document that most of the classes are not meant to be overridden - and back compat does not extend to subclassing unless the class was specifically designed for it.&lt;/p&gt;</comment>
                            <comment id="12761350" author="thetaphi" created="Thu, 1 Oct 2009 22:26:01 +0100"  >&lt;p&gt;Does the highlighter rewrite before checking the query? In this is not the case the simpliest thing to do would be the following: Just wrap it into a Query subclass and rewrite it to NRQ.&lt;/p&gt;</comment>
                            <comment id="12761366" author="thetaphi" created="Thu, 1 Oct 2009 23:17:57 +0100"  >&lt;p&gt;A even simplier workaround:&lt;br/&gt;
Instead of using a NRQ, wrap a NRF with ConstantScoreQuery (just change TrieField.getRangeQuery()). You will loose auto-rewrite if only few terms are affected, but for precSteps&amp;gt;4/6, MTQ default would also use ConstantScoreQuery.&lt;/p&gt;</comment>
                            <comment id="12761643" author="markrmiller@gmail.com" created="Fri, 2 Oct 2009 18:01:07 +0100"  >&lt;p&gt;I was about to merge that last changed needed (rewrite fix) with Yoniks patch - but it looks like Yoniks patch is missing the SolrQueryWrapper class ...&lt;/p&gt;</comment>
                            <comment id="12761647" author="yseeley@gmail.com" created="Fri, 2 Oct 2009 18:11:36 +0100"  >&lt;p&gt;missing &quot;svn add&quot; strikes again.... attaching new patch.&lt;/p&gt;</comment>
                            <comment id="12761749" author="yseeley@gmail.com" created="Fri, 2 Oct 2009 23:16:24 +0100"  >&lt;blockquote&gt;&lt;p&gt;Instead of using a NRQ, wrap a NRF with ConstantScoreQuery&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yep, that would work too.  Your call Mark &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12761757" author="markrmiller@gmail.com" created="Fri, 2 Oct 2009 23:24:32 +0100"  >&lt;p&gt;On first blush, I&apos;ve got to think the wrapper is better.&lt;/p&gt;

&lt;p&gt;We don&apos;t lose the few terms -&amp;gt; faster booleanquery that way, and I&apos;m not sure I see any advantage to using CSQ. So its not a huge weight towards the wrapper, but we now have it, and it does weigh that way it would seem to me ...&lt;/p&gt;

&lt;p&gt;Uwe?&lt;/p&gt;</comment>
                            <comment id="12761759" author="thetaphi" created="Fri, 2 Oct 2009 23:27:57 +0100"  >&lt;p&gt;I have no preference...&lt;/p&gt;

&lt;p&gt;But we fix the highlighter bug in lucene trunk, too?&lt;/p&gt;</comment>
                            <comment id="12761761" author="markrmiller@gmail.com" created="Fri, 2 Oct 2009 23:30:47 +0100"  >&lt;blockquote&gt;&lt;p&gt;But we fix the highlighter bug in lucene trunk, too?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yup, def. The only reason we are trying to sidestep here is to avoid having to update the jar in Solr. Its just a hassle. What do we call it and how do we track it?&lt;br/&gt;
Back against the wall, I think it makes sense, but not if we can sidestep and go pure 2.9 release.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit a fix in Lucene over the weekend - super easy fix there anyway.&lt;/p&gt;</comment>
                            <comment id="12761763" author="thetaphi" created="Fri, 2 Oct 2009 23:34:01 +0100"  >&lt;p&gt;I would also stay with 2.9 in Solr. Just mark the removal of the wrapper as a TODO item after the next lucene update.&lt;/p&gt;</comment>
                            <comment id="12775774" author="gsingers" created="Tue, 10 Nov 2009 15:52:08 +0000"  >&lt;p&gt;Bulk close for Solr 1.4&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12436699">LUCENE-1929</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12431902">SOLR-1319</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12421230" name="SOLR-1221.patch" size="8528" author="markrmiller@gmail.com" created="Sun, 4 Oct 2009 17:16:35 +0100"/>
                            <attachment id="12421125" name="SOLR-1221.patch" size="7227" author="yseeley@gmail.com" created="Fri, 2 Oct 2009 18:11:36 +0100"/>
                            <attachment id="12421068" name="SOLR-1221.patch" size="3906" author="yseeley@gmail.com" created="Thu, 1 Oct 2009 22:18:35 +0100"/>
                            <attachment id="12420658" name="SOLR-1221.patch" size="903" author="markrmiller@gmail.com" created="Sun, 27 Sep 2009 19:57:00 +0100"/>
                            <attachment id="12420642" name="SOLR-1221.patch" size="2873" author="markrmiller@gmail.com" created="Sun, 27 Sep 2009 00:50:34 +0100"/>
                            <attachment id="12419631" name="SOLR-1221.patch" size="2065" author="markrmiller@gmail.com" created="Tue, 15 Sep 2009 14:36:14 +0100"/>
                            <attachment id="12418064" name="SOLR-1221.patch" size="2021" author="markrmiller@gmail.com" created="Sat, 29 Aug 2009 17:32:11 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 16 Jun 2009 18:40:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6427</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxmkn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19976</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>