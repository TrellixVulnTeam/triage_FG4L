<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:22:57 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-1106/SOLR-1106.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-1106] Pluggable CoreAdminHandler  (Action ) architecture that allows for custom handler access to CoreContainer / request-response </title>
                <link>https://issues.apache.org/jira/browse/SOLR-1106</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Currently there are certain default actions implemented in CoreAdminHandler ( CREATE , SWAP, RELOAD , ALIAS etc.) . &lt;/p&gt;

&lt;p&gt;For the purpose of in-house monitoring tools that needs to interact with multiple cores at a given solr instance - we need custom handlers that has access to CoreContainer and the req, resp of the same. &lt;/p&gt;

&lt;p&gt;So - the proposed way of injecting handlers is as follows. &lt;/p&gt;

&lt;p&gt;In solr.xml - we add a new schema - &lt;/p&gt;

&lt;p&gt; &amp;lt;solr &amp;gt;&lt;br/&gt;
     &amp;lt;cores adminPath=&quot;/cores/admin&quot;&amp;gt;  &lt;/p&gt;

&lt;p&gt;          &amp;lt;adminActionHandler action=&quot;newaction&quot; handlerType=&quot;com.mydomain.myclass&quot; /&amp;gt;&lt;br/&gt;
      &amp;lt;/cores&amp;gt; &lt;br/&gt;
  &amp;lt;/solr&amp;gt; &lt;/p&gt;

&lt;p&gt;New abstract class -  CoreAdminActionRequestHandler added - that com.mydomain.myclass would need to inherit from. &lt;/p&gt;

&lt;p&gt;Following action handlers registered by default - &lt;/p&gt;

&lt;p&gt;    registerCustomAdminHandler(&quot;create&quot;, new AdminCreateActionRequestHandler());&lt;br/&gt;
    registerCustomAdminHandler(&quot;rename&quot;, new AdminRenameActionRequestHandler());&lt;br/&gt;
    registerCustomAdminHandler(&quot;alias&quot;, new AdminAliasActionRequestHandler());&lt;br/&gt;
    registerCustomAdminHandler(&quot;unload&quot;, new AdminUnloadActionRequestHandler());&lt;br/&gt;
    registerCustomAdminHandler(&quot;status&quot;, new AdminStatusActionRequestHandler());&lt;br/&gt;
    registerCustomAdminHandler(&quot;persist&quot;, new AdminPersistActionRequestHandler());&lt;br/&gt;
    registerCustomAdminHandler(&quot;reload&quot;, new AdminReloadActionRequestHandler());&lt;br/&gt;
    registerCustomAdminHandler(&quot;swap&quot;, new AdminSwapActionRequestHandler());&lt;/p&gt;

&lt;p&gt;Trying to register a handler with one that already exists would result in an error ( Hence - the above mentioned defaults would not be overridden). &lt;/p&gt;</description>
                <environment>&lt;p&gt;Java 5, Tomcat 6 &lt;/p&gt;</environment>
        <key id="12422383">SOLR-1106</key>
            <summary>Pluggable CoreAdminHandler  (Action ) architecture that allows for custom handler access to CoreContainer / request-response </summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalinmangar">Shalin Shekhar Mangar</assignee>
                                    <reporter username="kaykay.unique">Karthik K</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Apr 2009 17:49:43 +0100</created>
                <updated>Tue, 10 Nov 2009 15:52:01 +0000</updated>
                            <resolved>Wed, 20 May 2009 07:16:50 +0100</resolved>
                                                    <fixVersion>1.4</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <timeoriginalestimate seconds="10800">3h</timeoriginalestimate>
                            <timeestimate seconds="10800">3h</timeestimate>
                                        <comments>
                            <comment id="12697092" author="kaykay.unique" created="Wed, 8 Apr 2009 17:53:02 +0100"  >&lt;p&gt;Changes to CoreContainer  ( inferring solr admin action handlers / loading them ). &lt;br/&gt;
Changes to CoreAdminHandler ( registering handlers ) &lt;br/&gt;
New class - CoreAdminActionRequestHandler added ( that needs to be implemented by the plugins ) &lt;/p&gt;

&lt;p&gt;Existing admin actions implemented as CoreAdminActionRequestHandlers. &lt;/p&gt;
</comment>
                            <comment id="12697097" author="kaykay.unique" created="Wed, 8 Apr 2009 17:57:08 +0100"  >&lt;p&gt;Name of the actions  is case-insensitive . &lt;/p&gt;</comment>
                            <comment id="12699835" author="kaykay.unique" created="Thu, 16 Apr 2009 21:12:20 +0100"  >&lt;p&gt;Revised Patch with less drastic changes: &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;New method added to SolrResourceLoader# newAdminHandlerInstance(final CoreContainer coreContainer)  to inject CoreContainer aware systems (ignoring SolrCoreAware since at a container level in a multi-core system - SolrCoreAware might not make sense)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;CoreAdminHandler#handleCustomAction(final CoreContainer cores, final SolrQueryRequest req, final SolrQueryResponse rsp)&lt;br/&gt;
 added to handle custom actions ( By default - it throws an exception explaining that action is not valid ). &lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;CoreContainer :&lt;br/&gt;
     solr/cores/@adminHandler added as an optional  xml config parameter ( defaults to org.apache.solr.handler.admin.CoreAdminHandler ) as before. &lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12699997" author="noble.paul" created="Fri, 17 Apr 2009 05:31:00 +0100"  >&lt;p&gt;few observations&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;It leaves no option to override the standard commands. Move the execution of each command to separate protected methods. this way even the standard commands can be overridden&lt;/li&gt;
	&lt;li&gt;do not use reflection to load the default CoreAdminhandler&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="12700191" author="kaykay.unique" created="Fri, 17 Apr 2009 15:41:16 +0100"  >&lt;blockquote&gt;
&lt;p&gt;    It leaves no option to override the standard commands.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That seems counter-intuitive to your objection of the first design by Abstract classes and implementations since the correct way is to have an abstract class and provide default implementations of the same for commands available by default.  Also - I do not see the motivation to override the default commands. &lt;/p&gt;

&lt;p&gt;I will attach the revised patch to load the default CoreAdminHandler without reflection. &lt;/p&gt;</comment>
                            <comment id="12700197" author="kaykay.unique" created="Fri, 17 Apr 2009 15:48:49 +0100"  >&lt;p&gt;CoreAdminHandler ( default ) instantiated without using reflection &lt;/p&gt;</comment>
                            <comment id="12700205" author="noble.paul" created="Fri, 17 Apr 2009 16:17:34 +0100"  >&lt;blockquote&gt;&lt;p&gt;I do not see the motivation to override the default commands. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There are places were we may need to override the default implementation. Actually we already do it internally. So if I cannot override the the default commands it may not be as useful&lt;/p&gt;</comment>
                            <comment id="12700210" author="kaykay.unique" created="Fri, 17 Apr 2009 16:29:36 +0100"  >&lt;blockquote&gt;
&lt;p&gt;There are places were we may need to override the default implementation. Actually we already do it internally. So if I cannot override the the default commands it may not be as useful&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If that were the case - then going by an abstract action and implementations of the same (with option to override default implementations ) would probably be cleaner , allowing default implementations to be overridden. Otherwise we are looking at probably around 6 - 7 methods that could be overridden and as we add more default commands - we might end up adding one more method to be overridden. Let me know what you feel about this. &lt;/p&gt;</comment>
                            <comment id="12700424" author="noble.paul" created="Sat, 18 Apr 2009 06:51:30 +0100"  >&lt;p&gt;to hoss&apos; comment on the list &lt;a href=&quot;http://markmail.org/message/s7mcbtaskngr74bd&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://markmail.org/message/s7mcbtaskngr74bd&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The commands such as create/load/unload etc can only be done by the CoreAdminHandler. So it is not really possible to achieve this as a RequestHandler. Take our usecase where we start with a blank slate ( zero cores) and we keep adding cores . In this case there is no core in the first  place to attach a RequestHandler &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;we might end up adding one more method to be overridden. Let me know what you feel about this. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;As I see it , there will be very few users overriding the CoreAdminHandler . We do it and we have a custom build of Solr for that. With this issue fixed I may be able to plugin my custom CoreAdminHandler.  having 7 -8 methods to be overridden is a good idea. If there are new commands we may have new methods&lt;/p&gt;</comment>
                            <comment id="12700806" author="kaykay.unique" created="Mon, 20 Apr 2009 15:34:18 +0100"  >&lt;blockquote&gt;
&lt;p&gt;Any Core can get access to the CoreContainer (via core.getCoreDescriptor().getCoreContainer()) and all of the SolrCores it is managing, so couldn&apos;t these new hooks you need be implented in regular RequestHandler? &lt;/p&gt;

&lt;p&gt; I ask this from the &quot;how to achieve a niche goal with the minimal number of invasive changes&quot; standpoint &amp;#8211; mainly because i don&apos;t really understand what new types of &quot;monitoring hooks&quot; you&apos;re thinking of. if they seem like something that would be generally useful to lots of people, why not add them to CoreAdminHandler? if they &lt;b&gt;pattern&lt;/b&gt; of adding them seems like something that will come up for lots of people &lt;b&gt;then&lt;/b&gt; i would worry about making CoreAdminHandler more extensible.  &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Monitoring hooks was one of the examples that we are using internally . If at the end of the implementation I find it generic enough - I would definitely be more than happy to share the patch for that too - but this I need this to be a building block on which other similar components could be built. &lt;/p&gt;

&lt;p&gt;Another context in which we need this is w.r.t doing some matching analysis between different indices  (managed via - a multi-core instance) where the indices are managed by the respective SolrCore&apos;s UpdateHandlers while a req / response via http would goto a place that has access to both the cores and return the result, &lt;/p&gt;

&lt;p&gt;RequestHandler does not seem logically correct (though is indirectly possible via the method outlined earlier ) since that would bind the request Handler to one of the cores while the behavior intended is across cores - hence that needs to be done a level above all the cores and I selected admin Handler since that seems to be the only handler used in solr.xml . &lt;/p&gt;

&lt;p&gt;But what could be useful is to retain the requestHandler and make them configurable in solr.xml to address similar requests in the future. &lt;/p&gt;


</comment>
                            <comment id="12700809" author="kaykay.unique" created="Mon, 20 Apr 2009 15:40:50 +0100"  >&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; As I see it , there will be very few users overriding the CoreAdminHandler . We do it and we have a custom build of Solr for that. With this issue fixed I may be able to plugin my custom CoreAdminHandler. having 7 -8 methods to be overridden is a good idea. If there are new commands we may have new methods&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;I have to disagree with the suggestions of overriding 7 - 8 method as a good idea here. Also - it seems ironical to me that you have a commit privilege to solr and have a custom build too ( as opposed to a pluggable library to solr ) since given the right hooks available - it can prevent forking of the code and useful to others in the community as well. &lt;/p&gt;

&lt;p&gt;The point of my longer exercise of submitting a patch to get it committed is to prevent forking , even though it is tempting in terms of time to do it otherwise. &lt;/p&gt;

&lt;p&gt;Having put the reasons-  here is the revised patch with individual &apos;actions&apos; of CoreAdminHandler being implemented as separate methods (&apos;protected&apos;) that could be overridden by derived methods if necesary. &lt;/p&gt;</comment>
                            <comment id="12701046" author="noble.paul" created="Tue, 21 Apr 2009 05:22:08 +0100"  >&lt;blockquote&gt;&lt;p&gt;I have to disagree with the suggestions of overriding 7 - 8 method as a good idea here.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;the methods are protected does not mean we may have to override it. We only override a couple of functionalities.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;it seems ironical to me that you have a commit privilege to solr and have a custom build too &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We will be glad to contribute everything back to Solr trunk. We may even do it eventually. but,  our use cases are very unique, and there may not be a need for such things for others. The changes are not limited to this. We needed a very lightweight Solr because we need to run close to 20000 cores per box.&lt;/p&gt;

&lt;p&gt;I am happy to see another user who has similar needs. &lt;/p&gt;</comment>
                            <comment id="12701151" author="kaykay.unique" created="Tue, 21 Apr 2009 14:24:48 +0100"  >&lt;p&gt; Let me know how this revised patch looks like and whether it fits your needs as well since I would prefer to have this committed and pick up a nightly build ( or a release , better) . Thanks for the help once again. &lt;/p&gt;</comment>
                            <comment id="12701523" author="shalinmangar" created="Wed, 22 Apr 2009 14:23:28 +0100"  >&lt;p&gt;Thanks Kay, this looks good.&lt;/p&gt;

&lt;p&gt;I&apos;ve made the following changes over your last patch&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Re-formatted code to Lucene/Solr coding style. I know this is frowned upon for changes to existing code but CoreAdminHandler was the only place using a non-standard style of brace positioning and variable names.&lt;/li&gt;
	&lt;li&gt;Made the CoreContainer instance protected&lt;/li&gt;
	&lt;li&gt;Removed the CoreContainer parameter to all the action methods since it is an instance variable&lt;/li&gt;
	&lt;li&gt;Removed the final keyword from variable/parameter definitions. That is just noise in this context, isn&apos;t it?&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I think this is ready to commit. I&apos;ll wait for a day for any feedback that others may have.&lt;/p&gt;</comment>
                            <comment id="12701546" author="kaykay.unique" created="Wed, 22 Apr 2009 15:26:32 +0100"  >&lt;p&gt;I have submitted changes to  the wiki at - &lt;a href=&quot;http://wiki.apache.org/solr/CoreAdmin&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/solr/CoreAdmin&lt;/a&gt; with additional info about adminHandler introduced in this jira. Let me know how it looks and approve the same once this fix is in.  &lt;/p&gt;</comment>
                            <comment id="12702257" author="shalinmangar" created="Fri, 24 Apr 2009 07:33:19 +0100"  >&lt;p&gt;Committed revision 768165.&lt;/p&gt;

&lt;p&gt;Thanks Kay and Noble!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I have submitted changes to the wiki at - &lt;a href=&quot;http://wiki.apache.org/solr/CoreAdmin&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/solr/CoreAdmin&lt;/a&gt; with additional info about adminHandler introduced in this jira. Let me know how it looks and approve the same once this fix is in.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This looks good Kay, thanks!&lt;/p&gt;</comment>
                            <comment id="12702569" author="kaykay.unique" created="Fri, 24 Apr 2009 22:38:25 +0100"  >&lt;p&gt;Thanks Shalin and Noble for helping committing this. &lt;/p&gt;</comment>
                            <comment id="12711020" author="shalinmangar" created="Wed, 20 May 2009 07:13:16 +0100"  >&lt;p&gt;It seems that the call to core.setProperties was removed in this refactoring and therefore, implicit properties are not being set on cores created through CoreAdminHandler.&lt;/p&gt;</comment>
                            <comment id="12711023" author="shalinmangar" created="Wed, 20 May 2009 07:16:50 +0100"  >&lt;p&gt;Oops, wrong call. That call was actually removed by &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-943&quot; title=&quot;Make it possible to specify dataDir in solr.xml&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-943&quot;&gt;&lt;del&gt;SOLR-943&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12713881" author="noble.paul" created="Thu, 28 May 2009 06:21:06 +0100"  >&lt;p&gt;The adminhandler attribute must be persisted back to solr.xml&lt;/p&gt;</comment>
                            <comment id="12713882" author="noble.paul" created="Thu, 28 May 2009 06:23:17 +0100"  >&lt;p&gt;committed : 779439&lt;/p&gt;</comment>
                            <comment id="12775710" author="gsingers" created="Tue, 10 Nov 2009 15:52:01 +0000"  >&lt;p&gt;Bulk close for Solr 1.4&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12430758">SOLR-1293</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12409236" name="SOLR-1106.patch" size="5534" author="noble.paul" created="Thu, 28 May 2009 06:21:06 +0100"/>
                            <attachment id="12406135" name="SOLR-1106.patch" size="20148" author="shalinmangar" created="Wed, 22 Apr 2009 14:23:28 +0100"/>
                            <attachment id="12405930" name="SOLR-1106.patch" size="19094" author="kaykay.unique" created="Mon, 20 Apr 2009 15:41:30 +0100"/>
                            <attachment id="12405771" name="SOLR-1106.patch" size="7489" author="kaykay.unique" created="Fri, 17 Apr 2009 15:48:49 +0100"/>
                            <attachment id="12405692" name="SOLR-1106.patch" size="7042" author="kaykay.unique" created="Thu, 16 Apr 2009 21:12:20 +0100"/>
                            <attachment id="12404983" name="SOLR-1106.patch" size="29926" author="kaykay.unique" created="Wed, 8 Apr 2009 17:53:02 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 17 Apr 2009 04:31:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6533</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxn9b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20087</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>