<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:19:09 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/SOLR-622/SOLR-622.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[SOLR-622] SpellCheckComponent should build or load indices on startup and commits</title>
                <link>https://issues.apache.org/jira/browse/SOLR-622</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;SpellCheckComponent must be able to build/load spell check index on startup and commits. With &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-605&quot; title=&quot;Programatically register SolrEventListeners&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-605&quot;&gt;&lt;del&gt;SOLR-605&lt;/del&gt;&lt;/a&gt;, SpellCheckComponent can register an event listener for firstSearcher and newSearcher events and rebuild/reload indices as appropriate.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;If index uses a FSDirectory and exists on disk then just reload it or else build it on firstSearcher event.&lt;/li&gt;
	&lt;li&gt;If index is built from a Solr field then re-build it on newSearcher event.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This will help avoid having to add QuerySenderListener in configuration and will not force people to issue build on first query.&lt;/p&gt;

&lt;p&gt;All this should be configurable so that people who don&apos;t want to rebuild on commits should be able to turn this feature off per configured spell checker.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12399872">SOLR-622</key>
            <summary>SpellCheckComponent should build or load indices on startup and commits</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalinmangar">Shalin Shekhar Mangar</assignee>
                                    <reporter username="shalinmangar">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Jul 2008 07:22:15 +0100</created>
                <updated>Fri, 10 May 2013 11:41:05 +0100</updated>
                            <resolved>Fri, 1 Aug 2008 07:12:13 +0100</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.3</fixVersion>
                                    <component>spellchecker</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12616237" author="shalinmangar" created="Wed, 23 Jul 2008 20:45:40 +0100"  >&lt;p&gt;Reloading existing index on firstSearcher cannot work without &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-648&quot; title=&quot;SpellcheckComponent throws NullPointerException on restart without build&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-648&quot;&gt;&lt;del&gt;SOLR-648&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12616239" author="shalinmangar" created="Wed, 23 Jul 2008 20:49:59 +0100"  >&lt;p&gt;I suppose if a reload on firstSearcher fails due to some reason (missing/corrupted index), we should try to build it, right?&lt;/p&gt;</comment>
                            <comment id="12616250" author="shalinmangar" created="Wed, 23 Jul 2008 21:32:05 +0100"  >&lt;p&gt;Hmm. The reload OR build logic cannot work correctly with firstSearcher. We cannot rely on the spellCheckIndexDir existing on disk to be a sure sign that only a reload is necessary. It may just be an empty directory/index. In fact the AbstractLuceneSpellChecker creates a FSDirectory on init which means that doing a simple reload may not be enough on startup.&lt;/p&gt;

&lt;p&gt;I think we should always call reload on firstSearcher for all spell checkers and (only for Solr based spell checkers) call build on newSearcher event. The only case where this will be a problem is where an index exists, Solr is stopped, spell checker config is added/enabled and Solr is restarted. Now a reload is done but we do not have any data in the spell check index. If a commit is done or build is called manually, things will take care of themselves.&lt;/p&gt;</comment>
                            <comment id="12616251" author="shalinmangar" created="Wed, 23 Jul 2008 21:34:28 +0100"  >&lt;p&gt;Issue description edited to add note on enabling/disabling this feature per spell checker through configuration.&lt;/p&gt;</comment>
                            <comment id="12617190" author="shalinmangar" created="Sat, 26 Jul 2008 16:22:00 +0100"  >&lt;p&gt;Adds a firstSearcher and postCommit event listener using API calls. The firstSearcher listener is added for all spell checkers so that reload is called on startup but the postCommit call back is only added if the spellchecker specifies the following in it&apos;s configuration:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;buildOnCommit&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;true&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/str&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Adds tests for the same. However, they fail currently. See &lt;a href=&quot;http://www.nabble.com/Question-on-newSearcher-and-commit-callbacks-tp18667573p18667573.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/Question-on-newSearcher-and-commit-callbacks-tp18667573p18667573.html&lt;/a&gt; for details. If the second commit call in the tests is uncommented then the tests pass.&lt;/p&gt;</comment>
                            <comment id="12618642" author="shalinmangar" created="Thu, 31 Jul 2008 11:55:59 +0100"  >&lt;p&gt;This patch uses separate firstSearcher and newSearcher event listeners for each spell checker. All tests pass. I&apos;ll commit this shortly.&lt;/p&gt;

&lt;p&gt;We should still try to figure out why the searcher obtained in a postCommit listener does not get access to the latest searcher.&lt;/p&gt;</comment>
                            <comment id="12618787" author="yseeley@gmail.com" created="Thu, 31 Jul 2008 19:16:00 +0100"  >&lt;blockquote&gt;&lt;p&gt;We should still try to figure out why the searcher obtained in a postCommit listener does not get access to the latest searcher.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think the callback happens before the new searcher is opened.&lt;br/&gt;
I think postCommit is also synchronous with the commit process - you don&apos;t want to rebuild your spell checking index here because it would freeze out any updates until it&apos;s done.&lt;/p&gt;

&lt;p&gt;We have warming mechanism that works for stuff like this... perhaps that is what should be used rather than postCommit callbacks?&lt;/p&gt;</comment>
                            <comment id="12618811" author="shalinmangar" created="Thu, 31 Jul 2008 20:02:33 +0100"  >&lt;blockquote&gt;&lt;p&gt;I think the callback happens before the new searcher is opened.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, the searcher is being created after informing the listeners. IMO, that seems a bit counter-intuitive. The commit has happened so I would expect to see the new data.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;We have warming mechanism that works for stuff like this... perhaps that is what should be used rather than postCommit callbacks?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;So the way used in the latest patch using a newSearcher event should be fine, right? It is done in a separate thread through ExecutorService in SolrCore.&lt;/p&gt;

&lt;p&gt;Not relevant to this issue but the newSearcher method is always called with a null currentSearcher, why is that? I mentioned it at &lt;a href=&quot;http://www.nabble.com/Question-on-newSearcher-and-commit-callbacks-tp18667573p18667573.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/Question-on-newSearcher-and-commit-callbacks-tp18667573p18667573.html&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="12618822" author="yseeley@gmail.com" created="Thu, 31 Jul 2008 20:25:29 +0100"  >&lt;blockquote&gt;&lt;p&gt;Yes, the searcher is being created after informing the listeners. IMO, that seems a bit counter-intuitive. The commit has happened so I would expect to see the new data.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That particular callback was made for index distribution.  It needed to be synchronous with the commit process, not allowing anything else to proceed until finished to ensure a clean snapshot.  The trigger is closing of the IndexWriter, not opening of a new IndexSearcher.&lt;/p&gt;

&lt;p&gt;We could create new callbacks, but I&apos;m not sure I would want to do that for 1.3&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;So the way used in the latest patch using a newSearcher event should be fine, right? It is done in a separate thread through ExecutorService in SolrCore.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I haven&apos;t looked at the patch, but this sounds potentially dangerous if you are using the searcher passed to you (async closes, etc).  I&apos;ve added a comment to the code about this.&lt;/p&gt;</comment>
                            <comment id="12618828" author="shalinmangar" created="Thu, 31 Jul 2008 20:39:11 +0100"  >&lt;blockquote&gt;&lt;p&gt;I haven&apos;t looked at the patch, but this sounds potentially dangerous if you are using the searcher passed to you (async closes, etc). I&apos;ve added a comment to the code about this.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The spell checker build is synchronous and completed inside the newSearcher call and the reference to searcher is not kept anywhere, we should be fine. In addition, I&apos;ll a note to the SolrSpellChecker#build method javadocs that no references to the searcher should be kept by implementations.&lt;/p&gt;

&lt;p&gt;Actually a reference to searcher is kept in the dictionary but the dictionary is used immediately and created everytime in the build method. We can get rid of it easily.&lt;/p&gt;</comment>
                            <comment id="12618829" author="yseeley@gmail.com" created="Thu, 31 Jul 2008 20:40:49 +0100"  >&lt;blockquote&gt;&lt;p&gt;It is done in a separate thread through ExecutorService in SolrCore.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I may have mis-understood this part... I though you were using your own ExecutorService.&lt;br/&gt;
So yes, using newSearcher and firstSearcher events should be fine.  They will be synchronous though (block all other progress on warming and registering the new server).  That may or may not be what you want.&lt;/p&gt;</comment>
                            <comment id="12618834" author="shalinmangar" created="Thu, 31 Jul 2008 20:54:31 +0100"  >&lt;p&gt;Functionally, this patch aspires to eliminate the need to modify solrconfig.xml to add a reload call to firstSearcher and build call to newSearcher using the QuerySenderListener.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;They will be synchronous though (block all other progress on warming and registering the new server). That may or may not be what you want.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Until we can add a scheduler into Solr in the future (which is something a lot of components like replication and DataImportHandler may need), I really don&apos;t see any other way for now. &lt;/p&gt;</comment>
                            <comment id="12618936" author="shalinmangar" created="Fri, 1 Aug 2008 06:39:41 +0100"  >&lt;p&gt;The last patch had some extra code which I was using for testing. This one removes all of those.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit this shortly.&lt;/p&gt;</comment>
                            <comment id="12618937" author="shalinmangar" created="Fri, 1 Aug 2008 06:50:32 +0100"  >&lt;p&gt;The last patch was generated incorrectly. Uploading new one.&lt;/p&gt;

&lt;p&gt;We are introducing a configuration parameter for spell checker with this issue&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;buildOnCommit&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;true&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/str&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now there is no need to check if a spell checker is built from Solr field or not. If the configuration param is present, we can blindly build it on newSearcher event.&lt;/p&gt;</comment>
                            <comment id="12618939" author="shalinmangar" created="Fri, 1 Aug 2008 07:12:13 +0100"  >&lt;p&gt;Committed revision 681604.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12400840">SOLR-648</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12395811">SOLR-572</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12387325" name="SOLR-622.patch" size="6721" author="shalinmangar" created="Fri, 1 Aug 2008 06:50:32 +0100"/>
                            <attachment id="12387268" name="SOLR-622.patch" size="8101" author="shalinmangar" created="Thu, 31 Jul 2008 11:55:59 +0100"/>
                            <attachment id="12386958" name="SOLR-622.patch" size="11510" author="shalinmangar" created="Sat, 26 Jul 2008 16:22:00 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 31 Jul 2008 18:16:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6989</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxxq7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20566</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>