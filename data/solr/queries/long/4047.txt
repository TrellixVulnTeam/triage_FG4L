For some reason dataimporter.functions.encoude URL stopped work after update to solr 4.0 from 3.5.
Here is the error


Full Import failed:java.lang.RuntimeException: java.lang.RuntimeException: org.apache.solr.handler.dataimport.DataImportHandlerException: Unable to encode expression: attach.name with value: null Processing Document # 1



Here is the data import config snippet:


...
            <entity name="account"
                    query="select name from accounts where account_id = '${attach.account_id}'">

                    <entity name="img_index" processor="TikaEntityProcessor" 
                            dataSource="bin"
                            format="text" 
                            url="http://example.com/data/${account.name}/attaches/${attach.item_id}/${dataimporter.functions.encodeUrl(attach.name)}">

                            <field column="text" name="body" />
                    </entity> 
            </entity>
...


When I'm changing it to not use dataimporter.functions.encodeUrl it works but I need to url encode file names as they have special chars in theirs names.