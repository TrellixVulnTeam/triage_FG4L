While testing my patch for SOLR-4629, i noticed a really random error that i traced back to the core reload (do to config file replication) failed because the directory was locked.

From what i can tell, the lock checking code in the SolrCore constructor isn't even suppose to be used in the reload situation where there is a "prev" core, except that in SolrCore.reload there is this check...


    if (!getNewIndexDir().equals(getIndexDir())) {
      // the directory is changing, don't pass on state
      prev = null;
    }




..i'm not really sure i understand this logic, or what exactly the source of the problem is, or if the lock checking code should just be changed to work a differnet way completley, but it seemed worthy of tracking in it's own jira.

log details to follow