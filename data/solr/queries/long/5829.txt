By default the ExpandComponent re-runs both the main query and filter queries to expand the groups collapsed by the CollapsingQParserPlugin. This ticket allows you to pass the main query and filter queries into the ExpandComponent. It also allows you to pass in the expand field.

This design allows the ExpandComponent to operate independently of the CollapsingQParserPlugin and allows for modeling of parent/child relationships. 

For example:


q=*:*&fq=type:parent&expand=true&expand.field=group_id&expand.q=*:*&expand.fq=type:child


In the query above the the main query returns all documents of the type:parent. The ExpandComponent then expands the groups by retrieving all documents with type:child and grouping them by the group_id.

In other words, the main result set will be the parent documents and the expanded result set will be the child documents.

You could reverse this as well:


q=*:*&fq=type:child&fq={!collapse field=group_id}&expand=true&expand.field=group_id&expand.q=*:*&expand.fq=type:parent


In the query above the main query returns all documents with type:child and collapses them on the group_id field. The ExpandComponent then expands the groups by retrieving all documents with type:parent and groups them by group_id. Since there is only one parent per collapsed child, each group will have one document 1.

In this case the main result set will be collapsed child documents and the expanded results will be parent documents.



