There isn't much i understand about OverseerTest, but today while doing a full test run I got an unreproducible assertion failure from this line...


assertNotNull("could not find counter for shard:" + ids[i], ai);



...in which the assertion message indicated that not only was "ai" null, but "ids[i]" was null as well.

Poking arround the test a bit, i think what's happening here is that some of the preliminary logic in testShardAssignmentBigger has bounded wait loops to "make sure ...." things have happened, but there is no assertion that these things actually happen if that the loop bound is exhausted - which can lead to missleading/confusing errors further on in the test.