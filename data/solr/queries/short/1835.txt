speed up and improve tests