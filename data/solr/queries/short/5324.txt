Make sub shard replica recovery and shard state switch asynchronous