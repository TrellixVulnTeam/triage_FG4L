<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:29:45 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-664/BOOKKEEPER-664.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-664] Compaction increases latency on journal writes</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-664</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;Compaction writes to the journal to avoid data loss (see &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-530&quot; title=&quot;data might be lost during compaction.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-530&quot;&gt;&lt;del&gt;BOOKKEEPER-530&lt;/del&gt;&lt;/a&gt;). &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-530&quot; title=&quot;data might be lost during compaction.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-530&quot;&gt;&lt;del&gt;BOOKKEEPER-530&lt;/del&gt;&lt;/a&gt; correctly identified that this may affect latency on the journal but we have observed this since in production. It is possible to avoid the journal completely, as twitter do in their github branch. Basically, we need to write to the entrylogger first, flush the entry log and then add to the index.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12660378">BOOKKEEPER-664</key>
            <summary>Compaction increases latency on journal writes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ikelly">Ivan Kelly</assignee>
                                    <reporter username="ikelly">Ivan Kelly</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Jul 2013 13:35:59 +0100</created>
                <updated>Tue, 22 Oct 2013 07:13:39 +0100</updated>
                            <resolved>Tue, 22 Oct 2013 06:44:36 +0100</resolved>
                                    <version>4.2.1</version>
                                    <fixVersion>4.2.2</fixVersion>
                    <fixVersion>4.3.0</fixVersion>
                                    <component>bookkeeper-server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13722403" author="ikelly" created="Mon, 29 Jul 2013 13:43:49 +0100"  >&lt;p&gt;Hmm, I can&apos;t find the changes on Twitter&apos;s branch now :/. I&apos;ll reimplement as it&apos;s a simple fix anyhow.&lt;/p&gt;</comment>
                            <comment id="13746488" author="ikelly" created="Wed, 21 Aug 2013 16:42:23 +0100"  >&lt;p&gt;Fix attached. Max batch size set at 100000 now. This will need to be revisited when &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-432&quot; title=&quot;Improve performance of entry log range read per ledger entries &quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-432&quot;&gt;&lt;del&gt;BOOKKEEPER-432&lt;/del&gt;&lt;/a&gt; goes in.&lt;/p&gt;</comment>
                            <comment id="13746528" author="hadoopqa" created="Wed, 21 Aug 2013 17:18:19 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-664&quot; title=&quot;Compaction increases latency on journal writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-664&quot;&gt;&lt;del&gt;BOOKKEEPER-664&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12599210/0001-BOOKKEEPER-664-Compaction-increases-latency-on-journ.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-BOOKKEEPER-664-Compaction-increases-latency-on-journ.patch&lt;/a&gt; downloaded at Wed Aug 21 15:51:21 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch does not add/modify any testcase&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 877&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/468/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/468/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13746546" author="ikelly" created="Wed, 21 Aug 2013 17:34:25 +0100"  >&lt;p&gt;this is a performance issue, so it&apos;s very difficult to add a test for it. Preexisting tests check that the change doesn&apos;t break existing functionality.&lt;/p&gt;</comment>
                            <comment id="13746578" author="hustlmsp" created="Wed, 21 Aug 2013 18:08:59 +0100"  >&lt;p&gt;considering make the parameter configurable...&lt;/p&gt;</comment>
                            <comment id="13747397" author="ikelly" created="Thu, 22 Aug 2013 10:46:17 +0100"  >&lt;p&gt;I&apos;ve made it configurable. I&apos;ve intentionally left it out of bk_server.conf though, as we don&apos;t actually want people to change the default.&lt;/p&gt;</comment>
                            <comment id="13747412" author="hadoopqa" created="Thu, 22 Aug 2013 11:18:37 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-664&quot; title=&quot;Compaction increases latency on journal writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-664&quot;&gt;&lt;del&gt;BOOKKEEPER-664&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12599405/0001-BOOKKEEPER-664-Compaction-increases-latency-on-journ_trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-BOOKKEEPER-664-Compaction-increases-latency-on-journ_trunk.patch&lt;/a&gt; downloaded at Thu Aug 22 09:51:30 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch does not add/modify any testcase&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 877&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/469/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/469/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13748686" author="ikelly" created="Fri, 23 Aug 2013 17:36:00 +0100"  >&lt;p&gt;Again, -1 is for tests. Performance issues are very hard to test in CI.&lt;/p&gt;</comment>
                            <comment id="13755761" author="rakeshr" created="Sun, 1 Sep 2013 18:23:15 +0100"  >&lt;p&gt;@Ivan, the patch looks good. Just adding few points:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&apos;compactionsMaxOutstandingRequests&apos; - please remove &apos;s&apos; can we just say &apos;compactionMaxOutstandingRequests&apos;.&lt;br/&gt;
Also, would be good to have long datatype for this configuration.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;CompactionScannerFactory#process() while entryLogger.addEntry(ledgerId, entry); doesn&apos;t handling the diskfull cases(its a suggestion, feel free to ignore) Considering normal addEntry flows, would act upon and do the transitions.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13755913" author="rakeshr" created="Mon, 2 Sep 2013 06:35:29 +0100"  >&lt;p&gt;Adding few more to my previous comment&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;CompactionScannerFactory#process() while entryLogger.addEntry(ledgerId, entry); doesn&apos;t handling the diskfull cases(its a suggestion, feel free to ignore) Considering normal addEntry flows, would act upon and do the transitions.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I feel, GarbageCollectorThread can catch NoWritableLedgerDirException and break from the &apos;logsToCompact&apos; iteration. This would avoid unnecessary error exceptions, like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (EntryLogMetadata meta : logsToCompact) {
            &lt;span class=&quot;code-comment&quot;&gt;//.....
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                compactEntryLog(scannerFactory, meta);
                toRemove.add(meta.entryLogId);
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ioe) {
                &lt;span class=&quot;code-comment&quot;&gt;//.....
&lt;/span&gt;            }&lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (NoWritableLedgerDirException nwlde){
                &lt;span class=&quot;code-comment&quot;&gt;//log and &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
             }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13756498" author="ikelly" created="Tue, 3 Sep 2013 11:38:18 +0100"  >&lt;p&gt;Updated patch to address comments.&lt;/p&gt;</comment>
                            <comment id="13756518" author="hadoopqa" created="Tue, 3 Sep 2013 12:08:48 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-664&quot; title=&quot;Compaction increases latency on journal writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-664&quot;&gt;&lt;del&gt;BOOKKEEPER-664&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12601138/0002-BOOKKEEPER-664-trunk-Compaction-increases-latency-on.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0002-BOOKKEEPER-664-trunk-Compaction-increases-latency-on.patch&lt;/a&gt; downloaded at Tue Sep  3 10:41:38 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch does not add/modify any testcase&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 877&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/480/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/480/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13756693" author="rakeshr" created="Tue, 3 Sep 2013 16:23:12 +0100"  >&lt;blockquote&gt;&lt;p&gt;would be good to have long datatype for &apos;compactionMaxOutstandingRequests&apos; configuration&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;When you get a chance to rebase, please see this comment also. Anyway its a suggestion and not a blocker.&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ikelly&quot; class=&quot;user-hover&quot; rel=&quot;ikelly&quot;&gt;Ivan Kelly&lt;/a&gt;, +1 latest patch looks fine.&lt;/p&gt;</comment>
                            <comment id="13756707" author="ikelly" created="Tue, 3 Sep 2013 16:42:03 +0100"  >&lt;p&gt;Cool, im going to run some benches to verify it, and if it checks out fine, ill commit&lt;/p&gt;</comment>
                            <comment id="13756711" author="ikelly" created="Tue, 3 Sep 2013 16:45:17 +0100"  >&lt;p&gt;also, compactionMaxOutstandingRequests should almost certainly not be long. 2^31 outstanding requests is much more than a reasonable max. Each request is 8bytes*3, so it would take 12GB to store 2^31 outstanding requests, not taking into account the overhead for the data structure to hold it which would probably bring it to 16GB. This is far far far too much memory to be using for compaction.&lt;/p&gt;</comment>
                            <comment id="13757401" author="rakeshr" created="Wed, 4 Sep 2013 03:44:17 +0100"  >&lt;p&gt;Good point, makes sense to me.&lt;/p&gt;</comment>
                            <comment id="13757659" author="ikelly" created="Wed, 4 Sep 2013 12:02:00 +0100"  >&lt;p&gt;Benching shows this doesn&apos;t quite work :/ I&apos;ve attached the graph. The segments to pay attention to are 4:40-5:00 &amp;amp; 5:20-end. The rest is loading data in, so the throttle is high. I loaded 50 ledgers with enough data to roll into a new logfile. Then I ran a load on 1 ledger, at throttle 1000. After a couple of minutes I deleted enough ledgers to trigger compaction. 4:40 is without the patch, 5:20 is with.&lt;/p&gt;

&lt;p&gt;Since we dont write to the journal, we add pressure on the ledger disk, as the offsets are updated in the index. The ledger disk is in the critical path (see &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-572&quot; title=&quot;Make the journal a write ahead log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-572&quot;&gt;&lt;del&gt;BOOKKEEPER-572&lt;/del&gt;&lt;/a&gt;) so increasing the load on it increases the time it will take to respond to the client. I don&apos;t have stats for it, but I suspect that flushing the index it causing the index page being written to by the non-compaction run, to be swapped out regularly during compaction. I&apos;m going to run again with a profiler to see more.&lt;/p&gt;</comment>
                            <comment id="13757663" author="hadoopqa" created="Wed, 4 Sep 2013 12:13:27 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-664&quot; title=&quot;Compaction increases latency on journal writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-664&quot;&gt;&lt;del&gt;BOOKKEEPER-664&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12601362/bench.png&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;bench.png&lt;/a&gt; downloaded at Wed Sep  4 11:11:37 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; Patch failed to apply to head of branch&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;</comment>
                            <comment id="13757732" author="ikelly" created="Wed, 4 Sep 2013 14:13:43 +0100"  >&lt;p&gt;Ah, the problem appears to be EntryLogger#flush() and EntryLogger#addEntry() being synced. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hustlmsp&quot; class=&quot;user-hover&quot; rel=&quot;hustlmsp&quot;&gt;Sijie Guo&lt;/a&gt;, I remember you&apos;ve mentioned this in the past, is there a self contained fix, or would it require all of &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-432&quot; title=&quot;Improve performance of entry log range read per ledger entries &quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-432&quot;&gt;&lt;del&gt;BOOKKEEPER-432&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13758039" author="hustlmsp" created="Wed, 4 Sep 2013 18:49:54 +0100"  >&lt;blockquote&gt;
&lt;p&gt;EntryLogger#flush() and EntryLogger#addEntry() being synced.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;the checkpoint mechanism in &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-564&quot; title=&quot;Better checkpoint mechanism&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-564&quot;&gt;&lt;del&gt;BOOKKEEPER-564&lt;/del&gt;&lt;/a&gt; is trying to resolving this synchronization by avoiding flushing current entry log.&lt;/p&gt;

&lt;p&gt;so similar idea could be applied here, we don&apos;t need to flush the entry logger after compaction. we could wait until it rolls to write new entry logger file and flushes the previous entry logger files. it is easy to do that using the EntryLogListener callback.&lt;/p&gt;

&lt;p&gt;BTW, I don&apos;t think you use max outstanding requests in the right way. you should not flush entry log when reaching max outstanding requests. you could just add the entry back to ledger storage and let it go through the original ledger storage add flow (since we already optimize the flush/checkpoint flow). the only thing that Compaction Scanner could do is to use max_outstanding_requests as a rate limiter in compaction scanner to limit the rate of compaction adds (e.g. 10% of bandwidth used for compaction).&lt;/p&gt;
</comment>
                            <comment id="13758796" author="hustlmsp" created="Thu, 5 Sep 2013 06:08:15 +0100"  >&lt;p&gt;attach a patch per my previous comment. this patch is just a quick draft to show the idea, need to refine.&lt;/p&gt;</comment>
                            <comment id="13758829" author="hadoopqa" created="Thu, 5 Sep 2013 07:44:01 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-664&quot; title=&quot;Compaction increases latency on journal writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-664&quot;&gt;&lt;del&gt;BOOKKEEPER-664&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12601560/BOOKKEEPER-664.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-664.patch&lt;/a&gt; downloaded at Thu Sep  5 06:16:44 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch does not add/modify any testcase&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 877&lt;br/&gt;
.    Tests failed: 3&lt;br/&gt;
.    Tests errors: 0&lt;/p&gt;

&lt;p&gt;.    The patch failed the following testcases:&lt;/p&gt;

&lt;p&gt;.      testMinorCompaction(org.apache.bookkeeper.bookie.CompactionTest)&lt;br/&gt;
.      testMajorCompaction(org.apache.bookkeeper.bookie.CompactionTest)&lt;br/&gt;
.      testCompactionSmallEntryLogs(org.apache.bookkeeper.bookie.CompactionTest)&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/483/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/483/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13758940" author="ikelly" created="Thu, 5 Sep 2013 10:26:08 +0100"  >&lt;p&gt;The attached patch falls to the same issue that caused us to go through the journal in the first place. We need to defer the add to the index, otherwise the index could be flushed before entrylog, and a crash would cause entry loss.&lt;/p&gt;

&lt;p&gt;I remembered the solution to the sync problem after I went home. You guys added double buffering of a sort, that entrylogger was only flushed after being rotated, thereby taking it out of the critical path. That&apos;s too big of a change for 4.2.2 though. Throttling should give a similar affect though.&lt;/p&gt;

&lt;p&gt;I think the solution is a combination of both patches. I&apos;ll have a go.&lt;/p&gt;</comment>
                            <comment id="13758948" author="ikelly" created="Thu, 5 Sep 2013 10:31:48 +0100"  >&lt;p&gt;I just realised that the flush on rotate stuff is already in trunk, so maybe throttling isnt even needed there. Working on 4.2.2 patch though.&lt;/p&gt;</comment>
                            <comment id="13759109" author="ikelly" created="Thu, 5 Sep 2013 15:30:02 +0100"  >&lt;p&gt;Merge throttling and listener into previous patch. Latency spike no longer appears during compaction, though compaction does take longer.&lt;/p&gt;</comment>
                            <comment id="13759145" author="hadoopqa" created="Thu, 5 Sep 2013 16:08:12 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-664&quot; title=&quot;Compaction increases latency on journal writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-664&quot;&gt;&lt;del&gt;BOOKKEEPER-664&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12601613/0001-BOOKKEEPER-664-branch-4.2-Compaction-increases-laten.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-BOOKKEEPER-664-branch-4.2-Compaction-increases-laten.patch&lt;/a&gt; downloaded at Thu Sep  5 15:06:20 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; Patch failed to apply to head of branch&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;</comment>
                            <comment id="13759333" author="hustlmsp" created="Thu, 5 Sep 2013 20:13:52 +0100"  >&lt;blockquote&gt;
&lt;p&gt;The attached patch falls to the same issue that caused us to go through the journal in the first place. We need to defer the add to the index, otherwise the index could be flushed before entrylog, and a crash would cause entry loss.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;yes. the attached patch is just a quick draft to show the idea I described previous comment.&lt;/p&gt;

&lt;p&gt;thanks for merging the throttling and listener into the patch.&lt;/p&gt;

&lt;p&gt;several comments on your latest patch:&lt;/p&gt;

&lt;p&gt;1) it would be better to add a test case to cover the case you described in the comment to ensure future changes would not break it.&lt;br/&gt;
2) rotate listener defers the flushing, which would break some test cases in compaction test if I remembered correctly. so you might need to change those test cases.&lt;br/&gt;
3) add compactionMaxOutstandingRequests and compactionRate to document &amp;amp; config file&lt;br/&gt;
4) use {} rather than &quot;+&quot; in log statements.&lt;br/&gt;
5) you might need to notify flushLock when shutting down similar as what I do in the patch. since entry logger might not rotate during shutting down.&lt;/p&gt;
</comment>
                            <comment id="13760461" author="ikelly" created="Fri, 6 Sep 2013 19:15:36 +0100"  >&lt;blockquote&gt;
&lt;p&gt;1) it would be better to add a test case to cover the case you described in the comment to ensure future changes would not break it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;test attached.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2) rotate listener defers the flushing, which would break some test cases in compaction test if I remembered correctly. so you might need to change those test cases.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Moving somethingWritten into EntryLogger fixes this problem.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;3) add compactionMaxOutstandingRequests and compactionRate to document &amp;amp; config file&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ive added to the config. I dont want to add to the doc yet. We havent played with the parameters ourselves yet. I&apos;d prefer if users didnt either without asking us.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;4) use {} rather than &quot;+&quot; in log statements.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;fixed&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;5) you might need to notify flushLock when shutting down similar as what I do in the patch. since entry logger might not rotate during shutting down.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Fixed by checking &apos;running&apos; in the wait loop&lt;/p&gt;</comment>
                            <comment id="13760490" author="hadoopqa" created="Fri, 6 Sep 2013 19:28:55 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-664&quot; title=&quot;Compaction increases latency on journal writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-664&quot;&gt;&lt;del&gt;BOOKKEEPER-664&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12601870/0001-BOOKKEEPER-664-branch-4.2-Compaction-increases-laten.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-BOOKKEEPER-664-branch-4.2-Compaction-increases-laten.patch&lt;/a&gt; downloaded at Fri Sep  6 18:26:58 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; Patch failed to apply to head of branch&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;</comment>
                            <comment id="13761593" author="hustlmsp" created="Mon, 9 Sep 2013 03:50:50 +0100"  >&lt;p&gt;+1 for the patch for branch 4.2.&lt;/p&gt;</comment>
                            <comment id="13761733" author="ikelly" created="Mon, 9 Sep 2013 10:54:58 +0100"  >&lt;p&gt;Committed r1521021 to branch-4.2. Thanks for the code and reviews Sijie.&lt;/p&gt;</comment>
                            <comment id="13769577" author="fpj" created="Tue, 17 Sep 2013 15:57:30 +0100"  >&lt;p&gt;I think you forgot to resolve this one.&lt;/p&gt;</comment>
                            <comment id="13769578" author="ikelly" created="Tue, 17 Sep 2013 15:59:35 +0100"  >&lt;p&gt;No patch has been submitted to trunk.&lt;/p&gt;</comment>
                            <comment id="13769650" author="fpj" created="Tue, 17 Sep 2013 17:23:23 +0100"  >&lt;p&gt;ok.&lt;/p&gt;</comment>
                            <comment id="13794122" author="ikelly" created="Mon, 14 Oct 2013 14:55:13 +0100"  >&lt;p&gt;New patch applies to trunk.&lt;/p&gt;</comment>
                            <comment id="13794128" author="hadoopqa" created="Mon, 14 Oct 2013 15:04:11 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-664&quot; title=&quot;Compaction increases latency on journal writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-664&quot;&gt;&lt;del&gt;BOOKKEEPER-664&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12608280/0001-BOOKKEEPER-664-Compaction-increases-latency-on-journ.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-BOOKKEEPER-664-Compaction-increases-latency-on-journ.patch&lt;/a&gt; downloaded at Mon Oct 14 14:02:00 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; Patch failed to apply to head of branch&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;</comment>
                            <comment id="13794152" author="ikelly" created="Mon, 14 Oct 2013 15:36:24 +0100"  >&lt;p&gt;Forgot to pull trunk before creating patch. Now based on latest trunk.&lt;/p&gt;</comment>
                            <comment id="13794175" author="hadoopqa" created="Mon, 14 Oct 2013 16:10:13 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-664&quot; title=&quot;Compaction increases latency on journal writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-664&quot;&gt;&lt;del&gt;BOOKKEEPER-664&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12608282/0001-BOOKKEEPER-664-Compaction-increases-latency-on-journ.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-BOOKKEEPER-664-Compaction-increases-latency-on-journ.patch&lt;/a&gt; downloaded at Mon Oct 14 14:42:00 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 1 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 881&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/512/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/512/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13801508" author="hustlmsp" created="Tue, 22 Oct 2013 06:42:53 +0100"  >&lt;p&gt;+1 for the patch. committing.&lt;/p&gt;</comment>
                            <comment id="13801512" author="hustlmsp" created="Tue, 22 Oct 2013 06:44:36 +0100"  >&lt;p&gt;committed as r1534503. thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ikelly&quot; class=&quot;user-hover&quot; rel=&quot;ikelly&quot;&gt;Ivan Kelly&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13801527" author="hudson" created="Tue, 22 Oct 2013 07:13:39 +0100"  >&lt;p&gt;SUCCESS: Integrated in bookkeeper-trunk #409 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/409/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/409/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-664&quot; title=&quot;Compaction increases latency on journal writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-664&quot;&gt;&lt;del&gt;BOOKKEEPER-664&lt;/del&gt;&lt;/a&gt;: Compaction increases latency on journal writes (ivank via sijie) (sijie: rev 1534503)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/conf/bk_server.conf&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/EntryLogger.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/GarbageCollectorThread.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/InterleavedLedgerStorage.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/CompactionTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12599209" name="0001-BOOKKEEPER-664-Compaction-increases-latency-on-journ-branch-4.2.patch" size="16659" author="ikelly" created="Wed, 21 Aug 2013 16:42:23 +0100"/>
                            <attachment id="12608282" name="0001-BOOKKEEPER-664-Compaction-increases-latency-on-journ.patch" size="35631" author="ikelly" created="Mon, 14 Oct 2013 15:36:24 +0100"/>
                            <attachment id="12608280" name="0001-BOOKKEEPER-664-Compaction-increases-latency-on-journ.patch" size="34971" author="ikelly" created="Mon, 14 Oct 2013 14:55:13 +0100"/>
                            <attachment id="12599210" name="0001-BOOKKEEPER-664-Compaction-increases-latency-on-journ.patch" size="16861" author="ikelly" created="Wed, 21 Aug 2013 16:42:23 +0100"/>
                            <attachment id="12599404" name="0001-BOOKKEEPER-664-Compaction-increases-latency-on-journ_branch4.2.patch" size="19408" author="ikelly" created="Thu, 22 Aug 2013 10:45:25 +0100"/>
                            <attachment id="12599405" name="0001-BOOKKEEPER-664-Compaction-increases-latency-on-journ_trunk.patch" size="19578" author="ikelly" created="Thu, 22 Aug 2013 10:45:35 +0100"/>
                            <attachment id="12601870" name="0001-BOOKKEEPER-664-branch-4.2-Compaction-increases-laten.patch" size="33567" author="ikelly" created="Fri, 6 Sep 2013 19:16:21 +0100"/>
                            <attachment id="12601613" name="0001-BOOKKEEPER-664-branch-4.2-Compaction-increases-laten.patch" size="24865" author="ikelly" created="Thu, 5 Sep 2013 15:30:02 +0100"/>
                            <attachment id="12601137" name="0001-BOOKKEEPER-664-branch-4.2-Compaction-increases-laten.patch" size="19619" author="ikelly" created="Tue, 3 Sep 2013 11:38:18 +0100"/>
                            <attachment id="12601138" name="0002-BOOKKEEPER-664-trunk-Compaction-increases-latency-on.patch" size="19788" author="ikelly" created="Tue, 3 Sep 2013 11:38:18 +0100"/>
                            <attachment id="12601560" name="BOOKKEEPER-664.patch" size="23043" author="hustlmsp" created="Thu, 5 Sep 2013 06:08:15 +0100"/>
                            <attachment id="12601362" name="bench.png" size="35307" author="ikelly" created="Wed, 4 Sep 2013 12:02:29 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 21 Aug 2013 16:18:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>340570</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzgkz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>340888</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>