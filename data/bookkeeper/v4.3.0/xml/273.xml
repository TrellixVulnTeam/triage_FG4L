<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:26:10 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-273/BOOKKEEPER-273.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-273] LedgerHandle.deleteLedger() should be idempotent</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-273</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;Deleting a non-existing ledger should silently succeed. &lt;/p&gt;

&lt;p&gt;Current behavior is to raise a ZKException, but it&apos;s not possible to know whether there was some error or the ledger does not exists anymore. &lt;/p&gt;

&lt;p&gt;This scenario will happen when a previous deleteLedger() call succeeded but the client crashed before updating its own ledger list.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12558515">BOOKKEEPER-273</key>
            <summary>LedgerHandle.deleteLedger() should be idempotent</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mmerli">Matteo Merli</assignee>
                                    <reporter username="mmerli">Matteo Merli</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 May 2012 01:09:16 +0100</created>
                <updated>Mon, 22 Oct 2012 15:50:15 +0100</updated>
                            <resolved>Wed, 30 May 2012 16:14:01 +0100</resolved>
                                    <version>4.1.0</version>
                                    <fixVersion>4.1.0</fixVersion>
                                    <component>bookkeeper-client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13285315" author="umamaheswararao" created="Wed, 30 May 2012 02:28:07 +0100"  >
&lt;p&gt;I agree the case. Even normal file system also will not throw any exceptions on delete failures, but it will indicate with false about the opeation status.&lt;br/&gt;
Unfortunately deleteLedger is void API. But this will be a behaviour change, So, let&apos;s discuss with Ivan/Flavio. Existing customers might have the opinion of throwing exception when NoNode also. If the change approves, you may want to add test for this behavior... .Alternatively, can we set a different exception code in this case?&lt;/p&gt;</comment>
                            <comment id="13285354" author="hustlmsp" created="Wed, 30 May 2012 04:03:35 +0100"  >&lt;p&gt;I like the idea Uma proposed, changing deleteLedger to return a boolean result indicating whether the file is deleted succeed or not. If we want to do it, it would be API change and I would suggest marking it as 4.2.0. &lt;/p&gt;

&lt;p&gt;BTW, it would be better to generate the patch with &apos;-no-prefix&apos; option, which might be easy for users to apply.&lt;/p&gt;</comment>
                            <comment id="13285470" author="fpj" created="Wed, 30 May 2012 08:40:42 +0100"  >&lt;p&gt;@matteo I agree with the change. Interestingly, there is a mismatch between the synchronous version of delete ledger and the asynchronous version. The asynchronous version propagates the zookeeper error code, but the synchronous one doesn&apos;t, it simply logs the error code. The asynchronous version seems to be leaking some info about the internals.&lt;/p&gt;

&lt;p&gt;@uma,sijie At the time we were designing the api, we&apos;ve set as one of our guidelines to have synchronous calls indicating an error by throwing an exception and asynchronous calls indicating errors with a return code. If we make the change Uma proposes, then we will be breaking this guideline and symmetry. Do you guys feel that it is a strong enough reason to break compatibility? Of course, doing it earlier is better, so now it is a good time to talk about it. Also, I think that a change that breaks compatibility should be in 5.0, no?&lt;/p&gt;

&lt;p&gt;With respect to the issue of this jira, I believe we would return true in the case the ledger has already been deleted and return false if the operation really fails, right? Throwing an exception compared to just returning a boolean enables us to convey more information about the error, even if we are not conveying a lot right now. &lt;/p&gt;</comment>
                            <comment id="13285534" author="hustlmsp" created="Wed, 30 May 2012 10:41:36 +0100"  >

&lt;p&gt;&amp;gt; With respect to the issue of this jira, I believe we would return true in the case the ledger has already been deleted and return false if the operation really fails, right?&lt;/p&gt;

&lt;p&gt;I think the proposal is returning true when deleting the ledger successfully, returning false when the ledger doesn&apos;t exist, throwing exception when encountering exceptions during deletion. Just as File#delete() in JDK, &lt;a href=&quot;http://docs.oracle.com/javase/1.4.2/docs/api/java/io/File.html#delete(&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://docs.oracle.com/javase/1.4.2/docs/api/java/io/File.html#delete(&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;&amp;gt;  At the time we were designing the api, we&apos;ve set as one of our guidelines to have synchronous calls indicating an error by throwing an exception and asynchronous calls indicating errors with a return code.&lt;/p&gt;

&lt;p&gt;I agreed that we need to keep compatibility in 4.x versions. One bad thing for now is user can&apos;t know the detail reason when receiving ZKException return code in ledger deletion. I would suggest returning NoSuchLedgerExistsException when deleting non-existed ledgers, which could keep compatibility and make user clear about what happened.&lt;/p&gt;</comment>
                            <comment id="13285550" author="umamaheswararao" created="Wed, 30 May 2012 11:22:58 +0100"  >&lt;blockquote&gt;
&lt;p&gt; would suggest returning NoSuchLedgerExistsException when deleting non-existed ledgers, which could keep compatibility and make user clear about what happened.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is one more option alternatively I proposed in my previous comment.&lt;br/&gt;
see in my above comment: &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-273?focusedCommentId=13285315&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13285315&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Alternatively, can we set a different exception code in this case?&lt;/a&gt;&lt;br/&gt;
I too agreed with Flavio about maintainng the compatibility for 4.x versions. For this version, fix could be like this suggestion. So, that we can maintain compatiobility for 4.x versions and also will be able to indicate the users about the status with correct exception.&lt;/p&gt;

&lt;p&gt;For version 5.0, may be we can think/ discuss more about this API behavior change. Since we don&apos;t want to break the compatibility in 4.x versions, Let&apos;s go ahead with above suggestion? If yes, it may be better to move to separate JIRA about the below discussions then?&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I think the proposal is returning true when deleting the ledger successfully, returning false when the ledger doesn&apos;t exist, throwing exception when encountering exceptions during deletion. Just as File#delete() in JDK, &lt;a href=&quot;http://docs.oracle.com/javase/1.4.2/docs/api/java/io/File.html#delete(&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://docs.oracle.com/javase/1.4.2/docs/api/java/io/File.html#delete(&lt;/a&gt;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;@uma,sijie At the time we were designing the api, we&apos;ve set as one of our guidelines to have synchronous calls indicating an error by throwing an exception and asynchronous calls indicating errors with a return code. If we make the change Uma proposes, then we will be breaking this guideline and symmetry. Do you guys feel that it is a strong enough reason to break compatibility? Of course, doing it earlier is better, so now it is a good time to talk about it. Also, I think that a change that breaks compatibility should be in 5.0, no?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Uma&lt;/p&gt;</comment>
                            <comment id="13285579" author="ikelly" created="Wed, 30 May 2012 12:05:09 +0100"  >&lt;p&gt;+1 on NoSuchLedgerExistsException. Any code already has to catch BKException, so this won&apos;t break BC, but it will allow them to know that the failure was only due to the ledger not existing.&lt;/p&gt;</comment>
                            <comment id="13285598" author="fpj" created="Wed, 30 May 2012 12:43:37 +0100"  >&lt;p&gt;+1 for me too on NoSuchLedgerExistsException.&lt;/p&gt;</comment>
                            <comment id="13285701" author="mmerli" created="Wed, 30 May 2012 15:29:32 +0100"  >&lt;p&gt;Updated the patch to throw BKNoSuchLedgerExistsException when the ledger doesn&apos;t exist.&lt;/p&gt;</comment>
                            <comment id="13285705" author="ikelly" created="Wed, 30 May 2012 15:42:54 +0100"  >&lt;p&gt;Two small niggles with the patch.&lt;br/&gt;
a) the javadoc should specify BKException.BKNoSuchLedgerExistsException rather than BKNoSuchLedgerExistsException, so that javadoc can generate a link for it. (mvn javadoc:aggregate generates the javadoc btw)&lt;br/&gt;
b) the else should be on the same line. Use zookeeper&apos;s coding standard, which in turn uses the sun standard. &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://cwiki.apache.org/confluence/display/ZOOKEEPER/HowToContribute&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://cwiki.apache.org/confluence/display/ZOOKEEPER/HowToContribute&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://www.oracle.com/technetwork/java/javase/documentation/codeconventions-142311.html#449&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.oracle.com/technetwork/java/javase/documentation/codeconventions-142311.html#449&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13285711" author="mmerli" created="Wed, 30 May 2012 15:52:49 +0100"  >&lt;p&gt;Updated the patch with formatting and exception full name.&lt;/p&gt;</comment>
                            <comment id="13285714" author="ikelly" created="Wed, 30 May 2012 15:55:40 +0100"  >&lt;p&gt;lgtm +1. committing&lt;/p&gt;</comment>
                            <comment id="13285731" author="ikelly" created="Wed, 30 May 2012 16:14:01 +0100"  >&lt;p&gt;Committed as r1344301. Thanks Matteo.&lt;/p&gt;</comment>
                            <comment id="13285742" author="hudson" created="Wed, 30 May 2012 16:31:29 +0100"  >&lt;p&gt;Integrated in bookkeeper-trunk #536 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/536/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/536/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-273&quot; title=&quot;LedgerHandle.deleteLedger() should be idempotent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-273&quot;&gt;&lt;del&gt;BOOKKEEPER-273&lt;/del&gt;&lt;/a&gt;: LedgerHandle.deleteLedger() should be idempotent (Matteo Merli via ivank) (Revision 1344301)&lt;/p&gt;

&lt;p&gt;     Result = UNSTABLE&lt;br/&gt;
ivank : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeper.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12530210" name="0001-BOOKKEEPER-273-LedgerHandle.deleteLedger-should-be-i.patch" size="1383" author="mmerli" created="Wed, 30 May 2012 15:51:46 +0100"/>
                            <attachment id="12530209" name="0001-BOOKKEEPER-273-LedgerHandle.deleteLedger-should-be-i.patch" size="1380" author="mmerli" created="Wed, 30 May 2012 15:28:42 +0100"/>
                            <attachment id="12530123" name="0001-BOOKKEEPER-273-LedgerHandle.deleteLedger-should-be-i.patch" size="1359" author="mmerli" created="Wed, 30 May 2012 01:16:29 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 30 May 2012 01:28:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>250353</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy4s5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>61718</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>