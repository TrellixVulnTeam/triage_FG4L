<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:27:41 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-623/BOOKKEEPER-623.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-623] LedgerChecker should avoid segments of closed ledger with higher start entryId than closed entry.</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-623</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;With the almost same testcase mentioned in the &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-584&quot; title=&quot;Data loss when ledger metadata is overwritten&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-584&quot;&gt;&lt;del&gt;BOOKKEEPER-584&lt;/del&gt;&lt;/a&gt;, Ledger metadata is getting added with extra segment during failure handling of bookies along with fencing. &lt;/p&gt;

&lt;p&gt;Only difference in the testcase is .&lt;br/&gt;
1. Before bookie failures some entries were already written&lt;br/&gt;
2. And after bookies failed ( First bookie will throw LedgerFenced/Unauthorized exception, and second bookie is slow/dead bookie ), Number of entries written asynchrounously is n*ensembleSize+1&lt;/p&gt;

&lt;p&gt;Note that, Unauthorized/FencedException callback comes first, then other bookie failure callback comes.&lt;/p&gt;

&lt;p&gt;I will attach a TestCase along with patch for this shortly. Testcase is modified version of attached testcase in &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-584&quot; title=&quot;Data loss when ledger metadata is overwritten&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-584&quot;&gt;&lt;del&gt;BOOKKEEPER-584&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12652319">BOOKKEEPER-623</key>
            <summary>LedgerChecker should avoid segments of closed ledger with higher start entryId than closed entry.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vinayrpet">Vinayakumar B</assignee>
                                    <reporter username="vinayrpet">Vinayakumar B</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Jun 2013 05:45:20 +0100</created>
                <updated>Wed, 26 Jun 2013 02:55:47 +0100</updated>
                            <resolved>Wed, 26 Jun 2013 02:27:33 +0100</resolved>
                                    <version>4.2.1</version>
                    <version>4.3.0</version>
                                    <fixVersion>4.2.2</fixVersion>
                    <fixVersion>4.3.0</fixVersion>
                                    <component>bookkeeper-server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13680942" author="vinayrpet" created="Wed, 12 Jun 2013 05:48:50 +0100"  >&lt;p&gt;Corrupted metadata will look like this&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;BookieMetadataFormatVersion	2
quorumSize: 3
ensembleSize: 3
length: 56
lastEntryId: 9
state: CLOSED
segment {
  ensembleMember: &quot;xx.xx.xx.154:15002&quot;
  ensembleMember: &quot;xx.xx.xx.154:15004&quot;
  ensembleMember: &quot;xx.xx.xx.154:15001&quot;
  firstEntryId: 0
}
segment {
  ensembleMember: &quot;xx.xx.xx.154:15002&quot;
  ensembleMember: &quot;xx.xx.xx.154:15005&quot;
  ensembleMember: &quot;xx.xx.xx.154:15001&quot;
  firstEntryId: 10
}
digestType: CRC32
password: &quot;&quot;
ackQuorumSize: 3&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;here ledger closed with lastEntryId 9, but still one more segment is present with firstEntryId 10. And during autorecovery, bookie will try to read this entry and fails.&lt;/p&gt;</comment>
                            <comment id="13680948" author="vinayrpet" created="Wed, 12 Jun 2013 06:12:34 +0100"  >&lt;p&gt;Patch for Trunk&lt;/p&gt;</comment>
                            <comment id="13680955" author="umamaheswararao" created="Wed, 12 Jun 2013 06:34:34 +0100"  >&lt;p&gt;I am back now &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Looks like good catch Vinay.&lt;br/&gt;
Just a note about customer impact because of this issue: Due to this many logs getting genrated and keep auto-recovery failing&lt;/p&gt;</comment>
                            <comment id="13680959" author="hustlmsp" created="Wed, 12 Jun 2013 06:45:12 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-580&quot; title=&quot;improve close logic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-580&quot;&gt;&lt;del&gt;BOOKKEEPER-580&lt;/del&gt;&lt;/a&gt; should fix this.&lt;/p&gt;</comment>
                            <comment id="13680962" author="umamaheswararao" created="Wed, 12 Jun 2013 06:49:16 +0100"  >&lt;p&gt;I think Yes, Sijie already handled this case in &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-580&quot; title=&quot;improve close logic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-580&quot;&gt;&lt;del&gt;BOOKKEEPER-580&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
Vinay, do you mind verifying with that patch once?&lt;/p&gt;</comment>
                            <comment id="13680963" author="umamaheswararao" created="Wed, 12 Jun 2013 06:49:51 +0100"  >&lt;p&gt;Thanks Sijie for pointing that issue.&lt;/p&gt;</comment>
                            <comment id="13680980" author="vinayrpet" created="Wed, 12 Jun 2013 07:22:19 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-580&quot; title=&quot;improve close logic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-580&quot;&gt;&lt;del&gt;BOOKKEEPER-580&lt;/del&gt;&lt;/a&gt; will not solve the current issue.&lt;br/&gt;
It will just avoid changes inside the &lt;tt&gt;handleUnrecoverableErrorDuringAdd(..)&lt;/tt&gt; proposed in the patch.&lt;/p&gt;</comment>
                            <comment id="13680986" author="umamaheswararao" created="Wed, 12 Jun 2013 07:30:18 +0100"  >&lt;p&gt;From Vinay Analysis: When we get failure response from one BK, we are changing the ensemble unconditionally, whther that is already closed or not. He is adding closed check in BK failure call back also.&lt;br/&gt;
I think locks should be consistent as current close check is under metadata lock and where asyncCloseInternal works under LedgerHandle lock.&lt;/p&gt;</comment>
                            <comment id="13680991" author="vinayrpet" created="Wed, 12 Jun 2013 07:38:00 +0100"  >&lt;p&gt;Attaching the latest patch.. &lt;br/&gt;
Made locks consistent. Using LedgerHandle lock while updating metadata also.&lt;/p&gt;</comment>
                            <comment id="13680999" author="hustlmsp" created="Wed, 12 Jun 2013 07:54:14 +0100"  >&lt;p&gt;first of all, I don&apos;t think the fix addresses your issue described. in this case, if entry 10 has auth failure and the ledger closed in entry 9. so when the ledger is opened to read, we just could access entries until 9. the semantic is correct and consistent. the extra segment doesn&apos;t affect the semantic of a closed ledger. so it is a auto-recovery issue not an error handling issue here.&lt;/p&gt;

&lt;p&gt;second, the segment is added when changing ensemble before closing. so how the close checking avoid adding extra segment? third, I don&apos;t think you need to add metadata.isClosed checking, since any zookeeper update is conditional and LedgerMetadata#resolveConflict already check if the metadata is Closed or not. so I am doubting how your test case reproduce your comment. Could you make it clear?&lt;/p&gt;
</comment>
                            <comment id="13681001" author="hadoopqa" created="Wed, 12 Jun 2013 07:58:53 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-623&quot; title=&quot;LedgerChecker should avoid segments of closed ledger with higher start entryId than closed entry.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-623&quot;&gt;&lt;del&gt;BOOKKEEPER-623&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12587370/BOOKKEEPER-623.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-623.patch&lt;/a&gt; downloaded at Wed Jun 12 06:32:52 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 1 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 843&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/355/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/355/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13681005" author="vinayrpet" created="Wed, 12 Jun 2013 08:07:51 +0100"  >&lt;blockquote&gt;&lt;p&gt;the extra segment doesn&apos;t affect the semantic of a closed ledger. so it is a auto-recovery issue not an error handling issue here.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Agree.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;second, the segment is added when changing ensemble before closing.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;  Here change of ensemble is happening after the ledger is closed. because Fenced/Unauthorized callback comes first and makes the ledger closed. Then BookieFailure callback comes and try to add the ensemble.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;third, I don&apos;t think you need to add metadata.isClosed checking, since any zookeeper update is conditional and LedgerMetadata#resolveConflict already check if the metadata is Closed or not.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Resolve conflict might have come while handling the callbacks for LegerFenced/Unauthorized exceptions. But it will be resolved and metadata will be updated at that time. Later when handling bookie failures in &lt;tt&gt;LedgerHandle#handleBookieFailure(..)&lt;/tt&gt; no conflicts will come, because all the later updates (ensemble change) will happen on the same instance of metadata which is already resolved the conflict, so it will have the latest zookeeper version and state. So obviously no check will happen before adding extra ensemble.&lt;/p&gt;</comment>
                            <comment id="13681054" author="hadoopqa" created="Wed, 12 Jun 2013 09:59:15 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-623&quot; title=&quot;LedgerChecker should avoid segments of closed ledger with higher start entryId than closed entry.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-623&quot;&gt;&lt;del&gt;BOOKKEEPER-623&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12587385/BOOKKEEPER-623.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-623.patch&lt;/a&gt; downloaded at Wed Jun 12 08:33:08 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 1 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 843&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/357/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/357/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13681461" author="hustlmsp" created="Wed, 12 Jun 2013 19:18:13 +0100"  >&lt;p&gt;vinay, thanks for explanation. but you still can&apos;t avoid adding extra segment if handling failure response came before auth failure. and also, another case, an ensemble change happened first and bring an unauthed bookie in, the extra segment would still be added to the ledger metadata.&lt;/p&gt;

&lt;p&gt;so a bunch of cases would introduce extra segment in closed state, which could not be avoided. so I don&apos;t see the value to avoid adding extra segments in a closed ledger, since lastEntryId already defined the boundary. we definitely should fix auto-recovery issue rather than this.&lt;/p&gt;</comment>
                            <comment id="13683873" author="hadoopqa" created="Fri, 14 Jun 2013 23:42:59 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-623&quot; title=&quot;LedgerChecker should avoid segments of closed ledger with higher start entryId than closed entry.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-623&quot;&gt;&lt;del&gt;BOOKKEEPER-623&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12587385/BOOKKEEPER-623.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-623.patch&lt;/a&gt; downloaded at Fri Jun 14 22:41:02 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; Patch failed to apply to head of branch&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;</comment>
                            <comment id="13686239" author="hustlmsp" created="Tue, 18 Jun 2013 01:36:50 +0100"  >&lt;p&gt;cancel the patch since the patch doesn&apos;t address the issue as it described.&lt;/p&gt;</comment>
                            <comment id="13687875" author="vinayrpet" created="Wed, 19 Jun 2013 12:03:03 +0100"  >&lt;p&gt;Attaching the patch with the fix in LedgerChecker&lt;/p&gt;</comment>
                            <comment id="13687904" author="hadoopqa" created="Wed, 19 Jun 2013 13:07:29 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-623&quot; title=&quot;LedgerChecker should avoid segments of closed ledger with higher start entryId than closed entry.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-623&quot;&gt;&lt;del&gt;BOOKKEEPER-623&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12588571/BOOKKEEPER-623.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-623.patch&lt;/a&gt; downloaded at Wed Jun 19 11:41:22 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch contains 1 line(s) with trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 1 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 849&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/375/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/375/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13687955" author="hadoopqa" created="Wed, 19 Jun 2013 14:09:22 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-623&quot; title=&quot;LedgerChecker should avoid segments of closed ledger with higher start entryId than closed entry.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-623&quot;&gt;&lt;del&gt;BOOKKEEPER-623&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12588585/BOOKKEEPER-623.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-623.patch&lt;/a&gt; downloaded at Wed Jun 19 12:42:56 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 1 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 849&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/378/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/378/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13688836" author="hustlmsp" created="Thu, 20 Jun 2013 04:32:29 +0100"  >&lt;p&gt;the check could be simple&lt;/p&gt;

&lt;p&gt;curEntryId != null &amp;amp;&amp;amp; !(lh.getLedgerMetadata().isClosed() &amp;amp;&amp;amp; lh.getLastAddConfirmed() &amp;lt; curEntryId)&lt;/p&gt;

&lt;p&gt;right?&lt;/p&gt;</comment>
                            <comment id="13689105" author="vinayrpet" created="Thu, 20 Jun 2013 11:22:25 +0100"  >&lt;p&gt;Yes! You are right &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hustlmsp&quot; class=&quot;user-hover&quot; rel=&quot;hustlmsp&quot;&gt;Sijie Guo&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;Uploading the latest patch with the change&lt;/p&gt;</comment>
                            <comment id="13689135" author="hadoopqa" created="Thu, 20 Jun 2013 11:57:39 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-623&quot; title=&quot;LedgerChecker should avoid segments of closed ledger with higher start entryId than closed entry.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-623&quot;&gt;&lt;del&gt;BOOKKEEPER-623&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12588815/BOOKKEEPER-623.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-623.patch&lt;/a&gt; downloaded at Thu Jun 20 10:31:21 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch contains 1 line(s) with trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 1 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 849&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/379/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/379/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13689206" author="vinayrpet" created="Thu, 20 Jun 2013 13:56:25 +0100"  >&lt;p&gt;Removed the trailing space&lt;/p&gt;</comment>
                            <comment id="13689238" author="hadoopqa" created="Thu, 20 Jun 2013 14:27:36 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-623&quot; title=&quot;LedgerChecker should avoid segments of closed ledger with higher start entryId than closed entry.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-623&quot;&gt;&lt;del&gt;BOOKKEEPER-623&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12588840/BOOKKEEPER-623.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-623.patch&lt;/a&gt; downloaded at Thu Jun 20 13:01:21 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 1 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 849&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/380/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/380/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13693567" author="hustlmsp" created="Wed, 26 Jun 2013 02:27:33 +0100"  >&lt;p&gt;+1 for the patch.&lt;/p&gt;

&lt;p&gt;committed as r1496705. thanks Vinay.&lt;/p&gt;</comment>
                            <comment id="13693578" author="hustlmsp" created="Wed, 26 Jun 2013 02:46:13 +0100"  >&lt;p&gt;committed as r1496708 in branch 4.2.&lt;/p&gt;</comment>
                            <comment id="13693579" author="hudson" created="Wed, 26 Jun 2013 02:55:47 +0100"  >&lt;p&gt;Integrated in bookkeeper-trunk #258 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/258/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/258/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-623&quot; title=&quot;LedgerChecker should avoid segments of closed ledger with higher start entryId than closed entry.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-623&quot;&gt;&lt;del&gt;BOOKKEEPER-623&lt;/del&gt;&lt;/a&gt;: LedgerChecker should avoid segments of closed ledger with higher start entryId than closed entry. (vinay via sijie) (Revision 1496705)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
sijie : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerChecker.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/client/LedgerCloseTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12588840" name="BOOKKEEPER-623.patch" size="4299" author="vinayrpet" created="Thu, 20 Jun 2013 13:56:25 +0100"/>
                            <attachment id="12588815" name="BOOKKEEPER-623.patch" size="4309" author="vinayrpet" created="Thu, 20 Jun 2013 11:22:25 +0100"/>
                            <attachment id="12588585" name="BOOKKEEPER-623.patch" size="4315" author="vinayrpet" created="Wed, 19 Jun 2013 13:31:31 +0100"/>
                            <attachment id="12588571" name="BOOKKEEPER-623.patch" size="4337" author="vinayrpet" created="Wed, 19 Jun 2013 12:03:03 +0100"/>
                            <attachment id="12587385" name="BOOKKEEPER-623.patch" size="5213" author="vinayrpet" created="Wed, 12 Jun 2013 07:39:01 +0100"/>
                            <attachment id="12587370" name="BOOKKEEPER-623.patch" size="4020" author="vinayrpet" created="Wed, 12 Jun 2013 06:12:34 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 12 Jun 2013 05:34:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>332643</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzf86v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>332972</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>