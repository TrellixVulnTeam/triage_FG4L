<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:27:32 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-140/BOOKKEEPER-140.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-140] Hub server doesn&apos;t subscribe remote region correctly when a region is down.</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-140</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;Hub server doesn&apos;t subscribe remote region correctly in following cases: (assume there is 3 regions, A, B, C)&lt;/p&gt;

&lt;p&gt;1. region shuts down before first subscribe.&lt;/p&gt;

&lt;p&gt;1) region C is down.&lt;br/&gt;
2) subscribe-a subscribe a topic in region A. a subscription state is created in region A&apos;s zookeeper. but remote subscribe to region C would fail since region C is down. hub server will respond client that subscribe failed without deleting subscription state. The following subscriptions using same subscribe id and same topic would failed due to NodeExists.&lt;/p&gt;

&lt;p&gt;2. region shuts down when attaches existing subscriptions.&lt;/p&gt;

&lt;p&gt;1) In region A, there is a local subscriber a for topic T. in region B, subscriber b for topic T. in region B, subscribe c for topic T.&lt;br/&gt;
2) servers are all restarted in all three regions. But region C is network-partitioned (or shuts down) from region A and region B.&lt;br/&gt;
3) subscriber b and subscribe c try to subscribe T again. hub servers in region B, C will try to remote subscribe region A, but should failed. There is no mechanism to retry remote subscribe. so if messages are published to topic T in region A, subscribe b and subscribe c would receive any message.  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12534015">BOOKKEEPER-140</key>
            <summary>Hub server doesn&apos;t subscribe remote region correctly when a region is down.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hustlmsp">Sijie Guo</assignee>
                                    <reporter username="hustlmsp">Sijie Guo</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Dec 2011 11:31:09 +0000</created>
                <updated>Mon, 22 Oct 2012 15:50:15 +0100</updated>
                            <resolved>Wed, 21 Dec 2011 16:43:39 +0000</resolved>
                                    <version>4.0.0</version>
                                    <fixVersion>4.1.0</fixVersion>
                                    <component>hedwig-server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13163535" author="hustlmsp" created="Tue, 6 Dec 2011 11:42:20 +0000"  >&lt;p&gt;attach a patch to fix this issue.&lt;/p&gt;</comment>
                            <comment id="13164161" author="hustlmsp" created="Wed, 7 Dec 2011 05:35:49 +0000"  >&lt;p&gt;new patch generated with --no-prefix&lt;/p&gt;</comment>
                            <comment id="13170899" author="ikelly" created="Fri, 16 Dec 2011 11:07:24 +0000"  >&lt;p&gt;I don&apos;t understand the second scenario in the description, could you double check you&apos;ve labelled regions and subscribers correctly. &lt;/p&gt;

&lt;p&gt;Otherwise, I need to clarify some things about how cross region should work before properly reviewing the patch, as I don&apos;t quite understand how message ordering should work between regions. I&apos;ve send a mail to bookkeeper-dev about this.&lt;/p&gt;</comment>
                            <comment id="13172875" author="hustlmsp" created="Tue, 20 Dec 2011 03:04:07 +0000"  >&lt;p&gt;&amp;gt; the second scenario&lt;/p&gt;

&lt;p&gt;As Utkarsh commented in the email,&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If it&apos;s not the first local subscribe, then region A won&apos;t be contacted, and&lt;br/&gt;
the subscription request will succeed even if region A is down.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;so if messages are published in region A, subscriber in region B would not receive.&lt;/p&gt;

&lt;p&gt;refine the second scenario as below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2. region shuts down when attaches existing subscriptions.

1) In region A, there is a local subscriber a &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; topic T. in region B, local subscriber b &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; topic T. in region B, local subscribe c &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; topic T.
2) servers are all restarted in all three regions. But region A is network-partitioned (or shuts down) from region B and region C.
3) subscriber b attach to Topic T in region B. subscriber c attach to Topic T in region C.
4) hub server owns Topic T in region B, would &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; remote subscription to region A and C. remote subscribe to region A succeed, &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; remote subscribe to region C would failed. hub server responds SUCCESS to subscriber b. subscriber c did the same thing in region C.
5) region A (restarted / network is connected again) became connected with region B and region C. messages published in region A. But subscribe b and c would never receive any messages.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13174198" author="ikelly" created="Wed, 21 Dec 2011 16:43:32 +0000"  >&lt;p&gt;+1 &lt;/p&gt;

&lt;p&gt;Looks good. Committed as r1221798.&lt;/p&gt;</comment>
                            <comment id="13174213" author="hudson" created="Wed, 21 Dec 2011 17:01:16 +0000"  >&lt;p&gt;Integrated in bookkeeper-trunk #289 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/289/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/289/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-140&quot; title=&quot;Hub server doesn&amp;#39;t subscribe remote region correctly when a region is down.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-140&quot;&gt;&lt;del&gt;BOOKKEEPER-140&lt;/del&gt;&lt;/a&gt;: Hub server doesn&apos;t subscribe remote region correctly when a region is down. (Sijie Gou via ivank)&lt;/p&gt;

&lt;p&gt;ivank : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-server/src/main/java/org/apache/hedwig/server/common/ServerConfiguration.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-server/src/main/java/org/apache/hedwig/server/regions/RegionManager.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-server/src/main/java/org/apache/hedwig/server/subscriptions/AbstractSubscriptionManager.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-server/src/test/java/org/apache/hedwig/server/HedwigRegionTestBase.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-server/src/test/java/org/apache/hedwig/server/integration/TestHedwigRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12506395" name="BOOKKEEPER-140.patch" size="39875" author="hustlmsp" created="Wed, 7 Dec 2011 05:35:49 +0000"/>
                            <attachment id="12506245" name="BOOKKEEPER-140.patch" size="39915" author="hustlmsp" created="Tue, 6 Dec 2011 11:42:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 16 Dec 2011 11:07:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>219741</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy4s5b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>61716</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>