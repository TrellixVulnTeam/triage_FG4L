<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:26:58 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-330/BOOKKEEPER-330.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-330] System.currentTimeMillis usage in Hedwig</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-330</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;Need same changes in hedwig server as what did in bookkeeper as &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-327&quot; title=&quot;System.currentTimeMillis usage in BookKeeper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-327&quot;&gt;&lt;del&gt;BOOKKEEPER-327&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12597985">BOOKKEEPER-330</key>
            <summary>System.currentTimeMillis usage in Hedwig</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="umamaheswararao">Uma Maheswara Rao G</assignee>
                                    <reporter username="hustlmsp">Sijie Guo</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Jul 2012 07:45:05 +0100</created>
                <updated>Wed, 13 Feb 2013 15:46:42 +0000</updated>
                            <resolved>Thu, 26 Jul 2012 04:23:25 +0100</resolved>
                                    <version>4.0.0</version>
                    <version>4.1.0</version>
                                    <fixVersion>4.2.0</fixVersion>
                                    <component>hedwig-server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13409224" author="umamaheswararao" created="Mon, 9 Jul 2012 07:50:20 +0100"  >&lt;p&gt;I am not familiar in hedwig code, I will try to change in hedwig part also as the changes are straightforward.&lt;br/&gt;
Sijie, is there for review &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="13417666" author="umamaheswararao" created="Wed, 18 Jul 2012 21:50:37 +0100"  >&lt;p&gt;Updated a simple patch reflecting to BK-327.&lt;/p&gt;</comment>
                            <comment id="13417686" author="mridulm80" created="Wed, 18 Jul 2012 22:13:38 +0100"  >&lt;p&gt;I should have raised the note in &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-327&quot; title=&quot;System.currentTimeMillis usage in BookKeeper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-327&quot;&gt;&lt;del&gt;BOOKKEEPER-327&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
In multi-core (and/or) multi-processor machines (particularly which are running for long) this method is practically useless for fine measurement.&lt;br/&gt;
The precision (&apos;fine&apos;) depends on a variety of factors I guess.&lt;/p&gt;

&lt;p&gt;System.currentTimeMillis() is at lower resolution (and with time jumps, via ntp updates, clock skew, etc) - but the measured difference would be what the system &apos;thought&apos; the time difference was : should average out to the same (unless the nodes clock is chronically loosing time).&lt;/p&gt;</comment>
                            <comment id="13422015" author="umamaheswararao" created="Wed, 25 Jul 2012 06:31:16 +0100"  >&lt;p&gt;Yes, I have seen that backward times in multicore machines in both the cases (CurrentTimeMillis and nanoTime). Also added the same comment in BK-327 as well.&lt;br/&gt;
I think we should not completely depend on this system times for sensitive opretaions like array access ..etc. This patch adds the check for negative on latency because there will be chance for backward times in all the cases. counter based time calculation would be better than currentTimeMillis. But I am not sure the change you are proposing here will be really required. &lt;br/&gt;
You mean, we will calculate all the time diffs with currentMillis, nanoTime and average out the elapsed time? That may messup the things I feel. Because always there may inaccuracy in times due to the mismatches in currentMillis and nanoTime right. Please correct me, If I understand your point wrongly.&lt;/p&gt;</comment>
                            <comment id="13422062" author="mridulm80" created="Wed, 25 Jul 2012 08:36:41 +0100"  >&lt;p&gt;No, my point was changing from one api to another in the assumption that the bug will be resolved is misplaced - the same issues will recur (in a more unpredictable manner) with nanotime too ...&lt;/p&gt;</comment>
                            <comment id="13422068" author="umamaheswararao" created="Wed, 25 Jul 2012 08:46:13 +0100"  >&lt;p&gt;Thanks a lot, Mridul for taking a look. &lt;br/&gt;
Yep. we did not assume that switching to nanoTime will completely resolve the issue. That is the reason why we added nagative check for latency in the patch where we have faced the problem. Going like better than other one.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (latency &amp;lt; 0) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13422852" author="hustlmsp" created="Thu, 26 Jul 2012 03:40:57 +0100"  >&lt;p&gt;the patch looks good to me. +1 &lt;/p&gt;
</comment>
                            <comment id="13422870" author="hustlmsp" created="Thu, 26 Jul 2012 04:23:25 +0100"  >&lt;p&gt;committed as r1365873. thanks Uma.&lt;/p&gt;</comment>
                            <comment id="13422875" author="hustlmsp" created="Thu, 26 Jul 2012 04:47:11 +0100"  >&lt;p&gt;committed as r1365875 in 4.1 branch.&lt;/p&gt;</comment>
                            <comment id="13423030" author="hudson" created="Thu, 26 Jul 2012 13:36:09 +0100"  >&lt;p&gt;Integrated in bookkeeper-trunk #620 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/620/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/620/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-330&quot; title=&quot;System.currentTimeMillis usage in Hedwig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-330&quot;&gt;&lt;del&gt;BOOKKEEPER-330&lt;/del&gt;&lt;/a&gt;: System.currentTimeMillis usage in Hedwig (uma via sijie) (Revision 1365873)&lt;/p&gt;

&lt;p&gt;     Result = UNSTABLE&lt;br/&gt;
sijie : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/java/org/apache/hedwig/client/benchmark/BenchmarkPublisher.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/java/org/apache/hedwig/client/benchmark/BenchmarkSubscriber.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/java/org/apache/hedwig/client/benchmark/BenchmarkUtils.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/java/org/apache/hedwig/client/netty/HedwigClientImpl.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/java/org/apache/hedwig/client/netty/HedwigPublisher.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/java/org/apache/hedwig/client/netty/HedwigSubscriber.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-server/src/main/java/org/apache/hedwig/admin/console/HedwigConsole.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-server/src/main/java/org/apache/hedwig/server/benchmark/AbstractBenchmark.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-server/src/main/java/org/apache/hedwig/server/benchmark/BookieBenchmark.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-server/src/main/java/org/apache/hedwig/server/benchmark/BookkeeperBenchmark.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-server/src/main/java/org/apache/hedwig/server/delivery/FIFODeliveryManager.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-server/src/main/java/org/apache/hedwig/server/handlers/PublishHandler.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-server/src/main/java/org/apache/hedwig/server/handlers/SubscribeHandler.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-server/src/main/java/org/apache/hedwig/server/handlers/UnsubscribeHandler.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-server/src/main/java/org/apache/hedwig/server/netty/ServerStats.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-server/src/main/java/org/apache/hedwig/server/persistence/ReadAheadCache.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-server/src/test/java/org/apache/hedwig/server/netty/TestServerStats.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12597624">BOOKKEEPER-327</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12537066" name="BOOKKEEPER-330.patch" size="23455" author="umamaheswararao" created="Wed, 18 Jul 2012 21:49:51 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 9 Jul 2012 06:50:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>293530</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyn60f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>169161</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>