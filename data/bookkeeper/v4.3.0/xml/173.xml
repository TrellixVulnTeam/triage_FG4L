<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:28:55 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-173/BOOKKEEPER-173.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-173] Uncontrolled number of threads in bookkeeper</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-173</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;I am not sure if it is a but or not.&lt;/p&gt;

&lt;p&gt;Say, I do have pc with 256 cores, and there is following code in bookkeeper:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;BookKeeper.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
OrderedSafeExecutor callbackWorker = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OrderedSafeExecutor(&lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt;.getRuntime().availableProcessors());
OrderedSafeExecutor mainWorkerPool = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OrderedSafeExecutor(&lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt; .getRuntime().availableProcessors());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As I understand, callbackWorker is not used at all, so it could be removed.&lt;br/&gt;
Also could be required to get more control over mainWorkerPool (say, extract interface + pass instance through contructor).&lt;/p&gt;

&lt;p&gt;Myabe there are other places in library where some thread pools are created without ability to reuse existing thread pools in application.&lt;/p&gt;





</description>
                <environment></environment>
        <key id="12542830">BOOKKEEPER-173</key>
            <summary>Uncontrolled number of threads in bookkeeper</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hustlmsp">Sijie Guo</assignee>
                                    <reporter username="philipp.sushkin">Philipp Sushkin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Feb 2012 06:58:09 +0000</created>
                <updated>Mon, 22 Oct 2012 15:50:18 +0100</updated>
                            <resolved>Fri, 20 Apr 2012 18:19:27 +0100</resolved>
                                                    <fixVersion>4.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13212067" author="fpj" created="Mon, 20 Feb 2012 20:56:31 +0000"  >&lt;p&gt;I agree, callbackWorker is not used any longer and we may want to have a constructor that allows the application to pass a different OrderedSafeExecutor.&lt;/p&gt;</comment>
                            <comment id="13214517" author="ikelly" created="Thu, 23 Feb 2012 10:02:38 +0000"  >&lt;p&gt;This should be simple to fix using by adding an config option to ServerConfiguration. The default can be Runetime.getRuntime().availableProcessors() which seems fine on commodity hardware, and then for highend stuff, the admin could configure fewer threads. Philipp, could you have a go at generating a patch that does this?&lt;/p&gt;</comment>
                            <comment id="13214520" author="fpj" created="Thu, 23 Feb 2012 10:06:20 +0000"  >&lt;p&gt;+1 on the idea of having a configuration option.&lt;/p&gt;</comment>
                            <comment id="13252600" author="hustlmsp" created="Thu, 12 Apr 2012 18:11:49 +0100"  >&lt;p&gt;attach a patch to expose number of worker threads as a configuration setting. as I need to use this setting when adding test case for &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-215&quot; title=&quot;Deadlock occurs under high load&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-215&quot;&gt;&lt;del&gt;BOOKKEEPER-215&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13254692" author="ikelly" created="Mon, 16 Apr 2012 14:50:36 +0100"  >&lt;p&gt;callbackWorker is never used and should be removed. Otherwise the patch is good.&lt;/p&gt;</comment>
                            <comment id="13254717" author="hustlmsp" created="Mon, 16 Apr 2012 15:24:43 +0100"  >&lt;p&gt;actually in &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-215&quot; title=&quot;Deadlock occurs under high load&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-215&quot;&gt;&lt;del&gt;BOOKKEEPER-215&lt;/del&gt;&lt;/a&gt;, the patch used the callbackWorker. LedgerRecoveryOp call back to bookkeeper in bookkeeper&apos;s callback, so it would introduce deadlock with limit permits. so I use this callbackWorker to execute forward read in LedgerRecovery procedure to avoid deadlock.&lt;/p&gt;</comment>
                            <comment id="13256626" author="fpj" created="Wed, 18 Apr 2012 16:01:29 +0100"  >&lt;p&gt;I have one quick clarification and one request. If setNumWorkerThreads is called after the BookKeeper object is constructed, then it has no effect on the number of threads in the pool. Should we enforce somehow that the value doesn&apos;t change after the BookKeeper object is constructed? Otherwise the semantics could be confusing.&lt;/p&gt;

&lt;p&gt;Also, it would be good to add a description of these options to the documentation.&lt;/p&gt;</comment>
                            <comment id="13256627" author="fpj" created="Wed, 18 Apr 2012 16:01:57 +0100"  >&lt;p&gt;Cancelling patch until comments are addressed.&lt;/p&gt;</comment>
                            <comment id="13257115" author="hustlmsp" created="Thu, 19 Apr 2012 01:36:06 +0100"  >&lt;p&gt;@Flavio, &lt;/p&gt;

&lt;p&gt;&amp;gt; If setNumWorkerThreads is called after the BookKeeper object is constructed, then it has no effect on the number of threads in the pool.&lt;/p&gt;

&lt;p&gt;yes, ur right. How about clarifying it in the documentation of this method?&lt;/p&gt;

&lt;p&gt;&amp;gt; Also, it would be good to add a description of these options to the documentation.&lt;/p&gt;

&lt;p&gt;will do it in the new patch.&lt;/p&gt;</comment>
                            <comment id="13258093" author="hustlmsp" created="Fri, 20 Apr 2012 09:53:09 +0100"  >&lt;p&gt;attach a new patch to add more documents to address Flavio&apos;s comments.&lt;/p&gt;

&lt;p&gt;beside that, I also put other existing client configuration settings in doc/bookkeeperConfigParam.textile.&lt;/p&gt;</comment>
                            <comment id="13258161" author="fpj" created="Fri, 20 Apr 2012 12:51:40 +0100"  >&lt;p&gt;It looks good, Sijie. I just made some minor corrections, please check.&lt;/p&gt;

&lt;p&gt;Also, I was wondering if we have a patch for the password issue with bookie recovery that is described in the documentation. If we don&apos;t have a jira, it would be great if we could open one before resolving this issue.&lt;/p&gt;</comment>
                            <comment id="13258246" author="hustlmsp" created="Fri, 20 Apr 2012 14:43:43 +0100"  >&lt;p&gt;thanks Flavio for those corrections. it is good to me. +1.&lt;/p&gt;

&lt;p&gt;&amp;gt; Also, I was wondering if we have a patch for the password issue with bookie recovery that is described in the documentation. If we don&apos;t have a jira, it would be great if we could open one before resolving this issue.&lt;/p&gt;

&lt;p&gt;hmm, currently we don&apos;t have a jira to track that issue. I will create one.&lt;/p&gt;</comment>
                            <comment id="13258385" author="fpj" created="Fri, 20 Apr 2012 18:19:15 +0100"  >&lt;p&gt;+1 as well. Thanks, Sijie.&lt;/p&gt;</comment>
                            <comment id="13258386" author="fpj" created="Fri, 20 Apr 2012 18:19:27 +0100"  >&lt;p&gt;Committed revision 1328452.&lt;/p&gt;</comment>
                            <comment id="13258410" author="hudson" created="Fri, 20 Apr 2012 18:45:29 +0100"  >&lt;p&gt;Integrated in bookkeeper-trunk #470 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/470/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/470/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-173&quot; title=&quot;Uncontrolled number of threads in bookkeeper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-173&quot;&gt;&lt;del&gt;BOOKKEEPER-173&lt;/del&gt;&lt;/a&gt;: Uncontrolled number of threads in bookkeeper (sijie via fpj) (Revision 1328452)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
fpj : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeper.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ClientConfiguration.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/doc/bookieConfigParams.textile&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/doc/bookkeeperConfig.textile&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/doc/bookkeeperConfigParams.textile&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/doc/index.textile&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12522447" name="BK-173.patch" size="4103" author="hustlmsp" created="Thu, 12 Apr 2012 18:11:49 +0100"/>
                            <attachment id="12523466" name="BK-173.patch_v2" size="18272" author="hustlmsp" created="Fri, 20 Apr 2012 09:53:09 +0100"/>
                            <attachment id="12523487" name="BOOKKEEPER-173.v3.patch" size="18322" author="fpj" created="Fri, 20 Apr 2012 12:51:40 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 20 Feb 2012 20:56:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>228116</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy4ruf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>61667</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>