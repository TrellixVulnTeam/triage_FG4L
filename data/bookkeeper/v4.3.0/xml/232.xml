<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:27:26 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-232/BOOKKEEPER-232.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-232] AsyncBK tests failing </title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-232</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>
&lt;p&gt;Trace:&lt;br/&gt;
java.io.IOException: Unable to delete file: C:\Users\uma\AppData\Local\Temp\bookie7010257841258186070test\current\136fcc63892.txn&lt;br/&gt;
	at org.apache.commons.io.FileUtils.forceDelete(FileUtils.java:1919)&lt;br/&gt;
	at org.apache.commons.io.FileUtils.cleanDirectory(FileUtils.java:1399)&lt;br/&gt;
	at org.apache.commons.io.FileUtils.deleteDirectory(FileUtils.java:1331)&lt;br/&gt;
	at org.apache.commons.io.FileUtils.forceDelete(FileUtils.java:1910)&lt;br/&gt;
	at org.apache.commons.io.FileUtils.cleanDirectory(FileUtils.java:1399)&lt;br/&gt;
	at org.apache.commons.io.FileUtils.deleteDirectory(FileUtils.java:1331)&lt;br/&gt;
	at org.apache.bookkeeper.test.BookKeeperClusterTestCase.stopBKCluster(BookKeeperClusterTestCase.java:150)&lt;br/&gt;
	at org.apache.bookkeeper.test.BookKeeperClusterTestCase.tearDown(BookKeeperClusterTestCase.java:94)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Unknown Source)&lt;br/&gt;
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)&lt;br/&gt;
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)&lt;br/&gt;
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Windows&lt;/p&gt;</environment>
        <key id="12553269">BOOKKEEPER-232</key>
            <summary>AsyncBK tests failing </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="umamaheswararao">Uma Maheswara Rao G</assignee>
                                    <reporter username="umamaheswararao">Uma Maheswara Rao G</reporter>
                        <labels>
                    </labels>
                <created>Sun, 29 Apr 2012 07:26:22 +0100</created>
                <updated>Mon, 22 Oct 2012 15:50:14 +0100</updated>
                            <resolved>Mon, 7 May 2012 17:48:37 +0100</resolved>
                                    <version>4.1.0</version>
                                    <fixVersion>4.1.0</fixVersion>
                                    <component>bookkeeper-server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13264474" author="umamaheswararao" created="Sun, 29 Apr 2012 07:29:24 +0100"  >&lt;p&gt;I just analysed the cause for this failures.&lt;br/&gt;
After stopping bk, we are not closing the EntryLogger and LedgerCache. Seems like ledger cache and entryLogger holding the locks on that files (*.txn, *.idx files).&lt;br/&gt;
If we clear the cache and entrylogger can help in this tests to pass.&lt;/p&gt;</comment>
                            <comment id="13264505" author="umamaheswararao" created="Sun, 29 Apr 2012 12:17:34 +0100"  >&lt;p&gt;Attached the patch. with this fix, all async tests passing.&lt;/p&gt;</comment>
                            <comment id="13264519" author="umamaheswararao" created="Sun, 29 Apr 2012 13:32:12 +0100"  >&lt;blockquote&gt;
&lt;p&gt;2012-04-29 17:01:11,382 - INFO  - &lt;span class=&quot;error&quot;&gt;&amp;#91;main:FinalRequestProcessor@423&amp;#93;&lt;/span&gt; - shutdown of&lt;br/&gt;
 request processor complete&lt;br/&gt;
2012-04-29 17:01:11,383 - INFO  - &lt;span class=&quot;error&quot;&gt;&amp;#91;main:ClientBase@227&amp;#93;&lt;/span&gt; - connecting to localhos&lt;br/&gt;
t 2181&lt;br/&gt;
Tests run: 14, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 50.091 sec&lt;/p&gt;

&lt;p&gt;Results :&lt;/p&gt;

&lt;p&gt;Tests run: 14, Failures: 0, Errors: 0, Skipped: 0&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; BUILD SUCCESS&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Total time: 55.195s&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Finished at: Sun Apr 29 17:01:12 IST 2012&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Final Memory: 7M/17M&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;/p&gt;
&lt;/blockquote&gt;</comment>
                            <comment id="13264675" author="umamaheswararao" created="Mon, 30 Apr 2012 05:48:37 +0100"  >&lt;p&gt;Closing streams in finally would have a bad properties. It will mask the root exceptions. Let me try to bring IOUtils clean up with null checks and close the streams in side try itself and retry on finally with IOUtils. for example: &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-2330&quot; title=&quot;In NNStorage.java, IOExceptions of stream closures  can mask root exceptions.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-2330&quot;&gt;&lt;del&gt;HDFS-2330&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13264678" author="rakeshr" created="Mon, 30 Apr 2012 05:50:07 +0100"  >&lt;p&gt;I feel, before closing the streams, it would be good to have null checks to avoid unwanted exceptions.&lt;/p&gt;</comment>
                            <comment id="13264679" author="umamaheswararao" created="Mon, 30 Apr 2012 05:51:15 +0100"  >&lt;p&gt;Yep, Rakesh, I will bring IOUtils cleanup methods here. That would handle this checks.&lt;/p&gt;</comment>
                            <comment id="13265623" author="umamaheswararao" created="Tue, 1 May 2012 04:54:31 +0100"  >&lt;p&gt;Attached the patch with IOUtils.close api.&lt;/p&gt;</comment>
                            <comment id="13269447" author="umamaheswararao" created="Mon, 7 May 2012 09:14:12 +0100"  >&lt;p&gt;@Flavio, Do you have time to review it?. So, that our tests will pass in windows ( our dev env).&lt;/p&gt;</comment>
                            <comment id="13269486" author="fpj" created="Mon, 7 May 2012 11:12:26 +0100"  >&lt;p&gt;Looking into it...&lt;/p&gt;</comment>
                            <comment id="13269504" author="fpj" created="Mon, 7 May 2012 11:33:29 +0100"  >&lt;p&gt;It doesn&apos;t compile for me, it looks like import org.apache.bookkeeper.util.IOUtils is missing. The patch also contains tabs. Just in case you haven&apos;t seen it yet, please have a look at the format we have been using here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/ZOOKEEPER/HowToContribute&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://cwiki.apache.org/confluence/display/ZOOKEEPER/HowToContribute&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="13269515" author="umamaheswararao" created="Mon, 7 May 2012 11:57:04 +0100"  >&lt;p&gt;Yes, Flavio, I forgot to include IOUtils class in the patch...my bad. I just ran the tests in my env. Did not re apply the patch and check. Let me re-generate the patch. Also will correct formatting issues. Thanks for taking a look.&lt;/p&gt;</comment>
                            <comment id="13269601" author="ikelly" created="Mon, 7 May 2012 14:26:30 +0100"  >&lt;p&gt;Another issue with the patch is that it leaks internal implementation detail of LedgerCache. Basically, LedgerCache should not be called that. It should be called LedgerIndex as all methods on the interface have to do with indexing. In fact, ill open a JIRA to rename it after this comment. The problem is that clearCache tells the user of the API that it maybe a cache there. I think it would be much better to simply call this method &quot;close()&quot; and implement the Closeable interface. This way the interface is kept a lot cleaner.&lt;/p&gt;
</comment>
                            <comment id="13269663" author="umamaheswararao" created="Mon, 7 May 2012 15:41:08 +0100"  >&lt;p&gt;Hi Ivan, Nice point about LedgerCache naming. I will leave it for other JIRA to rename it as you mentioned.( if it is ok for you, you can directly assign that issue to me, i will upload patch). As discussed, now LedgerCache extends Closeable and just implemented close method. Also formatted correctly as per BK guidelines.&lt;/p&gt;

&lt;p&gt;If you have time, please take a look.&lt;/p&gt;</comment>
                            <comment id="13269741" author="fpj" created="Mon, 7 May 2012 17:15:26 +0100"  >&lt;p&gt;+1, looks good. Ivan?&lt;/p&gt;</comment>
                            <comment id="13269744" author="ikelly" created="Mon, 7 May 2012 17:20:10 +0100"  >&lt;p&gt;lgtm +1. Don&apos;t worry about the rename of LedgerCache yet. It needs to be done when the patch queue is small because otherwise it&apos;ll probably hit a conflict. We should do before 4.1 though.&lt;/p&gt;</comment>
                            <comment id="13269765" author="ikelly" created="Mon, 7 May 2012 17:48:37 +0100"  >&lt;p&gt;Submitted to r1335117. Thanks Uma&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12525854" name="BOOKKEEPER-232.patch" size="8504" author="umamaheswararao" created="Mon, 7 May 2012 15:33:24 +0100"/>
                            <attachment id="12525152" name="BOOKKEEPER-232.patch" size="5776" author="umamaheswararao" created="Tue, 1 May 2012 04:54:31 +0100"/>
                            <attachment id="12525015" name="BOOKKEEPER-232.patch" size="4202" author="umamaheswararao" created="Sun, 29 Apr 2012 12:16:27 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 30 Apr 2012 04:50:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>237380</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy4s9z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>61737</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>