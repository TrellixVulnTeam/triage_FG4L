<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:25:47 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-717/BOOKKEEPER-717.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-717] journal should look forward to group time-out entries</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-717</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;journal should look a bit forward to group timeout entries, which avoid too much fsyncs with single entry impacting journal performance. so bookie could have sustained high throughput with low-latency.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12686826">BOOKKEEPER-717</key>
            <summary>journal should look forward to group time-out entries</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12659256">BOOKKEEPER-656</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hustlmsp">Sijie Guo</assignee>
                                    <reporter username="hustlmsp">Sijie Guo</reporter>
                        <labels>
                    </labels>
                <created>Tue, 31 Dec 2013 08:05:05 +0000</created>
                <updated>Fri, 7 Mar 2014 12:35:55 +0000</updated>
                            <resolved>Fri, 7 Mar 2014 12:16:13 +0000</resolved>
                                                    <fixVersion>4.3.0</fixVersion>
                                    <component>bookkeeper-server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13888849" author="hustlmsp" created="Sun, 2 Feb 2014 06:45:49 +0000"  >&lt;p&gt;attach a patch to forward group timeout entries, which would reduce number for force writes. since it is a performance change, there is no separated test case for it.&lt;/p&gt;</comment>
                            <comment id="13888861" author="hadoopqa" created="Sun, 2 Feb 2014 07:56:03 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-717&quot; title=&quot;journal should look forward to group time-out entries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-717&quot;&gt;&lt;del&gt;BOOKKEEPER-717&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12626513/BOOKKEEPER-717.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-717.diff&lt;/a&gt; downloaded at Sun Feb  2 07:28:12 UTC 2014&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch does not add/modify any testcase&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch seems to introduce 1 new RAT warning(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 893&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/572/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/572/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13890998" author="ikelly" created="Tue, 4 Feb 2014 18:50:17 +0000"  >&lt;p&gt;I can&apos;t quite figure out the logic of the group timeout stuff&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (maxGroupWaitInMSec &amp;gt; 0 &amp;amp;&amp;amp; !groupWhenTimeout &amp;amp;&amp;amp; (MathUtils.elapsedMSec(toFlush.getFirst().enqueueTime) &amp;gt; maxGroupWaitInMSec)) {
    groupWhenTimeout = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (maxGroupWaitInMSec &amp;gt; 0 &amp;amp;&amp;amp; groupWhenTimeout &amp;amp;&amp;amp; qe != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; MathUtils.elapsedMSec(qe.enqueueTime) &amp;lt; maxGroupWaitInMSec) {
    groupWhenTimeout = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    shouldFlush = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
} ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If, in the first clause, the time since enqueue for the first entry is greater than maxGroupWaitInMSec, then surely shouldFlush should be set to true? Similarly shouldn&apos;t you defer the flush if you get to the next clause &lt;b&gt;and&lt;/b&gt; the enqueueTime of the first in the queue is less than the maxGroupWaitInMSec?&lt;/p&gt;</comment>
                            <comment id="13891014" author="hustlmsp" created="Tue, 4 Feb 2014 18:57:41 +0000"  >&lt;p&gt;the first clause is the first time that we find an already timeout entry in the queue. at this point, we set groupWhenTimeout to true. then it would start looking forward to see if there any other items in the queue&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if there is no items in the queue, flush current batch.&lt;/li&gt;
	&lt;li&gt;if there are still items, then add them into the batch until 1) we find a non time out entry (the second clause) or 2) we reached the batch size.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13891031" author="hustlmsp" created="Tue, 4 Feb 2014 19:02:42 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
If, in the first clause, the time since enqueue &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the first entry is greater than maxGroupWaitInMSec, then surely shouldFlush should be set to &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;?
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;No, the change here is to avoid this. for example, in the queue, you have 100 entries, a disk hiccup cause all 100 entries to be time out. if you set shouldFlush to be true, then you will have 100 individual sync requests, which each only sync one entry. that&apos;s bad for performance. the change is to group all these 100 entries into one batch and sync them together.&lt;/p&gt;</comment>
                            <comment id="13923830" author="ikelly" created="Fri, 7 Mar 2014 12:15:59 +0000"  >&lt;p&gt;Makes sense now, after staring at it for an hour &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. We need to take the whole loop, and multiple iterations of it into account to figure out what it&apos;s doing. We should try to simplify this loop later to make it simpler to understand. Can&apos;t think of any clear way now though. Committing changes.&lt;/p&gt;</comment>
                            <comment id="13923831" author="ikelly" created="Fri, 7 Mar 2014 12:16:13 +0000"  >&lt;p&gt;Committed r1575243&lt;/p&gt;</comment>
                            <comment id="13923845" author="hudson" created="Fri, 7 Mar 2014 12:35:55 +0000"  >&lt;p&gt;FAILURE: Integrated in bookkeeper-trunk #573 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/573/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/573/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-717&quot; title=&quot;journal should look forward to group time-out entries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-717&quot;&gt;&lt;del&gt;BOOKKEEPER-717&lt;/del&gt;&lt;/a&gt;: journal should look forward to group time-out entries (sijie via ivank) (ivank: rev 1575243)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Journal.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LogMark.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12626513" name="BOOKKEEPER-717.diff" size="14992" author="hustlmsp" created="Sun, 2 Feb 2014 06:45:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 2 Feb 2014 07:56:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365819</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzkwo7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>366126</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>