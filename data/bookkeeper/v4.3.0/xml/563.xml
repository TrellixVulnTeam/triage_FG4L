<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:30:05 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-563/BOOKKEEPER-563.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-563] Avoid Journal polluting page cache</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-563</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;writing data into journal which force the data in os buffer cache being used for hot reads, which could have negative affect on performance.&lt;/p&gt;

&lt;p&gt;similar solution is as &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1470&quot; title=&quot;Avoid polluting page cache during compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1470&quot;&gt;&lt;del&gt;CASSANDRA-1470&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12631558">BOOKKEEPER-563</key>
            <summary>Avoid Journal polluting page cache</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="robindhamankar">Robin Dhamankar</assignee>
                                    <reporter username="hustlmsp">Sijie Guo</reporter>
                        <labels>
                    </labels>
                <created>Sat, 9 Feb 2013 04:44:17 +0000</created>
                <updated>Sat, 20 Jul 2013 19:00:31 +0100</updated>
                            <resolved>Sat, 20 Jul 2013 19:00:31 +0100</resolved>
                                                    <fixVersion>4.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13575322" author="robindhamankar" created="Sun, 10 Feb 2013 02:53:05 +0000"  >&lt;p&gt;I have a fix for this. Will submit the patch for review&lt;/p&gt;</comment>
                            <comment id="13649174" author="fpj" created="Sat, 4 May 2013 21:58:41 +0100"  >&lt;p&gt;Robin, Any progress here?&lt;/p&gt;</comment>
                            <comment id="13649189" author="robindhamankar" created="Sat, 4 May 2013 23:14:41 +0100"  >&lt;p&gt;We have fixed this in the twitter fork. You can review the fix at &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/twitter/bookkeeper/commit/a48472911b176d75905399e7c32bb782f3564b83&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/twitter/bookkeeper/commit/a48472911b176d75905399e7c32bb782f3564b83&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If you are fine with the change, I will submit this as a patch.&lt;/p&gt;</comment>
                            <comment id="13654468" author="ikelly" created="Fri, 10 May 2013 14:46:52 +0100"  >&lt;p&gt;I like the change. I&apos;ve made a few small comments on gh, but otherwise i think it&apos;s good to go.&lt;/p&gt;</comment>
                            <comment id="13654537" author="robindhamankar" created="Fri, 10 May 2013 16:10:01 +0100"  >&lt;p&gt;Thanks. I responded to the comments on GH. I can prepare a patch if you agree with the responses&lt;/p&gt;</comment>
                            <comment id="13656924" author="ikelly" created="Tue, 14 May 2013 10:27:01 +0100"  >&lt;p&gt;comments on GH look good.&lt;/p&gt;</comment>
                            <comment id="13664080" author="robindhamankar" created="Wed, 22 May 2013 14:09:06 +0100"  >&lt;p&gt;Great. I will submit a patch this week.&lt;/p&gt;</comment>
                            <comment id="13678028" author="robindhamankar" created="Fri, 7 Jun 2013 14:29:28 +0100"  >&lt;p&gt;Added the patch based as discussed&lt;/p&gt;</comment>
                            <comment id="13679513" author="ikelly" created="Mon, 10 Jun 2013 14:54:14 +0100"  >&lt;p&gt;The patch is backwards(removes the feature rather than adds it), so it needs to be generated again. I also have 3 small comments.&lt;br/&gt;
1) There&apos;s a getJournalRemovePagesFromCache() in server config but no set. We should have a set to be consistent (also have it return a ServerConfiguration object to allow chaining)&lt;br/&gt;
2) Is System.getProperty(&quot;os.name&quot;).toLowerCase().contains(&quot;linux&quot;) necessary? posix_fadvise is posix, so any system that has it should be compatible, any that doesn&apos;t should throw a link error.&lt;br/&gt;
3) catch should be on the same line as the previous }.&lt;/p&gt;</comment>
                            <comment id="13679517" author="ikelly" created="Mon, 10 Jun 2013 14:58:31 +0100"  >&lt;p&gt;Also, you could use sun.misc.SharedSecrets.getJavaIOFileDescriptorAccess rather than custom code.&lt;/p&gt;</comment>
                            <comment id="13688776" author="hustlmsp" created="Thu, 20 Jun 2013 02:48:36 +0100"  >&lt;p&gt;simply reverse the diff file using patchutils : &lt;/p&gt;

&lt;p&gt;interdiff &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-563&quot; title=&quot;Avoid Journal polluting page cache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-563&quot;&gt;&lt;del&gt;BOOKKEEPER-563&lt;/del&gt;&lt;/a&gt;.diff /dev/null &amp;gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-563&quot; title=&quot;Avoid Journal polluting page cache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-563&quot;&gt;&lt;del&gt;BOOKKEEPER-563&lt;/del&gt;&lt;/a&gt;.reverse.diff&lt;/p&gt;

&lt;p&gt;&amp;gt; &quot;os.name&quot; checking.&lt;/p&gt;

&lt;p&gt;I think the OS check here is necessary. I am assuming someone would run it in windows platform.&lt;/p&gt;
</comment>
                            <comment id="13690459" author="ikelly" created="Fri, 21 Jun 2013 17:39:39 +0100"  >&lt;p&gt;patch -R also handles it. &lt;/p&gt;

&lt;p&gt;My primary concern was the os check. That said, its not vital to change it now. Worst case scenario is that the feature is not enabled.&lt;/p&gt;

&lt;p&gt;+1 for the patch in any case. &lt;/p&gt;</comment>
                            <comment id="13693540" author="hustlmsp" created="Wed, 26 Jun 2013 01:50:31 +0100"  >&lt;blockquote&gt;
&lt;p&gt;That said, its not vital to change it now. Worst case scenario is that the feature is not enabled.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;for clarification,&lt;/p&gt;

&lt;p&gt;there are bunch of os doesn&apos;t support posix_fadvise.&lt;br/&gt;
&lt;a href=&quot;http://www.gnu.org/software/gnulib/manual/html_node/posix_005ffadvise.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.gnu.org/software/gnulib/manual/html_node/posix_005ffadvise.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;it would fail tests on mac if we don&apos;t have os checking.&lt;br/&gt;
&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/cassandra-user/201104.mbox/%3CBANLkTim6MiRX2Baa+V7vHVQ42BWD7bofCw@mail.gmail.com%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/cassandra-user/201104.mbox/%3CBANLkTim6MiRX2Baa+V7vHVQ42BWD7bofCw@mail.gmail.com%3E&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13693545" author="hustlmsp" created="Wed, 26 Jun 2013 01:56:04 +0100"  >&lt;p&gt;cleanup the format and submit the patch to jekins, so it could run pre-commit job.&lt;/p&gt;</comment>
                            <comment id="13693580" author="hadoopqa" created="Wed, 26 Jun 2013 02:56:15 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-563&quot; title=&quot;Avoid Journal polluting page cache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-563&quot;&gt;&lt;del&gt;BOOKKEEPER-563&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12589692/BOOKKEEPER-563.reverse.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-563.reverse.diff&lt;/a&gt; downloaded at Wed Jun 26 01:29:57 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch does not add/modify any testcase&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 851&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/389/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/389/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13694060" author="ikelly" created="Wed, 26 Jun 2013 17:31:18 +0100"  >&lt;blockquote&gt;
&lt;p&gt;there are bunch of os doesn&apos;t support posix_fadvise.&lt;br/&gt;
&lt;a href=&quot;http://www.gnu.org/software/gnulib/manual/html_node/posix_005ffadvise.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.gnu.org/software/gnulib/manual/html_node/posix_005ffadvise.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;it would fail tests on mac if we don&apos;t have os checking.&lt;br/&gt;
&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/cassandra-user/201104.mbox/%3CBANLkTim6MiRX2Baa+V7vHVQ42BWD7bofCw@mail.gmail.com%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/cassandra-user/201104.mbox/%3CBANLkTim6MiRX2Baa+V7vHVQ42BWD7bofCw@mail.gmail.com%3E&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Indeed. Anything not supporting &quot;_XOPEN_SOURCE &amp;gt;= 600 || _POSIX_C_SOURCE &amp;gt;= 200112L&quot; wont have it. But whether it has it or not is easy to test without having to revert to checking the OS. If you call posix_fadvise on a system that doesn&apos;t have it, you&apos;ll get&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.UnsatisfiedLinkError: Error looking up function &apos;posix_fadvise&apos;: java: undefined symbol: posix_fadvise
	at com.sun.jna.Function.&amp;lt;init&amp;gt;(Function.java:179)
	at com.sun.jna.NativeLibrary.getFunction(NativeLibrary.java:344)
	at com.sun.jna.NativeLibrary.getFunction(NativeLibrary.java:324)
	at com.sun.jna.Native.register(Native.java:1341)
	at com.sun.jna.Native.register(Native.java:1018)
	at testjna.main(testjna.java:16)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which can be caught. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hasFadvise) {
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        posix_fadvise(sysFileDesc, offset, len, POSIX_FADV_DONTNEED);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (UnsatisfiedLinkError ule) {
        LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;posix_fadvise not found&quot;&lt;/span&gt;);
        hasFadvise = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Having said that, I don&apos;t think this is worth blocking the patch for, so +1 on the patch. We can create another JIRA to resolve this issue. Also, I think the -1 for the tests is fine in this case.&lt;/p&gt;</comment>
                            <comment id="13714490" author="hustlmsp" created="Sat, 20 Jul 2013 19:00:31 +0100"  >&lt;p&gt;commit as r1505174. thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=robindhamankar&quot; class=&quot;user-hover&quot; rel=&quot;robindhamankar&quot;&gt;Robin Dhamankar&lt;/a&gt;. thanks Ivan for reviewing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12586720" name="BOOKKEEPER-563.diff" size="15263" author="robindhamankar" created="Fri, 7 Jun 2013 14:28:49 +0100"/>
                            <attachment id="12589692" name="BOOKKEEPER-563.reverse.diff" size="15750" author="hustlmsp" created="Wed, 26 Jun 2013 01:56:04 +0100"/>
                            <attachment id="12588741" name="BOOKKEEPER-563.reverse.diff" size="13523" author="hustlmsp" created="Thu, 20 Jun 2013 02:48:36 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 10 Feb 2013 02:53:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>312054</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzbpav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>312400</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>