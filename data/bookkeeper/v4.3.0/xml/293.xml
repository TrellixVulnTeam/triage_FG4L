<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:25:57 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-293/BOOKKEEPER-293.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-293] Periodic checking of ledger replication status</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-293</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;We should periodically check all ledgers to make sure that they are fully replicated.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12560363">BOOKKEEPER-293</key>
            <summary>Periodic checking of ledger replication status</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12553925">BOOKKEEPER-237</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ikelly">Ivan Kelly</assignee>
                                    <reporter username="ikelly">Ivan Kelly</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Jun 2012 16:24:42 +0100</created>
                <updated>Thu, 2 May 2013 03:29:58 +0100</updated>
                            <resolved>Fri, 4 Jan 2013 10:36:06 +0000</resolved>
                                                    <fixVersion>4.2.0</fixVersion>
                                    <component>bookkeeper-auto-recovery</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13444919" author="umamaheswararao" created="Thu, 30 Aug 2012 13:46:11 +0100"  >&lt;p&gt;Ivan, I am not so clear on this JIRA, could you please give me some more description for better understanding of the scenario. Is this to track for which are ledgers not getting chance/not replicating for long time?&lt;/p&gt;</comment>
                            <comment id="13444995" author="ikelly" created="Thu, 30 Aug 2012 16:04:29 +0100"  >&lt;p&gt;There are failures which would not be detected by the auditor, such as if a disk on a bookie gets a little corrupted (for example one index file is corrupted etc). So it would be good to periodically check all ledgers to make sure they&apos;re readable. I&apos;m not sure who should check it yet, but that&apos;s why I created this JIRA. To discuss and implement it.&lt;/p&gt;</comment>
                            <comment id="13445014" author="umamaheswararao" created="Thu, 30 Aug 2012 16:26:49 +0100"  >&lt;p&gt;Ok. Yes, I have this requirement in my mind, how DNs scans the blocks periodically to detect the corruption of data etc.. That is why I asked for clarification of JIRA.&lt;br/&gt;
Also true that we have to decide that who should actually scan the ledgers. &lt;br/&gt;
I have seen in some comment that, you have the idea of distributed Auditor. In that case this may be easy to give this job to auditors itself to scan the local bk ledgers? How about moving this to after distributed audotor idea implemented, if you have concrete idea ready on distributed auditor?&lt;/p&gt;

&lt;p&gt;Another idea is that, Auditor should periodically take the BKs one by one and find under-Replicated ledgers for that BK alone, even though that BK not failed. As disk failures will be very rare than node failures, this period can be litle more and can track some how last scaned time per BK. After crossing that period only we will go and scan that BK ledgers. Very initial idea, need to think the scenarios.&lt;br/&gt;
DN block scanning time 21 days for each block.&lt;/p&gt;

&lt;p&gt;This particular case may not be really important for Namenode&apos;s scenario, as ledgers will be maintained only for checkpoint period. There will be very very rere case for 3 disks failures with in the checkpoint period. Node failures may be general than disk failure scenarios.&lt;/p&gt;
</comment>
                            <comment id="13445658" author="rakeshr" created="Fri, 31 Aug 2012 05:53:41 +0100"  >&lt;p&gt;We had a discussion in &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-126&quot; title=&quot;EntryLogger doesn&amp;#39;t detect when one of it&amp;#39;s logfiles is corrupt&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-126&quot;&gt;&lt;del&gt;BOOKKEEPER-126&lt;/del&gt;&lt;/a&gt; - &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-126?focusedCommentId=13242095&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13242095&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;comment&lt;/a&gt;, about the disk corruption. &lt;/p&gt;

&lt;p&gt;We were thinking of periodic scanning of ledgers by each bookies(as it will be local disk scanning and there will not be huge network calls when there are many ledgers) and will try to re-replicate himself from the peer bookie. Since we introduced the concept of dedicated auditor process to know the failures, its good idea to give responsibility of scanning to these periodically.&lt;/p&gt;

&lt;p&gt;Also, its good idea to have sub auditors to distribute the load of scanning.&lt;/p&gt;</comment>
                            <comment id="13473838" author="umamaheswararao" created="Thu, 11 Oct 2012 05:50:41 +0100"  >&lt;p&gt;This is one pending task for this feature to move. Let&apos;s start discussion more on this to move towards closer.&lt;br/&gt;
Thanks Vinay, for your interest to work on this, in your free time.&lt;br/&gt;
I will also think some options to night and post if get any good thoughts by then. &lt;/p&gt;</comment>
                            <comment id="13527565" author="ikelly" created="Sun, 9 Dec 2012 18:33:21 +0000"  >&lt;p&gt;Patch depends on &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-496&quot; title=&quot;Ensure that the auditor and replication worker will shutdown if they lose their ZK session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-496&quot;&gt;&lt;del&gt;BOOKKEEPER-496&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Also includes a few other fixes necessary for this feature,&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;EntryLogger does an extra sanity check on entry lengths it reads from its log&lt;/li&gt;
	&lt;li&gt;Replication daemons take a ServerConfiguration, rather than an abstract configuration.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13527724" author="umamaheswararao" created="Mon, 10 Dec 2012 05:38:07 +0000"  >&lt;p&gt;Hi Ivan, Thanks a lot for the patch. Recent days I did not get proper time to think on it, due to our deadlines/ other works. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Some thoughts I am  having on it, But your approach is straight forward and ok for now to include in 4.2 release.&lt;/p&gt;

&lt;p&gt;Here the problem with current approch may be is, It will do remote read of all ledgers once in a day. This will consume the NW bandwidth and disturb other processes or BK perf at that time right.&lt;br/&gt;
To avoid this remote read, how about implementing something like, Auditor will be just co-ordinator for this work. When the period triggers, Auditor will just send a requests to all RWs for scanning their local BK entries. Once the scannig done, RW will send back the results to Auditor. After that Auditor will publish based on the results from RW. RW anyway can pick the ledgers underreplicated and do replication. Scanning before replication toout the actual entry missings will happen only if there were real failures seen right. So, this scanning may be acceptable. But I am worried bit about the full ledgers scaning for disk failures. This can be a future work if you think this is correct to do.&lt;/p&gt;

&lt;p&gt;Other than that, patch looks good at high level. I will do further reviews in detail and post the comments in some time today.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Uma&lt;/p&gt;</comment>
                            <comment id="13527853" author="fpj" created="Mon, 10 Dec 2012 10:16:25 +0000"  >&lt;p&gt;The discussion on &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-126&quot; title=&quot;EntryLogger doesn&amp;#39;t detect when one of it&amp;#39;s logfiles is corrupt&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-126&quot;&gt;&lt;del&gt;BOOKKEEPER-126&lt;/del&gt;&lt;/a&gt; didn&apos;t make clear if this one is a blocker or not. Not that I don&apos;t want this one in, but I haven&apos;t looked at the patch yet. If it turns out to be problematic for whatever reason, can we have 4.2.0 without it or not?&lt;/p&gt;</comment>
                            <comment id="13530680" author="umamaheswararao" created="Thu, 13 Dec 2012 05:02:53 +0000"  >&lt;p&gt;As per the readmap listed &lt;a href=&quot;https://cwiki.apache.org/BOOKKEEPER/roadmap.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;here&lt;/a&gt;, this should be a blocker. Because if you see second point &apos;&#8226;autorecovery (bookie and ledger)&apos;&lt;br/&gt;
 1) bookie autorecovery : already addressed by other subtasks here&lt;br/&gt;
 2) ledger autorecovery : one way detecting the corruptions while writing/reading is handled by &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-199&quot; title=&quot;Provide bookie readonly mode, when journal/ledgers flushing has failed with IOE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-199&quot;&gt;&lt;del&gt;BOOKKEEPER-199&lt;/del&gt;&lt;/a&gt;, but that will not do any recovery job automatically after detecting disk failures. &lt;/p&gt;

&lt;p&gt;In namenode case, anyway this JIRA will not help as the period of scanning should be much higher here and we can not scan so frequently. In namenode, ledger lifetime will be checkpoint time(1hour) only.&lt;/p&gt;

&lt;p&gt;Considering other side effects of this JIRA approach now (listed in my comment), I am ok to move this to 4.3 and discuss cleanly. What about others opinion here?&lt;/p&gt;</comment>
                            <comment id="13531546" author="fpj" created="Thu, 13 Dec 2012 21:42:49 +0000"  >&lt;p&gt;Uma, It sounds fine to have this patch in, but we need to converge then. From your comments, you seem to be ok with the patch, but also said that you&apos;d do a more thorough review. Could you either +1 or provide comments shortly, please?&lt;/p&gt;</comment>
                            <comment id="13532079" author="umamaheswararao" created="Fri, 14 Dec 2012 06:10:56 +0000"  >&lt;p&gt;Sorry for the delay in review!&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;patching file bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/
Auditor.java
Hunk #1 succeeded at 25 with fuzz 2.
Hunk #2 FAILED at 79.
Hunk #3 succeeded at 125 (offset -6 lines).
Hunk #4 FAILED at 171.
Hunk #5 succeeded at 178 (offset -8 lines).
Hunk #6 succeeded at 259 (offset -8 lines).
Hunk #7 succeeded at 393 with fuzz 2 (offset -14 lines).
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Patch does not apply cleanly for me. This is may be because of recent changes. We have to rebase it on latest trunk.&lt;/p&gt;</comment>
                            <comment id="13532239" author="ikelly" created="Fri, 14 Dec 2012 11:13:33 +0000"  >&lt;p&gt;New patch rebased on top of &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-496&quot; title=&quot;Ensure that the auditor and replication worker will shutdown if they lose their ZK session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-496&quot;&gt;&lt;del&gt;BOOKKEEPER-496&lt;/del&gt;&lt;/a&gt; changes.&lt;/p&gt;</comment>
                            <comment id="13532240" author="ikelly" created="Fri, 14 Dec 2012 11:18:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=umamahesh&quot; class=&quot;user-hover&quot; rel=&quot;umamahesh&quot;&gt;Uma Mahesh&lt;/a&gt;, the amount of traffic to bookies for these checks is minimal. For each ledger we read 2 entries on each bookie in each ensemble. In the normal case this will amount to reading 6 entries per ledger, though one issue with it could be that it would cause a evictions in the cache, but in terms of network bandwidth, it&apos;s not an issue.&lt;/p&gt;

&lt;p&gt;What is an issue, and something that we&apos;ll have to look at in 4.3.0 is that if there are a lot of ledgers, the periodic checker will end up accessing zookeeper a lot, but this is a problem for the auditor in general. We should see if we can find some way to a) reduce the load on zk and b) spread the reads on zookeeper around the cluster.&lt;/p&gt;</comment>
                            <comment id="13532304" author="hadoopqa" created="Fri, 14 Dec 2012 13:51:25 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-293&quot; title=&quot;Periodic checking of ledger replication status&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-293&quot;&gt;&lt;del&gt;BOOKKEEPER-293&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12560951/0001-BOOKKEEPER-293-Periodic-checking-of-ledger-replicati.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-BOOKKEEPER-293-Periodic-checking-of-ledger-replicati.patch&lt;/a&gt; downloaded at Fri Dec 14 13:48:51 UTC 2012&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; Patch failed to apply to head of branch&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;</comment>
                            <comment id="13532306" author="fpj" created="Fri, 14 Dec 2012 13:57:04 +0000"  >&lt;p&gt;Patch does not apply correctly, cancelling.&lt;/p&gt;</comment>
                            <comment id="13532321" author="ikelly" created="Fri, 14 Dec 2012 14:16:21 +0000"  >&lt;p&gt;Patch requires &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-496&quot; title=&quot;Ensure that the auditor and replication worker will shutdown if they lose their ZK session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-496&quot;&gt;&lt;del&gt;BOOKKEEPER-496&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13532521" author="umamaheswararao" created="Fri, 14 Dec 2012 18:24:30 +0000"  >&lt;p&gt;Thanks Ivan for the explanation! Even after applying BK-496, it failed to apply for me.&lt;br/&gt;
I am ok with your explanation here regarding scan load, as target bookies will be in distributed way. I think #b should be a simple option. Anyway we will discuss that improvement in 4.3&lt;br/&gt;
One comment from me is, how about treating AUDITOR_PERIODIC_CHECK_INTERVAL=-1 (or) 0 as disabled this feature. Because this may not really help in some cases like namenode shared storage as the ledger lifetime it self will be 1 hour in namenode case, but here scanning period will be 1 day. other than that +1 from me to push this in.&lt;/p&gt;</comment>
                            <comment id="13532542" author="ikelly" created="Fri, 14 Dec 2012 18:44:14 +0000"  >&lt;p&gt;I&apos;ve put in the check for the interval and uploaded a new patch here and on 496.&lt;/p&gt;</comment>
                            <comment id="13532940" author="hadoopqa" created="Sat, 15 Dec 2012 05:19:52 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-293&quot; title=&quot;Periodic checking of ledger replication status&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-293&quot;&gt;&lt;del&gt;BOOKKEEPER-293&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12561009/0002-BOOKKEEPER-293-Periodic-checking-of-ledger-replicati.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0002-BOOKKEEPER-293-Periodic-checking-of-ledger-replicati.patch&lt;/a&gt; downloaded at Sat Dec 15 05:17:15 UTC 2012&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; Patch failed to apply to head of branch&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;</comment>
                            <comment id="13537127" author="hadoopqa" created="Thu, 20 Dec 2012 16:23:24 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-293&quot; title=&quot;Periodic checking of ledger replication status&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-293&quot;&gt;&lt;del&gt;BOOKKEEPER-293&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12561009/0002-BOOKKEEPER-293-Periodic-checking-of-ledger-replicati.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0002-BOOKKEEPER-293-Periodic-checking-of-ledger-replicati.patch&lt;/a&gt; downloaded at Thu Dec 20 16:01:25 UTC 2012&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 4 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 507&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/161/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/161/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13537201" author="umamaheswararao" created="Thu, 20 Dec 2012 17:57:31 +0000"  >&lt;p&gt;Thanks Ivan for the patch! Below is my feedback on the patch.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;AuditorPeriodicCheckTest:&lt;br/&gt;
  did not write the buffer anywhere in test.
    &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
       ByteBuffer junk = ByteBuffer.allocate(1024*1024);
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (File f : entryLogs) {
            FileOutputStream out = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileOutputStream(f);
            out.close();
        }
    &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Worth having a log whether we enabled this service or not as we have the flag and also log with period.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Do you think we should consider Autorecovery enable/disable flag to run this service as we may stop Bookies because of maintanence, that time if this service runs then it may identify lot of ledgers as under-replicated and even though RW won&apos;t process them immediately until the service enabled, it may spend on unnecesary checkings once enabled.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Now publishSuspectedLedgers may be called concurrently right? (regular auditing and this periodic check)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13541091" author="umamaheswararao" created="Sun, 30 Dec 2012 15:15:09 +0000"  >&lt;p&gt;Cancelling the patch addressing the comments!&lt;/p&gt;</comment>
                            <comment id="13542000" author="umamaheswararao" created="Wed, 2 Jan 2013 05:07:10 +0000"  >&lt;p&gt;Hi Ivan, do you have time to work on this? If you are busy now, let me know, I will generate a patch for it. But need your opinion on comments as well &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; .&lt;/p&gt;</comment>
                            <comment id="13542074" author="ikelly" created="Wed, 2 Jan 2013 10:29:30 +0000"  >&lt;p&gt;I&apos;ll get a new patch up for this today.&lt;/p&gt;</comment>
                            <comment id="13542078" author="umamaheswararao" created="Wed, 2 Jan 2013 10:48:22 +0000"  >&lt;p&gt;That&apos;s great, Thanks Ivan!&lt;/p&gt;</comment>
                            <comment id="13542166" author="ikelly" created="Wed, 2 Jan 2013 15:10:35 +0000"  >&lt;p&gt;New patch addresses comments.&lt;/p&gt;</comment>
                            <comment id="13542167" author="ikelly" created="Wed, 2 Jan 2013 15:11:30 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Now publishSuspectedLedgers may be called concurrently right? (regular auditing and this periodic check)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;No, it all runs in a single thread executor, so if a bookie dies, it&apos;ll be checked after the periodic check has finished.&lt;/p&gt;</comment>
                            <comment id="13542186" author="hadoopqa" created="Wed, 2 Jan 2013 15:45:14 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-293&quot; title=&quot;Periodic checking of ledger replication status&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-293&quot;&gt;&lt;del&gt;BOOKKEEPER-293&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12562912/0001-BOOKKEEPER-293-Periodic-checking-of-ledger-replicati.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-BOOKKEEPER-293-Periodic-checking-of-ledger-replicati.patch&lt;/a&gt; downloaded at Wed Jan  2 15:15:34 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 4 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 760&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/183/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/183/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13543719" author="umamaheswararao" created="Fri, 4 Jan 2013 09:06:10 +0000"  >&lt;p&gt;+1 latest patch looks good to me.&lt;br/&gt;
Please remove one unused import in AuditorPeriodicCheckTest while committing.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.junit.Assert.assertEquals;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13543774" author="ikelly" created="Fri, 4 Jan 2013 10:36:06 +0000"  >&lt;p&gt;committed as r1428777. Uma, assertEquals is used 3 times in that file.&lt;/p&gt;</comment>
                            <comment id="13543806" author="umamaheswararao" created="Fri, 4 Jan 2013 11:23:28 +0000"  >&lt;p&gt;Ok. my eclipse is showing that comment.assertEquals will be available via Assert as that was extended by super class. Anyways its fine. Thanks for closing it. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Great work all. &lt;br/&gt;
Thanks a lot, Ivan, Rakesh, Flavio for your great efforts to move this feature to closure. This is the last JIRA in &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-237&quot; title=&quot;Automatic recovery of under-replicated ledgers and its entries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-237&quot;&gt;&lt;del&gt;BOOKKEEPER-237&lt;/del&gt;&lt;/a&gt; subtasks!&lt;/p&gt;</comment>
                            <comment id="13543844" author="hudson" created="Fri, 4 Jan 2013 12:33:54 +0000"  >&lt;p&gt;Integrated in bookkeeper-trunk2 #28 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk2/28/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk2/28/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-293&quot; title=&quot;Periodic checking of ledger replication status&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-293&quot;&gt;&lt;del&gt;BOOKKEEPER-293&lt;/del&gt;&lt;/a&gt;: Periodic checking of ledger replication status (ivank) (Revision 1428777)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
ivank : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/EntryLogger.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/InterleavedLedgerStorage.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerCacheImpl.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/LedgerUnderreplicationManager.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/ZkLedgerUnderreplicationManager.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/Auditor.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/AuditorElector.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/BookieAccessor.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorBookieTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorLedgerCheckerTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorPeriodicCheckTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13543893" author="hudson" created="Fri, 4 Jan 2013 13:58:20 +0000"  >&lt;p&gt;Integrated in bookkeeper-trunk2 #31 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk2/31/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk2/31/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-293&quot; title=&quot;Periodic checking of ledger replication status&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-293&quot;&gt;&lt;del&gt;BOOKKEEPER-293&lt;/del&gt;&lt;/a&gt;: Periodic checking of ledger replication status (ivank) (Revision 1428777)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
ivank : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/EntryLogger.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/InterleavedLedgerStorage.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerCacheImpl.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/LedgerUnderreplicationManager.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/ZkLedgerUnderreplicationManager.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/Auditor.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/AuditorElector.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/BookieAccessor.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorBookieTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorLedgerCheckerTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorPeriodicCheckTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13543936" author="hudson" created="Fri, 4 Jan 2013 15:08:44 +0000"  >&lt;p&gt;Integrated in bookkeeper-trunk2 #33 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk2/33/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk2/33/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-293&quot; title=&quot;Periodic checking of ledger replication status&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-293&quot;&gt;&lt;del&gt;BOOKKEEPER-293&lt;/del&gt;&lt;/a&gt;: Periodic checking of ledger replication status (ivank) (Revision 1428777)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
ivank : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/EntryLogger.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/InterleavedLedgerStorage.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerCacheImpl.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/LedgerUnderreplicationManager.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/ZkLedgerUnderreplicationManager.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/Auditor.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/AuditorElector.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/BookieAccessor.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorBookieTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorLedgerCheckerTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorPeriodicCheckTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12622930">BOOKKEEPER-496</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12533151">BOOKKEEPER-126</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12562912" name="0001-BOOKKEEPER-293-Periodic-checking-of-ledger-replicati.patch" size="38334" author="ikelly" created="Wed, 2 Jan 2013 15:10:35 +0000"/>
                            <attachment id="12560951" name="0001-BOOKKEEPER-293-Periodic-checking-of-ledger-replicati.patch" size="33253" author="ikelly" created="Fri, 14 Dec 2012 11:13:33 +0000"/>
                            <attachment id="12561009" name="0002-BOOKKEEPER-293-Periodic-checking-of-ledger-replicati.patch" size="33135" author="ikelly" created="Fri, 14 Dec 2012 18:43:19 +0000"/>
                            <attachment id="12560105" name="0002-BOOKKEEPER-293-Periodic-checking-of-ledger-replicati.patch" size="33902" author="ikelly" created="Sun, 9 Dec 2012 18:33:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 30 Aug 2012 12:46:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>247232</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy23f3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>46037</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>