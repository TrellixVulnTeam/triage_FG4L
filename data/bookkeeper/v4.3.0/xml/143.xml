<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:27:31 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-143/BOOKKEEPER-143.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-143] Add SSL support for hedwig cpp client</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-143</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;Currently Hedwig CPP client doesn&apos;t support SSL. &lt;/p&gt;

&lt;p&gt;Example for boost::asio using SSL:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.boost.org/doc/libs/1_46_1/doc/html/boost_asio/example/ssl/client.cpp&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.boost.org/doc/libs/1_46_1/doc/html/boost_asio/example/ssl/client.cpp&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12535262">BOOKKEEPER-143</key>
            <summary>Add SSL support for hedwig cpp client</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hustlmsp">Sijie Guo</assignee>
                                    <reporter username="hustlmsp">Sijie Guo</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Dec 2011 07:41:26 +0000</created>
                <updated>Wed, 13 Feb 2013 15:46:46 +0000</updated>
                            <resolved>Mon, 1 Oct 2012 14:41:31 +0100</resolved>
                                    <version>4.0.0</version>
                                    <fixVersion>4.2.0</fixVersion>
                                    <component>bookkeeper-client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13228319" author="fpj" created="Tue, 13 Mar 2012 11:16:56 +0000"  >&lt;p&gt;Moving it to 4.2.0.&lt;/p&gt;</comment>
                            <comment id="13450524" author="hustlmsp" created="Fri, 7 Sep 2012 12:08:41 +0100"  >&lt;p&gt;Attach a patch. 1) abstract channel interface 2) implemented ssl channel.&lt;/p&gt;

&lt;p&gt;the patch is generated based on &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-252&quot; title=&quot;Hedwig: provide a subscription mode to kill other subscription channel when hedwig client is used as a proxy-style server.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-252&quot;&gt;&lt;del&gt;BOOKKEEPER-252&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13455918" author="hustlmsp" created="Fri, 14 Sep 2012 17:31:08 +0100"  >&lt;p&gt;update a new patch just rebased to latest patch of &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-252&quot; title=&quot;Hedwig: provide a subscription mode to kill other subscription channel when hedwig client is used as a proxy-style server.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-252&quot;&gt;&lt;del&gt;BOOKKEEPER-252&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13458559" author="ikelly" created="Wed, 19 Sep 2012 11:51:49 +0100"  >&lt;p&gt;Looks good. I&apos;ve a couple of comments on the impl.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I don&apos;t like how event dispatcher has to know about SSL. I understand its because each thread needs a private SSL context. However, this would be better served using TLS (Thread local storage).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;EventDispatcher::setupSslContexts&lt;br/&gt;
  if load_verify_file returns an error will the channel work at all. Shouldn&apos;t this throw an exception.&lt;/li&gt;
&lt;/ul&gt;



&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;rename DuplexChannelManager::Create -&amp;gt; DuplexChannelManager::create&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;removeChannel also closes it. A lot of places which call removeChannel also close it. It would be better to call removeChannel, removeAndCloseChannel and remove the redundant closes.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;::connect(OperationCallbackPtr&amp;amp; cb) is never called except from ::connect(). So they should be merged.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;AbstractDuplexChannel::writeRequest added commented out code&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;connectCallbackHandler directly calls doAfterConnect, which means doAfterConnect should really be connectCallbackHandler&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13459655" author="hustlmsp" created="Thu, 20 Sep 2012 16:12:20 +0100"  >&lt;p&gt;Attach a new patch addressing Ivan&apos;s comment.&lt;/p&gt;</comment>
                            <comment id="13459661" author="hustlmsp" created="Thu, 20 Sep 2012 16:14:59 +0100"  >&lt;p&gt;&amp;gt; ::connect(OperationCallbackPtr&amp;amp; cb) is never called except from ::connect(). So they should be merged.&lt;/p&gt;

&lt;p&gt;this interface is required by &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-369&quot; title=&quot;re-factor hedwig cpp client to provide better interface to support both one-subscription-per-channel and multiple-subscriptions-per-channel.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-369&quot;&gt;&lt;del&gt;BOOKKEEPER-369&lt;/del&gt;&lt;/a&gt; when refactoring cpp client to support multiplexing.&lt;/p&gt;

&lt;p&gt;&amp;gt; ::connect(OperationCallbackPtr&amp;amp; cb) is never called except from ::connect(). So they should be merged.&lt;/p&gt;

&lt;p&gt;connectCallbackHandler is the bound handler after the channel is connected. so the logic would be executed after connected, I think doAfterConnect would be OK.&lt;/p&gt;</comment>
                            <comment id="13459717" author="ikelly" created="Thu, 20 Sep 2012 17:32:08 +0100"  >&lt;p&gt;Ssl should always be SSL or ssl, mixing the cases seems wrong.&lt;/p&gt;

&lt;p&gt;getSslContex() is missing a t&lt;/p&gt;

&lt;p&gt;Why not create a context for each ssl_socket? It would avoid the need to modify event dispatcher at all. They take 60 microseconds to create, and are 24bytes in size. It seems reasonable as overhead as we&apos;ll have 64k sockets max anyhow.&lt;/p&gt;

&lt;p&gt;sslcheck should be in the toplevel Makefile.am also.&lt;/p&gt;</comment>
                            <comment id="13459720" author="ikelly" created="Thu, 20 Sep 2012 17:34:00 +0100"  >&lt;p&gt;Also, unittests segfault in testRandomDelivery.&lt;br/&gt;
I&apos;ve attached the stacktrace from gdb.&lt;/p&gt;</comment>
                            <comment id="13460092" author="hustlmsp" created="Fri, 21 Sep 2012 01:18:58 +0100"  >&lt;blockquote&gt;
&lt;p&gt;Why not create a context for each ssl_socket? It would avoid the need to modify event dispatcher at all. They take 60 microseconds to create, and are 24bytes in size. It seems reasonable as overhead as we&apos;ll have 64k sockets max anyhow.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The 64k limitation is for a client connects to a host. If the client connects to several hosts, the number is not just 64k. besides that, I think 60 microseconds is calculated without loading verify file, if client loads and very pem file, the overhead would be big.&lt;/p&gt;</comment>
                            <comment id="13460201" author="hustlmsp" created="Fri, 21 Sep 2012 05:41:25 +0100"  >&lt;blockquote&gt;
&lt;p&gt;Also, unittests segfault in testRandomDelivery.&lt;br/&gt;
I&apos;ve attached the stacktrace from gdb.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What version of your os, openssl and boost?&lt;/p&gt;

&lt;p&gt;I run the test using &quot;  c=1 ; while [ $c -le 10 ] ; do c=`expr $c + 1`;  make sslcheck; done &quot; in a 2.6.18 linux with openssl-0.9.8 and boost1.38.0. It doesn&apos;t failed.&lt;/p&gt;

&lt;p&gt;from the stacktrace, it seems that something wrong in ssl calls. if you could provide me the libraries version, I could track the issue.&lt;/p&gt;</comment>
                            <comment id="13460341" author="ikelly" created="Fri, 21 Sep 2012 09:12:16 +0100"  >&lt;p&gt;boost 1.50.0&lt;br/&gt;
OpenSSL 1.0.1c 10 May 2012&lt;br/&gt;
Darwin spokegrown-lm 11.3.0 Darwin Kernel Version 11.3.0: Thu Jan 12 18:47:41 PST 2012; root:xnu-1699.24.23~1/RELEASE_X86_64 x86_64&lt;/p&gt;</comment>
                            <comment id="13461425" author="hustlmsp" created="Sun, 23 Sep 2012 15:17:32 +0100"  >&lt;p&gt;Attach a new patch, which &lt;/p&gt;

&lt;p&gt;1) removes ssl context from eventdispatcher. instead, create a SSLContextFactory in channel.h to create ssl context for ssl channel.&lt;/p&gt;

&lt;p&gt;seems that ssl context needs to be created for each channel. so I just created the context when creating the ssl channel.&lt;/p&gt;

&lt;p&gt;2) remove ssl_shutdown when closeSockets for mac os. after that, the core dump doesn&apos;t appear. I am not sure why it cores when ssl shutdown, because ssl shutdown just send a shutdown notify request to server. so remove shutdown just close its underlying socket works well.&lt;/p&gt;</comment>
                            <comment id="13466798" author="ikelly" created="Mon, 1 Oct 2012 14:41:31 +0100"  >&lt;p&gt;Committed r1392319. Good work Sijie.&lt;/p&gt;</comment>
                            <comment id="13467047" author="hudson" created="Mon, 1 Oct 2012 19:21:38 +0100"  >&lt;p&gt;Integrated in bookkeeper-trunk #734 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/734/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/734/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-143&quot; title=&quot;Add SSL support for hedwig cpp client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-143&quot;&gt;&lt;del&gt;BOOKKEEPER-143&lt;/del&gt;&lt;/a&gt;: Add SSL support for hedwig cpp client (sijie via ivank) (Revision 1392319)&lt;/p&gt;

&lt;p&gt;     Result = UNSTABLE&lt;br/&gt;
ivank : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/Makefile.am&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/configure.ac&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/inc/hedwig/client.h&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/lib/channel.cpp&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/lib/channel.h&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/lib/client.cpp&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/lib/clientimpl.cpp&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/lib/clientimpl.h&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/lib/eventdispatcher.cpp&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/lib/eventdispatcher.h&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/lib/subscriberimpl.cpp&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/lib/subscriberimpl.h&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/lib/util.cpp&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/lib/util.h&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/scripts/log4cxx.conf&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/scripts/server-control.sh&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/scripts/tester.sh&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/test/Makefile.am&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/test/main.cpp&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/test/messageboundtest.cpp&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/test/messagefiltertest.cpp&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/test/pubsubtest.cpp&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/test/util.h&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12546201" name="BOOKKEEPER-143.diff" size="86192" author="hustlmsp" created="Sun, 23 Sep 2012 15:17:32 +0100"/>
                            <attachment id="12545917" name="BOOKKEEPER-143.diff" size="79560" author="hustlmsp" created="Thu, 20 Sep 2012 16:12:20 +0100"/>
                            <attachment id="12545167" name="BOOKKEEPER-143.diff" size="78047" author="hustlmsp" created="Fri, 14 Sep 2012 17:31:08 +0100"/>
                            <attachment id="12544199" name="BOOKKEEPER-143.patch" size="77640" author="hustlmsp" created="Fri, 7 Sep 2012 12:08:41 +0100"/>
                            <attachment id="12545928" name="ssl.segfault" size="20976" author="ikelly" created="Thu, 20 Sep 2012 17:34:00 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 13 Mar 2012 11:16:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>220946</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyn6ov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>169271</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>