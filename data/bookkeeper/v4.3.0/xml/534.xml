<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:32:26 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-534/BOOKKEEPER-534.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-534] Flakeyness in AuditorBookieTest</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-534</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk2/35/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk2/35/&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12626176">BOOKKEEPER-534</key>
            <summary>Flakeyness in AuditorBookieTest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="umamaheswararao">Uma Maheswara Rao G</assignee>
                                    <reporter username="ikelly">Ivan Kelly</reporter>
                        <labels>
                    </labels>
                <created>Sat, 5 Jan 2013 13:01:04 +0000</created>
                <updated>Wed, 13 Feb 2013 15:46:34 +0000</updated>
                            <resolved>Mon, 7 Jan 2013 21:54:14 +0000</resolved>
                                                    <fixVersion>4.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13545436" author="umamaheswararao" created="Sun, 6 Jan 2013 16:40:59 +0000"  >&lt;p&gt;I think problem may be looks like, after restarting the Bookies and if it take time to create the vote then waitloop may complete quickly.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (retryCount &amp;gt; 0) {
            List&amp;lt;BookieServer&amp;gt; auditors = getAuditorBookie();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (auditors.size() &amp;gt; 0) {
                newAuditor = auditors.get(0);
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (auditor == newAuditor) {
                    &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(500);
                } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                    &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
                }
            }
            retryCount--;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Auditors size would be 0 if vote is not created yet. then this loop will complete quickly as there won&apos;t be any delay between runs. Are you seeing any other reason here?&lt;/p&gt;</comment>
                            <comment id="13545714" author="umamaheswararao" created="Mon, 7 Jan 2013 09:22:46 +0000"  >&lt;p&gt;I have added small delay in vote creation, so that wait loop will end quickly. In the logs second election also happend but by that time loop also ends and failed. Needs to run multiple times to reproduce.&lt;/p&gt;</comment>
                            <comment id="13545715" author="umamaheswararao" created="Mon, 7 Jan 2013 09:24:58 +0000"  >&lt;p&gt;Attaching a patch here. With this patch above issue should be solved.&lt;br/&gt;
Ivan, please check if you got any another clue on this?&lt;/p&gt;</comment>
                            <comment id="13545761" author="ikelly" created="Mon, 7 Jan 2013 10:45:55 +0000"  >&lt;p&gt;The first patch looks nicer I think. Did it not work?&lt;/p&gt;

&lt;p&gt;Why have you added the delay to vote creation in the AuditorElector?&lt;/p&gt;</comment>
                            <comment id="13545787" author="umamaheswararao" created="Mon, 7 Jan 2013 11:07:55 +0000"  >&lt;p&gt;Hi Ivan, my first patch is just to reproduce the issue. Second patch is for fix. (&lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-534&quot; title=&quot;Flakeyness in AuditorBookieTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-534&quot;&gt;&lt;del&gt;BOOKKEEPER-534&lt;/del&gt;&lt;/a&gt;.patch)&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Why have you added the delay to vote creation in the AuditorElector?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I have added that dealy just to reproduce, not as fix. Per my understanding of this issue, if there is small delay in vote creation, by that loop can exit as auditors.size would be 0. By running that patch multiple time (may be 5-6 time )issue will get reproduced. Second one is the patch to have proper dealy for all runs(even though auditors.size if 0). After this change that is passed by applying on top of that.&lt;/p&gt;</comment>
                            <comment id="13545828" author="ikelly" created="Mon, 7 Jan 2013 11:51:32 +0000"  >&lt;p&gt;Ah, I read the times on the patches wrong. The 10:24 patch looks good to me.&lt;/p&gt;</comment>
                            <comment id="13546315" author="ikelly" created="Mon, 7 Jan 2013 21:54:14 +0000"  >&lt;p&gt;Committed r1430041. Thanks Uma.&lt;/p&gt;</comment>
                            <comment id="13546392" author="hudson" created="Mon, 7 Jan 2013 23:10:12 +0000"  >&lt;p&gt;Integrated in bookkeeper-trunk2 #40 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk2/40/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk2/40/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-534&quot; title=&quot;Flakeyness in AuditorBookieTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-534&quot;&gt;&lt;del&gt;BOOKKEEPER-534&lt;/del&gt;&lt;/a&gt;: Flakeyness in AuditorBookieTest (umamahesh via ivank) (Revision 1430041)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
ivank : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorBookieTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12563532" name="BOOKKEEPER-534-Reproduce-with-delays.patch" size="1612" author="umamaheswararao" created="Mon, 7 Jan 2013 09:22:46 +0000"/>
                            <attachment id="12563533" name="BOOKKEEPER-534.patch" size="877" author="umamaheswararao" created="Mon, 7 Jan 2013 09:24:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 6 Jan 2013 16:40:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>302762</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz0zvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>249821</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>