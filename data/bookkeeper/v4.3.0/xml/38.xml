<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:26:37 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-38/BOOKKEEPER-38.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-38] Bookie Server doesn&apos;t exit when its zookeeper session is expired. So the process is hang there.</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-38</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;Bookie server doesn&apos;t process zookeeper watcher events and just ignore them. So when session expires, bookie server hangs there and can&apos;t do nothing.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12518176">BOOKKEEPER-38</key>
            <summary>Bookie Server doesn&apos;t exit when its zookeeper session is expired. So the process is hang there.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ikelly">Ivan Kelly</assignee>
                                    <reporter username="hustlmsp">Sijie Guo</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Aug 2011 07:53:22 +0100</created>
                <updated>Wed, 7 Dec 2011 15:56:06 +0000</updated>
                            <resolved>Tue, 23 Aug 2011 23:39:35 +0100</resolved>
                                    <version>4.0.0</version>
                                    <fixVersion>4.0.0</fixVersion>
                                    <component>bookkeeper-server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13080778" author="hustlmsp" created="Mon, 8 Aug 2011 07:54:19 +0100"  >&lt;p&gt;Since all the ephemeral nodes associated with the expired zk handle are all go away, it might be complex to recover from this fatal status. It might be better to handle these events and exit when zookeeper session is expired.&lt;/p&gt;</comment>
                            <comment id="13080839" author="hustlmsp" created="Mon, 8 Aug 2011 10:06:49 +0100"  >&lt;p&gt;add code to call shutdown function when zk client is expired.&lt;/p&gt;</comment>
                            <comment id="13082038" author="hustlmsp" created="Wed, 10 Aug 2011 02:18:35 +0100"  >&lt;p&gt;submit patch.&lt;/p&gt;</comment>
                            <comment id="13082448" author="ikelly" created="Wed, 10 Aug 2011 17:29:00 +0100"  >&lt;p&gt;Patch looks good. However, you increase the standard timeout of the bookie from 10000 to 60000. Is this intentional? &lt;/p&gt;

&lt;p&gt;I&apos;ve attached a test case to ensure that this functionality works as proposed. Could you integrate it with your patch.&lt;/p&gt;

&lt;p&gt;Could you perhaps make the timeout into a constant or system property so that the test can use it. I&apos;ve used 10000 in my test as.&lt;/p&gt;</comment>
                            <comment id="13082897" author="hustlmsp" created="Thu, 11 Aug 2011 05:15:27 +0100"  >&lt;p&gt;Ivan, thanks for your test case.&lt;/p&gt;

&lt;p&gt;attached a new patch:&lt;br/&gt;
integrated with Ivan&apos;s test case.&lt;br/&gt;
change code to using BookieServer.shutdown(), so we can shutdown nio server.&lt;/p&gt;</comment>
                            <comment id="13084054" author="ikelly" created="Fri, 12 Aug 2011 12:40:16 +0100"  >&lt;p&gt;I don&apos;t like the idea of Bookie getting a reference to to BookieServer. This creates a circular dependency. Off the top of my head, I think it would be better to have a deathwatcher thread running in BookieServer. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
class DeathWatcher &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; {
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run() {
      &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
          &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000);
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!nioServerFactory.isAlive() || !bookie.isAlive()) {
             shutdown();
             &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
          }
      }
   }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;BookieServer#shutdown would need to be synchronized to avoid race problems here. Bookie#shutdown and NioServerFactory#shutdown also in fact. This shouldn&apos;t affect performance at all though, as they on run on shutdown by definition.&lt;/p&gt;</comment>
                            <comment id="13084227" author="hustlmsp" created="Fri, 12 Aug 2011 17:24:00 +0100"  >&lt;p&gt;Ivan, I agreed with you. I would change the patch.&lt;/p&gt;</comment>
                            <comment id="13089833" author="breed" created="Tue, 23 Aug 2011 23:39:35 +0100"  >&lt;p&gt;+1 excellent work Sijie&lt;/p&gt;

&lt;p&gt;Committed revision 1160915.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12489999" name="BookieZKExpireTest.java" size="3051" author="ikelly" created="Wed, 10 Aug 2011 17:29:00 +0100"/>
                            <attachment id="12489665" name="bookkeeper-38.patch" size="4455" author="hustlmsp" created="Mon, 8 Aug 2011 10:06:49 +0100"/>
                            <attachment id="12490077" name="bookkeeper-38_v2.patch" size="12911" author="hustlmsp" created="Thu, 11 Aug 2011 06:12:01 +0100"/>
                            <attachment id="12490267" name="bookkeeper-38_v3.patch" size="13805" author="hustlmsp" created="Fri, 12 Aug 2011 17:24:26 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 10 Aug 2011 16:29:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63982</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyo0an:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>174067</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>