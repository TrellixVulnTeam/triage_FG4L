<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:27:16 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-745/BOOKKEEPER-745.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-745] Fix for false reports of ledger unreplication during rolling restarts.</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-745</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;The bug occurred because there was no check if rereplication was enabled or not when the auditor came online. When the auditor comes online it does a check of which bookies are up and marks the ledgers on missing bookies as underreplicated. In the false report case, the auditor was running after each bookie was bounced due to the way leader election for the auditor works. And since one bookie was down since you&apos;re bouncing the server, all ledgers on that bookie will get marked as underreplicated.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12706648">BOOKKEEPER-745</key>
            <summary>Fix for false reports of ledger unreplication during rolling restarts.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ikelly">Ivan Kelly</assignee>
                                    <reporter username="ikelly">Ivan Kelly</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Apr 2014 16:27:30 +0100</created>
                <updated>Mon, 2 Jun 2014 16:55:14 +0100</updated>
                            <resolved>Mon, 2 Jun 2014 16:55:14 +0100</resolved>
                                                    <fixVersion>4.3.0</fixVersion>
                    <fixVersion>4.2.3</fixVersion>
                                    <component>bookkeeper-auto-recovery</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13960196" author="hadoopqa" created="Fri, 4 Apr 2014 18:57:43 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-745&quot; title=&quot;Fix for false reports of ledger unreplication during rolling restarts.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-745&quot;&gt;&lt;del&gt;BOOKKEEPER-745&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12638715/0006-Fix-for-false-reports-of-ledger-unreplicat.branch4.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0006-Fix-for-false-reports-of-ledger-unreplicat.branch4.2.patch&lt;/a&gt; downloaded at Fri Apr  4 17:56:06 UTC 2014&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; Patch failed to apply to head of branch&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;</comment>
                            <comment id="13979660" author="ikelly" created="Thu, 24 Apr 2014 13:47:17 +0100"  >&lt;p&gt;rebased patch&lt;/p&gt;</comment>
                            <comment id="13979699" author="hadoopqa" created="Thu, 24 Apr 2014 14:27:21 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-745&quot; title=&quot;Fix for false reports of ledger unreplication during rolling restarts.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-745&quot;&gt;&lt;del&gt;BOOKKEEPER-745&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12641709/0002-Fix-for-false-reports-of-ledger-unreplication-.trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0002-Fix-for-false-reports-of-ledger-unreplication-.trunk.patch&lt;/a&gt; downloaded at Thu Apr 24 13:25:43 UTC 2014&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; Patch failed to apply to head of branch&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;</comment>
                            <comment id="13986110" author="fpj" created="Wed, 30 Apr 2014 22:23:46 +0100"  >&lt;p&gt;The patches here have gone stale, both trunk and 4.2.&lt;/p&gt;</comment>
                            <comment id="13987573" author="ikelly" created="Fri, 2 May 2014 11:41:10 +0100"  >&lt;p&gt;will rebase once the changes the depend on are in.&lt;/p&gt;</comment>
                            <comment id="13990624" author="ikelly" created="Tue, 6 May 2014 14:19:04 +0100"  >&lt;p&gt;rebased to trunk&lt;/p&gt;</comment>
                            <comment id="13991289" author="hadoopqa" created="Tue, 6 May 2014 23:55:30 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-745&quot; title=&quot;Fix for false reports of ledger unreplication during rolling restarts.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-745&quot;&gt;&lt;del&gt;BOOKKEEPER-745&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12643569/0001-Fix-for-false-reports-of-ledger-unreplication-.trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-Fix-for-false-reports-of-ledger-unreplication-.trunk.patch&lt;/a&gt; downloaded at Tue May  6 22:25:27 UTC 2014&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 4 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 905&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/625/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/625/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13994616" author="rakeshr" created="Sun, 11 May 2014 18:29:29 +0100"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ikelly&quot; class=&quot;user-hover&quot; rel=&quot;ikelly&quot;&gt;Ivan Kelly&lt;/a&gt;, overall patch looks fine. I&apos;ve few suggestions, please see it:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Can we move waitIfLedgerReplicationDisabled(); above to generateBookie2LedgersIndex(). This would make bk2ledger indexing after replication enabled otw it may continue with the old index, also I feel later it would be helpful when doing IP to hostname meta changes.&lt;/li&gt;
	&lt;li&gt;Could you replace &apos;children.get(0)&apos; using constant AUDITOR_INDEX&lt;/li&gt;
	&lt;li&gt;Please increase the tests timeout, already tests has 4secs sleep    @Test(timeout=5000)&lt;/li&gt;
	&lt;li&gt;Few cleanups in tests:&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Please remove following used variables in AuditorRollingRestartTest.java:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Logger LOG = LoggerFactory
            .getLogger(AuditorPeriodicBookieCheckTest.class);

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; CHECK_INTERVAL = 1; &lt;span class=&quot;code-comment&quot;&gt;// run every second
&lt;/span&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numLedgers = 1;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Please remove unused imports&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;-Rakesh&lt;/p&gt;</comment>
                            <comment id="14009546" author="ikelly" created="Tue, 27 May 2014 11:10:37 +0100"  >&lt;blockquote&gt;&lt;p&gt;Can we move waitIfLedgerReplicationDisabled(); above to generateBookie2LedgersIndex(). This would make bk2ledger indexing after replication enabled otw it may continue with the old index, also I feel later it would be helpful when doing IP to hostname meta changes.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The reason I put it after the generateBookie2LedgersIndex() is that this method can run for a long time. So it could be running when a rolling restart begins, and then the ledgers would be marked while autoreplication is disabled. Putting the wait after, and having the bk2ledger map a little stale is ok though, because we are only looking for the ledgers which are on the bookie that failed. There will be no new ledgers added to that bookie after that bookie has failed, so we still get the same list of ledgers. If another bookie fails, the bookie check will run again after autoreplication is reenabled.&lt;/p&gt;

&lt;p&gt;I&apos;ve addressed the rest of the comments.&lt;/p&gt;</comment>
                            <comment id="14009559" author="hadoopqa" created="Tue, 27 May 2014 11:44:35 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-745&quot; title=&quot;Fix for false reports of ledger unreplication during rolling restarts.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-745&quot;&gt;&lt;del&gt;BOOKKEEPER-745&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12646884/0001-Fix-for-false-reports-of-ledger-unreplication-.trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-Fix-for-false-reports-of-ledger-unreplication-.trunk.patch&lt;/a&gt; downloaded at Tue May 27 10:13:55 UTC 2014&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 4 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 917&lt;br/&gt;
.    Tests failed: 0&lt;br/&gt;
.    Tests errors: 1&lt;/p&gt;

&lt;p&gt;.    The patch failed the following testcases:&lt;/p&gt;

&lt;p&gt;.      &lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/638/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/638/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14009562" author="ikelly" created="Tue, 27 May 2014 11:50:02 +0100"  >&lt;p&gt;Failure seems to be in part of the code that this change doesn&apos;t touch, kicking off test again.&lt;/p&gt;</comment>
                            <comment id="14013046" author="fpj" created="Thu, 29 May 2014 23:50:09 +0100"  >&lt;blockquote&gt;&lt;p&gt;Failure seems to be in part of the code that this change doesn&apos;t touch, kicking off test again.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The test that failed is org.apache.bookkeeper.client.BookieWriteLedgerTest.testWithMultipleBookieFailuresInLastEnsemble&lt;span class=&quot;error&quot;&gt;&amp;#91;4&amp;#93;&lt;/span&gt;. Do you know if there is a jira for this? We probably want to have a look at it before releasing 4.2.3, no?&lt;/p&gt;
</comment>
                            <comment id="14013464" author="ikelly" created="Fri, 30 May 2014 10:41:44 +0100"  >&lt;p&gt;Failure was against trunk. There&apos;s flake in the trunk tests that needs to be addressed before 4.3.0. 4.2.3 tests cleanly every time for me.&lt;/p&gt;</comment>
                            <comment id="14013839" author="ikelly" created="Fri, 30 May 2014 16:51:20 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rakeshr&quot; class=&quot;user-hover&quot; rel=&quot;rakeshr&quot;&gt;Rakesh R&lt;/a&gt; Can you take another look at this.&lt;/p&gt;</comment>
                            <comment id="14013989" author="rakeshr" created="Fri, 30 May 2014 18:40:40 +0100"  >&lt;blockquote&gt;
&lt;p&gt;The reason I put it after the generateBookie2LedgersIndex() is that this method can run for a long time. So it could be running when a rolling restart begins, and then the ledgers would be marked while autoreplication is disabled. Putting the wait after, and having the bk2ledger map a little stale is ok though, because we are only looking for the ledgers which are on the bookie that failed&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I was seeing the behaviour of this flow with IP_to_Hostname renaming tool &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-639&quot; title=&quot;Provide hostname based bookie and ledger metadata to support IP change&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-639&quot;&gt;BOOKKEEPER-639&lt;/a&gt;. In that case after enabling autoreplication, auditor will compare the old ledger bookie ids(ip as bookieId) with the new bookie available set(hostname as bookieId) and publish as lost bookies. Now auditor will publish these bookies and their ledgers. Now the RWs compete each other for urLock and will just do markLedgerUnderreplicated. In worst case if there are many ledgers in the system unnecessary re-replication cycle will happen for long time for all the ledgers. To avoid this, I think simple approach is just reverse these statements or we could find some other way ?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Auditor.java
        List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; availableBookies = getAvailableBookies();
        &lt;span class=&quot;code-comment&quot;&gt;// find lost bookies
&lt;/span&gt;        Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; knownBookies = ledgerDetails.keySet();
        Collection&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; lostBookies = CollectionUtils.subtract(knownBookies,
                availableBookies);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14014017" author="rakeshr" created="Fri, 30 May 2014 18:59:55 +0100"  >&lt;p&gt;Adding one more point. In build test took more than 60secs, pls use bigger value 2 or 2.5mins.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
AuditorRollingRestartTest	1 min 35 sec
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14014593" author="ikelly" created="Sat, 31 May 2014 11:16:19 +0100"  >&lt;p&gt;&amp;gt; To avoid this, I think simple approach is just reverse these statements or we could find some other way ?&lt;br/&gt;
Ah I see. This is a good point. But the other case also stands. How about if I reverse the statements, but then if ledger replication is disabled, abort the current invokation and schedule a new one?&lt;/p&gt;</comment>
                            <comment id="14014594" author="ikelly" created="Sat, 31 May 2014 11:17:03 +0100"  >&lt;p&gt;To clarify, if we discover it is disabled, after building the index, abort and reschedule.&lt;/p&gt;</comment>
                            <comment id="14014595" author="ikelly" created="Sat, 31 May 2014 11:19:28 +0100"  >&lt;p&gt;&amp;gt; Adding one more point. In build test took more than 60secs, pls use bigger value 2 or 2.5mins.&lt;br/&gt;
Sure. This highlights another issue we have. The test is defined as a junit1 test, so all these timeouts we have are useless. I&apos;ll up the timeout, but we need to fix this other issue also (though in trunk), for 4.2.3 it&apos;s not important. I&apos;m not sure if we have a jira for it.&lt;/p&gt;</comment>
                            <comment id="14014599" author="rakeshr" created="Sat, 31 May 2014 11:33:09 +0100"  >&lt;blockquote&gt;&lt;p&gt;To clarify, if we discover it is disabled, after building the index, abort and reschedule.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;yup this looks fine.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;but we need to fix this other issue also (though in trunk), for 4.2.3 it&apos;s not important. I&apos;m not sure if we have a jira for it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I could see &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-739&quot; title=&quot;Test timeouts mostly ignored&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-739&quot;&gt;&lt;del&gt;BOOKKEEPER-739&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14014607" author="ikelly" created="Sat, 31 May 2014 12:11:12 +0100"  >&lt;p&gt;New patch addresses final comment, puts timeout at 10minutes also.&lt;/p&gt;</comment>
                            <comment id="14014628" author="hadoopqa" created="Sat, 31 May 2014 12:47:56 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-745&quot; title=&quot;Fix for false reports of ledger unreplication during rolling restarts.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-745&quot;&gt;&lt;del&gt;BOOKKEEPER-745&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12647769/0001-BOOKKEEPER-745-Fix-for-false-reports-of-ledger-unrep.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-BOOKKEEPER-745-Fix-for-false-reports-of-ledger-unrep.patch&lt;/a&gt; downloaded at Sat May 31 11:11:41 UTC 2014&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 4 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;WARNING&lt;/font&gt;: the current HEAD has 23 Javadoc warning(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 920&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;.   There is at least one warning, please check&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/646/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/646/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14014822" author="fpj" created="Sat, 31 May 2014 22:07:23 +0100"  >&lt;p&gt;The patch looks good to me. The latest patch does not apply to the 4.2 branch, but I noticed that there is an older patch for 4.2. Did you mean to update it?&lt;/p&gt;

&lt;p&gt;I also don&apos;t quite understand the javadoc warning in the latest QA build. Do you know why it started showing up now?  &lt;/p&gt;</comment>
                            <comment id="14014947" author="ikelly" created="Sun, 1 Jun 2014 11:10:33 +0100"  >&lt;p&gt;These aren&apos;t new javadoc warnings, it&apos;s just that they appear now because javadoc runs fully since &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-763&quot; title=&quot;findbugs fails to run on jenkins&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-763&quot;&gt;&lt;del&gt;BOOKKEEPER-763&lt;/del&gt;&lt;/a&gt;. I&apos;ll update the 4.2 patch when the trunk patch is in.&lt;/p&gt;</comment>
                            <comment id="14015200" author="rakeshr" created="Mon, 2 Jun 2014 07:32:58 +0100"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ikelly&quot; class=&quot;user-hover&quot; rel=&quot;ikelly&quot;&gt;Ivan Kelly&lt;/a&gt;. Latest patch looks nice +1&lt;/p&gt;</comment>
                            <comment id="14015292" author="ikelly" created="Mon, 2 Jun 2014 10:54:50 +0100"  >&lt;p&gt;Committed r1599145 to trunk. Thanks for the reviews guys. Will backport to 4.2 now.&lt;/p&gt;</comment>
                            <comment id="14015321" author="hudson" created="Mon, 2 Jun 2014 12:23:17 +0100"  >&lt;p&gt;SUCCESS: Integrated in bookkeeper-trunk #655 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/655/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/655/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-745&quot; title=&quot;Fix for false reports of ledger unreplication during rolling restarts.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-745&quot;&gt;&lt;del&gt;BOOKKEEPER-745&lt;/del&gt;&lt;/a&gt;: Fix for false reports of ledger unreplication during rolling restarts. (ivank) (ivank: rev 1599145)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/ZkLedgerUnderreplicationManager.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/Auditor.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/AuditorElector.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorLedgerCheckerTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorPeriodicBookieCheckTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorRollingRestartTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/test/TestCallbacks.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14015481" author="ikelly" created="Mon, 2 Jun 2014 16:55:14 +0100"  >&lt;p&gt;Committed revision 1599251 to branch-4.2&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12706647">BOOKKEEPER-744</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12706649">BOOKKEEPER-746</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12647769" name="0001-BOOKKEEPER-745-Fix-for-false-reports-of-ledger-unrep.patch" size="24681" author="ikelly" created="Sat, 31 May 2014 12:11:12 +0100"/>
                            <attachment id="12647917" name="0001-BOOKKEEPER-745.patch" size="24397" author="ikelly" created="Mon, 2 Jun 2014 16:54:48 +0100"/>
                            <attachment id="12646884" name="0001-Fix-for-false-reports-of-ledger-unreplication-.trunk.patch" size="22309" author="ikelly" created="Tue, 27 May 2014 11:05:50 +0100"/>
                            <attachment id="12643569" name="0001-Fix-for-false-reports-of-ledger-unreplication-.trunk.patch" size="22628" author="ikelly" created="Tue, 6 May 2014 14:19:04 +0100"/>
                            <attachment id="12641709" name="0002-Fix-for-false-reports-of-ledger-unreplication-.trunk.patch" size="22628" author="ikelly" created="Thu, 24 Apr 2014 13:47:17 +0100"/>
                            <attachment id="12638714" name="0004-Fix-for-false-reports-of-ledger-unreplication-.trunk.patch" size="22628" author="ikelly" created="Fri, 4 Apr 2014 17:58:09 +0100"/>
                            <attachment id="12638715" name="0006-Fix-for-false-reports-of-ledger-unreplicat.branch4.2.patch" size="22875" author="ikelly" created="Fri, 4 Apr 2014 17:58:09 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 4 Apr 2014 17:57:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384971</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzo6b3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>385238</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>