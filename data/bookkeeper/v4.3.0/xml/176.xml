<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:28:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-176/BOOKKEEPER-176.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-176] HierarchicalBookieFailureTest Hung</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-176</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;See jstack attachment.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12543049">BOOKKEEPER-176</key>
            <summary>HierarchicalBookieFailureTest Hung</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ikelly">Ivan Kelly</assignee>
                                    <reporter username="fpj">Flavio Junqueira</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Feb 2012 13:21:53 +0000</created>
                <updated>Mon, 22 Oct 2012 15:50:16 +0100</updated>
                            <resolved>Thu, 1 Mar 2012 14:58:41 +0000</resolved>
                                                    <fixVersion>4.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13210286" author="ikelly" created="Fri, 17 Feb 2012 14:14:12 +0000"  >&lt;p&gt;Does it fail deterministically, or randomly? Have you logs?&lt;/p&gt;</comment>
                            <comment id="13210304" author="fpj" created="Fri, 17 Feb 2012 14:58:56 +0000"  >&lt;p&gt;It failed once for me. All I have right now is the stack trace I posted.&lt;/p&gt;</comment>
                            <comment id="13218122" author="ikelly" created="Tue, 28 Feb 2012 12:54:29 +0000"  >&lt;p&gt;This patch fixes 4 things, 2 of which are important.&lt;/p&gt;

&lt;p&gt;1) LedgerHandle#pendingAddOps is now threadsafe, this was probably the source of this bug, as after &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-157&quot; title=&quot;For small packets, increasing number of bookies actually degrades performance.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-157&quot;&gt;&lt;del&gt;BOOKKEEPER-157&lt;/del&gt;&lt;/a&gt; adding the queue and removing were not always necessarily in the same thread.&lt;/p&gt;

&lt;p&gt;2) BookKeeper will not initiate create/open or delete ledger operations after zookeeper has connected. This was a source of other intermittent errors, though probably not this one.&lt;/p&gt;

&lt;p&gt;3) Small bug that caused NPE in entrylogger GC.&lt;/p&gt;

&lt;p&gt;4) Typo in network-delays script.&lt;/p&gt;
</comment>
                            <comment id="13218991" author="fpj" created="Wed, 29 Feb 2012 08:34:43 +0000"  >&lt;p&gt;It looks good, Ivan. I have a couple of questions, one not directly related to this patch:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;I was wondering if it is clean to pass a zk reference to a constructor and have the constructor creating it when the reference is null. We can document it, but this is not exactly the behavior I would expect. In any case, I don&apos;t feel strongly about a change here, but I wanted to raise the point.&lt;/li&gt;
	&lt;li&gt;There is a todo saying &quot;handle session disconnects and expires&quot;. I noticed it was there already, and it made me wonder what happens if a client loses its session. Don&apos;t we try to establish a new session? I don&apos;t think we care about the order aspect of sessions here, so I think we need to create a new session if the initial one is gone, no?&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13219002" author="ikelly" created="Wed, 29 Feb 2012 08:52:36 +0000"  >&lt;p&gt;Re: 1.&lt;br/&gt;
It&apos;s not clean, but its difficult to do cleanly because ZooKeeper expects a watcher for its construction, BookKeeper expects a ZooKeeper for its construction, and the Watcher for ZK requires a the CountDownLatch created by BookKeeper, which cannot be used until after the base constructor is run. Still I don&apos;t like nulls, let me try something else.&lt;/p&gt;

&lt;p&gt;Re: 2.&lt;br/&gt;
We should open another JIRA for that TODO.&lt;/p&gt;</comment>
                            <comment id="13219068" author="ikelly" created="Wed, 29 Feb 2012 10:18:28 +0000"  >&lt;p&gt;I changed it to remove the null being passed to the core constructor. Now i pass in an empty watcher, register a new one afterwards, and then ensure that if the connection has been established in the time between creating zk and registering the new watcher, the countdown latch is counted down.&lt;/p&gt;</comment>
                            <comment id="13219271" author="hustlmsp" created="Wed, 29 Feb 2012 15:12:08 +0000"  >&lt;p&gt;new patch is OK to me. +1&lt;/p&gt;</comment>
                            <comment id="13219666" author="fpj" created="Wed, 29 Feb 2012 23:50:45 +0000"  >&lt;p&gt;I&apos;m not really comfortable with the way that we are creating a zoookeeper object in this patch. I was wondering about moving the zookeeper initialization code (in the case the bookkeeper objects owns it) to after construction. One option would be to initialize it in withZKConnected before the call to submit. If the BK objects owns it and is null, we initialize the zookeeper client. I tried this approach, but it turned out not to be very clean, though. It requires more changes than simply moving code.&lt;/p&gt;</comment>
                            <comment id="13219932" author="ikelly" created="Thu, 1 Mar 2012 08:56:34 +0000"  >&lt;p&gt;zk initialization cannot be moved out of the constructor without moving ledgerManager construction out. In any case, it means leaving zookeeper null in the constructor, and checking if zookeeper is null at a later point, which is what my first patch did, but i think using null like this is ugly.&lt;/p&gt;</comment>
                            <comment id="13219959" author="ikelly" created="Thu, 1 Mar 2012 11:01:57 +0000"  >&lt;p&gt;Changes made as discusses this morning.&lt;/p&gt;</comment>
                            <comment id="13220078" author="fpj" created="Thu, 1 Mar 2012 14:58:41 +0000"  >&lt;p&gt;+1, thanks Ivan. Committed revision 1295604.&lt;/p&gt;</comment>
                            <comment id="13220088" author="hudson" created="Thu, 1 Mar 2012 15:17:30 +0000"  >&lt;p&gt;Integrated in bookkeeper-trunk #385 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/385/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/385/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-176&quot; title=&quot;HierarchicalBookieFailureTest Hung&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-176&quot;&gt;&lt;del&gt;BOOKKEEPER-176&lt;/del&gt;&lt;/a&gt;: HierarchicalBookieFailureTest Hung (ivank via fpj) (Revision 1295604)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
fpj : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeper.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/AbstractZkLedgerManager.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/cpp/scripts/network-delays.sh&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12516668" name="BOOKKEEPER-176.diff" size="12519" author="ikelly" created="Thu, 1 Mar 2012 11:01:56 +0000"/>
                            <attachment id="12516545" name="BOOKKEEPER-176.diff" size="11506" author="ikelly" created="Wed, 29 Feb 2012 10:18:28 +0000"/>
                            <attachment id="12516319" name="BOOKKEEPER-176.diff" size="11905" author="ikelly" created="Tue, 28 Feb 2012 12:54:29 +0000"/>
                            <attachment id="12514981" name="HierarchicalBookieFailureTest.jstack.out" size="30672" author="fpj" created="Fri, 17 Feb 2012 13:22:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 17 Feb 2012 14:14:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>228335</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy4s2v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>61705</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>