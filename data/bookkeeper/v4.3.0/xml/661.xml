<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:29:48 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-661/BOOKKEEPER-661.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-661] Turn readonly back to writable if spaces are reclaimed.</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-661</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;should be able to turn a bookie from readonly back to writable if the spaces are reclaimed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12659720">BOOKKEEPER-661</key>
            <summary>Turn readonly back to writable if spaces are reclaimed.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hustlmsp">Sijie Guo</assignee>
                                    <reporter username="hustlmsp">Sijie Guo</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Jul 2013 07:42:16 +0100</created>
                <updated>Tue, 21 Jan 2014 16:59:57 +0000</updated>
                            <resolved>Tue, 21 Jan 2014 16:26:42 +0000</resolved>
                                                    <fixVersion>4.3.0</fixVersion>
                                    <component>bookkeeper-server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13763948" author="hustlmsp" created="Wed, 11 Sep 2013 05:15:36 +0100"  >&lt;p&gt;will generate this patch later, since it will touch same files as &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-656&quot; title=&quot;Bookie Performance Improvement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-656&quot;&gt;&lt;del&gt;BOOKKEEPER-656&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13842976" author="hustlmsp" created="Mon, 9 Dec 2013 08:30:21 +0000"  >&lt;p&gt;attach a patch (which includes changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-662&quot; title=&quot;Major GC should kick in immediately if remaining space reaches a warning threshold&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-662&quot;&gt;&lt;del&gt;BOOKKEEPER-662&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="13843032" author="hadoopqa" created="Mon, 9 Dec 2013 10:07:00 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-661&quot; title=&quot;Turn readonly back to writable if spaces are reclaimed.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-661&quot;&gt;&lt;del&gt;BOOKKEEPER-661&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12617797/BOOKKEEPER-661.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-661.diff&lt;/a&gt; downloaded at Mon Dec  9 09:38:31 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 5 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 887&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/552/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/552/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13859829" author="rakeshr" created="Wed, 1 Jan 2014 04:39:42 +0000"  >&lt;p&gt;Good work Sijie&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I&apos;ve gone through &apos;back to writable logic&apos; and please see the below comments. I&apos;ll look into GC part separately and will add my comments to &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-662&quot; title=&quot;Major GC should kick in immediately if remaining space reaches a warning threshold&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-662&quot;&gt;&lt;del&gt;BOOKKEEPER-662&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;small typo : should be &apos;serve&apos; instead of &apos;server&apos;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Transitioning Bookie to Writable mode and will server read/write requests.&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;small typo : should be &apos;Failed&apos; instead of &apos;Faile&apos;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Faile to delete bookie readonly state in zookeeper : &quot;&lt;/span&gt;, e);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Wrongly deleting the readonly path, bookie is creating ephemral path as follows. Please use the same for deletion
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.bookieRegistrationPath + BookKeeperConstants.READONLY + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; + getMyId()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Since it is ignoring the ZK KeeperException when deleting, its good to handle KeeperException.NodeExistsException during transitionToReadOnlyMode() and here it will triggerBookieShutdown()
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// clear the readonly state
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (KeeperException e) {
                &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we failed when deleting the readonly flag in zookeeper, it is OK since client would
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// already see the bookie in writable list. so just log the exception
&lt;/span&gt;                LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Faile to delete bookie readonly state in zookeeper : &quot;&lt;/span&gt;, e);
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;-Rakesh&lt;/p&gt;</comment>
                            <comment id="13871799" author="hustlmsp" created="Wed, 15 Jan 2014 08:26:30 +0000"  >&lt;p&gt;addressed comment. attach latest patch based on &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-662&quot; title=&quot;Major GC should kick in immediately if remaining space reaches a warning threshold&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-662&quot;&gt;&lt;del&gt;BOOKKEEPER-662&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13871800" author="hustlmsp" created="Wed, 15 Jan 2014 08:27:41 +0000"  >&lt;p&gt;attach a patch with &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-662&quot; title=&quot;Major GC should kick in immediately if remaining space reaches a warning threshold&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-662&quot;&gt;&lt;del&gt;BOOKKEEPER-662&lt;/del&gt;&lt;/a&gt; changes for precommit job.&lt;/p&gt;</comment>
                            <comment id="13871824" author="hadoopqa" created="Wed, 15 Jan 2014 09:05:37 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-661&quot; title=&quot;Turn readonly back to writable if spaces are reclaimed.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-661&quot;&gt;&lt;del&gt;BOOKKEEPER-661&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12623092/BOOKKEEPER-661_662.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-661_662.diff&lt;/a&gt; downloaded at Wed Jan 15 08:37:19 UTC 2014&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 5 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 888&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/555/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/555/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13872169" author="ikelly" created="Wed, 15 Jan 2014 15:15:40 +0000"  >&lt;p&gt;I think accepting and ignoring NodeExistsException is confusing. There could be corner cases where the bookie is coming up with a full disk, after crash where the ephemeral from the last process is still there. Then the bookie registration will disappear after the previous process&apos;s session timeout.&lt;/p&gt;

&lt;p&gt;It would be better to modify registerBookie() to get check if the Stat.getEphemeralOwner == current zk session id. In this case, registerBookie can just return. I think this is safer.&lt;/p&gt;

&lt;p&gt;Do we need diskWritable() &amp;amp; diskJustWritable()? They seem to be handled the same.&lt;/p&gt;

&lt;p&gt;On any unrelated note, why do we register readonly bookies in zookeeper. I don&apos;t see it used anywhere on the client? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rakeshr&quot; class=&quot;user-hover&quot; rel=&quot;rakeshr&quot;&gt;Rakesh R&lt;/a&gt;, perhaps you remember?&lt;/p&gt;
</comment>
                            <comment id="13872266" author="rakeshr" created="Wed, 15 Jan 2014 16:56:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;On any unrelated note, why do we register readonly bookies in zookeeper. I don&apos;t see it used anywhere on the client? Rakesh R, perhaps you remember?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Hi Ivan, &lt;br/&gt;
As I recollect, readonly bookie information is used in the following cases:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Rereplication : Auditor will be using all the bookies(available + r-o bookies) to see failures.&lt;/li&gt;
	&lt;li&gt;There is a logic to close channels to dead bookies. This readonly bookieId is used to make it alive and excluding from deadbookie list.&lt;/li&gt;
	&lt;li&gt;Also, exposed shell command to know the r-o bookies&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13872498" author="hustlmsp" created="Wed, 15 Jan 2014 19:40:22 +0000"  >&lt;blockquote&gt;
&lt;p&gt;It would be better to modify registerBookie() to get check if the Stat.getEphemeralOwner == current zk session id. In this case, registerBookie can just return. I think this is safer.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;checking session id is the safer way. will do that.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Do we need diskWritable() &amp;amp; diskJustWritable()? They seem to be handled the same.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;they are related to DiskWarnThreshold and DiskSpaceThreshold. we handle different action in gc. when disk is just writable, we need to force gc. &lt;/p&gt;


</comment>
                            <comment id="13872504" author="hustlmsp" created="Wed, 15 Jan 2014 19:42:04 +0000"  >&lt;p&gt;not sure why this was resolved. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13873162" author="hustlmsp" created="Thu, 16 Jan 2014 08:37:59 +0000"  >&lt;p&gt;attach a new patch to check ephemeralowner when creating registration znode.  &lt;/p&gt;</comment>
                            <comment id="13873180" author="hadoopqa" created="Thu, 16 Jan 2014 09:09:06 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-661&quot; title=&quot;Turn readonly back to writable if spaces are reclaimed.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-661&quot;&gt;&lt;del&gt;BOOKKEEPER-661&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12623334/BOOKKEEPER-661.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-661.diff&lt;/a&gt; downloaded at Thu Jan 16 08:40:47 UTC 2014&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 3 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 888&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/557/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/557/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13873307" author="ikelly" created="Thu, 16 Jan 2014 12:03:21 +0000"  >&lt;p&gt;Ooops, seems I resolved by mistake. Will take another look.&lt;/p&gt;</comment>
                            <comment id="13873383" author="ikelly" created="Thu, 16 Jan 2014 13:33:44 +0000"  >&lt;p&gt;The logic in checkRegNodeAndWaitExpire and registerBookie is a bit off. If the node exists and is owned by the current session, the zk.create() in registerBookie shouldn&apos;t be called.&lt;/p&gt;</comment>
                            <comment id="13873526" author="hustlmsp" created="Thu, 16 Jan 2014 15:57:03 +0000"  >&lt;p&gt;my bad. I was thinking returning boolean to not create znode. but it slipped from my mind. will address that.&lt;/p&gt;</comment>
                            <comment id="13873664" author="rakeshr" created="Thu, 16 Jan 2014 17:53:20 +0000"  >&lt;p&gt;Thanks Sijie for the patch. &lt;/p&gt;

&lt;p&gt;Adding few comments, please see:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&apos;regPath&apos; is missing in logging, please pass args to it.
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;ZK exception checking and wait ephemeral znode {} expired : &quot;&lt;/span&gt;, ke);
LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Interrupted checking and wait ephemeral znode {} expired : &quot;&lt;/span&gt;, ie);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Please add (timeout=60000) for the test case.
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testBookieShouldTurnWritableFromReadOnly() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Also, since you are touching it would be great if you can include timeout for other testcases in ReadOnlyBookieTest class. &lt;br/&gt;
Somehow we have missed this class when doing the &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-523&quot; title=&quot;Every test should have a timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-523&quot;&gt;&lt;del&gt;BOOKKEEPER-523&lt;/del&gt;&lt;/a&gt; imprv activity.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;It is good practise to have fail statement in tests when we are expecting an exception. Please use like the below one.
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+            ledger.addEntry(&lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;.getBytes());
             Assert.fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Should &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; exception as not enough bookies to write entry!&quot;&lt;/span&gt;);
+        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (BKException.BKNotEnoughBookiesException e) {
+            &lt;span class=&quot;code-comment&quot;&gt;// Expected
&lt;/span&gt;+        }

+        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+            bkc.createLedger(2, 2, DigestType.MAC, &quot;&quot;.getBytes());
             Assert.fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Should &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; exception as not enough bookies to create ledger!&quot;&lt;/span&gt;);
+        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (BKException bke) {
+            &lt;span class=&quot;code-comment&quot;&gt;// Expected.
&lt;/span&gt;+        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13877160" author="hustlmsp" created="Tue, 21 Jan 2014 04:01:07 +0000"  >&lt;p&gt;attach a patch which address the comments.&lt;/p&gt;</comment>
                            <comment id="13877167" author="hadoopqa" created="Tue, 21 Jan 2014 04:13:03 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-661&quot; title=&quot;Turn readonly back to writable if spaces are reclaimed.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-661&quot;&gt;&lt;del&gt;BOOKKEEPER-661&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12624063/BOOKKEEPER-661.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-661.diff&lt;/a&gt; downloaded at Tue Jan 21 04:10:58 UTC 2014&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; Patch failed to apply to head of branch&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;</comment>
                            <comment id="13877232" author="hustlmsp" created="Tue, 21 Jan 2014 05:51:45 +0000"  >&lt;p&gt;attach the right patch.&lt;/p&gt;</comment>
                            <comment id="13877314" author="hadoopqa" created="Tue, 21 Jan 2014 07:43:58 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-661&quot; title=&quot;Turn readonly back to writable if spaces are reclaimed.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-661&quot;&gt;&lt;del&gt;BOOKKEEPER-661&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12624077/BOOKKEEPER-661.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-661.diff&lt;/a&gt; downloaded at Tue Jan 21 07:15:40 UTC 2014&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 4 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 893&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/562/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/562/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13877584" author="ikelly" created="Tue, 21 Jan 2014 16:26:42 +0000"  >&lt;p&gt;Committed r1560066. Thanks Sijie.&lt;/p&gt;</comment>
                            <comment id="13877609" author="hudson" created="Tue, 21 Jan 2014 16:59:57 +0000"  >&lt;p&gt;SUCCESS: Integrated in bookkeeper-trunk #520 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/520/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/520/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-661&quot; title=&quot;Turn readonly back to writable if spaces are reclaimed.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-661&quot;&gt;&lt;del&gt;BOOKKEEPER-661&lt;/del&gt;&lt;/a&gt;: Turn readonly back to writable if spaces are reclaimed. (sijie via ivank) (ivank: rev 1560066)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/EntryLogger.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/GarbageCollectorThread.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/IndexPersistenceMgr.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/InterleavedLedgerStorage.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerDirsManager.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/BookieInitializationTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/CompactionTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/TestSyncThread.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/test/ReadOnlyBookieTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12624077" name="BOOKKEEPER-661.diff" size="37489" author="hustlmsp" created="Tue, 21 Jan 2014 05:51:45 +0000"/>
                            <attachment id="12624063" name="BOOKKEEPER-661.diff" size="37569" author="hustlmsp" created="Tue, 21 Jan 2014 04:01:07 +0000"/>
                            <attachment id="12623334" name="BOOKKEEPER-661.diff" size="32124" author="hustlmsp" created="Thu, 16 Jan 2014 08:37:59 +0000"/>
                            <attachment id="12623091" name="BOOKKEEPER-661.diff" size="28249" author="hustlmsp" created="Wed, 15 Jan 2014 08:26:30 +0000"/>
                            <attachment id="12617797" name="BOOKKEEPER-661.diff" size="44326" author="hustlmsp" created="Mon, 9 Dec 2013 08:30:21 +0000"/>
                            <attachment id="12623092" name="BOOKKEEPER-661_662.diff" size="49957" author="hustlmsp" created="Wed, 15 Jan 2014 08:27:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 9 Dec 2013 10:07:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>339912</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzggxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>340230</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>