<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:30:12 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-319/BOOKKEEPER-319.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-319] Manage auditing and replication processes</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-319</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;This subtask discusses, how we will manage the whole rereplication processes.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12595877">BOOKKEEPER-319</key>
            <summary>Manage auditing and replication processes</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12553925">BOOKKEEPER-237</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vinayrpet">Vinayakumar B</assignee>
                                    <reporter username="rakeshr">Rakesh R</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Jun 2012 09:26:06 +0100</created>
                <updated>Thu, 2 May 2013 03:29:55 +0100</updated>
                            <resolved>Thu, 4 Oct 2012 17:32:15 +0100</resolved>
                                                    <fixVersion>4.2.0</fixVersion>
                                    <component>bookkeeper-auto-recovery</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13401240" author="rakeshr" created="Tue, 26 Jun 2012 09:28:52 +0100"  >&lt;p&gt;Following are some of the discussion threads from &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-272&quot; title=&quot;Provide automatic mechanism to know bookie failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-272&quot;&gt;&lt;del&gt;BOOKKEEPER-272&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;As a bookie process&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-272?focusedCommentId=13400581&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13400581&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BOOKKEEPER-272?focusedCommentId=13400581&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13400581&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;As a separate process&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-272?focusedCommentId=13400628&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13400628&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BOOKKEEPER-272?focusedCommentId=13400628&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13400628&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13443074" author="vinayrpet" created="Tue, 28 Aug 2012 12:21:27 +0100"  >&lt;p&gt;Hi All, &lt;br/&gt;
I want to take up this Jira.&lt;/p&gt;

&lt;p&gt;I assume the following from various discussions under &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-237&quot; title=&quot;Automatic recovery of under-replicated ledgers and its entries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-237&quot;&gt;&lt;del&gt;BOOKKEEPER-237&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Auditor will be a separate daemon, which also contains ReplicationWorker, which should be started in all bookie machines.&lt;/li&gt;
	&lt;li&gt;One of them will be elected as Auditor and start publishing the bookie failures and under-replicated ledgers. Replication workers start replicating to local bookie.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;So here are my thoughts about current Jira,&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Create a class do start Auditor service and replication worker. How about having class name as &quot;AuditorPeer&quot;, similar to zookeeper &quot;QuorumPeer&quot;..?&lt;/li&gt;
	&lt;li&gt;Include this in the bookkeeper scripts.&lt;/li&gt;
	&lt;li&gt;Assuming that this daemon will be started from the same installation and configurations as of bookie.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Any thoughts, suggestions, inputs are welcome.&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="13443183" author="umamaheswararao" created="Tue, 28 Aug 2012 15:10:29 +0100"  >&lt;p&gt;Sounds great Vinay.&lt;/p&gt;

&lt;p&gt;Coming to naming of the process, I wanted get the opinions from Ivan/Flavio as Ivan might have already thought about some good name &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I can see why you are asking for other name rather than simply auditor. It&apos;s because only one process can act as Auditor and others are just workers and participants for next elections.&lt;/p&gt;

&lt;p&gt;Anyway, that can be updated once name decided. You can start work on other areas of this patch and once name finalized you can update it. So, that should not be a blocking for you.&lt;/p&gt;
</comment>
                            <comment id="13443799" author="vinayrpet" created="Wed, 29 Aug 2012 05:51:08 +0100"  >&lt;p&gt;Thanks Uma,&lt;br/&gt;
Yeah, I will start working with other things. Name I will update once its finalized.&lt;/p&gt;</comment>
                            <comment id="13444947" author="vinayrpet" created="Thu, 30 Aug 2012 14:28:21 +0100"  >&lt;p&gt;Attaching the patch for review. Here I have named the class as &apos;AuditorPeer&apos; itself.&lt;/p&gt;</comment>
                            <comment id="13444991" author="umamaheswararao" created="Thu, 30 Aug 2012 15:55:00 +0100"  >&lt;p&gt;changed to PA state for you Vinay.&lt;/p&gt;</comment>
                            <comment id="13457201" author="umamaheswararao" created="Mon, 17 Sep 2012 19:10:42 +0100"  >&lt;p&gt;Hi Vinay, thanks for the patch.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; ZooKeeper getNewZookeeper(ServerConfiguration conf)
+            &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, InterruptedException, KeeperException {
+        ZooKeeper newZk = ZkUtils.getNewZookeeperClient(conf.getZkServers(),
+                conf.getZkTimeout(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Watcher() {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please use ZKUtils#getNewConnectedClient instead, as you added it recently in format patch.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  */
+    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void join() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException {
+        &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;) {
+            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (auditorElector.isRunning()) {
+                wait(100);
+            }
+            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (replicationWorker.isRunning()) {
+                wait(100);
+            }
+        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Could you please give me a hint why you added this log in join, did not strikes it to me on first look.&lt;br/&gt;
anyway shutdown is calling auditor and rw shutdown, so they will be interrupted and joined there?&lt;br/&gt;
Simply why can&apos;t we add add join in this method?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; class AuditorPeerDeathWatcher &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; {
+        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; watchInterval;
+        AuditorPeer peer;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;why can&apos;t we make these variable private?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(confFile).toURI().toURL()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;directly also, you can convert to url right? any issue?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
+            LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Exception running bookie server : &quot;&lt;/span&gt;, e);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Why bookie server?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&quot;Shut down AuditorPeer
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;typo?&lt;/p&gt;


&lt;p&gt;isRunning --&amp;gt; add small doc for this&lt;/p&gt;

&lt;p&gt;These are some comments on first look. Did not take a look into tests much&lt;br/&gt;
I would request, Ivan to take a look for better naming here for the process.&lt;br/&gt;
Also please add your comments&lt;/p&gt;
</comment>
                            <comment id="13459659" author="ikelly" created="Thu, 20 Sep 2012 16:14:31 +0100"  >&lt;p&gt;Patch looks good, but needs a rebase against trunk. I have the following comments.&lt;/p&gt;

&lt;p&gt;For naming I would suggest calling the command (for the bash script), &quot;autorec&quot; or &quot;autorecovery&quot;, and the main class &quot;AutoRecoveryMain&quot;. We shouldn&apos;t expose the actual implementation to the user, we just want to them to know that a auto recovery service is available.&lt;/p&gt;

&lt;p&gt;Typo in the name of the death watcher thread.&lt;/p&gt;

&lt;p&gt;The help for &quot;conf&quot; should be &quot;Bookie server configuration&quot;. &lt;/p&gt;

&lt;p&gt;A ParseException in parseArgs will cause the same error to be printed twice.&lt;/p&gt;

&lt;p&gt;In printUsage, there should be no &quot;or&quot;. It should be &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hf.printHelp(&lt;span class=&quot;code-quote&quot;&gt;&quot;AutoRecoveryMain [options]\n&quot;&lt;/span&gt;, opts);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;getMyBookieAddress can be static. &lt;/p&gt;

&lt;p&gt;getNewZookeeper exists in AuditorPeer and in ZkUtils. There is already a version of it in ZkUtils now as well.&lt;/p&gt;

&lt;p&gt;Also, you&apos;re catching Exception e in main(). Could you run &quot;mvn install findbugs:check&quot; once you&apos;ve rebased to ensure this isn&apos;t causing a findbugs error.&lt;/p&gt;</comment>
                            <comment id="13460300" author="vinayrpet" created="Fri, 21 Sep 2012 08:05:25 +0100"  >&lt;p&gt;Attaching the latest patch addressing both Uma and Ivan&apos;s comments.&lt;/p&gt;</comment>
                            <comment id="13460505" author="ikelly" created="Fri, 21 Sep 2012 15:07:15 +0100"  >&lt;p&gt;The new patch is good except for AutoRecoveryMain#join(). Why not just join the deathWatcher thread?&lt;/p&gt;</comment>
                            <comment id="13461685" author="vinayrpet" created="Mon, 24 Sep 2012 09:48:25 +0100"  >&lt;p&gt;Thanks Ivan for the hint.. I just changed that and uploading updated patch.&lt;/p&gt;</comment>
                            <comment id="13462367" author="umamaheswararao" created="Tue, 25 Sep 2012 03:22:48 +0100"  >&lt;p&gt;+1 , I am fine to push this in. Thanks Vinay.&lt;/p&gt;

&lt;p&gt;@Ivan, Could you please push this in, if you like the latest one. As this is the startUp for recovery process,&lt;br/&gt;
Surendra wanted to start verifying the scenarios with recoevry Node after this patch in.&lt;/p&gt;</comment>
                            <comment id="13469484" author="ikelly" created="Thu, 4 Oct 2012 17:32:15 +0100"  >&lt;p&gt;Committed as r1394145. Good work Vinay.&lt;/p&gt;</comment>
                            <comment id="13469606" author="hudson" created="Thu, 4 Oct 2012 20:06:53 +0100"  >&lt;p&gt;Integrated in bookkeeper-trunk #740 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/740/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/740/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-319&quot; title=&quot;Manage auditing and replication processes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-319&quot;&gt;&lt;del&gt;BOOKKEEPER-319&lt;/del&gt;&lt;/a&gt;: Manage auditing and replication processes (Vinay via ivank) (Revision 1394145)&lt;/p&gt;

&lt;p&gt;     Result = UNSTABLE&lt;br/&gt;
ivank : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/bin/bookkeeper&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/bin/bookkeeper-daemon.sh&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/AuditorElector.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/AutoRecoveryMain.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/ReplicationWorker.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AutoRecoveryMainTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12608444">BOOKKEEPER-409</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12546272" name="BOOKKEEPER-319.patch" size="15656" author="vinayrpet" created="Mon, 24 Sep 2012 09:48:25 +0100"/>
                            <attachment id="12546008" name="BOOKKEEPER-319.patch" size="15888" author="vinayrpet" created="Fri, 21 Sep 2012 08:05:25 +0100"/>
                            <attachment id="12543092" name="BOOKKEEPER-319.patch" size="21045" author="vinayrpet" created="Thu, 30 Aug 2012 14:28:21 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 28 Aug 2012 11:21:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>240488</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxuwhz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4085</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>