<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:25:52 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-619/BOOKKEEPER-619.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-619] Bookie should not create local cookie files if zookeeper is uninitialized</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-619</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;If you download a distribution of bookkeeper-4.2.1 and try to start the bookie before initializing zookeeper, then the bookie will fail to start, but write the local cookie files with a null instance id. If you then initialize zookeeper with the &quot;bin/bookkeeper shell metaformat&quot;, you will not be able to start the bookie as instance id of in zk will not match the null instance id in the bookie files.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12651377">BOOKKEEPER-619</key>
            <summary>Bookie should not create local cookie files if zookeeper is uninitialized</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ikelly">Ivan Kelly</assignee>
                                    <reporter username="ikelly">Ivan Kelly</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Jun 2013 17:34:23 +0100</created>
                <updated>Fri, 21 Jun 2013 18:25:58 +0100</updated>
                            <resolved>Fri, 21 Jun 2013 17:55:35 +0100</resolved>
                                    <version>4.2.1</version>
                                    <fixVersion>4.2.2</fixVersion>
                    <fixVersion>4.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13677266" author="hadoopqa" created="Thu, 6 Jun 2013 18:26:58 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-619&quot; title=&quot;Bookie should not create local cookie files if zookeeper is uninitialized&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-619&quot;&gt;&lt;del&gt;BOOKKEEPER-619&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12586527/0001-BOOKKEEPER-619-Bookie-should-not-create-local-cookie.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-BOOKKEEPER-619-Bookie-should-not-create-local-cookie.patch&lt;/a&gt; downloaded at Thu Jun  6 17:01:00 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 1 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 843&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/353/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/353/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13683900" author="hadoopqa" created="Sat, 15 Jun 2013 00:09:11 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-619&quot; title=&quot;Bookie should not create local cookie files if zookeeper is uninitialized&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-619&quot;&gt;&lt;del&gt;BOOKKEEPER-619&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12586527/0001-BOOKKEEPER-619-Bookie-should-not-create-local-cookie.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-BOOKKEEPER-619-Bookie-should-not-create-local-cookie.patch&lt;/a&gt; downloaded at Fri Jun 14 22:43:03 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 1 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 849&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/367/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/367/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13686248" author="hustlmsp" created="Tue, 18 Jun 2013 01:47:53 +0100"  >&lt;p&gt;I don&apos;t think this would be an issue. when you formatted the metadata, shouldn&apos;t you format the local bookie? it is supposed to the logic for a clear consistence instance setup.&lt;/p&gt;

&lt;p&gt;for example, if the /ledgers exists before, but the admin didn&apos;t run metadata format, so there is no instance id in cookies file. but the bookie failed to start due to other issues, the admin run metadata format again. the bookie would still fail to start since the local bookie files are not consistent with metadata format.&lt;/p&gt;

&lt;p&gt;A consistent instance setup you should run local bookie format after metadata format. This is what the format tools give you.&lt;/p&gt;</comment>
                            <comment id="13686528" author="ikelly" created="Tue, 18 Jun 2013 10:36:29 +0100"  >&lt;p&gt;It&apos;s mostly a usability thing. I&apos;ve been caught out by this a couple of times and I&apos;ve seen others caught by it as well. The problem is that you extract the tarball on a server, try to run a bookie without running the format command. This is a mistake, so you run the metaformat. Then you run the bookieformat, and it warns you that you&apos;re about to destroy data (i.e. the cookie that was created in the previous run). This is confusing, and awkward. In fact, the only reason you need to run the bookieformat is because the previous run created the cookies. If, on a clean cluster you run metaformat and then just start the bookie, you have the same effect.&lt;/p&gt;

&lt;p&gt;The purpose this this patch is to avoid this confusing situation. If you run a bookie against a nonformatted metadata, it doesn&apos;t put up any new barriers to running it again once metadata is formatted.&lt;/p&gt;</comment>
                            <comment id="13688842" author="hustlmsp" created="Thu, 20 Jun 2013 04:45:57 +0100"  >&lt;p&gt;in general, it is good to have the checking. I agreed.&lt;/p&gt;

&lt;p&gt;but the existence of ledgerRootPath doesn&apos;t mean the metadata is formatted. for example, in a shared zookeeper environment, the ledgerRootPath might be provided before bookkeeper initialized its instance. that&apos;s why I don&apos;t think the patch is necessary, since the best guideline is when you format the metadata instance, you&apos;d better to format the bookies, no matter the bookie is non-formatted, formatted from previous instance, or partial-formatted due to incorrect steps.&lt;/p&gt;

&lt;p&gt;anyway +1 for this patch.&lt;/p&gt;</comment>
                            <comment id="13690452" author="ikelly" created="Fri, 21 Jun 2013 17:32:37 +0100"  >&lt;blockquote&gt;&lt;p&gt;but the existence of ledgerRootPath doesn&apos;t mean the metadata is formatted&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It may do. If you initialized your cluster with a bookkeeper version before we added metaformat, then ledgerRootPath existence effectively meant that metadata was formatted. If we weren&apos;t maintaining this behaviour then we could refuse to write anything on the bookie if instanceid was null. We are maintaining it though :/&lt;/p&gt;

&lt;p&gt;I&apos;ll push in the patch. Thanks for reviewing.&lt;/p&gt;</comment>
                            <comment id="13690467" author="ikelly" created="Fri, 21 Jun 2013 17:55:26 +0100"  >&lt;p&gt;Committed r1495508 to trunk.&lt;br/&gt;
Committed r1495510 to branch-4.2.&lt;/p&gt;</comment>
                            <comment id="13690492" author="hudson" created="Fri, 21 Jun 2013 18:25:58 +0100"  >&lt;p&gt;Integrated in bookkeeper-trunk #252 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/252/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/252/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-619&quot; title=&quot;Bookie should not create local cookie files if zookeeper is uninitialized&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-619&quot;&gt;&lt;del&gt;BOOKKEEPER-619&lt;/del&gt;&lt;/a&gt;: Bookie should not create local cookie files if zookeeper is uninitialized (ivank) (Revision 1495508)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
ivank : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeperAdmin.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/BookieInitializationTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12586527" name="0001-BOOKKEEPER-619-Bookie-should-not-create-local-cookie.patch" size="5055" author="ikelly" created="Thu, 6 Jun 2013 17:54:57 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 6 Jun 2013 17:26:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>331703</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzf2fb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>332034</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>