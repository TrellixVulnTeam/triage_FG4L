<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:31:24 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-166/BOOKKEEPER-166.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-166] Bookie will not recover its journal if the length prefix of an entry is truncated</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-166</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;Entries in the bookie&apos;s journal are written in the format &amp;lt;len&amp;gt;&amp;lt;entry&amp;gt;&lt;/p&gt;

&lt;p&gt;If the bookie crashes while writing the length part, then the bookie will not be able to recover the journal.&lt;br/&gt;
An unlikely situation to happen as this is only 1 int, but an issue none the less.&lt;/p&gt;

&lt;p&gt;There is a testcase in &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-165&quot; title=&quot;Add versioning support for journal files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-165&quot;&gt;&lt;del&gt;BOOKKEEPER-165&lt;/del&gt;&lt;/a&gt; which will trigger this when enabled (BookieJournalTest#testTruncatedInLenJournal).&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12541653">BOOKKEEPER-166</key>
            <summary>Bookie will not recover its journal if the length prefix of an entry is truncated</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ikelly">Ivan Kelly</assignee>
                                    <reporter username="ikelly">Ivan Kelly</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Feb 2012 17:00:20 +0000</created>
                <updated>Mon, 22 Oct 2012 15:50:14 +0100</updated>
                            <resolved>Fri, 30 Mar 2012 12:00:36 +0100</resolved>
                                                    <fixVersion>4.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13241104" author="ikelly" created="Thu, 29 Mar 2012 10:27:38 +0100"  >&lt;p&gt;Patch simply reenables the test. Another fix actually fixed the issue. &lt;/p&gt;

&lt;p&gt;When we discussed this before we came to the conclusion that simply ensuring that we read 4 bytes would be enough. This is not the case, as the journal preallocates disk space, so in the case where the length is truncated, the final bits would be zeroed. However, this is fine now, as it will try to read in the packet. The entryId and ledgerId will be 0, and the bookie will see that ledgerId doesn&apos;t exist and skip the entry.&lt;/p&gt;</comment>
                            <comment id="13241254" author="hustlmsp" created="Thu, 29 Mar 2012 15:11:24 +0100"  >&lt;p&gt;yeah, the journal did preallocate disk space. I agreed. +1 for the patch.&lt;/p&gt;</comment>
                            <comment id="13242254" author="ikelly" created="Fri, 30 Mar 2012 12:00:36 +0100"  >&lt;p&gt;Committed as r1307353&lt;/p&gt;</comment>
                            <comment id="13242261" author="hudson" created="Fri, 30 Mar 2012 12:13:28 +0100"  >&lt;p&gt;Integrated in bookkeeper-trunk #434 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/434/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/434/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-166&quot; title=&quot;Bookie will not recover its journal if the length prefix of an entry is truncated&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-166&quot;&gt;&lt;del&gt;BOOKKEEPER-166&lt;/del&gt;&lt;/a&gt;: Bookie will not recover its journal if the length prefix of an entry is truncated (ivank) (Revision 1307353)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
ivank : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/BookieJournalTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12520396" name="BOOKKEEPER-166.diff" size="785" author="ikelly" created="Thu, 29 Mar 2012 10:27:38 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 29 Mar 2012 14:11:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>226940</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy4sav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>61741</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>