<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:27:24 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-235/BOOKKEEPER-235.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-235] Bad syncing in entrylogger degrades performance for many concurrent ledgers</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-235</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;EntryLogger flush syncs on the wrong object, which really hurts performance.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12553778">BOOKKEEPER-235</key>
            <summary>Bad syncing in entrylogger degrades performance for many concurrent ledgers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ikelly">Ivan Kelly</assignee>
                                    <reporter username="ikelly">Ivan Kelly</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 May 2012 16:24:11 +0100</created>
                <updated>Mon, 22 Oct 2012 15:50:19 +0100</updated>
                            <resolved>Wed, 9 May 2012 12:01:13 +0100</resolved>
                                                    <fixVersion>4.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13268271" author="ikelly" created="Fri, 4 May 2012 13:04:30 +0100"  >&lt;p&gt;The problem was that the flush thread was syncing on entryLogger, while EntryLogger#addEntry is also synchronised, so they were holding each other off. &lt;/p&gt;

&lt;p&gt;Fix is two liner.&lt;/p&gt;</comment>
                            <comment id="13268360" author="fpj" created="Fri, 4 May 2012 14:44:39 +0100"  >&lt;p&gt;The description refers to EntryLogger flush synchronizing on the wrong object, but the patch changes a synchronization block in InterleavedLedgerStore. For InterleavedLedgerStore flush, it is only called from Bookie SyncThread, and I&apos;m not convinced that it is ok to change the synchronized block like that.&lt;/p&gt;</comment>
                            <comment id="13268368" author="ikelly" created="Fri, 4 May 2012 14:53:09 +0100"  >&lt;p&gt;InterleavedLedgerStorage#flush was syncing on the entrylogger to ensure that only #flush was not called concurrently. It was something i introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-196&quot; title=&quot;Define interface between bookie and ledger storage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-196&quot;&gt;&lt;del&gt;BOOKKEEPER-196&lt;/del&gt;&lt;/a&gt; as an extra check even though it was only called by SyncThread. I didn&apos;t realize at the time that EntryLogger#addEntry was also synchronized. Because of this, each call to #addEntry from the bookie thread would block the sync block of #flush in the sync thread.&lt;/p&gt;</comment>
                            <comment id="13268422" author="fpj" created="Fri, 4 May 2012 16:07:11 +0100"  >&lt;p&gt;InterleavedLedgerStorage#flush essentially calls LedgerCacheImpl#flushLedger and EntryLogger#flush. They both have synchronization in some form. Given that flushLock is kind of dangling in this patch, what if we simply remove the synchronization block in InterleavedLedgerStorage#flush and drop flushLock?&lt;/p&gt;</comment>
                            <comment id="13268934" author="fpj" created="Sat, 5 May 2012 11:36:59 +0100"  >&lt;p&gt;Canceling patch until we converge.&lt;/p&gt;</comment>
                            <comment id="13269735" author="ikelly" created="Mon, 7 May 2012 17:09:25 +0100"  >&lt;p&gt;New patch removes syncing completely, as a) this is only called from SyncThread and b) LedgerCacheImpl#flushLedger and EntryLogger#flush both have their own synchronisation.&lt;/p&gt;</comment>
                            <comment id="13271306" author="fpj" created="Wed, 9 May 2012 12:01:02 +0100"  >&lt;p&gt;+1, thanks ivan.&lt;/p&gt;</comment>
                            <comment id="13271307" author="fpj" created="Wed, 9 May 2012 12:01:13 +0100"  >&lt;p&gt;Committed revision 1336083.&lt;/p&gt;</comment>
                            <comment id="13271323" author="hudson" created="Wed, 9 May 2012 12:22:11 +0100"  >&lt;p&gt;Integrated in bookkeeper-trunk #499 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/499/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/499/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-235&quot; title=&quot;Bad syncing in entrylogger degrades performance for many concurrent ledgers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-235&quot;&gt;&lt;del&gt;BOOKKEEPER-235&lt;/del&gt;&lt;/a&gt;: Bad syncing in entrylogger degrades performance for many concurrent ledgers (ivank via fpj) (Revision 1336083)&lt;/p&gt;

&lt;p&gt;     Result = UNSTABLE&lt;br/&gt;
fpj : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/InterleavedLedgerStorage.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12525868" name="BOOKKEEPER-235.diff" size="1999" author="ikelly" created="Mon, 7 May 2012 17:09:25 +0100"/>
                            <attachment id="12525604" name="BOOKKEEPER-235.diff" size="1137" author="ikelly" created="Fri, 4 May 2012 13:04:30 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 4 May 2012 13:44:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>237987</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy4rsv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>61660</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>