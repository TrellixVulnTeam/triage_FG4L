<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:25:42 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-347/BOOKKEEPER-347.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-347]  Provide mechanism to detect r-o bookie by the bookie clients</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-347</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;This jira to discuss, how the bookie client knows about the bookie running in r-o. This would be required by the client to choose writable bookies during add entries. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12599090">BOOKKEEPER-347</key>
            <summary> Provide mechanism to detect r-o bookie by the bookie clients</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12548815">BOOKKEEPER-199</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vinayrpet">Vinayakumar B</assignee>
                                    <reporter username="rakeshr">Rakesh R</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Jul 2012 10:04:07 +0100</created>
                <updated>Wed, 13 Feb 2013 15:46:42 +0000</updated>
                            <resolved>Mon, 3 Dec 2012 16:59:36 +0000</resolved>
                                    <version>4.1.0</version>
                                    <fixVersion>4.2.0</fixVersion>
                                    <component>bookkeeper-client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="13484826" author="vinayrpet" created="Fri, 26 Oct 2012 11:11:01 +0100"  >&lt;p&gt;Attaching patch for client side changes.&lt;/p&gt;</comment>
                            <comment id="13485562" author="rakeshr" created="Sun, 28 Oct 2012 03:50:00 +0000"  >&lt;p&gt;Thanks Vinay and nice work. Just following comments:&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;comment#1:&lt;br/&gt;
In your patch, its iterating over bookieAddresses and comparing with &apos;readonly&apos; string. Instead we could check the corresponding bookie address present in &apos;&lt;/p&gt;
{bookieRegPath}
&lt;p&gt;/readonly/&apos; znode. isn&apos;t it?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
         HashSet&amp;lt;InetSocketAddress&amp;gt; newBookieAddrs = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;InetSocketAddress&amp;gt;();
         &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; bookieAddrString : children) {
+            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Bookie.READONLY.equals(bookieAddrString)) {
+                &lt;span class=&quot;code-comment&quot;&gt;// Just exclude the readonly bookies from available nodes
&lt;/span&gt;+                &lt;span class=&quot;code-comment&quot;&gt;// list.
&lt;/span&gt;+                &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
+            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;hr /&gt;
&lt;p&gt;comment#2:&lt;br/&gt;
Also, its good to have test cases verifying the behaviour, like we can just creating an ephemeral znode bookieip:port under /readonly and try creating ledger using bkclient, should through exception.&lt;/p&gt;

&lt;p&gt;-Rakesh&lt;/p&gt;</comment>
                            <comment id="13485569" author="rakeshr" created="Sun, 28 Oct 2012 05:06:40 +0000"  >&lt;p&gt;Adding more to my above &lt;cite&gt;comment#1&lt;/cite&gt;:&lt;/p&gt;

&lt;p&gt;We could also think of an optimistic approach of sending the write request to bkserver(without extra r-o checks), anyway bookie server has the logic of validating r-o mode and throws BookieProtocol.EREADONLY exception back to the client. So in the client side, just handle &quot;BookieProtocol.EREADONLY&quot; and finds new bookie server to continue writing entries.&lt;/p&gt;</comment>
                            <comment id="13485575" author="umamaheswararao" created="Sun, 28 Oct 2012 05:51:06 +0000"  >&lt;p&gt;Thanks a lot Vinay for the patch!&lt;br/&gt;
I also wanted to review this change. Currently I am not able to look at this patch as I am on vacation. I will be back by tomorrow. Overall Nice work from you in BK-199 JIRA &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="13485832" author="vinayrpet" created="Mon, 29 Oct 2012 04:45:26 +0000"  >&lt;p&gt;Hi Rakesh,&lt;/p&gt;

&lt;p&gt;&quot;readonly&quot; is the persistent znode, which is under &quot;/ledgers/available&quot; and if any r-o bookies will be having ephemeral nodes under &quot;/ledgers/available/readonly&quot;.&lt;/p&gt;

&lt;p&gt;As Sijie mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-199?focusedCommentId=13416144&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13416144&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BOOKKEEPER-199?focusedCommentId=13416144&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13416144&lt;/a&gt; only write requests will go through available bookies and we need exclude r-o bookies from available bookies list. Here since &quot;readonly&quot; znode also under &quot;/ledgers/available&quot;, Just excluding it.&lt;/p&gt;

&lt;p&gt;Since BookieWatcher itself will exclude from available list,  no need of extra checking of whether bookie is readonly or not at client side.&lt;/p&gt;

&lt;p&gt;Requests, which have sent before BookieWatcher  updates the available list, will get &quot;BookieProtocol.EREADONLY&quot; error. And again ensemble change will happen excluding the r-o bookies.&lt;/p&gt;</comment>
                            <comment id="13485887" author="rakeshr" created="Mon, 29 Oct 2012 08:07:01 +0000"  >&lt;p&gt;@Vinay&lt;br/&gt;
I understood. I got confused after reading the comments in the patch.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-comment&quot;&gt;// Just exclude the readonly bookies from available nodes
&lt;/span&gt;+  &lt;span class=&quot;code-comment&quot;&gt;// list.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Instead could you please mention like:&lt;br/&gt;
&quot;// Excluding &apos;readonly&apos; znode from the available bookies list&quot;&lt;br/&gt;
Also, we can directly remove the Bookie.READONLY as follows, in that case not required to have the checks inside loop:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
children.remove(Bookie.READONLY);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13485907" author="umamaheswararao" created="Mon, 29 Oct 2012 09:18:18 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; bookieAddrString : children) {
+            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Bookie.READONLY.equals(bookieAddrString)) {
+                &lt;span class=&quot;code-comment&quot;&gt;// Just exclude the readonly bookies from available nodes
&lt;/span&gt;+                &lt;span class=&quot;code-comment&quot;&gt;// list.
&lt;/span&gt;+                &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
+            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think there is a potential issue here.&lt;br/&gt;
When you simply exclude the r-o bookie from newBookieAddrs set, we will simply consider the remaining bookies as dead Bookies and will close all the connections. Closing connections for writers may be ok, but this is not at all correct for readers as we will allow reading the r-o bookies.&lt;/p&gt;</comment>
                            <comment id="13485939" author="vinayrpet" created="Mon, 29 Oct 2012 10:31:44 +0000"  >&lt;p&gt;Attaching the latest patch.&lt;/p&gt;</comment>
                            <comment id="13487193" author="ikelly" created="Tue, 30 Oct 2012 20:33:29 +0000"  >&lt;p&gt;testLedgerCreationShouldFailWithReadonlyBookie() is broken. Try replacing the 2 zk lines with a 3 second thread sleep. it still passes. you&apos;ve killed one of the two bookies at the start of the test, so there&apos;s no way you&apos;ll be able to create a ledger.&lt;/p&gt;

&lt;p&gt;The problem is that, in BookieWatcher, you remove the READONLY znode, which only removes &quot;readonly&quot; from the list, not the znodes under &quot;readonly&quot;. Really, what you need to do is watch /available/readonly similar to how /available is watched, and update a list of readonly bookies when the children change. this list can then be remove for the desired effect.&lt;/p&gt;

&lt;p&gt;Finally, in the test, you should use BookKeeperClusterTestCase#getBookie() instead of hard coding the bookie id.&lt;/p&gt;</comment>
                            <comment id="13497817" author="vinayrpet" created="Thu, 15 Nov 2012 07:28:43 +0000"  >&lt;p&gt;Hi Ivan,&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The problem is that, in BookieWatcher, you remove the READONLY znode, which only removes &quot;readonly&quot; from the list, not the znodes under &quot;readonly&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Here, everytime getChildren() is called, new list of children itself will be used as knownbookies. This list contains only one level of znodes. i.e. It doesn&apos;t contains the znodes under &apos;readonly&apos;, but it contains &apos;readonly&apos;.&lt;/p&gt;

&lt;p&gt;Since, during transition to readOnly, we will unregister from &apos;available&apos; and register under &apos;readonly&apos; znode, getChildren(..) call will not have this transitioned bookie address. So this bookie will be removed automatically from available bookies on watcher event.&lt;/p&gt;

&lt;p&gt;Only thing we need to do is, to avoid closing of the readonly bookie clients, we can add watcher on &apos;readonly&apos; znode and keep track of readonly bookies, and avoid closing of clients for readonly bookies.&lt;/p&gt;

&lt;p&gt;In the above Test, &lt;br/&gt;
I was trying to simulate the transitionToReadOnly. Anyway I corrected the test by directly using the &lt;tt&gt;Bookie.transitionToReadOnly()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;One small change required in &lt;tt&gt;Bookie.transitionToReadOnly()&lt;/tt&gt; is the order of creating the readonly ephemeral node and deleting the available ephemeral node should be changed to get the updated list of readonly bookies first.&lt;/p&gt;

&lt;p&gt;I will post a patch soon regarding these..&lt;/p&gt;</comment>
                            <comment id="13497865" author="vinayrpet" created="Thu, 15 Nov 2012 09:11:15 +0000"  >&lt;p&gt;Attaching the patch&lt;/p&gt;</comment>
                            <comment id="13504565" author="hadoopqa" created="Tue, 27 Nov 2012 12:12:53 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-347&quot; title=&quot; Provide mechanism to detect r-o bookie by the bookie clients&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-347&quot;&gt;&lt;del&gt;BOOKKEEPER-347&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WARNING: Running test-patch on a dirty local svn workspace&lt;/p&gt;

&lt;p&gt;Patch &amp;lt;a href=&quot;/jira/secure/attachment/12553635/&lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-347&quot; title=&quot; Provide mechanism to detect r-o bookie by the bookie clients&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-347&quot;&gt;&lt;del&gt;BOOKKEEPER-347&lt;/del&gt;&lt;/a&gt;.patch&quot;&amp;gt;/jira/secure/attachment/12553635/&lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-347&quot; title=&quot; Provide mechanism to detect r-o bookie by the bookie clients&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-347&quot;&gt;&lt;del&gt;BOOKKEEPER-347&lt;/del&gt;&lt;/a&gt;.patch&amp;lt;/a&amp;gt; downloaded at Tue Nov 27 11:53:06 UTC 2012&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch contains 1 line(s) longer than 120 characters&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 1 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;WARNING&lt;/font&gt;: the current HEAD has 8 Javadoc warning(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;WARNING&lt;/font&gt;: the current HEAD has 9 javac warning(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;WARNING: the current HEAD has  Findbugs warning(s), they should be addressed ASAP&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 390&lt;br/&gt;
.    Tests failed: 5&lt;br/&gt;
.    Tests errors: 36&lt;/p&gt;

&lt;p&gt;.    The patch failed the following testcases:&lt;/p&gt;

&lt;p&gt;.      testLedgerCreationShouldFailWithReadonlyBookie(org.apache.bookkeeper.test.ReadOnlyBookieTest)&lt;br/&gt;
.      testAsyncBookieRecoveryToRandomBookies&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;(org.apache.bookkeeper.client.BookieRecoveryTest)&lt;br/&gt;
.      testAsyncBookieRecoveryToRandomBookies&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;(org.apache.bookkeeper.client.BookieRecoveryTest)&lt;br/&gt;
.      testAsyncBookieRecoveryToRandomBookies&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;(org.apache.bookkeeper.client.BookieRecoveryTest)&lt;br/&gt;
.      testAsyncBookieRecoveryToRandomBookies&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt;(org.apache.bookkeeper.client.BookieRecoveryTest)&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;.   There is at least one warning, please check&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/31/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/31/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13507468" author="ikelly" created="Fri, 30 Nov 2012 17:21:04 +0000"  >&lt;p&gt;New patch looks good, but tests are failing so you should look into that. Also, there&apos;s a findbugs and 1 line which is too long.&lt;/p&gt;

&lt;p&gt;Also, could you rename BKInvalidWriteOnReadOnlyBookieException to BKWriteToReadOnlyBookieException (and the other objects in that file named the same also).&lt;/p&gt;</comment>
                            <comment id="13508500" author="vinayrpet" created="Mon, 3 Dec 2012 06:29:49 +0000"  >&lt;p&gt;Attaching the patch with fix&lt;/p&gt;</comment>
                            <comment id="13508596" author="hadoopqa" created="Mon, 3 Dec 2012 09:06:27 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-347&quot; title=&quot; Provide mechanism to detect r-o bookie by the bookie clients&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-347&quot;&gt;&lt;del&gt;BOOKKEEPER-347&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WARNING: Running test-patch on a dirty local svn workspace&lt;/p&gt;

&lt;p&gt;Patch &amp;lt;a href=&quot;/jira/secure/attachment/12555711/&lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-347&quot; title=&quot; Provide mechanism to detect r-o bookie by the bookie clients&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-347&quot;&gt;&lt;del&gt;BOOKKEEPER-347&lt;/del&gt;&lt;/a&gt;.patch&quot;&amp;gt;/jira/secure/attachment/12555711/&lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-347&quot; title=&quot; Provide mechanism to detect r-o bookie by the bookie clients&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-347&quot;&gt;&lt;del&gt;BOOKKEEPER-347&lt;/del&gt;&lt;/a&gt;.patch&amp;lt;/a&amp;gt; downloaded at Mon Dec  3 08:41:01 UTC 2012&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 1 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 387&lt;br/&gt;
.    Tests failed: 1&lt;br/&gt;
.    Tests errors: 0&lt;/p&gt;

&lt;p&gt;.    The patch failed the following testcases:&lt;/p&gt;

&lt;p&gt;.      testLedgerCreationShouldFailWithReadonlyBookie(org.apache.bookkeeper.test.ReadOnlyBookieTest)&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/63/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/63/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13508637" author="ikelly" created="Mon, 3 Dec 2012 10:41:54 +0000"  >&lt;p&gt;testLedgerCreationShouldFailWithReadonlyBookie is still flakey. This is due to the bookieWatcher in the bookie client not being updated immediately when the bookie transitions. It has to wait for the watcher to trigger, but by this time, createLedger may have already been called. This can be solved by modifying the test to the following &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    /**
     * Test ledger creation with readonly bookies
     */
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testLedgerCreationShouldFailWithReadonlyBookie() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        killBookie(1);
        baseConf.setReadOnlyModeEnabled(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        startNewBookie();

        bs.get(1).getBookie().transitionToReadOnlyMode();
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            bkc.readBookiesBlocking();
            bkc.createLedger(2, 2, DigestType.CRC32, &quot;&quot;.getBytes());
            fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Must &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; exception, as there is one readonly bookie&quot;&lt;/span&gt;);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (BKException e) {
            &lt;span class=&quot;code-comment&quot;&gt;// Expected
&lt;/span&gt;        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I also rejigged the how you start the bookie. I don&apos;t like changing the conf of the bookie on the fly, as the result on the bookie side could be unpredictable. &lt;/p&gt;</comment>
                            <comment id="13508676" author="vinayrpet" created="Mon, 3 Dec 2012 11:57:12 +0000"  >&lt;p&gt;Ok, thanks for the suggestion Ivan. I will modify and upload the patch again.&lt;/p&gt;</comment>
                            <comment id="13508688" author="vinayrpet" created="Mon, 3 Dec 2012 12:26:15 +0000"  >&lt;p&gt;Attaching the latest patchn with test failure fix&lt;/p&gt;</comment>
                            <comment id="13508839" author="hadoopqa" created="Mon, 3 Dec 2012 16:37:15 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-347&quot; title=&quot; Provide mechanism to detect r-o bookie by the bookie clients&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-347&quot;&gt;&lt;del&gt;BOOKKEEPER-347&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WARNING: Running test-patch on a dirty local svn workspace&lt;/p&gt;

&lt;p&gt;Patch &amp;lt;a href=&quot;/jira/secure/attachment/12555777/&lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-347&quot; title=&quot; Provide mechanism to detect r-o bookie by the bookie clients&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-347&quot;&gt;&lt;del&gt;BOOKKEEPER-347&lt;/del&gt;&lt;/a&gt;.patch&quot;&amp;gt;/jira/secure/attachment/12555777/&lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-347&quot; title=&quot; Provide mechanism to detect r-o bookie by the bookie clients&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-347&quot;&gt;&lt;del&gt;BOOKKEEPER-347&lt;/del&gt;&lt;/a&gt;.patch&amp;lt;/a&amp;gt; downloaded at Mon Dec  3 16:11:39 UTC 2012&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 1 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 387&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/69/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/69/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13508854" author="ikelly" created="Mon, 3 Dec 2012 16:59:36 +0000"  >&lt;p&gt;Committed as r1416590. Good work Vinay.&lt;/p&gt;</comment>
                            <comment id="13509600" author="hudson" created="Tue, 4 Dec 2012 09:05:24 +0000"  >&lt;p&gt;Integrated in bookkeeper-trunk #837 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/837/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-347&quot; title=&quot; Provide mechanism to detect r-o bookie by the bookie clients&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-347&quot;&gt;&lt;del&gt;BOOKKEEPER-347&lt;/del&gt;&lt;/a&gt;: Provide mechanism to detect r-o bookie by the bookie clients (Vinay via ivank) (Revision 1416590)&lt;/p&gt;

&lt;p&gt;     Result = UNSTABLE&lt;br/&gt;
ivank : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BKException.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeperAdmin.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookieWatcher.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/test/ReadOnlyBookieTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12555777" name="BOOKKEEPER-347.patch" size="13599" author="vinayrpet" created="Mon, 3 Dec 2012 16:03:42 +0000"/>
                            <attachment id="12555749" name="BOOKKEEPER-347.patch" size="13599" author="vinayrpet" created="Mon, 3 Dec 2012 12:26:15 +0000"/>
                            <attachment id="12555711" name="BOOKKEEPER-347.patch" size="13514" author="vinayrpet" created="Mon, 3 Dec 2012 06:29:49 +0000"/>
                            <attachment id="12553635" name="BOOKKEEPER-347.patch" size="12607" author="vinayrpet" created="Thu, 15 Nov 2012 09:11:15 +0000"/>
                            <attachment id="12551176" name="BOOKKEEPER-347.patch" size="5279" author="vinayrpet" created="Mon, 29 Oct 2012 10:31:44 +0000"/>
                            <attachment id="12550945" name="BOOKKEEPER-347.patch" size="3890" author="vinayrpet" created="Fri, 26 Oct 2012 11:11:01 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 26 Oct 2012 10:11:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>251222</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy50mn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63095</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>