<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:28:03 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-371/BOOKKEEPER-371.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-371] NPE in hedwig hub client causes hedwig hub to shut down.</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-371</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;The hedwig client was connected to a remote region hub that restarted resulting in the channel getting disconnected. &lt;/p&gt;


&lt;p&gt;2012-08-15 17:47:42,443 - ERROR - &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-20-thread-1:TerminateJVMExceptionHandler@28&amp;#93;&lt;/span&gt; - Uncaught exception in thread pool-20-thread-1&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.hedwig.client.netty.HedwigClientImpl.getResponseHandlerFromChannel(HedwigClientImpl.java:323)&lt;br/&gt;
        at org.apache.hedwig.client.handlers.MessageConsumeCallback.operationFinished(MessageConsumeCallback.java:75)&lt;br/&gt;
        at org.apache.hedwig.client.handlers.MessageConsumeCallback.operationFinished(MessageConsumeCallback.java:41)&lt;br/&gt;
        at org.apache.hedwig.server.regions.RegionManager$1$1$1.operationFinished(RegionManager.java:208)&lt;br/&gt;
        at org.apache.hedwig.server.regions.RegionManager$1$1$1.operationFinished(RegionManager.java:202)&lt;br/&gt;
        at org.apache.hedwig.server.persistence.ReadAheadCache$PersistCallback.operationFinished(ReadAheadCache.java:194)&lt;br/&gt;
        at org.apache.hedwig.server.persistence.ReadAheadCache$PersistCallback.operationFinished(ReadAheadCache.java:171)&lt;br/&gt;
        at org.apache.hedwig.server.persistence.BookkeeperPersistenceManager$PersistOp$1.safeAddComplete(BookkeeperPersistenceManager.java:548)&lt;br/&gt;
        at org.apache.hedwig.zookeeper.SafeAsynBKCallback$AddCallback.addComplete(SafeAsynBKCallback.java:93)&lt;br/&gt;
        at org.apache.bookkeeper.client.PendingAddOp.submitCallback(PendingAddOp.java:165)&lt;br/&gt;
        at org.apache.bookkeeper.client.LedgerHandle.sendAddSuccessCallbacks(LedgerHandle.java:643)&lt;br/&gt;
        at org.apache.bookkeeper.client.PendingAddOp.writeComplete(PendingAddOp.java:159)&lt;br/&gt;
        at org.apache.bookkeeper.proto.PerChannelBookieClient.handleAddResponse(PerChannelBookieClient.java:577)&lt;br/&gt;
        at org.apache.bookkeeper.proto.PerChannelBookieClient$7.safeRun(PerChannelBookieClient.java:525)&lt;br/&gt;
        at org.apache.bookkeeper.util.SafeRunnable.run(SafeRunnable.java:31)&lt;br/&gt;
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:166)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:722)&lt;/p&gt;


&lt;p&gt;At 2012-08-15 17:47:42,443, the channel was disconnected as well. &lt;/p&gt;

&lt;p&gt;I believe the following code in the MessageConsumeCallback is causing this problem. &lt;/p&gt;

&lt;p&gt; Channel topicSubscriberChannel = client.getSubscriber().getChannelForTopic(topicSubscriber);&lt;br/&gt;
        HedwigClientImpl.getResponseHandlerFromChannel(topicSubscriberChannel).getSubscribeResponseHandler()&lt;br/&gt;
        .messageConsumed(messageConsumeData.msg);&lt;/p&gt;

&lt;p&gt;The channel was retrieved without checking if it was closed and then getPipeline().getLast() was called which returned a null value resulting in a NPE. Moreover, we need to check if the returned Response handler is not null because there is a race here if channel.close() is called after we retrieve the channel and before we call messageConsumed(). &lt;/p&gt;

&lt;p&gt;I guess the same applies for other instances where we use this.&lt;br/&gt;
Does the above explanation seem right? &lt;/p&gt;
</description>
                <environment></environment>
        <key id="12603840">BOOKKEEPER-371</key>
            <summary>NPE in hedwig hub client causes hedwig hub to shut down.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="i0exception">Aniruddha</assignee>
                                    <reporter username="i0exception">Aniruddha</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Aug 2012 11:42:02 +0100</created>
                <updated>Wed, 13 Feb 2013 15:47:02 +0000</updated>
                            <resolved>Tue, 28 Aug 2012 13:54:28 +0100</resolved>
                                                    <fixVersion>4.2.0</fixVersion>
                                    <component>hedwig-client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13436748" author="hustlmsp" created="Fri, 17 Aug 2012 15:13:48 +0100"  >&lt;p&gt;@Aniruddha. yup, your explanation is right. this bug is same to &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-144&quot; title=&quot;NPE in MessageConsumeCallback&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-144&quot;&gt;&lt;del&gt;BOOKKEEPER-144&lt;/del&gt;&lt;/a&gt;. we need to check ResponseHandler is null or not before calling its methods. &lt;/p&gt;

&lt;p&gt;Could you generate a patch for it?&lt;/p&gt;</comment>
                            <comment id="13437729" author="i0exception" created="Mon, 20 Aug 2012 09:11:31 +0100"  >&lt;p&gt;It would be great if you could review the patch. Also, is there some thing similar to reviewboard where I can view the patches? &lt;/p&gt;</comment>
                            <comment id="13437833" author="hustlmsp" created="Mon, 20 Aug 2012 13:55:39 +0100"  >&lt;p&gt;thanks Aniruddha.&lt;/p&gt;

&lt;p&gt;the fix looks good to me. but seems that the patch could not apply to latest trunk. I think your code base is before &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-331&quot; title=&quot;Let hedwig support returning message seq id for publish requests.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-331&quot;&gt;&lt;del&gt;BOOKKEEPER-331&lt;/del&gt;&lt;/a&gt;. could you rebase the patch to latest trunk?&lt;/p&gt;

&lt;p&gt;&amp;gt; is there some thing similar to reviewboard where I can view the patches?&lt;br/&gt;
apache&apos;s review board is here : &lt;a href=&quot;https://reviews.apache.org/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/&lt;/a&gt;&lt;br/&gt;
you could find those patch available&apos;s jiras in &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER#selectedTab=com.atlassian.jira.plugin.system.project%3Aissues-panel&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/BOOKKEEPER#selectedTab=com.atlassian.jira.plugin.system.project%3Aissues-panel&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13439714" author="i0exception" created="Wed, 22 Aug 2012 18:44:28 +0100"  >&lt;p&gt;Here&apos;s the reviewboard diff addressing this. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/6734/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/6734/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13443132" author="hustlmsp" created="Tue, 28 Aug 2012 13:54:28 +0100"  >&lt;p&gt;committed as r1378112.&lt;/p&gt;

&lt;p&gt;thanks Aniruddha for the patch. &lt;/p&gt;

&lt;p&gt;BTW: it would be better to put the patch in jira when you uploading to review board &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13443166" author="hudson" created="Tue, 28 Aug 2012 14:49:06 +0100"  >&lt;p&gt;Integrated in bookkeeper-trunk #679 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/679/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/679/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-371&quot; title=&quot;NPE in hedwig hub client causes hedwig hub to shut down.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-371&quot;&gt;&lt;del&gt;BOOKKEEPER-371&lt;/del&gt;&lt;/a&gt;: NPE in hedwig hub client causes hedwig hub to shut down. (Aniruddha via sijie) (Revision 1378112)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
sijie : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/java/org/apache/hedwig/client/exceptions/NoResponseHandlerException.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/java/org/apache/hedwig/client/handlers/MessageConsumeCallback.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/java/org/apache/hedwig/client/handlers/SubscribeResponseHandler.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/java/org/apache/hedwig/client/netty/HedwigClientImpl.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/java/org/apache/hedwig/client/netty/HedwigPublisher.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/java/org/apache/hedwig/client/netty/HedwigSubscriber.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-client/src/main/java/org/apache/hedwig/client/netty/WriteCallback.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12535264">BOOKKEEPER-144</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12542001" name="BK-371.patch" size="21125" author="i0exception" created="Wed, 22 Aug 2012 18:39:21 +0100"/>
                            <attachment id="12541567" name="BK-371.patch" size="21643" author="i0exception" created="Mon, 20 Aug 2012 09:11:31 +0100"/>
                            <attachment id="12542763" name="BOOKKEEPER-371.diff" size="20753" author="hustlmsp" created="Tue, 28 Aug 2012 13:52:31 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 17 Aug 2012 14:13:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>293552</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyn6kn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>169252</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>