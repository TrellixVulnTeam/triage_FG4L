<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:32:13 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-538/BOOKKEEPER-538.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-538] Race condition in BookKeeper#close</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-538</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;I&apos;ve seen this with BookieAutoRecoveryTest. Basically, we interrupt and join the replicationworker thread, and then close the BookKeeper instance. This can have caused a bookkeeper operation that never finished. The executor runs it after #close has closed the BookieClient. The operation opens a connection and therefore we get a hang on releaseExternalResources(). &lt;/p&gt;

&lt;p&gt;Solution is pretty simple. We should shutdown all executors before closing the bookieClient. I&apos;ll attach a patch which does this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12626600">BOOKKEEPER-538</key>
            <summary>Race condition in BookKeeper#close</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ikelly">Ivan Kelly</assignee>
                                    <reporter username="ikelly">Ivan Kelly</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Jan 2013 18:37:21 +0000</created>
                <updated>Wed, 13 Feb 2013 15:46:41 +0000</updated>
                            <resolved>Thu, 10 Jan 2013 18:14:34 +0000</resolved>
                                                    <fixVersion>4.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13547119" author="hadoopqa" created="Tue, 8 Jan 2013 18:56:43 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-538&quot; title=&quot;Race condition in BookKeeper#close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-538&quot;&gt;&lt;del&gt;BOOKKEEPER-538&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12563795/0001-BOOKKEEPER-538-Race-condition-in-BookKeeper-close.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-BOOKKEEPER-538-Race-condition-in-BookKeeper-close.patch&lt;/a&gt; downloaded at Tue Jan  8 18:51:45 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch does not add/modify any testcase&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; patch does not compile&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 TESTS&lt;/font&gt; - patch does not compile, cannot run testcases&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; distro tarball fails with the patch&lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/220/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/220/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13547124" author="rakeshr" created="Tue, 8 Jan 2013 19:04:49 +0000"  >&lt;p&gt;Its great catch, also signaling to think more BookieAutoRecovery test cases &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13547537" author="umamaheswararao" created="Wed, 9 Jan 2013 02:11:06 +0000"  >&lt;p&gt;DO you think we have to handle this at BookieClient itself. Client should not allow to open any new channels after closed it right? Not sure I missed something here.&lt;/p&gt;

&lt;p&gt;Current patch also looks good and ensuring all executors stopped before waiting to releaseExternalResources. I think this is the Jetty behavior that if there are any channels in open state then this will hang. I have just seen an open issue in Jetty as well JETTY-391 similar to it. &lt;/p&gt;

&lt;p&gt;On answering the first comment +1 on this patch as this can fix the issue as well.&lt;/p&gt;</comment>
                            <comment id="13547588" author="umamaheswararao" created="Wed, 9 Jan 2013 03:14:33 +0000"  >&lt;p&gt;oops.... there was a typo: &apos;JETTY-391&apos; --&amp;gt; NETTY-391 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; (jetty --&amp;gt; netty )&lt;/p&gt;</comment>
                            <comment id="13547726" author="hustlmsp" created="Wed, 9 Jan 2013 07:35:01 +0000"  >&lt;p&gt;sounds great. I agreed that moving shutting down scheduler and mainWorkerPool before releaseExternalResources would be helpful. but awaitTermination is a kind of violence, it might terminate some ongoing operations forcefully. I am not sure is it possible to cause some channel is still leaking without close then block Netty#releaseExternalResources again. &lt;/p&gt;

&lt;p&gt;I thought that hedwig client already handled similar issue well. You could check hedwig-client/src/main/java/org/apache/hedwig/client/netty/CleanupChannelMap.java. It ensures that all outstanding channels would be closed finally during closing, so it would not block Netty#releaseExternalResources.&lt;/p&gt;</comment>
                            <comment id="13547816" author="ikelly" created="Wed, 9 Jan 2013 09:56:58 +0000"  >&lt;p&gt;awaitTermination doesn&apos;t force anything. It waits until any operations on the scheduler finish. #shutdownNow will force the operations to finish, but this patch doesn&apos;t use that. I&apos;m making a few changes now, and will attach a new patch shortly.&lt;/p&gt;</comment>
                            <comment id="13548353" author="ikelly" created="Wed, 9 Jan 2013 10:27:31 +0000"  >&lt;p&gt;New patch adds test and checks values of awaitTermination.&lt;/p&gt;</comment>
                            <comment id="13548356" author="ikelly" created="Wed, 9 Jan 2013 10:31:41 +0000"  >&lt;p&gt;Last patch was the wrong version, correct one added now.&lt;/p&gt;</comment>
                            <comment id="13548409" author="hadoopqa" created="Wed, 9 Jan 2013 11:32:03 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-538&quot; title=&quot;Race condition in BookKeeper#close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-538&quot;&gt;&lt;del&gt;BOOKKEEPER-538&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12563925/0001-BOOKKEEPER-538-Race-condition-in-BookKeeper-close.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-BOOKKEEPER-538-Race-condition-in-BookKeeper-close.patch&lt;/a&gt; downloaded at Wed Jan  9 11:01:48 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 1 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 783&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/224/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/224/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13548770" author="hustlmsp" created="Wed, 9 Jan 2013 18:21:39 +0000"  >&lt;p&gt;checked the javadoc about &apos;awaitTermination&apos; : Blocks until all tasks have completed execution after a shutdown request, or the timeout occurs, or the current thread is interrupted, whichever happens first.&lt;/p&gt;

&lt;p&gt;if timeout occurs or current thread is interrupted, is it possible that there are ongoing tasks in the executor? if so, is it possible to have the same issue?&lt;/p&gt;</comment>
                            <comment id="13549094" author="ikelly" created="Wed, 9 Jan 2013 22:20:44 +0000"  >&lt;blockquote&gt;
&lt;p&gt;if timeout occurs or current thread is interrupted, is it possible that there are ongoing tasks in the executor? if so, is it possible to have the same issue?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Technically, yes, this can happen if we have some bad logic somewhere that&apos;s running stuff in a loop. However, shutdown() will stop the executor from accepting any more tasks, so in reality this shouldn&apos;t happen. &lt;/p&gt;</comment>
                            <comment id="13549354" author="hustlmsp" created="Thu, 10 Jan 2013 04:50:20 +0000"  >&lt;p&gt;OK. I am fine with it. +1 for the patch.&lt;/p&gt;</comment>
                            <comment id="13549360" author="umamaheswararao" created="Thu, 10 Jan 2013 04:57:31 +0000"  >&lt;p&gt;Hi Ivan,&lt;/p&gt;

&lt;p&gt;Could you please check the below comment before committing? (I have posted this in my previous comment)&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Do you think we have to handle this at BookieClient itself. Client should not allow to open any new channels after closed it right? Not sure I missed something here.&lt;/p&gt;

&lt;p&gt;Current patch also looks good and ensuring all executors stopped before waiting to releaseExternalResources. I think this is the Netty behavior that if there are any channels in open state then this will hang. I have just seen an open issue in Jetty as well NETTY-391 similar to it. &lt;/p&gt;

&lt;p&gt;On answering the first comment +1 on this patch as this can fix the issue as well.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="13549363" author="hustlmsp" created="Thu, 10 Jan 2013 05:09:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=umamaheswararao&quot; class=&quot;user-hover&quot; rel=&quot;umamaheswararao&quot;&gt;Uma Maheswara Rao G&lt;/a&gt; If I understand your question correctly, this is what I suggested on my comments, it would be better to follow similar pattern use in hedwig client (hedwig-client/src/main/java/org/apache/hedwig/client/netty/CleanupChannelMap.java), which close any open channel after the client is closed. &lt;/p&gt;</comment>
                            <comment id="13549541" author="ikelly" created="Thu, 10 Jan 2013 11:12:37 +0000"  >&lt;p&gt;I&apos;ll add some code to BookieClient to block new connections after close.&lt;/p&gt;</comment>
                            <comment id="13549566" author="ikelly" created="Thu, 10 Jan 2013 12:24:26 +0000"  >&lt;p&gt;New patch blocks any new connections being made after close is called, along with the change in ordering of the executor shutdown from the previous patches.&lt;/p&gt;</comment>
                            <comment id="13549583" author="umamaheswararao" created="Thu, 10 Jan 2013 12:58:01 +0000"  >&lt;p&gt;Thanks a lot, Ivan for update on the patch!&lt;br/&gt;
closed variable can be volatile?&lt;br/&gt;
Other than that patch looks great to me. +1&lt;/p&gt;</comment>
                            <comment id="13549628" author="hadoopqa" created="Thu, 10 Jan 2013 13:30:39 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-538&quot; title=&quot;Race condition in BookKeeper#close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-538&quot;&gt;&lt;del&gt;BOOKKEEPER-538&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12564155/0001-BOOKKEEPER-538-Race-condition-in-BookKeeper-close.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-BOOKKEEPER-538-Race-condition-in-BookKeeper-close.patch&lt;/a&gt; downloaded at Thu Jan 10 12:59:22 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 1 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 786&lt;br/&gt;
.    Tests failed: 1&lt;br/&gt;
.    Tests errors: 0&lt;/p&gt;

&lt;p&gt;.    The patch failed the following testcases:&lt;/p&gt;

&lt;p&gt;.      testPeriodicCheckWhenDisabled(org.apache.bookkeeper.replication.AuditorPeriodicCheckTest)&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/235/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/235/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13549714" author="ikelly" created="Thu, 10 Jan 2013 15:34:01 +0000"  >&lt;p&gt;Added volatile for closed, though it&apos;s not strictly necessary. The read write lock should form a memory barrier.&lt;/p&gt;

&lt;p&gt;More importantly, fixed the AuditorPeriodicCheckTest issue. The problem had been there all along, but the fix for this made it trigger more. Basically, it was relying on the executor being shutdown later to allow it to check ledgers after the flag is set. As the test was, it was very very timing sensitive. It should be less so now.&lt;/p&gt;</comment>
                            <comment id="13549747" author="hadoopqa" created="Thu, 10 Jan 2013 16:12:31 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-538&quot; title=&quot;Race condition in BookKeeper#close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-538&quot;&gt;&lt;del&gt;BOOKKEEPER-538&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12564189/0001-BOOKKEEPER-538-Race-condition-in-BookKeeper-close.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-BOOKKEEPER-538-Race-condition-in-BookKeeper-close.patch&lt;/a&gt; downloaded at Thu Jan 10 15:41:24 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 2 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 786&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/236/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/236/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13549781" author="umamaheswararao" created="Thu, 10 Jan 2013 16:44:50 +0000"  >&lt;p&gt;Make sense. +1, go ahead and push this in.&lt;/p&gt;</comment>
                            <comment id="13549858" author="fpj" created="Thu, 10 Jan 2013 18:14:34 +0000"  >&lt;p&gt;+1, Thanks Ivan for the patch and Uma for reviewing. Committed revision 1431536.&lt;/p&gt;</comment>
                            <comment id="13549896" author="hudson" created="Thu, 10 Jan 2013 18:43:40 +0000"  >&lt;p&gt;Integrated in bookkeeper-trunk2 #52 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk2/52/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk2/52/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-538&quot; title=&quot;Race condition in BookKeeper#close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-538&quot;&gt;&lt;del&gt;BOOKKEEPER-538&lt;/del&gt;&lt;/a&gt;: Race condition in BookKeeper#close (ivank via fpj) (Revision 1431536)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
fpj : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeper.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieClient.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/util/OrderedSafeExecutor.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookKeeperTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorPeriodicCheckTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12615679">BOOKKEEPER-462</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12564189" name="0001-BOOKKEEPER-538-Race-condition-in-BookKeeper-close.patch" size="20291" author="ikelly" created="Thu, 10 Jan 2013 15:34:01 +0000"/>
                            <attachment id="12564155" name="0001-BOOKKEEPER-538-Race-condition-in-BookKeeper-close.patch" size="16792" author="ikelly" created="Thu, 10 Jan 2013 12:24:26 +0000"/>
                            <attachment id="12563925" name="0001-BOOKKEEPER-538-Race-condition-in-BookKeeper-close.patch" size="6210" author="ikelly" created="Wed, 9 Jan 2013 10:31:41 +0000"/>
                            <attachment id="12563921" name="0001-BOOKKEEPER-538-Race-condition-in-BookKeeper-close.patch" size="3100" author="ikelly" created="Wed, 9 Jan 2013 10:27:31 +0000"/>
                            <attachment id="12563795" name="0001-BOOKKEEPER-538-Race-condition-in-BookKeeper-close.patch" size="3100" author="ikelly" created="Tue, 8 Jan 2013 18:40:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 8 Jan 2013 18:56:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>303207</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz139b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>250370</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>