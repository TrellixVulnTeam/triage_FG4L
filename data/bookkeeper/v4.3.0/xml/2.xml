<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:29:06 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-2/BOOKKEEPER-2.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-2] bookkeeper does not put enough meta-data in to do recovery properly</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-2</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;somewhere, probably zookeeper, we need to keep track of the the information about keys used for access and for mac validation as well as the digest type for entries. we can&apos;t write a general recovery tool without it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12468954">BOOKKEEPER-2</key>
            <summary>bookkeeper does not put enough meta-data in to do recovery properly</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12553925">BOOKKEEPER-237</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ikelly">Ivan Kelly</assignee>
                                    <reporter username="breed">Benjamin Reed</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Jul 2010 21:40:40 +0100</created>
                <updated>Wed, 13 Feb 2013 15:46:26 +0000</updated>
                            <resolved>Wed, 18 Jul 2012 16:01:41 +0100</resolved>
                                                    <fixVersion>4.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="12972797" author="fpj" created="Sat, 18 Dec 2010 14:38:59 +0000"  >&lt;p&gt;Why can&apos;t we assume that the key is provided as part of the application input and let the application manage keys directly? It doesn&apos;t seem to be a good design choice to have BK managing keys on behalf of the application.&lt;/p&gt;</comment>
                            <comment id="13008544" author="dhruba" created="Fri, 18 Mar 2011 17:49:24 +0000"  >&lt;p&gt;hi flavio, can you pl explain your proposal in a little more detail? (please pardon my ignorance).&lt;/p&gt;</comment>
                            <comment id="13039543" author="fpj" created="Thu, 26 May 2011 08:11:02 +0100"  >&lt;p&gt;I just noticed that you had a comment here now, Dhruba. I was not really proposing anything, I was just pointing out that it didn&apos;t sound right to me to give keys to bookkeeper and expect it to manage it for the application. When I say manage, I mean having bookkeeper storing and using keys transparently for the application. &lt;/p&gt;</comment>
                            <comment id="13397759" author="ikelly" created="Wed, 20 Jun 2012 19:46:57 +0100"  >&lt;p&gt;Patch is pretty straight forward. For all new ledgers, store the password and digest type. They can then be opened without having to specify the password using asyncOpenLedger on BookKeeperAdmin. I&apos;ve only create async versions of the calls for now. We can add sync in future is people want them. This api isn&apos;t for general use, only from administrative tools.&lt;/p&gt;</comment>
                            <comment id="13399512" author="ikelly" created="Fri, 22 Jun 2012 19:52:17 +0100"  >&lt;p&gt;The patch applied on top of &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-303&quot; title=&quot;LedgerMetadata should serialized using protobufs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-303&quot;&gt;&lt;del&gt;BOOKKEEPER-303&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13403985" author="ikelly" created="Fri, 29 Jun 2012 17:01:06 +0100"  >&lt;p&gt;Updated to latest trunk.&lt;/p&gt;</comment>
                            <comment id="13409345" author="umamaheswararao" created="Mon, 9 Jul 2012 12:36:40 +0100"  >
&lt;p&gt;nit: BookKeeperAdmin: one unused import for DigestType.&lt;br/&gt;
as we are touching the file, I would suggest clean the imports as well.&lt;/p&gt;

&lt;p&gt;One question: since this is a metadat change, do we need to up the MetaDataVersion number, and add the version checks on deserialing digestType and metadat for more safe?&lt;/p&gt;

&lt;p&gt;@Sijie, It would be great if you take a look on it beased on your time?&lt;/p&gt;</comment>
                            <comment id="13409455" author="hustlmsp" created="Mon, 9 Jul 2012 14:37:29 +0100"  >&lt;p&gt;@Uma, sure. I would take a look today.&lt;/p&gt;</comment>
                            <comment id="13410071" author="hustlmsp" created="Tue, 10 Jul 2012 06:56:08 +0100"  >&lt;p&gt;the patch is good, but I had several questions:&lt;/p&gt;

&lt;p&gt;1) since we stored passwd and digest type on ledger metadata, if user provided wrong digest type or wrong passwd to open the ledger, why we don&apos;t fail the open request?&lt;/p&gt;

&lt;p&gt;And also in test cases I found you used fixed digestType to open the ledger. but the test cases would be ran with different digest types. The test case would create a ledger using DigestType.CRC32 and open it using DigestType.MAC. Do we allow doing this? &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        LedgerHandle lh = bkc.createLedger(3, 2, digestType, passwdA);

+        lh = bkc.openLedgerNoRecovery(ledgerId, BookKeeper.DigestType.MAC, passwdA);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2) ensurePasswordUsedForOldLedgers is a kind of backward compatibility test. why not move it to TestBackwardCompat? so we could know all incompatibles from a central entry.&lt;/p&gt;
</comment>
                            <comment id="13411698" author="ikelly" created="Wed, 11 Jul 2012 17:31:58 +0100"  >&lt;p&gt;New patch addresses comments and fixes some other minor issues.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;1) since we stored passwd and digest type on ledger metadata, if user provided wrong digest type or wrong passwd to open the ledger, why we don&apos;t fail the open request?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If the user provides the wrong password and digest to openLedger, it now fails. However, if the user configures a incorrect recovery password or digest, and the ledger has the correct password in the metadata already, no failure occurs during recovery, as all the necessary information is available.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2) ensurePasswordUsedForOldLedgers is a kind of backward compatibility test. why not move it to TestBackwardCompat? so we could know all incompatibles from a central entry.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It needs some things like #verifyFullyReplicated, which are only in BookieRecoveryTest.&lt;/p&gt;</comment>
                            <comment id="13414653" author="hustlmsp" created="Sun, 15 Jul 2012 16:00:10 +0100"  >&lt;p&gt;the new patch looks good to me. +1.&lt;/p&gt;</comment>
                            <comment id="13415178" author="hustlmsp" created="Mon, 16 Jul 2012 15:34:11 +0100"  >&lt;p&gt;@Uma, could you take a look at Ivan&apos;s new patch? &lt;/p&gt;</comment>
                            <comment id="13415544" author="umamaheswararao" created="Mon, 16 Jul 2012 20:13:45 +0100"  >&lt;p&gt;Thanks a lot, Ivan for the update on patch.&lt;br/&gt;
@Sijie, I will take  a look on this patch tomorrow morning.&lt;/p&gt;</comment>
                            <comment id="13416361" author="umamaheswararao" created="Tue, 17 Jul 2012 18:02:03 +0100"  >&lt;p&gt;+1 on the patch, It looks great to me&lt;/p&gt;

&lt;p&gt;Please take care of below tiny nit on committing the patch&lt;/p&gt;

&lt;p&gt;typo: &apos;adminisative&apos; &lt;br/&gt;
 /* For an adminisative open, the default passwords&lt;/p&gt;</comment>
                            <comment id="13417148" author="hustlmsp" created="Wed, 18 Jul 2012 16:01:41 +0100"  >&lt;p&gt;committed as r1362974. thanks Ivan&apos;s great work. thanks Uma for reviewing. &lt;/p&gt;</comment>
                            <comment id="13417173" author="hudson" created="Wed, 18 Jul 2012 16:31:29 +0100"  >&lt;p&gt;Integrated in bookkeeper-trunk #611 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/611/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/611/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-2&quot; title=&quot;bookkeeper does not put enough meta-data in to do recovery properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-2&quot;&gt;&lt;del&gt;BOOKKEEPER-2&lt;/del&gt;&lt;/a&gt;: bookkeeper does not put enough meta-data in to do recovery properly (ivank via sijie) (Revision 1362974)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
sijie : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeperAdmin.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DigestManager.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerCreateOp.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerMetadata.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerOpenOp.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/DataFormats.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/proto/DataFormats.proto&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookKeeperTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/meta/GcLedgersTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13417203" author="umamaheswararao" created="Wed, 18 Jul 2012 17:12:40 +0100"  >&lt;p&gt;First issue committed in AutoReplication work &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Great work, Ivan and Sijie.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12554512">BOOKKEEPER-246</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12554513">BOOKKEEPER-247</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12551786">BOOKKEEPER-221</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12459531">ZOOKEEPER-712</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                            <outwardlinks description="requires">
                                        <issuelink>
            <issuekey id="12595240">BOOKKEEPER-303</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12536049" name="BOOKKEEPER-2.diff" size="45766" author="ikelly" created="Wed, 11 Jul 2012 17:28:40 +0100"/>
                            <attachment id="12534000" name="BOOKKEEPER-2.diff" size="35186" author="ikelly" created="Fri, 29 Jun 2012 17:01:05 +0100"/>
                            <attachment id="12532742" name="BOOKKEEPER-2.diff" size="33910" author="ikelly" created="Wed, 20 Jun 2012 19:46:57 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 18 Dec 2010 14:38:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>102143</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy9own:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90514</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>