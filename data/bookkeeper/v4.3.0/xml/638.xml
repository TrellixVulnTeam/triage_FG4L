<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:31:15 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-638/BOOKKEEPER-638.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-638] Two bookies could start at the same time to access bookie data.</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-638</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;this issue is introduced in providing netty server for bookie.&lt;/p&gt;

&lt;p&gt;in &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-294&quot; title=&quot;Not able to start the bookkeeper before the ZK session timeout.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-294&quot;&gt;&lt;del&gt;BOOKKEEPER-294&lt;/del&gt;&lt;/a&gt;, we agreed on the start sequence of bookie:&lt;/p&gt;

&lt;p&gt;1) bind bookie port first (to avoid two processes running at the same host).&lt;br/&gt;
2) start bookie (e.g initialize bookie storage and replaying journals)&lt;br/&gt;
3) start nio server to accept incoming requests.&lt;/p&gt;

&lt;p&gt;but after refactoring for netty server, step 1) is combined to be executed in step 3), so two processes could have chance to run at the same time replaying journals. this is pretty bad.&lt;/p&gt;

&lt;p&gt;we need to change the code to stick on the sequence described above.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12655253">BOOKKEEPER-638</key>
            <summary>Two bookies could start at the same time to access bookie data.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hustlmsp">Sijie Guo</assignee>
                                    <reporter username="hustlmsp">Sijie Guo</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Jun 2013 02:34:35 +0100</created>
                <updated>Fri, 11 Oct 2013 15:57:58 +0100</updated>
                            <resolved>Fri, 11 Oct 2013 15:19:01 +0100</resolved>
                                    <version>4.3.0</version>
                                    <fixVersion>4.3.0</fixVersion>
                                    <component>bookkeeper-server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13701428" author="hustlmsp" created="Sat, 6 Jul 2013 23:03:49 +0100"  >&lt;p&gt;a patch following the sequence as described in Description section.&lt;/p&gt;</comment>
                            <comment id="13701436" author="hadoopqa" created="Sat, 6 Jul 2013 23:37:51 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-638&quot; title=&quot;Two bookies could start at the same time to access bookie data.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-638&quot;&gt;&lt;del&gt;BOOKKEEPER-638&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12591096/BOOKKEEPER-638.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-638.diff&lt;/a&gt; downloaded at Sat Jul  6 22:11:22 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch does not add/modify any testcase&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 853&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/411/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/411/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13731775" author="fpj" created="Wed, 7 Aug 2013 09:39:38 +0100"  >&lt;p&gt;Good catch, Sijie, +1.&lt;/p&gt;</comment>
                            <comment id="13791620" author="ikelly" created="Thu, 10 Oct 2013 17:06:32 +0100"  >&lt;p&gt;With the new sequence, it&apos;s possible a bookie could register with zk, a client sees it, tries to use it, and hit the RejectedRequestHandler. Its seems a bit strange. Couldn&apos;t we set the listening socket as unreadable, and then set it as readable when start is called, like what happens in suspendProcessing and resumeProcessing().&lt;/p&gt;</comment>
                            <comment id="13791714" author="hustlmsp" created="Thu, 10 Oct 2013 18:35:51 +0100"  >&lt;p&gt;&amp;gt;  a bookie could register with zk, &lt;/p&gt;

&lt;p&gt;a bookie only register itself after bookie is started. so in general, no write requests would be sent during startup.&lt;/p&gt;

&lt;p&gt;&amp;gt; a client sees it, tries to use it, and hit the RejectedRequestHandler. &lt;/p&gt;

&lt;p&gt;This is exactly what the patch tends to do. If a bookie is not ready (can&apos;t serving any request), we should fail any read/write request fast. A client can&apos;t be aware of a channel is turning to readable in server side, so it has to wait for timeout and retry other bookie, which introduce latency impact.&lt;/p&gt;</comment>
                            <comment id="13792615" author="ikelly" created="Fri, 11 Oct 2013 14:34:32 +0100"  >&lt;p&gt;Hmm, ok. The behaviour that would match 4.2 behaviour is to block until started, but I guess failing fast is better.&lt;/p&gt;

&lt;p&gt;+1 on the patch. Pushing in.&lt;/p&gt;</comment>
                            <comment id="13792647" author="ikelly" created="Fri, 11 Oct 2013 15:19:01 +0100"  >&lt;p&gt;Committed r1531302. Thanks Sijie.&lt;/p&gt;</comment>
                            <comment id="13792676" author="hudson" created="Fri, 11 Oct 2013 15:57:58 +0100"  >&lt;p&gt;SUCCESS: Integrated in bookkeeper-trunk #394 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/394/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/394/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-638&quot; title=&quot;Two bookies could start at the same time to access bookie data.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-638&quot;&gt;&lt;del&gt;BOOKKEEPER-638&lt;/del&gt;&lt;/a&gt;: Two bookies could start at the same time to access bookie data. (sijie via ivank) (ivank: rev 1531302)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieNettyServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12591096" name="BOOKKEEPER-638.diff" size="4791" author="hustlmsp" created="Sat, 6 Jul 2013 23:03:49 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 6 Jul 2013 22:37:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>335530</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzfpxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>335854</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>