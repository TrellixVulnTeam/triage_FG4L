<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:26:22 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-446/BOOKKEEPER-446.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-446] BookKeeper.createLedger(..) should not mask the error with ZKException</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-446</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;in &lt;tt&gt;BookKeeper.createLedger()&lt;/tt&gt; following code is masking the error with ZKException. Should throw the original exception to client.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (counter.getLh() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;ZooKeeper error: &quot;&lt;/span&gt; + counter.getrc());
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; BKException.create(Code.ZKException);
        }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="12613860">BOOKKEEPER-446</key>
            <summary>BookKeeper.createLedger(..) should not mask the error with ZKException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hustlmsp">Sijie Guo</assignee>
                                    <reporter username="vinayrpet">Vinayakumar B</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Oct 2012 08:32:02 +0000</created>
                <updated>Tue, 10 Sep 2013 14:43:08 +0100</updated>
                            <resolved>Tue, 10 Sep 2013 14:15:15 +0100</resolved>
                                    <version>4.2.0</version>
                                    <fixVersion>4.2.2</fixVersion>
                    <fixVersion>4.3.0</fixVersion>
                                    <component>bookkeeper-server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13485920" author="umamaheswararao" created="Mon, 29 Oct 2012 09:52:15 +0000"  >&lt;p&gt;Yep, we can see this.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            lh = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LedgerHandle(bk, ledgerId, metadata, digestType, passwd);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (GeneralSecurityException e) {
            LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Security exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; creating ledger: &quot;&lt;/span&gt; + ledgerId, e);
            cb.createComplete(BKException.Code.DigestNotInitializedException, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.ctx);
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (NumberFormatException e) {
            LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Incorrectly entered parameter throttle: &quot;&lt;/span&gt; + bk.getConf().getThrottleValue(), e);
            cb.createComplete(BKException.Code.IncorrectParameterException, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.ctx);
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
        }

and 

} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (BKNotEnoughBookiesException e) {
            LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Not enough bookies to create ledger&quot;&lt;/span&gt;);
            cb.createComplete(e.getCode(), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.ctx);
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
        }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here the actual exception was masked due to the check above mentioned. &lt;/p&gt;

&lt;p&gt;How about using the original rc while creating BKException.&lt;/p&gt;</comment>
                            <comment id="13485934" author="hustlmsp" created="Mon, 29 Oct 2012 10:19:59 +0000"  >&lt;p&gt;yes, we need to use the original rc. 1) which is the right exception, 2) make sync interface and async interface consistent to use same exception.&lt;/p&gt;</comment>
                            <comment id="13497246" author="ikelly" created="Wed, 14 Nov 2012 17:27:18 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13762174" author="rakeshr" created="Mon, 9 Sep 2013 20:11:54 +0100"  >&lt;p&gt;Updated patch. Please have a look at it. I&apos;m keeping &apos; if (counter.getrc() == BKException.Code.OK)&apos; condition to consider any exceptional case. &lt;/p&gt;

&lt;p&gt;Actually wants to remove this, Shall I go ahead?&lt;/p&gt;

&lt;p&gt;I think, this fix can go with 4.2.2. Feel free to change version if not applicable.&lt;/p&gt;</comment>
                            <comment id="13762232" author="hadoopqa" created="Mon, 9 Sep 2013 21:20:02 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-446&quot; title=&quot;BookKeeper.createLedger(..) should not mask the error with ZKException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-446&quot;&gt;&lt;del&gt;BOOKKEEPER-446&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12602188/0001-BOOKKEEPER-446-create-ledger-exceptions.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-BOOKKEEPER-446-create-ledger-exceptions.patch&lt;/a&gt; downloaded at Mon Sep  9 20:17:42 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; Patch failed to apply to head of branch&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;</comment>
                            <comment id="13762515" author="hustlmsp" created="Tue, 10 Sep 2013 01:28:51 +0100"  >&lt;p&gt;+ 4.3.0 release. I don&apos;t think that we should put one change only in 4.2.2 without merging back to trunk.&lt;/p&gt;</comment>
                            <comment id="13762595" author="hustlmsp" created="Tue, 10 Sep 2013 02:38:50 +0100"  >&lt;p&gt;I think we also need to clean up the return codes used in client package:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;in general, bookkeeper/ledger handle should not directly return &lt;b&gt;ZKException&lt;/b&gt;, since we allow non-zookeeper metadata managers. so they should use the return codes returned by &lt;b&gt;Op&lt;/b&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;there are still places returning zookeeper return code as bookkeeper return code. we should also clean them up.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;attached a new patch to clean up the bookkeeper client return codes.&lt;/li&gt;
	&lt;li&gt;add ReplicationException code for replication pipeline, rather than using ZKException&lt;/li&gt;
	&lt;li&gt;add UnexpectedConditionException code for unexpected conditions. e.g. ledgerCreateOp return OK with a null ledger handle, rather than using ZKException.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Besides that, provide two simple test cases in LedgerCreateDeleteTest rather than in ReadWriteTest.&lt;/p&gt;</comment>
                            <comment id="13762713" author="hadoopqa" created="Tue, 10 Sep 2013 05:37:40 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-446&quot; title=&quot;BookKeeper.createLedger(..) should not mask the error with ZKException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-446&quot;&gt;&lt;del&gt;BOOKKEEPER-446&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12602257/BOOKKEEPER-446.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-446.patch&lt;/a&gt; downloaded at Tue Sep 10 04:10:18 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 1 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 879&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/488/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/488/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13763027" author="ikelly" created="Tue, 10 Sep 2013 14:15:15 +0100"  >&lt;p&gt;Committed as r1521471 to branch-4.2&lt;br/&gt;
Committed r1521474 to trunk.&lt;/p&gt;

&lt;p&gt;Thanks guys.&lt;/p&gt;</comment>
                            <comment id="13763045" author="hudson" created="Tue, 10 Sep 2013 14:43:08 +0100"  >&lt;p&gt;SUCCESS: Integrated in bookkeeper-trunk #356 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/356/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/356/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-446&quot; title=&quot;BookKeeper.createLedger(..) should not mask the error with ZKException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-446&quot;&gt;&lt;del&gt;BOOKKEEPER-446&lt;/del&gt;&lt;/a&gt;: BookKeeper.createLedger(..) should not mask the error with ZKException (sijie via ivank) (ivank: rev 1521474)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BKException.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeper.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/FlatLedgerManager.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/HierarchicalLedgerManager.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/Auditor.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/test/LedgerCreateDeleteTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12602188" name="0001-BOOKKEEPER-446-create-ledger-exceptions.patch" size="8689" author="rakeshr" created="Mon, 9 Sep 2013 20:02:56 +0100"/>
                            <attachment id="12602257" name="BOOKKEEPER-446.patch" size="14235" author="hustlmsp" created="Tue, 10 Sep 2013 02:43:04 +0100"/>
                            <attachment id="12602256" name="BOOKKEEPER-446.patch" size="14218" author="hustlmsp" created="Tue, 10 Sep 2013 02:38:50 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 29 Oct 2012 09:52:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>252674</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy6wlj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74106</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>