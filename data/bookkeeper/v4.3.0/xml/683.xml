<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:27:40 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-683/BOOKKEEPER-683.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-683] TestSubAfterCloseSub fails on 4.2</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-683</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;Test failure when checking the release candidate.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12668348">BOOKKEEPER-683</key>
            <summary>TestSubAfterCloseSub fails on 4.2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jiannan">Jiannan Wang</assignee>
                                    <reporter username="fpj">Flavio Junqueira</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Sep 2013 21:27:44 +0100</created>
                <updated>Fri, 27 Sep 2013 11:12:16 +0100</updated>
                            <resolved>Fri, 27 Sep 2013 10:38:15 +0100</resolved>
                                                    <fixVersion>4.2.2</fixVersion>
                    <fixVersion>4.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13766648" author="jiannan" created="Fri, 13 Sep 2013 18:08:34 +0100"  >&lt;p&gt;The sequence flow of test case TestSubAfterCloseSub#runSubAfterCloseSubTest(false) is as follow:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;subscriber.subscribe(topic, subid, CreateOrAttach.CREATE_OR_ATTACH);&lt;/li&gt;
	&lt;li&gt;subscriber.asyncCloseSubscription(topic, subid, &#8230;)&lt;/li&gt;
	&lt;li&gt;subscriber.asyncSubscribe(topic, subid, CreateOrAttach.ATTACH, &#8230;)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;However, these two logs show that request (3) is handled before request (2) since it&apos;s sent in new channel:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-09-12 21:23:03,452 - INFO  - [DeliveryManagerThread:SubscribeHandler$1$1@206] - Subscribe request (1) for (topic:TestSubAfterCloseSub-false, subscriber:mysub) from channel /127.0.0.1:62996 succeed - its subscription data is State : { consumeSeqId: local:0 };Preferences : { System Preferences : [] };
2013-09-12 21:23:05,463 - INFO  - [DeliveryManagerThread:SubscribeHandler$1$1@206] - Subscribe request (2) for (topic:TestSubAfterCloseSub-false, subscriber:mysub) from channel /127.0.0.1:62997 succeed - its subscription data is State : { consumeSeqId: local:0 };Preferences : { System Preferences : [] };
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As a result, the subscription is in closed state when message is published which cause test failure. With above description, it&apos;s reasonable that Non-MultiplexClient fail on this case.&lt;/p&gt;

&lt;p&gt;@hustlmsp, the comment of the test case show that it&apos;s created for &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-507&quot; title=&quot;Race condition happens if closeSubscription and subscribe happened at the same time (in multiplexed client).&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-507&quot;&gt;&lt;del&gt;BOOKKEEPER-507&lt;/del&gt;&lt;/a&gt;. However, &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-507&quot; title=&quot;Race condition happens if closeSubscription and subscribe happened at the same time (in multiplexed client).&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-507&quot;&gt;&lt;del&gt;BOOKKEEPER-507&lt;/del&gt;&lt;/a&gt; aims to fix race condition issue for multiplexed client. So my fix is just remove it, please notify me if a new case is required.&lt;/p&gt;</comment>
                            <comment id="13766669" author="jiannan" created="Fri, 13 Sep 2013 18:20:44 +0100"  >&lt;p&gt;Thinking more about the fix, maybe we need more work, or else we would better to warn user the fact that simplex client doesn&apos;t guarantee the order of asynchronized call in somewhere.&lt;/p&gt;</comment>
                            <comment id="13766698" author="hadoopqa" created="Fri, 13 Sep 2013 18:39:00 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-683&quot; title=&quot;TestSubAfterCloseSub fails on 4.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-683&quot;&gt;&lt;del&gt;BOOKKEEPER-683&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12603046/BOOKKEEPER-683.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-683.patch&lt;/a&gt; downloaded at Fri Sep 13 17:11:14 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 1 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 878&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/493/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/493/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13766830" author="ikelly" created="Fri, 13 Sep 2013 20:11:02 +0100"  >&lt;p&gt;The ordering thing is a known issue. &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-37&quot; title=&quot;Ordering of published messages is not preserved when doing asynchronous publication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-37&quot;&gt;BOOKKEEPER-37&lt;/a&gt;. I think the test failure can be handled in this patch, and then we can fix &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-37&quot; title=&quot;Ordering of published messages is not preserved when doing asynchronous publication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-37&quot;&gt;BOOKKEEPER-37&lt;/a&gt; later. The fix for it would be far too large for 4.2.2 in any case. Thanks for taking a look at this.&lt;/p&gt;</comment>
                            <comment id="13767298" author="jiannan" created="Sat, 14 Sep 2013 03:05:12 +0100"  >&lt;p&gt;Ok, then comment the test case instead of removing it would be better. After we fix &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-37&quot; title=&quot;Ordering of published messages is not preserved when doing asynchronous publication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-37&quot;&gt;BOOKKEEPER-37&lt;/a&gt;, uncomment it to add the case back. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hustlmsp&quot; class=&quot;user-hover&quot; rel=&quot;hustlmsp&quot;&gt;Sijie Guo&lt;/a&gt;, what&apos;s your opinion?&lt;/p&gt;</comment>
                            <comment id="13768014" author="hustlmsp" created="Mon, 16 Sep 2013 03:41:08 +0100"  >&lt;p&gt;I am OK with your solution, let&apos;s not block 4.2 release right now and seek a solution for &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-37&quot; title=&quot;Ordering of published messages is not preserved when doing asynchronous publication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-37&quot;&gt;BOOKKEEPER-37&lt;/a&gt; later.&lt;/p&gt;</comment>
                            <comment id="13768030" author="jiannan" created="Mon, 16 Sep 2013 04:21:04 +0100"  >&lt;p&gt;Comment the test case instead of removing it, so that we can add it back after &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-37&quot; title=&quot;Ordering of published messages is not preserved when doing asynchronous publication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-37&quot;&gt;BOOKKEEPER-37&lt;/a&gt; is fixed.&lt;/p&gt;</comment>
                            <comment id="13768044" author="hadoopqa" created="Mon, 16 Sep 2013 04:58:20 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-683&quot; title=&quot;TestSubAfterCloseSub fails on 4.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-683&quot;&gt;&lt;del&gt;BOOKKEEPER-683&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12603268/BOOKKEEPER-683.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-683.patch&lt;/a&gt; downloaded at Mon Sep 16 03:30:58 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 1 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 878&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;&lt;b&gt;+1 Overall result, good!, no -1s&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/495/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/495/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13779795" author="ikelly" created="Fri, 27 Sep 2013 10:38:15 +0100"  >&lt;p&gt;Committed r1526841 to trunk&lt;br/&gt;
Committed r1526839 to branch-4.2&lt;/p&gt;</comment>
                            <comment id="13779805" author="hudson" created="Fri, 27 Sep 2013 11:12:16 +0100"  >&lt;p&gt;SUCCESS: Integrated in bookkeeper-trunk #374 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/374/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/374/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-683&quot; title=&quot;TestSubAfterCloseSub fails on 4.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-683&quot;&gt;&lt;del&gt;BOOKKEEPER-683&lt;/del&gt;&lt;/a&gt;: TestSubAfterCloseSub fails on 4.2 (jiannan via ivank) (ivank: rev 1526841)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/hedwig-server/src/test/java/org/apache/hedwig/client/TestSubAfterCloseSub.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12603268" name="BOOKKEEPER-683.patch" size="837" author="jiannan" created="Mon, 16 Sep 2013 04:21:04 +0100"/>
                            <attachment id="12603046" name="BOOKKEEPER-683.patch" size="1668" author="jiannan" created="Fri, 13 Sep 2013 18:07:38 +0100"/>
                            <attachment id="12602871" name="org.apache.hedwig.client.TestSubAfterCloseSub-output.txt" size="107194" author="fpj" created="Thu, 12 Sep 2013 21:28:49 +0100"/>
                            <attachment id="12602872" name="org.apache.hedwig.client.TestSubAfterCloseSub.txt" size="2701" author="fpj" created="Thu, 12 Sep 2013 21:28:49 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 13 Sep 2013 17:08:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>348282</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzhwdb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>348578</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>