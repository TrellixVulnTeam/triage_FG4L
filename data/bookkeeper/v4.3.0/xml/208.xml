<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:29:34 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-208/BOOKKEEPER-208.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-208] Separate write quorum from ack quorum</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-208</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;There are use cases for bookkeeper that may require submitting add requests to a write set and returning upon receiving a confirmation from an ack set. The ack set must be a subset of the write set. An important special case is writing to all and returning upon hearing from a majority. Another important use case is avoiding &lt;b&gt;s&lt;/b&gt; slow disks by writing to &lt;b&gt;f + s + 1&lt;/b&gt; and returning upon receiving &lt;b&gt;f + 1&lt;/b&gt; responses.&lt;/p&gt;

&lt;p&gt;Currently, the write set and the ack set are the same for a ledger. Internal changes to support these cases include changes to LedgerHandle and PendingAddOp. We also need to add a call to the client API to accept different sizes for the write set and the ack set upon ledger creation.&lt;/p&gt;

&lt;p&gt;It is also open for the discussion the need to implement a new distribution schedule. So far it looks like we can reuse the round robin implementation we currently have. We would need to implement a new one if, for example, the initial bookie of an add operation must be always the same.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12549521">BOOKKEEPER-208</key>
            <summary>Separate write quorum from ack quorum</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ikelly">Ivan Kelly</assignee>
                                    <reporter username="fpj">Flavio Junqueira</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Apr 2012 16:34:46 +0100</created>
                <updated>Wed, 13 Feb 2013 15:46:39 +0000</updated>
                            <resolved>Wed, 12 Sep 2012 11:09:35 +0100</resolved>
                                                    <fixVersion>4.2.0</fixVersion>
                                    <component>bookkeeper-client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13246404" author="ikelly" created="Wed, 4 Apr 2012 17:04:51 +0100"  >&lt;p&gt;Here&apos;s a rough draft of what I think it should look like. We can continue to use the RoundRobin scheduler, but write and ack quorum are separate entities now.&lt;/p&gt;</comment>
                            <comment id="13246451" author="fpj" created="Wed, 4 Apr 2012 17:39:49 +0100"  >&lt;p&gt;Thanks, Ivan. I had a look and the general direction seems fine to me. I understand this is rough cut, but just to make sure we are seeing it the same way, a couple of things I believe are missing are a new call to create a ledger and a new constructor for LedgerHandle. Does it sound right to you? &lt;/p&gt;</comment>
                            <comment id="13269767" author="ikelly" created="Mon, 7 May 2012 17:51:26 +0100"  >&lt;p&gt;Another cut at this patch. Includes client and a few tests now.&lt;/p&gt;</comment>
                            <comment id="13284350" author="rakeshr" created="Mon, 28 May 2012 10:45:38 +0100"  >&lt;p&gt;Hi Ivan,&lt;/p&gt;

&lt;p&gt;I had a quick look on the latest patch and the concept of write &amp;amp; ack quorum looks nice to me. &lt;/p&gt;

&lt;p&gt;Just I&apos;m having following suggestion.&lt;/p&gt;

&lt;p&gt;The BK client will maintains separate Write-Queue for each Bookie. What I&apos;m thinking is, quorumWrites will do parallely for each entries and it can be asynchronously at the PendingAddOp level. Does it sound good to you?.&lt;/p&gt;

&lt;p&gt;PendingAddOp.java&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        for (int bookieIndex : lh.distributionSchedule.getWriteSet(entryId)) {
            sendWriteRequest(bookieIndex);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13432699" author="ikelly" created="Fri, 10 Aug 2012 12:04:35 +0100"  >&lt;p&gt;Patch is ready to go in my opinion.&lt;/p&gt;</comment>
                            <comment id="13440353" author="hustlmsp" created="Thu, 23 Aug 2012 15:57:01 +0100"  >&lt;p&gt;the patch looks good to me. +1&lt;/p&gt;</comment>
                            <comment id="13441141" author="rakeshr" created="Fri, 24 Aug 2012 14:40:07 +0100"  >&lt;p&gt;Hi Ivan, The idea and the patch looks great. I&apos;ve missed the following comments previously&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;#1)&lt;br/&gt;
There are few cross overs with &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-247&quot; title=&quot;Detection of under replication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-247&quot;&gt;&lt;del&gt;BOOKKEEPER-247&lt;/del&gt;&lt;/a&gt; patch, which had committed recently. Please rebase the patch in latest trunk.&lt;br/&gt;
Few compilation errors in RoundRobinDistributionSchedule.java, LedgerChecker.java,  etc &lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;#2)&lt;br/&gt;
CURRENT_METADATA_FORMAT_VERSION&lt;br/&gt;
Since we are modifying the ledger metadata, does it required to increment the version?&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;#3)&lt;br/&gt;
Missing javadocs, will help to quickly convey the idea.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; AckSet {
+        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; addBookieAndCheck(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; bookieIndexHeardFrom);
+        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void removeBookie(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; bookie);
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;hr /&gt;
&lt;p&gt;#4)&lt;br/&gt;
I haven&apos;t seen anywhere this ctor is used and good to remove it. Since we are not planning to &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; RoundRobinDistributionSchedule(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; quorumSize, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; ensembleSize) {
-        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.quorumSize = quorumSize;
+        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.writeQuorumSize = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.ackQuorumSize = quorumSize;
         &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.ensembleSize = ensembleSize;
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;hr /&gt;
&lt;p&gt;#5)&lt;br/&gt;
I could see one scenario of handleFailure(). Say I got a failure response from slow bookie as writeFailed and going for handleBookieFailure. Mean time the addEntry() would go ahead with next entry and sendWrite() request. There will be a concurrency issues between these two flows.&lt;/p&gt;

&lt;p&gt;I feel, Bookkeeper-337 should go with this issue to handle concurrent handleFailures.&lt;/p&gt;</comment>
                            <comment id="13442478" author="ikelly" created="Mon, 27 Aug 2012 16:38:33 +0100"  >&lt;p&gt;Re: #5 &lt;br/&gt;
You&apos;re right. There&apos;s a window where entries will continue to write to the old bookie, even though we&apos;ve added a new bookie to the ensemble. I think &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-337&quot; title=&quot;Add entry fails with MetadataVersionException when last ensemble has morethan one bookie failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-337&quot;&gt;&lt;del&gt;BOOKKEEPER-337&lt;/del&gt;&lt;/a&gt; will handle some of it, but really we need to block all completions of add operations once we&apos;ve taken the decision to replace a bookie. More specifically, once we take the lastAddConfirmed + 1 to set the start entry of the segment, no entry after that can be confirmed to the client until the bookie has been replaced in the ensemble.&lt;/p&gt;</comment>
                            <comment id="13442479" author="ikelly" created="Mon, 27 Aug 2012 16:39:47 +0100"  >&lt;p&gt;Patch rebased on trunk and adds test for bookie failure (currently fails).&lt;/p&gt;</comment>
                            <comment id="13442508" author="ikelly" created="Mon, 27 Aug 2012 17:29:54 +0100"  >&lt;p&gt;Re: #2&lt;br/&gt;
We haven&apos;t released a version since bumping it to 2, so it doesn&apos;t need to be bumped again. Production should be using an official release.&lt;/p&gt;</comment>
                            <comment id="13443071" author="ikelly" created="Tue, 28 Aug 2012 12:14:13 +0100"  >&lt;p&gt;New patch addresses all of &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rakeshr&quot; class=&quot;user-hover&quot; rel=&quot;rakeshr&quot;&gt;Rakesh R&lt;/a&gt;&apos;s comments.&lt;/p&gt;</comment>
                            <comment id="13444882" author="rakeshr" created="Thu, 30 Aug 2012 12:24:57 +0100"  >&lt;p&gt;Good work Ivan, latest patch looks fine.&lt;/p&gt;

&lt;p&gt;+1 from me&lt;/p&gt;</comment>
                            <comment id="13444985" author="ikelly" created="Thu, 30 Aug 2012 15:38:39 +0100"  >&lt;p&gt;I have forgotten javadoc for the new BookKeeper#createLedger call. Added now. Could someone check it out.&lt;/p&gt;</comment>
                            <comment id="13452840" author="hustlmsp" created="Tue, 11 Sep 2012 10:19:35 +0100"  >&lt;p&gt;the latest patch looks good to me. +1.&lt;/p&gt;

&lt;p&gt;since that it changed the client, I think it would be better to change hedwig too, to let it use the latest api so user could configure writeQuorumSize and ackQuorumSize. It would be a separated jira. I would create one to do it.&lt;/p&gt;</comment>
                            <comment id="13453877" author="ikelly" created="Wed, 12 Sep 2012 11:09:35 +0100"  >&lt;p&gt;Committed as r1383872. Thanks for reviewing guys.&lt;/p&gt;</comment>
                            <comment id="13453926" author="hudson" created="Wed, 12 Sep 2012 13:04:03 +0100"  >&lt;p&gt;Integrated in bookkeeper-trunk #704 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/704/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/704/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-208&quot; title=&quot;Separate write quorum from ack quorum&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-208&quot;&gt;&lt;del&gt;BOOKKEEPER-208&lt;/del&gt;&lt;/a&gt;: Separate write quorum from ack quorum (ivank) (Revision 1383872)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
ivank : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-benchmark/src/main/java/org/apache/bookkeeper/benchmark/BenchThroughputLatency.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeper.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DistributionSchedule.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerChecker.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerCreateOp.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerMetadata.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingAddOp.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/RoundRobinDistributionSchedule.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ClientConfiguration.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/DataFormats.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/proto/DataFormats.proto&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/client/RoundRobinDistributionScheduleTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/client/SlowBookieTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestLedgerChecker.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestReadTimeout.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/meta/GcLedgersTest.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookKeeperClusterTestCase.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12598127">BOOKKEEPER-336</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12607023">BOOKKEEPER-399</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12543098" name="BOOKKEEPER-208.diff" size="60445" author="ikelly" created="Thu, 30 Aug 2012 15:38:39 +0100"/>
                            <attachment id="12542747" name="BOOKKEEPER-208.diff" size="57090" author="ikelly" created="Tue, 28 Aug 2012 12:14:13 +0100"/>
                            <attachment id="12542613" name="BOOKKEEPER-208.diff" size="52258" author="ikelly" created="Mon, 27 Aug 2012 16:39:47 +0100"/>
                            <attachment id="12540471" name="BOOKKEEPER-208.diff" size="47023" author="ikelly" created="Fri, 10 Aug 2012 12:04:35 +0100"/>
                            <attachment id="12525872" name="BOOKKEEPER-208.diff" size="37812" author="ikelly" created="Mon, 7 May 2012 17:51:26 +0100"/>
                            <attachment id="12521326" name="BOOKKEEPER-208.diff" size="12978" author="ikelly" created="Wed, 4 Apr 2012 17:04:51 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 4 Apr 2012 16:04:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>234512</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyn6k7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>169250</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>