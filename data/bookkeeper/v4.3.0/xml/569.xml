<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:32:37 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-569/BOOKKEEPER-569.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-569] Critical performance bug in InterleavedLedgerStorage</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-569</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;There&apos;s a synchronization on InterleavedLedgerStorage#flush(), which kills performance when you&apos;re writing to many ledgers on a single bookie. Both #flush and #addEntry are synchronized, which blocks any adds being serviced while the sync thread is running.&lt;/p&gt;

&lt;p&gt;The sync on #addEntry has always been there, but on #flush it has only existed since &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-293&quot; title=&quot;Periodic checking of ledger replication status&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-293&quot;&gt;&lt;del&gt;BOOKKEEPER-293&lt;/del&gt;&lt;/a&gt;. The addition was obviously a mistake.&lt;/p&gt;

&lt;p&gt;Fix is simply to remove it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12632238">BOOKKEEPER-569</key>
            <summary>Critical performance bug in InterleavedLedgerStorage</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ikelly">Ivan Kelly</assignee>
                                    <reporter username="ikelly">Ivan Kelly</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Feb 2013 17:00:14 +0000</created>
                <updated>Sat, 16 Feb 2013 15:44:19 +0000</updated>
                            <resolved>Sat, 16 Feb 2013 15:04:17 +0000</resolved>
                                                    <fixVersion>4.2.1</fixVersion>
                    <fixVersion>4.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13577756" author="fpj" created="Wed, 13 Feb 2013 17:34:34 +0000"  >&lt;p&gt;I have a few questions here:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Why is addEntry synchronized? Other than flush, it seems to be the only other synchronized method.&lt;/li&gt;
	&lt;li&gt;Both addEntry and flush access ledgerCache. Are you sure that making flush unsynchronized will not cause any race?&lt;/li&gt;
	&lt;li&gt;What exactly makes you think it is an obvious mistake, other than you being the author of the 293 patch?&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13577769" author="ikelly" created="Wed, 13 Feb 2013 17:47:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;1. Why is addEntry synchronized? Other than flush, it seems to be the only other synchronized method.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It doesn&apos;t necessarily have to be, as EntryLogger#addEntry is synchronized and LedgerCacheImpl seems quite threadsafe. It has always been synchronized though, so I don&apos;t want to change it without good reason.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;2. Both addEntry and flush access ledgerCache. Are you sure that making flush unsynchronized will not cause any race?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;ledgerCache is threadsafe as far as I can see. Also, up until Jan 4, flush was no unsynchronized, as it didn&apos;t present a problem.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;3. What exactly makes you think it is an obvious mistake, other than you being the author of the 293 patch? &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Its completely unrelated to the patch. Usually, for a change like that, unrelated to the issue, I&apos;d have noted why I did it in the jira or added a comment. I think I had been touching that code to make it accessible for the tests, and changed it back wrong. I need to check at home, as thats the repo the original changes were in. &lt;/p&gt;</comment>
                            <comment id="13577773" author="hadoopqa" created="Wed, 13 Feb 2013 17:52:21 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-569&quot; title=&quot;Critical performance bug in InterleavedLedgerStorage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-569&quot;&gt;&lt;del&gt;BOOKKEEPER-569&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12569224/0001-BOOKKEEPER-569-Critical-performance-issue-in-Interle.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-BOOKKEEPER-569-Critical-performance-issue-in-Interle.patch&lt;/a&gt; downloaded at Wed Feb 13 17:22:11 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch does not add/modify any testcase&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 815&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/269/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/269/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13578937" author="hustlmsp" created="Fri, 15 Feb 2013 04:27:31 +0000"  >&lt;p&gt;+1 for this change. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpj&quot; class=&quot;user-hover&quot; rel=&quot;fpj&quot;&gt;Flavio Junqueira&lt;/a&gt; how is your opinion on Ivan&apos;s replies? If there is +1 from you, the patch is ready to be in.&lt;/p&gt;</comment>
                            <comment id="13579571" author="fpj" created="Fri, 15 Feb 2013 22:56:32 +0000"  >&lt;p&gt;+1, looks good.&lt;/p&gt;</comment>
                            <comment id="13579803" author="fpj" created="Sat, 16 Feb 2013 15:04:18 +0000"  >&lt;p&gt;Trunk: Committed revision 1446902.&lt;br/&gt;
Branch 4.2: Committed revision 1446900.&lt;/p&gt;</comment>
                            <comment id="13579805" author="hudson" created="Sat, 16 Feb 2013 15:44:19 +0000"  >&lt;p&gt;Integrated in bookkeeper-trunk #106 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/106/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/106/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-569&quot; title=&quot;Critical performance bug in InterleavedLedgerStorage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-569&quot;&gt;&lt;del&gt;BOOKKEEPER-569&lt;/del&gt;&lt;/a&gt;: Critical performance bug in InterleavedLedgerStorage (ivank via fpj) (Revision 1446902)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
fpj : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/InterleavedLedgerStorage.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12569224" name="0001-BOOKKEEPER-569-Critical-performance-issue-in-Interle.patch" size="1047" author="ikelly" created="Wed, 13 Feb 2013 17:02:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 13 Feb 2013 17:34:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>312734</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzbthz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>313080</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>