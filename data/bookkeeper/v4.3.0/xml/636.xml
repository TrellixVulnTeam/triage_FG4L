<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat May 16 23:31:13 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/BOOKKEEPER-636/BOOKKEEPER-636.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[BOOKKEEPER-636] Latest txn logs might be deleted in a race condition which is not recoverable if BK goes down before next txn log created.</title>
                <link>https://issues.apache.org/jira/browse/BOOKKEEPER-636</link>
                <project id="12311293" key="BOOKKEEPER">Bookkeeper</project>
                    <description>&lt;p&gt;With the following scenario latest transaction log can be deleted.&lt;/p&gt;

&lt;p&gt;1. more than &lt;tt&gt;journalMaxBackups&lt;/tt&gt; txn logs are there in journal dir.&lt;br/&gt;
2. BK machine was up for long time and the latest txn log id is some what huge number&lt;br/&gt;
3. Now reboot the machine.&lt;br/&gt;
4. after reboot BK restarted.&lt;br/&gt;
5. Now, Immediately after startup, One entry is added, due to which Synthread rolled the lastMark in ledger dirs before the lastLogId updated by Journal thread. (this lastMark was having the old logId which was before reboot). &lt;br/&gt;
6. Now after roll, old journal txn logs were gc&apos;ed. &lt;b&gt;Now latest created the txn log was deleted.&lt;/b&gt;&lt;br/&gt;
7. After this Journal thread updated the lastLogMark, also some more rolls happened.&lt;br/&gt;
8. Now BK restarted again. But BK was not able to start because it was not able to find the latest txn log file in journal directory.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.io.IOException: Recovery log 264564 is missing
        at org.apache.bookkeeper.bookie.Journal.replay(Journal.java:424)
        at org.apache.bookkeeper.bookie.Bookie.readJournal(Bookie.java:547)
        at org.apache.bookkeeper.bookie.Bookie.start(Bookie.java:603)
        at org.apache.bookkeeper.proto.BookieServer.start(BookieServer.java:111)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12654976">BOOKKEEPER-636</key>
            <summary>Latest txn logs might be deleted in a race condition which is not recoverable if BK goes down before next txn log created.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vinayrpet">Vinayakumar B</assignee>
                                    <reporter username="vinayrpet">Vinayakumar B</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Jun 2013 18:47:06 +0100</created>
                <updated>Thu, 4 Jul 2013 16:19:46 +0100</updated>
                            <resolved>Thu, 4 Jul 2013 16:19:46 +0100</resolved>
                                    <version>4.2.1</version>
                    <version>4.3.0</version>
                                    <fixVersion>4.2.2</fixVersion>
                    <fixVersion>4.3.0</fixVersion>
                                    <component>bookkeeper-server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="13694114" author="vinayrpet" created="Wed, 26 Jun 2013 18:48:08 +0100"  >&lt;p&gt;Adding analysis to avoid very big description.&lt;/p&gt;


&lt;p&gt;Analysis:&lt;br/&gt;
------------&lt;br/&gt;
1. EveryTime new journal txn log will be created with the nanoTime() as the id.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; == logFile) {
                    logId = MathUtils.now();
                    logFile = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JournalChannel(journalDirectory, logId);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2. System.nanoTime() is the relative time with the system startup. It will start from 0 everytime system re-started. refer &lt;a href=&quot;http://java.dzone.com/articles/how-arbitary-start&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://java.dzone.com/articles/how-arbitary-start&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;3. before reboot, last txn logId was very huge, but just after restart, latest txn id became &lt;b&gt;40974.txn&lt;/b&gt;. 1c9d2f436.txn  was the last txn file.&lt;br/&gt;
 As part of first roll latest txn file was garbage collected.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-06-25 14:38:14,730 - INFO  [SyncThread:Journal@341] - garbage collected journal 40974.txn&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;4. After this one more restart gave the problem.&lt;/p&gt;


&lt;p&gt;&lt;b&gt;Conclusion&lt;/b&gt;:&lt;br/&gt;
We should not use &lt;tt&gt;System.nanoTime()&lt;/tt&gt; for the storage and compare purposes.&lt;/p&gt;</comment>
                            <comment id="13694120" author="vinayrpet" created="Wed, 26 Jun 2013 18:55:00 +0100"  >&lt;p&gt;Attaching a draft patch.&lt;br/&gt;
Didn&apos;t get how can I write a test for this scenario.&lt;/p&gt;</comment>
                            <comment id="13694398" author="hustlmsp" created="Thu, 27 Jun 2013 02:19:49 +0100"  >&lt;p&gt;good catch, Vinay. but the patch make things complicated, you don&apos;t need to introduce another file, it is easy to get the max journal file id from journal directory, and you just need to guarantee next journal id is large than max journal file id in journal directory when startup.&lt;/p&gt;

&lt;p&gt;And I think we don&apos;t need to add another method, we should use System.currentTimeMillis and add a comment about this case.&lt;/p&gt;

&lt;p&gt;attach a patch to simplify things.&lt;/p&gt;</comment>
                            <comment id="13694429" author="hadoopqa" created="Thu, 27 Jun 2013 03:20:17 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-636&quot; title=&quot;Latest txn logs might be deleted in a race condition which is not recoverable if BK goes down before next txn log created.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-636&quot;&gt;&lt;del&gt;BOOKKEEPER-636&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12589821/BOOKKEEPER-636.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-636.diff&lt;/a&gt; downloaded at Thu Jun 27 01:54:00 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch contains 1 line(s) longer than 120 characters&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch does not add/modify any testcase&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 852&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/395/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/395/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13694468" author="vinayrpet" created="Thu, 27 Jun 2013 05:06:25 +0100"  >&lt;p&gt;Thanks Sijie.. Patch is Simple indeed. +1.&lt;/p&gt;</comment>
                            <comment id="13694473" author="rakeshr" created="Thu, 27 Jun 2013 05:12:06 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hustlmsp&quot; class=&quot;user-hover&quot; rel=&quot;hustlmsp&quot;&gt;Sijie Guo&lt;/a&gt;&lt;br/&gt;
Is it required to make journalid more random using the System.currentTimeInMillis(), can we make the journalid in sequence as follows.&lt;br/&gt;
I feel, it simplifies debugging.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; newLogId = logId + 1;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13695246" author="hustlmsp" created="Fri, 28 Jun 2013 04:58:17 +0100"  >&lt;p&gt;no preference, just tried to keep it consistent with before. I am OK to change it in sequence.&lt;/p&gt;</comment>
                            <comment id="13695250" author="umamaheswararao" created="Fri, 28 Jun 2013 05:13:52 +0100"  >&lt;p&gt;+1 for this idea to keep incrementing by &apos;+1&apos;. This should avoid even that timeofday changes as well. May be on startup of process we consider System.currentTimeInMillis() and from then we keep increment the logid.&lt;/p&gt;</comment>
                            <comment id="13695536" author="ikelly" created="Fri, 28 Jun 2013 17:03:03 +0100"  >&lt;p&gt;+1 on the +1 thing. It will also stop concurrent bookie instances from starting if we enforce that to write to journal id X+1, this current process must have created the file for that journal (we should use File#createNewFile).&lt;/p&gt;</comment>
                            <comment id="13696068" author="vinayrpet" created="Sat, 29 Jun 2013 08:19:32 +0100"  >&lt;p&gt;Just updated the Sijie&apos;s patch to update the logId with +1.&lt;/p&gt;</comment>
                            <comment id="13696074" author="hadoopqa" created="Sat, 29 Jun 2013 09:41:08 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-636&quot; title=&quot;Latest txn logs might be deleted in a race condition which is not recoverable if BK goes down before next txn log created.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-636&quot;&gt;&lt;del&gt;BOOKKEEPER-636&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12590157/BOOKKEEPER-636.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-636.patch&lt;/a&gt; downloaded at Sat Jun 29 08:14:50 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch does not add/modify any testcase&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 853&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/397/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/397/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13696076" author="umamaheswararao" created="Sat, 29 Jun 2013 10:25:28 +0100"  >&lt;p&gt;Thanks Vinay for the patch. +1&lt;br/&gt;
If others also agree on it, I will go for commit.&lt;/p&gt;</comment>
                            <comment id="13696077" author="umamaheswararao" created="Sat, 29 Jun 2013 10:27:48 +0100"  >&lt;p&gt;@Ivan,&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt; It will also stop concurrent bookie instances from starting if we enforce that to write to journal id X+1, this current process must have created the file for that journal (we should use File#createNewFile).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I did not notice your comment above. Ar you expecting this ceateNewFIle change also in this patch? Right now we use RandomAccessFile I think and also we take position for seeking.&lt;/p&gt;</comment>
                            <comment id="13696210" author="hustlmsp" created="Sat, 29 Jun 2013 23:43:32 +0100"  >&lt;p&gt;we could assign the timestamp when instantiating the logId. we don&apos;t need to check the logId when incrementing it.&lt;/p&gt;</comment>
                            <comment id="13696216" author="hadoopqa" created="Sun, 30 Jun 2013 00:27:47 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-636&quot; title=&quot;Latest txn logs might be deleted in a race condition which is not recoverable if BK goes down before next txn log created.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-636&quot;&gt;&lt;del&gt;BOOKKEEPER-636&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12590185/BOOKKEEPER-636.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;BOOKKEEPER-636.diff&lt;/a&gt; downloaded at Sat Jun 29 23:01:30 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch does not add/modify any testcase&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 853&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/399/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/399/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13697985" author="ikelly" created="Tue, 2 Jul 2013 18:05:11 +0100"  >&lt;p&gt;The createNewFile change is very small, and ensures two processes don&apos;t make a mess of each others journals. I&apos;m not sure two processes could even get this far, but it&apos;s better to be safe than sorry. (i&apos;ve attached a patch with includes this change)&lt;/p&gt;</comment>
                            <comment id="13698024" author="hadoopqa" created="Tue, 2 Jul 2013 18:37:50 +0100"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-636&quot; title=&quot;Latest txn logs might be deleted in a race condition which is not recoverable if BK goes down before next txn log created.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-636&quot;&gt;&lt;del&gt;BOOKKEEPER-636&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12590465/0001-BOOKKEEPER-636-Latest-txn-logs-might-be-deleted-in-a.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;0001-BOOKKEEPER-636-Latest-txn-logs-might-be-deleted-in-a.patch&lt;/a&gt; downloaded at Tue Jul  2 17:11:30 UTC 2013&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any line longer than 120&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch does not add/modify any testcase&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 FINDBUGS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Findbugs warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 853&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/401/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk-precommit-build/401/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13699890" author="vinayrpet" created="Thu, 4 Jul 2013 11:03:17 +0100"  >&lt;p&gt;+1 for the new changes ivan. &lt;br/&gt;
I think its ready to go in. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13700025" author="ikelly" created="Thu, 4 Jul 2013 13:02:07 +0100"  >&lt;p&gt;Committed r1499731 to trunk. Thanks Vinay.&lt;/p&gt;</comment>
                            <comment id="13700062" author="hudson" created="Thu, 4 Jul 2013 14:15:39 +0100"  >&lt;p&gt;Integrated in bookkeeper-trunk #271 (See &lt;a href=&quot;https://builds.apache.org/job/bookkeeper-trunk/271/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/bookkeeper-trunk/271/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/BOOKKEEPER-636&quot; title=&quot;Latest txn logs might be deleted in a race condition which is not recoverable if BK goes down before next txn log created.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;BOOKKEEPER-636&quot;&gt;&lt;del&gt;BOOKKEEPER-636&lt;/del&gt;&lt;/a&gt;: Latest txn logs might be deleted in a race condition which is not recoverable if BK goes down before next txn log created. (vinay via ivank) (Revision 1499731)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
ivank : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Journal.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/JournalChannel.java&lt;/li&gt;
	&lt;li&gt;/zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/util/MathUtils.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13700133" author="ikelly" created="Thu, 4 Jul 2013 16:19:46 +0100"  >&lt;p&gt;Committed revision 1499776 to branch-4.2&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12590465" name="0001-BOOKKEEPER-636-Latest-txn-logs-might-be-deleted-in-a.patch" size="4076" author="ikelly" created="Tue, 2 Jul 2013 18:05:11 +0100"/>
                            <attachment id="12590185" name="BOOKKEEPER-636.diff" size="2444" author="hustlmsp" created="Sat, 29 Jun 2013 23:52:37 +0100"/>
                            <attachment id="12589821" name="BOOKKEEPER-636.diff" size="2687" author="hustlmsp" created="Thu, 27 Jun 2013 02:20:06 +0100"/>
                            <attachment id="12590157" name="BOOKKEEPER-636.patch" size="2459" author="vinayrpet" created="Sat, 29 Jun 2013 08:19:32 +0100"/>
                            <attachment id="12589777" name="BOOKKEEPER-636.patch" size="4742" author="vinayrpet" created="Wed, 26 Jun 2013 18:55:00 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 27 Jun 2013 01:19:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>335253</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzfo87:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>335577</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>