<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:59:33 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1842/PIG-1842.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1842] Improve Scalability of the XMLLoader for large datasets such as wikipedia</title>
                <link>https://issues.apache.org/jira/browse/PIG-1842</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The current XMLLoader for Pig, does not work well for large datasets such as the wikipedia dataset. Each mapper reads in the entire XML file resulting in extermely slow run times.&lt;/p&gt;

&lt;p&gt;Viraj&lt;/p&gt;</description>
                <environment></environment>
        <key id="12497653">PIG-1842</key>
            <summary>Improve Scalability of the XMLLoader for large datasets such as wikipedia</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vivekp">Vivek Padmanabhan</assignee>
                                    <reporter username="viraj">Viraj Bhat</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Feb 2011 02:20:20 +0000</created>
                <updated>Mon, 25 Apr 2011 22:27:08 +0100</updated>
                            <resolved>Wed, 30 Mar 2011 21:17:53 +0100</resolved>
                                    <version>0.7.0</version>
                    <version>0.8.0</version>
                    <version>0.9.0</version>
                                    <fixVersion>0.8.1</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12991827" author="vivekp" created="Tue, 8 Feb 2011 07:42:53 +0000"  >&lt;p&gt;Attaching an initial patch.&lt;/p&gt;</comment>
                            <comment id="12991832" author="vivekp" created="Tue, 8 Feb 2011 08:04:15 +0000"  >&lt;p&gt;The below are some of the issues addressed in the patch :&lt;br/&gt;
a) Marking splittable of the loader as true except for gz formats&lt;br/&gt;
a) Changing XMLLoader to read for splits rather than entire file.&lt;br/&gt;
b) Handling scenarios regarding split/record boundaries&lt;br/&gt;
c) Using CBZip2InputStream to handle bzip2 files&lt;br/&gt;
d) An improvement on logic of collectTag (ie, skip unnecessary reads to find end tag if no start tags are found)&lt;/p&gt;

&lt;p&gt;Manual tests for scalability and functional verification were done for the patch.&lt;br/&gt;
Using latest wikipedia dump in bz2 format (contains 10861606 pages; 6.5gb bz2) the new loader completed within 3 minutes,while the older version took more than 35minutes for a simple load-filter null-store script.&lt;/p&gt;
</comment>
                            <comment id="12992088" author="alangates" created="Tue, 8 Feb 2011 18:29:50 +0000"  >&lt;p&gt;The patch does not apply cleanly against the trunk.  Can you regenerate the patch against the latest trunk?&lt;/p&gt;</comment>
                            <comment id="12992423" author="vivekp" created="Wed, 9 Feb 2011 10:34:23 +0000"  >&lt;p&gt;Attaching the patch again&lt;/p&gt;</comment>
                            <comment id="12999053" author="alangates" created="Thu, 24 Feb 2011 21:14:20 +0000"  >&lt;p&gt;From reviewing the code it is not clear to me how this splits the XML file.  Let&apos;s say we have an XML file that looks like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;a&amp;gt;
    &amp;lt;b&amp;gt;
        &amp;lt;c&amp;gt;
        &amp;lt;/c&amp;gt;
        &amp;lt;c1&amp;gt;
        &amp;lt;/c1&amp;gt;
    &amp;lt;/b&amp;gt;
&amp;lt;/a&amp;gt;
&amp;lt;a1&amp;gt;
    &amp;lt;b1&amp;gt;
    &amp;lt;/b1&amp;gt;
    &amp;lt;b2&amp;gt;
    &amp;lt;/b2&amp;gt;
&amp;lt;/a2&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the split falls on line &quot;&amp;lt;/c1&amp;gt;&quot;.  &lt;/p&gt;

&lt;p&gt;How far will split 1 read?  It seems like it has to read to &quot;&amp;lt;/a&amp;gt;&quot; or else the map processing split one will not be able to process this as a coherent document.  Yet from the setting of maxBytesReadable on line 132 it looks to me like it won&apos;t read past the end point.  &lt;/p&gt;

&lt;p&gt;How does split 2 know where to start?  I don&apos;t see any code that is telling split 2 to fast forward to the point where split 1 ends.&lt;/p&gt;

&lt;p&gt;All the tests pass just fine.&lt;/p&gt;</comment>
                            <comment id="12999315" author="vivekp" created="Fri, 25 Feb 2011 11:48:41 +0000"  >&lt;p&gt;Hi Alan ,&lt;br/&gt;
 The below is how I have handled these cases :&lt;/p&gt;

&lt;p&gt;Note :-&lt;br/&gt;
The XMLLoader will consider one record from begining tag to end tag just like a line record reader searching for new line char .&lt;br/&gt;
Split start and end locations are provided by the default FileInputFormat.&lt;/p&gt;




&lt;p&gt;Describing the entire steps in a simple way ;&lt;/p&gt;

&lt;p&gt;*The loader will collect the start and end tags and create a record out of it. (XMLLoaderBufferedPositionedInputStream.collectTag)&lt;br/&gt;
	*For begin tag &lt;br/&gt;
		*Read till the tag is found in this block &lt;br/&gt;
			*If tag not found and split end has reached then no rec found in this split (return empty array)&lt;br/&gt;
			*If partial tag is found in the current split then even though split end has reached &lt;br/&gt;
			 continue reading rest of the file , beyond the split end location (handled by cond in while loop)&lt;br/&gt;
	*For end tag&lt;br/&gt;
		*Read till the end tag is found even if the split end location is reached.	&lt;/p&gt;


&lt;p&gt;&amp;gt;&amp;gt;How far will split 1 read? It seems like it has to read to &quot;&amp;lt;/a&amp;gt;&quot; or else the map processing split one will not be able to process this as a coherent document. &lt;br/&gt;
&amp;gt;&amp;gt;Yet from the setting of maxBytesReadable on line 132 it looks to me like it won&apos;t read past the end point.&lt;/p&gt;

&lt;p&gt;The other condition will keep the reading going on. (matchBuf.size() &amp;gt; 0 )&lt;/p&gt;

&lt;p&gt;Here in this case lets say my tag identifier is &amp;lt;a&amp;gt; .  Then the loader will read till the split end to search for begining tag. &lt;br/&gt;
Now for the end tag, it reads the rest of file starting from the last read position.Lets say split end has reached in between,&lt;br/&gt;
it will check whether it has found a match/or partial match. If not proceed with the reading till it finds a end tag.&lt;/p&gt;</comment>
                            <comment id="12999316" author="vivekp" created="Fri, 25 Feb 2011 11:51:08 +0000"  >&lt;p&gt;I have done manual test for split boundary conditions. Please suggest whether/how I can do the same with unit tests.&lt;/p&gt;</comment>
                            <comment id="12999506" author="alangates" created="Fri, 25 Feb 2011 19:43:44 +0000"  >&lt;p&gt;I have checked the patch into trunk.  I applied it to the 0.8 branch, but got errors in the unit tests.  I will attach the results of the 0.8 test run.&lt;/p&gt;</comment>
                            <comment id="13000794" author="vivekp" created="Tue, 1 Mar 2011 09:25:59 +0000"  >&lt;p&gt;The errors are because &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1839&quot; title=&quot;piggybank: XMLLoader will always add an extra empty tuple even if no tags are matched&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1839&quot;&gt;&lt;del&gt;PIG-1839&lt;/del&gt;&lt;/a&gt;(XMLLoader will always add an extra empty tuple even if no tags are matched) was not applied to 0.8 branch which corrects these test cases. &lt;/p&gt;</comment>
                            <comment id="13002190" author="alangates" created="Thu, 3 Mar 2011 20:28:06 +0000"  >&lt;p&gt;Patch 2 checked into 0.8 branch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12470564" name="PIG-1842_1.patch" size="19025" author="vivekp" created="Tue, 8 Feb 2011 07:42:53 +0000"/>
                            <attachment id="12470664" name="PIG-1842_2.patch" size="16757" author="vivekp" created="Wed, 9 Feb 2011 10:34:23 +0000"/>
                            <attachment id="12471961" name="TEST-org.apache.pig.piggybank.test.storage.TestXMLLoader.txt" size="40904" author="alangates" created="Fri, 25 Feb 2011 19:44:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 8 Feb 2011 07:42:53 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>165212</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyau27:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97181</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>