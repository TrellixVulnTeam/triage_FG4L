<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:04:21 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1321/PIG-1321.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1321] Logical Optimizer: Merge cascading foreach</title>
                <link>https://issues.apache.org/jira/browse/PIG-1321</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;We can merge consecutive foreach statement.&lt;/p&gt;

&lt;p&gt;Eg:&lt;br/&gt;
b = foreach a generate a0#&apos;key1&apos; as b0, a0#&apos;key2&apos; as b1, a1;&lt;br/&gt;
c = foreach b generate b0#&apos;kk1&apos;, b0#&apos;kk2&apos;, b1, a1;&lt;/p&gt;

&lt;p&gt;=&amp;gt; c = foreach a generate a0#&apos;key1&apos;#&apos;kk1&apos;, a0#&apos;key1&apos;#&apos;kk2&apos;, a0#&apos;key2&apos;, a1;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12459925">PIG-1321</key>
            <summary>Logical Optimizer: Merge cascading foreach</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12459922">PIG-1319</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xuefuz">Xuefu Zhang</assignee>
                                    <reporter username="daijy">Daniel Dai</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Mar 2010 22:31:28 +0000</created>
                <updated>Fri, 17 Dec 2010 22:43:58 +0000</updated>
                            <resolved>Fri, 27 Aug 2010 23:24:40 +0100</resolved>
                                    <version>0.7.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12884105" author="xuefuz" created="Thu, 1 Jul 2010 01:13:13 +0100"  >&lt;p&gt;Here is the scope of this type of optimization:&lt;/p&gt;

&lt;p&gt;Pre-condition: &lt;br/&gt;
1. two consecutive foreach statements.&lt;br/&gt;
2. the second foreach statement is a simple inner plan in which the ognly statement is a GENERATE statement. In other words, the second foreach statement must be something like &quot;FOREACH A GENERATE ....&quot;&lt;/p&gt;

&lt;p&gt;Optimization result:&lt;br/&gt;
The two foreach statement will be merged to one. The new foreach statement keeps the first old foreach statement&apos;s inner plan with the new expressions for the GENERATE statement. These new expressions are generated based on those in the second foreach generate statement, combined with those in the first foreach generate statement. For instance, suppose we have the following pig script:&lt;/p&gt;

&lt;p&gt;A = load &apos;file.txt&apos; as (a, b, c);&lt;br/&gt;
B = foreach A generate a+b as u, c-b as v;&lt;br/&gt;
C = foreach B generate $0+5, v;&lt;br/&gt;
dump C;&lt;/p&gt;

&lt;p&gt;The optimized plan after merge-foreach optimization will be equivalent to the following pig script&lt;/p&gt;

&lt;p&gt;A = load &apos;file.txt&apos; as (a, b, c);&lt;br/&gt;
C = foreach A generate a+b+5, c-b;&lt;br/&gt;
dump C;&lt;/p&gt;

&lt;p&gt;Of course, first foreach can have any complex inner plan, which remains the same in the new foreach statement.&lt;/p&gt;

&lt;p&gt;Patch for this optimization is coming soon...&lt;/p&gt;</comment>
                            <comment id="12884811" author="xuefuz" created="Fri, 2 Jul 2010 22:20:35 +0100"  >&lt;p&gt;Add one more pre-condition:&lt;br/&gt;
3. The first foreach statement cannot contain flatten due to its complexity.&lt;/p&gt;</comment>
                            <comment id="12902186" author="xuefuz" created="Wed, 25 Aug 2010 01:10:08 +0100"  >&lt;p&gt;Regenerate the patch to fix some test failures as well as rebasing with trunk&apos;s latest code changes.&lt;/p&gt;</comment>
                            <comment id="12902392" author="mridul" created="Wed, 25 Aug 2010 13:05:28 +0100"  >&lt;p&gt;Is the merge prevented only if flatten is present, or for any udf ?&lt;/p&gt;</comment>
                            <comment id="12902499" author="xuefuz" created="Wed, 25 Aug 2010 17:27:07 +0100"  >&lt;p&gt;Merge is prevented if the first foreach contains flatten. UDF is allowed in any of the foreachs for this optimization.&lt;/p&gt;</comment>
                            <comment id="12903680" author="daijy" created="Fri, 27 Aug 2010 23:24:13 +0100"  >&lt;p&gt;Repost the pre-condition:&lt;br/&gt;
1. two consecutive foreach statements.&lt;br/&gt;
2. the second foreach statement is a simple inner plan in which the ognly statement is a GENERATE statement. In other words, the second foreach statement must be something like &quot;FOREACH A GENERATE ....&quot;&lt;br/&gt;
3. The first foreach statement cannot contain flatten due to its complexity&lt;br/&gt;
4. No 1st foreach output is referred more than once in second foreach, eg: &quot;B = foreach xxxx; C = foreach B generate $0, $1, $0&quot; will not be merged. The reason if we merge, $0 will be calculated twice, which defeat the benefit of merging.&lt;/p&gt;

&lt;p&gt;All tests pass. test-patch result:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; +1 overall.  &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 @author.  The patch does not contain any @author tags.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 tests included.  The patch appears to include 3 new or modified tests.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;</comment>
                            <comment id="12903681" author="daijy" created="Fri, 27 Aug 2010 23:24:40 +0100"  >&lt;p&gt;Patch committed. Thanks Xuefu!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12452992" name="jira-1321-2.patch" size="23046" author="xuefuz" created="Wed, 25 Aug 2010 01:10:08 +0100"/>
                            <attachment id="12453308" name="jira-1321-3.patch" size="25745" author="daijy" created="Fri, 27 Aug 2010 23:24:13 +0100"/>
                            <attachment id="12451715" name="pig-1321.patch" size="21223" author="xuefuz" created="Tue, 10 Aug 2010 23:01:29 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 1 Jul 2010 00:13:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164820</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyap47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96380</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>This rule allows to merge togther two foreach statements if the following preconditions are met:&lt;br/&gt;
&lt;br/&gt;
- foreach statements are consecutive&lt;br/&gt;
- the second foreach is not nested&lt;br/&gt;
- the first foreach statement does not contain flatten &lt;br/&gt;
&lt;br/&gt;
Example:&lt;br/&gt;
&lt;br/&gt;
(1) Original code:&lt;br/&gt;
&lt;br/&gt;
A = load &amp;#39;file.txt&amp;#39; as (a, b, c);&lt;br/&gt;
B = foreach A generate a+b as u, c-b as v;&lt;br/&gt;
C = foreach B generate $0+5, v;&lt;br/&gt;
.....&lt;br/&gt;
&lt;br/&gt;
(2) Optimized code:&lt;br/&gt;
&lt;br/&gt;
A = load &amp;#39;file.txt&amp;#39; as (a, b, c);&lt;br/&gt;
C = foreach A generate a+b+5, c-b;&lt;br/&gt;
......&lt;br/&gt;
</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>