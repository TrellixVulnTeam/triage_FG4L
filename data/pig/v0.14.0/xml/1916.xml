<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:02:17 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1916/PIG-1916.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1916] Nested cross</title>
                <link>https://issues.apache.org/jira/browse/PIG-1916</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;It is useful to have cross inside foreach nested statement. One typical use case for nested foreach is after cogroup two relations, we want to flatten the records of the same key, and do some processing. This is naturally to be achieved by cross. Eg:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
C = cogroup user by uid, session by uid;
D = foreach C {
    crossed = cross user, session; -- To flatten two input bags
    filtered = filter crossed by user::region == session::region;
    result = foreach crossed generate processSession(user::age, user::gender, session::ip);  --Nested foreach Jira: PIG-1631
    generate result;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If we don&apos;t have cross, user have to write a UDF process the bag user, session. It is much harder than a UDF process flattened tuples. This is especially true when we have nested foreach statement(&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1631&quot; title=&quot;Support to 2 level nested foreach&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1631&quot;&gt;&lt;del&gt;PIG-1631&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;This is a candidate project for Google summer of code 2011. More information about the program can be found at &lt;a href=&quot;http://wiki.apache.org/pig/GSoc2011&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/pig/GSoc2011&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12501759">PIG-1916</key>
            <summary>Nested cross</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zjshen">Zhijie Shen</assignee>
                                    <reporter username="daijy">Daniel Dai</reporter>
                        <labels>
                            <label>gsoc2011</label>
                    </labels>
                <created>Fri, 18 Mar 2011 03:49:11 +0000</created>
                <updated>Fri, 24 Aug 2012 19:00:52 +0100</updated>
                            <resolved>Thu, 14 Jul 2011 07:16:31 +0100</resolved>
                                                    <fixVersion>0.10.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13009626" author="zjshen" created="Tue, 22 Mar 2011 12:33:14 +0000"  >&lt;p&gt;Hi developers,&lt;/p&gt;

&lt;p&gt;I&apos;m a graduate student and interested in big data. I&apos;m interested in applying for GSoC with Pig. I&apos;ve already successfully built Pig locally, and read two papers about Pig published on SIGMOD and VLDB. Now I&apos;m investigating into this issue and the related one: 1631, which seem to be interesting additions to Pig. However, there&apos;s quite limited information here. Will anybody give me some hints of where I should start in Pig code to deal with this issue?&lt;/p&gt;
</comment>
                            <comment id="13009669" author="zjshen" created="Tue, 22 Mar 2011 15:02:27 +0000"  >&lt;p&gt;I&apos;ve just had quick glance at the code, and found the start point of this issue could be the LogicalPlanGenerator.g, where current grammar doesn&apos;t support accept the nested cross operator. Meanwhile, the LogicalPlanBuilder class lacks buildNestedCrossOp function as well. Hence to add nested cross, at first, additional codes are required in the aforementioned part of the Pig. Please correct me if I&apos;m wrong. Thanks! I&apos;m going on to explore more related parts of this issue.&lt;/p&gt;</comment>
                            <comment id="13009905" author="daijy" created="Tue, 22 Mar 2011 23:39:52 +0000"  >&lt;p&gt;Yes, you will need to change LogicalPlanGenerator.g and buildNestedCrossOp so that Pig can recognize nested operator and generate logical plan correctly. This is the first step. There are other places need to change, for example:&lt;br/&gt;
1. LogToPhyTranslationVisitor.java, which translate logical plan to physical plan. It currently does not recognize nested cross&lt;br/&gt;
2. Also in LogToPhyTranslationVisitor.java, Pig translate top level &quot;cross&quot; into UDF GFCross. Nested cross will use a different implementation, so we should translate into a different physical plan (using POCross)&lt;br/&gt;
3. MRCompiler.java, it does not know how to handle POCross yet&lt;br/&gt;
4. Pipeline execution, I hope POCross will work, but need to review (a little background, POCross used to implement Pig local mode, however, it is dropped in Pig 0.7 since we move to hadoop local mode. Currently no one is using POCross, hopefully it still functional)&lt;/p&gt;</comment>
                            <comment id="13010198" author="zjshen" created="Wed, 23 Mar 2011 16:18:24 +0000"  >&lt;p&gt;Hi Daniel,&lt;/p&gt;

&lt;p&gt;thank you very much for your response. It will definitely help me to understand the code. Besides, would you please to give some tips to survive in GSoC application with ASF? For example, the criteria to evaluate a student. The GSoC Wiki page of Pig provides quite limited information.&lt;/p&gt;

&lt;p&gt;BTW, I assume you would be the potential mentor for this issue, right?&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Zhijie&lt;/p&gt;</comment>
                            <comment id="13010255" author="daijy" created="Wed, 23 Mar 2011 17:49:22 +0000"  >&lt;p&gt;GSoC Wiki page of Pig does provide guidelines how to write a GSoC application. There is no absolute criteria. The chance of acceptance depends on how many students applying, how much quota we get, and what is your rank among all students. &lt;/p&gt;

&lt;p&gt;I assume I will mentor this issue unless we get overwhelming number of projects, or someone is more interested to mentor.&lt;/p&gt;</comment>
                            <comment id="13011254" author="zjshen" created="Fri, 25 Mar 2011 16:08:29 +0000"  >&lt;p&gt;Hi Daniel,&lt;/p&gt;

&lt;p&gt;I browsed through the code, but I didn&apos;t found a class named POCross. I think it&apos;s not only depreciated, but also removed from the code. Moreover, after reading the code, I&apos;m still not clear why you said the top level logic cross should be translated into GFCross while the nested logic cross should use POCross instead? What is the difference?&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Zhijie&lt;/p&gt;</comment>
                            <comment id="13011284" author="daijy" created="Fri, 25 Mar 2011 17:06:03 +0000"  >&lt;p&gt;Yes, you are right. In 0.8 branch, we have POCross, but we drop in trunk. And that POCross is for another purpose, may or may not be usable for this project. We need a new POCross to implement nested cross behavior.&lt;/p&gt;</comment>
                            <comment id="13016083" author="zjshen" created="Tue, 5 Apr 2011 20:14:40 +0100"  >&lt;p&gt;I found the POCross.java in branch-0.6. Together with POCross, other classes in &quot;org.apache.pig.backend.local.executionengine.physicalLayer.relationalOperator&quot; have been removed as well in the latest version. I checked into &quot;MRCompiler.java&quot;, and found the &quot;pigContext.getExecType()&quot; is seldom checked in the visitXXXX functions. So how does Pig distinguish between local execution and hadoop execution? I&apos;m a bit confused here.&lt;/p&gt;</comment>
                            <comment id="13016125" author="daijy" created="Tue, 5 Apr 2011 22:15:04 +0100"  >&lt;p&gt;In 0.6, local mode makes a big difference. Starting 0.7, local mode leverage hadoop local mode, there is no much difference. &lt;/p&gt;</comment>
                            <comment id="13016720" author="zjshen" created="Thu, 7 Apr 2011 07:40:16 +0100"  >&lt;p&gt;Here is the draft of my GSoC&apos;11 application for the this issue:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.google-melange.com/gsoc/proposal/review/google/gsoc2011/zjshen/1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.google-melange.com/gsoc/proposal/review/google/gsoc2011/zjshen/1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll go on to polish it. Comments are welcome. Thanks!&lt;/p&gt;</comment>
                            <comment id="13017418" author="zjshen" created="Fri, 8 Apr 2011 13:14:12 +0100"  >&lt;p&gt;I&apos;ve updated my application.&lt;/p&gt;</comment>
                            <comment id="13050201" author="zjshen" created="Thu, 16 Jun 2011 04:37:44 +0100"  >&lt;p&gt;Make a report of my progress and the issue I&apos;ve met.&lt;/p&gt;

&lt;p&gt;First, by adding the nested cross syntax (e.g., changing grammar source files and the hooked functions), Pig can now accept the nested cross statement, generate the logic plan and reach the step of translating the logic plan into the physical plan. The major issue here is multiple inputs. The existing nested operators only have one input, hence current grammar seems to assume one input for the nested operators. However, cross can accept multiple inputs. Therefore the input syntax in the nested block has to been changed as well.&lt;/p&gt;

&lt;p&gt;How to translate the logic nested cross into the correct physical operators looks like the essence part of this project. I&apos;ve spent time to investigating into the translation, as well as the map/reduce plan compiling and map/reduce job execution.&lt;/p&gt;

&lt;p&gt;During the stage of logic plan generation, both top-level and nested cross statements will result in a LOCross instance. LogToPhyTranslationVisitor already has the function to visit POCross. However, the fuction works with the top-level POCross, but not the nested one. To see why it doesn&apos;t work for nested cross, here are two map/reduce plans respectively generated for the top-level and the nested cross operators:&lt;/p&gt;

&lt;p&gt;1. top-level:&lt;br/&gt;
user = load &apos;user.txt&apos; as (uid, region);&lt;br/&gt;
session = load &apos;session.txt&apos; as (uid, region, duration);&lt;br/&gt;
A = group user by uid;&lt;br/&gt;
B = group session by uid;&lt;br/&gt;
C = cross A, B;&lt;br/&gt;
store C into &apos;test.out&apos;;&lt;/p&gt;

&lt;p&gt;#--------------------------------------------------&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Map Reduce Plan&lt;br/&gt;
#--------------------------------------------------&lt;br/&gt;
MapReduce node scope-38&lt;br/&gt;
Map Plan&lt;br/&gt;
Union&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt; - scope-39
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---C: Local Rearrange&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;
{tuple}(false) - scope-21&lt;br/&gt;
|   |   |&lt;br/&gt;
|   |   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;int&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - scope-22&lt;br/&gt;
|   |   |&lt;br/&gt;
|   |   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;int&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - scope-23&lt;br/&gt;
|   |&lt;br/&gt;
|   |---C: New For Each(true,true)&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt; - scope-20&lt;br/&gt;
|       |   |&lt;br/&gt;
|       |   POUserFunc(org.apache.pig.impl.builtin.GFCross)&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt; - scope-18&lt;br/&gt;
|       |   |&lt;br/&gt;
|       |   |---Constant(2) - scope-16&lt;br/&gt;
|       |   |&lt;br/&gt;
|       |   |---Constant(0) - scope-17&lt;br/&gt;
|       |   |&lt;br/&gt;
|       |   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;*&amp;#93;&lt;/span&gt; - scope-19&lt;br/&gt;
|       |&lt;br/&gt;
|       |---user: New For Each(false,false)&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt; - scope-5&lt;br/&gt;
|           |   |&lt;br/&gt;
|           |   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - scope-1&lt;br/&gt;
|           |   |&lt;br/&gt;
|           |   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - scope-3&lt;br/&gt;
|           |&lt;br/&gt;
|           |---user: Load(&lt;a href=&quot;file:///home/zjshen/Workspace/eclipse/pig_test/user.txt:org.apache.pig.builtin.PigStorage&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:///home/zjshen/Workspace/eclipse/pig_test/user.txt:org.apache.pig.builtin.PigStorage&lt;/a&gt;) - scope-0&lt;br/&gt;
|&lt;br/&gt;
|---C: Local Rearrange&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;{tuple}
&lt;p&gt;(false) - scope-29&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;int&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - scope-30&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;int&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - scope-31&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---C: New For Each(true,true)&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt; - scope-28&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   POUserFunc(org.apache.pig.impl.builtin.GFCross)&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt; - scope-26&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---Constant(2) - scope-24&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---Constant(1) - scope-25&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;*&amp;#93;&lt;/span&gt; - scope-27&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---session: New For Each(false,false,false)&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt; - scope-13&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - scope-7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - scope-9&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; - scope-11&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;--&lt;del&gt;session: Load(&lt;a href=&quot;file:///home/zjshen/Workspace/eclipse/pig_test/session.txt:org.apache.pig.builtin.PigStorage&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:///home/zjshen/Workspace/eclipse/pig_test/session.txt:org.apache.pig.builtin.PigStorage&lt;/a&gt;) - scope-6&lt;/del&gt;-------&lt;br/&gt;
Reduce Plan&lt;br/&gt;
C: Store(test.out:org.apache.pig.builtin.PigStorage) - scope-35&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;--&lt;del&gt;POJoinPackage(true,true)&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt; - scope-40&lt;/del&gt;-------&lt;br/&gt;
Global sort: false&lt;br/&gt;
----------------&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;2. nested:&lt;br/&gt;
user = load &apos;user.txt&apos; as (uid, region);&lt;br/&gt;
session = load &apos;session.txt&apos; as (uid, region, duration);&lt;br/&gt;
C = cogroup user by uid, session by uid;&lt;br/&gt;
D = foreach C &lt;/p&gt;
{
    crossed = cross user, session;
    filtered = filter crossed by user::region == session::region;
    generate group, user, session;
}
&lt;p&gt;;&lt;br/&gt;
store D into &apos;test.out&apos;;&lt;/p&gt;

&lt;p&gt;#--------------------------------------------------&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Map Reduce Plan&lt;br/&gt;
#--------------------------------------------------&lt;br/&gt;
MapReduce node scope-52&lt;br/&gt;
Map Plan&lt;br/&gt;
Union&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt; - scope-53
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---C: Local Rearrange&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;
{bytearray}(false) - scope-16&lt;br/&gt;
|   |   |&lt;br/&gt;
|   |   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - scope-17&lt;br/&gt;
|   |&lt;br/&gt;
|   |---user: New For Each(false,false)&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt; - scope-5&lt;br/&gt;
|       |   |&lt;br/&gt;
|       |   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - scope-1&lt;br/&gt;
|       |   |&lt;br/&gt;
|       |   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - scope-3&lt;br/&gt;
|       |&lt;br/&gt;
|       |---user: Load(&lt;a href=&quot;file:///home/zjshen/Workspace/eclipse/pig_test/user.txt:org.apache.pig.builtin.PigStorage&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:///home/zjshen/Workspace/eclipse/pig_test/user.txt:org.apache.pig.builtin.PigStorage&lt;/a&gt;) - scope-0&lt;br/&gt;
|&lt;br/&gt;
|---C: Local Rearrange&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;{bytearray}
&lt;p&gt;(false) - scope-18&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - scope-19&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---session: New For Each(false,false,false)&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt; - scope-13&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - scope-7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - scope-9&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; - scope-11&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;--&lt;del&gt;session: Load(&lt;a href=&quot;file:///home/zjshen/Workspace/eclipse/pig_test/session.txt:org.apache.pig.builtin.PigStorage&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:///home/zjshen/Workspace/eclipse/pig_test/session.txt:org.apache.pig.builtin.PigStorage&lt;/a&gt;) - scope-6&lt;/del&gt;-------&lt;br/&gt;
Reduce Plan&lt;br/&gt;
D: Store(test.out:org.apache.pig.builtin.PigStorage) - scope-49&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---D: New For Each(false)&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt; - scope-48&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   RelationToExpressionProject&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;*&amp;#93;&lt;/span&gt; - scope-20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---filtered: Filter&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt; - scope-44&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Equal To&lt;span class=&quot;error&quot;&gt;&amp;#91;boolean&amp;#93;&lt;/span&gt; - scope-47&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - scope-45&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt; - scope-46&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---crossed: New For Each(true,true)&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt; - scope-43&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - scope-41&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; - scope-42&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---Package&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;
{tuple} - scope-24&lt;br/&gt;
    |               |&lt;br/&gt;
    |               |---crossed: Global Rearrange&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt; - scope-23&lt;br/&gt;
    |                   |&lt;br/&gt;
    |                   |---crossed: Local Rearrange&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;{tuple}
&lt;p&gt;(false) - scope-30&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;int&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - scope-31&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;int&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - scope-32&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---crossed: New For Each(true,true)&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt; - scope-29&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   POUserFunc(org.apache.pig.impl.builtin.GFCross)&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt; - scope-27&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---Constant(2) - scope-25&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---Constant(0) - scope-26&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;*&amp;#93;&lt;/span&gt; - scope-28&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - scope-21&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---crossed: Local Rearrange&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;
{tuple}
&lt;p&gt;(false) - scope-38&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;int&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - scope-39&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;int&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - scope-40&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---crossed: New For Each(true,true)&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt; - scope-37&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   POUserFunc(org.apache.pig.impl.builtin.GFCross)&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt; - scope-35&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---Constant(2) - scope-33&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---Constant(1) - scope-34&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;*&amp;#93;&lt;/span&gt; - scope-36&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; - scope-22&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---C: Package&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;
{bytearray}
&lt;p&gt; - scope-15--------&lt;br/&gt;
Global sort: false&lt;br/&gt;
----------------&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The difference in the physical plan is not obvious because translation procedure is same: local rearrange first -&amp;gt; global rearrange -&amp;gt; package -&amp;gt; physical foreach. However, when the physical plan is translated into the map/reduce plan, the difference becomes obvious. The physical operators belonging to the top-level cross are distributed in both map and reduce stage: local rearrange is placed in map; global rearrange is removed because the logic is inherently available in map/reduce; package and foreach group together to form POJoinPackage which is placed in the reduce stage.&lt;/p&gt;

&lt;p&gt;On the other hand, the physical plan of the nested cross hasn&apos;t be translated into the same map/reduce plan. This is because the physical operators of the nested commands cannot be distributed into both map and reduce stages. Instead, they have to be solved locally in one of either map/reduce stage. Therefore, the problem occurs, the global rearrange and the package operators appear inside the reduce stage. First, the global rearrange used to be assumed to be replaced by Hadoop&apos;s merge/shuffle, so that the logic of processing data is not implemented. Second, package reads data from Hadoop&apos;s reduce function. And in the current implementation, only one package can appear in the reduce stage, because the keyInfo member of only one POPackage instance will be set.&lt;/p&gt;

&lt;p&gt;As to these situations, when visiting LOCross in LogToPhyTranslationVisitor, whether it is a top-level or a nested cross should be distinguished (perhaps need modification on logical plan). If it is a nested cross, some other operator (temporarily named POCross) need to be generated to replace POGlobalRearrange and POPackage. It should achieve the similar functionality, but can operate locally. Afterwards, MRCompiler needs a function to visit the POCross instance and attach it to the reduce stage.&lt;/p&gt;

&lt;p&gt;Attached is the code I&apos;ve modified up till now.&lt;/p&gt;</comment>
                            <comment id="13050202" author="zjshen" created="Thu, 16 Jun 2011 04:39:41 +0100"  >&lt;p&gt;Incomplete patch to show progress.&lt;/p&gt;</comment>
                            <comment id="13052306" author="daijy" created="Tue, 21 Jun 2011 02:31:39 +0100"  >&lt;p&gt;Here is my review comments:&lt;br/&gt;
1. Parser change is good. LOCross is correct in logical plan&lt;br/&gt;
2. Logical plan is still good after the optimizer&lt;br/&gt;
3. Physical plan is not good. we shall have POCross in physical plan. The current physical plan shows &quot;Global Rearrange&quot; + &quot;Local Rearrange&quot; + &quot;GFCross&quot;, which is good for top level cross, but not nested cross&lt;/p&gt;

&lt;p&gt;Here is suggested change:&lt;br/&gt;
1. Add a flag inner to LOCross&lt;br/&gt;
2. Change LogToPhyTranslationVisitor, if top level cross, keep the old logic; if nested cross, convert LOCross to POCross&lt;/p&gt;</comment>
                            <comment id="13053407" author="zjshen" created="Wed, 22 Jun 2011 20:15:43 +0100"  >&lt;p&gt;As Daniel suggested, I differ the process of visiting LOCross: for the top-level LOCross, I keep the original logic; for the nested LOCross, I generate a POCross instead and place it into the correct place of the physical plan. After that, I&apos;ve found the physical and map/reduce plan is generated correctly. However, the pipeline was still broken because the getNext() function of POCross hasn&apos;t been implemented. I recall that you&apos;ve mentioned there&apos;s POCross in previous version of Pig. I found out the code and reuse the getNext() function. I found it almost worked! There were some bugs, which were fixed by me. Finally, the nested cross basically works! Please refer to the newest patch for the code update.&lt;/p&gt;</comment>
                            <comment id="13059338" author="zjshen" created="Mon, 4 Jul 2011 07:50:19 +0100"  >&lt;p&gt;The nested cross functionality basically works. I&apos;ve respectively tested one, two and three bags cross on both local machine and single-node hadoop platform. Also, I&apos;ve fixed the bug of cross over null bag. If an input bag is found null, POCross return null result whatever the other inputs are, because the cross product of null and anything is null. Moreover, I refactored POCross a bit and implmented illustratorMarkup() function, which is the part I&apos;m still not sure.&lt;/p&gt;

&lt;p&gt;Afterwards, I&apos;ll come up with comprehensive test cases, and investegate into illustratorMarkup().&lt;/p&gt;


&lt;p&gt;Below is an example. For the following sample commands,&lt;/p&gt;

&lt;p&gt;#-----------------------------------------------&lt;br/&gt;
user = load &apos;user.txt&apos; using PigStorage(&apos;\t&apos;) as (uid, region);&lt;br/&gt;
session = load &apos;session.txt&apos; using PigStorage(&apos;\t&apos;) as (uid, region, duration);&lt;br/&gt;
C = cogroup user by uid, session by uid;&lt;br/&gt;
D = foreach C &lt;/p&gt;
{
    crossed = cross user, session;
    generate crossed;
}
&lt;p&gt;store D into &apos;test.out&apos;;&lt;br/&gt;
#-----------------------------------------------&lt;/p&gt;

&lt;p&gt;I got the logical, phyical and map/reduce plans, which are demonstrated as follows.&lt;/p&gt;

&lt;p&gt;#-----------------------------------------------&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;New Logical Plan:&lt;br/&gt;
#-----------------------------------------------&lt;br/&gt;
D: (Name: LOStore Schema: crossed#22:bag
{#23:tuple(user::uid#16:bytearray,user::region#17:bytearray,session::uid#18:bytearray,session::region#19:bytearray,session::duration#20:bytearray)}
&lt;p&gt;)&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---D: (Name: LOForEach Schema: crossed#22:bag
{#23:tuple(user::uid#16:bytearray,user::region#17:bytearray,session::uid#18:bytearray,session::region#19:bytearray,session::duration#20:bytearray)}
&lt;p&gt;)&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   (Name: LOGenerate&lt;span class=&quot;error&quot;&gt;&amp;#91;false&amp;#93;&lt;/span&gt; Schema: crossed#22:bag
{#23:tuple(user::uid#16:bytearray,user::region#17:bytearray,session::uid#18:bytearray,session::region#19:bytearray,session::duration#20:bytearray)}
&lt;p&gt;)&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   crossed:(Name: Project Type: bag Uid: 22 Input: 0 Column: &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---crossed: (Name: LOCross Schema: user::uid#16:bytearray,user::region#17:bytearray,session::uid#18:bytearray,session::region#19:bytearray,session::duration#20:bytearray)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---user: (Name: LOInnerLoad&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; Schema: uid#16:bytearray,region#17:bytearray)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---session: (Name: LOInnerLoad&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; Schema: uid#18:bytearray,region#19:bytearray,duration#20:bytearray)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---C: (Name: LOCogroup Schema: group#21:bytearray,user#22:bag
{#28:tuple(uid#16:bytearray,region#17:bytearray)}
&lt;p&gt;,session#24:bag&lt;/p&gt;
{#29:tuple(uid#18:bytearray,region#19:bytearray,duration#20:bytearray)}
&lt;p&gt;)&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   uid:(Name: Project Type: bytearray Uid: 16 Input: 0 Column: 0)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   uid:(Name: Project Type: bytearray Uid: 18 Input: 1 Column: 0)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---user: (Name: LOLoad Schema: uid#16:bytearray,region#17:bytearray)RequiredFields:null&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---session: (Name: LOLoad Schema: uid#18:bytearray,region#19:bytearray,duration#20:bytearray)RequiredFields:null&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;#-----------------------------------------------&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Physical Plan:&lt;br/&gt;
#-----------------------------------------------&lt;br/&gt;
D: Store(test.out:org.apache.pig.builtin.PigStorage) - scope-25
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---D: New For Each(false)&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt; - scope-24&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   RelationToExpressionProject&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;*&amp;#93;&lt;/span&gt; - scope-20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---POCross&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt; - scope-23&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - scope-21&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; - scope-22&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---C: Package&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;
{bytearray} - scope-15&lt;br/&gt;
        |&lt;br/&gt;
        |---C: Global Rearrange&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt; - scope-14&lt;br/&gt;
            |&lt;br/&gt;
            |---C: Local Rearrange&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;{bytearray}
&lt;p&gt;(false) - scope-16&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - scope-17&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---user: New For Each(false,false)&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt; - scope-5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - scope-1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - scope-3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---user: Load(&lt;a href=&quot;file:///home/zjshen/Workspace/eclipse/pig_test/user.txt:PigStorage(&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:///home/zjshen/Workspace/eclipse/pig_test/user.txt:PigStorage(&lt;/a&gt;&apos;	&apos;)) - scope-0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---C: Local Rearrange&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;
{bytearray}(false) - scope-18&lt;br/&gt;
                |   |&lt;br/&gt;
                |   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - scope-19&lt;br/&gt;
                |&lt;br/&gt;
                |---session: New For Each(false,false,false)&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt; - scope-13&lt;br/&gt;
                    |   |&lt;br/&gt;
                    |   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - scope-7&lt;br/&gt;
                    |   |&lt;br/&gt;
                    |   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - scope-9&lt;br/&gt;
                    |   |&lt;br/&gt;
                    |   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; - scope-11&lt;br/&gt;
                    |&lt;br/&gt;
                    |---session: Load(&lt;a href=&quot;file:///home/zjshen/Workspace/eclipse/pig_test/session.txt:PigStorage(&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:///home/zjshen/Workspace/eclipse/pig_test/session.txt:PigStorage(&lt;/a&gt;&apos;	&apos;)) - scope-6&lt;br/&gt;
&lt;br/&gt;
#--------------------------------------------------&lt;br/&gt;
# Map Reduce Plan                                  &lt;br/&gt;
#--------------------------------------------------&lt;br/&gt;
MapReduce node scope-28&lt;br/&gt;
Map Plan&lt;br/&gt;
Union&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt; - scope-29&lt;br/&gt;
|&lt;br/&gt;
|---C: Local Rearrange&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;{bytearray}
&lt;p&gt;(false) - scope-16&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - scope-17&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---user: New For Each(false,false)&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt; - scope-5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - scope-1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - scope-3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---user: Load(&lt;a href=&quot;file:///home/zjshen/Workspace/eclipse/pig_test/user.txt:PigStorage(&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:///home/zjshen/Workspace/eclipse/pig_test/user.txt:PigStorage(&lt;/a&gt;&apos;	&apos;)) - scope-0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---C: Local Rearrange&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;
{bytearray}(false) - scope-18&lt;br/&gt;
    |   |&lt;br/&gt;
    |   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - scope-19&lt;br/&gt;
    |&lt;br/&gt;
    |---session: New For Each(false,false,false)&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt; - scope-13&lt;br/&gt;
        |   |&lt;br/&gt;
        |   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; - scope-7&lt;br/&gt;
        |   |&lt;br/&gt;
        |   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - scope-9&lt;br/&gt;
        |   |&lt;br/&gt;
        |   Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; - scope-11&lt;br/&gt;
        |&lt;br/&gt;
        |---session: Load(&lt;a href=&quot;file:///home/zjshen/Workspace/eclipse/pig_test/session.txt:PigStorage(&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:///home/zjshen/Workspace/eclipse/pig_test/session.txt:PigStorage(&lt;/a&gt;&apos;	&apos;)) - scope-6--------&lt;br/&gt;
Reduce Plan&lt;br/&gt;
D: Store(test.out:org.apache.pig.builtin.PigStorage) - scope-25&lt;br/&gt;
|&lt;br/&gt;
|---D: New For Each(false)&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt; - scope-24&lt;br/&gt;
    |   |&lt;br/&gt;
    |   RelationToExpressionProject&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;*&amp;#93;&lt;/span&gt; - scope-20&lt;br/&gt;
    |   |&lt;br/&gt;
    |   |---POCross&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt; - scope-23&lt;br/&gt;
    |       |&lt;br/&gt;
    |       |---Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - scope-21&lt;br/&gt;
    |       |&lt;br/&gt;
    |       |---Project&lt;span class=&quot;error&quot;&gt;&amp;#91;bag&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; - scope-22&lt;br/&gt;
    |&lt;br/&gt;
    |---C: Package&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;{bytearray}
&lt;p&gt; - scope-15--------&lt;br/&gt;
Global sort: false&lt;br/&gt;
----------------&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/li&gt;
&lt;/ol&gt;

</comment>
                            <comment id="13062898" author="daijy" created="Mon, 11 Jul 2011 08:42:25 +0100"  >&lt;p&gt;Hi, Zhijie,&lt;br/&gt;
I browse through the patch, looks good to me. Certainly I will look into more details later. But in the mean time, can you add test cases to the patch? We need to test:&lt;br/&gt;
1. Simple case (the one on Jira)&lt;br/&gt;
2. More than two inputs in cogroup&lt;br/&gt;
3. There is statement before cross (eg, do a filter, then do cross)&lt;/p&gt;

&lt;p&gt;You can follow existing test (eg: TestEvalPipeline2) to write a separate test suit. &lt;/p&gt;</comment>
                            <comment id="13063313" author="zjshen" created="Mon, 11 Jul 2011 13:46:57 +0100"  >&lt;p&gt;Hi Daniel,&lt;/p&gt;

&lt;p&gt;Yes, I&apos;m currently preparing the test cases. However, instead of writing a separate test suit, may I added the cases into TestForEachNestedPlanLocal and TestForEachNestedPlan, which already contains the cases for other nested operators.&lt;/p&gt;</comment>
                            <comment id="13063747" author="zjshen" created="Tue, 12 Jul 2011 07:48:10 +0100"  >&lt;p&gt;The candidate patch for submission.&lt;/p&gt;</comment>
                            <comment id="13063750" author="zjshen" created="Tue, 12 Jul 2011 07:56:52 +0100"  >&lt;p&gt;Hi Daniel,&lt;/p&gt;

&lt;p&gt;I&apos;ve completed the test cases. The slight difference between my patch and what you suppose to be is &quot;1. Simple case (the one on Jira)&quot;. I didn&apos;t use this sample directly because it contains a command that hasn&apos;t been implemented yet. Instead, I modified the sample and created the simplest case:&lt;br/&gt;
C = cogroup user by uid, session by uid;&lt;br/&gt;
D = foreach C &lt;/p&gt;
{
    crossed = cross user, session;
    generate crossed;
}

&lt;p&gt;One more question is whether we need to do the same unit test in a mini-cluster environment (currently in local environment).&lt;/p&gt;

&lt;p&gt;Generally, I think the patch for this issue is close to submission. How do you think about this?&lt;/p&gt;</comment>
                            <comment id="13064249" author="daijy" created="Wed, 13 Jul 2011 01:22:15 +0100"  >&lt;p&gt;Hi, Zhijie,&lt;br/&gt;
Patch looks pretty good. The simple test case you use is fine, and local mode test should be good enough. I see you also tested cases when one side is an empty bag, it works as expected. Illustrate also works. I think the patch is good to go. &lt;/p&gt;

&lt;p&gt;One future improvement is, we can optimize the bag creation. We can create n-1 bags instead of n bags. For the last relation, we can iterate tuple by tuple, create results on the fly. Thus we can use less memory. We can open a separate Jira ticket for this optimization. &lt;/p&gt;</comment>
                            <comment id="13065074" author="daijy" created="Thu, 14 Jul 2011 07:11:35 +0100"  >&lt;p&gt;Change the patch slightly to fix test-patch warnings.&lt;/p&gt;</comment>
                            <comment id="13065078" author="daijy" created="Thu, 14 Jul 2011 07:16:31 +0100"  >&lt;p&gt;TestScriptLanguage fail, but it is not caused by this patch. Will open a separate Jira to fix test case. Test-patch show several more javac warnings, all of them are in Antlr generated code.&lt;/p&gt;

&lt;p&gt;Patch committed to trunk. Congratulation, Zhijie!&lt;/p&gt;</comment>
                            <comment id="13065184" author="zjshen" created="Thu, 14 Jul 2011 12:14:11 +0100"  >&lt;p&gt;Thanks for your help, Daniel&#65281;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12475811">PIG-1665</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12514108">PIG-2163</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12482746" name="PIG-1916_1.patch" size="9981" author="zjshen" created="Thu, 16 Jun 2011 04:39:41 +0100"/>
                            <attachment id="12483486" name="PIG-1916_2.patch" size="31337" author="zjshen" created="Wed, 22 Jun 2011 20:16:11 +0100"/>
                            <attachment id="12485119" name="PIG-1916_3.patch" size="31620" author="zjshen" created="Mon, 4 Jul 2011 07:51:15 +0100"/>
                            <attachment id="12486150" name="PIG-1916_4.patch" size="38885" author="zjshen" created="Tue, 12 Jul 2011 07:48:10 +0100"/>
                            <attachment id="12486413" name="PIG-1916_5.patch" size="39523" author="daijy" created="Thu, 14 Jul 2011 07:11:35 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 22 Mar 2011 12:33:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>68016</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyauh3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97248</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Allow cross two or more bags inside a foreach statement. For example:&lt;br/&gt;
&lt;br/&gt;
user = load &amp;#39;user&amp;#39; as (uid, age, gender, region);&lt;br/&gt;
session = load &amp;#39;session&amp;#39; as (uid, region);&lt;br/&gt;
C = cogroup user by uid, session by uid;&lt;br/&gt;
D = foreach C {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;crossed = cross user, session;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;generate crossed;&lt;br/&gt;
}&lt;br/&gt;
</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>