<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:55:56 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1825/PIG-1825.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1825] ability to turn off the write ahead log for pig&apos;s HBaseStorage</title>
                <link>https://issues.apache.org/jira/browse/PIG-1825</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Added an option to allow a caller of HBaseStorage to turn off the WriteAheadLog feature while doing bulk loads into hbase.&lt;/p&gt;

&lt;p&gt;From the performance tuning wikipage: &lt;a href=&quot;http://wiki.apache.org/hadoop/PerformanceTuning&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/hadoop/PerformanceTuning&lt;/a&gt;&lt;br/&gt;
&quot;To speed up the inserts in a non critical job (like an import job), you can use Put.writeToWAL(false) to bypass writing to the write ahead log.&quot;&lt;/p&gt;

&lt;p&gt;We&apos;ve tested this on HBase 0.20.6 and it helps dramatically.  &lt;/p&gt;

&lt;p&gt;The -noWAL options is passed in just like other options for hbase storage:&lt;/p&gt;

&lt;p&gt;STORE myalias INTO &apos;MyTable&apos; USING org.apache.pig.backend.hadoop.hbase.HBaseStorage(&apos;mycolumnfamily:field1 mycolumnfamily:field2&apos;,&apos;-noWAL&apos;);&lt;/p&gt;

&lt;p&gt;This would be my first patch so please educate me with any steps I need to do.  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12496866">PIG-1825</key>
            <summary>ability to turn off the write ahead log for pig&apos;s HBaseStorage</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="billgraham">Bill Graham</assignee>
                                    <reporter username="choenes">Corbin Hoenes</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Jan 2011 20:22:38 +0000</created>
                <updated>Mon, 6 Jun 2011 01:25:00 +0100</updated>
                            <resolved>Mon, 6 Jun 2011 01:24:47 +0100</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12987201" author="choenes" created="Wed, 26 Jan 2011 20:24:07 +0000"  >&lt;p&gt;Patched against branch_0.8.0&lt;/p&gt;</comment>
                            <comment id="12987203" author="choenes" created="Wed, 26 Jan 2011 20:26:15 +0000"  >&lt;p&gt;Patched against branch_0.8.0&lt;/p&gt;</comment>
                            <comment id="12989330" author="alangates" created="Tue, 1 Feb 2011 18:56:59 +0000"  >&lt;p&gt;Dmitriy, is this something we should check in?  You seemed to indicate that this was no longer necessary after we moved to HBase 0.89 or above.&lt;/p&gt;</comment>
                            <comment id="12989436" author="dvryaboy" created="Tue, 1 Feb 2011 23:00:13 +0000"  >&lt;p&gt;Sounds fine to me (though I haven&apos;t read the patch yet).&lt;br/&gt;
HBase 0.90 has significant speed improvements but I imagine it still writes a WAL and you can still turn it off.&lt;/p&gt;</comment>
                            <comment id="12990274" author="alangates" created="Thu, 3 Feb 2011 20:15:41 +0000"  >&lt;p&gt;Starting unit tests and test-patch&lt;/p&gt;</comment>
                            <comment id="12990759" author="alangates" created="Fri, 4 Feb 2011 21:38:29 +0000"  >&lt;p&gt;Unit tests pass.  The output of test-patch:&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; -1 overall.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 @author.  The patch does not contain any @author tags.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;                         Please justify why no tests are needed for this patch.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;As this points out, the functionality isn&apos;t tested.  Before we can check it in we&apos;ll need a test added to the hbase unit tests that shows that you can write to hbase with this option set.&lt;/p&gt;</comment>
                            <comment id="13026869" author="billgraham" created="Fri, 29 Apr 2011 07:03:26 +0100"  >&lt;p&gt;Attached is &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1825&quot; title=&quot;ability to turn off the write ahead log for pig&amp;#39;s HBaseStorage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1825&quot;&gt;&lt;del&gt;PIG-1825&lt;/del&gt;&lt;/a&gt;_1.patch that&apos;s updated to apply to the trunk that also contains a passing unit test.&lt;/p&gt;</comment>
                            <comment id="13031012" author="dvryaboy" created="Tue, 10 May 2011 05:49:26 +0100"  >&lt;p&gt;The patch is really straightforward and the test doesn&apos;t actually test the patch, except to make sure the argument doesn&apos;t break parsing.  WAL behavior is not actually verified.&lt;/p&gt;

&lt;p&gt;Two things we can do here: &lt;br/&gt;
1) make a createPut() method in HBStorage, call it from putNext(), and in a test create our own HBS, call createPut(), and check that put.getWriteToWal() returns the right value&lt;br/&gt;
2) ignore the trivial test.&lt;/p&gt;

&lt;p&gt;Option 1 is the right thing to do, 2 I can probably be convinced of. As is we shouldn&apos;t commit, since the test just adds extra time to unit tests without doing much useful work.&lt;/p&gt;</comment>
                            <comment id="13031024" author="dvryaboy" created="Tue, 10 May 2011 06:19:40 +0100"  >&lt;p&gt;btw, skipping WAL is a BAD idea. Cause, no WAL, even during &lt;b&gt;normal&lt;/b&gt; operation. WALs are useful for many things, recovery being only one of them.&lt;/p&gt;

&lt;p&gt;From the HBase book at &lt;a href=&quot;http://hbase.apache.org/book.html#perf.hbase.client.putwal&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hbase.apache.org/book.html#perf.hbase.client.putwal&lt;/a&gt; :&lt;/p&gt;

&lt;p&gt;13.7.7. Turn off WAL on Puts&lt;br/&gt;
A frequently discussed option for increasing throughput on Puts is to call writeToWAL(false). Turning this off means that the RegionServer will not write the Put to the Write Ahead Log, only into the memstore, HOWEVER the consequence is that if there is a RegionServer failure there will be data loss. If writeToWAL(false) is used, do so with extreme caution. You may find in actuality that it makes little difference if your load is well distributed across the cluster.&lt;/p&gt;

&lt;p&gt;In general, it is best to use WAL for Puts, and where loading throughput is a concern to use bulk loading techniques instead.&lt;/p&gt;</comment>
                            <comment id="13031039" author="billgraham" created="Tue, 10 May 2011 07:05:00 +0100"  >&lt;p&gt;Adding a second patch with new tests for option 2, which asserts that the WAL is disabled when createPut is called. There&apos;s still no assertion that createPut actually is used though, just as the original tests couldn&apos;t assert that disable WAL was called. &lt;/p&gt;

&lt;p&gt;Ideally we could somehow mock the Put or HTable or something to verify, but I think this would disrupt the code quite a bit for a simple test.&lt;/p&gt;

&lt;p&gt;Agreed, disabling the WAL should only be done with extreme caution. &lt;/p&gt;</comment>
                            <comment id="13031068" author="dvryaboy" created="Tue, 10 May 2011 08:09:36 +0100"  >&lt;p&gt;Cool. At this point I don&apos;t think we need testStoreToHBase_2_no_WAL() ?&lt;/p&gt;

&lt;p&gt;HBase itself doesn&apos;t actually test noWAL directly. I&apos;m ok with not testing the full path, just testing that we are using the HBase api correctly.&lt;/p&gt;

&lt;p&gt;I do almost want to make it &quot;-noSafety&quot; just to be clear about what one is doing when invoking this &quot;optimization&quot;....&lt;/p&gt;</comment>
                            <comment id="13032009" author="billgraham" created="Wed, 11 May 2011 20:59:16 +0100"  >&lt;p&gt;Here&apos;s patch #3 with &lt;tt&gt;testStoreToHBase_2_no_WAL&lt;/tt&gt; removed. I agree we should remove it if HBase doesn&apos;t even deal with it in the unit test mode.&lt;/p&gt;

&lt;p&gt;I think using the &lt;tt&gt;-noWAL&lt;/tt&gt; option makes the most sense, since it&apos;s very clear what it does. I&apos;ve added comments in the Javadocs to make sure the risks are clear.&lt;/p&gt;

&lt;p&gt;If someone uses an obscurely named flag (i.e., -noWAL) without understanding what it does by reading either the Pig javadocs or the HBase documentation, then they&apos;re really flying blind.&lt;/p&gt;</comment>
                            <comment id="13044660" author="dvryaboy" created="Mon, 6 Jun 2011 01:24:47 +0100"  >&lt;p&gt;Committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12469466" name="HBaseStorage_noWAL.patch" size="2196" author="choenes" created="Wed, 26 Jan 2011 20:26:15 +0000"/>
                            <attachment id="12477732" name="PIG-1825_1.patch" size="4343" author="billgraham" created="Fri, 29 Apr 2011 07:03:26 +0100"/>
                            <attachment id="12478670" name="PIG-1825_2.patch" size="6939" author="billgraham" created="Tue, 10 May 2011 07:05:00 +0100"/>
                            <attachment id="12478873" name="PIG-1825_3.patch" size="5971" author="billgraham" created="Wed, 11 May 2011 20:59:16 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Feb 2011 18:56:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>71895</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyatyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97165</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>