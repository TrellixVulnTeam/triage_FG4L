<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:53:20 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3020/PIG-3020.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3020] &quot;Duplicate uid in schema&quot; error when joining two relations derived from the same load statement</title>
                <link>https://issues.apache.org/jira/browse/PIG-3020</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The following validates OK with pig 0.9 and fails with the following error in 0.11 (and I suspect 0.10)&lt;/p&gt;

&lt;p&gt;pig -c debug2.pig&lt;/p&gt;

&lt;p&gt;Script: debug2.pig&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;A = LOAD &apos;foo&apos; AS (group:tuple(uid, dst_id), uids_with_recs:bag{} , uids_with_flock:bag{});
edges_both = FILTER A BY NOT IsEmpty(uids_with_recs) AND NOT IsEmpty(uids_with_flock);
edges_both = FOREACH edges_both GENERATE
    group.uid AS src_id,
    group.dst_id AS dst_id;
both_counts = GROUP edges_both BY src_id;
both_counts = FOREACH both_counts GENERATE
    group AS src_id, SIZE(edges_both) AS size_both;

edges_bq = FILTER A BY NOT IsEmpty(uids_with_recs);
edges_bq = FOREACH edges_bq GENERATE
    group.uid AS src_id,
    group.dst_id AS dst_id;
bq_counts = GROUP edges_bq BY src_id;
bq_counts = FOREACH bq_counts GENERATE
    group AS src_id, SIZE(edges_bq) AS size_bq;

per_user_set_sizes = JOIN bq_counts BY src_id LEFT OUTER, both_counts BY src_id;
store per_user_set_sizes into  &apos;foo&apos;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Error:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR 2270: Logical plan invalid state: duplicate uid in schema : bq_counts::src_id#417:bytearray,bq_counts::size_bq#468:long,both_counts::src_id#417:bytearray,both_counts::size_both#480:long

org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1067: Unable to explain alias null
	at org.apache.pig.PigServer.explain(PigServer.java:999)
	at org.apache.pig.tools.grunt.GruntParser.explainCurrentBatch(GruntParser.java:398)
	at org.apache.pig.tools.grunt.GruntParser.processExplain(GruntParser.java:330)
	at org.apache.pig.tools.grunt.Grunt.checkScript(Grunt.java:98)
	at org.apache.pig.Main.run(Main.java:600)
	at org.apache.pig.Main.main(Main.java:154)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.hadoop.util.RunJar.main(RunJar.java:186)
Caused by: org.apache.pig.impl.logicalLayer.FrontendException: ERROR 2000: Error processing rule LoadTypeCastInserter
	at org.apache.pig.newplan.optimizer.PlanOptimizer.optimize(PlanOptimizer.java:122)
	at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.compile(HExecutionEngine.java:277)
	at org.apache.pig.PigServer.compilePp(PigServer.java:1322)
	at org.apache.pig.PigServer.explain(PigServer.java:984)
	... 10 more
Caused by: org.apache.pig.impl.plan.PlanValidationException: ERROR 2270: Logical plan invalid state: duplicate uid in schema : bq_counts::src_id#417:bytearray,bq_counts::size_bq#468:long,both_counts::src_id#417:bytearray,both_counts::size_both#480:long
	at org.apache.pig.newplan.logical.optimizer.SchemaResetter.validate(SchemaResetter.java:232)
	at org.apache.pig.newplan.logical.optimizer.SchemaResetter.visit(SchemaResetter.java:105)
	at org.apache.pig.newplan.logical.relational.LOJoin.accept(LOJoin.java:171)
	at org.apache.pig.newplan.DependencyOrderWalker.walk(DependencyOrderWalker.java:75)
	at org.apache.pig.newplan.PlanVisitor.visit(PlanVisitor.java:52)
	at org.apache.pig.newplan.logical.optimizer.SchemaPatcher.transformed(SchemaPatcher.java:43)
	at org.apache.pig.newplan.optimizer.PlanOptimizer.optimize(PlanOptimizer.java:113)
	... 13 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12614280">PIG-3020</key>
            <summary>&quot;Duplicate uid in schema&quot; error when joining two relations derived from the same load statement</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jcoveney">Jonathan Coveney</assignee>
                                    <reporter username="julienledem">Julien Le Dem</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 Oct 2012 21:54:56 +0000</created>
                <updated>Fri, 18 Oct 2013 21:13:48 +0100</updated>
                            <resolved>Tue, 18 Dec 2012 02:41:35 +0000</resolved>
                                    <version>0.11</version>
                                    <fixVersion>0.11</fixVersion>
                    <fixVersion>0.12.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13488275" author="julienledem" created="Wed, 31 Oct 2012 21:56:41 +0000"  >&lt;p&gt;the check added in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2176&quot; title=&quot;add logical plan assumption checker &quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2176&quot;&gt;&lt;del&gt;PIG-2176&lt;/del&gt;&lt;/a&gt; is breaking this script&lt;/p&gt;</comment>
                            <comment id="13526723" author="julienledem" created="Fri, 7 Dec 2012 19:53:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3020&quot; title=&quot;&amp;quot;Duplicate uid in schema&amp;quot; error when joining two relations derived from the same load statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3020&quot;&gt;&lt;del&gt;PIG-3020&lt;/del&gt;&lt;/a&gt;.patch fixes the issue&lt;/p&gt;</comment>
                            <comment id="13526864" author="jcoveney" created="Fri, 7 Dec 2012 23:21:10 +0000"  >&lt;p&gt;This looks good to me, though I wonder if there is anyone who knows this code better than can take a look.&lt;/p&gt;</comment>
                            <comment id="13526925" author="dvryaboy" created="Sat, 8 Dec 2012 00:33:32 +0000"  >&lt;p&gt;are the manifest changes related?&lt;/p&gt;</comment>
                            <comment id="13530255" author="julienledem" created="Wed, 12 Dec 2012 19:52:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dvryaboy&quot; class=&quot;user-hover&quot; rel=&quot;dvryaboy&quot;&gt;Dmitriy V. Ryaboy&lt;/a&gt; I just noticed it was logging a warning with a NullPointerException when running tests from eclipse. I just fixed the log line to something clearer. It is not related but I feel it is small enough to be done here.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jcoveney&quot; class=&quot;user-hover&quot; rel=&quot;jcoveney&quot;&gt;Jonathan Coveney&lt;/a&gt; I also added a unit test with a pig script that was failing before and works now to validate my change.&lt;/p&gt;</comment>
                            <comment id="13531880" author="jcoveney" created="Fri, 14 Dec 2012 01:08:38 +0000"  >&lt;p&gt;Julien,&lt;/p&gt;

&lt;p&gt;I&apos;ve included a test that I think you should add to this patch (and it may turn out that pig 3093 is a duplicate of this).&lt;/p&gt;

&lt;p&gt;Either way, my test fails on trunk, but it fails with a different error on your branch. Looks like when you change the uid you whack the alias.&lt;/p&gt;</comment>
                            <comment id="13534214" author="jcoveney" created="Mon, 17 Dec 2012 19:38:31 +0000"  >&lt;p&gt;I&apos;ve attached a fix, with and without whitespace changes (would like to attach _ws, but easier to review without). This include and also fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3093&quot; title=&quot;Self join + realias results in schema errors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3093&quot;&gt;&lt;del&gt;PIG-3093&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13534401" author="julienledem" created="Mon, 17 Dec 2012 23:10:32 +0000"  >&lt;p&gt;looks good to me&lt;br/&gt;
+1&lt;/p&gt;</comment>
                            <comment id="13534454" author="jcoveney" created="Tue, 18 Dec 2012 00:20:41 +0000"  >&lt;p&gt;This is in trunk. Not sure if it meets the criteria to be in pig-11?&lt;/p&gt;</comment>
                            <comment id="13534495" author="dvryaboy" created="Tue, 18 Dec 2012 01:13:37 +0000"  >&lt;p&gt;existing scripts that work on pig 9 don&apos;t work on 11 without this so I think it needs to be in 11 (to prevent breaking changes).&lt;/p&gt;</comment>
                            <comment id="13534537" author="jcoveney" created="Tue, 18 Dec 2012 02:06:23 +0000"  >&lt;p&gt;I am inclined to agree. Will commit to 0.11&lt;/p&gt;</comment>
                            <comment id="13553541" author="elifinkelshteyn" created="Tue, 15 Jan 2013 06:36:10 +0000"  >&lt;p&gt;Is there any work around for this for 0.10 aside from substituting cogroup for join?&lt;/p&gt;</comment>
                            <comment id="13799469" author="knoguchi" created="Fri, 18 Oct 2013 21:13:48 +0100"  >&lt;p&gt;FYI, I&apos;m trying to revert the change from this jira at &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3492&quot; title=&quot;ColumnPrune dropping used column due to LogicalRelationalOperator.fixDuplicateUids changes not propagating&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3492&quot;&gt;&lt;del&gt;PIG-3492&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12671642">PIG-3492</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12623644">PIG-3093</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12514518">PIG-2176</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12561340" name="PIG-3020-2.patch" size="10732" author="jcoveney" created="Mon, 17 Dec 2012 19:38:31 +0000"/>
                            <attachment id="12561339" name="PIG-3020-2_ws.patch" size="17803" author="jcoveney" created="Mon, 17 Dec 2012 19:38:31 +0000"/>
                            <attachment id="12559938" name="PIG-3020.patch" size="14562" author="julienledem" created="Fri, 7 Dec 2012 19:53:14 +0000"/>
                            <attachment id="12560888" name="PIG-3020_branch-0.11_1.patch" size="11050" author="julienledem" created="Fri, 14 Dec 2012 00:43:50 +0000"/>
                            <attachment id="12560892" name="PIG-3093-testcase.patch" size="3053" author="jcoveney" created="Fri, 14 Dec 2012 01:08:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 7 Dec 2012 23:21:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253521</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy7mkf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>78466</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>