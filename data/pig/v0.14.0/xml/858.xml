<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:59:50 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-858/PIG-858.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-858] Order By followed by &quot;replicated&quot; join fails while compiling MR-plan from physical plan</title>
                <link>https://issues.apache.org/jira/browse/PIG-858</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Consider the query:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
A = load &apos;a&apos;;
B = order A by $0;
C = join A by $0, B by $0;
explain C;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;works. But if replicated join is used instead&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
A = load &apos;a&apos;;
B = order A by $0;
C = join A by $0, B by $0 using &lt;span class=&quot;code-quote&quot;&gt;&quot;replicated&quot;&lt;/span&gt;;
explain C;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;this fails with ERROR org.apache.pig.tools.grunt.Grunt - ERROR 2034: Error compiling operator POFRJoin&lt;br/&gt;
relevant stacktrace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.RuntimeException: org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MRCompilerException: ERROR 2034: Error compiling &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; POFRJoin
        at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.explain(HExecutionEngine.java:306)
        at org.apache.pig.PigServer.explain(PigServer.java:574)
        ... 8 more
Caused by: org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MRCompilerException: ERROR 2034: Error compiling &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; POFRJoin
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MRCompiler.visitFRJoin(MRCompiler.java:942)
        at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POFRJoin.visit(POFRJoin.java:173)
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MRCompiler.compile(MRCompiler.java:342)
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MRCompiler.compile(MRCompiler.java:327)
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MRCompiler.compile(MRCompiler.java:233)
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher.compile(MapReduceLauncher.java:301)
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher.explain(MapReduceLauncher.java:278)
        at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.explain(HExecutionEngine.java:303)
        ... 9 more
Caused by: java.lang.ArrayIndexOutOfBoundsException: -1
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MRCompiler.visitFRJoin(MRCompiler.java:901)
        ... 16 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12428390">PIG-858</key>
            <summary>Order By followed by &quot;replicated&quot; join fails while compiling MR-plan from physical plan</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ashutoshc">Ashutosh Chauhan</assignee>
                                    <reporter username="ashutoshc">Ashutosh Chauhan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Jun 2009 19:20:52 +0100</created>
                <updated>Wed, 24 Mar 2010 22:15:54 +0000</updated>
                            <resolved>Fri, 16 Oct 2009 20:21:57 +0100</resolved>
                                    <version>0.4.0</version>
                                    <fixVersion>0.6.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12733057" author="ashutoshc" created="Sun, 19 Jul 2009 20:51:20 +0100"  >&lt;p&gt;While POFRJoin is getting compiled in MRCompiler, it needs to identify for each of its &lt;br/&gt;
predecessor in physical plan of which compiled MROperator they are part of. Currently, it is&lt;br/&gt;
assumed to be one of the compiledInputs(an array of MRoper which are immediate predecessor of current MROper in MROper DAG). &lt;br/&gt;
Mostly this is true, but in cases where one physical operator results in two or more MR operator, this may not be true, as is the&lt;br/&gt;
case here. When there is an order-by before FRJoin; one of the inputs of POFRJoin will be&lt;br/&gt;
POSort, but POSort operator will be in the first MROper of the two generated MROperator&lt;br/&gt;
and thus will not be found in compiledInputs (which contains second MROper). Thus,&lt;br/&gt;
current way of identifying corresponding MRoper of a physical operator is unreliable.&lt;br/&gt;
This bug also affects the implementation of merge-sort join &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-845&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/PIG-845&lt;/a&gt; . Since POMergeJoin needs to know which MROper&lt;br/&gt;
corresponds to its left input and which one corresponds to its right. It can do so by looking&lt;br/&gt;
into compiledInputs as long as there is no order-by (or similiar PO which results in&lt;br/&gt;
multiple MROper) as its predecessors. Doing order-by before using merge&lt;br/&gt;
join is however a natural use-case there.&lt;/p&gt;

&lt;p&gt;Proposal is to introduce a new private member variable in MRCompiler phyToMROperMap &lt;br/&gt;
(similiar to logToPhyMap) using which leaf MROper for a given&lt;br/&gt;
physical operator can be identified. Thoughts?&lt;/p&gt;
</comment>
                            <comment id="12755267" author="ashutoshc" created="Tue, 15 Sep 2009 01:33:18 +0100"  >&lt;p&gt;Patch as discussed in previous comment. Also included are test cases, where blocking operator (order-by, distinct) occurs before FRjoin.&lt;/p&gt;</comment>
                            <comment id="12760141" author="hadoopqa" created="Mon, 28 Sep 2009 04:04:17 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12419592/pig-858.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12419592/pig-858.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 819057.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/47/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/47/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/47/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/47/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/47/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/47/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12765334" author="alangates" created="Wed, 14 Oct 2009 01:26:36 +0100"  >&lt;p&gt;I&apos;m reviewing this patch.&lt;/p&gt;</comment>
                            <comment id="12765601" author="alangates" created="Wed, 14 Oct 2009 16:56:26 +0100"  >&lt;p&gt;Mostly looks straight forward and passes all the tests.  You made a number of changes in MRCompiler.visitUnion.  I don&apos;t understand what exactly you were changing there.  Could you give a brief overview of those changes?&lt;/p&gt;</comment>
                            <comment id="12765720" author="ashutoshc" created="Wed, 14 Oct 2009 21:08:39 +0100"  >&lt;p&gt;visitUnion has same changes as others visit functions, that is it adds MR Operator corresponding to POUnion in phyToMROpMap map. Real changes are in visitFRJoin. Earlier in visitFRJoin, it used to look in compiledInputs array of MROper one by one trying to match MROPer leaf PO with POFRJoin using operator key. Now, it doesn&apos;t need to do that it can simply lookup in the phyToMROpMap.&lt;/p&gt;</comment>
                            <comment id="12765735" author="ashutoshc" created="Wed, 14 Oct 2009 21:29:37 +0100"  >&lt;p&gt;Its been a while since I did that patch. So, bit more clarification: We are interested in finding PO which corresponds to &quot;fragment&quot; PO input of POFRJoin. This PO is already compiled and is in one the MROper. Earlier we  will iterate through compiledInputs array trying to match this PO  with PO contained in each MROperator. This fails as discussed in previous comments. With this change, since we keep track of MR operator with each physical operator it need not to do that but can simply look up for MROper corresponding to &quot;fragment&quot; PO in the phyToMROpMap.&lt;/p&gt;</comment>
                            <comment id="12766669" author="alangates" created="Fri, 16 Oct 2009 20:21:57 +0100"  >&lt;p&gt;Fix checked in.  Thanks Ashutosh for the patch and explanation.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12419592" name="pig-858.patch" size="14541" author="ashutoshc" created="Tue, 15 Sep 2009 01:33:18 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 28 Sep 2009 03:04:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164410</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyajqn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95509</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>