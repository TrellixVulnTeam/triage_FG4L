<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:53:57 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2534/PIG-2534.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2534] Pig generating infinite map outputs</title>
                <link>https://issues.apache.org/jira/browse/PIG-2534</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;I am getting a strange behavior by Pig in the below script for Pig 0.9.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
event_serve = LOAD &apos;input1&apos;   AS (s, m, l);
cm_data_raw = LOAD &apos;input2&apos;  AS (s, m, l);

SPLIT cm_data_raw INTO
    cm_serve_raw IF (( (chararray) (s#&apos;key1&apos;) == &apos;0&apos;) AND ( (chararray) (s#&apos;key2&apos;) == &apos;5&apos;)),
    cm_click_raw IF (( (chararray) (s#&apos;key1&apos;) == &apos;1&apos;) AND ( (chararray) (s#&apos;key2&apos;) == &apos;5&apos;));

cm_serve = FOREACH cm_serve_raw GENERATE  s#&apos;key3&apos; AS f1,  s#&apos;key4&apos; AS f2, s#&apos;key5&apos; AS f3 ;
cm_serve_lowercase = stream cm_serve through `echo val3`;

cm_serve_final = FOREACH cm_serve_lowercase GENERATE  $0 AS cm_event_guid, $1 AS cm_receive_time, $2 AS cm_ctx_url;

event_serve_filtered = FILTER event_serve BY  (chararray) (s#&apos;key1&apos;) neq &apos;xxx&apos; AND (chararray) (s#&apos;key2&apos;) neq &apos;yyy&apos; ;

event_serve_project = FOREACH event_serve_filtered GENERATE  s#&apos;key3&apos; AS event_guid, s#&apos;key4&apos; AS receive_time;

event_serve_join = join cm_serve_final by (cm_event_guid),
    event_serve_project by (event_guid);

store event_serve_join into &apos;somewhere&apos;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Input (both input1 and input2 is same)&lt;br/&gt;
&amp;#8212;&lt;br/&gt;
&lt;a href=&quot;#0,key2#5,key3#val3,key4#val4,key5#val5&quot;&gt;key1#0,key2#5,key3#val3,key4#val4,key5#val5&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;If i run this pig script with ColumnMapKeyPrune disabled, the job goes through fine and 1 output is created.&lt;br/&gt;
But if I run this script by default, then it keeps on generating map output records infinitely. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12542742">PIG-2534</key>
            <summary>Pig generating infinite map outputs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="vivekp">Vivek Padmanabhan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Feb 2012 19:57:47 +0000</created>
                <updated>Fri, 26 Jul 2013 18:59:17 +0100</updated>
                            <resolved>Thu, 1 Mar 2012 07:22:53 +0000</resolved>
                                    <version>0.9.1</version>
                                    <fixVersion>0.10.0</fixVersion>
                    <fixVersion>0.9.3</fixVersion>
                    <fixVersion>0.11</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13210157" author="vivekp" created="Fri, 17 Feb 2012 09:24:49 +0000"  >&lt;p&gt;Posting a test case without SPLIT to reproduce this issue&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testINFINITE() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

        File f1 = Util.createFile(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; [] {&lt;span class=&quot;code-quote&quot;&gt;&quot;[key1#0,key2#5,key3#val3,key4#val4,key5#val5]&quot;&lt;/span&gt;} );
        File f2 = Util.createFile(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; [] {&lt;span class=&quot;code-quote&quot;&gt;&quot;[key1#0,key2#5,key3#val3,key4#val4,key5#val5]&quot;&lt;/span&gt;} );

        PigServer ps = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PigServer(ExecType.LOCAL);
        ps.registerQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;event_serve = LOAD &apos;file:&lt;span class=&quot;code-comment&quot;&gt;//&quot;&lt;/span&gt;+f1.getAbsolutePath()+&lt;span class=&quot;code-quote&quot;&gt;&quot;&apos; AS (s, m, l);&quot;&lt;/span&gt;);
&lt;/span&gt;        ps.registerQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;cm_data_raw = LOAD &apos;file:&lt;span class=&quot;code-comment&quot;&gt;//&quot;&lt;/span&gt;+f2.getAbsolutePath()+&lt;span class=&quot;code-quote&quot;&gt;&quot;&apos; AS (s, m, l);&quot;&lt;/span&gt;);
&lt;/span&gt;        ps.registerQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;cm_serve = FOREACH cm_data_raw GENERATE  s#&apos;key3&apos; AS f1,  s#&apos;key4&apos; AS f2, s#&apos;key5&apos; AS f3 ;&quot;&lt;/span&gt;);
        ps.registerQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;cm_serve_lowercase = stream cm_serve through `tr [:upper:] [:lower:]`  ;&quot;&lt;/span&gt;);
        ps.registerQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;cm_serve_final = FOREACH cm_serve_lowercase GENERATE  $0 AS cm_event_guid, $1 AS cm_receive_time, $2 AS cm_ctx_url;&quot;&lt;/span&gt;);
        ps.registerQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;event_serve_project = FOREACH  event_serve GENERATE  s#&apos;key3&apos; AS event_guid, s#&apos;key4&apos; AS receive_time;&quot;&lt;/span&gt;);
        ps.registerQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;event_serve_join = join cm_serve_final by (cm_event_guid), event_serve_project by (event_guid);&quot;&lt;/span&gt;);

        Iterator&amp;lt;Tuple&amp;gt; itr = ps.openIterator(&lt;span class=&quot;code-quote&quot;&gt;&quot;event_serve_join&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;(itr.hasNext())
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(itr.next());

    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13210744" author="daijy" created="Sat, 18 Feb 2012 01:55:13 +0000"  >&lt;p&gt;It happens when stream does not have an output schema. A workaround is to change&lt;br/&gt;
stream cm_serve through `tr &lt;span class=&quot;error&quot;&gt;&amp;#91;:upper:&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;:lower:&amp;#93;&lt;/span&gt;`&lt;br/&gt;
into&lt;br/&gt;
stream cm_serve through `tr &lt;span class=&quot;error&quot;&gt;&amp;#91;:upper:&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;:lower:&amp;#93;&lt;/span&gt;` as (a, b, c)&lt;/p&gt;

&lt;p&gt;I will upload a patch shortly.&lt;/p&gt;</comment>
                            <comment id="13217855" author="thejas" created="Tue, 28 Feb 2012 02:55:31 +0000"  >&lt;p&gt;+1 &lt;br/&gt;
I think we should add a javadoc comment to the setOutputUids function, saying that it checks for null schema and throws an exception to stop column pruning from happening. We should also consider moving such checks (such as null schema) that need to happen on all logical operators to a separate visitor (subclass of a AllLogicalExpressionVisitor?), which gets called from the Transformer.check().&lt;/p&gt;

</comment>
                            <comment id="13217986" author="dvryaboy" created="Tue, 28 Feb 2012 07:56:15 +0000"  >&lt;p&gt;It throws an exception as part of normal flow control? Can we refactor that?&lt;/p&gt;</comment>
                            <comment id="13219870" author="daijy" created="Thu, 1 Mar 2012 07:16:47 +0000"  >&lt;p&gt;Attach &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2534&quot; title=&quot;Pig generating infinite map outputs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2534&quot;&gt;&lt;del&gt;PIG-2534&lt;/del&gt;&lt;/a&gt;-2.patch to add comments to setOutputUids, also fix a findbug warning. For refactory, we can certainly do it, but since that is lower priority, I will open a separate ticket to address it.&lt;/p&gt;</comment>
                            <comment id="13219873" author="daijy" created="Thu, 1 Mar 2012 07:22:53 +0000"  >&lt;p&gt;Unit test pass. test-patch:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; -1 overall.  &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 @author.  The patch does not contain any @author tags.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 tests included.  The patch appears to include 3 new or modified tests.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     -1 javadoc.  The javadoc tool appears to have generated 1 warning messages.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     -1 release audit.  The applied patch generated 533 release audit warnings (more than the trunk&apos;s current 530 warnings).&lt;/p&gt;

&lt;p&gt;javadoc and release audit warning is unrelated.&lt;/p&gt;

&lt;p&gt;Patch committed to 0.9/0.10/trunk&lt;/p&gt;</comment>
                            <comment id="13219877" author="daijy" created="Thu, 1 Mar 2012 07:25:19 +0000"  >&lt;p&gt;Open &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2566&quot; title=&quot;Refactory ColumnPruneHelper not throw exception in normal flow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2566&quot;&gt;PIG-2566&lt;/a&gt; to track Dmitriy&apos;s comment.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12544733">PIG-2566</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12515312" name="PIG-2534-1.patch" size="3092" author="daijy" created="Tue, 21 Feb 2012 02:30:56 +0000"/>
                            <attachment id="12516650" name="PIG-2534-2.patch" size="4101" author="daijy" created="Thu, 1 Mar 2012 07:16:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 18 Feb 2012 01:55:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>228028</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy3tfb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56091</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>