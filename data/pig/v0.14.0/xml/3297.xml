<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:59:43 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3297/PIG-3297.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3297] Avro files with stringType set to String cannot be read by the AvroStorage LoadFunc</title>
                <link>https://issues.apache.org/jira/browse/PIG-3297</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;When an Avro file is created there exists the option to set the &quot;String Type&quot; to a different class than the default Utf8.&lt;br/&gt;
A very common situation is that the &quot;String Type&quot; is set to the default String class.&lt;/p&gt;

&lt;p&gt;When trying to read such an Avro file in Pig using the AvroStorage LoadFunc from the included piggybank this gives the following Exception:&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.ClassCastException: java.lang.String cannot be cast to org.apache.avro.util.Utf8&lt;br/&gt;
        at org.apache.pig.piggybank.storage.avro.PigAvroDatumReader.readString(PigAvroDatumReader.java:154)&lt;br/&gt;
        at org.apache.avro.generic.GenericDatumReader.read(GenericDatumReader.java:150)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12644554">PIG-3297</key>
            <summary>Avro files with stringType set to String cannot be read by the AvroStorage LoadFunc</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nielsbasjes">Niels Basjes</assignee>
                                    <reporter username="nielsbasjes">Niels Basjes</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Apr 2013 09:42:12 +0100</created>
                <updated>Mon, 14 Oct 2013 17:46:10 +0100</updated>
                            <resolved>Tue, 21 May 2013 23:11:28 +0100</resolved>
                                    <version>0.11.1</version>
                                    <fixVersion>0.12.0</fixVersion>
                                    <component>piggybank</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13641891" author="nielsbasjes" created="Thu, 25 Apr 2013 16:25:42 +0100"  >&lt;p&gt;I have a working fix that I&apos;ll submit shortly.&lt;/p&gt;</comment>
                            <comment id="13642202" author="nielsbasjes" created="Thu, 25 Apr 2013 21:56:54 +0100"  >&lt;p&gt;The patch I created.&lt;/p&gt;</comment>
                            <comment id="13651811" author="nielsbasjes" created="Wed, 8 May 2013 12:38:50 +0100"  >&lt;p&gt;I found that although the fix correct is that the test I created not right is.&lt;/p&gt;</comment>
                            <comment id="13651938" author="nielsbasjes" created="Wed, 8 May 2013 15:35:21 +0100"  >&lt;p&gt;The simplest test file that demonstrates the bug.&lt;/p&gt;</comment>
                            <comment id="13654700" author="michaelmoss" created="Fri, 10 May 2013 19:30:43 +0100"  >&lt;p&gt;Niels, I&apos;ve run into this also (and a similar issue with Hive), and it seems that it might be brought on not by the code you patched, but perhaps in the avro-1.x.y.jar files itself.&lt;/p&gt;

&lt;p&gt;We are serializing strings as avro.java.string and everything was working fine on our HDP1.2 (Hortonworks) cluster, but when I upgraded the avro jar that pig uses to avro-1.7.4 from avro-1.5.3, I get this exception.&lt;/p&gt;

&lt;p&gt;I&apos;m also have this issue on the latest version of CDH4.2 (with Impala1.0) in both pig and hive and the culprit there seems to be the avro-1.7.x.jar that they use.&lt;/p&gt;

&lt;p&gt;I&apos;m just starting to dig into finding out why, but was hoping you or someone here might have some insight.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13661347" author="nielsbasjes" created="Sat, 18 May 2013 13:36:02 +0100"  >&lt;p&gt;In reply to the question Michael Moss posted to the Avro mailing list the reponse was that the proposed fix is the correct way to solve the issue.&lt;br/&gt;
See: &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/avro-user/201305.mbox/%3CCDB6AEC8.EE942%25scott@richrelevance.com%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/avro-user/201305.mbox/%3CCDB6AEC8.EE942%25scott@richrelevance.com%3E&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Quote:&lt;blockquote&gt;
&lt;p&gt;The change in the Pig loader in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3297&quot; title=&quot;Avro files with stringType set to String cannot be read by the AvroStorage LoadFunc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3297&quot;&gt;&lt;del&gt;PIG-3297&lt;/del&gt;&lt;/a&gt; seems correct &#139; they must use&lt;br/&gt;
CharSequence, not Utf8.&lt;/p&gt;&lt;/blockquote&gt;&lt;/p&gt;</comment>
                            <comment id="13662405" author="nielsbasjes" created="Mon, 20 May 2013 23:21:17 +0100"  >&lt;p&gt;The only way to have a unit test for this bug is to bump the version of Avro that is used while doing the junit tests to version 1.7.4&lt;/p&gt;</comment>
                            <comment id="13662410" author="nielsbasjes" created="Mon, 20 May 2013 23:24:36 +0100"  >&lt;p&gt;The fix for this bug is very simple.&lt;br/&gt;
In order to have a unit test that actually fails without this fix we create a dependency with upgrading the dependency with avro to version 1.7.4&lt;/p&gt;

&lt;p&gt;I leave it to the committers to decide to &quot;just do the fix&quot; or to &quot;do the fix, upgrade to Avro, and add the unit test&quot;.&lt;/p&gt;</comment>
                            <comment id="13662412" author="nielsbasjes" created="Mon, 20 May 2013 23:25:19 +0100"  >&lt;p&gt;Is blocked iff we want to use the provided unit test.&lt;/p&gt;</comment>
                            <comment id="13662414" author="nielsbasjes" created="Mon, 20 May 2013 23:27:05 +0100"  >&lt;p&gt;The fix for this bug is very simple.&lt;br/&gt;
In order to have a unit test that actually fails without this fix we create a dependency with upgrading the dependency with avro to version 1.7.4&lt;br/&gt;
I leave it to the committers to decide to &quot;just do the fix&quot; or to &quot;do the fix, upgrade to Avro, and add the unit test&quot;.&lt;br/&gt;
For this reason the fix and the unit test are placed in separate files.&lt;/p&gt;</comment>
                            <comment id="13662640" author="cheolsoo" created="Tue, 21 May 2013 04:47:02 +0100"  >&lt;p&gt;+1.&lt;/p&gt;</comment>
                            <comment id="13663474" author="cheolsoo" created="Tue, 21 May 2013 23:11:29 +0100"  >&lt;p&gt;I only committed the fix to trunk. Please let me know if you&apos;d like to get the unit test committed as well.&lt;/p&gt;

&lt;p&gt;Thanks Niels!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12648519">PIG-3332</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12580585" name="PIG-3297-1.patch" size="5035" author="nielsbasjes" created="Thu, 25 Apr 2013 21:56:54 +0100"/>
                            <attachment id="12583902" name="PIG-3297-v2-20130521-The-fix.patch" size="831" author="nielsbasjes" created="Mon, 20 May 2013 23:24:36 +0100"/>
                            <attachment id="12583903" name="PIG-3297-v2-20130521-Unittest.patch" size="11409" author="nielsbasjes" created="Mon, 20 May 2013 23:24:36 +0100"/>
                            <attachment id="12582298" name="test_record.avro" size="225" author="nielsbasjes" created="Wed, 8 May 2013 15:35:21 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 10 May 2013 18:30:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>324919</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzdwo7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>325264</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Read Avro files that have string fields that were written with avro.java.string = String&lt;br/&gt;
</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>