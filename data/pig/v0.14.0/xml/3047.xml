<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:03:59 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3047/PIG-3047.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3047] Check the size of a relation before adding it to distributed cache in Replicated join</title>
                <link>https://issues.apache.org/jira/browse/PIG-3047</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Right now if someone makes a mistake and put the large relation last, Pig will copy a huge file into distributed cache and it will take a long time before the job eventually fails. It would be better to check before copying the relation that it is of reasonable size.&lt;br/&gt;
&amp;lt;1 GB ?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12615958">PIG-3047</key>
            <summary>Check the size of a relation before adding it to distributed cache in Replicated join</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aniket486">Aniket Mokashi</assignee>
                                    <reporter username="julienledem">Julien Le Dem</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Nov 2012 20:53:41 +0000</created>
                <updated>Tue, 15 Apr 2014 21:44:56 +0100</updated>
                            <resolved>Tue, 29 Oct 2013 00:16:35 +0000</resolved>
                                                    <fixVersion>0.12.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13496536" author="prkommireddi" created="Tue, 13 Nov 2012 21:00:02 +0000"  >&lt;p&gt;Hi Julien,&lt;/p&gt;

&lt;p&gt;What do you think about setting this size as a % based on &quot;mapred.child.java.opts&quot;?&lt;/p&gt;</comment>
                            <comment id="13496642" author="jcoveney" created="Tue, 13 Nov 2012 22:58:00 +0000"  >&lt;p&gt;I agree with Prashant that hardcoding a size is a bit janky.&lt;/p&gt;</comment>
                            <comment id="13496699" author="julienledem" created="Wed, 14 Nov 2012 00:12:01 +0000"  >&lt;p&gt;I&apos;m open to suggestions regarding what is a reasonable size for a relation used in a replicated join.&lt;br/&gt;
should it be a % of the max heap size?&lt;br/&gt;
I&apos;d avoid to parse mapred.child.java.opts though. Is there a better way?&lt;/p&gt;</comment>
                            <comment id="13496744" author="prkommireddi" created="Wed, 14 Nov 2012 01:37:12 +0000"  >&lt;p&gt;We could possibly do something similar to Hadoop&apos;s ShuffleRamManager, minus the wait()/notify() on memory freeing-up&lt;/p&gt;

&lt;p&gt;1. % of max heap/available memory to JVM&lt;br/&gt;
2. % could be specified by user&lt;br/&gt;
3. User could also choose to specify a certain size in bytes&lt;br/&gt;
4. Ship pig with a conservative % to start with&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="13508600" author="prkommireddi" created="Mon, 3 Dec 2012 09:22:06 +0000"  >&lt;p&gt;Julien, Jon - what do you guys think about the above proposal?&lt;/p&gt;</comment>
                            <comment id="13509411" author="jcoveney" created="Tue, 4 Dec 2012 01:25:39 +0000"  >&lt;p&gt;Prashant: that sounds good to me. Just make it configurable (as you proposed) and have those configuration keys in the PigConfiguration class and it should be good.&lt;/p&gt;</comment>
                            <comment id="13525807" author="julienledem" created="Thu, 6 Dec 2012 22:08:53 +0000"  >&lt;p&gt;sounds good to me&lt;/p&gt;</comment>
                            <comment id="13796376" author="aniket486" created="Wed, 16 Oct 2013 04:39:01 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ihadanny&quot; class=&quot;user-hover&quot; rel=&quot;ihadanny&quot;&gt;Ido Hadanny&lt;/a&gt;, have you already started working on this?&lt;/p&gt;</comment>
                            <comment id="13796424" author="ihadanny" created="Wed, 16 Oct 2013 05:52:51 +0100"  >&lt;p&gt;no, was planning to start today. is it ok with you?&lt;/p&gt;
</comment>
                            <comment id="13796801" author="ihadanny" created="Wed, 16 Oct 2013 14:54:56 +0100"  >&lt;p&gt;When the replicated input sizes is bigger than pig.fr_join.max.bytes.size, we throw a nice exception (ryuchtman + ihadanny)&lt;/p&gt;</comment>
                            <comment id="13796809" author="ryuchtman" created="Wed, 16 Oct 2013 15:00:38 +0100"  >&lt;p&gt;we only implemented option 3 in Prashant suggestion (with deafult of 1G), but it should be pretty easy to implement the rest&lt;/p&gt;</comment>
                            <comment id="13797666" author="aniket486" created="Thu, 17 Oct 2013 07:57:09 +0100"  >&lt;p&gt;This is excellent. option 3 should be good enough to cover scope of this jira.&lt;br/&gt;
A few comments on implementation-&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;if(!UriUtil.isHDFSFile(location)) - is that required?&lt;/li&gt;
	&lt;li&gt;Can you use Utils.getPathLength to get the size of files.&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="13797667" author="aniket486" created="Thu, 17 Oct 2013 07:59:21 +0100"  >&lt;p&gt;Also, how about rename pig.fr_join.max.bytes.size to pig.join.replicated.max.bytes (or any other suitable)? Also, please move it to PigConfiguration class and also make an entry into pig.properties.&lt;/p&gt;</comment>
                            <comment id="13800148" author="ihadanny" created="Sun, 20 Oct 2013 16:03:40 +0100"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aniket486&quot; class=&quot;user-hover&quot; rel=&quot;aniket486&quot;&gt;Aniket Mokashi&lt;/a&gt;! &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ryuchtman&quot; class=&quot;user-hover&quot; rel=&quot;ryuchtman&quot;&gt;Ran Yuchtman&lt;/a&gt; and I implemented your suggestions and uploaded the fixed patch. Please re-review.&lt;/p&gt;</comment>
                            <comment id="13800164" author="aniket486" created="Sun, 20 Oct 2013 18:50:25 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ihadanny&quot; class=&quot;user-hover&quot; rel=&quot;ihadanny&quot;&gt;Ido Hadanny&lt;/a&gt;, thanks for updating the patch!&lt;/p&gt;

&lt;p&gt;Few more comments-&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;comment on the test still mentions the old property name.&lt;/li&gt;
	&lt;li&gt;We typically catch the exception in test and assert the error message. Can you modify your test to do so?&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I tried your patch on trunk and found some problems with it.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;If I modify the test to remove the catch exception annotation and increase the configuration value to 18. I get following exception stack-
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: org.apache.pig.impl.plan.VisitorException: ERROR 0: Replicated input files size: 64063 exceeds pig.join.replicated.max.bytes: 18
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler$JoinDistributedCacheVisitor.visitFRJoin(JobControlCompiler.java:1578)
	... 42 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;With your old patch, I get following exception stack-
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: org.apache.pig.impl.plan.VisitorException: ERROR 0: Replicated input files size: 17 exceeds pig.fr_join.max.bytes.size: 14
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler$JoinDistributedCacheVisitor.visitFRJoin(JobControlCompiler.java:1579)
	... 42 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13805919" author="aniket486" created="Sat, 26 Oct 2013 02:10:41 +0100"  >&lt;p&gt;Your patch does not have the right fix for this problem. If you look closely, the first fragment of replFiles is not added to distributed cache and hence we should not add all of replFiles. The reason first patch works is because at the time this check is made replFiles&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; is null hence it is skipped. Also, since you are not recursively listing the files, you do not hit the problem we hit in the second patch (hidden _logs directory). The reason second patch test case shows big numbers is because of hidden _logs directory in the replicated data path. I fixed the Utils.getPathLength method to ignore the hidden files. &lt;b&gt;This also affects reducer estimation code path by ignoring hidden directories while listing input&lt;/b&gt;, which I feel is right way to go.&lt;/p&gt;</comment>
                            <comment id="13806013" author="aniket486" created="Sat, 26 Oct 2013 07:37:59 +0100"  >&lt;p&gt;RB: &lt;a href=&quot;https://reviews.apache.org/r/14964/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/14964/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13807511" author="aniket486" created="Tue, 29 Oct 2013 00:16:28 +0000"  >&lt;p&gt;Committed to trunk and 0.12 branch!&lt;br/&gt;
Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ihadanny&quot; class=&quot;user-hover&quot; rel=&quot;ihadanny&quot;&gt;Ido Hadanny&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;..&lt;/p&gt;</comment>
                            <comment id="13807647" author="knoguchi" created="Tue, 29 Oct 2013 03:42:12 +0000"  >&lt;p&gt;Seems like compile-test is failing on test/TestFRJoin2.java after the commit.  Can you take a look?&lt;/p&gt;</comment>
                            <comment id="13807663" author="knoguchi" created="Tue, 29 Oct 2013 04:20:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;Seems like compile-test is failing on test/TestFRJoin2.java after the commit. Can you take a look?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sorry, this is on 0.12 branch.&lt;/p&gt;</comment>
                            <comment id="13807679" author="aniket486" created="Tue, 29 Oct 2013 04:58:38 +0000"  >&lt;p&gt;It&apos;s missing an import statement which was not required by trunk. I will commit the change shortly after test-commit pass.&lt;/p&gt;</comment>
                            <comment id="13807720" author="aniket486" created="Tue, 29 Oct 2013 06:14:41 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knoguchi&quot; class=&quot;user-hover&quot; rel=&quot;knoguchi&quot;&gt;Koji Noguchi&lt;/a&gt; for catching this. I have added the missing imports to TestFRJoin2.java.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12610428" name="PIG-3047-2.patch" size="11977" author="aniket486" created="Sat, 26 Oct 2013 02:30:02 +0100"/>
                            <attachment id="12610712" name="PIG-3047-3.patch" size="14725" author="aniket486" created="Mon, 28 Oct 2013 23:02:20 +0000"/>
                            <attachment id="12608713" name="fix_pig_3047.diff" size="5807" author="ihadanny" created="Wed, 16 Oct 2013 14:56:09 +0100"/>
                            <attachment id="12609309" name="fix_pig_3047_1.diff" size="6445" author="ihadanny" created="Sun, 20 Oct 2013 16:02:22 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 13 Nov 2012 21:00:02 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>257564</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hydxuf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>115347</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>