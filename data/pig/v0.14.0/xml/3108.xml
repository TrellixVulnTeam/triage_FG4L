<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:58:41 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3108/PIG-3108.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3108] HBaseStorage returns empty maps when mixing wildcard- with other columns</title>
                <link>https://issues.apache.org/jira/browse/PIG-3108</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Consider the following:&lt;br/&gt;
A and B should be the same (with different order, of course).&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/*
in hbase shell:

create &apos;pigtest&apos;, &apos;pig&apos;
put &apos;pigtest&apos; , &apos;1&apos;, &apos;pig:name&apos;, &apos;A&apos;
put &apos;pigtest&apos; , &apos;1&apos;, &apos;pig:has_legs&apos;, &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;
put &apos;pigtest&apos; , &apos;1&apos;, &apos;pig:has_ribs&apos;, &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;
*/
A = LOAD &apos;hbase:&lt;span class=&quot;code-comment&quot;&gt;//pigtest&apos; USING org.apache.pig.backend.hadoop.hbase.HBaseStorage(&apos;pig:name pig:has*&apos;) AS (name:chararray,parts);
&lt;/span&gt;
B = LOAD &apos;hbase:&lt;span class=&quot;code-comment&quot;&gt;//pigtest&apos; USING org.apache.pig.backend.hadoop.hbase.HBaseStorage(&apos;pig:has* pig:name&apos;) AS (parts,name:chararray);
&lt;/span&gt;
dump A;
dump B;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is due to a bug in setLocation and initScan.&lt;br/&gt;
For &lt;em&gt;A&lt;/em&gt; &lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;scan.addColumn(pig,name); // for &apos;pig:name&apos;&lt;/li&gt;
	&lt;li&gt;scan.addFamily(pig); // for the &apos;pig:has*&apos;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;So that&apos;s silently right.&lt;/p&gt;

&lt;p&gt;But for &lt;em&gt;B&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;scan.addFamily(pig)&lt;/li&gt;
	&lt;li&gt;scan.addColumn(pig,name)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;will override the first call to addFamily, because you cannot mix them on the same family.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12625414">PIG-3108</key>
            <summary>HBaseStorage returns empty maps when mixing wildcard- with other columns</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="christoph.bauer">Christoph Bauer</assignee>
                                    <reporter username="christoph.bauer">Christoph Bauer</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Dec 2012 12:05:38 +0000</created>
                <updated>Mon, 14 Oct 2013 17:45:56 +0100</updated>
                            <resolved>Tue, 12 Feb 2013 05:04:40 +0000</resolved>
                                    <version>0.9.0</version>
                    <version>0.9.1</version>
                    <version>0.9.2</version>
                    <version>0.10.0</version>
                    <version>0.11</version>
                    <version>0.10.1</version>
                    <version>0.12.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13540457" author="christoph.bauer" created="Fri, 28 Dec 2012 13:19:20 +0000"  >&lt;p&gt;fixes this bug in trunk&lt;/p&gt;</comment>
                            <comment id="13543237" author="billgraham" created="Thu, 3 Jan 2013 20:02:02 +0000"  >&lt;p&gt;Thanks for digging into this one. I&apos;m a confused either by the example or the implementation. The example seems to point out a bug when there are column descriptors with prefixes (i.e. &lt;tt&gt;has*&lt;/tt&gt; or &lt;tt&gt;name*&lt;/tt&gt;), but the fix is in &lt;tt&gt;addFiltersWithoutColumnPrefix&lt;/tt&gt; which should only apply when there is no column with a descriptor. This is an intentional fork in how filters and/or scans are used which happens in this block of code:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;if (!columnPrefixExists) {
    addFiltersWithoutColumnPrefix(columnInfo_);
}
else {
    addFiltersWithColumnPrefix(columnInfo_);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13543751" author="christoph.bauer" created="Fri, 4 Jan 2013 10:08:11 +0000"  >&lt;p&gt;Sorry. I&apos;ve been with this code too long. I will try to explain.&lt;/p&gt;

&lt;p&gt;addFiltersWithColumnPrefix and  addFiltersWithoutColumnPrefix actually do&lt;br/&gt;
different things:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;addFiltersWithColumnPrefix creates HBase scan filters&lt;/li&gt;
	&lt;li&gt;addFiltersWithoutColumnPrefix tells the scan object the families and&lt;br/&gt;
   columns to retrieve. This is much quicker than adding filters, thats why it&lt;br/&gt;
   was changed.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The thing is: the scan object should always be limited to the&lt;br/&gt;
family/columns needed to speed things up. In fact we did this already - see&lt;br/&gt;
setLocation (it&apos;s basicly the same as in addFiltersWithoutColumnPrefix).&lt;/p&gt;

&lt;p&gt;So what I did was to replace the code in setLocation with a call to&lt;br/&gt;
addFiltersWithoutColumnPrefix&lt;/p&gt;


&lt;p&gt;To make things clear, we could remove addFiltersWithoutColumnPrefix  from&lt;br/&gt;
the if/else in initScan() ()setLocation will called anyway) and rename it&lt;br/&gt;
to setScanColumns or something.&lt;/p&gt;



&lt;p&gt;2013/1/3 Bill Graham (JIRA) &amp;lt;jira@apache.org&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="13545642" author="billgraham" created="Mon, 7 Jan 2013 05:17:40 +0000"  >&lt;p&gt;Got it, thanks for the clarification. A few comments then:&lt;/p&gt;

&lt;p&gt;1. Yes, we should rename &lt;tt&gt;addFiltersWithoutColumnPrefix&lt;/tt&gt; to &lt;tt&gt;addScans&lt;/tt&gt;, since the filter part is misleading and it seems we can always call that method as implemented.&lt;br/&gt;
2. Instead of calling &lt;tt&gt;addFiltersWithoutColumnPrefix&lt;/tt&gt; from &lt;tt&gt;setLocation&lt;/tt&gt; let&apos;s just remove the  addFamily/addColumn block from &lt;tt&gt;setLocation&lt;/tt&gt;. Then in &lt;tt&gt;initScan()&lt;/tt&gt; we can handle both scans and filters in one place with something like this (to replace the existing conditional):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;addScans(columnInfo_);

if (!columnPrefixExists) {
  addFiltersWithoutColumnPrefix(columnInfo_);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3. Would you please update the javadocs in &lt;tt&gt;addFiltersWithoutColumnPrefix&lt;/tt&gt; (or &lt;tt&gt;addScan&lt;/tt&gt;) to describe the new logic as best you can. This section of the filter/scan code has been particularly nasty in the past so we should be as clear as possible about what&apos;s happening here.&lt;/p&gt;
</comment>
                            <comment id="13545737" author="christoph.bauer" created="Mon, 7 Jan 2013 09:56:58 +0000"  >&lt;p&gt;I will generate a new patch.&lt;/p&gt;

&lt;p&gt;The reason addFamily/addColumn is in &lt;tt&gt;setLocation&lt;/tt&gt; is that &lt;tt&gt;pushProjection&lt;/tt&gt; might have been called leading to a reduced number of columns actually needed in the scan.&lt;/p&gt;

&lt;p&gt;I looked around but haven&apos;t found a better place for the scanColumns code.&lt;/p&gt;</comment>
                            <comment id="13545741" author="christoph.bauer" created="Mon, 7 Jan 2013 10:03:53 +0000"  >&lt;p&gt;Come to think of it.&lt;/p&gt;

&lt;p&gt;column filter initialization should also be postponed if possible.&lt;br/&gt;
I will/did adress that in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3067&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/PIG-3067&lt;/a&gt; if you agree.&lt;/p&gt;</comment>
                            <comment id="13545801" author="christoph.bauer" created="Mon, 7 Jan 2013 11:22:10 +0000"  >&lt;p&gt;1. Renamed addFilterWithoutColumnPrefix to addColumnsToScan&lt;br/&gt;
2. Removed addColumnsToScan from setLocation, because pushProjection is not working as expected anyway.&lt;br/&gt;
3. add/changed javadoc&lt;br/&gt;
4. replaced if/else logic in initScan&lt;/p&gt;</comment>
                            <comment id="13552090" author="billgraham" created="Sat, 12 Jan 2013 22:58:33 +0000"  >&lt;p&gt;Thanks Cristoph this patch looks good. I&apos;m on vaca for a few days but after that I will test this before committing.&lt;/p&gt;

&lt;p&gt;Let&apos;s limit &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3067&quot; title=&quot;HBaseStorage should be split up to become more manageable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3067&quot;&gt;PIG-3067&lt;/a&gt; to only refactoring the code without any new features, improvements or bug fixes.   &lt;/p&gt;</comment>
                            <comment id="13785792" author="qwertymaniac" created="Fri, 4 Oct 2013 02:22:26 +0100"  >&lt;p&gt;Moved from Release Notes to comments:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Tested and committed. Thanks for the patch Christoph and sorry for the delay!&lt;/p&gt;&lt;/blockquote&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12563553" name="PIG-3108.patch" size="6825" author="christoph.bauer" created="Mon, 7 Jan 2013 11:19:54 +0000"/>
                            <attachment id="12562580" name="PIG-3108.patch" size="5744" author="christoph.bauer" created="Fri, 28 Dec 2012 13:19:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Jan 2013 20:02:02 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>301956</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz0s9b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>248586</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>