<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:56:00 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1821/PIG-1821.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1821] UDFContext.getUDFProperties does not handle collisions in hashcode of udf classname (+ arg hashcodes)</title>
                <link>https://issues.apache.org/jira/browse/PIG-1821</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;In code below, if generateKey() returns same value for two udfs, the udfs would end up sharing the properties object. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, Properties&amp;gt; udfConfs = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, Properties&amp;gt;();

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Properties getUDFProperties(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; c) {
        &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; k = generateKey(c);
        Properties p = udfConfs.get(k);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (p == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            p = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Properties();
            udfConfs.put(k, p);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; p;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; generateKey(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; c) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; c.getName().hashCode();
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Properties getUDFProperties(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; c, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; k = generateKey(c, args);
        Properties p = udfConfs.get(k);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (p == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            p = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Properties();
            udfConfs.put(k, p);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; p;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; generateKey(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; c, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; hc = c.getName().hashCode();
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; args.length; i++) {
            hc &amp;lt;&amp;lt;= 1;
            hc ^= args[i].hashCode();
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; hc;
    }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;To prevent this, a new class (say X) that can hold the classname and args should be created, and instead of HashMap&amp;lt;Integer, Properties&amp;gt;,  HashMap&amp;lt;X, Properties&amp;gt; should be used. Then HahsMap will deal with the collisions. &lt;/p&gt;

</description>
                <environment></environment>
        <key id="12496721">PIG-1821</key>
            <summary>UDFContext.getUDFProperties does not handle collisions in hashcode of udf classname (+ arg hashcodes)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thejas">Thejas M Nair</assignee>
                                    <reporter username="thejas">Thejas M Nair</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Jan 2011 20:32:30 +0000</created>
                <updated>Thu, 4 Aug 2011 01:34:35 +0100</updated>
                            <resolved>Sun, 8 May 2011 18:36:53 +0100</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12986682" author="sms" created="Tue, 25 Jan 2011 21:01:16 +0000"  >&lt;p&gt;Since Pig does not allow function name overloading, can we use fully qualified class names as the key, i..e., HashMap &amp;lt;String, Properties&amp;gt; ?&lt;/p&gt;</comment>
                            <comment id="12986705" author="thejas" created="Tue, 25 Jan 2011 21:51:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;Since Pig does not allow function name overloading, can we use fully qualified class names as the key, i..e., HashMap &amp;lt;String, Properties&amp;gt; ? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, but getUDFProperties(Class c, String[] args) also needs to be supported. So List&amp;lt;String&amp;gt; is more appropriate. &lt;/p&gt;</comment>
                            <comment id="12986707" author="thejas" created="Tue, 25 Jan 2011 21:53:17 +0000"  >&lt;p&gt;I meant to say that List&amp;lt;String&amp;gt; can be used as key, ie  HashMap &amp;lt;List&amp;lt;String&amp;gt;, Properties&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13027676" author="thejas" created="Mon, 2 May 2011 15:39:30 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1821&quot; title=&quot;UDFContext.getUDFProperties does not handle collisions in hashcode of udf classname (+ arg hashcodes)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1821&quot;&gt;&lt;del&gt;PIG-1821&lt;/del&gt;&lt;/a&gt;.1.patch - unit tests passed (except TestStoreInstances, which is failing in trunk). test-patch failed because of no new unit tests. There are no new unit tests because it is not easy to create a test case to produce the problem this could have caused.&lt;/p&gt;</comment>
                            <comment id="13028428" author="thejas" created="Tue, 3 May 2011 22:10:28 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1821&quot; title=&quot;UDFContext.getUDFProperties does not handle collisions in hashcode of udf classname (+ arg hashcodes)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1821&quot;&gt;&lt;del&gt;PIG-1821&lt;/del&gt;&lt;/a&gt;.2.patch - Changes to incorporate comments from Richard. Passes unit tests and test-patch.&lt;/p&gt;</comment>
                            <comment id="13028438" author="rding" created="Tue, 3 May 2011 22:27:11 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13029406" author="thejas" created="Thu, 5 May 2011 17:12:15 +0100"  >&lt;p&gt;Patch committed to 0.9 branch and trunk.&lt;/p&gt;</comment>
                            <comment id="13030188" author="woody.anderson@gmail.com" created="Sat, 7 May 2011 00:14:08 +0100"  >&lt;p&gt;this checkin has caused a classloader failure when using my loader UDF.&lt;/p&gt;

&lt;p&gt;i&apos;ve narrowed it the the checking that references this bug:&lt;/p&gt;

&lt;p&gt;r1099860 | thejas | 2011-05-05 09:10:26 -0700 (Thu, 05 May 2011) | 3 lines&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1821&quot; title=&quot;UDFContext.getUDFProperties does not handle collisions in hashcode of udf classname (+ arg hashcodes)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1821&quot;&gt;&lt;del&gt;PIG-1821&lt;/del&gt;&lt;/a&gt;: UDFContext.getUDFProperties does not handle collisions&lt;br/&gt;
  in hashcode of udf classname (+ arg hashcodes) (thejas)&lt;/p&gt;

&lt;p&gt;I rebuilt my loader against the new pig jar, still fails.&lt;/p&gt;

&lt;p&gt;here&apos;s the output of my code (it works if i run using pig built with the previous revision):&lt;br/&gt;
Backend error message during job submission&lt;br/&gt;
-------------------------------------------&lt;br/&gt;
java.io.IOException: Deserialization error: com.yahoo.ymail.pigfunctions.AsStorage&lt;br/&gt;
        at org.apache.pig.impl.util.ObjectSerializer.deserialize(ObjectSerializer.java:55)&lt;br/&gt;
        at org.apache.pig.impl.util.UDFContext.deserialize(UDFContext.java:183)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.util.MapRedUtil.setupUDFContext(MapRedUtil.java:155)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigOutputFormat.setupUdfEnvAndStores(PigOutputFormat.java:228)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigOutputFormat.checkOutputSpecs(PigOutputFormat.java:185)&lt;br/&gt;
        at org.apache.hadoop.mapred.JobClient.submitJobInternal(JobClient.java:770)&lt;br/&gt;
        at org.apache.hadoop.mapred.JobClient.submitJob(JobClient.java:730)&lt;br/&gt;
        at org.apache.hadoop.mapred.jobcontrol.Job.submit(Job.java:378)&lt;br/&gt;
        at org.apache.hadoop.mapred.jobcontrol.JobControl.startReadyJobs(JobControl.java:247)&lt;br/&gt;
        at org.apache.hadoop.mapred.jobcontrol.JobControl.run(JobControl.java:279)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:680)&lt;br/&gt;
Caused by: java.lang.ClassNotFoundException: com.yahoo.ymail.pigfunctions.AsStorage&lt;br/&gt;
        at java.net.URLClassLoader$1.run(URLClassLoader.java:202)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
        at java.net.URLClassLoader.findClass(URLClassLoader.java:190)&lt;br/&gt;
        at java.lang.ClassLoader.loadClass(ClassLoader.java:307)&lt;br/&gt;
        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:301)&lt;br/&gt;
        at java.lang.ClassLoader.loadClass(ClassLoader.java:248)&lt;br/&gt;
        at java.lang.Class.forName0(Native Method)&lt;br/&gt;
        at java.lang.Class.forName(Class.java:247)&lt;br/&gt;
        at java.io.ObjectInputStream.resolveClass(ObjectInputStream.java:603)&lt;br/&gt;
        at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1574)&lt;br/&gt;
        at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1495)&lt;br/&gt;
        at java.io.ObjectInputStream.readClass(ObjectInputStream.java:1461)&lt;br/&gt;
        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1311)&lt;br/&gt;
        at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1946)&lt;br/&gt;
        at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1870)&lt;br/&gt;
        at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1752)&lt;br/&gt;
        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1328)&lt;br/&gt;
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:350)&lt;br/&gt;
        at java.util.HashMap.readObject(HashMap.java:1029)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
        at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:974)&lt;br/&gt;
        at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1848)&lt;br/&gt;
        at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1752)&lt;br/&gt;
        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1328)&lt;br/&gt;
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:350)&lt;br/&gt;
        at org.apache.pig.impl.util.ObjectSerializer.deserialize(ObjectSerializer.java:53)&lt;br/&gt;
        ... 10 more&lt;/p&gt;</comment>
                            <comment id="13030190" author="thejas" created="Sat, 7 May 2011 00:25:34 +0100"  >&lt;p&gt;Reopening to address the issue Woody reported.&lt;/p&gt;</comment>
                            <comment id="13030240" author="thejas" created="Sat, 7 May 2011 01:30:36 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1821&quot; title=&quot;UDFContext.getUDFProperties does not handle collisions in hashcode of udf classname (+ arg hashcodes)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1821&quot;&gt;&lt;del&gt;PIG-1821&lt;/del&gt;&lt;/a&gt;.3.patch - fixes problem reported by Woody. Replaced Class in UDFContext key with class name (String).&lt;/p&gt;</comment>
                            <comment id="13030243" author="daijy" created="Sat, 7 May 2011 02:12:48 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13030513" author="thejas" created="Sun, 8 May 2011 18:36:53 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1821&quot; title=&quot;UDFContext.getUDFProperties does not handle collisions in hashcode of udf classname (+ arg hashcodes)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1821&quot;&gt;&lt;del&gt;PIG-1821&lt;/del&gt;&lt;/a&gt;.3.patch - tests passed, patch committed to trunk and 0.9 branch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12477958" name="PIG-1821.1.patch" size="5704" author="thejas" created="Mon, 2 May 2011 15:36:35 +0100"/>
                            <attachment id="12478095" name="PIG-1821.2.patch" size="5157" author="thejas" created="Tue, 3 May 2011 22:10:28 +0100"/>
                            <attachment id="12478484" name="PIG-1821.3.patch" size="2175" author="thejas" created="Sat, 7 May 2011 01:30:36 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 25 Jan 2011 21:01:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66338</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyatxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97161</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>