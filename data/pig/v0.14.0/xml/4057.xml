<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:02:42 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-4057/PIG-4057.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-4057] Group All followed by CROSS with default parallelism produces wrong results</title>
                <link>https://issues.apache.org/jira/browse/PIG-4057</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;SET default_parallel 199;&lt;br/&gt;
......&lt;br/&gt;
by_size = ...&lt;br/&gt;
uniq_vals = .....&lt;br/&gt;
grpd = group uniq_vals all;&lt;br/&gt;
all_vals = FOREACH grpd GENERATE uniq_vals;&lt;br/&gt;
cross_result = CROSS by_size, all_vals;&lt;br/&gt;
store cross_result into &apos;/tmp/roh/cross/out/recipient_asns&apos;;&lt;/p&gt;

&lt;p&gt;Job1: grpd, all_vals, cross_result (The plan does GFCross function here for&lt;br/&gt;
all_vals assuming cross parallelism to be 1 taking that of the current job even&lt;br/&gt;
though it should consider default parallelism 199 of Job 2. Parallelism of Job1&lt;br/&gt;
is 1 because of group all)&lt;br/&gt;
Job2: cross_result (Actual CROSS of by_size and all_vals)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12727135">PIG-4057</key>
            <summary>Group All followed by CROSS with default parallelism produces wrong results</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="rohini">Rohini Palaniswamy</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Jul 2014 18:52:23 +0100</created>
                <updated>Fri, 21 Nov 2014 05:59:23 +0000</updated>
                            <resolved>Mon, 28 Jul 2014 03:54:59 +0100</resolved>
                                                    <fixVersion>0.14.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="14060953" author="rohini" created="Mon, 14 Jul 2014 19:06:29 +0100"  >&lt;p&gt;There are more issues to address. &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Cross would have problems even if group by was not group all and specified a different parallelism than cross.&lt;/li&gt;
	&lt;li&gt;Another case would be if there was no default parallel specified and different reducers were estimated for Job1 and Job2.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Since GFCross explicitly uses mapred.reduce.tasks need to also see how it is working in Tez.&lt;/p&gt;</comment>
                            <comment id="14061036" author="rohini" created="Mon, 14 Jul 2014 20:03:05 +0100"  >&lt;p&gt;One way to fix this would be to always have GFCross UDF as part of map task of the actual cross job and never do it as part of previous job&apos;s map or reduce. Trying to see if there is a better alternative for GFCross implementation that could do away with relying on parallelism of the reducer as it will cause problems with Tez auto parallelism. &lt;/p&gt;</comment>
                            <comment id="14064199" author="daijy" created="Wed, 16 Jul 2014 23:05:38 +0100"  >&lt;p&gt;The problem is GFCross divide to difference number of cross groups. If the number of groups are the same, then result is correct, whether it is equal to number of reducers does not matter.&lt;/p&gt;

&lt;p&gt;However, when number of cross groups correlates to the number of reducers, the performance is the best, in that:&lt;br/&gt;
1. If there are too much groups, every record will be duplicated many times, there are more intermediate results generated&lt;br/&gt;
2. If there are too few groups, some reducers takes no groups to process, cause imbalance load&lt;/p&gt;

&lt;p&gt;I can fix it by forcing all GFCross use the same cross groups at the frontend. If tez auto-parallelism is used, we may end up with non-optimal cross groups. Auto-parallelism works by over estimate the number of reduce in the frontend, so we might end up having more cross groups, which means larger intermediate results. But I don&apos;t see an easy way to peek the number of reduce at the runtime and pass to GFCross.&lt;/p&gt;</comment>
                            <comment id="14069794" author="daijy" created="Tue, 22 Jul 2014 05:25:13 +0100"  >&lt;p&gt;RB link: &lt;a href=&quot;https://reviews.apache.org/r/23787/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/23787/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14073887" author="daijy" created="Fri, 25 Jul 2014 01:19:02 +0100"  >&lt;p&gt;Address &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;&apos;s review comments.&lt;/p&gt;</comment>
                            <comment id="14074133" author="cheolsoo" created="Fri, 25 Jul 2014 07:28:17 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14075133" author="daijy" created="Sat, 26 Jul 2014 00:34:12 +0100"  >&lt;p&gt;Another patch addressing Rohini&apos;s review comments.&lt;/p&gt;</comment>
                            <comment id="14075243" author="rohini" created="Sat, 26 Jul 2014 04:27:02 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14075867" author="daijy" created="Mon, 28 Jul 2014 03:51:26 +0100"  >&lt;p&gt;Fix unit test failures and resync with trunk.&lt;/p&gt;</comment>
                            <comment id="14075868" author="daijy" created="Mon, 28 Jul 2014 03:54:59 +0100"  >&lt;p&gt;Patch committed to trunk. Thanks Cheolsoo and Rohini for review!&lt;/p&gt;</comment>
                            <comment id="14075869" author="rohini" created="Mon, 28 Jul 2014 03:55:54 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14076908" author="daijy" created="Mon, 28 Jul 2014 22:24:15 +0100"  >&lt;p&gt;TestPigContext still fail in tez. Attach &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4057&quot; title=&quot;Group All followed by CROSS with default parallelism produces wrong results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4057&quot;&gt;&lt;del&gt;PIG-4057&lt;/del&gt;&lt;/a&gt;-7.patch to fix it.&lt;/p&gt;</comment>
                            <comment id="14076910" author="daijy" created="Mon, 28 Jul 2014 22:25:09 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4057&quot; title=&quot;Group All followed by CROSS with default parallelism produces wrong results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4057&quot;&gt;&lt;del&gt;PIG-4057&lt;/del&gt;&lt;/a&gt;-7.patch committed to trunk.&lt;/p&gt;</comment>
                            <comment id="14077442" author="daijy" created="Tue, 29 Jul 2014 07:45:44 +0100"  >&lt;p&gt;Another unit test failure caused by the patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4057&quot; title=&quot;Group All followed by CROSS with default parallelism produces wrong results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4057&quot;&gt;&lt;del&gt;PIG-4057&lt;/del&gt;&lt;/a&gt;-8.patch).&lt;/p&gt;</comment>
                            <comment id="14077840" author="rohini" created="Tue, 29 Jul 2014 16:39:04 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12657053" name="PIG-4057-1.patch" size="43462" author="daijy" created="Tue, 22 Jul 2014 05:15:47 +0100"/>
                            <attachment id="12657504" name="PIG-4057-2.patch" size="45710" author="daijy" created="Thu, 24 Jul 2014 01:45:08 +0100"/>
                            <attachment id="12657731" name="PIG-4057-3.patch" size="45846" author="daijy" created="Fri, 25 Jul 2014 01:19:02 +0100"/>
                            <attachment id="12657747" name="PIG-4057-4.patch" size="45706" author="daijy" created="Fri, 25 Jul 2014 02:35:22 +0100"/>
                            <attachment id="12657944" name="PIG-4057-5.patch" size="46633" author="daijy" created="Sat, 26 Jul 2014 00:34:12 +0100"/>
                            <attachment id="12658062" name="PIG-4057-6.patch" size="48658" author="daijy" created="Mon, 28 Jul 2014 03:51:26 +0100"/>
                            <attachment id="12658255" name="PIG-4057-7.patch" size="854" author="daijy" created="Mon, 28 Jul 2014 22:24:15 +0100"/>
                            <attachment id="12658368" name="PIG-4057-8.patch" size="1338" author="daijy" created="Tue, 29 Jul 2014 07:45:44 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 16 Jul 2014 22:05:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>405242</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzrli7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>405271</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>