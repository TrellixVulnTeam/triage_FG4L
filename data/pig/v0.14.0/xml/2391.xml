<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:57:38 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2391/PIG-2391.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2391] Bzip_2 test is broken</title>
                <link>https://issues.apache.org/jira/browse/PIG-2391</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;This test is currently commented out but if you uncomment it it fails with Pig 10 but runs successfully with Pig 9.&lt;/p&gt;

&lt;p&gt;Script:&lt;/p&gt;

&lt;p&gt;a = load &apos;/homes/olgan/studenttab10k&apos; using PigStorage() as (name, age, gpa);&lt;br/&gt;
store a into &apos;intermediate.bz&apos;;&lt;br/&gt;
b = load &apos;intermediate.bz&apos;;&lt;br/&gt;
store b into &apos;final.bz&apos;;&lt;/p&gt;

&lt;p&gt;A couple of observations:&lt;/p&gt;

&lt;p&gt;(1) Identical script (represented by Bzip_1 test) that has bz2 instead of bz extension in the script succeeds in Pig 10&lt;br/&gt;
(2) The problem occurs while reading intermediate.bz which has different size with Pig 9 and Pig 10&lt;br/&gt;
(3) Problem can be reproduced in local mode with small subset of data in the file&lt;br/&gt;
(4) The following stack trace is observed:&lt;/p&gt;

&lt;p&gt;2011-12-01 13:53:12,280 &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-22&amp;#93;&lt;/span&gt; WARN  org.apache.hadoop.mapred.LocalJobRunner - job_local_0002&lt;br/&gt;
java.lang.RuntimeException: java.io.IOException: compressedStream EOF&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigRecordReader.initNextRecordReader(PigRecordReader.java:237)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigRecordReader.&amp;lt;init&amp;gt;(PigRecordReader.java:109)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigInputFormat.createRecordReader(PigInputFormat.java:119)&lt;br/&gt;
        at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:588)&lt;br/&gt;
        at org.apache.hadoop.mapred.MapTask.run(MapTask.java:305)&lt;br/&gt;
        at org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:177)&lt;br/&gt;
Caused by: java.io.IOException: compressedStream EOF&lt;br/&gt;
        at org.apache.tools.bzip2r.CBZip2InputStream.cadvise(CBZip2InputStream.java:92)&lt;br/&gt;
        at org.apache.tools.bzip2r.CBZip2InputStream.compressedStreamEOF(CBZip2InputStream.java:96)&lt;br/&gt;
        at org.apache.tools.bzip2r.CBZip2InputStream.bsR(CBZip2InputStream.java:451)&lt;br/&gt;
        at org.apache.tools.bzip2r.CBZip2InputStream.initBlock(CBZip2InputStream.java:348)&lt;br/&gt;
        at org.apache.tools.bzip2r.CBZip2InputStream.&amp;lt;init&amp;gt;(CBZip2InputStream.java:220)&lt;br/&gt;
        at org.apache.pig.bzip2r.Bzip2TextInputFormat$BZip2LineRecordReader.&amp;lt;init&amp;gt;(Bzip2TextInputFormat.java:105)&lt;br/&gt;
        at org.apache.pig.bzip2r.Bzip2TextInputFormat.createRecordReader(Bzip2TextInputFormat.java:244)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigRecordReader.initNextRecordReader(PigRecordReader.java:227)&lt;br/&gt;
        ... 5 more&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12533518">PIG-2391</key>
            <summary>Bzip_2 test is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xutingz">xuting zhao</assignee>
                                    <reporter username="olgan">Olga Natkovich</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Dec 2011 21:53:33 +0000</created>
                <updated>Thu, 26 Apr 2012 21:32:55 +0100</updated>
                            <resolved>Thu, 8 Dec 2011 22:05:55 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                    <fixVersion>0.11</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13163889" author="xutingz" created="Tue, 6 Dec 2011 21:48:41 +0000"  >&lt;p&gt;This problem is caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2143&quot; title=&quot;Make PigStorage optionally store schema; improve docs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2143&quot;&gt;&lt;del&gt;PIG-2143&lt;/del&gt;&lt;/a&gt; where the setCompression function is added and codecFactory.getCodec(path) is called to determine whether there is a corresponding CompressionCodec class for the compression file. codecFactory.getCodec() will return null for .bz file while return BZip2Codec for .bz2 file. In 0.9, the suffix of the file path is used to determine this. &lt;/p&gt;

&lt;p&gt;In this patch, I modified the setCompression function to treat .bz file as .bz2 file and added new unit test for this case. ant test-commit has been run successfully on .10 branch and trunk.&lt;/p&gt;</comment>
                            <comment id="13163897" author="olgan" created="Tue, 6 Dec 2011 22:04:33 +0000"  >&lt;p&gt;Hi Xuting,&lt;/p&gt;

&lt;p&gt;Could you explain what is causing this regression? It is not obvious to me what the fix is doing. Also, what would happen if another store function like BinStorage is used?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13163899" author="olgan" created="Tue, 6 Dec 2011 22:07:35 +0000"  >&lt;p&gt;Looks like our comments crossed. So the issue is that Hadoop does not understand .bz extension and you need to fake it by saying it is actually bz2.&lt;/p&gt;</comment>
                            <comment id="13163901" author="olgan" created="Tue, 6 Dec 2011 22:09:23 +0000"  >&lt;p&gt;It would be good to have this as comment in your patch. It is a bit of a hack but I don&apos;t see a better way to do this. Please, update the patch with better comment and I will commit it once tests pass&lt;/p&gt;</comment>
                            <comment id="13164049" author="xutingz" created="Wed, 7 Dec 2011 01:43:54 +0000"  >&lt;p&gt;I added extra comments in the &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2391&quot; title=&quot;Bzip_2 test is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2391&quot;&gt;&lt;del&gt;PIG-2391&lt;/del&gt;&lt;/a&gt;-1.patch to explain the modifications.&lt;br/&gt;
Xuting&lt;/p&gt;</comment>
                            <comment id="13164054" author="daijy" created="Wed, 7 Dec 2011 01:50:49 +0000"  >&lt;p&gt;Thanks Xuting. Do you have idea why this pass in 0.9?&lt;/p&gt;</comment>
                            <comment id="13164060" author="olgan" created="Wed, 7 Dec 2011 01:54:10 +0000"  >&lt;p&gt;I assume it is because we merged PigStorage and PigStorageSchema in 10&lt;/p&gt;</comment>
                            <comment id="13164180" author="xutingz" created="Wed, 7 Dec 2011 06:23:26 +0000"  >&lt;p&gt;Hi Daniel, I think that is because the patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2143&quot; title=&quot;Make PigStorage optionally store schema; improve docs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2143&quot;&gt;&lt;del&gt;PIG-2143&lt;/del&gt;&lt;/a&gt; only applied on 0.10 and later branches.&lt;br/&gt;
In 0.9, instead of calling the codecFactory.getCodec function which can cause this problem, it directly checks the suffix of the path to determine what kind of compressionCodec class should be applied.&lt;/p&gt;

&lt;p&gt;To be specific, In 0.9, the code is like the following:&lt;/p&gt;

&lt;p&gt;      if (location.endsWith(&quot;.bz2&quot;) || location.endsWith(&quot;.bz&quot;)) &lt;/p&gt;
{
                FileOutputFormat.setCompressOutput(job, true);
                FileOutputFormat.setOutputCompressorClass(job,  BZip2Codec.class);
            }
&lt;p&gt;  else if (location.endsWith(&quot;.gz&quot;)) &lt;/p&gt;
{
                FileOutputFormat.setCompressOutput(job, true);
                FileOutputFormat.setOutputCompressorClass(job, GzipCodec.class);
            }
&lt;p&gt; else &lt;/p&gt;
{
                FileOutputFormat.setCompressOutput( job, false);
            }

&lt;p&gt;In .10, the code is like:&lt;br/&gt;
       CompressionCodec codec = codecFactory.getCodec(location);&lt;br/&gt;
        if (codec != null) &lt;/p&gt;
{
            FileOutputFormat.setCompressOutput(job, true);
            FileOutputFormat.setOutputCompressorClass(job, codec.getClass());
        }
&lt;p&gt;else &lt;/p&gt;
{
            FileOutputFormat.setCompressOutput(job, false);  
        }</comment>
                            <comment id="13164236" author="daijy" created="Wed, 7 Dec 2011 08:21:50 +0000"  >&lt;p&gt;It seems in Pig 0.10, we mistakenly drop some code of 0.9. Will it work if we just bring back the 0.9 code?&lt;/p&gt;

&lt;p&gt;Here is the code we removed in 0.10:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (location.endsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;.bz2&quot;&lt;/span&gt;) || location.endsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;.bz&quot;&lt;/span&gt;)) {
    FileOutputFormat.setCompressOutput(job, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
    FileOutputFormat.setOutputCompressorClass(job,  BZip2Codec.class);
}  &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (location.endsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;.gz&quot;&lt;/span&gt;)) {
    FileOutputFormat.setCompressOutput(job, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
    FileOutputFormat.setOutputCompressorClass(job, GzipCodec.class);
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    FileOutputFormat.setCompressOutput( job, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13164648" author="xutingz" created="Wed, 7 Dec 2011 19:38:37 +0000"  >&lt;p&gt;I bring the removed code into 0.10 and it passes the commit test and my new unit test. the &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2391&quot; title=&quot;Bzip_2 test is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2391&quot;&gt;&lt;del&gt;PIG-2391&lt;/del&gt;&lt;/a&gt;-2.patch is the new patch on that.&lt;/p&gt;</comment>
                            <comment id="13164661" author="daijy" created="Wed, 7 Dec 2011 20:04:53 +0000"  >&lt;p&gt;Thanks Xuting! I will commit patch once tests pass.&lt;/p&gt;</comment>
                            <comment id="13165618" author="daijy" created="Thu, 8 Dec 2011 22:05:55 +0000"  >&lt;p&gt;Unit tests pass. test-patch:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; -1 overall.  &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 @author.  The patch does not contain any @author tags.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 tests included.  The patch appears to include 3 new or modified tests.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     -1 release audit.  The applied patch generated 465 release audit warnings (more than the trunk&apos;s current 458 warnings).&lt;/p&gt;

&lt;p&gt;No new file added, so ignore release audit warning.&lt;/p&gt;

&lt;p&gt;Patch committed to trunk/0.10. Thanks Xuting!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12506371" name="PIG-2391-1.patch" size="3572" author="xutingz" created="Wed, 7 Dec 2011 01:42:33 +0000"/>
                            <attachment id="12506500" name="PIG-2391-2.patch" size="4051" author="xutingz" created="Wed, 7 Dec 2011 19:37:27 +0000"/>
                            <attachment id="12506310" name="PIG-2391.patch" size="3303" author="xutingz" created="Tue, 6 Dec 2011 21:36:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 6 Dec 2011 21:48:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>219246</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyawzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97657</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>