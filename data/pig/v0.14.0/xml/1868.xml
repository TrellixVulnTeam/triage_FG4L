<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:03:06 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1868/PIG-1868.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1868] New logical plan fails when I have complex data types from udf</title>
                <link>https://issues.apache.org/jira/browse/PIG-1868</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The new logical plan fails when I have complex data types returning from my eval function.&lt;/p&gt;

&lt;p&gt;The below is my script :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
register myudf.jar;   
B1 = load &apos;myinput&apos; as (id:chararray,ts:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,url:chararray);
B2 = group B1 by id;
B = foreach B2 {
 Tuples = order B1 by ts;
 generate Tuples;
};
C1 = foreach B generate TransformToMyDataType(Tuples,-1,0,1) as seq: { t: ( previous, current, next ) };
C2 = foreach C1 generate FLATTEN(seq);
C3 = foreach C2 generate  current.id as id;
dump C3;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On C3 it fails with below message :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Couldn&apos;t find matching uid -1 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; project (Name: Project Type: bytearray Uid: 45 Input: 0 Column: 1)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The below is the describe on C1 ;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
C1: {seq: {t: (previous: (id: chararray,ts: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,url: chararray),current: (id: chararray,ts: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,url: chararray),next: (id: chararray,ts: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,url: chararray))}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The script works if I turn off new logical plan or use Pig 0.7.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12499556">PIG-1868</key>
            <summary>New logical plan fails when I have complex data types from udf</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="vivekp">Vivek Padmanabhan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Feb 2011 06:42:05 +0000</created>
                <updated>Thu, 2 May 2013 03:29:37 +0100</updated>
                            <resolved>Sun, 27 Mar 2011 06:57:44 +0100</resolved>
                                    <version>0.9.0</version>
                                    <fixVersion>0.9.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13006760" author="daijy" created="Tue, 15 Mar 2011 01:39:43 +0000"  >&lt;p&gt;Get actually implmenentation of TransformToMyDataType from the user. The problem is TransformToMyDataType forget to set twolevelaccess flag for the bag. Pig 0.9 does not require twolevelaccess flag. However, we saw Pig 0.9 fail with a different stack:&lt;/p&gt;

&lt;p&gt;ERROR 1000: Invalid field reference. Referenced field &lt;span class=&quot;error&quot;&gt;&amp;#91;guid&amp;#93;&lt;/span&gt; does not exist in schema: null.&lt;/p&gt;

&lt;p&gt;org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1067: Unable to explain alias C3&lt;br/&gt;
at org.apache.pig.PigServer.explain(PigServer.java:993)&lt;br/&gt;
at org.apache.pig.tools.grunt.GruntParser.explainCurrentBatch(GruntParser.java:368)&lt;br/&gt;
at org.apache.pig.tools.grunt.GruntParser.processExplain(GruntParser.java:300)&lt;br/&gt;
at org.apache.pig.tools.grunt.GruntParser.processExplain(GruntParser.java:263)&lt;br/&gt;
at org.apache.pig.tools.pigscript.parser.PigScriptParser.Explain(PigScriptParser.java:665)&lt;br/&gt;
at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:325)&lt;br/&gt;
at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:176)&lt;br/&gt;
at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:152)&lt;br/&gt;
at org.apache.pig.tools.grunt.Grunt.exec(Grunt.java:90)&lt;br/&gt;
at org.apache.pig.Main.run(Main.java:537)&lt;br/&gt;
at org.apache.pig.Main.main(Main.java:108)&lt;br/&gt;
Caused by: org.apache.pig.impl.plan.PlanValidationException: ERROR 1000: Invalid field reference. Referenced field &lt;span class=&quot;error&quot;&gt;&amp;#91;guid&amp;#93;&lt;/span&gt; does not exist in schema: null.&lt;br/&gt;
at org.apache.pig.newplan.logical.visitor.ColumnAliasConversionVisitor$1.visit(ColumnAliasConversionVisitor.java:114)&lt;br/&gt;
at org.apache.pig.newplan.logical.expression.DereferenceExpression.accept(DereferenceExpression.java:83)&lt;br/&gt;
at org.apache.pig.newplan.DependencyOrderWalker.walk(DependencyOrderWalker.java:75)&lt;br/&gt;
at org.apache.pig.newplan.PlanVisitor.visit(PlanVisitor.java:50)&lt;br/&gt;
at org.apache.pig.newplan.logical.optimizer.AllExpressionVisitor.visit(AllExpressionVisitor.java:114)&lt;br/&gt;
at org.apache.pig.newplan.logical.relational.LOGenerate.accept(LOGenerate.java:240)&lt;br/&gt;
at org.apache.pig.newplan.DependencyOrderWalker.walk(DependencyOrderWalker.java:75)&lt;br/&gt;
at org.apache.pig.newplan.logical.optimizer.AllExpressionVisitor.visit(AllExpressionVisitor.java:104)&lt;br/&gt;
at org.apache.pig.newplan.logical.relational.LOForEach.accept(LOForEach.java:73)&lt;br/&gt;
at org.apache.pig.newplan.DependencyOrderWalker.walk(DependencyOrderWalker.java:75)&lt;br/&gt;
at org.apache.pig.newplan.PlanVisitor.visit(PlanVisitor.java:50)&lt;br/&gt;
at org.apache.pig.PigServer$Graph.compile(PigServer.java:1538)&lt;br/&gt;
at org.apache.pig.PigServer$Graph.compile(PigServer.java:1533)&lt;br/&gt;
at org.apache.pig.PigServer$Graph.access$200(PigServer.java:1295)&lt;br/&gt;
at org.apache.pig.PigServer.buildStorePlan(PigServer.java:1195)&lt;br/&gt;
at org.apache.pig.PigServer.explain(PigServer.java:956)&lt;/p&gt;</comment>
                            <comment id="13007663" author="daijy" created="Wed, 16 Mar 2011 19:55:06 +0000"  >&lt;p&gt;The reason for the failure on trunk is because in this query, TransformToMyDataType returns more specific error message than user declared schema &quot;seq: &lt;/p&gt;
{ t: ( previous, current, next ) }
&lt;p&gt;&quot;, and now we only take user declared schema. This is a regression, I will attach a patch to fix it.&lt;/p&gt;</comment>
                            <comment id="13011387" author="thejas" created="Fri, 25 Mar 2011 19:39:20 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13011740" author="daijy" created="Sun, 27 Mar 2011 06:57:44 +0100"  >&lt;p&gt;Review notes: &lt;a href=&quot;https://reviews.apache.org/r/526/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/526/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Patch committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12502002">PIG-1927</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12473844" name="PIG-1868-1.patch" size="1687" author="daijy" created="Wed, 16 Mar 2011 20:13:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 15 Mar 2011 01:39:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66343</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyau7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97206</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>