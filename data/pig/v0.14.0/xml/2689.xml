<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:48:18 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2689/PIG-2689.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2689] JsonStorage fails to find schema when LimitAdjuster runs</title>
                <link>https://issues.apache.org/jira/browse/PIG-2689</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Scripts that both save out data with JsonStorage and trigger the LimitAdjuster (e.g. doing an order by followed by a limit) yield the following Exception:&lt;/p&gt;

&lt;p&gt;java.io.IOException: Could not find schema in UDF context&lt;br/&gt;
        at org.apache.pig.builtin.JsonStorage.prepareToWrite(JsonStorage.java:125)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigOutputFormat$PigRecordWriter.&amp;lt;init&amp;gt;(PigOutputFormat.java:125)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigOutputFormat.getRecordWriter(PigOutputFormat.java:86)&lt;br/&gt;
        at org.apache.hadoop.mapred.ReduceTask$NewTrackingRecordWriter.&amp;lt;init&amp;gt;(ReduceTask.java:569)&lt;br/&gt;
        at org.apache.hadoop.mapred.ReduceTask.runNewReducer(ReduceTask.java:638)&lt;br/&gt;
        at org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:417)&lt;br/&gt;
        at org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:260)&lt;/p&gt;

&lt;p&gt;This happens b/c the LimitAdjuster does not copy the signature into it&apos;s newly created POStore, and hence JsonStorage looks for the schema for a null signature.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12554394">PIG-2689</key>
            <summary>JsonStorage fails to find schema when LimitAdjuster runs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ddaniels888">Doug Daniels</assignee>
                                    <reporter username="ddaniels888">Doug Daniels</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 May 2012 23:11:59 +0100</created>
                <updated>Fri, 21 Nov 2014 05:58:20 +0000</updated>
                            <resolved>Fri, 18 Jul 2014 00:06:15 +0100</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.14.0</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13270887" author="ddaniels888" created="Tue, 8 May 2012 23:13:17 +0100"  >&lt;p&gt;Attached a patch that fixes this by copying the signature to the new POStore.  It also copies the alias, which helps in illustrate.&lt;/p&gt;</comment>
                            <comment id="13270895" author="azaroth" created="Tue, 8 May 2012 23:26:29 +0100"  >&lt;p&gt;The modification looks OK, but I am not sure about the tests.&lt;br/&gt;
Should we test this as an e2e test?&lt;/p&gt;</comment>
                            <comment id="13470578" author="alangates" created="Fri, 5 Oct 2012 20:22:12 +0100"  >&lt;p&gt;This patch no longer applies because PhysicalOperator no longer has a setAlias method.  It&apos;s not clear to me why that was removed.  It also wasn&apos;t clear to me whether it was required for this patch (it looked like the setSignature was the one that mattered, but I wanted to confirm that before proceeding).&lt;/p&gt;

&lt;p&gt;As for the e2e tests for this, ideally I agree we should have one.  But we don&apos;t generate any json data in the tests yet, so it seems too much to ask to add a new data set and tests for it.&lt;/p&gt;

&lt;p&gt;I&apos;m going to set this JIRA to open since the patch as is doesn&apos;t apply.  But if you feel setAlias isn&apos;t required I&apos;m fine to apply the patch.&lt;/p&gt;</comment>
                            <comment id="14059971" author="rohini" created="Sun, 13 Jul 2014 02:12:59 +0100"  >&lt;p&gt;The issue is already fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3120&quot; title=&quot;setStoreFuncUDFContextSignature called with null signature&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3120&quot;&gt;&lt;del&gt;PIG-3120&lt;/del&gt;&lt;/a&gt;. But that does not have a unit test. So added a unit test as part of this patch and also set the alias on the new limit operator based on &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ddaniels888&quot; class=&quot;user-hover&quot; rel=&quot;ddaniels888&quot;&gt;Doug Daniels&lt;/a&gt; original patch. The unit test on the original patch does not apply cleanly anymore as having files for test is removed from TestJsonStorage and they are generated at run time.&lt;/p&gt;</comment>
                            <comment id="14065585" author="daijy" created="Thu, 17 Jul 2014 22:30:25 +0100"  >&lt;p&gt;+1 for &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2689&quot; title=&quot;JsonStorage fails to find schema when LimitAdjuster runs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2689&quot;&gt;&lt;del&gt;PIG-2689&lt;/del&gt;&lt;/a&gt;-2.patch.&lt;/p&gt;</comment>
                            <comment id="14065734" author="rohini" created="Fri, 18 Jul 2014 00:06:15 +0100"  >&lt;p&gt;Committed to trunk (0.14). Thanks Daniel for the review.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                                                <inwardlinks description="Is contained by">
                                        <issuelink>
            <issuekey id="12627467">PIG-3120</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12655428" name="PIG-2689-2-nowhitespacechange.patch" size="8055" author="rohini" created="Sun, 13 Jul 2014 02:12:59 +0100"/>
                            <attachment id="12655429" name="PIG-2689-2.patch" size="14333" author="rohini" created="Sun, 13 Jul 2014 02:12:59 +0100"/>
                            <attachment id="12526055" name="PIG-2689.patch" size="5734" author="ddaniels888" created="Tue, 8 May 2012 23:12:32 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 8 May 2012 22:26:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>238636</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxza3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29619</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>