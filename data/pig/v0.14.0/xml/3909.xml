<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:55:29 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3909/PIG-3909.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3909] Type Casting issue</title>
                <link>https://issues.apache.org/jira/browse/PIG-3909</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;  This issue is very close to &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1191&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/PIG-1191&lt;/a&gt;, which had been closed for version 0.6.0. Steps to reproduce the issue:&lt;/p&gt;

&lt;p&gt;  Pig script as below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;input7.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
A = load &apos;polisan/input7.txt&apos; as (bagofmap:{});
B = foreach A generate FLATTEN((IsEmpty(bagofmap) ? &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; : bagofmap)) AS bagofmap;
C = filter B by (chararray)bagofmap#&apos;fieldkey1&apos; matches &apos;po.*&apos;;
D = foreach C generate (chararray)bagofmap#&apos;fieldkey2&apos;;
dump D;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;  input data as below: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;polisan/input7.txt&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{([fieldkey1#polisan,fieldkey2#lily])}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;  run command &quot;pig -x local -f input7.pig&quot;.  Exception will be thrown out like below:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.pig.backend.executionengine.ExecException: ERROR 1075: Received a bytearray from the UDF. Cannot determine how to convert the bytearray to string.
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.POCast.getNext(POCast.java:935)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;  I tried to dig into the source code, and found there were something wrong with generation of Logical Plan(LP), &quot;new TypeCheckingRelVisitor( lp, collector).visit();&quot; particularly. For the pig script I pasted in the ticket, logical plan was like this,&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;#-----------------------------------------------
# New Logical Plan:
#-----------------------------------------------
D: (Name: LOStore Schema: #21:chararray)
|
|---D: (Name: LOForEach Schema: #21:chararray)
    |   |
    |   (Name: LOGenerate[false] Schema: #21:chararray)
    |   |   |
    |   |   (Name: Cast Type: chararray Uid: 21)
    |   |   |
    |   |   |---(Name: Map Type: bytearray Uid: 21 Key: fieldkey2)
    |   |       |
    |   |       |---(Name: Cast Type: map Uid: 16)
    |   |           |
    |   |           |---bagofmap:(Name: Project Type: bytearray Uid: 16 Input: 0 Column: (*))
    |   |
    |   |---(Name: LOInnerLoad[0] Schema: bagofmap#16:bytearray)
    |
    |---C: (Name: LOFilter Schema: bagofmap#16:bytearray)
        |   |
        |   (Name: Regex Type: boolean Uid: 20)
        |   |
        |   |---(Name: Cast Type: chararray Uid: 17)
        |   |   |
        |   |   |---(Name: Map Type: bytearray Uid: 17 Key: fieldkey1)
        |   |       |
        |   |       |---(Name: Cast Type: map Uid: 26)        &#8212;&#8212;&amp;gt; Uid was assigned to 26, while other  places were 16
        |   |           |
        |   |           |---bagofmap:(Name: Project Type: bytearray Uid: 16 Input: 0 Column: 0)
        |   |
        |   |---(Name: Constant Type: chararray Uid: 19)
        |
        |---B: (Name: LOForEach Schema: bagofmap#16:bytearray)
            |   |
            |   (Name: LOGenerate[true] Schema: bagofmap#16:bytearray)
            |   |   |
            |   |   (Name: BinCond Type: bag Uid: 16)
            |   |   |
            |   |   |---(Name: UserFunc(org.apache.pig.builtin.IsEmpty) Type: boolean Uid: 14)
            |   |   |   |
            |   |   |   |---bagofmap:(Name: Project Type: bag Uid: 12 Input: 0 Column: (*))
            |   |   |
            |   |   |---(Name: Cast Type: bag Uid: 15)
            |   |   |   |
            |   |   |   |---(Name: Constant Type: bytearray Uid: 15)
            |   |   |
            |   |   |---bagofmap:(Name: Project Type: bag Uid: 12 Input: 1 Column: (*))
            |   |
            |   |---bagofmap: (Name: LOInnerLoad[0] Schema: null)
            |   |
            |   |---bagofmap: (Name: LOInnerLoad[0] Schema: null)
            |
            |---A: (Name: LOLoad Schema: bagofmap#12:bag{#13:tuple()})RequiredFields:null
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;    I followed the code, and found at first all uid of bagofmap were all 16, then TypeCheckingRelVisitor.visit() was called, some cast were added, e.g., to cast bagofmap from bytearray to map, at the same time, uid were also recaculated. When alias C was processed, uid of bagofmap(bytearray type) was changed to 26, and bagofmap in inserted CastExpression was also assigned 26. While processing D, the foreach sentence, bagofmap in project expression was merged back into 16, while other bagofmap of bytearray were sharing the schema object, leaving the one of map type in filter-sentence 26. This leaded to, loadFunction for uid 26 was missing in uid2LoadFuncMap, then caster was assigned to null, and then the exception at last.&lt;/p&gt;

&lt;p&gt;  I tried serveral ways to make the code go well.&lt;br/&gt;
1) add implementation of function visit(CastException) for class LineageFindExpVisitor, to add &amp;lt;26, org.apache.pig.builtin.PigStorage()&amp;gt; to uid2LoadFuncMap, then caster will be assigned with right function. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void visit(CastExpression &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; FrontendException {
        updateUidMap(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;.getExpression());        
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2)  to hack code of function getFieldSchema() of class ProjectExpression, to make sure when uid of bagofmap were re-caculated, &quot;26&quot; would not be merged back to 16, then  &amp;lt;26, org.apache.pig.builtin.PigStorage()&amp;gt; was passed into uid2LoadFuncMap when lineageFinder.visit(); was called to generate the map.&lt;/p&gt;

&lt;p&gt;3) run the script in debug mode using Eclipse, and hack the result of mergeUid() to make all uid 26 be merged back to 16, then &amp;lt;16, org.apache.pig.builtin.PigStorage()&amp;gt; in uid2LoadFuncMap would be enough.&lt;/p&gt;

&lt;p&gt;  I&apos;m not sure which one should be ok, preferred, or none of them. But I believe LP generated was not correct, and there should be some bug on getFieldSchema() function of ProjectExpression class. Please confirm.&lt;/p&gt;

&lt;p&gt;  Besides, I wonder what uidOnlyFieldSchema, and fieldSchema mean, and their difference exactly for LogicalExpression, and then I could understand better implementation of getFieldSchema(), when cloneUid() should be called, and when mergeUid() should be called, and when getNextUid().&lt;/p&gt;

&lt;p&gt;  Thanks.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12709959">PIG-3909</key>
            <summary>Type Casting issue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="polisan">Hongchang Li</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Apr 2014 08:35:06 +0100</created>
                <updated>Mon, 7 Jul 2014 19:08:02 +0100</updated>
                            <resolved>Fri, 25 Apr 2014 21:39:41 +0100</resolved>
                                    <version>0.12.0</version>
                    <version>0.11.1</version>
                                    <fixVersion>0.13.0</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13980413" author="daijy" created="Thu, 24 Apr 2014 23:42:23 +0100"  >&lt;p&gt;In ProjectExpression we forget clone the fieldSchema. Attach the patch.&lt;/p&gt;</comment>
                            <comment id="13981306" author="rohini" created="Fri, 25 Apr 2014 18:46:03 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13981562" author="daijy" created="Fri, 25 Apr 2014 21:39:41 +0100"  >&lt;p&gt;Patch committed to trunk. Thanks Rohini for review!&lt;/p&gt;</comment>
                            <comment id="13982740" author="polisan" created="Mon, 28 Apr 2014 05:03:19 +0100"  >&lt;p&gt;hi, there,&lt;br/&gt;
  after patching, i got LP like this,&lt;br/&gt;
&amp;lt;noformat&amp;gt;&lt;br/&gt;
#-----------------------------------------------&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;New Logical Plan:&lt;br/&gt;
#-----------------------------------------------&lt;br/&gt;
D: (Name: LOStore Schema: #21:chararray)
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---D: (Name: LOForEach Schema: #21:chararray)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   (Name: LOGenerate&lt;span class=&quot;error&quot;&gt;&amp;#91;false&amp;#93;&lt;/span&gt; Schema: #21:chararray)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   (Name: Cast Type: chararray Uid: 21)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---(Name: Map Type: bytearray Uid: 21 Key: fieldkey2)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---(Name: Cast Type: map Uid: 16)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---bagofmap:(Name: Project Type: bytearray Uid: 16 Input: 0 Column: &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---(Name: LOInnerLoad&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; Schema: bagofmap#26:bytearray)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---C: (Name: LOFilter Schema: bagofmap#26:bytearray)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   (Name: Regex Type: boolean Uid: 20)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---(Name: Cast Type: chararray Uid: 17)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---(Name: Map Type: bytearray Uid: 17 Key: fieldkey1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---(Name: Cast Type: map Uid: 26)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---bagofmap:(Name: Project Type: bytearray Uid: 26 Input: 0 Column: 0)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---(Name: Constant Type: chararray Uid: 19)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---B: (Name: LOForEach Schema: bagofmap#26:bytearray)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   (Name: LOGenerate&lt;span class=&quot;error&quot;&gt;&amp;#91;true&amp;#93;&lt;/span&gt; Schema: bagofmap#26:bytearray)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   (Name: BinCond Type: bag Uid: 16)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---(Name: UserFunc(org.apache.pig.builtin.IsEmpty) Type: boolean Uid: 14)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---bagofmap:(Name: Project Type: bag Uid: 12 Input: 0 Column: &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---(Name: Cast Type: bag Uid: 15)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---(Name: Constant Type: bytearray Uid: 15)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---bagofmap:(Name: Project Type: bag Uid: 12 Input: 1 Column: &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---bagofmap: (Name: LOInnerLoad&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; Schema: null)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---bagofmap: (Name: LOInnerLoad&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; Schema: null)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---A: (Name: LOLoad Schema: bagofmap#12:bag
{#13:tuple()}
&lt;p&gt;)RequiredFields:null&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&amp;lt;noformat&amp;gt;&lt;/p&gt;

&lt;p&gt;   then we can see, for alias C, D, the uid for bagofmap are different, 26 for C and 16 for D. are you sure this is correct?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13982742" author="polisan" created="Mon, 28 Apr 2014 05:06:09 +0100"  >&lt;p&gt;sorry for wrong format. reattach the LP.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;#-----------------------------------------------
# New Logical Plan:
#-----------------------------------------------
D: (Name: LOStore Schema: #21:chararray)
|
|---D: (Name: LOForEach Schema: #21:chararray)
    |   |
    |   (Name: LOGenerate[false] Schema: #21:chararray)
    |   |   |
    |   |   (Name: Cast Type: chararray Uid: 21)
    |   |   |
    |   |   |---(Name: Map Type: bytearray Uid: 21 Key: fieldkey2)
    |   |       |
    |   |       |---(Name: Cast Type: map Uid: 16)
    |   |           |
    |   |           |---bagofmap:(Name: Project Type: bytearray Uid: 16 Input: 0 Column: (*))
    |   |
    |   |---(Name: LOInnerLoad[0] Schema: bagofmap#26:bytearray)
    |
    |---C: (Name: LOFilter Schema: bagofmap#26:bytearray)
        |   |
        |   (Name: Regex Type: boolean Uid: 20)
        |   |
        |   |---(Name: Cast Type: chararray Uid: 17)
        |   |   |
        |   |   |---(Name: Map Type: bytearray Uid: 17 Key: fieldkey1)
        |   |       |
        |   |       |---(Name: Cast Type: map Uid: 26)
        |   |           |
        |   |           |---bagofmap:(Name: Project Type: bytearray Uid: 26 Input: 0 Column: 0)
        |   |
        |   |---(Name: Constant Type: chararray Uid: 19)
        |
        |---B: (Name: LOForEach Schema: bagofmap#26:bytearray)
            |   |
            |   (Name: LOGenerate[true] Schema: bagofmap#26:bytearray)
            |   |   |
            |   |   (Name: BinCond Type: bag Uid: 16)
            |   |   |
            |   |   |---(Name: UserFunc(org.apache.pig.builtin.IsEmpty) Type: boolean Uid: 14)
            |   |   |   |
            |   |   |   |---bagofmap:(Name: Project Type: bag Uid: 12 Input: 0 Column: (*))
            |   |   |
            |   |   |---(Name: Cast Type: bag Uid: 15)
            |   |   |   |
            |   |   |   |---(Name: Constant Type: bytearray Uid: 15)
            |   |   |
            |   |   |---bagofmap:(Name: Project Type: bag Uid: 12 Input: 1 Column: (*))
            |   |
            |   |---bagofmap: (Name: LOInnerLoad[0] Schema: null)
            |   |
            |   |---bagofmap: (Name: LOInnerLoad[0] Schema: null)
            |
            |---A: (Name: LOLoad Schema: bagofmap#12:bag{#13:tuple()})RequiredFields:null


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13982770" author="daijy" created="Mon, 28 Apr 2014 07:00:09 +0100"  >&lt;p&gt;Yes, the explain plan does not look right on trunk due to &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3508&quot; title=&quot;&amp;#39;explain&amp;#39; now showing logical plan BEFORE the necessary optimization (ImplicitSplitInserter, DuplicateForEachColumnRewrite,etc)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3508&quot;&gt;&lt;del&gt;PIG-3508&lt;/del&gt;&lt;/a&gt;, we need to checkin &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3545&quot; title=&quot;Seperate validation rules from optimizer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3545&quot;&gt;&lt;del&gt;PIG-3545&lt;/del&gt;&lt;/a&gt; to bring it right. The plan shown lacks another round of uid regeneration (uid for D need to be regenerated).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12641813" name="PIG-3909-1.patch" size="2033" author="daijy" created="Thu, 24 Apr 2014 23:42:23 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 24 Apr 2014 22:42:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>388281</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzoqnj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>388536</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>