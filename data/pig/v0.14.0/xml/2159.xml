<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:54:12 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2159/PIG-2159.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2159] New logical plan uses incorrect class for  SUM causing for ClassCastException</title>
                <link>https://issues.apache.org/jira/browse/PIG-2159</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The below is my script;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
A = load &apos;input1&apos; using PigStorage(&apos;,&apos;)  as (f1:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,f2:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,f3:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,f4:&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;,f5:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;);
B = load &apos;input2&apos; using PigStorage(&apos;,&apos;)  as (f1:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,f2:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,f3:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,f4:&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;,f5:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;);
C = load &apos;input_Main&apos; using PigStorage(&apos;,&apos;)  as (f1:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,f2:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,f3:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
U = UNION ONSCHEMA A,B;
J = join C by (f1,f2,f3) LEFT OUTER, U by (f1,f2,f3);
Porj = foreach J generate C::f1 as f1 ,C::f2 as f2,C::f3 as f3,U::f4 as f4,U::f5 as f5;
G = GROUP Porj by (f1,f2,f3,f5);
Final = foreach G generate SUM(Porj.f4) as total;
dump Final;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;The script fails at while computing the sum with class cast exception.&lt;br/&gt;
Caused by: java.lang.ClassCastException: java.lang.Long cannot be cast to java.lang.Double&lt;br/&gt;
         at org.apache.pig.builtin.DoubleSum$Initial.exec(DoubleSum.java:82)&lt;br/&gt;
         ... 19 more&lt;/p&gt;

&lt;p&gt;This is clearly a bug in the logical plan created in 0.9. The sum operation should have processed using org.apache.pig.builtin.LongSum, but instead 0.9 logical plan have used org.apache.pig.builtin.DoubleSum which is meant for sum of doubles. And hence the ClassCastException.&lt;/p&gt;

&lt;p&gt;The same script works fine with Pig 0.8.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12513906">PIG-2159</key>
            <summary>New logical plan uses incorrect class for  SUM causing for ClassCastException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="vivekp">Vivek Padmanabhan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Jul 2011 12:41:01 +0100</created>
                <updated>Thu, 4 Aug 2011 01:35:01 +0100</updated>
                            <resolved>Tue, 19 Jul 2011 00:48:18 +0100</resolved>
                                    <version>0.9.0</version>
                                    <fixVersion>0.9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13064498" author="vivekp" created="Wed, 13 Jul 2011 12:46:38 +0100"  >&lt;p&gt;The issue could be reproduced using the above mentioned script. A sample input is provided below ;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
input1
100,101,102,103,104,105
110,111,112,113,114,115

input2
200,201,202,203,204,205
210,211,212,213,214,215

input0
100,101,102,103,104,105
200,201,202,203,204,205
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;



&lt;p&gt;The logical plan from explain for 0.9;&lt;br/&gt;
#-----------------------------------------------&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;New Logical Plan:&lt;br/&gt;
#-----------------------------------------------&lt;br/&gt;
Final: (Name: LOStore Schema: total#95:double)
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---Final: (Name: LOForEach Schema: total#95:double)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   (Name: LOGenerate&lt;span class=&quot;error&quot;&gt;&amp;#91;false&amp;#93;&lt;/span&gt; Schema: &lt;br/&gt;
total#95:double)ColumnPrune:InputUids=&lt;span class=&quot;error&quot;&gt;&amp;#91;91&amp;#93;&lt;/span&gt;ColumnPrune:OutputUids=&lt;span class=&quot;error&quot;&gt;&amp;#91;95&amp;#93;&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   (Name: UserFunc(org.apache.pig.builtin.DoubleSum) Type: &lt;br/&gt;
double Uid: 95)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/li&gt;
&lt;/ol&gt;





&lt;p&gt;The logical plan from explain for 0.8;&lt;br/&gt;
#-----------------------------------------------&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;New Logical Plan:&lt;br/&gt;
#-----------------------------------------------&lt;br/&gt;
fake: (Name: LOStore Schema: total#68:long)
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---Final: (Name: LOForEach Schema: total#68:long)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   (Name: LOGenerate&lt;span class=&quot;error&quot;&gt;&amp;#91;false&amp;#93;&lt;/span&gt; Schema: &lt;br/&gt;
total#68:long)ColumnPrune:InputUids=&lt;span class=&quot;error&quot;&gt;&amp;#91;66&amp;#93;&lt;/span&gt;ColumnPrune:OutputUids=&lt;span class=&quot;error&quot;&gt;&amp;#91;68&amp;#93;&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   (Name: UserFunc(org.apache.pig.builtin.LongSum) Type: long &lt;br/&gt;
Uid: 68)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---(Name: Dereference Type: bag Uid: 67 Column:&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---Porj:(Name: Project Type: bag Uid: 66 Input: 0 &lt;br/&gt;
Column: &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;---Porj: (Name: LOInnerLoad&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; Schema: &lt;br/&gt;
f1#43:int,f2#44:int,f3#45:int,f4#59:long,f5#60:double)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13065444" author="daijy" created="Thu, 14 Jul 2011 19:39:50 +0100"  >&lt;p&gt;The error is caused by schema generated by unionOnSchema, which only has empty uid. This would impact many queries containing unionOnSchema.&lt;/p&gt;</comment>
                            <comment id="13065451" author="dvryaboy" created="Thu, 14 Jul 2011 19:46:15 +0100"  >&lt;p&gt;Sounds like a blocker for the 0.9 release, changing the priority accordingly. &lt;br/&gt;
Nice catch.&lt;/p&gt;</comment>
                            <comment id="13065639" author="daijy" created="Fri, 15 Jul 2011 01:49:51 +0100"  >&lt;p&gt;Fix test failure on TestUnionOnSchemaSetter.&lt;/p&gt;</comment>
                            <comment id="13066082" author="alangates" created="Fri, 15 Jul 2011 18:14:19 +0100"  >&lt;p&gt;Dmitry, I don&apos;t see this as a blocker for 0.9.  It does not produce wrong results and users can rewrite their scripts to work around it.  I agree it should go on the 0.9 branch and be part of the anticipated 0.9.1 release.  &lt;/p&gt;</comment>
                            <comment id="13066784" author="jiraposter@reviews.apache.org" created="Mon, 18 Jul 2011 05:43:00 +0100"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1138/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1138/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for pig and thejas.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2159&quot; title=&quot;New logical plan uses incorrect class for  SUM causing for ClassCastException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2159&quot;&gt;&lt;del&gt;PIG-2159&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2159&quot; title=&quot;New logical plan uses incorrect class for  SUM causing for ClassCastException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2159&quot;&gt;&lt;del&gt;PIG-2159&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2159&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/PIG-2159&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/src/org/apache/pig/newplan/logical/relational/LOUnion.java 1146183 &lt;br/&gt;
  trunk/test/org/apache/pig/parser/TestUnionOnSchemaSetter.java 1146183 &lt;br/&gt;
  trunk/test/org/apache/pig/test/TestEvalPipeline2.java 1146183 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1138/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1138/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Unit-test:&lt;br/&gt;
    all pass&lt;/p&gt;

&lt;p&gt;Test-patch:&lt;br/&gt;
    all pass&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Daniel&lt;/p&gt;
</comment>
                            <comment id="13067380" author="thejas" created="Tue, 19 Jul 2011 00:12:44 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13067396" author="daijy" created="Tue, 19 Jul 2011 00:48:18 +0100"  >&lt;p&gt;Patch committed to both 0.9 branch and trunk&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12486523" name="PIG-2159-1.patch" size="4848" author="daijy" created="Thu, 14 Jul 2011 23:24:00 +0100"/>
                            <attachment id="12486537" name="PIG-2159-2.patch" size="6069" author="daijy" created="Fri, 15 Jul 2011 01:49:51 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 14 Jul 2011 18:39:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66181</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyavw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97478</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>