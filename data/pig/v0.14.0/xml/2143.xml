<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:56:04 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2143/PIG-2143.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2143] Make PigStorage optionally store schema; improve docs.</title>
                <link>https://issues.apache.org/jira/browse/PIG-2143</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;I&apos;d like to propose that we allow for a greater degree of customization in PigStorage.&lt;/p&gt;

&lt;p&gt;An incomplete list features that we might want to add:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;flag to tell it to overwrite existing output if it exists&lt;/li&gt;
	&lt;li&gt;flag to tell it to compress output using gzip|bzip|lzo (currently this can be achieved by setting the directory name to end in .gz or .bz2, which is a bit awkward)&lt;/li&gt;
	&lt;li&gt;flag to tell it to store the schema and header (perhaps by merging in PigStorageSchema work?)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12511586">PIG-2143</key>
            <summary>Make PigStorage optionally store schema; improve docs.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dvryaboy">Dmitriy V. Ryaboy</assignee>
                                    <reporter username="dvryaboy">Dmitriy V. Ryaboy</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Jun 2011 01:40:45 +0100</created>
                <updated>Thu, 1 Aug 2013 15:08:39 +0100</updated>
                            <resolved>Mon, 18 Jul 2011 16:40:39 +0100</resolved>
                                                    <fixVersion>0.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13055250" author="dvryaboy" created="Mon, 27 Jun 2011 01:43:01 +0100"  >&lt;p&gt;In order to make this kind of thing work as more and more options are added, I suggest we add a single optional second argument, which specifies all the flags / options, similar to how we did it in HBaseStorage.&lt;/p&gt;

&lt;p&gt;So the invocation would be something like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
store mystuff into &apos;myplace&apos; using PigStorage(&apos;|&apos;, &apos;-compress=lzo -storeSchema -overwrite&apos;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13062668" author="dvryaboy" created="Sun, 10 Jul 2011 04:15:31 +0100"  >&lt;p&gt;Attached patch adds the code for treating an optional second parameter as a list of arguments.&lt;br/&gt;
It also moves PigStorageSchema code into PigStorage, controlled by a &apos;-schema&apos; flag, and deprecates PigStorageSchema (no plans to remove it completely yet).&lt;/p&gt;

&lt;p&gt;I plan to add the compression and overwrite flags as well in this ticket, consider this an early draft.&lt;/p&gt;</comment>
                            <comment id="13062882" author="dvryaboy" created="Mon, 11 Jul 2011 08:12:02 +0100"  >&lt;p&gt;I did some work on the compression thing, and had a second thought. Let&apos;s keep these changes isolated from each other. This code is already pretty baked (in PigStorageSchema) so it&apos;s probably better to make the other changes separately. Marking this as ready for review; will open separate tickets for the other improvements.&lt;/p&gt;</comment>
                            <comment id="13064196" author="rangadi" created="Tue, 12 Jul 2011 23:20:44 +0100"  >&lt;p&gt;+1 looks good.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;We could remove most of PigStorageSchema.java by invoking super(delimiter, &quot;-schema&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;this will also let us remove JsonMetadata.java and tests for PigStorageSchema.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13064942" author="thejas" created="Thu, 14 Jul 2011 00:11:50 +0100"  >&lt;p&gt;In PigStorage.applySchema, the schema is being deserialised in every call. It needs to be done only the first time.&lt;/p&gt;

&lt;p&gt;Some minor things - &lt;/p&gt;

&lt;p&gt;formatting of a curly braces  in  the functions -  PigStorage(String delimiter, String options) and applySchema(Tuple tup) are off .&lt;/p&gt;

&lt;p&gt;I ran test-patch, and there was a new javadoc warning - &lt;/p&gt;

&lt;p&gt;&amp;gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /tmp/trunk/src/org/apache/pig/builtin/JsonMetadata.java:94: warning: &lt;span class=&quot;error&quot;&gt;&amp;#91;deprecation&amp;#93;&lt;/span&gt; fullPath(java.lang.String,org.apache.pig.backend.datastorage.DataStorage) in org.apache.pig.impl.io.FileLocalizer has been deprecated&lt;br/&gt;
&amp;gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         String fullPath = FileLocalizer.fullPath(path, storage);&lt;/p&gt;

&lt;p&gt;There is also a javac warning from JsonMetadata.java, but that can be addressed separately (different jira) since JsonMetadata.java is just copied from existing file. &lt;br/&gt;
 /tmp/trunk/src/org/apache/pig/builtin/JsonMetadata.java:191: warning - Tag @see: can&apos;t find getStatistics(String, Configuration) in org.apache.pig.LoadMetadata&lt;/p&gt;


&lt;p&gt;Other thoughts (we can also track these in different jira&apos;s)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If  PigStorage without parameters is used (ie same as specifying no load func) on data that has been stored with &apos;-schema&apos;. Should the schema and delim from metadata be used ?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;PigStorage is used with delim on file stored with &apos;-schema&apos;, should it throw error if the delim in metadata file is different ? or warn and just use the delim specified in metadata file ?&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="13065375" author="dvryaboy" created="Thu, 14 Jul 2011 17:42:39 +0100"  >&lt;p&gt;Thanks for the reviews.&lt;/p&gt;

&lt;p&gt;Uploading a patch that fixes the repeated deserialization (nice catch!), adjusts whitespace, and makes the piggybank stuff shallow deprecated proxies for the builtins.&lt;/p&gt;

&lt;p&gt;I am not sure if loading the schema when it was created but isn&apos;t being requested is a good idea.. can see arguments both ways.&lt;/p&gt;

&lt;p&gt;I do think we should allow loading with a different delimiter than that set in the schema.&lt;/p&gt;</comment>
                            <comment id="13065376" author="dvryaboy" created="Thu, 14 Jul 2011 17:42:56 +0100"  >&lt;p&gt;resubmitting patch&lt;/p&gt;</comment>
                            <comment id="13065391" author="rangadi" created="Thu, 14 Jul 2011 18:14:25 +0100"  >
&lt;p&gt;PigStorageSchema is not setting &quot;-schema&quot; argument.&lt;/p&gt;

&lt;p&gt;&amp;gt; I am not sure if loading the schema when it was created but isn&apos;t being requested is a good idea..&lt;/p&gt;

&lt;p&gt;+1 for using the existing schema. May be we could add &apos;-ignoreSchema&apos; flag.&lt;/p&gt;

&lt;p&gt;&amp;gt; PigStorage is used with delim on file stored with &apos;-schema&apos;, should it throw error if the delim in metadata file is different ? or warn and just use the delim specified in metadata file ?&lt;/p&gt;

&lt;p&gt;+1 for throwing an error. If we have -ignoreSchema, it will let users handle some rare cases. &lt;/p&gt;</comment>
                            <comment id="13065678" author="dvryaboy" created="Fri, 15 Jul 2011 03:09:11 +0100"  >&lt;p&gt;Canceling patch to incorporate the feedback.&lt;/p&gt;</comment>
                            <comment id="13065724" author="dvryaboy" created="Fri, 15 Jul 2011 06:34:18 +0100"  >&lt;p&gt;Submitting a new version of the patch.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;added a bunch of javadocs&lt;/li&gt;
	&lt;li&gt;added &quot;-noschema&quot; to turn off loading of schema&lt;/li&gt;
	&lt;li&gt;removed the compression code accidentally introduced in the previous version &amp;#8211; saving that for another ticket&lt;/li&gt;
	&lt;li&gt;did NOT fix the delimiter issue. That&apos;s because we currently don&apos;t store the delimiter when storing the schema! We just use it to delimit the header file. There is no clean way to store this kind of information, we need to think about the proper design for this.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13065728" author="dvryaboy" created="Fri, 15 Jul 2011 06:40:27 +0100"  >&lt;p&gt;Recreated the patch, this time using git --no-prefix so it&apos;ll apply for svn users.&lt;/p&gt;</comment>
                            <comment id="13066061" author="rangadi" created="Fri, 15 Jul 2011 17:32:08 +0100"  >&lt;p&gt;Thanks for the detailed javadoc. noticed the compression changes in the prev patch.&lt;/p&gt;

&lt;p&gt;PigStorageSchema class does not set &quot;-schema&quot; option. Is that correct?&lt;/p&gt;

&lt;p&gt;didn&apos;t know .pig_schema didn&apos;t store the delimiter.&lt;/p&gt;</comment>
                            <comment id="13066275" author="thejas" created="Fri, 15 Jul 2011 23:34:02 +0100"  >&lt;p&gt;Thanks for adding the comprehensive documentation and fixing the incorrect old one! &lt;/p&gt;

&lt;p&gt;Review of &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2143&quot; title=&quot;Make PigStorage optionally store schema; improve docs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2143&quot;&gt;&lt;del&gt;PIG-2143&lt;/del&gt;&lt;/a&gt;.4.patch -&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In PigStorage.getSchema(..) , it should check for (!dontLoadSchema) for deciding if the schema file should be read. (instead of (storeschema) ).&lt;/li&gt;
	&lt;li&gt;A test case where pig loads schema with the default constructor will be useful. One of the new test cases in the patch can be modified for this. I think we need one for the -noschema as well.&lt;/li&gt;
	&lt;li&gt;In javadoc for constructor PigStorage(String delimiter, String options), the line about &quot;-Dprop=value&quot; can be removed as its not used right now.&lt;/li&gt;
	&lt;li&gt;A nitpick - In the PigStorage class javadoc, I think &apos;An optional second constructor&apos; is a bit misleading. There are 3 constructors including default one, and all 3 constructors are &apos;optional&apos; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; . Maybe calling it &apos;Another constructor&apos; is better.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13066577" author="dvryaboy" created="Sun, 17 Jul 2011 03:52:40 +0100"  >&lt;p&gt;Addressed the comments.&lt;br/&gt;
Added tests. They pass.&lt;/p&gt;</comment>
                            <comment id="13066777" author="thejas" created="Mon, 18 Jul 2011 05:05:31 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2143&quot; title=&quot;Make PigStorage optionally store schema; improve docs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2143&quot;&gt;&lt;del&gt;PIG-2143&lt;/del&gt;&lt;/a&gt;.5.patch looks great. +1&lt;/p&gt;</comment>
                            <comment id="13067092" author="dvryaboy" created="Mon, 18 Jul 2011 16:38:43 +0100"  >&lt;p&gt;Changed the title to reflect what we actually did in this iteration.&lt;/p&gt;</comment>
                            <comment id="13067093" author="dvryaboy" created="Mon, 18 Jul 2011 16:40:39 +0100"  >&lt;p&gt;Committed. Thanks Raghu and Thejas for reviews.&lt;/p&gt;</comment>
                            <comment id="13067170" author="daijy" created="Mon, 18 Jul 2011 18:45:15 +0100"  >&lt;p&gt;Can we put release notes on this? Thanks.&lt;/p&gt;</comment>
                            <comment id="13158263" author="guangnan" created="Mon, 28 Nov 2011 07:28:55 +0000"  >&lt;p&gt;Would like to have the -overwrite option implimented. &lt;/p&gt;

&lt;p&gt;Also it&apos;s ugly that while what I want is to overwrite exsting output location and I have to speicify the delimter again.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
store mystuff into &apos;myplace&apos; using PigStorage(&apos;\t&apos;, &apos;-overwrite&apos;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13159052" author="dvryaboy" created="Tue, 29 Nov 2011 02:38:22 +0000"  >&lt;p&gt;Cheng, we narrowed the scope of this ticket to actually get the rewrite in &amp;#8211; do you want to open another jira with this feature request?&lt;/p&gt;</comment>
                            <comment id="13726454" author="35niavlys" created="Thu, 1 Aug 2013 15:08:39 +0100"  >&lt;p&gt;I try to launch the store command 2 times in the same query :&lt;/p&gt;

&lt;p&gt;   pigServer.registerQuery(&quot;&lt;br/&gt;
      STORE data1 INTO &apos;store1&apos; USING PigStorage(&apos;&lt;br class=&quot;atl-forced-newline&quot; /&gt;t&apos;, &apos;-schema&apos;);&lt;br/&gt;
      STORE data2 INTO &apos;store2&apos; USING PigStorage(&apos;&lt;br class=&quot;atl-forced-newline&quot; /&gt;t&apos;, &apos;-schema&apos;);&lt;br/&gt;
   &quot;);&lt;/p&gt;

&lt;p&gt;&apos;store1&apos; have his schema but not &apos;store2&apos;, have you got the same problem ?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12514713">PIG-2179</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12486466" name="PIG-2143.2.diff" size="60381" author="dvryaboy" created="Thu, 14 Jul 2011 17:42:39 +0100"/>
                            <attachment id="12486547" name="PIG-2143.3.patch" size="74306" author="dvryaboy" created="Fri, 15 Jul 2011 06:34:18 +0100"/>
                            <attachment id="12486550" name="PIG-2143.4.patch" size="74260" author="dvryaboy" created="Fri, 15 Jul 2011 06:40:27 +0100"/>
                            <attachment id="12486751" name="PIG-2143.5.patch" size="74569" author="dvryaboy" created="Sun, 17 Jul 2011 03:52:40 +0100"/>
                            <attachment id="12485981" name="PIG-2143.diff" size="35453" author="dvryaboy" created="Sun, 10 Jul 2011 04:15:31 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 12 Jul 2011 22:20:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>41692</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyavsv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97463</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Documentation has been updated to reflect reality.&lt;br/&gt;
&lt;br/&gt;
An optional second constructor argument is provided that allows one to customize advanced behaviors. A list of available options is below:&lt;br/&gt;
&lt;br/&gt;
-schema Stores the schema of the relation using a hidden JSON file.&lt;br/&gt;
-noschema Ignores a stored schema during loading.&lt;br/&gt;
&lt;br/&gt;
Schemas&lt;br/&gt;
If -schema is specified, a hidden &amp;quot;.pig_schema&amp;quot; file is created in the output directory when storing data. It is used by PigStorage (with or without -schema) during loading to determine the field names and types of the data without the need for a user to explicitly provide the schema in an as clause, unless -noschema is specified. No attempt to merge conflicting schemas is made during loading. The first schema encountered during a file system scan is used.&lt;br/&gt;
In addition, using -schema drops a &amp;quot;.pig_headers&amp;quot; file in the output directory. This file simply lists the delimited aliases. This is intended to make export to tools that can read files with header lines easier (just cat the header to your data).&lt;br/&gt;
&lt;br/&gt;
Note that regardless of whether or not you store the schema, you always need to specify the correct delimiter to read your data. If you store reading delimiter &amp;quot;#&amp;quot; and then load using the default delimiter, your data will not be parsed correctly.&lt;br/&gt;
&lt;br/&gt;
</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>