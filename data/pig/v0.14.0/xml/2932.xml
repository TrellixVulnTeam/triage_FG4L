<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:09:04 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2932/PIG-2932.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2932] Setting high default_parallel causes IOException in local mode</title>
                <link>https://issues.apache.org/jira/browse/PIG-2932</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;This bug has been confirmed only in local mode.&lt;/p&gt;

&lt;p&gt;When setting a high default_parallel, Pig fails on some operations.&lt;br/&gt;
The following data and script reproduce the bug.&lt;/p&gt;

&lt;p&gt;Data:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
grunt&amp;gt; cat file.txt                                  
11	1	qwer
12	2	qwerty
13	3	ert
13	3	ertyu
14	4	zxcv
16	6	fsdfg
16	6	fdfghj
18	8	fjklopi
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Script:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SET default_parallel 9
a = load &apos;file.txt&apos; as (id1:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, id2:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, str:chararray);
b = group a by (id1,id2);
c = foreach b generate flatten(group), a;
d = order c by group::id1 ASC, group::id2 ASC;
dump d
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2012-09-26 15:28:13,230 [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-32] INFO  org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapReduce$Map - Aliases being processed per job phase (AliasName[line,offset]): M: d[12,4] C:  R: 
2012-09-26 15:28:13,232 [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-32] WARN  org.apache.hadoop.mapred.LocalJobRunner - job_local_0009
java.io.IOException: Illegal partition &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Null: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; index: 0 (12,2) (1)
	at org.apache.hadoop.mapred.MapTask$MapOutputBuffer.collect(MapTask.java:1073)
	at org.apache.hadoop.mapred.MapTask$NewOutputCollector.write(MapTask.java:691)
	at org.apache.hadoop.mapreduce.TaskInputOutputContext.write(TaskInputOutputContext.java:80)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapReduce$Map.collect(PigGenericMapReduce.java:123)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.runPipeline(PigGenericMapBase.java:285)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:278)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:64)
	at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:144)
	at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:764)
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:370)
	at org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:212)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The script succeeds if default_parallel is set to 2.&lt;br/&gt;
I guess it depends on the fact that the default_parallel is higher than the number of unique keys, probably some quirk with ORDER BY.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12609238">PIG-2932</key>
            <summary>Setting high default_parallel causes IOException in local mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cheolsoo">Cheolsoo Park</assignee>
                                    <reporter username="azaroth">Gianmarco De Francisci Morales</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Sep 2012 14:41:27 +0100</created>
                <updated>Sat, 24 Jan 2015 21:53:27 +0000</updated>
                            <resolved>Fri, 5 Oct 2012 22:45:13 +0100</resolved>
                                                    <fixVersion>0.11</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13464380" author="cheolsoo" created="Thu, 27 Sep 2012 03:34:03 +0100"  >&lt;p&gt;In fact, the example script works fine with MR2 in local mode, so that makes me believe that this is an issue with LocalJobRunner of hadoop 0.20. Please see &lt;a href=&quot;https://issues.apache.org/jira/browse/MAPREDUCE-1367&quot; title=&quot;LocalJobRunner should support parallel mapper execution&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAPREDUCE-1367&quot;&gt;&lt;del&gt;MAPREDUCE-1367&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The best fix is probably disabling the tests in local mode. I don&apos;t think that there is a way to disable tests only when hadoopversion == 20 &amp;amp;&amp;amp; execonly == local.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13464383" author="cheolsoo" created="Thu, 27 Sep 2012 03:42:29 +0100"  >&lt;p&gt;Attaching a patch that disables Rank tests in local mode.&lt;/p&gt;</comment>
                            <comment id="13464628" author="xalan" created="Thu, 27 Sep 2012 12:17:11 +0100"  >&lt;p&gt;I think the patch can solve the problem with rank tests execution in local mode. &lt;br/&gt;
But, I tried this code and failed again:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SET default_parallel 3;
a = load &apos;file.txt&apos; as (id1:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, id2:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, str:chararray);
b = order id1 ASC, id2 ASC;
dump b;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m using Hadoop 1.0.0&lt;/p&gt;</comment>
                            <comment id="13464942" author="cheolsoo" created="Thu, 27 Sep 2012 19:18:04 +0100"  >&lt;p&gt;Hi Allan,&lt;/p&gt;

&lt;p&gt;That&apos;s expected. Any parallelism in local mode w/o &lt;a href=&quot;https://issues.apache.org/jira/browse/MAPREDUCE-1367&quot; title=&quot;LocalJobRunner should support parallel mapper execution&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAPREDUCE-1367&quot;&gt;&lt;del&gt;MAPREDUCE-1367&lt;/del&gt;&lt;/a&gt; will fail. If you compare LocalJobRunner of hadoop 1.0.0 and that of hadoop 2.0.0, you will see that &lt;a href=&quot;https://issues.apache.org/jira/browse/MAPREDUCE-1367&quot; title=&quot;LocalJobRunner should support parallel mapper execution&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAPREDUCE-1367&quot;&gt;&lt;del&gt;MAPREDUCE-1367&lt;/del&gt;&lt;/a&gt; is included in 2.0.0 but not in 1.0.0.&lt;/p&gt;

&lt;p&gt;Again, you code runs fine in MR2 (hadoop-2.0.0). To really &quot;fix&quot; it, we have to replace the hadoop dependency in pig.jar, but all the hadoop 0.20.x and 1.0.0 have the same problem.&lt;/p&gt;

&lt;p&gt;In fact, I ran into the same issue at &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2852&quot; title=&quot;Old Hadoop API being used sometimes when running parellel in local mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2852&quot;&gt;&lt;del&gt;PIG-2852&lt;/del&gt;&lt;/a&gt;, and I documented it in Pig manual.&lt;/p&gt;

&lt;p&gt;I suggest that we should change the title of the jira and disable Rank tests in local mode. Please let me know if you have a better suggestion.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13465232" author="azaroth" created="Fri, 28 Sep 2012 00:56:19 +0100"  >&lt;p&gt;Cheolsoo, thanks for the explanation.&lt;br/&gt;
Now it is more clear.&lt;/p&gt;

&lt;p&gt;I agree with your proposals.&lt;br/&gt;
Will test and commit the patch tomorrow.&lt;/p&gt;</comment>
                            <comment id="13465483" author="xalan" created="Fri, 28 Sep 2012 09:53:30 +0100"  >&lt;p&gt;Thanks for the explanation Cheolsoo. &lt;/p&gt;</comment>
                            <comment id="13470695" author="alangates" created="Fri, 5 Oct 2012 22:45:13 +0100"  >&lt;p&gt;Patch checked in.  Thanks Cheolsoo.&lt;/p&gt;</comment>
                            <comment id="14209703" author="alex_davliatov" created="Thu, 13 Nov 2014 12:45:34 +0000"  >&lt;p&gt;Apache Pig version 0.12.1 (r1585011) &lt;br/&gt;
compiled Apr 05 2014, 01:41:34&lt;/p&gt;

&lt;p&gt;Happened again.&lt;/p&gt;</comment>
                            <comment id="14211352" author="daijy" created="Thu, 13 Nov 2014 21:53:51 +0000"  >&lt;p&gt;What is your hadoop version?&lt;/p&gt;</comment>
                            <comment id="14215833" author="alex_davliatov" created="Tue, 18 Nov 2014 07:37:44 +0000"  >&lt;p&gt;Sorry, didn&apos;t read the comments properly: I use hadoop 1.2.1, and fix is hadoop 2.+.&lt;/p&gt;</comment>
                            <comment id="14290837" author="erwaman" created="Sat, 24 Jan 2015 21:53:27 +0000"  >&lt;p&gt;I encountered this issue, too, in distributed mode with Pig 0.11.1 and Hadoop 2.3.0. I filed &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4392&quot; title=&quot;RANK BY fails when default_parallel is greater than cardinality of field being ranked by&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4392&quot;&gt;&lt;del&gt;PIG-4392&lt;/del&gt;&lt;/a&gt; for my issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12769896">PIG-4392</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12546794" name="PIG-2932.patch" size="3533" author="cheolsoo" created="Thu, 27 Sep 2012 03:42:29 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 27 Sep 2012 02:34:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242073</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxwd0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12597</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>