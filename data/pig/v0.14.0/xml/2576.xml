<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:00:59 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2576/PIG-2576.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2576] Change in behavior for UDFContext.getUDFContext().getJobConf() in front-end</title>
                <link>https://issues.apache.org/jira/browse/PIG-2576</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;We read a file in the UDF constructor. (The file is transferred to the compute nodes via distache)&lt;br/&gt;
To avoid this case in the front-end while the script is in the compile stage,&lt;br/&gt;
we differentiate between front end and back end execution depending upon a condition ( UDFContext.getUDFContext().getJobConf() == null )&lt;/p&gt;

&lt;p&gt;This was working till Pig 0.9.1, in the current Pig 0.9 version this is breaking.&lt;br/&gt;
ie, If I have any &apos;fs&apos; commands after the STORE statement, the GruntParser invokes the udf constructor again and the above condition check returns false causing errors.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12545796">PIG-2576</key>
            <summary>Change in behavior for UDFContext.getUDFContext().getJobConf() in front-end</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thw">Thomas Weise</assignee>
                                    <reporter username="vivekp">Vivek Padmanabhan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Mar 2012 09:07:10 +0000</created>
                <updated>Thu, 26 Apr 2012 21:32:40 +0100</updated>
                            <resolved>Fri, 16 Mar 2012 22:20:23 +0000</resolved>
                                    <version>0.9.3</version>
                                    <fixVersion>0.10.0</fixVersion>
                    <fixVersion>0.9.3</fixVersion>
                    <fixVersion>0.11</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13225955" author="vivekp" created="Fri, 9 Mar 2012 09:22:13 +0000"  >&lt;p&gt;Attaching a sample script, udf and exception trace to illustrate the issue.&lt;br/&gt;
Looks like the change came in as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2532&quot; title=&quot;Registered classes fail deserialization in frontend&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2532&quot;&gt;&lt;del&gt;PIG-2532&lt;/del&gt;&lt;/a&gt; in which Pig MR Launcher will set the current UDFContext before the MR jobs are&lt;br/&gt;
launched. &lt;br/&gt;
Hence after the job launch , the UDFContext.getUDFContext().getJobConf() will&lt;br/&gt;
always be a non null value.&lt;/p&gt;</comment>
                            <comment id="13225992" author="daijy" created="Fri, 9 Mar 2012 10:35:57 +0000"  >&lt;p&gt;This might hardly count as defect. But if we absolutely need to bring the old behavior, we shall clone UDFContext instead of passing reference.&lt;/p&gt;</comment>
                            <comment id="13226004" author="vivekp" created="Fri, 9 Mar 2012 11:02:40 +0000"  >&lt;p&gt;Daniel, currently is there any api calls to differentiate the local and MR mode ?&lt;br/&gt;
If not how about providing this information in UDFContext. &lt;/p&gt;</comment>
                            <comment id="13226083" author="thw" created="Fri, 9 Mar 2012 14:07:42 +0000"  >&lt;p&gt;For the user it is a regression or incompatibility introduced in a minor/patch release. Whether the previous behavior of UDFContext.getUDFContext().getJobConf() was intended/documented and what workarounds there are (see below) is not really important, it was in place for long and users have come to rely on it. It is impossible for us to find out how many UDFs have been written with this dependency or change them. &lt;/p&gt;

&lt;p&gt;A better way for UDF developers to ensure initialization only runs in the backend is another issue. It should be possible to determine that easily and in a standard way. The UDF constructor is executed by the frontend (several times) and mapred, hence there is a need to determine where the code runs (for access to files etc.) &lt;/p&gt;

&lt;p&gt;UDF developer can workaround this by just being a bit more &quot;safe&quot; with the &quot;where do I run&quot; check:&lt;/p&gt;

&lt;p&gt;1) The initialization can be done lazily from exec(...), which is never called in the frontend?&lt;/p&gt;

&lt;p&gt;2) Instead of just checking for null, do this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

Configuration jobConf = UDFContext.getUDFContext().getJobConf();
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (jobConf != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; jobConf.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;mapred.task.id&quot;&lt;/span&gt;) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
   &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Executing in BACKEND:&quot;&lt;/span&gt; + jobConf.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;mapred.task.id&quot;&lt;/span&gt;));    
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
   &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Executing in FRONTEND&quot;&lt;/span&gt; + jobConf);    
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Both of the above work on 0.9.2 and previous releases.&lt;/p&gt;
</comment>
                            <comment id="13226196" author="ashutoshc" created="Fri, 9 Mar 2012 16:54:17 +0000"  >&lt;p&gt;Until &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2344&quot; title=&quot;UDF / LoadFunc / StoreFunc should be serializable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2344&quot;&gt;PIG-2344&lt;/a&gt; is resolved this (wanting to know running in front/backend) will keep coming back, since state is exposed to user, where it should not have been. Long term fix of this is &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2344&quot; title=&quot;UDF / LoadFunc / StoreFunc should be serializable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2344&quot;&gt;PIG-2344&lt;/a&gt;, in short term we can provide a static method which can return boolean telling its running in frontend or not, instead of user doing it themselves and getting into issues.&lt;/p&gt;</comment>
                            <comment id="13226392" author="thw" created="Fri, 9 Mar 2012 20:11:10 +0000"  >&lt;p&gt;Patch to clone UDFContext. Also adding convenience method for frontend check.&lt;/p&gt;

&lt;p&gt;Patch tested on cluster and run ant test -Dtestcase=TestRegisteredJarVisibility&lt;/p&gt;</comment>
                            <comment id="13226407" author="daijy" created="Fri, 9 Mar 2012 20:18:25 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13231642" author="thw" created="Fri, 16 Mar 2012 21:22:17 +0000"  >&lt;p&gt;Attached e2e test to verify conf is always null in frontend.&lt;/p&gt;</comment>
                            <comment id="13231683" author="daijy" created="Fri, 16 Mar 2012 22:20:23 +0000"  >&lt;p&gt;+1. Patch committed to 0.9/0.10/trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12542626">PIG-2532</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12529942">PIG-2344</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12517772" name="PIG-2576_0.9.patch" size="1767" author="thw" created="Fri, 9 Mar 2012 20:11:10 +0000"/>
                            <attachment id="12517693" name="PIG-2576_Script_UDF.txt" size="3431" author="vivekp" created="Fri, 9 Mar 2012 09:22:12 +0000"/>
                            <attachment id="12518738" name="PIG-2576_e2e.patch" size="2523" author="thw" created="Fri, 16 Mar 2012 21:22:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 9 Mar 2012 10:35:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>230979</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyaxuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97796</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>