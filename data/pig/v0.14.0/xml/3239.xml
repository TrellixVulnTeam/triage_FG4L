<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:50:01 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3239/PIG-3239.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3239] Unable to return multiple values from a macro using SPLIT</title>
                <link>https://issues.apache.org/jira/browse/PIG-3239</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Hi, I&apos;m unable to return multiple values from a macro when values come from a SPLIT. Here is an small example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
DEFINE my_macro(seq) RETURNS valid, invalid {
    added = FOREACH $seq GENERATE $0 * 2, $1;
    SPLIT added INTO $valid IF $1 == &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, $invalid OTHERWISE;
}

data = LOAD &apos;&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;.csv&apos; USING PigStorage(&apos;,&apos;) AS (value: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, valid: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;);
P, Q = my_macro(data);
DUMP P;
DUMP Q;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Pig is unable to recognize the &lt;tt&gt;OTHERWISE&lt;/tt&gt; side. Error is: &lt;tt&gt;ERROR org.apache.pig.tools.grunt.Grunt - ERROR 1200: &amp;lt;at case.pig, line 3&amp;gt; Invalid macro definition: . Reason: Macro &apos;my_macro&apos; missing return alias: invalid&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Simple workaround is to force &lt;tt&gt;$invalid&lt;/tt&gt; to be returned as &lt;tt&gt;FOREACH&lt;/tt&gt; result:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SPLIT added INTO $valid IF $1 == &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, tmp_invalid OTHERWISE;
$invalid = FOREACH tmp_invalid GENERATE *;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Samples and logs attached to the issue.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Apache Pig version 0.10.0-cdh4.2.0 (rexported) &lt;br/&gt;
compiled Feb 15 2013, 12:19:17&lt;/p&gt;

&lt;p&gt;Linux 3.2.0-38-generic #61-Ubuntu SMP Tue Feb 19 12:18:21 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux&lt;/p&gt;</environment>
        <key id="12635564">PIG-3239</key>
            <summary>Unable to return multiple values from a macro using SPLIT</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dreambird">Johnny Zhang</assignee>
                                    <reporter username="luibelgo">Luis Belloch</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Mar 2013 13:06:37 +0000</created>
                <updated>Mon, 14 Oct 2013 17:45:47 +0100</updated>
                            <resolved>Fri, 15 Mar 2013 16:58:38 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13594686" author="luibelgo" created="Wed, 6 Mar 2013 13:08:56 +0000"  >&lt;p&gt;Files: &lt;a href=&quot;https://gist.github.com/luisbelloch/5099190&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gist.github.com/luisbelloch/5099190&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13599553" author="dreambird" created="Tue, 12 Mar 2013 01:15:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=luibelgo&quot; class=&quot;user-hover&quot; rel=&quot;luibelgo&quot;&gt;Luis Belloch&lt;/a&gt;, please correct me if I am wrong, I think &apos;SPLIT&apos; doesn&apos;t work with &apos;OTHERWISE&apos;. &apos;SPLIT&apos; only work with &apos;IF&apos; &lt;a href=&quot;http://pig.apache.org/docs/r0.7.0/piglatin_ref2.html#SPLIT&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://pig.apache.org/docs/r0.7.0/piglatin_ref2.html#SPLIT&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;actually below script works with me very well on your example&lt;/p&gt;
{noforamt}
&lt;p&gt;DEFINE my_macro(seq) RETURNS valid, invalid &lt;/p&gt;
{                 
    added = FOREACH $seq GENERATE $0 * 2, $1;                 
    SPLIT added INTO $valid IF $1 == true, $invalid IF $1 ==false;
}
&lt;p&gt;data = LOAD &apos;case.csv&apos; USING PigStorage(&apos;,&apos;) AS (value: int, valid: boolean);&lt;br/&gt;
P, Q = my_macro(data);&lt;br/&gt;
DUMP P;&lt;br/&gt;
DUMP Q;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13599554" author="dreambird" created="Tue, 12 Mar 2013 01:16:56 +0000"  >&lt;p&gt;sorry for the typo, I mean&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;DEFINE my_macro(seq) RETURNS valid, invalid
{ added = FOREACH $seq GENERATE $0 * 2, $1; SPLIT added INTO $valid IF $1 == true, $invalid IF $1 ==false; } data = LOAD &apos;case.csv&apos; USING PigStorage(&apos;,&apos;) AS (value: int, valid: boolean); P, Q = my_macro(data); DUMP P; DUMP Q; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13599823" author="luibelgo" created="Tue, 12 Mar 2013 08:25:16 +0000"  >&lt;p&gt;Hi Johnny Zhang, if you have a look at version 0.10, OTHERWISE keyword exists.&lt;br/&gt;
&lt;a href=&quot;http://pig.apache.org/docs/r0.10.0/basic.html#SPLIT&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://pig.apache.org/docs/r0.10.0/basic.html#SPLIT&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13600281" author="dreambird" created="Tue, 12 Mar 2013 18:14:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=luibelgo&quot; class=&quot;user-hover&quot; rel=&quot;luibelgo&quot;&gt;Luis Belloch&lt;/a&gt;, you are right, sorry I was looking at the old release doc.&lt;/p&gt;</comment>
                            <comment id="13600653" author="dreambird" created="Wed, 13 Mar 2013 00:31:42 +0000"  >&lt;p&gt;this fix works for me. I will run all unit tests see if any regression it brings.&lt;/p&gt;</comment>
                            <comment id="13600949" author="luibelgo" created="Wed, 13 Mar 2013 08:39:22 +0000"  >&lt;p&gt;Thanks! We&apos;ll test it internally.&lt;/p&gt;
</comment>
                            <comment id="13601638" author="cheolsoo" created="Wed, 13 Mar 2013 21:08:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dreambird&quot; class=&quot;user-hover&quot; rel=&quot;dreambird&quot;&gt;Johnny Zhang&lt;/a&gt;, thank you for the fix. I think your fix is correct. Can you please add a unit test case for this?&lt;/p&gt;

&lt;p&gt;TestMacroExpansion.java has splitTest, but that doesn&apos;t cover OTHERWISE. You might want to expand that test case, or add a new test case.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13602540" author="cheolsoo" created="Thu, 14 Mar 2013 18:24:27 +0000"  >&lt;p&gt;Chatted with Johnny, and it looks like TestMacroExpansion isn&apos;t a good place to put a new test case for this. It might be better to add one to TestSplit.&lt;/p&gt;</comment>
                            <comment id="13602868" author="dreambird" created="Thu, 14 Mar 2013 23:04:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;, thanks a lot for review my patch. I have add one test case into TestSplit.&lt;/p&gt;</comment>
                            <comment id="13603160" author="cheolsoo" created="Fri, 15 Mar 2013 05:37:03 +0000"  >&lt;p&gt;+1. Let me run unit tests.&lt;/p&gt;</comment>
                            <comment id="13603513" author="cheolsoo" created="Fri, 15 Mar 2013 16:58:38 +0000"  >&lt;p&gt;Committed to trunk. Thanks Johnny!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12573790" name="PIG-3239.patch.txt" size="2066" author="dreambird" created="Thu, 14 Mar 2013 23:03:47 +0000"/>
                            <attachment id="12573448" name="PIG-3239.patch.txt" size="742" author="dreambird" created="Wed, 13 Mar 2013 00:31:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 12 Mar 2013 01:15:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>316057</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzcdzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>316400</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>