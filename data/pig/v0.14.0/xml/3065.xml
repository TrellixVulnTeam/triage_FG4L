<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:59:56 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3065/PIG-3065.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3065] pig output format/committer should support recovery for hadoop 0.23</title>
                <link>https://issues.apache.org/jira/browse/PIG-3065</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;In hadoop 0.23 the output committer can optionally support recovery to handle&lt;br/&gt;
the application master getting restarted (failing some # of attempts). If its possible the pig outputformat/committer should support recovery.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12617153">PIG-3065</key>
            <summary>pig output format/committer should support recovery for hadoop 0.23</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="rohini">Rohini Palaniswamy</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Nov 2012 18:34:17 +0000</created>
                <updated>Mon, 14 Oct 2013 17:46:27 +0100</updated>
                            <resolved>Tue, 17 Sep 2013 19:14:10 +0100</resolved>
                                                    <fixVersion>0.12.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13502183" author="rohini" created="Wed, 21 Nov 2012 18:35:19 +0000"  >&lt;p&gt;From &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tgraves&quot; class=&quot;user-hover&quot; rel=&quot;tgraves&quot;&gt;Thomas Graves&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;In hadoop 0.23 the output committer can optionally support recovery to handle&lt;br/&gt;
the application master getting restarted (failing some # of attempts). Recovery&lt;br/&gt;
allows the app master to pick up from where it left off in the case where some&lt;br/&gt;
tasks finished before the failure.  The AM does this by reading the job history&lt;br/&gt;
file so far and determining which tasks completed.   The hadoop&lt;br/&gt;
Fileoutputformat/Fileoutputcommitter supports this.&lt;/p&gt;

&lt;p&gt;  @Override&lt;br/&gt;
  public boolean isRecoverySupported() &lt;/p&gt;
{
    return true;
  }

&lt;p&gt;From doing some searching,&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigOutputFormat&lt;br/&gt;
uses PigOutputCommitter which doesn&apos;t have the recovery supported set so it&lt;br/&gt;
defaults to the OutputCommitter one which has recovery set to false.  We&apos;ve&lt;br/&gt;
seen many instances where we believe supporting this would have made things go&lt;br/&gt;
much faster as the jobs which had the AM fail had to re-run all of the tasks&lt;br/&gt;
rather then just a few that hadn&apos;t finished yet.&lt;/p&gt;

&lt;p&gt;If its possible the pig outputformat/committer should support recovery.&lt;/p&gt;</comment>
                            <comment id="13695911" author="dreambird" created="Sat, 29 Jun 2013 00:22:16 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;Rohini Palaniswamy&lt;/a&gt;, I see the problem. I want to pick this one. Though I am not clear for class PigOutputCommitter.java, how can we let it import hadoop 2.x jar, in where isRecoverySupported() is available in class OutputCommitter.java when hadoopVersion is 23; and import hadoop 1.x jar, in where isRecoverySupported() is available in class OutputCommitter.java when hadoopVersion is 20? Any example of how Pig does this? Thanks.&lt;/p&gt;</comment>
                            <comment id="13696154" author="rohini" created="Sat, 29 Jun 2013 17:58:08 +0100"  >&lt;p&gt;Look at HadoopShims classes. You can add a method like&lt;/p&gt;

&lt;p&gt;public boolean isRecoverySupported(OutputCommitter committer) &lt;/p&gt;
{
   return committer.isRecoverySupported();
}


&lt;p&gt;In 0.20/1.x HadoopShims, the method can just return false always. The AM restart/recovery is still not as stable as one would hope to be at the moment and we have seen it lead to data corruption/loss. So please also add a configuration property for this and have it turned off by default.&lt;/p&gt;</comment>
                            <comment id="13699388" author="dreambird" created="Wed, 3 Jul 2013 21:08:33 +0100"  >&lt;p&gt;Rohini, thanks a lot for your explanations! This patch added a new function isRecoverySupported in PigOutputCommitter, which return whether AM restart recover is supported.&lt;/p&gt;</comment>
                            <comment id="13702632" author="rohini" created="Tue, 9 Jul 2013 00:44:12 +0100"  >&lt;p&gt;Few comments:&lt;br/&gt;
  1) Can you change static public to public static in HadoopShims?&lt;br/&gt;
  2) You are checking against the static string instead of the value in the configuration. It will never be true.&lt;/p&gt;

&lt;p&gt;supported = PigConfiguration.PIG_OUTPUT_COMMITTER_RECOVERY.equals(&quot;true&quot;) ? HadoopShims.isRecoverySupported(oc) : false;&lt;/p&gt;

&lt;p&gt;  Were you able to test this out by killing the application master process? It needs to be tested out for this patch to be ready for commit.  &lt;/p&gt;</comment>
                            <comment id="13707363" author="dreambird" created="Fri, 12 Jul 2013 22:01:58 +0100"  >&lt;p&gt;Rohini, thanks for your comments. Appreciate. I just upload the polished patch, hopefully it address the concerns. I am still figuring out a manual test, will post the result later. Thanks.&lt;/p&gt;
</comment>
                            <comment id="13764677" author="daijy" created="Wed, 11 Sep 2013 20:45:45 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dreambird&quot; class=&quot;user-hover&quot; rel=&quot;dreambird&quot;&gt;Johnny Zhang&lt;/a&gt; Are you still working on it? I uploaded a simplified patch, and will try to test it.&lt;/p&gt;</comment>
                            <comment id="13764713" author="daijy" created="Wed, 11 Sep 2013 21:18:37 +0100"  >&lt;p&gt;We shall also invoke individual OutputCommitter to relay the isRecoverySupported/recoverTask. Reattach patch.&lt;/p&gt;</comment>
                            <comment id="13765453" author="rohini" created="Thu, 12 Sep 2013 15:14:06 +0100"  >&lt;p&gt;Looks good Daniel. Just a minor comment on formatting. Noticed !=null is not formatted. If we can test this across AM restarts and knows it works then we can get this in.&lt;/p&gt;</comment>
                            <comment id="13769047" author="daijy" created="Tue, 17 Sep 2013 02:02:00 +0100"  >&lt;p&gt;Tested with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vinodkv&quot; class=&quot;user-hover&quot; rel=&quot;vinodkv&quot;&gt;Vinod Kumar Vavilapalli&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arpitagarwal&quot; class=&quot;user-hover&quot; rel=&quot;arpitagarwal&quot;&gt;Arpit Agarwal&lt;/a&gt;. The patch worked as expected. &lt;/p&gt;</comment>
                            <comment id="13769057" author="rohini" created="Tue, 17 Sep 2013 02:11:39 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13769762" author="daijy" created="Tue, 17 Sep 2013 19:14:10 +0100"  >&lt;p&gt;Patch committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12602654" name="PIG-3065-3.patch" size="6610" author="daijy" created="Wed, 11 Sep 2013 21:18:37 +0100"/>
                            <attachment id="12592073" name="PIG-3065.patch.txt" size="4496" author="dreambird" created="Fri, 12 Jul 2013 22:01:58 +0100"/>
                            <attachment id="12590707" name="PIG-3065.patch.txt" size="4614" author="dreambird" created="Wed, 3 Jul 2013 21:08:33 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 28 Jun 2013 23:22:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>259354</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyfj4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>124627</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>