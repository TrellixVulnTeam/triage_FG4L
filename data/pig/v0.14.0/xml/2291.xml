<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:02:51 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2291/PIG-2291.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2291] PigStats.isSuccessful returns false if embedded pig script has dump</title>
                <link>https://issues.apache.org/jira/browse/PIG-2291</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The below is my python script, &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
#! /usr/bin/python
from  org.apache.pig.scripting &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; Pig

P = Pig.compileFromFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;&quot;a.pig&quot;&lt;/span&gt;&quot;&quot;)
result = P.bind().runSingle()

&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; result.isSuccessful():
    print &apos;Pig job succeeded&apos;
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;:
    print &apos;Pig job failed&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;The below is the pig script embedded (a.pig)&lt;br/&gt;
A = LOAD &apos;a1&apos; USING PigStorage(&apos;,&apos;) AS (f1:chararray,f2:chararray);&lt;br/&gt;
B = GROUP A by f1;&lt;br/&gt;
dump B;&lt;/p&gt;


&lt;p&gt;For this script execution, even though the job is successful the output printed is &apos;Pig job failed&apos;&lt;br/&gt;
This is because result.isSuccessful() is returning false whenever the pig script is having a dump statement.&lt;/p&gt;

&lt;p&gt;If i run the pig script alone, then the error code returned is proper.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12523533">PIG-2291</key>
            <summary>PigStats.isSuccessful returns false if embedded pig script has dump</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xutingz">xuting zhao</assignee>
                                    <reporter username="vivekp">Vivek Padmanabhan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Sep 2011 09:55:19 +0100</created>
                <updated>Mon, 23 Jan 2012 07:31:19 +0000</updated>
                            <resolved>Tue, 20 Dec 2011 19:27:56 +0000</resolved>
                                    <version>0.9.0</version>
                                    <fixVersion>0.9.2</fixVersion>
                    <fixVersion>0.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13165714" author="olgan" created="Fri, 9 Dec 2011 00:43:45 +0000"  >&lt;p&gt;Xuting, could you, please, take a look, thanks&lt;/p&gt;</comment>
                            <comment id="13168014" author="xutingz" created="Tue, 13 Dec 2011 01:03:13 +0000"  >&lt;p&gt;I think this problem is caused by the specialty of dump operation. From the Pig tutorial, it says:&lt;/p&gt;

&lt;p&gt;With multi-query exection, you want to use STORE to save (persist) your results. You do not want to use DUMP as it will disable multi-query execution and is likely to slow down execution. (If you have included DUMP statements in your scripts for debugging purposes, you should remove them.)&lt;/p&gt;

&lt;p&gt;DUMP Example: In this script, because the DUMP command is interactive, the multi-query execution will be disabled and two separate jobs will be created to execute this script. The first job will execute A &amp;gt; B &amp;gt; DUMP while the second job will execute A &amp;gt; B &amp;gt; C &amp;gt; STORE.&lt;/p&gt;

&lt;p&gt;A = LOAD &apos;input&apos; AS (x, y, z);&lt;br/&gt;
B = FILTER A BY x &amp;gt; 5;&lt;br/&gt;
DUMP B;&lt;br/&gt;
C = FOREACH B GENERATE y, z;&lt;br/&gt;
STORE C INTO &apos;output&apos;;&lt;/p&gt;

&lt;p&gt;Similarly, adding dump B into the python script will lead to two logical plan to be executed and the second logical plan is empty and will return a unsuccessful status to the exec function in the BoundScript. I am not sure if we need to fix this because this problem seems an &quot;expected&quot; behavior of the dump operation.&lt;/p&gt;</comment>
                            <comment id="13168919" author="daijy" created="Wed, 14 Dec 2011 00:28:53 +0000"  >&lt;p&gt;In PigServer.execute(), we call &quot;PigStatsUtil.getEmptyPigStats()&quot; when execute an empty plan. getEmptyPigStats does have a side effect to clear up the global stats, which I think we should avoid. I think instead of calling &quot;getEmptyPigStats&quot;, we shall simply return &quot;new SimplePigStats()&quot;, so the global stats retain. &lt;/p&gt;</comment>
                            <comment id="13168954" author="xutingz" created="Wed, 14 Dec 2011 01:23:17 +0000"  >&lt;p&gt;Hi Daniel, &lt;/p&gt;

&lt;p&gt;   Thanks for the advice! I re-exam the code and the PigStatsUtil.getEmptyPigStats() should be the cause of the problem. However, it seems what the getEmptyStats does is to create a new SimplePigStats() and return it back. How about changing the return stats to : return PigStats.get(), which I think, will return the current PigStats of the PigServer so the global stats retains?&lt;/p&gt;

&lt;p&gt;Xuting&lt;/p&gt;</comment>
                            <comment id="13169009" author="daijy" created="Wed, 14 Dec 2011 02:26:31 +0000"  >&lt;p&gt;That&apos;s fine for me. But seems other code also use getEmptyPigStats, I am not sure whether other code relies on the old behavior of getEmptyPigStats or not. Can you check it out? If not, then go ahead and change it.&lt;/p&gt;</comment>
                            <comment id="13169738" author="xutingz" created="Wed, 14 Dec 2011 21:55:00 +0000"  >&lt;p&gt;I have changed the return type to return PigStats.get(); The ant test-commit has been ran successfully on trunk, 0.9 and 0.10 branch. Additional unit test cases are added into TestScriptLanguage and this specific unit test has ran successfully on 0.9, 0.10 and trunk as well. If there is additional unit test that I missed to run, please let me know. Thanks.&lt;br/&gt;
Xuting&lt;/p&gt;</comment>
                            <comment id="13170525" author="daijy" created="Thu, 15 Dec 2011 22:08:27 +0000"  >&lt;p&gt;Xuting,&lt;br/&gt;
I get one failure TestGrunt.testScriptMissingLastNewLine, can you take a look?&lt;/p&gt;</comment>
                            <comment id="13171163" author="xutingz" created="Fri, 16 Dec 2011 19:46:33 +0000"  >&lt;p&gt;Hi Daniel,&lt;/p&gt;

&lt;p&gt;   I downloaded the trunk source code from svn and without any modification, the test on TestGrunt seems to fail. The following is the code that I ran:&lt;br/&gt;
ant test -Dtestcase=TestGrunt&lt;/p&gt;

&lt;p&gt;Xuting&lt;/p&gt;</comment>
                            <comment id="13171236" author="daijy" created="Fri, 16 Dec 2011 21:58:21 +0000"  >&lt;p&gt;Seems trunk is broken. I will take a look. Thanks!&lt;/p&gt;</comment>
                            <comment id="13173447" author="daijy" created="Tue, 20 Dec 2011 19:23:57 +0000"  >&lt;p&gt;Change the patch slightly. All unit tests pass. test-patch:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; -1 overall.  &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 @author.  The patch does not contain any @author tags.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 tests included.  The patch appears to include 3 new or modified tests.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     -1 release audit.  The applied patch generated 507 release audit warnings (more than the trunk&apos;s current 500 warnings).&lt;/p&gt;

&lt;p&gt;No new file added, ignore release audit warning.&lt;/p&gt;</comment>
                            <comment id="13173453" author="daijy" created="Tue, 20 Dec 2011 19:27:56 +0000"  >&lt;p&gt;Patch committed to 0.9/0.10/trunk. Thanks Xuting!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12508121" name="PIG-2291-2.patch" size="4976" author="daijy" created="Tue, 20 Dec 2011 19:23:57 +0000"/>
                            <attachment id="12507441" name="PIG-2291.patch" size="3681" author="xutingz" created="Wed, 14 Dec 2011 21:50:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 9 Dec 2011 00:43:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35728</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyawif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97578</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>