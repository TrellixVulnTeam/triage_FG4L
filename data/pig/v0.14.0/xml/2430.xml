<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:52:20 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2430/PIG-2430.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2430] An EvalFunc which overrides getArgToFuncMapping with FuncSpec with constructor arguments is not properly instantiated with said arguments</title>
                <link>https://issues.apache.org/jira/browse/PIG-2430</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;If you override getArgToFuncMapping and any of the FuncSpec&apos;s specify constructor arguments, those arguments are currently ignored. Thankfully, there is a one line fix (it&apos;s funny that this has never been run into before, but is an). Patch with tests incoming. I assume that this affects 0.10 and 0.9 but haven&apos;t tested, I was just working with trunk.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12535273">PIG-2430</key>
            <summary>An EvalFunc which overrides getArgToFuncMapping with FuncSpec with constructor arguments is not properly instantiated with said arguments</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jcoveney">Jonathan Coveney</assignee>
                                    <reporter username="jcoveney">Jonathan Coveney</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Dec 2011 08:43:35 +0000</created>
                <updated>Thu, 26 Apr 2012 21:32:46 +0100</updated>
                            <resolved>Fri, 6 Jan 2012 22:08:33 +0000</resolved>
                                    <version>0.9.0</version>
                    <version>0.10.0</version>
                    <version>0.11</version>
                                    <fixVersion>0.10.0</fixVersion>
                    <fixVersion>0.11</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13170039" author="jcoveney" created="Thu, 15 Dec 2011 08:47:18 +0000"  >&lt;p&gt;I added a new test. Ran ant test-commit successful. Should test on 0.10 and 0.9&lt;/p&gt;</comment>
                            <comment id="13170593" author="jcoveney" created="Thu, 15 Dec 2011 23:51:31 +0000"  >&lt;p&gt;I patched .9 and .10 and ran ant test-commit successfully too &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13170746" author="dvryaboy" created="Fri, 16 Dec 2011 03:52:40 +0000"  >&lt;p&gt;Nice fix, but make the test use local mode. Also might want to move the UDF classes into the test itself, it&apos;s not like someone is likely to reuse it from the utils package.&lt;/p&gt;</comment>
                            <comment id="13170800" author="jcoveney" created="Fri, 16 Dec 2011 06:19:16 +0000"  >&lt;p&gt;This takes into account Dmitriy&apos;s suggestions. I successfully ran ant test-commit on trunk, and ant -Dtestcase=TestUDF test on 0.9 and 0.10.&lt;/p&gt;</comment>
                            <comment id="13170806" author="jcoveney" created="Fri, 16 Dec 2011 07:12:23 +0000"  >&lt;p&gt;I ran ant test-commit successfully on 0.9 and 0.10&lt;/p&gt;</comment>
                            <comment id="13172843" author="thejas" created="Tue, 20 Dec 2011 01:59:35 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
grunt&amp;gt; define SZ SIZE(&apos;10&apos;);        
grunt&amp;gt; l = load &apos;t.txt&apos; as (a,b);   
grunt&amp;gt; f = foreach l generate SZ(a);
grunt&amp;gt; dump f;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have attached a patch with a change to size udf to return a dummy size value passed in the constructor. (the change is just meant to demonstrate the issue)&lt;/p&gt;

&lt;p&gt;With the change proposed in PIG2430_1.patch, the constructor argument does not get set. Without the PIG2430_1.patch, the SZ(a) call will return 10, with it returns 0.&lt;/p&gt;</comment>
                            <comment id="13172925" author="jcoveney" created="Tue, 20 Dec 2011 05:09:17 +0000"  >&lt;p&gt;Thejas, thanks again for taking a look. I see what you mean now. I think there are a couple of resolutions to this, the question comes down to: in the case of an explicit define statement, but where there is also a matching getArgToFuncMapping, which should take precedence? For an explicit parameter (ie you dummy sIZE example), it seems pretty clear that the user defined parameter should take precedence. With no parameter it is less clear...there are 2 reasons why people would use a define statement.&lt;br/&gt;
1) to explicitly define a constructor parameter (or intentionally 0 constructor parameters)&lt;br/&gt;
2) to be able to refer to a UDF by an alias (in which case, the argument by the getArgToFuncMapping may be appropriate)&lt;/p&gt;

&lt;p&gt;This ambiguity could be why this argument was ignored in the first place, but given it&apos;s there, I think it could be useful in UDFs, we just have to be clear on the semantics.&lt;/p&gt;</comment>
                            <comment id="13173285" author="dvryaboy" created="Tue, 20 Dec 2011 16:27:41 +0000"  >&lt;p&gt;Is there a way for us to tell if a UDF was DEFINEd or just used directly? That way we could tell if no-arguments was forced through a define, or if we should obey the args passed via argToFuncMapping.&lt;/p&gt;</comment>
                            <comment id="13173449" author="thejas" created="Tue, 20 Dec 2011 19:24:44 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is there a way for us to tell if a UDF was DEFINEd or just used directly? &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The information is not currently available in TypeCheckingExpVisitor, but it should be possible to pass that along. LogicalPlanBuilder.buildUDF is where the replacement with defined udf happens.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This ambiguity could be why this argument was ignored in the first place, but given it&apos;s there, I think it could be useful in UDFs, we just have to be clear on the semantics.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think we can define the semantics as the getArgsToFuncMapping() returns function with default constructor arguments, which can be overridden by define statement. I think it makes sense to add this info to the javadoc comments for getArgsToFuncMapping.&lt;/p&gt;

&lt;p&gt;We need to think about how this constructor argument semantics should be defined with the new EvalFunc interface in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2421&quot; title=&quot;EvalFuncs need redesigned&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2421&quot;&gt;PIG-2421&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13173871" author="jcoveney" created="Wed, 21 Dec 2011 05:46:52 +0000"  >&lt;p&gt;I agree that this experience should definitely inform the new EvalFunc design. I added a new comment&lt;/p&gt;

&lt;p&gt;As far as this patch, I added your case to TestUDF, and took it into account. There is a part of LogicalPlanBuilder.java&apos;s buildUDF that is only called if there was no define statement for the alias in question. Thus, I added a field to UserFuncExpression which holds true if it was created via a define, and false otherwise.&lt;/p&gt;

&lt;p&gt;Thus, if you were to do...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
define my myudf(&apos;val&apos;);
a = load ...
b = foreach a generate my($0), myudf($0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this case, the my would have any FuncSpec values overriden by the define statement, but myudf would not, since it was not via an alias.&lt;/p&gt;

&lt;p&gt;Let me know if this seems like an appropriate way to do this!&lt;/p&gt;</comment>
                            <comment id="13180674" author="jcoveney" created="Thu, 5 Jan 2012 18:40:25 +0000"  >&lt;p&gt;Thejas,&lt;/p&gt;

&lt;p&gt;Was wondering if you might be able to get this a look to see if it seems reasonable.&lt;/p&gt;</comment>
                            <comment id="13180755" author="thejas" created="Thu, 5 Jan 2012 19:34:32 +0000"  >&lt;p&gt;Sorry, I had forgot about this jira. Thanks for reminding!&lt;br/&gt;
This looks good. I will commit after running unit tests and test-patch.&lt;/p&gt;</comment>
                            <comment id="13180780" author="thejas" created="Thu, 5 Jan 2012 19:56:44 +0000"  >&lt;p&gt;Does anybody feel strongly to have this in 0.9 branch? While I don&apos;t see the change as being risky, I think it is better to minimize the patches to 0.9 in the interest of keeping it stable. &lt;/p&gt;</comment>
                            <comment id="13180791" author="dvryaboy" created="Thu, 5 Jan 2012 20:07:18 +0000"  >&lt;p&gt;I&apos;m ok with keeping this out of 0.9 branch.&lt;/p&gt;</comment>
                            <comment id="13180885" author="jcoveney" created="Thu, 5 Jan 2012 22:12:07 +0000"  >&lt;p&gt;I&apos;m fine keeping this out of 0.9. The genesis of this patch was that it enables other things I&apos;d like to do in trunk. 0.9 should probably really only have bug fixes and minor improvements at this point, keeping it stable, and we should make 0.10 the next bastion of the high tech pigs.&lt;/p&gt;</comment>
                            <comment id="13181640" author="thejas" created="Fri, 6 Jan 2012 22:03:33 +0000"  >&lt;p&gt;PIG2430_2.010.patch - patch re-based with 0.10 branch .&lt;/p&gt;</comment>
                            <comment id="13181642" author="thejas" created="Fri, 6 Jan 2012 22:08:34 +0000"  >&lt;p&gt;test-patch and unit tests pass. Committed the patches to 0.10 branch and trunk.&lt;br/&gt;
Thanks Jonathan!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12534605">PIG-2421</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12508019" name="DummySize.patch" size="769" author="thejas" created="Tue, 20 Dec 2011 01:59:35 +0000"/>
                            <attachment id="12507489" name="PIG2430.patch" size="6014" author="jcoveney" created="Thu, 15 Dec 2011 08:46:44 +0000"/>
                            <attachment id="12507658" name="PIG2430_1.patch" size="5577" author="jcoveney" created="Fri, 16 Dec 2011 06:20:05 +0000"/>
                            <attachment id="12509722" name="PIG2430_2.010.patch" size="9155" author="thejas" created="Fri, 6 Jan 2012 22:03:33 +0000"/>
                            <attachment id="12508201" name="PIG2430_2.patch" size="9597" author="jcoveney" created="Wed, 21 Dec 2011 05:47:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 16 Dec 2011 03:52:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>220957</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyax6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97687</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>