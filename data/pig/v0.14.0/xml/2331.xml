<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:08:24 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2331/PIG-2331.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2331] BinStorage in LOAD statement failing when input has curly braces</title>
                <link>https://issues.apache.org/jira/browse/PIG-2331</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;When one uses curly braces in load statement when BinStorage() is used, it fails with the following exception&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Pig Stack Trace
---------------
ERROR 2245:
&amp;lt;file rep1.pig, line 1, column 4&amp;gt; Cannot get schema from loadFunc org.apache.pig.builtin.BinStorage

org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1066: Unable to open iterator &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; alias a
        at org.apache.pig.PigServer.openIterator(PigServer.java:901)
        at org.apache.pig.tools.grunt.GruntParser.processDump(GruntParser.java:655)
        at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:303)
        at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:188)
        at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:164)
        at org.apache.pig.tools.grunt.Grunt.exec(Grunt.java:81)
        at org.apache.pig.Main.run(Main.java:561)
        at org.apache.pig.Main.main(Main.java:111)
Caused by: org.apache.pig.PigException: ERROR 1002: Unable to store alias a
        at org.apache.pig.PigServer.storeEx(PigServer.java:1000)
        at org.apache.pig.PigServer.store(PigServer.java:963)
        at org.apache.pig.PigServer.openIterator(PigServer.java:876)
        ... 7 more
Caused by: org.apache.pig.impl.logicalLayer.FrontendException: ERROR 2245:
&amp;lt;file rep1.pig, line 1, column 4&amp;gt; Cannot get schema from loadFunc org.apache.pig.builtin.BinStorage
        at org.apache.pig.newplan.logical.relational.LOLoad.getSchemaFromMetaData(LOLoad.java:154)
        at org.apache.pig.newplan.logical.relational.LOLoad.getSchema(LOLoad.java:109)
        at org.apache.pig.newplan.logical.relational.LOStore.getSchema(LOStore.java:68)
        at org.apache.pig.newplan.logical.visitor.SchemaAliasVisitor.validate(SchemaAliasVisitor.java:60)
        at org.apache.pig.newplan.logical.visitor.SchemaAliasVisitor.visit(SchemaAliasVisitor.java:84)
        at org.apache.pig.newplan.logical.relational.LOStore.accept(LOStore.java:77)
        at org.apache.pig.newplan.DependencyOrderWalker.walk(DependencyOrderWalker.java:75)
        at org.apache.pig.newplan.PlanVisitor.visit(PlanVisitor.java:50)
        at org.apache.pig.PigServer$Graph.compile(PigServer.java:1659)
        at org.apache.pig.PigServer$Graph.compile(PigServer.java:1653)
        at org.apache.pig.PigServer$Graph.access$200(PigServer.java:1378)
        at org.apache.pig.PigServer.storeEx(PigServer.java:995)
        ... 9 more
Caused by: java.io.IOException: java.net.URISyntaxException: Illegal character in path at index 72: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//xyz/user/anithar/input/part-m-0000{0,1}
&lt;/span&gt;        at org.apache.pig.builtin.BinStorage.getSchema(BinStorage.java:377)
        at org.apache.pig.newplan.logical.relational.LOLoad.getSchemaFromMetaData(LOLoad.java:150)
        ... 20 more
Caused by: java.net.URISyntaxException: Illegal character in path at index 72: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//xyz/user/anithar/input/part-m-0000{0,1}
&lt;/span&gt;        at java.net.URI$Parser.fail(URI.java:2809)
        at java.net.URI$Parser.checkChars(URI.java:2982)
        at java.net.URI$Parser.parseHierarchical(URI.java:3066)
        at java.net.URI$Parser.parse(URI.java:3014)
        at java.net.URI.&amp;lt;init&amp;gt;(URI.java:578)
        at org.apache.pig.builtin.BinStorage.getSchema(BinStorage.java:375)
        ... 21 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Script&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a = load &apos;input/part-m-0000{0,1}&apos; using BinStorage();
dump a;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt; The script runs well in 0.8 version. &lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Anitha&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12528251">PIG-2331</key>
            <summary>BinStorage in LOAD statement failing when input has curly braces</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xutingz">xuting zhao</assignee>
                                    <reporter username="anitharaju">Anitha Raju</reporter>
                        <labels>
                    </labels>
                <created>Fri, 21 Oct 2011 11:35:07 +0100</created>
                <updated>Wed, 14 Dec 2011 21:51:22 +0000</updated>
                            <resolved>Wed, 14 Dec 2011 21:50:53 +0000</resolved>
                                    <version>0.9.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13132983" author="olgan" created="Fri, 21 Oct 2011 20:41:48 +0100"  >&lt;p&gt;This looks like a regression since it works on 0.8. Can somebody take a look please&lt;/p&gt;</comment>
                            <comment id="13133065" author="thejas" created="Fri, 21 Oct 2011 22:06:36 +0100"  >&lt;p&gt;The regression caused by changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1865&quot; title=&quot;BinStorage/PigStorageSchema cannot load data from a different namenode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1865&quot;&gt;&lt;del&gt;PIG-1865&lt;/del&gt;&lt;/a&gt; (load data from a different namenode), where &apos;new URI(loc)&apos; is called to connect to a different file system. &lt;/p&gt;</comment>
                            <comment id="13133073" author="olgan" created="Fri, 21 Oct 2011 22:26:21 +0100"  >&lt;p&gt;Thejas, thanks for quick investigation! How complex will the change need to be?&lt;/p&gt;</comment>
                            <comment id="13133455" author="thejas" created="Sat, 22 Oct 2011 19:48:23 +0100"  >&lt;p&gt;The file name string is converted into an URI, which is then used to create a FileSystem object. But the curly braces are not part of a valid URI. &lt;br/&gt;
One way to get a valid URI in such cases would be to expand the glob pattern in file name, but unfortunately that code is not exposed through a public API. So the code will have to copied to pig or accessed through reflection.&lt;/p&gt;</comment>
                            <comment id="13140396" author="thejas" created="Mon, 31 Oct 2011 18:15:51 +0000"  >&lt;p&gt;Hadoop provides a way to get a valid uri from this location String, - (new org.apache.hadoop.fs.Path(location)).toUri().  That would be a clean way to fix this. &lt;/p&gt;
</comment>
                            <comment id="13163258" author="olgan" created="Tue, 6 Dec 2011 01:44:09 +0000"  >&lt;p&gt;Hi Xuting, please, take a look. Thejas will be helping you with this one - reach out to him if need help&lt;/p&gt;</comment>
                            <comment id="13165707" author="xutingz" created="Fri, 9 Dec 2011 00:27:34 +0000"  >&lt;p&gt;I have modified the code according to Thejas&apos;s suggestion and added a unit test. test-commit has been run successfully on 0.9, 0.10 and trunk.&lt;/p&gt;</comment>
                            <comment id="13169735" author="thejas" created="Wed, 14 Dec 2011 21:50:53 +0000"  >&lt;p&gt;+1 Patch committed to trunk and 0.10 branch.&lt;br/&gt;
I made a minor change in the test case before checking in the patch - replaced &quot;i=i+1;&quot; with &quot;i++;&quot; .&lt;/p&gt;</comment>
                            <comment id="13169736" author="thejas" created="Wed, 14 Dec 2011 21:51:22 +0000"  >&lt;p&gt;Xuting,Thanks for the contribution!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12506686" name="PIG-2331.patch" size="2226" author="xutingz" created="Fri, 9 Dec 2011 00:26:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 21 Oct 2011 19:41:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97605</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyawpr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97611</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>