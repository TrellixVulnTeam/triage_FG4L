<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:56:03 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2144/PIG-2144.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2144] ClassCastException when using IsEmpty(DIFF()) </title>
                <link>https://issues.apache.org/jira/browse/PIG-2144</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;I have following input &amp;lt;name&amp;gt;:&amp;lt;nickname&amp;gt;, for which I want to find records where name is different from nickname.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;input/name_nickname.txt&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Bharat:Bharat
Amita:Amita
Mitesh:Mitesh
Reenu:Anshu
Shikha:Shikhu
Shilpa:Shilpi
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have following script to find records where name is different from nickname.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;isEmpty_diff.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

A = LOAD &apos;input/name_nickname.txt&apos; using PigStorage(&apos;:&apos;);

B = FILTER A BY NOT IsEmpty(DIFF($0, $1));

DUMP B;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;The above pig script works with older pig versions (e.g. 0.8.0 (r1043805)) and gives following output&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;output of isEmpty_diff.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
(Reenu,Anshu)
(Shikha,Shikhu)
(Shilpa,Shilpi)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;However, the above pig script (isEmpty_diff.pig) fails on Pig 0.9 (e.g. 0.9.0.xx (r1127671)) and newer version of Pig 0.8 (e.g. version 0.8.0.xx (r1102885)) , with ClassCastException&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;ClassCastException&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.ClassCastException: org.apache.pig.data.DefaultDataBag cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to java.lang.&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;
        at org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.PONot.getNext(PONot.java:75)
        at org.apache.pig.backend.hadoop.executionengine.physicalLayer.PhysicalOperator.getNext(PhysicalOperator.java:318)
        at org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.POUserFunc.processInput(POUserFunc.java:159)
        at org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.POUserFunc.getNext(POUserFunc.java:184)
        at org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.POUserFunc.getNext(POUserFunc.java:269)
        at org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.PONot.getNext(PONot.java:71)
        at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POFilter.getNext(POFilter.java:148)
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigMapBase.runPipeline(PigMapBase.java:261)
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigMapBase.map(PigMapBase.java:256)
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigMapBase.map(PigMapBase.java:58)
        at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:144)
        at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:676)
        at org.apache.hadoop.mapred.MapTask.run(MapTask.java:336)
        at org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:210)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;As a workaround, I used the following pig script.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
A = LOAD &apos;input/name_nickname.txt&apos; using PigStorage(&apos;:&apos;);

--B = FILTER A BY NOT IsEmpty(DIFF($0, $1));
B1 = FOREACH A GENERATE $0, $1, DIFF($0, $1);
B2 = FILTER B1 BY NOT IsEmpty($2);
B = FOREACH B2 GENERATE $0, $1;

DUMP B;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12511652">PIG-2144</key>
            <summary>ClassCastException when using IsEmpty(DIFF()) </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thejas">Thejas M Nair</assignee>
                                    <reporter username="miteshsjat">Mitesh Singh Jat</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Jun 2011 15:23:46 +0100</created>
                <updated>Thu, 4 Aug 2011 01:34:44 +0100</updated>
                            <resolved>Wed, 29 Jun 2011 01:32:02 +0100</resolved>
                                    <version>0.8.0</version>
                    <version>0.8.1</version>
                    <version>0.9.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                    <fixVersion>0.8.1</fixVersion>
                    <fixVersion>0.9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13055752" author="thejas" created="Mon, 27 Jun 2011 21:55:08 +0100"  >&lt;p&gt;The bug is in LogicalExpressionSimplifier optimization rule, it is doing a wrong transformation and adding a NOT operator to output of DIFF.&lt;br/&gt;
The logical plan - &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
#-----------------------------------------------
# New Logical Plan:
#-----------------------------------------------
B: (Name: LOStore Schema: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
|
|---B: (Name: LOFilter Schema: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
    |   |
    |   (Name: Not Type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; Uid: 12)
    |   |
    |   |---(Name: UserFunc(org.apache.pig.builtin.IsEmpty) Type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; Uid: 9)
    |       |
    |       |---(Name: Not Type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; Uid: 11)
    |           |
    |           |---(Name: UserFunc(org.apache.pig.builtin.DIFF) Type: bag Uid: 8)
    |               |
    |               |---(Name: Project Type: bytearray Uid: 6 Input: 0 Column: 0)
    |               |
    |               |---(Name: Project Type: bytearray Uid: 7 Input: 0 Column: 1)
    |
    |---A: (Name: LOLoad Schema: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)RequiredFields:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Note: In the explain command, the logical optimizer is also called twice, which seems to eliminate the Not in the logical plan that is printed. I made local changes to code to find the actual logical plan gets used for generating the physical plan (pasted above). Will make changes to ensure that logical optimizer runs only once in the explain command, as part of this patch.&lt;/p&gt;
</comment>
                            <comment id="13055759" author="thejas" created="Mon, 27 Jun 2011 22:07:58 +0100"  >&lt;p&gt;For a filter condition where one filter udf (ie returns boolean) is called from another, and there is a NOT on the outer udf, the query would finish successfully inspite of having an incorrect plan.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
eg.
 B = FILTER A BY NOT IsEmpty(IsEmpty($0));

grunt&amp;gt; explain B;
#-----------------------------------------------
# New Logical Plan:
#-----------------------------------------------
B: (Name: LOStore Schema: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
|
|---B: (Name: LOFilter Schema: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
    |   |
    |   (Name: Not Type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; Uid: 24)
    |   |
    |   |---(Name: UserFunc(org.apache.pig.builtin.IsEmpty) Type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; Uid: 21)
    |       |
    |       |---(Name: Not Type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; Uid: 23)
    |           |
    |           |---(Name: UserFunc(org.apache.pig.builtin.IsEmpty) Type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; Uid: 20)
    |               |
    |               |---(Name: Project Type: bytearray Uid: 19 Input: 0 Column: 0)
    |
    |---A: (Name: LOLoad Schema: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)RequiredFields:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13056678" author="daijy" created="Tue, 28 Jun 2011 18:59:23 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13056912" author="thejas" created="Wed, 29 Jun 2011 01:31:41 +0100"  >&lt;p&gt;Patch passed unit tests and test-patch. Committed patch to trunk, 0.9. Committed slightly modified patch for 0.8 - &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2144&quot; title=&quot;ClassCastException when using IsEmpty(DIFF()) &quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2144&quot;&gt;&lt;del&gt;PIG-2144&lt;/del&gt;&lt;/a&gt;.08.1.patch&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12484583" name="PIG-2144.08.1.patch" size="3810" author="thejas" created="Wed, 29 Jun 2011 01:31:41 +0100"/>
                            <attachment id="12484472" name="PIG-2144.1.patch" size="4521" author="thejas" created="Tue, 28 Jun 2011 17:22:08 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 27 Jun 2011 20:55:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66281</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyavt3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97464</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>