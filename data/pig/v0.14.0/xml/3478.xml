<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:56:28 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3478/PIG-3478.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3478] Make StreamingUDF work for Hadoop 2</title>
                <link>https://issues.apache.org/jira/browse/PIG-3478</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2417&quot; title=&quot;Streaming UDFs -  allow users to easily write UDFs in scripting languages with no JVM implementation.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2417&quot;&gt;&lt;del&gt;PIG-2417&lt;/del&gt;&lt;/a&gt; introduced Streaming UDF. However, it does not work under Hadoop 2. Both unit tests/e2e tests under Haodop 2 fails. We need to fix it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12670086">PIG-3478</key>
            <summary>Make StreamingUDF work for Hadoop 2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lbendig">Lorand Bendig</assignee>
                                    <reporter username="daijy">Daniel Dai</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Sep 2013 16:47:50 +0100</created>
                <updated>Fri, 21 Nov 2014 05:59:17 +0000</updated>
                            <resolved>Mon, 23 Jun 2014 00:36:32 +0100</resolved>
                                                    <fixVersion>0.14.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="13790582" author="jeremykarn" created="Wed, 9 Oct 2013 17:29:17 +0100"  >&lt;p&gt;Here&apos;s a patch I tested on a Hadoop 2.1.0 cluster.  I was able to run an example script and get the unit tests to pass but I wasn&apos;t able to run the e2e tests on the cluster to confirm that those are also fixed.&lt;/p&gt;</comment>
                            <comment id="13818623" author="cheolsoo" created="Sun, 10 Nov 2013 23:16:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeremykarn&quot; class=&quot;user-hover&quot; rel=&quot;jeremykarn&quot;&gt;Jeremy Karn&lt;/a&gt;, I ran e2e tests (StreamingPythonUDFs) on an EMR Hadoop 2.2 cluster and saw two issues as follows:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;NPE in StreamingUDF.java
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2013-11-10 22:32:19,694 FATAL [IPC Server handler 11 on 33809] org.apache.hadoop.mapred.TaskAttemptListenerImpl: Task: attempt_1383086282107_1892_m_000000_3 - exited : org.apache.pig.backend.executionengine.ExecException: ERROR 0: Exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; executing [POUserFunc (Name: POUserFunc(org.apache.pig.impl.builtin.StreamingUDF)[&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;] - scope-3 Operator Key: scope-3) children: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; at []]: java.lang.NullPointerException
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.PhysicalOperator.getNext(PhysicalOperator.java:338)
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POForEach.processPlan(POForEach.java:378)
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POForEach.getNextTuple(POForEach.java:298)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.runPipeline(PigGenericMapBase.java:282)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:277)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:64)
	at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:145)
	at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:775)
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:342)
	at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:162)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:415)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1491)
	at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:157)
Caused by: java.lang.NullPointerException
	at org.apache.pig.impl.builtin.StreamingUDF.ensureUserFileAvailable(StreamingUDF.java:249)
	at org.apache.pig.impl.builtin.StreamingUDF.constructCommand(StreamingUDF.java:218)
	at org.apache.pig.impl.builtin.StreamingUDF.startUdfController(StreamingUDF.java:163)
	at org.apache.pig.impl.builtin.StreamingUDF.initialize(StreamingUDF.java:156)
	at org.apache.pig.impl.builtin.StreamingUDF.exec(StreamingUDF.java:146)
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.POUserFunc.getNext(POUserFunc.java:330)
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.POUserFunc.getNextInteger(POUserFunc.java:379)
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.PhysicalOperator.getNext(PhysicalOperator.java:321)
	... 13 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;NPE is thrown from &lt;tt&gt;udfFileStream.close();&lt;/tt&gt; where udfFileStream is null.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;After fixing #1 by adding a null check, I ran into this error:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2013-11-10 23:00:51,402 FATAL [IPC Server handler 11 on 40139] org.apache.hadoop.mapred.TaskAttemptListenerImpl: Task: attempt_1383086282107_1905_m_000000_3 - exited : org.apache.pig.backend.executionengine.ExecException: ERROR 2078: Caught error from UDF: StreamingUDF [Could not create directory: /home/hadoop/.versions/2.2.0/logs/udfOutput]at org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.POUserFunc.getNext(POUserFunc.java:358)
at org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.POUserFunc.getNextInteger(POUserFunc.java:379)
at org.apache.pig.backend.hadoop.executionengine.physicalLayer.PhysicalOperator.getNext(PhysicalOperator.java:321)
at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POForEach.processPlan(POForEach.java:378)
at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POForEach.getNextTuple(POForEach.java:298)
at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.runPipeline(PigGenericMapBase.java:282)
at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:277)
at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:64)
at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:145)
at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:775)
at org.apache.hadoop.mapred.MapTask.run(MapTask.java:342)
at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:162)
at java.security.AccessController.doPrivileged(Native Method)
at javax.security.auth.Subject.doAs(Subject.java:415)
at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1491)
at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:157)
Caused by: java.io.IOException: Could not create directory: /home/hadoop/.versions/2.2.0/logs/udfOutput
at org.apache.pig.scripting.ScriptingOutputCapturer.getTaskLogDir(ScriptingOutputCapturer.java:104)
at org.apache.pig.scripting.ScriptingOutputCapturer.getStandardOutputRootWriteLocation(ScriptingOutputCapturer.java:86)
at org.apache.pig.impl.builtin.StreamingUDF.constructCommand(StreamingUDF.java:187)
at org.apache.pig.impl.builtin.StreamingUDF.startUdfController(StreamingUDF.java:163)
at org.apache.pig.impl.builtin.StreamingUDF.initialize(StreamingUDF.java:156)at org.apache.pig.impl.builtin.StreamingUDF.exec(StreamingUDF.java:146)
at org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.POUserFunc.getNext(POUserFunc.java:330)... 15 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Can you look into these failures? We should also enable &lt;tt&gt;StreamingPythonUDFs&lt;/tt&gt; tests in nightly.conf once they&apos;re fixed.&lt;/p&gt;</comment>
                            <comment id="13820393" author="rohini" created="Tue, 12 Nov 2013 19:55:46 +0000"  >&lt;p&gt;Cancelling patch till Cheolsoo&apos;s comments are addressed.&lt;/p&gt;</comment>
                            <comment id="13897111" author="russell.jurney" created="Mon, 10 Feb 2014 22:16:02 +0000"  >&lt;p&gt;Looking into this myself.&lt;/p&gt;</comment>
                            <comment id="13957008" author="prkommireddi" created="Tue, 1 Apr 2014 22:05:40 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=russell.jurney&quot; class=&quot;user-hover&quot; rel=&quot;russell.jurney&quot;&gt;Russell Jurney&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeremykarn&quot; class=&quot;user-hover&quot; rel=&quot;jeremykarn&quot;&gt;Jeremy Karn&lt;/a&gt; anyone looking into this?&lt;/p&gt;</comment>
                            <comment id="13957831" author="jeremykarn" created="Wed, 2 Apr 2014 17:13:32 +0100"  >&lt;p&gt;I probably won&apos;t get a chance to look at this in the next couple of weeks.  &lt;/p&gt;</comment>
                            <comment id="13958121" author="prkommireddi" created="Wed, 2 Apr 2014 21:14:18 +0100"  >&lt;p&gt;Thanks for getting back. I&apos;ve moved this to 0.13, we could possibly get it in by then.&lt;/p&gt;</comment>
                            <comment id="14015473" author="lbendig" created="Mon, 2 Jun 2014 16:49:12 +0100"  >&lt;p&gt;Adjustment of the initial patch: &lt;tt&gt;StreamingUDF#ensureUserFileAvailable&lt;/tt&gt; couldn&apos;t get the inputStream of the registered python script due to an additional slash in the file&apos;s path. Now I managed to run unit and e2e tests (local and cluster mode (pseudo-distributed)) successfully on Hadoop 2.2.0 and 2.4.0. &lt;/p&gt;</comment>
                            <comment id="14015549" author="cheolsoo" created="Mon, 2 Jun 2014 17:55:11 +0100"  >&lt;p&gt;This is great! I am running the tests to verify your fix.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aniket486&quot; class=&quot;user-hover&quot; rel=&quot;aniket486&quot;&gt;Aniket Mokashi&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;Daniel Dai&lt;/a&gt;, can we commit this into branch-0.13 if all the tests pass? I think this is an important bug fix.&lt;/p&gt;</comment>
                            <comment id="14015789" author="cheolsoo" created="Mon, 2 Jun 2014 20:38:28 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lbendig&quot; class=&quot;user-hover&quot; rel=&quot;lbendig&quot;&gt;Lorand Bendig&lt;/a&gt;, unfortunately, I am getting the following error while running the e2e tests-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.io.IOException: Could not create directory: /apps/hadoop/2.4.0/logs/udfOutput
        at org.apache.pig.scripting.ScriptingOutputCapturer.getTaskLogDir(ScriptingOutputCapturer.java:103)
        at org.apache.pig.scripting.ScriptingOutputCapturer.getStandardOutputRootWriteLocation(ScriptingOutputCapturer.java:85)
        at org.apache.pig.impl.builtin.StreamingUDF.constructCommand(StreamingUDF.java:186)
        at org.apache.pig.impl.builtin.StreamingUDF.startUdfController(StreamingUDF.java:163)
        at org.apache.pig.impl.builtin.StreamingUDF.initialize(StreamingUDF.java:156)
        at org.apache.pig.impl.builtin.StreamingUDF.exec(StreamingUDF.java:146)
        at org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.POUserFunc.getNext(POUserFunc.java:344)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The problem is that users don&apos;t always have write permissions to hadoop.log.dir &lt;tt&gt;/apps/hadoop/2.4.0/logs&lt;/tt&gt;. Shouldn&apos;t we write to the temp dir instead?&lt;/p&gt;</comment>
                            <comment id="14015837" author="jeremykarn" created="Mon, 2 Jun 2014 21:17:46 +0100"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lbendig&quot; class=&quot;user-hover&quot; rel=&quot;lbendig&quot;&gt;Lorand Bendig&lt;/a&gt;!  &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;, we originally chose the log directory because we wanted users to be able to view their udf output from the Task Tracker in the same place as the rest of the logs for that task.  Maybe it makes sense to fall back to temp dir if the user doesn&apos;t have permission to write to the log dir?  &lt;/p&gt;</comment>
                            <comment id="14015900" author="cheolsoo" created="Mon, 2 Jun 2014 22:12:09 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeremykarn&quot; class=&quot;user-hover&quot; rel=&quot;jeremykarn&quot;&gt;Jeremy Karn&lt;/a&gt;, that sounds reasonable to me. Thank you for the clarification.&lt;/p&gt;</comment>
                            <comment id="14016086" author="lbendig" created="Tue, 3 Jun 2014 01:33:00 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeremykarn&quot; class=&quot;user-hover&quot; rel=&quot;jeremykarn&quot;&gt;Jeremy Karn&lt;/a&gt; thanks for looking at this issue. I updated the patch so that hadoop.tmp.dir will be used if hadoop.log.dir is not writable.&lt;/p&gt;</comment>
                            <comment id="14040285" author="daijy" created="Sun, 22 Jun 2014 23:30:59 +0100"  >&lt;p&gt;+1, &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3478&quot; title=&quot;Make StreamingUDF work for Hadoop 2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3478&quot;&gt;&lt;del&gt;PIG-3478&lt;/del&gt;&lt;/a&gt;-3.patch works for me. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lbendig&quot; class=&quot;user-hover&quot; rel=&quot;lbendig&quot;&gt;Lorand Bendig&lt;/a&gt;, would you like to commit it?&lt;/p&gt;</comment>
                            <comment id="14040297" author="lbendig" created="Mon, 23 Jun 2014 00:19:45 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;Daniel Dai&lt;/a&gt;, thanks for checking it. Sure I will, but currently I&apos;m experiencing permission issues and can&apos;t commit. &lt;/p&gt;</comment>
                            <comment id="14040304" author="daijy" created="Mon, 23 Jun 2014 00:36:32 +0100"  >&lt;p&gt;Ok, let me commit it to trunk. Thanks Lorand!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12647916" name="PIG-3478-2.patch" size="15700" author="lbendig" created="Mon, 2 Jun 2014 16:49:12 +0100"/>
                            <attachment id="12648038" name="PIG-3478-3.patch" size="16351" author="lbendig" created="Tue, 3 Jun 2014 01:33:00 +0100"/>
                            <attachment id="12607597" name="PIG-3478.patch" size="13276" author="jeremykarn" created="Wed, 9 Oct 2013 17:28:40 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 9 Oct 2013 16:29:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>349916</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzi6g7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>350214</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>