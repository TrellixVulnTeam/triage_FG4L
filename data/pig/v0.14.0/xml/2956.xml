<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:58:29 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2956/PIG-2956.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2956] Invalid cache specification for some streaming statement</title>
                <link>https://issues.apache.org/jira/browse/PIG-2956</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Another category of failure in e2e tests, such as ComputeSpec_1, ComputeSpec_2, ComputeSpec_3, RaceConditions_1, RaceConditions_3, RaceConditions_4, RaceConditions_7, RaceConditions_8.&lt;/p&gt;

&lt;p&gt;Here is stack:&lt;br/&gt;
ERROR 6003: Invalid cache specification. File doesn&apos;t exist: C:/Program Files (x86)/GnuWin32/bin/head.exe&lt;/p&gt;

&lt;p&gt;org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobCreationException: ERROR 2017: Internal error creating job configuration.&lt;br/&gt;
at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.getJob(JobControlCompiler.java:723)&lt;br/&gt;
at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.compile(JobControlCompiler.java:258)&lt;br/&gt;
at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher.launchPig(MapReduceLauncher.java:151)&lt;br/&gt;
at org.apache.pig.PigServer.launchPlan(PigServer.java:1318)&lt;br/&gt;
at org.apache.pig.PigServer.executeCompiledLogicalPlan(PigServer.java:1303)&lt;br/&gt;
at org.apache.pig.PigServer.execute(PigServer.java:1293)&lt;br/&gt;
at org.apache.pig.PigServer.executeBatch(PigServer.java:364)&lt;br/&gt;
at org.apache.pig.tools.grunt.GruntParser.executeBatch(GruntParser.java:133)&lt;br/&gt;
at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:194)&lt;br/&gt;
at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:166)&lt;br/&gt;
at org.apache.pig.tools.grunt.Grunt.exec(Grunt.java:84)&lt;br/&gt;
at org.apache.pig.Main.run(Main.java:561)&lt;br/&gt;
at org.apache.pig.Main.main(Main.java:111)&lt;br/&gt;
Caused by: org.apache.pig.backend.executionengine.ExecException: ERROR 6003: Invalid cache specification. File doesn&apos;t exist: C:/Program Files (x86)/GnuWin32/bin/head.exe&lt;br/&gt;
at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.setupDistributedCache(JobControlCompiler.java:1151)&lt;br/&gt;
at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.setupDistributedCache(JobControlCompiler.java:1129)&lt;br/&gt;
at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.getJob(JobControlCompiler.java:447)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12610793">PIG-2956</key>
            <summary>Invalid cache specification for some streaming statement</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12597859">PIG-2793</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="daijy">Daniel Dai</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Oct 2012 07:52:24 +0100</created>
                <updated>Mon, 14 Oct 2013 17:46:34 +0100</updated>
                            <resolved>Fri, 31 May 2013 18:18:39 +0100</resolved>
                                                    <fixVersion>0.12.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13477484" author="dvryaboy" created="Wed, 17 Oct 2012 01:19:03 +0100"  >&lt;p&gt;Why not replace &quot;new URL(src.toString())&quot; with src.toURI() in the first place?&lt;/p&gt;</comment>
                            <comment id="13481074" author="daijy" created="Sun, 21 Oct 2012 22:23:52 +0100"  >&lt;p&gt;I did that before and hit exception in Linux (I forget the exception). So src.toURI() is only for Windows, for Linux, have to use new URL(src.toString()). I will post the Linux exception later.&lt;/p&gt;</comment>
                            <comment id="13489134" author="daijy" created="Thu, 1 Nov 2012 23:21:21 +0000"  >&lt;p&gt;Here is the failure using &quot;src.toURI()&quot; directly with a order by statement:&lt;br/&gt;
Message: java.io.FileNotFoundException: File does not exist: /tmp/temp-1510081022/tmp-1308657145#pigsample_1889145873_1351808882314&lt;br/&gt;
	at org.apache.hadoop.hdfs.DistributedFileSystem.getFileStatus(DistributedFileSystem.java:517)&lt;br/&gt;
	at org.apache.hadoop.filecache.DistributedCache.getFileStatus(DistributedCache.java:185)&lt;br/&gt;
	at org.apache.hadoop.filecache.TrackerDistributedCacheManager.determineTimestamps(TrackerDistributedCacheManager.java:721)&lt;br/&gt;
	at org.apache.hadoop.mapred.JobClient.copyAndConfigureFiles(JobClient.java:763)&lt;br/&gt;
	at org.apache.hadoop.mapred.JobClient.copyAndConfigureFiles(JobClient.java:655)&lt;br/&gt;
	at org.apache.hadoop.mapred.JobClient.access$300(JobClient.java:174)&lt;br/&gt;
	at org.apache.hadoop.mapred.JobClient$2.run(JobClient.java:865)&lt;br/&gt;
	at org.apache.hadoop.mapred.JobClient$2.run(JobClient.java:850)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
	at javax.security.auth.Subject.doAs(Subject.java:396)&lt;br/&gt;
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1121)&lt;br/&gt;
	at org.apache.hadoop.mapred.JobClient.submitJobInternal(JobClient.java:850)&lt;br/&gt;
	at org.apache.hadoop.mapred.JobClient.submitJob(JobClient.java:824)&lt;br/&gt;
	at org.apache.hadoop.mapred.jobcontrol.Job.submit(Job.java:378)&lt;br/&gt;
	at org.apache.hadoop.mapred.jobcontrol.JobControl.startReadyJobs(JobControl.java:247)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.apache.pig.backend.hadoop20.PigJobControl.mainLoopAction(PigJobControl.java:157)&lt;br/&gt;
	at org.apache.pig.backend.hadoop20.PigJobControl.run(PigJobControl.java:134)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:680)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher$1.run(MapReduceLauncher.java:257)&lt;/p&gt;

&lt;p&gt;src.toURI() does encode &quot;#&quot; character, and Hadoop on Linux have trouble finding the distributed cache item with &quot;#&quot; encoded. However, Windows is happy to take encoded &quot;#&quot; character, I am not sure why. And the original &quot;new URI(src.toString())&quot; fail if src contains &quot;:&quot; character. So the logic becomes:&lt;br/&gt;
1. On Linux, &quot;new URI(src.toString())&quot; always success, src never encoded, and DistributedCache is happy&lt;br/&gt;
2. On Windows, src contains &quot;:&quot;, &quot;new URI(src.toString())&quot; fail, src will be encoded using &quot;src.toUri()&quot;, and DistributedCache don&apos;t mind&lt;/p&gt;</comment>
                            <comment id="13489149" author="daijy" created="Thu, 1 Nov 2012 23:36:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2956&quot; title=&quot;Invalid cache specification for some streaming statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2956&quot;&gt;&lt;del&gt;PIG-2956&lt;/del&gt;&lt;/a&gt;-1_0.10.patch is the same patch for 0.10 branch.&lt;/p&gt;</comment>
                            <comment id="13500580" author="julienledem" created="Mon, 19 Nov 2012 19:52:13 +0000"  >&lt;p&gt;you should still catch exceptions that come out of toURI() and handle them in the same way the URI exception was handled before I think. Bad URI should still be handled.&lt;/p&gt;</comment>
                            <comment id="13535335" author="julienledem" created="Tue, 18 Dec 2012 21:16:45 +0000"  >&lt;p&gt;Daniel? any update on this?&lt;/p&gt;</comment>
                            <comment id="13554435" author="alangates" created="Tue, 15 Jan 2013 22:09:15 +0000"  >&lt;p&gt;Canceling patch pending addressing Julien&apos;s comments.&lt;/p&gt;</comment>
                            <comment id="13658788" author="daijy" created="Wed, 15 May 2013 21:44:03 +0100"  >&lt;p&gt;Dive deeper into the issue. Here is what I find:&lt;br/&gt;
1. The problem with &quot;new URI(src.toString())&quot;: It is not compatible with Windows path style, colon and space will result an exception&lt;/p&gt;

&lt;p&gt;2. The problem with &quot;src.toUri()&quot;: It encodes &quot;#&quot; character. Hadoop will use URI.getFragment() to get the symlink from a uri, getFragment only search for &quot;#&quot; character not the encoded one&lt;/p&gt;

&lt;p&gt;I attach a new patch, which takes out the symlink part, use &quot;src.toUri()&quot; to encode the rest, then append the symlink. Tested both Windows and Linux works.&lt;/p&gt;</comment>
                            <comment id="13669566" author="alangates" created="Wed, 29 May 2013 19:50:50 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13671665" author="daijy" created="Fri, 31 May 2013 18:18:39 +0100"  >&lt;p&gt;Patch committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12548201" name="PIG-2956-1.patch" size="1053" author="daijy" created="Mon, 8 Oct 2012 07:53:25 +0100"/>
                            <attachment id="12551790" name="PIG-2956-1_0.10.patch" size="938" author="daijy" created="Thu, 1 Nov 2012 23:36:39 +0000"/>
                            <attachment id="12583366" name="PIG-2956-2.patch" size="3087" author="daijy" created="Wed, 15 May 2013 21:44:03 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 17 Oct 2012 00:19:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245446</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy04wv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34612</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>