<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:58:35 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1022/PIG-1022.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1022] optimizer pushes filter before the foreach that generates column used by filter</title>
                <link>https://issues.apache.org/jira/browse/PIG-1022</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;grunt&amp;gt; l = load &apos;students.txt&apos; using PigStorage() as (name:chararray, gender:chararray, age:chararray, score:chararray);&lt;br/&gt;
grunt&amp;gt; f = foreach l generate name, gender, age,score, &apos;200&apos;  as gid:chararray;&lt;br/&gt;
grunt&amp;gt; g = group f by (name, gid);&lt;br/&gt;
grunt&amp;gt; f2 = foreach g generate group.name as name: chararray, group.gid as gid: chararray;&lt;br/&gt;
grunt&amp;gt; filt = filter f2 by gid == &apos;200&apos;;&lt;br/&gt;
grunt&amp;gt; explain filt;&lt;/p&gt;

&lt;p&gt;In the plan generated filt is pushed up after the load and before the first foreach, even though the filter is on gid which is generated in first foreach.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12438102">PIG-1022</key>
            <summary>optimizer pushes filter before the foreach that generates column used by filter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="thejas">Thejas M Nair</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Oct 2009 17:25:16 +0100</created>
                <updated>Fri, 14 May 2010 07:45:48 +0100</updated>
                            <resolved>Tue, 1 Dec 2009 18:34:01 +0000</resolved>
                                    <version>0.4.0</version>
                                    <fixVersion>0.7.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12765612" author="thejas" created="Wed, 14 Oct 2009 17:27:40 +0100"  >&lt;p&gt;$&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
grunt&amp;gt; explain filt;
#-----------------------------------------------
# Logical Plan:
#-----------------------------------------------

Store 1-1162 Schema: {name: chararray,gid: chararray} Type: Unknown
|
|---ForEach 1-1148 Schema: {name: chararray,gid: chararray} Type: bag
    |   |
    |   Project 1-1144 Projections: [0] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: name: chararray Type: chararray
    |   Input: Project 1-1145 Projections: [0] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;|
    |   |---Project 1-1145 Projections: [0] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: group: tuple({name: chararray,gid: chararray}) Type: tuple
    |       Input: CoGroup 1-1138
    |   |
    |   Project 1-1146 Projections: [1] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: gid: chararray Type: chararray
    |   Input: Project 1-1147 Projections: [0] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;|
    |   |---Project 1-1147 Projections: [0] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: group: tuple({name: chararray,gid: chararray}) Type: tuple
    |       Input: CoGroup 1-1138
    |
    |---CoGroup 1-1138 Schema: {group: (name: chararray,gid: chararray),f: {name: chararray,gender: chararray,age: chararray,score: chararray,gid: chararray}} Type: bag
        |   |
        |   Project 1-1136 Projections: [0] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: name: chararray Type: chararray
        |   Input: ForEach 1-1135
        |   |
        |   Project 1-1137 Projections: [4] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: gid: chararray Type: chararray
        |   Input: ForEach 1-1135
        |
        |---ForEach 1-1135 Schema: {name: chararray,gender: chararray,age: chararray,score: chararray,gid: chararray} Type: bag
            |   |
            |   Project 1-1130 Projections: [0] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: name: chararray Type: chararray
            |   Input: Filter 1-1152
            |   |
            |   Project 1-1131 Projections: [1] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: gender: chararray Type: chararray
            |   Input: Filter 1-1152
            |   |
            |   Project 1-1132 Projections: [2] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: age: chararray Type: chararray
            |   Input: Filter 1-1152
            |   |
            |   Project 1-1133 Projections: [3] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: score: chararray Type: chararray
            |   Input: Filter 1-1152
            |   |
            |   Const 1-1134( 200 ) FieldSchema: chararray Type: chararray
            |
            |---Filter 1-1152 Schema: {name: chararray,gender: chararray,age: chararray,score: chararray} Type: bag
                |   |
                |   Equal 1-1151 FieldSchema: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; Type: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;
                |   |
                |   |---Project 1-1149 Projections: [0] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: name: chararray Type: chararray
                |   |   Input: ForEach 1-1161
                |   |
                |   |---Const 1-1150( 200 ) FieldSchema: chararray Type: chararray
                |
                |---ForEach 1-1161 Schema: {name: chararray,gender: chararray,age: chararray,score: chararray} Type: bag
                    |   |
                    |   Cast 1-1154 FieldSchema: name: chararray Type: chararray
                    |   |
                    |   |---Project 1-1153 Projections: [0] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: name: bytearray Type: bytearray
                    |       Input: Load 1-1123
                    |   |
                    |   Cast 1-1156 FieldSchema: gender: chararray Type: chararray
                    |   |
                    |   |---Project 1-1155 Projections: [1] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: gender: bytearray Type: bytearray
                    |       Input: Load 1-1123
                    |   |
                    |   Cast 1-1158 FieldSchema: age: chararray Type: chararray
                    |   |
                    |   |---Project 1-1157 Projections: [2] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: age: bytearray Type: bytearray
                    |       Input: Load 1-1123
                    |   |
                    |   Cast 1-1160 FieldSchema: score: chararray Type: chararray
                    |   |
                    |   |---Project 1-1159 Projections: [3] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: score: bytearray Type: bytearray
                    |       Input: Load 1-1123
                    |
                    |---Load 1-1123 Schema: {name: bytearray,gender: bytearray,age: bytearray,score: bytearray} Type: bag

$&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12765682" author="daijy" created="Wed, 14 Oct 2009 19:35:51 +0100"  >&lt;p&gt;Actually we cannot push the filter even before f2. Since we do not keep track of the source of data inside tuple, so gid should be treated as a generated field of f2. However, projection map of f2 give us the wrong result that gid is a directly mapped field of group (which is a tuple (name, gid)), and this triggers all the subsequences. The fix for this problem is to modify the projection map generation logic for the mapped field. &lt;/p&gt;

&lt;p&gt;Santhosh, do you have any comment?&lt;/p&gt;</comment>
                            <comment id="12766294" author="daijy" created="Thu, 15 Oct 2009 23:29:06 +0100"  >&lt;p&gt;Seems &quot;project fixer up&quot; require nested field to be counted as mapped fields. And for pushupfilter, nested field should not be counted as a mapped fields. We need to clarify the definition of projectMap.mappedFields first. &lt;/p&gt;</comment>
                            <comment id="12768035" author="daijy" created="Wed, 21 Oct 2009 01:46:56 +0100"  >&lt;p&gt;Attach the patch. Thanks Santhosh for helping analyze the problem.&lt;/p&gt;</comment>
                            <comment id="12768120" author="hadoopqa" created="Wed, 21 Oct 2009 08:27:35 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12422754/PIG-1022-1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12422754/PIG-1022-1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 827829.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/104/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/104/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/104/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/104/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/104/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/104/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12768312" author="daijy" created="Wed, 21 Oct 2009 17:24:59 +0100"  >&lt;p&gt;core tests pass manually&lt;/p&gt;</comment>
                            <comment id="12770831" author="hadoopqa" created="Wed, 28 Oct 2009 08:38:25 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12422754/PIG-1022-1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12422754/PIG-1022-1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 830335.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/119/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/119/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/119/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/119/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/119/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/119/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12771157" author="daijy" created="Wed, 28 Oct 2009 22:20:24 +0000"  >&lt;p&gt;The core test failure is temporal due to &quot;port conflict&quot;&lt;/p&gt;</comment>
                            <comment id="12784279" author="alangates" created="Tue, 1 Dec 2009 16:22:58 +0000"  >&lt;p&gt;+1, patch looks good.  I also reran the unit tests since it had been a while since this patch was posted, and they all still pass.&lt;/p&gt;</comment>
                            <comment id="12784326" author="alangates" created="Tue, 1 Dec 2009 18:34:01 +0000"  >&lt;p&gt;Checked that patch in for Daniel since I&apos;d already applied it and tested it.&lt;/p&gt;</comment>
                            <comment id="12784582" author="alangates" created="Wed, 2 Dec 2009 01:47:59 +0000"  >&lt;p&gt;Patch checked into 0.6 branch as well.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12422754" name="PIG-1022-1.patch" size="4778" author="daijy" created="Wed, 21 Oct 2009 01:46:56 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 14 Oct 2009 18:35:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164552</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyallr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95811</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>