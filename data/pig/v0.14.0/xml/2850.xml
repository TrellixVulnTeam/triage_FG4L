<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:52:51 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2850/PIG-2850.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2850] Pig should support loading macro files as resources stored in JAR files</title>
                <link>https://issues.apache.org/jira/browse/PIG-2850</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;A file containing macros can be imported in pig like so:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
IMPORT &apos;some_path/my_macros.pig&apos;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It would be convenient if a macro file could be imported from a registered JAR as well.  This would make it easier to distribute them.  One could package a set of UDFs and macros in a single JAR.  Once the JAR is registered any of the UDFs or macros can be used once.&lt;/p&gt;

&lt;p&gt;For example, support that &lt;tt&gt;some_path/my_macros.pig&lt;/tt&gt; has been packaged in a JAR named &lt;tt&gt;my_macros.jar&lt;/tt&gt;.  The above code then becomes &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
REGISTER my_macros.jar;
IMPORT &apos;some_path/my_macros.pig&apos;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Pig would first check if the file is found at the path &lt;tt&gt;some_path/my_macros.pig&lt;/tt&gt;, and failing that it would attempt to load a resource by that name.  Since the JAR is registered it will find it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12600740">PIG-2850</key>
            <summary>Pig should support loading macro files as resources stored in JAR files</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="matterhayes">Matthew Hayes</assignee>
                                    <reporter username="matterhayes">Matthew Hayes</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Jul 2012 23:25:27 +0100</created>
                <updated>Fri, 22 Feb 2013 04:53:37 +0000</updated>
                            <resolved>Fri, 24 Aug 2012 03:57:54 +0100</resolved>
                                                    <fixVersion>0.11</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13425323" author="matterhayes" created="Mon, 30 Jul 2012 23:26:18 +0100"  >&lt;p&gt;Sample implementation with unit test&lt;/p&gt;</comment>
                            <comment id="13425974" author="dvryaboy" created="Tue, 31 Jul 2012 19:10:03 +0100"  >&lt;p&gt;Nice!&lt;br/&gt;
couple of quick notes: &lt;/p&gt;

&lt;p&gt;most of the LOG.info calls should be LOG.debug&lt;/p&gt;

&lt;p&gt;OutputStream should probably be buffered&lt;/p&gt;

&lt;p&gt;The test involves creating a jar, writing it out to FS, and registering it.. how about we just check in a jar in test/resources ?&lt;/p&gt;

&lt;p&gt;It&apos;s a little weird to be writing out to a temp file.. would be cleaner to allow pig to pick up from a jar without intermediate storage. Ideas on how to do that?&lt;/p&gt;</comment>
                            <comment id="13426072" author="matterhayes" created="Tue, 31 Jul 2012 21:00:30 +0100"  >&lt;p&gt;Thanks for the feedback &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Replaced LOG.info with LOG.debug.&lt;br/&gt;
Wrapped BufferedOutputStream around stream.&lt;/p&gt;

&lt;p&gt;For the test, I like creating the JAR in the test so the test is totally self contained.  You don&apos;t need to refer to a file in a separate JAR to understand it.  What do you think?&lt;/p&gt;

&lt;p&gt;Regarding writing to a temp file, I did it this way to mimic what happens with FileLocalizer.  Other parts of QueryParserDriver are assuming the macro file is local and I didn&apos;t want to make significant changes.  In this new diff I&apos;ve moved the code to FileLocalizer.fetchResource(), which seems cleaner.&lt;/p&gt;</comment>
                            <comment id="13440488" author="matterhayes" created="Thu, 23 Aug 2012 18:56:24 +0100"  >&lt;p&gt;Is there anything else necessary for me to change?&lt;/p&gt;</comment>
                            <comment id="13440628" author="dvryaboy" created="Thu, 23 Aug 2012 21:31:06 +0100"  >&lt;p&gt;Sorry, didn&apos;t notice you updated. Will review.&lt;/p&gt;</comment>
                            <comment id="13440764" author="dvryaboy" created="Fri, 24 Aug 2012 00:28:32 +0100"  >&lt;p&gt;Looks good. In fetchResource, you check if resourceStream is not null; if it is null, the whole function will return null. I suspect that would be surprising and cause NPEs downstream. Perhaps an exception-throwing assert would be better here? Is there a legit reason for this function to ever return null instead of throwing?&lt;/p&gt;</comment>
                            <comment id="13440824" author="matterhayes" created="Fri, 24 Aug 2012 01:26:22 +0100"  >&lt;p&gt;The function could legitimately return null if the macro file is not found as a file or a resource.  I thought an error about a resource not being found could be cryptic if the user isn&apos;t expecting this behavior when importing the macro file.  So I checked for null in getMacroFile after attempting to fetch as a resource and then threw and exception about the file not being found.&lt;/p&gt;

&lt;p&gt;Alternatively I could throw a ResourceNotFoundException in fetchResource and catch this in getMacroFile.  See diff #3 where I am doing this instead.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13440853" author="dvryaboy" created="Fri, 24 Aug 2012 02:25:43 +0100"  >&lt;p&gt;Perfect, thanks for the explanation. I like patch 3, will commit.&lt;br/&gt;
Sorry about the slow turnaround, feel free to ping if there are no comments for more than a few days next time.. we shouldn&apos;t let tickets languish like that.&lt;/p&gt;</comment>
                            <comment id="13440857" author="dvryaboy" created="Fri, 24 Aug 2012 02:27:55 +0100"  >&lt;p&gt;Patch isn&apos;t applying cleanly. I&apos;ll remediate and post rebased patch.&lt;/p&gt;</comment>
                            <comment id="13440862" author="dvryaboy" created="Fri, 24 Aug 2012 02:33:09 +0100"  >&lt;p&gt;Ok.. it&apos;s actually a legit conflict, not just a merge issue. This code was changed in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2866&quot; title=&quot;PigServer fails with macros without a script file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2866&quot;&gt;&lt;del&gt;PIG-2866&lt;/del&gt;&lt;/a&gt;. I&apos;ll ask Bill to take a look.&lt;/p&gt;</comment>
                            <comment id="13440876" author="matterhayes" created="Fri, 24 Aug 2012 02:59:05 +0100"  >&lt;p&gt;Oops I should have done an svn up.  I resolved the conflicts and submitted patch #4.&lt;/p&gt;</comment>
                            <comment id="13440890" author="dvryaboy" created="Fri, 24 Aug 2012 03:41:46 +0100"  >&lt;p&gt;Fails to compile. Did you forget to add ResourceNotFoundException ?&lt;/p&gt;</comment>
                            <comment id="13440894" author="matterhayes" created="Fri, 24 Aug 2012 03:49:51 +0100"  >&lt;p&gt;yep i did, sorry, now fixed&lt;/p&gt;</comment>
                            <comment id="13440900" author="dvryaboy" created="Fri, 24 Aug 2012 03:57:54 +0100"  >&lt;p&gt;Committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12605414">PIG-2896</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12538440" name="import_macros_from_jar.diff" size="6857" author="matterhayes" created="Mon, 30 Jul 2012 23:26:18 +0100"/>
                            <attachment id="12538604" name="import_macros_from_jar_2.diff" size="7766" author="matterhayes" created="Tue, 31 Jul 2012 21:00:30 +0100"/>
                            <attachment id="12542218" name="import_macros_from_jar_3.diff" size="8470" author="matterhayes" created="Fri, 24 Aug 2012 01:22:59 +0100"/>
                            <attachment id="12542228" name="import_macros_from_jar_4.diff" size="8686" author="matterhayes" created="Fri, 24 Aug 2012 02:58:44 +0100"/>
                            <attachment id="12542233" name="import_macros_from_jar_5.diff" size="9385" author="matterhayes" created="Fri, 24 Aug 2012 03:49:51 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 31 Jul 2012 18:10:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256454</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyb0if:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98226</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>