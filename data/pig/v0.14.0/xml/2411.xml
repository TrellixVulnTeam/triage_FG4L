<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:56:13 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2411/PIG-2411.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2411] AvroStorage UDF in PiggyBank fails to STORE a bag of single-field tuples as Avro arrays</title>
                <link>https://issues.apache.org/jira/browse/PIG-2411</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;This patch is a fix for a bug for persisting bags of tuples via AvroStorage.&lt;/p&gt;

&lt;p&gt;The script that alerted me to a bug is:&lt;/p&gt;

&lt;p&gt;messages = LOAD &apos;/tmp/messages.avro&apos; USING AvroStorage();&lt;br/&gt;
user_groups = GROUP messages by user_id;&lt;br/&gt;
per_user = FOREACH user_groups &lt;/p&gt;
{ sorted = ORDER messages BY message_id DESC; GENERATE group AS user_id, sorted AS messages; }
&lt;p&gt;DESCRIBE per_user&lt;br/&gt;
&amp;gt; per_user: {user_id: int,messages: {(message_id: int,topic: chararray,user_id: int)}}&lt;br/&gt;
STORE per_user INTO &apos;/tmp/per_user.avro&apos; USING AvroStorage();&lt;/p&gt;

&lt;p&gt;The error is:&lt;/p&gt;

&lt;p&gt;Pig Stack Trace&lt;br/&gt;
---------------&lt;br/&gt;
ERROR 1002: Unable to store alias per_user&lt;/p&gt;

&lt;p&gt;org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1002: Unable to store alias per_user&lt;br/&gt;
at org.apache.pig.PigServer$Graph.registerQuery(PigServer.java:1596)&lt;br/&gt;
at org.apache.pig.PigServer.registerQuery(PigServer.java:584)&lt;br/&gt;
at org.apache.pig.tools.grunt.GruntParser.processPig(GruntParser.java:942)&lt;br/&gt;
at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:386)&lt;br/&gt;
at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:188)&lt;br/&gt;
at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:164)&lt;br/&gt;
at org.apache.pig.tools.grunt.Grunt.run(Grunt.java:67)&lt;br/&gt;
at org.apache.pig.Main.run(Main.java:487)&lt;br/&gt;
at org.apache.pig.Main.main(Main.java:108)&lt;br/&gt;
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
at org.apache.hadoop.util.RunJar.main(RunJar.java:156)&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.isTupleWrapper(AvroStorageUtils.java:327)&lt;br/&gt;
at org.apache.pig.piggybank.storage.avro.PigSchema2Avro.convert(PigSchema2Avro.java:82)&lt;br/&gt;
at org.apache.pig.piggybank.storage.avro.PigSchema2Avro.convert(PigSchema2Avro.java:105)&lt;br/&gt;
at org.apache.pig.piggybank.storage.avro.PigSchema2Avro.convertRecord(PigSchema2Avro.java:151)&lt;br/&gt;
at org.apache.pig.piggybank.storage.avro.PigSchema2Avro.convert(PigSchema2Avro.java:62)&lt;br/&gt;
at org.apache.pig.piggybank.storage.avro.AvroStorage.checkSchema(AvroStorage.java:502)&lt;br/&gt;
at org.apache.pig.newplan.logical.rules.InputOutputFileValidator$InputOutputFileVisitor.visit(InputOutputFileValidator.java:65)&lt;br/&gt;
at org.apache.pig.newplan.logical.relational.LOStore.accept(LOStore.java:77)&lt;br/&gt;
at org.apache.pig.newplan.DepthFirstWalker.depthFirst(DepthFirstWalker.java:64)&lt;br/&gt;
at org.apache.pig.newplan.DepthFirstWalker.depthFirst(DepthFirstWalker.java:66)&lt;br/&gt;
at org.apache.pig.newplan.DepthFirstWalker.depthFirst(DepthFirstWalker.java:66)&lt;br/&gt;
at org.apache.pig.newplan.DepthFirstWalker.depthFirst(DepthFirstWalker.java:66)&lt;br/&gt;
at org.apache.pig.newplan.DepthFirstWalker.depthFirst(DepthFirstWalker.java:66)&lt;br/&gt;
at org.apache.pig.newplan.DepthFirstWalker.walk(DepthFirstWalker.java:53)&lt;br/&gt;
at org.apache.pig.newplan.PlanVisitor.visit(PlanVisitor.java:50)&lt;br/&gt;
at org.apache.pig.newplan.logical.rules.InputOutputFileValidator.validate(InputOutputFileValidator.java:45)&lt;br/&gt;
at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.compile(HExecutionEngine.java:292)&lt;br/&gt;
at org.apache.pig.PigServer.compilePp(PigServer.java:1360)&lt;br/&gt;
at org.apache.pig.PigServer.executeCompiledLogicalPlan(PigServer.java:1297)&lt;br/&gt;
at org.apache.pig.PigServer.execute(PigServer.java:1286)&lt;br/&gt;
at org.apache.pig.PigServer.access$400(PigServer.java:125)&lt;br/&gt;
at org.apache.pig.PigServer$Graph.registerQuery(PigServer.java:1591)&lt;br/&gt;
... 13 more&lt;/p&gt;</description>
                <environment>&lt;p&gt;Mac OS X 10.6.8 in local mode&lt;/p&gt;</environment>
        <key id="12534278">PIG-2411</key>
            <summary>AvroStorage UDF in PiggyBank fails to STORE a bag of single-field tuples as Avro arrays</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="russell.jurney">Russell Jurney</assignee>
                                    <reporter username="russell.jurney">Russell Jurney</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Wed, 7 Dec 2011 23:46:48 +0000</created>
                <updated>Fri, 22 Jun 2012 04:36:24 +0100</updated>
                            <resolved>Sat, 17 Mar 2012 01:19:47 +0000</resolved>
                                    <version>0.9.0</version>
                    <version>0.9.1</version>
                    <version>0.9.2</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>piggybank</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <timeoriginalestimate seconds="21600">6h</timeoriginalestimate>
                            <timeestimate seconds="21600">6h</timeestimate>
                                        <comments>
                            <comment id="13164846" author="russell.jurney" created="Wed, 7 Dec 2011 23:47:25 +0000"  >&lt;p&gt;Patch attached.&lt;/p&gt;</comment>
                            <comment id="13164847" author="russell.jurney" created="Wed, 7 Dec 2011 23:48:07 +0000"  >&lt;p&gt;See also &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1748&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/PIG-1748&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13185289" author="daijy" created="Thu, 12 Jan 2012 22:12:27 +0000"  >&lt;p&gt;Hi, Russell,&lt;br/&gt;
Do you still want to get it into 0.9.2? If so, can you add a test to your patch? Or if you think existing tests already cover it, can you describe it?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13186012" author="daijy" created="Sat, 14 Jan 2012 00:12:16 +0000"  >&lt;p&gt;Unlink to 0.9.2 since it&apos;s too late to get in. Change fix version to 0.10&lt;/p&gt;</comment>
                            <comment id="13218822" author="russell.jurney" created="Wed, 29 Feb 2012 01:48:27 +0000"  >&lt;p&gt;This now works in my branch of Pig on github, and includes unit tests, input data and expected data in Avro.  See: &lt;a href=&quot;https://github.com/rjurney/pig/tree/branch-0.9&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/rjurney/pig/tree/branch-0.9&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Committer: please get with me about sorting out this mess.&lt;/p&gt;</comment>
                            <comment id="13219004" author="russell.jurney" created="Wed, 29 Feb 2012 08:54:44 +0000"  >&lt;p&gt;Started over.  The fix is here: &lt;a href=&quot;https://github.com/rjurney/pig/commit/47811554beeabed433a3cb7942418ab1d354cb3b&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/rjurney/pig/commit/47811554beeabed433a3cb7942418ab1d354cb3b&lt;/a&gt;&lt;br/&gt;
The test is here: &lt;a href=&quot;https://github.com/rjurney/pig/commit/6308b04171af4de5d66aa359ee12227674f09e34&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/rjurney/pig/commit/6308b04171af4de5d66aa359ee12227674f09e34&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13219007" author="russell.jurney" created="Wed, 29 Feb 2012 08:59:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/pig/pull/2&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/pig/pull/2&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13231780" author="daijy" created="Sat, 17 Mar 2012 01:15:02 +0000"  >&lt;p&gt;Attach the patch from Russell&apos;s github.&lt;/p&gt;</comment>
                            <comment id="13231783" author="daijy" created="Sat, 17 Mar 2012 01:19:47 +0000"  >&lt;p&gt;Patch committed to 0.10/trunk. Thanks Russell!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12518763" name="PIG-2411-1.patch" size="3350" author="daijy" created="Sat, 17 Mar 2012 01:15:02 +0000"/>
                            <attachment id="12506541" name="avrobug.patch" size="1116" author="russell.jurney" created="Wed, 7 Dec 2011 23:47:25 +0000"/>
                            <attachment id="12518764" name="messages.avro" size="263" author="daijy" created="Sat, 17 Mar 2012 01:15:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 12 Jan 2012 22:12:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>220000</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyax3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97672</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>avro udf piggybank pig storage</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>