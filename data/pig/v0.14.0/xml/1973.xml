<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:49:54 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1973/PIG-1973.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1973] UDFContext.getUDFContext usage of ThreadLocal pattern is not typical</title>
                <link>https://issues.apache.org/jira/browse/PIG-1973</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;this is probably isn&apos;t manifesting anywhere, but it&apos;s an incorrect use of the ThreadLocal pattern.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12503588">PIG-1973</key>
            <summary>UDFContext.getUDFContext usage of ThreadLocal pattern is not typical</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="woody.anderson@gmail.com">Woody Anderson</assignee>
                                    <reporter username="woody.anderson@gmail.com">Woody Anderson</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Apr 2011 05:58:38 +0100</created>
                <updated>Mon, 18 Jul 2011 16:25:32 +0100</updated>
                            <resolved>Mon, 18 Jul 2011 16:25:32 +0100</resolved>
                                    <version>0.8.0</version>
                    <version>0.9.0</version>
                                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13016693" author="woody.anderson@gmail.com" created="Thu, 7 Apr 2011 05:59:39 +0100"  >&lt;p&gt;use the initialValue method of ThreadLocal, which is how to correctly handle lazy initialization. &lt;/p&gt;</comment>
                            <comment id="13022373" author="rding" created="Wed, 20 Apr 2011 22:13:30 +0100"  >&lt;p&gt;I agree that this is a better usage idiom. But the initialValue method is invoked the first time a thread accesses the ThreadLocal variable with the get method, so the outcomes are the same. &lt;/p&gt;</comment>
                            <comment id="13022584" author="woody.anderson@gmail.com" created="Thu, 21 Apr 2011 01:54:09 +0100"  >&lt;p&gt;incorrect.&lt;/p&gt;

&lt;p&gt;initialValue is invoked when get() is first called. However, in the old code, initialValue returns null b/c it was not overridden.&lt;br/&gt;
thus, if 2 threads call getUDFContext() at the same time they may get 2 different UDFContext objects, b/c the method &lt;br/&gt;
does an unprotected comparison/set check:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; UDFContext getUDFContext() {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tss.get() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            UDFContext ctx = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; UDFContext();
            tss.set(ctx);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; tss.get();
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;this is CLASSIC race condition.&lt;/p&gt;</comment>
                            <comment id="13022939" author="woody.anderson@gmail.com" created="Thu, 21 Apr 2011 22:59:23 +0100"  >&lt;p&gt;ok. i agree. it&apos;s not a bug.&lt;br/&gt;
though, i still find it misleading code, in that it doesn&apos;t utilize the easy concise form, and at least to me &quot;looks wrong&quot; on 1st and second inspection.&lt;/p&gt;</comment>
                            <comment id="13066258" author="alangates" created="Fri, 15 Jul 2011 23:21:14 +0100"  >&lt;p&gt;Marking as submitpatch so we can get this reviewed and committed.&lt;/p&gt;</comment>
                            <comment id="13066796" author="thejas" created="Mon, 18 Jul 2011 07:13:40 +0100"  >&lt;p&gt;Patch looks good.&lt;br/&gt;
I have re-generated the patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1973&quot; title=&quot;UDFContext.getUDFContext usage of ThreadLocal pattern is not typical&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1973&quot;&gt;&lt;del&gt;PIG-1973&lt;/del&gt;&lt;/a&gt;.1.patch) with latest svn trunk. Running run test-patch and unit tests.&lt;/p&gt;</comment>
                            <comment id="13067079" author="thejas" created="Mon, 18 Jul 2011 16:24:16 +0100"  >&lt;p&gt;Updating the summary to indicate that this is a code improvement, but not a bug.&lt;/p&gt;</comment>
                            <comment id="13067082" author="thejas" created="Mon, 18 Jul 2011 16:25:32 +0100"  >&lt;p&gt;+1 &lt;br/&gt;
Patch committed to trunk.&lt;br/&gt;
Thanks Woody!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12475665" name="1973.patch" size="1075" author="woody.anderson@gmail.com" created="Thu, 7 Apr 2011 05:59:39 +0100"/>
                            <attachment id="12486792" name="PIG-1973.1.patch" size="1918" author="thejas" created="Mon, 18 Jul 2011 07:13:40 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 20 Apr 2011 21:13:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>67762</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyautr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97305</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>