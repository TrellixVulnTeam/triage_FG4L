<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:54:38 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-795/PIG-795.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-795] Command that selects a random sample of the rows, similar to LIMIT</title>
                <link>https://issues.apache.org/jira/browse/PIG-795</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;When working with very large data sets (imagine that!), running a pig script can take time. It may be useful to run on a small subset of the data in some situations (eg: debugging / testing, or to get fast results even if less accurate.) &lt;/p&gt;

&lt;p&gt;The command &quot;LIMIT N&quot; selects the first N rows of the data, but these are not necessarily randomzed. A command &quot;SAMPLE X&quot; would retain the row only with the probability x%.&lt;/p&gt;

&lt;p&gt;Note: it is possible to implement this feature with FILTER BY and an UDF, but so is LIMIT, and limit is built-in.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12424357">PIG-795</key>
            <summary>Command that selects a random sample of the rows, similar to LIMIT</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ericg">Eric Gaudet</assignee>
                                    <reporter username="ericg">Eric Gaudet</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 May 2009 00:16:20 +0100</created>
                <updated>Thu, 25 Mar 2010 00:12:46 +0000</updated>
                            <resolved>Mon, 4 May 2009 21:57:47 +0100</resolved>
                                                    <fixVersion>0.3.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12704844" author="ericg" created="Fri, 1 May 2009 00:23:23 +0100"  >&lt;p&gt;This patch implements the SAMPLE command. It basically add a random sample mode to the LIMIT class. &lt;/p&gt;

&lt;p&gt;The syntax is like LIMIT: &quot;a = SAMPLE x&quot;, where x is an integer and 0&amp;lt;=x&amp;lt;=100. Each row will be selected if rand()&amp;lt;(x/100).&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;p&gt;    a = LOAD &apos;mybigdata&apos;&lt;br/&gt;
    b = SAMPLE 5&lt;br/&gt;
    ...&lt;/p&gt;

&lt;p&gt;will select 5% of the data.&lt;/p&gt;
</comment>
                            <comment id="12705037" author="alangates" created="Fri, 1 May 2009 17:24:00 +0100"  >&lt;p&gt;Eric,&lt;/p&gt;

&lt;p&gt;Thanks for the patch.  I agree this is a feature that people will find useful.  I have a few questions and comments:&lt;/p&gt;

&lt;p&gt;1) Is 1% the minimum sample size people will want to work with?  Given that data in the grid can be on the order of terabytes, I can see people wanting a 0.1% sample, or even 0.01% sample.  Maybe that&apos;s too hard to specify nicely in the syntax, or maybe people will be happy with 1% minimum.  I&apos;m not sure, but it&apos;s worth thinking about.&lt;/p&gt;

&lt;p&gt;2) Sample and limit aren&apos;t really related, so implementing this in limit seems artificial.  Could it instead be implemented as a filter with a random function?  So the grammar production would look like:&lt;/p&gt;

&lt;p&gt;X = SAMPLE Y a% =&amp;gt; X = FILTER Y BY a &amp;lt; RANDOM();&lt;/p&gt;

&lt;p&gt;with RANDOM being a function you added to return a random number.&lt;/p&gt;

&lt;p&gt;The advantage of this is we would hope in the future to push filter operators down into the load functions themselves.  intelligent load functions could then take this filter and not even deserialize a record until it decided whether it was going to be kept or not.&lt;/p&gt;

&lt;p&gt;3) The patch should include unit tests.&lt;/p&gt;</comment>
                            <comment id="12705072" author="ericg" created="Fri, 1 May 2009 18:40:16 +0100"  >&lt;p&gt;Thanks for your feedback. (BTW, should these issues be discussed in a different place?)&lt;/p&gt;

&lt;p&gt;Here&apos;s my comments:&lt;/p&gt;

&lt;p&gt;1) I agree that the 1% minimum looks arbitrary and annoying, but I decided to keep it like this for several reasons. Most importantly, I didn&apos;t want to disturb the syntax of LIMIT, which expects an integer. Secondly, 1% is a reasonable minimum if you want a statistically significant result. And finally, you can work around the limitation by adding a 2nd level of sample (or more): b = SAMPLE a 1; c = SAMPLE b 1;   gives you 0.01%.&lt;/p&gt;

&lt;p&gt;Now that I think about it, it&apos;s easy to change the syntax and use a float for SAMPLE. The value would be a probability between 0.0 and 1.0. It&apos;s cleaner this way, and I will send a new patch for that.&lt;/p&gt;

&lt;p&gt;2) I implemented it in limit because they are both specialized filters in a way, with a similar syntax. This way the code changes are very small.&lt;/p&gt;

&lt;p&gt;It already exists as a filter without any coding needed:&lt;/p&gt;

&lt;p&gt;    b = FILTER a BY org.apache.pig.piggybank.evaluation.math.RANDOM()&amp;lt;0.01;&lt;/p&gt;

&lt;p&gt;The syntax not very user friendly, though.&lt;/p&gt;

&lt;p&gt;3) Will add unit tests in the new patch with floats.&lt;/p&gt;


&lt;p&gt;I will produce a new patch with the float syntax and unit tests in the next few days, unless you tell me you prefer FILTER BY.&lt;/p&gt;</comment>
                            <comment id="12705104" author="olgan" created="Fri, 1 May 2009 21:19:57 +0100"  >&lt;p&gt;Can we implement SAMPLE the same way we implement JOIN - as a macro.&lt;/p&gt;

&lt;p&gt;This way we will achieve the readability without much code changes. &lt;/p&gt;</comment>
                            <comment id="12705134" author="alangates" created="Fri, 1 May 2009 22:49:05 +0100"  >&lt;p&gt;I think it&apos;s fine to have sample as a keyword.  It&apos;s valuable not just because it&apos;s easier syntax, but because in the future it could be expanded to more sophisticated sampling techniques beyond just taking a percentage of the data.  For example:&lt;/p&gt;

&lt;p&gt;B = SAMPLE A 1 USING &apos;mywhizbangnewsmaplingalgorithm&apos;;&lt;/p&gt;

&lt;p&gt;What I meant was your patch could translate SAMPLE underneath into a filter.  Then, instead of making changes in the limit code, all you need to do is move RANDOM from piggybank into pig&apos;s builtins, and change QueryParser.jjt to do the translation form SAMPLE to FILTER.&lt;/p&gt;</comment>
                            <comment id="12705204" author="ericg" created="Sat, 2 May 2009 02:30:49 +0100"  >&lt;p&gt;This is the implementation of the SAMPLE operator rewritten as FILTER by the query parser, as suggested by Olga and Alan. It uses a new built-in function RANDOM(), copied from piggybank. This patch also adds the unit test TestSample. &lt;/p&gt;

&lt;p&gt;I am unfamiliar with LogicalPlan crafting, so the code might not be the best. Please feel free to clean it up.&lt;/p&gt;
</comment>
                            <comment id="12705368" author="olgan" created="Sun, 3 May 2009 03:23:38 +0100"  >&lt;p&gt;I tested the patch and it works very well. Thanks Eric for contributing!&lt;/p&gt;

&lt;p&gt;We are trying to commit multiquery changes at the moment. I will commit this patch in a day or two once the multiquery code is in.&lt;/p&gt;</comment>
                            <comment id="12705739" author="olgan" created="Mon, 4 May 2009 21:57:47 +0100"  >&lt;p&gt;Patch committed. Thanks, Eric, for contributing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12406975" name="sample2.diff" size="6169" author="ericg" created="Fri, 1 May 2009 00:23:23 +0100"/>
                            <attachment id="12407058" name="sample3.diff" size="7790" author="ericg" created="Sat, 2 May 2009 02:30:49 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 1 May 2009 16:24:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164352</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyaizr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95388</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>