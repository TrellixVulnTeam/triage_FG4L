<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:03:50 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-761/PIG-761.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-761] ERROR 2086 on simple JOIN</title>
                <link>https://issues.apache.org/jira/browse/PIG-761</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;ERROR 2086: Unexpected problem during optimization. Could not find all LocalRearrange operators.org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1002: Unable to store alias 109&lt;/p&gt;

&lt;p&gt;doing pretty straightforward join in one of my pig scripts. I am able to &apos;dump&apos; both relationship involved in this join. when I try to join them I am getting this error.&lt;/p&gt;

&lt;p&gt;Here is a full log:&lt;/p&gt;


&lt;p&gt;ERROR 2086: Unexpected problem during optimization. Could not find all&lt;br/&gt;
LocalRearrange operators.&lt;br/&gt;
org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1002: Unable&lt;br/&gt;
to store alias 109&lt;br/&gt;
       at org.apache.pig.PigServer.registerQuery(PigServer.java:296)&lt;br/&gt;
       at org.apache.pig.tools.grunt.GruntParser.processPig(GruntParser.java:529)&lt;br/&gt;
       at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:280)&lt;br/&gt;
       at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:99)&lt;br/&gt;
       at org.apache.pig.tools.grunt.Grunt.run(Grunt.java:75)&lt;br/&gt;
       at org.apache.pig.Main.main(Main.java:319)&lt;br/&gt;
Caused by: org.apache.pig.backend.executionengine.ExecException: ERROR&lt;br/&gt;
2043: Unexpected error during execution.&lt;br/&gt;
       at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.execute(HExecutionEngine.java:274)&lt;br/&gt;
       at org.apache.pig.PigServer.executeCompiledLogicalPlan(PigServer.java:700)&lt;br/&gt;
       at org.apache.pig.PigServer.execute(PigServer.java:691)&lt;br/&gt;
       at org.apache.pig.PigServer.registerQuery(PigServer.java:292)&lt;br/&gt;
       ... 5 more&lt;br/&gt;
Caused by: org.apache.pig.impl.plan.optimizer.OptimizerException:&lt;br/&gt;
ERROR 2086: Unexpected problem during optimization. Could not find all&lt;br/&gt;
LocalRearrange operators.&lt;br/&gt;
       at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.plans.POPackageAnnotator.handlePackage(POPackageAnnotator.java:116)&lt;br/&gt;
       at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.plans.POPackageAnnotator.visitMROp(POPackageAnnotator.java:88)&lt;br/&gt;
       at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceOper.visit(MapReduceOper.java:194)&lt;br/&gt;
       at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceOper.visit(MapReduceOper.java:43)&lt;br/&gt;
       at org.apache.pig.impl.plan.DepthFirstWalker.depthFirst(DepthFirstWalker.java:65)&lt;br/&gt;
       at org.apache.pig.impl.plan.DepthFirstWalker.depthFirst(DepthFirstWalker.java:67)&lt;br/&gt;
       at org.apache.pig.impl.plan.DepthFirstWalker.depthFirst(DepthFirstWalker.java:67)&lt;br/&gt;
       at org.apache.pig.impl.plan.DepthFirstWalker.depthFirst(DepthFirstWalker.java:67)&lt;br/&gt;
       at org.apache.pig.impl.plan.DepthFirstWalker.walk(DepthFirstWalker.java:50)&lt;br/&gt;
       at org.apache.pig.impl.plan.PlanVisitor.visit(PlanVisitor.java:51)&lt;br/&gt;
       at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.&lt;br/&gt;
MapReduceLauncher.compile(MapReduceLauncher.java:198)&lt;br/&gt;
       at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher.launchPig(MapReduceLauncher.java:80)&lt;br/&gt;
       at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.execute(HExecutionEngine.java:261)&lt;br/&gt;
       ... 8 more&lt;br/&gt;
ERROR 1002: Unable to store alias 398&lt;br/&gt;
org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1002: Unable&lt;br/&gt;
to store alias 398&lt;br/&gt;
       at org.apache.pig.PigServer.registerQuery(PigServer.java:296)&lt;br/&gt;
       at org.apache.pig.tools.grunt.GruntParser.processPig(GruntParser.java:529)&lt;br/&gt;
       at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:280)&lt;br/&gt;
       at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:99)&lt;br/&gt;
       at org.apache.pig.tools.grunt.Grunt.run(Grunt.java:75)&lt;br/&gt;
       at org.apache.pig.Main.main(Main.java:319)&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
       at org.apache.pig.backend.hadoop.executionengine.physicalLayer.LogToPhyTranslationVisitor.visit(LogToPhyTranslationVisitor.java:669)&lt;br/&gt;
       at org.apache.pig.impl.logicalLayer.LOCogroup.visit(LOCogroup.java:330)&lt;br/&gt;
       at org.apache.pig.impl.logicalLayer.LOCogroup.visit(LOCogroup.java:41)&lt;br/&gt;
       at org.apache.pig.impl.plan.DependencyOrderWalker.walk(DependencyOrderWalker.java:68)&lt;br/&gt;
       at org.apache.pig.impl.plan.PlanVisitor.visit(PlanVisitor.java:51)&lt;br/&gt;
       at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.compile(HExecutionEngine.java:246)&lt;br/&gt;
       at org.apache.pig.PigServer.compilePp(PigServer.java:771)&lt;br/&gt;
       at org.apache.pig.PigServer.executeCompiledLogicalPlan(PigServer.java:697)&lt;br/&gt;
       at org.apache.pig.PigServer.execute(PigServer.java:691)&lt;br/&gt;
       at org.apache.pig.PigServer.registerQuery(PigServer.java:292)&lt;br/&gt;
       ... 5 more&lt;/p&gt;</description>
                <environment>&lt;p&gt;mapreduce mode&lt;/p&gt;</environment>
        <key id="12422428">PIG-761</key>
            <summary>ERROR 2086 on simple JOIN</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="vzaliva">Vadim Zaliva</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Apr 2009 01:53:49 +0100</created>
                <updated>Wed, 24 Mar 2010 22:15:54 +0000</updated>
                            <resolved>Fri, 25 Dec 2009 00:20:35 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12697555" author="olgan" created="Thu, 9 Apr 2009 17:23:07 +0100"  >&lt;p&gt;Please, provide a query that is causing this problem. Without reproducible case, this will be hard to diagnose. We don&apos;t see this problem in our tests&lt;/p&gt;</comment>
                            <comment id="12766640" author="timmsc" created="Fri, 16 Oct 2009 19:26:57 +0100"  >&lt;p&gt;I ran into this bug as well.  I am using Pig 0.4.0.  I did a LIMIT on one of the data sets to be joined too.  I worked around the problem by approximating the LIMIT with a FILTER.  I&apos;ll see if I can distill it down to a small reproducible test case.  I won&apos;t get time to do that for a week or two though.&lt;/p&gt;</comment>
                            <comment id="12794005" author="ankur" created="Wed, 23 Dec 2009 10:34:14 +0000"  >&lt;p&gt;Here is a very simple script to reproduce the issue:-&lt;/p&gt;

&lt;p&gt;----- Start ---------&lt;br/&gt;
data1 = LOAD &apos;data1&apos; as (a:int, b:int, c:chararray);&lt;br/&gt;
proj1 = LIMIT data1 5;&lt;/p&gt;

&lt;p&gt;data2 = LOAD &apos;data2&apos; as (x:int, y:chararray, z:chararray);&lt;br/&gt;
proj2 = FOREACH data2 GENERATE x, y;&lt;/p&gt;

&lt;p&gt;cogrouped = COGROUP proj1 BY a, proj2 BY x INNER PARALLEL 2;&lt;br/&gt;
joined = FOREACH cogrouped GENERATE FLATTEN(proj1), FLATTEN(proj2);&lt;/p&gt;

&lt;p&gt;store joined into &apos;results&apos;;&lt;br/&gt;
----- End ------------&lt;/p&gt;

&lt;p&gt;The problem seems to be with the LIMIT operator for one of the relations participating in the join.  Seems like this causes the mismatch between expected and found local re-arrange operators&lt;/p&gt;</comment>
                            <comment id="12794163" author="daijy" created="Wed, 23 Dec 2009 19:13:02 +0000"  >&lt;p&gt;The problem lies in the complexity between limit and one of the optimization. More specific, optimization POPackageAnnotator search for matching POLocalRearrange in the map plan, if not, search in the predecessor&apos;s reduce plan. However, if we have a limit, limit will introduce a map-reduce job between the original map-reduce job and its predecessor. POPackageAnnotator cannot find the POLocalRearrange then. To fix it, we mark the map reduce job introduced by limit, and in POPackageAnnotator, if we saw a limit map reduce job, we will search POLocalRearrange in limit job&apos;s parent.&lt;/p&gt;</comment>
                            <comment id="12794324" author="hadoopqa" created="Thu, 24 Dec 2009 06:26:24 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12428861/PIG-761-1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12428861/PIG-761-1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 893660.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/157/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/157/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/157/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/157/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/157/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/157/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12794503" author="pkamath" created="Thu, 24 Dec 2009 22:51:55 +0000"  >&lt;p&gt;+1, Changes look good. I had a question on the following lines:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
108                 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (mrOper.isLimitOnly())
  109                     mrOper = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.mPlan.getPredecessors(mrOper).get(0); 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Will there be a case when the POLocalRearrange may be present in the limit only MROper?&lt;br/&gt;
Will there be a case where the limit only MROper may have &amp;gt; 1 predecessors?&lt;/p&gt;

&lt;p&gt;If the answer to both of these is no, then the patch is good to commit otherwise, these condition may need to be handled.&lt;/p&gt;</comment>
                            <comment id="12794504" author="daijy" created="Thu, 24 Dec 2009 22:56:52 +0000"  >&lt;p&gt;The answer to both is no. There is only one case to insert limit only MROper, It always have the same structure and only have one predecessor, which is the real limit MROper job.&lt;/p&gt;</comment>
                            <comment id="12794523" author="daijy" created="Fri, 25 Dec 2009 00:20:35 +0000"  >&lt;p&gt;Patch committed to both trunk and 0.6 branch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12428861" name="PIG-761-1.patch" size="5147" author="daijy" created="Wed, 23 Dec 2009 19:13:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 9 Apr 2009 16:23:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164324</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyailj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95324</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>