<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:52:55 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2856/PIG-2856.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2856] AvroStorage doesn&apos;t load files in the directories when a glob pattern matches both files and directories.</title>
                <link>https://issues.apache.org/jira/browse/PIG-2856</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;This is a regression from &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2492&quot; title=&quot;AvroStorage should recognize globs and commas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2492&quot;&gt;&lt;del&gt;PIG-2492&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;When a glob pattern such as &apos;*&apos; matches not only files but also directories, AvroStorage does not load files in the directories. This is a bug in getAllSubDirs() that can be fixed as follows:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; getAllSubDirs(Path path, Job job, Set&amp;lt;Path&amp;gt; paths)
...
FileStatus[] matchedFiles = fs.globStatus(path, PATH_FILTER);
...
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (FileStatus file : matchedFiles) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (file.isDir()) {
-        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (FileStatus sub : fs.listStatus(path)) {
+        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (FileStatus sub : fs.listStatus(file.getPath())) {
            getAllSubDirs(sub.getPath(), job, paths);
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12601189">PIG-2856</key>
            <summary>AvroStorage doesn&apos;t load files in the directories when a glob pattern matches both files and directories.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cheolsoo">Cheolsoo Park</assignee>
                                    <reporter username="cheolsoo">Cheolsoo Park</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Aug 2012 10:25:30 +0100</created>
                <updated>Fri, 22 Feb 2013 04:54:11 +0000</updated>
                            <resolved>Mon, 6 Aug 2012 06:22:01 +0100</resolved>
                                    <version>0.11</version>
                                    <fixVersion>0.11</fixVersion>
                                    <component>piggybank</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13427201" author="cheolsoo" created="Thu, 2 Aug 2012 10:34:06 +0100"  >&lt;p&gt;Attach is a patch that fixes the bug in getAllSubDirs() and updates the unit test testGlob1.&lt;/p&gt;

&lt;p&gt;Regarding the test, &quot;expected_test_dir_1.avro&quot; includes files in test_dir1 but doesn&apos;t include ones in its sub-directory test_subdir. On the other hand, &quot;expected_testDir.avro&quot; includes files not only test_dir1 but also its sub-directory test_subdir.&lt;/p&gt;

&lt;p&gt;Since all files in test_dir1 and its sub-directory are supposed to be loaded, &quot;expected_testDir.avro&quot; is used.&lt;/p&gt;</comment>
                            <comment id="13427205" author="cheolsoo" created="Thu, 2 Aug 2012 10:38:10 +0100"  >&lt;p&gt;Review board:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/6318/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/6318/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13428796" author="cheolsoo" created="Sun, 5 Aug 2012 05:30:37 +0100"  >&lt;p&gt;Regarding why this problem was not caught by testGlob1, there are actually two reasons:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;The expected output was incorrect (as mentioned above).&lt;/li&gt;
	&lt;li&gt;The job status was not checked at all. So even though the job failed, the test still passed if it generated the expected output. In testGlob1, the job failed after loading 3 files, but since that happened to be the expected output, the test still passed.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I&apos;ve updated the patch so that not only is the expected output for testGlob1 updated, but the job status also is checked.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13428981" author="sms" created="Mon, 6 Aug 2012 06:21:38 +0100"  >&lt;p&gt;All unit tests pass except TestDBStorage (Hadoop 20) and TestMultiStorage (Hadoop 20 and Hadoop 23). Patch has been committed. Thanks Cheolsoo!&lt;/p&gt;</comment>
                            <comment id="13429008" author="sms" created="Mon, 6 Aug 2012 08:40:26 +0100"  >&lt;p&gt;Forgot to add that TestLookupInFiles in Hadoop 23 is erroring out.&lt;/p&gt;</comment>
                            <comment id="13429009" author="sms" created="Mon, 6 Aug 2012 08:41:07 +0100"  >&lt;p&gt;Addendum to previous comment - its unrelated to this patch and existed previously.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12539174" name="PIG-2856-2.patch" size="3252" author="cheolsoo" created="Sun, 5 Aug 2012 05:30:36 +0100"/>
                            <attachment id="12538887" name="PIG-2856.patch" size="1806" author="cheolsoo" created="Thu, 2 Aug 2012 10:34:06 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 6 Aug 2012 05:21:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242340</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxwofb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14444</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>