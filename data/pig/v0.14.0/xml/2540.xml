<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:59:14 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2540/PIG-2540.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2540] AvroStorage can&apos;t read schema on amazon s3 in elastic mapreduce</title>
                <link>https://issues.apache.org/jira/browse/PIG-2540</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;grunt&amp;gt; emails = load &apos;s3://agile.data/again_inbox&apos; using AvroStorage();&lt;br/&gt;
grunt&amp;gt; describe emails&lt;br/&gt;
Schema for emails unknown.&lt;br/&gt;
grunt&amp;gt; a = limit emails 10;&lt;br/&gt;
grunt&amp;gt; dump a&lt;br/&gt;
2012-02-16 22:15:58,347 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  org.apache.pig.tools.pigstats.ScriptState - Pig features used in the script: LIMIT&lt;br/&gt;
2012-02-16 22:15:58,483 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MRCompiler - File concatenation threshold: 100 optimistic? false&lt;br/&gt;
2012-02-16 22:15:58,542 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MultiQueryOptimizer - MR plan size before optimization: 1&lt;br/&gt;
2012-02-16 22:15:58,542 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MultiQueryOptimizer - MR plan size after optimization: 1&lt;br/&gt;
2012-02-16 22:15:58,632 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  org.apache.pig.tools.pigstats.ScriptState - Pig script settings are added to the job&lt;br/&gt;
2012-02-16 22:15:58,658 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler - mapred.job.reduce.markreset.buffer.percent is not set, set to default 0.3&lt;br/&gt;
2012-02-16 22:15:58,665 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; ERROR org.apache.pig.tools.grunt.Grunt - ERROR 2017: Internal error creating job configuration.&lt;br/&gt;
2012-02-16 22:15:58,665 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; ERROR org.apache.pig.tools.grunt.Grunt - org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1066: Unable to open iterator for alias a&lt;br/&gt;
	at org.apache.pig.PigServer.openIterator(PigServer.java:901)&lt;br/&gt;
	at org.apache.pig.tools.grunt.GruntParser.processDump(GruntParser.java:652)&lt;br/&gt;
	at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:303)&lt;br/&gt;
	at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:188)&lt;br/&gt;
	at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:164)&lt;br/&gt;
	at org.apache.pig.tools.grunt.Grunt.run(Grunt.java:67)&lt;br/&gt;
	at org.apache.pig.Main.run(Main.java:497)&lt;br/&gt;
	at org.apache.pig.Main.main(Main.java:111)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.apache.hadoop.util.RunJar.main(RunJar.java:156)&lt;br/&gt;
Caused by: org.apache.pig.PigException: ERROR 1002: Unable to store alias a&lt;br/&gt;
	at org.apache.pig.PigServer.storeEx(PigServer.java:1000)&lt;br/&gt;
	at org.apache.pig.PigServer.store(PigServer.java:963)&lt;br/&gt;
	at org.apache.pig.PigServer.openIterator(PigServer.java:876)&lt;br/&gt;
	... 12 more&lt;br/&gt;
Caused by: org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobCreationException: ERROR 2017: Internal error creating job configuration.&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.getJob(JobControlCompiler.java:731)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.compile(JobControlCompiler.java:263)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher.launchPig(MapReduceLauncher.java:149)&lt;br/&gt;
	at org.apache.pig.PigServer.launchPlan(PigServer.java:1314)&lt;br/&gt;
	at org.apache.pig.PigServer.executeCompiledLogicalPlan(PigServer.java:1299)&lt;br/&gt;
	at org.apache.pig.PigServer.storeEx(PigServer.java:996)&lt;br/&gt;
	... 14 more&lt;br/&gt;
Caused by: java.lang.ArrayIndexOutOfBoundsException: 0&lt;br/&gt;
	at org.apache.hadoop.mapreduce.lib.input.FileInputFormat.setInputPaths(FileInputFormat.java:352)&lt;br/&gt;
	at org.apache.pig.piggybank.storage.avro.AvroStorage.setLocation(AvroStorage.java:138)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.getJob(JobControlCompiler.java:387)&lt;br/&gt;
	... 19 more&lt;/p&gt;</description>
                <environment>&lt;p&gt;Amazon Elastic MapReduce&lt;/p&gt;</environment>
        <key id="12542952">PIG-2540</key>
            <summary>AvroStorage can&apos;t read schema on amazon s3 in elastic mapreduce</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="russell.jurney">Russell Jurney</assignee>
                                    <reporter username="russell.jurney">Russell Jurney</reporter>
                        <labels>
                            <label>avro</label>
                            <label>avro_udf</label>
                            <label>aws</label>
                            <label>emr</label>
                            <label>pants</label>
                            <label>pig</label>
                            <label>s3</label>
                            <label>sad</label>
                            <label>unhappy</label>
                    </labels>
                <created>Thu, 16 Feb 2012 22:16:25 +0000</created>
                <updated>Fri, 22 Jun 2012 04:36:24 +0100</updated>
                            <resolved>Tue, 27 Mar 2012 03:56:53 +0100</resolved>
                                    <version>0.9.1</version>
                    <version>0.10.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                    <fixVersion>0.9.3</fixVersion>
                    <fixVersion>0.11</fixVersion>
                                    <component>data</component>
                    <component>piggybank</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13233135" author="russell.jurney" created="Tue, 20 Mar 2012 02:35:22 +0000"  >&lt;p&gt;This patch converts the API used to get the current directory from a Path to a URI.  This enables S3, &lt;a href=&quot;file://&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file://&lt;/a&gt; and /foo all work.&lt;/p&gt;

&lt;p&gt;The outstanding issue is that 7 out of 11 tests fail.  I cannot reproduce these failures outside of the unit tests.&lt;/p&gt;

&lt;p&gt;I call for help.&lt;/p&gt;</comment>
                            <comment id="13233136" author="russell.jurney" created="Tue, 20 Mar 2012 02:35:51 +0000"  >&lt;p&gt;This fails 7 out of 11 tests, but works in practice.  Help.&lt;/p&gt;</comment>
                            <comment id="13233231" author="russell.jurney" created="Tue, 20 Mar 2012 05:43:03 +0000"  >&lt;p&gt;These are the test failures I get.&lt;/p&gt;</comment>
                            <comment id="13233933" author="jcoveney" created="Tue, 20 Mar 2012 23:17:48 +0000"  >&lt;p&gt;Russell, here is the change. Previously, there was this function in TestAvroStorage:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getInputFile(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; file) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;///&quot;&lt;/span&gt; + &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;user.dir&quot;&lt;/span&gt;) + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; + basedir + file;
&lt;/span&gt;    }   
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The issue is that System.getProperty(&quot;user.dir&quot;) returns a directory that begins with a /, so you were getting&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
file:&lt;span class=&quot;code-comment&quot;&gt;////etc&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;By changing it accordingly, now all but one test run. The last test errors out, but this is because the file &quot;test_no_extension&quot; doesn&apos;t exist.&lt;/p&gt;</comment>
                            <comment id="13233942" author="russell.jurney" created="Tue, 20 Mar 2012 23:28:08 +0000"  >&lt;p&gt;The fix for test_no_extension was merged in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2505&quot; title=&quot;AvroStorage won&amp;#39;t read any file not ending in .avro&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2505&quot;&gt;&lt;del&gt;PIG-2505&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;So this is ready for merging? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13234001" author="jcoveney" created="Wed, 21 Mar 2012 01:02:45 +0000"  >&lt;p&gt;Favor 1: can you try this on trunk and see if it works? No reason not to have it in both.&lt;br/&gt;
Point 2: in getAllSubDirs, you added a bunch of System.err.println. This should all be logged instead, via the logger, though some of it looks like vestiges of when you were debugging &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; either way, could be useful to clean it up and log some useful statz. Otherwise, looks good to me.&lt;/p&gt;</comment>
                            <comment id="13234065" author="russell.jurney" created="Wed, 21 Mar 2012 03:56:43 +0000"  >&lt;p&gt;printlns removed&lt;/p&gt;</comment>
                            <comment id="13234137" author="jcoveney" created="Wed, 21 Mar 2012 05:54:23 +0000"  >&lt;p&gt;Russell, I think you need to rebase. That has some changes to PigAvroInputFormat.java that I think are from a different patch, and it doesn&apos;t have the change I made to fix the tests.&lt;/p&gt;</comment>
                            <comment id="13236020" author="russell.jurney" created="Thu, 22 Mar 2012 20:54:10 +0000"  >&lt;p&gt;I am using git.  I commit locally, and pull from the github copy... so I am not sure how to do this?&lt;/p&gt;</comment>
                            <comment id="13236048" author="russell.jurney" created="Thu, 22 Mar 2012 21:21:00 +0000"  >&lt;p&gt;I don&apos;t understand how to do this.  I did this:&lt;/p&gt;

&lt;p&gt;russell-jurneys-macbook-pro:newpig rjurney$ git remote -v&lt;br/&gt;
origin	&lt;a href=&quot;https://github.com/apache/pig.git&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/pig.git&lt;/a&gt; (fetch)&lt;br/&gt;
origin	&lt;a href=&quot;https://github.com/apache/pig.git&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/pig.git&lt;/a&gt; (push)&lt;/p&gt;

&lt;p&gt;russell-jurneys-macbook-pro:newpig rjurney$ git branch -v&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;branch-0.10 14f4606 &lt;span class=&quot;error&quot;&gt;&amp;#91;ahead 5&amp;#93;&lt;/span&gt; Merge branch &apos;branch-0.10&apos; of &lt;a href=&quot;https://github.com/apache/pig&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/pig&lt;/a&gt; into branch-0.10&lt;br/&gt;
  trunk       cb49401 &lt;span class=&quot;error&quot;&gt;&amp;#91;behind 7&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2589&quot; title=&quot;Additional e2e test for 0.10 new features&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2589&quot;&gt;&lt;del&gt;PIG-2589&lt;/del&gt;&lt;/a&gt;: Additional e2e test for 0.10 new features&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;russell-jurneys-macbook-pro:newpig rjurney$ git pull&lt;br/&gt;
remote: Counting objects: 77, done.&lt;br/&gt;
remote: Compressing objects: 100% (6/6), done.&lt;br/&gt;
remote: Total 39 (delta 17), reused 39 (delta 17)&lt;br/&gt;
Unpacking objects: 100% (39/39), done.&lt;br/&gt;
From &lt;a href=&quot;https://github.com/apache/pig&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/pig&lt;/a&gt;&lt;br/&gt;
   b8ce196..d1f6cb1  branch-0.10 -&amp;gt; origin/branch-0.10&lt;br/&gt;
   8b21cc4..841f336  trunk      -&amp;gt; origin/trunk&lt;br/&gt;
Merge made by recursive.&lt;/p&gt;

&lt;p&gt;git diff --no-prefix 73bb67f8cc3974d76e034d09da96995e887b4c30 contrib/piggybank/java/src/main/java/org/apache/pig/piggybank/storage/avro/ &amp;gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2540&quot; title=&quot;AvroStorage can&amp;#39;t read schema on amazon s3 in elastic mapreduce&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2540&quot;&gt;&lt;del&gt;PIG-2540&lt;/del&gt;&lt;/a&gt;.tests_fail.patch.3&lt;/p&gt;

&lt;p&gt;This patch is identical to the other one.  What am I missing?&lt;/p&gt;</comment>
                            <comment id="13237396" author="russell.jurney" created="Sat, 24 Mar 2012 01:44:36 +0000"  >&lt;p&gt;Can anyone help me out here?  I don&apos;t know how to patch other than git, and it is not working &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13239128" author="jcoveney" created="Tue, 27 Mar 2012 03:48:35 +0100"  >&lt;p&gt;Committed to 0.10 (r1305716) and trunk (r1305715). Testing on 0.9 now.&lt;/p&gt;</comment>
                            <comment id="13239130" author="jcoveney" created="Tue, 27 Mar 2012 03:52:34 +0100"  >&lt;p&gt;Attaching applied patch.&lt;/p&gt;</comment>
                            <comment id="13239131" author="jcoveney" created="Tue, 27 Mar 2012 03:56:30 +0100"  >&lt;p&gt;Applied to pig0.9 r1305717&lt;/p&gt;

&lt;p&gt;Onward and upwards!&lt;/p&gt;</comment>
                            <comment id="13239217" author="russell.jurney" created="Tue, 27 Mar 2012 07:06:39 +0100"  >&lt;p&gt;Oh wow!&lt;/p&gt;</comment>
                            <comment id="13277634" author="russell.jurney" created="Thu, 17 May 2012 08:16:40 +0100"  >&lt;p&gt;Note: this patch seems to have accidentally fixed &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2527&quot; title=&quot;ILLUSTRATE fails for relations LOADed with the AvroStorage UDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2527&quot;&gt;&lt;del&gt;PIG-2527&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Rejoice!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12519009" name="PIG-2540.tests_fail.patch" size="5729" author="russell.jurney" created="Tue, 20 Mar 2012 02:35:22 +0000"/>
                            <attachment id="12519169" name="PIG-2540.tests_fail.patch.2" size="6973" author="russell.jurney" created="Wed, 21 Mar 2012 03:56:42 +0000"/>
                            <attachment id="12520052" name="PIG-2540_4.patch" size="4896" author="jcoveney" created="Tue, 27 Mar 2012 03:52:33 +0100"/>
                            <attachment id="12519149" name="PIG-2540_almost_there.patch" size="5166" author="jcoveney" created="Tue, 20 Mar 2012 23:17:47 +0000"/>
                            <attachment id="12519025" name="TEST-org.apache.pig.piggybank.test.storage.avro.TestAvroStorage.txt" size="85605" author="russell.jurney" created="Tue, 20 Mar 2012 05:43:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 20 Mar 2012 23:17:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>228238</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzcyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30082</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>