<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:58:02 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1931/PIG-1931.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1931] Integrate Macro Expansion with New Parser</title>
                <link>https://issues.apache.org/jira/browse/PIG-1931</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Currently Macro expansion is implemented as a preprocessor (&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1793&quot; title=&quot;Add macro expansion to Pig Latin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1793&quot;&gt;&lt;del&gt;PIG-1793&lt;/del&gt;&lt;/a&gt;) so that it can work with the old parser. Now the new parser replaced old parser in trunk and we can integrate macro expansion into the new parser. This has many advantages such as better error reporting, less code and making Macro part of Pig Latin.&lt;/p&gt;

&lt;p&gt;To aid debugging, Pig command line option -r (dryrun) will produce a script with expanded macros (in addition to the script with substituted parameters).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12502115">PIG-1931</key>
            <summary>Integrate Macro Expansion with New Parser</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rding">Richard Ding</assignee>
                                    <reporter username="rding">Richard Ding</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Mar 2011 22:28:28 +0000</created>
                <updated>Thu, 4 Aug 2011 01:34:48 +0100</updated>
                            <resolved>Wed, 6 Apr 2011 22:33:50 +0100</resolved>
                                    <version>0.9.0</version>
                                    <fixVersion>0.9.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13009874" author="rding" created="Tue, 22 Mar 2011 22:32:23 +0000"  >&lt;p&gt;Attaching the initial patch. &lt;/p&gt;

&lt;p&gt;Still need to integrate file name, line number into the parser tree.&lt;/p&gt;</comment>
                            <comment id="13010859" author="xuefuz" created="Thu, 24 Mar 2011 19:21:46 +0000"  >&lt;p&gt;I haven&apos;t finished reviewing (some code may require discussion in person), but here is my comments so far.&lt;/p&gt;

&lt;p&gt;1. QueryParser.g&lt;br/&gt;
1) This file is for syntax check and AST generation. It&apos;s better to move the validation to one of the tree parsers.&lt;br/&gt;
2)For readability, please divide the long rules into sub-rules, each rule having only one root (^). Also, remove unnecessary token renaming such as rets+=alias.&lt;br/&gt;
3)Import and returns need to be added to eid (accross all tree parsers as well).&lt;/p&gt;

&lt;p&gt;2. AliasMasker.g&lt;br/&gt;
   1) Please simplify, be consistent with QueryParser.g, as you don&apos;t generate pig script any more. For instance, &lt;br/&gt;
 output_clause &lt;br/&gt;
    : ^( OUTPUT stream_cmd ( stream_cmd)* )&lt;br/&gt;
it should be just ^( OUTPUT stream_cmd+ )&lt;/p&gt;

&lt;p&gt;3. QueryParserDriver.java&lt;br/&gt;
1)Error reporting should be consistent with others (especially line numbers and offsets)&lt;br/&gt;
2)I don&apos;t see how currentImport is updated anywhere.&lt;br/&gt;
3)In inlineMacro(), I don&apos;t see how nodes variable is updated. Isn&apos;t it always empty?&lt;/p&gt;

&lt;p&gt;4. MacroExpansionDebug.g&lt;br/&gt;
1) pasted/copied code should be removed. For example, getErrorMessage()&lt;br/&gt;
2) I see a few unused member variables/methods.&lt;br/&gt;
3) File name is confusing. It seems having nothing to do with macro expansion. It just prints a script from an AST.&lt;/p&gt;

&lt;p&gt;5. PigMacro.java&lt;br/&gt;
1)We should restrain from throwing runtime exception&lt;/p&gt;</comment>
                            <comment id="13010899" author="alangates" created="Thu, 24 Mar 2011 20:34:00 +0000"  >&lt;p&gt;Please make sure you post any results from your conversation here, so others can follow.&lt;/p&gt;</comment>
                            <comment id="13011335" author="xuefuz" created="Fri, 25 Mar 2011 18:28:28 +0000"  >&lt;p&gt;Some additional comments (It can be included in subsequent patches):&lt;/p&gt;

&lt;p&gt;1. PigScriptParser.jj : multi assignment should cover the single assignment. No need to have both.&lt;/p&gt;


&lt;p&gt;2. Need to add check to make sure that macro definition cannot happen in another macro definition.&lt;/p&gt;</comment>
                            <comment id="13011424" author="rding" created="Fri, 25 Mar 2011 21:16:42 +0000"  >&lt;p&gt;This patch added the script file name to the error messages and addressed the review comments. &lt;/p&gt;</comment>
                            <comment id="13011476" author="rding" created="Fri, 25 Mar 2011 23:09:09 +0000"  >&lt;p&gt;test-patch result:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     [exec] -1 overall.  
     [exec] 
     [exec]     +1 @author.  The patch does not contain any @author tags.
     [exec] 
     [exec]     +1 tests included.  The patch appears to include 30 &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; or modified tests.
     [exec] 
     [exec]     +1 javadoc.  The javadoc tool did not generate any warning messages.
     [exec] 
     [exec]     -1 javac.  The applied patch generated 941 javac compiler warnings (more than the trunk&apos;s current 884 warnings).
     [exec] 
     [exec]     +1 findbugs.  The patch does not introduce any &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Findbugs warnings.
     [exec] 
     [exec]     -1 release audit.  The applied patch generated 550 release audit warnings (more than the trunk&apos;s current 548 warnings).
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Release audit warnings are html related.&lt;/p&gt;</comment>
                            <comment id="13011515" author="rding" created="Sat, 26 Mar 2011 00:29:07 +0000"  >&lt;p&gt;Patch 2 committed to trunk.&lt;/p&gt;</comment>
                            <comment id="13011548" author="xuefuz" created="Sat, 26 Mar 2011 04:18:06 +0000"  >&lt;p&gt;+1 Patch &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1931&quot; title=&quot;Integrate Macro Expansion with New Parser&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1931&quot;&gt;&lt;del&gt;PIG-1931&lt;/del&gt;&lt;/a&gt;_2.patch looks good. Additional comments:&lt;/p&gt;

&lt;p&gt;1) The &quot;main&quot; pig script file name should be available from Antlr parser, which can be set in the AST node.&lt;/p&gt;

&lt;p&gt;2) If not done already, please test cases where a macro def is called more than one time.&lt;/p&gt;</comment>
                            <comment id="13013601" author="xuefuz" created="Wed, 30 Mar 2011 20:25:51 +0100"  >&lt;p&gt;Another observation: current the file name of the main script is set only on AST, so source file name will be there for errors reported by AST visitors or plan visitors. However, for syntax errors, which happen before AST tree is built, the file name is absent, which should be also part of error reporting.&lt;/p&gt;</comment>
                            <comment id="13013700" author="rding" created="Wed, 30 Mar 2011 23:07:06 +0100"  >&lt;p&gt;Patch 3 adds source name to the lexer and parser so that lexer/parser error messages contain the script file name. &lt;/p&gt;</comment>
                            <comment id="13013737" author="xuefuz" created="Thu, 31 Mar 2011 00:47:34 +0100"  >&lt;p&gt;About &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1931&quot; title=&quot;Integrate Macro Expansion with New Parser&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1931&quot;&gt;&lt;del&gt;PIG-1931&lt;/del&gt;&lt;/a&gt;_3.patch:&lt;/p&gt;

&lt;p&gt;1. I think it&apos;s a right approach to include the source file name in QueryParserStringStream. Once that happens, we can get the stored file name in every token by calling token.getInputStream().getSourceName(). Then, in the PigParserNodeAdapter, you can set the file name to each PigParserNode instance created. In this way, you set the file name while AST is generated, which eliminates the need of recursively set it as done currently at macro expansion time.&lt;/p&gt;

&lt;p&gt;2. For the error header, &amp;lt;file myscript.pig, line 1, column 10&amp;gt; would be more consistent than &amp;lt;At myscript.pig, line 1, column 10&amp;gt;.&lt;/p&gt;</comment>
                            <comment id="13014259" author="rding" created="Thu, 31 Mar 2011 23:49:54 +0100"  >&lt;p&gt;Attaching a simplified version. Thanks Xuefu for suggestions.&lt;/p&gt;</comment>
                            <comment id="13014274" author="xuefuz" created="Fri, 1 Apr 2011 00:19:32 +0100"  >&lt;p&gt;+1 &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1931&quot; title=&quot;Integrate Macro Expansion with New Parser&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1931&quot;&gt;&lt;del&gt;PIG-1931&lt;/del&gt;&lt;/a&gt;_4.patch looks good.&lt;/p&gt;</comment>
                            <comment id="13014719" author="rding" created="Fri, 1 Apr 2011 17:21:33 +0100"  >&lt;p&gt;test-patch result:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     [exec] -1 overall.  
     [exec] 
     [exec]     +1 @author.  The patch does not contain any @author tags.
     [exec] 
     [exec]     +1 tests included.  The patch appears to include 8 &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; or modified tests.
     [exec] 
     [exec]     +1 javadoc.  The javadoc tool did not generate any warning messages.
     [exec] 
     [exec]     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.
     [exec] 
     [exec]     +1 findbugs.  The patch does not introduce any &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Findbugs warnings.
     [exec] 
     [exec]     -1 release audit.  The applied patch generated 556 release audit warnings (more than the trunk&apos;s current 555 warnings).
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Release audit warning is html related.&lt;/p&gt;

&lt;p&gt;Unit tests pass.&lt;/p&gt;</comment>
                            <comment id="13014721" author="rding" created="Fri, 1 Apr 2011 17:29:32 +0100"  >&lt;p&gt;patch 4 committed to trunk.&lt;/p&gt;</comment>
                            <comment id="13016538" author="olgan" created="Wed, 6 Apr 2011 22:14:34 +0100"  >&lt;p&gt;Can this ticket be closed?&lt;/p&gt;</comment>
                            <comment id="13016550" author="rding" created="Wed, 6 Apr 2011 22:33:50 +0100"  >&lt;p&gt;patches are committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12474350" name="PIG-1931_1.patch" size="202679" author="rding" created="Tue, 22 Mar 2011 22:32:23 +0000"/>
                            <attachment id="12474664" name="PIG-1931_2.patch" size="214789" author="rding" created="Fri, 25 Mar 2011 21:16:42 +0000"/>
                            <attachment id="12475023" name="PIG-1931_3.patch" size="4964" author="rding" created="Wed, 30 Mar 2011 23:07:06 +0100"/>
                            <attachment id="12475163" name="PIG-1931_4.patch" size="12377" author="rding" created="Thu, 31 Mar 2011 23:49:54 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 24 Mar 2011 19:21:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66261</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyauk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97262</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>