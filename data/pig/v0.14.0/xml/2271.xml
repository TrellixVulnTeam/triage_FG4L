<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:49:30 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2271/PIG-2271.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2271] PIG regression in BinStorage/PigStorage in 0.9.1</title>
                <link>https://issues.apache.org/jira/browse/PIG-2271</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;I&apos;m using the 0.9.1 official release.&lt;/p&gt;

&lt;p&gt;My input data are read form a text file &apos;activity&apos; (provided as attachment):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
00,1239698069000, &amp;lt;- &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is the line that is not correctly handled
01,1239698505000,b
01,1239698369000,a
02,1239698413000,b
02,1239698553000,c
02,1239698313000,a
03,1239698316000,a
03,1239698516000,c
03,1239698416000,b
03,1239698621000,d
04,1239698417000,c
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;My script is working correctly:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-- load input data
activities = LOAD &apos;activity&apos; USING PigStorage(&apos;,&apos;) AS (sid:chararray, timestamp:&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;, name:chararray);

-- group input data
activities = GROUP activities BY sid;
activities = FOREACH activities GENERATE group, activities.(timestamp, name);

-- store grouped activities in a temporary file
STORE activities INTO &apos;tmp&apos; USING PigStorage();

-- reload grouped activities from the temporary file
activities = LOAD &apos;tmp&apos; USING PigStorage() AS (sid:chararray, acts:bag { act:tuple (timestamp:&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;, name:chararray) });

-- store grouped activities again in an output file
STORE activities INTO &apos;output&apos; USING PigStorage();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After running this script, the &apos;output&apos; file contains a correct result:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
00	{(1239698069000,)}
01	{(1239698505000,b),(1239698369000,a)}
02	{(1239698413000,b),(1239698553000,c),(1239698313000,a)}
03	{(1239698316000,a),(1239698516000,c),(1239698416000,b),(1239698621000,d)}
04	{(1239698417000,c)}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But the issue occurs when I use BinStorage() instead of PigStorage() to store / reload my temporary files. The &apos;output&apos; file in that case is not complete:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
00	
01	{(1239698505000,b),(1239698369000,a)}
02	{(1239698413000,b),(1239698553000,c),(1239698313000,a)}
03	{(1239698316000,a),(1239698516000,c),(1239698416000,b),(1239698621000,d)}
04	{(1239698417000,c)}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The not working script is the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-- load input data
activities = LOAD &apos;activity&apos; USING PigStorage(&apos;,&apos;) AS (sid:chararray, timestamp:&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;, name:chararray);

-- group input data
activities = GROUP activities BY sid;
activities = FOREACH activities GENERATE group, activities.(timestamp, name);

-- store grouped activities in a temporary file
STORE activities INTO &apos;tmp&apos; USING PigStorage();

-- reload grouped activities from the temporary file
activities = LOAD &apos;tmp&apos; USING PigStorage() AS (sid:chararray, acts:bag { act:tuple (timestamp:&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;, name:chararray) });

-- store grouped activities again in an output file
STORE activities INTO &apos;output&apos; USING PigStorage();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So the issue seems to be located in the way the BinStorage() store or load bags.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12522397">PIG-2271</key>
            <summary>PIG regression in BinStorage/PigStorage in 0.9.1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thejas">Thejas M Nair</assignee>
                                    <reporter username="vbarat">Vincent BARAT</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Sep 2011 10:35:45 +0100</created>
                <updated>Mon, 23 Jan 2012 07:31:26 +0000</updated>
                            <resolved>Tue, 11 Oct 2011 00:03:55 +0100</resolved>
                                    <version>0.9.1</version>
                    <version>0.10.0</version>
                                    <fixVersion>0.9.2</fixVersion>
                    <fixVersion>0.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13101714" author="daijy" created="Sat, 10 Sep 2011 02:10:42 +0100"  >&lt;p&gt;Can you do these:&lt;br/&gt;
1. Get the output schema for MyUDF. (describe activities)&lt;br/&gt;
2. Use a different construct for BinStorage: BinStorage(&quot;org.apache.pig.builtin.Utf8StorageConverter&quot;)&lt;/p&gt;</comment>
                            <comment id="13122029" author="vbarat" created="Thu, 6 Oct 2011 17:04:42 +0100"  >&lt;p&gt;Hi Daniel,&lt;/p&gt;

&lt;p&gt;I did more investigations and fully reformulated the issue. There is no more UDF function involved, and I reproduce it with the 0.9.1 official release.&lt;/p&gt;

&lt;p&gt;The issue is related to BinStorage (but I can also reproduce it using PigStorage(&apos;,&apos;)).&lt;/p&gt;

&lt;p&gt;This is a really blocking issue for me, as I need to use BinStorage() to load some binary data. This issue prevent be from using pig 0.9.1.&lt;/p&gt;

&lt;p&gt;Thanks a lot for your time.&lt;/p&gt;</comment>
                            <comment id="13122157" author="thejas" created="Thu, 6 Oct 2011 19:52:43 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2271&quot; title=&quot;PIG regression in BinStorage/PigStorage in 0.9.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2271&quot;&gt;&lt;del&gt;PIG-2271&lt;/del&gt;&lt;/a&gt;.0.patch - initial patch. Test cases need to be added. &lt;/p&gt;

&lt;p&gt;The type conversion when user specified schema is present was not handling nulls correctly, it resulted in a cast failure. So the type conversion for the tuple that contained null was not successful. &lt;/p&gt;</comment>
                            <comment id="13122302" author="thejas" created="Thu, 6 Oct 2011 22:14:24 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2271&quot; title=&quot;PIG regression in BinStorage/PigStorage in 0.9.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2271&quot;&gt;&lt;del&gt;PIG-2271&lt;/del&gt;&lt;/a&gt;.1.patch - patch with test cases.&lt;/p&gt;</comment>
                            <comment id="13122305" author="thejas" created="Thu, 6 Oct 2011 22:16:45 +0100"  >&lt;p&gt;I would like to clarify that the type conversion fails only when user casts a complex type (tuple/bag/map) using a schema with inner schema, and one of the values inside is null.&lt;/p&gt;</comment>
                            <comment id="13124549" author="daijy" created="Mon, 10 Oct 2011 23:53:41 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12498048" name="PIG-2271.0.patch" size="2186" author="thejas" created="Thu, 6 Oct 2011 19:52:42 +0100"/>
                            <attachment id="12498070" name="PIG-2271.1.patch" size="10176" author="thejas" created="Thu, 6 Oct 2011 22:14:24 +0100"/>
                            <attachment id="12498014" name="activity" size="208" author="vbarat" created="Thu, 6 Oct 2011 16:40:23 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 10 Sep 2011 01:10:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35739</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy3u2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56196</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>patch committed to 0.9 branch and trunk</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>