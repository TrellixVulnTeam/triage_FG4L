<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:55:10 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-626/PIG-626.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-626] Statistics (records read by each mapper and reducer)</title>
                <link>https://issues.apache.org/jira/browse/PIG-626</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;This uses the counters framework that hadoop has. Initially, I am just interested in finding out the number of records read by each mapper/reducer particularly for the last job in any script. A sample code to access the statistics for the last job:&lt;/p&gt;

&lt;p&gt;String reducePlan = stats.getPigStats().get(stats.getLastJobID()).get(&quot;PIG_STATS_REDUCE_PLAN&quot;);&lt;br/&gt;
        if(reducePlan == null) &lt;/p&gt;
{
            System.out.println(&quot;Records written : &quot; + stats.getPigStats().get(stats.getLastJobID()).get(&quot;PIG_STATS_MAP_OUTPUT_RECORDS&quot;));
        }
&lt;p&gt; else &lt;/p&gt;
{
            System.out.println(&quot;Records written : &quot; + stats.getPigStats().get(stats.getLastJobID()).get(&quot;PIG_STATS_REDUCE_OUTPUT_RECORDS&quot;));
        }
&lt;p&gt;The patch contains 7 test cases. These include tests PigStorage and BinStorage along with one for multiple MR jobs case.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12412739">PIG-626</key>
            <summary>Statistics (records read by each mapper and reducer)</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shubhamc">Shubham Chopra</assignee>
                                    <reporter username="shubhamc">Shubham Chopra</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Jan 2009 12:10:38 +0000</created>
                <updated>Wed, 18 Jun 2014 11:22:56 +0100</updated>
                            <resolved>Mon, 11 May 2009 21:47:25 +0100</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.3.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12665110" author="shubhamc" created="Mon, 19 Jan 2009 12:13:11 +0000"  >&lt;p&gt;Patch attached.&lt;/p&gt;</comment>
                            <comment id="12665512" author="alangates" created="Tue, 20 Jan 2009 19:33:14 +0000"  >&lt;p&gt;Shubham, I have several comments and questions about this patch:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;What exactly is the goal here, to make statistics available to users via the PigServer interface, or to add certain specific statistics to map and reduce?&lt;/li&gt;
	&lt;li&gt;If I understand correctly you are just returning pig specific counters in PigServer.getStats().  Why not return all counters (if they are available)?  Perhaps users would want to read the hadoop counters too.&lt;/li&gt;
	&lt;li&gt;There are some println&apos;s stuck in here that print out the stats at the end of the job.  This should be written to the logs instead.&lt;/li&gt;
	&lt;li&gt;I don&apos;t see where the statistics are actually being incremented during the map reduce job.  I see where they&apos;re collected after the job.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="12665698" author="shubhamc" created="Wed, 21 Jan 2009 04:25:40 +0000"  >
&lt;p&gt;1. The initial goal is to just get the pig query result sizes. I try to get the no. of records written by the last job which gives me the required metric. In addition to this I am making the stats for all the jobs available. I am not adding any specific stat to map/reduce.&lt;br/&gt;
2. I am only using the hadoop counters here. I am not registering any pig-specific counters. Olga had suggested that I make the counters available in the form of a map with the keys starting with PIG_STATS to reference the required counter. &lt;br/&gt;
Hadoop has a bunch of counters that it uses to display stats in its map-red webUI. These counters give the no. of records and bytes read/written by map/reduce of each job. I am making all the hadoop stats, at the granularity of a record, available.&lt;br/&gt;
3. I have rectified this in the new patch.&lt;br/&gt;
4. These counters are incremented within hadoop.&lt;/p&gt;</comment>
                            <comment id="12668678" author="alangates" created="Fri, 30 Jan 2009 00:34:06 +0000"  >&lt;p&gt;I ran the unit tests on the latest patch and saw failures in TestBZip.  It&apos;s getting a null pointer exception when it tries to reference PigStats at some point.  I&apos;ll attach the results to the bug.&lt;/p&gt;</comment>
                            <comment id="12668679" author="alangates" created="Fri, 30 Jan 2009 00:34:32 +0000"  >&lt;p&gt;Results of TestBZIp&lt;/p&gt;</comment>
                            <comment id="12676320" author="shubhamc" created="Tue, 24 Feb 2009 16:05:05 +0000"  >&lt;p&gt;PigStats patch.&lt;/p&gt;</comment>
                            <comment id="12680852" author="shubhamc" created="Wed, 11 Mar 2009 11:57:09 +0000"  >&lt;p&gt;Updates pigStats patch. I now make use of the ExecJob interface.&lt;/p&gt;</comment>
                            <comment id="12688676" author="shubhamc" created="Tue, 24 Mar 2009 13:11:37 +0000"  >&lt;p&gt;I tested the patch with the latest trunk and it worked fine.&lt;/p&gt;</comment>
                            <comment id="12699798" author="shubhamc" created="Thu, 16 Apr 2009 19:36:23 +0100"  >&lt;p&gt;Tested the patch with the latest trunk.&lt;/p&gt;</comment>
                            <comment id="12705152" author="alangates" created="Fri, 1 May 2009 23:19:06 +0100"  >&lt;p&gt;Shubham,&lt;/p&gt;

&lt;p&gt;I apologize for being so slow to get to this.  I see several issues in the patch.&lt;/p&gt;

&lt;p&gt;1) The launcher code has changed significantly.  I tried to figure out how to paste your code in, but I was afraid I was doing it wrong so I backed off.  You&apos;ll need to integrate your patch with the changes.&lt;/p&gt;

&lt;p&gt;2) All error messages now require an error code (see &lt;a href=&quot;http://wiki.apache.org/pig/PigErrorHandlingFunctionalSpecification&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/pig/PigErrorHandlingFunctionalSpecification&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;3) In a couple places when the code can&apos;t find the statistics information it says:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Jobs not found in the JobClient. Please &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; using a different Hadoop mode&quot;&lt;/span&gt;); 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems like this ought to be a warning instead of an info.  Also, what does it mean to try a different hadoop mode?  It&apos;s not clear from this message what action the user should take.&lt;/p&gt;

&lt;p&gt;I promise if you make another patch for this I&apos;ll look at it quickly so it doesn&apos;t go out of date on you again.&lt;/p&gt;</comment>
                            <comment id="12707317" author="shubhamc" created="Fri, 8 May 2009 12:38:17 +0100"  >&lt;p&gt;Patch compatible with the latest trunk attached.&lt;/p&gt;</comment>
                            <comment id="12707432" author="hadoopqa" created="Fri, 8 May 2009 18:27:13 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12407613/pigStats.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12407613/pigStats.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 772750.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 226 javac compiler warnings (more than the trunk&apos;s current 225 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 2 new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/33/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/33/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/33/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/33/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/33/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/33/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12707447" author="alangates" created="Fri, 8 May 2009 18:50:19 +0100"  >&lt;p&gt;Patch checked in.  Thanks Shubham for your patience on this one.&lt;/p&gt;</comment>
                            <comment id="12707484" author="alangates" created="Fri, 8 May 2009 20:25:17 +0100"  >&lt;p&gt;I should have checked my other window before I marked the bug as fixed.  The commit failed, I can&apos;t seem to contact Apache&apos;s SVN at the moment.  I&apos;ll commit the patch once I can.&lt;/p&gt;</comment>
                            <comment id="12707547" author="alangates" created="Fri, 8 May 2009 23:34:13 +0100"  >&lt;p&gt;A version of the patch that deals with the findbugs and javac warnings.&lt;/p&gt;</comment>
                            <comment id="12708211" author="alangates" created="Mon, 11 May 2009 21:47:25 +0100"  >&lt;p&gt;Patch committed, for real this time.&lt;/p&gt;</comment>
                            <comment id="12708737" author="hadoopqa" created="Wed, 13 May 2009 04:17:36 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12407672/PIG-626.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12407672/PIG-626.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 774167.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/34/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/34/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12717946" author="rekhajos" created="Wed, 10 Jun 2009 07:39:47 +0100"  >&lt;p&gt;Shubham/Alan,&lt;/p&gt;

&lt;p&gt;This is nice.I need to trap the below data per script and save it into database as record of the run.&lt;/p&gt;

&lt;p&gt;PIG_STATS_BYTES_WRITTEN&lt;br/&gt;
PIG_STATS_RECORDS_WRITTEN&lt;br/&gt;
PIG_STATS_MAP_INPUT_RECORDS,&lt;br/&gt;
PIG_STATS_MAP_OUTPUT_RECORDS, &lt;br/&gt;
PIG_STATS_REDUCE_INPUT_RECORDS, &lt;br/&gt;
PIG_STATS_REDUCE_OUTPUT_RECORDS, &lt;br/&gt;
PIG_STATS_REDUCE_PLAN, &lt;br/&gt;
PIG_STATS_COMBINE_PLAN&lt;/p&gt;

&lt;p&gt;In pig 2.2 I see similar info in the console logs.Can the pulling be done from there?&lt;/p&gt;

&lt;p&gt;In anycase , I do not want stats run to be an offline process as seen in the Test files in the package.&lt;br/&gt;
Ideally would like to call/execute the stats module right from pig scripts itself as -&lt;br/&gt;
stats.record(); //first line&lt;br/&gt;
stats.flush(&apos;out&amp;lt;jobid&amp;gt;.txt&apos;);//last line&lt;/p&gt;

&lt;p&gt;The push to db can be a cron process.&lt;/p&gt;

&lt;p&gt;Any suggestions?&lt;/p&gt;

&lt;p&gt;Thanks &amp;amp; Regards,&lt;br/&gt;
/Rekha.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12407672" name="PIG-626.patch" size="66014" author="alangates" created="Fri, 8 May 2009 23:34:13 +0100"/>
                            <attachment id="12399075" name="TEST-org.apache.pig.test.TestBZip.txt" size="31491" author="alangates" created="Fri, 30 Jan 2009 00:34:32 +0000"/>
                            <attachment id="12407613" name="pigStats.patch" size="65551" author="shubhamc" created="Fri, 8 May 2009 12:38:17 +0100"/>
                            <attachment id="12401927" name="pigStats.patch" size="61120" author="shubhamc" created="Wed, 11 Mar 2009 11:57:09 +0000"/>
                            <attachment id="12400865" name="pigStats.patch" size="71189" author="shubhamc" created="Tue, 24 Feb 2009 16:05:05 +0000"/>
                            <attachment id="12398369" name="pigStats.patch" size="53858" author="shubhamc" created="Wed, 21 Jan 2009 04:25:40 +0000"/>
                            <attachment id="12398225" name="pigStats.patch" size="53878" author="shubhamc" created="Mon, 19 Jan 2009 12:13:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 20 Jan 2009 19:33:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164215</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyah0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95069</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>