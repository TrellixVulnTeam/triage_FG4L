<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:01:08 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2593/PIG-2593.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2593] Filter by a boolean value does not work</title>
                <link>https://issues.apache.org/jira/browse/PIG-2593</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The following script does not work:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a = load &apos;allscalar10k&apos; as (name, age, gpa, instate);
b = filter a by instate;
explain b;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Exception:&lt;br/&gt;
ERROR 1200: &amp;lt;file 18.pig, line 2, column 23&amp;gt;  mismatched input &apos;;&apos; expecting IS&lt;/p&gt;

&lt;p&gt;org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1000: Error during parsing. &amp;lt;file 18.pig, line 2, column 23&amp;gt;  mismatched input &apos;;&apos; expecting IS&lt;br/&gt;
        at org.apache.pig.PigServer$Graph.parseQuery(PigServer.java:1598)&lt;br/&gt;
        at org.apache.pig.PigServer$Graph.registerQuery(PigServer.java:1541)&lt;br/&gt;
        at org.apache.pig.PigServer.registerQuery(PigServer.java:541)&lt;br/&gt;
        at org.apache.pig.tools.grunt.GruntParser.processPig(GruntParser.java:945)&lt;br/&gt;
        at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:392)&lt;br/&gt;
        at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:190)&lt;br/&gt;
        at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:166)&lt;br/&gt;
        at org.apache.pig.tools.grunt.Grunt.exec(Grunt.java:84)&lt;br/&gt;
        at org.apache.pig.Main.run(Main.java:599)&lt;br/&gt;
        at org.apache.pig.Main.main(Main.java:153)&lt;br/&gt;
Caused by: Failed to parse: &amp;lt;file 18.pig, line 2, column 23&amp;gt;  mismatched input &apos;;&apos; expecting IS&lt;br/&gt;
        at org.apache.pig.parser.QueryParserDriver.parse(QueryParserDriver.java:222)&lt;br/&gt;
        at org.apache.pig.parser.QueryParserDriver.parse(QueryParserDriver.java:164)&lt;br/&gt;
        at org.apache.pig.PigServer$Graph.parseQuery(PigServer.java:1590)&lt;br/&gt;
        ... 9 more&lt;/p&gt;

&lt;p&gt;It works if we change the script into:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a = load &apos;allscalar10k&apos; as (name, age, gpa, instate);
b = filter a by instate==TRUE;
explain b;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12546653">PIG-2593</key>
            <summary>Filter by a boolean value does not work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jay23jack">Jie Li</assignee>
                                    <reporter username="daijy">Daniel Dai</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Mar 2012 20:13:04 +0000</created>
                <updated>Fri, 22 Feb 2013 04:53:27 +0000</updated>
                            <resolved>Fri, 8 Jun 2012 19:42:23 +0100</resolved>
                                                    <fixVersion>0.11</fixVersion>
                                    <component>build</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                            <comments>
                            <comment id="13287596" author="jay23jack" created="Fri, 1 Jun 2012 19:49:31 +0100"  >&lt;p&gt;I got slightly different results:&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Case&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Description&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Query&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Result&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;declare as boolean and filter as boolean&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a = load &apos;allscalar10k&apos; as (name, age, gpa, instate:boolean);&lt;br/&gt;
b = filter a by instate==TRUE;&lt;br/&gt;
dump b;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;successful&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;explicitly cast to boolean&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a = load &apos;allscalar10k&apos; as (name, age, gpa, instate);&lt;br/&gt;
b = filter a by (boolean) instate == TRUE;&lt;br/&gt;
dump b;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;successful&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;implicitly conversion to string&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a = load &apos;allscalar10k&apos; as (name, age, gpa, instate);&lt;br/&gt;
b = filter a by instate == &apos;true&apos;;&lt;br/&gt;
dump b;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;successful&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;implicitly conversion to boolean&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a = load &apos;allscalar10k&apos; as (name, age, gpa, instate);&lt;br/&gt;
b = filter a by instate==TRUE;&lt;br/&gt;
dump b;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Error:In alias b, incompatible types in Equal Operator left hand side:bytearray right hand side:boolean&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;declare as boolean and filter&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; a = load &apos;allscalar10k&apos; as (name, age, gpa, instate:boolean);&lt;br/&gt;
b = filter a by instate;&lt;br/&gt;
dump b;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Error: &amp;lt;file 2.pig, line 2, column 23&amp;gt;  mismatched input &apos;;&apos; expecting IS&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;So we have two cases not working here. We want to make Case 4 work by supporting implicit conversion of boolean, as we&apos;ve already supported implicit conversion of chararray in Case 3.  Also it makes sense that Case 5 should work as boolean is a valid conditional expression.&lt;/p&gt;</comment>
                            <comment id="13287649" author="daijy" created="Fri, 1 Jun 2012 21:38:22 +0100"  >&lt;p&gt;Yes, you are right. We need to fix both 4 &amp;amp; 5.&lt;/p&gt;

&lt;p&gt;There exists some e2e test cases in FilterBoolean, which is disabled due to the issue. You can make use of them.&lt;/p&gt;</comment>
                            <comment id="13289662" author="jay23jack" created="Tue, 5 Jun 2012 20:33:03 +0100"  >&lt;p&gt;Fixed case 4 in the sub-task &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2736&quot; title=&quot;Support implicit cast from bytearray to boolean&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2736&quot;&gt;&lt;del&gt;PIG-2736&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;For case 5, one alternative is to rewrite the expression &quot;by instate&quot; to &quot;by instate == true;&quot; in QueryParser, but the downside is if instate is not a boolean type, then the error messages would be confusing: &quot;the left side is a xxx type and the right side is a boolean type&quot;, as there is actually no right side. Any means to customize the error message?&lt;/p&gt;

&lt;p&gt;Another alternative is to create a BooleanExpression to handle this case, which would involve more changes all the way from the parser to the physical operator.&lt;/p&gt;</comment>
                            <comment id="13289845" author="jay23jack" created="Wed, 6 Jun 2012 00:20:31 +0100"  >&lt;p&gt;Fixed case 5 in a light way: added a virtual node &quot;BOOL_COND&quot; in QueryParser and implemented it with the original expression in LogicalPlanGenerator. Will attach the patch soon.&lt;/p&gt;

&lt;p&gt;Actually there is a Case 6 in the e2e test:&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no schema and filter&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a = load &apos;allscalar10k&apos; as (name, age, gpa, instate);&lt;br/&gt;
b = filter a by instate;&lt;br/&gt;
dump b;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Error: &amp;lt;file 2.pig, line 9, column 4&amp;gt; Filter&apos;s condition must evaluate to boolean. Found: bytearray&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;After discussing with Daniel, we decided to leave this case for now, as it may require some heavy-weight changes.&lt;/p&gt;</comment>
                            <comment id="13290283" author="jay23jack" created="Wed, 6 Jun 2012 18:29:09 +0100"  >&lt;p&gt;Attached the patch of case 5. The patch for case 4 is in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2736&quot; title=&quot;Support implicit cast from bytearray to boolean&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2736&quot;&gt;&lt;del&gt;PIG-2736&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13291908" author="daijy" created="Fri, 8 Jun 2012 19:42:23 +0100"  >&lt;p&gt;All unit tests pass. &lt;/p&gt;

&lt;p&gt;Patch committed to trunk. Thanks Jie!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12531125" name="PIG-2593.patch" size="4742" author="jay23jack" created="Wed, 6 Jun 2012 18:29:09 +0100"/>
                    </attachments>
                <subtasks>
                            <subtask id="12559004">PIG-2736</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 1 Jun 2012 18:49:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>231811</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyaxxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97809</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>