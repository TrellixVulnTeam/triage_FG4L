<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:09:02 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2937/PIG-2937.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2937] generated field in nested foreach does not inherit the variable name as the field name</title>
                <link>https://issues.apache.org/jira/browse/PIG-2937</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
raw_data = load &apos;xyz&apos; using Loader() as (field_a, field_b, field_c);
records = foreach raw_data {
  generated_field = (field_a is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? &apos;-&apos; : someUDF(field_b)); 
  GENERATE
    field_c,
    generated_field
  ;
}
describe records;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;One would expect the generated_field to have a field name, similar to the field_c that is from the original relation. However, Pig currently doesn&apos;t assign the field name by default. It&apos;d be nice if we can assign the variable name as the default field name. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12609458">PIG-2937</key>
            <summary>generated field in nested foreach does not inherit the variable name as the field name</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jcoveney">Jonathan Coveney</assignee>
                                    <reporter username="pengfeng">Feng Peng</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Sep 2012 22:35:35 +0100</created>
                <updated>Fri, 22 Feb 2013 04:53:43 +0000</updated>
                            <resolved>Thu, 15 Nov 2012 00:39:55 +0000</resolved>
                                                    <fixVersion>0.11</fixVersion>
                    <fixVersion>0.12.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13481841" author="jcoveney" created="Mon, 22 Oct 2012 22:51:56 +0100"  >&lt;p&gt;This is definitely important and useful.&lt;/p&gt;

&lt;p&gt;To my eye, the way that this should work is that in any case where you don&apos;t have a schema (in this case, generated_field inside of the GENERATE) we should do our best to fill it in. In the case of a binary conditional, etc, we know the return type, so that gives us the type, and the field name (ie generated_field) would give us the name.&lt;/p&gt;

&lt;p&gt;I think that this is not a deep change, but it is a tricky one as getting Pig to thread through Schema information like this that isn&apos;t currently threaded through can be tricky.&lt;/p&gt;</comment>
                            <comment id="13483434" author="jcoveney" created="Wed, 24 Oct 2012 19:01:41 +0100"  >&lt;p&gt;I&apos;ve attached a patch that fixes this and passes test-commit.&lt;/p&gt;

&lt;p&gt;The approach it takes is in the case of a generate where you have a field referencing a valid LogicalExpression that for some reason does not have an alias associated with it (this is not common, only really happens afaik in the context Feng posted), then the alias name becomes the alias in the Schema.&lt;/p&gt;</comment>
                            <comment id="13483456" author="pengfeng" created="Wed, 24 Oct 2012 19:35:41 +0100"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jcoveney&quot; class=&quot;user-hover&quot; rel=&quot;jcoveney&quot;&gt;Jonathan Coveney&lt;/a&gt;!&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The change in ProjectExpression.java seems to be a whitespace change only.&lt;/li&gt;
	&lt;li&gt;The change in LogicalPlanBuilder.java seems to be a reasonable best-effort to me.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Non-comitter +1&lt;/p&gt;</comment>
                            <comment id="13483465" author="jcoveney" created="Wed, 24 Oct 2012 19:50:08 +0100"  >&lt;p&gt;I fixed a typo in ProjectExpression &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13487217" author="jcoveney" created="Tue, 30 Oct 2012 20:47:53 +0000"  >&lt;p&gt;Bump. Would love it if someone could take a look or opine&lt;/p&gt;</comment>
                            <comment id="13488045" author="pengfeng" created="Wed, 31 Oct 2012 18:18:23 +0000"  >&lt;p&gt;co-bump, can any committer take a look at the change? Thanks!&lt;/p&gt;</comment>
                            <comment id="13488444" author="rohini" created="Thu, 1 Nov 2012 04:07:17 +0000"  >&lt;p&gt;Jon, &lt;br/&gt;
   I compiled the logical plan for the given query with your patch. The schema for the generated field still does not have a variable name associated with it. Did not dig further to see where is the problem though. &lt;br/&gt;
   Also can we include a unit test? Thanks. &lt;/p&gt;</comment>
                            <comment id="13491969" author="jcoveney" created="Wed, 7 Nov 2012 00:05:42 +0000"  >&lt;p&gt;Rohini,&lt;/p&gt;

&lt;p&gt;Not sure what happened. I thought it worked locally, but maybe I was wrong. Either way, I uploaded a version that should work. Would love some eyes. Thanks!&lt;/p&gt;</comment>
                            <comment id="13494830" author="rohini" created="Sun, 11 Nov 2012 05:33:28 +0000"  >&lt;p&gt;Sorry about the delay Jon. The patch looks good and the logical plan schema is now correct. It would be good if we can add a testcase. Just had a recent reminder from Santhosh to do a +1 after ensuring there is a unit test. &lt;/p&gt;</comment>
                            <comment id="13496660" author="jcoveney" created="Tue, 13 Nov 2012 23:18:59 +0000"  >&lt;p&gt;Rohini,&lt;/p&gt;

&lt;p&gt;Thanks for taking a look. I&apos;ve attached a patch with and without whitespace changes. I added a test, and refactored TestLogicalPlanGenerator (where I put the test) a little bit. The patch without whitespace is to make reviewing easier.&lt;/p&gt;

&lt;p&gt;Please let me know your thoughts.&lt;/p&gt;</comment>
                            <comment id="13497319" author="rohini" created="Wed, 14 Nov 2012 18:28:17 +0000"  >&lt;p&gt;Thanks Jon. +1. Patch looks good. &lt;/p&gt;

&lt;p&gt;Minor nitpick I have is that it would be nice to give the test a more relevant name than testAutomaticallyMadeName. Something like testRelationAliasForBinCond. But I am not going to insist. &lt;/p&gt;</comment>
                            <comment id="13497329" author="jcoveney" created="Wed, 14 Nov 2012 18:38:20 +0000"  >&lt;p&gt;I am horrible at naming. I&apos;ll change the name to something more like that, and then commit.&lt;/p&gt;</comment>
                            <comment id="13497417" author="pengfeng" created="Wed, 14 Nov 2012 20:29:08 +0000"  >&lt;p&gt;Great, thanks guys!&lt;/p&gt;</comment>
                            <comment id="13497651" author="jcoveney" created="Thu, 15 Nov 2012 00:39:55 +0000"  >&lt;p&gt;It&apos;s in. Thanks Rohini!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12550657" name="PIG-2937-0.patch" size="2105" author="jcoveney" created="Wed, 24 Oct 2012 19:01:41 +0100"/>
                            <attachment id="12550660" name="PIG-2937-1.patch" size="2105" author="jcoveney" created="Wed, 24 Oct 2012 19:21:27 +0100"/>
                            <attachment id="12552367" name="PIG-2937-2.patch" size="3896" author="jcoveney" created="Wed, 7 Nov 2012 00:05:42 +0000"/>
                            <attachment id="12553402" name="PIG-2937-3_nowhitespace.patch" size="23867" author="jcoveney" created="Tue, 13 Nov 2012 23:18:59 +0000"/>
                            <attachment id="12553403" name="PIG-2937-3_whitespace.patch" size="74321" author="jcoveney" created="Tue, 13 Nov 2012 23:18:59 +0000"/>
                            <attachment id="12553596" name="PIG-2937-4_whitespace.patch" size="74313" author="jcoveney" created="Thu, 15 Nov 2012 00:30:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 22 Oct 2012 21:51:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242087</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxwd5b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12617</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>