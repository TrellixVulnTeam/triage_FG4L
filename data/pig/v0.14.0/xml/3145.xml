<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:05:57 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3145/PIG-3145.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3145] Parameters in core-site.xml and mapred-site.xml are not correctly substituted</title>
                <link>https://issues.apache.org/jira/browse/PIG-3145</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;To reproduce the issue, please do the following:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Parameterize the address of name node in core-site.xml.
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &amp;lt;property&amp;gt;
    &amp;lt;name&amp;gt;fs.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.name&amp;lt;/name&amp;gt;
    &amp;lt;value&amp;gt;hdfs:&lt;span class=&quot;code-comment&quot;&gt;//${foo}:8020&amp;lt;/value&amp;gt;
&lt;/span&gt;  &amp;lt;/property&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Set the value of &quot;foo&quot; via -D option.
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
export PIG_OPTS=&lt;span class=&quot;code-quote&quot;&gt;&quot;-Dfoo=mr1-0.cheolsoo.com&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Pig fails with the following error.
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2013-01-28 18:54:02,786 [main] INFO  org.apache.pig.backend.hadoop.executionengine.HExecutionEngine - Connecting to hadoop file system at: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//${foo}:8020
&lt;/span&gt;2013-01-28 18:54:02,805 [main] ERROR org.apache.pig.Main - ERROR 2999: Unexpected internal error. &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
Details at logfile: /home/cheolsoo/pig-cdh/pig_1359428042522.log
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Note that the parameter ${foo} in core-site.xml is not expanded. This is because the addresses of name node and job tracker are read directly from core-site.xml instead of reading via Configuration.get().&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;HExecutionEngine.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// properties is Java Properties
&lt;/span&gt;cluster = properties.getProperty(JOB_TRACKER_LOCATION);
nameNode = properties.getProperty(FILE_SYSTEM_LOCATION);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Replacing these lines with Configuration.get() fixes the issue.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;HExecutionEngine.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// jc is Hadoop Configuration
&lt;/span&gt;cluster = jc.get(JOB_TRACKER_LOCATION);
nameNode = jc.get(FILE_SYSTEM_LOCATION);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="12629628">PIG-3145</key>
            <summary>Parameters in core-site.xml and mapred-site.xml are not correctly substituted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cheolsoo">Cheolsoo Park</assignee>
                                    <reporter username="cheolsoo">Cheolsoo Park</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Jan 2013 03:10:58 +0000</created>
                <updated>Mon, 14 Oct 2013 17:45:54 +0100</updated>
                            <resolved>Tue, 26 Feb 2013 00:32:04 +0000</resolved>
                                                    <fixVersion>0.12.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13565033" author="prkommireddi" created="Tue, 29 Jan 2013 03:15:37 +0000"  >&lt;p&gt;Hi Cheolsoo, this might also be in a similar category as &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3135&quot; title=&quot;HExecutionEngine should look for resources in user passed Properties&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3135&quot;&gt;&lt;del&gt;PIG-3135&lt;/del&gt;&lt;/a&gt;. Currently Pig expects the site xml files on the classpath - again Configuration is not used.&lt;/p&gt;</comment>
                            <comment id="13565038" author="cheolsoo" created="Tue, 29 Jan 2013 03:26:09 +0000"  >&lt;p&gt;Hi Prashant,&lt;/p&gt;

&lt;p&gt;Thank you very much for pointing that out.&lt;/p&gt;

&lt;p&gt;Indeed, PIg-3135 is in a similar category, but but I think that my problem is a bit different from yours. In my case, *-site.xml files are present in classpath, but system properties (-Dkey=value) that are passed to JVM are not honored. They are different, aren&apos;t they?&lt;/p&gt;</comment>
                            <comment id="13565042" author="prkommireddi" created="Tue, 29 Jan 2013 03:30:21 +0000"  >&lt;p&gt;Agreed. I am guessing your changes would go into HExecutionEngine primarily. Would be good to get both changes in around the same time.&lt;/p&gt;</comment>
                            <comment id="13566715" author="cheolsoo" created="Wed, 30 Jan 2013 18:18:27 +0000"  >&lt;p&gt;Attached is a patch that includes proposed changes.&lt;/p&gt;

&lt;p&gt;Note that I also removed 4 lines of &lt;tt&gt;properties.setProperty()&lt;/tt&gt; for local mode. This is because they&apos;re redundant as those properties are loaded from *-default.xml files.&lt;/p&gt;

&lt;p&gt;I ran commit-test with both hadoop 20 and 23 and saw no failures. To be safe, I will run a full suite of unit test as well.&lt;/p&gt;</comment>
                            <comment id="13566856" author="jarcec" created="Wed, 30 Jan 2013 20:03:03 +0000"  >&lt;p&gt;+1 (non-binding)&lt;/p&gt;

&lt;p&gt;The change seems reasonable to me. &lt;/p&gt;

&lt;p&gt;Jarcec&lt;/p&gt;</comment>
                            <comment id="13569087" author="cheolsoo" created="Fri, 1 Feb 2013 21:11:15 +0000"  >&lt;p&gt;I ran full unit test and e2e test and found no regression.&lt;/p&gt;

&lt;p&gt;Note that the following test cases are failing in trunk:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;org.apache.pig.test.TestScriptUDF &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3153&quot; title=&quot;TestScriptUDF.testJavascriptExampleScript fails in trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3153&quot;&gt;&lt;del&gt;PIG-3153&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;org.apache.pig.test.TestPackage &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3154&quot; title=&quot;TestPackage.testOperator fails in trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3154&quot;&gt;&lt;del&gt;PIG-3154&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;org.apache.pig.test.TestTypeCheckingValidatorNewLP &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3155&quot; title=&quot;TestTypeCheckingValidatorNewLP.testSortWithInnerPlan3 fails in trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3155&quot;&gt;&lt;del&gt;PIG-3155&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;org.apache.pig.data.TestSchemaTuple &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3156&quot; title=&quot;TestSchemaTuple fails in trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3156&quot;&gt;&lt;del&gt;PIG-3156&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;However, they are not relevant, and I filed jiras for them.&lt;/p&gt;</comment>
                            <comment id="13569146" author="sms" created="Fri, 1 Feb 2013 21:58:39 +0000"  >&lt;p&gt;+1 - the changes look good.&lt;/p&gt;</comment>
                            <comment id="13569181" author="cheolsoo" created="Fri, 1 Feb 2013 22:38:23 +0000"  >&lt;p&gt;Thank you Santhosh for the review. Committed to trunk.&lt;/p&gt;</comment>
                            <comment id="13575569" author="cheolsoo" created="Sun, 10 Feb 2013 23:02:57 +0000"  >&lt;p&gt;I realized that my patch broke TestHBaseStorage. I will back out and rework it.&lt;/p&gt;</comment>
                            <comment id="13581802" author="cheolsoo" created="Wed, 20 Feb 2013 00:27:45 +0000"  >&lt;p&gt;Attaching a patch that fixes TestHBaseStorage.&lt;/p&gt;

&lt;p&gt;In my previous patch, I removed the following lines:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
properties.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;mapreduce.framework.name&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;local&quot;&lt;/span&gt;);
properties.setProperty(JOB_TRACKER_LOCATION, LOCAL );
properties.setProperty(FILE_SYSTEM_LOCATION, &lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;///&quot;&lt;/span&gt;);
&lt;/span&gt;properties.setProperty(ALTERNATIVE_FILE_SYSTEM_LOCATION, &lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;///&quot;&lt;/span&gt;);&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But that causes a problem when PigServer is constructed in local mode with the mini-cluster-generated configuration because fs.default.name and mapred.job.tracker are set to mini-cluster-values while PigServer runs in local mode.&lt;/p&gt;

&lt;p&gt;In my new patch, I not only kept these lines but also moved them before  &quot;recomputeProperties(jc, properties);&quot;, so fs.default.name and mapred.job.tracker in JobConf will be always overwritten in local mode.&lt;/p&gt;

&lt;p&gt;Now in local mode JobConf always returns &quot;file:///&quot; and &quot;local&quot; regardless whether configuration is passed to the PigServer constructor or not.&lt;/p&gt;

&lt;p&gt;I am running full unit test now.&lt;/p&gt;</comment>
                            <comment id="13586476" author="cheolsoo" created="Mon, 25 Feb 2013 23:45:35 +0000"  >&lt;p&gt;To be clear, I ran unit test with hadoop23 which excludes TestHBaseStorage. That&apos;s why I didn&apos;t identify the issue.&lt;/p&gt;

&lt;p&gt;Using my new patch, I can verify that TestHBaseStorage passes with hadoop20. &lt;/p&gt;</comment>
                            <comment id="13586480" author="sms" created="Mon, 25 Feb 2013 23:49:10 +0000"  >&lt;p&gt;The patch looks good. Chatted offline with Cheolsoo about how this was missed in the first place and he has explained that in his previous comment. The unit tests were run for Hadoop 23 which excluded TestHBaseStorage. However, it failed for Hadoop 20. This is now fixed.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13586521" author="cheolsoo" created="Tue, 26 Feb 2013 00:32:04 +0000"  >&lt;p&gt;Committed to trunk again. Thank you Santhosh for the review!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12570033" name="PIG-3145-2.patch" size="1730" author="cheolsoo" created="Wed, 20 Feb 2013 00:27:45 +0000"/>
                            <attachment id="12567177" name="PIG-3145.patch" size="1230" author="cheolsoo" created="Wed, 30 Jan 2013 18:18:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 29 Jan 2013 03:15:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310124</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzbdef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310469</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>