<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:51:16 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1605/PIG-1605.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1605] Adding soft link to plan to solve input file dependency</title>
                <link>https://issues.apache.org/jira/browse/PIG-1605</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;In scalar implementation, we need to deal with implicit dependencies. &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1603&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;PIG-1603&lt;/a&gt; is trying to solve the problem by adding a LOScalar operator. Here is a different approach. We will add a soft link to the plan, and soft link is only visible to the walkers. By doing this, we can make sure we visit LOStore which generate scalar first, and then LOForEach which use the scalar. All other part of the logical plan does not know the existence of the soft link. The benefits are:&lt;/p&gt;

&lt;p&gt;1. Logical plan do not need to deal with LOScalar, this makes logical plan cleaner&lt;br/&gt;
2. Conceptually scalar dependency is different. Regular link represent a data flow in pipeline. In scalar, the dependency means an operator depends on a file generated by the other operator. It&apos;s different type of data dependency.&lt;br/&gt;
3. Soft link can solve other dependency problem in the future. If we introduce another UDF dependent on a file generated by another operator, we can use this mechanism to solve it. &lt;br/&gt;
4. With soft link, we can use scalar come from different sources in the same statement, which in my mind is not a rare use case. (eg: D = foreach C generate c0/A.total, c1/B.count; )&lt;/p&gt;

&lt;p&gt;Currently, there are two cases we can use soft link:&lt;br/&gt;
1. scalar dependency, where ReadScalar UDF will use a file generate by a LOStore&lt;br/&gt;
2. store-load dependency, where we will load a file which is generated by a store in the same script. This happens in multi-store case. Currently we solve it by regular link. It is better to use a soft link.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12473836">PIG-1605</key>
            <summary>Adding soft link to plan to solve input file dependency</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="daijy">Daniel Dai</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Sep 2010 19:01:40 +0100</created>
                <updated>Fri, 17 Dec 2010 22:45:40 +0000</updated>
                            <resolved>Wed, 22 Sep 2010 06:46:25 +0100</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12908900" author="thejas" created="Mon, 13 Sep 2010 19:28:03 +0100"  >&lt;blockquote&gt;&lt;p&gt;4. With soft link, we can use scalar come from different sources in the same statement, which in my mind is not a rare use case. (eg: D = foreach C generate c0/A.total, c1/B.count; )&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This works with LOScalar as well. For above example, there will be two LOScalar operators preceding the LogicalOperator for D. It will be like - &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
C -&amp;gt; LOScalar -&amp;gt; LOScalar -&amp;gt; D .
     A _^         B_^
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12908906" author="thejas" created="Mon, 13 Sep 2010 19:33:38 +0100"  >&lt;p&gt;I think the first three benefits mentioned here are good reason to go for this approach instead of LOScalar.  &lt;/p&gt;</comment>
                            <comment id="12908937" author="alangates" created="Mon, 13 Sep 2010 20:10:10 +0100"  >&lt;p&gt;How in depth are the changes to the graphing package and the walkers to handle this different type of edge in the graph?&lt;/p&gt;</comment>
                            <comment id="12909007" author="daijy" created="Mon, 13 Sep 2010 22:27:04 +0100"  >&lt;p&gt;Changes are reasonably small. Here is a summary:&lt;br/&gt;
1. Add the following methods to the plan (both old and new):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void createSoftLink(E from, E to)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; List&amp;lt;E&amp;gt; getSoftLinkPredecessors(E op)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; List&amp;lt;E&amp;gt; getSoftLinkSuccessors(E op)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2. All walkers need to change. When walker get predecessors/successors, it need to get both soft/regular link predecessors. The changes are straight forward, eg&lt;br/&gt;
from:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Collection&amp;lt;O&amp;gt; newSuccessors = mPlan.getSuccessors(suc);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Collection&amp;lt;O&amp;gt; newSuccessors = mPlan.getSuccessors(suc);
newSuccessors.addAll(mPlan.getSoftLinkSuccessors(suc));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3. Change plan utility functions, such as replace, replaceAndAddSucessors, replaceAndAddPredecessors, etc&lt;br/&gt;
In new logical plan, there is no change since we only have minimum utility functions. In old logical plan, there should be some change to make those utility functions aware of soft link, but if we decide not support old logical plan going forward, no change needed, only need to note those utility functions does not deal with soft link within the function.&lt;/p&gt;

&lt;p&gt;4. Change scalar to use soft link&lt;br/&gt;
This include creating soft link, maintaining soft link when doing transform (migrating to new plan, translating to physical plan). &lt;/p&gt;

&lt;p&gt;5. Change store-load to use soft link&lt;br/&gt;
This is an optional step. Currently we use regular link, conceptually we shall use soft link. It is Ok if we don&apos;t do this for now.&lt;/p&gt;

&lt;p&gt;Also note in most cases, there is no soft link, the plan will behave just like before, so this change should be safe enough.&lt;/p&gt;</comment>
                            <comment id="12909008" author="daijy" created="Mon, 13 Sep 2010 22:27:48 +0100"  >&lt;p&gt;Yes, Thejas is right. The first 3 are the main reasons for the change.&lt;/p&gt;</comment>
                            <comment id="12913335" author="thejas" created="Wed, 22 Sep 2010 02:04:03 +0100"  >&lt;p&gt;Looks good. +1&lt;br/&gt;
Possible optimizations - (can be done in future )-&lt;br/&gt;
1. If column-pruning rule removes the relation-as-scalar column, then the soft-link can be removed.&lt;br/&gt;
2. split-filter rule will be disabled if it has a relation-as-scalar in the filter expression. If we filter expressions has the relation-as-scalar and update soft-links accordingly, we don&apos;t need to disable this rule.&lt;/p&gt;</comment>
                            <comment id="12913405" author="daijy" created="Wed, 22 Sep 2010 06:40:55 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1605&quot; title=&quot;Adding soft link to plan to solve input file dependency&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1605&quot;&gt;&lt;del&gt;PIG-1605&lt;/del&gt;&lt;/a&gt;-2.patch fix findbug warnings.&lt;/p&gt;

&lt;p&gt;test-patch result:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; -1 overall.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 @author.  The patch does not contain any @author tags.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 tests included.  The patch appears to include 6 new or modified tests.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     -1 release audit.  The applied patch generated 455 release audit warnings (more than the trunk&apos;s current 453 warning&lt;br/&gt;
s).&lt;/p&gt;</comment>
                            <comment id="12913408" author="daijy" created="Wed, 22 Sep 2010 06:46:25 +0100"  >&lt;p&gt;Release audit warning is due to jdiff. No new file added. Patch committed to both trunk and 0.8 branch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12455166" name="PIG-1605-1.patch" size="81578" author="daijy" created="Tue, 21 Sep 2010 19:09:13 +0100"/>
                            <attachment id="12455236" name="PIG-1605-2.patch" size="82478" author="daijy" created="Wed, 22 Sep 2010 06:40:55 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 13 Sep 2010 18:28:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>165071</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyas8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96886</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>