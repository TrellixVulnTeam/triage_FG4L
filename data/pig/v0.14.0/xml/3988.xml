<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:09:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3988/PIG-3988.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3988] PigStorage: CommandLineParser is not thread safe</title>
                <link>https://issues.apache.org/jira/browse/PIG-3988</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;PigStorage uses commons-cli to parse options. The CommandLineParser is stored as a static member. This can cause issues when two threads instantiate PigStorage at the same time, since CommandLineParser stores state in a non-thread-safe way.&lt;/p&gt;

&lt;p&gt;OptionBuilder, used in populateValidOptions(), is also not thread safe, as it stores its state in static members.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12718882">PIG-3988</key>
            <summary>PigStorage: CommandLineParser is not thread safe</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tmwoodruff">Travis Woodruff</assignee>
                                    <reporter username="tmwoodruff">Travis Woodruff</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Jun 2014 17:55:19 +0100</created>
                <updated>Fri, 21 Nov 2014 05:58:39 +0000</updated>
                            <resolved>Wed, 11 Jun 2014 20:27:59 +0100</resolved>
                                    <version>0.13.0</version>
                                    <fixVersion>0.14.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14020113" author="tmwoodruff" created="Fri, 6 Jun 2014 18:40:56 +0100"  >&lt;p&gt;This patch moves the option parsing members to local variables in the constructor, since that&apos;s the only place they&apos;re used. Since the CommandLineParser is no longer static, access by multiple threads is no longer an issue.&lt;/p&gt;

&lt;p&gt;It also removes use of the OptionBuilder class and configures the Option via setters instead.&lt;/p&gt;</comment>
                            <comment id="14021025" author="cheolsoo" created="Sun, 8 Jun 2014 00:49:11 +0100"  >&lt;p&gt;+1. Thank you for the patch!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tmwoodruff&quot; class=&quot;user-hover&quot; rel=&quot;tmwoodruff&quot;&gt;Travis Woodruff&lt;/a&gt;, do you mind committing this patch into 0.14 instead of 0.13? Given we&apos;re in the middle of release process, I&apos;d like to avoid any commit into 0.13 except test failures and critical bug fixes.&lt;/p&gt;</comment>
                            <comment id="14021041" author="cheolsoo" created="Sun, 8 Jun 2014 01:53:53 +0100"  >&lt;p&gt;Committed to trunk.&lt;/p&gt;</comment>
                            <comment id="14021063" author="tmwoodruff" created="Sun, 8 Jun 2014 03:56:13 +0100"  >&lt;p&gt;0.14 is fine. Thanks.&lt;/p&gt;</comment>
                            <comment id="14028094" author="rohini" created="Wed, 11 Jun 2014 18:47:38 +0100"  >&lt;p&gt;Encountered this exception in line Option overwrite = new Option(null, &quot;Overwrites the destination.&quot;); in PigStorage.java while running from eclipse. It was because commons-cli-1.0.jar was in my classpath.  Passes while running TestPigStorage though as it has commons-cli-1.2.jar which was only recently upgraded in pig.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.IllegalArgumentException: opt is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.commons.cli.Option.validateOption(Option.java:159)
	at org.apache.commons.cli.Option.&amp;lt;init&amp;gt;(Option.java:250)
	at org.apache.commons.cli.Option.&amp;lt;init&amp;gt;(Option.java:222)
	at org.apache.pig.builtin.PigStorage.populateValidOptions(PigStorage.java:167)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What is the reason behind changing &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Option overwrite = OptionBuilder.hasOptionalArgs(1).withArgName(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;).withLongOpt(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;).withDescription(&lt;span class=&quot;code-quote&quot;&gt;&quot;Overwrites the destination.&quot;&lt;/span&gt;).create();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Option overwrite = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Option(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Overwrites the destination.&quot;&lt;/span&gt;);
        overwrite.setLongOpt(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;);
        overwrite.setOptionalArg(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        overwrite.setArgs(1);
        overwrite.setArgName(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I don&apos;t see a difference. We should revert back so that it is backward compatible with commons-cli-1.0.jar as well&lt;/p&gt;</comment>
                            <comment id="14028212" author="tmwoodruff" created="Wed, 11 Jun 2014 19:51:35 +0100"  >&lt;p&gt;Looks like commons-cli 1.0 passes &quot; &quot; instead of null to the Option constructor in OptionBuilder. &lt;/p&gt;

&lt;p&gt;Attaching &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3988&quot; title=&quot;PigStorage: CommandLineParser is not thread safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3988&quot;&gt;&lt;del&gt;PIG-3988&lt;/del&gt;&lt;/a&gt;-2.patch. This is a patch on trunk (assumes no revert of previous patch).&lt;/p&gt;

&lt;p&gt;Tested and working on both commons-cli 1.0 and 1.2.&lt;/p&gt;</comment>
                            <comment id="14028217" author="tmwoodruff" created="Wed, 11 Jun 2014 19:53:24 +0100"  >&lt;p&gt;Reason behind change is that OptionBuilder is not thread safe (&lt;a href=&quot;https://issues.apache.org/jira/browse/CLI-209&quot; title=&quot;OptionBuilder is not thread-safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CLI-209&quot;&gt;&lt;del&gt;CLI-209&lt;/del&gt;&lt;/a&gt;). We encounter sporadic exceptions due to this.&lt;/p&gt;
</comment>
                            <comment id="14028242" author="rohini" created="Wed, 11 Jun 2014 20:07:03 +0100"  >&lt;p&gt;&amp;gt; Reason behind change is that OptionBuilder is not thread safe&lt;br/&gt;
  Thanks for the clarification. My mistake as I din&apos;t pay attention to the jira description. Will commit the change. &lt;/p&gt;</comment>
                            <comment id="14028272" author="rohini" created="Wed, 11 Jun 2014 20:27:59 +0100"  >&lt;p&gt;Committed &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3988&quot; title=&quot;PigStorage: CommandLineParser is not thread safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3988&quot;&gt;&lt;del&gt;PIG-3988&lt;/del&gt;&lt;/a&gt;-2.patch which fixes the IllegalArgumentException to trunk. Thanks Travis.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12648659" name="PIG-3988-1.patch" size="2857" author="tmwoodruff" created="Fri, 6 Jun 2014 17:59:20 +0100"/>
                            <attachment id="12649848" name="PIG-3988-2.patch" size="1212" author="tmwoodruff" created="Wed, 11 Jun 2014 19:51:35 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 7 Jun 2014 23:49:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>397081</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzq7w7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>397204</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>