<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:58:12 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3463/PIG-3463.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3463] Pig should use hadoop local mode for small jobs</title>
                <link>https://issues.apache.org/jira/browse/PIG-3463</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Pig should use hadoop local mode for small jobs - few mappers, few reducers and few mb of data.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12669121">PIG-3463</key>
            <summary>Pig should use hadoop local mode for small jobs</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aniket486">Aniket Mokashi</assignee>
                                    <reporter username="aniket486">Aniket Mokashi</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Sep 2013 22:21:27 +0100</created>
                <updated>Mon, 7 Jul 2014 19:07:53 +0100</updated>
                            <resolved>Wed, 22 Jan 2014 08:54:14 +0000</resolved>
                                    <version>0.11.1</version>
                                    <fixVersion>0.13.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13872710" author="aniket486" created="Wed, 15 Jan 2014 22:32:51 +0000"  >&lt;p&gt;If pig.auto.local.enabled is set, JCC will modify Configuration of all the jobs with one reducer and input size less than pig.auto.local.input.maxbytes, so that they are forced to run in local mode. Output of local run is also written to hdfs.&lt;/p&gt;</comment>
                            <comment id="13872724" author="aniket486" created="Wed, 15 Jan 2014 22:37:39 +0000"  >&lt;p&gt;Tried few scenarios with the patch-&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Load small data, group all, count - works in local mode.&lt;/li&gt;
	&lt;li&gt;Load small data, another small data and replicated join - works in local mode.&lt;/li&gt;
	&lt;li&gt;Load small data and order by key - all 3 jobs work in local mode and .&lt;/li&gt;
	&lt;li&gt;Load small data and large data for replicated join - first job runs in local mode, second runs in MR mode.&lt;/li&gt;
	&lt;li&gt;Load large data and order by key - works in first stage in MR mode and last stages in local mode.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13875473" author="daijy" created="Sat, 18 Jan 2014 01:24:17 +0000"  >&lt;p&gt;RB link: &lt;a href=&quot;https://reviews.apache.org/r/16928/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/16928/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13878165" author="cheolsoo" created="Wed, 22 Jan 2014 02:16:35 +0000"  >&lt;p&gt;+1. All unit tests pass!&lt;/p&gt;</comment>
                            <comment id="13878183" author="aniket486" created="Wed, 22 Jan 2014 02:52:10 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt; for the review and testing!&lt;br/&gt;
Let me commit this.&lt;/p&gt;</comment>
                            <comment id="13878416" author="aniket486" created="Wed, 22 Jan 2014 08:54:01 +0000"  >&lt;p&gt;Committed to trunk. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;Daniel Dai&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt; for the review!&lt;/p&gt;

&lt;p&gt;Also, thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dvryaboy&quot; class=&quot;user-hover&quot; rel=&quot;dvryaboy&quot;&gt;Dmitriy V. Ryaboy&lt;/a&gt; for the original patch on this.&lt;/p&gt;</comment>
                            <comment id="13904486" author="saurfang" created="Tue, 18 Feb 2014 19:48:30 +0000"  >&lt;p&gt;Aniket, thanks a lot for making this wonderful feature!&lt;/p&gt;

&lt;p&gt;However, I had some issues when testing it. It seems that it would fail on a MapOnly task (i.e. 0 reducers). An trivial example of such job would be load a small data and immediately store them back. I&apos;m using Hadoop 2.2 so I&apos;m not sure if that has anything to do with this issue.&lt;/p&gt;

&lt;p&gt;The reason reported was that Hadoop expects the Map output format to be LongWritable, Text while the actual output format are PigNullableWritable,Writable. In this case, the PigMapOnly.java passes null,Tuple to collect.&lt;/p&gt;

&lt;p&gt;java.lang.Exception: java.io.IOException: Type mismatch in value from map: expec&lt;br/&gt;
ted org.apache.hadoop.io.Text, received org.apache.pig.data.BinSedesTuple&lt;br/&gt;
        at org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:4&lt;br/&gt;
03)&lt;br/&gt;
Caused by: java.io.IOException: Type mismatch in value from map: expected org.ap&lt;br/&gt;
ache.hadoop.io.Text, received org.apache.pig.data.BinSedesTuple&lt;br/&gt;
        at org.apache.hadoop.mapred.MapTask$MapOutputBuffer.collect(MapTask.java&lt;br/&gt;
:1055)&lt;br/&gt;
        at org.apache.hadoop.mapred.MapTask$NewOutputCollector.write(MapTask.jav&lt;br/&gt;
a:691)&lt;br/&gt;
        at org.apache.hadoop.mapreduce.task.TaskInputOutputContextImpl.write(Tas&lt;br/&gt;
kInputOutputContextImpl.java:89)&lt;br/&gt;
        at org.apache.hadoop.mapreduce.lib.map.WrappedMapper$Context.write(Wrapp&lt;br/&gt;
edMapper.java:112)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigMapOn&lt;br/&gt;
ly$Map.collect(PigMapOnly.java:48)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGener&lt;br/&gt;
icMapBase.runPipeline(PigGenericMapBase.java:284)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGener&lt;br/&gt;
icMapBase.map(PigGenericMapBase.java:277)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGener&lt;br/&gt;
icMapBase.map(PigGenericMapBase.java:64)&lt;br/&gt;
        at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:145)&lt;br/&gt;
        at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:763)&lt;br/&gt;
        at org.apache.hadoop.mapred.MapTask.run(MapTask.java:339)&lt;br/&gt;
        at org.apache.hadoop.mapred.LocalJobRunner$Job$MapTaskRunnable.run(Local&lt;br/&gt;
JobRunner.java:235)&lt;br/&gt;
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:47&lt;br/&gt;
1)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:166)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.&lt;br/&gt;
java:1145)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor&lt;br/&gt;
.java:615)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:724)&lt;/p&gt;

&lt;p&gt;I did find a solution: I moved the local mode conversion code block couple lines above and I think this might have to do with the way Mapper/Reducer plans are processed. I don&apos;t know enough to make any firm conclusion and have attached my patch for you to review.&lt;/p&gt;</comment>
                            <comment id="13904489" author="saurfang" created="Tue, 18 Feb 2014 19:49:46 +0000"  >&lt;p&gt;This patch moves the local mode conversion block around to work around a bug causing Map only task to fial.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12693464">PIG-3745</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12722360">PIG-4021</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12629609" name="JobControlCompiler.java.patch" size="5575" author="saurfang" created="Tue, 18 Feb 2014 19:49:46 +0000"/>
                            <attachment id="12623240" name="PIG-3463-1.patch" size="58778" author="aniket486" created="Wed, 15 Jan 2014 22:01:32 +0000"/>
                            <attachment id="12623494" name="PIG-3463-3.patch" size="76310" author="aniket486" created="Thu, 16 Jan 2014 22:02:07 +0000"/>
                            <attachment id="12624304" name="PIG-3463-6.patch" size="70635" author="aniket486" created="Wed, 22 Jan 2014 08:50:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 18 Jan 2014 01:24:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>349053</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzi14f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>349351</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>