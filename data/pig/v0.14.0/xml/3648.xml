<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:57:31 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3648/PIG-3648.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3648] Make the sample size for RandomSampleLoader configurable</title>
                <link>https://issues.apache.org/jira/browse/PIG-3648</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Pig uses RandomSampleLoader for range partitioning in order-by. But since the sample size is hardcoded as 100, volatility in the variance of the results  increases when sorting a large number of rows (e.g. 10M+ per task).&lt;/p&gt;

&lt;p&gt;It would be nice if the sample size could be configurable via Pig properties.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12687379">PIG-3648</key>
            <summary>Make the sample size for RandomSampleLoader configurable</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cheolsoo">Cheolsoo Park</assignee>
                                    <reporter username="cheolsoo">Cheolsoo Park</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Jan 2014 01:27:35 +0000</created>
                <updated>Mon, 7 Jul 2014 19:07:53 +0100</updated>
                            <resolved>Tue, 18 Feb 2014 19:24:59 +0000</resolved>
                                                    <fixVersion>0.13.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13862714" author="cheolsoo" created="Mon, 6 Jan 2014 01:31:38 +0000"  >&lt;p&gt;Attached is a patch that introduces a new property called &quot;pig.random.sampler.sample.size&quot;.&lt;/p&gt;</comment>
                            <comment id="13863497" author="aniket486" created="Mon, 6 Jan 2014 22:12:54 +0000"  >&lt;p&gt;+1.&lt;/p&gt;

&lt;p&gt;There is a typo in comments - RandomeSampleLoader, otherwise, patch looks good.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;volatility in the variance of the results increases when sorting a large number of rows&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Can you give an example when this happens? Sampling algo looks good to me. Also, we want to keep number of samples less, so that we can replace this mechanism in future if needed.&lt;/p&gt;</comment>
                            <comment id="13863684" author="mbossenbroek" created="Tue, 7 Jan 2014 00:17:02 +0000"  >&lt;p&gt;I came across this issue while trying to order data with a large number of reducers. The last reducer ended up with 10x the data of the other reducers and took 10x longer to execute.&lt;/p&gt;

&lt;p&gt;I ran some statistical simulations on the selection algo and found that with a small sample size, the likelihood of a less than uniform sample distribution was higher. In my example, it was selecting only 100 rows out of 13M, which wasn&apos;t representative of the data.&lt;/p&gt;

&lt;p&gt;I can provide the sample code I was using to test this if needed.&lt;/p&gt;
</comment>
                            <comment id="13863707" author="rohini" created="Tue, 7 Jan 2014 00:34:08 +0000"  >&lt;p&gt;+1.  Agree that it obviously makes sense to have large sample size for larger data - &lt;a href=&quot;http://en.wikipedia.org/wiki/Sample_size_determination#Introduction&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://en.wikipedia.org/wiki/Sample_size_determination#Introduction&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13863730" author="aniket486" created="Tue, 7 Jan 2014 00:49:45 +0000"  >&lt;p&gt;We are using reservoir sampling here, with assumption that the number of samples fit in memory. My only question/concern is how much benefit does increasing sample size provide here.&lt;br/&gt;
In your example- 100 samples on 13M rows had 10x skew. Does 200 samples make it 5x skew or less? If it does, doing this definitely makes sense.&lt;/p&gt;</comment>
                            <comment id="13863749" author="rohini" created="Tue, 7 Jan 2014 01:04:41 +0000"  >&lt;p&gt;Is memory a big concern really w.r.t to number of samples? I haven&apos;t checked but I am assuming we will only have the orderby key in the sample and not entire tuple and that would not amount to much in terms of occupying memory. Is that wrong?&lt;/p&gt;</comment>
                            <comment id="13863761" author="aniket486" created="Tue, 7 Jan 2014 01:17:16 +0000"  >&lt;p&gt;Memory is not a concern. I&apos;m suspecting that there is not much benefit of keeping this configurable. Obviously, no harm, if we configure it right.&lt;/p&gt;</comment>
                            <comment id="13863770" author="rohini" created="Tue, 7 Jan 2014 01:25:32 +0000"  >&lt;p&gt;I don&apos;t think it is possible to configure it right unless we store statistics on the total number of records (using something like hraven) and use that to determine the sample size as a proportion dynamically. Otherwise the best option is to let the user specify a sample size as we don&apos;t know the number of records until the map completes. &lt;/p&gt;

&lt;p&gt;On a different note, when I was checking code to confirm that the samples only contain the order by columns saw that MR does RandomSampleLoader -&amp;gt; Foreach (to project sort columns) because it was loader. In Tez, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;Daniel Dai&lt;/a&gt; had fixed it to do POForeach - &amp;gt; POReservoirSample projecting the columns early. &lt;/p&gt;</comment>
                            <comment id="13865694" author="cheolsoo" created="Wed, 8 Jan 2014 18:05:55 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I&apos;m suspecting that there is not much benefit of keeping this configurable.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I am deploying this at work to let my users experiment. I will let you know whether this helps or not. In the meantime, we can leave it as is.&lt;/p&gt;</comment>
                            <comment id="13904084" author="cheolsoo" created="Tue, 18 Feb 2014 14:21:25 +0000"  >&lt;p&gt;Actually, this turned out to be helpful. Since I am not change the default behavior (i.e. the number of sampled rows per task is still set to 100), I think we can commit this to 0.13. Does anyone disagree?&lt;/p&gt;</comment>
                            <comment id="13904335" author="daijy" created="Tue, 18 Feb 2014 18:09:33 +0000"  >&lt;p&gt;+1, that should be fine.&lt;/p&gt;</comment>
                            <comment id="13904445" author="cheolsoo" created="Tue, 18 Feb 2014 19:24:59 +0000"  >&lt;p&gt;Committed to trunk. Thank you Daniel!&lt;/p&gt;</comment>
                            <comment id="13904596" author="aniket486" created="Tue, 18 Feb 2014 21:09:26 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;, it would be great if you can share rough numbers on benefits of the setting. That will give us some guidance on configuring this value.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12621547" name="PIG-3648-1.patch" size="2625" author="cheolsoo" created="Mon, 6 Jan 2014 01:31:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 6 Jan 2014 22:12:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>366380</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzl05b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>366691</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>