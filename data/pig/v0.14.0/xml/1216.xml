<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:56:55 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1216/PIG-1216.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1216] New load store design does not allow Pig to validate inputs and outputs up front</title>
                <link>https://issues.apache.org/jira/browse/PIG-1216</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;In Pig 0.6 and before, Pig attempts to verify existence of inputs and non-existence of outputs during parsing to avoid run time failures when inputs don&apos;t exist or outputs can&apos;t be overwritten.  The downside to this was that Pig assumed all inputs and outputs were HDFS files, which made implementation harder for non-HDFS based load and store functions.  In the load store redesign (&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-966&quot; title=&quot;Proposed rework for LoadFunc, StoreFunc, and Slice/r interfaces&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-966&quot;&gt;&lt;del&gt;PIG-966&lt;/del&gt;&lt;/a&gt;) this was delegated to InputFormats and OutputFormats to avoid this problem and to make use of the checks already being done in those implementations.  Unfortunately, for Pig Latin scripts that run more then one MR job, this does not work well.  MR does not do input/output verification on all the jobs at once.  It does them one at a time.  So if a Pig Latin script results in 10 MR jobs and the file to store to at the end already exists, the first 9 jobs will be run before the 10th job discovers that the whole thing was doomed from the beginning.  &lt;/p&gt;

&lt;p&gt;To avoid this a validate call needs to be added to the new LoadFunc and StoreFunc interfaces.  Pig needs to pass this method enough information that the load function implementer can delegate to InputFormat.getSplits() and the store function implementer to OutputFormat.checkOutputSpecs() if s/he decides to.  Since 90% of all load and store functions use HDFS and PigStorage will also need to, the Pig team should implement a default file existence check on HDFS and make it available as a static method to other Load/Store function implementers.  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12455131">PIG-1216</key>
            <summary>New load store design does not allow Pig to validate inputs and outputs up front</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ashutoshc">Ashutosh Chauhan</assignee>
                                    <reporter username="alangates">Alan Gates</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Feb 2010 01:14:37 +0000</created>
                <updated>Fri, 14 May 2010 07:46:50 +0100</updated>
                            <resolved>Fri, 26 Feb 2010 19:35:03 +0000</resolved>
                                    <version>0.7.0</version>
                                    <fixVersion>0.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12834411" author="pkamath" created="Tue, 16 Feb 2010 19:46:03 +0000"  >&lt;p&gt;Review comments:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Is it ok to call outputSpecs multiple times (since we will now be calling it in the visitor and Hadoop will be calling it later when the job is launched) - hope that does not break the contract per Hadoop&apos;s OutputFormat interface&lt;/li&gt;
	&lt;li&gt;The test case for validation failure should ensure that PlanValidationException is indeed thrown (through some boolean flag?) - currently the code has :
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (PlanValidationException pve){
+           &lt;span class=&quot;code-comment&quot;&gt;// We expect &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to happen.
&lt;/span&gt;+        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;import org.omg.PortableInterceptor.SUCCESSFUL; in TestStore.java seems accidental - if you will be submitting a new patch for above comment, you can remove this import also.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Otherwise looks good.&lt;/p&gt;</comment>
                            <comment id="12834577" author="ashutoshc" created="Wed, 17 Feb 2010 00:40:14 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is it ok to call outputSpecs multiple times &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Talked with Arun regarding this. In a user supplied OutputFormat, implementation of checkOutputSpecs() will also be provided by user. So, user needs to make sure this call is idempotent. PigStorage uses TextOutputFormat for which checkOutputSpecs() is idempotent. We need to document this fact in user manual.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;the test case for validation failure &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;import &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done.&lt;/p&gt;

&lt;p&gt;Result of test-patch.sh on the patch:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; +1 overall.  &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 @author.  The patch does not contain any @author tags.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 tests included.  The patch appears to include 6 new or modified tests.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;</comment>
                            <comment id="12834608" author="ashutoshc" created="Wed, 17 Feb 2010 02:22:16 +0000"  >&lt;p&gt;Thinking more about this. We don&apos;t do validation on input side because the input location (or files) may get created over the course of execution of pig script, rendering such validation for input not only useless but incorrect. But similar situation may exist for output validation as well. Assume simple case of HDFS as storage and  the output location exists in HDFS. Now user may have rmf statements within the script, so output location is actually deleted before that job is executed, but if we do upfront validation Pig will fail and refuse to run script saying outputformat.checkspecs() is asserting output location exists at compile time. &lt;br/&gt;
In a more general case, invariants which are true at the compile time of Pig script may no longer hold at runtime, resulting in doing such kind of validation at compile time dangerous. &lt;/p&gt;</comment>
                            <comment id="12834637" author="hadoopqa" created="Wed, 17 Feb 2010 04:19:59 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12436067/pig-1216_1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12436067/pig-1216_1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 909921.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/207/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/207/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12834909" author="pkamath" created="Wed, 17 Feb 2010 18:24:31 +0000"  >&lt;p&gt;Patch committed to load-store-redesign branch - Thanks Ashutosh!&lt;/p&gt;

&lt;p&gt;Note that only outputs will be validated up front (in line with Pig 0.6.0) - inputs will not be validated up front since for the following case validating inputs is not easy:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...
store into &apos;foo&apos;...
load &apos;foo&apos;...
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12835459" author="ashutoshc" created="Thu, 18 Feb 2010 22:49:31 +0000"  >&lt;p&gt;Referring to point # 1 of Pradeep&apos;s review comment:&lt;/p&gt;

&lt;p&gt;So, for Zebra It is not safe to call check outputSpecs() multiple times because they create indices in this function call. So, this approach doesn&apos;t work. Proposal is to introduce validate() in storefunc api which Storer can implement in whatever way they want, thus getting rid of this restriction. In PigStorage&apos;s validate() we will call outputSpecs() since it is safe to do so there.&lt;/p&gt;</comment>
                            <comment id="12835816" author="ashutoshc" created="Fri, 19 Feb 2010 16:55:22 +0000"  >&lt;p&gt;Reopening as the assumption made for the patch doesn&apos;t hold.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12436093">PIG-966</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12435759" name="pig-1216.patch" size="11850" author="ashutoshc" created="Sat, 13 Feb 2010 02:21:29 +0000"/>
                            <attachment id="12436067" name="pig-1216_1.patch" size="14532" author="ashutoshc" created="Wed, 17 Feb 2010 00:40:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 16 Feb 2010 19:46:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164731</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyanvz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96181</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>