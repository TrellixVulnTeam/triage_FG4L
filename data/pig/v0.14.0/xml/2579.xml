<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:00:58 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2579/PIG-2579.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2579] Support for multiple input schemas in AvroStorage</title>
                <link>https://issues.apache.org/jira/browse/PIG-2579</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;This is a barebones patch for AvroStorage which enables support of multiple input schemas.  The assumption is that the input consists of avro files having different schemas that can be unioned, e.g., flat records.  &lt;/p&gt;

&lt;p&gt;A simple illustrative example is attached (avro_storage_union_schema_test.tar.gz): run create_avro1.pig, followed by create_avro2.pig, followed by read_avro.pig.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12546052">PIG-2579</key>
            <summary>Support for multiple input schemas in AvroStorage</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cheolsoo">Cheolsoo Park</assignee>
                                    <reporter username="srosenberg">Stan Rosenberg</reporter>
                        <labels>
                    </labels>
                <created>Mon, 12 Mar 2012 02:04:57 +0000</created>
                <updated>Fri, 22 Feb 2013 04:53:43 +0000</updated>
                            <resolved>Thu, 11 Oct 2012 23:10:37 +0100</resolved>
                                    <version>0.9.2</version>
                    <version>0.11</version>
                                    <fixVersion>0.11</fixVersion>
                                    <component>piggybank</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13446546" author="cheolsoo" created="Sat, 1 Sep 2012 01:54:57 +0100"  >&lt;p&gt;I updated the original Stan&apos;s patch re-basing it to trunk. While I kept the core logic unchanged, I made some modifications as follows:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Removed glob pattern related code as it&apos;s resolved in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2492&quot; title=&quot;AvroStorage should recognize globs and commas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2492&quot;&gt;&lt;del&gt;PIG-2492&lt;/del&gt;&lt;/a&gt;.&lt;/li&gt;
	&lt;li&gt;Added an option &apos;multiple_schema&apos; to AvroStorage. By default, AvroStorage assumes that all the input files have the same schema, but if &apos;multiple_schema&apos; is passed to load function, it tries to merge every input schema.&lt;/li&gt;
	&lt;li&gt;Allows multiple schemas with the same name. I use paths to identify schemas instead of their names.&lt;/li&gt;
	&lt;li&gt;Refactored code.&lt;/li&gt;
	&lt;li&gt;Added unit tests.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I think that the most arguable part is how to merge two different schemas into one. In shorts, the rules are as follows:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Different primitive types can be merged if certain conditions are met. Please see AvroStorageUtils.mergeType() for more details.&lt;/li&gt;
	&lt;li&gt;Only the same kind of complex types can be merged. e.g. record + record =&amp;gt; ok, but record + array =&amp;gt; error.&lt;/li&gt;
	&lt;li&gt;For records, the union of fields is returned.&lt;/li&gt;
	&lt;li&gt;For arrays/maps, their element types/value types are merged.&lt;/li&gt;
	&lt;li&gt;For unions, the union of unions is returned.&lt;/li&gt;
	&lt;li&gt;For fixeds, only the same size of fixeds can be merged.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;It&apos;s easy to see in a unit test (TestAvroStorageUtils) what&apos;s expected when two schemas are merged.&lt;/p&gt;

&lt;p&gt;Please let me know if you have any questions/concerns.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13446559" author="cheolsoo" created="Sat, 1 Sep 2012 02:03:00 +0100"  >&lt;p&gt;Review board:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/6884/diff/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/6884/diff/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13455390" author="cheolsoo" created="Thu, 13 Sep 2012 23:47:10 +0100"  >&lt;p&gt;I rebased the patch to trunk.&lt;/p&gt;</comment>
                            <comment id="13458317" author="cheolsoo" created="Wed, 19 Sep 2012 01:13:52 +0100"  >&lt;p&gt;Updated the patch based on Santhosh&apos;s comments in review board.&lt;/p&gt;</comment>
                            <comment id="13473688" author="cheolsoo" created="Thu, 11 Oct 2012 00:25:08 +0100"  >&lt;p&gt;Updating the patch.&lt;/p&gt;

&lt;p&gt;@Santhosh,&lt;br/&gt;
Can you please also remove the following files when committing the patch? They are no longer used by tests so should be deleted.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
#	deleted:    contrib/piggybank/java/src/test/java/org/apache/pig/piggybank/test/storage/avro/avro_test_files/test_generic_union_schema.avro
#	deleted:    contrib/piggybank/java/src/test/java/org/apache/pig/piggybank/test/storage/avro/avro_test_files/test_recursive_schema.avro
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13474550" author="sms" created="Thu, 11 Oct 2012 23:10:09 +0100"  >&lt;p&gt;I ran all the unit test cases and for Hadoop23, there are 2 failures and 1 error. I verified that these failures and error were not related to this patch by reproducing them on the latest source from trunk.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
~/src/apache/pig/trunk/contrib/piggybank/java/build/test/logs $ grep Failures TEST-org.apache.pig.piggybank.test.* | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;Failures: 0&quot;&lt;/span&gt;
TEST-org.apache.pig.piggybank.test.storage.TestDBStorage.txt:Tests run: 1, Failures: 1, Errors: 0, Time elapsed: 8.462 sec
TEST-org.apache.pig.piggybank.test.storage.TestMultiStorage.txt:Tests run: 1, Failures: 1, Errors: 0, Time elapsed: 7.989 sec

~/src/apache/pig/trunk/contrib/piggybank/java/build/test/logs $ grep Errors TEST-org.apache.pig.piggybank.test.* | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;Errors: 0&quot;&lt;/span&gt;
TEST-org.apache.pig.piggybank.test.evaluation.string.TestLookupInFiles.txt:Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 8.041 sec

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The patch and the updated binaries for unit tests along with the deletions are now committed.&lt;/p&gt;

&lt;p&gt;Thanks Cheolsoo.&lt;/p&gt;</comment>
                            <comment id="13474551" author="sms" created="Thu, 11 Oct 2012 23:10:37 +0100"  >&lt;p&gt;Patch reviewed and committed.&lt;/p&gt;</comment>
                            <comment id="13474558" author="cheolsoo" created="Thu, 11 Oct 2012 23:19:00 +0100"  >&lt;p&gt;Thanks Santhosh.&lt;/p&gt;

&lt;p&gt;I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2966&quot; title=&quot;Test failures on CentOS 6 because MALLOC_ARENA_MAX is not set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2966&quot;&gt;&lt;del&gt;PIG-2966&lt;/del&gt;&lt;/a&gt; for the piggybank test failures.&lt;/p&gt;</comment>
                            <comment id="13475488" author="cheolsoo" created="Sat, 13 Oct 2012 02:27:37 +0100"  >&lt;p&gt;@Santhosh,&lt;br/&gt;
I think that you omitted two files:&lt;br/&gt;
contrib/piggybank/java/src/test/java/org/apache/pig/piggybank/test/storage/avro/avro_test_files/expected_testMultipleSchemas1.avro&lt;br/&gt;
contrib/piggybank/java/src/test/java/org/apache/pig/piggybank/test/storage/avro/avro_test_files/expected_testMultipleSchemas2.avro&lt;/p&gt;

&lt;p&gt;TestAvroStorage is failing due to missing files. Can you please commit them to trunk and brach-0.11?&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13475507" author="sms" created="Sat, 13 Oct 2012 03:40:18 +0100"  >&lt;p&gt;My apologies on missing out on adding these files. I have committed both of them to trunk and branch-0.11. Cheolsoo, thanks for pointing it out.&lt;/p&gt;</comment>
                            <comment id="13475740" author="cheolsoo" created="Sun, 14 Oct 2012 01:56:25 +0100"  >&lt;p&gt;@Santhosh,&lt;br/&gt;
Thank you very much.&lt;/p&gt;

&lt;p&gt;Btw, regarding the other test failures, I realized that I was hitting &lt;a href=&quot;https://issues.apache.org/jira/browse/MAPREDUCE-3933&quot; title=&quot;Failures because MALLOC_ARENA_MAX is not set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAPREDUCE-3933&quot;&gt;&lt;del&gt;MAPREDUCE-3933&lt;/del&gt;&lt;/a&gt;, and I was able to fix them by setting MALLOC_ARENA_MAX to 4 on my CentOS 6 VM. Please see &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2966&quot; title=&quot;Test failures on CentOS 6 because MALLOC_ARENA_MAX is not set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2966&quot;&gt;&lt;del&gt;PIG-2966&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;But I cannot reproduce the same failures on my Mac, which seems correct as this issue is CentOS-6-specific. Are you setting JAVA_HOME=`/usr/libexec/java_home` on your Mac? As far as I understand, those 3 tests are only ones that use MiniCluster, and not setting JAVA_HOME will make them fail.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12543463" name="PIG-2579-2-avro_test_files.tar.gz" size="1472" author="cheolsoo" created="Sun, 2 Sep 2012 04:49:19 +0100"/>
                            <attachment id="12543462" name="PIG-2579-2.patch" size="51772" author="cheolsoo" created="Sun, 2 Sep 2012 04:49:19 +0100"/>
                            <attachment id="12545073" name="PIG-2579-3.patch" size="52172" author="cheolsoo" created="Thu, 13 Sep 2012 23:47:10 +0100"/>
                            <attachment id="12545647" name="PIG-2579-4.patch" size="59277" author="cheolsoo" created="Wed, 19 Sep 2012 01:13:52 +0100"/>
                            <attachment id="12547042" name="PIG-2579-5.patch" size="59455" author="cheolsoo" created="Fri, 28 Sep 2012 21:50:00 +0100"/>
                            <attachment id="12548665" name="PIG-2579-6.patch" size="59573" author="cheolsoo" created="Thu, 11 Oct 2012 00:25:08 +0100"/>
                            <attachment id="12517979" name="avro_storage_union_schema.patch" size="51277" author="srosenberg" created="Mon, 12 Mar 2012 02:05:42 +0000"/>
                            <attachment id="12517980" name="avro_storage_union_schema_test.tar.gz" size="621" author="srosenberg" created="Mon, 12 Mar 2012 02:05:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 1 Sep 2012 00:54:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>231210</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxwczb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12590</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>