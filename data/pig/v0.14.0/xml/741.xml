<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:59:52 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-741/PIG-741.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-741] Add LIMIT as a statement that works in nested FOREACH</title>
                <link>https://issues.apache.org/jira/browse/PIG-741</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;I&apos;d like to compute the top 10 results in each group.&lt;/p&gt;

&lt;p&gt;The natural way to express this in Pig would be:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
A = load &apos;...&apos; using PigStorage() as (
    date: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
    count: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
    url: chararray
);

B = group A by ( date );

C = foreach B {
    D = order A by count desc;
    E = limit D 10;
    generate
        FLATTEN(E);
    };

dump C;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Yeah, I could write a UDF / PiggyBank function to take the top n results. But since LIMIT already exists as a statement, it seems like it should also work in the nested foreach context.&lt;/p&gt;

&lt;p&gt;Example workaround code.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
C = foreach B {
    D = order A by count desc;
    E = util.TOP(D, 10);
    generate
        FLATTEN(E);
    };

dump C;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12421617">PIG-741</key>
            <summary>Add LIMIT as a statement that works in nested FOREACH</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="alangates">Alan Gates</assignee>
                                    <reporter username="ciemo">David Ciemiewicz</reporter>
                        <labels>
                    </labels>
                <created>Tue, 31 Mar 2009 07:51:43 +0100</created>
                <updated>Wed, 24 Mar 2010 22:10:57 +0000</updated>
                            <resolved>Tue, 5 May 2009 16:52:17 +0100</resolved>
                                                    <fixVersion>0.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12704427" author="alangates" created="Thu, 30 Apr 2009 02:12:08 +0100"  >&lt;p&gt;A patch that adds the ability to have limit nested in a foreach.  This first version does not use the combiner.&lt;/p&gt;</comment>
                            <comment id="12704447" author="hadoopqa" created="Thu, 30 Apr 2009 03:38:04 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12406856/PIG-741.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12406856/PIG-741.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 768923.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 3 new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/28/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/28/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/28/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/28/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/28/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/28/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12704452" author="ciemo" created="Thu, 30 Apr 2009 03:58:40 +0100"  >&lt;p&gt;Thanks Alan!&lt;/p&gt;

&lt;p&gt;The fact that LIMIT in this case doesn&apos;t use the combiner is probably not an issue.  In most of the instances I have, I usually don&apos;t have more than a million things in the grouped databag, most of the time I only have under 1000 to 10000 things so the combiner won&apos;t have much value.&lt;/p&gt;</comment>
                            <comment id="12704672" author="alangates" created="Thu, 30 Apr 2009 16:47:17 +0100"  >&lt;p&gt;Since limit distributes rather nicely, I&apos;d very much like it to use the combiner.  But after looking at the code for a bit I realized I could wait for the work Santosh is doing on the optimizer and use that (see &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-697&quot; title=&quot;Proposed improvements to pig&amp;#39;s optimizer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-697&quot;&gt;&lt;del&gt;PIG-697&lt;/del&gt;&lt;/a&gt;) or rewrite a bunch of that code myself.  I decided it was better to check in a limited version of limit (hah) now and get the combiner functionality in a month or two.  Glad to hear it will work for you now.&lt;/p&gt;</comment>
                            <comment id="12704685" author="olgan" created="Thu, 30 Apr 2009 17:22:49 +0100"  >&lt;p&gt;+1 on the patch with one question: is there a reason why tests were only added for local mode?&lt;/p&gt;</comment>
                            <comment id="12704735" author="ciemo" created="Thu, 30 Apr 2009 19:11:01 +0100"  >&lt;p&gt;Because this is a &quot;new&quot; feature, we probably need to make some edits to the Pig reference manual when this is released.&lt;/p&gt;</comment>
                            <comment id="12704775" author="alangates" created="Thu, 30 Apr 2009 21:14:49 +0100"  >&lt;p&gt;I only added tests for local mode because inner operators are executed in local mode one way or another, so I didn&apos;t think there was a need to test it in the map reduce case as well.&lt;/p&gt;</comment>
                            <comment id="12706078" author="alangates" created="Tue, 5 May 2009 16:52:17 +0100"  >&lt;p&gt;Patch checked in.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12406856" name="PIG-741.patch" size="10531" author="alangates" created="Thu, 30 Apr 2009 02:11:23 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 30 Apr 2009 01:12:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164308</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyaid3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95286</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>