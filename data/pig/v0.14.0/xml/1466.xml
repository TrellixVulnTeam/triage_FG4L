<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:06:38 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1466/PIG-1466.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1466] Improve log messages for memory usage</title>
                <link>https://issues.apache.org/jira/browse/PIG-1466</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;For anything more then a moderately sized dataset Pig usually spits following messages:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2010-05-27 18:28:31,659 INFO org.apache.pig.impl.util.SpillableMemoryManager: low memory handler called (Usage
threshold exceeded) init = 4194304(4096K) used = 672012960(656262K) committed = 954466304(932096K) max =
954466304(932096K)

2010-05-27 18:10:52,653 INFO org.apache.pig.impl.util.SpillableMemoryManager: low memory handler called (Collection
threshold exceeded) init = 4194304(4096K) used = 954466304(932096K) committed = 954466304(932096K) max =
954466304(932096K)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This seems to confuse users a lot. Once these messages are printed, users tend to believe that Pig is having hard time with memory, is spilling to disk etc. but in fact Pig might be cruising along at ease. We should be little more careful what to print in logs. Currently these are printed when a notification is sent by JVM and some other conditions are met which may not necessarily indicate low memory condition. Furthermore, with &lt;tt&gt;InternalCachedBag&lt;/tt&gt; embraced everywhere in favor of &lt;tt&gt;DefaultBag&lt;/tt&gt;, these messages have lost their usefulness. At the every least, we should lower the log level at which these are printed. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12467944">PIG-1466</key>
            <summary>Improve log messages for memory usage</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thejas">Thejas M Nair</assignee>
                                    <reporter username="ashutoshc">Ashutosh Chauhan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Jun 2010 21:38:14 +0100</created>
                <updated>Fri, 17 Dec 2010 22:44:38 +0000</updated>
                            <resolved>Thu, 19 Aug 2010 21:15:34 +0100</resolved>
                                    <version>0.7.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12882731" author="alangates" created="Fri, 25 Jun 2010 22:55:52 +0100"  >&lt;p&gt;Rather than change the log level can we change it to only print when we truly spill a &lt;tt&gt;DefaultBag&lt;/tt&gt;?  It would be nice to know if there are any cases where we are still doing that.&lt;/p&gt;</comment>
                            <comment id="12882743" author="olgan" created="Fri, 25 Jun 2010 23:33:18 +0100"  >&lt;p&gt;It would also be nice to know when GC is called but we can make message to reflect that&lt;/p&gt;</comment>
                            <comment id="12887576" author="olgan" created="Mon, 12 Jul 2010 23:49:29 +0100"  >&lt;p&gt;Thejas, can you update the messages since you are already looking at the memory stuff, thanks&lt;/p&gt;</comment>
                            <comment id="12898020" author="thejas" created="Fri, 13 Aug 2010 01:25:40 +0100"  >&lt;p&gt;I am planning to change as following -&lt;br/&gt;
1. Change the string &quot;low memory handler called&quot; to &quot;cleaner notified&quot; .&lt;br/&gt;
2. Print additional log message stating total spill object memory freed and total number of objects freed. This will be printed the first time a candidate to be freed is found, and then every 10 times the GC is called from the code. (GC is called after a threshold of memory suitable to be freed has been collected.)&lt;/p&gt;
</comment>
                            <comment id="12898296" author="thejas" created="Fri, 13 Aug 2010 17:14:51 +0100"  >&lt;blockquote&gt;&lt;p&gt;It would also be nice to know when GC is called but we can make message to reflect that &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Olga, Are you suggesting that we should log everytime the memory manager handler is called or when the memory manager invokes GC after spilling enough memory ?&lt;br/&gt;
I am not sure if it is  useful to log every call to the memory manager handler, maybe we can log the first time for each type of threshold has been exceeded and then every time we actually spill something to disk.&lt;/p&gt;</comment>
                            <comment id="12899489" author="olgan" created="Tue, 17 Aug 2010 18:43:46 +0100"  >&lt;p&gt;Thejas, your proposal looks good&lt;/p&gt;</comment>
                            <comment id="12900120" author="thejas" created="Thu, 19 Aug 2010 01:22:30 +0100"  >&lt;p&gt;With the changes in the patch, the logs from SpillableMemoryManager will look like this -&lt;/p&gt;

&lt;p&gt;2010-08-18 18:22:44,365 INFO org.apache.pig.impl.util.SpillableMemoryManager: first memory handler call- Usage threshold exceeded init = 5439488(5312K) used = 657702912(642288K) committed = 715849728(699072K) max = 715849728(699072K)&lt;br/&gt;
2010-08-18 18:22:44,728 INFO org.apache.pig.impl.util.SpillableMemoryManager: first memory handler call - Collection threshold exceeded init = 5439488(5312K) used = 658437416(643005K) committed = 715849728(699072K) max = 715849728(699072K)&lt;br/&gt;
2010-08-18 18:27:51,174 INFO org.apache.pig.impl.util.SpillableMemoryManager: Spilled an estimate of 73675890 bytes from 1 objects. init = 5439488(5312K) used = 511215656(499234K) committed = 659881984(644416K) max = 715849728(699072K)&lt;br/&gt;
2010-08-18 18:29:16,739 INFO org.apache.pig.impl.util.SpillableMemoryManager: Spilled an estimate of 418063724 bytes from 1 objects. init = 5439488(5312K) used = 563165736(549966K) committed = 659881984(644416K) max = 715849728(699072K)&lt;br/&gt;
2010-08-18 18:29:22,274 INFO org.apache.pig.impl.util.SpillableMemoryManager: Spilled an estimate of 443888012 bytes from 1 objects. init = 5439488(5312K) used = 553174984(540209K) committed = 715849728(699072K) max = 715849728(699072K)&lt;/p&gt;</comment>
                            <comment id="12900122" author="thejas" created="Thu, 19 Aug 2010 01:25:02 +0100"  >&lt;p&gt;test-patch results. No new test cases are included as this changes only the log messages.&lt;/p&gt;

&lt;p&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; -1 overall.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 @author.  The patch does not contain any @author tags.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;                         Please justify why no tests are needed for this patch.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; ======================================================================&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; ======================================================================&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     Finished build.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; ======================================================================&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; ======================================================================&lt;/p&gt;</comment>
                            <comment id="12900375" author="thejas" created="Thu, 19 Aug 2010 18:50:12 +0100"  >&lt;p&gt;core and contrib test passed when i run them manually. Patch is ready for review.&lt;/p&gt;</comment>
                            <comment id="12900379" author="olgan" created="Thu, 19 Aug 2010 19:08:18 +0100"  >&lt;p&gt;I will review this patch today&lt;/p&gt;</comment>
                            <comment id="12900413" author="olgan" created="Thu, 19 Aug 2010 20:49:33 +0100"  >&lt;p&gt;Patch looks good. Just one comment:&lt;/p&gt;

&lt;p&gt;&quot;memory handler call- Usage threshold exceeded &quot;  and &quot;memory handler call - Collection threshold exceeded &quot; need to be made more neutral so that users do not think it is a problem. Also, I think we want to log this at info level so that we get it by default.&lt;/p&gt;</comment>
                            <comment id="12900424" author="thejas" created="Thu, 19 Aug 2010 21:03:33 +0100"  >&lt;blockquote&gt;&lt;p&gt;&quot;memory handler call- Usage threshold exceeded &quot; and &quot;memory handler call - Collection threshold exceeded &quot; need to be made more neutral so that users do not think it is a problem. Also, I think we want to log this at info level so that we get it by default.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I will change &apos;exceeded&apos; part . I log the message at info level the first time handler called for each threshold type, in subsequent calls to the handler messages are logged only if some object has been spilled to disk.&lt;/p&gt;</comment>
                            <comment id="12900430" author="thejas" created="Thu, 19 Aug 2010 21:15:34 +0100"  >&lt;p&gt;Patch committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12452473" name="PIG-1466.patch" size="3767" author="thejas" created="Thu, 19 Aug 2010 01:22:30 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 25 Jun 2010 21:55:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164953</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyaqr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96645</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>