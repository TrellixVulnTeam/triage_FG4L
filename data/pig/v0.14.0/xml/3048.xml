<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:03:55 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3048/PIG-3048.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3048] Add mapreduce workflow information to job configuration</title>
                <link>https://issues.apache.org/jira/browse/PIG-3048</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Adding workflow properties to the job configuration would enable logging and analysis of workflows in addition to individual MapReduce jobs.  Suggested properties include a workflow ID, workflow name, adjacency list connecting nodes in the workflow, and the name of the current node in the workflow.&lt;/p&gt;

&lt;p&gt;mapreduce.workflow.id - a unique ID for the workflow, ideally prepended with the application name&lt;br/&gt;
e.g. pig_&amp;lt;pigScriptId&amp;gt;&lt;/p&gt;

&lt;p&gt;mapreduce.workflow.name - a name for the workflow, to distinguish this workflow from other workflows and to group different runs of the same workflow&lt;br/&gt;
e.g. pig command line&lt;/p&gt;

&lt;p&gt;mapreduce.workflow.adjacency - an adjacency list for the workflow graph, encoded as mapreduce.workflow.adjacency.&amp;lt;source node&amp;gt; = &amp;lt;comma-separated list of target nodes&amp;gt;&lt;/p&gt;

&lt;p&gt;mapreduce.workflow.node.name - the name of the node corresponding to this MapReduce job in the workflow adjacency list&lt;/p&gt;</description>
                <environment></environment>
        <key id="12615961">PIG-3048</key>
            <summary>Add mapreduce workflow information to job configuration</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="billie.rinaldi">Billie Rinaldi</assignee>
                                    <reporter username="billie.rinaldi">Billie Rinaldi</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Nov 2012 21:23:45 +0000</created>
                <updated>Mon, 14 Oct 2013 17:46:39 +0100</updated>
                            <resolved>Thu, 29 Aug 2013 21:02:37 +0100</resolved>
                                                    <fixVersion>0.12.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13497689" author="dvryaboy" created="Thu, 15 Nov 2012 01:38:11 +0000"  >&lt;p&gt;Related:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2658&quot; title=&quot;Add start time for pig script in generated Map-Reduce job conf&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2658&quot;&gt;&lt;del&gt;PIG-2658&lt;/del&gt;&lt;/a&gt; (Add start time for pig script in generated Map-Reduce job conf )&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2587&quot; title=&quot;Compute LogicalPlan signature and store in job conf&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2587&quot;&gt;&lt;del&gt;PIG-2587&lt;/del&gt;&lt;/a&gt; (Add logical plan signature to the job conf)&lt;/p&gt;

&lt;p&gt;I think those two are better implementations of workflow id and workflow name (assuming multiple versions of the same workflow don&apos;t start at the same exact time). &lt;/p&gt;

&lt;p&gt;Adding the adjacent nodes info is interesting. I am not sure we produce something equivalent right now.. Bill Graham would know.&lt;/p&gt;</comment>
                            <comment id="13497708" author="billgraham" created="Thu, 15 Nov 2012 02:05:44 +0000"  >&lt;p&gt;I like the idea of adding more of this type of info, but we should make sure we define all the different namings and concepts first (existing and proposed) to make sure out terminology is clear and consistent. For example we already have these concepts:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;job name&lt;/li&gt;
	&lt;li&gt;script id&lt;/li&gt;
	&lt;li&gt;script submit time&lt;/li&gt;
	&lt;li&gt;job submit time&lt;/li&gt;
	&lt;li&gt;logical plan signature&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So then what is a script and what is a workflow and how does versioning (i.e., logical plan signature) play into things, or does it? &lt;/p&gt;

&lt;p&gt;I like the idea of adjacency lists, which we don&apos;t currently produce. What I&apos;d love to see though is the full DAG. Being able to get the full dag from any job in it would be pretty cool. For already executed jobs, their job ids could even be populated.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;
</comment>
                            <comment id="13498184" author="billie.rinaldi" created="Thu, 15 Nov 2012 18:09:01 +0000"  >&lt;p&gt;I&apos;m thinking of a workflow as a particular DAG.  Each run of a workflow has a globally unique ID, and it has a name that distinguishes that DAG from other DAGs.  It sounds like the logical plan signature would be more appropriate for the workflow name, assuming we want to group together runs of the same DAG with different inputs/outputs/arguments.&lt;/p&gt;

&lt;p&gt;What is included in the full DAG in addition to the adjacency list?&lt;/p&gt;</comment>
                            <comment id="13498231" author="billgraham" created="Thu, 15 Nov 2012 18:44:57 +0000"  >&lt;p&gt;I could have been mis-reading your patch but I thought it was providing the adjacency list only from the job in question. The DAG would include that, plus all adjacency lists of other jobs in the script that might not be directly connected to the job in question.&lt;/p&gt;

&lt;p&gt;We use logical plan signature to distinguish between different version of the same workflow. Between versions the DAG could change. We&apos;ve got our own custom field in the job conf to represent the workflow name, but it would be great to standardize this. So we could have something like this:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Workflow name: the logical name of the deployed scheduled script script (i.e., Hourly click analysis)&lt;/li&gt;
	&lt;li&gt;Logical plan signature (existing): a hash that represents a version of the script, without considering it&apos;s input/output&lt;/li&gt;
	&lt;li&gt;Script start time (existing): used with Workflow name and Logical plan signature to correlate multiple jobs into a single run of a workflow&lt;/li&gt;
	&lt;li&gt;Job start time (existing): used to show when different jobs start&lt;/li&gt;
	&lt;li&gt;Script DAG: used by tools to visualize the current workflow execution given a job. This is something we&apos;d like to have for Ambrose (&lt;a href=&quot;https://github.com/twitter/ambrose&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/twitter/ambrose&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;We represent the DAG as an adjacency list keyed by the physical operator key (scope-*) &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; and then once a job starts we add the jobId to the node &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;1 - &lt;a href=&quot;https://github.com/twitter/ambrose/blob/master/pig/src/main/java/com/twitter/ambrose/pig/AmbrosePigProgressNotificationListener.java#L91&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/twitter/ambrose/blob/master/pig/src/main/java/com/twitter/ambrose/pig/AmbrosePigProgressNotificationListener.java#L91&lt;/a&gt;&lt;br/&gt;
2 - &lt;a href=&quot;https://github.com/twitter/ambrose/blob/master/pig/src/main/java/com/twitter/ambrose/pig/AmbrosePigProgressNotificationListener.java#L138&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/twitter/ambrose/blob/master/pig/src/main/java/com/twitter/ambrose/pig/AmbrosePigProgressNotificationListener.java#L138&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If we had those things, would we still need a unique id for the run? It would certainly be more robust that the start time, signature, workflow name.&lt;/p&gt;

&lt;p&gt;Do we need node name?&lt;/p&gt;
</comment>
                            <comment id="13498370" author="billie.rinaldi" created="Thu, 15 Nov 2012 21:48:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;I could have been mis-reading your patch but I thought it was providing the adjacency list only from the job in question. The DAG would include that, plus all adjacency lists of other jobs in the script that might not be directly connected to the job in question.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right, I remember now that operators are removed from the plan as jobs are executed.  I didn&apos;t seem to have access to the entire DAG at the point where the job configuration is populated, so I figured that you could just take the full DAG from the first job, or even better, merge the partial DAGs for all the jobs (in the event that some application adds onto its DAG after jobs have begun executing).  Instead, I could split the new configuration method into two parts, one that sets the adjacencies before any jobs are run, and another that sets the rest of the information.  I can certainly use OperatorKey.toString for the node names.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If we had those things, would we still need a unique id for the run?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;d like to have a workflow ID like pig_&amp;lt;scriptID&amp;gt; because then we don&apos;t have to know what makes a unique identifier for a particular application.  I&apos;ve opened a similar ticket for Hive, &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3708&quot; title=&quot;Add mapreduce workflow information to job configuration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3708&quot;&gt;&lt;del&gt;HIVE-3708&lt;/del&gt;&lt;/a&gt;.  Do you think we should include the Pig version in the ID?  I think it makes sense to make the workflow name either the script name or the logical plan signature, or perhaps a concatenation of the two.  Is the script name what you meant by &quot;the logical name of the deployed scheduled script&quot;?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Do we need node name?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If you don&apos;t have a node name, how do you know which job in the DAG is running?&lt;/p&gt;</comment>
                            <comment id="13498798" author="billie.rinaldi" created="Fri, 16 Nov 2012 13:15:48 +0000"  >&lt;p&gt;Updated patch based on discussion.&lt;/p&gt;</comment>
                            <comment id="13738300" author="billie.rinaldi" created="Tue, 13 Aug 2013 15:41:21 +0100"  >&lt;p&gt;Updated patch for trunk.&lt;/p&gt;</comment>
                            <comment id="13752934" author="daijy" created="Wed, 28 Aug 2013 23:04:20 +0100"  >&lt;p&gt;The patch looks fine for me.&lt;/p&gt;

&lt;p&gt;Yes we can have different ways to represent track a job as Bill indicated, which might already exist in Pig. However, the key here is we also need a way to capture this information consistently across multiple projects (such as Hive). Since Hive already adopted &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3708&quot; title=&quot;Add mapreduce workflow information to job configuration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3708&quot;&gt;&lt;del&gt;HIVE-3708&lt;/del&gt;&lt;/a&gt;, it is meaningful to check in this patch, so upper layer application such as Ambari can make of this in a consistent manner.&lt;/p&gt;

&lt;p&gt;I would like to check it in if no objection.&lt;/p&gt;</comment>
                            <comment id="13753942" author="dvryaboy" created="Thu, 29 Aug 2013 20:03:21 +0100"  >&lt;p&gt;no objections. after all, usage of the config info is purely optional.&lt;/p&gt;

&lt;p&gt;We&apos;ve run into trouble before with information of this sort becoming very big and triggering JobConf too large errors. Might want to look at compression at some point.&lt;/p&gt;</comment>
                            <comment id="13753996" author="daijy" created="Thu, 29 Aug 2013 21:02:37 +0100"  >&lt;p&gt;Patch committed to trunk. Thanks guys!&lt;/p&gt;</comment>
                            <comment id="13753997" author="billgraham" created="Thu, 29 Aug 2013 21:03:30 +0100"  >&lt;p&gt;+1 to commit.&lt;/p&gt;

&lt;p&gt;Just one style nit re spaces:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;(getFileName() != null)?getFileName():&quot;default&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;should instead be:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;(getFileName() != null) ? getFileName() : &quot;default&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13753998" author="billgraham" created="Thu, 29 Aug 2013 21:04:57 +0100"  >&lt;p&gt;Whoops, I was a minute too late. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13754001" author="daijy" created="Thu, 29 Aug 2013 21:10:49 +0100"  >&lt;p&gt;No problem, I just committed the change you suggested. Thanks Bill!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12597729" name="PIG-3048.patch" size="2078" author="billie.rinaldi" created="Tue, 13 Aug 2013 15:41:40 +0100"/>
                            <attachment id="12553780" name="PIG-3048.patch" size="2047" author="billie.rinaldi" created="Fri, 16 Nov 2012 13:15:48 +0000"/>
                            <attachment id="12553373" name="PIG-3048.patch" size="2219" author="billie.rinaldi" created="Tue, 13 Nov 2012 21:39:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 15 Nov 2012 01:38:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>257567</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hydxv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>115350</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>