<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:08:08 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3886/PIG-3886.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3886] UdfDistributedCache_1 fails in tez branch</title>
                <link>https://issues.apache.org/jira/browse/PIG-3886</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The e2e test &quot;UdfDistributedCache_1&quot; fails with the following error-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                    : Caused by: java.io.FileNotFoundException: ./foodle (No such file or directory)    
                    : at java.io.FileInputStream.open(Native Method)    
                    : at java.io.FileInputStream.&amp;lt;init&amp;gt;(FileInputStream.java:146)    
                    : at java.io.FileInputStream.&amp;lt;init&amp;gt;(FileInputStream.java:101)    
                    : at java.io.FileReader.&amp;lt;init&amp;gt;(FileReader.java:58)    
                    : at org.apache.pig.test.udf.evalfunc.Udfcachetest.exec(Udfcachetest.java:60)    
                    : at org.apache.pig.test.udf.evalfunc.Udfcachetest.exec(Udfcachetest.java:40)    
                    : at org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.POUserFunc.getNext(POUserFunc.java:353)
                    : ... 14 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12708105">PIG-3886</key>
            <summary>UdfDistributedCache_1 fails in tez branch</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12666475">PIG-3446</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cheolsoo">Cheolsoo Park</assignee>
                                    <reporter username="cheolsoo">Cheolsoo Park</reporter>
                        <labels>
                    </labels>
                <created>Sat, 12 Apr 2014 20:25:46 +0100</created>
                <updated>Fri, 21 Nov 2014 05:58:28 +0000</updated>
                            <resolved>Mon, 14 Jul 2014 01:53:44 +0100</resolved>
                                    <version>tez-branch</version>
                                    <fixVersion>0.14.0</fixVersion>
                                    <component>tez</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="14020469" author="daijy" created="Fri, 6 Jun 2014 23:34:05 +0100"  >&lt;p&gt;This happens when opt.fetch=true. Turn it off the test pass. I will try to make a patch.&lt;/p&gt;</comment>
                            <comment id="14020483" author="cheolsoo" created="Fri, 6 Jun 2014 23:41:47 +0100"  >&lt;p&gt;Ah. I thought I disabled fetch optimization in all e2e tests when I committed the patch. Apparently, I missed this test.&lt;/p&gt;

&lt;p&gt;Thank you Daniel!&lt;/p&gt;</comment>
                            <comment id="14020501" author="daijy" created="Sat, 7 Jun 2014 00:00:44 +0100"  >&lt;p&gt;Actually I see &quot;&apos;java_params&apos; =&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;-Dopt.fetch=false&amp;#39;&amp;#93;&lt;/span&gt;&quot; in UdfDistributedCache_1. So &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt; didn&apos;t miss the test. The issue is my version of Hadoop does not take HADOOP_OPTS, it only takes HADOOP_CLIENT_OPTS. That&apos;s why Accumulator_5 does not work for me as well. We will need to change bin/pig to solve it.&lt;/p&gt;</comment>
                            <comment id="14020536" author="cheolsoo" created="Sat, 7 Jun 2014 00:35:48 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14020552" author="daijy" created="Sat, 7 Jun 2014 00:51:00 +0100"  >&lt;p&gt;Actually the test on tez still fail on backend. Let me open a separate Jira for the frontend exception due to PIG_OPTS (&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3989&quot; title=&quot;PIG_OPTS does not work with some version of HADOOP&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3989&quot;&gt;&lt;del&gt;PIG-3989&lt;/del&gt;&lt;/a&gt;), and leave this Jira for tez issue.&lt;/p&gt;</comment>
                            <comment id="14057048" author="cheolsoo" created="Thu, 10 Jul 2014 03:21:31 +0100"  >&lt;p&gt;Attaching a patch that fixes UdfDistributedCache_1.&lt;/p&gt;

&lt;p&gt;But this patch isn&apos;t complete because the following fails in Tez while it works in MR-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
set pig.streaming.cache.files &apos;s3n:&lt;span class=&quot;code-comment&quot;&gt;//foo/bar/zoo&apos;;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Currently, &lt;tt&gt;pig.streaming.cache.files&lt;/tt&gt; only works with hdfs paths in Tez, but it should also work with other file systems such as s3.&lt;/p&gt;

&lt;p&gt;Here is the stack trace that I get for a s3 path-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.io.FileNotFoundException: File does not exist: /bar/zoo
at org.apache.hadoop.hdfs.DistributedFileSystem$17.doCall(DistributedFileSystem.java:1128)
at org.apache.hadoop.hdfs.DistributedFileSystem$17.doCall(DistributedFileSystem.java:1120)
 at org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81)
at org.apache.hadoop.hdfs.DistributedFileSystem.getFileStatus(DistributedFileSystem.java:1120)
at org.apache.pig.backend.hadoop.executionengine.tez.TezResourceManager.getTezResources(TezResourceManager.java:138)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14057874" author="daijy" created="Thu, 10 Jul 2014 21:06:17 +0100"  >&lt;p&gt;+1 for patch. The s3 issue seems to be more general, it might affect all s3 resources and I can work on it in a separate ticket.&lt;/p&gt;</comment>
                            <comment id="14057881" author="cheolsoo" created="Thu, 10 Jul 2014 21:10:51 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;Daniel Dai&lt;/a&gt;, give me a bit more time. I almost fixed it with S3. I will also clean up a couple of things along the way. A new patch will be posted soon.&lt;/p&gt;</comment>
                            <comment id="14058203" author="cheolsoo" created="Fri, 11 Jul 2014 02:37:05 +0100"  >&lt;p&gt;Here is a new patch that handles s3 paths. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;Daniel Dai&lt;/a&gt;, can you review this?&lt;/p&gt;

&lt;p&gt;There is still a problem [1], but I think we can fix it in a separate jira? (I didn&apos;t have time to get it done today.)&lt;/p&gt;

&lt;p&gt;[1] I have a production job that ships a s3 directory recursively using &lt;tt&gt;pig.streaming.cache.files&lt;/tt&gt;, but I couldn&apos;t get it working yet. I see files are shipped to a temporary staging directory on hdfs and are added to task local resources. But somehow they&apos;re not available inside the udf.&lt;/p&gt;

</comment>
                            <comment id="14059361" author="daijy" created="Fri, 11 Jul 2014 22:11:10 +0100"  >&lt;p&gt;+1. Does &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; work in MR?&lt;/p&gt;

&lt;p&gt;The patch will conflict with &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4011&quot; title=&quot;Pig should not put PigContext in job.jar to help jar dedup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4011&quot;&gt;&lt;del&gt;PIG-4011&lt;/del&gt;&lt;/a&gt;, but I can rebase the patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4011&quot; title=&quot;Pig should not put PigContext in job.jar to help jar dedup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4011&quot;&gt;&lt;del&gt;PIG-4011&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14059396" author="cheolsoo" created="Fri, 11 Jul 2014 22:39:41 +0100"  >&lt;p&gt;Yes, &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; works in MR.&lt;/p&gt;</comment>
                            <comment id="14059567" author="cheolsoo" created="Sat, 12 Jul 2014 02:18:30 +0100"  >&lt;p&gt;I updated the patch incorporating &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;Rohini Palaniswamy&lt;/a&gt; suggestions. The key change is this-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// Ship the local resource to the staging directory on the remote FS
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (uri.toString().startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&quot;&lt;/span&gt;)) {
  Path remoteFsPath = remoteFs.makeQualified(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(stagingDir, resourceName));
  FileSystem.get(conf).copyFromLocalFile(resourcePath, remoteFsPath);
  resources.put(resourceName, remoteFsPath);
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; remoteFsPath;
}
resources.put(resourceName, resourcePath);
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; resourcePath;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;UdfDistributedCache_1 passes.&lt;/p&gt;</comment>
                            <comment id="14059568" author="cheolsoo" created="Sat, 12 Jul 2014 02:19:06 +0100"  >&lt;p&gt;I will commit the 3rd patch if I don&apos;t hear any more comments.&lt;/p&gt;</comment>
                            <comment id="14060249" author="cheolsoo" created="Mon, 14 Jul 2014 01:53:44 +0100"  >&lt;p&gt;Committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12654919" name="PIG-3886-1.patch" size="6831" author="cheolsoo" created="Thu, 10 Jul 2014 03:21:31 +0100"/>
                            <attachment id="12655129" name="PIG-3886-2.patch" size="16165" author="cheolsoo" created="Fri, 11 Jul 2014 02:37:05 +0100"/>
                            <attachment id="12655347" name="PIG-3886-3.patch" size="14556" author="cheolsoo" created="Sat, 12 Jul 2014 02:18:30 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 6 Jun 2014 22:34:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386428</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzof9z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386693</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>