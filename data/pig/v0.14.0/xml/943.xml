<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:07:08 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-943/PIG-943.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-943] Pig crash when it cannot get counter from hadoop</title>
                <link>https://issues.apache.org/jira/browse/PIG-943</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;We see following call stacks in Pig:&lt;br/&gt;
Case 1:&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher.computeWarningAggregate(MapReduceLauncher.java:390)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher.launchPig(MapReduceLauncher.java:238)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.execute(HExecutionEngine.java:265)&lt;/p&gt;

&lt;p&gt;Case 2:&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.pig.tools.pigstats.PigStats.accumulateMRStats(PigStats.java:150)&lt;br/&gt;
        at org.apache.pig.tools.pigstats.PigStats.accumulateStats(PigStats.java:91)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher.launchPig(MapReduceLauncher.java:192)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.execute(HExecutionEngine.java:265)&lt;/p&gt;

&lt;p&gt;In both cases, hadoop jobs finishes without error. The cause of both problems is RunningJob.getCounters() returns a null, and Pig do not currently check for that. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12434780">PIG-943</key>
            <summary>Pig crash when it cannot get counter from hadoop</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="daijy">Daniel Dai</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Sep 2009 22:19:55 +0100</created>
                <updated>Wed, 24 Mar 2010 22:13:12 +0000</updated>
                            <resolved>Tue, 8 Sep 2009 19:02:23 +0100</resolved>
                                    <version>0.3.0</version>
                                    <fixVersion>0.4.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12751187" author="daijy" created="Thu, 3 Sep 2009 22:59:53 +0100"  >&lt;p&gt;No unit test is included. The script reproducing the exception requires a large input data which is not possible to put it here.&lt;/p&gt;</comment>
                            <comment id="12751200" author="dvryaboy" created="Thu, 3 Sep 2009 23:35:01 +0100"  >&lt;p&gt;Daniel,&lt;br/&gt;
-1 is a bit of a hack. Maybe cleaner to insert and check for nulls? Also, perhaps using stringToLong from CastUtils is warranted as it&apos;s a bit safer than parseLong().&lt;/p&gt;

&lt;p&gt;-D&lt;/p&gt;</comment>
                            <comment id="12751210" author="daijy" created="Fri, 4 Sep 2009 00:01:49 +0100"  >&lt;p&gt;Hi, Dmitriy,&lt;br/&gt;
All this patch does is checking for nulls. The extra work in the patch is when counters object is null, we treat all counter as unknown, so we do not report confusing results to user. Which part do you think &quot;hacky&quot;? Also parseLong is there for a long time and currently the only problem we observe is RunningJob.getCounters is null. If this is your concern I can change it to use stringToLong.&lt;/p&gt;</comment>
                            <comment id="12751560" author="pkamath" created="Fri, 4 Sep 2009 19:25:11 +0100"  >&lt;p&gt;I am wondering if we should report that we were unable to determine the number of records/bytes written - &lt;/p&gt;
 &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
           &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (stats.getRecordsWritten()!=-1)                                                                                                                                                                                             
                log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Records written : &quot;&lt;/span&gt; + stats.getRecordsWritten());                                                                                                                                                                
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (stats.getBytesWritten()!=-1)                                                                                                                                                                                               
                log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Bytes written : &quot;&lt;/span&gt; + stats.getBytesWritten());                                                                                                                                                                    
        }                              
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;could change to&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(stats.getRecordsWritten()==-1) {
        log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Records written : Unable to determine number of records written&quot;&lt;/span&gt;);
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Records written : stats.getRecordsWritten()&quot;&lt;/span&gt;);
    }
	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(stats.getBytesWritten()==-1) {
        log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Bytes written : Unable to determine number of bytes written&quot;&lt;/span&gt;);
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Bytes written : stats.getBytesWritten()&quot;&lt;/span&gt;);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If we are using -1 to indicate we did not get counter information but the warning has occured some number of times (maybe in one of the&lt;br/&gt;
jobs where we did get counter information),  the following function&apos;s output message should change&lt;br/&gt;
:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void logAggregate(Map&amp;lt;Enum, &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt; aggMap, MessageType messageType, Log log) {
    	&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(Enum e: aggMap.keySet()) {
    		&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; count = aggMap.get(e);
    		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(count != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; count &amp;gt; 0) {
    			&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; message = &lt;span class=&quot;code-quote&quot;&gt;&quot;Encountered &quot;&lt;/span&gt; + messageType + &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt; + e.toString() + &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt; + count + &lt;span class=&quot;code-quote&quot;&gt;&quot; time(s).&quot;&lt;/span&gt;;
    			logMessage(message, messageType, log);
    		}
    	}	
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void logAggregate(Map&amp;lt;Enum, &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt; aggMap, MessageType messageType, Log log) {
    	&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(Enum e: aggMap.keySet()) {
    		&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; count = aggMap.get(e);
    		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(count != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; (count == -1 || count &amp;gt; 0)) {
    			&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; message = &lt;span class=&quot;code-quote&quot;&gt;&quot;Encountered &quot;&lt;/span&gt; + messageType + &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt; + e.toString() + &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt; + (count == -1 ? &lt;span class=&quot;code-quote&quot;&gt;&quot;unknown number of &quot;&lt;/span&gt;: count.toString()) + &lt;span class=&quot;code-quote&quot;&gt;&quot; time(s).&quot;&lt;/span&gt;;
    			logMessage(message, messageType, log);
    		}
    	}	
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This way we still warn the user about the warning message which got aggregated but just not report the number of occurences.&lt;/p&gt;

&lt;p&gt;To enable the above change the code in MapReduceLauncher.java should also change to ensure we report 3 types of counts:&lt;br/&gt;
0 -&amp;gt; the warning did not occur&lt;br/&gt;
-1 -&amp;gt;the warning occured in some of the jobs but in one or more jobs we get a null counter and hence we cannot report an accurate count&lt;br/&gt;
&amp;gt;0 -&amp;gt; we can accurately report the count of occurences of the warning.&lt;/p&gt;</comment>
                            <comment id="12751575" author="hadoopqa" created="Fri, 4 Sep 2009 20:13:21 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12418545/PIG-943-1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12418545/PIG-943-1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 811203.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no tests are needed for this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/13/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/13/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/13/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/13/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/13/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/13/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12751631" author="dvryaboy" created="Fri, 4 Sep 2009 22:51:23 +0100"  >&lt;p&gt;Hi Daniel,&lt;br/&gt;
My apologies, I worded my comment poorly. I wasn&apos;t minus-oneing the patch, I was saying that the use of -1 as a magic value is a bit hacky.&lt;br/&gt;
I think inserting Long.NaN or null and checking for it on the other end, instead of checking for -1, is cleaner.&lt;/p&gt;</comment>
                            <comment id="12751640" author="daijy" created="Fri, 4 Sep 2009 23:19:45 +0100"  >&lt;p&gt;This patch include Pradeep&apos;s comment. Now if we encounter any null counters from hadoop, we ignore it when doing the calculation. Then in the report, we put a note &quot;We cannot retrieve hadoop counter for x jobs, the number following warnings may not be correct&quot;.&lt;/p&gt;</comment>
                            <comment id="12751645" author="daijy" created="Fri, 4 Sep 2009 23:43:18 +0100"  >&lt;p&gt;Hi, Dmitriy,&lt;br/&gt;
Thank you for your clarification. I look up the code, if we change -1 to a Long.NaN or null, then we need to change more code. Besides, I don&apos;t see much difference if we use null instead of -1. In both cases, we use a special value to indicate something special.&lt;/p&gt;</comment>
                            <comment id="12751650" author="pkamath" created="Sat, 5 Sep 2009 00:10:21 +0100"  >&lt;p&gt;Reviewed &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-943&quot; title=&quot;Pig crash when it cannot get counter from hadoop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-943&quot;&gt;&lt;del&gt;PIG-943&lt;/del&gt;&lt;/a&gt;-2.patch. Changes look good +1&lt;/p&gt;

&lt;p&gt;One very minor comment, the following message:&lt;br/&gt;
&quot;We cannot retrieve hadoop counter for  ..&quot; should change to  &quot;Unable to retrieve hadoop counter for  ..&quot; &lt;/p&gt;</comment>
                            <comment id="12751676" author="hadoopqa" created="Sat, 5 Sep 2009 01:44:21 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12418677/PIG-943-2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12418677/PIG-943-2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 811203.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no tests are needed for this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/14/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/14/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/14/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/14/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/14/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/14/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12752011" author="daijy" created="Mon, 7 Sep 2009 05:59:21 +0100"  >&lt;p&gt;Fix one bug in calculation of the number of occurrence of null counters&lt;/p&gt;</comment>
                            <comment id="12752626" author="daijy" created="Tue, 8 Sep 2009 18:38:45 +0100"  >&lt;p&gt;Minor change. If no warnings, shall not put the message &quot;the number following warnings may not be correct&quot;&lt;/p&gt;</comment>
                            <comment id="12752649" author="daijy" created="Tue, 8 Sep 2009 19:02:23 +0100"  >&lt;p&gt;Patch committed&lt;/p&gt;</comment>
                            <comment id="12752673" author="daijy" created="Tue, 8 Sep 2009 19:43:40 +0100"  >&lt;p&gt;Since there is no unit test included, I manually tested with two failed script, both pass without error message.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12418545" name="PIG-943-1.patch" size="7012" author="daijy" created="Thu, 3 Sep 2009 22:59:53 +0100"/>
                            <attachment id="12418677" name="PIG-943-2.patch" size="10096" author="daijy" created="Fri, 4 Sep 2009 23:19:45 +0100"/>
                            <attachment id="12418690" name="PIG-943-3.patch" size="10132" author="daijy" created="Sat, 5 Sep 2009 02:08:38 +0100"/>
                            <attachment id="12418774" name="PIG-943-4.patch" size="10591" author="daijy" created="Mon, 7 Sep 2009 05:59:21 +0100"/>
                            <attachment id="12418941" name="PIG-943-5.patch" size="10667" author="daijy" created="Tue, 8 Sep 2009 18:38:45 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Sep 2009 22:35:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164483</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyakqn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95671</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>