<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:57:37 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2556/PIG-2556.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2556] CSVExcelStorage load: quoted field with newline as first character sees newline as record end </title>
                <link>https://issues.apache.org/jira/browse/PIG-2556</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Loading a record that contains a newline as the first character in a quoted field is broken.  The loader interprets the quoted newline as the record delimiter.  I&apos;ve identified and fixed the bug and added a new testcase to expose it.  I&apos;ll post a patch soon.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12544087">PIG-2556</key>
            <summary>CSVExcelStorage load: quoted field with newline as first character sees newline as record end </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tivv">Vitalii Tymchyshyn</assignee>
                                    <reporter username="stickyhipp">Peter Welch</reporter>
                        <labels>
                            <label>newbie</label>
                            <label>patch</label>
                    </labels>
                <created>Sat, 25 Feb 2012 01:01:12 +0000</created>
                <updated>Fri, 22 Feb 2013 04:53:53 +0000</updated>
                            <resolved>Mon, 20 Aug 2012 21:14:43 +0100</resolved>
                                    <version>0.9.1</version>
                                    <fixVersion>0.11</fixVersion>
                                    <component>piggybank</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13217424" author="stickyhipp" created="Mon, 27 Feb 2012 19:25:57 +0000"  >&lt;p&gt;Index: src/test/java/org/apache/pig/piggybank/test/storage/TestCSVExcelStorage.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; src/test/java/org/apache/pig/piggybank/test/storage/TestCSVExcelStorage.java	(revision 1294285)&lt;br/&gt;
+++ src/test/java/org/apache/pig/piggybank/test/storage/TestCSVExcelStorage.java	(working copy)&lt;br/&gt;
@@ -49,6 +49,7 @@&lt;/p&gt;

&lt;p&gt;     String testFileCommaName = &quot;testFileComma.csv&quot;;&lt;br/&gt;
     String testFileTabName = &quot;testFileTab.csv&quot;;&lt;br/&gt;
+    String testFileNewlines = &quot;testFileNewlines.csv&quot;;&lt;/p&gt;

&lt;p&gt;     String testStrComma = &lt;br/&gt;
     	&quot;John,Doe,10\n&quot; +&lt;br/&gt;
@@ -124,7 +125,36 @@&lt;br/&gt;
     		add(Util.createTuple(new String[] &lt;/p&gt;
{&quot;Frank&quot;,&quot;Clean&quot;,&quot;70&quot;}
&lt;p&gt;));&lt;br/&gt;
     	}&lt;br/&gt;
     };&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;p&gt;+&lt;br/&gt;
+    String[] testFileNewlinesArray = new String[] &lt;/p&gt;
{
+            &quot;One,Two,Three&quot;,
+            &quot;123,\&quot;\nSecond line\nThird line\&quot;, \&quot;456\&quot;&quot;  // notice that the space after the comma but before the quote
+            // is considered to be part of the 3rd field.  TBD if that&apos;s correct.
+    }
&lt;p&gt;;&lt;br/&gt;
+&lt;br/&gt;
+    @SuppressWarnings(&quot;serial&quot;)&lt;br/&gt;
+	ArrayList&amp;lt;Tuple&amp;gt; testStrNewlinesResultTuples =&lt;br/&gt;
+    	new ArrayList&amp;lt;Tuple&amp;gt;() {&lt;br/&gt;
+    	&lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+    		add(Util.createTuple(new String[] {&quot;One&quot;,&quot;Two&quot;,&quot;Three&quot;}));+    		add(Util.createTuple(new String[] {&quot;123&quot;, &quot;\nSecond line\nThird line&quot;,&quot; 456&quot;}));+    	}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;+    };&lt;br/&gt;
+&lt;br/&gt;
+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testNewline() throws IOException &lt;/p&gt;
{
+
+        // Read the test file:
+        String script =
+        	&quot;a = LOAD &apos;&quot; + testFileNewlines + &quot;&apos; &quot; +
+        	&quot;USING org.apache.pig.piggybank.storage.CSVExcelStorage(&apos;,&apos;, &apos;YES_MULTILINE&apos;);&quot;;
+        Util.registerMultiLineQuery(pigServer, script);
+        compareExpectedActual(testStrNewlinesResultTuples, &quot;a&quot;);
+
+
+    }
&lt;p&gt;+&lt;br/&gt;
     public TestCSVExcelStorage() throws ExecException, IOException &lt;/p&gt;
{
 
         pigServer = new PigServer(ExecType.LOCAL);
@@ -135,6 +165,7 @@
         
         Util.createLocalInputFile(testFileCommaName, testStrCommaArray);
         Util.createLocalInputFile(testFileTabName, testStrTabArray);
+        Util.createLocalInputFile(testFileNewlines, testFileNewlinesArray);
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     @Test&lt;br/&gt;
@@ -148,7 +179,7 @@&lt;br/&gt;
         assertEquals(Util.createTuple(new String[] &lt;/p&gt;
{&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;}
&lt;p&gt;), it.next());&lt;br/&gt;
     }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Test&lt;br/&gt;
+    @Test&lt;br/&gt;
     public void testQuotedCommas() throws IOException {&lt;br/&gt;
         String inputFileName = &quot;TestCSVExcelStorage-quotedcommas.txt&quot;;&lt;br/&gt;
         Util.createLocalInputFile(inputFileName, new String[] 
{&quot;\&quot;foo,bar,baz\&quot;&quot;, &quot;fee,foe,fum&quot;}
&lt;p&gt;);&lt;br/&gt;
Index: src/main/java/org/apache/pig/piggybank/storage/CSVExcelStorage.java&lt;br/&gt;
===================================================================&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;src/main/java/org/apache/pig/piggybank/storage/CSVExcelStorage.java	(revision 1294285)&lt;br/&gt;
+++ src/main/java/org/apache/pig/piggybank/storage/CSVExcelStorage.java	(working copy)&lt;br/&gt;
@@ -622,6 +622,10 @@&lt;br/&gt;
 				// that entire field is quoted:&lt;br/&gt;
 				getNextInQuotedField = true;&lt;br/&gt;
 				evenQuotesSeen = true;&lt;br/&gt;
+                if (i == recordLen - 1) 
{
+                    fieldBuffer.put(b);
+					sawEmbeddedRecordDelimiter = true;
+                }
&lt;p&gt; 			} else if (b == FIELD_DEL) &lt;/p&gt;
{
 				readField(fieldBuffer, getNextFieldID++); // end of the field
 			}
&lt;p&gt; else {&lt;/p&gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13217429" author="stickyhipp" created="Mon, 27 Feb 2012 19:27:57 +0000"  >&lt;p&gt;Patch file attached&lt;/p&gt;</comment>
                            <comment id="13436678" author="tivv" created="Fri, 17 Aug 2012 13:24:12 +0100"  >&lt;p&gt;I&apos;ve also got into this bug. &lt;br/&gt;
Should have check jira for patch before fixing &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, but here is my pull request with patch in case this would make fix progress faster: &lt;a href=&quot;https://github.com/apache/pig/pull/6&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/pig/pull/6&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13436707" author="tivv" created="Fri, 17 Aug 2012 13:55:42 +0100"  >&lt;p&gt;Actually there is one more problem: &quot;Test &quot;&quot;quoted&quot;&quot;\ndata&quot; also does not work OK. Fixed in second commit. Will attach updated patch to this ticket. Also code is in pull request&lt;/p&gt;</comment>
                            <comment id="13436710" author="tivv" created="Fri, 17 Aug 2012 13:59:24 +0100"  >&lt;p&gt;Patch from &lt;a href=&quot;https://github.com/apache/pig/pull/6/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/pig/pull/6/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13437061" author="dvryaboy" created="Fri, 17 Aug 2012 21:53:47 +0100"  >&lt;p&gt;Looks good, but the spacing is kind of crazy &amp;#8211; did tabs get in or something?&lt;/p&gt;

&lt;p&gt;+                if (i == recordLen - 1) &lt;/p&gt;
{
+                    fieldBuffer.put(b);
+					sawEmbeddedRecordDelimiter = true;
+                }</comment>
                            <comment id="13437062" author="dvryaboy" created="Fri, 17 Aug 2012 21:54:21 +0100"  >&lt;p&gt;Let me try that again..&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i == recordLen - 1) {
+                    fieldBuffer.put(b);
+					sawEmbeddedRecordDelimiter = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
+                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13437064" author="dvryaboy" created="Fri, 17 Aug 2012 21:56:28 +0100"  >&lt;p&gt;Assigning to Vitalii &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="13437361" author="tivv" created="Sat, 18 Aug 2012 17:32:30 +0100"  >&lt;p&gt;I can see spacing problems in my patch (CSVExcelProblems-2.patch). I will fix  settings im my IDE and resubmit.&lt;/p&gt;</comment>
                            <comment id="13437876" author="tivv" created="Mon, 20 Aug 2012 15:04:12 +0100"  >&lt;p&gt;Patch with better padding&lt;/p&gt;</comment>
                            <comment id="13437878" author="tivv" created="Mon, 20 Aug 2012 15:06:00 +0100"  >&lt;p&gt;OK, I&apos;ve recreated patch with better spacing (csv3.patch). I&apos;ve set up my IDE for tab to be 8 chars, don&apos;t use tabs, use 4-chars indent. There still can be problems because original file uses tabs. I can reformat it without tabs, but did not do it for now.&lt;/p&gt;</comment>
                            <comment id="13438156" author="dvryaboy" created="Mon, 20 Aug 2012 21:14:43 +0100"  >&lt;p&gt;Committed to trunk. Thanks Vitalii and Peter!&lt;/p&gt;

&lt;p&gt;D&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12541594" name="csv3.patch" size="5962" author="tivv" created="Mon, 20 Aug 2012 15:04:12 +0100"/>
                            <attachment id="12516200" name="patch_PIG2556_CSVExcelStorage.patch" size="3221" author="stickyhipp" created="Mon, 27 Feb 2012 19:27:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 17 Aug 2012 12:24:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>229325</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyaxrr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97782</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>