<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:01:00 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2574/PIG-2574.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2574] Make reducer estimator plugable</title>
                <link>https://issues.apache.org/jira/browse/PIG-2574</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;I&apos;d like to refactor the logic contained in this method into a pluggable interface:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;static int JobControlCompiler.estimateNumberOfReducers(Configuration conf, List&amp;lt;POLoad&amp;gt; lds);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="12545595">PIG-2574</key>
            <summary>Make reducer estimator plugable</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="billgraham">Bill Graham</assignee>
                                    <reporter username="billgraham">Bill Graham</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Mar 2012 02:33:29 +0000</created>
                <updated>Fri, 22 Feb 2013 04:54:13 +0000</updated>
                            <resolved>Mon, 16 Apr 2012 06:53:50 +0100</resolved>
                                                    <fixVersion>0.11</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13224953" author="traviscrawford" created="Thu, 8 Mar 2012 02:41:28 +0000"  >&lt;p&gt;This is somewhat related to &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2573&quot; title=&quot;Automagically setting parallelism based on input file size does not work with HCatalog&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2573&quot;&gt;&lt;del&gt;PIG-2573&lt;/del&gt;&lt;/a&gt;. In that bug I&apos;m interested in making the default size-based estimator work with HCatalog. In this bug Bill is interested in using additional data to estimate the number of reducers.&lt;/p&gt;

&lt;p&gt;For example, if you want to produce counts for some field in a large data set, you may just want one reducer. However, if your input data size is large you&apos;ll get a large number of reducers too. A plugin could look at historical stats for this job and choose an appropriate number of reducers.&lt;/p&gt;</comment>
                            <comment id="13228627" author="billgraham" created="Tue, 13 Mar 2012 19:28:04 +0000"  >&lt;p&gt;Here&apos;s a first pass at a patch showing a proposed solution. It adds the following interface and default impl:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;o.a.p.backend.hadoop.executionengine.mapReduceLayer.PigReducerEstimator
o.a.p.backend.hadoop.executionengine.mapReduceLayer.InputFileSizeReducerEstimator
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;along with the following two optional configs to override the default estimator:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;pig.exec.reducer.estimator
pig.exec.reducer.estimator.arg
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13228746" author="billgraham" created="Tue, 13 Mar 2012 21:53:12 +0000"  >&lt;p&gt;Patch #1 had some bad diff action going on. Please disregard. Here&apos;s patch #2 for review.&lt;/p&gt;</comment>
                            <comment id="13233506" author="billgraham" created="Tue, 20 Mar 2012 15:45:39 +0000"  >&lt;p&gt;Patch #3 includes changes from &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2573&quot; title=&quot;Automagically setting parallelism based on input file size does not work with HCatalog&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2573&quot;&gt;&lt;del&gt;PIG-2573&lt;/del&gt;&lt;/a&gt; merged in. &lt;/p&gt;</comment>
                            <comment id="13234021" author="dvryaboy" created="Wed, 21 Mar 2012 01:36:56 +0000"  >&lt;p&gt;Looks good overall. I didn&apos;t run tests.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Please mark all new APIs as evolving&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Please add all new configurable keys to pig.properties, commented out, with instructions for people regarding what they mean&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&quot;@param job job configuration&quot; &amp;#8211; it&apos;s actually a Job, not just the config, right?&lt;/li&gt;
&lt;/ul&gt;


</comment>
                            <comment id="13239719" author="billgraham" created="Tue, 27 Mar 2012 18:47:11 +0100"  >&lt;p&gt;Here&apos;s a patch with Dmitriy&apos;s comments, plus a few other small edits:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Incorporated the fix from &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2616&quot; title=&quot;JobControlCompiler.getInputSizeFromLoader must handle exceptions from LoadFunc.getStatistics.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2616&quot;&gt;&lt;del&gt;PIG-2616&lt;/del&gt;&lt;/a&gt; into &lt;tt&gt;InputSizeReducerEstimator&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;Added both &lt;tt&gt;@InterfaceAudience.Public&lt;/tt&gt; and &lt;tt&gt;@InterfaceStability.Evolving&lt;/tt&gt; to &lt;tt&gt;PigReducerEstimator&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;Moved some tests from &lt;tt&gt;TestJobControlCompiler&lt;/tt&gt; to &lt;tt&gt;TestInputSizeReducerEstimator&lt;/tt&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Also, I added the following to &lt;tt&gt;.gitignore&lt;/tt&gt;. Let me know if I should back that out and put it in it&apos;s own patch:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+target/
+*.iml
+*.ipr
+*.iws
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13240762" author="billgraham" created="Wed, 28 Mar 2012 22:50:07 +0100"  >&lt;p&gt;Per discussions on the list, I&apos;ve moved the test class to a package that matches the class being tested. OK, now I&apos;m done until further review.&lt;/p&gt;</comment>
                            <comment id="13240970" author="julienledem" created="Thu, 29 Mar 2012 06:02:16 +0100"  >&lt;p&gt;Overall, this looks good to me.&lt;/p&gt;

&lt;p&gt;Here are my comments, mostly details. Some of them are about existing code that has been moved.&lt;/p&gt;

&lt;p&gt;1)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; listener != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? (PigProgressNotificationListener) listener : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;if listener is null you can still cast it.&lt;br/&gt;
just return (PigProgressNotificationListener) listener;&lt;/p&gt;

&lt;p&gt;2)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; reducers = (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.ceil((totalInputFileSize+0.0) / bytesPerReducer);
reducers = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.max(1, reducers); 
reducers = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.min(maxReducers, reducers);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;use a cast (double)totalInputFileSize to convert to double.&lt;br/&gt;
cast the final result to int instead. That will avoid bad conversion to integer if bytesPerReducer is small.&lt;/p&gt;

&lt;p&gt;3)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; instantiateObjectFromParams(Configuration conf, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; classParamKey, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; argParamKey) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;you can do the following so that classes using it don&apos;t need to cast. You still get a ClassCastException if it&apos;s not the correct type.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@SuppressWarnings(&lt;span class=&quot;code-quote&quot;&gt;&quot;unchecked&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;T&amp;gt; T instantiateObjectFromParams(Configuration conf, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; classParamKey, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; argParamKey) {
   ...
   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (T)result;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If you want to handle the cast with a better message you can do this (notice we don&apos;t need to suppress warnings anymore):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;T&amp;gt; T get(Configuration conf, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; classParamKey, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; argParamKey, &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;T&amp;gt; clazz) {
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      ...
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; clazz.&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(result);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ClassCastException e) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ExecException(&lt;span class=&quot;code-quote&quot;&gt;&quot;the class defined by &quot;&lt;/span&gt;+classParamKey+&lt;span class=&quot;code-quote&quot;&gt;&quot; in conf is not of type &quot;&lt;/span&gt;+clazz.getName(), e);
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13240997" author="billgraham" created="Thu, 29 Mar 2012 06:43:14 +0100"  >&lt;p&gt;Thanks Julien, here&apos;s a revised patch.&lt;/p&gt;</comment>
                            <comment id="13244976" author="billgraham" created="Tue, 3 Apr 2012 06:02:57 +0100"  >&lt;p&gt;Made two additional changes to make it cleaner when implementing &lt;tt&gt;PigReducerEstimator&lt;/tt&gt;.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Moved constants out of &lt;tt&gt;InputSizeReducerEstimator&lt;/tt&gt; into it&apos;s interface &lt;tt&gt;PigReducerEstimator&lt;/tt&gt;, since implementing classes might need these.&lt;/li&gt;
	&lt;li&gt;Setting &lt;tt&gt;mapred.reduce.tasks&lt;/tt&gt; in &lt;tt&gt;JobControlCompiler&lt;/tt&gt; since it shouldn&apos;t be the responsibility of &lt;tt&gt;PigReducerEstimator&lt;/tt&gt; to set this value, just to calculate it and return it.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13245029" author="dvryaboy" created="Tue, 3 Apr 2012 07:50:56 +0100"  >&lt;p&gt;+1 &lt;/p&gt;

&lt;p&gt;Looks good. Please commit when you get your keys &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="13254522" author="billgraham" created="Mon, 16 Apr 2012 06:53:50 +0100"  >&lt;p&gt;Committed to trunk.&lt;/p&gt;</comment>
                            <comment id="13254528" author="billgraham" created="Mon, 16 Apr 2012 06:57:57 +0100"  >&lt;p&gt;Not committed to 0.10 FYI. The patch isn&apos;t applying cleanly so I need to dig in a bit.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12603159">PIG-2871</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12518224" name="pig-2574_1.patch" size="17378" author="billgraham" created="Tue, 13 Mar 2012 19:28:04 +0000"/>
                            <attachment id="12518256" name="pig-2574_2.patch" size="17350" author="billgraham" created="Tue, 13 Mar 2012 21:53:12 +0000"/>
                            <attachment id="12519087" name="pig-2574_3.patch" size="19822" author="billgraham" created="Tue, 20 Mar 2012 15:45:39 +0000"/>
                            <attachment id="12520162" name="pig-2574_4.patch" size="26267" author="billgraham" created="Tue, 27 Mar 2012 18:47:11 +0100"/>
                            <attachment id="12520327" name="pig-2574_5.patch" size="27989" author="billgraham" created="Wed, 28 Mar 2012 22:50:07 +0100"/>
                            <attachment id="12520370" name="pig-2574_6.patch" size="28846" author="billgraham" created="Thu, 29 Mar 2012 06:43:13 +0100"/>
                            <attachment id="12521103" name="pig-2574_7.patch" size="28970" author="billgraham" created="Tue, 3 Apr 2012 06:02:56 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 8 Mar 2012 02:41:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>230781</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyaxuf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97794</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Support for custom PigReducerEstimator class via pig.exec.reducer.estimator and pig.exec.reducer.estimator.args.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>