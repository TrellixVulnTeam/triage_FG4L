<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:02:52 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2290/PIG-2290.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2290] TOBAG wraps tuple parameters in another tuple</title>
                <link>https://issues.apache.org/jira/browse/PIG-2290</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The TOBAG function indiscriminately wraps all parameters in a tuple.  When I pass a list of tuples to the function, I would expect it to return a bag containing those tuples.  Instead, it returns a bag containing single element tuples, where each tuple contains one of the tuples passed in.&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;tuples.txt&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
(mike,608)
(ryan,11624)
(justin,2317)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Demonstration using pig 0.9.0&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
grunt&amp;gt; TUPLE_DATA = LOAD &apos;tuples.txt&apos; AS (T:tuple(name:chararray,street_number:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;));
grunt&amp;gt; BAGGED = FOREACH TUPLE_DATA GENERATE TOBAG(T);
grunt&amp;gt; DESCRIBE BAGGED;
BAGGED: {{(name: chararray,street_number: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)}}
grunt&amp;gt; DUMP BAGGED;
({((mike,608))})
({((ryan,11624))})
({((justin,2317))})
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12523349">PIG-2290</key>
            <summary>TOBAG wraps tuple parameters in another tuple</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ryan.hoegg">Ryan Hoegg</assignee>
                                    <reporter username="ryan.hoegg">Ryan Hoegg</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Sep 2011 16:42:36 +0100</created>
                <updated>Thu, 26 Apr 2012 21:33:05 +0100</updated>
                            <resolved>Wed, 12 Oct 2011 20:06:22 +0100</resolved>
                                    <version>0.9.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>internal-udfs</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13106542" author="ryan.hoegg" created="Fri, 16 Sep 2011 16:48:51 +0100"  >&lt;p&gt;Patch to TOBAG function to check if the parameter is a tuple before creating one, including unit test&lt;/p&gt;</comment>
                            <comment id="13106676" author="dvryaboy" created="Fri, 16 Sep 2011 19:41:57 +0100"  >&lt;p&gt;Looks good, though the formatting is a little off:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+                } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                 Tuple tp2 = TupleFactory.getInstance().newTuple(1);
                 tp2.set(0, object);
                 bag.add(tp2);
             }
+            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The else block is not indented properly.&lt;/p&gt;

&lt;p&gt;Ok to put in trunk or do you feel this must go into 0.9.1?&lt;/p&gt;</comment>
                            <comment id="13106736" author="ryan.hoegg" created="Fri, 16 Sep 2011 20:19:18 +0100"  >&lt;p&gt;Fixed formatting in TOBAG.java&lt;/p&gt;</comment>
                            <comment id="13106841" author="thejas" created="Fri, 16 Sep 2011 22:48:47 +0100"  >&lt;p&gt;This change is not backward compatible. It can break existing pig queries. &lt;br/&gt;
It can be argued that the TOBAG current implementation has a correct/consistent behavior - it puts each argument into a tuple and adds it to a bag. The bag always contains tuple with single element. &lt;/p&gt;

&lt;p&gt;I think there has to be a very strong reason to break backward compatibility.  This could go into a new UDF (say TOBAG_2 ?). Or this could go into some major version upgrade of pig where we make bunch of non backward compatible changes.&lt;/p&gt;</comment>
                            <comment id="13106873" author="ryan.hoegg" created="Fri, 16 Sep 2011 23:31:49 +0100"  >&lt;p&gt;This is probably true, but the current implementation behaves inconsistently (output does not match schema).  Plus, it makes it impossible to generate a bag containing tuples with more than one element.&lt;/p&gt;

&lt;p&gt;Is 0.9 -&amp;gt; 0.10 considered a &quot;major version upgrade&quot;?&lt;/p&gt;</comment>
                            <comment id="13106899" author="thejas" created="Sat, 17 Sep 2011 00:14:19 +0100"  >&lt;p&gt;I didn&apos;t notice that the output does not match schema. That means one can&apos;t use the output of the TOBAG later in the query. So fixing this is not likely to have an impact on most of the existing queries. It will affect only some cases where the output of TOBAG is stored without further processing on it into a storage that does not store schema.&lt;br/&gt;
But this use case is something that users would need to check for, when the upgrade. I would vote for making this change only in 0.10, and not for 0.9.1 .&lt;/p&gt;</comment>
                            <comment id="13126004" author="thejas" created="Wed, 12 Oct 2011 19:08:12 +0100"  >&lt;p&gt;pig-2290.1.patch - fix patch format issue, updated javadoc.&lt;/p&gt;</comment>
                            <comment id="13126050" author="thejas" created="Wed, 12 Oct 2011 20:06:22 +0100"  >&lt;p&gt;+1 . Patch committed to trunk.&lt;br/&gt;
Thanks for the contribution Ryan!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12498786" name="pig-2290.1.patch" size="3622" author="thejas" created="Wed, 12 Oct 2011 19:08:12 +0100"/>
                            <attachment id="12494850" name="pig-2290.patch" size="3317" author="ryan.hoegg" created="Fri, 16 Sep 2011 20:19:18 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 16 Sep 2011 18:41:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35729</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyawi7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97577</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>If the argument to TOBAG is a tuple, it does not get inserted into another tuple before being added to the bag.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>