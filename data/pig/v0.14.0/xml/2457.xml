<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:49:34 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2457/PIG-2457.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2457] JsonLoaderStorage tests is broken for e2e</title>
                <link>https://issues.apache.org/jira/browse/PIG-2457</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description></description>
                <environment></environment>
        <key id="12537240">PIG-2457</key>
            <summary>JsonLoaderStorage tests is broken for e2e</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="daijy">Daniel Dai</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Jan 2012 20:58:00 +0000</created>
                <updated>Thu, 26 Apr 2012 21:32:41 +0100</updated>
                            <resolved>Wed, 4 Jan 2012 21:08:54 +0000</resolved>
                                    <version>0.10.0</version>
                    <version>0.11</version>
                                    <fixVersion>0.10.0</fixVersion>
                    <fixVersion>0.11</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13179868" author="daijy" created="Wed, 4 Jan 2012 21:03:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2453&quot; title=&quot;Fetching schema can be very slow for multi-thousand LOADs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2453&quot;&gt;&lt;del&gt;PIG-2453&lt;/del&gt;&lt;/a&gt; introduced jackson utilities into JsonMetaData, which is use in JsonLoader/JsonStorage in backend. We need to ship these classes.&lt;/p&gt;</comment>
                            <comment id="13179871" author="alangates" created="Wed, 4 Jan 2012 21:06:27 +0000"  >&lt;p&gt;+1, looks good.&lt;/p&gt;</comment>
                            <comment id="13179872" author="daijy" created="Wed, 4 Jan 2012 21:08:55 +0000"  >&lt;p&gt;Patch committed to trunk/0.10.&lt;/p&gt;</comment>
                            <comment id="13179898" author="dvryaboy" created="Wed, 4 Jan 2012 21:27:48 +0000"  >&lt;p&gt;How did this work before? JsonMetaData already used jackson (but not the util package).&lt;/p&gt;

&lt;p&gt; import org.codehaus.jackson.JsonParseException;&lt;br/&gt;
 import org.codehaus.jackson.map.JsonMappingException;&lt;br/&gt;
 import org.codehaus.jackson.map.ObjectMapper;&lt;/p&gt;</comment>
                            <comment id="13179901" author="dvryaboy" created="Wed, 4 Jan 2012 21:28:38 +0000"  >&lt;p&gt;(the reason I ask is, if we are blowing up the size of our job jar and it&apos;s not necessary, I can just write my own LRUMap, it&apos;s pretty trivial)&lt;/p&gt;</comment>
                            <comment id="13179910" author="daijy" created="Wed, 4 Jan 2012 21:37:24 +0000"  >&lt;p&gt;Good question. Is that possible jackon-core.jar is part of hadoop, but jackson-mapper is not? Surely large job.jar is not good.&lt;/p&gt;</comment>
                            <comment id="13179914" author="daijy" created="Wed, 4 Jan 2012 21:42:27 +0000"  >&lt;p&gt;Here is the stack BTW:&lt;/p&gt;

&lt;p&gt;Error: java.lang.ClassNotFoundException: org.codehaus.jackson.map.util.LRUMap at java.net.URLClassLoader$1.run(URLClassLoader.java:200) at java.security.AccessController.doPrivileged(Native Method) at java.net.URLClassLoader.findClass(URLClassLoader.java:188) at java.lang.ClassLoader.loadClass(ClassLoader.java:306) at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:276) at java.lang.ClassLoader.loadClass(ClassLoader.java:251) at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:319) at org.apache.pig.builtin.JsonMetadata.&amp;lt;init&amp;gt;(JsonMetadata.java:75) at org.apache.pig.builtin.JsonStorage.storeSchema(JsonStorage.java:269) at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigOutputCommitter.storeCleanup(PigOutputCommitter.java:143) at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigOutputCommitter.commitJob(PigOutputCommitter.java:180) at org.apache.hadoop.mapred.Task.runJobCleanupTask(Task.java:1002) at org.apache.hadoop.mapred.MapTask.run(MapTask.java:357) at org.apache.hadoop.mapred.Child$4.run(Child.java:255) at java.security.AccessController.doPrivileged(Native Method) at javax.security.auth.Subject.doAs(Subject.java:396) at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1059) at org.apache.hadoop.mapred.Child.main(Child.java:249) &lt;/p&gt;</comment>
                            <comment id="13179923" author="daijy" created="Wed, 4 Jan 2012 21:47:42 +0000"  >&lt;p&gt;I see the problem. Hadoop 20.205 bundles jackson 1.0.1, which does not contain LRUMap.&lt;/p&gt;</comment>
                            <comment id="13179993" author="dvryaboy" created="Wed, 4 Jan 2012 23:45:32 +0000"  >&lt;p&gt;We should probably ensure our classes are used then. I checked the size of the jars, they are about 800K:&lt;/p&gt;

&lt;p&gt;&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 dmitriy  staff   203K Feb 14  2011 build/ivy/lib/Pig/jackson-core-asl-1.7.3.jar&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 dmitriy  staff   611K Feb 14  2011 build/ivy/lib/Pig/jackson-mapper-asl-1.7.3.jar&lt;/p&gt;

&lt;p&gt;Kind of painful. We do need both the mapper and core. Do Hadoop&apos;s jars override ours on the classpath?&lt;/p&gt;</comment>
                            <comment id="13180005" author="daijy" created="Thu, 5 Jan 2012 00:07:11 +0000"  >&lt;p&gt;I think OutputCommitter is in backend. We will have to ship it or use hadoop&apos;s version of jackson. Another possible solution is to find out more specific package than org.codehaus.jackson(cuz only LRU class is not in 1.0.1), so we can ship less classes.&lt;/p&gt;</comment>
                            <comment id="13180016" author="daijy" created="Thu, 5 Jan 2012 00:18:30 +0000"  >&lt;p&gt;But PigStorage works fine, seems there is still something missing. I am looking.&lt;/p&gt;</comment>
                            <comment id="13180036" author="dvryaboy" created="Thu, 5 Jan 2012 00:32:01 +0000"  >&lt;p&gt;Like I said, I can just write an LRUMap of our own, it&apos;s not hard.&lt;br/&gt;
But I am worried about the version mismatch. This will affect AvroStorage too, Avro folks are the ones who requested that we bump our jackson version in the first place.&lt;/p&gt;</comment>
                            <comment id="13180100" author="daijy" created="Thu, 5 Jan 2012 01:41:27 +0000"  >&lt;p&gt;PigStorage also fail with &quot;-schema&quot; option (before I thought it by default creates the schema file).&lt;/p&gt;

&lt;p&gt;Yes, version mismatch is a bigger problem. In frontend, user can use &quot;HADOOP_USER_CLASSPATH_FIRST&quot; to override hadoop bundled jars, but for backend, hadoop always use bundled jars first. In our case, hadoop cannot find LRUMap in bundled jackson, so it goes to job.jar to find it. For Avro, it is not that lucky. I don&apos;t know a solution for that. We shall definitely push hadoop to bundled a newer jackson in next version (I am testing on 20.205).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12509459" name="PIG-2457-1.patch" size="658" author="daijy" created="Wed, 4 Jan 2012 21:03:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 4 Jan 2012 21:06:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>222749</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy3trr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56147</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>