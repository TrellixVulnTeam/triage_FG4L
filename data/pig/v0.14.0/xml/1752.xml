<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:48:41 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1752/PIG-1752.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1752] UDFs should be able to indicate files to load in the distributed cache</title>
                <link>https://issues.apache.org/jira/browse/PIG-1752</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Currently there is no way for a UDF to load a file into the distributed cache.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12491948">PIG-1752</key>
            <summary>UDFs should be able to indicate files to load in the distributed cache</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="alangates">Alan Gates</assignee>
                                    <reporter username="alangates">Alan Gates</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Dec 2010 00:49:40 +0000</created>
                <updated>Thu, 4 Aug 2011 01:35:08 +0100</updated>
                            <resolved>Mon, 6 Dec 2010 21:45:10 +0000</resolved>
                                                    <fixVersion>0.9.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12966381" author="daijy" created="Fri, 3 Dec 2010 01:34:55 +0000"  >&lt;p&gt;Do we want to add it to LoadFunc/StoreFunc as well?&lt;/p&gt;</comment>
                            <comment id="12966383" author="alangates" created="Fri, 3 Dec 2010 01:36:03 +0000"  >&lt;p&gt;This patch changes the EvalFunc interface to allow UDFs to declare a list of files they want to put in the distributed cache.  It adds a new method &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    /**
     * Allow a UDF to specify a list of files it would like placed in the distributed
     * cache.  These files will be put in the cache &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; every job the UDF is used in.
     * The &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; implementation returns &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;.
     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; A list of files
     */
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; getCacheFiles() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    }
    
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This change is backward compatible since EvalFunc is an abstract class and the default implementation returns null. &lt;/p&gt;

&lt;p&gt;Any files returned by getCacheFiles are captured and placed in the physical plan during logical-&amp;gt;physical translation.  The JobControlCompiler then visits each UDF and adds the files returned to the list of files to load into the distributed cache for this job.&lt;/p&gt;

&lt;p&gt;No special handling is provided for the files.  Users have to assure they are already on HDFS.  The filename should be of the form:&lt;/p&gt;

&lt;p&gt;hdfs://namenode/path#symlink&lt;/p&gt;

&lt;p&gt;where symlink is the name that the file will be linked into the tasks local directory under.  The UDF can then access the file in the backend by opening that symlink as a local file.&lt;/p&gt;</comment>
                            <comment id="12966384" author="alangates" created="Fri, 3 Dec 2010 01:41:40 +0000"  >&lt;p&gt;One other note.  I didn&apos;t include any unit tests with this patch.  I don&apos;t know how to test it in the unit tests since the distributed cache isn&apos;t used in local mode.  I&apos;ve tested it on a cluster.  Any thoughts on how to include tests for this in the unit tests are welcome.&lt;/p&gt;</comment>
                            <comment id="12966598" author="daijy" created="Fri, 3 Dec 2010 17:49:26 +0000"  >&lt;p&gt;+1. I don&apos;t think there is an easy way to put unit test. &lt;/p&gt;

&lt;p&gt;Also we can open another Jira for LoadFunc.&lt;/p&gt;</comment>
                            <comment id="12966738" author="alangates" created="Fri, 3 Dec 2010 23:49:49 +0000"  >&lt;p&gt;This may make sense to add to the load func as well, but I agree we can do that separately if we decide it would be useful.&lt;/p&gt;</comment>
                            <comment id="12966742" author="alangates" created="Fri, 3 Dec 2010 23:56:25 +0000"  >&lt;p&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; -1 overall.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 @author.  The patch does not contain any @author tags.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;                         Please justify why no tests are needed for this patch.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     -1 release audit.  The applied patch generated 450 release audit warnings (more than the trunk&apos;s current 449 warnings).&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The no tests issue I discussed above.&lt;/p&gt;

&lt;p&gt;The extra release audit is due to a .orig file left over from the merge&lt;/p&gt;

&lt;p&gt;All unit tests passed as well.&lt;/p&gt;</comment>
                            <comment id="12968423" author="alangates" created="Mon, 6 Dec 2010 21:45:10 +0000"  >&lt;p&gt;Patch checked in.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12460600">PIG-1337</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12465198" name="PIG-1752.patch" size="6834" author="alangates" created="Fri, 3 Dec 2010 01:30:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 3 Dec 2010 01:34:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66135</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyativ:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97094</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>We add a new method to EvalFunc:&lt;br/&gt;
public List&amp;lt;String&amp;gt; getCacheFiles();&lt;br/&gt;
&lt;br/&gt;
User can override this method to return a list of hdfs files need to shipped to distributed cache. Inside EvalFunc, user can assume these files are already exist in distributed cache.&lt;br/&gt;
&lt;br/&gt;
For example:&lt;br/&gt;
public class Udfcachetest extends EvalFunc&amp;lt;String&amp;gt; {&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public String exec(Tuple input) throws IOException {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;FileReader fr = new FileReader(&amp;quot;./smallfile&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BufferedReader d = new BufferedReader(fr);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return d.readLine();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public List&amp;lt;String&amp;gt; getCacheFiles() {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;List&amp;lt;String&amp;gt; list = new ArrayList&amp;lt;String&amp;gt;(1);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;list.add(&amp;quot;/user/pig/tests/data/small#smallfile&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return list;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
a = load &amp;#39;1.txt&amp;#39;;&lt;br/&gt;
b = foreach a generate Udfcachetest(*);&lt;br/&gt;
dump b;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>