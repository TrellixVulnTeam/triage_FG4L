<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:54:04 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1831/PIG-1831.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1831] Indeterministic behavior in local mode due to static variable PigMapReduce.sJobConf</title>
                <link>https://issues.apache.org/jira/browse/PIG-1831</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The below script when run in local mode gives me a different output. It looks like in local mode I have to store a relation obtained through streaming in order to use it afterwards.&lt;/p&gt;

&lt;p&gt; For example consider the below script : &lt;/p&gt;

&lt;p&gt;DEFINE MySTREAMUDF `test.sh`;&lt;br/&gt;
A  = LOAD &apos;myinput&apos; USING PigStorage() AS (myId:chararray, data2, data3,data4 );&lt;br/&gt;
B = STREAM A THROUGH MySTREAMUDF AS (wId:chararray, num:int);&lt;br/&gt;
--STORE B into &apos;output.B&apos;;&lt;br/&gt;
C = JOIN B by wId LEFT OUTER, A by myId;&lt;br/&gt;
D = FOREACH C GENERATE B::wId,B::num,data4 ;&lt;br/&gt;
D = STREAM D THROUGH MySTREAMUDF AS (f1:chararray,f2:int);&lt;br/&gt;
--STORE D into &apos;output.D&apos;;&lt;br/&gt;
E = foreach B GENERATE wId,num;&lt;br/&gt;
F = DISTINCT E;&lt;br/&gt;
G = GROUP F ALL;&lt;br/&gt;
H = FOREACH G GENERATE COUNT_STAR(F) as TotalCount;&lt;br/&gt;
I = CROSS D,H;&lt;br/&gt;
STORE I  into &apos;output.I&apos;;&lt;/p&gt;


&lt;p&gt;test.sh&lt;br/&gt;
---------&lt;br/&gt;
#/bin/bash&lt;br/&gt;
cut -f1,3&lt;/p&gt;


&lt;p&gt;And input is &lt;br/&gt;
abcd    label1  11      feature1&lt;br/&gt;
acbd    label2  22      feature2&lt;br/&gt;
adbc    label3  33      feature3&lt;/p&gt;


&lt;p&gt;Here if I store relation B and D then everytime i get the result  :&lt;br/&gt;
acbd            3&lt;br/&gt;
abcd            3&lt;br/&gt;
adbc            3&lt;/p&gt;

&lt;p&gt;But if i dont store relations B and D then I get an empty output.  Here again I have observed that this behaviour is random ie sometimes like 1out of 5 runs there will be output. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12497038">PIG-1831</key>
            <summary>Indeterministic behavior in local mode due to static variable PigMapReduce.sJobConf</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="vivekp">Vivek Padmanabhan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Jan 2011 10:02:31 +0000</created>
                <updated>Mon, 25 Apr 2011 22:27:08 +0100</updated>
                            <resolved>Fri, 18 Feb 2011 02:16:58 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12988910" author="daijy" created="Mon, 31 Jan 2011 21:47:10 +0000"  >&lt;p&gt;This issue is caused by race condition in using static variable PigMapReduce.sJobConf in local mode. In local mode, all mapreduce job share a single VM. Pig keep on overwriting static variable PigMapReduce.sJobConf each time we launch a new mapreduce job. When multiple mapreduce jobs launching simultaneously, one mapreduce job may use config for other mapreduce job, and cause indeterministic behavior. Options to fix this issue are:&lt;br/&gt;
1. force local mode run mapreduce job sequentially, if there is a way&lt;br/&gt;
2. Make sJobConf an array keyed by mapreduce jobid. However, some UDFs is using sJobConf, we could break backward compatibility&lt;/p&gt;</comment>
                            <comment id="12988920" author="daijy" created="Mon, 31 Jan 2011 22:07:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1831&quot; title=&quot;Indeterministic behavior in local mode due to static variable PigMapReduce.sJobConf&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1831&quot;&gt;&lt;del&gt;PIG-1831&lt;/del&gt;&lt;/a&gt;-0.patch illustrates how to fix the specific case in the Jira. However, a complete patch should address for all usage of PigMapReduce.sJobConf.&lt;/p&gt;</comment>
                            <comment id="12989335" author="daijy" created="Tue, 1 Feb 2011 19:05:45 +0000"  >&lt;p&gt;Richard suggest a better fix using ThreadLocal variable instead of static variable. Still keep static sJobConf for backward compatibility though it is already marked as deprecate in 0.7. In theory, if UDF still use deprecated sJobConf, they might see the same issue. But the chance of it should be very low.&lt;/p&gt;</comment>
                            <comment id="12989854" author="rding" created="Wed, 2 Feb 2011 23:05:02 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12994633" author="daijy" created="Tue, 15 Feb 2011 02:54:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1831&quot; title=&quot;Indeterministic behavior in local mode due to static variable PigMapReduce.sJobConf&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1831&quot;&gt;&lt;del&gt;PIG-1831&lt;/del&gt;&lt;/a&gt;-2.patch fix unit test failures.&lt;/p&gt;</comment>
                            <comment id="12994634" author="daijy" created="Tue, 15 Feb 2011 02:55:13 +0000"  >&lt;p&gt;Review notes: &lt;a href=&quot;https://reviews.apache.org/r/376/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/376/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12996201" author="daijy" created="Fri, 18 Feb 2011 01:54:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1831&quot; title=&quot;Indeterministic behavior in local mode due to static variable PigMapReduce.sJobConf&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1831&quot;&gt;&lt;del&gt;PIG-1831&lt;/del&gt;&lt;/a&gt;-3.patch fix findbug warnings.&lt;/p&gt;</comment>
                            <comment id="12996209" author="daijy" created="Fri, 18 Feb 2011 02:16:58 +0000"  >&lt;p&gt;Patch committed to both trunk and 0.8 branch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12469866" name="PIG-1831-0.patch" size="870" author="daijy" created="Mon, 31 Jan 2011 22:07:28 +0000"/>
                            <attachment id="12469969" name="PIG-1831-1.patch" size="23706" author="daijy" created="Tue, 1 Feb 2011 19:05:45 +0000"/>
                            <attachment id="12471052" name="PIG-1831-2.patch" size="24999" author="daijy" created="Tue, 15 Feb 2011 02:54:11 +0000"/>
                            <attachment id="12471356" name="PIG-1831-3.patch" size="25005" author="daijy" created="Fri, 18 Feb 2011 01:54:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 31 Jan 2011 21:47:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>165208</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyatzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97171</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>