<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:48:57 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1289/PIG-1289.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1289] PIG Join fails while doing a filter on joined data</title>
                <link>https://issues.apache.org/jira/browse/PIG-1289</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;PIG Join fails while doing a filter on joined data&lt;/p&gt;

&lt;p&gt;Here are the steps to reproduce it:&lt;br/&gt;
-bash-3.1$ pig -latest -x local&lt;br/&gt;
grunt&amp;gt; a = load &apos;first.dat&apos; using PigStorage(&apos;\u0001&apos;) as (f1:int, f2:chararray);&lt;br/&gt;
grunt&amp;gt; DUMP a;&lt;br/&gt;
(1,A)&lt;br/&gt;
(2,B)&lt;br/&gt;
(3,C)&lt;br/&gt;
(4,D)&lt;/p&gt;

&lt;p&gt;grunt&amp;gt; b = load &apos;second.dat&apos; using PigStorage() as (f3:chararray);&lt;br/&gt;
grunt&amp;gt; DUMP b;&lt;br/&gt;
(A)&lt;br/&gt;
(D)&lt;br/&gt;
(E)&lt;/p&gt;

&lt;p&gt;grunt&amp;gt; c = join a by f2 LEFT OUTER, b by f3;&lt;br/&gt;
grunt&amp;gt; DUMP c;&lt;br/&gt;
(1,A,A)&lt;br/&gt;
(2,B,)&lt;br/&gt;
(3,C,)&lt;br/&gt;
(4,D,D)&lt;br/&gt;
grunt&amp;gt; describe c;&lt;br/&gt;
c: &lt;/p&gt;
{a::f1: int,a::f2: chararray,b::f3: chararray}
&lt;p&gt;grunt&amp;gt; d = filter c by (f3 is null or f3 ==&apos;&apos;);&lt;/p&gt;

&lt;p&gt;grunt&amp;gt; dump d;&lt;br/&gt;
2010-03-03 15:00:37,129 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  org.apache.pig.impl.logicalLayer.optimizer.PruneColumns - No column pruned for b&lt;br/&gt;
2010-03-03 15:00:37,129 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  org.apache.pig.impl.logicalLayer.optimizer.PruneColumns - No map keys pruned for b&lt;br/&gt;
2010-03-03 15:00:37,129 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  org.apache.pig.impl.logicalLayer.optimizer.PruneColumns - No column pruned for a&lt;br/&gt;
2010-03-03 15:00:37,130 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  org.apache.pig.impl.logicalLayer.optimizer.PruneColumns - No map keys pruned for a&lt;br/&gt;
2010-03-03 15:00:37,130 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; ERROR org.apache.pig.tools.grunt.Grunt - ERROR 1002: Unable to store alias d&lt;/p&gt;


&lt;p&gt;This one is failing too:&lt;/p&gt;

&lt;p&gt;grunt&amp;gt; d = filter c by (b::f3 is null or b::f3 ==&apos;&apos;);&lt;/p&gt;

&lt;p&gt;or this one not returning results as expected:&lt;/p&gt;

&lt;p&gt;grunt&amp;gt; d = foreach c generate f1 as f1, f2 as f2, f3 as f3;&lt;br/&gt;
grunt&amp;gt; e = filter d by (f3 is null or f3 ==&apos;&apos;);&lt;br/&gt;
grunt&amp;gt; DUMP e;&lt;br/&gt;
(1,A,)&lt;br/&gt;
(2,B,)&lt;br/&gt;
(3,C,)&lt;br/&gt;
(4,D,)&lt;/p&gt;

&lt;p&gt;while the expected result is&lt;br/&gt;
(2,B,)&lt;br/&gt;
(3,C,)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12458684">PIG-1289</key>
            <summary>PIG Join fails while doing a filter on joined data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="karims">Karim Saadah</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Mar 2010 16:36:34 +0000</created>
                <updated>Tue, 20 Jul 2010 18:36:38 +0100</updated>
                            <resolved>Fri, 19 Mar 2010 06:48:20 +0000</resolved>
                                    <version>0.6.0</version>
                                    <fixVersion>0.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12843695" author="daijy" created="Wed, 10 Mar 2010 18:50:23 +0000"  >&lt;p&gt;The problem is we push filter in front of the out join. We should not push filter when:&lt;br/&gt;
1. filter is pushed to inner branch&lt;br/&gt;
2. filter condition is to test nullability&lt;/p&gt;</comment>
                            <comment id="12844576" author="hadoopqa" created="Fri, 12 Mar 2010 17:18:36 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12438569/PIG-1289-1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12438569/PIG-1289-1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 922169.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/246/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/246/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/246/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/246/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/246/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/246/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12846213" author="alangates" created="Tue, 16 Mar 2010 23:44:09 +0000"  >&lt;p&gt;I think I&apos;m missing something here.  It seems the criteria here should be that the filter is not pushed up a branch that will be producing nulls.  So, given a script like:&lt;/p&gt;

&lt;p&gt;A = load &apos;foo&apos; as (q, r, s);&lt;br/&gt;
B = load &apos;bar &apos; as (t, u, v);&lt;br/&gt;
C = join A on q outer, B on t;&lt;/p&gt;

&lt;p&gt;D = filter C by q &amp;gt; 0; &lt;/p&gt;

&lt;p&gt;is pushable, but &lt;/p&gt;

&lt;p&gt;D = filter C by t &amp;gt; 0;&lt;/p&gt;

&lt;p&gt;is not.  I think the test that at most one element of the join is outer and it is the one we are considering meets this criteria.  But I don&apos;t understand the need to check for null tests.&lt;/p&gt;
</comment>
                            <comment id="12846222" author="daijy" created="Wed, 17 Mar 2010 00:06:37 +0000"  >&lt;p&gt;Yes, it is safe not push filter up a branch that will be producing nulls. I might be wrong but what I did is try to be a little bit more aggressive. Since the only extra value outer join will produce is null, so if filter is not testing null, we can still push it up even if it is on the inner branch. &lt;/p&gt;

&lt;p&gt;Eg:&lt;br/&gt;
A = load &apos;foo&apos; as (q, r, s);&lt;br/&gt;
B = load &apos;bar &apos; as (t, u, v);&lt;br/&gt;
C = join A on q outer, B on t;&lt;br/&gt;
D = filter C by t &amp;gt; 0;&lt;/p&gt;

&lt;p&gt;The production C consists of two parts:&lt;br/&gt;
A + B&lt;br/&gt;
A + &quot;null&quot;&lt;/p&gt;

&lt;p&gt;If we do a filter after join, it is a union on this two parts:&lt;br/&gt;
filter(A + B) union filter(A + &quot;null&quot;)&lt;/p&gt;

&lt;p&gt;If we are not testing nullability (eg, t &amp;gt; 0), then filter(A + &quot;null&quot;) will not have any production, so&lt;br/&gt;
filter(A + B) union filter(A + &quot;null&quot;) = filter(A + B)&lt;/p&gt;

&lt;p&gt;In this case, outer join is equivalent as a regular join (since all generated null B records are filtered away), so we can still push the filter up.&lt;/p&gt;</comment>
                            <comment id="12846228" author="alangates" created="Wed, 17 Mar 2010 00:21:52 +0000"  >&lt;p&gt;In the case of &lt;/p&gt;

&lt;p&gt;D = filter C by t &amp;gt; 0&lt;/p&gt;

&lt;p&gt;the filter will evaluate to null when t is null.  By definition filters return only records that evaluate true.  So t &amp;gt; 0 will have the affect of filtering out all outer records of A because t will be null for every one of them.  That is, it turns the join into an inner join.  However, if the filter is pushed above the join, it will remain an outer join, since it will only filter the records from B where t &amp;gt; 0 and not the outer records from A.  Thus this transformation is not output neutral.&lt;/p&gt;</comment>
                            <comment id="12846246" author="daijy" created="Wed, 17 Mar 2010 01:06:43 +0000"  >&lt;p&gt;Oh, you are right. I need to further change the join type to regular join to make my idea work. Since changing the join type may broke some other part of the code, so let&apos;s be safe here and only push filter in front of a branch not generating null.&lt;/p&gt;</comment>
                            <comment id="12846315" author="hadoopqa" created="Wed, 17 Mar 2010 06:37:20 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12438992/PIG-1289-2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12438992/PIG-1289-2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 924034.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/253/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/253/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/253/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/253/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/253/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/253/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12847248" author="daijy" created="Fri, 19 Mar 2010 06:48:20 +0000"  >&lt;p&gt;Unit test failure due to port conflict. Manual test successful. Patch committed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12469736">PIG-1507</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12438569" name="PIG-1289-1.patch" size="3619" author="daijy" created="Fri, 12 Mar 2010 02:38:06 +0000"/>
                            <attachment id="12438992" name="PIG-1289-2.patch" size="3486" author="daijy" created="Wed, 17 Mar 2010 01:40:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 10 Mar 2010 18:50:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164792</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyaoqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96318</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>