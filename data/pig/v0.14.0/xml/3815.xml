<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:52:03 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3815/PIG-3815.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3815] Hadoop bug causes to pig to fail silently with jar cache</title>
                <link>https://issues.apache.org/jira/browse/PIG-3815</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Pig uses DistributedCache.addFileToClassPath api that puts jars on distributed cache configuration. This uses : to separate list of files to be put of classpath via distributed cache. If fs.default.name has port number in it, it causes the tokenization logic to fail in hadoop for retrieving list of cache filenames in backend.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12702048">PIG-3815</key>
            <summary>Hadoop bug causes to pig to fail silently with jar cache</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aniket486">Aniket Mokashi</assignee>
                                    <reporter username="aniket486">Aniket Mokashi</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Mar 2014 01:52:02 +0000</created>
                <updated>Mon, 7 Jul 2014 19:08:00 +0100</updated>
                            <resolved>Sun, 23 Mar 2014 06:48:23 +0000</resolved>
                                    <version>0.13.0</version>
                                    <fixVersion>0.13.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13939354" author="cheolsoo" created="Tue, 18 Mar 2014 15:08:26 +0000"  >&lt;ol&gt;
	&lt;li&gt;Can you delete this? It&apos;s unused.
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.codehaus.plexus.util.IOUtil;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Do you mind fixing JobControlCompiler.java#L1700 too? Looks like we can use IOUtils.closeQuietly() here too.
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        OutputStream os = fs.create(dst);
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            IOUtils.copyBytes(url.openStream(), os, 4096, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
            &lt;span class=&quot;code-comment&quot;&gt;// IOUtils can not close both the input and the output properly in a &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt;
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// as we can get an exception in between opening the stream and calling the method
&lt;/span&gt;            os.close();
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13939606" author="julienledem" created="Tue, 18 Mar 2014 18:31:16 +0000"  >&lt;p&gt;same comment as 1. from Cheolsoo&lt;br/&gt;
otherwise, this looks good to me.&lt;/p&gt;</comment>
                            <comment id="13939618" author="aniket486" created="Tue, 18 Mar 2014 18:38:27 +0000"  >&lt;p&gt;Thanks for the review, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=julienledem&quot; class=&quot;user-hover&quot; rel=&quot;julienledem&quot;&gt;Julien Le Dem&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;. I have attached revised patch and committed it to trunk!&lt;/p&gt;</comment>
                            <comment id="13939712" author="rohini" created="Tue, 18 Mar 2014 20:09:10 +0000"  >&lt;p&gt;Actually I see some issue with this patch. Reopening jira.&lt;/p&gt;

&lt;p&gt;   1) Changing os.close() to IOUtils.closeQuietly(os); is not good. You can close the input quietly, but not output especially HDFS outputstream. HDFS can create empty files  without data which can be accessed through NN fine if os.close() failed. We have been bitten by this a lot of time. In internal projects, we delete the file and retry if os.close() failed.  So please let the pig script fail if os.close() failed rather than causing unexpected behavior.&lt;/p&gt;

&lt;p&gt;   2) addFileToClassPath is already doing  file.toUri().getPath(). I don&apos;t see where the hadoop bug is coming from. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc/hadoop/common/branches/branch-1.0/src/mapred/org/apache/hadoop/filecache/DistributedCache.java?revision=1206848&amp;amp;view=markup&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/hadoop/common/branches/branch-1.0/src/mapred/org/apache/hadoop/filecache/DistributedCache.java?revision=1206848&amp;amp;view=markup&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void addFileToClassPath
           (Path file, Configuration conf, FileSystem fs)
        &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; filepath = file.toUri().getPath();
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; classpath = conf.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;mapred.job.classpath.files&quot;&lt;/span&gt;);
    conf.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;mapred.job.classpath.files&quot;&lt;/span&gt;, classpath == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
        ? filepath
        : classpath + &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;path.separator&quot;&lt;/span&gt;) + filepath);
    URI uri = fs.makeQualified(file).toUri();
    addCacheFile(uri, conf);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13939728" author="aniket486" created="Tue, 18 Mar 2014 20:29:54 +0000"  >&lt;p&gt;Thanks for your comments, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;Rohini Palaniswamy&lt;/a&gt;. I was not aware of limitations on the HDFS streams, I have attached a patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3815&quot; title=&quot;Hadoop bug causes to pig to fail silently with jar cache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3815&quot;&gt;&lt;del&gt;PIG-3815&lt;/del&gt;&lt;/a&gt;-2.patch) to fix those problems.&lt;/p&gt;

&lt;p&gt;Hadoop Jira: &lt;a href=&quot;https://issues.apache.org/jira/browse/MAPREDUCE-2361&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/MAPREDUCE-2361&lt;/a&gt;. Looks like this was fixed here - &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1077790&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1077790&lt;/a&gt;. &lt;/p&gt;
</comment>
                            <comment id="13939749" author="julienledem" created="Tue, 18 Mar 2014 20:40:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;Rohini Palaniswamy&lt;/a&gt; in the code you quoted, don&apos;t you think it is putting the port back in the following line?&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;URI uri = fs.makeQualified(file).toUri();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13939750" author="rohini" created="Tue, 18 Mar 2014 20:40:46 +0000"  >&lt;p&gt;Yes. It has been fixed 3 years ago. I am not sure what version of hadoop you are using and hitting this issue. But since we still support 0.20 as well there is no harm in doing .toUri().getPath() in pig as well. &lt;/p&gt;

&lt;p&gt;+1. Since the issue is not with hadoop 1.0, please update your comment when checking in this patch from  &quot;// &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3815&quot; title=&quot;Hadoop bug causes to pig to fail silently with jar cache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3815&quot;&gt;&lt;del&gt;PIG-3815&lt;/del&gt;&lt;/a&gt; In hadoop 1.0, addFileToClassPath uses : as separator&quot; to say hadoop 0.20. &lt;/p&gt;</comment>
                            <comment id="13939815" author="rohini" created="Tue, 18 Mar 2014 21:17:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=julienledem&quot; class=&quot;user-hover&quot; rel=&quot;julienledem&quot;&gt;Julien Le Dem&lt;/a&gt;,&lt;br/&gt;
    It is being qualified only to be used in addCacheFile() which sets the mapred.cache.files which is required. conf.set(&quot;mapred.job.classpath.files&quot;) uses just the file path after removing scheme and port.&lt;/p&gt;</comment>
                            <comment id="13939825" author="aniket486" created="Tue, 18 Mar 2014 21:24:43 +0000"  >&lt;p&gt;I have committed &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3815&quot; title=&quot;Hadoop bug causes to pig to fail silently with jar cache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3815&quot;&gt;&lt;del&gt;PIG-3815&lt;/del&gt;&lt;/a&gt;-2.patch to trunk! Thanks everyone for your comments.&lt;/p&gt;</comment>
                            <comment id="13940196" author="aniket486" created="Wed, 19 Mar 2014 05:26:47 +0000"  >&lt;p&gt;I just realized that there is a better way to refactor this code. Can someone review the patch attached?&lt;/p&gt;</comment>
                            <comment id="13940600" author="cheolsoo" created="Wed, 19 Mar 2014 15:54:18 +0000"  >&lt;p&gt;Ha, that looks a lot better to me. +1.&lt;/p&gt;</comment>
                            <comment id="13940867" author="aniket486" created="Wed, 19 Mar 2014 19:13:57 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;, I committed it to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12635362" name="PIG-3815-1.patch" size="2843" author="aniket486" created="Tue, 18 Mar 2014 18:29:37 +0000"/>
                            <attachment id="12635391" name="PIG-3815-2.patch" size="1475" author="aniket486" created="Tue, 18 Mar 2014 20:21:02 +0000"/>
                            <attachment id="12635492" name="PIG-3815-3.patch" size="2133" author="aniket486" created="Wed, 19 Mar 2014 05:25:22 +0000"/>
                            <attachment id="12635220" name="PIG-3815.patch" size="2435" author="aniket486" created="Tue, 18 Mar 2014 01:53:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 18 Mar 2014 15:08:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>380388</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzne67:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>380669</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>