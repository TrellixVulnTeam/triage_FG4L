<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:01:24 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2629/PIG-2629.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2629] Wrong Usage of Scalar which is null causes high namenode operation </title>
                <link>https://issues.apache.org/jira/browse/PIG-2629</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Script&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
A = LOAD &apos;test3.txt&apos;   AS (from:chararray);
B = LOAD &apos;test2.txt&apos;    AS (source:chararray,to:chararray);
C = FILTER A BY (from == &apos;temp&apos; );
D = FILTER B BY (source MATCHES &apos;.*xyz*.&apos;);
E = JOIN C by (from) left &lt;span class=&quot;code-keyword&quot;&gt;outer&lt;/span&gt;,D by (to);
F = FILTER E BY (D.to IS NULL);
dump F;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Inputs&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ cat test2.txt
temp    temp
temp    temp
temp    temp
temp    temp
temp    temp
tepm    tepm

$ cat test3.txt  |head
temp
temp
temp
temp
temp
temp
tepm
temp
temp
temp
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here I have by mistake called &apos;to&apos; using &apos;D.to&apos; instead of &apos;D::to&apos;. The D relation gives null output. &lt;/p&gt;

&lt;p&gt;First Map Reduce job computes D which give null results.&lt;br/&gt;
The MapPlan of 2nd job&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Union[tuple] - scope-56
|
|---E: Local Rearrange[tuple]{chararray}(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;) - scope-36
|   |   |
|   |   Project[chararray][0] - scope-37
|   |
|   |---C: Filter[bag] - scope-26
|       |   |
|       |   Equal To[&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;] - scope-29
|       |   |
|       |   |---Project[chararray][0] - scope-27
|       |   |
|       |   |---Constant(temp) - scope-28
|       |
|       |---A: New For Each(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)[bag] - scope-25
|           |   |
|           |   Cast[chararray] - scope-23
|           |   |
|           |   |---Project[bytearray][0] - scope-22
|           |
|           |---F: Filter[bag] - scope-17
|               |   |
|               |   POIsNull[&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;] - scope-21
|               |   |
|               |   |---POUserFunc(org.apache.pig.impl.builtin.ReadScalars)[chararray] - scope-20
|               |       |
|               |       |---Constant(1) - scope-18
|               |       |
|               |       |---Constant(hdfs:&lt;span class=&quot;code-comment&quot;&gt;//nn-nn1/tmp/temp-1607149525/tmp281350188) - scope-19
&lt;/span&gt;|               |
|               |---A: Load(hdfs:&lt;span class=&quot;code-comment&quot;&gt;//nn-nn1/user/anithar/test3.txt:org.apache.pig.builtin.PigStorage) - scope-0
&lt;/span&gt;|
|---E: Local Rearrange[tuple]{chararray}(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;) - scope-38
    |   |
    |   Project[chararray][1] - scope-39
    |
    |---Load(hdfs:&lt;span class=&quot;code-comment&quot;&gt;//nn-nn1/tmp/temp-1607149525/tmp-458164144:org.apache.pig.impl.io.TFileStorage) - scope-53--------&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here at F , the file /tmp/temp-1607149525/tmp281350188 which is the output of the 1st Mapreduce Job is repeatedly read. &lt;br/&gt;
If the input to F was non empty, since I am calling the scalar wrongly, it would have failed with the expected error message &apos;Scalar has more than 1 row in the output&apos;.&lt;/p&gt;

&lt;p&gt;But since its null, it returns in ReadScalars before the exception is thrown and gives these in the task logs repeatedly &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2012-04-03 11:46:58,824 INFO org.apache.hadoop.mapreduce.lib.input.FileInputFormat: Total input paths to process : 1
2012-04-03 11:46:58,824 INFO org.apache.pig.backend.hadoop.executionengine.util.MapRedUtil: Total input paths to process : 1
2012-04-03 11:46:58,827 WARN org.apache.pig.impl.builtin.ReadScalars: No scalar field to read, returning &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
....
....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That is its reading the &apos;/tmp/temp-1607149525/tmp281350188&apos; file again and again which was causing high namenode operation. &lt;br/&gt;
The cost of one small mistake had ended up causing heavy namenode operations.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Anitha&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12549345">PIG-2629</key>
            <summary>Wrong Usage of Scalar which is null causes high namenode operation </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rohini">Rohini Palaniswamy</assignee>
                                    <reporter username="anitharaju">Anitha Raju</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Apr 2012 15:52:51 +0100</created>
                <updated>Tue, 15 Apr 2014 21:44:57 +0100</updated>
                            <resolved>Fri, 6 Dec 2013 00:45:45 +0000</resolved>
                                    <version>0.8.1</version>
                    <version>0.9.2</version>
                    <version>0.10.0</version>
                                    <fixVersion>0.12.1</fixVersion>
                    <fixVersion>0.13.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13249495" author="aniket486" created="Sun, 8 Apr 2012 08:37:08 +0100"  >&lt;p&gt;I think we should make scalar syntax more explicit to avoid such problems. D-&amp;gt;to or SCALAR(D.to) are few options.&lt;/p&gt;</comment>
                            <comment id="13249496" author="aniket486" created="Sun, 8 Apr 2012 08:37:20 +0100"  >&lt;p&gt;I think we should make scalar syntax more explicit to avoid such problems. D-&amp;gt;to or SCALAR(D.to) are few options.&lt;/p&gt;</comment>
                            <comment id="13802107" author="rohini" created="Tue, 22 Oct 2013 19:41:41 +0100"  >&lt;p&gt;We hit this again. Need to also fix ReadScalars to not read the file again if the value is null. &lt;/p&gt;</comment>
                            <comment id="13804601" author="cheolsoo" created="Thu, 24 Oct 2013 20:42:19 +0100"  >&lt;p&gt;+1.&lt;/p&gt;

&lt;p&gt;One minor comment: You can just do if(!valueLoaded), can&apos;t you?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !valueLoaded) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13840740" author="rohini" created="Fri, 6 Dec 2013 00:30:19 +0000"  >&lt;p&gt;Addressed Cheolsoo&apos;s comment.&lt;/p&gt;</comment>
                            <comment id="13840752" author="rohini" created="Fri, 6 Dec 2013 00:45:45 +0000"  >&lt;p&gt;Committed to branch-0.12 (0.12.1) and trunk (0.13). Thanks Cheolsoo for the review.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12689075">PIG-3669</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12609889" name="PIG-2629-1.patch" size="2136" author="rohini" created="Wed, 23 Oct 2013 18:49:47 +0100"/>
                            <attachment id="12617277" name="PIG-2629-2.patch" size="4102" author="rohini" created="Fri, 6 Dec 2013 00:30:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 8 Apr 2012 07:37:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>234336</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyayb3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97869</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>