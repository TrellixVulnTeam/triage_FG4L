<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:03:22 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1536/PIG-1536.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1536] use same logic for merging inner schemas in &quot;default union&quot; and &quot;union onschema&quot;</title>
                <link>https://issues.apache.org/jira/browse/PIG-1536</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;We should consider using logic for merging inner schema in case of the two different types of union. &lt;/p&gt;

&lt;p&gt;In case of &apos;default union&apos;, it merges the two inner schema of bags/tuples by position if the number of fields are same and the corresponding types are compatible. &lt;/p&gt;

&lt;p&gt;In case of &apos;union onschema&apos;, it considers tuple/bag with different innerschema to be incompatible types.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12470836">PIG-1536</key>
            <summary>use same logic for merging inner schemas in &quot;default union&quot; and &quot;union onschema&quot;</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="thejas">Thejas M Nair</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Aug 2010 21:41:19 +0100</created>
                <updated>Thu, 4 Aug 2011 01:35:02 +0100</updated>
                            <resolved>Fri, 25 Feb 2011 00:12:44 +0000</resolved>
                                                    <fixVersion>0.9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12895410" author="thejas" created="Wed, 4 Aug 2010 21:43:02 +0100"  >
&lt;p&gt;The way &apos;default union&apos; deals with columns of different but compatible types in same position is not right. It creates a merged schema choosing a merged type, but there is not cast that happens to convert the rows to this type.&lt;br/&gt;
eg -&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
grunt&amp;gt; l1 = load &apos;/tmp/f1&apos; as (a : chararray, t (a : &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, c : &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;) );
grunt&amp;gt; l2 = load &apos;/tmp/f1&apos; as (a : chararray, t (a : &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, b : &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) ); 
grunt&amp;gt; u = union l1, l2;                                              
grunt&amp;gt; describe u;                                                    
u: {a: chararray,t: (a: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,c: &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;)}

-- the result of u, only the rows originating from l1 will correspond to schema shown in describe.

MapReduce node 1-206
Map Plan
u: Store(fakefile:org.apache.pig.builtin.PigStorage) - 1-203
|
|---u: Union[bag] - 1-202
    |
    |---l1: New For Each(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)[bag] - 1-195
    |   |   |
    |   |   Cast[chararray] - 1-192
    |   |   |
    |   |   |---Project[bytearray][0] - 1-191
    |   |   |
    |   |   Cast[tuple:(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;)] - 1-194
    |   |   |
    |   |   |---Project[bytearray][1] - 1-193
    |   |
    |   |---l1: Load(/tmp/f1:org.apache.pig.builtin.PigStorage) - 1-190
    |
    |---l2: New For Each(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)[bag] - 1-201
        |   |
        |   Cast[chararray] - 1-198
        |   |
        |   |---Project[bytearray][0] - 1-197
        |   |
        |   Cast[tuple:(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)] - 1-200
        |   |
        |   |---Project[bytearray][1] - 1-199
        |
        |---l2: Load(/tmp/f1:org.apache.pig.builtin.PigStorage) - 1-196--------
Global sort: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
----------------

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12991569" author="daijy" created="Mon, 7 Feb 2011 20:15:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1536&quot; title=&quot;use same logic for merging inner schemas in &amp;quot;default union&amp;quot; and &amp;quot;union onschema&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1536&quot;&gt;&lt;del&gt;PIG-1536&lt;/del&gt;&lt;/a&gt;-2.patch address Thejas&apos;s review comment.&lt;/p&gt;</comment>
                            <comment id="12991577" author="thejas" created="Mon, 7 Feb 2011 20:28:59 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12992132" author="daijy" created="Tue, 8 Feb 2011 19:35:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1536&quot; title=&quot;use same logic for merging inner schemas in &amp;quot;default union&amp;quot; and &amp;quot;union onschema&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1536&quot;&gt;&lt;del&gt;PIG-1536&lt;/del&gt;&lt;/a&gt;-3.patch resync with trunk.&lt;/p&gt;</comment>
                            <comment id="12999145" author="daijy" created="Fri, 25 Feb 2011 00:12:44 +0000"  >&lt;p&gt;Patch committed to trunk.&lt;/p&gt;</comment>
                            <comment id="12999146" author="daijy" created="Fri, 25 Feb 2011 00:13:15 +0000"  >&lt;p&gt;Review notes: &lt;a href=&quot;https://reviews.apache.org/r/387/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/387/&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12470199" name="PIG-1536-1.patch" size="31865" author="daijy" created="Thu, 3 Feb 2011 23:27:45 +0000"/>
                            <attachment id="12470493" name="PIG-1536-2.patch" size="32645" author="daijy" created="Mon, 7 Feb 2011 20:15:41 +0000"/>
                            <attachment id="12470620" name="PIG-1536-3.patch" size="32005" author="daijy" created="Tue, 8 Feb 2011 19:35:20 +0000"/>
                            <attachment id="12471053" name="PIG-1536-4.patch" size="32035" author="daijy" created="Tue, 15 Feb 2011 03:06:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 7 Feb 2011 20:15:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66172</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyarhr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96765</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>The behavior of union and uniononschema converges after this patch:&lt;br/&gt;
1. Union on relation of two different size result a null schema (union only):&lt;br/&gt;
A: (a1:long, a2:long)&lt;br/&gt;
B: (b1:long, b2:long, b3:long)&lt;br/&gt;
A union B: null&lt;br/&gt;
&lt;br/&gt;
2. Union column of incompatible type result a bytearray type:&lt;br/&gt;
A: (a1:long, a2:long)&lt;br/&gt;
B: (b1:(b11:long, b12:long), b2:long)&lt;br/&gt;
A union B: (a1:bytearray, a2:long)&lt;br/&gt;
&lt;br/&gt;
3. Union column of compatible type will produce a escalate the type. The priority is chararray -&amp;gt; double -&amp;gt; float -&amp;gt; long -&amp;gt; int -&amp;gt; bytearray:&lt;br/&gt;
A: (a1:int, a2:double, a3:int)&lt;br/&gt;
B: (b1:float, b2:chararray, b3:bytearray)&lt;br/&gt;
A union B: (a1:float, a2:chararray, a3:int)&lt;br/&gt;
&lt;br/&gt;
4. Union different inner type result an empty complex type:&lt;br/&gt;
A: (a1:(a11:long, a12:int), a2:{(a21:charray, a22:int)})&lt;br/&gt;
B: (b1:(b11:int, b12:int), b2:{(b21:int, b22:int)})&lt;br/&gt;
A union B: (a1:(), a2:{()})&lt;br/&gt;
&lt;br/&gt;
5. Always take the alias of first relation as the alias of unioned relation field</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>