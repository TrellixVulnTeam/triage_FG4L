<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:10:46 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2924/PIG-2924.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2924] PigStats should not be assuming all Storage classes to be file-based storage</title>
                <link>https://issues.apache.org/jira/browse/PIG-2924</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Using PigStatsUtil (like Oozie does) to collect JobStats for jobs that use a HBaseStorage blows up when the stats are asked to be accumulated.&lt;/p&gt;

&lt;p&gt;This is because JobStats (which adds stuff up) is assuming all storages are file based and that it can do listStatus/etc. operations on their filespec-provided filename. For HBaseStorage, this is set to the tablename and there&apos;s no such file, leading to an exception (FileNotFound or Invalid URI - depending on using &apos;tablename&apos; or &apos;hbase://tablename&apos;).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12608249">PIG-2924</key>
            <summary>PigStats should not be assuming all Storage classes to be file-based storage</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cheolsoo">Cheolsoo Park</assignee>
                                    <reporter username="qwertymaniac">Harsh J</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Sep 2012 15:37:31 +0100</created>
                <updated>Wed, 23 Apr 2014 02:10:35 +0100</updated>
                            <resolved>Mon, 19 Nov 2012 19:54:52 +0000</resolved>
                                    <version>0.9.2</version>
                    <version>0.10.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                                    <component>tools</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13458723" author="qwertymaniac" created="Wed, 19 Sep 2012 15:42:25 +0100"  >&lt;p&gt;A straight forward fix may be to intercept the FileNotFound issues. A proper fix may be to have storages report if they are file-based or otherwise?&lt;/p&gt;</comment>
                            <comment id="13459167" author="billgraham" created="Wed, 19 Sep 2012 23:25:41 +0100"  >&lt;p&gt;We ran into similar issues with HCatalog and reducer estimation (&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2573&quot; title=&quot;Automagically setting parallelism based on input file size does not work with HCatalog&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2573&quot;&gt;&lt;del&gt;PIG-2573&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2574&quot; title=&quot;Make reducer estimator plugable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2574&quot;&gt;&lt;del&gt;PIG-2574&lt;/del&gt;&lt;/a&gt;), since an HDFS path was assumed.&lt;/p&gt;

&lt;p&gt;For this issue we could register different classes that know how to look up (or not support) stats based on the URI prefix of the data location (hdfs, hbase, s3, etc).&lt;/p&gt;</comment>
                            <comment id="13485320" author="cheolsoo" created="Sat, 27 Oct 2012 02:19:20 +0100"  >&lt;p&gt;I am attaching a patch that implements Bill&apos;s suggestion. To make the computation of the output size plugable, I did the following:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added a new interface called PigStatsOutputSizeComputer.&lt;/li&gt;
	&lt;li&gt;Added a default implementation of this interface called FileBasedOutputSizeComputer.&lt;/li&gt;
	&lt;li&gt;Added a new flag via which a custom output size computer can be registered.&lt;/li&gt;
	&lt;li&gt;Added unit test cases for both file-based and non-file-based systems.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Basically, I followed the pattern that Bill introduced for the reducer estimator in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2574&quot; title=&quot;Make reducer estimator plugable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2574&quot;&gt;&lt;del&gt;PIG-2574&lt;/del&gt;&lt;/a&gt;. Any comments would be appreciated.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13485814" author="cheolsoo" created="Mon, 29 Oct 2012 03:47:57 +0000"  >&lt;p&gt;Adding the new property (pig.stats.output.size.computer) to the default pig.properties file with comments.&lt;/p&gt;</comment>
                            <comment id="13486229" author="billgraham" created="Mon, 29 Oct 2012 18:15:37 +0000"  >&lt;p&gt;This looks great, thanks for taking this one. I think we need to make a few changes to the pattern used &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2574&quot; title=&quot;Make reducer estimator plugable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2574&quot;&gt;&lt;del&gt;PIG-2574&lt;/del&gt;&lt;/a&gt; though, because we could have a case where we have multiple store funcs that each write to a different data source.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Instead of registering a single new computer it would be ideal if we could register a list of computers.&lt;/li&gt;
	&lt;li&gt;Each computer could have a &lt;tt&gt;boolean supports(POStore poStore)&lt;/tt&gt; method that returns whether this class supports a given POStore. This can often be done by inspecting the output path. A default URI-based abstract class could help with that part.&lt;/li&gt;
	&lt;li&gt;The computers would then be consulted in order, where the first to support the POStore wins.&lt;/li&gt;
	&lt;li&gt;If a computer can&apos;t determine a size for some reason (i.e., it doesn&apos;t support it or an exception occurred), it shouldn&apos;t return 0. Instead maybe we reserve -1 for this case and document it as such.&lt;/li&gt;
	&lt;li&gt;Having the word Computer in the interface name and configs could cause confusion, due to how it&apos;s an overloaded term. I don&apos;t have any great suggestions though. &lt;tt&gt;PigStatsOutputSizeReader&lt;/tt&gt;?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thoughts? &lt;/p&gt;
</comment>
                            <comment id="13486456" author="cheolsoo" created="Mon, 29 Oct 2012 22:55:35 +0000"  >&lt;p&gt;Hi Bill, thank you very much for reviewing my patch!&lt;/p&gt;

&lt;p&gt;I totally agree with most of your comments. In particular, adding a supports() method seems like an elegant way to support multiple computers. I will make that change in a new patch.&lt;/p&gt;

&lt;p&gt;But I am wondering if you would agree to remove POStore from the interface. The reason why I want to remove it is because I don&apos;t think that POStore is needed to implement supports() and getOutputSize() for any kinds of computers. All we need is probably the uri string, so it seems to make sense to pass the uri string (or a URI object) instead of the whole POStore. Please let me know if you think otherwise. &lt;/p&gt;

&lt;p&gt;Regarding the name of the interface, I couldn&apos;t come up with a better name. Reader sounds good to me. Maybe reporter or calculator?&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13486660" author="cheolsoo" created="Tue, 30 Oct 2012 05:19:43 +0000"  >&lt;p&gt;I updated the patch as follows:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Having the word Computer in the interface name and configs could cause confusion, due to how it&apos;s an overloaded term. I don&apos;t have any great suggestions though. PigStatsOutputSizeReader?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Changed to &lt;tt&gt;PigStatsOutputSizeReader&lt;/tt&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Instead of registering a single new computer it would be ideal if we could register a list of computers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Fixed.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Each computer could have a boolean supports(POStore poStore) method that returns whether this class supports a given POStore. This can often be done by inspecting the output path. A default URI-based abstract class could help with that part.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Each reader implements &lt;tt&gt;boolean supports(String uri)&lt;/tt&gt; method. For &lt;tt&gt;FileBasedOutputSizeReader&lt;/tt&gt;, the output of &lt;tt&gt;UriUtil.isHDFSFileOrLocalOrS3N()&lt;/tt&gt; is returned.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The computers would then be consulted in order, where the first to support the POStore wins.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Fixed.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If a computer can&apos;t determine a size for some reason (i.e., it doesn&apos;t support it or an exception occurred), it shouldn&apos;t return 0. Instead maybe we reserve -1 for this case and document it as such.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Fixed.&lt;/p&gt;

&lt;p&gt;In addition, I replaced &lt;tt&gt;POStore&lt;/tt&gt; with &lt;tt&gt;String&lt;/tt&gt;. Please let me know what you think.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13487444" author="cheolsoo" created="Wed, 31 Oct 2012 01:48:29 +0000"  >&lt;p&gt;Updating the comments in pig.properties to make it clear that the user can register multiple readers, and the 1st reader that supports the given uri will be used.&lt;/p&gt;</comment>
                            <comment id="13493019" author="billgraham" created="Thu, 8 Nov 2012 07:24:49 +0000"  >&lt;p&gt;Sorry for the delay on the review Chelsoo. Looking good. A few more comments. Let me know what you think.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I think we need to pass the &lt;tt&gt;POStore&lt;/tt&gt; instead of the location. PigStorage impls provided by random parties might not all abide by a unique namespacing convention in their location syntax. For example, &lt;tt&gt;VerticaStorer&lt;/tt&gt; uses a syntax like &quot;
{[db_schema].[table_name]}
&lt;p&gt;&quot; (curly brackets included). Another implementor could use the same syntax.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;JobStats.getOuputSize could be simplified by doing this, which is more commonly done:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;String reporterNames = conf.get(
   PigStatsOutputSizeReader.OUTPUT_SIZE_READER_KEY,
   FileBasedOutputSizeReader.class.getCanonicalName());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Does &lt;tt&gt;PigContext.instantiateFuncFromSpec(className)&lt;/tt&gt; (without appending &quot;()&quot;) not work?&lt;/li&gt;
	&lt;li&gt;It seems like it would be reasonable for &lt;tt&gt;PigStatsOutputSizeReader.getOutputSize&lt;/tt&gt; to throw IOException all the way up to &lt;tt&gt;JobStats&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;Let&apos;s make &lt;tt&gt;DummyOutputSizeReader&lt;/tt&gt; an inner class of &lt;tt&gt;TestJobStats&lt;/tt&gt; since that package is already totally bloated.&lt;/li&gt;
	&lt;li&gt;In &lt;tt&gt;pig.properties&lt;/tt&gt; reducers&apos; should not have an apostrophe (no possessive for inanimate objects).&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13493558" author="cheolsoo" created="Thu, 8 Nov 2012 22:24:51 +0000"  >&lt;p&gt;Thank you very much for reviewing my patch, Bill!&lt;/p&gt;

&lt;p&gt;I agree that passing POStore is better. I also agree with the other points and incorporated them in this new patch. Please let me know what you think.&lt;/p&gt;</comment>
                            <comment id="13500583" author="cheolsoo" created="Mon, 19 Nov 2012 19:54:52 +0000"  >&lt;p&gt;Bill gave +1 in the RB:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/8122/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/8122/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12708343">PIG-3891</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12617260">PIG-3066</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12551152" name="PIG-2924-2.patch" size="19722" author="cheolsoo" created="Mon, 29 Oct 2012 03:47:57 +0000"/>
                            <attachment id="12551305" name="PIG-2924-3.patch" size="18869" author="cheolsoo" created="Tue, 30 Oct 2012 05:19:43 +0000"/>
                            <attachment id="12551472" name="PIG-2924-4.patch" size="19176" author="cheolsoo" created="Wed, 31 Oct 2012 01:48:29 +0000"/>
                            <attachment id="12552726" name="PIG-2924-5.patch" size="20697" author="cheolsoo" created="Thu, 8 Nov 2012 22:24:51 +0000"/>
                            <attachment id="12551048" name="PIG-2924.patch" size="18288" author="cheolsoo" created="Sat, 27 Oct 2012 02:19:20 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 19 Sep 2012 22:25:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242356</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxwolb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14471</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>