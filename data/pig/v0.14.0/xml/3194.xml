<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:55:25 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3194/PIG-3194.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3194] Changes to ObjectSerializer.java break compatibility with Hadoop 0.20.2</title>
                <link>https://issues.apache.org/jira/browse/PIG-3194</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The changes to ObjectSerializer.java in the following commit&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1403934&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1403934&lt;/a&gt; break compatibility with Hadoop 0.20.2 Clusters.&lt;/p&gt;

&lt;p&gt;The reason is, that the code uses methods from Apache Commons Codec 1.4 - which are not available in Apache Commons Codec 1.3 which is shipping with Hadoop 0.20.2.&lt;/p&gt;

&lt;p&gt;The offending methods are Base64.decodeBase64(String) and Base64.encodeBase64URLSafeString(byte[])&lt;/p&gt;

&lt;p&gt;If I revert these changes, Pig 0.11.0 candidate 2 works well with our Hadoop 0.20.2 Clusters.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12632807">PIG-3194</key>
            <summary>Changes to ObjectSerializer.java break compatibility with Hadoop 0.20.2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="prkommireddi">Prashant Kommireddi</assignee>
                                    <reporter username="kadeng">Kai Londenberg</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Feb 2013 09:51:03 +0000</created>
                <updated>Tue, 2 Apr 2013 16:54:32 +0100</updated>
                            <resolved>Sat, 16 Mar 2013 00:04:52 +0000</resolved>
                                    <version>0.11</version>
                                    <fixVersion>0.12.0</fixVersion>
                    <fixVersion>0.11.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13580621" author="jcoveney" created="Mon, 18 Feb 2013 14:18:07 +0000"  >&lt;p&gt;Do we want to consider just using commons codec 1.3? Do the newer versions of Hadoop still use that version of commons codec? &lt;/p&gt;</comment>
                            <comment id="13580638" author="kadeng" created="Mon, 18 Feb 2013 14:51:43 +0000"  >&lt;p&gt;I would propose to try and stay as compatible as possible with reasonable effort. Here, the effort to stay compatible with a still widely used version of Hadoop seems to be minimal. I see 3 alternative solutions here:&lt;/p&gt;

&lt;p&gt;1.) Revert the mentioned commit. &lt;/p&gt;

&lt;p&gt;2.) Reproduce the required functionality using code that&apos;s compatible to commons codec 1.3 (i.e. use Base64.decodeBase64(str.getBytes()) instead of the shortcut Base64.decodeBase64(str).&lt;/p&gt;

&lt;p&gt;3.) Embed a rebased commons codec 1.4+ into pig. With that, I mean a version of commons codec 1.4+ which has been automatically refactored such that it has a new base package, for example pig.org.apache.commons.codec or something like that.&lt;/p&gt;
</comment>
                            <comment id="13580667" author="jcoveney" created="Mon, 18 Feb 2013 15:37:35 +0000"  >&lt;p&gt;Assuming that all hadoop uses commons codec 1.3 (is that what hadoop 2 uses?) then #2 seems like a no-brainer to me&lt;/p&gt;</comment>
                            <comment id="13580768" author="jcoveney" created="Mon, 18 Feb 2013 18:50:53 +0000"  >&lt;p&gt;Hmm, so I simply set common-codec.version in ivy/library.properties back to 1.3 and everything worked fine, but it looks like something else is pulling in the 1.4 lib (it appears in build/ivy/lib/Pig/). Need to figure out what is causing that and then my plan is to roll back to 1.3, see what breaks, and fix it. I doubt there is very much.&lt;/p&gt;

&lt;p&gt;Need to get to the bottom of why 1.4 is still getting brought in, though.&lt;/p&gt;</comment>
                            <comment id="13580787" author="ashutoshc" created="Mon, 18 Feb 2013 19:14:03 +0000"  >&lt;p&gt;Hadoop has moved to 1.4 long way back. If I remember correctly 0.20.2 was last release with 1.3. In hadoop2 I believe they are at 1.5. Though this is debatable but IMO consistency with hadoop-1 is more important than 0.20.2. &lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc/hadoop/common/branches/branch-1/ivy/libraries.properties?revision=1342816&amp;amp;view=markup&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/hadoop/common/branches/branch-1/ivy/libraries.properties?revision=1342816&amp;amp;view=markup&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13580815" author="kadeng" created="Mon, 18 Feb 2013 20:26:24 +0000"  >&lt;p&gt;I&apos;d recommend to build the way you do now with 1.4. But test with Hadoop 0.20.2 as well. Mostly, commons-codec 1.3 and 1.4 are compatible. 1.3 is just missing some Methods. Actually the compatibility problem is just these 2 methods. Maybe it&apos;s even easier to copy the Base64 class from commons-codec 1.4 into some utility package of pit itself.&lt;/p&gt;</comment>
                            <comment id="13591233" author="prkommireddi" created="Sat, 2 Mar 2013 02:30:22 +0000"  >&lt;p&gt;Base64 seems to have been refactored a bit for codec 1.4. It now extends a base class (BaseNCodec) and uses a util (StringUtils). There&apos;s not much of dependency on StringUtils. Though BaseNCodec and Base64 are slightly tied up (even though it&apos;s just the 2 methods we use in pig). We could do a few things here&lt;/p&gt;

&lt;p&gt;1. Bring Base* classes into a pig util&lt;br/&gt;
2. Eliminate call to encodeBase64URLSafeString and use byte[] encodeBase64 (available in 1.3) instead.&lt;/p&gt;

&lt;p&gt;Looking at the Base64 code, there isn&apos;t much difference in the 2 methods except that &apos;-&apos; is used for &apos;+&apos; and &apos;_&apos; is used for &apos;/&apos; with URLSafe. Doesn&apos;t look like we need the encoding be url safe either?&lt;/p&gt;

&lt;p&gt;And as Kai suggested, we can use Base64.decodeBase64(str.getBytes()) from 1.3 for decoding. &lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;



</comment>
                            <comment id="13592896" author="prkommireddi" created="Tue, 5 Mar 2013 01:23:30 +0000"  >&lt;p&gt;Would be great to have some ideas from others and discuss &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13593328" author="jcoveney" created="Tue, 5 Mar 2013 11:19:14 +0000"  >&lt;p&gt;I don&apos;t love the idea of bringing the classes in, and would rather just use the methods available in 1.3 if possible. I think that&apos;s a fine path, as you are correct: we don&apos;t need to be url safe.&lt;/p&gt;</comment>
                            <comment id="13593747" author="julienledem" created="Tue, 5 Mar 2013 18:46:02 +0000"  >&lt;p&gt;same as Jon. we can just use the methods present in 1.3 and we don&apos;t need to be URL safe.&lt;br/&gt;
Let&apos;s not repackage commons.codec or duplicate part of it just for this. &lt;/p&gt;</comment>
                            <comment id="13593757" author="prkommireddi" created="Tue, 5 Mar 2013 18:50:26 +0000"  >&lt;p&gt;Sounds good to me. 1 was a just an option to put out there, I agree using 1.3 methods is a lot cleaner/better approach.&lt;/p&gt;</comment>
                            <comment id="13595012" author="prkommireddi" created="Wed, 6 Mar 2013 19:26:14 +0000"  >&lt;p&gt;Changed ObjectSerializer to use codec 1.3 methods. Tested with unit tests that are using ser/deser (TestPruneColumn, TestEvalPipeline2) and &quot;ant test-commit&quot; - all pass. Also tested against Load/Store funcs that use a lot of this (TestPigStorage, TestHBaseStorage). &lt;/p&gt;

&lt;p&gt;Please review.&lt;/p&gt;</comment>
                            <comment id="13596307" author="dvryaboy" created="Thu, 7 Mar 2013 20:07:19 +0000"  >&lt;p&gt;Prashant, were you able to test in environments where 1.4 is and is not available?&lt;/p&gt;</comment>
                            <comment id="13596588" author="prkommireddi" created="Fri, 8 Mar 2013 00:01:54 +0000"  >&lt;p&gt;Dmitriy, yes. Here is what I have done after the fix:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;1. compile pig with 1.4&lt;/b&gt;&lt;br/&gt;
1a. start up pig with hadoop 0.20.2 - runs &lt;span class=&quot;error&quot;&gt;&amp;#91;expected&amp;#93;&lt;/span&gt;&lt;br/&gt;
1b. start up pig with hadoop 1 - runs &lt;span class=&quot;error&quot;&gt;&amp;#91;expected&amp;#93;&lt;/span&gt;&lt;br/&gt;
1c. test-commit and few other tests mentioned in my previous comment all pass.&lt;br/&gt;
1d. run sample scripts against 1a and 1b - works good.&lt;/p&gt;


&lt;p&gt;&lt;b&gt;2. compile pig with 1.3&lt;/b&gt;&lt;br/&gt;
2a. start up pig with hadoop 0.20.2 - runs &lt;span class=&quot;error&quot;&gt;&amp;#91;expected&amp;#93;&lt;/span&gt;&lt;br/&gt;
2b. start up pig with hadoop-1 - runs &lt;span class=&quot;error&quot;&gt;&amp;#91;expected&amp;#93;&lt;/span&gt;&lt;br/&gt;
2c. test-commit and other tests pass but TestMRCompiler fails - &lt;b&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;not expected&amp;#93;&lt;/span&gt;&lt;/b&gt;&lt;br/&gt;
2d. run sample scripts against 2a and 2b - works good&lt;/p&gt;


&lt;p&gt;The issue with 2c (TestMRCompiler.testMergeJoin failing against 1.3) is that the gold file being used contains a serialized string that was generated using 1.4. There seem to be a few differences between 1.3 and 1.4 with encode/decode behavior - please see &lt;a href=&quot;https://issues.apache.org/jira/browse/CODEC-89&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CODEC-89&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/CODEC-91&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CODEC-91&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Considering our tests run against hadoop-1 and all pass I am not sure if we should be spending time in making the test case codec 1.3 aware? &lt;/p&gt;</comment>
                            <comment id="13599120" author="prkommireddi" created="Mon, 11 Mar 2013 18:41:44 +0000"  >&lt;p&gt;Dmitriy, let me know what you think?&lt;/p&gt;</comment>
                            <comment id="13599169" author="dvryaboy" created="Mon, 11 Mar 2013 19:30:56 +0000"  >&lt;p&gt;We can skip the test if we detect that we are on Hadoop 2.0 by using org.junit.Assume &lt;/p&gt;

&lt;p&gt;Let&apos;s do that so we don&apos;t have to come back and fix this later.&lt;/p&gt;</comment>
                            <comment id="13603925" author="prkommireddi" created="Fri, 15 Mar 2013 22:20:02 +0000"  >&lt;p&gt;Uploading a new patch with Dmitriy&apos;s feedback incorporated.&lt;/p&gt;</comment>
                            <comment id="13603984" author="dvryaboy" created="Fri, 15 Mar 2013 23:36:35 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13604019" author="dvryaboy" created="Sat, 16 Mar 2013 00:04:52 +0000"  >&lt;p&gt;Committed to 0.11.1 and trunk.&lt;/p&gt;

&lt;p&gt;Thanks Kai for reporting and Prashant for fixing!&lt;/p&gt;</comment>
                            <comment id="13604023" author="prkommireddi" created="Sat, 16 Mar 2013 00:10:02 +0000"  >&lt;p&gt;Thanks for review/commit, Dmitriy.&lt;/p&gt;</comment>
                            <comment id="13604037" author="prkommireddi" created="Sat, 16 Mar 2013 00:34:39 +0000"  >&lt;p&gt;Kai, can you confirm 11.1 works for you?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12572374" name="PIG-3194.patch" size="4685" author="prkommireddi" created="Wed, 6 Mar 2013 19:26:14 +0000"/>
                            <attachment id="12573959" name="PIG-3194_2.patch" size="5606" author="prkommireddi" created="Fri, 15 Mar 2013 22:20:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 18 Feb 2013 14:18:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>313303</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzbx0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>313648</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>