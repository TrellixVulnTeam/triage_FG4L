<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:05:00 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1890/PIG-1890.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1890] Fix piggybank unit test TestAvroStorage</title>
                <link>https://issues.apache.org/jira/browse/PIG-1890</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;TestAvroStorage fail on trunk. There are two reasons:&lt;br/&gt;
1. After &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1680&quot; title=&quot;Pig 0.8 HBaseStorage may not against HBase 0.89&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1680&quot;&gt;&lt;del&gt;PIG-1680&lt;/del&gt;&lt;/a&gt;, we call LoadFunc.setLocation one more time.&lt;br/&gt;
2. The schema for AvroStorage seems to be wrong. For example, in first test case testArrayDefault, the schema for &quot;in&quot; is set to &quot;PIG_WRAPPER: (FIELD: &lt;/p&gt;
{PIG_WRAPPER: (ARRAY_ELEM: float)}
&lt;p&gt;)&quot;. It seems PIG_WRAPPER is redundant. This issue is hidden until &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1188&quot; title=&quot;Padding nulls to the input tuple according to input schema&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1188&quot;&gt;&lt;del&gt;PIG-1188&lt;/del&gt;&lt;/a&gt; checked in.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12500949">PIG-1890</key>
            <summary>Fix piggybank unit test TestAvroStorage</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kengoodhope">Ken Goodhope</assignee>
                                    <reporter username="daijy">Daniel Dai</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Wed, 9 Mar 2011 21:57:42 +0000</created>
                <updated>Thu, 4 Aug 2011 01:35:05 +0100</updated>
                            <resolved>Tue, 12 Jul 2011 02:15:14 +0100</resolved>
                                    <version>0.9.0</version>
                                    <fixVersion>0.9.0</fixVersion>
                    <fixVersion>0.10.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13004906" author="daijy" created="Thu, 10 Mar 2011 00:54:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1890&quot; title=&quot;Fix piggybank unit test TestAvroStorage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1890&quot;&gt;&lt;del&gt;PIG-1890&lt;/del&gt;&lt;/a&gt;-1.patch fix the first issue. I temporary comment out all test cases in TestAvroStorage.&lt;/p&gt;</comment>
                            <comment id="13027855" author="olgan" created="Mon, 2 May 2011 22:21:41 +0100"  >&lt;p&gt;Hi Jacob, &lt;/p&gt;

&lt;p&gt;Are you planning to address the additional issue for 0.9 or should we delay this?&lt;/p&gt;</comment>
                            <comment id="13027862" author="kengoodhope" created="Mon, 2 May 2011 22:40:29 +0100"  >&lt;p&gt;I have been working on some fixes to AvroStorage already.  I should be able to make sure this issue gets addressed in those fixes as will.  Will have it done sometime this week.&lt;/p&gt;</comment>
                            <comment id="13030845" author="jghoman" created="Mon, 9 May 2011 19:29:00 +0100"  >&lt;p&gt;@Ken - any update now that we&apos;re in a new week?&lt;/p&gt;</comment>
                            <comment id="13033822" author="kengoodhope" created="Sun, 15 May 2011 22:35:22 +0100"  >&lt;p&gt;For testArrayDefault, we are attempting to return an entire avro array, which is consistent with the schema.  The result is tuple with one column, a bag of floats&quot;.  In POProject.getNext(Tuple), tuples with one column have their single column extracted, cast to a tuple, and then returned.  Obviously in this case, this results in trying to cast the bag of floats into a tuple and an exception being thrown.&lt;/p&gt;

&lt;p&gt;Does anyone know why this is being done in POProject?&lt;/p&gt;</comment>
                            <comment id="13034925" author="daijy" created="Tue, 17 May 2011 19:04:30 +0100"  >&lt;p&gt;Seems it should call POProject.getNext(DataBag) instead. Project one item assumes this item already has the correct type and need not convert. The issue should be caused by plan generation, which results a wrong result type for POProject.&lt;/p&gt;</comment>
                            <comment id="13038100" author="kengoodhope" created="Mon, 23 May 2011 19:09:19 +0100"  >&lt;p&gt;Right now, in this test, AvroStorage is attempting to pass back a single array of floats with one call to next. To be consistent with intent of how the data is stored we want this array returned as a single unit(databag) with each foreach call. In other words we don&apos;t want foreach to return each element of that array one at a time. If I am understanding the code right, it appears that is what it is trying to do. Am I missing something? Is there a way to control this behavior?&lt;/p&gt;
</comment>
                            <comment id="13041915" author="kengoodhope" created="Wed, 1 Jun 2011 01:37:17 +0100"  >&lt;p&gt;I need some clarification on the contract for POProject.getNext(Tuple).  Right now, if it receives a tuple with a single element, it extracts that element and attempts to cast it as a tuple and return it.  This breaks with any single element tuple that where the single element is not a tuple.  The code could be modified to not extract non-tuple elements.&lt;/p&gt;</comment>
                            <comment id="13050033" author="olgan" created="Wed, 15 Jun 2011 22:12:52 +0100"  >&lt;p&gt;About to cut the release&lt;/p&gt;</comment>
                            <comment id="13058813" author="kengoodhope" created="Fri, 1 Jul 2011 22:24:04 +0100"  >&lt;p&gt;The fix for this jira involves two parts, making setLocation idempotent, and a fix in POProject.  I have added a jira for POProject issue &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2153&quot; title=&quot;POProject throws an error with tuples containing a single non-tuple field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2153&quot;&gt;&lt;del&gt;PIG-2153&lt;/del&gt;&lt;/a&gt;.  I will try and get a patch for the setLocation issue added this weekend.  I have made some other changes to the version of AvroStorage we are using at LinkedIn and want to seperate those changes from any patch I submit for this.&lt;/p&gt;</comment>
                            <comment id="13059625" author="kengoodhope" created="Mon, 4 Jul 2011 23:01:32 +0100"  >&lt;p&gt;Attached patch.  Only works if &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2153&quot; title=&quot;POProject throws an error with tuples containing a single non-tuple field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2153&quot;&gt;&lt;del&gt;PIG-2153&lt;/del&gt;&lt;/a&gt; is fixed.  Until then the unit tests still break.  This patch fixes setLocation.&lt;/p&gt;</comment>
                            <comment id="13059958" author="dvryaboy" created="Tue, 5 Jul 2011 16:37:47 +0100"  >&lt;p&gt;Marked &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2153&quot; title=&quot;POProject throws an error with tuples containing a single non-tuple field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2153&quot;&gt;&lt;del&gt;PIG-2153&lt;/del&gt;&lt;/a&gt; as a blocker to this.&lt;/p&gt;

&lt;p&gt;I have a feeling that ticket is also blocking EB issue 60 &lt;a href=&quot;https://github.com/kevinweil/elephant-bird/issues/60&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/kevinweil/elephant-bird/issues/60&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="13060114" author="phunt" created="Tue, 5 Jul 2011 21:26:50 +0100"  >&lt;p&gt;Hi, I&apos;m seeing an issue with both versions of the attached patches when I run the following:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;REGISTER avro-1.4.1.jar; 
REGISTER json-simple-1.1.jar; 
REGISTER piggybank.jar;

A = LOAD &apos;input_123.avro&apos; USING 
org.apache.pig.piggybank.storage.avro.AvroStorage();

B = LOAD &apos;input_789.avro&apos; USING 
org.apache.pig.piggybank.storage.avro.AvroStorage();

C = UNION A, B; 
DUMP C;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where each file contains a single tuple; input_123.avro contains &quot;1,2,3&quot; (ints) and input_789.avro contains &quot;7,8,9&quot;&lt;br/&gt;
Dump C should be returning 2 tuples; 1 tuple 1,2,3 and 1 tuple 7,8,9.&lt;/p&gt;

&lt;p&gt;Without the patch I see 6 tuples output (3 1,2,3 and 3 7,8,9)&lt;br/&gt;
With either of the proposed patches applied I see 4 tuples output (2 1,2,3 and 2 7,8,9)&lt;/p&gt;

&lt;p&gt;From looking at other pig loader functions it seems like the following would address the setLocation issue:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;     public void setLocation(String location, Job job) throws IOException {
-        if(AvroStorageUtils.addInputPaths(location, job) &amp;amp;&amp;amp; inputAvroSchema == null) {
-            inputAvroSchema = getAvroSchema(location, job);
-        }
+        FileInputFormat.setInputPaths(job, location);
+        inputAvroSchema = getAvroSchema(location, job);
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This does resolve the issue for the script I described. However the &quot;addInputPaths&quot; functionality of AvroStorageUtils is lost - but I&apos;m wondering why this was added rather than just rely on the std capabilities of LOAD? (such as globbing).&lt;/p&gt;


&lt;p&gt;I&apos;d be happy to package up my suggestion as a patch if there&apos;s interest.&lt;/p&gt;</comment>
                            <comment id="13060165" author="kengoodhope" created="Tue, 5 Jul 2011 23:11:34 +0100"  >&lt;p&gt;Hi Patrick, for our purposes we need setLocation to add all sub-directories, including directories more than 2 levels deep.  A common use case for us to to have directories organized by time, yyyy/MM/dd/hh/mm.  In that case if you want to load all the data from a particular month, then you need to add all the subdirs.  Your right that a UNION can accomplish this, but it can be painful to add the directories that way.  I will take a look at why this is still breaking in your case.&lt;/p&gt;
</comment>
                            <comment id="13060178" author="mmoeller" created="Tue, 5 Jul 2011 23:43:19 +0100"  >&lt;p&gt;Hi Ken,&lt;/p&gt;

&lt;p&gt;I am have the same use case as you and encountering the same behavior as Patrick. I made a few modifications to the methods &quot;addInputPaths&quot; and &quot;addAllSubDirs&quot; from your patch, which seems to solve the UNION issue. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; addInputPaths(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; pathString, Job job)
        &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {

        Set&amp;lt;Path&amp;gt; pathSet = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;Path&amp;gt;();
        
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (addAllSubDirs(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(pathString), job, pathSet)) {
            Path[] paths = pathSet.toArray(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path[pathSet.size()]);
 
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    }

    /**
     * Adds all non-hidden directories and subdirectories to the paths set
     * 
     * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
     */
  	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; addAllSubDirs(Path path, Job job, Set&amp;lt;Path&amp;gt; paths) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
  		FileSystem fs = FileSystem.get(job.getConfiguration());

  		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (PATH_FILTER.accept(path)) {
  			&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
  				FileStatus file = fs.getFileStatus(path);
  				&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (file.isDir()) {
  					&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (FileStatus sub : fs.listStatus(path)) {
  						addAllSubDirs(sub.getPath(), job, paths);
  					}
  				} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
  					AvroStorageLog.details(&lt;span class=&quot;code-quote&quot;&gt;&quot;Add input file:&quot;&lt;/span&gt; + file);
  					paths.add(file.getPath());
  				}
  			} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (FileNotFoundException e) {
  				AvroStorageLog.details(&lt;span class=&quot;code-quote&quot;&gt;&quot;Input path does not exist: &quot;&lt;/span&gt; + path);
  				&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
  			}
  			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
  		}
  		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
  	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13060190" author="mmoeller" created="Wed, 6 Jul 2011 00:12:54 +0100"  >&lt;p&gt;Re-pasting addInputPaths. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    /**
     * get input paths to job config
     */
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; addInputPaths(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; pathString, Job job)
        &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {

        Set&amp;lt;Path&amp;gt; pathSet = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;Path&amp;gt;();
        
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (addAllSubDirs(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(pathString), job, pathSet)) {
            Path[] paths = pathSet.toArray(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path[pathSet.size()]);

            FileInputFormat.setInputPaths(job, paths);  
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13060213" author="phunt" created="Wed, 6 Jul 2011 01:21:54 +0100"  >&lt;p&gt;@ken (and @mads) thanks, I figured something like that. Could this possibly be an issue in pig itself? I do see this&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;LoadFunc.setLocation:
     * This method will be called in the backend multiple times. Implementations
     * should bear in mind that this method is called multiple times and should
     * ensure there are no inconsistent side effects due to the multiple calls.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But what I&apos;m seeing in this UNION case is that setLocation is being called multiple times on the same AvroStorage instance, for the same job, with different files. This results (current avrostorage code with pig-1890-2.patch applied) in the duplication - 2 files are added rather than one (my patch fixes this by only taking the most recent argument to setLocation, which is consistent with existing loader funcs, whereas avrostorage keeps adding). If you check the debugging output you&apos;ll see this (I might have added a bit more debugging to setLocation to capture this event...)&lt;/p&gt;

&lt;p&gt;Regards.&lt;/p&gt;</comment>
                            <comment id="13060218" author="dvryaboy" created="Wed, 6 Jul 2011 01:38:46 +0100"  >&lt;p&gt;I&apos;ve been a bit out of the loop on this &amp;#8211; you are doing your own directory traversal? You shouldn&apos;t need to do that in the Pig layer, this should be done in your InputFormat. I had to write a wrapper to emulate what &lt;a href=&quot;https://issues.apache.org/jira/browse/MAPREDUCE-1501&quot; title=&quot;FileInputFormat to support multi-level/recursive directory listing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAPREDUCE-1501&quot;&gt;&lt;del&gt;MAPREDUCE-1501&lt;/del&gt;&lt;/a&gt; does in Elephant-Bird, and I believe Pig does the same thing (but without caring about the mapred.input.dir.recursive config).&lt;/p&gt;

&lt;p&gt;As for setLocation, yes. Making it idempotent is &quot;fun&quot;.  &lt;/p&gt;

&lt;p&gt;I am curious about this business with calling it with different files for the same instance for the same job. Patrick, can you show some debug output that has the sequence of calls? &lt;/p&gt;</comment>
                            <comment id="13060240" author="kengoodhope" created="Wed, 6 Jul 2011 03:28:27 +0100"  >&lt;p&gt;There are places where we use addInputDir as a true add, not set.  Otherwise your solution would work.  I did incorporate the use in a set for addAllSubDirs.  Since the method name was no longer descriptive, I changed it to getAllSubDirs.  This new patch passed unit tests, but currently there isn&apos;t a test for UNION.  Let me know if this works.&lt;/p&gt;</comment>
                            <comment id="13060241" author="kengoodhope" created="Wed, 6 Jul 2011 03:40:46 +0100"  >&lt;p&gt;Dmitry, when I inherited the code it was already doing the traversal in setLocation, and I didn&apos;t consider doing in the InputFormat.  To be honest, I am not crazy about adding all the subdirs by default, since this is inconsistent with the way a standard map-reduce job works.  But, our users expect this behavior, and have pig jobs that depend on it.&lt;/p&gt;

&lt;p&gt;If the current patch works, I am inclined to leave it, until I get time to do a better re-factoring.&lt;/p&gt;</comment>
                            <comment id="13060245" author="dvryaboy" created="Wed, 6 Jul 2011 03:56:38 +0100"  >&lt;p&gt;Ken, adding all subdirs is how Hadoop + whatever patchset works, given the right value for mapred.input.dir.recursive&lt;/p&gt;

&lt;p&gt;Now, what version of Hadoop, I have no idea, but it&apos;s in there somewhere &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. And since that&apos;s what people decided on it probably behooves us to respect it. But fixing that issue is a separate concern from what this ticket tries to address. We should open a ticket, though.&lt;/p&gt;</comment>
                            <comment id="13060700" author="phunt" created="Wed, 6 Jul 2011 18:21:50 +0100"  >&lt;p&gt;@Dmitriy thanks.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Patrick, can you show some debug output that has the sequence of calls?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure, I didn&apos;t save the original so I re-ran it, see attached (pig_setloc_avro.txt) for full details using the UNION example (this is with current trunk - notice that there are 6 tuples output rather than 2). I mis-remembered one detail - it&apos;s calling setLoc for the same job, with different files, but &lt;em&gt;different&lt;/em&gt; AvroStorage objects. (see first two lines of setLocation debug message). &lt;/p&gt;

&lt;p&gt;Why are there 8 AvroStorage objects being created, shouldn&apos;t there just be 2, one for loading each of the two input files?&lt;/p&gt;</comment>
                            <comment id="13060701" author="phunt" created="Wed, 6 Jul 2011 18:22:29 +0100"  >&lt;p&gt;demonstrate setLocation calls on AvroStorage.&lt;/p&gt;</comment>
                            <comment id="13060762" author="kengoodhope" created="Wed, 6 Jul 2011 19:55:18 +0100"  >&lt;p&gt;A recent change in Pig causes setLocation to be called twice, and if setLocation isn&apos;t idempotent, then you get twice the output.  My suspicion is UNION is further exasperating the problem leading to the input being added 4X.  Did you still see the problem with the last patch I added?&lt;/p&gt;</comment>
                            <comment id="13060767" author="mmoeller" created="Wed, 6 Jul 2011 20:01:49 +0100"  >&lt;p&gt;Hi Ken,&lt;/p&gt;

&lt;p&gt;With the latest patch the UNION behaves as expected for me.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;br/&gt;
Mads&lt;/p&gt;</comment>
                            <comment id="13062663" author="kengoodhope" created="Sun, 10 Jul 2011 03:20:40 +0100"  >&lt;p&gt;Uploading new patch that contains the same fixes to setLocation contained in the previous patch.  New patch adds fixes to the schema that resolve the issues around the unit tests.&lt;/p&gt;</comment>
                            <comment id="13062664" author="kengoodhope" created="Sun, 10 Jul 2011 03:26:47 +0100"  >&lt;p&gt;Removing the blocker for &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2153&quot; title=&quot;POProject throws an error with tuples containing a single non-tuple field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2153&quot;&gt;&lt;del&gt;PIG-2153&lt;/del&gt;&lt;/a&gt;.  Turns out the problem, as first asserted, was in AvroStorage.  The new logical plan must handle implicit wrapping tuples differently than used to be the case.  In order to make this work, I removed the wrapping tuple from the schema produced by getSchema.  getNext still returns its result in the wrapping tuple.  I also had to modify putNext, to expect a piq schema without the implicit wrapping tuple.&lt;/p&gt;</comment>
                            <comment id="13062665" author="kengoodhope" created="Sun, 10 Jul 2011 03:29:19 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1890&quot; title=&quot;Fix piggybank unit test TestAvroStorage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1890&quot;&gt;&lt;del&gt;PIG-1890&lt;/del&gt;&lt;/a&gt;-4.patch ready for review.  All unit test now working against trunk.&lt;/p&gt;</comment>
                            <comment id="13063633" author="phunt" created="Tue, 12 Jul 2011 02:00:13 +0100"  >&lt;p&gt;I tested &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1890&quot; title=&quot;Fix piggybank unit test TestAvroStorage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1890&quot;&gt;&lt;del&gt;PIG-1890&lt;/del&gt;&lt;/a&gt;-4.patch against trunk using the UNION example and it generated expected (i.e. correct) results.&lt;/p&gt;</comment>
                            <comment id="13063637" author="daijy" created="Tue, 12 Jul 2011 02:10:55 +0100"  >&lt;p&gt;All Avro unit tests pass now, and test-patch returns all +1. Now we don&apos;t get a double PIG_WRAPPER, the schema generated by ArvoStorage looks good to me. Thanks guys for your hard working!&lt;/p&gt;</comment>
                            <comment id="13063641" author="daijy" created="Tue, 12 Jul 2011 02:15:14 +0100"  >&lt;p&gt;Patch committed to trunk.&lt;/p&gt;</comment>
                            <comment id="13064011" author="daijy" created="Tue, 12 Jul 2011 18:12:34 +0100"  >&lt;p&gt;Also committed to 0.9 branch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12473226" name="PIG-1890-1.patch" size="1940" author="daijy" created="Thu, 10 Mar 2011 00:53:38 +0000"/>
                            <attachment id="12485185" name="PIG-1890-2.patch" size="15846" author="kengoodhope" created="Mon, 4 Jul 2011 23:01:32 +0100"/>
                            <attachment id="12485361" name="PIG-1890-3.patch" size="17341" author="kengoodhope" created="Wed, 6 Jul 2011 03:28:27 +0100"/>
                            <attachment id="12485978" name="PIG-1890-4.patch" size="19765" author="kengoodhope" created="Sun, 10 Jul 2011 03:20:40 +0100"/>
                            <attachment id="12485454" name="pig_setloc_avro.txt" size="15970" author="phunt" created="Wed, 6 Jul 2011 18:22:29 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 2 May 2011 21:21:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37462</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzczr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30088</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fixed AvroStorage unit tests.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>