<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:50:41 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2769/PIG-2769.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2769] a simple logic causes very long compiling time on pig 0.10.0</title>
                <link>https://issues.apache.org/jira/browse/PIG-2769</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;We found the following simple logic will cause very long compiling time for pig 0.10.0, while using pig 0.8.1, everything is fine.&lt;/p&gt;

&lt;p&gt;A = load &apos;A.txt&apos; using PigStorage()  AS (m: int);&lt;/p&gt;

&lt;p&gt;B = FOREACH A &lt;/p&gt;
{
    days_str = (chararray)
        (m == 1 ? 31: 
        (m == 2 ? 28: 
        (m == 3 ? 31: 
        (m == 4 ? 30: 
        (m == 5 ? 31: 
        (m == 6 ? 30: 
        (m == 7 ? 31: 
        (m == 8 ? 31: 
        (m == 9 ? 30: 
        (m == 10 ? 31: 
        (m == 11 ? 30:31)))))))))));
GENERATE
   days_str as days_str;
}
&lt;p&gt;   &lt;br/&gt;
store B into &apos;B&apos;;&lt;/p&gt;

&lt;p&gt;and here&apos;s a simple input file example: A.txt&lt;br/&gt;
1&lt;br/&gt;
2&lt;br/&gt;
3&lt;/p&gt;

&lt;p&gt;The pig version we used in the test&lt;br/&gt;
Apache Pig version 0.10.0-SNAPSHOT (rexported)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Apache Pig version 0.10.0-SNAPSHOT (rexported)&lt;/p&gt;</environment>
        <key id="12596000">PIG-2769</key>
            <summary>a simple logic causes very long compiling time on pig 0.10.0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njw45">Nick White</assignee>
                                    <reporter username="dli@operasolutions.com">Dan Li</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Jun 2012 00:16:02 +0100</created>
                <updated>Mon, 4 Nov 2013 20:03:23 +0000</updated>
                            <resolved>Tue, 8 Jan 2013 23:14:13 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                    <fixVersion>0.11.2</fixVersion>
                                    <component>build</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>14</watches>
                                                                <comments>
                            <comment id="13401783" author="dli@operasolutions.com" created="Wed, 27 Jun 2012 00:17:02 +0100"  >&lt;p&gt;example code and data file&lt;/p&gt;</comment>
                            <comment id="13401785" author="dli@operasolutions.com" created="Wed, 27 Jun 2012 00:18:32 +0100"  >&lt;p&gt;It&apos;s worth pointing out that Pig 0.9.2 also runs quickly; we only see the degradation with Pig 0.10.0.&lt;/p&gt;

&lt;p&gt;The degradation in performance seems to have a knee as 4 or 5 conditionals works as expected but as presented, the script takes about 6 minutes at the GRUNT&amp;gt; prompt after hitting enter; before any Hadoop execution.&lt;/p&gt;

&lt;p&gt;-Clay&lt;/p&gt;</comment>
                            <comment id="13401790" author="jcoveney" created="Wed, 27 Jun 2012 00:23:37 +0100"  >&lt;p&gt;My guess is that this has to do with recursive backtracking.&lt;/p&gt;

&lt;p&gt;from QueryParser.g&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
foreach_statement : ( ( alias EQUAL )?  FOREACH rel LEFT_CURLY ) =&amp;gt; foreach_complex_statement
                  | foreach_simple_statement
;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The fact that it works fine up until some n and then dies is typical of when these things die. It could be some interaction with another recursive backtracking rule that is blowing up.&lt;/p&gt;

&lt;p&gt;The ideal solution is to get rid of recursive backtracking in the parser...&lt;/p&gt;
</comment>
                            <comment id="13402454" author="daijy" created="Wed, 27 Jun 2012 19:43:10 +0100"  >&lt;p&gt;It takes me 5 min to compile the logical plan.&lt;/p&gt;</comment>
                            <comment id="13410611" author="dli@operasolutions.com" created="Tue, 10 Jul 2012 18:45:20 +0100"  >&lt;p&gt;Hi, Daniel,&lt;/p&gt;

&lt;p&gt;I tried to check out the revision 0.10.0 [ 12316246 ] , but got &quot;No such revision 12316246&quot; error. The command I used is following&lt;/p&gt;

&lt;p&gt;svn co -r 12316246 &lt;a href=&quot;http://svn.apache.org/repos/asf/pig/branches/branch-0.10/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/pig/branches/branch-0.10/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks.&lt;br/&gt;
Dan&lt;/p&gt;</comment>
                            <comment id="13410620" author="daijy" created="Tue, 10 Jul 2012 18:50:02 +0100"  >&lt;p&gt;What is revision 12316246? Where did you get this?&lt;/p&gt;</comment>
                            <comment id="13410628" author="dli@operasolutions.com" created="Tue, 10 Jul 2012 18:53:15 +0100"  >&lt;p&gt;From your comment on 27/Jun/12 18:43, is the number [ 12316246 ] the revision number?&lt;/p&gt;
</comment>
                            <comment id="13411717" author="dli@operasolutions.com" created="Wed, 11 Jul 2012 17:59:09 +0100"  >&lt;p&gt;Hi, Daniel,&lt;/p&gt;

&lt;p&gt;I&apos;m little bit confused. is this problem fixed or not?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;br/&gt;
Dan&lt;/p&gt;</comment>
                            <comment id="13411811" author="daijy" created="Wed, 11 Jul 2012 19:22:44 +0100"  >&lt;p&gt;No, it is not fixed. 5 min to compile a plan is not acceptable. I am not saying a particular version works, just to post what I observe. Sorry for the confusion. We need to fix it.&lt;/p&gt;</comment>
                            <comment id="13411968" author="dli@operasolutions.com" created="Wed, 11 Jul 2012 21:37:17 +0100"  >&lt;p&gt;Thanks for the clarification, and looking forward to the fix.&lt;/p&gt;

&lt;p&gt;Dan&lt;/p&gt;</comment>
                            <comment id="13469587" author="tnachen" created="Thu, 4 Oct 2012 19:40:10 +0100"  >&lt;p&gt;I&apos;d like to look at this for my first bug fix for pig, as I&apos;ve already glanced through the parsing and query plan code. Can&apos;t find a way to assign this to myself via Jira though, probably need someone else to do so?&lt;/p&gt;</comment>
                            <comment id="13469592" author="thejas" created="Thu, 4 Oct 2012 19:46:03 +0100"  >&lt;p&gt;I have assigned it to you. I have also added you to contributors list, now you should be able to assign jiras to yourself.&lt;/p&gt;</comment>
                            <comment id="13481538" author="tnachen" created="Mon, 22 Oct 2012 18:36:07 +0100"  >&lt;p&gt;I decided to leave this issue open to grab for now since this issue is mostly in the ANTLR generated code and I am still learning about ANTLR.&lt;br/&gt;
It does seems that it&apos;s recursively calling foreach_complex_statement pretty excessively, but I don&apos;t have enough knowledge to deduce the grammer so it still works.&lt;br/&gt;
I did verify that the AST generated in 0.9.2 and 0.10-SNAPSHOT generated is exactly the same if that helps.&lt;/p&gt;</comment>
                            <comment id="13539638" author="njw45" created="Wed, 26 Dec 2012 19:11:14 +0000"  >&lt;p&gt;I&apos;ve attached a patch that refactors the QueryParser&apos;s grammar so that it doesn&apos;t need global backtracking (in fact, it only has backtracking in one rule as empty map casts look very much like map literals in brackets). I&apos;ve added a lot of comments, so hope it&apos;s clear what&apos;s going on, and have checked all the unit tests pass. I&apos;ve also added a lot more unit tests, including the query on this ticket (which now parses in about 0.03s), so I&apos;m pretty sure it&apos;s just a drop-in replacement.&lt;/p&gt;</comment>
                            <comment id="13540653" author="alangates" created="Sat, 29 Dec 2012 00:11:28 +0000"  >&lt;p&gt;I&apos;ll take a look at this and start running the tests.&lt;/p&gt;</comment>
                            <comment id="13540715" author="alangates" created="Sat, 29 Dec 2012 01:36:45 +0000"  >&lt;p&gt;I see failures in TestInputSizeReducerEstimator with this patch applied.  There may be others, as the test run hasn&apos;t finished yet.&lt;/p&gt;</comment>
                            <comment id="13541000" author="njw45" created="Sat, 29 Dec 2012 21:27:26 +0000"  >&lt;p&gt;Were there any others? What do the test logs say? It passes for me locally, so I&apos;d appreciate some help identifying the failure. Thanks -&lt;/p&gt;</comment>
                            <comment id="13541394" author="alangates" created="Mon, 31 Dec 2012 16:02:06 +0000"  >&lt;p&gt;That&apos;s the only failure I see in the unit tests that&apos;s new after I apply your patch.  It fails consistently for me with your patch and passes consistently without it.  I&apos;ll attach the logs from the test.&lt;/p&gt;</comment>
                            <comment id="13541395" author="alangates" created="Mon, 31 Dec 2012 16:03:09 +0000"  >&lt;p&gt;Log file of failed test.  Not intended as a patch.&lt;/p&gt;</comment>
                            <comment id="13541974" author="cheolsoo" created="Wed, 2 Jan 2013 02:49:48 +0000"  >&lt;p&gt;Hi Alan,&lt;/p&gt;

&lt;p&gt;The test failure that you&apos;re seeing may be because of a stale &lt;tt&gt;hadoop-site.xml&lt;/tt&gt; in &lt;tt&gt;build/classes&lt;/tt&gt; from a previous test. Any test that uses MiniCluster generates &lt;tt&gt;hadoop-site.xml&lt;/tt&gt; in &lt;tt&gt;build/classes&lt;/tt&gt;, and since &lt;tt&gt;build/classes&lt;/tt&gt; is in the classpath of unit test, a stale &lt;tt&gt;hadoop-site.xml&lt;/tt&gt; will be picked up by &lt;tt&gt;TestInputSizeReducerEstimator&lt;/tt&gt; if exists.&lt;/p&gt;

&lt;p&gt;I am able to reproduce the exactly same error by adding a &lt;tt&gt;hadoop-site.xml&lt;/tt&gt; to &lt;tt&gt;build/classes&lt;/tt&gt; as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;hadoop-site.xml&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;configuration&amp;gt;
  &amp;lt;property&amp;gt;
    &amp;lt;name&amp;gt;fs.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.name&amp;lt;/name&amp;gt;
    &amp;lt;value&amp;gt;hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:45399&amp;lt;/value&amp;gt;
&lt;/span&gt;  &amp;lt;/property&amp;gt;
&amp;lt;/configuration&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;With this &lt;tt&gt;hadoop-site.xml&lt;/tt&gt; in classpath, the test tries to connect to a NN on port 45399, which it shouldn&apos;t.&lt;/p&gt;

&lt;p&gt;Can you verify that running &lt;tt&gt;ant clean test&lt;/tt&gt; instead of &lt;tt&gt;ant test&lt;/tt&gt; lets the error go away? When I do &lt;tt&gt;ant clean test&lt;/tt&gt;, the test always passes for me.&lt;/p&gt;</comment>
                            <comment id="13543429" author="jcoveney" created="Thu, 3 Jan 2013 23:48:04 +0000"  >&lt;p&gt;Nick, this its awesome. Well done, and thanks for tackling it. It&apos;s some cleanup pig sorely needed.&lt;/p&gt;</comment>
                            <comment id="13547085" author="alangates" created="Tue, 8 Jan 2013 18:22:58 +0000"  >&lt;p&gt;When I do a clean first as Cheolsoo advises it works, though I don&apos;t fully understand that since I started out with a clean checkout.&lt;/p&gt;

&lt;p&gt;In the system tests NegForeach_7, NegForeach_9, SyntaxErrors_4, Macro_Error_4 all fail because the error messages have changed.  You can find these in test/e2e/pig/tests/negative.conf and macro.conf.  Search on each of the group names (NegForeach, ...) and then find the test number under that.  In each case you can run the query and change the expected error message to match the new one.  &lt;/p&gt;

&lt;p&gt;Other than that, +1, patch looks good.&lt;/p&gt;</comment>
                            <comment id="13547105" author="rohini" created="Tue, 8 Jan 2013 18:43:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;When I do a clean first as Cheolsoo advises it works, though I don&apos;t fully understand that since I started out with a clean checkout.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Order of tests run must have been the cause. It might have passed after doing a clean because you might have just run TestInputSizeReducerEstimator without running other tests. TestInputSizeReducerEstimator needs to be fixed to do new Configuration(false); instead of new Configuration(); which makes it pick up hadoop-site.xml from a previously run test. &lt;/p&gt;</comment>
                            <comment id="13547206" author="njw45" created="Tue, 8 Jan 2013 20:16:09 +0000"  >&lt;p&gt;Thanks! I&apos;ve attached a version of the patch which fixes the e2e tests you mentioned.&lt;/p&gt;</comment>
                            <comment id="13547339" author="alangates" created="Tue, 8 Jan 2013 22:14:19 +0000"  >&lt;p&gt;Two small changes from the last patch.  I fixed one issue in negative.conf where there was a &quot;&quot; instead of &quot;.  Also changed TestInputSizeReducerEstimator as suggested by Rohini which fixed the unit test issue (thanks Rohini).&lt;/p&gt;</comment>
                            <comment id="13547387" author="alangates" created="Tue, 8 Jan 2013 23:14:13 +0000"  >&lt;p&gt;Patch checked in.  Thanks Nick.&lt;/p&gt;</comment>
                            <comment id="13550696" author="dvryaboy" created="Fri, 11 Jan 2013 01:57:41 +0000"  >&lt;p&gt;this is great, thank you!&lt;/p&gt;</comment>
                            <comment id="13621897" author="dvryaboy" created="Thu, 4 Apr 2013 08:39:14 +0100"  >&lt;p&gt;Didn&apos;t see earlier that this only went into trunk (thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knoguchi&quot; class=&quot;user-hover&quot; rel=&quot;knoguchi&quot;&gt;Koji Noguchi&lt;/a&gt; for pointing this out!).&lt;br/&gt;
We should put this into 0.11 branch, maybe there will be an 0.11.2 before 12 comes out.&lt;/p&gt;</comment>
                            <comment id="13622731" author="knoguchi" created="Thu, 4 Apr 2013 21:17:29 +0100"  >&lt;blockquote&gt;&lt;p&gt;We should put this into 0.11 branch, maybe there will be an 0.11.2 before 12 comes out.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If we can fix this in 0.11, that would be really nice.  &lt;br/&gt;
On our clusters, there were multiple users hit with this issue on 0.10.&lt;/p&gt;</comment>
                            <comment id="13622756" author="dvryaboy" created="Thu, 4 Apr 2013 21:41:52 +0100"  >&lt;p&gt;in 0.11 branch now.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12560359">PIG-2752</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12640337">PIG-3266</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12562392" name="PIG-2769.0.patch" size="56330" author="njw45" created="Wed, 26 Dec 2012 19:11:14 +0000"/>
                            <attachment id="12563813" name="PIG-2769.1.patch" size="58721" author="njw45" created="Tue, 8 Jan 2013 20:16:09 +0000"/>
                            <attachment id="12563839" name="PIG-2769.2.patch" size="58469" author="alangates" created="Tue, 8 Jan 2013 22:14:19 +0000"/>
                            <attachment id="12562799" name="TEST-org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.TestInputSizeReducerEstimator.txt" size="8480" author="alangates" created="Mon, 31 Dec 2012 16:03:09 +0000"/>
                            <attachment id="12533559" name="case1.tar" size="10240" author="dli@operasolutions.com" created="Wed, 27 Jun 2012 00:17:02 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 26 Jun 2012 23:23:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>240701</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxuzb3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4543</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>