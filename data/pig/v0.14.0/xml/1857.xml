<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:57:47 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1857/PIG-1857.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1857] Create an package integration project</title>
                <link>https://issues.apache.org/jira/browse/PIG-1857</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;This goal of this ticket is to generate a set of RPM/debian package which integrate well with RPM sets created by &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-6255&quot; title=&quot;Create an rpm integration project&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-6255&quot;&gt;&lt;del&gt;HADOOP-6255&lt;/del&gt;&lt;/a&gt;.  &lt;/p&gt;</description>
                <environment>&lt;p&gt;RHEL 5.5/Ubuntu 10.10&lt;/p&gt;</environment>
        <key id="12498709">PIG-1857</key>
            <summary>Create an package integration project</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="eyang">Eric Yang</assignee>
                                    <reporter username="eyang">Eric Yang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Feb 2011 01:08:13 +0000</created>
                <updated>Thu, 2 May 2013 03:29:36 +0100</updated>
                            <resolved>Tue, 26 Jul 2011 02:39:43 +0100</resolved>
                                    <version>0.9.0</version>
                                    <fixVersion>0.9.1</fixVersion>
                    <fixVersion>0.10.0</fixVersion>
                                    <component>build</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="12995552" author="eyang" created="Wed, 16 Feb 2011 22:32:02 +0000"  >&lt;p&gt;RPM deployment should utilize hadoop jars from hadoop rpm file.  It should be possible to create a default /etc/defaults/pig-env.sh which explicitly defines PIG_CLASSPATH=$&lt;/p&gt;
{HADOOP_CORE_JAR}
&lt;p&gt;:...:$&lt;/p&gt;
{HBASE_JAR}
&lt;p&gt;:$&lt;/p&gt;
{HADOOP_CONF_DIR}

&lt;p&gt;This will ensure pig environment is setup properly by the RPM packages without burden Pig developer nor application developer to setup the environment.&lt;/p&gt;</comment>
                            <comment id="12995597" author="eyang" created="Thu, 17 Feb 2011 00:07:47 +0000"  >&lt;p&gt;Preview of pig rpm/deb package.  /etc/default/pig-env.sh contains the proper setup of hadoop and hbase environment, if those software are deployed using package management system.  &lt;/p&gt;

&lt;p&gt;The outstanding issue is pig.jar bundling hadoop classes.  It would be ideal to have hadoop jars decoupled from pig.jar.&lt;/p&gt;</comment>
                            <comment id="12995598" author="eyang" created="Thu, 17 Feb 2011 00:09:27 +0000"  >&lt;p&gt;Usage:&lt;/p&gt;

&lt;p&gt;ant &quot;rpm&quot; to create rpm package.&lt;br/&gt;
ant &quot;deb&quot; to create deb package.&lt;/p&gt;</comment>
                            <comment id="12996188" author="eyang" created="Fri, 18 Feb 2011 01:30:50 +0000"  >&lt;p&gt;Revised patch to bundle pig-&lt;span class=&quot;error&quot;&gt;&amp;#91;version&amp;#93;&lt;/span&gt;&lt;del&gt;withouthadoop.jar as pig&lt;/del&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;version&amp;#93;&lt;/span&gt;-core.jar for rpm/deb packages.&lt;/p&gt;</comment>
                            <comment id="12996194" author="eyang" created="Fri, 18 Feb 2011 01:40:03 +0000"  >&lt;p&gt;Patch generation mistake on &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1857&quot; title=&quot;Create an package integration project&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1857&quot;&gt;&lt;del&gt;PIG-1857&lt;/del&gt;&lt;/a&gt;.patch resubmit again with &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1857&quot; title=&quot;Create an package integration project&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1857&quot;&gt;&lt;del&gt;PIG-1857&lt;/del&gt;&lt;/a&gt;-1.patch&lt;/p&gt;</comment>
                            <comment id="13062283" author="eyang" created="Sat, 9 Jul 2011 02:21:13 +0100"  >&lt;p&gt;Updated RPM/Debian packaging to layout files according to proposed file structure layout in &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-6255&quot; title=&quot;Create an rpm integration project&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-6255&quot;&gt;&lt;del&gt;HADOOP-6255&lt;/del&gt;&lt;/a&gt;.  Pig RPM/Debian package currently depends on 0.20-security branch version of Hadoop.&lt;/p&gt;</comment>
                            <comment id="13062586" author="alangates" created="Sat, 9 Jul 2011 18:16:34 +0100"  >&lt;p&gt;I am reviewing this patch.&lt;/p&gt;</comment>
                            <comment id="13067419" author="alangates" created="Tue, 19 Jul 2011 01:49:01 +0100"  >&lt;p&gt;A few initial comments:&lt;/p&gt;

&lt;p&gt;In rpm/spec/pig.spec the dependencies are set to &quot;Requires: hadoop, sh-utils, textutils, jdk &amp;gt;= 1.6&quot;.  But in deb/pig.control/control they are set to &quot;Depends: openjdk-6-jre-headless&quot;.  Shouldn&apos;t these match?&lt;/p&gt;

&lt;p&gt;nit: the build target &quot;source&quot; should be called source-distribution or something.  &quot;source&quot; sounds like it checks out the source.&lt;/p&gt;

&lt;p&gt;I still need to test this and think more about how it arranges files.&lt;/p&gt;</comment>
                            <comment id="13067429" author="eyang" created="Tue, 19 Jul 2011 02:16:32 +0100"  >&lt;p&gt;The meta packages do not match between debian and redhat.  On Debian, it depends on openjdk-6-jre-headless because Oracle does not offer Debian java package on their website.  Hence, the dependency is set to the default jdk provided by Debian (Same for ubuntu).  I will add &quot;hadoop&quot; to debian control file.  For sh-utils and textutils, those packages are part of base OS, hence no package needs to be defined.&lt;/p&gt;

&lt;p&gt;&quot;source&quot; change to &quot;source-distribution&quot; works for me too.&lt;/p&gt;</comment>
                            <comment id="13070024" author="alangates" created="Sat, 23 Jul 2011 20:15:16 +0100"  >&lt;p&gt;I&apos;ve tested the following with this:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;I can build rpms on Linux&lt;/li&gt;
	&lt;li&gt;I can build debs on Linux&lt;/li&gt;
	&lt;li&gt;I tried to build rpms on Mac.  This failed.  I have the current version of the rpm package from MacPorts.  Maybe I need something more recent.  I don&apos;t see this as a show stopper, but it would be nice.  See below for the error message.&lt;/li&gt;
	&lt;li&gt;I can build debs on Mac&lt;/li&gt;
	&lt;li&gt;When I build a tarball distribution (the one we&apos;ve done up until now) with this it works as before with an installed cluster and in local mode.  So this seems backward compatible.  That&apos;s good.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;What I haven&apos;t tested yet that still needs testing:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;That I can install the resulting rpm and that Pig runs ok when I do.  In particular I am interested to see how users run Pig when the RPM is installed.  Do they still need to set PIG_CLASSPATH to point to their cluster or does the RPM installation take care of all that.&lt;/li&gt;
	&lt;li&gt;That I can install the resulting deb and that Pig runs ok when I do.  I don&apos;t have any debian based systems handy to test this.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;A general question as well.  My initial impression was that there would be separate rpms and debs for binary and source distributions, as there are for maven packages.  But it looking at the resulting rpms and debs it looks instead like source and executables have all been placed in one rpm/deb.  Is that intentional?  Is it what users expect?  These things usually seem to be divided in rpms.&lt;/p&gt;

&lt;p&gt;The error message I get when building rpms on my mac:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
rpm:
    [mkdir] Created dir: /tmp/pig_package_build_gates/BUILD
    [mkdir] Created dir: /tmp/pig_package_build_gates/RPMS
    [mkdir] Created dir: /tmp/pig_package_build_gates/SRPMS
    [mkdir] Created dir: /tmp/pig_package_build_gates/SOURCES
    [mkdir] Created dir: /tmp/pig_package_build_gates/SPECS
     [copy] Copying 2 files to /tmp/pig_package_build_gates/SOURCES
     [copy] Copying 1 file to /tmp/pig_package_build_gates/SPECS
      [rpm] Building the RPM based on the pig.spec file
      [rpm] error: Unable to open temp file.
      [rpm]     Unable to open temp file.
      [rpm] 
      [rpm] 
      [rpm] RPM build errors:

BUILD FAILED
/Users/gates/src/pig/top/1857/trunk/build.xml:885: &apos;/opt/local/bin/rpmbuild&apos; failed with exit code 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13070045" author="eyang" created="Sat, 23 Jul 2011 21:19:49 +0100"  >&lt;p&gt;I have not tried to build the rpm on Mac port.  From the error, it looks like the system was unable to create files in /tmp.  There are three possible causes.  &lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;/tmp is full.&lt;/li&gt;
	&lt;li&gt;Disable java-repak did not work on MacPorts.  There are bugs in rpmbuild which re-package java jar files to find dependencies.  This is particularly a issue with software using aspect/j.  Hence, I defined a new macro __os_install_post to overwrite the jar file repackaging.  This macro was designed for RHEL/CentOS.  I don&apos;t think this macro works on MacPorts.&lt;/li&gt;
	&lt;li&gt;The source code location is in a location where the directory path contains multiple dash &apos;-&apos; character.  rpmbuild has bug to use long file names with dash character.  This is the reason that the build system designed to build RPM in /tmp to avoid using $src_prefix/build/rpm, where src_prefix has long file names.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I think the probable cause is either 1 or 2.  If you like to try to debug 2, then edit src/packages/rpm/spec/pig.spec and remove __os_install_post macro.&lt;/p&gt;

&lt;p&gt;For the untested part:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;PIG_CLASS_PATH should be properly setup by the script.  User doesn&apos;t need to define class path.&lt;/li&gt;
	&lt;li&gt;I would recommend to use VirtualBox and install Ubuntu.  I could share my vm image for testing on monday.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;For Apache Hadoop rpm/deb packages, there is no deb source package because source tarball is a different target from top level.  &lt;/p&gt;

&lt;p&gt;Here are the reasons why there is no source package:&lt;/p&gt;

&lt;p&gt;For debian, software are usually setup:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Write a control file, and pre/post install/remove/upgrade scripts&lt;/li&gt;
	&lt;li&gt;Patch source code&lt;/li&gt;
	&lt;li&gt;Build source code&lt;/li&gt;
	&lt;li&gt;Create deb package from binary&lt;/li&gt;
	&lt;li&gt;Create source deb package with source file list and binary deb package&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;For rpm, software are usually setup:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Write a spec file&lt;/li&gt;
	&lt;li&gt;Prepare source code and patches&lt;/li&gt;
	&lt;li&gt;Build from patched source&lt;/li&gt;
	&lt;li&gt;Discover dependency&lt;/li&gt;
	&lt;li&gt;Generate source rpm and binary rpm&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;In both systems, the meta data packaging file are created outside of the scope of source tarball, and patches can be applied to create patch level packages.  In Apache, we have minor releases but not patch level release.  Hence, the patching mechanism do not apply.  Apache released source tarball is the source of truth.  There is no need to create separate source package to represent the source.&lt;/p&gt;</comment>
                            <comment id="13070620" author="eyang" created="Mon, 25 Jul 2011 18:21:07 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1857&quot; title=&quot;Create an package integration project&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1857&quot;&gt;&lt;del&gt;PIG-1857&lt;/del&gt;&lt;/a&gt;-3.patch: Update debian dependency on Sun Java and Hadoop.&lt;/p&gt;</comment>
                            <comment id="13070772" author="eyang" created="Mon, 25 Jul 2011 22:26:13 +0100"  >&lt;p&gt;Fix path for pig jar file in Debian package.&lt;/p&gt;</comment>
                            <comment id="13070840" author="eyang" created="Mon, 25 Jul 2011 23:48:52 +0100"  >&lt;p&gt;Remove template defined PIG_HOME.&lt;/p&gt;</comment>
                            <comment id="13070857" author="daijy" created="Tue, 26 Jul 2011 00:25:41 +0100"  >&lt;p&gt;Tried &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1857&quot; title=&quot;Create an package integration project&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1857&quot;&gt;&lt;del&gt;PIG-1857&lt;/del&gt;&lt;/a&gt;-5.patch, works well in both ubuntu (deb) and redhat (rpm). Here is some notes about how it works:&lt;br/&gt;
1. Install contrib, lib, scripts, test, tutorial into /usr/share/pig, install pig config into /etc/pig, install bin/pig into /usr/bin&lt;br/&gt;
2. package bundles pig-withouthadoop.jar&lt;br/&gt;
3. package depends on hadoop package&lt;br/&gt;
4. bin/pig will put /etc/hadoop into classpath, which should be the hadoop config; It also link all hadoop jars&lt;/p&gt;

&lt;p&gt;For Alan&apos;s concern:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;That I can install the resulting rpm and that Pig runs ok when I do. In particular I am interested to see how users run Pig when the RPM is installed. Do they still need to set PIG_CLASSPATH to point to their cluster or does the RPM installation take care of all that.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, verified.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;That I can install the resulting deb and that Pig runs ok when I do. I don&apos;t have any debian based systems handy to test this.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, verified.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;A general question as well. My initial impression was that there would be separate rpms and debs for binary and source distributions, as there are for maven packages. But it looking at the resulting rpms and debs it looks instead like source and executables have all been placed in one rpm/deb. Is that intentional? Is it what users expect? These things usually seem to be divided in rpms.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Talked with Eric, we only build binary packages. The rpm source package is not used and Eric will remove it.&lt;/p&gt;</comment>
                            <comment id="13070864" author="daijy" created="Tue, 26 Jul 2011 01:00:37 +0100"  >&lt;p&gt;Some additional change we want to make:&lt;br/&gt;
1. pig-withouthadoop.jar is renamed to pig-0.10.0-SNAPSHOT-core.jar in the package, which could be confusing&lt;br/&gt;
2. Eventually we want to use pig-only.jar, link all libraries in lib dynamically&lt;/p&gt;

&lt;p&gt;All these changes require change other part of Pig code, which is outside the scope of this Jira. We will open separate tickets to address.&lt;/p&gt;</comment>
                            <comment id="13070876" author="eyang" created="Tue, 26 Jul 2011 01:45:13 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1857&quot; title=&quot;Create an package integration project&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1857&quot;&gt;&lt;del&gt;PIG-1857&lt;/del&gt;&lt;/a&gt;-6.patch: Build RPM binary package only.&lt;/p&gt;</comment>
                            <comment id="13070888" author="daijy" created="Tue, 26 Jul 2011 02:09:55 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1857&quot; title=&quot;Create an package integration project&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1857&quot;&gt;&lt;del&gt;PIG-1857&lt;/del&gt;&lt;/a&gt;-7.patch include some minor change in classpath sequence. Allow user to override hadoop conf with environment variable PIG_CLASSPATH&lt;/p&gt;</comment>
                            <comment id="13070897" author="daijy" created="Tue, 26 Jul 2011 02:39:43 +0100"  >&lt;p&gt;Patch committed to trunk. Thanks Eric!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12435489">HADOOP-6255</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12424985">PIG-805</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12471355" name="PIG-1857-1.patch" size="24035" author="eyang" created="Fri, 18 Feb 2011 01:40:03 +0000"/>
                            <attachment id="12485799" name="PIG-1857-2.patch" size="32162" author="eyang" created="Sat, 9 Jul 2011 02:21:13 +0100"/>
                            <attachment id="12487735" name="PIG-1857-3.patch" size="32082" author="eyang" created="Mon, 25 Jul 2011 18:21:07 +0100"/>
                            <attachment id="12487757" name="PIG-1857-4.patch" size="32159" author="eyang" created="Mon, 25 Jul 2011 22:26:13 +0100"/>
                            <attachment id="12487767" name="PIG-1857-5.patch" size="32130" author="eyang" created="Mon, 25 Jul 2011 23:48:52 +0100"/>
                            <attachment id="12487776" name="PIG-1857-6.patch" size="32130" author="eyang" created="Tue, 26 Jul 2011 01:45:13 +0100"/>
                            <attachment id="12487780" name="PIG-1857-7.patch" size="32725" author="daijy" created="Tue, 26 Jul 2011 02:31:55 +0100"/>
                            <attachment id="12471235" name="PIG-1857-draft.patch" size="25739" author="eyang" created="Thu, 17 Feb 2011 00:07:47 +0000"/>
                            <attachment id="12471353" name="PIG-1857.patch" size="24043" author="eyang" created="Fri, 18 Feb 2011 01:30:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 9 Jul 2011 17:16:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>46539</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyau5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97196</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Create PIG rpm and deb packages.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>