<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:08:22 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3623/PIG-3623.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3623] HBaseStorage: setting loadKey and noWAL to false doesn&apos;t have any affect</title>
                <link>https://issues.apache.org/jira/browse/PIG-3623</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The documentation for HBaseStorage (&lt;a href=&quot;http://pig.apache.org/docs/r0.12.0/func.html#HBaseStorage&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://pig.apache.org/docs/r0.12.0/func.html#HBaseStorage&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;says -loadKey=(true|false) Load the row key as the first value in every tuple returned from HBase (default=false)&lt;/p&gt;

&lt;p&gt;However, looking at the source (&lt;a href=&quot;http://svn.apache.org/repos/asf/pig/trunk/src/org/apache/pig/backend/hadoop/hbase/HBaseStorage.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/pig/trunk/src/org/apache/pig/backend/hadoop/hbase/HBaseStorage.java&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;it is just doing a check for the existence of this option&lt;/p&gt;

&lt;p&gt;loadRowKey_ = configuredOptions_.hasOption(&quot;loadKey&quot;);&lt;/p&gt;

&lt;p&gt;So setting -loadKey=false in the options string, still results in a true value&lt;/p&gt;</description>
                <environment></environment>
        <key id="12684473">PIG-3623</key>
            <summary>HBaseStorage: setting loadKey and noWAL to false doesn&apos;t have any affect</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nezihyigitbasi">Nezih Yigitbasi</assignee>
                                    <reporter username="mstefaniak">Michael Stefaniak</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Dec 2013 14:53:12 +0000</created>
                <updated>Mon, 7 Jul 2014 19:08:02 +0100</updated>
                            <resolved>Wed, 5 Feb 2014 03:25:19 +0000</resolved>
                                    <version>0.12.0</version>
                                    <fixVersion>0.13.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13856804" author="prkommireddi" created="Thu, 26 Dec 2013 09:13:00 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mstefaniak&quot; class=&quot;user-hover&quot; rel=&quot;mstefaniak&quot;&gt;Michael Stefaniak&lt;/a&gt;. This actually sounds like a bug, the following would fix it.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(configuredOptions_.hasOption(&lt;span class=&quot;code-quote&quot;&gt;&quot;loadKey&quot;&lt;/span&gt;)) {
    loadRowKey_ = configuredOptions_.getOptionValue(&lt;span class=&quot;code-quote&quot;&gt;&quot;loadKey&quot;&lt;/span&gt;);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;Rohini Palaniswamy&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=billgraham&quot; class=&quot;user-hover&quot; rel=&quot;billgraham&quot;&gt;Bill Graham&lt;/a&gt; would this be backward incompatible? Its the right thing to do w.r.t docs, but I am not sure if this will throw users off because of current behavior?&lt;/p&gt;</comment>
                            <comment id="13856907" author="rohini" created="Thu, 26 Dec 2013 15:19:34 +0000"  >&lt;p&gt;We should fix the code and not the documentation as the expected behavior should that be of the documentation. Since default is false, people don&apos;t usually specify -loadKey false and if they specified they would immediately realize as in this jira that it is not working correctly because the fields returned are not expected, so backward compatibility is not a issue. Saw this with -noWAL as well when fixing &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3632&quot; title=&quot;Add option to configure cacheBlocks in HBaseStorage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3632&quot;&gt;&lt;del&gt;PIG-3632&lt;/del&gt;&lt;/a&gt;. Both options need to be fixed.&lt;/p&gt;</comment>
                            <comment id="13857303" author="billgraham" created="Fri, 27 Dec 2013 04:47:53 +0000"  >&lt;p&gt;+1 for fixing behavior to match the docs here. Great find &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mstefaniak&quot; class=&quot;user-hover&quot; rel=&quot;mstefaniak&quot;&gt;Michael Stefaniak&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13885950" author="nezihyigitbasi" created="Wed, 29 Jan 2014 22:54:47 +0000"  >&lt;p&gt;Guys, Seems like nobody has fixed this issue, so I fixed it. Any feedback is appreciated.&lt;/p&gt;</comment>
                            <comment id="13886092" author="rohini" created="Thu, 30 Jan 2014 00:43:58 +0000"  >&lt;p&gt;Can you please fix -noWAL as well?&lt;/p&gt;</comment>
                            <comment id="13886101" author="nezihyigitbasi" created="Thu, 30 Jan 2014 00:51:24 +0000"  >&lt;p&gt;Added a fix for noWAL&lt;/p&gt;</comment>
                            <comment id="13888230" author="nezihyigitbasi" created="Fri, 31 Jan 2014 22:08:26 +0000"  >&lt;p&gt;This patch fixes the backward compatibility issues I found during my tests. The solution is to use OptionBuilder to create options that take optional arguments since addOption doesn&apos;t let me do that. And if we don&apos;t make loadKey and noWal arguments optional (that is if we make 2nd argument of addOption true) then old code that doesn&apos;t specify true|false breaks. Rohini, can you please review? &lt;/p&gt;

&lt;p&gt;Btw I have run my own unit tests and couldn&apos;t get TestHBaseStorage running. I get exceptions like :&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 533071 &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-4871&amp;#93;&lt;/span&gt; WARN  org.apache.hadoop.mapred.TaskTracker  - Error initializing att                                                           empt_20140131132522179_0022_m_000001_1:&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; java.io.FileNotFoundException: File does not exist: hdfs://localhost:44996/tmp/hadoop-nyi                                                           gitba/mapred/system/job_20140131132522179_0022/jobToken&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.hadoop.hdfs.DistributedFileSystem.getFileStatus(DistributedFileSystem.j                                                           ava:517)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.hadoop.mapred.TaskTracker.localizeJobTokenFile(TaskTracker.java:4250)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.hadoop.mapred.TaskTracker.initializeJob(TaskTracker.java:1158)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.hadoop.mapred.TaskTracker.localizeJob(TaskTracker.java:1099)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.hadoop.mapred.TaskTracker$5.run(TaskTracker.java:2382)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at java.lang.Thread.run(Thread.java:722)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 533071 &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-4871&amp;#93;&lt;/span&gt; ERROR org.apache.hadoop.mapred.TaskStatus  - Trying to set finish ti                                                           me for task attempt_20140131132522179_0022_m_000001_1 when no start time is set, stackTrace is : java                                                           .lang.Exception&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.hadoop.mapred.TaskStatus.setFinishTime(TaskStatus.java:145)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.hadoop.mapred.TaskTracker$TaskInProgress.kill(TaskTracker.java:3094)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.hadoop.mapred.TaskTracker$5.run(TaskTracker.java:2392)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at java.lang.Thread.run(Thread.java:722)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="13888873" author="rohini" created="Sun, 2 Feb 2014 09:05:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;And if we don&apos;t make loadKey and noWal arguments optional (that is if we make 2nd argument of addOption true) then old code that doesn&apos;t specify true|false breaks &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;   validOptions_.addOption(&quot;loadKey&quot;, false, &quot;Load Key&quot;);&lt;br/&gt;
   if (&quot;true&quot;.equalsIgnoreCase(value) || value == null) {//the null check is for backward compat.&lt;/p&gt;

&lt;p&gt;Just realized that -loadKey and -noWAL were command line switches/flags instead of options which take arguments even though the document said otherwise. Seeing the code for ignoreWhitespace which takes argument value, I had just assumed that -loadKey and -noWAL also took argument  but was not honoring those argument values. Wish all of them were consistent. Changing documentation now to say that they are only flags will still make people looking at older release documentation make mistakes or will have them confuse with -ignoreWhiteSpace and -cacheBlocks which always take arguments. Your patch takes care of it both ways (either as flag or as an option taking argument). So I guess we are good. Patch looks good as well. &lt;/p&gt;

&lt;p&gt;TestHBaseStorage fails for me as well. When doing svn up -r 1553724 which is the last checkin in &lt;a href=&quot;http://svn.apache.org/viewvc/pig/trunk/src/org/apache/pig/backend/hadoop/hbase/HBaseStorage.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/pig/trunk/src/org/apache/pig/backend/hadoop/hbase/HBaseStorage.java&lt;/a&gt;, the tests pass. Initially thought it was due to &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3573&quot; title=&quot;Provide StoreFunc and LoadFunc for Accumulo&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3573&quot;&gt;&lt;del&gt;PIG-3573&lt;/del&gt;&lt;/a&gt; changing zookeeper version to 3.4.5, but even reverting it to 3.4.4 the tests fail.  Will commit once I figure out the cause of the failure.&lt;/p&gt;</comment>
                            <comment id="13888875" author="rohini" created="Sun, 2 Feb 2014 09:07:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nezihyigitbasi&quot; class=&quot;user-hover&quot; rel=&quot;nezihyigitbasi&quot;&gt;Nezih Yigitbasi&lt;/a&gt;,&lt;br/&gt;
   There are 6 failures and 2 errors with this patch when applying it after svn up -r 1553724. Can you take a look at those failures?&lt;/p&gt;</comment>
                            <comment id="13888906" author="nezihyigitbasi" created="Sun, 2 Feb 2014 11:58:43 +0000"  >&lt;p&gt;Rohini, thanks for running the TestHBaseStorage for me. Finally I also got it working (needed to switch to JDK 6, found out that this is a bug &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1550&quot; title=&quot;ZooKeeperSaslClient does not finish anonymous login on OpenJDK&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1550&quot;&gt;&lt;del&gt;ZOOKEEPER-1550&lt;/del&gt;&lt;/a&gt;). Anyways, fixed the issue &amp;amp; all unit tests pass now.&lt;/p&gt;</comment>
                            <comment id="13891657" author="rohini" created="Wed, 5 Feb 2014 03:25:19 +0000"  >&lt;p&gt;+1. Committed to trunk. Thanks Nezih&lt;/p&gt;

&lt;p&gt;The TestHBaseStorage still fails in the trunk. Passes fine when reverting to the old revision with this patch. Will address that in a separate jira. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12626029" name="PIG-3623.1.patch" size="3406" author="nezihyigitbasi" created="Thu, 30 Jan 2014 00:51:24 +0000"/>
                            <attachment id="12626388" name="PIG-3623.2.patch" size="4590" author="nezihyigitbasi" created="Fri, 31 Jan 2014 22:08:26 +0000"/>
                            <attachment id="12626527" name="PIG-3623.3.patch" size="4684" author="nezihyigitbasi" created="Sun, 2 Feb 2014 11:58:43 +0000"/>
                            <attachment id="12626003" name="PIG-3623.patch" size="1385" author="nezihyigitbasi" created="Wed, 29 Jan 2014 22:54:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 26 Dec 2013 09:13:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>363545</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzkidr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>363851</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>