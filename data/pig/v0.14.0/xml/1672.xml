<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:04:06 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1672/PIG-1672.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1672] order of relations in replicated join gets switched in a query where first relation has two mergeable foreach statements</title>
                <link>https://issues.apache.org/jira/browse/PIG-1672</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The replicated join query was running out of memory because the order of relations got switched during logical plan optimization and it was attempting to load the larger (left) relation into memory.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
cat replj.pig
l1 = load &apos;x&apos; as (a);
l2 = load &apos;y&apos; as (b);
l3 = load &apos;z&apos; as (a1,b1,c1,d1);
f1 = foreach l3 generate a1 as a, b1 as b, c1 as c, d1 as d;
f2 = foreach f1 generate a,b,c; 
j1 = join f2 by a, l1 by a using &apos;replicated&apos;;
j2 = join j1 by b, l2 by b using &apos;replicated&apos;;
explain j2;


Note that in the MR plan printed below, the Load in the MR job with join operations has &apos;x&apos; as the input instead of &apos;z&apos; .

#--------------------------------------------------
# Map Reduce Plan                                  
#--------------------------------------------------
MapReduce node scope-30
Map Plan
Store(file:/tmp/temp101387354/tmp-125684214:org.apache.pig.impl.io.InterStorage) - scope-31
|
|---l2: Load(file:&lt;span class=&quot;code-comment&quot;&gt;///Users/tejas/pig-0.8/branch-0.8/y:org.apache.pig.builtin.PigStorage) - scope-17--------
&lt;/span&gt;Global sort: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
----------------

MapReduce node scope-27
Map Plan
j2: Store(fakefile:org.apache.pig.builtin.PigStorage) - scope-26
|
|---j2: FRJoin[tuple] - scope-20
    |   |
    |   Project[bytearray][1] - scope-18
    |   |
    |   Project[bytearray][0] - scope-19
    |
    |---j1: FRJoin[tuple] - scope-11
        |   |
        |   Project[bytearray][0] - scope-9
        |   |
        |   Project[bytearray][0] - scope-10
        |
        |---l1: Load(file:&lt;span class=&quot;code-comment&quot;&gt;///Users/tejas/pig-0.8/branch-0.8/x:org.apache.pig.builtin.PigStorage) - scope-0--------
&lt;/span&gt;Global sort: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
----------------

MapReduce node scope-28
Map Plan
Store(file:/tmp/temp101387354/tmp-890864787:org.apache.pig.impl.io.InterStorage) - scope-29
|
|---f2: New For Each(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)[bag] - scope-8
    |   |
    |   Project[bytearray][0] - scope-2
    |   |
    |   Project[bytearray][1] - scope-4
    |   |
    |   Project[bytearray][2] - scope-6
    |
    |---l3: Load(file:&lt;span class=&quot;code-comment&quot;&gt;///Users/tejas/pig-0.8/branch-0.8/z:org.apache.pig.builtin.PigStorage) - scope-1--------
&lt;/span&gt;Global sort: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
----------------

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12476796">PIG-1672</key>
            <summary>order of relations in replicated join gets switched in a query where first relation has two mergeable foreach statements</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thejas">Thejas M Nair</assignee>
                                    <reporter username="thejas">Thejas M Nair</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Oct 2010 19:51:58 +0100</created>
                <updated>Fri, 17 Dec 2010 22:46:13 +0000</updated>
                            <resolved>Sat, 9 Oct 2010 01:19:56 +0100</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12919016" author="thejas" created="Thu, 7 Oct 2010 19:54:00 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1672&quot; title=&quot;order of relations in replicated join gets switched in a query where first relation has two mergeable foreach statements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1672&quot;&gt;&lt;del&gt;PIG-1672&lt;/del&gt;&lt;/a&gt;.1.patch&lt;br/&gt;
Fixed the way new merged foreach gets added after two foreach statements get merged. I will upload another patch with test cases.&lt;/p&gt;</comment>
                            <comment id="12919431" author="thejas" created="Sat, 9 Oct 2010 00:58:01 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1672&quot; title=&quot;order of relations in replicated join gets switched in a query where first relation has two mergeable foreach statements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1672&quot;&gt;&lt;del&gt;PIG-1672&lt;/del&gt;&lt;/a&gt;.2.patch&lt;br/&gt;
Added test case.&lt;br/&gt;
I have also made minor changes to reduce the memory footprint of the right table, which should reduce the overhead for every record in the table by up to 80 bytes. In POFRJoin.java, now the ArrayList that stores multiple values for a key is initialized with 1, the &apos;value&apos; tuple in the hashmap is initialized with expected number of fields.&lt;/p&gt;

</comment>
                            <comment id="12919432" author="thejas" created="Sat, 9 Oct 2010 00:58:48 +0100"  >&lt;p&gt;Unit tests and test-patch have passed with &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1672&quot; title=&quot;order of relations in replicated join gets switched in a query where first relation has two mergeable foreach statements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1672&quot;&gt;&lt;del&gt;PIG-1672&lt;/del&gt;&lt;/a&gt;.2.patch .&lt;/p&gt;</comment>
                            <comment id="12919433" author="daijy" created="Sat, 9 Oct 2010 01:03:38 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12919438" author="thejas" created="Sat, 9 Oct 2010 01:19:56 +0100"  >&lt;p&gt;Patch committed to 0.8 branch and trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12456619" name="PIG-1672.1.patch" size="2002" author="thejas" created="Thu, 7 Oct 2010 19:54:00 +0100"/>
                            <attachment id="12456751" name="PIG-1672.2.patch" size="7868" author="thejas" created="Sat, 9 Oct 2010 00:58:01 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 9 Oct 2010 00:03:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>165121</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyasy7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97001</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>