<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:56:17 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3270/PIG-3270.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3270] Union onschema failing at runtime when merging incompatible types</title>
                <link>https://issues.apache.org/jira/browse/PIG-3270</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;t1 = LOAD &apos;file1.txt&apos; USING PigStorage() AS (a: chararray, b: chararray);
t2 = LOAD &apos;file2.txt&apos; USING PigStorage() AS (a: chararray, b: float);
tout = UNION ONSCHEMA t1, t2;
dump tout;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Job fails with &lt;br/&gt;
2013-04-09 11:37:37,817 &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-12&amp;#93;&lt;/span&gt; WARN  org.apache.hadoop.mapred.LocalJobRunner - job_local_0001&lt;br/&gt;
java.lang.Exception: org.apache.pig.backend.executionengine.ExecException: ERROR 2055: Received Error while processing the map plan.&lt;br/&gt;
        at org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:399)&lt;br/&gt;
Caused by: org.apache.pig.backend.executionengine.ExecException: ERROR 2055: Received Error while processing the map plan.&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.runPipeline(PigGenericMapBase.java:311)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:278)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:64)&lt;br/&gt;
        at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:144)&lt;br/&gt;
        at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:726)&lt;br/&gt;
        at org.apache.hadoop.mapred.MapTask.run(MapTask.java:333)&lt;br/&gt;
        at org.apache.hadoop.mapred.LocalJobRunner$Job$MapTaskRunnable.run(LocalJobRunner.java:231)&lt;br/&gt;
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:439)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:680)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12641653">PIG-3270</key>
            <summary>Union onschema failing at runtime when merging incompatible types</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knoguchi">Koji Noguchi</assignee>
                                    <reporter username="knoguchi">Koji Noguchi</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Apr 2013 16:42:07 +0100</created>
                <updated>Mon, 14 Oct 2013 17:46:45 +0100</updated>
                            <resolved>Thu, 11 Apr 2013 20:52:14 +0100</resolved>
                                                    <fixVersion>0.12.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13626733" author="knoguchi" created="Tue, 9 Apr 2013 16:49:23 +0100"  >&lt;p&gt;Before &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2071&quot; title=&quot;casting numeric type to chararray during schema merge for union is inconsistent with other schema merge cases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2071&quot;&gt;&lt;del&gt;PIG-2071&lt;/del&gt;&lt;/a&gt;, this job would have dumped field &apos;b&apos; as chararray instead of failing at the middle at runtime.  Reading that jira, I&apos;m thinking this example should have failed at compile time with better error messages.  Am I understanding it correctly? &lt;/p&gt;</comment>
                            <comment id="13626944" author="daijy" created="Tue, 9 Apr 2013 19:46:58 +0100"  >&lt;p&gt;This should not fail. When we merge chararray and numerical field, the result datatype is unknown (bytearray). Do an explain without MergeForEach (-t MergeForEach):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
tout: (Name: LOStore Schema: a#11:chararray,b#12:bytearray)
|
|---tout: (Name: LOUnion Schema: a#11:chararray,b#12:bytearray)
    |
    |---tout: (Name: LOForEach Schema: a#1:chararray,b#2:bytearray)
    |   |   |
    |   |   (Name: LOGenerate[&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;] Schema: a#1:chararray,b#2:bytearray)ColumnPrune:InputUids=[1, 2]ColumnPrune:OutputUids=[1, 2]
    |   |   |   |
    |   |   |   a:(Name: Project Type: chararray Uid: 1 Input: 0 Column: 0)
    |   |   |   |
    |   |   |   (Name: Cast Type: bytearray Uid: 2)  &amp;lt;------- Wrong &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;
    |   |   |   |
    |   |   |   |---b:(Name: Project Type: chararray Uid: 2 Input: 1 Column: 0)
    |   |   |
    |   |   |---(Name: LOInnerLoad[0] Schema: a#1:chararray)
    |   |   |
    |   |   |---(Name: LOInnerLoad[1] Schema: b#2:chararray)
    |   |
    |   |---t1: (Name: LOForEach Schema: a#1:chararray,b#2:chararray)
    |       |   |
    |       |   (Name: LOGenerate[&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;] Schema: a#1:chararray,b#2:chararray)ColumnPrune:InputUids=[1, 2]ColumnPrune:OutputUids=[1, 2]
    |       |   |   |
    |       |   |   (Name: Cast Type: chararray Uid: 1)
    |       |   |   |
    |       |   |   |---a:(Name: Project Type: bytearray Uid: 1 Input: 0 Column: (*))
    |       |   |   |
    |       |   |   (Name: Cast Type: chararray Uid: 2)
    |       |   |   |
    |       |   |   |---b:(Name: Project Type: bytearray Uid: 2 Input: 1 Column: (*))
    |       |   |
    |       |   |---(Name: LOInnerLoad[0] Schema: a#1:bytearray)
    |       |   |
    |       |   |---(Name: LOInnerLoad[1] Schema: b#2:bytearray)
    |       |
    |       |---t1: (Name: LOLoad Schema: a#1:bytearray,b#2:bytearray)RequiredFields:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
    |
    |---tout: (Name: LOForEach Schema: a#3:chararray,b#4:bytearray)
        |   |
        |   (Name: LOGenerate[&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;] Schema: a#3:chararray,b#4:bytearray)ColumnPrune:InputUids=[3, 4]ColumnPrune:OutputUids=[3, 4]
        |   |   |
        |   |   a:(Name: Project Type: chararray Uid: 3 Input: 0 Column: 0)
        |   |   |
        |   |   (Name: Cast Type: bytearray Uid: 4)  &amp;lt;------- Wrong &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;
        |   |   |
        |   |   |---b:(Name: Project Type: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; Uid: 4 Input: 1 Column: 0)
        |   |
        |   |---(Name: LOInnerLoad[0] Schema: a#3:chararray)
        |   |
        |   |---(Name: LOInnerLoad[1] Schema: b#4:&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)
        |
        |---t2: (Name: LOForEach Schema: a#3:chararray,b#4:&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)
            |   |
            |   (Name: LOGenerate[&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;] Schema: a#3:chararray,b#4:&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)ColumnPrune:InputUids=[3, 4]ColumnPrune:OutputUids=[3, 4]
            |   |   |
            |   |   (Name: Cast Type: chararray Uid: 3)
            |   |   |
            |   |   |---a:(Name: Project Type: bytearray Uid: 3 Input: 0 Column: (*))
            |   |   |
            |   |   (Name: Cast Type: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; Uid: 4)
            |   |   |
            |   |   |---b:(Name: Project Type: bytearray Uid: 4 Input: 1 Column: (*))
            |   |
            |   |---(Name: LOInnerLoad[0] Schema: a#3:bytearray)
            |   |
            |   |---(Name: LOInnerLoad[1] Schema: b#4:bytearray)
            |
            |---t2: (Name: LOLoad Schema: a#3:bytearray,b#4:bytearray)RequiredFields:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We should not insert cast to bytes operation. It&apos;s probably in UnionOnSchemaSetter&lt;/p&gt;</comment>
                            <comment id="13628259" author="knoguchi" created="Wed, 10 Apr 2013 22:16:58 +0100"  >&lt;blockquote&gt;&lt;p&gt;We should not insert cast to bytes operation. It&apos;s probably in UnionOnSchemaSetter&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ah, I see.  I saw that job was failing at POCast(DataByteArray) but didn&apos;t know that it would work without this cast. &lt;/p&gt;

&lt;p&gt;Writing a test.&lt;/p&gt;</comment>
                            <comment id="13628382" author="knoguchi" created="Wed, 10 Apr 2013 23:46:22 +0100"  >&lt;blockquote&gt;&lt;p&gt;Writing a test.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Since the original job was failing at runtime due to invalid bytearray casting, I added a e2e test.&lt;/p&gt;</comment>
                            <comment id="13629277" author="daijy" created="Thu, 11 Apr 2013 20:52:14 +0100"  >&lt;p&gt;Patch committed to trunk. Thanks Koji!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12578080" name="pig-3270-v01.patch" size="950" author="knoguchi" created="Wed, 10 Apr 2013 22:16:58 +0100"/>
                            <attachment id="12578100" name="pig-3270-v02.patch" size="2197" author="knoguchi" created="Wed, 10 Apr 2013 23:46:22 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 9 Apr 2013 18:46:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>322069</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzdf3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>322414</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>