<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:56:07 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-920/PIG-920.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-920] optimizing diamond queries</title>
                <link>https://issues.apache.org/jira/browse/PIG-920</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The following query&lt;/p&gt;

&lt;p&gt;A = load &apos;foo&apos;;&lt;br/&gt;
B = filer A by $0&amp;gt;1;&lt;br/&gt;
C = filter A by $1 = &apos;foo&apos;;&lt;br/&gt;
D = COGROUP C by $0, B by $0;&lt;br/&gt;
......&lt;/p&gt;

&lt;p&gt;does not get efficiently executed. Currently, it runs a map only job that basically reads and write the same data before doing the query processing.&lt;/p&gt;

&lt;p&gt;Query where the data is loaded twice actually executed more efficiently.&lt;/p&gt;

&lt;p&gt;This is not an uncommon query and we should fix this issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12433010">PIG-920</key>
            <summary>optimizing diamond queries</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rding">Richard Ding</assignee>
                                    <reporter username="olgan">Olga Natkovich</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Aug 2009 18:12:33 +0100</created>
                <updated>Wed, 24 Mar 2010 22:15:54 +0000</updated>
                            <resolved>Fri, 30 Oct 2009 20:54:33 +0000</resolved>
                                                    <fixVersion>0.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12770657" author="rding" created="Tue, 27 Oct 2009 21:47:57 +0000"  >&lt;p&gt;This patch adds optimization for diamond queries as part of multi-query optimization.&lt;/p&gt;</comment>
                            <comment id="12770800" author="hadoopqa" created="Wed, 28 Oct 2009 05:40:00 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12423365/PIG-920.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12423365/PIG-920.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 830335.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/118/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/118/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/118/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/118/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/118/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/118/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12771712" author="pkamath" created="Fri, 30 Oct 2009 00:14:00 +0000"  >&lt;p&gt;In MultiQueryOptimizer.java (the numbers in the code blocks below are line numbers):&lt;/p&gt;

&lt;p&gt;It would be good to add some comments in the following code on why the plan size should be 2 or 3&lt;br/&gt;
and what the POForEach is&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; 223             if (pl.size() == 2 || pl.size() == 3) {
   224                 PhysicalOperator root = pl.getRoots().get(0);
   225                 PhysicalOperator leaf = pl.getLeaves().get(0);
   226                 if (root instanceof POLoad &amp;amp;&amp;amp; leaf instanceof POStore) {
   227                     if (pl.size() == 3) {
   228                         PhysicalOperator mid = pl.getSuccessors(root).get(0);
   229                         if (mid instanceof POForEach) {
   230                             rtn = true;
   231                         }
   232                     } else {
   233                         rtn = true;
   234                     }
   235                 }
   236             }
   237         }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Just to be safe it might be better to check that there is only 1 successor before this code:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; 265                 PhysicalOperator opSucc = succ.mapPlan.getSuccessors(op).get(0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is the following by design even in the case where multiple successors are present for splitter?&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; 309         return 1;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12771727" author="rding" created="Fri, 30 Oct 2009 00:54:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;It would be good to add some comments in the following code on why the plan size should be 2 or 3 and what the POForEach is&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Will do.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Just to be safe it might be better to check that there is only 1 successor before this code:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The load operator can have only one successor (supportsMultipleOutputs = false).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is the following by design even in the case where multiple successors are present for splitter?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This return value is the number of MR operators being merged (removed from plan by this method). For this method, the return value can be either 0 or 1.&lt;/p&gt;</comment>
                            <comment id="12772066" author="rding" created="Fri, 30 Oct 2009 20:01:57 +0000"  >&lt;p&gt;Add additional comments.&lt;/p&gt;</comment>
                            <comment id="12772081" author="pkamath" created="Fri, 30 Oct 2009 20:54:33 +0000"  >&lt;p&gt;+1, patch committed, thanks for the contribution Richard!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12423716" name="PIG-920.patch" size="14562" author="rding" created="Fri, 30 Oct 2009 20:01:21 +0000"/>
                            <attachment id="12423365" name="PIG-920.patch" size="13958" author="rding" created="Tue, 27 Oct 2009 21:47:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 27 Oct 2009 21:47:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164464</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyakgn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95626</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>