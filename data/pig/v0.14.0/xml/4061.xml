<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:04:44 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-4061/PIG-4061.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-4061] Make Streaming UDF work in Tez</title>
                <link>https://issues.apache.org/jira/browse/PIG-4061</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3478&quot; title=&quot;Make StreamingUDF work for Hadoop 2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3478&quot;&gt;&lt;del&gt;PIG-3478&lt;/del&gt;&lt;/a&gt; fixed Streaming UDF in MR2. We should get it working in Tez.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12728298">PIG-4061</key>
            <summary>Make Streaming UDF work in Tez</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12666475">PIG-3446</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="cheolsoo">Cheolsoo Park</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Jul 2014 23:49:38 +0100</created>
                <updated>Fri, 21 Nov 2014 05:58:24 +0000</updated>
                            <resolved>Thu, 21 Aug 2014 17:59:59 +0100</resolved>
                                                    <fixVersion>0.14.0</fixVersion>
                                    <component>tez</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14094625" author="daijy" created="Tue, 12 Aug 2014 21:37:44 +0100"  >&lt;p&gt;Seems StreamingPythonUDFs works for me now. I do remember it failed in some environment sometimes, guess it is environment dependent. One thing I notice is all log files are generated in userlog root directory instead of the application specific directory. Wonder if this is the issue which cause failure. &lt;/p&gt;</comment>
                            <comment id="14094726" author="daijy" created="Tue, 12 Aug 2014 22:37:54 +0100"  >&lt;p&gt;Attach a patch to change the log dir. I have trouble to reproduce the failure though. Anyone has an environment on which StreamingPythonUDFs fail?&lt;/p&gt;</comment>
                            <comment id="14095116" author="cheolsoo" created="Wed, 13 Aug 2014 04:56:20 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;Daniel Dai&lt;/a&gt;, you&apos;re right. It works now. I don&apos;t know since when, it has been fixed. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;We should remove the following comments in TezPlanContainer.java then-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-comment&quot;&gt;// Streaming UDF&apos;s are not working under Hadoop 2 (PIG-3478), so don&apos;t bother adding
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// resources &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; them yet.
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&quot;StreamingUDF&quot;&lt;/span&gt;.equals(clazz.getSimpleName())) {
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fileName : StreamingUDF.getResourcesForJar()) {
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//         jarLists.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(fileName).toURI().toURL());
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//     }
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// }&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As for your patch, you have typos in your code-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hadoopLogDir == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;hadoop.log.dir&quot;&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;//--&amp;gt; hadoopLogDir = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;hadoop.log.dir&quot;&lt;/span&gt;);
&lt;/span&gt;+        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Btw, the code checks for &quot;hadoop.log.dir&quot; not only in system properties but also in configuration. Should we do the same for &quot;yarn.app.container.log.dir&quot;?&lt;/p&gt;
</comment>
                            <comment id="14095168" author="daijy" created="Wed, 13 Aug 2014 06:28:27 +0100"  >&lt;p&gt;Thanks Cheolsoo, attach another patch to address all the comments.&lt;/p&gt;</comment>
                            <comment id="14095169" author="rohini" created="Wed, 13 Aug 2014 06:30:58 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14095196" author="daijy" created="Wed, 13 Aug 2014 07:07:51 +0100"  >&lt;p&gt;Patch committed to trunk. Thanks Cheolsoo, Rohini for review!&lt;/p&gt;</comment>
                            <comment id="14100194" author="cheolsoo" created="Mon, 18 Aug 2014 01:36:47 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;Daniel Dai&lt;/a&gt;, streaming udf is broken by your patch. I think you shouldn&apos;t add these lines-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&quot;StreamingUDF&quot;&lt;/span&gt;.equals(clazz.getSimpleName())) {
+                    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fileName : StreamingUDF.getResourcesForJar()) {
+                        jarLists.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(fileName).toURI());
+                    }
+                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is the stack trace-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.io.FileNotFoundException: File /python/streaming/controller.py does not exist
    at org.apache.hadoop.fs.RawLocalFileSystem.deprecatedGetFileStatus(RawLocalFileSystem.java:516)
    at org.apache.hadoop.fs.RawLocalFileSystem.getFileLinkStatusInternal(RawLocalFileSystem.java:729)
    at org.apache.hadoop.fs.RawLocalFileSystem.getFileStatus(RawLocalFileSystem.java:506)
    at org.apache.hadoop.fs.FilterFileSystem.getFileStatus(FilterFileSystem.java:402)
    at org.apache.hadoop.fs.FileUtil.copy(FileUtil.java:337)
    at org.apache.hadoop.fs.FileSystem.copyFromLocalFile(FileSystem.java:1951)
    at org.apache.hadoop.fs.FileSystem.copyFromLocalFile(FileSystem.java:1919)
    at org.apache.hadoop.fs.FileSystem.copyFromLocalFile(FileSystem.java:1884)
    at org.apache.pig.backend.hadoop.executionengine.tez.TezResourceManager.addTezResource(TezResourceManager.java:82)
    at org.apache.pig.backend.hadoop.executionengine.tez.TezResourceManager.addTezResources(TezResourceManager.java:105)
    at org.apache.pig.backend.hadoop.executionengine.tez.TezPlanContainer.getLocalResources(TezPlanContainer.java:108)
    at org.apache.pig.backend.hadoop.executionengine.tez.TezJobCompiler.getJob(TezJobCompiler.java:89)
    ... 21 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14100257" author="daijy" created="Mon, 18 Aug 2014 04:56:51 +0100"  >&lt;p&gt;Sorry about this. The test pass for me but that&apos;s probably because I only test on a single node cluster. Does removing those lines work for you?&lt;/p&gt;</comment>
                            <comment id="14103053" author="cheolsoo" created="Wed, 20 Aug 2014 00:46:47 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;Daniel Dai&lt;/a&gt;, yes if I remove those lines, it works for me. In fact, I think those *.py files don&apos;t need to be added to local resources since they&apos;re already packaged in the pig.jar-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
cheolsoop@lgml-cheolsoop:~/workspace/pig-svn$ jar -tvf pig-0.14.0-SNAPSHOT-core-h2.jar | grep python
 13335 Sat Aug 16 15:09:08 PDT 2014 python/streaming/controller.py
  3042 Sat Aug 16 15:09:08 PDT 2014 python/streaming/pig_util.py
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I see that MR doesn&apos;t add these files to distributed cache either.&lt;/p&gt;

&lt;p&gt;In a new patch, I made the following changes-&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Removed those lines in TezPlanContainer.java.&lt;/li&gt;
	&lt;li&gt;Removed getResourcesForJar() in StreamingUDF.java.&lt;/li&gt;
	&lt;li&gt;Changed TestStreamingUDF.java to make it run in both MR and Tez.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="14105075" author="daijy" created="Thu, 21 Aug 2014 06:45:58 +0100"  >&lt;p&gt;Yes, it is part of pig-core.jar, we don&apos;t need to ship specifically. +1.&lt;/p&gt;</comment>
                            <comment id="14105589" author="cheolsoo" created="Thu, 21 Aug 2014 17:59:59 +0100"  >&lt;p&gt;Committed &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4061&quot; title=&quot;Make Streaming UDF work in Tez&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4061&quot;&gt;&lt;del&gt;PIG-4061&lt;/del&gt;&lt;/a&gt;-3.patch in trunk. Thank you Daniel for the review!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12661310" name="PIG-4061-1.patch" size="801" author="daijy" created="Tue, 12 Aug 2014 22:37:54 +0100"/>
                            <attachment id="12661399" name="PIG-4061-2.patch" size="2554" author="daijy" created="Wed, 13 Aug 2014 06:28:27 +0100"/>
                            <attachment id="12662906" name="PIG-4061-3.patch" size="4243" author="cheolsoo" created="Wed, 20 Aug 2014 00:46:47 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 12 Aug 2014 20:37:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>406403</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzrsjj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>406423</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>