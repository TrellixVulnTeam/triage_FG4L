<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:55:14 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-4184/PIG-4184.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-4184] UDF backward compatibility issue after POStatus.STATUS_NULL refactory</title>
                <link>https://issues.apache.org/jira/browse/PIG-4184</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;This is the same issue we discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3739&quot; title=&quot;The Warning_4 e2e test is broken in trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3739&quot;&gt;&lt;del&gt;PIG-3739&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3679&quot; title=&quot;e2e StreamingPythonUDFs_10 fails in trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3679&quot;&gt;&lt;del&gt;PIG-3679&lt;/del&gt;&lt;/a&gt;. However, our previous fix does not solve the issue, in fact, it make things worse and it is totally my fault.&lt;/p&gt;

&lt;p&gt;Consider the following UDF and script:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class IntToBool &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; EvalFunc&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;&amp;gt; {
        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt; exec(Tuple input) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (input == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || input.size() == 0)
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
            &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; val = (&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;)input.get(0);
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (val == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || val == 0) ? &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a = load &apos;1.txt&apos; as (i0:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, i1:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
b = foreach a generate IntToBool(i0);
store b into &apos;output&apos;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;1.txt&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
1
2   3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;With Pig 0.12, we get:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;With Pig 0.13/0.14, we get:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
()
(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The reason is in 0.12, Pig pass first row as a tuple with a null item to IntToBool, with 0.13/0.14, Pig swallow the first row, which is not right. And this wrong behavior is brought by &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3739&quot; title=&quot;The Warning_4 e2e test is broken in trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3739&quot;&gt;&lt;del&gt;PIG-3739&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3679&quot; title=&quot;e2e StreamingPythonUDFs_10 fails in trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3679&quot;&gt;&lt;del&gt;PIG-3679&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Before that (but after POStatus.STATUS_NULL refactory &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3568&quot; title=&quot;Define the semantics of POStatus.STATUS_NULL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3568&quot;&gt;&lt;del&gt;PIG-3568&lt;/del&gt;&lt;/a&gt;), we do have a behavior change which makes e2e test StreamingPythonUDFs_10 fail with NPE. However, I think this is an inconsistent behavior of 0.12. Consider the following scripts:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a = load &apos;1.txt&apos; as (name:chararray, age:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, gpa:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;);
b = foreach a generate ROUND((gpa&amp;gt;3.0?gpa+1:gpa));
store b into &apos;output&apos;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a = load &apos;1.txt&apos; as (name:chararray, age:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, gpa:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;);
b = foreach a generate ROUND(gpa);
store b into &apos;output&apos;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If gpa field is null, script 1 skip the row and script 2 fail with NPE, which does not make sense. So my thinking is:&lt;br/&gt;
1. Pig 0.12 is wrong and POStatus.STATUS_NULL refactory fix this behavior (we don&apos;t need related fix in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3739&quot; title=&quot;The Warning_4 e2e test is broken in trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3739&quot;&gt;&lt;del&gt;PIG-3739&lt;/del&gt;&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3679&quot; title=&quot;e2e StreamingPythonUDFs_10 fails in trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3679&quot;&gt;&lt;del&gt;PIG-3679&lt;/del&gt;&lt;/a&gt;)&lt;br/&gt;
2. ROUND (and some other UDF) is wrong anyway, we shall fix it&lt;/p&gt;</description>
                <environment></environment>
        <key id="12742551">PIG-4184</key>
            <summary>UDF backward compatibility issue after POStatus.STATUS_NULL refactory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="daijy">Daniel Dai</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Sep 2014 19:48:56 +0100</created>
                <updated>Fri, 21 Nov 2014 05:59:04 +0000</updated>
                            <resolved>Fri, 17 Oct 2014 22:30:23 +0100</resolved>
                                                    <fixVersion>0.14.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14167506" author="cheolsoo" created="Fri, 10 Oct 2014 22:00:24 +0100"  >&lt;p&gt;+1.&lt;/p&gt;

&lt;p&gt;I ran into this problem while using another UDF (Datafu &lt;a href=&quot;http://datafu.incubator.apache.org/docs/datafu/1.1.0/datafu/pig/util/TransposeTupleToBag.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;TransposeTupleToBag&lt;/a&gt;). The output differs between Pig 0.12 and 0.13 when passing null tuples.&lt;/p&gt;</comment>
                            <comment id="14167531" author="rohini" created="Fri, 10 Oct 2014 22:20:51 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;Daniel Dai&lt;/a&gt;, &lt;br/&gt;
   if (input == null || input.size() == 0) is in way more UDF classes in piggybank and builtin than the classes you just changed. Wouldn&apos;t all those UDFs and user UDFs doing the same break?&lt;/p&gt;</comment>
                            <comment id="14168854" author="daijy" created="Mon, 13 Oct 2014 01:12:02 +0100"  >&lt;p&gt;Going through the piggybank and fix the null handling part. Note those UDFs do not handle null before, even without &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4184&quot; title=&quot;UDF backward compatibility issue after POStatus.STATUS_NULL refactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4184&quot;&gt;&lt;del&gt;PIG-4184&lt;/del&gt;&lt;/a&gt;-1.patch. However, before &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4184&quot; title=&quot;UDF backward compatibility issue after POStatus.STATUS_NULL refactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4184&quot;&gt;&lt;del&gt;PIG-4184&lt;/del&gt;&lt;/a&gt;-1.patch, some NPE does not manifest if we don&apos;t feed null to UDF directly.&lt;/p&gt;</comment>
                            <comment id="14175149" author="rohini" created="Fri, 17 Oct 2014 16:27:27 +0100"  >&lt;p&gt;+1 for both the patches.&lt;/p&gt;
</comment>
                            <comment id="14175571" author="daijy" created="Fri, 17 Oct 2014 22:30:23 +0100"  >&lt;p&gt;Patch committed to both trunk and 0.14 branch. Thanks Rohini, Cheolsoo!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12669775" name="PIG-4184-1.patch" size="6659" author="daijy" created="Thu, 18 Sep 2014 20:16:17 +0100"/>
                            <attachment id="12674440" name="PIG-4184-piggybank-1.patch" size="41704" author="daijy" created="Mon, 13 Oct 2014 01:12:02 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 10 Oct 2014 21:00:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzu39z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>