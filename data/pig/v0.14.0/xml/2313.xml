<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:47:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2313/PIG-2313.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2313] NPE in ILLUSTRATE trying to get StatusReporter in STORE</title>
                <link>https://issues.apache.org/jira/browse/PIG-2313</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;I&apos;m seeing an NPE trying to do an illustrate on a script.  So far the simplest version of the script that exhibits the issue is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
raw = LOAD &apos;data.txt&apos; USING PigStorage() AS (x:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, y:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
filtered = FILTER raw BY x &amp;lt; 5;
grouped = GROUP filtered BY x;
counted = FOREACH grouped
         GENERATE group AS x,
                  COUNT(filtered) AS the_count;
rmf output;
STORE counted INTO &apos;output&apos;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I had to pass a few nested Exceptions along to get it, but the bottom stack trace looks like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.NullPointerException
	at org.apache.hadoop.mapreduce.TaskInputOutputContext.getCounter(TaskInputOutputContext.java:88)
	at org.apache.pig.tools.pigstats.PigStatusReporter.getCounter(PigStatusReporter.java:60)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReducePOStoreImpl.createRecordCounter(MapReducePOStoreImpl.java:121)
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POStore.setUp(POStore.java:108)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapReduce$Reduce.cleanup(PigGenericMapReduce.java:525)
	at org.apache.hadoop.mapreduce.Reducer.run(Reducer.java:178)
	at org.apache.pig.pen.LocalMapReduceSimulator.launchPig(LocalMapReduceSimulator.java:222)
	at org.apache.pig.pen.ExampleGenerator.getData(ExampleGenerator.java:257)
	at org.apache.pig.pen.ExampleGenerator.getData(ExampleGenerator.java:275)
	at org.apache.pig.pen.LineageTrimmingVisitor.checkNewBaseData(LineageTrimmingVisitor.java:418)
	... 21 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It looks like the IllustratorContext in the hadoop20 PigMapReduce.java shim (line 73) is getting setup with a null StatusReporter.  This seems to be for the Reduce phase.  On the other hand, the PigMapBase.java sets up the IllustratorContext with an IllustratorDummyReporter for the Map phase.&lt;/p&gt;

&lt;p&gt;Eventually when the code in MapReducePOStoreImpl line 121 tries to get the reporter, it fails with the NPE.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12525555">PIG-2313</key>
            <summary>NPE in ILLUSTRATE trying to get StatusReporter in STORE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="ddaniels888">Doug Daniels</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Oct 2011 18:41:02 +0100</created>
                <updated>Thu, 26 Apr 2012 21:32:40 +0100</updated>
                            <resolved>Thu, 3 Nov 2011 00:15:59 +0000</resolved>
                                    <version>0.9.0</version>
                    <version>0.10.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                    <fixVersion>0.11</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13119528" author="ddaniels888" created="Mon, 3 Oct 2011 20:35:02 +0100"  >&lt;p&gt;I created a patch that passes an IllustratorDummyReporter into the IlustratorContext in hadoop20 PigMapReduce.Reduce.  This fixes the NPE, but yields a new Exception about being unable to setup the store function:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: org.apache.pig.impl.logicalLayer.FrontendException: ERROR 0: Exception: Unable to setup the store function.
	at org.apache.pig.pen.LineageTrimmingVisitor.checkNewBaseData(LineageTrimmingVisitor.java:420)
	at org.apache.pig.pen.LineageTrimmingVisitor.processLoad(LineageTrimmingVisitor.java:374)
	at org.apache.pig.pen.LineageTrimmingVisitor.processOperator(LineageTrimmingVisitor.java:438)
	... 19 more
Caused by: org.apache.pig.backend.executionengine.ExecException: ERROR 2081: Unable to setup the store function.
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POStore.setUp(POStore.java:111)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapReduce$Reduce.cleanup(PigGenericMapReduce.java:525)
	at org.apache.hadoop.mapreduce.Reducer.run(Reducer.java:178)
	at org.apache.pig.pen.LocalMapReduceSimulator.launchPig(LocalMapReduceSimulator.java:222)
	at org.apache.pig.pen.ExampleGenerator.getData(ExampleGenerator.java:260)
	at org.apache.pig.pen.ExampleGenerator.getData(ExampleGenerator.java:278)
	at org.apache.pig.pen.LineageTrimmingVisitor.checkNewBaseData(LineageTrimmingVisitor.java:418)
	... 21 more
Caused by: java.io.IOException: File already exists:file:/Users/ddaniels/code/sandbox/jira/output_new/_temporary/_attempt__0000_r_000000_0/part-r-00000
	at org.apache.hadoop.fs.RawLocalFileSystem.create(RawLocalFileSystem.java:228)
	at org.apache.hadoop.fs.ChecksumFileSystem$ChecksumFSOutputSummer.&amp;lt;init&amp;gt;(ChecksumFileSystem.java:335)
	at org.apache.hadoop.fs.ChecksumFileSystem.create(ChecksumFileSystem.java:368)
	at org.apache.hadoop.fs.FileSystem.create(FileSystem.java:484)
	at org.apache.hadoop.fs.FileSystem.create(FileSystem.java:465)
	at org.apache.hadoop.fs.FileSystem.create(FileSystem.java:372)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigTextOutputFormat.getRecordWriter(PigTextOutputFormat.java:98)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReducePOStoreImpl.createStoreFunc(MapReducePOStoreImpl.java:85)
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POStore.setUp(POStore.java:103)
	... 27 more
================================================================================
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Does anyone understand what would cause that?  The Exception above is from running it in local mode, but the same problem happens in MapReduce mode (I checked that the output dir does not exist too).&lt;/p&gt;

&lt;p&gt;Also, I tried to add a test in TestExampleGenerator.java in the patch, but it complains &quot;Internal error. Did not find roots in the physical plan.&quot;  Is there something special that needs to be done to get the store to appear in the plan?&lt;/p&gt;</comment>
                            <comment id="13137298" author="daijy" created="Thu, 27 Oct 2011 18:22:07 +0100"  >&lt;p&gt;Hi, Daniels,&lt;br/&gt;
Your fix for Reporter is right. We didn&apos;t pass reporter to reducer in illustrate. I attached &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2313&quot; title=&quot;NPE in ILLUSTRATE trying to get StatusReporter in STORE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2313&quot;&gt;&lt;del&gt;PIG-2313&lt;/del&gt;&lt;/a&gt;-2.patch also fix the &quot;store func setup&quot; issue. I include your test case in patch.&lt;/p&gt;</comment>
                            <comment id="13141738" author="thejas" created="Tue, 1 Nov 2011 23:12:02 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13142689" author="daijy" created="Wed, 2 Nov 2011 23:35:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2313&quot; title=&quot;NPE in ILLUSTRATE trying to get StatusReporter in STORE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2313&quot;&gt;&lt;del&gt;PIG-2313&lt;/del&gt;&lt;/a&gt;-3.patch resync with trunk.&lt;/p&gt;</comment>
                            <comment id="13142712" author="daijy" created="Thu, 3 Nov 2011 00:15:59 +0000"  >&lt;p&gt;Patch committed to both trunk and 0.10 branch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12501121" name="PIG-2313-2.patch" size="9160" author="daijy" created="Thu, 27 Oct 2011 18:22:07 +0100"/>
                            <attachment id="12502070" name="PIG-2313-3.patch" size="11221" author="daijy" created="Wed, 2 Nov 2011 23:35:27 +0000"/>
                            <attachment id="12497525" name="PIG-2313-example.tar.gz" size="2029" author="ddaniels888" created="Mon, 3 Oct 2011 20:36:09 +0100"/>
                            <attachment id="12497526" name="PIG-2313-first_shot.patch" size="5602" author="ddaniels888" created="Mon, 3 Oct 2011 20:36:09 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 27 Oct 2011 17:22:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>43834</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy3tz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56180</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>