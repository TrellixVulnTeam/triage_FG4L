<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:59:38 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2163/PIG-2163.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2163] Improve nested cross to stream one relation</title>
                <link>https://issues.apache.org/jira/browse/PIG-2163</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1916&quot; title=&quot;Nested cross&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1916&quot;&gt;&lt;del&gt;PIG-1916&lt;/del&gt;&lt;/a&gt; added nested cross support for PIG. One optimization is instead of materialize all bags before producing result, we can stream one of the input to save on memory.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12514108">PIG-2163</key>
            <summary>Improve nested cross to stream one relation</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zjshen">Zhijie Shen</assignee>
                                    <reporter username="daijy">Daniel Dai</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Jul 2011 19:46:11 +0100</created>
                <updated>Thu, 26 Apr 2012 21:32:36 +0100</updated>
                            <resolved>Sun, 4 Sep 2011 23:00:08 +0100</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13092675" author="zjshen" created="Mon, 29 Aug 2011 08:20:14 +0100"  >&lt;p&gt;Hi Daniel,&lt;/p&gt;

&lt;p&gt;If I understand your suggestion correctly, you mean that when cross over n relations, the first n-1 relations are recorded temporally in n-1 bags, and the last relation ejects the tuples iteratively (through getNext()) and crosses it with the stored bags.&lt;/p&gt;

&lt;p&gt;However, the problem is that the tuples in the last relation will not be iterated once but k1*k2*...kn-1 times, where ki is the number of tuples in i-th relation. For example, if there are three relations:&lt;/p&gt;

&lt;p&gt;bag1: &lt;/p&gt;
{(a, 1)}

&lt;p&gt;bag2: &lt;/p&gt;
{(a, x), (a, y)}
&lt;p&gt;1st     ^&lt;br/&gt;
2rd             ^&lt;/p&gt;

&lt;p&gt;bag3: &lt;/p&gt;
{(a, true), (a, false)}

&lt;p&gt;the bag3 will be iterated twice: first to cross with (a, x) and second to cross with (a, y).&lt;/p&gt;

&lt;p&gt;On the other hand, getNext() can only go through the last relation once. Hence I think the n bags inevitable. How do you think about this? Correct me if I&apos;m wrong.&lt;/p&gt;

&lt;p&gt;By the way, this issue reminds me a problem that the computation of cross product is expensive especially when the number of relations is large. I&apos;m not a database specialist. Does anybody know some smarter algorithms to reduce the rounds of scanning the relations?&lt;/p&gt;</comment>
                            <comment id="13092680" author="zjshen" created="Mon, 29 Aug 2011 08:53:58 +0100"  >&lt;p&gt;sorry, I tought this issue again, and found I was wrong. The memory for one bag is savable. &lt;/p&gt;

&lt;p&gt;Whenever a new tuple of the first relation is ejected, iterate all the combinations of the tuples in the other n-1relationship.&lt;/p&gt;</comment>
                            <comment id="13093212" author="daijy" created="Mon, 29 Aug 2011 22:13:35 +0100"  >&lt;p&gt;Yes, and usually we stream the last relation as we did in join. So assume the last relation is a large one, user can optimize to make use of it.&lt;/p&gt;</comment>
                            <comment id="13093438" author="zjshen" created="Tue, 30 Aug 2011 05:53:18 +0100"  >&lt;p&gt;Attached is the patch for this issue. Assume there are n bags as input. Now POCross only create n - 1 temporal bags.&lt;/p&gt;

&lt;p&gt;The general logic is iterating the tuple of the first bag (the left-most one in the bag list) and merging it with all the combinations with the tuples stored in the n - 1 temporal bags. Choosing the first bag to iterate separately is to keep the order of the cross product in this method the same as that with n temporal bags.&lt;/p&gt;
</comment>
                            <comment id="13093990" author="daijy" created="Tue, 30 Aug 2011 19:43:58 +0100"  >&lt;p&gt;Thanks Zhijie, patch works good. One comment, as I mentioned in my last comment, Pig usually stream the rightmost relation. We wanna that here as well, that will improves user experience, and simplify the documentation.&lt;/p&gt;</comment>
                            <comment id="13096723" author="zjshen" created="Sat, 3 Sep 2011 18:11:13 +0100"  >&lt;p&gt;Hi Daniel,&lt;/p&gt;

&lt;p&gt;I modified the patch according to your comments.&lt;/p&gt;

&lt;p&gt;Now the right-most bag will be streamed while the cross product will be generated on the fly. Additionally, to make the order of generated tuples reasonable, I reverse the iteration order of n bags (converting to n, n - 1, ..., 2, 1 order, and avoiding the strange 2, 3, ..., n - 1, n, 1 order). For example, if there are three bags from left to right:&lt;/p&gt;

&lt;p&gt;bag #1 &lt;/p&gt;
{(a, 1), (a, 2)}
&lt;p&gt;bag #2 &lt;/p&gt;
{(a, 11), (a, 22)}
&lt;p&gt;bag #3 &lt;/p&gt;
{(a, 111), (a, 222)}

&lt;p&gt;the generated bag will be:&lt;/p&gt;
{
(a, 1, a, 11, a, 111),
(a, 2, a, 11, a, 111),
(a, 1, a, 22, a, 111),
(a, 2, a, 22, a, 111),
(a, 1, a, 11, a, 222),
(a, 2, a, 11, a, 222),
(a, 1, a, 22, a, 222),
(a, 2, a, 22, a, 222)
}</comment>
                            <comment id="13096952" author="daijy" created="Sun, 4 Sep 2011 23:00:08 +0100"  >&lt;p&gt;+1 for &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2163&quot; title=&quot;Improve nested cross to stream one relation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2163&quot;&gt;&lt;del&gt;PIG-2163&lt;/del&gt;&lt;/a&gt;_1.patch, works as expected. &lt;/p&gt;

&lt;p&gt;test-patch:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; -1 overall.  &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 @author.  The patch does not contain any @author tags.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;                         Please justify why no tests are needed for this patch.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;This is an enhancement of &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1916&quot; title=&quot;Nested cross&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1916&quot;&gt;&lt;del&gt;PIG-1916&lt;/del&gt;&lt;/a&gt;. Test in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1916&quot; title=&quot;Nested cross&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1916&quot;&gt;&lt;del&gt;PIG-1916&lt;/del&gt;&lt;/a&gt; is enough to cover the patch, so no new tests is fine for this patch.&lt;/p&gt;

&lt;p&gt;All unit test pass.&lt;/p&gt;

&lt;p&gt;Patch committed to trunk. Thanks Zhijie!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12501759">PIG-1916</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12492200" name="PIG-2163.patch" size="6072" author="zjshen" created="Tue, 30 Aug 2011 05:53:18 +0100"/>
                            <attachment id="12492914" name="PIG-2163_1.patch" size="5649" author="zjshen" created="Sat, 3 Sep 2011 18:11:13 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 29 Aug 2011 07:20:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>62730</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyavx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97482</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>