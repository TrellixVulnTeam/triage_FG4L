<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:06:26 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3095/PIG-3095.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3095] &quot;which&quot; is called many, many times for each Pig STREAM statement</title>
                <link>https://issues.apache.org/jira/browse/PIG-3095</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;STREAM statements are checked by the LogicalPlanBuilder as it comes across them - and these checks include running the system utility &quot;which&quot;. However, due to the backtracking parsing mechanism &quot;which&quot; is called repeatedly with the same arguments (I noticed this while profiling a script with 4 STREAM statements - &quot;which&quot; was run over 230 times!). The attached patch just caches the return value of &quot;which&quot;, reducing the overhead of running a system process to a Map lookup.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12623663">PIG-3095</key>
            <summary>&quot;which&quot; is called many, many times for each Pig STREAM statement</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njw45">Nick White</assignee>
                                    <reporter username="njw45">Nick White</reporter>
                        <labels>
                            <label>patch</label>
                            <label>performance</label>
                    </labels>
                <created>Thu, 13 Dec 2012 04:23:43 +0000</created>
                <updated>Mon, 14 Oct 2013 17:45:52 +0100</updated>
                            <resolved>Sun, 16 Dec 2012 20:13:35 +0000</resolved>
                                    <version>0.12.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                                    <component>grunt</component>
                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13533168" author="cheolsoo" created="Sat, 15 Dec 2012 21:56:59 +0000"  >&lt;p&gt;Hello Nick,&lt;/p&gt;

&lt;p&gt;Thank you very much for the patch! I have a few comments:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The &lt;a href=&quot;http://code.google.com/p/guava-libraries/wiki/CachesExplained&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;guava doc&lt;/a&gt; says &quot;If you have defined a CacheLoader that does not declare any checked exceptions then you can perform cache lookups using getUnchecked(K)&quot;.
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; class Which &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; CacheLoader&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; {
     &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; load(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; file) {
        ...
         } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {}
         &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
     }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Since &lt;tt&gt;Which.load()&lt;/tt&gt; does not declare any checked exceptions, can&apos;t we use &lt;tt&gt;getUnchecked()&lt;/tt&gt; without the &lt;tt&gt;try/catch&lt;/tt&gt; block? In fact, I think that no exception will be ever caught by the following &lt;tt&gt;catch&lt;/tt&gt; since &lt;tt&gt;Which.load()&lt;/tt&gt; already catches any exception. Please correct me if I am wrong.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            argPath = whichCache.getUnchecked(arg);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(ExecutionException e) {
            argPath = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;With this change, &quot;&lt;tt&gt;import java.util.concurrent.ExecutionException&lt;/tt&gt;&quot; is not needed.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;Can you please remove the following statement since it&apos;s unused?
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.google.common.cache.Cache;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Can you please fix indentation in &lt;tt&gt;CacheLoader&lt;/tt&gt;? This is probably because you used &quot;&lt;tt&gt;git diff -w&lt;/tt&gt;&quot;.
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; class Which &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; CacheLoader&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; {
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; load(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; file) {
...
}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13533188" author="cheolsoo" created="Sat, 15 Dec 2012 22:37:50 +0000"  >&lt;p&gt;I also noticed that your patch breaks &lt;tt&gt;TestSctreaming&lt;/tt&gt;. Here is one example among others:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Testcase: testInputOutputSpecs took 0.022 sec
    Caused an ERROR
Error during parsing. CacheLoader returned &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; key script1259692341619822790pl.
org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1000: Error during parsing. CacheLoader returned &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; key script1259692341619822790pl.
    at org.apache.pig.PigServer$Graph.parseQuery(PigServer.java:1617)
    at org.apache.pig.PigServer$Graph.registerQuery(PigServer.java:1556)
    at org.apache.pig.PigServer.registerQuery(PigServer.java:526)
    at org.apache.pig.PigServer.registerQuery(PigServer.java:539)
    at org.apache.pig.test.TestStreaming.testInputOutputSpecs(TestStreaming.java:640)
Caused by: Failed to parse: CacheLoader returned &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; key script1259692341619822790pl.
    at org.apache.pig.parser.QueryParserDriver.parse(QueryParserDriver.java:193)
    at org.apache.pig.PigServer$Graph.parseQuery(PigServer.java:1609)
Caused by: com.google.common.cache.CacheLoader$InvalidCacheLoadException: CacheLoader returned &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; key script1259692341619822790pl.
    at com.google.common.cache.LocalCache$Segment.getAndRecordStats(LocalCache.java:2383)
    at com.google.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2351)
    at com.google.common.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2313)
    at com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2228)
    at com.google.common.cache.LocalCache.get(LocalCache.java:3967)
    at com.google.common.cache.LocalCache.getOrLoad(LocalCache.java:3971)
    at com.google.common.cache.LocalCache$LocalManualCache.get(LocalCache.java:4831)
    at org.apache.pig.parser.StreamingCommandUtils.checkAndShip(StreamingCommandUtils.java:155)
    at org.apache.pig.parser.StreamingCommandUtils.checkAutoShipSpecs(StreamingCommandUtils.java:135)
    at org.apache.pig.parser.LogicalPlanBuilder.buildCommand(LogicalPlanBuilder.java:1134)
    at org.apache.pig.parser.LogicalPlanBuilder.buildCommand(LogicalPlanBuilder.java:1087)
    at org.apache.pig.parser.LogicalPlanGenerator.cmd(LogicalPlanGenerator.java:2097)
    at org.apache.pig.parser.LogicalPlanGenerator.define_clause(LogicalPlanGenerator.java:1802)
    at org.apache.pig.parser.LogicalPlanGenerator.op_clause(LogicalPlanGenerator.java:1295)
    at org.apache.pig.parser.LogicalPlanGenerator.general_statement(LogicalPlanGenerator.java:799)
    at org.apache.pig.parser.LogicalPlanGenerator.statement(LogicalPlanGenerator.java:517)
    at org.apache.pig.parser.LogicalPlanGenerator.query(LogicalPlanGenerator.java:392)
    at org.apache.pig.parser.QueryParserDriver.parse(QueryParserDriver.java:184)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;To reproduce, please run:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ant clean test -Dtestcase=TestStreaming
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13533277" author="njw45" created="Sun, 16 Dec 2012 06:05:30 +0000"  >&lt;p&gt;Ah, sorry about that. I&apos;ve fixed the issues you mentioned (and read the guava javadoc a bit more carefully &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; in the attached &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3095&quot; title=&quot;&amp;quot;which&amp;quot; is called many, many times for each Pig STREAM statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3095&quot;&gt;&lt;del&gt;PIG-3095&lt;/del&gt;&lt;/a&gt;.1.patch, and the tests now pass. Thanks -&lt;/p&gt;</comment>
                            <comment id="13533301" author="cheolsoo" created="Sun, 16 Dec 2012 08:13:29 +0000"  >&lt;p&gt;+1.&lt;/p&gt;

&lt;p&gt;I will run e2e test to be safe and commit your patch unless I see any failure. Thank you!&lt;/p&gt;</comment>
                            <comment id="13533501" author="cheolsoo" created="Sun, 16 Dec 2012 20:13:36 +0000"  >&lt;p&gt;Committed to trunk. Thanks Nick!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12561165" name="PIG-3095.1.patch" size="3880" author="njw45" created="Sun, 16 Dec 2012 06:05:30 +0000"/>
                            <attachment id="12560714" name="PIG-3095.patch" size="2582" author="njw45" created="Thu, 13 Dec 2012 04:24:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 15 Dec 2012 21:56:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>297391</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyyixj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>235410</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>