<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:51:58 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1391/PIG-1391.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1391] pig unit tests leave behind files in temp directory because MiniCluster files don&apos;t get deleted</title>
                <link>https://issues.apache.org/jira/browse/PIG-1391</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Pig unit test runs leave behind files in temp dir (/tmp) and there are too many files in the directory over time.&lt;br/&gt;
Most of the files are left behind by MiniCluster . It closes/shutsdown MiniDFSCluster, MiniMRCluster and the FileSystem that it has created when the constructor is called, only in finalize(). And java does not guarantee that finalize() will be called. &lt;/p&gt;
</description>
                <environment></environment>
        <key id="12462831">PIG-1391</key>
            <summary>pig unit tests leave behind files in temp directory because MiniCluster files don&apos;t get deleted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thejas">Thejas M Nair</assignee>
                                    <reporter username="thejas">Thejas M Nair</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Apr 2010 01:08:21 +0100</created>
                <updated>Fri, 14 May 2010 07:47:56 +0100</updated>
                            <resolved>Fri, 14 May 2010 07:29:33 +0100</resolved>
                                    <version>0.7.0</version>
                    <version>0.8.0</version>
                                    <fixVersion>0.6.0</fixVersion>
                    <fixVersion>0.7.0</fixVersion>
                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12860080" author="thejas" created="Fri, 23 Apr 2010 01:18:30 +0100"  >&lt;p&gt;This is a path for review before I go ahead and change around 70+ test files. &lt;/p&gt;

&lt;p&gt;It adds a shutdown() function in MiniCluster, which can be called from test cases to free the resources and delete the temp files.&lt;/p&gt;

&lt;p&gt;In the patch, I have also made corresponding changes in one of the tests - TestPigContext to demonstrate the kind of changes that will be needed in other tests that use MiniCluster . The required changes are -&lt;br/&gt;
1. Add function annotated by @AfterClass which will call Minicluster.shutdown(). This will be called after all the unit test cases in the class have been run.&lt;br/&gt;
2. Annotate the class with @RunWith(JUnit4.class) so that junit4 is used . Without that it will run in junit3.x mode, which ignores @AfterClass annotation. &lt;/p&gt;</comment>
                            <comment id="12860717" author="chaitk" created="Sun, 25 Apr 2010 18:27:28 +0100"  >&lt;blockquote&gt;&lt;p&gt;2. Annotate the class with @RunWith(JUnit4.class) so that junit4 is used . Without that it will run in junit3.x mode, which ignores @AfterClass annotation.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Since ivy cache currently gets junit-4.5.jar, the tests run with junit4 mode, no?&lt;/p&gt;</comment>
                            <comment id="12860764" author="thejas" created="Sun, 25 Apr 2010 22:28:32 +0100"  >&lt;blockquote&gt;&lt;p&gt;Since ivy cache currently gets junit-4.5.jar, the tests run with junit4 mode, no?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;No. If a test class is a subclass of junit.framework.TestCase, it runs in the junit 3 compatible mode, and does not recognize the annotations such as @AfterClass . So it is necessary to annotate the class with @RunWith(JUnit4.class).&lt;/p&gt;</comment>
                            <comment id="12860793" author="chaitk" created="Mon, 26 Apr 2010 05:00:44 +0100"  >&lt;p&gt;@Thejas : Ok, I get it now. It makes sense in this case to use the annotation.&lt;br/&gt;
But there was one more thing that I observed in most of the test classes that extend junit.framework.TestCase. These classes are also using either of @BeforeClass and @Test annotations. This would mean that they are actually junit4.x compatible and need not extend junit.framework.TestCase. I&apos;m not sure if this should be discussed as another JIRA or can it be sorted out while working on this issue itself?&lt;/p&gt;</comment>
                            <comment id="12860794" author="chaitk" created="Mon, 26 Apr 2010 05:02:34 +0100"  >&lt;p&gt;@Thejas : Ok, I get it now. It makes sense in this case to use the annotation.&lt;br/&gt;
But there was one more thing that I observed in most of the test classes that extend junit.framework.TestCase. These classes are also using either of @BeforeClass and @Test annotations. This would mean that they are actually junit4.x compatible and need not extend junit.framework.TestCase. I&apos;m not sure if this should be discussed as another JIRA or can it be sorted out while working on this issue itself?&lt;/p&gt;</comment>
                            <comment id="12860967" author="thejas" created="Mon, 26 Apr 2010 16:59:47 +0100"  >&lt;blockquote&gt;&lt;p&gt;@Thejas : Ok, I get it now. It makes sense in this case to use the annotation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;But there was one more thing that I observed in most of the test classes that extend junit.framework.TestCase. These classes are also using either of @BeforeClass and @Test annotations. This would mean that they are actually junit4.x compatible and need not extend junit.framework.TestCase. I&apos;m not sure if this should be discussed as another JIRA or can it be sorted out while working on this issue itself?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, the classes that use junit4 annotations need not extend  junit.framework.TestCase. But if they don&apos;t extend  junit.framework.TestCase, more changes are required such as removing the @Override for all the functions. Adding @RunWith(JUnit4.class)  to those classes seemed to be easier. &lt;/p&gt;</comment>
                            <comment id="12861512" author="thejas" created="Tue, 27 Apr 2010 20:47:20 +0100"  >&lt;p&gt;Patch for 0.6 branch. It reduces the number of temp files being left behind from around 1767 to 135 .  It changes only contents of test/ dir. &lt;/p&gt;

&lt;p&gt;As the patch does not apply to trunk, I have manually run the unit tests and test-patch . All unit tests succeeded, pasting result of test-patch - &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; +1 overall.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 @author.  The patch does not contain any @author tags.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 tests included.  The patch appears to include 208 new or modified tests.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;</comment>
                            <comment id="12862200" author="thejas" created="Thu, 29 Apr 2010 14:49:45 +0100"  >&lt;p&gt;New patch for 0.6 branch. Made a change to build.xml - A new dir will be created within then temp dir and this dir will be used as the temp dir for tests. After the tests are done, this dir will be deleted, so that no temp files are left behind.&lt;/p&gt;</comment>
                            <comment id="12864070" author="hadoopqa" created="Wed, 5 May 2010 00:31:54 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12443607/PIG-1391.trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12443607/PIG-1391.trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 940601.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 251 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/314/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/314/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/314/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/314/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/314/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/314/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12864082" author="thejas" created="Wed, 5 May 2010 01:04:57 +0100"  >&lt;p&gt;The test case that is shown to fail in above report - TestSampleOptimizer , passes when run locally.&lt;/p&gt;</comment>
                            <comment id="12864577" author="daijy" created="Thu, 6 May 2010 00:16:14 +0100"  >&lt;p&gt;Recommend to change two things:&lt;br/&gt;
1. remove $&lt;/p&gt;
{junit.tmp.dir}
&lt;p&gt; after unit test targets in build.xml&lt;br/&gt;
2. remove fixes for zebra test case in this patch, it seems to be an irrelevant change.&lt;/p&gt;

&lt;p&gt;Other part are good. Please commit after the above two changes.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12443197" name="PIG-1391.06.2.patch" size="116025" author="thejas" created="Thu, 29 Apr 2010 14:49:45 +0100"/>
                            <attachment id="12442990" name="PIG-1391.06.patch" size="114700" author="thejas" created="Tue, 27 Apr 2010 20:47:20 +0100"/>
                            <attachment id="12443297" name="PIG-1391.07.patch" size="118544" author="thejas" created="Fri, 30 Apr 2010 17:24:28 +0100"/>
                            <attachment id="12443607" name="PIG-1391.trunk.patch" size="152251" author="thejas" created="Tue, 4 May 2010 19:07:15 +0100"/>
                            <attachment id="12442636" name="minicluster.patch" size="4195" author="thejas" created="Fri, 23 Apr 2010 01:18:29 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 25 Apr 2010 17:27:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164883</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyapx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96510</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>