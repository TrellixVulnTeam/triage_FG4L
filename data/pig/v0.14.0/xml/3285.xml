<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:02:10 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3285/PIG-3285.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3285] Jobs using HBaseStorage fail to ship dependency jars</title>
                <link>https://issues.apache.org/jira/browse/PIG-3285</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Launching a job consuming &lt;tt&gt;HBaseStorage&lt;/tt&gt; fails out of the box. The user must specify &lt;tt&gt;-Dpig.additional.jars&lt;/tt&gt; for HBase and all of its dependencies. Exceptions look something like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-04-19 18:58:39,360 FATAL org.apache.hadoop.mapred.Child: Error running child : java.lang.NoClassDefFoundError: com/google/protobuf/Message
	at org.apache.hadoop.hbase.io.HbaseObjectWritable.&amp;lt;clinit&amp;gt;(HbaseObjectWritable.java:266)
	at org.apache.hadoop.hbase.ipc.Invocation.write(Invocation.java:139)
	at org.apache.hadoop.hbase.ipc.HBaseClient$Connection.sendParam(HBaseClient.java:612)
	at org.apache.hadoop.hbase.ipc.HBaseClient.call(HBaseClient.java:975)
	at org.apache.hadoop.hbase.ipc.WritableRpcEngine$Invoker.invoke(WritableRpcEngine.java:84)
	at $Proxy7.getProtocolVersion(Unknown Source)
	at org.apache.hadoop.hbase.ipc.WritableRpcEngine.getProxy(WritableRpcEngine.java:136)
	at org.apache.hadoop.hbase.ipc.HBaseRPC.waitForProxy(HBaseRPC.java:208)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12643728">PIG-3285</key>
            <summary>Jobs using HBaseStorage fail to ship dependency jars</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ndimiduk">Nick Dimiduk</assignee>
                                    <reporter username="ndimiduk">Nick Dimiduk</reporter>
                        <labels>
                    </labels>
                <created>Sat, 20 Apr 2013 00:30:33 +0100</created>
                <updated>Mon, 7 Jul 2014 19:07:54 +0100</updated>
                            <resolved>Sun, 24 Nov 2013 23:45:03 +0000</resolved>
                                                    <fixVersion>0.13.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13637013" author="ndimiduk" created="Sat, 20 Apr 2013 00:32:59 +0100"  >&lt;p&gt;Attaching example scripts to demonstrate the issue. Repro steps look something like:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;hadoop -put 1.txt to your home directory.&lt;/li&gt;
	&lt;li&gt;Make sure HBase is running.&lt;/li&gt;
	&lt;li&gt;Execute 1.pig.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13637314" author="daijy" created="Sat, 20 Apr 2013 18:50:43 +0100"  >&lt;p&gt;The problem is we don&apos;t ship protobuf.jar, here is the code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
TableMapReduceUtil.addDependencyJars(job.getConfiguration(),
            org.apache.hadoop.hbase.client.HTable.class,
            com.google.common.collect.Lists.class,
            org.apache.zookeeper.ZooKeeper.class)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;One other issue is we don&apos;t have protobuf.jar in Pig codebase. If we add a protobuf class, Pig cannot compile. We would need to add a compilation dependency for protobuf.&lt;/p&gt;</comment>
                            <comment id="13638337" author="ndimiduk" created="Mon, 22 Apr 2013 20:11:37 +0100"  >&lt;p&gt;This patch invokes the correct incantation of &lt;tt&gt;TableMapReduceUtils#addDependencyJars&lt;/tt&gt;. Specifically, it allows HBase to add the jars to the job on Pig&apos;s behalf. Note that the HBase jars must be on the Pig classpath for job launching to succeed. This is provided via &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2786&quot; title=&quot;enhance Pig launcher script wrt. HBase/HCat integration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2786&quot;&gt;&lt;del&gt;PIG-2786&lt;/del&gt;&lt;/a&gt; and can be invoked by defining environment variables for &lt;tt&gt;HBASE_HOME&lt;/tt&gt; and &lt;tt&gt;HBASE_CONF_DIR&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="13638341" author="ndimiduk" created="Mon, 22 Apr 2013 20:13:03 +0100"  >&lt;p&gt;The reason this patch works is that protobuf et al are shipped with HBase and are available on the launch script&apos;s classpath via &lt;tt&gt;$HBASE_HOME&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="13639328" author="daijy" created="Tue, 23 Apr 2013 19:07:04 +0100"  >&lt;p&gt;TableMapReduce.addDependencyJars(job) works for HBase 0.95+. For HBase 0.94, there is a bug which does not add hbase.jar. Also a side effect for addDependencyJars(job) is it adds hadoop.jar and pig.jar into tmpjars. Both of which are already taken care of by Pig. I am not sure if we double ship those jars if we doing this. Actually I would prefer a TableMapReduce.addDependencyJars version which only adds hbase.jar/guava.jar/protobuf.jar and additional dependencies when hbase evolves (but no hadoop.jar/pig.jar)&lt;/p&gt;</comment>
                            <comment id="13639532" author="ndimiduk" created="Tue, 23 Apr 2013 21:05:47 +0100"  >&lt;p&gt;Ah, right. This bug was fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8146&quot; title=&quot;IntegrationTestBigLinkedList does not work on distributed setup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8146&quot;&gt;&lt;del&gt;HBASE-8146&lt;/del&gt;&lt;/a&gt;, which will go out with hbase-0.94.7. I&apos;ll update the patch to smooth over both versions.&lt;/p&gt;</comment>
                            <comment id="13639565" author="ndimiduk" created="Tue, 23 Apr 2013 21:15:06 +0100"  >&lt;p&gt;Updated patch smoothes over hbase-0.94 versions.&lt;/p&gt;</comment>
                            <comment id="13645712" author="ndimiduk" created="Tue, 30 Apr 2013 17:49:03 +0100"  >&lt;p&gt;bump.&lt;/p&gt;</comment>
                            <comment id="13645772" author="rohini" created="Tue, 30 Apr 2013 18:49:27 +0100"  >&lt;blockquote&gt;&lt;p&gt;I am not sure if we double ship those jars if we doing this. Actually I would prefer a TableMapReduce.addDependencyJars version which only adds hbase.jar/guava.jar/protobuf.jar and additional dependencies when hbase evolves (but no hadoop.jar/pig.jar)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Nick, Looking at the code I am sure we will end up double shipping jars which is very inefficient. It would be good to write a separate function instead of TableMapReduce.addDependencyJars(job) that filters out pig and hadoop jars (classes starting with org.apache.pig and org.apache.hadoop) and those in pigContext.extraJars from the list of classes in TableMapReduce.addDependencyJars(job) and then set them on tmpjars. You can reuse JarManager.findContainingJar to find the jar for a class file.&lt;/p&gt;</comment>
                            <comment id="13645850" author="ndimiduk" created="Tue, 30 Apr 2013 20:04:02 +0100"  >&lt;p&gt;Good point, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;Rohini Palaniswamy&lt;/a&gt;. Would it be instead relevant for Hadoop to remove duplicates in the &quot;tmpjars&quot; list?&lt;/p&gt;

&lt;p&gt;Also tangentially relevant, have a look at &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8438&quot; title=&quot;Extend bin/hbase to print a &amp;quot;mapreduce classpath&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8438&quot;&gt;&lt;del&gt;HBASE-8438&lt;/del&gt;&lt;/a&gt; for building a minimal set of classpath additions. This will minimize the number of places jars can be pulled from.&lt;/p&gt;</comment>
                            <comment id="13645934" author="rohini" created="Tue, 30 Apr 2013 21:24:36 +0100"  >&lt;p&gt;Nick,&lt;br/&gt;
 You can raise a jira in Hadoop to handle duplicates. But since we support all older versions, we can&apos;t rely on it. Also it will not help with the current problem anyways. &lt;/p&gt;

&lt;p&gt;  The problem here is that hbase code is setting some jars in tmpjars which copies the jar to hdfs to /user/&lt;span class=&quot;error&quot;&gt;&amp;#91;username&amp;#93;&lt;/span&gt;/.staging and adds that hdfs file to DistributedCache.addArchiveToClassPath when JobClient.submitJob() is done. Pig already puts the pig.jar as job.jar and it ships the other registered jar to a tmp location in hdfs (/tmp/...) and then does a DistributedCache.addFileToClassPath before submitting the job. In this case, all the three settings are different and since pig does not use tmpfiles or tmpjars and does the work by itself the hdfs path is also different. So duplicates have to be resolved at the pig level. &lt;/p&gt;</comment>
                            <comment id="13645956" author="ndimiduk" created="Tue, 30 Apr 2013 21:46:20 +0100"  >&lt;p&gt;Gross. Too many code-paths. How then to proceed? Can we consolidate on a single, approved method of shipping job dependencies?&lt;/p&gt;

&lt;p&gt;(cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; since you were interested in the related &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2055&quot; title=&quot;Hive should add HBase classpath dependencies when available&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2055&quot;&gt;&lt;del&gt;HIVE-2055&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="13646042" author="rohini" created="Tue, 30 Apr 2013 22:59:05 +0100"  >&lt;p&gt;Not too many code paths. For hbase storage, need to write a method that&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Filters out pig and hadoop classes from the list of classes so that pig and hadoop jar are not included.&lt;/li&gt;
	&lt;li&gt;Find the jars for the other classes and filter out any jars already present in PigContext.extrajars and add only the rest to tmpjars.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  Also ensure that you add HTable.class apart from Zookeeper, inputformat, input/output key/value, partitioner and combiner classes. &lt;/p&gt;</comment>
                            <comment id="13646289" author="ndimiduk" created="Wed, 1 May 2013 02:44:57 +0100"  >&lt;blockquote&gt;&lt;p&gt;Not too many code paths.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure there are. Both Pig and HBase are replicating the behavior of &lt;tt&gt;ToolRunner&lt;/tt&gt;&apos;s libjars argument for including jars with a job. They do so in slightly different ways, but thus we have 3 different code-paths. I&apos;d prefer consolidation on a single code-path.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Filters out pig and hadoop classes from the list of classes so that pig and hadoop jar are not included.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We can add a method, something like &lt;tt&gt;addHBaseDependencyJars(Job)&lt;/tt&gt; which will add only HBase and it&apos;s dependency jars (currently: zookeeper, protobuf, guava), nothing else. That way, we&apos;re not including any redundant Pig or Hadoop jars and HBase is managing it&apos;s own dependencies (meaning Pig won&apos;t have to change every time we change something). This is effectively the same doing what you say above, &quot;Also ensure that you add HTable.class apart from Zookeeper, inputformat, input/output key/value, partitioner and combiner classes,&quot; that is, omitting inputformat, keys, values, partitioner, combiner. Does that sound like it&apos;ll accomplish what this filter intends?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Find the jars for the other classes and filter out any jars already present in PigContext.extrajars and add only the rest to tmpjars.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;How do we access the PigContext? Is it in the jobConf or some such? I&apos;d rather not put Pig-specific code in the bowels of HBase mapreduce code; my preference is to build generic APIs that can be used across the board.&lt;/p&gt;

&lt;p&gt;HBase APIs are designed to assist people writing raw MR jobs against HBase (ie, including key/value classes, input/output format classes, &amp;amp;c). The slightly different requirements of Pig and Hive need to be addressed as well.&lt;/p&gt;</comment>
                            <comment id="13646715" author="rohini" created="Wed, 1 May 2013 18:10:03 +0100"  >&lt;p&gt;Actually I got a little confused with the patch as TableMapReduce.addDependencyJars(job) was adding all those and focused just on Daniel&apos;s comment. If your intention is to only add protobuf jar, you can do a Class.forName(some protobuf class name) and if that does not throw a CNFE (meaning older hbase versions) you can pass that class also to the TableMapreduceUtil.addDependencyJars(Configuration conf, Class... classes)&lt;/p&gt;</comment>
                            <comment id="13646998" author="daijy" created="Wed, 1 May 2013 23:11:20 +0100"  >&lt;p&gt;Agree with Rohini, that should be a simple fix to add protobuf.jar. We don&apos;t need to double ship jars and make things complicated.&lt;/p&gt;</comment>
                            <comment id="13649875" author="ndimiduk" created="Mon, 6 May 2013 18:07:28 +0100"  >&lt;p&gt;I don&apos;t want this to become a game of dependency tracking across projects. That said, HBase doesn&apos;t add dependencies all that often, so maybe it doesn&apos;t matter in practice.&lt;/p&gt;</comment>
                            <comment id="13649958" author="daijy" created="Mon, 6 May 2013 19:32:08 +0100"  >&lt;p&gt;If HBase adding another method only adding hbase.jar/guava.jar/protobuf.jar etc(but not inputformat/outputformat jar), Pig can switch to use that. But for now, TableMapReduce.addDependencyJars(job) is not what we want.&lt;/p&gt;</comment>
                            <comment id="13673668" author="rohini" created="Mon, 3 Jun 2013 23:09:51 +0100"  >&lt;p&gt;Canceling patch for now so that it does not show in Patch Available list. &lt;/p&gt;</comment>
                            <comment id="13734258" author="ndimiduk" created="Fri, 9 Aug 2013 01:38:24 +0100"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;Daniel Dai&lt;/a&gt;. Have a look at the patch on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9165&quot; title=&quot;Improvements to addDependencyJars&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9165&quot;&gt;&lt;del&gt;HBASE-9165&lt;/del&gt;&lt;/a&gt;. It include a new method for this use-case: TableMapReduceUtil#addHBaseDependencyJars(Configuration).&lt;/p&gt;</comment>
                            <comment id="13754182" author="daijy" created="Fri, 30 Aug 2013 00:13:53 +0100"  >&lt;p&gt;That sounds good. We can switch to it for newer version of hbase once &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9165&quot; title=&quot;Improvements to addDependencyJars&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9165&quot;&gt;&lt;del&gt;HBASE-9165&lt;/del&gt;&lt;/a&gt; committed. &lt;/p&gt;</comment>
                            <comment id="13754251" author="ndimiduk" created="Fri, 30 Aug 2013 01:36:31 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;Daniel Dai&lt;/a&gt; would you mind commenting positively on the HBase ticket as well? Thanks.&lt;/p&gt;</comment>
                            <comment id="13823910" author="ndimiduk" created="Fri, 15 Nov 2013 18:29:59 +0000"  >&lt;p&gt;FYI &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9165&quot; title=&quot;Improvements to addDependencyJars&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9165&quot;&gt;&lt;del&gt;HBASE-9165&lt;/del&gt;&lt;/a&gt; is committed to 0.96 and trunk. It will be available with HBase 0.96.1. I hope to also backport it to 0.94, available on 0.94.14 and later. The new method is &lt;a href=&quot;https://github.com/apache/hbase/commit/8d844e61a55c93bf23cf9427e02f9814b66d68a8#diff-7d445ba2b99d6f251da23153a1cc82f4R560&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;TableMapReduceUtil#addHBaseDependencyJars(Configuration)&lt;/a&gt;. I&apos;m now using it in a new hbase bin script command &lt;tt&gt;mapredcp&lt;/tt&gt;, as of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8438&quot; title=&quot;Extend bin/hbase to print a &amp;quot;mapreduce classpath&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8438&quot;&gt;&lt;del&gt;HBASE-8438&lt;/del&gt;&lt;/a&gt;. Its output is as follows:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ ./bin/hbase mapredcp | tr &apos;:&apos; &apos;\n&apos;
/private/tmp/hbase-0.97.0-SNAPSHOT/lib/netty-3.6.6.Final.jar
/private/tmp/hbase-0.97.0-SNAPSHOT/lib/hbase-hadoop-compat-0.97.0-SNAPSHOT.jar
/private/tmp/hbase-0.97.0-SNAPSHOT/lib/protobuf-java-2.5.0.jar
/private/tmp/hbase-0.97.0-SNAPSHOT/lib/guava-12.0.1.jar
/private/tmp/hbase-0.97.0-SNAPSHOT/lib/htrace-core-2.01.jar
/private/tmp/hbase-0.97.0-SNAPSHOT/lib/hbase-protocol-0.97.0-SNAPSHOT.jar
/private/tmp/hbase-0.97.0-SNAPSHOT/lib/hbase-client-0.97.0-SNAPSHOT.jar
/private/tmp/hbase-0.97.0-SNAPSHOT/lib/zookeeper-3.4.5.jar
/private/tmp/hbase-0.97.0-SNAPSHOT/lib/hbase-server-0.97.0-SNAPSHOT.jar
/private/tmp/hbase-0.97.0-SNAPSHOT/lib/hbase-common-0.97.0-SNAPSHOT.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13824071" author="hudson" created="Fri, 15 Nov 2013 20:45:04 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #838 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/838/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/838/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9165&quot; title=&quot;Improvements to addDependencyJars&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9165&quot;&gt;&lt;del&gt;HBASE-9165&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;mapreduce&amp;#93;&lt;/span&gt; Modularize building dependency jars&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Separate adding HBase and dependencies from adding other job&lt;br/&gt;
   dependencies, and expose it as a separate method that other&lt;br/&gt;
   projects can use (for &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3285&quot; title=&quot;Jobs using HBaseStorage fail to ship dependency jars&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3285&quot;&gt;&lt;del&gt;PIG-3285&lt;/del&gt;&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;Explicitly add hbase-server to the list of dependencies we ship&lt;br/&gt;
   with the job, for users who extend the classes we provide (see&lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9112&quot; title=&quot;Custom TableInputFormat in initTableMapperJob throws ClassNoFoundException on TableMapper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9112&quot;&gt;&lt;del&gt;HBASE-9112&lt;/del&gt;&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;Add integration test for addDependencyJars.&lt;/li&gt;
	&lt;li&gt;Code reuse for TestTableMapReduce. (ndimiduk: rev 1542341)&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-it/src/test/java/org/apache/hadoop/hbase/mapreduce/IntegrationTestTableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/IdentityTableMapper.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/mapred/TestTableMapReduce.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestTableMapReduce.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestTableMapReduceBase.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestTableMapReduceUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13824159" author="ndimiduk" created="Fri, 15 Nov 2013 22:08:51 +0000"  >&lt;p&gt;Backport to HBase 0.94.14 is complete.&lt;/p&gt;</comment>
                            <comment id="13824168" author="ndimiduk" created="Fri, 15 Nov 2013 22:17:37 +0000"  >&lt;p&gt;Here&apos;s an updated patch. It would be nice to test and confirm end-to-end. Testing in my local checkout results in an NPE; I assume I&apos;m doing something wrong.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ ant clean &amp;amp;&amp;amp; ant &amp;amp;&amp;amp; ant -Dtestcase=TestHBaseStorage test
...
Testcase: org.apache.pig.test.TestHBaseStorage took 0 sec
        Caused an ERROR
null not an instance of org.apache.hadoop.hbase.MiniHBaseCluster
java.lang.RuntimeException: null not an instance of org.apache.hadoop.hbase.MiniHBaseCluster
        at org.apache.hadoop.hbase.HBaseTestingUtility.getMiniHBaseCluster(HBaseTestingUtility.java:701)
        at org.apache.hadoop.hbase.HBaseTestingUtility.getHBaseCluster(HBaseTestingUtility.java:1591)
        at org.apache.pig.test.TestHBaseStorage.oneTimeTearDown(TestHBaseStorage.java:92)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13824186" author="jarcec" created="Fri, 15 Nov 2013 22:31:46 +0000"  >&lt;p&gt;I really do like idea behind this patch, thank you for driving the effort on both sides  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt;! Do you think that we can leave the older code laying around for couple of Pig releases and switch between those two conditionally based on the HBase version? I&apos;m concerned a bit about backward compatibility here as this patch will make pig not working on a HBase releases where it is currently working.&lt;/p&gt;</comment>
                            <comment id="13824195" author="ndimiduk" created="Fri, 15 Nov 2013 22:38:45 +0000"  >&lt;p&gt;More compatibility is better. I think that can be done with a little reflection magic. That logic will be pretty hairy as it spans at least 4 HBase releases. I&apos;m not familiar with Pig internals so I&apos;ll leave a more sophisticated patch up to a maintainer (unless someone can illustrate how I can test my patches).&lt;/p&gt;</comment>
                            <comment id="13824211" author="jarcec" created="Fri, 15 Nov 2013 22:55:55 +0000"  >&lt;p&gt;Yeah I agree, more compatibility is definitely better. Considering that the class &lt;tt&gt;TableMapReduceUtil&lt;/tt&gt; have &quot;always&quot; been there, it might become fairly straightforward. Do you think that following snippet might work?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Method m = TableMapReduceUtil.class.getMethod(&lt;span class=&quot;code-quote&quot;&gt;&quot;addHBaseDependencyJars&quot;&lt;/span&gt;, Configuration.class);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(m != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
  m.invoke(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, job.getConfiguration());
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
  &lt;span class=&quot;code-comment&quot;&gt;// Old code
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And then the basic sanity testing would be with changing the HBase version on the command line, for example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ant clean test -Dtestcase=TestHBaseStorage -Dhbase.version=0.94.1
ant clean test -Dtestcase=TestHBaseStorage -Dhbase.version=0.94.14
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13824214" author="ndimiduk" created="Fri, 15 Nov 2013 23:02:56 +0000"  >&lt;p&gt;I suspect that would work, but I&apos;ve been bitten enough by the nuances of indirect dependency resolution at runtime that I&apos;ll withhold judgement until running a job on a real cluster &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;You&apos;ll also need to add permutations for 0.96.0 and 0.96.1. At least with this single API, we should be able to iterate on our side without repercussions for Pig.&lt;/p&gt;</comment>
                            <comment id="13824375" author="hudson" created="Sat, 16 Nov 2013 04:05:42 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #4681 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/4681/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/4681/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9165&quot; title=&quot;Improvements to addDependencyJars&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9165&quot;&gt;&lt;del&gt;HBASE-9165&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;mapreduce&amp;#93;&lt;/span&gt; Modularize building dependency jars&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Separate adding HBase and dependencies from adding other job&lt;br/&gt;
   dependencies, and expose it as a separate method that other&lt;br/&gt;
   projects can use (for &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3285&quot; title=&quot;Jobs using HBaseStorage fail to ship dependency jars&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3285&quot;&gt;&lt;del&gt;PIG-3285&lt;/del&gt;&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;Explicitly add hbase-server to the list of dependencies we ship&lt;br/&gt;
   with the job, for users who extend the classes we provide (see&lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9112&quot; title=&quot;Custom TableInputFormat in initTableMapperJob throws ClassNoFoundException on TableMapper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9112&quot;&gt;&lt;del&gt;HBASE-9112&lt;/del&gt;&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;Add integration test for addDependencyJars.&lt;/li&gt;
	&lt;li&gt;Code reuse for TestTableMapReduce. (ndimiduk: rev 1542341)&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-it/src/test/java/org/apache/hadoop/hbase/mapreduce/IntegrationTestTableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/IdentityTableMapper.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/mapred/TestTableMapReduce.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestTableMapReduce.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestTableMapReduceBase.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestTableMapReduceUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13824507" author="hudson" created="Sat, 16 Nov 2013 15:49:20 +0000"  >&lt;p&gt;FAILURE: Integrated in hbase-0.96 #190 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96/190/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96/190/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9165&quot; title=&quot;Improvements to addDependencyJars&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9165&quot;&gt;&lt;del&gt;HBASE-9165&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;mapreduce&amp;#93;&lt;/span&gt; Modularize building dependency jars&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Separate adding HBase and dependencies from adding other job&lt;br/&gt;
   dependencies, and expose it as a separate method that other&lt;br/&gt;
   projects can use (for &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3285&quot; title=&quot;Jobs using HBaseStorage fail to ship dependency jars&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3285&quot;&gt;&lt;del&gt;PIG-3285&lt;/del&gt;&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;Explicitly add hbase-server to the list of dependencies we ship&lt;br/&gt;
   with the job, for users who extend the classes we provide (see&lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9112&quot; title=&quot;Custom TableInputFormat in initTableMapperJob throws ClassNoFoundException on TableMapper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9112&quot;&gt;&lt;del&gt;HBASE-9112&lt;/del&gt;&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;Add integration test for addDependencyJars.&lt;/li&gt;
	&lt;li&gt;Code reuse for TestTableMapReduce.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Note this patch differs from the one applied to TRUNK/0.98 in that it omits&lt;br/&gt;
changes to TestTableMapReduceUtil which have not yet been backported from&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8534&quot; title=&quot;Fix coverage for org.apache.hadoop.hbase.mapreduce&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8534&quot;&gt;&lt;del&gt;HBASE-8534&lt;/del&gt;&lt;/a&gt;. This can be addressed when that patch is backported (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9484&quot; title=&quot;Backport 8534 &amp;quot;Fix coverage for org.apache.hadoop.hbase.mapreduce&amp;quot; to 0.96&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9484&quot;&gt;&lt;del&gt;HBASE-9484&lt;/del&gt;&lt;/a&gt;). (ndimiduk: rev 1542342)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-it/src/test/java/org/apache/hadoop/hbase/mapreduce/IntegrationTestTableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/IdentityTableMapper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/mapred/TestTableMapReduce.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestTableMapReduce.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestTableMapReduceBase.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13824552" author="hudson" created="Sat, 16 Nov 2013 18:21:28 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94 #1203 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/1203/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/1203/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9165&quot; title=&quot;Improvements to addDependencyJars&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9165&quot;&gt;&lt;del&gt;HBASE-9165&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;mapreduce&amp;#93;&lt;/span&gt; Modularize building dependency jars&lt;/p&gt;

&lt;p&gt;Separate adding HBase and dependencies from adding other job dependencies, and&lt;br/&gt;
expose it as a separate method that other projects can use (for &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3285&quot; title=&quot;Jobs using HBaseStorage fail to ship dependency jars&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3285&quot;&gt;&lt;del&gt;PIG-3285&lt;/del&gt;&lt;/a&gt;,&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2055&quot; title=&quot;Hive should add HBase classpath dependencies when available&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2055&quot;&gt;&lt;del&gt;HIVE-2055&lt;/del&gt;&lt;/a&gt;). (ndimiduk: rev 1542414)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/mapreduce/TestTableMapReduce.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13824580" author="hudson" created="Sat, 16 Nov 2013 19:08:44 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.94-security #337 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/337/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/337/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9165&quot; title=&quot;Improvements to addDependencyJars&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9165&quot;&gt;&lt;del&gt;HBASE-9165&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;mapreduce&amp;#93;&lt;/span&gt; Modularize building dependency jars&lt;/p&gt;

&lt;p&gt;Separate adding HBase and dependencies from adding other job dependencies, and&lt;br/&gt;
expose it as a separate method that other projects can use (for &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3285&quot; title=&quot;Jobs using HBaseStorage fail to ship dependency jars&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3285&quot;&gt;&lt;del&gt;PIG-3285&lt;/del&gt;&lt;/a&gt;,&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2055&quot; title=&quot;Hive should add HBase classpath dependencies when available&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2055&quot;&gt;&lt;del&gt;HIVE-2055&lt;/del&gt;&lt;/a&gt;). (ndimiduk: rev 1542414)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/mapreduce/TestTableMapReduce.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13824599" author="hudson" created="Sat, 16 Nov 2013 19:57:07 +0000"  >&lt;p&gt;FAILURE: Integrated in hbase-0.96-hadoop2 #120 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96-hadoop2/120/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96-hadoop2/120/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9165&quot; title=&quot;Improvements to addDependencyJars&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9165&quot;&gt;&lt;del&gt;HBASE-9165&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;mapreduce&amp;#93;&lt;/span&gt; Modularize building dependency jars&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Separate adding HBase and dependencies from adding other job&lt;br/&gt;
   dependencies, and expose it as a separate method that other&lt;br/&gt;
   projects can use (for &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3285&quot; title=&quot;Jobs using HBaseStorage fail to ship dependency jars&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3285&quot;&gt;&lt;del&gt;PIG-3285&lt;/del&gt;&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;Explicitly add hbase-server to the list of dependencies we ship&lt;br/&gt;
   with the job, for users who extend the classes we provide (see&lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9112&quot; title=&quot;Custom TableInputFormat in initTableMapperJob throws ClassNoFoundException on TableMapper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9112&quot;&gt;&lt;del&gt;HBASE-9112&lt;/del&gt;&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;Add integration test for addDependencyJars.&lt;/li&gt;
	&lt;li&gt;Code reuse for TestTableMapReduce.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Note this patch differs from the one applied to TRUNK/0.98 in that it omits&lt;br/&gt;
changes to TestTableMapReduceUtil which have not yet been backported from&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8534&quot; title=&quot;Fix coverage for org.apache.hadoop.hbase.mapreduce&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8534&quot;&gt;&lt;del&gt;HBASE-8534&lt;/del&gt;&lt;/a&gt;. This can be addressed when that patch is backported (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9484&quot; title=&quot;Backport 8534 &amp;quot;Fix coverage for org.apache.hadoop.hbase.mapreduce&amp;quot; to 0.96&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9484&quot;&gt;&lt;del&gt;HBASE-9484&lt;/del&gt;&lt;/a&gt;). (ndimiduk: rev 1542342)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-it/src/test/java/org/apache/hadoop/hbase/mapreduce/IntegrationTestTableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/mapred/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/IdentityTableMapper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/TableMapReduceUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/mapred/TestTableMapReduce.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestTableMapReduce.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestTableMapReduceBase.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13825029" author="jarcec" created="Mon, 18 Nov 2013 01:43:27 +0000"  >&lt;p&gt;Yeah, I hear your concern &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt;. Nevertheless I&apos;ll be more than happy to work with you to ensure that all the required combinations will work. I have to say though that I&apos;m not a Pig committer and thus we will need someone else to do the commit.&lt;/p&gt;</comment>
                            <comment id="13825596" author="cheolsoo" created="Mon, 18 Nov 2013 18:41:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jarcec&quot; class=&quot;user-hover&quot; rel=&quot;jarcec&quot;&gt;Jarek Jarcec Cecho&lt;/a&gt;, please upload a new patch that includes what you suggest. Committing it is not a problem at all.&lt;/p&gt;</comment>
                            <comment id="13825844" author="jarcec" created="Mon, 18 Nov 2013 22:14:42 +0000"  >&lt;p&gt;Thank you for your support &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt; Do you feel comfortable with making the suggested changes to the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt; or do you want me to jump in and do them?&lt;/p&gt;</comment>
                            <comment id="13825928" author="ndimiduk" created="Mon, 18 Nov 2013 23:15:15 +0000"  >&lt;p&gt;Here&apos;s an updated patch that does as you suggest.&lt;/p&gt;</comment>
                            <comment id="13826981" author="jarcec" created="Tue, 19 Nov 2013 21:52:05 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt;! Couple of high level notes:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-      TableMapReduceUtil.addDependencyJars(job.getConfiguration(), klass);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems that we&apos;ve accidentally removed the call &lt;tt&gt;TableMapReduceUtil.addDependencyJars()&lt;/tt&gt;  from method &lt;tt&gt;addClassToJobIfExists()&lt;/tt&gt;. As a result not all required jars are propagated to the &lt;tt&gt;DistributedCache&lt;/tt&gt;  when running on HBase 0.95+.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+            &lt;span class=&quot;code-comment&quot;&gt;// method doesn&apos;t exist or invocation failed. moving on.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can we at least do a debug log message stating that &lt;tt&gt;TableMapReduceUtil.addHBaseDependencyJars&lt;/tt&gt; is not available and thus we will revert to our own logic for propagating jars? It think that it will help to know what logic we used for propagating jars while investigating failing pig scripts.&lt;/p&gt;</comment>
                            <comment id="13827013" author="ndimiduk" created="Tue, 19 Nov 2013 22:23:41 +0000"  >&lt;p&gt;Thanks for the review, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jarcec&quot; class=&quot;user-hover&quot; rel=&quot;jarcec&quot;&gt;Jarek Jarcec Cecho&lt;/a&gt;. Good catch on the unintended change to addClassToJobIfExists.&lt;/p&gt;

&lt;p&gt;Attaching an updated patch addressing both comments.&lt;/p&gt;</comment>
                            <comment id="13827083" author="jarcec" created="Tue, 19 Nov 2013 23:23:19 +0000"  >&lt;p&gt;Thank you for the quick turnaround &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;I was able to run &lt;tt&gt;TestHBaseStorage&lt;/tt&gt; unit tests for all the combinations using following commands:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# Old path:
ant clean test -Dhbaseversion=94 -Dtestcase=TestHBaseStorage
ant clean test -Dhbaseversion=95 -Dtestcase=TestHBaseStorage  -Dprotobuf-java.version=2.5.0

# New path:

# Compile HBase 0.94 branch and install it to local maven cache (mvn clean install -DskipTests)
ant clean test -Dhbaseversion=94 -Dtestcase=TestHBaseStorage -Dhbase94.version=0.94.14
# Compile HBase 0.96 branch and install it to local maven cache (mvn clean install -DskipTests)
ant clean test -Dhbaseversion=95 -Dtestcase=TestHBaseStorage  -Dprotobuf-java.version=2.5.0 -Dhbase95.version=0.96.1-SNAPSHOT
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The only problem that I&apos;ve encounter so far is the exception &lt;tt&gt;ReflectiveOperationException&lt;/tt&gt; (&lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/lang/ReflectiveOperationException.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;javadoc&lt;/a&gt;) that has been added in JDK7, while Pig still requires JDK6 compatibility. I&apos;ve substituted the exception with &lt;tt&gt;Exception&lt;/tt&gt;  for the purpose of above tests.&lt;/p&gt;

&lt;p&gt;I&apos;ll try to give it a spin on a real clusters to see if everything will work as expected.&lt;/p&gt;</comment>
                            <comment id="13827206" author="ndimiduk" created="Wed, 20 Nov 2013 01:12:51 +0000"  >&lt;p&gt;Excellent. I didn&apos;t realize ReflectiveOperationException was introduced in JDK7, nice catch. Thanks for taking this the last mile!&lt;/p&gt;</comment>
                            <comment id="13828234" author="jarcec" created="Wed, 20 Nov 2013 22:47:25 +0000"  >&lt;p&gt;I&apos;ve tested the change on a real clusters running HBase 0.94 with and without the &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9165&quot; title=&quot;Improvements to addDependencyJars&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9165&quot;&gt;&lt;del&gt;HBASE-9165&lt;/del&gt;&lt;/a&gt; and everything seems to be working just fine. It would be great to also test 0.96 with and without the change, but I do not feel that it&apos;s entirely necessary. I&apos;m +1 on the patch, provided that we will remove the JDK7 only class &lt;tt&gt;ReflectiveOperationException&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="13828260" author="ndimiduk" created="Wed, 20 Nov 2013 23:05:47 +0000"  >&lt;p&gt;Updating patch to not use ReflectiveOperationException.&lt;/p&gt;

&lt;p&gt;Thanks for testing! Would you mind taking it for a spin with hbase-0.94.14RC1? It was just posted and includes all necessary patches required to test the new logic.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://people.apache.org/~larsh/hbase-0.94.14-rc1/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~larsh/hbase-0.94.14-rc1/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13830715" author="jarcec" created="Sat, 23 Nov 2013 17:44:45 +0000"  >&lt;p&gt;My apologies for the delay &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt;. I&apos;ve tried the latest patch against linked HBase RC and everything seems to be working.&lt;/p&gt;

&lt;p&gt;+1 (non-binding)&lt;/p&gt;

&lt;p&gt;Feel free to take a look &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="13831106" author="cheolsoo" created="Sun, 24 Nov 2013 23:35:34 +0000"  >&lt;p&gt;+1. I ran TestHBaseStorage myself, and I trust Jarcec&apos;s test.&lt;/p&gt;</comment>
                            <comment id="13831110" author="cheolsoo" created="Sun, 24 Nov 2013 23:45:03 +0000"  >&lt;p&gt;Committed to trunk. Thank you Nick and Jarcec!&lt;/p&gt;</comment>
                            <comment id="13831611" author="jarcec" created="Mon, 25 Nov 2013 16:36:50 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12643727">HBASE-8386</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12597254">PIG-2786</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12615020" name="0001-PIG-3285-Add-HBase-dependency-jars.patch" size="5231" author="ndimiduk" created="Wed, 20 Nov 2013 23:05:47 +0000"/>
                            <attachment id="12614703" name="0001-PIG-3285-Add-HBase-dependency-jars.patch" size="4560" author="ndimiduk" created="Tue, 19 Nov 2013 22:23:41 +0000"/>
                            <attachment id="12614508" name="0001-PIG-3285-Add-HBase-dependency-jars.patch" size="5062" author="ndimiduk" created="Mon, 18 Nov 2013 23:15:15 +0000"/>
                            <attachment id="12614148" name="0001-PIG-3285-Add-HBase-dependency-jars.patch" size="4288" author="ndimiduk" created="Fri, 15 Nov 2013 22:17:37 +0000"/>
                            <attachment id="12580121" name="0001-PIG-3285-Add-HBase-dependency-jars.patch" size="1909" author="ndimiduk" created="Tue, 23 Apr 2013 21:15:06 +0100"/>
                            <attachment id="12579883" name="0001-PIG-3285-Add-HBase-dependency-jars.patch" size="1686" author="ndimiduk" created="Mon, 22 Apr 2013 20:11:37 +0100"/>
                            <attachment id="12579634" name="1.pig" size="145" author="ndimiduk" created="Sat, 20 Apr 2013 00:32:59 +0100"/>
                            <attachment id="12579635" name="1.txt" size="8" author="ndimiduk" created="Sat, 20 Apr 2013 00:32:59 +0100"/>
                            <attachment id="12579636" name="2.pig" size="99" author="ndimiduk" created="Sat, 20 Apr 2013 00:32:59 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 20 Apr 2013 17:50:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>324095</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzdrlj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>324440</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>