<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:50:29 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-544/PIG-544.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-544] Utf8StorageConverter.java does not always produce NULLs when data is malformed</title>
                <link>https://issues.apache.org/jira/browse/PIG-544</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;It does so for scalar types but not for complext types and not for the fields inside of the complext types.&lt;/p&gt;

&lt;p&gt;This is because it uses different code to parse scalar types by themselves and scalar types inside of a complex type. It should really use the same (its own code to do so.)&lt;/p&gt;

&lt;p&gt;The code it is currently uses, is inside of TextDataParser.jjt and is also used to parse constants so we need to be careful if we want to make changes to it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12409228">PIG-544</key>
            <summary>Utf8StorageConverter.java does not always produce NULLs when data is malformed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thejas">Thejas M Nair</assignee>
                                    <reporter username="olgan">Olga Natkovich</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Nov 2008 23:53:54 +0000</created>
                <updated>Wed, 24 Mar 2010 22:04:14 +0000</updated>
                            <resolved>Fri, 6 Mar 2009 22:53:57 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12650810" author="sms" created="Wed, 26 Nov 2008 00:09:15 +0000"  >&lt;p&gt;Another use case where scalars also generate errors:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

grunt&amp;gt; a = load &apos;student_tab.data&apos;;
grunt&amp;gt; store a into &apos;student_tab.bin&apos; using BinStorage();
grunt&amp;gt; a = load &apos;student_tab.bin&apos; using BinStorage() as (name: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, age: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, gpa: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;);
grunt&amp;gt; dump a;

2008-11-25 16:02:40,986 [main] ERROR org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.Launcher - Error message from task (map) task_200809241441_24635_m_000000java.lang.RuntimeException : Unexpected data type 74 found in stream.
         at org.apache.pig.data.DataReaderWriter.readDatum(DataReaderWriter.java:115)
         at org.apache.pig.builtin.BinStorage.bytesToInteger(BinStorage.java:169)
         at org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.POCast.getNext(POCast.java:143) 
....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12675514" author="thejas" created="Fri, 20 Feb 2009 23:58:57 +0000"  >&lt;p&gt;Handles long/float values with l/L/f/F at the end in Utf8StorageConverter.java bytesToLong, bytesToFloat .&lt;br/&gt;
Added unit tests to TestConversions.java .&lt;/p&gt;</comment>
                            <comment id="12675991" author="thejas" created="Mon, 23 Feb 2009 18:02:54 +0000"  >&lt;p&gt;Deleting the patch attached that actually belonged to different JIRA.&lt;/p&gt;</comment>
                            <comment id="12678500" author="thejas" created="Tue, 3 Mar 2009 23:05:26 +0000"  >&lt;p&gt;Patch.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;DataReaderWriter bytestoX logic for complex datatypes  re-factored into separate functions in same class and used by BinStorage.&lt;/li&gt;
	&lt;li&gt;Utf8StorageConverter logs warning and returns null if type conversions fail.&lt;/li&gt;
	&lt;li&gt;Moved logging utility functions from org.apache.pig.tools.grunt.Utils to org.apache.pig.impl.util.LogUtils. Updated files that used grunt.Utils .&lt;/li&gt;
	&lt;li&gt;Added unit test cases for type conversion failures in TestEvalPipeline2 .&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12678990" author="sms" created="Wed, 4 Mar 2009 23:33:19 +0000"  >&lt;p&gt;Review comments:&lt;/p&gt;

&lt;p&gt;Index: test/org/apache/pig/test/TestEvalPipeline2.java&lt;br/&gt;
=======================================================&lt;/p&gt;

&lt;p&gt;1. Its not clear how the constant 1634952294 is arrived at. A comment alluding to this fact will help. The same comment applies to other constants that are used in this test case.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    @Test
+    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testBinStorageByteArrayCastsSimple() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
+        assertTrue( (&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;)tup.get(0) == 1634952294);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Index: src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/expressionOperators/POProject.java&lt;br/&gt;
========================================================================================&lt;/p&gt;

&lt;p&gt;1. Do we need mLog? POProject extends ExpressionOperator which in turn extends PhysicalOperator. PhysicalOperator has a private member variable called log. Its better to use log instead of creating another member variable.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Log mLog = LogFactory.getLog(getClass());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2. I am not sure if processInputBag calls parseFromBytes(). Can you clarify?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        Result res;
+        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;{
+            res = processInputBag();
+        }
+        &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e){
+            Result r = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Result();
+            r.returnStatus = POStatus.STATUS_OK;
+            &lt;span class=&quot;code-comment&quot;&gt;// can happen &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; parseFromBytes identifies it as being of different type&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Index: src/org/apache/pig/builtin/BinStorage.java&lt;br/&gt;
===================================================================&lt;/p&gt;

&lt;p&gt;1. Can we make the log private static ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Log mLog = LogFactory.getLog(getClass());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2. Minor comment. Use bytearray instead of byres array to be consistent with the bytearray type. Also, be consistent with use of upper case for types, I see bag and then Long, Map, etc.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+            LogUtils.warn(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to convert bytes array to bag, &quot;&lt;/span&gt; +
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3. In bytesToTuple, the message should be tuple and not bag&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Tuple bytesToTuple(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] b) {
+            LogUtils.warn(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to convert bytes array to bag, &quot;&lt;/span&gt; +
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;4. Documentation. Now that error code 2110 has been removed,  &lt;a href=&quot;http://wiki.apache.org/pig/PigErrorHandlingFunctionalSpecification&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/pig/PigErrorHandlingFunctionalSpecification&lt;/a&gt; has to be updated to reflect the removal of this error code.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; errCode = 2110;
-            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; msg = &lt;span class=&quot;code-quote&quot;&gt;&quot;Could not convert bytearray to map.&quot;&lt;/span&gt;;
-            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ExecException(msg, errCode, PigException.BUG);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;5. The bytes to (Integer/Long/Float/Double) methods are interpreting the first 4 to 8 bytes (depending on the type) and returning the value as the value for the converted type. This is a semantics question. Should we return null or should we do a best effort conversion of bytes to basic types? For example in the bytesToCharArray routine, the first couple of bytes are expected to be representative of the length of the string. The same argument holds good for the tuple too. However for the numeric types, a fixed number of bytes is interpreted as the value.&lt;/p&gt;</comment>
                            <comment id="12679391" author="thejas" created="Thu, 5 Mar 2009 22:01:55 +0000"  >&lt;p&gt;Santhosh, Thanks for reviewing the changes and the suggestions.&lt;br/&gt;
The suggestions have been incorporated in this new patch, which replaces the old one.&lt;br/&gt;
Re: Index: src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/expressionOperators/POProject.java,  I have removed the changes in that as those are not necessary for fixing this JIRA. (I had accidentally included it in the patch.). It will be useful to fix similar problem described in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-696&quot; title=&quot;Fatal error produced when malformed scalar types within complex type is converted to given type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-696&quot;&gt;&lt;del&gt;PIG-696&lt;/del&gt;&lt;/a&gt; .&lt;/p&gt;

&lt;p&gt;Re: The semantics of bytearray to numeric types, a best effort conversion will be done. ie if there are minimum number of bytes required for the conversion, it will convert the bytearray to the specified number type.&lt;/p&gt;

</comment>
                            <comment id="12679730" author="thejas" created="Fri, 6 Mar 2009 21:26:46 +0000"  >&lt;p&gt;Attaching a new patch, because there were problems in applying the diffs generated by &quot;svn mv&quot; in the old one (Utils.java moved to LogUtils.java).&lt;br/&gt;
This patch does not have LogUtils.java . The changes made in LogUtils.java over Utils.java are under the Utils.java diff in patch.&lt;br/&gt;
After the patch is applied, the Utils.java should be moved to LogUtils.java  using &apos;svn mv&apos;.&lt;/p&gt;</comment>
                            <comment id="12679752" author="sms" created="Fri, 6 Mar 2009 22:53:57 +0000"  >&lt;p&gt;Patch has been committed. Good work on the test cases. Thanks Thejas!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12401646" name="544.2.patch" size="42634" author="thejas" created="Fri, 6 Mar 2009 21:26:46 +0000"/>
                            <attachment id="12401553" name="544.patch" size="47934" author="thejas" created="Thu, 5 Mar 2009 22:01:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 26 Nov 2008 00:09:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38465</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyag2v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94916</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>