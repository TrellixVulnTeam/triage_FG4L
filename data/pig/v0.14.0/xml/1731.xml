<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:58:19 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1731/PIG-1731.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1731] New Logical Plan: FILTER fails when there are multiple conditions</title>
                <link>https://issues.apache.org/jira/browse/PIG-1731</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Following pig script fails:&lt;br/&gt;
===========&lt;br/&gt;
REGISTER string.jar;&lt;/p&gt;

&lt;p&gt;A = LOAD &apos;data&apos; USING PigStorage() AS (a0:chararray, a1, a2);&lt;br/&gt;
B = FOREACH A GENERATE a0;&lt;br/&gt;
C = DISTINCT B;&lt;br/&gt;
D = FILTER C BY string.LENGTH(a0) &amp;lt;= 50 AND string.LENGTH(a0) &amp;gt; 1; &lt;br/&gt;
STORE D INTO &apos;D&apos;;&lt;br/&gt;
===========&lt;br/&gt;
2010-11-16 22:11:38,097 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  org.apache.pig.backend.hadoop.executionengine.HExecutionEngine - pig.usenewlogicalplan is set to true. New logical plan will be used.&lt;br/&gt;
2010-11-16 22:11:38,202 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; ERROR org.apache.pig.tools.grunt.Grunt - ERROR 2998: Unhandled internal error. null&lt;/p&gt;

&lt;p&gt;But this one works:&lt;br/&gt;
===========&lt;br/&gt;
REGISTER string.jar;&lt;/p&gt;

&lt;p&gt;A = LOAD &apos;data&apos; USING PigStorage() AS (a0:chararray, a1, a2);&lt;br/&gt;
B = FOREACH A GENERATE a0;&lt;br/&gt;
C = DISTINCT B;&lt;br/&gt;
D = FILTER C BY string.LENGTH(a0) &amp;lt;= 50;&lt;br/&gt;
E = FILTER D BY string.LENGTH(a0) &amp;gt; 1; &lt;br/&gt;
STORE E INTO &apos;D&apos;;&lt;br/&gt;
===========&lt;/p&gt;

&lt;p&gt;Input data:&lt;br/&gt;
===========&lt;br/&gt;
Jerry   Jerry   0.55&lt;br/&gt;
Dave    David   0.15&lt;br/&gt;
Danny   Dan     0.015&lt;br/&gt;
S       Smith   0.2&lt;br/&gt;
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA        Amy     0.8&lt;br/&gt;
===========&lt;/p&gt;</description>
                <environment></environment>
        <key id="12480152">PIG-1731</key>
            <summary>New Logical Plan: FILTER fails when there are multiple conditions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yanz">Yan Zhou</assignee>
                                    <reporter username="sherri_chen">Sherry Chen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Nov 2010 22:23:28 +0000</created>
                <updated>Fri, 17 Dec 2010 22:46:58 +0000</updated>
                            <resolved>Wed, 17 Nov 2010 16:34:31 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12932725" author="yanz" created="Wed, 17 Nov 2010 00:18:54 +0000"  >&lt;p&gt;The problem is that UserFuncExpression.isEqual checks for the logical plan equality before check for the the UDF&apos;s equality. This causes an infinite loop as the logical plan equality check&lt;br/&gt;
requires the equality checks of all its operators of which the UserFuncExpression is part.&lt;/p&gt;

&lt;p&gt;We had the similar issues on other expression operators before. NotExpression, e.g, had the problem fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1510&quot; title=&quot;Add `deepCopy` for LogicalExpressions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1510&quot;&gt;&lt;del&gt;PIG-1510&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;The  UserFuncExpression.isEqual is called by the logicl expression simplifier (&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1399&quot; title=&quot;Logical Optimizer: Expression optimizor rule&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1399&quot;&gt;&lt;del&gt;PIG-1399&lt;/del&gt;&lt;/a&gt;)  in the new logical plan. At least in this test it is not called if the old logical plan is used. That&apos;s why use of the old logical plan is ok in this test case.&lt;/p&gt;</comment>
                            <comment id="12932729" author="yanz" created="Wed, 17 Nov 2010 00:23:23 +0000"  >&lt;p&gt;UserFuncExpression seems to be the only logical expression operator that still has this problem as I just checked.&lt;/p&gt;</comment>
                            <comment id="12932731" author="olgan" created="Wed, 17 Nov 2010 00:34:23 +0000"  >&lt;p&gt;can we solve both issues with the same patch?&lt;/p&gt;</comment>
                            <comment id="12932732" author="yanz" created="Wed, 17 Nov 2010 00:36:21 +0000"  >&lt;p&gt;If there is no AND in this test, the simplifier won&apos;t check for the equality of the two UDF calls so it is ok too.&lt;/p&gt;</comment>
                            <comment id="12932736" author="daijy" created="Wed, 17 Nov 2010 00:47:04 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12932752" author="yanz" created="Wed, 17 Nov 2010 01:04:36 +0000"  >&lt;p&gt;test-patch runs clean.&lt;/p&gt;</comment>
                            <comment id="12933021" author="yanz" created="Wed, 17 Nov 2010 16:34:31 +0000"  >&lt;p&gt;test-core passed cleanly.&lt;/p&gt;

&lt;p&gt;Committed to both trunk and the 0.8 branch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12459747" name="PIG-1731.patch" size="2549" author="yanz" created="Wed, 17 Nov 2010 00:18:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 17 Nov 2010 00:18:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>165163</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyaten:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97075</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>