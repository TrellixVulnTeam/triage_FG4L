<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:02:24 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1313/PIG-1313.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1313] PigServer leaks memory over time</title>
                <link>https://issues.apache.org/jira/browse/PIG-1313</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;When &lt;tt&gt;PigServer&lt;/tt&gt; runs it creates temporary files using the &lt;tt&gt;FileLocalizer.getTemporaryPath(..)&lt;/tt&gt;. This static method creates and returns a handle to a temporary file (as an instance of &lt;tt&gt;ElementDescriptor&lt;/tt&gt;). The &lt;tt&gt;ElementDescriptors&lt;/tt&gt; returned by this method are kept on a static &lt;tt&gt;Stack&lt;/tt&gt; named &lt;tt&gt;toDelete&lt;/tt&gt;. The items on &lt;tt&gt;toDelete&lt;/tt&gt; get removed by the &lt;tt&gt;FileLocalizer.deleteTempFile()&lt;/tt&gt; method.&lt;/p&gt;

&lt;p&gt;The only place in the code where I see &lt;tt&gt;FileLocalizer.deleteTempFile()&lt;/tt&gt; called is in the Main class. &lt;tt&gt;PigServer&lt;/tt&gt; does not call that method though, so a long-running VM that repeatedly uses instances of &lt;tt&gt;PigServer&lt;/tt&gt; to run jobs will leak memory via &lt;tt&gt;toDelete&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;One suggested fix is to have &lt;tt&gt;PigServer.shutdown()&lt;/tt&gt; call &lt;tt&gt;FileLocalizer.deleteTempFile()&lt;/tt&gt;, but this would cause problems in a multi-threaded environment, since it seems &lt;tt&gt;ElementDescriptors&lt;/tt&gt; are pushed onto the &lt;tt&gt;toDelete&lt;/tt&gt; stack before they&apos;re used, not once they&apos;re done with. With this approach, running multiple instances of &lt;tt&gt;PigServer&lt;/tt&gt; in separate threads could cause one completed job to clobber the other&apos;s still-in-use temp files.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12459881">PIG-1313</key>
            <summary>PigServer leaks memory over time</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="billgraham">Bill Graham</assignee>
                                    <reporter username="billgraham">Bill Graham</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Mar 2010 16:57:42 +0000</created>
                <updated>Fri, 17 Dec 2010 22:43:58 +0000</updated>
                            <resolved>Thu, 1 Apr 2010 23:49:39 +0100</resolved>
                                    <version>0.7.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12848391" author="daijy" created="Mon, 22 Mar 2010 22:17:18 +0000"  >&lt;p&gt;Yes, your observation is valid. When we design PigServer, we do not put long running and multi-thread in mind. We already have &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-240&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;PIG-240&lt;/a&gt; in an attempt to make PigServer multi-thread. In your case, it seems all you need is to intermittently instantiate PigServer and run script within one java VM. So we need to ensure when the first PigServer is done, we reclaim all the resources local to that particular PigServer instance. And PigServer.shutdown sounds like a reasonable place to do that. &lt;/p&gt;

&lt;p&gt;FileLocalizer.toDelete and FileLocalizer.deleteOnFail are such resources local to PigServer instance. Seems that we should move them into PigServer so that we can clear them safely during shutdown. &lt;/p&gt;</comment>
                            <comment id="12848442" author="billgraham" created="Mon, 22 Mar 2010 23:39:06 +0000"  >&lt;p&gt;Thanks for the pointer to &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-240&quot; title=&quot;Support launching concurrent Pig jobs from one VM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-240&quot;&gt;&lt;del&gt;PIG-240&lt;/del&gt;&lt;/a&gt;. The patch included make it look like that bug is focusing specifically on the LogicalPlan refactor. &lt;/p&gt;

&lt;p&gt;In my case I do need a multi-threaded PigServer instance. My VM is running a scheduler which wakes up and invokes scripts periodically and it is possible that one script will be kicked off while another is already running.  As a result, calling FileLocalizer.deleteTempFiles() can cause problem. This is because the toDelete Stack and others are static.&lt;/p&gt;

&lt;p&gt;One possible fix would be to bind a toDelete Stack to each thread local instance, or to make FileLocalizer non-static. The later seems cleaner but would require modifying a lot more code.&lt;/p&gt;</comment>
                            <comment id="12848450" author="billgraham" created="Mon, 22 Mar 2010 23:45:52 +0000"  >&lt;p&gt;Attaching &lt;tt&gt;Pig1313Reproducer.java&lt;/tt&gt;, which is a class that can be used to reproduce the issue. It re-runs a PigServer job in an infinite loop.&lt;/p&gt;

&lt;p&gt;It&apos;s difficult to expose run time info about the toDelete Stack because it&apos;s private but you can run a script like this to repeatedly dump the size/count of the elements on the Stack:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;while true; do jmap -histo &amp;lt;pid&amp;gt; | grep HFile; sleep 5; done&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Over time the overall count of HFile objects will increase.&lt;/p&gt;</comment>
                            <comment id="12848968" author="billgraham" created="Wed, 24 Mar 2010 00:01:22 +0000"  >&lt;p&gt;Looking more closely at FileLocalizer it does seem that by just making toDelete, deleteOnFail and relativeRoot into ThreadLocals, this issue around multiple threads and temp files could be solved. If there&apos;s agreement on this approach, I can take on this issue and contribute a patch. Thoughts?&lt;/p&gt;</comment>
                            <comment id="12849453" author="alangates" created="Wed, 24 Mar 2010 21:28:02 +0000"  >&lt;p&gt;I&apos;m not sure I understand all the pros and cons of Daniel&apos;s suggestion of moving the variables to PigServer versus Bill&apos;s suggestion of making them ThreadLocal.  The advantages I can see of moving the values to PigServer are:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;It&apos;s clearer to other developers what&apos;s going on, since they can see that these values are associated with an instance of PigServer.  Otherwise we&apos;re constructing a hidden dependency between the lifetime of PigServer and the thread it&apos;s running in.&lt;/li&gt;
	&lt;li&gt;If at some future point Pig&apos;s frontend is multi-threaded this will still work (granted this is unlikely or at least far in the future)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The advantage I see with Bill&apos;s proposal is it&apos;s less change.&lt;/p&gt;

&lt;p&gt;Are there other things I&apos;m missing here?&lt;/p&gt;</comment>
                            <comment id="12849501" author="billgraham" created="Wed, 24 Mar 2010 22:29:46 +0000"  >&lt;p&gt;You summed it up well Alan. My ThreadLocal suggestion was really just because we could modify one class internally instead of doing a much larger refactor. &lt;/p&gt;

&lt;p&gt;I&apos;m unclear though on how we&apos;d go about moving FileLocalizer.toDelete and FileLocalizer.deleteOnFail into PigServer? Currently, calls to the FileLocalizer methods that create these temp file objects happen all over the codebase in places where the calling code wouldn&apos;t have a handle to their PigServer instance AFAIK. Unless they could get the PigServer from the PigContext or something of the sort. Otherwise, it would need to be a static call to PigServer methods, and we&apos;ve just moved the same problem to another class.&lt;/p&gt;
</comment>
                            <comment id="12849811" author="daijy" created="Thu, 25 Mar 2010 18:15:14 +0000"  >&lt;p&gt;I think ThreadLocal could be a simpler alternative solution for now. In the long term, we should move static FileLocalizer variable into PigServer, since user may not launch different thread for different PigServer, ThreadLocal can not solve all situation. But moving static variables require more code changes. So I am fine to use ThreadLocal for now if it solves Bill&apos;s problem. Hi, Bill, can you give a patch on this?&lt;/p&gt;</comment>
                            <comment id="12849836" author="billgraham" created="Thu, 25 Mar 2010 18:47:01 +0000"  >&lt;p&gt;Sure, I can work on a patch. Not sure how I&apos;d create a unit test for this though, since it&apos;s a change to how private internals are managed. We should be able to assert the fix though with the attached test harness that reproduces the issue.&lt;/p&gt;

&lt;p&gt;Can you please assign this JIRA to me, or give me permissions to assign?&lt;/p&gt;</comment>
                            <comment id="12849846" author="daijy" created="Thu, 25 Mar 2010 19:05:04 +0000"  >&lt;p&gt;In this case, we can skip the unit test and test it manually, just put a notes on the Jira. Thanks!&lt;/p&gt;

&lt;p&gt;I don&apos;t have the permission to assign it to you, but you cannot see &quot;assign to me&quot; link on your Jira?&lt;/p&gt;</comment>
                            <comment id="12849848" author="alangates" created="Thu, 25 Mar 2010 19:06:41 +0000"  >&lt;p&gt;I&apos;ve added you to the contributors list in JIRA, so you should now be able to assign issues to yourself.&lt;/p&gt;</comment>
                            <comment id="12851079" author="billgraham" created="Mon, 29 Mar 2010 21:39:16 +0100"  >&lt;p&gt;Attaching two patches, one built from the trunk and one built from the 0.4.0 branch (since 0.4.0 is what we&apos;re using). Not sure if patches to older branches are still being applied or not though. Let me know if I should provide other patches for other branches.&lt;/p&gt;

&lt;p&gt;The patch includes the following changes to FileLocalizer:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;toDelete, deleteOnFail and relativeRoot are ThreadLocals.&lt;/li&gt;
	&lt;li&gt;The initialized attribute and the init method has been removed, since they&apos;re no longer needed.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In PigServer I&apos;ve done the following:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;FileLocalizer.deleteTempFiles() is called from the shutdown method.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ve run my server with this patch applied for a few days now and the memory consumption has stabilized. I also no longer see exceptions in the logs from when a PigServers temp files would go missing.&lt;/p&gt;</comment>
                            <comment id="12851087" author="hadoopqa" created="Mon, 29 Mar 2010 21:55:43 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12440102/PIG-1313-0.4.0-1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12440102/PIG-1313-0.4.0-1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 928384.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no tests are needed for this patch.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/255/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/255/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12851102" author="hadoopqa" created="Mon, 29 Mar 2010 22:20:27 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12440107/PIG-1313-1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12440107/PIG-1313-1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 928384.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no tests are needed for this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/256/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/256/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/256/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/256/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/256/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/256/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12851130" author="billgraham" created="Mon, 29 Mar 2010 23:02:37 +0100"  >&lt;p&gt;Previous patch caused issues with dependencies in test code, which I&apos;ve resolved in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1313&quot; title=&quot;PigServer leaks memory over time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1313&quot;&gt;&lt;del&gt;PIG-1313&lt;/del&gt;&lt;/a&gt;-2.patch. Also, the 0.4.0 patch was getting picked up and was causing failures. Holding off on reattaching that patch until tests pass with the trunk patch. &lt;/p&gt;</comment>
                            <comment id="12851228" author="hadoopqa" created="Tue, 30 Mar 2010 04:07:08 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12440121/PIG-1313-2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12440121/PIG-1313-2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 928384.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no tests are needed for this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/257/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/257/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/257/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/257/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/257/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/257/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12851717" author="hadoopqa" created="Wed, 31 Mar 2010 05:05:03 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12440276/PIG-1313-3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12440276/PIG-1313-3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 929236.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no tests are needed for this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/272/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/272/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/272/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/272/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/272/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/272/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12852060" author="daijy" created="Wed, 31 Mar 2010 20:19:27 +0100"  >&lt;p&gt;I will review it.&lt;/p&gt;</comment>
                            <comment id="12852202" author="daijy" created="Thu, 1 Apr 2010 01:48:57 +0100"  >&lt;p&gt;+1. This patch faithfully translate static variable into ThreadLocal variable. Will commit it shortly.&lt;/p&gt;</comment>
                            <comment id="12852240" author="daijy" created="Thu, 1 Apr 2010 05:00:20 +0100"  >&lt;p&gt;I read the patch again. Two things I notice:&lt;br/&gt;
1. PigServer.shutdown() should be explicitly called user in order to take advantage of it. We need to put some document on it.&lt;br/&gt;
2. deleteOnFail is now dangling, no one is calling registerDeleteOnFail/triggerDeleteOnFail. We will address it in a seperate Jira.&lt;/p&gt;</comment>
                            <comment id="12852450" author="billgraham" created="Thu, 1 Apr 2010 17:45:14 +0100"  >&lt;ol&gt;
	&lt;li&gt;Attaching &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1313&quot; title=&quot;PigServer leaks memory over time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1313&quot;&gt;&lt;del&gt;PIG-1313&lt;/del&gt;&lt;/a&gt;-4.patch with additional Javadocs on PigServer and PigServer.shutdown().&lt;/li&gt;
	&lt;li&gt;triggerDeleteOnFail is still called by TestMultQueryLocal.executePlan, but you are correct in that no one is (or was) calling registerDeleteOnFail, which is the only entry point to push something onto the deleteOnFail stack.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I will gladly remove deleteOnFail and all calls to it as part of this JIRA, or we can handle it in another one if that&apos;s cleaner w.r.t. issue tracking. Let me know. &lt;/p&gt;</comment>
                            <comment id="12852463" author="daijy" created="Thu, 1 Apr 2010 18:13:43 +0100"  >&lt;p&gt;Thanks, Bill,&lt;br/&gt;
Let&apos;s leave triggerDeleteOnFail. This is the thing we want to fix. I&apos;ve opened another Jira &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1347&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;PIG-1347&lt;/a&gt; for that. This patch is good to go and I will commit it shortly.&lt;/p&gt;</comment>
                            <comment id="12852491" author="billgraham" created="Thu, 1 Apr 2010 19:27:30 +0100"  >&lt;p&gt;Here&apos;s the same patch for 0.4.0 if anyone wants it.&lt;/p&gt;</comment>
                            <comment id="12852587" author="daijy" created="Thu, 1 Apr 2010 23:49:39 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1313&quot; title=&quot;PigServer leaks memory over time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1313&quot;&gt;&lt;del&gt;PIG-1313&lt;/del&gt;&lt;/a&gt;-4.patch committed to trunk. Will come with Pig 0.8 release. This issue is about memory leak and it is hard to write a unit test for it. Bill tested it manually and it works. &lt;/p&gt;

&lt;p&gt;Thanks Bill for contributing!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12440102" name="PIG-1313-0.4.0-1.patch" size="8394" author="billgraham" created="Mon, 29 Mar 2010 21:39:16 +0100"/>
                            <attachment id="12440532" name="PIG-1313-0.4.0-4.patch" size="9563" author="billgraham" created="Thu, 1 Apr 2010 19:27:30 +0100"/>
                            <attachment id="12440107" name="PIG-1313-1.patch" size="8214" author="billgraham" created="Mon, 29 Mar 2010 21:59:13 +0100"/>
                            <attachment id="12440101" name="PIG-1313-1.patch" size="8214" author="billgraham" created="Mon, 29 Mar 2010 21:39:16 +0100"/>
                            <attachment id="12440121" name="PIG-1313-2.patch" size="8457" author="billgraham" created="Mon, 29 Mar 2010 23:02:37 +0100"/>
                            <attachment id="12440276" name="PIG-1313-3.patch" size="8489" author="billgraham" created="Tue, 30 Mar 2010 22:08:33 +0100"/>
                            <attachment id="12440524" name="PIG-1313-4.patch" size="9404" author="billgraham" created="Thu, 1 Apr 2010 17:45:14 +0100"/>
                            <attachment id="12439527" name="Pig1313Reproducer.java" size="2511" author="billgraham" created="Mon, 22 Mar 2010 23:45:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 22 Mar 2010 22:17:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164813</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyap1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96368</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>PigServer shutdown() method cleans up after itself better.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>