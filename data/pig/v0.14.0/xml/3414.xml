<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:07:12 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3414/PIG-3414.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3414] QueryParserDriver.parseSchema(String) silently returns a wrong result when a comma is missing in the schema definition</title>
                <link>https://issues.apache.org/jira/browse/PIG-3414</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;QueryParserDriver provides a convenient method to parse from string to LogicalSchema. But if a comma is missing between two fields in the schema definition, it silently returns a wrong result. For example,&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; b:&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This string will be parsed up to &quot;a:int&quot;, and &quot;b:long&quot; will be silently discarded. This should rather fail with a parser exception.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12662753">PIG-3414</key>
            <summary>QueryParserDriver.parseSchema(String) silently returns a wrong result when a comma is missing in the schema definition</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cheolsoo">Cheolsoo Park</assignee>
                                    <reporter username="cheolsoo">Cheolsoo Park</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Aug 2013 01:24:01 +0100</created>
                <updated>Mon, 14 Oct 2013 17:46:11 +0100</updated>
                            <resolved>Wed, 14 Aug 2013 18:08:27 +0100</resolved>
                                                    <fixVersion>0.12.0</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13734255" author="cheolsoo" created="Fri, 9 Aug 2013 01:34:10 +0100"  >&lt;p&gt;Attached is a patch that throws an exception when a comma is missing in the schema definition.&lt;/p&gt;

&lt;p&gt;I also added new test cases.&lt;/p&gt;</comment>
                            <comment id="13734787" author="xuefuz" created="Fri, 9 Aug 2013 14:44:47 +0100"  >&lt;p&gt;I think using custom code to detect grammar error might not be the best approach. I can image that there can be more cases like this. Ideally, we should fix this by the grammar or the use of antlr. &lt;/p&gt;</comment>
                            <comment id="13735167" author="cheolsoo" created="Fri, 9 Aug 2013 20:24:31 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;Xuefu Zhang&lt;/a&gt;, thank you for your comment sir!&lt;/p&gt;

&lt;p&gt;I agree with you. In fact, this issue doesn&apos;t exist when the schema definition is used inside the AS clause in a LOAD statement because the grammar looks for a right parenthesis and throws a parser exception if it doesn&apos;t find one. Unfortunately, I didn&apos;t have a good idea to detect this in the grammar itself when the schema definition is used alone.&lt;/p&gt;

&lt;p&gt;For the context, I have a load func that takes the schema string as an option, and I use this helper function to parse it. One user accidentally omitted a comma, and that resulted in some surprising side-effects in downstream ETL processes. So I put some quick fix to prevent such unfortunate event again.&lt;/p&gt;

&lt;p&gt;But yes, I agree that this is probably not the best approach. I will cancel the patch for now. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13735329" author="cheolsoo" created="Fri, 9 Aug 2013 22:27:31 +0100"  >&lt;p&gt;OK, here is a new patch that fixes the grammar. I added a new rule as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
standalone_field_def_list: field_def_list EOF;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As can be seen, this rule will ensure that all the tokens are consumed. Let me know if you have a better suggestion.&lt;/p&gt;</comment>
                            <comment id="13735368" author="xuefuz" created="Fri, 9 Aug 2013 22:53:33 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt; Thanks for reworking on the patch. The patch looks very good, except for a minor point: instead of &quot;standalone_field_def_list&quot;, would you consider naming it just as &quot;schema&quot; or some sort, paring with its counterpart &quot;query&quot;? It&apos;s now a top-level root and cannot be used in other grammar rules. This might make it clear to other developers.&lt;/p&gt;</comment>
                            <comment id="13735394" author="cheolsoo" created="Fri, 9 Aug 2013 23:14:29 +0100"  >&lt;p&gt;Thank you for the suggestion! I renamed the rule to &quot;schema&quot; and moved it next to &quot;query&quot;. So it should be clear that it&apos;s a top level rule.&lt;/p&gt;</comment>
                            <comment id="13735416" author="xuefuz" created="Fri, 9 Aug 2013 23:34:08 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13735444" author="cheolsoo" created="Fri, 9 Aug 2013 23:56:37 +0100"  >&lt;p&gt;Committed to trunk. Thank you Xuefu for the review!&lt;/p&gt;</comment>
                            <comment id="13735500" author="cheolsoo" created="Sat, 10 Aug 2013 00:27:50 +0100"  >&lt;p&gt;I realized that I broke TestSchema so reverted my commit. In fact, it&apos;s the test case that has a bug:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
datetime(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;,datetime) -- A comma is missing, so it should fail!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I am going to post a new patch that fixes this test case.&lt;/p&gt;</comment>
                            <comment id="13735505" author="cheolsoo" created="Sat, 10 Aug 2013 00:30:32 +0100"  >&lt;p&gt;A new patch includes the following changes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Moved my test case to TestSchema.java since that seems like a better place than TestQueryParser.java.&lt;/li&gt;
	&lt;li&gt;Fixed the bug in TestSchema.testGetStringFromSchema(), so now TestSchema passes.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13735600" author="cheolsoo" created="Sat, 10 Aug 2013 01:39:19 +0100"  >&lt;p&gt;I am discovering several buggy unit tests that were accidentally passing. Now I am adding this new check, they start failing.&lt;/p&gt;

&lt;p&gt;I will fix all the buggy unit tests in a new patch.&lt;/p&gt;</comment>
                            <comment id="13739243" author="cheolsoo" created="Wed, 14 Aug 2013 06:28:21 +0100"  >&lt;p&gt;All the unit tests are fixed. I uploaded the new patch to RB:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/13551/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/13551/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please review one more time. Thanks!&lt;/p&gt;</comment>
                            <comment id="13739706" author="xuefuz" created="Wed, 14 Aug 2013 15:23:54 +0100"  >&lt;p&gt;+1. I assume all test pass now.&lt;/p&gt;</comment>
                            <comment id="13739887" author="cheolsoo" created="Wed, 14 Aug 2013 18:08:27 +0100"  >&lt;p&gt;Thank you Xuefu! Yes, all the unit tests pass now. Sorry for all the unexpected inconvenience.&lt;/p&gt;

&lt;p&gt;Committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12597175" name="PIG-3414-2.patch" size="3692" author="cheolsoo" created="Fri, 9 Aug 2013 22:28:53 +0100"/>
                            <attachment id="12597188" name="PIG-3414-3.patch" size="3447" author="cheolsoo" created="Fri, 9 Aug 2013 23:14:29 +0100"/>
                            <attachment id="12597210" name="PIG-3414-4.patch" size="3846" author="cheolsoo" created="Sat, 10 Aug 2013 00:30:32 +0100"/>
                            <attachment id="12597217" name="PIG-3414-5.patch" size="3593" author="cheolsoo" created="Sat, 10 Aug 2013 00:45:52 +0100"/>
                            <attachment id="12597889" name="PIG-3414-6.patch" size="15914" author="cheolsoo" created="Wed, 14 Aug 2013 06:19:00 +0100"/>
                            <attachment id="12596998" name="PIG-3414.patch" size="3323" author="cheolsoo" created="Fri, 9 Aug 2013 01:34:10 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 9 Aug 2013 13:44:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>342755</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzgycv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>343059</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>