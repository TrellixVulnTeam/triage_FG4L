<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:01:42 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-880/PIG-880.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-880] Order by is borken with complex fields</title>
                <link>https://issues.apache.org/jira/browse/PIG-880</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Pig script:&lt;/p&gt;

&lt;p&gt;a = load &apos;studentcomplextab10k&apos; as (smap:map[],c2,c3);&lt;br/&gt;
f = foreach a generate smap#&apos;name, smap#&apos;age&apos;, smap#&apos;gpa&apos; ;            &lt;br/&gt;
s = order f by $0;           &lt;br/&gt;
store s into &apos;sc.out&apos;         &lt;/p&gt;

&lt;p&gt;Stack:&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.ArrayStoreException&lt;br/&gt;
        at java.lang.System.arraycopy(Native Method)&lt;br/&gt;
        at java.util.Arrays.copyOf(Arrays.java:2763)&lt;br/&gt;
        at java.util.ArrayList.toArray(ArrayList.java:305)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.partitioners.WeightedRangePartitioner.convertToArray(WeightedRangePartitioner.java:154)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.partitioners.WeightedRangePartitioner.configure(WeightedRangePartitioner.java:96)&lt;br/&gt;
        ... 5 more&lt;/p&gt;

&lt;p&gt;        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.Launcher.getErrorMessages(Launcher.java:230)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.Launcher.getStats(Launcher.java:179)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher.launchPig(MapReduceLauncher.java:204)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.execute(HExecutionEngine.java:265)&lt;br/&gt;
        at org.apache.pig.PigServer.executeCompiledLogicalPlan(PigServer.java:769)&lt;br/&gt;
        at org.apache.pig.PigServer.execute(PigServer.java:762)&lt;br/&gt;
        at org.apache.pig.PigServer.access$100(PigServer.java:91)&lt;br/&gt;
        at org.apache.pig.PigServer$Graph.execute(PigServer.java:933)&lt;br/&gt;
        at org.apache.pig.PigServer.executeBatch(PigServer.java:245)&lt;br/&gt;
        at org.apache.pig.tools.grunt.GruntParser.executeBatch(GruntParser.java:112)&lt;br/&gt;
        at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:168)&lt;br/&gt;
        at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:140)&lt;br/&gt;
        at org.apache.pig.tools.grunt.Grunt.exec(Grunt.java:88)&lt;br/&gt;
        at org.apache.pig.Main.main(Main.java:389)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12430084">PIG-880</key>
            <summary>Order by is borken with complex fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sms">Santhosh Srinivasan</assignee>
                                    <reporter username="olgan">Olga Natkovich</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Jul 2009 18:51:57 +0100</created>
                <updated>Wed, 24 Mar 2010 22:13:10 +0000</updated>
                            <resolved>Fri, 31 Jul 2009 22:16:01 +0100</resolved>
                                    <version>0.3.0</version>
                                    <fixVersion>0.4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12729882" author="pkamath" created="Sat, 11 Jul 2009 00:20:30 +0100"  >&lt;p&gt;The root cause of this issue is that in interpreting map data, PigStorage returns values in the map to be of the type that it deduces based on the data. So string data for values are returned as String, integer values are returned as Integer. However the logical layer in Pig assumes the type of the values in the map to be ByteArray since it cannot assume any type. If one of the sampled values forming the quantile list is a null, it is assumed to be of type of the reduce key of the final order by job. In this case, since the order by key is smap#&apos;name&apos;, it is thought to be of type ByteArray. However the values resulting from the map lookup are actually of type String.  This mismatch results in the above exception - if nulls are filtered out, map.collect() fails because hadoop thinks the map key type is bytearray but it gets a Text (string).&lt;/p&gt;

&lt;p&gt;A proposal to fix this is to Change TextDataParser which is used by PigStorage for reading map data to return ByteArray type for the values in the map.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;
</comment>
                            <comment id="12729886" author="pkamath" created="Sat, 11 Jul 2009 00:28:06 +0100"  >&lt;p&gt;The root cause here is the same issue discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-724&quot; title=&quot;Treating map values in PigStorage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-724&quot;&gt;&lt;del&gt;PIG-724&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12732142" author="pkamath" created="Thu, 16 Jul 2009 21:37:40 +0100"  >&lt;p&gt;Attached code only patch which changes the way PigStorage would return values for maps (change is to return bytearray type). This is based on the proposal above. If this proposal is fine, this patch can be augmented with unit tests.&lt;/p&gt;</comment>
                            <comment id="12732300" author="olgan" created="Fri, 17 Jul 2009 02:52:08 +0100"  >&lt;p&gt;+1. I think this is reasonable fix until we figure out a better way of dealing with maps&lt;/p&gt;</comment>
                            <comment id="12733018" author="sms" created="Sun, 19 Jul 2009 16:53:10 +0100"  >&lt;p&gt;Review Comment:&lt;/p&gt;

&lt;p&gt;PigStorage should read map values as strings instead of interpreting the types. This way, integers that are too long to fit into Integer, etc. will still be interpreted as bytearray.&lt;/p&gt;</comment>
                            <comment id="12736994" author="sms" created="Thu, 30 Jul 2009 06:02:31 +0100"  >&lt;p&gt;Attached patch creates maps with value type set to DataByteArray (i.e., bytearray) for text data parsed by PigStorage. This change is consistent with the language semantics of treating value type as bytearray. New test cases have been added.&lt;/p&gt;</comment>
                            <comment id="12737310" author="pkamath" created="Thu, 30 Jul 2009 22:46:51 +0100"  >&lt;p&gt;+1 - looks good.&lt;/p&gt;</comment>
                            <comment id="12737375" author="sms" created="Fri, 31 Jul 2009 01:13:10 +0100"  >&lt;p&gt;Attaching a new patch that fixes a couple of unit tests.&lt;/p&gt;</comment>
                            <comment id="12737379" author="pkamath" created="Fri, 31 Jul 2009 01:36:23 +0100"  >&lt;p&gt;+1 to the new changes.&lt;/p&gt;</comment>
                            <comment id="12737714" author="sms" created="Fri, 31 Jul 2009 22:16:01 +0100"  >&lt;p&gt;Patch has been committed. This fix breaks backward compatibility where PigStorage reads maps. The type of the map values will now be bytearray instead of the actual type.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12417225">PIG-724</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12413733" name="PIG-880-bytearray-mapvalue-code-without-tests.patch" size="698" author="pkamath" created="Thu, 16 Jul 2009 21:37:40 +0100"/>
                            <attachment id="12415077" name="PIG-880_1.patch" size="16488" author="sms" created="Fri, 31 Jul 2009 01:13:10 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 10 Jul 2009 23:20:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164431</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10342"><![CDATA[Incompatible change]]></customfieldvalue>
    <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyajzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95550</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>MapValues Bytearray</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>