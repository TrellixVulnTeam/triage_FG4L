<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:08:41 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-992/PIG-992.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-992] [zebra] Separate Schema-related files into a &quot;Schema&quot; package</title>
                <link>https://issues.apache.org/jira/browse/PIG-992</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The hope is to facilitate future sharing of the Schema codes between different modules and/or products. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12437161">PIG-992</key>
            <summary>[zebra] Separate Schema-related files into a &quot;Schema&quot; package</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yanz">Yan Zhou</assignee>
                                    <reporter username="yanz">Yan Zhou</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Oct 2009 22:38:04 +0100</created>
                <updated>Thu, 2 May 2013 03:29:22 +0100</updated>
                            <resolved>Thu, 15 Oct 2009 21:39:04 +0100</resolved>
                                    <version>0.4.0</version>
                                    <fixVersion>0.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12761795" author="hadoopqa" created="Sat, 3 Oct 2009 02:17:22 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12421180/SchemaPackageChange.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12421180/SchemaPackageChange.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 821101.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 183 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/59/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/59/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12763135" author="yanz" created="Wed, 7 Oct 2009 18:10:00 +0100"  >&lt;p&gt;Additional changes to some test files to avoid use of non-default lzo compression.&lt;/p&gt;</comment>
                            <comment id="12763183" author="chaow" created="Wed, 7 Oct 2009 19:45:40 +0100"  >&lt;p&gt;Patch reviewed. +1&lt;/p&gt;</comment>
                            <comment id="12763439" author="hong.tang" created="Thu, 8 Oct 2009 10:56:33 +0100"  >&lt;p&gt;Comments:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In many places, both types.ParseException and schema.ParseException are thrown. Do you really want both?&lt;/li&gt;
	&lt;li&gt;In the following
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+public enum ColumnType implements Writable {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is the Writable interface actually used? You have rather odd pattern of asymmetric readFields and write:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+  @Override
+  public void readFields(DataInput in) throws IOException {
+    // no op, instantiated by the caller
+  }
+
+  @Override
+  public void write(DataOutput out) throws IOException {
+    Utils.writeString(out, name);
+  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;In the following code
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+  public static class ColumnSchema {
+    public String name;
+    public ColumnType type;
+    public Schema schema;
+    public int index; // field index in schema
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Exposing fields as all-public seems like a bad idea.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;Is there a specific usage case to allow schema to be mutable at any time? (minor nit: the comment says add a field, but the code seems to add a column to the schema).
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+  /**
+   * add a field
+   */
+  public void add(ColumnSchema f) throws ParseException
+  {
+    add(f, false);
+  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Why Schema.equals(Object) is not implemented on top of the static version of the method (or vice versa)?&lt;/li&gt;
	&lt;li&gt;In Schema.readFields(), the Version string from the input is not checked for compatibility.&lt;/li&gt;
	&lt;li&gt;In the following
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+  private void init(String[] columnNames) throws ParseException {
+    // the arg must be of type or they will be treated as the default type
+    // TODO: verify column names don&apos;t contain COLUMN_DELIMITER
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It seems that the TODO should not involve too much work and please consider not deferring it later.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;Need more detailed documentation on the spec of the parameter for Schema.getColumnSchema(String name)
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+  /**
+   * Get a column&apos;s schema
+   */
+  public ColumnSchema getColumnSchema(String name) throws ParseException
+  {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Schema.getColumnSchemaOnParsedName and Schema.getColumnSchema seems to be copy/paste code.&lt;/li&gt;
	&lt;li&gt;Schema.getColumnSchema(ParsedName pn) has side effect of modifying the parameter pn. The javadoc reads cryptic to me.&lt;/li&gt;
	&lt;li&gt;There are many classes generated by JavaCC. It is probably better not including them in the patch (and put the generated source under build/src).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Other minor issues:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Typically contrib projects should use the version string as the parent project.&lt;/li&gt;
	&lt;li&gt;Style: there are some very long lines.&lt;/li&gt;
	&lt;li&gt;There are a few white space changes. That should be avoided if possible.&lt;/li&gt;
	&lt;li&gt;In the following
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+    } catch (org.apache.hadoop.zebra.schema.ParseException e) {
+      throw new AssertionError(&quot;Invalid Projection: &quot;+e.getMessage());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;consider change AssertionError to IllegalArgumentException.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;In the following:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+  /*
+   * helper class to parse a column name string one section at a time and find the required
+   * type for the parsed part.
+   */
+  public static class ParsedName {
+    public String mName;
+    int mKeyOffset; // the offset where the keysstring starts
+    public ColumnType mDT = ColumnType.ANY; // parent&apos;s type
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The description seems to indicate that this should not be a public class. I tried to understand the body of the class and do not feel that it serves a general purpose.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;The following seems like useless assignment:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+  private long mVersion = schemaVersion;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  /**
+   * Normalize the schema string.
+   * 
+   * @param value
+   *          the input string representation of the schema.
+   * @return the normalized string representation.
+   */
+  public static String normalize(String value) {
+    String result = new String();
+
+    if (value == null || value.trim().isEmpty())
+      return result;
+
+    StringBuilder sb = new StringBuilder();
+    String[] parts = value.trim().split(COLUMN_DELIMITER);
+    for (int nx = 0; nx &amp;lt; parts.length; nx++) {
+      if (nx &amp;gt; 0) sb.append(COLUMN_DELIMITER);
+      sb.append(parts[nx].trim());
+    }
+    return sb.toString();
+  }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There is a wasted value.trim().&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;In Schema.equals(Object), instead of comparing class equality, using &quot;instanceof&quot; is typically better.&lt;/li&gt;
	&lt;li&gt;Use StringBuilder instead in the following code:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+    String merged = new String();
+    for (int i = 0; i &amp;lt; columnNames.length; i++) {
+      if (i &amp;gt; 0) merged += &quot;,&quot;;
+      merged += columnNames[i];
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;There are a few indentation problems.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12764742" author="yanz" created="Mon, 12 Oct 2009 17:50:42 +0100"  >&lt;p&gt;Mostly address the review comments by Hong. Most significant changes include removal of JavaCC generated sources from the repository, unification of the ParseException class generated by both the storage parser and schema parser, hide internal members of the Schema.ColumnSchema class.&lt;/p&gt;</comment>
                            <comment id="12764856" author="alangates" created="Mon, 12 Oct 2009 22:42:31 +0100"  >&lt;p&gt;Canceling old patches.&lt;/p&gt;</comment>
                            <comment id="12764857" author="alangates" created="Mon, 12 Oct 2009 22:42:55 +0100"  >&lt;p&gt;Resubmitting patch so hudson will rerun&lt;/p&gt;</comment>
                            <comment id="12764903" author="hadoopqa" created="Tue, 13 Oct 2009 01:45:52 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12421879/SchemaPackageChange.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12421879/SchemaPackageChange.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 824446.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 183 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/18/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/18/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/18/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/18/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/18/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/18/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12766234" author="alangates" created="Thu, 15 Oct 2009 21:39:04 +0100"  >&lt;p&gt;Patch checked in.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12437166">PIG-993</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12421879" name="SchemaPackageChange.patch" size="374765" author="yanz" created="Mon, 12 Oct 2009 17:50:42 +0100"/>
                            <attachment id="12421541" name="SchemaPackageChange.patch" size="387133" author="yanz" created="Wed, 7 Oct 2009 18:10:00 +0100"/>
                            <attachment id="12421180" name="SchemaPackageChange.patch" size="387147" author="yanz" created="Sat, 3 Oct 2009 01:26:12 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 3 Oct 2009 01:17:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164527</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyal9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95757</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>The patch file needs to be applied after Jira 986&amp;#39;s patch has been applied.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>