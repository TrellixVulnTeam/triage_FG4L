<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:59:23 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3581/PIG-3581.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3581] Incorrect scope resolution with nested foreach</title>
                <link>https://issues.apache.org/jira/browse/PIG-3581</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Consider the following script:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
A = LOAD &apos;test_data&apos; AS (a: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, b: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
C = FOREACH A GENERATE *;
B = FOREACH (GROUP A BY a) {
	C = FILTER A BY b % 2 == 0;
	D = FILTER A BY b % 2 == 1;
	GENERATE group AS a, A.b AS every, C.b AS even, D.b AS odd;
};
DESCRIBE B;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Notice that C is defined both inside the nested foreach as well as outside. I would expect that in the GENERATE inside the nested FOREACH, the C that is used will be the one that is defined inside. If that is not so, I think at least a warning is due.&lt;/p&gt;

&lt;p&gt;However, currently Pig silently assumes that the C you mean one is the one that is defined &lt;b&gt;outside&lt;/b&gt; the nested FOREACH.&lt;/p&gt;

&lt;p&gt;Hence, the result of &quot;DESCRIBE B&quot; looks as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
B: {
    a: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
    every: {
        (
            b: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;
        )
    },
    even: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
    odd: {
        (
            b: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;
        )
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If I remove the definition of C that is outside the foreach, then I get the following for &quot;DESCRIBE B&quot;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
B: {
    a: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
    every: {
        (
            b: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;
        )
    },
    even: {
        (
            b: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;
        )
    },
    odd: {
        (
            b: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;
        )
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12679678">PIG-3581</key>
            <summary>Incorrect scope resolution with nested foreach</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aniket486">Aniket Mokashi</assignee>
                                    <reporter username="venusatuluri">Venu Satuluri</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Nov 2013 06:12:58 +0000</created>
                <updated>Mon, 7 Jul 2014 19:08:09 +0100</updated>
                            <resolved>Tue, 26 Nov 2013 19:23:01 +0000</resolved>
                                                    <fixVersion>0.13.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13831676" author="xuefuz" created="Mon, 25 Nov 2013 18:02:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aniket&quot; class=&quot;user-hover&quot; rel=&quot;aniket&quot;&gt;Aniket Bhatnagar&lt;/a&gt; Could you please put a review board entry for this? Also, do you think if a test case would be helpful? Thanks.&lt;/p&gt;</comment>
                            <comment id="13831748" author="aniket486" created="Mon, 25 Nov 2013 18:43:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;Xuefu Zhang&lt;/a&gt;, Thanks for looking into this. I will submit a review shortly.&lt;/p&gt;

&lt;p&gt;It&apos;s a minor change, I&apos;m just changing the order of name resolution to give priority to nested variable over scalar. Essentially following code -&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// From --
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(1) doScalar
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(2) doNested
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(3) other

&lt;span class=&quot;code-comment&quot;&gt;// To--
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(2) doNested
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(1) doScalar
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(3) other
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If you insist, I can add a test for this, but I think we won&apos;t need it.&lt;/p&gt;</comment>
                            <comment id="13831810" author="xuefuz" created="Mon, 25 Nov 2013 19:28:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aniket&quot; class=&quot;user-hover&quot; rel=&quot;aniket&quot;&gt;Aniket Bhatnagar&lt;/a&gt; Thanks for your explanation. I agree that not every patch needs a test. While the change might be minor, it changed or corrected the behaviour. Unless we find it very difficult to construct a test, I&apos;d think a test case is helpful in the sense that it not only provides a way to verify the fix but also prevents future break of this. As a fyi, there are some example of test cases in TestPigServer which might be followed.&lt;/p&gt;</comment>
                            <comment id="13832208" author="aniket486" created="Tue, 26 Nov 2013 02:23:48 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;Xuefu Zhang&lt;/a&gt;. Attached new patch with tests. RB: &lt;a href=&quot;https://reviews.apache.org/r/15852/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/15852/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13832670" author="xuefuz" created="Tue, 26 Nov 2013 15:33:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aniket&quot; class=&quot;user-hover&quot; rel=&quot;aniket&quot;&gt;Aniket Bhatnagar&lt;/a&gt; Thanks for spending time on the test case. I posted a couple of comments on rb.&lt;/p&gt;</comment>
                            <comment id="13832872" author="aniket486" created="Tue, 26 Nov 2013 18:51:16 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;Xuefu Zhang&lt;/a&gt;, I do not understand your concern, scalars are allowed anywhere in the script and that change doesn&apos;t seem to affect that anyway.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;JFYI, you are looping in the wrong Aniket above.&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="13832895" author="xuefuz" created="Tue, 26 Nov 2013 19:05:15 +0000"  >&lt;p&gt;Okay. Then I was mistaken indeed. Patch looks good. +1.&lt;/p&gt;

&lt;p&gt;My apology to another Aniket also. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13832917" author="aniket486" created="Tue, 26 Nov 2013 19:22:48 +0000"  >&lt;p&gt;Thanks for the review, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;Xuefu Zhang&lt;/a&gt;! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Committed to trunk..&lt;/p&gt;
</comment>
                            <comment id="13855935" author="cheolsoo" created="Mon, 23 Dec 2013 21:16:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aniket486&quot; class=&quot;user-hover&quot; rel=&quot;aniket486&quot;&gt;Aniket Mokashi&lt;/a&gt;, I think this patch introduced a regression. Consider the following query-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a = LOAD &apos;foo&apos; AS (x:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, y:chararray);
b = GROUP a BY x;
c = FOREACH b {
    expr = &apos;bar&apos;;
    filtered = FILTER a BY y == expr;
    GENERATE COUNT(filtered);
}
DESCRIBE c;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This used to work in 0.11 but no longer works in trunk. It looks like &apos;expr&apos; used to be resolved to a scalar expression (&apos;bar&apos;), but it&apos;s not the case anymore. &lt;/p&gt;

&lt;p&gt;My question are,&lt;br/&gt;
1. Is it supported to define a local scalar expression inside a nested foreach? e.g. expr = &apos;bar&apos;;&lt;br/&gt;
2. If so, can you fix the regression?&lt;/p&gt;</comment>
                            <comment id="13855949" author="aniket486" created="Mon, 23 Dec 2013 21:38:28 +0000"  >&lt;p&gt;Let me look into this in detail.&lt;/p&gt;

&lt;p&gt;In general, expr = &apos;bar&apos;; filtered = FILTER a BY y == expr; - using scalar is very bad (crazy). It is going to store the word &apos;bar&apos; in a file on HDFS and read it back.&lt;/p&gt;</comment>
                            <comment id="13855955" author="cheolsoo" created="Mon, 23 Dec 2013 21:44:39 +0000"  >&lt;p&gt;I am not saying it&apos;s a good thing to do. I was answering a user questions on the mailing list and curious whether it&apos;s supported or not. For the context, see here-&lt;br/&gt;
&lt;a href=&quot;http://www.mail-archive.com/user@pig.apache.org/msg08977.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.mail-archive.com/user@pig.apache.org/msg08977.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13855959" author="cheolsoo" created="Mon, 23 Dec 2013 21:53:51 +0000"  >&lt;blockquote&gt;
&lt;p&gt;It is going to store the word &apos;bar&apos; in a file on HDFS and read it back.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Plus, I don&apos;t think this is true. See the explain output in 0.11. There is no hdfs reading for &apos;bar&apos;. It&apos;s a constant-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
c: Store(fakefile:org.apache.pig.builtin.PigStorage) - scope-20
|
|---c: New For Each(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)[bag] - scope-19
    |   |
    |   POUserFunc(org.apache.pig.builtin.COUNT)[&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;] - scope-13
    |   |
    |   |---RelationToExpressionProject[bag][*] - scope-12
    |       |
    |       |---filtered: Filter[bag] - scope-15
    |           |   |
    |           |   Equal To[&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;] - scope-18
    |           |   |
    |           |   |---Project[chararray][1] - scope-16
    |           |   |
    |           |   |---Constant(bar) - scope-17
    |           |
    |           |---Project[bag][1] - scope-14
    |
    |---b: Package[tuple]{&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;} - scope-9--------
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13855960" author="aniket486" created="Mon, 23 Dec 2013 22:01:34 +0000"  >&lt;p&gt;Understood. So, its a problem with nested_command resolution and not scalar resolution. I will submit a patch for this.&lt;/p&gt;</comment>
                            <comment id="13855961" author="aniket486" created="Mon, 23 Dec 2013 22:02:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is it supported to define a local scalar expression inside a nested foreach? e.g. expr = &apos;bar&apos;;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes. &lt;a href=&quot;https://github.com/apache/pig/blob/branch-0.12/src/org/apache/pig/parser/QueryParser.g#L923&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/pig/blob/branch-0.12/src/org/apache/pig/parser/QueryParser.g#L923&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;If so, can you fix the regression?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes&lt;/p&gt;</comment>
                            <comment id="13857896" author="cheolsoo" created="Sat, 28 Dec 2013 01:24:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aniket486&quot; class=&quot;user-hover&quot; rel=&quot;aniket486&quot;&gt;Aniket Mokashi&lt;/a&gt;, I put up a fix in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3643&quot; title=&quot;Nested Foreach with UDF and bincond is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3643&quot;&gt;&lt;del&gt;PIG-3643&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12686533">PIG-3643</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12615434" name="PIG-3581-1.patch" size="1741" author="aniket486" created="Sat, 23 Nov 2013 01:58:29 +0000"/>
                            <attachment id="12615770" name="PIG-3581-2.patch" size="3657" author="aniket486" created="Tue, 26 Nov 2013 02:22:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 25 Nov 2013 18:02:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>359038</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzjqjz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>359328</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>