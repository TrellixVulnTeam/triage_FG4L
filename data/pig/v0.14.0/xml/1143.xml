<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:05:27 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1143/PIG-1143.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1143] Poisson Sample Loader should compute the number of samples required only once</title>
                <link>https://issues.apache.org/jira/browse/PIG-1143</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The current poisson sampler forces each of the maps to compute the sample number. This is redundant and causes issues when a large directory is specified in the join. The sampler should be changed to calculate the sample count only once and this information should be shared with the remaining mappers.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12442931">PIG-1143</key>
            <summary>Poisson Sample Loader should compute the number of samples required only once</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sriranjan">Sriranjan Manjunath</assignee>
                                    <reporter username="sriranjan">Sriranjan Manjunath</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Dec 2009 00:10:16 +0000</created>
                <updated>Wed, 24 Mar 2010 22:16:01 +0000</updated>
                            <resolved>Tue, 22 Dec 2009 18:24:03 +0000</resolved>
                                                    <fixVersion>0.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12788971" author="sriranjan" created="Thu, 10 Dec 2009 22:24:43 +0000"  >&lt;p&gt;To describe the problem in more detail, the current implementation does not handle a glob efficiently. When the sample loader encounters a directory (or combinations thereof), it gets the element descriptors of all the files inside the directory to compute the file sizes.&lt;br/&gt;
For ex: A = load &quot;&lt;/p&gt;
{view, click}
&lt;p&gt;&quot; will result in computing file sizes of all the files underneath both &quot;view&quot; and &quot;click&quot; directories. If we have a large number of mappers, this will result in a ton of hdfs system calls, clogging the name node.&lt;/p&gt;

&lt;p&gt;I intend to modify Poisson Sample Loader as follows. The algorithm for computing the total number of samples remains the same. However, it will not be computed by every mapper. I will be using the UDFContext object to share this information across mappers. Since mapper/ reducers can only read the information from UDFContext, the slicer will store this information. The slicer will compute the sampler count for the first map. As before, PigSlice will call computeSamples() for the first map. It will then store this value as a property in the UDFContext object. The Slicer will check UDFContext to see if this value is set and if it is, it will use it instead of computing it again. I intend to use &quot;pig.input.0.sampleCount&quot; as the key.&lt;/p&gt;

&lt;p&gt;This solution will reduce the fileSize() invocations to a minimum and should reduce the burden on the name node.&lt;/p&gt;</comment>
                            <comment id="12788998" author="olgan" created="Thu, 10 Dec 2009 22:59:34 +0000"  >&lt;p&gt;Sounds like a good approach. We need to figure out how this will translate into Load-Store redesign and make sure to port it there once the patch is available.&lt;/p&gt;</comment>
                            <comment id="12789013" author="thejas" created="Thu, 10 Dec 2009 23:21:41 +0000"  >&lt;p&gt;The PoissonSampleLoader implementation in Load-store redesign does not check the file size and has a different approach for the following reason (as mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1062&quot; title=&quot;load-store-redesign branch: change SampleLoader and subclasses to work with new LoadFunc interface &quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1062&quot;&gt;&lt;del&gt;PIG-1062&lt;/del&gt;&lt;/a&gt;) -&lt;/p&gt;

&lt;p&gt;With new interfaces in load-store redesign, pig can compute the file size by adding up size of each split (from InputSplit.getLenght()) . But the documentation of the function does not make it clear if this is size on disk , compressed/uncompressed etc. Looks like it just needs to be some number proportional to size of the file. Assuming it is size on disk (uncompressed), using this to estimate the total memory it will require is tricky, one has to make assumptions about the compression ratio and the serialization method.&lt;br/&gt;
Using Tuple.getMemorySize() while sampling will give more accurate numbers for reducer memory that it will consume. &lt;/p&gt;</comment>
                            <comment id="12789015" author="thejas" created="Thu, 10 Dec 2009 23:23:07 +0000"  >&lt;p&gt;To summarize my above comment, the approach in load-store redesign of not using the file-size at all is better .&lt;/p&gt;</comment>
                            <comment id="12789023" author="sriranjan" created="Thu, 10 Dec 2009 23:30:20 +0000"  >&lt;p&gt;The file size in the documentation refers to the size on disk. In order to account for compression, encoding etc. a configurable parameter - pig.inputfile.conversionfactor is provided. I agree that this cannot be set to a good value for compressed data. It is just a guidance. The implications of setting it to a bad value are minimal - we will end up sampling little more than the required number of samples (unless you set it to a fraction).&lt;/p&gt;</comment>
                            <comment id="12789046" author="thejas" created="Fri, 11 Dec 2009 00:14:26 +0000"  >&lt;p&gt;Pig input does not have to be a file, the LoadFunc could be reading from HBase or some other source. So the use of FileLocalizer.getSize(fname,pcProps) will not work in all cases.&lt;br/&gt;
 InputSplits.getLength() can be used instead, but as per the documentation, the purpose of  InputSplits.getLength() is &quot;so that the input splits can be sorted by size&quot;. So implementations might just give a number that is proportional to the size if they don&apos;t have access to actual size. &lt;/p&gt;

&lt;p&gt;Even if the actual file size on disk is available through  InputSplits.getLength(), in case of columnar storage the compression can be very high (eg run-length encoding of column that is sort key with only few unique values), and we might end up sampling very little.&lt;/p&gt;</comment>
                            <comment id="12789063" author="sriranjan" created="Fri, 11 Dec 2009 01:15:35 +0000"  >&lt;p&gt;I am OK with using InputSplits.getLength() as long as these provide you a good estimate of the file size. Without the population size, poisson samplers do now work well.&lt;/p&gt;

&lt;p&gt;Samplers expect the data to be in BinStorage. If not, the first job reads it and stores it into BinStorage. The only exception being if the join follows a load/store only MR job.&lt;/p&gt;</comment>
                            <comment id="12789064" author="sriranjan" created="Fri, 11 Dec 2009 01:19:52 +0000"  >&lt;p&gt;&lt;b&gt;now&lt;/b&gt; should have been &lt;b&gt;not&lt;/b&gt;!&lt;/p&gt;</comment>
                            <comment id="12789069" author="thejas" created="Fri, 11 Dec 2009 01:38:36 +0000"  >&lt;p&gt;If the data is going to be in BinStorage, my comments regarding the approach for this patch are not applicable. But the patch does not need to be ported to load-store redesign branch.&lt;/p&gt;</comment>
                            <comment id="12790566" author="hadoopqa" created="Tue, 15 Dec 2009 05:24:16 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12427980/PIG_1143.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12427980/PIG_1143.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 890553.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/123/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/123/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/123/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/123/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/123/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/123/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12790900" author="olgan" created="Tue, 15 Dec 2009 19:21:55 +0000"  >&lt;p&gt;I am reviewing this patch&lt;/p&gt;</comment>
                            <comment id="12790983" author="olgan" created="Tue, 15 Dec 2009 22:11:33 +0000"  >&lt;p&gt;I think this needs to be tested with multiple skew joins both in a case of single store and multiquery. Please, add unit tests&lt;/p&gt;</comment>
                            <comment id="12791796" author="sriranjan" created="Thu, 17 Dec 2009 05:58:38 +0000"  >&lt;p&gt;I have added the successive join and multiquery unit tests.&lt;/p&gt;</comment>
                            <comment id="12791872" author="hadoopqa" created="Thu, 17 Dec 2009 10:51:00 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12428266/PIG_1143.patch.1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12428266/PIG_1143.patch.1&lt;/a&gt;&lt;br/&gt;
  against trunk revision 891499.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/135/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/135/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/135/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/135/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/135/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/135/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12793296" author="olgan" created="Mon, 21 Dec 2009 18:45:14 +0000"  >&lt;p&gt;+1 on the code changes. There is a extra debug trace in the code that I will remove as part of the commit&lt;/p&gt;</comment>
                            <comment id="12793322" author="olgan" created="Mon, 21 Dec 2009 19:53:35 +0000"  >&lt;p&gt;patch committed to the trunk. Will commit to 0.6 branch tomorrow.&lt;/p&gt;</comment>
                            <comment id="12793710" author="olgan" created="Tue, 22 Dec 2009 18:24:03 +0000"  >&lt;p&gt;patch committed to 0.6.0 branch. Thanks, Sri!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12427980" name="PIG_1143.patch" size="11296" author="sriranjan" created="Tue, 15 Dec 2009 00:17:25 +0000"/>
                            <attachment id="12428266" name="PIG_1143.patch.1" size="13788" author="sriranjan" created="Thu, 17 Dec 2009 05:58:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 10 Dec 2009 22:59:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164665</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyan1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96044</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>