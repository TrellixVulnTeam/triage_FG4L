<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:52:12 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2184/PIG-2184.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2184] Not able to provide positional reference to macro invocations</title>
                <link>https://issues.apache.org/jira/browse/PIG-2184</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;It looks like the macro functionality doesnt support for positional references. The below is an example script;&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------------------&lt;br/&gt;
DEFINE my_macro (X,key) returns Y&lt;/p&gt;
        {
        tmp1 = foreach  $X generate TOKENIZE((chararray)$key) as tokens;
        tmp2 = foreach tmp1 generate flatten(tokens);
        tmp3 = order tmp2 by $0;
        $Y = distinct tmp3;
        }

&lt;p&gt;A = load &apos;sometext&apos; using TextLoader() as (row1) ;&lt;br/&gt;
E = my_macro(A,A.$0);&lt;br/&gt;
dump E;&lt;br/&gt;
----------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;This script execution fails at parsing staging itself;&lt;/p&gt;

&lt;p&gt;org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1000: Error during parsing. &amp;lt;file try1.pig, line 16,&lt;br/&gt;
column 16&amp;gt;  mismatched input &apos;.&apos; expecting RIGHT_PAREN&lt;/p&gt;

&lt;p&gt;If i replace A.$0 with the field name ie row1 the script runs fine.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12514890">PIG-2184</key>
            <summary>Not able to provide positional reference to macro invocations</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xutingz">xuting zhao</assignee>
                                    <reporter username="vivekp">Vivek Padmanabhan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 Jul 2011 12:16:14 +0100</created>
                <updated>Thu, 26 Apr 2012 21:32:44 +0100</updated>
                            <resolved>Thu, 17 Nov 2011 08:39:12 +0000</resolved>
                                    <version>0.9.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13145697" author="olgan" created="Mon, 7 Nov 2011 18:47:23 +0000"  >&lt;p&gt;Hi Xuting, Could you take a look at this when you get a chance.&lt;/p&gt;</comment>
                            <comment id="13147896" author="daijy" created="Thu, 10 Nov 2011 18:33:58 +0000"  >&lt;p&gt;The script seems not right. Macro only do literal substitution, so with&lt;br/&gt;
E = my_macro(A,A.$0);&lt;/p&gt;

&lt;p&gt;We will get &quot;tmp1 = foreach $X generate TOKENIZE((chararray)A.$0) as tokens;&quot;, which is wrong.&lt;/p&gt;

&lt;p&gt;However, &quot;E = my_macro(A,$0);&quot; also does not work. We should fix this case. There are two issues:&lt;br/&gt;
1. in parser, my_macro(A, $0) is not allowed, we need to allow this&lt;br/&gt;
2. in param substitution, $0 is not a valid value, we need to fix&lt;/p&gt;</comment>
                            <comment id="13147926" author="xutingz" created="Thu, 10 Nov 2011 19:03:08 +0000"  >&lt;p&gt;Hi Daniel,&lt;/p&gt;

&lt;p&gt;   Thanks for the comments. I guess this also explains the error I got after modifing the parser and passing the A.$0 as parameter into the macrio function. One thing I am not sure is if we allow parameter $0, then how can we know which dataset $0 stands for? For example, if my_macro only contains one parameter and user called my_macro($0)?&lt;/p&gt;

&lt;p&gt;Best,&lt;br/&gt;
Xuting&lt;/p&gt;</comment>
                            <comment id="13148210" author="alangates" created="Fri, 11 Nov 2011 01:56:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;in param substitution, $0 is not a valid value, we need to fix&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;How do we need to fix this?  $0 shouldn&apos;t be a valid parameter substitution.&lt;/p&gt;</comment>
                            <comment id="13148213" author="daijy" created="Fri, 11 Nov 2011 02:03:55 +0000"  >&lt;p&gt;Hi, Alan,&lt;br/&gt;
Here we need to replace &apos;key&apos; to &quot;$0&quot;. Parameter substitution does not allow &quot;$0&quot; to be the value, but seems it takes &quot;&lt;br class=&quot;atl-forced-newline&quot; /&gt;$0&quot;. This works but I am not if there&apos;s a better fix.&lt;/p&gt;</comment>
                            <comment id="13149814" author="daijy" created="Mon, 14 Nov 2011 18:57:10 +0000"  >&lt;p&gt;As per Pig Macro doc, Pig macros support four types of parameters:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;alias (IDENTIFIER)&lt;/li&gt;
	&lt;li&gt;integer&lt;/li&gt;
	&lt;li&gt;float&lt;/li&gt;
	&lt;li&gt;string literal (quoted string)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;We shall add one more:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;field (IDENTIFIER or position in the form $int)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Which the new definition, we will not allow &quot;A.$0&quot;, since this is a mix of alias and field.&lt;/p&gt;</comment>
                            <comment id="13150153" author="xutingz" created="Tue, 15 Nov 2011 01:25:02 +0000"  >&lt;p&gt; I use the method which adds &quot;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&quot; in front of the dollar variable. If we call the Matcher.quoteReplacement(val) function in PreprocessorContext.java, it will be too general and as a result, there will be some problem in parameter substitution. For example, &apos;\&apos; will be added in front of URL parameters.&lt;/p&gt;


&lt;p&gt; Ant test-commit has been run successfully and a new Junit test has been added into the test/org/apache/pig/test/TestMacroExpansion.java. The old Junit test of &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2081&quot; title=&quot;Dryrun gives wrong line numbers in error message for scripts containing macro.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2081&quot;&gt;&lt;del&gt;PIG-2081&lt;/del&gt;&lt;/a&gt; has been removed because it is about adding error message under this situation &lt;/p&gt;</comment>
                            <comment id="13150682" author="daijy" created="Tue, 15 Nov 2011 19:06:23 +0000"  >&lt;p&gt;Sounds good. Running the tests.&lt;/p&gt;</comment>
                            <comment id="13151904" author="daijy" created="Thu, 17 Nov 2011 08:39:12 +0000"  >&lt;p&gt;Unit test pass. test-patch:&lt;/p&gt;

&lt;p&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; -1 overall.  &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 @author.  The patch does not contain any @author tags.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 tests included.  The patch appears to include 3 new or modified tests.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     -1 javac.  The applied patch generated 964 javac compiler warnings (more than the trunk&apos;s current 962 warnings).&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     -1 release audit.  The applied patch generated 475 release audit warnings (more than the trunk&apos;s current 468 warnings).&lt;/p&gt;

&lt;p&gt;javac warning is in generated file. No new file added so ignore release audit warning.&lt;/p&gt;

&lt;p&gt;Patch committed to trunk and 0.10 branch.&lt;/p&gt;

&lt;p&gt;Thanks Xuting!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12503703" name="2184.patch" size="2890" author="xutingz" created="Tue, 15 Nov 2011 01:17:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 7 Nov 2011 18:47:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>46024</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyaw13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97500</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>