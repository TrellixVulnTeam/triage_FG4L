<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:54:22 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3247/PIG-3247.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3247] Piggybank functions to mimic OVER clause in SQL</title>
                <link>https://issues.apache.org/jira/browse/PIG-3247</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;In order to test Hive I have written some UDFs to mimic the behavior of SQL&apos;s OVER clause.  I thought they would be useful to share.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12636896">PIG-3247</key>
            <summary>Piggybank functions to mimic OVER clause in SQL</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="alangates">Alan Gates</assignee>
                                    <reporter username="alangates">Alan Gates</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Mar 2013 23:12:22 +0000</created>
                <updated>Mon, 14 Oct 2013 17:46:12 +0100</updated>
                            <resolved>Fri, 19 Jul 2013 23:00:55 +0100</resolved>
                                                    <fixVersion>0.12.0</fixVersion>
                                    <component>piggybank</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13601801" author="alangates" created="Wed, 13 Mar 2013 23:25:45 +0000"  >&lt;p&gt;Basic OVER functionality can be accomplished in Pig using GROUP BY and FOREACH FLATTEN.  For example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
select s, min(i) over (partition by s) from T
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;is done in Pig as:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
A = load &apos;T&apos;;
B = group A by s;
C = foreach B generate flatten(A), MIN(A.i) as min;
D = foreach C generate A::s, min;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But as soon as a windowing clause is added this no longer works because the function needs to be called once for each row in the bag and only a subset of the bag should be passed to the function.  To address this I&apos;ve added two new functions:&lt;/p&gt;

&lt;p&gt;Stitch - Given multiple bags this stitches them together row by row.  So if you have two bags:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
bag A:
{ (1, 2), 
  (3, 4) }
bag B
{ (a, b),
  (c, d) }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then Stitch(A, B) will return&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{ (1, 2, a, b),
  (3, 4, c, d) }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Over - Implements the standard SQL windowing and analytic functions, including : rank, dense_rank, cume_dist, percent_rank, ntile, first_value, last_value, lead, and lag.  Together these can be used to do windowing and analytics functions in Pig.&lt;/p&gt;

&lt;p&gt;Pig already has rank and dense_rank, and this is in no way meant to replace that.  This is meant to mimic exactly the SQL functionality.  Also, these functions make no allowance for large sets that don&apos;t fit in memory on a single reducer.  &lt;/p&gt;</comment>
                            <comment id="13614353" author="alangates" created="Tue, 26 Mar 2013 17:45:15 +0000"  >&lt;p&gt;A new version of the patch that fixes an error in the percent_rank calculation and adds the ability to specify the return type of the Over function.&lt;/p&gt;</comment>
                            <comment id="13668599" author="cheolsoo" created="Tue, 28 May 2013 20:53:29 +0100"  >&lt;p&gt;+1. Looks good to me.&lt;/p&gt;

&lt;p&gt;There is a typo in the comment in Over.java: teh -&amp;gt; the.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Over.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 * indicates teh current record.  If not specified 0 is the &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13714130" author="alangates" created="Fri, 19 Jul 2013 23:00:55 +0100"  >&lt;p&gt;Patch committed.  Thanks Cheolsoo for the review.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12575547" name="Over.2.patch" size="101227" author="alangates" created="Tue, 26 Mar 2013 17:45:15 +0000"/>
                            <attachment id="12573627" name="Over.patch" size="98333" author="alangates" created="Thu, 14 Mar 2013 00:06:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 28 May 2013 19:53:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>317388</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzcm6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>317729</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Added OVER clause like functionality in Piggybank.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>