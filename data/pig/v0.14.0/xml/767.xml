<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:50:31 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-767/PIG-767.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-767] Schema reported from DESCRIBE and actual schema of inner bags are different.</title>
                <link>https://issues.apache.org/jira/browse/PIG-767</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The following script:&lt;/p&gt;

&lt;p&gt;urlContents = LOAD &apos;inputdir&apos; USING BinStorage() AS (url:bytearray, pg:bytearray);&lt;br/&gt;
&amp;#8211; describe and dump are in-sync&lt;br/&gt;
DESCRIBE urlContents;&lt;br/&gt;
DUMP urlContents;&lt;/p&gt;

&lt;p&gt;urlContentsG = GROUP urlContents BY url;&lt;br/&gt;
DESCRIBE urlContentsG;&lt;/p&gt;

&lt;p&gt;urlContentsF = FOREACH urlContentsG GENERATE group,urlContents.pg;&lt;/p&gt;

&lt;p&gt;DESCRIBE urlContentsF;&lt;br/&gt;
DUMP urlContentsF;&lt;/p&gt;


&lt;p&gt;Prints for the DESCRIBE commands:&lt;/p&gt;

&lt;p&gt;urlContents: &lt;/p&gt;
{url: chararray,pg: chararray}
&lt;p&gt;urlContentsG: {group: chararray,urlContents: {url: chararray,pg: chararray}}&lt;br/&gt;
urlContentsF: {group: chararray,pg: {pg: chararray}}&lt;/p&gt;

&lt;p&gt;The reported schemas for urlContentsG and urlContentsF are wrong. They are also against the section &quot;Schemas for Complex Data Types&quot; in &lt;a href=&quot;http://wiki.apache.org/pig-data/attachments/FrontPage/attachments/plrm.htm#_Schemas&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/pig-data/attachments/FrontPage/attachments/plrm.htm#_Schemas&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;As expected, actual data observed from DUMP urlContentsG and DUMP urlContentsF do contain the tuple inside the inner bags.&lt;/p&gt;

&lt;p&gt;The correct schema for urlContentsG is:  {group: chararray,urlContents: {t1:(url: chararray,pg: chararray)}}&lt;/p&gt;

&lt;p&gt;This may sound like a technicality, but it isn&apos;t. For instance, a UDF that assumes an inner bag of &lt;/p&gt;
{chararray}
&lt;p&gt; will not work with &lt;/p&gt;
{(chararray)}
&lt;p&gt;. &lt;/p&gt;


</description>
                <environment></environment>
        <key id="12422976">PIG-767</key>
            <summary>Schema reported from DESCRIBE and actual schema of inner bags are different.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="gmavromatis">George Mavromatis</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Apr 2009 05:43:29 +0100</created>
                <updated>Thu, 4 Aug 2011 01:35:01 +0100</updated>
                            <resolved>Mon, 24 Jan 2011 18:28:39 +0000</resolved>
                                                    <fixVersion>0.9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12699810" author="sms" created="Thu, 16 Apr 2009 20:07:31 +0100"  >&lt;p&gt;Firstly, the describe output is broken for bags in some cases. You will not see the inner tuple (t1 in your example). This can be fixed. It will not cause any problems for the runtime execution.&lt;/p&gt;

&lt;p&gt;Bags are containers of tuples. There are no bags that do not contain tuples unless the bags are empty. As a result, UDFs that assume an inner bag of chararray will always get a bag with chararray.&lt;/p&gt;

&lt;p&gt;I am pasting the output of similar queries and you should see the inner tuples in the output. Notice that you see the tuples in the bags. Also notice that the bags in the describe output do not have the inner tuples.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

grunt&amp;gt; a = load &apos;/user/sms/data/student_tab.data&apos; as (name: chararray, age:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, gpa: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;);
grunt&amp;gt; b = group a by age; 

grunt&amp;gt; describe b;
b: {group: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,a: {name: chararray,age: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,gpa: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;}}

grunt&amp;gt; dump b;
(19,{(John,19,3.8F),(Jack,19,3.1F)})
(20,{(Joe,20,3.5F),(Harry,20,3.2F),(Govinda,20,4.0F)})

grunt&amp;gt; c = foreach b generate group, a.gpa;

grunt&amp;gt; describe c;
c: {group: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,gpa: {gpa: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;}}

grunt&amp;gt; dump c;
(19,{(3.8F),(3.1F)})
(20,{(3.5F),(3.2F),(4.0F)})
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12699832" author="gmavromatis" created="Thu, 16 Apr 2009 21:05:09 +0100"  >&lt;p&gt;Santosh: You are saying the exact same thing I said, i.e. that inner bags contain tuples and that describe does not report the tuples in the schema it prints. That&apos;s precisely the bug.&lt;/p&gt;

&lt;p&gt;Our examples are in fact similar too! I hope that my description shows that I understand that inner bags contain tuples (&quot;As expected, actual data observed from DUMP... contain the tuple inside the inner bags&quot;).&lt;/p&gt;</comment>
                            <comment id="12699842" author="sms" created="Thu, 16 Apr 2009 21:25:17 +0100"  >&lt;p&gt;As a reference, please look at &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-449&quot; title=&quot;Schemas for bags should contain tuples all the time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-449&quot;&gt;&lt;del&gt;PIG-449&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The tuple inside a bag cannot be accessed by name or position. There are no semantics that support accessing a tuple inside a bag. However, the contents of the tuple inside a bag are accessible. As such, the presence or absence of a tuple inside a bag (as part of the schema) in the describe output does not matter.&lt;/p&gt;

&lt;p&gt;E.g.: urlContentsG: {group: chararray,urlContents: {t1:(url: chararray,pg: chararray)}} &lt;br/&gt;
In the above schema, you can access urlContents.url. You will not be able to access urlContents.t1&lt;/p&gt;

&lt;p&gt;An example to illustrate this point follows:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
grunt&amp;gt; a = load &apos;input&apos; as (bagColumn: bag{t: tuple(i: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, f: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)});
grunt&amp;gt; b = foreach a generate bagColumn.t;
2009-04-16 13:23:43,324 [main] ERROR org.apache.pig.tools.grunt.Grunt - ERROR 1028: Access to the tuple (t) of the bag is disallowed. Only access to the elements of the tuple in the bag is allowed.

Details at logfile: /homes/sms/src_pig/pig/trunk_optimizer_phase1/pig_1239908562989.log

grunt&amp;gt; c = foreach a generate bagColumn.i;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12979726" author="daijy" created="Mon, 10 Jan 2011 20:06:37 +0000"  >&lt;p&gt;The only place we generate bag schema without tuple inside is LOGroup. Attach &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-767&quot; title=&quot;Schema reported from DESCRIBE and actual schema of inner bags are different.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-767&quot;&gt;&lt;del&gt;PIG-767&lt;/del&gt;&lt;/a&gt;-1.patch to change LOGroup schema generation in new logical plan. Once describe migrate to new logical plan, this issue is fixed.&lt;/p&gt;</comment>
                            <comment id="12980978" author="daijy" created="Wed, 12 Jan 2011 22:36:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-767&quot; title=&quot;Schema reported from DESCRIBE and actual schema of inner bags are different.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-767&quot;&gt;&lt;del&gt;PIG-767&lt;/del&gt;&lt;/a&gt;-2.patch fix all unit test failures.&lt;/p&gt;</comment>
                            <comment id="12983416" author="rding" created="Tue, 18 Jan 2011 22:38:55 +0000"  >
&lt;p&gt;Together with &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1786&quot; title=&quot;Move describe/nested describe to new logical plan&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1786&quot;&gt;&lt;del&gt;PIG-1786&lt;/del&gt;&lt;/a&gt;, the output of above describe commands is&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
urlContents: {url: bytearray,pg: bytearray}
urlContentsG: {group: bytearray,urlContents: {(url: bytearray,pg: bytearray)}}
urlContentsF: {group: bytearray,{pg: bytearray}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;should the output for urlContentsF be &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
urlContentsF: {group: bytearray,{(pg: bytearray)}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12983503" author="daijy" created="Wed, 19 Jan 2011 02:30:32 +0000"  >&lt;p&gt;It is depend on &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1786&quot; title=&quot;Move describe/nested describe to new logical plan&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1786&quot;&gt;&lt;del&gt;PIG-1786&lt;/del&gt;&lt;/a&gt; to move describe to new logical plan. Once &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1786&quot; title=&quot;Move describe/nested describe to new logical plan&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1786&quot;&gt;&lt;del&gt;PIG-1786&lt;/del&gt;&lt;/a&gt; commit, we will see the right schema.&lt;/p&gt;</comment>
                            <comment id="12984504" author="daijy" created="Fri, 21 Jan 2011 00:44:28 +0000"  >&lt;p&gt;Richard is right. Miss the change in Dereference in original patch. Attach &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-767&quot; title=&quot;Schema reported from DESCRIBE and actual schema of inner bags are different.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-767&quot;&gt;&lt;del&gt;PIG-767&lt;/del&gt;&lt;/a&gt;-3.patch.&lt;/p&gt;</comment>
                            <comment id="12985505" author="daijy" created="Mon, 24 Jan 2011 03:56:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-767&quot; title=&quot;Schema reported from DESCRIBE and actual schema of inner bags are different.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-767&quot;&gt;&lt;del&gt;PIG-767&lt;/del&gt;&lt;/a&gt;-4.patch fix unit test failure of &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-767&quot; title=&quot;Schema reported from DESCRIBE and actual schema of inner bags are different.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-767&quot;&gt;&lt;del&gt;PIG-767&lt;/del&gt;&lt;/a&gt;-3.patch&lt;/p&gt;</comment>
                            <comment id="12985876" author="daijy" created="Mon, 24 Jan 2011 18:28:39 +0000"  >&lt;p&gt;Review notes: &lt;a href=&quot;https://reviews.apache.org/r/278/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/278/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12985878" author="daijy" created="Mon, 24 Jan 2011 18:28:57 +0000"  >&lt;p&gt;Patch committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12494673">PIG-1786</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12467916" name="PIG-767-1.patch" size="3272" author="daijy" created="Mon, 10 Jan 2011 20:06:37 +0000"/>
                            <attachment id="12468179" name="PIG-767-2.patch" size="18004" author="daijy" created="Wed, 12 Jan 2011 22:36:22 +0000"/>
                            <attachment id="12468932" name="PIG-767-3.patch" size="21467" author="daijy" created="Fri, 21 Jan 2011 00:44:28 +0000"/>
                            <attachment id="12469118" name="PIG-767-4.patch" size="22939" author="daijy" created="Mon, 24 Jan 2011 03:56:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 16 Apr 2009 19:07:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>657</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyaio7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95336</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>