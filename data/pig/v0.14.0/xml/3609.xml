<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:04:51 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3609/PIG-3609.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3609] ClassCastException when calling compareTo method on&#160;AvroBagWrapper&#160;</title>
                <link>https://issues.apache.org/jira/browse/PIG-3609</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;One got the following exception when calling compareTo method on&#160;AvroBagWrapper with an AvroBagWrapper object:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.ClassCastException: org.apache.pig.impl.util.avro.AvroBagWrapper incompatible with java.util.Collection
        at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericData.compare(GenericData.java:786)
        at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericData.compare(GenericData.java:760)
        at org.apache.pig.impl.util.avro.AvroBagWrapper.compareTo(AvroBagWrapper.java:78)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looking at the code, it compares objects with different types:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; GenericData.get().compare(theArray, o, theArray.getSchema());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12682761">PIG-3609</key>
            <summary>ClassCastException when calling compareTo method on&#160;AvroBagWrapper&#160;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rding">Richard Ding</assignee>
                                    <reporter username="rding">Richard Ding</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Dec 2013 20:03:39 +0000</created>
                <updated>Mon, 7 Jul 2014 19:07:59 +0100</updated>
                            <resolved>Tue, 24 Dec 2013 04:53:07 +0000</resolved>
                                    <version>0.12.0</version>
                                    <fixVersion>0.13.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13840760" author="rding" created="Fri, 6 Dec 2013 00:59:12 +0000"  >&lt;p&gt;Attaching a patch.&lt;/p&gt;</comment>
                            <comment id="13841824" author="rding" created="Fri, 6 Dec 2013 22:42:40 +0000"  >&lt;p&gt;New patch with a test case.&lt;/p&gt;</comment>
                            <comment id="13852224" author="cheolsoo" created="Wed, 18 Dec 2013 22:08:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rding&quot; class=&quot;user-hover&quot; rel=&quot;rding&quot;&gt;Richard Ding&lt;/a&gt;, I don&apos;t think the following is correct-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      AvroBagWrapper bOther = (AvroBagWrapper) o;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.size() != bOther.size()) {
+          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.size() &amp;gt; bOther.size()) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 1;
+          &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; -1;
+      }
+      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; GenericData.get().compare(theArray, bOther.theArray, theArray.getSchema());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When comparing arrays, we should compare entries one by one before comparing the size of arrays, shouldn&apos;t we? At least, that&apos;s how GenericData#compare() works for arrays-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; ARRAY:
      Collection a1 = (Collection)o1;
      Collection a2 = (Collection)o2;
      Iterator e1 = a1.iterator();
      Iterator e2 = a2.iterator();
      Schema elementType = s.getElementType();
      &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;(e1.hasNext() &amp;amp;&amp;amp; e2.hasNext()) {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; compare = compare(e1.next(), e2.next(), elementType, equals);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (compare != 0) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; compare;
      }
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; e1.hasNext() ? 1 : (e2.hasNext() ? -1 : 0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think we should just call GenericData#compare() w/o comparing the size.&lt;/p&gt;

&lt;p&gt;In addition, I found your test case a bit confusing. Since getExpect() returns a set which doesn&apos;t guarantee any ordering, it&apos;s not clear how arrays are mapped to bw0, bw1, and bw2. That makes it hard to reason about the assertions.&lt;/p&gt;</comment>
                            <comment id="13852228" author="cheolsoo" created="Wed, 18 Dec 2013 22:11:55 +0000"  >&lt;p&gt;I am attaching a patch that addresses my comments. I&apos;ll commit this if you agree. Thank!&lt;/p&gt;</comment>
                            <comment id="13856041" author="rding" created="Tue, 24 Dec 2013 00:14:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;, checking size is an optimization, this is also what DefaultAbstractBag implements. &lt;/p&gt;

&lt;p&gt;+1 on the patch.&lt;/p&gt;</comment>
                            <comment id="13856138" author="cheolsoo" created="Tue, 24 Dec 2013 04:53:07 +0000"  >&lt;p&gt;Committed to trunk. Thank you Richard!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12617283" name="PIG-3609.patch" size="1261" author="rding" created="Fri, 6 Dec 2013 00:59:12 +0000"/>
                            <attachment id="12617491" name="PIG-3609_2.patch" size="7595" author="rding" created="Fri, 6 Dec 2013 22:42:40 +0000"/>
                            <attachment id="12619420" name="PIG-3609_3.patch" size="6750" author="cheolsoo" created="Wed, 18 Dec 2013 22:11:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 18 Dec 2013 22:08:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>362018</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzk8yf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>362313</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>