<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:08:40 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-993/PIG-993.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-993] [zebra] Abitlity to drop a column group in a table</title>
                <link>https://issues.apache.org/jira/browse/PIG-993</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;A Zebra table is stored as multiple sub tables each containing a set of columns called column group (CG). The user specifies how these columns are grouped while creating a table through the &lt;em&gt;storage hint&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;For some of the large tables, it might be necessary for users to remove a set of columns and retain the rest. This jira provides a way for users to delete an entire column group. &lt;/p&gt;

&lt;p&gt;The following comments will have more details on API and the semantics. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12437166">PIG-993</key>
            <summary>[zebra] Abitlity to drop a column group in a table</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rangadi">Raghu Angadi</assignee>
                                    <reporter username="rangadi">Raghu Angadi</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Oct 2009 23:37:54 +0100</created>
                <updated>Thu, 2 May 2013 03:29:27 +0100</updated>
                            <resolved>Fri, 16 Oct 2009 23:16:14 +0100</resolved>
                                                    <fixVersion>0.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12761766" author="rangadi" created="Fri, 2 Oct 2009 23:49:29 +0100"  >
&lt;p&gt;API  is pretty simple : &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
class org.apache.hadoop.zebra.BasicTable {
 /** see the patch &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; JavaDoc and attached example &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; usage */

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void dropColumnGroup(Path path,
                                   Configuration conf,   &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; cgName)
                               &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException { ... }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
	&lt;li&gt;Table schema is not modified.&lt;/li&gt;
	&lt;li&gt;this API takes a name for a column group. &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-986&quot; title=&quot;[zebra] Zebra Column Group Naming Support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-986&quot;&gt;&lt;del&gt;PIG-986&lt;/del&gt;&lt;/a&gt; adds explicit names for CGs.&lt;/li&gt;
	&lt;li&gt;Once a CGs is deleted, NULL is returned for the fields that were stored in the CG.
	&lt;ul&gt;
		&lt;li&gt;This is the main difference between just manually deleting  a directory on filesystem and &apos;properly&apos; deleting a CG.&lt;/li&gt;
		&lt;li&gt;Many changes made in other parts of zebra are related to handling the missing CGs.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12761767" author="rangadi" created="Fri, 2 Oct 2009 23:52:57 +0100"  >&lt;p&gt;Deletion procedure : &lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Check if a column group with the given name exists and throw an error if there is no such group.&lt;/li&gt;
	&lt;li&gt;If the column group is already deleted return normally.
	&lt;ul&gt;
		&lt;li&gt;If a column group is already marked deleted and the corresponding physical directory still&lt;br/&gt;
        exists, try to remove the the column group data again. An earlier attempt might not have&lt;br/&gt;
        removed the directory.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Create a an empty file &quot;.deleted-CGNAME&quot; in the top level directory.&lt;/li&gt;
	&lt;li&gt;If the creation fails, check if the file already exists. This can happen when two users concurrently&lt;br/&gt;
      try to delete the same column group. If CG is marked deleted after this, return success. Exception is &lt;br/&gt;
      thrown for any other error.&lt;/li&gt;
	&lt;li&gt;Delete the column group directory.&lt;/li&gt;
	&lt;li&gt;An exception is thrown if deletion fails. Note that, column group is already marked deleted even though&lt;br/&gt;
      the deletion of a directory failed. A subsequent deletion of such a column group will again try to to delete the directory.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="12761768" author="rangadi" created="Sat, 3 Oct 2009 00:00:53 +0100"  >&lt;p&gt;Attachments ; &lt;/p&gt;

&lt;p&gt;  DropColumnGropuExample.java : a simple example to illustrate the functionality.&lt;/p&gt;

&lt;p&gt;  zebra-drop-cg.patch : This patch would apply only after a patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-896&quot; title=&quot;Pig doesnt run on Mac OSX&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-896&quot;&gt;&lt;del&gt;PIG-896&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;  Some of the tests included there are written by Jing Huang. Jing also helped with testing the patchon real clusters with various errors. Yan Zhou helped with correctly handling missing column groups.&lt;/p&gt;
</comment>
                            <comment id="12761769" author="rangadi" created="Sat, 3 Oct 2009 00:03:07 +0100"  >&lt;p&gt;&amp;gt; zebra-drop-cg.patch : This patch would apply only after a patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-896&quot; title=&quot;Pig doesnt run on Mac OSX&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-896&quot;&gt;&lt;del&gt;PIG-896&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
I meant say &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-986&quot; title=&quot;[zebra] Zebra Column Group Naming Support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-986&quot;&gt;&lt;del&gt;PIG-986&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12761793" author="yanz" created="Sat, 3 Oct 2009 02:12:47 +0100"  >&lt;p&gt;this patch should be applied after the patch for Jira992 has been applied.&lt;/p&gt;</comment>
                            <comment id="12761794" author="yanz" created="Sat, 3 Oct 2009 02:15:01 +0100"  >&lt;p&gt;This patych should be applied after the patch for Jira992 is applied.&lt;/p&gt;</comment>
                            <comment id="12762707" author="yanz" created="Tue, 6 Oct 2009 18:52:27 +0100"  >&lt;p&gt;The patch attached by me (Yan Zhou) was based upon Raghu&apos;s patch minus some unrelated changes.&lt;/p&gt;</comment>
                            <comment id="12762731" author="yanz" created="Tue, 6 Oct 2009 19:37:35 +0100"  >&lt;p&gt;Patch Reviewed +1&lt;/p&gt;</comment>
                            <comment id="12764552" author="rangadi" created="Mon, 12 Oct 2009 06:03:47 +0100"  >&lt;p&gt;This patch depends on &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-992&quot; title=&quot;[zebra] Separate Schema-related files into a &amp;quot;Schema&amp;quot; package&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-992&quot;&gt;&lt;del&gt;PIG-992&lt;/del&gt;&lt;/a&gt;. It is not a functional dependency and can be removed if required.&lt;/p&gt;</comment>
                            <comment id="12764746" author="yanz" created="Mon, 12 Oct 2009 17:57:48 +0100"  >&lt;p&gt;This new version  of patch is needed due to the upstream changes in Pig-992. Although this Jira is functionally independent of Pig-992, but the application sequence of the patches must be honored.&lt;/p&gt;</comment>
                            <comment id="12766581" author="hadoopqa" created="Fri, 16 Oct 2009 17:16:26 +0100"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12421881/zebra-drop-cg.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12421881/zebra-drop-cg.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 825712.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 33 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/88/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/88/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/88/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/88/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/88/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/88/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12766610" author="alangates" created="Fri, 16 Oct 2009 18:17:24 +0100"  >&lt;p&gt;When I run the zebra unit tests for this patch, I get a failure from org.apache.hadoop.zebra.io.TestCheckin.txt.  Output of that test attached.&lt;/p&gt;</comment>
                            <comment id="12766732" author="alangates" created="Fri, 16 Oct 2009 23:12:35 +0100"  >&lt;p&gt;We looked over the failure info and couldn&apos;t understand why it was failing.  I&apos;ve rerun the unit tests multiple times since and seen no issue.  We&apos;ve run it on several different machines and not seen an issue.  So I&apos;m going to declare the test failure a fluke and commit the patch.&lt;/p&gt;</comment>
                            <comment id="12766734" author="alangates" created="Fri, 16 Oct 2009 23:16:14 +0100"  >&lt;p&gt;Patch checked in.&lt;/p&gt;</comment>
                            <comment id="12766841" author="rangadi" created="Sat, 17 Oct 2009 07:40:11 +0100"  >
&lt;p&gt;I think the test needs to be fixed.  It deletes 6 column groups from 6 different threads. The spec explicitly states read accesses and parallel deletions expected to fail. But the table is always left in consistent state. The rationale for this is that in practice these tables are accessed from different machines and it would add unnecessary complication to support coordinate all the readers and the writers (especially with no locking support on HDFS). Zebra tables have no state outside the directory. This applies to writing as well.&lt;/p&gt;

&lt;p&gt;One options I see is to make each thread make multiple attempts in case of errors. &lt;/p&gt;
</comment>
                            <comment id="12771686" author="chaow" created="Thu, 29 Oct 2009 23:11:09 +0000"  >&lt;p&gt;Raghu&apos;s comment has been addressed in Jira 1057 :&lt;/p&gt;

&lt;p&gt;&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;Zebra&amp;#93;&lt;/span&gt; Zebra does not support concurrent deletions of column groups now.&quot;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12436954">PIG-986</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12437161">PIG-992</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12421170" name="DropColumnGroupExample.java" size="5081" author="rangadi" created="Sat, 3 Oct 2009 00:00:53 +0100"/>
                            <attachment id="12422374" name="TEST-org.apache.hadoop.zebra.io.TestCheckin.txt" size="36337" author="alangates" created="Fri, 16 Oct 2009 18:17:24 +0100"/>
                            <attachment id="12421881" name="zebra-drop-cg.patch" size="93658" author="yanz" created="Mon, 12 Oct 2009 18:05:07 +0100"/>
                            <attachment id="12421184" name="zebra-drop-cg.patch" size="53875" author="yanz" created="Sat, 3 Oct 2009 02:15:01 +0100"/>
                            <attachment id="12421171" name="zebra-drop-cg.patch" size="53933" author="rangadi" created="Sat, 3 Oct 2009 00:00:53 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 3 Oct 2009 01:12:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164528</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyala7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95759</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>