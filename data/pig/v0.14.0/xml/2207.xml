<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:50:51 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2207/PIG-2207.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2207] Support custom counters for aggregating warnings from different udfs</title>
                <link>https://issues.apache.org/jira/browse/PIG-2207</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Pig allows udfs to aggregate warning messages instead of writing out a separate warning message each time. Udfs can do this by logging the warning using EvalFunc.warn(String msg, Enum) call. But the udfs are forced to use PigWarning class if the warning needs to be printed at the end of the pig script . &lt;/p&gt;

&lt;p&gt;For example, with the changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2191&quot; title=&quot;Reduce amount of log spam generated by UDFs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2191&quot;&gt;&lt;del&gt;PIG-2191&lt;/del&gt;&lt;/a&gt;, some of the builtin udfs are using PigWarning.UDF_WARNING_1 as argument in calls to EvalFunc.warn. This will result in the warning count being printed on STDERR -&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2011-08-05 22:10:29,285 [main] WARN  org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher - Encountered Warning UDF_WARNING_1 2 time(s).
2011-08-05 22:10:29,285 [main] INFO  org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher - Success!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But it would be better if a udf such as the LOWER udf could use a custom warning counter, and the STDERR is like -&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2011-08-05 22:10:29,285 [main] WARN  org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher - Encountered Warning LOWER_FUNC_INPUT_WARNING 2 time(s).
2011-08-05 22:10:29,285 [main] INFO  org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher - Success!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A new function could be added to support this - (something like) EvalFunc.warn(String warnName, String warnMsg);  A specific counter group could be used for udf warnings (see org.apache.hadoop.mapred.Counters), and counters for that group could be done during final warning aggregation in done in MapReduceLauncher.computeWarningAggregate(). &lt;/p&gt;</description>
                <environment></environment>
        <key id="12518087">PIG-2207</key>
            <summary>Support custom counters for aggregating warnings from different udfs</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aniket486">Aniket Mokashi</assignee>
                                    <reporter username="thejas">Thejas M Nair</reporter>
                        <labels>
                            <label>newbie</label>
                    </labels>
                <created>Fri, 5 Aug 2011 23:34:35 +0100</created>
                <updated>Sun, 2 Feb 2014 05:37:49 +0000</updated>
                            <resolved>Thu, 23 Jan 2014 05:35:03 +0000</resolved>
                                                                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13080280" author="dvryaboy" created="Sat, 6 Aug 2011 00:01:10 +0100"  >&lt;p&gt;You read my mind.&lt;/p&gt;

&lt;p&gt;I think for starters, we should increment the warning counters in groups based on the UDF. Right now all the UDF_WARNING_1s roll together, but we could split them into MyUDF / UDF_WARNING_1, MyOtherUDF / UDF_WARNING_2&lt;/p&gt;

&lt;p&gt;I also think the warning message should be printed &quot;at least once&quot; &amp;#8211; just the counters alone aren&apos;t always sufficient. We could get this fairly cheaply by keeping a weakref hashmap of seen warnings, and logging the message every time we see a new warning.&lt;/p&gt;</comment>
                            <comment id="13082003" author="thejas" created="Wed, 10 Aug 2011 01:00:51 +0100"  >&lt;p&gt;It will not be a good idea for udfs to use separate counters until the next-gen mapreduce is in (MR-279). A large number of counters can cause the the job to be killed, for hadoop 0.20.x (see &lt;a href=&quot;https://issues.apache.org/jira/browse/MAPREDUCE-1943&quot; title=&quot;Implement limits on per-job JobConf, Counters, StatusReport, Split-Sizes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAPREDUCE-1943&quot;&gt;&lt;del&gt;MAPREDUCE-1943&lt;/del&gt;&lt;/a&gt;). MR-279 will enable much larger number of counters to be used.&lt;/p&gt;</comment>
                            <comment id="13082137" author="dvryaboy" created="Wed, 10 Aug 2011 06:05:55 +0100"  >&lt;p&gt;Your proposal suggests custom counters via strings, so we have this problem either way. At least making the group match the class that issues the warning constrains the space of possible counters to num_udfs x 4_generic_warnings, whereas the space of possible strings is (for our purposes) unlimited.&lt;/p&gt;</comment>
                            <comment id="13082556" author="thejas" created="Wed, 10 Aug 2011 19:46:13 +0100"  >&lt;blockquote&gt;&lt;p&gt;I also think the warning message should be printed &quot;at least once&quot; &#8211; just the counters alone aren&apos;t always sufficient. We could get this fairly cheaply by keeping a weakref hashmap of seen warnings, and logging the message every time we see a new warning.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This way the single line of warning can be printed in the backend (task) logs, but not in client to the user. It does not provide a means for the backend to client communication. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Your proposal suggests custom counters via strings, so we have this problem either way. At least making the group match the class that issues the warning constrains the space of possible counters to num_udfs x 4_generic_warnings, whereas the space of possible strings is (for our purposes) unlimited.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think the counter name should based on warnName + &lt;b&gt;first&lt;/b&gt; warnMsg, in EvalFunc.warn(String warnName, String warnMsg). That way a single warning message also will be displayed on client side, when warning aggregations is turned on. When warning aggregation is turned off, each warnMsg goes into log.&lt;/p&gt;

</comment>
                            <comment id="13082638" author="dvryaboy" created="Wed, 10 Aug 2011 21:09:40 +0100"  >&lt;p&gt;Right, the client communication is done via counters, and if they want to debug, they can go look in the logs. Other than syntax errors, all of my Pig job debugging starts with looking at task logs anyway.&lt;/p&gt;

&lt;p&gt;I see what you meant with the counter names now &amp;#8211; so the counter would be &quot;PigCounters.UDF_WARNING_1-dereferencing_null_in_LOWER&quot; for example. This accomplishes the goal of communicating the error to the client, but still produces many counters, which you just said goes against the recommendation in &lt;a href=&quot;https://issues.apache.org/jira/browse/MAPREDUCE-1943&quot; title=&quot;Implement limits on per-job JobConf, Counters, StatusReport, Split-Sizes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAPREDUCE-1943&quot;&gt;&lt;del&gt;MAPREDUCE-1943&lt;/del&gt;&lt;/a&gt;, and also makes the counter name too long &amp;#8211; 1943 restricts counter names to 64 chars.  &lt;/p&gt;

&lt;p&gt;What is the value of keeping all udf counters in the same group? &lt;/p&gt;</comment>
                            <comment id="13082658" author="thejas" created="Wed, 10 Aug 2011 21:42:24 +0100"  >&lt;blockquote&gt;&lt;p&gt;What is the value of keeping all udf counters in the same group? &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;On the client side that will help finding which counters are warning counters, so that those can be printed.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Other than syntax errors, all of my Pig job debugging starts with looking at task logs anyway.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I was thinking of the case where you don&apos;t know that you are supposed to start debugging &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; . I guess, the generic udf warnings counter could might be good enough for that.&lt;/p&gt;

&lt;p&gt;The 64 char limit would be another reason why what I proposed will not work with &lt;a href=&quot;https://issues.apache.org/jira/browse/MAPREDUCE-1943&quot; title=&quot;Implement limits on per-job JobConf, Counters, StatusReport, Split-Sizes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAPREDUCE-1943&quot;&gt;&lt;del&gt;MAPREDUCE-1943&lt;/del&gt;&lt;/a&gt;. But even MR-279 might also end up having such limitations in the future. (Unless pig ships with a custom MR application master!) &lt;/p&gt;</comment>
                            <comment id="13082661" author="thejas" created="Wed, 10 Aug 2011 21:44:06 +0100"  >&lt;p&gt;I think for now, it makes sense to go with what Dmitriy proposed in his first comment .&lt;/p&gt;</comment>
                            <comment id="13875536" author="aniket486" created="Sat, 18 Jan 2014 03:59:39 +0000"  >&lt;p&gt;RB:&lt;a href=&quot;https://reviews.apache.org/r/17087/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/17087/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13879456" author="aniket486" created="Thu, 23 Jan 2014 05:34:57 +0000"  >&lt;p&gt;Committed to trunk! Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;Daniel Dai&lt;/a&gt; for the review.&lt;/p&gt;</comment>
                            <comment id="13880162" author="daijy" created="Thu, 23 Jan 2014 18:11:16 +0000"  >&lt;p&gt;Also this is a minor backward incompatibility change, we need to put it in &quot;INCOMPATIBLE CHANGES&quot; section, and properly document it.&lt;/p&gt;</comment>
                            <comment id="13880217" author="aniket486" created="Thu, 23 Jan 2014 18:55:38 +0000"  >&lt;p&gt;Backward&apos;s incompatible because someone consuming the counter programmatically would not find it?&lt;/p&gt;</comment>
                            <comment id="13880357" author="daijy" created="Thu, 23 Jan 2014 21:05:53 +0000"  >&lt;p&gt;Yes, it is exposed in MRJobStats, might affect some ppl.&lt;/p&gt;</comment>
                            <comment id="13888827" author="cheolsoo" created="Sun, 2 Feb 2014 05:18:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aniket486&quot; class=&quot;user-hover&quot; rel=&quot;aniket486&quot;&gt;Aniket Mokashi&lt;/a&gt;, do you mind taking a quick look at &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3739&quot; title=&quot;The Warning_4 e2e test is broken in trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3739&quot;&gt;&lt;del&gt;PIG-3739&lt;/del&gt;&lt;/a&gt;? It fails after this commit, and I am not sure whether the test needs to be modified or this patch introduces a bug. Thanks!&lt;/p&gt;</comment>
                            <comment id="13888829" author="aniket486" created="Sun, 2 Feb 2014 05:27:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;, its not a bug, we have changed the message as well as the counter. I will patch the e2e test.&lt;/p&gt;</comment>
                            <comment id="13888833" author="cheolsoo" created="Sun, 2 Feb 2014 05:37:49 +0000"  >&lt;p&gt;Very cool! Thanks a lot!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12515336">PIG-2191</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12692696">PIG-3739</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12623771" name="PIG-2207-1.patch" size="2150" author="aniket486" created="Sat, 18 Jan 2014 03:43:29 +0000"/>
                            <attachment id="12624580" name="PIG-2207-5.patch" size="5914" author="aniket486" created="Thu, 23 Jan 2014 05:34:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 5 Aug 2011 23:01:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>46084</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy4sjj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>61780</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>