<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:00:54 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3662/PIG-3662.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3662] Static loadcaster in BinStorage can cause exception</title>
                <link>https://issues.apache.org/jira/browse/PIG-3662</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;I came a cross this issue when testing &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3642&quot; title=&quot;Direct HDFS access for small jobs (fetch) &quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3642&quot;&gt;&lt;del&gt;PIG-3642&lt;/del&gt;&lt;/a&gt;. Consider the following two testcases from &lt;tt&gt;TestEvalPipeline2&lt;/tt&gt; executed in local mode:&lt;br/&gt;
&lt;tt&gt;testBinStorageByteCast&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
A = load &apos;table_testBinStorageByteCast&apos; as (a0, a1, a2);
store A into &apos;table_testBinStorageByteCast.temp&apos; using BinStorage();
A = load &apos;table_testBinStorageByteCast.temp&apos; using BinStorage() as (a0, a1, a2);
B = foreach A generate (&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;)a0;
dump B;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;tt&gt;testBinStorageByteArrayCastsSimple&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
A = load &apos;table_bs_ac&apos;;
store A into &apos;TestEvalPipeline2_BinStorageByteArrayCasts&apos; using
  org.apache.pig.builtin.BinStorage();
B = load &apos;TestEvalPipeline2_BinStorageByteArrayCasts&apos;  using 
  BinStorage(&apos;Utf8StorageConverter&apos;) as (name: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, age: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, gpa: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;, 
lage: &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;, dgpa: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;); 
dump B;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first testcase should fail (same example at: &lt;a href=&quot;http://pig.apache.org/docs/r0.12.0/func.html#binstorage&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://pig.apache.org/docs/r0.12.0/func.html#binstorage&lt;/a&gt;) while the second one should pass.&lt;br/&gt;
When I run &lt;b&gt;only&lt;/b&gt; &lt;em&gt;testBinStorageByteArrayCastsSimple&lt;/em&gt; there&apos;s no problem, but when it runs &lt;b&gt;after&lt;/b&gt; &lt;em&gt;testBinStorageByteCast&lt;/em&gt;, it fails with the same exception as &lt;em&gt;testBinStorageByteArrayCastsSimple&lt;/em&gt; :&lt;br/&gt;
&lt;tt&gt;java.lang.Exception: org.apache.pig.backend.executionengine.ExecException: ERROR 1118: Cannot cast bytes loaded from BinStorage. Please provide a custom converter.&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Reason:&lt;br/&gt;
When &apos;table_testBinStorageByteCast.temp&apos; is loaded, &lt;em&gt;BinStorage#getLoadCaster()&lt;/em&gt; sets &lt;em&gt;UnImplementedLoadCaster&lt;/em&gt; since casterString is not defined. This causes the exception when &lt;em&gt;BinStorage#bytesToLong()&lt;/em&gt; is called during the cast of a0 which is correct. Now move on to the next testcase where &lt;em&gt;&apos;TestEvalPipeline2_BinStorageByteArrayCasts&apos;&lt;/em&gt; is loaded. We expect BinStorage to use &lt;em&gt;Utf8StorageConverter&lt;/em&gt; as a loadcaster but it will use &lt;em&gt;UnImplementedLoadCaster&lt;/em&gt; instead, which results in an exception. It&apos;s because caster and casterString are &lt;b&gt;static&lt;/b&gt; variables in BinStorage, however these are set and accessed like instance variables. Therefore, when BinStorage(&apos;Utf8StorageConverter&apos;) gets instantiated, it will contain the already initialized caster from the previous run. &lt;em&gt;BinStorage#getLoadCaster()&lt;/em&gt; will just return this instead of instantiating Utf8StorageConverter from the provided constructor parameter.&lt;/p&gt;

&lt;p&gt;Are caster and casterString just by accident static? If so, I&apos;d address this issue with the patch attached.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12688343">PIG-3662</key>
            <summary>Static loadcaster in BinStorage can cause exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lbendig">Lorand Bendig</assignee>
                                    <reporter username="lbendig">Lorand Bendig</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Jan 2014 22:18:29 +0000</created>
                <updated>Mon, 7 Jul 2014 19:07:55 +0100</updated>
                            <resolved>Sat, 11 Jan 2014 00:06:10 +0000</resolved>
                                                    <fixVersion>0.13.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13868497" author="rohini" created="Sat, 11 Jan 2014 00:06:10 +0000"  >&lt;p&gt;+1. Commited to trunk. Thanks Lorand.&lt;/p&gt;

&lt;p&gt;Please do click on &quot;Submit Patch&quot; next time for it to show up in the Patch Available notifications.&lt;/p&gt;</comment>
                            <comment id="13868509" author="lbendig" created="Sat, 11 Jan 2014 00:14:33 +0000"  >&lt;p&gt;OK, sure. Thank you for committing it!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12622450" name="PIG-3662.patch" size="678" author="lbendig" created="Fri, 10 Jan 2014 22:19:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 11 Jan 2014 00:06:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>367362</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzl673:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>367671</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>