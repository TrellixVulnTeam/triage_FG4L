<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:08:26 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2337/PIG-2337.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2337] Provide UDF with input schema</title>
                <link>https://issues.apache.org/jira/browse/PIG-2337</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;We have several requests to make input schema available to the UDF for inspection. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12529291">PIG-2337</key>
            <summary>Provide UDF with input schema</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xutingz">xuting zhao</assignee>
                                    <reporter username="olgan">Olga Natkovich</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Oct 2011 19:18:43 +0100</created>
                <updated>Fri, 22 Feb 2013 04:54:16 +0000</updated>
                            <resolved>Tue, 8 Nov 2011 19:58:12 +0000</resolved>
                                                    <fixVersion>0.11</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13138652" author="daijy" created="Fri, 28 Oct 2011 20:04:54 +0100"  >&lt;p&gt;Currently, if users want input schema for EvalFunc, they need to do it themselves:&lt;br/&gt;
1. In front end, serialize the schema and put in UDFContext in method outputSchema&lt;br/&gt;
2. In the backend, deserialize the schema from UDFContext.&lt;/p&gt;

&lt;p&gt;The sample use case can be found in TestSchema.InputSchemaUDF (&lt;a href=&quot;https://svn.apache.org/repos/asf/pig/trunk/test/org/apache/pig/test/TestSchema.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/pig/trunk/test/org/apache/pig/test/TestSchema.java&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;This process is quite involved and we shall to do it automatically. This involves:&lt;br/&gt;
1. In front end, we serialize the schema and put in UDFContext for every EvalFunc&lt;br/&gt;
2. In the backend, deserialize the schema for every EvalFunc&lt;br/&gt;
3. User can use EvalFunc.getSchema() to retrieve input schema for this EvalFunc&lt;/p&gt;

&lt;p&gt;To do this, we need a unique signature for EvalFunc so we can use it as a key to store to/retrieve from UDFContext. This mechanism is not there yet and it is tracked in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2338&quot; title=&quot;Need signature for EvalFunc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2338&quot;&gt;&lt;del&gt;PIG-2338&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13141960" author="xutingz" created="Wed, 2 Nov 2011 06:42:29 +0000"  >&lt;p&gt;1.test-commit has been successfully run on this patch.&lt;br/&gt;
2.Unit test has been added in the TestSchema.java as testAutoSchemaSerialization()&lt;/p&gt;</comment>
                            <comment id="13141981" author="daijy" created="Wed, 2 Nov 2011 07:23:25 +0000"  >&lt;p&gt;You will need to wait &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2338&quot; title=&quot;Need signature for EvalFunc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2338&quot;&gt;&lt;del&gt;PIG-2338&lt;/del&gt;&lt;/a&gt; check in, right?&lt;/p&gt;</comment>
                            <comment id="13142283" author="xutingz" created="Wed, 2 Nov 2011 16:46:59 +0000"  >&lt;p&gt;Hi Daniel,&lt;br/&gt;
   I includes those modification in 2338 in this patch. I am not sure if I need to seperate them or put them together. Thanks.&lt;/p&gt;</comment>
                            <comment id="13142321" author="daijy" created="Wed, 2 Nov 2011 17:27:29 +0000"  >&lt;p&gt;Should be separate. I will try to commit &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2338&quot; title=&quot;Need signature for EvalFunc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2338&quot;&gt;&lt;del&gt;PIG-2338&lt;/del&gt;&lt;/a&gt; ASAP. So you can regenerate the patch.&lt;/p&gt;</comment>
                            <comment id="13143802" author="xutingz" created="Fri, 4 Nov 2011 07:29:53 +0000"  >&lt;p&gt;1.The test-commit has been run successfully with this patch&lt;br/&gt;
2.An e2e test has been added&lt;/p&gt;</comment>
                            <comment id="13145158" author="daijy" created="Sun, 6 Nov 2011 23:47:00 +0000"  >&lt;p&gt;Thanks for the patch. Couple of comments:&lt;br/&gt;
1. You cannot put logic in EvalFunc.setUDFContextSignature() and EvalFunc.getUDFContextSignature(), user might override it. So don&apos;t save signature in EvalFunc. You can do the serialization in UserFuncExpression.getFieldSchema (You are quite there, except you need to use the signature in UserFuncExpression). You can do the deserialization in POUserFunc.instantiateFunc&lt;br/&gt;
2. prefix for the key:&quot;pig.evalfunc.signature&quot;, better be &quot;pig.evalfunc.inputschema&quot;&lt;br/&gt;
3. method name &quot;autoGetInputSchema&quot;, better &quot;getInputSchema&quot;, &quot;autoSetInputSchema&quot;, better &quot;setInputSchema&quot;&lt;br/&gt;
4. getInputSchema is user facing, should add some javadoc&lt;/p&gt;</comment>
                            <comment id="13145738" author="xutingz" created="Mon, 7 Nov 2011 19:47:50 +0000"  >&lt;p&gt;Thanks for this comments.&lt;br/&gt;
The 2337-3.patch is the modified one. The changes including:&lt;br/&gt;
1. moving the store and retrieve actions of signature into UserFuncExpression and POUserFunc.&lt;br/&gt;
2. changing the prefix of the key to: &quot;pig.evalfunc.inputshcmea.&quot;&lt;br/&gt;
3. adding javadoc into the getEFInputSchema.&lt;br/&gt;
4. I tried to change the function name of autoGetInputSchema and autoSetInputSchema to getInputSchema and setInputSchema. However, there seems some function in the jsFunction with the same name: private Schema getInputSchema(),private Schema setInputSchema(). So if I change to that name, there will be an error. As a result, I changed them to setEFInputSchema and getEFInputSchema()&lt;/p&gt;

&lt;p&gt;ant commit-test and e2e test on the new test case: UDFContextAuto have been successfully run.&lt;/p&gt;</comment>
                            <comment id="13146003" author="daijy" created="Tue, 8 Nov 2011 00:49:41 +0000"  >&lt;p&gt;Patch looks good. jsFunction seems to be a perfect candidate to use this new infrastructure. I would suggest to do that in this patch as well (And also we can reclaim the name they stole &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/p&gt;</comment>
                            <comment id="13146028" author="xutingz" created="Tue, 8 Nov 2011 01:50:02 +0000"  >&lt;p&gt;Hi Daniel,&lt;/p&gt;

&lt;p&gt;  I have modified the jsFunction and changed the functions names in EvalFunc to getInputSchema() and setInputSchema(). test-commit and e2e test on the new test case: UDFContextAuto have been successfully run.&lt;/p&gt;

&lt;p&gt;Xuting&lt;/p&gt;</comment>
                            <comment id="13146031" author="daijy" created="Tue, 8 Nov 2011 01:56:10 +0000"  >&lt;p&gt;Everything looks right now. Will commit once tests pass.&lt;/p&gt;</comment>
                            <comment id="13146510" author="daijy" created="Tue, 8 Nov 2011 19:56:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2337&quot; title=&quot;Provide UDF with input schema&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2337&quot;&gt;&lt;del&gt;PIG-2337&lt;/del&gt;&lt;/a&gt;-5.patch include some minor change in javadoc.&lt;/p&gt;</comment>
                            <comment id="13146512" author="daijy" created="Tue, 8 Nov 2011 19:58:12 +0000"  >&lt;p&gt;Unit test pass. Test-patch result:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; -1 overall.  &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 @author.  The patch does not contain any @author tags.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 tests included.  The patch appears to include 10 new or modified tests.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     -1 release audit.  The applied patch generated 468 release audit warnings (more than the trunk&apos;s current 461 warnings).&lt;/p&gt;

&lt;p&gt;No new file added, ignore release audit warning.&lt;/p&gt;

&lt;p&gt;Patch committed to trunk. Thanks Xuting!&lt;/p&gt;</comment>
                            <comment id="13578749" author="russell.jurney" created="Thu, 14 Feb 2013 22:19:37 +0000"  >&lt;p&gt;One problem with this patch/commit: what you really need is a ResourceSchema, not a schema &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13578759" author="jcoveney" created="Thu, 14 Feb 2013 22:32:03 +0000"  >&lt;p&gt;Russell: I&apos;m not sure what you mean? When it comes to UDFss, pretty much everything is in terms of Schemas. Can you give a case where a Schema isn&apos;t sufficient, but a ResourceSchema would be?&lt;/p&gt;

&lt;p&gt;Further, converting to a ResourceSchema is pretty easy, but I&apos;d be very curious to know of a use case.&lt;/p&gt;</comment>
                            <comment id="13579504" author="russell.jurney" created="Fri, 15 Feb 2013 21:08:44 +0000"  >&lt;p&gt;I am looking at JsonStorage in the process of writing ToJson as a builtin, and it uses ResourceSchema, which are serializable. The implementation uses features like: field.getName(), schema.getFields(),  field.getSchema() - can you tell me the schema equivalents?&lt;/p&gt;</comment>
                            <comment id="13579532" author="dvryaboy" created="Fri, 15 Feb 2013 21:50:57 +0000"  >&lt;p&gt;Is anything preventing you from calling &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ResourceSchema(Schema pigSchema)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;?&lt;/p&gt;</comment>
                            <comment id="13579859" author="russell.jurney" created="Sat, 16 Feb 2013 18:09:23 +0000"  >&lt;p&gt;Thanks, I looked for that, I read the Javadoc and the classes... and couldn&apos;t find it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;To answer your question: stupidity mostly.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12529295">PIG-2338</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12502366" name="PIG-2337-2.patch" size="6736" author="xutingz" created="Fri, 4 Nov 2011 07:27:59 +0000"/>
                            <attachment id="12502788" name="PIG-2337-3.patch" size="8074" author="xutingz" created="Mon, 7 Nov 2011 19:42:33 +0000"/>
                            <attachment id="12502862" name="PIG-2337-4.patch" size="10253" author="xutingz" created="Tue, 8 Nov 2011 01:47:46 +0000"/>
                            <attachment id="12502951" name="PIG-2337-5.patch" size="8033" author="daijy" created="Tue, 8 Nov 2011 19:56:54 +0000"/>
                            <attachment id="12501917" name="PIG-2337.patch" size="14462" author="xutingz" created="Wed, 2 Nov 2011 06:38:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 28 Oct 2011 19:04:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>215151</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyawqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97616</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>