<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:09:00 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1748/PIG-1748.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1748] Add load/store function AvroStorage for avro data</title>
                <link>https://issues.apache.org/jira/browse/PIG-1748</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;We want to use Pig to process arbitrary Avro data and store results as Avro files. AvroStorage() extends two PigFuncs: LoadFunc and StoreFunc. &lt;/p&gt;

&lt;p&gt;Due to discrepancies of Avro and Pig data models, AvroStorage has:&lt;br/&gt;
1. Limited support for &quot;record&quot;: we do not support recursively defined record because the number of fields in such records is data dependent.&lt;br/&gt;
2. Limited support for &quot;union&quot;: we only accept nullable union like &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;null&amp;quot;, &amp;quot;some-type&amp;quot;&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;For simplicity, we also make the following assumptions:&lt;br/&gt;
If the input directory is a leaf directory, then we assume Avro data files in it have the same schema;&lt;br/&gt;
If the input directory contains sub-directories, then we assume Avro data files in all sub-directories have the same schema.&lt;/p&gt;

&lt;p&gt;AvroStorage takes no input parameters when used as a LoadFunc (except for &quot;debug &lt;span class=&quot;error&quot;&gt;&amp;#91;debug-level&amp;#93;&lt;/span&gt;&quot;). &lt;br/&gt;
Users can provide parameters to AvroStorage when used as a StoreFunc. If they don&apos;t, Avro schema of output data is derived from its &lt;br/&gt;
Pig schema.&lt;/p&gt;

&lt;p&gt;Detailed documentation can be found in &lt;a href=&quot;http://linkedin.jira.com/wiki/display/HTOOLS/AvroStorage+-+Pig+support+for+Avro+data&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://linkedin.jira.com/wiki/display/HTOOLS/AvroStorage+-+Pig+support+for+Avro+data&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12480859">PIG-1748</key>
            <summary>Add load/store function AvroStorage for avro data</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="guolin2001">lin guo</assignee>
                                    <reporter username="guolin2001">lin guo</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Nov 2010 20:27:21 +0000</created>
                <updated>Thu, 2 May 2013 03:29:34 +0100</updated>
                            <resolved>Mon, 31 Jan 2011 21:19:32 +0000</resolved>
                                                    <fixVersion>0.9.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>15</watches>
                                                                <comments>
                            <comment id="12969660" author="guolin2001" created="Thu, 9 Dec 2010 08:35:42 +0000"  >&lt;p&gt;this patch contains codes/unittests of AvroStorage; it also updates dependent jars.&lt;/p&gt;</comment>
                            <comment id="12969880" author="cutting" created="Thu, 9 Dec 2010 19:19:11 +0000"  >&lt;p&gt;I skimmed this, and overall it looks great!  The only thing I noticed is that it should probably depend on avro-1.4.1 rather than 1.4.0.&lt;/p&gt;</comment>
                            <comment id="12970011" author="guolin2001" created="Thu, 9 Dec 2010 23:33:03 +0000"  >&lt;p&gt;Thanks... and I will update it to use the latest version.&lt;/p&gt;

&lt;p&gt;Best,&lt;br/&gt;
Lin&lt;/p&gt;

</comment>
                            <comment id="12983970" author="jghoman" created="Thu, 20 Jan 2011 01:08:16 +0000"  >&lt;p&gt;Attaching binary test avro files used by unit tests.  Need to be untgz&apos;ed and placed in contrib/piggybank/java/src/test/java/org/apache/pig/piggybank/test/storage/avro/avro_test_files by reviewer/committer&lt;/p&gt;</comment>
                            <comment id="12983971" author="jghoman" created="Thu, 20 Jan 2011 01:09:21 +0000"  >&lt;p&gt;Attaching updated patch.  I&apos;ll be finishing this JIRA for Lin.  Delta from her patch: Avro 1.4, test refactoring and brought in line with Pig coding conventions.  Ready for review.&lt;/p&gt;</comment>
                            <comment id="12984963" author="daijy" created="Fri, 21 Jan 2011 22:12:30 +0000"  >&lt;p&gt;Seems you forget contrib/piggybank/java/src/test/java/org/apache/pig/piggybank/test/storage/avro/avro_test_files/test_array.avro&lt;/p&gt;</comment>
                            <comment id="12984964" author="daijy" created="Fri, 21 Jan 2011 22:14:44 +0000"  >&lt;p&gt;Ok, get it in a separate file.&lt;/p&gt;</comment>
                            <comment id="12985022" author="scott_carey" created="Sat, 22 Jan 2011 01:14:11 +0000"  >&lt;p&gt;About plans on the Avro side:&lt;/p&gt;

&lt;p&gt;I plan on merging my work with this (great!) work into the Avro project.  In the long  run the Avro project is a better place for this for several reasons, but in the short term it does not matter.  It will be some time before it is available from Avro.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Avro is fully mavenized in 1.5.0 (due out in a few weeks), meaning it is easy to add sub module jars such as &apos;avro-pig.jar&apos;.   Furthermore, its easy to have multiple versions for each version of pig if needed.  For example we could simultaneously release avro-pig0.7.jar, avro-pig0.8.jar etc. as part of Avro 1.6.0 if it was necessary due to API breakage or extra features enabled in newer versions of Pig.&lt;/li&gt;
	&lt;li&gt;A lot of the work here is applicable to multiple systems, I plan to share code with Avro Hive SerDe&apos;s when those are implemented.  This may lead to a general module that helps projects translate their schemas to avro and back.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;None of this impacts the work here in the short term, but I&apos;m sure people will be interested in these plans and may have other ideas/suggestions on how to work on this in a way that is not too fragmented.&lt;/p&gt;</comment>
                            <comment id="12985030" author="daijy" created="Sat, 22 Jan 2011 01:40:19 +0000"  >&lt;p&gt;To Jokob:&lt;br/&gt;
I get 2 failure in TestAvroStorage: testArrayWithSame, testRecordWithFieldSchema. Error message is similar:&lt;/p&gt;

&lt;p&gt;could not instantiate &apos;org.apache.pig.piggybank.storage.avro.AvroStorage&apos; with arguments &apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;same, src/test/java/org/apache/pig/piggybank/test/storage/avro/avro_test_files/test_array.avro&amp;#93;&lt;/span&gt;&apos;&lt;br/&gt;
java.lang.RuntimeException: could not instantiate &apos;org.apache.pig.piggybank.storage.avro.AvroStorage&apos; with arguments &apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;same, src/test/java/org/apache/pig/piggybank/test/storage/avro/avro_test_files/test_array.avro&amp;#93;&lt;/span&gt;&apos;&lt;br/&gt;
        at org.apache.pig.impl.PigContext.instantiateFuncFromSpec(PigContext.java:494)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.NonEvalFuncSpec(QueryParser.java:5660)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.StoreClause(QueryParser.java:4034)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.BaseExpr(QueryParser.java:1501)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.Expr(QueryParser.java:1013)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.Parse(QueryParser.java:825)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.LogicalPlanBuilder.parse(LogicalPlanBuilder.java:63)&lt;br/&gt;
        at org.apache.pig.PigServer$Graph.parseQuery(PigServer.java:1708)&lt;br/&gt;
        at org.apache.pig.PigServer$Graph.registerQuery(PigServer.java:1658)&lt;br/&gt;
        at org.apache.pig.PigServer.registerQuery(PigServer.java:546)&lt;br/&gt;
        at org.apache.pig.PigServer.registerQuery(PigServer.java:570)&lt;br/&gt;
        at org.apache.pig.piggybank.test.storage.avro.TestAvroStorage.testAvroStorage(Unknown Source)&lt;br/&gt;
        at org.apache.pig.piggybank.test.storage.avro.TestAvroStorage.testArrayWithSame(Unknown Source)&lt;br/&gt;
Caused by: java.lang.reflect.InvocationTargetException&lt;br/&gt;
        at java.lang.reflect.Constructor.newInstance(Constructor.java:513)&lt;br/&gt;
        at org.apache.pig.impl.PigContext.instantiateFuncFromSpec(PigContext.java:484)&lt;br/&gt;
Caused by: java.net.ConnectException: Call to localhost.localdomain/127.0.0.1:57284 failed on connection exception: java.net.ConnectException: Connection refused&lt;br/&gt;
        at org.apache.hadoop.ipc.Client.wrapException(Client.java:767)&lt;br/&gt;
        at org.apache.hadoop.ipc.Client.call(Client.java:743)&lt;br/&gt;
        at org.apache.hadoop.ipc.RPC$Invoker.invoke(RPC.java:220)&lt;br/&gt;
        at $Proxy9.getProtocolVersion(Unknown Source)&lt;br/&gt;
        at org.apache.hadoop.ipc.RPC.getProxy(RPC.java:359)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient.createRPCNamenode(DFSClient.java:106)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient.&amp;lt;init&amp;gt;(DFSClient.java:207)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient.&amp;lt;init&amp;gt;(DFSClient.java:170)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DistributedFileSystem.initialize(DistributedFileSystem.java:82)&lt;br/&gt;
        at org.apache.hadoop.fs.FileSystem.createFileSystem(FileSystem.java:1378)&lt;br/&gt;
        at org.apache.hadoop.fs.FileSystem.access$200(FileSystem.java:66)&lt;br/&gt;
        at org.apache.hadoop.fs.FileSystem$Cache.get(FileSystem.java:1390)&lt;br/&gt;
        at org.apache.hadoop.fs.FileSystem.get(FileSystem.java:196)&lt;br/&gt;
        at org.apache.hadoop.fs.FileSystem.get(FileSystem.java:95)&lt;br/&gt;
        at org.apache.hadoop.fs.FileSystem.get(FileSystem.java:180)&lt;br/&gt;
        at org.apache.pig.piggybank.storage.avro.AvroStorage.init(AvroStorage.java:372)&lt;br/&gt;
        at org.apache.pig.piggybank.storage.avro.AvroStorage.&amp;lt;init&amp;gt;(AvroStorage.java:110)&lt;br/&gt;
Caused by: java.net.ConnectException: Connection refused&lt;br/&gt;
        at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)&lt;br/&gt;
        at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:574)&lt;br/&gt;
        at org.apache.hadoop.net.SocketIOWithTimeout.connect(SocketIOWithTimeout.java:206)&lt;br/&gt;
        at org.apache.hadoop.net.NetUtils.connect(NetUtils.java:404)&lt;br/&gt;
        at org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:304)&lt;br/&gt;
        at org.apache.hadoop.ipc.Client$Connection.access$1700(Client.java:176)&lt;br/&gt;
        at org.apache.hadoop.ipc.Client.getConnection(Client.java:860)&lt;br/&gt;
        at org.apache.hadoop.ipc.Client.call(Client.java:720)&lt;/p&gt;

&lt;p&gt;Know what happen?&lt;/p&gt;</comment>
                            <comment id="12985936" author="jghoman" created="Mon, 24 Jan 2011 19:39:27 +0000"  >&lt;p&gt;@Daniel- Let me take a look.&lt;/p&gt;

&lt;p&gt;@Scott - It&apos;s worth noting that projects can include Avro support as they wish, just as Avro can incorporate that work as it wishes.  But I&apos;m not sure I understand.  You&apos;re saying that you&apos;d rather have any higher-level application supporting Avro to have that support hosted in Avro, rather than treating it as a library to be included?  This seems like an odd approach to me, essentially inverting the domain knowledge of each application to Avro, rather than the application itself where its developers frolic and work.  Is there something I&apos;m missing here?&lt;/p&gt;</comment>
                            <comment id="12985958" author="scott_carey" created="Mon, 24 Jan 2011 20:12:10 +0000"  >&lt;p&gt;@Jacob&lt;br/&gt;
Of course projects can do what they wish.  I&apos;m simply hoping many can collaborate together on this general problem category.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This seems like an odd approach to me, essentially inverting the domain knowledge of each application to Avro, rather than the application itself where its developers frolic and work. Is there something I&apos;m missing here?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Writing a Pig storage adapter requires Avro domain knowledge and Pig domain knowledge.  I found that it required more knowledge of Avro than Pig to do well.  If all you ever want to achieve is:&lt;/p&gt;

&lt;p&gt;Pig - &amp;gt;&amp;gt; Avro file - &amp;gt;&amp;gt; Pig, then maybe it doesn&apos;t matter who hosts it. &lt;/p&gt;

&lt;p&gt;But what if you want to do:&lt;br/&gt;
Pig - &amp;gt;&amp;gt;  Avro file - &amp;gt;&amp;gt; Cascading - &amp;gt;&amp;gt; Avro file - &amp;gt;&amp;gt; Hive - &amp;gt;&amp;gt; Avro file - &amp;gt;&amp;gt; Pig   ?&lt;/p&gt;

&lt;p&gt;Now which project should host what defines how all those data models can interact through a common schema system?  pig contrib?  hive contrib?  howl? cascading (gpl . . .)?&lt;/p&gt;

&lt;p&gt;In the longer term, the common elements needed by all of the above can crystallize out into an avro module general to all, and individual modules hosted by each project can use that.  What that might look like won&apos;t be apparent until there are enough example use cases however.&lt;/p&gt;</comment>
                            <comment id="12985972" author="jghoman" created="Mon, 24 Jan 2011 20:38:09 +0000"  >&lt;p&gt;@Scott&lt;br/&gt;
I can&apos;t say I&apos;m convinced, and am in fact more concerned from your example, given that this approach essentially builds dependencies on all of those projects into Avro.  However, this JIRA isn&apos;t the best place to discuss this.  Is there a discussion about this type of integration going on in Avro that the community can contribute to?  Is there a JIRA?  Thanks.&lt;/p&gt;</comment>
                            <comment id="12986204" author="scott_carey" created="Tue, 25 Jan 2011 03:31:19 +0000"  >&lt;p&gt;@Jacob&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt; I can&apos;t say I&apos;m convinced, and am in fact more concerned from your example, given that this approach essentially builds dependencies on all of those projects into Avro.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Avro is completely modularized now, so there would not be any dependency mess like that.  It is now easy to add separate modules such as &apos;avro-pig.jar&apos;  or &apos;avro-hive.jar&apos;.  It already has &apos;avro-mapred.jar&apos;. &lt;br/&gt;
&lt;a href=&quot;https://cwiki.apache.org/confluence/display/AVRO/Build+Documentation#BuildDocumentation-Java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://cwiki.apache.org/confluence/display/AVRO/Build+Documentation#BuildDocumentation-Java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As this gets off topic, we can use Avro developer mailing list.  Related issues are &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-647&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AVRO-647&lt;/a&gt; and the issues linked to it, as well as &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-592&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AVRO-592&lt;/a&gt;.  There is no ticket yet on the broader scope stuff. &lt;/p&gt;</comment>
                            <comment id="12986551" author="felixgao" created="Tue, 25 Jan 2011 17:55:41 +0000"  >&lt;p&gt;I noticed the avro loader does not support file globbing. &lt;/p&gt;

&lt;p&gt;log_load = LOAD &apos;/user/felix/avro/access_log.test.avro&apos; USING org.apache.pig.piggybank.storage.avro.AvroStorage();   &amp;lt;--- works fine&lt;br/&gt;
but&lt;br/&gt;
log_load = LOAD &apos;/user/felix/avro/*.avro&apos; USING org.apache.pig.piggybank.storage.avro.AvroStorage();&lt;/p&gt;

&lt;p&gt;ERROR 1018: Problem determining schema during load&lt;/p&gt;

&lt;p&gt;org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1000: Error during parsing. Problem determining schema during load&lt;br/&gt;
    at org.apache.pig.PigServer$Graph.parseQuery(PigServer.java:1342)&lt;br/&gt;
    at org.apache.pig.PigServer$Graph.registerQuery(PigServer.java:1286)&lt;br/&gt;
    at org.apache.pig.PigServer.registerQuery(PigServer.java:460)&lt;br/&gt;
    at org.apache.pig.tools.grunt.GruntParser.processPig(GruntParser.java:738)&lt;/p&gt;

&lt;p&gt;    at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:324)&lt;br/&gt;
    at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:163)&lt;br/&gt;
    at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:139)&lt;br/&gt;
    at org.apache.pig.tools.grunt.Grunt.exec(Grunt.java:89)&lt;br/&gt;
    at org.apache.pig.Main.main(Main.java:414)&lt;br/&gt;
Caused by: org.apache.pig.impl.logicalLayer.parser.ParseException: Problem determining schema during load&lt;br/&gt;
    at org.apache.pig.impl.logicalLayer.parser.QueryParser.Parse(QueryParser.java:752)&lt;/p&gt;

&lt;p&gt;    at org.apache.pig.impl.logicalLayer.LogicalPlanBuilder.parse(LogicalPlanBuilder.java:63)&lt;br/&gt;
    at org.apache.pig.PigServer$Graph.parseQuery(PigServer.java:1336)&lt;br/&gt;
    ... 8 more&lt;br/&gt;
Caused by: org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1018: Problem determining schema during load&lt;br/&gt;
    at org.apache.pig.impl.logicalLayer.LOLoad.getSchema(LOLoad.java:156)&lt;br/&gt;
    at org.apache.pig.impl.logicalLayer.parser.QueryParser.Parse(QueryParser.java:750)&lt;br/&gt;
    ... 10 more&lt;br/&gt;
Caused by: java.io.FileNotFoundException: File does not exist: /user/felix/avro/*.avro&lt;br/&gt;
    at org.apache.hadoop.hdfs.DFSClient$DFSInputStream.openInfo(DFSClient.java:1586)&lt;br/&gt;
    at org.apache.hadoop.hdfs.DFSClient$DFSInputStream.&amp;lt;init&amp;gt;(DFSClient.java:1577)&lt;br/&gt;
    at org.apache.hadoop.hdfs.DFSClient.open(DFSClient.java:428)&lt;br/&gt;
    at org.apache.hadoop.hdfs.DistributedFileSystem.open(DistributedFileSystem.java:185)&lt;br/&gt;
    at org.apache.hadoop.fs.FileSystem.open(FileSystem.java:431)&lt;br/&gt;
    at org.apache.pig.piggybank.storage.avro.AvroStorage.getSchema(AvroStorage.java:181)&lt;/p&gt;

&lt;p&gt;    at org.apache.pig.piggybank.storage.avro.AvroStorage.getAvroSchema(AvroStorage.java:133)&lt;br/&gt;
    at org.apache.pig.piggybank.storage.avro.AvroStorage.getAvroSchema(AvroStorage.java:108)&lt;br/&gt;
    at org.apache.pig.piggybank.storage.avro.AvroStorage.getSchema(AvroStorage.java:233)&lt;br/&gt;
    at org.apache.pig.impl.logicalLayer.LOLoad.determineSchema(LOLoad.java:169)&lt;br/&gt;
    at org.apache.pig.impl.logicalLayer.LOLoad.getSchema(LOLoad.java:150)&lt;br/&gt;
    ... 11 more&lt;/p&gt;</comment>
                            <comment id="12988193" author="jghoman" created="Fri, 28 Jan 2011 19:43:16 +0000"  >&lt;p&gt;Figured out the test failures.  Turns out that when one does a full run of the unit tests (which I cannot get to succeed on my machine), the ~/pigtest directory is left running during the contrib tests and within the contrib build.xml file is a &lt;tt&gt;junit.hadoop.conf&lt;/tt&gt; variable pointing those tests to the hdfs the pig tests had running but is no longer up.  This conf trickles down to the test which ends up using it as the default filesystem and tries to connect to it, but can&apos;t since that HDFS is gone.  This doesn&apos;t occur when run through an idea like IntelliJ since the IDE doesn&apos;t use contrib&apos;s build.xml settings.  &lt;/p&gt;

&lt;p&gt;I&apos;ve fixed this by explicitly referencing the local file system in the tests, though this seems like a bug in the contrib build system to me.  I&apos;ll open a JIRA to address this.&lt;/p&gt;

&lt;p&gt;@Felix - good catch.  To provide a cleaner separation between my work and Lin&apos;s, I would like to go ahead and fix this bug in a separate JIRA after 1748 is committed.  How does this sound to you?&lt;/p&gt;

&lt;p&gt;Contrib tests pass, except org.apache.pig.piggybank.test.TestPigStorageSchema, which fails for me with or without the patch.  Version 3 of the patch is updated to include better behavior in for directories with files that should be filtered out.&lt;/p&gt;</comment>
                            <comment id="12988253" author="dvryaboy" created="Fri, 28 Jan 2011 21:46:24 +0000"  >&lt;p&gt;The TestPigStorageSchema thing is mine, someone else just opened a ticket. Will fix.&lt;/p&gt;</comment>
                            <comment id="12988893" author="daijy" created="Mon, 31 Jan 2011 21:19:58 +0000"  >&lt;p&gt;Patch committed to trunk. Thanks Lin, Jakob! &lt;/p&gt;</comment>
                            <comment id="13164216" author="russell.jurney" created="Wed, 7 Dec 2011 07:45:06 +0000"  >&lt;p&gt;This patch is a fix for a bug for persisting bags of tuples via AvroStorage.&lt;/p&gt;

&lt;p&gt;The script that alerted me to a bug is:&lt;/p&gt;

&lt;p&gt;messages = LOAD &apos;/tmp/messages.avro&apos; USING AvroStorage();&lt;br/&gt;
user_groups = GROUP messages by user_id;&lt;br/&gt;
per_user = FOREACH user_groups &lt;/p&gt;
{                
    sorted = ORDER messages BY message_id DESC;     
    GENERATE group AS user_id, sorted AS messages;
}
&lt;p&gt;DESCRIBE per_user&lt;br/&gt;
&amp;gt; per_user: {user_id: int,messages: {(message_id: int,topic: chararray,user_id: int)}}&lt;br/&gt;
STORE per_user INTO &apos;/tmp/per_user.avro&apos; USING AvroStorage();&lt;/p&gt;

&lt;p&gt;The error is:&lt;/p&gt;

&lt;p&gt;Pig Stack Trace&lt;br/&gt;
---------------&lt;br/&gt;
ERROR 1002: Unable to store alias per_user&lt;/p&gt;

&lt;p&gt;org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1002: Unable to store alias per_user&lt;br/&gt;
	at org.apache.pig.PigServer$Graph.registerQuery(PigServer.java:1596)&lt;br/&gt;
	at org.apache.pig.PigServer.registerQuery(PigServer.java:584)&lt;br/&gt;
	at org.apache.pig.tools.grunt.GruntParser.processPig(GruntParser.java:942)&lt;br/&gt;
	at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:386)&lt;br/&gt;
	at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:188)&lt;br/&gt;
	at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:164)&lt;br/&gt;
	at org.apache.pig.tools.grunt.Grunt.run(Grunt.java:67)&lt;br/&gt;
	at org.apache.pig.Main.run(Main.java:487)&lt;br/&gt;
	at org.apache.pig.Main.main(Main.java:108)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.apache.hadoop.util.RunJar.main(RunJar.java:156)&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.isTupleWrapper(AvroStorageUtils.java:327)&lt;br/&gt;
	at org.apache.pig.piggybank.storage.avro.PigSchema2Avro.convert(PigSchema2Avro.java:82)&lt;br/&gt;
	at org.apache.pig.piggybank.storage.avro.PigSchema2Avro.convert(PigSchema2Avro.java:105)&lt;br/&gt;
	at org.apache.pig.piggybank.storage.avro.PigSchema2Avro.convertRecord(PigSchema2Avro.java:151)&lt;br/&gt;
	at org.apache.pig.piggybank.storage.avro.PigSchema2Avro.convert(PigSchema2Avro.java:62)&lt;br/&gt;
	at org.apache.pig.piggybank.storage.avro.AvroStorage.checkSchema(AvroStorage.java:502)&lt;br/&gt;
	at org.apache.pig.newplan.logical.rules.InputOutputFileValidator$InputOutputFileVisitor.visit(InputOutputFileValidator.java:65)&lt;br/&gt;
	at org.apache.pig.newplan.logical.relational.LOStore.accept(LOStore.java:77)&lt;br/&gt;
	at org.apache.pig.newplan.DepthFirstWalker.depthFirst(DepthFirstWalker.java:64)&lt;br/&gt;
	at org.apache.pig.newplan.DepthFirstWalker.depthFirst(DepthFirstWalker.java:66)&lt;br/&gt;
	at org.apache.pig.newplan.DepthFirstWalker.depthFirst(DepthFirstWalker.java:66)&lt;br/&gt;
	at org.apache.pig.newplan.DepthFirstWalker.depthFirst(DepthFirstWalker.java:66)&lt;br/&gt;
	at org.apache.pig.newplan.DepthFirstWalker.depthFirst(DepthFirstWalker.java:66)&lt;br/&gt;
	at org.apache.pig.newplan.DepthFirstWalker.walk(DepthFirstWalker.java:53)&lt;br/&gt;
	at org.apache.pig.newplan.PlanVisitor.visit(PlanVisitor.java:50)&lt;br/&gt;
	at org.apache.pig.newplan.logical.rules.InputOutputFileValidator.validate(InputOutputFileValidator.java:45)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.compile(HExecutionEngine.java:292)&lt;br/&gt;
	at org.apache.pig.PigServer.compilePp(PigServer.java:1360)&lt;br/&gt;
	at org.apache.pig.PigServer.executeCompiledLogicalPlan(PigServer.java:1297)&lt;br/&gt;
	at org.apache.pig.PigServer.execute(PigServer.java:1286)&lt;br/&gt;
	at org.apache.pig.PigServer.access$400(PigServer.java:125)&lt;br/&gt;
	at org.apache.pig.PigServer$Graph.registerQuery(PigServer.java:1591)&lt;br/&gt;
	... 13 more&lt;/p&gt;</comment>
                            <comment id="13164217" author="russell.jurney" created="Wed, 7 Dec 2011 07:46:03 +0000"  >&lt;p&gt;I&apos;ve attached a patch that fixes a bug I ran into in serializing bags of tuples.&lt;/p&gt;</comment>
                            <comment id="13164828" author="cutting" created="Wed, 7 Dec 2011 23:20:26 +0000"  >&lt;p&gt;Russell, this patch looks good to me, except for the print statement.  But you should probably open a new issue and add it there, as this issue has already been committed, closed and released.&lt;/p&gt;</comment>
                            <comment id="13164848" author="russell.jurney" created="Wed, 7 Dec 2011 23:49:02 +0000"  >&lt;p&gt;Thanks, Doug.  Created &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2411&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/PIG-2411&lt;/a&gt; and submitted patch.&lt;/p&gt;</comment>
                            <comment id="13454762" author="debashish" created="Thu, 13 Sep 2012 10:26:52 +0100"  >&lt;p&gt;REGISTER /path/avro-1.4.1.jar&lt;br/&gt;
REGISTER /path/json-simple-1.1.jar&lt;br/&gt;
REGISTER /path/piggybank.jar&lt;br/&gt;
REGISTER /path/jackson-core-asl-1.5.5.jar&lt;br/&gt;
REGISTER /path/jackson-mapper-asl-1.5.5.jar&lt;br/&gt;
avro = LOAD &apos;/hdfs path/part-r-00000.avro&apos; USING org.apache.pig.piggybank.storage.avro.AvroStorage();&lt;/p&gt;

&lt;p&gt;Im trying this code but it&apos;s unable to read the avro file,showing  the following exception&lt;/p&gt;


&lt;p&gt;Pig Stack Trace&lt;br/&gt;
---------------&lt;br/&gt;
ERROR 2997: Unable to recreate exception from backed error: Error: Found class org.apache.hadoop.mapreduce.TaskAttemptContext, but interface was expected&lt;/p&gt;

&lt;p&gt;org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1066: Unable to open iterator for alias sc. Backend error : Unable to recreate exception from backed error: Error: Found class org.apache.hadoop.mapreduce.TaskAttemptContext, but interface was expected&lt;br/&gt;
	at org.apache.pig.PigServer.openIterator(PigServer.java:742)&lt;br/&gt;
	at org.apache.pig.tools.grunt.GruntParser.processDump(GruntParser.java:612)&lt;br/&gt;
	at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:303)&lt;br/&gt;
	at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:165)&lt;br/&gt;
	at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:141)&lt;br/&gt;
	at org.apache.pig.tools.grunt.Grunt.exec(Grunt.java:90)&lt;br/&gt;
	at org.apache.pig.Main.run(Main.java:406)&lt;br/&gt;
	at org.apache.pig.Main.main(Main.java:107)&lt;br/&gt;
Caused by: org.apache.pig.backend.executionengine.ExecException: ERROR 2997: Unable to recreate exception from backed error: Error: Found class org.apache.hadoop.mapreduce.TaskAttemptContext, but interface was expected&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.Launcher.getErrorMessages(Launcher.java:221)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.Launcher.getStats(Launcher.java:151)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher.launchPig(MapReduceLauncher.java:337)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.execute(HExecutionEngine.java:378)&lt;br/&gt;
	at org.apache.pig.PigServer.executeCompiledLogicalPlan(PigServer.java:1198)&lt;br/&gt;
	at org.apache.pig.PigServer.storeEx(PigServer.java:874)&lt;br/&gt;
	at org.apache.pig.PigServer.store(PigServer.java:816)&lt;br/&gt;
	at org.apache.pig.PigServer.openIterator(PigServer.java:728)&lt;br/&gt;
	... 7 more&lt;/p&gt;

&lt;p&gt;please help me asap&lt;/p&gt;
</comment>
                            <comment id="13454985" author="jghoman" created="Thu, 13 Sep 2012 17:30:31 +0100"  >&lt;p&gt;@deb - questions like these should be directed to the pig user list, not JIRA.  You&apos;ll receive assistance there.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12438666">HIVE-895</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12497099">PIG-1833</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12480860">PIG-1749</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12506409" name="AvroStorageUtils-bagfix.patch" size="1168" author="russell.jurney" created="Wed, 7 Dec 2011 07:45:02 +0000"/>
                            <attachment id="12468806" name="PIG-1748-2.patch" size="128648" author="jghoman" created="Thu, 20 Jan 2011 01:09:21 +0000"/>
                            <attachment id="12469695" name="PIG-1748-3.patch" size="129691" author="jghoman" created="Fri, 28 Jan 2011 19:43:16 +0000"/>
                            <attachment id="12465887" name="avro_storage.patch" size="130916" author="guolin2001" created="Thu, 9 Dec 2010 08:35:41 +0000"/>
                            <attachment id="12468805" name="avro_test_files.tar.gz" size="5486" author="jghoman" created="Thu, 20 Jan 2011 01:08:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 9 Dec 2010 19:19:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37463</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxzczz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30089</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Pig Avro</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>