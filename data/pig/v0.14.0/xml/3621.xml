<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:08:22 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3621/PIG-3621.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3621] Python Avro library can&apos;t read Avros made with builtin AvroStorage</title>
                <link>https://issues.apache.org/jira/browse/PIG-3621</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Using this script:&lt;/p&gt;

&lt;p&gt;from avro import schema, datafile, io&lt;br/&gt;
import pprint&lt;br/&gt;
import sys&lt;br/&gt;
import json&lt;/p&gt;

&lt;p&gt;field_id = None&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Optional key to print&lt;br/&gt;
if (len(sys.argv) &amp;gt; 2):&lt;br/&gt;
  field_id = sys.argv&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;Test reading avros&lt;br/&gt;
rec_reader = io.DatumReader()&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;Create a &apos;data file&apos; (avro file) reader&lt;br/&gt;
df_reader = datafile.DataFileReader(&lt;br/&gt;
  open(sys.argv&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;),&lt;br/&gt;
  rec_reader&lt;br/&gt;
)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;the last line fails with:&lt;/p&gt;

&lt;p&gt;Traceback (most recent call last):&lt;br/&gt;
  File &quot;/Users/rjurney/bin/cat_avro&quot;, line 22, in &amp;lt;module&amp;gt;&lt;br/&gt;
    rec_reader&lt;br/&gt;
  File &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/avro/datafile.py&quot;, line 247, in _&lt;em&gt;init&lt;/em&gt;_&lt;br/&gt;
    self.datum_reader.writers_schema = schema.parse(self.get_meta(SCHEMA_KEY))&lt;br/&gt;
  File &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/avro/schema.py&quot;, line 784, in parse&lt;br/&gt;
    return make_avsc_object(json_data, names)&lt;br/&gt;
  File &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/avro/schema.py&quot;, line 740, in make_avsc_object&lt;br/&gt;
    return RecordSchema(name, namespace, fields, names, type, doc, other_props)&lt;br/&gt;
  File &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/avro/schema.py&quot;, line 653, in _&lt;em&gt;init&lt;/em&gt;_&lt;br/&gt;
    other_props)&lt;br/&gt;
  File &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/avro/schema.py&quot;, line 294, in _&lt;em&gt;init&lt;/em&gt;_&lt;br/&gt;
    new_name = names.add_name(name, namespace, self)&lt;br/&gt;
  File &quot;/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/avro/schema.py&quot;, line 268, in add_name&lt;br/&gt;
    raise SchemaParseException(fail_msg)&lt;br/&gt;
avro.schema.SchemaParseException: record is a reserved type name.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12684414">PIG-3621</key>
            <summary>Python Avro library can&apos;t read Avros made with builtin AvroStorage</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="russell.jurney">Russell Jurney</assignee>
                                    <reporter username="russell.jurney">Russell Jurney</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Dec 2013 05:07:37 +0000</created>
                <updated>Tue, 15 Apr 2014 21:44:59 +0100</updated>
                            <resolved>Thu, 19 Dec 2013 03:03:41 +0000</resolved>
                                    <version>0.12.0</version>
                                    <fixVersion>0.12.1</fixVersion>
                    <fixVersion>0.13.0</fixVersion>
                                    <component>internal-udfs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13852191" author="russell.jurney" created="Wed, 18 Dec 2013 21:45:17 +0000"  >&lt;p&gt;I discovered the bug. Line 106 of AvroStorage.java uses the word &quot;record&quot; as the schema name. This is a reserved word in the Python implementation. Changing this name makes records from AvroStorage read fine by Python Avro.&lt;/p&gt;

&lt;p&gt;Patch coming.&lt;/p&gt;</comment>
                            <comment id="13852194" author="russell.jurney" created="Wed, 18 Dec 2013 21:47:00 +0000"  >&lt;p&gt;One-line patch that changes the name of the schema to a non-reserved word.&lt;/p&gt;</comment>
                            <comment id="13852312" author="cheolsoo" created="Wed, 18 Dec 2013 23:34:38 +0000"  >&lt;p&gt;Thank you for identifying the bug.&lt;/p&gt;

&lt;p&gt;I think using a more pig specific name is better. Looking at the code, it seems that &quot;pig_output&quot; is supposed to be used when no schema name is specified. I am attaching a new patch that sets the default schema name to &quot;pig_output&quot;.&lt;/p&gt;

&lt;p&gt;I will commit this if there is no objection.&lt;/p&gt;
</comment>
                            <comment id="13852439" author="dvryaboy" created="Thu, 19 Dec 2013 01:23:30 +0000"  >&lt;p&gt;Uh, no thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13852441" author="dvryaboy" created="Thu, 19 Dec 2013 01:25:55 +0000"  >&lt;p&gt;Sorry, that was a &quot;no&quot; to the assignment. Cheolsoo, does that var get set elsewhere? Why remove the logic for checking empty string, etc, and using a default?&lt;/p&gt;</comment>
                            <comment id="13852477" author="cheolsoo" created="Thu, 19 Dec 2013 02:11:34 +0000"  >&lt;p&gt;I thought that logic is redundant since 1) it is not possible to set schemaName to null, and 2) an empty schemaName is fine. But clearly, I am wrong about #2. It can result in an error. Here is an example-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a = LOAD &apos;foo&apos; AS (i:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
STORE a INTO &apos;bar&apos; USING AvroStorage(&apos;&apos;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I am putting the logic back in a new patch.&lt;/p&gt;

&lt;p&gt;Thank you Dmitriy for catching that!&lt;/p&gt;</comment>
                            <comment id="13852500" author="dvryaboy" created="Thu, 19 Dec 2013 02:23:53 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13852543" author="cheolsoo" created="Thu, 19 Dec 2013 03:03:41 +0000"  >&lt;p&gt;Committed to trunk. Thank you Russell and Dmitriy.&lt;/p&gt;</comment>
                            <comment id="13852550" author="cheolsoo" created="Thu, 19 Dec 2013 03:12:56 +0000"  >&lt;p&gt;Committed to 0.12.1 too.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12684577">AVRO-1412</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12684577">AVRO-1412</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12684577">AVRO-1412</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12619454" name="PIG-3621-3.patch" size="550" author="cheolsoo" created="Thu, 19 Dec 2013 02:11:34 +0000"/>
                            <attachment id="12619437" name="PIG-3631-2.patch" size="943" author="cheolsoo" created="Wed, 18 Dec 2013 23:34:38 +0000"/>
                            <attachment id="12619413" name="PIG-3631.patch" size="601" author="russell.jurney" created="Wed, 18 Dec 2013 21:47:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 18 Dec 2013 23:34:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>363486</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzki0n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>363792</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>