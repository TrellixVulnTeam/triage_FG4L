<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:59:10 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3677/PIG-3677.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3677] ConfigurationUtil.getLocalFSProperties can return an inconsistent property set</title>
                <link>https://issues.apache.org/jira/browse/PIG-3677</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;From  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jlowe&quot; class=&quot;user-hover&quot; rel=&quot;jlowe&quot;&gt;Jason Lowe&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;Our integration tests with a recent version of Hadoop 2.2 and pig were failing with these kinds of stacktraces for replicated join:&lt;/p&gt;

&lt;p&gt;2014-01-17 17:20:41,811 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; ERROR&lt;br/&gt;
org.apache.pig.tools.pigstats.SimplePigStats - ERROR 2997: Unable to recreate&lt;br/&gt;
exception from backed error: AttemptID:attempt_1389973251957_0127_m_000000_3&lt;br/&gt;
Info:Error: org.apache.pig.backend.executionengine.ExecException: ERROR 2081:&lt;br/&gt;
Unable to setup the load function.&lt;br/&gt;
    at&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POLoad.getNext(POLoad.java:125)&lt;br/&gt;
    at&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.physicalLayer.PhysicalOperator.processInput(PhysicalOperator.java:308)&lt;br/&gt;
    at&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POLocalRearrange.getNext(POLocalRearrange.java:263)&lt;br/&gt;
    at&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POFRJoin.setUpHashMap(POFRJoin.java:398)&lt;br/&gt;
    at&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POFRJoin.getNext(POFRJoin.java:231)&lt;br/&gt;
    at&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.runPipeline(PigGenericMapBase.java:286)&lt;br/&gt;
    at&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:281)&lt;br/&gt;
    at&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:64)&lt;br/&gt;
    at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:145)&lt;br/&gt;
    at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:764)&lt;br/&gt;
    at org.apache.hadoop.mapred.MapTask.run(MapTask.java:340)&lt;br/&gt;
    at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:165)&lt;br/&gt;
    at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
    at javax.security.auth.Subject.doAs(Subject.java:415)&lt;br/&gt;
    at&lt;br/&gt;
org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1562)&lt;br/&gt;
    at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:160)&lt;br/&gt;
Caused by: org.apache.hadoop.mapreduce.lib.input.InvalidInputException: Input&lt;br/&gt;
path does not exist:&lt;br/&gt;
hdfs://cluster-nn1.yahoo.com:8020/user/hitusr_1/pigrepl_scope-24_21617961_1389979200720_1&lt;br/&gt;
    at&lt;br/&gt;
org.apache.hadoop.mapreduce.lib.input.FileInputFormat.listStatus(FileInputFormat.java:285)&lt;br/&gt;
    at&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigFileInputFormat.listStatus(PigFileInputFormat.java:37)&lt;br/&gt;
    at&lt;br/&gt;
org.apache.hadoop.mapreduce.lib.input.FileInputFormat.getSplits(FileInputFormat.java:340)&lt;br/&gt;
    at org.apache.pig.impl.io.ReadToEndLoader.init(ReadToEndLoader.java:190)&lt;br/&gt;
    at org.apache.pig.impl.io.ReadToEndLoader.&amp;lt;init&amp;gt;(ReadToEndLoader.java:146)&lt;br/&gt;
    at&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POLoad.setUp(POLoad.java:93)&lt;br/&gt;
    at&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POLoad.getNext(POLoad.java:121)&lt;br/&gt;
    ... 15 more&lt;/p&gt;


&lt;p&gt;Debugged this to find that ConfigurationUtil.getLocalFSProperties can return a&lt;br/&gt;
property set where fs.default.name=&lt;a href=&quot;file:///&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:///&lt;/a&gt; but fs.defaultFS was&lt;br/&gt;
hdfs://cluster-nn1.yahoo.com:8020.  Pig is bypassing&lt;br/&gt;
Configuration.set(), so deprecated names aren&apos;t being handled properly.  Later&lt;br/&gt;
when we try to take these properties and poke them into a Configuration object,&lt;br/&gt;
if we try to set fs.defaultFS &lt;b&gt;after&lt;/b&gt; fs.default.name then both will end up as&lt;br/&gt;
hdfs://... and it breaks.&lt;/p&gt;

&lt;p&gt;We could have pig also set fs.defaultFS.  Problem is that if fs.default.name&lt;br/&gt;
gets yet another alias or is itself deprecated later then pig will have to&lt;br/&gt;
change or we can break again.  In that sense, another fix is to assert that&lt;br/&gt;
Configuration.isDeprecated(&quot;fs.default.name&quot;) is false and then filter out any&lt;br/&gt;
property where Configuration.isDeprecated() is true.  Then we&apos;re left with&lt;br/&gt;
settings that won&apos;t clobber each other when we go to build the configuration&lt;br/&gt;
later.&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jlowe&quot; class=&quot;user-hover&quot; rel=&quot;jlowe&quot;&gt;Jason Lowe&lt;/a&gt; for helping with debugging this. We had a hard time figuring this out as it failed with only 2.2 version of hadoop(+ few patches) and we don&apos;t have an answer to how we did not encounter this issue long ago with hadoop 0.23 and earlier versions of 2.x.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12689600">PIG-3677</key>
            <summary>ConfigurationUtil.getLocalFSProperties can return an inconsistent property set</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rohini">Rohini Palaniswamy</assignee>
                                    <reporter username="rohini">Rohini Palaniswamy</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Jan 2014 23:42:34 +0000</created>
                <updated>Tue, 15 Apr 2014 21:44:59 +0100</updated>
                            <resolved>Thu, 23 Jan 2014 05:57:33 +0000</resolved>
                                    <version>0.11.1</version>
                                    <fixVersion>0.12.1</fixVersion>
                    <fixVersion>0.13.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13879056" author="rohini" created="Wed, 22 Jan 2014 19:19:00 +0000"  >&lt;p&gt;Doing a unset which takes care of removing all aliased configuration properties.&lt;/p&gt;</comment>
                            <comment id="13879073" author="rohini" created="Wed, 22 Jan 2014 19:30:30 +0000"  >&lt;p&gt;Changed to use set instead of unset which is more simple.&lt;/p&gt;</comment>
                            <comment id="13879077" author="rohini" created="Wed, 22 Jan 2014 19:33:37 +0000"  >&lt;p&gt;Note: If &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-9725&quot; title=&quot;Configuration allows final parameters to be changed via set method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-9725&quot;&gt;HADOOP-9725&lt;/a&gt; gets fixed and if &quot;fs.default.name&quot; is a final parameter, this will break. There are other places in code like WeightedRangePartitioner, SkewedPartitioner, etc also that do conf.set(&quot;fs.default.name&quot;) directly and will break. &lt;/p&gt;</comment>
                            <comment id="13879465" author="aniket486" created="Thu, 23 Jan 2014 05:49:47 +0000"  >&lt;p&gt;Good catch! +1.&lt;/p&gt;</comment>
                            <comment id="13879471" author="rohini" created="Thu, 23 Jan 2014 05:57:33 +0000"  >&lt;p&gt;Committed to trunk. Thanks Aniket for the review.&lt;/p&gt;</comment>
                            <comment id="13882617" author="daijy" created="Mon, 27 Jan 2014 07:35:32 +0000"  >&lt;p&gt;Can we port it to 12.1?&lt;/p&gt;</comment>
                            <comment id="13882622" author="rohini" created="Mon, 27 Jan 2014 08:02:36 +0000"  >&lt;p&gt;Committed to branch-0.12 as well.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12691317">PIG-3725</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12657311">HADOOP-9725</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12624401" name="PIG-3677-1.patch" size="3537" author="rohini" created="Wed, 22 Jan 2014 19:19:00 +0000"/>
                            <attachment id="12624403" name="PIG-3677-2.patch" size="3541" author="rohini" created="Wed, 22 Jan 2014 19:30:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 23 Jan 2014 05:49:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>368567</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzldjr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>368871</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>