<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:57:33 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3642/PIG-3642.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3642] Direct HDFS access for small jobs (fetch) </title>
                <link>https://issues.apache.org/jira/browse/PIG-3642</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;With this patch I&apos;d like to add the possibility to directly read data from HDFS instead of launching MR jobs in case of simple (map-only) tasks. Hive already has this feature (fetch). This patch shares some similarities with the local mode of Pig 0.6. Here, fetching kicks off when the following holds for a script:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;it contains only LIMIT, FILTER, UNION (if no split is generated), STREAM, (nested) FOREACH with expression operators, custom UDFs..etc&lt;/li&gt;
	&lt;li&gt;no scalar aliases&lt;/li&gt;
	&lt;li&gt;no SampleLoader&lt;/li&gt;
	&lt;li&gt;single leaf job&lt;/li&gt;
	&lt;li&gt;DUMP (no STORE)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The feature is enabled by default and can be toggled with:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;-N or -no_fetch&lt;/li&gt;
	&lt;li&gt;set opt.fetch true/false;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;There&apos;s no STORE support because I wanted to make it explicit that this &quot;optimization&quot; is for launching small/simple scripts during development, rather than querying and filtering large number of rows on the client machine. However, a threshold could be given on the input size (an estimation) to determine whether to prefer fetch over MR jobs, similar to what Hive&apos;s &apos;&lt;tt&gt;hive.fetch.task.conversion.threshold&lt;/tt&gt;&apos; does. (through Pig&apos;s LoadMetadata#getStatistic ?)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12686477">PIG-3642</key>
            <summary>Direct HDFS access for small jobs (fetch) </summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lbendig">Lorand Bendig</assignee>
                                    <reporter username="lbendig">Lorand Bendig</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Dec 2013 23:13:43 +0000</created>
                <updated>Thu, 21 Aug 2014 00:34:34 +0100</updated>
                            <resolved>Mon, 3 Feb 2014 04:02:08 +0000</resolved>
                                                    <fixVersion>0.13.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13858261" author="cheolsoo" created="Sun, 29 Dec 2013 06:45:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lbendig&quot; class=&quot;user-hover&quot; rel=&quot;lbendig&quot;&gt;Lorand Bendig&lt;/a&gt;, is this patch ready for review? If so, do you mind uploading it to the &lt;a href=&quot;https://reviews.apache.org&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;review board&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;This feature will be very useful!&lt;/p&gt;</comment>
                            <comment id="13858471" author="lbendig" created="Sun, 29 Dec 2013 23:23:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt; es, I&apos;d like to have it reviewed&lt;/p&gt;</comment>
                            <comment id="13858473" author="lbendig" created="Sun, 29 Dec 2013 23:25:32 +0000"  >&lt;p&gt;Please find attached the review request at : &lt;a href=&quot;https://reviews.apache.org/r/16507/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/16507/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13860156" author="azaroth" created="Thu, 2 Jan 2014 11:57:29 +0000"  >&lt;p&gt;I am -0 on this idea.&lt;br/&gt;
Skipping MR requires rewriting good part of the execution logic, and might introduce weird optimization bugs.&lt;br/&gt;
More importantly, the added advantage brought by this feature is small.&lt;br/&gt;
Usually, if you want to test your program on a small input, you copy it locally and run Pig in local mode.&lt;/p&gt;</comment>
                            <comment id="13860224" author="lbendig" created="Thu, 2 Jan 2014 14:16:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=azaroth&quot; class=&quot;user-hover&quot; rel=&quot;azaroth&quot;&gt;Gianmarco De Francisci Morales&lt;/a&gt;, I took the idea of this patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2925&quot; title=&quot;Support non-MR fetching for simple queries with select/limit/filter operations only&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2925&quot;&gt;&lt;del&gt;HIVE-2925&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2864&quot; title=&quot;LOAD with FILTER should read data without MapReduce&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2864&quot;&gt;&lt;del&gt;PIG-2864&lt;/del&gt;&lt;/a&gt;. I agree, that the benefit is limited, however simple scripts/queries will run significantly faster than in local MR mode. As far as I can judge, aside from some mocking and initialization&lt;br/&gt;
the execution logic literally follows Pig&apos;s pull-based model. What optimization bugs do you think that can happen? &lt;/p&gt;</comment>
                            <comment id="13860228" author="azaroth" created="Thu, 2 Jan 2014 14:23:56 +0000"  >&lt;p&gt;I haven&apos;t reviewed the patch thoroughly so take my comments with the due care.&lt;br/&gt;
I am just afraid that we will redo the same &quot;mistake&quot; we did with the local mode execution of Pig that you mention in the ticket.&lt;br/&gt;
That mode of execution was removed because it was a burden to maintain, and in the end the two implementations (MR and local mode) were out of synch, resulting in the same script doing different things.&lt;br/&gt;
I just want to avoid the same thing happening again.&lt;/p&gt;

&lt;p&gt;If &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt; has reviewed the patch, I would like to hear his comments on this issue.&lt;/p&gt;</comment>
                            <comment id="13860392" author="cheolsoo" created="Thu, 2 Jan 2014 17:45:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=azaroth&quot; class=&quot;user-hover&quot; rel=&quot;azaroth&quot;&gt;Gianmarco De Francisci Morales&lt;/a&gt;, thank you for raising a concern. But I still think we should commit this patch for the following reasons-&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Fetch optimization happens after physical plan is fully built. If the plan is fetchable (i.e. meets all the conditions Lorand listed in the description), Pig will launch a job via FetchLauncher instead via MapReduceLauncher. Given this code path, I think the possibility of introducing a weird optimization bug is minimal. In addition, the optimization is only applicable to fairly small queries.&lt;/li&gt;
	&lt;li&gt;There are indeed changes to some backend operators such as POStream. This is because the logic about when to pull data from pipeline is different in some cases. But these changes are fairly minimal too.&lt;/li&gt;
	&lt;li&gt;IMO, the benefit of this optimization is big. I am constantly asked by users about this feature. True that it won&apos;t improve any performance of production ETL jobs, but it will shorten development iteration. In addition, launching a full MR job for a simple load/dump query definitely makes a bad impression to new users.&lt;/li&gt;
&lt;/ol&gt;




</comment>
                            <comment id="13860531" author="alangates" created="Thu, 2 Jan 2014 18:27:45 +0000"  >&lt;p&gt;I don&apos;t think this will result in the same local mode/mr mode problem that we had before.  The issue there was we tried (and failed) to have two modes where Pig provided all features.  This is much more limited to doing things locally that can easily be done locally.&lt;/p&gt;</comment>
                            <comment id="13862458" author="cheolsoo" created="Sun, 5 Jan 2014 01:12:20 +0000"  >&lt;p&gt;Uploading the patch that I am running unit/e2e tests.&lt;/p&gt;

&lt;p&gt;This patch adds a &quot;return&quot; to HExecutuinEngine#explain(). (See my comment in the RB.) I also cleaned trailing white spaces.&lt;/p&gt;</comment>
                            <comment id="13862693" author="cheolsoo" created="Mon, 6 Jan 2014 00:57:23 +0000"  >&lt;p&gt;I see 6 failures in unit tests-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;gt;&amp;gt;&amp;gt; org.apache.pig.impl.builtin.TestStreamingUDF.testPythonUDF_onCluster
&amp;gt;&amp;gt;&amp;gt; org.apache.pig.test.TestDefaultDateTimeZone.testLocalExecution
&amp;gt;&amp;gt;&amp;gt; org.apache.pig.test.TestEvalPipeline2.testNonStandardDataWithoutFetch
&amp;gt;&amp;gt;&amp;gt; org.apache.pig.test.TestEvalPipeline2.testBinStorageByteArrayCastsSimple
&amp;gt;&amp;gt;&amp;gt; org.apache.pig.test.TestEvalPipeline2.testLoadWithDifferentSchema
&amp;gt;&amp;gt;&amp;gt; org.apache.pig.test.TestStoreInstances.testBackendStoreCommunication
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Can you please take a look at them?&lt;/p&gt;</comment>
                            <comment id="13868977" author="lbendig" created="Sun, 12 Jan 2014 09:23:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;, thanks for pointing out these issues!&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;org.apache.pig.test.TestDefaultDateTimeZone.testLocalExecution&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It&apos;s because fetch didn&apos;t initialize pig.datetime.default.tz with the current timezone. Fixed.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;org.apache.pig.test.TestEvalPipeline2.testNonStandardDataWithoutFetch&lt;br/&gt;
org.apache.pig.test.TestEvalPipeline2.testBinStorageByteArrayCastsSimple&lt;br/&gt;
org.apache.pig.test.TestEvalPipeline2.testLoadWithDifferentSchema&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This was a non-fetch issue, now fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3662&quot; title=&quot;Static loadcaster in BinStorage can cause exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3662&quot;&gt;&lt;del&gt;PIG-3662&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;org.apache.pig.test.TestStoreInstances.testBackendStoreCommunication&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The problem was here that FetchOptimizer initialized FileLocalizer#relativeRoot to check whether POStore is related to a dump.&lt;br/&gt;
This initialized temporary path is in the threadlocal and it might happen that a Wrong FS: &lt;a href=&quot;file:/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/&lt;/a&gt;..., expected: hdfs://... exception&lt;br/&gt;
is thrown in those cases if the test is executed both in local and mapreduce mode in the same session. The temp path is initialized&lt;br/&gt;
to &lt;a href=&quot;file:/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/&lt;/a&gt; for the local mode and is reused for the mapreduce mode which causes the exception.&lt;br/&gt;
Now relativeRoot is not initialized by FetchOptimizer.&lt;/p&gt;

&lt;p&gt;I managed to run test-core successfully with -Dhadoopversion=23.&lt;/p&gt;</comment>
                            <comment id="13869187" author="cheolsoo" created="Sun, 12 Jan 2014 23:20:06 +0000"  >&lt;p&gt;Thank you Lorand! I am running unit tests again with your new patch.&lt;/p&gt;</comment>
                            <comment id="13870364" author="cheolsoo" created="Tue, 14 Jan 2014 04:05:11 +0000"  >&lt;p&gt;Unit tests all pass! Thank you so much!&lt;/p&gt;

&lt;p&gt;I am running e2e tests now.&lt;/p&gt;</comment>
                            <comment id="13872774" author="aniket486" created="Wed, 15 Jan 2014 23:19:21 +0000"  >&lt;p&gt;We have &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3463&quot; title=&quot;Pig should use hadoop local mode for small jobs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3463&quot;&gt;&lt;del&gt;PIG-3463&lt;/del&gt;&lt;/a&gt; that makes small jobs run in hadoop local mode. If that looks good, we can avoid adding complexity of FetchOptimizer.&lt;/p&gt;</comment>
                            <comment id="13873082" author="cheolsoo" created="Thu, 16 Jan 2014 06:25:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aniket486&quot; class=&quot;user-hover&quot; rel=&quot;aniket486&quot;&gt;Aniket Mokashi&lt;/a&gt;, are you saying we should commit &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3463&quot; title=&quot;Pig should use hadoop local mode for small jobs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3463&quot;&gt;&lt;del&gt;PIG-3463&lt;/del&gt;&lt;/a&gt; instead of this patch because the former includes the latter?&lt;/p&gt;</comment>
                            <comment id="13873440" author="lbendig" created="Thu, 16 Jan 2014 14:38:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aniket486&quot; class=&quot;user-hover&quot; rel=&quot;aniket486&quot;&gt;Aniket Mokashi&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3463&quot; title=&quot;Pig should use hadoop local mode for small jobs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3463&quot;&gt;&lt;del&gt;PIG-3463&lt;/del&gt;&lt;/a&gt; is a great add-on! Although the two patches target the same issue, as far as I see, they are not overlapping.&lt;br/&gt;
I think, in this case &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3642&quot; title=&quot;Direct HDFS access for small jobs (fetch) &quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3642&quot;&gt;&lt;del&gt;PIG-3642&lt;/del&gt;&lt;/a&gt; can be regarded as a further optimization on top of &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3463&quot; title=&quot;Pig should use hadoop local mode for small jobs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3463&quot;&gt;&lt;del&gt;PIG-3463&lt;/del&gt;&lt;/a&gt; when only a subset of simple operators are used and there&apos;s even no need of kicking off the LocalJobRunner. Having both add-ons can result in a way faster development cycle, I think. Why do not have both?&lt;/p&gt;</comment>
                            <comment id="13873754" author="aniket486" created="Thu, 16 Jan 2014 18:51:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lbendig&quot; class=&quot;user-hover&quot; rel=&quot;lbendig&quot;&gt;Lorand Bendig&lt;/a&gt;, I&apos;m not against the adding this feature to pig. However, from feature point of view, &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3463&quot; title=&quot;Pig should use hadoop local mode for small jobs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3463&quot;&gt;&lt;del&gt;PIG-3463&lt;/del&gt;&lt;/a&gt; is super set of &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3642&quot; title=&quot;Direct HDFS access for small jobs (fetch) &quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3642&quot;&gt;&lt;del&gt;PIG-3642&lt;/del&gt;&lt;/a&gt; with less complexity (pre-tested code etc) and code maintenance. Hence, we should avoid adding this extra complexity and burden of maintenance, if possible.&lt;/p&gt;</comment>
                            <comment id="13875995" author="cheolsoo" created="Sun, 19 Jan 2014 20:15:08 +0000"  >&lt;p&gt;I will leave the decision to Aniket and Lorand.&lt;/p&gt;

&lt;p&gt;Just FYI- I have been running e2e tests, and I found many test failures even without this patch. So it was hard to tell whether this patch breaks any tests or not.&lt;/p&gt;

&lt;p&gt;Here is the result in the current trunk (without this patch)-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[exec] Final results ,    PASSED: 536  FAILED: 22   SKIPPED: 24   ABORTED: 62   FAILED DEPENDENCY: 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We should fix these before things get worse.&lt;/p&gt;</comment>
                            <comment id="13876043" author="cheolsoo" created="Sun, 19 Jan 2014 23:01:57 +0000"  >&lt;p&gt;Actually, discard my e2e results. I found some environment issues and am rerunning them.&lt;/p&gt;</comment>
                            <comment id="13876315" author="lbendig" created="Mon, 20 Jan 2014 10:18:15 +0000"  >&lt;p&gt;Cheolsoo, thanks for testing it through.&lt;br/&gt;
However, I don&apos;t see the complexity as crucial, and it&apos;s also fairly separated from the existing code,&lt;br/&gt;
I see Aniket&apos;s point of view. I of course have +1 but obviously you guys on board have the right to make the decision.&lt;/p&gt;</comment>
                            <comment id="13876352" author="cheolsoo" created="Mon, 20 Jan 2014 11:20:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lbendig&quot; class=&quot;user-hover&quot; rel=&quot;lbendig&quot;&gt;Lorand Bendig&lt;/a&gt;, you&apos;re right. I was reviewing Aniket&apos;s patch today and realized that these two patches are fairly independent of each other.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aniket486&quot; class=&quot;user-hover&quot; rel=&quot;aniket486&quot;&gt;Aniket Mokashi&lt;/a&gt;, after understanding your patch more, I agree with Lorand regarding the complexity. Besides, it makes mapper only jobs almost instant. I couldn&apos;t compare runtime between &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3463&quot; title=&quot;Pig should use hadoop local mode for small jobs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3463&quot;&gt;&lt;del&gt;PIG-3463&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3642&quot; title=&quot;Direct HDFS access for small jobs (fetch) &quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3642&quot;&gt;&lt;del&gt;PIG-3642&lt;/del&gt;&lt;/a&gt; because the current patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3463&quot; title=&quot;Pig should use hadoop local mode for small jobs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3463&quot;&gt;&lt;del&gt;PIG-3463&lt;/del&gt;&lt;/a&gt; didn&apos;t work for mapper only jobs. However, I imagine it would be quite slower since it still launches local MR jobs, etc. So shall we commit both?&lt;/p&gt;

&lt;p&gt;In fact, what really concerns me is that these optimizations make many tests run differently than before. For eg, many e2e tests that are running as MR jobs now can run as fetch jobs. That significantly changes our code coverage. So I&apos;d like to explicitly disable these optimizations in all the existing e2e tests. It should be trivial to do via conf files. Do you agree?&lt;/p&gt;
</comment>
                            <comment id="13877734" author="cheolsoo" created="Tue, 21 Jan 2014 18:58:13 +0000"  >&lt;p&gt;Just FYI- e2e tests in trunk pass as of 01/21 except StreamingPythonUDFs_10. I will file a jira for this failure.&lt;/p&gt;</comment>
                            <comment id="13884027" author="lbendig" created="Tue, 28 Jan 2014 11:12:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;, do you think this patch is a good candidate to have it in trunk? If so, I&apos;d rebase it, had a look at the e2e conf and would run the unit tests again (e.g to see if it really doesn&apos;t conflict with &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3463&quot; title=&quot;Pig should use hadoop local mode for small jobs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3463&quot;&gt;&lt;del&gt;PIG-3463&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="13884207" author="cheolsoo" created="Tue, 28 Jan 2014 14:49:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lbendig&quot; class=&quot;user-hover&quot; rel=&quot;lbendig&quot;&gt;Lorand Bendig&lt;/a&gt;, yes, I still want to commit this patch. As soon as you rebase your patch, I can re-run the tests.&lt;/p&gt;

&lt;p&gt;For e2e tests, I think you add &quot;opt.fetch=false&quot; to &quot;./test/e2e/pig/conf/testpropertiesfile.conf&quot;. (I haven&apos;t tested it.)&lt;/p&gt;</comment>
                            <comment id="13886095" author="lbendig" created="Thu, 30 Jan 2014 00:45:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;, the patch is rebased, minor adjustments were needed.&lt;br/&gt;
Only a few e2e tests are affected, so I turned off fetch at these&lt;br/&gt;
individually through the &apos;java_params&apos; property. (It seems to&lt;br/&gt;
me that setting opt.fetch=false in testpropertiesfile.conf doesn&apos;t work)&lt;/p&gt;</comment>
                            <comment id="13888830" author="cheolsoo" created="Sun, 2 Feb 2014 05:34:25 +0000"  >&lt;p&gt;+1.&lt;/p&gt;

&lt;p&gt;All the e2e tests pass except &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3679&quot; title=&quot;e2e StreamingPythonUDFs_10 fails in trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3679&quot;&gt;&lt;del&gt;PIG-3679&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3739&quot; title=&quot;The Warning_4 e2e test is broken in trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3739&quot;&gt;&lt;del&gt;PIG-3739&lt;/del&gt;&lt;/a&gt;. (Both are unrelated.) &lt;/p&gt;

&lt;p&gt;I also confirmed that the fetch optimization is explicitly disabled in all the effected e2e test cases, so they will run in the same manner as before. In fact, I found one &quot;commented-out&quot; test case that can be effected by the fetch optimization. So I made an one-line change just to be safe as follows-&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;cmdline.conf#L71&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
#			&apos;java_params&apos; =&amp;gt; [&apos;-Dopt.fetch=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;],
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I will commit &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3642&quot; title=&quot;Direct HDFS access for small jobs (fetch) &quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3642&quot;&gt;&lt;del&gt;PIG-3642&lt;/del&gt;&lt;/a&gt;-6.patch if I don&apos;t hear any objection.&lt;/p&gt;</comment>
                            <comment id="13889197" author="cheolsoo" created="Mon, 3 Feb 2014 04:02:08 +0000"  >&lt;p&gt;Committed to trunk. Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lbendig&quot; class=&quot;user-hover&quot; rel=&quot;lbendig&quot;&gt;Lorand Bendig&lt;/a&gt; for the great work!&lt;/p&gt;

&lt;p&gt;As discussed in the RB, I opened a documentation jira and assign it to you, It would be nice if you could add a brief description to the Pig manual about this new feature.&lt;/p&gt;</comment>
                            <comment id="13889824" author="lbendig" created="Mon, 3 Feb 2014 19:49:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;, great! Thank you for your assistance! I&apos;ll take care of the docs.&lt;/p&gt;</comment>
                            <comment id="13963529" author="aniket486" created="Tue, 8 Apr 2014 23:20:56 +0100"  >&lt;blockquote&gt;&lt;p&gt;However, a threshold could be given on the input size (an estimation) to determine whether to prefer fetch over MR jobs, similar to what Hive&apos;s &apos;hive.fetch.task.conversion.threshold&apos; does. (through Pig&apos;s LoadMetadata#getStatistic ?)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lbendig&quot; class=&quot;user-hover&quot; rel=&quot;lbendig&quot;&gt;Lorand Bendig&lt;/a&gt;, we currently do not have such a restriction, correct? Should we add it? (The only case that doesn&apos;t require a size restriction is - load-limit-dump).&lt;/p&gt;</comment>
                            <comment id="13963972" author="lbendig" created="Wed, 9 Apr 2014 10:34:30 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aniket486&quot; class=&quot;user-hover&quot; rel=&quot;aniket486&quot;&gt;Aniket Mokashi&lt;/a&gt; Currently the restriction is that only dump is allowed which implies that users won&apos;t query large amount of data.&lt;br/&gt;
If store were supported then &apos;fetch.task.conversion.threshold&apos; would make sense. My concern is however, that most of the loaders return null for LoadMetadata#getStatistic. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12735593">PIG-4135</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12692767">PIG-3740</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12602310">PIG-2864</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12621490" name="PIG-3642-3.patch" size="74118" author="cheolsoo" created="Sun, 5 Jan 2014 01:12:20 +0000"/>
                            <attachment id="12622535" name="PIG-3642-4.patch" size="75078" author="lbendig" created="Sun, 12 Jan 2014 08:59:41 +0000"/>
                            <attachment id="12626027" name="PIG-3642-5.patch" size="81882" author="lbendig" created="Thu, 30 Jan 2014 00:45:16 +0000"/>
                            <attachment id="12626508" name="PIG-3642-6.patch" size="83769" author="cheolsoo" created="Sun, 2 Feb 2014 05:34:25 +0000"/>
                            <attachment id="12620558" name="PIG-3642.patch" size="65533" author="lbendig" created="Thu, 26 Dec 2013 23:15:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 29 Dec 2013 06:45:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365468</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzku6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365769</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>When the DUMP operator is used to execute Pig Latin statements, Pig can take the advantage to minimize latency by directly reading data from HDFS rather than launching MapReduce jobs.&lt;br/&gt;
&lt;br/&gt;
Direct fetch is turned on by default. To turn it off set the property opt.fetch to false or start Pig with the &amp;quot;-N&amp;quot; or &amp;quot;-no_fetch&amp;quot; option.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>