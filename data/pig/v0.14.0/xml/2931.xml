<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:09:06 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2931/PIG-2931.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2931] $ signs in the replacement string make parameter substitution fail</title>
                <link>https://issues.apache.org/jira/browse/PIG-2931</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;To reproduce the issue, use the following pig script:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;test.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a = load &apos;data&apos;;
b = filter by $FILTER;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and run the following command:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
pig -x local -dryrun -f test.pig -p FILTER=&lt;span class=&quot;code-quote&quot;&gt;&quot;(\$0 == &apos;a&apos;)&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This generates the following script:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;test.pig.substituted&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a = load &apos;data&apos;;
b = filter by ($FILTER == &apos;a&apos;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However this should be:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a = load &apos;data&apos;;
b = filter by ($0 == &apos;a&apos;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is because Pig calls replaceFirst() with a replacement string that include a $ sign as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;$FILTER&quot;&lt;/span&gt;.replaceFirst(&lt;span class=&quot;code-quote&quot;&gt;&quot;\\$FILTER&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;($0 == &apos;a&apos;)&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To treat $ signs as literals in the replacement string, we must escape them. Please see the &lt;a href=&quot;http://docs.oracle.com/javase/6/docs/api/java/util/regex/Matcher.html#replaceFirst(java.lang.String)&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Java doc&lt;/a&gt; for Matcher class for explanation:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Note that backslashes (&amp;#41; and dollar signs ($) in the replacement string may cause the results to be different than if it were being treated as a literal replacement string. Dollar signs may be treated as references to captured subsequences as described above, and backslashes are used to escape literal characters in the replacement string.&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12608966">PIG-2931</key>
            <summary>$ signs in the replacement string make parameter substitution fail</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cheolsoo">Cheolsoo Park</assignee>
                                    <reporter username="cheolsoo">Cheolsoo Park</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Sep 2012 06:40:11 +0100</created>
                <updated>Fri, 22 Feb 2013 04:54:09 +0000</updated>
                            <resolved>Fri, 19 Oct 2012 01:06:18 +0100</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.11</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13462471" author="cheolsoo" created="Tue, 25 Sep 2012 07:05:29 +0100"  >&lt;p&gt;Attaching a patch that fixes the issue by escaping $ signs in the replacement string.&lt;/p&gt;

&lt;p&gt;I also added a test case to the TestParamSubPreproc suite and verified that it passes.&lt;/p&gt;</comment>
                            <comment id="13466961" author="dvryaboy" created="Mon, 1 Oct 2012 18:17:52 +0100"  >&lt;p&gt;The patch looks correct, but I can&apos;t help but wonder if anyone might be (ab)using the current behavior.. second opinion?&lt;/p&gt;</comment>
                            <comment id="13467006" author="cheolsoo" created="Mon, 1 Oct 2012 18:50:57 +0100"  >&lt;p&gt;Hi Dmitriy,&lt;/p&gt;

&lt;p&gt;That&apos;s an interesting thought. But in this case, $0 and $1 will only be able to refer to parameter names. I can&apos;t think why someone would want to replace parameter names with strings that include themselves. I might not be seeing a useful case.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13478563" author="jcoveney" created="Thu, 18 Oct 2012 02:16:46 +0100"  >&lt;p&gt;Dmitriy, I agree with Cheolsoo. Seems unlikely, and I&apos;d rather fix it as it&apos;s a totally fair use of positionals. +1&lt;/p&gt;</comment>
                            <comment id="13478589" author="dvryaboy" created="Thu, 18 Oct 2012 02:56:59 +0100"  >&lt;p&gt;ok, +1. Please make a note about the highly unlikely backwards incompatibility.&lt;/p&gt;</comment>
                            <comment id="13479511" author="jcoveney" created="Fri, 19 Oct 2012 01:06:18 +0100"  >&lt;p&gt;Thanks Cheolsoo! It&apos;s in&lt;/p&gt;</comment>
                            <comment id="13481788" author="julienledem" created="Mon, 22 Oct 2012 21:58:16 +0100"  >&lt;p&gt;sorry to reply late on this. This would break users that are already double escaping $ to insert values containing $&lt;br/&gt;
We should escape $ only if it is not escaped yet.&lt;/p&gt;</comment>
                            <comment id="13481819" author="cheolsoo" created="Mon, 22 Oct 2012 22:26:17 +0100"  >&lt;p&gt;Hi Julien,&lt;/p&gt;

&lt;p&gt;Thank you very much for pointing that out. In fact, I&apos;ve just realized that I broke TestScriptLanguange for the reason that you&apos;re describing. Pig#bind() escapes &apos;$&apos;, so my change makes bindLocalVariableTest2() fail.&lt;/p&gt;

&lt;p&gt;Please let me open a jira under &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2972&quot; title=&quot;Umbrella ticket for test failures in 0.11/trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2972&quot;&gt;&lt;del&gt;PIG-2972&lt;/del&gt;&lt;/a&gt; and post a patch.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12507181">PIG-2074</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12546450" name="PIG-2931.patch" size="3977" author="cheolsoo" created="Tue, 25 Sep 2012 07:09:47 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 1 Oct 2012 17:17:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242069</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxwczr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12592</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>This changes the behavior of parameter substitution so that dollar signs in the replacement string are no longer treated as references to captured subsequences, but they are now treated as a literal replacement string. Therefore, this will cause backward compatibility issues for users who rely on the previous behavior of parameter substitution.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>