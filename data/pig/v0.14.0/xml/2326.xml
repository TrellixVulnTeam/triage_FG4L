<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:10:03 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2326/PIG-2326.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2326] Pig minicluster tests can not be run from eclipse</title>
                <link>https://issues.apache.org/jira/browse/PIG-2326</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Some of the setup of the minicluster tests are in the ant config hence they don&apos;t run in eclipse.&lt;br/&gt;
In particular:&lt;br/&gt;
System.setProperty(&quot;hadoop.log.dir&quot;, &quot;build/test/logs&quot;);&lt;br/&gt;
hadoop-site.xml in the classpath&lt;/p&gt;</description>
                <environment></environment>
        <key id="12527787">PIG-2326</key>
            <summary>Pig minicluster tests can not be run from eclipse</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="julienledem">Julien Le Dem</assignee>
                                    <reporter username="julienledem">Julien Le Dem</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Oct 2011 18:08:52 +0100</created>
                <updated>Fri, 22 Feb 2013 04:54:09 +0000</updated>
                            <resolved>Thu, 19 Jan 2012 06:48:24 +0000</resolved>
                                                    <fixVersion>0.11</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13130776" author="julienledem" created="Wed, 19 Oct 2011 18:11:05 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2326&quot; title=&quot;Pig minicluster tests can not be run from eclipse&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2326&quot;&gt;&lt;del&gt;PIG-2326&lt;/del&gt;&lt;/a&gt;.patch adds the missing required System.property and changes the location of the hadoop-site.xml so that it works from eclipse without additional setup&lt;/p&gt;</comment>
                            <comment id="13143216" author="azaroth" created="Thu, 3 Nov 2011 14:52:44 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13173326" author="azaroth" created="Tue, 20 Dec 2011 17:22:47 +0000"  >&lt;p&gt;Hi Julien,&lt;br/&gt;
I think you can commit this patch if you want.&lt;/p&gt;</comment>
                            <comment id="13175108" author="dvryaboy" created="Thu, 22 Dec 2011 22:15:37 +0000"  >&lt;p&gt;+1 but please remove dead code instead of leaving it commented out.&lt;/p&gt;</comment>
                            <comment id="13175215" author="julienledem" created="Fri, 23 Dec 2011 01:12:52 +0000"  >&lt;p&gt;Here is a new patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2326&quot; title=&quot;Pig minicluster tests can not be run from eclipse&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2326&quot;&gt;&lt;del&gt;PIG-2326&lt;/del&gt;&lt;/a&gt;_a.patch) addressing Dmitriy&apos;s comment and applying the same to the 0.23 shim layer.&lt;/p&gt;</comment>
                            <comment id="13175438" author="azaroth" created="Fri, 23 Dec 2011 14:11:58 +0000"  >&lt;p&gt;Now that I think of it, this makes the tests run through eclipse slightly different from the ones run using ant.&lt;br/&gt;
This could generate confusion.&lt;/p&gt;

&lt;p&gt;I would also change build.xml (also in piggybank and penny) to reference hadoop-site.xml from build/classes:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./build.xml:    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;junit.hadoop.conf&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${user.home}/pigtest/conf/&quot;&lt;/span&gt;/&amp;gt;
./contrib/piggybank/java/build.xml:    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;junit.hadoop.conf&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${user.home}/pigtest/conf/&quot;&lt;/span&gt;/&amp;gt;
./contrib/penny/java/build.xml:    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;junit.hadoop.conf&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;${user.home}/pigtest/conf/&quot;&lt;/span&gt;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And also change the docs:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./src/docs/src/documentation/content/xdocs/pigunit.xml:          The &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; value is ~/pigtest/conf.
./src/docs/src/documentation/content/xdocs/test.xml:          The &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; value is ~/pigtest/conf.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13175620" author="julienledem" created="Fri, 23 Dec 2011 23:23:23 +0000"  >&lt;p&gt;Some more files refering to pigtest/conf:&lt;/p&gt;

&lt;p&gt;./build/classes/docs/src/documentation/content/xdocs/pigunit.xml:          The default value is ~/pigtest/conf.&lt;br/&gt;
./build/classes/docs/src/documentation/content/xdocs/test.xml:          The default value is ~/pigtest/conf.&lt;br/&gt;
./build.xml:    &amp;lt;property name=&quot;junit.hadoop.conf&quot; value=&quot;$&lt;/p&gt;
{user.home}/pigtest/conf/&quot;/&amp;gt;&lt;br/&gt;
./CHANGES.txt:&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2219&quot; title=&quot;Pig tests fail if ${user.home}/pigtest/conf does not already exist&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2219&quot;&gt;&lt;del&gt;PIG-2219&lt;/del&gt;&lt;/a&gt;: Pig tests fail if ${user.home}
&lt;p&gt;/pigtest/conf does not already exist (cwsteinbach via gates)&lt;br/&gt;
./contrib/penny/java/build.xml:    &amp;lt;property name=&quot;junit.hadoop.conf&quot; value=&quot;$&lt;/p&gt;
{user.home}/pigtest/conf/&quot;/&amp;gt;&lt;br/&gt;
./contrib/piggybank/java/build.xml:    &amp;lt;property name=&quot;junit.hadoop.conf&quot; value=&quot;${user.home}
&lt;p&gt;/pigtest/conf/&quot;/&amp;gt;&lt;br/&gt;
./contrib/piggybank/java/src/test/java/org/apache/pig/piggybank/test/storage/TestPathPartitioner.java:    File oldConf = new File(System.getProperty(&quot;user.home&quot;)+&quot;/pigtest/conf/hadoop-site.xml&quot;);&lt;br/&gt;
./contrib/piggybank/java/src/test/java/org/apache/pig/piggybank/test/storage/TestPathPartitionHelper.java:    File oldConf = new File(System.getProperty(&quot;user.home&quot;)+&quot;/pigtest/conf/hadoop-site.xml&quot;);&lt;br/&gt;
./src/docs/src/documentation/content/xdocs/pigunit.xml:          The default value is ~/pigtest/conf.&lt;br/&gt;
./src/docs/src/documentation/content/xdocs/test.xml:          The default value is ~/pigtest/conf.&lt;br/&gt;
./src/org/apache/pig/backend/hadoop/datastorage/ConfigurationUtil.java:            // so pigtest/conf/hadoop-site.xml contains such entry. This prevents some tests from &lt;br/&gt;
./test/org/apache/pig/pigunit/MiniClusterRunner.java: *       System.getProperty(&quot;user.home&quot;), &quot;pigtest/conf/&quot;&amp;lt;/li&amp;gt;&lt;br/&gt;
./test/org/apache/pig/test/TestNativeMapReduce.java:    // the presence of ~/pigtest/conf/hadoop-site.xml created by MiniCluster&lt;/p&gt;

&lt;p&gt;I&apos;m updating the patch accordingly. You&apos;ll notice that some tests delete the file to avoid having it on the classpath.&lt;br/&gt;
The root problem is Pig checking for the existence of hadoop-site.xml on the classpath in Map/Reduce mode ( in org.apache.pig.backend.hadoop.executionengine.HExecutionEngine)&lt;br/&gt;
This makes unit testing hard as we cannot just pass Properties to PigServer and use the &quot;Hadoop local&quot; mode for tests. Tests step on each other through the config file.&lt;/p&gt;
</comment>
                            <comment id="13175689" author="daijy" created="Sat, 24 Dec 2011 07:53:37 +0000"  >&lt;p&gt;+1. I like the relocation of ~/pigtest/conf/hadoop-site to build/classes. &lt;/p&gt;

&lt;p&gt;The patch does not contain the change for hadoop 23 part. I can add it.&lt;/p&gt;</comment>
                            <comment id="13175698" author="azaroth" created="Sat, 24 Dec 2011 09:16:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;This makes unit testing hard as we cannot just pass Properties to PigServer and use the &quot;Hadoop local&quot; mode for tests. Tests step on each other through the config file.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hi Julien,&lt;br/&gt;
can we simply delete hadoop-site.xml in shutdownMiniMrClusters(), so that MiniCluster is &quot;self contained&quot;?&lt;br/&gt;
Would that solve the issue?&lt;/p&gt;</comment>
                            <comment id="13175811" author="daijy" created="Sun, 25 Dec 2011 07:54:11 +0000"  >&lt;p&gt;For some background of hadoop-site.xml checking in mapreduce mode, if not doing that, Pig would launch normally but into an inconsistent state, some command will run as if it is in local mode, and some command will fail. To avoid that, we mandate the existence of hadoop-site.xml in mapreduce mode.&lt;/p&gt;</comment>
                            <comment id="13182832" author="julienledem" created="Mon, 9 Jan 2012 21:55:23 +0000"  >&lt;p&gt;Hi Daniel,&lt;br/&gt;
That means there are places in Pig where it does not take into account properties passed to PigServer. Probably in static initializers and similar.&lt;br/&gt;
Mandating hadoop-site.xml does not fix those bugs.&lt;/p&gt;</comment>
                            <comment id="13182850" author="daijy" created="Mon, 9 Jan 2012 22:07:00 +0000"  >&lt;p&gt;Hi, Julien,&lt;br/&gt;
It does not take hadoop-site.xml. It does take Pig properties. What do you mean by static initializer?&lt;/p&gt;</comment>
                            <comment id="13182931" author="julienledem" created="Mon, 9 Jan 2012 23:35:03 +0000"  >&lt;p&gt;Sorry, I&apos;m just guessing here. I need to investigate more. I was wondering if the requirement for the file to be there was because some piece of code was statically initializing a new configuration without getting passed the properties. The behavior you describe makes me think of this.&lt;/p&gt;</comment>
                            <comment id="13184598" author="dvryaboy" created="Thu, 12 Jan 2012 00:43:36 +0000"  >&lt;p&gt;Daniel, is there a test for the commands you mention will fail if we fix this issue? &lt;br/&gt;
Seems like there&apos;s a bug there to begin with, and we should fix both this classpath thing and the commands that are otherwise inconsistent.&lt;/p&gt;</comment>
                            <comment id="13184644" author="daijy" created="Thu, 12 Jan 2012 01:36:14 +0000"  >&lt;p&gt;There are seems several threads in our discussion. I want to make sure we understand clearly:&lt;br/&gt;
1. The patch itself. I am totally fine with it if tests pass&lt;/p&gt;

&lt;p&gt;2. For the reason why we check existence hadoop-site.xml in mapreduce mode&lt;br/&gt;
Yes, remove this check will simplify MiniCluster test. However, I only want to solve one problem: If user run pig in mapreduce mode, but he forget putting config file in classpath, pig will remind user rather than enter into an agnostic mode. By agnostic mode, I mean some Pig operator run, but some are not (like order by).&lt;/p&gt;</comment>
                            <comment id="13184688" author="daijy" created="Thu, 12 Jan 2012 03:05:01 +0000"  >&lt;p&gt;I checked again it seems much better on current hadoop in that:&lt;br/&gt;
1. If Pig does not find hadoop config file, it is actually run as local mode, much better than agnostic mode previously (more test is needed to verify this is always the case)&lt;br/&gt;
2. bin/pig script has been improved, it will use HADOOP_HOME/HADOOP_CONF_DIR, the chance user get it wrong is drastically reduced&lt;/p&gt;

&lt;p&gt;Based on these, I am fine to drop this check on trunk.&lt;/p&gt;</comment>
                            <comment id="13184712" author="julienledem" created="Thu, 12 Jan 2012 04:19:38 +0000"  >&lt;p&gt;Hi Daniel,&lt;br/&gt;
1) yes we should focus on just running tests in eclipse on this JIRA. I created another one to discuss the hadoop-site.xml requirement: &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2451&quot; title=&quot;Pig should not mandate hadoop-site.xml or core-site.xml to be on the classpath&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2451&quot;&gt;PIG-2451&lt;/a&gt;&lt;br/&gt;
2) I agree with you that we should not get in a mode where the behavior is inconsistent when there is no config available. However it should work in the default Hadoop mode in that case: local file system and in-process execution. We should track down and fix any inconsistent behavior in that case.&lt;br/&gt;
I +1 on your last comment (and suggest we follow up on &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2451&quot; title=&quot;Pig should not mandate hadoop-site.xml or core-site.xml to be on the classpath&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2451&quot;&gt;PIG-2451&lt;/a&gt; for this).&lt;/p&gt;</comment>
                            <comment id="13188953" author="daijy" created="Thu, 19 Jan 2012 06:43:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2326&quot; title=&quot;Pig minicluster tests can not be run from eclipse&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2326&quot;&gt;&lt;del&gt;PIG-2326&lt;/del&gt;&lt;/a&gt;-3.patch resync with trunk.&lt;/p&gt;</comment>
                            <comment id="13188958" author="daijy" created="Thu, 19 Jan 2012 06:48:24 +0000"  >&lt;p&gt;Unit test pass.&lt;/p&gt;

&lt;p&gt;test-patch:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; -1 overall.  &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 @author.  The patch does not contain any @author tags.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 tests included.  The patch appears to include 29 new or modified tests.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     -1 javadoc.  The javadoc tool appears to have generated 1 warning messages.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt;     -1 release audit.  The applied patch generated 524 release audit warnings (more than the trunk&apos;s current 517 warnings).&lt;/p&gt;

&lt;p&gt;javadoc warning seems unrelated. No new file added, ignore release audit warning.&lt;/p&gt;

&lt;p&gt;Patch committed to trunk.&lt;/p&gt;</comment>
                            <comment id="13430513" author="rohini" created="Tue, 7 Aug 2012 19:37:38 +0100"  >&lt;p&gt;Daniel,&lt;br/&gt;
  Can we have this patch committed to 0.10 also. Without this running multiple builds on same hudson box is very difficult. Builds step on each other and fail due to hadoop-site.xml in user directory. With pig builds taking 10 hrs it wastes a lot of time.&lt;/p&gt;</comment>
                            <comment id="13430521" author="aklochkov" created="Tue, 7 Aug 2012 19:49:25 +0100"  >&lt;p&gt;Please consider committing the fix to 0.9.x also, by all the same reasons. Should we create separate tasks for that?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12536323">PIG-2451</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12511095" name="PIG-2326-3.patch" size="15657" author="daijy" created="Thu, 19 Jan 2012 06:43:26 +0000"/>
                            <attachment id="12499715" name="PIG-2326.patch" size="1038" author="julienledem" created="Wed, 19 Oct 2011 18:11:05 +0100"/>
                            <attachment id="12508477" name="PIG-2326_a.patch" size="3349" author="julienledem" created="Fri, 23 Dec 2011 01:14:38 +0000"/>
                            <attachment id="12508580" name="PIG-2326_b.patch" size="15742" author="julienledem" created="Fri, 23 Dec 2011 23:31:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Nov 2011 14:52:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>89284</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyawov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97607</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>After this patch, Pig does not create ~/pigtest any more when running unit test</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>