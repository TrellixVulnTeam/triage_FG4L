<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:53:34 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3807/PIG-3807.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3807] Pig creates wrong schema after dereferencing nested tuple fields with sorts</title>
                <link>https://issues.apache.org/jira/browse/PIG-3807</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The following script fails:&lt;/p&gt;

&lt;p&gt;d1 = load &apos;test_data.txt&apos; USING PigStorage() AS (f1: int, f2: int, f3: int, f4: int);&lt;br/&gt;
d2 = load &apos;test_data.txt&apos; USING PigStorage() AS (f1: int, f2: int, f3: int, f4: int);&lt;br/&gt;
&amp;#8211; the sorting causes the error&lt;br/&gt;
n1 = foreach (group d1 by f1) &lt;/p&gt;
{
	sorted = ORDER d1 by f2;
	generate group, flatten(d1.f3) as x3;
}
&lt;p&gt;;&lt;br/&gt;
n2 = foreach (group d2 by f1) &lt;/p&gt;
{
	sorted = ORDER d2 by f2;
	generate group, flatten(d2.f3) as q3;
}
&lt;p&gt;;&lt;br/&gt;
describe n1;&lt;br/&gt;
describe n2;&lt;/p&gt;

&lt;p&gt;joined = join n1 by (x3), n2 by (q3);&lt;br/&gt;
describe joined;&lt;br/&gt;
final = foreach joined generate n1::x3;&lt;br/&gt;
dump final;&lt;/p&gt;

&lt;p&gt;&amp;#8211; selected output below&lt;br/&gt;
n1: &lt;/p&gt;
{group: int,x3: int}
&lt;p&gt;n2: &lt;/p&gt;
{group: int,q3: int}
&lt;p&gt;joined: &lt;/p&gt;
{n1::group: int,n1::x3: int,n2::group: int,n2::q3: int}
&lt;p&gt;2014-03-11 19:16:35 ERROR Grunt:125 - ERROR 1025: &lt;br/&gt;
&amp;lt;file , line 17, column 32&amp;gt; Invalid field projection. Projected field &lt;span class=&quot;error&quot;&gt;&amp;#91;n1::x3&amp;#93;&lt;/span&gt; does not exist in schema: n1::f1:int,n1::f2:int,n1::f3:int,n1::f4:int,n2::f1:int,n2::f2:int,n2::f3:int,n2::f4:int.&lt;br/&gt;
Details at logfile: &lt;/p&gt;</description>
                <environment></environment>
        <key id="12700853">PIG-3807</key>
            <summary>Pig creates wrong schema after dereferencing nested tuple fields with sorts</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="ddreyfus">David Dreyfus</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Mar 2014 23:24:17 +0000</created>
                <updated>Mon, 7 Jul 2014 19:07:58 +0100</updated>
                            <resolved>Sun, 25 May 2014 20:46:02 +0100</resolved>
                                    <version>0.12.0</version>
                    <version>0.13.0</version>
                                    <fixVersion>0.13.0</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13931144" author="ddreyfus" created="Tue, 11 Mar 2014 23:26:52 +0000"  >&lt;p&gt;Test data used in script. Same as &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2767&quot; title=&quot;Pig creates wrong schema after dereferencing nested tuple fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2767&quot;&gt;&lt;del&gt;PIG-2767&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13937427" author="daijy" created="Mon, 17 Mar 2014 03:34:45 +0000"  >&lt;p&gt;Another DanglingNestedNode issue. Thanks for reporting!&lt;/p&gt;</comment>
                            <comment id="13940824" author="rohini" created="Wed, 19 Mar 2014 18:48:53 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13941009" author="daijy" created="Wed, 19 Mar 2014 21:18:38 +0000"  >&lt;p&gt;Turns out the change is a subset of &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knoguchi&quot; class=&quot;user-hover&quot; rel=&quot;knoguchi&quot;&gt;Koji Noguchi&lt;/a&gt;&apos;s patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2970&quot; title=&quot;Nested foreach getting incorrect schema when having unrelated inner query&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2970&quot;&gt;&lt;del&gt;PIG-2970&lt;/del&gt;&lt;/a&gt;. Credit to Koji!&lt;/p&gt;

&lt;p&gt;Patch committed to trunk. Thanks Rohini for review!&lt;/p&gt;</comment>
                            <comment id="13941045" author="ddreyfus" created="Wed, 19 Mar 2014 21:47:44 +0000"  >&lt;p&gt;Hi Daniel,&lt;br/&gt;
How can I locate jar files with these patches implemented?&lt;/p&gt;

&lt;p&gt;Thank you&lt;/p&gt;

&lt;p&gt;Sent from my iPhone&lt;/p&gt;

</comment>
                            <comment id="13941054" author="daijy" created="Wed, 19 Mar 2014 21:53:06 +0000"  >&lt;p&gt;You can build from trunk:&lt;br/&gt;
svn co &lt;a href=&quot;http://svn.apache.org/repos/asf/pig/trunk&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/pig/trunk&lt;/a&gt;&lt;br/&gt;
cd trunk&lt;br/&gt;
ant (or ant -Dhadoopversion=23 if you are using Hadoop 2)&lt;/p&gt;</comment>
                            <comment id="13964557" author="ddreyfus" created="Wed, 9 Apr 2014 20:10:07 +0100"  >&lt;p&gt;When I test using pig 0.13.0 the problem remains.&lt;br/&gt;
Can someone double-check that the problem has been resolved?&lt;br/&gt;
```&lt;br/&gt;
n1: &lt;/p&gt;
{group: int,x3: int}
&lt;p&gt;n2: &lt;/p&gt;
{group: int,q3: int}
&lt;p&gt;joined: &lt;/p&gt;
{n1::group: int,n1::x3: int,n2::group: int,n2::q3: int}
&lt;p&gt;2014-04-09 14:58:55 ERROR Grunt:125 - ERROR 1025: &lt;br/&gt;
&amp;lt;file C:/Users/dreyfusd/Dropbox/workspace_Pig/&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2767&quot; title=&quot;Pig creates wrong schema after dereferencing nested tuple fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2767&quot;&gt;&lt;del&gt;PIG-2767&lt;/del&gt;&lt;/a&gt;-bug/pig-2767-bug.pig, line 18, column 32&amp;gt; Invalid field projection. Projected field &lt;span class=&quot;error&quot;&gt;&amp;#91;n1::x3&amp;#93;&lt;/span&gt; does not exist in schema: n1::f1:int,n1::f2:int,n1::f3:int,n1::f4:int,n2::f1:int,n2::f2:int,n2::f3:int,n2::f4:int.&lt;/p&gt;</comment>
                            <comment id="13966091" author="daijy" created="Fri, 11 Apr 2014 02:01:33 +0100"  >&lt;p&gt;Seems it is fine for me:&lt;br/&gt;
d1 = load &apos;test_data.txt&apos; USING PigStorage() AS (f1: int, f2: int, f3: int, f4: int);&lt;br/&gt;
d2 = load &apos;test_data.txt&apos; USING PigStorage() AS (f1: int, f2: int, f3: int, f4: int);&lt;br/&gt;
n1 = foreach (group d1 by f1) &lt;/p&gt;
{sorted = ORDER d1 by f2; generate group, flatten(d1.f3) as x3; }
&lt;p&gt;;&lt;br/&gt;
n2 = foreach (group d2 by f1) &lt;/p&gt;
{sorted = ORDER d2 by f2; generate group, flatten(d2.f3) as q3; }
&lt;p&gt;;&lt;br/&gt;
joined = join n1 by x3, n2 by q3;&lt;br/&gt;
final = foreach joined generate n1::x3;&lt;br/&gt;
describe final;&lt;/p&gt;

&lt;p&gt;final: &lt;/p&gt;
{n1::x3: int}

&lt;p&gt;What is the exact script are you running?&lt;/p&gt;</comment>
                            <comment id="13967592" author="ddreyfus" created="Sat, 12 Apr 2014 18:28:01 +0100"  >&lt;p&gt;I run the script that I posted originally.&lt;br/&gt;
I test running against 0.13.0 without the attached patch, based on my understanding.&lt;br/&gt;
Do I need to apply patch-3807-1, too?&lt;/p&gt;</comment>
                            <comment id="13968079" author="daijy" created="Mon, 14 Apr 2014 05:56:11 +0100"  >&lt;p&gt;The patch is already committed to trunk. What do you mean 0.13.0? Do you check out trunk and build Pig by yourself?&lt;/p&gt;</comment>
                            <comment id="13968253" author="ddreyfus" created="Mon, 14 Apr 2014 12:19:03 +0100"  >&lt;p&gt;1) Yes, I built the trunk.&lt;br/&gt;
2) After rebuilding the trunk doing a &lt;del&gt;clean&lt;/del&gt; first, it worked better.&lt;br/&gt;
3) However, testing on Windows under Eclipse I notice that Pig can&apos;t delete its temp files. Do you notice any such problem?&lt;/p&gt;</comment>
                            <comment id="13968299" author="ddreyfus" created="Mon, 14 Apr 2014 13:29:25 +0100"  >&lt;p&gt;It works as expected on Linux after a better build of the trunk.&lt;/p&gt;</comment>
                            <comment id="13968695" author="ddreyfus" created="Mon, 14 Apr 2014 20:11:18 +0100"  >&lt;p&gt;GruntParser.processDump() doesn&apos;t close any files on Windows after completing the dump.&lt;br/&gt;
Not sure where to look, but the iterator allocated in processDump() doesn&apos;t close the file.&lt;br/&gt;
ReadToEndLoader.initializeReader() doesn&apos;t close the file when the curSplitIndex &amp;gt; inpSplits.size()-1. Perhaps it should close the reader if it&apos;s open and ALSO return false.&lt;/p&gt;</comment>
                            <comment id="13968744" author="daijy" created="Mon, 14 Apr 2014 20:46:09 +0100"  >&lt;p&gt;This seems to be a separate issue and we shall open a new Jira for it. Do you see any exception? How can I reproduce it?&lt;/p&gt;</comment>
                            <comment id="13968764" author="ddreyfus" created="Mon, 14 Apr 2014 21:02:42 +0100"  >&lt;p&gt;Yes. Close the 3807 and open a new one case.&lt;br/&gt;
No exceptions.&lt;br/&gt;
Use the same script as provided for pig-3807, except run it from Eclipse on Windows.&lt;br/&gt;
You&apos;ll notice two errors at the end of execution corresponding to an attempt to delete the two files that are still open.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12635025" name="PIG-3807-1.patch" size="2444" author="daijy" created="Mon, 17 Mar 2014 03:34:45 +0000"/>
                            <attachment id="12634049" name="test_data.txt" size="43" author="ddreyfus" created="Tue, 11 Mar 2014 23:26:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 17 Mar 2014 03:34:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>379196</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzn6wf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>379488</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>