<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:07:41 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2837/PIG-2837.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2837] AvroStorage throws StackOverFlowError</title>
                <link>https://issues.apache.org/jira/browse/PIG-2837</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;When i try to dump avro data using&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
records = LOAD &apos;/logs/records/07262012/01/1/Record.1343265732700.avro&apos; using org.apache.pig.piggybank.storage.avro.AvroStorage(); 
dump records;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Pig Stack Trace 
--------------- 
ERROR 2998: Unhandled internal error. &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
java.lang.StackOverflowError 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:258) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:262) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:262) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:271) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:284) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:262) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:271) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:284) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:262) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:271) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:284) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:262) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:271) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:284) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:262) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:271) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:284) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:262) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:271) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:284) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:262) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:271) 
at org.apache.pig.piggybank.storage.avro.AvroStorageUtils.containsGenericUnion(AvroStorageUtils.java:284)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I did verify the avro schema using avro-tools and dump the data as json format, data looks good.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12600256">PIG-2837</key>
            <summary>AvroStorage throws StackOverFlowError</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cheolsoo">Cheolsoo Park</assignee>
                                    <reporter username="mubarakseyed">Mubarak Seyed</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Jul 2012 03:22:42 +0100</created>
                <updated>Fri, 22 Feb 2013 04:54:06 +0000</updated>
                            <resolved>Mon, 6 Aug 2012 08:47:06 +0100</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.11</fixVersion>
                                    <component>piggybank</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13423014" author="qwertymaniac" created="Thu, 26 Jul 2012 12:37:12 +0100"  >&lt;p&gt;I can imagine this happening if there&apos;s a self-reference in the schema. For example, an array of the record name itself being a field inside the schema. In this case, the record&apos;s type and schema is re-resolved and it enters an infinite loop.&lt;/p&gt;

&lt;p&gt;I suppose we could keep a reference of names (with namespace, for correctness) and only re-call if we&apos;ve not already visited it?&lt;/p&gt;</comment>
                            <comment id="13423644" author="cheolsoo" created="Fri, 27 Jul 2012 03:47:13 +0100"  >&lt;p&gt;It seems that AvroStorage does not support recursive record and generic union:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;1. Limited support for &quot;record&quot;: we do not support recursively defined record because the number of fields in such records is data dependent.&lt;br/&gt;
2. Limited support for &quot;union&quot;: we only accept nullable union like &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;null&amp;quot;, &amp;quot;some-type&amp;quot;&amp;#93;&lt;/span&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://cwiki.apache.org/PIG/avrostorage.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://cwiki.apache.org/PIG/avrostorage.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AvroStorage checks the above limitations and throws exceptions when violated; however, since #2 is checked before #1, we ends up with stack overflow if schema is recursive. This can be avoided by changing the order of the checks so that AvroStorage fails fast if schema is recursive.&lt;/p&gt;

&lt;p&gt;I uploaded a patch that changes the order of the checks and adds two test cases to TestAvroStorage to verify that proper exceptions are thrown for two cases. My test can be run with the following commands:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
tar -xf avro_test_files.tar.gz
ant clean compile-test piggybank -Dhadoopversion=20
cd contrib/piggybank/java
ant test -Dtestcase=TestAvroStorage
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13427215" author="cheolsoo" created="Thu, 2 Aug 2012 10:53:54 +0100"  >&lt;p&gt;Review board:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/6319/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/6319/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13428998" author="cheolsoo" created="Mon, 6 Aug 2012 07:50:21 +0100"  >&lt;p&gt;Fixed typos in comments.&lt;/p&gt;</comment>
                            <comment id="13429011" author="sms" created="Mon, 6 Aug 2012 08:46:36 +0100"  >&lt;p&gt;Patch has been committed. TestDBStorage (Hadoop 20 and Hadoop 23), TestMultiStorage (Hadoop 23) are failing and TestLookupInFiles in Hadoop 23 is erroring out. All of these are unrelated to this patch.&lt;/p&gt;

&lt;p&gt;Thanks Cheolsoo!&lt;/p&gt;</comment>
                            <comment id="13429274" author="cheolsoo" created="Mon, 6 Aug 2012 18:23:13 +0100"  >&lt;p&gt;@Santhosh,&lt;/p&gt;

&lt;p&gt;Thanks for reviewing my patch!&lt;/p&gt;

&lt;p&gt;Regarding the other test failures,&lt;/p&gt;

&lt;p&gt;1) If I run the following commands, I don&apos;t see TestDBStorage failure in Hadoop 20:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ant clean compile-test jar-withouthadoop -Dhadoopversion=20 &lt;span class=&quot;code-comment&quot;&gt;// Note jar-withouthadoop
&lt;/span&gt;cd contrib/piggybank/java
ant clean test -Dtestcase=TestAvroStorage -Dhadoopversion=20
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2) I believe that TestDBStorage/TestMultiStorage/TestLookupInFiles failures are due to some mini cluster mis-configuration:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2012-08-06 01:13:52,340 INFO  [AsyncDispatcher event handler] rmapp.RMAppImpl (RMAppImpl.java:transition(533)) - Application application_1344240816627_0001 failed 1 times due to AM Container &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; appatt     empt_1344240816627_0001_000001 exited with  exitCode: 127 due to:
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;While I see them failing on Mac, they run fine on CentOS 6. I am wondering if it would be better to modify these tests so that they will run in local mode instead of mr mode.&lt;/p&gt;

&lt;p&gt;Thanks! &lt;/p&gt;</comment>
                            <comment id="13429564" author="cheolsoo" created="Tue, 7 Aug 2012 00:15:46 +0100"  >&lt;p&gt;Actually, I have clean runs on Mac in both hadoop 20 and 23 with following commands:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;hadoop 20&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ant clean compile-test jar-withouthadoop -Dhadoopversion=20
cd contrib/piggybank/java
ant clean test -Dhadoopversion=20
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;hadoop 23&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ant clean compile-test jar-withouthadoop -Dhadoopversion=23
cd contrib/piggybank/java
JAVA_HOME=`/usr/libexec/java_home` ant clean test -Dhadoopversion=23
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12539243" name="PIG-2837-2.patch" size="4892" author="cheolsoo" created="Mon, 6 Aug 2012 07:50:21 +0100"/>
                            <attachment id="12538117" name="PIG-2837.patch" size="4894" author="cheolsoo" created="Fri, 27 Jul 2012 03:49:34 +0100"/>
                            <attachment id="12538114" name="avro_test_files.tar.gz" size="523" author="cheolsoo" created="Fri, 27 Jul 2012 03:30:53 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 26 Jul 2012 11:37:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242341</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxwofj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14445</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>