<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:56:27 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-4220/PIG-4220.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-4220] MapReduce-based Rank failing with NPE due to missing Counters</title>
                <link>https://issues.apache.org/jira/browse/PIG-4220</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;User reported his pig job with Rank was failing at &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Pig Stack Trace
---------------
ERROR 2043: Unexpected error during execution.

org.apache.pig.backend.executionengine.ExecException: ERROR 2043: Unexpected
error during execution.
        at org.apache.pig.PigServer.launchPlan(PigServer.java:1296)
        at
org.apache.pig.PigServer.executeCompiledLogicalPlan(PigServer.java:1270)
        at org.apache.pig.PigServer.execute(PigServer.java:1260)
        at org.apache.pig.PigServer.executeBatch(PigServer.java:354)
        at
org.apache.pig.tools.grunt.GruntParser.executeBatch(GruntParser.java:138)
        at
org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:200)
        at
org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:171)
        at org.apache.pig.tools.grunt.Grunt.exec(Grunt.java:84)
        at org.apache.pig.Main.run(Main.java:480)
        at org.apache.pig.Main.main(Main.java:157)
Caused by: java.lang.RuntimeException: Error to read counters into Rank
operation counterSize 277
        at
org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.saveCounters(JobControlCompiler.java:384)
        at
org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.updateMROpPlan(JobControlCompiler.java:330)
        at
org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher.launchPig(MapReduceLauncher.java:385)
        at org.apache.pig.PigServer.launchPlan(PigServer.java:1285)
        ... 9 more
Caused by: java.lang.NullPointerException
        at
org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.saveCounters(JobControlCompiler.java:375)
        ... 12 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(this is different from PIG:3985 NPE)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12745563">PIG-4220</key>
            <summary>MapReduce-based Rank failing with NPE due to missing Counters</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knoguchi">Koji Noguchi</assignee>
                                    <reporter username="knoguchi">Koji Noguchi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Oct 2014 19:29:05 +0100</created>
                <updated>Fri, 21 Nov 2014 05:58:52 +0000</updated>
                            <resolved>Mon, 6 Oct 2014 22:35:41 +0100</resolved>
                                                    <fixVersion>0.14.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14156955" author="knoguchi" created="Thu, 2 Oct 2014 19:37:03 +0100"  >&lt;p&gt;NPE was due to some PigMapReduceCounter.PigMapCounter getting empty inputs thus not creating corresponding counters.  However, JobControlCompiler(a reader) assumes all mappers to create the counters.&lt;br/&gt;
Fix can be&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Adding counter of 0 at initialization of the tasks&lt;br/&gt;
or&lt;/li&gt;
	&lt;li&gt;In the JobControlCompiler, assume 0 for non-existence counters.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This patch takes the first approach&lt;/p&gt;</comment>
                            <comment id="14156965" author="rohini" created="Thu, 2 Oct 2014 19:41:38 +0100"  >&lt;p&gt;Why not just call PigMapReduceCounter.PigReduceCounter.incrementCounter(0);?&lt;/p&gt;</comment>
                            <comment id="14156989" author="knoguchi" created="Thu, 2 Oct 2014 20:06:18 +0100"  >&lt;p&gt;Rohini pointed out that we need the same change on the PigReduceCounter side.  Added.&lt;/p&gt;

&lt;p&gt;Also, getting rid of the code segment where it catches Exception and ignoring it.  This may to incorrect results. &lt;/p&gt;

&lt;p&gt;Other than that, trying to keep the original format.&lt;/p&gt;</comment>
                            <comment id="14156992" author="knoguchi" created="Thu, 2 Oct 2014 20:07:52 +0100"  >&lt;p&gt;Accidentally added a patch with debug statement.  Reattaching.&lt;/p&gt;</comment>
                            <comment id="14157082" author="rohini" created="Thu, 2 Oct 2014 21:05:47 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14158320" author="rohini" created="Fri, 3 Oct 2014 19:34:57 +0100"  >&lt;p&gt;Need to call PigStatusReporter.setContext(context); before incrementCounter in PigReduceCounter&lt;/p&gt;</comment>
                            <comment id="14158466" author="knoguchi" created="Fri, 3 Oct 2014 21:17:58 +0100"  >&lt;blockquote&gt;&lt;p&gt;Need to call PigStatusReporter.setContext(context); before incrementCounter in PigReduceCounter&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks for catching that.&lt;/p&gt;</comment>
                            <comment id="14158476" author="rohini" created="Fri, 3 Oct 2014 21:22:50 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14158481" author="knoguchi" created="Fri, 3 Oct 2014 21:27:09 +0100"  >&lt;p&gt;hmm. My v3 patch fails on compile error.  I&apos;ll upload another one.&lt;/p&gt;</comment>
                            <comment id="14158514" author="rohini" created="Fri, 3 Oct 2014 21:59:13 +0100"  >&lt;p&gt;Sorry that change was required only for backporting to 0.11. Your v2 patch is good and you can go ahead and check that in. &lt;/p&gt;</comment>
                            <comment id="14161004" author="knoguchi" created="Mon, 6 Oct 2014 22:35:41 +0100"  >&lt;p&gt;Committed pig-4220-v02.txt patch.  Thanks Rohini for the review!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12672600" name="pig-4220-v01.txt" size="1055" author="knoguchi" created="Thu, 2 Oct 2014 19:37:03 +0100"/>
                            <attachment id="12672607" name="pig-4220-v02.txt" size="3194" author="knoguchi" created="Thu, 2 Oct 2014 20:07:52 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 2 Oct 2014 18:41:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzulxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>