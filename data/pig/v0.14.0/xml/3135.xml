<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:04:11 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3135/PIG-3135.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3135] HExecutionEngine should look for resources in user passed Properties</title>
                <link>https://issues.apache.org/jira/browse/PIG-3135</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Looking at this snippet:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void init(Properties properties) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ExecException {
          .
          .
          .

            &lt;span class=&quot;code-comment&quot;&gt;// Check existence of hadoop-site.xml or core-site.xml
&lt;/span&gt;            Configuration testConf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Configuration();
            &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; cl = testConf.getClassLoader();
            URL hadoop_site = cl.getResource( HADOOP_SITE );
            URL core_site = cl.getResource( CORE_SITE );
           
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;( hadoop_site == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; core_site == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ) {
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ExecException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot find hadoop configurations in classpath (neither hadoop-site.xml nor core-site.xml was found in the classpath).&quot;&lt;/span&gt; +
                        &lt;span class=&quot;code-quote&quot;&gt;&quot; If you plan to use local mode, please put -x local option in command line&quot;&lt;/span&gt;,
                        4010);
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This assumes the resources (*-site.xml) are set on the classpath, but this will not always be the case when run with Pig&apos;s Java APIs. One could want to programatically set the resources and the code here should additionally check if they are available in there. &lt;/p&gt;

&lt;p&gt;Example: When a Configuration object is created and resources are added before passing it on to Pig.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Configuration conf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Configuration(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
conf.addResource(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo/core-site.xml&quot;&lt;/span&gt;);
conf.addResource(&lt;span class=&quot;code-quote&quot;&gt;&quot;bar/hadoop-site.xml&quot;&lt;/span&gt;);

PigServer pServer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PigServer(ExecType.MAPREDUCE, conf);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The above conf is not used right now to obtain resources.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12628834">PIG-3135</key>
            <summary>HExecutionEngine should look for resources in user passed Properties</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="prkommireddi">Prashant Kommireddi</assignee>
                                    <reporter username="prkommireddi">Prashant Kommireddi</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Jan 2013 01:15:54 +0000</created>
                <updated>Mon, 14 Oct 2013 17:46:52 +0100</updated>
                            <resolved>Sun, 24 Feb 2013 03:38:23 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13561272" author="prkommireddi" created="Thu, 24 Jan 2013 00:26:18 +0000"  >&lt;p&gt;To get around the current limitation of depending on *site.xml files being set on classpath, we could add a property &quot;pig.use.override.configs&quot; to be able to provide your own configs and have JobConf be built from that. &lt;/p&gt;

&lt;p&gt;Currently:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
jc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JobConf();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Proposal:&lt;/p&gt;

&lt;p&gt;1. If &quot;pig.use.override.configs&quot; is present, generate JobConf using properties&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
jc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JobConf(ConfigurationUtil.toConfiguration(properties));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This change would be backward compatible, and those who wish to bypass classpath limitation can do so by setting the override property.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="13562274" author="prkommireddi" created="Fri, 25 Jan 2013 02:04:33 +0000"  >&lt;p&gt;Would appreciate if someone can take a look. I have added a new Test class for HExecutionEngine as these couple tests don&apos;t fit in any other place, and it makes sense to have its own Test for it.&lt;/p&gt;</comment>
                            <comment id="13566853" author="cheolsoo" created="Wed, 30 Jan 2013 20:00:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prkommireddi&quot; class=&quot;user-hover&quot; rel=&quot;prkommireddi&quot;&gt;Prashant Kommireddi&lt;/a&gt; Overall looks good to me. I have 3 questions.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Can we call the property &quot;pig.use.overriden.hadoop.configs&quot;? What we&apos;re overriding here are basically Hadoop confs, so I think that a more specific name is better. Do you agree?&lt;/li&gt;
	&lt;li&gt;On a related note, can you update the following comment in testJobConfGeneration?&lt;br/&gt;
From:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// This should fail as pig expects classpath to be set&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;To something like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// This should fail as pig expects Hadoop configs are present in classpath.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Can you add this new property to conf/pig.properties with some explanation, so people can know about it? It would be nice if we could mention that this is a Mr-mode-specific property too. Please let me know if you have a better suggestion regarding how to document this.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13567030" author="prkommireddi" created="Wed, 30 Jan 2013 22:54:19 +0000"  >&lt;p&gt;Thanks for the quick review. Your comments make sense, I will make the above changes and upload a new patch.&lt;/p&gt;</comment>
                            <comment id="13569998" author="prkommireddi" created="Mon, 4 Feb 2013 05:33:03 +0000"  >&lt;p&gt;Hi Cheolsoo, find attached a revised patch as per our previous discussion.&lt;/p&gt;</comment>
                            <comment id="13570012" author="cheolsoo" created="Mon, 4 Feb 2013 06:27:38 +0000"  >&lt;p&gt;+1. I will commit it after running tests.&lt;/p&gt;</comment>
                            <comment id="13570733" author="cheolsoo" created="Mon, 4 Feb 2013 23:10:12 +0000"  >&lt;p&gt;Committed to trunk. Thanks Prashant!&lt;/p&gt;</comment>
                            <comment id="13570739" author="prkommireddi" created="Mon, 4 Feb 2013 23:18:57 +0000"  >&lt;p&gt;Thanks for the review and commit, Cheolsoo.&lt;/p&gt;</comment>
                            <comment id="13575568" author="cheolsoo" created="Sun, 10 Feb 2013 23:01:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prkommireddi&quot; class=&quot;user-hover&quot; rel=&quot;prkommireddi&quot;&gt;Prashant Kommireddi&lt;/a&gt;, very sorry for reopening the jira, but this makes unit test fail.&lt;/p&gt;

&lt;p&gt;Note that &lt;tt&gt;ant clean test -Dtestcase=TestHExecutionEngine&lt;/tt&gt; always passes. But when you run the test as part of unit test (i.e. ant clean test), it fails.&lt;/p&gt;

&lt;p&gt;To reproduce, please do the following:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Run a unit test that uses mini-cluster (e.g. TestAccumulator).
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ant clean test -Dtestcase=TestAccumulator
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Run TestHExecutionEngine &lt;b&gt;without ant clean&lt;/b&gt;.
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ant test -Dtestcase=TestHExecutionEngine
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This will fail with the following errors in logs:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.net.ConnectException: Call to localhost.localdomain/127.0.0.1:59119 failed on connection exception: java.net.ConnectException: Connection refused
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In fact, the same issue was discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2769?focusedCommentId=13541974&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13541974&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;PIG-2769&lt;/a&gt; before. What I don&apos;t fully understand is why this happens even though you&apos;re doing &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2769?focusedCommentId=13547105&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13547105&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;what Rohini suggests&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;For the time being, I will back out the patch to stabilize the build. As soon as you update the patch, I will test it again. Does this make sense?&lt;/p&gt;</comment>
                            <comment id="13575580" author="prkommireddi" created="Mon, 11 Feb 2013 00:07:42 +0000"  >&lt;p&gt;Sure, I will take a look.&lt;/p&gt;</comment>
                            <comment id="13581825" author="prkommireddi" created="Wed, 20 Feb 2013 01:05:06 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;, I think the issue is with the fact that MiniCluster.buildCluster() generates a hadoop-site.xml file under build/classes. However, MiniCluster.shutDown() does not delete this file. Ideally, hadoop-site.xml should be deleted on cluster shutdown. &lt;/p&gt;

&lt;p&gt;With respect to TestHExecutionEngine, the issue is with the fact a previous test run that uses mini-cluster generates hadoop-site.xml and does not delete it. At the time TestHExecutionEngine runs this file is present on the classpath but mini-dfs and mini-mr were shutdown at the completion of previous test. pigContext.connect() in TestHExecutionEngine tries to establish a connection with mini-cluster which is no longer up.&lt;/p&gt;

&lt;p&gt;The fix would be to:&lt;/p&gt;

&lt;p&gt;1. Delete hadoop-site-xml on mini-cluster shutdown (to be done in another JIRA)&lt;br/&gt;
2. Check if this patch stabilizes (and nothing else breaks)&lt;/p&gt;

&lt;p&gt;Does that make sense?&lt;/p&gt;</comment>
                            <comment id="13582366" author="cheolsoo" created="Wed, 20 Feb 2013 17:48:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prkommireddi&quot; class=&quot;user-hover&quot; rel=&quot;prkommireddi&quot;&gt;Prashant Kommireddi&lt;/a&gt;, I totally agree with you. Can we fix &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3200&quot; title=&quot;MiniCluster should delete hadoop-site.xml on shutDown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3200&quot;&gt;&lt;del&gt;PIG-3200&lt;/del&gt;&lt;/a&gt; first then?&lt;/p&gt;</comment>
                            <comment id="13585273" author="cheolsoo" created="Sun, 24 Feb 2013 03:38:23 +0000"  >&lt;p&gt;+1 again.&lt;/p&gt;

&lt;p&gt;Verified that &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3200&quot; title=&quot;MiniCluster should delete hadoop-site.xml on shutDown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3200&quot;&gt;&lt;del&gt;PIG-3200&lt;/del&gt;&lt;/a&gt; fixes the test failure, and committed the patch to trunk again.&lt;/p&gt;

&lt;p&gt;Thanks Prashant!&lt;/p&gt;</comment>
                            <comment id="13585479" author="prkommireddi" created="Sun, 24 Feb 2013 20:18:01 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;Cheolsoo Park&lt;/a&gt;, I don&apos;t see the new tests &quot;test/org/apache/pig/test/TestHExecutionEngine.java&quot; making it in with this commit. Can you please take a look when you get a chance?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ svn diff --summarize -c r1449436
M       conf/pig.properties
M       CHANGES.txt
M       src/org/apache/pig/backend/hadoop/executionengine/HExecutionEngine.java
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13585501" author="cheolsoo" created="Sun, 24 Feb 2013 21:40:47 +0000"  >&lt;p&gt;My bad. I forgot to add it. It is committed now:&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1449553&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1449553&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13585503" author="prkommireddi" created="Sun, 24 Feb 2013 21:47:58 +0000"  >&lt;p&gt;Thanks Cheolsoo.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12566436" name="PIG-3135.patch" size="4725" author="prkommireddi" created="Fri, 25 Jan 2013 02:04:33 +0000"/>
                            <attachment id="12567801" name="PIG-3135_1.patch" size="5891" author="prkommireddi" created="Mon, 4 Feb 2013 05:33:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 30 Jan 2013 20:00:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>308313</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz4yrz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>272974</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>