<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:54:28 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1483/PIG-1483.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1483] [piggybank] Add HadoopJobHistoryLoader to the piggybank</title>
                <link>https://issues.apache.org/jira/browse/PIG-1483</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1333&quot; title=&quot;API interface to Pig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1333&quot;&gt;&lt;del&gt;PIG-1333&lt;/del&gt;&lt;/a&gt; added many script-related entries to the MR job xml file and thus it&apos;s now possible to use Pig for querying Hadoop job history/xml files to get script-level usage statistics. What we need is a Pig loader that can parse these files and generate corresponding data objects.&lt;/p&gt;

&lt;p&gt;The goal of this jira is to create a HadoopJobHistoryLoader in piggybank.&lt;/p&gt;

&lt;p&gt;Here is an example that shows the intended usage:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Find all the jobs grouped by script and user:&lt;/b&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a = load &apos;/mapred/history/_logs/history/&apos; using HadoopJobHistoryLoader() as (j:map[], m:map[], r:map[]);
b = foreach a generate (Chararray) j#&apos;PIG_SCRIPT_ID&apos; as id, (Chararray) j#&apos;USER&apos; as user, (Chararray) j#&apos;JOBID&apos; as job; 
c = filter b by not (id is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
d = group c by (id, user);
e = foreach d generate flatten(group), c.job;
dump e;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A couple more examples:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Find scripts that use only the default parallelism:&lt;/b&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a = load &apos;/mapred/history/done&apos; using HadoopJobHistoryLoader() as (j:map[], m:map[], r:map[]);
b = foreach a generate j#&apos;PIG_SCRIPT_ID&apos; as id, j#&apos;USER&apos; as user, j#&apos;JOBNAME&apos; as script_name, (&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;) r#&apos;NUMBER_REDUCES&apos; as reduces;
c = group b by (id, user, script_name) parallel 10;
d = foreach c generate group.user, group.script_name, MAX(b.reduces) as max_reduces;
e = filter d by max_reduces == 1;
dump e;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;Find the running time of each script (in seconds):&lt;/b&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a = load &apos;/mapred/history/done&apos; using HadoopJobHistoryLoader() as (j:map[], m:map[], r:map[]);
b = foreach a generate j#&apos;PIG_SCRIPT_ID&apos; as id, j#&apos;USER&apos; as user, j#&apos;JOBNAME&apos; as script_name, (&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;) j#&apos;SUBMIT_TIME&apos; as start, (&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;) j#&apos;FINISH_TIME&apos; as end;
c = group b by (id, user, script_name)
d = foreach c generate group.user, group.script_name, (MAX(b.end) - MIN(b.start)/1000;
dump d;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12468743">PIG-1483</key>
            <summary>[piggybank] Add HadoopJobHistoryLoader to the piggybank</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rding">Richard Ding</assignee>
                                    <reporter username="rding">Richard Ding</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Jul 2010 19:14:13 +0100</created>
                <updated>Wed, 29 Aug 2012 00:11:09 +0100</updated>
                            <resolved>Fri, 27 Aug 2010 19:34:25 +0100</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12886483" author="rding" created="Thu, 8 Jul 2010 22:22:46 +0100"  >&lt;p&gt;This is the initial patch with a few caveats:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Each mapper processes only one job history file. This loader will create as many map tasks as the number of files to process.&lt;/li&gt;
	&lt;li&gt;It uses &lt;em&gt;org.apache.hadoop.mapred.DefaultJobHistoryParser&lt;/em&gt; to parse the job history files. This parser isn&apos;t production ready.&lt;/li&gt;
&lt;/ol&gt;

</comment>
                            <comment id="12886502" author="rding" created="Thu, 8 Jul 2010 22:36:03 +0100"  >
&lt;p&gt;Usage:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
register piggybank.jar
A = load &apos;&amp;lt;directory or file&amp;gt;&apos; org.apache.pig.piggybank.storage.HadoopJobHistoryLoader() as (j:map[], m:map[], r:map[]);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where j is a map with following entries:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

JOBID, JOBNAME, CLUSTER, QUEUE_NAME, STATUS, PIG_VERSION, HADOOP_VERSION, USER, USER_GROUP, HOST_DIR,
JOBCONF, PIG_SCRIPT_ID, PIG_SCRIPT,

TOTAL_LAUNCHED_MAPS, TOTAL_MAPS, FINISHED_MAPS, FAILED_MAPS, RACK_LOCAL_MAPS, DATA_LOCAL_MAPS,

TOTAL_LAUNCHED_REDUCES, TOTAL_REDUCES, FINISHED_REDUCES, FAILED_REDUCES,

SUBMIT_TIME, LAUNCH_TIME, FINISH_TIME,

MAP_INPUT_RECORDS, MAP_OUTPUT_RECORDS, MAP_OUTPUT_BYTES,
COMBINE_INPUT_RECORDS, COMBINE_OUTPUT_RECORDS, SPILLED_RECORDS,
REDUCE_SHUFFLE_BYTES, REDUCE_INPUT_GROUPS, REDUCE_INPUT_RECORDS, REDUCE_OUTPUT_RECORDS,

HDFS_BYTES_READ, HDFS_BYTES_WRITTEN, FILE_BYTES_READ, FILE_BYTES_WRITTEN,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;m is a map with following entries:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
MAX_MAP_INPUT_ROWS, MIN_MAP_INPUT_ROWS, MAX_MAP_TIME, MIN_MAP_TIME, AVG_MAP_TIME, NUMBER_MAPS
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;r is a map with following entries:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
AVG_REDUCE_TIME, MAX_REDUCE_TIME, NUMBER_REDUCES, MIN_REDUCE_TIME, MIN_REDUCE_INPUT_ROWS, MAX_REDUCE_INPUT_ROWS
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12886537" author="rding" created="Thu, 8 Jul 2010 23:45:56 +0100"  >
&lt;p&gt;Add these additional entries to the first map:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
PIG_JOB_FEATURE, PIG_JOB_ALIAS, PIG_JOB_PARENTS
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12902140" author="rding" created="Wed, 25 Aug 2010 00:12:29 +0100"  >&lt;p&gt;New patch adding unit test.&lt;/p&gt;</comment>
                            <comment id="12903491" author="olgan" created="Fri, 27 Aug 2010 18:46:16 +0100"  >&lt;p&gt;+1, please, commit&lt;/p&gt;</comment>
                            <comment id="12904453" author="rding" created="Tue, 31 Aug 2010 01:39:37 +0100"  >&lt;p&gt;Patch committed to trunk.&lt;/p&gt;</comment>
                            <comment id="13438112" author="aniket486" created="Mon, 20 Aug 2012 20:22:42 +0100"  >&lt;p&gt;Broken by &lt;a href=&quot;https://issues.apache.org/jira/browse/MAPREDUCE-323&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/MAPREDUCE-323&lt;/a&gt; ? Should we reopen this jira?&lt;/p&gt;</comment>
                            <comment id="13443639" author="aniket486" created="Wed, 29 Aug 2012 00:11:09 +0100"  >&lt;p&gt;Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2894&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/PIG-2894&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12449027" name="PIG-1483.patch" size="25470" author="rding" created="Thu, 8 Jul 2010 23:43:48 +0100"/>
                            <attachment id="12452984" name="PIG-1483_1.patch" size="40973" author="rding" created="Wed, 25 Aug 2010 00:12:29 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 27 Aug 2010 17:46:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164969</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyaqxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96675</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>