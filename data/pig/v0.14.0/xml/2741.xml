<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:03:26 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-2741/PIG-2741.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-2741] Python script throws an NameError: name &apos;Configuration&apos; is not defined in case cache dir is not created</title>
                <link>https://issues.apache.org/jira/browse/PIG-2741</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;I have a Python script which writes out data to HDFS&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
from org.apache.hadoop.conf &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; *
from org.apache.hadoop.fs &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; *

config = Configuration()
hdfs = FileSystem.get(config)
out = hdfs.create(Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;/user/viraj/junk.txt&quot;&lt;/span&gt;))
out.write(&lt;span class=&quot;code-quote&quot;&gt;&quot;Hello World!&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When I run this I get the following error:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;2012-06-06 01:20:43,101 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  org.apache.pig.Main - Logging error messages to: /home/viraj/pig_1338945643097.log&lt;br/&gt;
2012-06-06 01:20:43,502 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  org.apache.pig.Main - Run embedded script: jython&lt;br/&gt;
2012-06-06 01:20:43,603 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  org.apache.pig.backend.hadoop.executionengine.HExecutionEngine - Connecting to hadoop file system at: hdfs://namenode:8020&lt;br/&gt;
2012-06-06 01:20:44,069 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  org.apache.pig.backend.hadoop.executionengine.HExecutionEngine - Connecting to map-reduce job tracker at: jobtracker:50300&lt;br/&gt;
&lt;b&gt;sys-package-mgr&lt;/b&gt;: can&apos;t create package cache dir, &apos;/mydir/xx&apos;&lt;br/&gt;
2012-06-06 01:20:45,815 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  org.apache.pig.scripting.jython.JythonScriptEngine - created tmp python.cachedir=/tmp/pig_jython_7126458276821733512&lt;br/&gt;
2012-06-06 01:20:45,904 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; ERROR org.apache.pig.Main - ERROR 1121: Python Error. Traceback (most recent call last):&lt;br/&gt;
  File &quot;/homes/viraj/test.py&quot;, line 4, in &amp;lt;module&amp;gt;&lt;br/&gt;
    config = Configuration()&lt;br/&gt;
NameError: name &apos;Configuration&apos; is not defined&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;I tried to solve it in various ways:&lt;/p&gt;

&lt;p&gt;1) Override pig.properties to specify python.cachedir.skip=false but it does not seem to work&lt;/p&gt;

&lt;p&gt;2) The only workaround is to: specify: -Dpython.cachedir=/mydirectory/tmp on the command line&lt;/p&gt;

&lt;p&gt;Viraj&lt;/p&gt;</description>
                <environment>&lt;p&gt;Pig 0.10&lt;/p&gt;</environment>
        <key id="12559474">PIG-2741</key>
            <summary>Python script throws an NameError: name &apos;Configuration&apos; is not defined in case cache dir is not created</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knoguchi">Koji Noguchi</assignee>
                                    <reporter username="viraj">Viraj Bhat</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Jun 2012 02:28:01 +0100</created>
                <updated>Sun, 6 Jan 2013 23:57:02 +0000</updated>
                            <resolved>Fri, 8 Jun 2012 08:07:30 +0100</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.11</fixVersion>
                    <fixVersion>0.10.1</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13289959" author="daijy" created="Wed, 6 Jun 2012 06:17:27 +0100"  >&lt;p&gt;The problem is: user don&apos;t have privilege in default python.cachedir, the workaround is to give a python.cachedir with privilege. &lt;/p&gt;</comment>
                            <comment id="13290347" author="knoguchi" created="Wed, 6 Jun 2012 20:31:11 +0100"  >&lt;p&gt;Note that &quot;can&apos;t create&quot; error is coming before JythonScriptEngine is creating the python.cachedir dir.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;sys-package-mgr: can&apos;t create package cache dir, &apos;/mydir/xx&apos;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2012-06-06 01:20:45,815 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO org.apache.pig.scripting.jython.JythonScriptEngine - created tmp python.cachedir=/tmp/pig_jython_7126458276821733512&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This seems to be a regression from &lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2548&quot; title=&quot;Support for providing parameters to python script&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2548&quot;&gt;&lt;del&gt;PIG-2548&lt;/del&gt;&lt;/a&gt;: Support for providing parameters to python script&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;src/org/apache/pig/scripting/jython/JythonScriptEngine.java&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;359                 PythonInterpreter.initialize(null, null, argv);&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;such that this initialization is called before python.cachedir is being updated by the JythonScriptEngine leading to this error.&lt;/p&gt;</comment>
                            <comment id="13290440" author="knoguchi" created="Wed, 6 Jun 2012 22:33:58 +0100"  >&lt;p&gt;Took out the PythonInterpreter.initialize and delayed the argument setting to later.  Would this work?&lt;/p&gt;</comment>
                            <comment id="13290612" author="daijy" created="Thu, 7 Jun 2012 01:16:12 +0100"  >&lt;p&gt;Patch looks good for me. But the weird thing is the script fail with the same error message if I apply the patch &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2665&quot; title=&quot;Bundled Jython jar in Pig 0.10.0-RC breaks module import in Python scripts with embedded Pig Latin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2665&quot;&gt;&lt;del&gt;PIG-2665&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;To make sure later patch does not break this script, please add a test case. I will take a look of &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2665&quot; title=&quot;Bundled Jython jar in Pig 0.10.0-RC breaks module import in Python scripts with embedded Pig Latin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2665&quot;&gt;&lt;del&gt;PIG-2665&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13290653" author="rohini" created="Thu, 7 Jun 2012 02:05:06 +0100"  >&lt;p&gt;&amp;gt;The problem is: user don&apos;t have privilege in default python.cachedir, the workaround is to give a &amp;gt; python.cachedir with privilege.&lt;/p&gt;

&lt;p&gt;PythonInterpreter.initialize calls PMPySystemState.initCacheDirectory which does cachedir = new File(props.getProperty(PYTHON_CACHEDIR, CACHEDIR_DEFAULT_NAME));  This tries to create the cachedir in the same directory as the pig installation because PYTHON_CACHEDIR is not set by then. For it to work, we need a cachedir directory in the same directory as the pig.jar with 777 permissions which is not desirable. &lt;/p&gt;</comment>
                            <comment id="13290659" author="rohini" created="Thu, 7 Jun 2012 02:08:57 +0100"  >&lt;p&gt;Also, because the default cache directory is always pig_lib_dir/cachedir/packages, it might cause issues if multiple users are running the scripts. Koji&apos;s fix will get us back to the old code path in JythonScriptEngine, which generated and set a random directory for python cache directory.&lt;/p&gt;</comment>
                            <comment id="13290798" author="knoguchi" created="Thu, 7 Jun 2012 06:13:30 +0100"  >&lt;blockquote&gt;&lt;p&gt;But the weird thing is the script fail with the same error message if I apply the patch &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2665&quot; title=&quot;Bundled Jython jar in Pig 0.10.0-RC breaks module import in Python scripts with embedded Pig Latin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2665&quot;&gt;&lt;del&gt;PIG-2665&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This jira was failing because python.cachedir was set to incorrect path when initialized.&lt;br/&gt;
For &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2665&quot; title=&quot;Bundled Jython jar in Pig 0.10.0-RC breaks module import in Python scripts with embedded Pig Latin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2665&quot;&gt;&lt;del&gt;PIG-2665&lt;/del&gt;&lt;/a&gt; with jython-standalone-2.5.2.jar, it seems to be failing due to &apos;python.cachedir.skip&apos; somehow set to true as default.&lt;br/&gt;
Error message is same but the cause is different.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;To make sure later patch does not break this script, please add a test case. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Adding testcase for &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2665&quot; title=&quot;Bundled Jython jar in Pig 0.10.0-RC breaks module import in Python scripts with embedded Pig Latin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2665&quot;&gt;&lt;del&gt;PIG-2665&lt;/del&gt;&lt;/a&gt; failing is probably easy.  As for this jira, I don&apos;t know of a good way.  Owner of jython-2.5.0.jar (dir) and the user of the test needs to be different for this issue to happen. When I manually tested, I just mkdir ./build/ivy/lib/Pig/cachedir ; followed by chmod 000 ./build/ivy/lib/Pig/cachedir. &lt;/p&gt;</comment>
                            <comment id="13290844" author="knoguchi" created="Thu, 7 Jun 2012 07:48:19 +0100"  >&lt;blockquote&gt;&lt;p&gt;Adding testcase for &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2665&quot; title=&quot;Bundled Jython jar in Pig 0.10.0-RC breaks module import in Python scripts with embedded Pig Latin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2665&quot;&gt;&lt;del&gt;PIG-2665&lt;/del&gt;&lt;/a&gt; failing is probably easy. As for this jira, &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Added a testcase that would fail when tried with pig-2665 patch. &lt;/p&gt;

&lt;p&gt;For testing this jira itself, I manually tested it by &lt;/p&gt;

&lt;p&gt;$ chmod 000 ./build/ivy/lib/Pig/cachedir&lt;/p&gt;

&lt;p&gt;and confirmed it fails with &quot;NameError: name &apos;Configuration&apos; is not defined&quot;&lt;br/&gt;
and succeeds after the patch&lt;/p&gt;

</comment>
                            <comment id="13290850" author="knoguchi" created="Thu, 7 Jun 2012 08:00:15 +0100"  >&lt;p&gt;Daniel asked me to add a brief comment on what the test is doing.  Updated.&lt;/p&gt;

&lt;p&gt;Also, forgot to mention that during the testing, I found out that PIG_CMD_ARGS_REMAINDERS could be null when called from the unit test.  Added extra checking with warning to avoid the NPE.&lt;/p&gt;</comment>
                            <comment id="13290891" author="daijy" created="Thu, 7 Jun 2012 09:56:31 +0100"  >&lt;p&gt;The test case only applicable to pig trunk. If we plan to commit to 0.10 branch, need make a test case for both 0.10 and trunk.&lt;/p&gt;</comment>
                            <comment id="13290896" author="daijy" created="Thu, 7 Jun 2012 10:11:32 +0100"  >&lt;p&gt;Add a different test case which applicable to &lt;/p&gt;</comment>
                            <comment id="13290897" author="daijy" created="Thu, 7 Jun 2012 10:11:53 +0100"  >&lt;p&gt;both 0.10 and trunk.&lt;/p&gt;</comment>
                            <comment id="13291486" author="rohini" created="Fri, 8 Jun 2012 02:26:42 +0100"  >&lt;p&gt;Daniel,&lt;br/&gt;
   You seem to have put a hardcoded path in the test by mistake.&lt;br/&gt;
 +sys.path.append(&quot;/Users/daijy/hadoop-1.0.0/hadoop-core-1.0.0.jar&quot;)&lt;/p&gt;</comment>
                            <comment id="13291491" author="daijy" created="Fri, 8 Jun 2012 02:40:53 +0100"  >&lt;p&gt;That&apos;s an accident. Reattach the patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="13291531" author="knoguchi" created="Fri, 8 Jun 2012 04:27:01 +0100"  >&lt;p&gt;Thanks Daniel for adding e2e testcase. &lt;br/&gt;
Added 1 line to the testase so that it would now fail without this patch.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;#jython uses &apos;python.home&apos;/cachedir when python.cachedir is not specified.
#To test python.cachedir is set correctly by the framework,
#setting python.home to a random path
                        &apos;java_params&apos; =&amp;gt; [&apos;-Dpython.home=/dev/null/fake&apos;],
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Confirmed that this test case&lt;br/&gt;
i) Fails without the patch (due to using /dev/null/fake as the cache dir)&lt;br/&gt;
ii) Succeeds with the patch (by using cache dir set by the framework.)&lt;br/&gt;
iii) Fails with &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2665&quot; title=&quot;Bundled Jython jar in Pig 0.10.0-RC breaks module import in Python scripts with embedded Pig Latin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2665&quot;&gt;&lt;del&gt;PIG-2665&lt;/del&gt;&lt;/a&gt; current patch due to &apos;python.cachedir.skip set to true in a standalone mode.&lt;/p&gt;</comment>
                            <comment id="13291534" author="knoguchi" created="Fri, 8 Jun 2012 04:41:24 +0100"  >&lt;p&gt;Hopefully this is the last one. Took out the &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;+sys.path.append(&quot;/Users/daijy/hadoop-1.0.0/hadoop-core-1.0.0.jar&quot;)&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="13291588" author="daijy" created="Fri, 8 Jun 2012 08:07:30 +0100"  >&lt;p&gt;Patch committed to both 0.10 branch and trunk. Thanks Koji!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12531159" name="pig-2741-no-test-yet-v1.patch.txt" size="2114" author="knoguchi" created="Wed, 6 Jun 2012 22:33:58 +0100"/>
                            <attachment id="12531230" name="pig-2741-testfailing-pig2665-v2.patch.txt" size="2975" author="knoguchi" created="Thu, 7 Jun 2012 07:48:19 +0100"/>
                            <attachment id="12531233" name="pig-2741-testfailing-pig2665-v3.patch.txt" size="3053" author="knoguchi" created="Thu, 7 Jun 2012 08:00:15 +0100"/>
                            <attachment id="12531244" name="pig-2741-testfailing-pig2665-v4.patch.txt" size="3151" author="daijy" created="Thu, 7 Jun 2012 10:11:31 +0100"/>
                            <attachment id="12531363" name="pig-2741-testfailing-pig2665-v5.patch.txt" size="3481" author="knoguchi" created="Fri, 8 Jun 2012 04:27:01 +0100"/>
                            <attachment id="12531357" name="pig-2741-testfailing-pig2665-v5.patch.txt" size="3129" author="daijy" created="Fri, 8 Jun 2012 02:40:53 +0100"/>
                            <attachment id="12531365" name="pig-2741-testfailing-pig2665-v6.patch.txt" size="3411" author="knoguchi" created="Fri, 8 Jun 2012 04:41:24 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 6 Jun 2012 05:17:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242349</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxwoi7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14457</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>