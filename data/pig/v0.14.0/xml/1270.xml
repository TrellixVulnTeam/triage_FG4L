<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:00:16 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1270/PIG-1270.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1270] Push limit into loader</title>
                <link>https://issues.apache.org/jira/browse/PIG-1270</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;We can optimize limit operation by stopping early in PigRecordReader. In general, we need a way to communicate between PigRecordReader and execution pipeline. POLimit could instruct PigRecordReader that we have already had enough records and stop feeding more data.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12457898">PIG-1270</key>
            <summary>Push limit into loader</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="daijy">Daniel Dai</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Mar 2010 18:55:46 +0000</created>
                <updated>Thu, 26 Apr 2012 21:33:02 +0100</updated>
                            <resolved>Fri, 23 Mar 2012 01:03:10 +0000</resolved>
                                    <version>0.7.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13095118" author="daijy" created="Thu, 1 Sep 2011 05:48:30 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1270&quot; title=&quot;Push limit into loader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1270&quot;&gt;&lt;del&gt;PIG-1270&lt;/del&gt;&lt;/a&gt;-2.patch fix all unit tests. However, I didn&apos;t see noticeable performance improvement. The script I test is:&lt;/p&gt;

&lt;p&gt;a = load &apos;studenttab20m&apos; as (name, age, gpa);&lt;br/&gt;
b = limit a 10;&lt;br/&gt;
dump b;&lt;/p&gt;

&lt;p&gt;Both in local mode and mapreduce mode. &lt;/p&gt;

&lt;p&gt;Need further investigation to find out why performance not improve.&lt;/p&gt;</comment>
                            <comment id="13156580" author="coderplay" created="Thu, 24 Nov 2011 07:34:49 +0000"  >&lt;p&gt;@Daniel&lt;/p&gt;

&lt;p&gt;It improves here, but with a bug. I did the test in a 25-nodes cluster which such script&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;A = load &apos;/tpch/orders&apos; USING PigStorage(&apos;\u0001&apos;) AS (o_orderkey:int, o_custkey:int, o_orderstatus:chararray, o_totalprice:double, o_orderdate:chararray, o_orderpriority:chararray, o_clerk:chararray, o_shippriority:int, o_comment: chararray);
F = FOREACH A GENERATE o_orderkey;
L = LIMIT F 10;
DUMP L; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;case&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;job cost time&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;HDFS bytes read&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Average time taken by Map tasks&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Worst performing map task&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;w/o optimization&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 26 sec&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;12,976,128&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1 sec &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1 sec&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;with optimization&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 24 sec&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;19,347,931,305&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3 sec &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 5 sec&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;Since with your patch, the LimitOptimizer would remove LOLimit from logic plans after set the limit to LOLoad, this would generate a map-only job. Record number of the result would be map_num * 10, this is incorrect. &lt;/p&gt;

&lt;p&gt;I will submit a patch soon.&lt;/p&gt;



</comment>
                            <comment id="13156586" author="coderplay" created="Thu, 24 Nov 2011 08:03:14 +0000"  >&lt;p&gt;Here is the patch which would fix the bug.&lt;/p&gt;</comment>
                            <comment id="13156591" author="coderplay" created="Thu, 24 Nov 2011 08:14:25 +0000"  >&lt;p&gt;sorry, some mistakes &lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;case&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;job cost time&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;HDFS bytes read&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Average time taken by Map tasks&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Worst performing map task&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;w/o optimization&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;26 sec&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;19,347,931,305&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3 sec&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5 sec&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;w/ optimization&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;24 sec&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;12,976,128&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1 sec&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1 sec&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
</comment>
                            <comment id="13158136" author="daijy" created="Mon, 28 Nov 2011 01:49:43 +0000"  >&lt;p&gt;Thanks Min, that&apos;s encouraging. Which version of Hadoop are you using?&lt;/p&gt;

&lt;p&gt;Also I discussed with Min in IM, it will be better to have a global flag to signal the sufficiency of records, so that we can address more cases for this optimization. &lt;/p&gt;</comment>
                            <comment id="13159819" author="coderplay" created="Wed, 30 Nov 2011 04:46:20 +0000"  >&lt;p&gt;We are using a modified version of 0.19.1. However, that internal version provide new MR API and is compatible with both hadoop clients under the versions of 0.19.x and 0.20.2. Our version doesn&apos;t change any logic of map phase from the community version, so this patch should improves the latter as well.&lt;/p&gt;


&lt;p&gt;That&apos;s a good attempt if we can address more cases like limit optimization on LOFilter.&lt;/p&gt;</comment>
                            <comment id="13205194" author="viraj" created="Fri, 10 Feb 2012 03:33:00 +0000"  >&lt;p&gt;What version is this likely going to be fixed?&lt;/p&gt;

&lt;p&gt;Daniel in your original comment the script mentioned is similar to a &quot;SELECT * .. LIMIT 10&quot; Hive currently does not run a M/R job for these situations, it just reads the data and streams it to stdout. Can we do such an optimization for the query mentioned?&lt;/p&gt;

&lt;p&gt;Additionally can we use some optimizations that Hadoop 23 has such as running in an Uberized task rather than launch M/R jobs? &lt;/p&gt;

&lt;p&gt;Viraj&lt;/p&gt;</comment>
                            <comment id="13205199" author="dvryaboy" created="Fri, 10 Feb 2012 03:45:19 +0000"  >&lt;p&gt;Uberized will kick in automatically in 0.23, no need to do anything on the Pig side afaik.&lt;/p&gt;</comment>
                            <comment id="13206748" author="daijy" created="Mon, 13 Feb 2012 08:23:17 +0000"  >&lt;p&gt;@Viraj&lt;br/&gt;
For the patch itself, I would like to commit it into trunk soon. For the direct hdfs access you mention, it will probably be part of the backend rework we planned, but I am not sure at the moment.&lt;/p&gt;</comment>
                            <comment id="13213202" author="viraj" created="Wed, 22 Feb 2012 02:29:13 +0000"  >&lt;p&gt;Hi Daniel,&lt;br/&gt;
 Can we target this patch for Pig 0.10.1?&lt;br/&gt;
Viraj&lt;/p&gt;</comment>
                            <comment id="13229772" author="daijy" created="Wed, 14 Mar 2012 23:53:44 +0000"  >&lt;p&gt;Unit test pass. Plan to check it into 0.10, objection?&lt;/p&gt;</comment>
                            <comment id="13231627" author="thejas" created="Fri, 16 Mar 2012 21:01:22 +0000"  >&lt;p&gt;+1. Can you make a minor change before checkin ? - Make the limit variable in PigRecordReader a final.&lt;/p&gt;</comment>
                            <comment id="13233116" author="thejas" created="Tue, 20 Mar 2012 01:53:38 +0000"  >&lt;p&gt;These are the results I got from running tests to check the performance on larger data.&lt;/p&gt;

&lt;p&gt;Query - &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
grunt&amp;gt; l = load &apos;/tmp/bigfile2&apos; as (a,b,c);
grunt&amp;gt; lim = limit l 10;
grunt&amp;gt; dump lim;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ran on a cluster with 8 map slots. &lt;/p&gt;

&lt;p&gt;With 128MB block size , 499 Maps -&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; trunk &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; trunk+patch &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;avg Run time &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 17 min 7 sec&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 6 min 44 sec &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;avg run time of map &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 12 sec &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 4 sec&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;



&lt;p&gt;With smaller number of splits the numbers are better - &lt;br/&gt;
With &apos;set pig.maxCombinedSplitSize 1073741824&apos; (ie split size of 1G) and 64 Maps -&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; trunk &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; trunk+patch &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;avg Run time &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 15 min 19 sec&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1 min 10 sec &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;avg run time of map &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 106 sec &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 4 sec&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
</comment>
                            <comment id="13236234" author="daijy" created="Fri, 23 Mar 2012 01:00:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1270&quot; title=&quot;Push limit into loader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1270&quot;&gt;&lt;del&gt;PIG-1270&lt;/del&gt;&lt;/a&gt;-4.patch resync with trunk and address Thejas&apos;s comment.&lt;/p&gt;</comment>
                            <comment id="13236238" author="daijy" created="Fri, 23 Mar 2012 01:03:10 +0000"  >&lt;p&gt;Patch committed to 0.10/trunk. Thanks Thejas and Min for testing!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12492146" name="PIG-1270-1.patch" size="12596" author="daijy" created="Mon, 29 Aug 2011 22:43:48 +0100"/>
                            <attachment id="12492577" name="PIG-1270-2.patch" size="12610" author="daijy" created="Thu, 1 Sep 2011 05:48:30 +0100"/>
                            <attachment id="12504993" name="PIG-1270-3.patch" size="10630" author="coderplay" created="Thu, 24 Nov 2011 08:03:14 +0000"/>
                            <attachment id="12519563" name="PIG-1270-4.patch" size="10610" author="daijy" created="Fri, 23 Mar 2012 01:00:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 24 Nov 2011 07:34:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35767</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy3t4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56042</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>