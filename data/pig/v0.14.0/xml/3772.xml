<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:47:55 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-3772/PIG-3772.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-3772] Syntax error when casting an inner schema of a bag and line break involved</title>
                <link>https://issues.apache.org/jira/browse/PIG-3772</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;The following script fails with syntax error&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
A = load &apos;data&apos; as (a:{(x:chararray, y:&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)}, b:chararray);
B = foreach A generate
    b,
    (bag{tuple(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;)}) a.x as ax:{(x:&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;)};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where the cast statement is on its own line.&lt;/p&gt;

&lt;p&gt;The script fails with the following exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
19-02-2014 17:30:22 PST bug_script ERROR - org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1000: Error during parsing.   Syntax error, unexpected symbol at or near &apos;bag&apos;
19-02-2014 17:30:22 PST bug_script ERROR - 	at org.apache.pig.PigServer$Graph.parseQuery(PigServer.java:1607)
19-02-2014 17:30:22 PST bug_script ERROR - 	at org.apache.pig.PigServer$Graph.registerQuery(PigServer.java:1546)
19-02-2014 17:30:22 PST bug_script ERROR - 	at org.apache.pig.PigServer.registerQuery(PigServer.java:516)
19-02-2014 17:30:22 PST bug_script ERROR - 	at org.apache.pig.tools.grunt.GruntParser.processPig(GruntParser.java:988)
19-02-2014 17:30:22 PST bug_script ERROR - 	at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:412)
19-02-2014 17:30:22 PST bug_script ERROR - 	at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:194)
19-02-2014 17:30:22 PST bug_script ERROR - 	at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:170)
19-02-2014 17:30:22 PST bug_script ERROR - 	at org.apache.pig.tools.grunt.Grunt.exec(Grunt.java:84)
19-02-2014 17:30:22 PST bug_script ERROR - 	at org.apache.pig.Main.run(Main.java:604)
19-02-2014 17:30:22 PST bug_script ERROR - 	at org.apache.pig.PigRunner.run(PigRunner.java:49)
19-02-2014 17:30:22 PST bug_script ERROR - 	at azkaban.jobtype.HadoopSecurePigWrapper.runPigJob(HadoopSecurePigWrapper.java:116)
19-02-2014 17:30:22 PST bug_script ERROR - 	at azkaban.jobtype.HadoopSecurePigWrapper$1.run(HadoopSecurePigWrapper.java:106)
19-02-2014 17:30:22 PST bug_script ERROR - 	at azkaban.jobtype.HadoopSecurePigWrapper$1.run(HadoopSecurePigWrapper.java:103)
19-02-2014 17:30:22 PST bug_script ERROR - 	at java.security.AccessController.doPrivileged(Native Method)
19-02-2014 17:30:22 PST bug_script ERROR - 	at javax.security.auth.Subject.doAs(Subject.java:396)
19-02-2014 17:30:22 PST bug_script ERROR - 	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1190)
19-02-2014 17:30:22 PST bug_script ERROR - 	at azkaban.jobtype.HadoopSecurePigWrapper.main(HadoopSecurePigWrapper.java:103)
19-02-2014 17:30:22 PST bug_script ERROR - Caused by: Failed to parse:   Syntax error, unexpected symbol at or near &apos;bag&apos;
19-02-2014 17:30:22 PST bug_script ERROR - 	at org.apache.pig.parser.QueryParserDriver.parse(QueryParserDriver.java:235)
19-02-2014 17:30:22 PST bug_script ERROR - 	at org.apache.pig.parser.QueryParserDriver.parse(QueryParserDriver.java:177)
19-02-2014 17:30:22 PST bug_script ERROR - 	at org.apache.pig.PigServer$Graph.parseQuery(PigServer.java:1599)
19-02-2014 17:30:22 PST bug_script ERROR - 	... 16 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The script succeeds if the foreach statement is written in one line:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
B = foreach A generate b, (bag{tuple(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;)}) a.x as ax:{(x:&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;)};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This problem happens only in batch mode.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12696140">PIG-3772</key>
            <summary>Syntax error when casting an inner schema of a bag and line break involved</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="ssvinarchukhorton">Sergey Svinarchuk</assignee>
                                    <reporter username="ahoyleo">Haishan Liu</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Feb 2014 01:58:52 +0000</created>
                <updated>Wed, 29 Apr 2015 00:10:49 +0100</updated>
                                            <version>0.11.1</version>
                                    <fixVersion>0.16.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13968267" author="ssvinarchukhorton" created="Mon, 14 Apr 2014 12:42:08 +0100"  >&lt;p&gt;I tested this your pig script on trunk and this issue not reproduce when batch mode on and off.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;A = load &apos;testdata&apos; as (a:{(x:chararray, y:float)}, b:chararray);
B = foreach A generate
      b,
      bag{tuple(long)}) a.x as ax:{(x:long)};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13968276" author="ssvinarchukhorton" created="Mon, 14 Apr 2014 12:52:16 +0100"  >&lt;p&gt;Issue not reproduce on trunk&lt;/p&gt;</comment>
                            <comment id="13968732" author="daijy" created="Mon, 14 Apr 2014 20:37:29 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ssvinarchuk&quot; class=&quot;user-hover&quot; rel=&quot;ssvinarchuk&quot;&gt;Sergey Svinarchuk&lt;/a&gt;, I can reproduce the issue on trunk. If you break the line as follows, it does not work:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
A = load &apos;data&apos; as (a:{(x:chararray, y:&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)}, b:chararray);
B = foreach A generate
    b,
    (bag{tuple(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;)}) a.x as ax:{(x:&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;)};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can you double check?&lt;/p&gt;</comment>
                            <comment id="13969449" author="ssvinarchukhorton" created="Tue, 15 Apr 2014 12:31:28 +0100"  >&lt;p&gt;I reproduced this issue. But I had next exception: &lt;br/&gt;
2014-04-15 13:16:19,047 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; ERROR org.apache.pig.tools.grunt.Grunt - ERROR 1200: &amp;lt;line 4, column 21&amp;gt;  mismatched input &apos;;&apos; expecting RIGHT_PAREN&lt;br/&gt;
And this issue reproduce in batch mode and interactive mode. &lt;br/&gt;
But it not reproduce if create test with this script. &lt;br/&gt;
This is problem in read and parse pig scripts. Because in GruntParser.processPig(String cmd) input string for second command will be &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;B = foreach A generate
    b,    
    (bag{tuple(long)}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13969524" author="ssvinarchukhorton" created="Tue, 15 Apr 2014 14:12:22 +0100"  >&lt;p&gt;I attached patch with fix this issue. Please review it.&lt;/p&gt;</comment>
                            <comment id="13969848" author="daijy" created="Tue, 15 Apr 2014 19:19:04 +0100"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ssvinarchukhorton&quot; class=&quot;user-hover&quot; rel=&quot;ssvinarchukhorton&quot;&gt;Sergey Svinarchuk&lt;/a&gt;, the patch works for me. There is another occurrence of the same pattern in &quot;&amp;lt;IN_BLOCK&amp;gt; MORE&quot;, shall we change it as well?&lt;/p&gt;</comment>
                            <comment id="13970585" author="ssvinarchukhorton" created="Wed, 16 Apr 2014 09:53:28 +0100"  >&lt;p&gt;Yes, I forgot added this changes to first patch.&lt;br/&gt;
I attached new patch.&lt;/p&gt;</comment>
                            <comment id="13971871" author="daijy" created="Wed, 16 Apr 2014 21:07:13 +0100"  >&lt;p&gt;Looks good, would you mind adding a testcase? TestGruntParser sounds like a good place to add.&lt;/p&gt;</comment>
                            <comment id="13972861" author="ssvinarchukhorton" created="Thu, 17 Apr 2014 13:04:12 +0100"  >&lt;p&gt;I added testcase for this issue. &lt;/p&gt;</comment>
                            <comment id="13975847" author="daijy" created="Mon, 21 Apr 2014 19:30:52 +0100"  >&lt;p&gt;Patch committed to trunk. Thanks Sergey!&lt;/p&gt;</comment>
                            <comment id="13998938" author="rohini" created="Thu, 15 May 2014 18:32:13 +0100"  >&lt;p&gt;This patch makes some of the existing scripts fail. For eg: &lt;br/&gt;
a = FOREACH a GENERATE&lt;br/&gt;
        *,&lt;br/&gt;
&amp;#8211;      0 AS f:int;&lt;br/&gt;
        ((f1 IS NOT NULL AND ((int)f2#&apos;k1&apos; == 0 OR (int)f2#&apos;k1&apos; == 1)) ? MyUDF(f2#&apos;k3&apos;, f1#&apos;k3&apos;, f1#&apos;k4&apos;) : 0) AS f:int;&lt;/p&gt;

&lt;p&gt;fails with &quot;Syntax error, unexpected symbol at or near &apos;&amp;lt;EOF&amp;gt;&apos;&quot;  for the line after the comment&lt;/p&gt;</comment>
                            <comment id="14005523" author="daijy" created="Thu, 22 May 2014 02:52:23 +0100"  >&lt;p&gt;Rollback the patch. Look forward to solve it in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2597&quot; title=&quot;Move grunt from javacc to ANTLR&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2597&quot;&gt;PIG-2597&lt;/a&gt; (Move grunt from javacc to ANTRL).&lt;/p&gt;</comment>
                            <comment id="14211381" author="knoguchi" created="Thu, 13 Nov 2014 22:24:18 +0000"  >&lt;p&gt;We had a user wasting hours of his time due to this bug.  &lt;/p&gt;

&lt;p&gt;I have no understanding of how the parsing works, but &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3772&quot; title=&quot;Syntax error when casting an inner schema of a bag and line break involved&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3772&quot;&gt;PIG-3772&lt;/a&gt;.patch and &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3772&quot; title=&quot;Syntax error when casting an inner schema of a bag and line break involved&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3772&quot;&gt;PIG-3772&lt;/a&gt;-3.patch has a typo in putting &quot;r&quot; instead of &quot;\r&quot;.   &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3772&quot; title=&quot;Syntax error when casting an inner schema of a bag and line break involved&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3772&quot;&gt;PIG-3772&lt;/a&gt;-2.patch does have the correct &quot;\r&quot;. &lt;/p&gt;

&lt;p&gt;Can this cause the error Rohini faced?  &lt;/p&gt;</comment>
                            <comment id="14211477" author="daijy" created="Thu, 13 Nov 2014 23:34:48 +0000"  >&lt;p&gt;I tried fixing the typo, still see the same exception.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12546718">PIG-2597</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12640404" name="PIG-3772-2.patch" size="1607" author="ssvinarchukhorton" created="Wed, 16 Apr 2014 09:53:08 +0100"/>
                            <attachment id="12640619" name="PIG-3772-3.patch" size="4069" author="ssvinarchukhorton" created="Thu, 17 Apr 2014 13:03:26 +0100"/>
                            <attachment id="12640262" name="PIG-3772.patch" size="978" author="ssvinarchukhorton" created="Tue, 15 Apr 2014 14:11:19 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 14 Apr 2014 11:42:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>374617</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzmer3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>374917</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>