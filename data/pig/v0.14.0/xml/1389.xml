<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:50:33 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-1389/PIG-1389.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-1389] Implement Pig counter to track number of rows for each input files </title>
                <link>https://issues.apache.org/jira/browse/PIG-1389</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;A MR job generated by Pig not only can have multiple outputs (in the case of multiquery) but also can have multiple inputs (in the case of join or cogroup). In both cases, the existing Hadoop counters (e.g. MAP_INPUT_RECORDS, REDUCE_OUTPUT_RECORDS) can not be used to count the number of records in the given input or output.  &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1299&quot; title=&quot;Implement Pig counter  to track number of output rows for each output files &quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1299&quot;&gt;&lt;del&gt;PIG-1299&lt;/del&gt;&lt;/a&gt; addressed the case of multiple outputs.  We need to add new counters for jobs with multiple inputs.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12462793">PIG-1389</key>
            <summary>Implement Pig counter to track number of rows for each input files </summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rding">Richard Ding</assignee>
                                    <reporter username="rding">Richard Ding</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Apr 2010 18:40:31 +0100</created>
                <updated>Fri, 17 Dec 2010 22:44:13 +0000</updated>
                            <resolved>Fri, 9 Jul 2010 23:47:39 +0100</resolved>
                                    <version>0.7.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12881975" author="rding" created="Thu, 24 Jun 2010 01:12:58 +0100"  >&lt;p&gt;This patch adds two counter groups:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;b&gt;MultiInputCounters&lt;/b&gt;: to count the records in each input of a multi-input job (such as join, cogroup, cross).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;b&gt;SideInputCounters&lt;/b&gt;: to count the records read from the side file in the cases of merge join, merge cogroup.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;These counters can be viewed from Hadoop job track UI. They are also available from APIs on PigStats/JobStats. &lt;/p&gt;

&lt;p&gt;There is no counter for side files of FR join.&lt;/p&gt;


</comment>
                            <comment id="12882077" author="hadoopqa" created="Thu, 24 Jun 2010 08:22:51 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12447912/PIG-1389.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12447912/PIG-1389.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 957399.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    -1 contrib tests.  The patch failed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/349/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/349/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/349/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/349/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/349/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/349/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12882377" author="rding" created="Thu, 24 Jun 2010 23:40:49 +0100"  >&lt;p&gt;Hudson core tests appear still unstable. I run core tests manually and they all passed. &lt;/p&gt;</comment>
                            <comment id="12882380" author="acmurthy" created="Thu, 24 Jun 2010 23:48:07 +0100"  >&lt;p&gt;Can we not just increment the standard MR counters rather than inventing new ones?&lt;/p&gt;</comment>
                            <comment id="12882381" author="acmurthy" created="Thu, 24 Jun 2010 23:49:05 +0100"  >&lt;p&gt;How many new counters are we really adding here? I only see the counter-groups. I&apos;m afraid this will be too many new counters...&lt;/p&gt;</comment>
                            <comment id="12882394" author="rding" created="Fri, 25 Jun 2010 00:21:34 +0100"  >&lt;p&gt;For a job with multiple inputs (i.e. join, cogroup, cross), we add one counter per user input. We don&apos;t add counter if input is from an intermediate file. The reason for doing this is MR input record counter is the sum of all inputs, and users want to know the number of records read from individual input.&lt;/p&gt;</comment>
                            <comment id="12883228" author="rding" created="Mon, 28 Jun 2010 18:43:19 +0100"  >&lt;p&gt;sync with the latest trunk.&lt;/p&gt;</comment>
                            <comment id="12883247" author="ashutoshc" created="Mon, 28 Jun 2010 20:08:26 +0100"  >&lt;p&gt;In cases of Merge Join and Merge Cogroup there is a possibility of double-counting and under-counting the records from the side loaders inherently due to design. So, in those cases reported numbers may confuse users.&lt;/p&gt;</comment>
                            <comment id="12883354" author="rding" created="Tue, 29 Jun 2010 00:42:16 +0100"  >&lt;p&gt;It seems there is no good solution for Merge Join and Merge Cogroup in this case. So I&apos;m going to treat them the same way as Replicated Join and not add counters for all side files.&lt;/p&gt;</comment>
                            <comment id="12883424" author="hadoopqa" created="Tue, 29 Jun 2010 07:20:58 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12448259/PIG-1389_1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12448259/PIG-1389_1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 958666.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    -1 contrib tests.  The patch failed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/335/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/335/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/335/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/335/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/335/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h8.grid.sp2.yahoo.net/335/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12884116" author="ashutoshc" created="Thu, 1 Jul 2010 02:17:33 +0100"  >&lt;p&gt;1.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    /**
+     * Returns the counter name &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the given input file name
+     * 
+     * @param fname the input file name
+     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; the counter name
+     */
+    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getMultiInputsCounterName(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fname) {
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; MULTI_INPUTS_RECORD_COUNTER +
+                &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(fname).getName();
+    }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Its dangerous to assume that input is a file name. It may not be. It can be a jdbc location string. In particular, new Path(fname) parses fname and throws exception if String is not the way it expects it to be. So, at various places in the patch, dont assume the path will refer to a file location and particularly avoid using Path() and deal in Strings.&lt;/p&gt;

&lt;p&gt;2. In PigRecordReader, initialization of Counters should be done in initialize() instead of getCurrentValue() that will avoid branching for every call of getCurrentValue.&lt;/p&gt;

&lt;p&gt;3. Marking of features in MRCompiler while compilation is still in progress may lead to incorrect results. We do bunch of optimizations &lt;b&gt;after&lt;/b&gt; MR plan is constructed. During which plan may get readjusted and whatever features were there in that particular MROper may get pushed around into different MR Oper. Better way to do this marking is post-construction of the MRPlan. Have a visitor which walks on the final MR Plan and marks the feature in those operator.&lt;/p&gt;

&lt;p&gt;4. As an extension of 1. I think having a test for non-file based input/output location would really be useful. &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1229&quot; title=&quot;allow pig to write output into a JDBC db&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1229&quot;&gt;&lt;del&gt;PIG-1229&lt;/del&gt;&lt;/a&gt; would have made that super-easy.&lt;/p&gt;</comment>
                            <comment id="12884834" author="rding" created="Fri, 2 Jul 2010 23:31:21 +0100"  >&lt;p&gt;We use Hadoop Path as a parser to parse the input/output locations for two use cases:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Determine the scheme of the location (e.g., hdfs, hbase, file, har, ...), and&lt;/li&gt;
	&lt;li&gt;Get the short file name of the location&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Ashutosh is right that this approach doesn&apos;t work with location string as in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1229&quot; title=&quot;allow pig to write output into a JDBC db&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1229&quot;&gt;&lt;del&gt;PIG-1229&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
jdbc:hsqldb:file:/tmp/batchtest;hsqldb.default_table_type=cached;hsqldb.cache_rows=100
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A RuntimeException is thrown when trying to parse it.&lt;/p&gt;

&lt;p&gt;The proposal is to use Java URI as parser instead for these use cases (Java URI throws a checked exception for invalid syntax). &lt;/p&gt;</comment>
                            <comment id="12885700" author="rding" created="Tue, 6 Jul 2010 22:41:23 +0100"  >&lt;p&gt;New patch to address above comments.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;2. In PigRecordReader, initialization of Counters should be done in initialize() instead of getCurrentValue() that will avoid branching for every call of getCurrentValue.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The problem here is that Map Reduce Framework calls RecordReader.initialize before calling Mapper.setup wherein Pig sets up the counter factory (PigStatusReporter). Therefore Counters cannot be initialized inside the RecordReader.initialize method.&lt;/p&gt;</comment>
                            <comment id="12885804" author="hadoopqa" created="Wed, 7 Jul 2010 04:25:15 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12448821/PIG-1389_2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12448821/PIG-1389_2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 960062.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    -1 contrib tests.  The patch failed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/360/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/360/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/360/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/360/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/360/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/360/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12886362" author="rding" created="Thu, 8 Jul 2010 17:22:37 +0100"  >&lt;p&gt;Locally ran and passed core unit tests.&lt;/p&gt;</comment>
                            <comment id="12886904" author="ashutoshc" created="Fri, 9 Jul 2010 22:44:08 +0100"  >&lt;p&gt;+1 &lt;/p&gt;

&lt;p&gt;Discussed about 3) with Richard offline. Though theoretically it will be better to find out the features on the fully compiled and optimized MR plan, it will be hard and may not be worth the complexity doing it. So, in this first pass it is fine to mark those features while MR plan&apos;s compilation is in progress. As a result in few corner cases, features marked for MR Oper may not be correct. We will fix up those cases as and when they come up.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12448228" name="PIG-1389.patch" size="49338" author="rding" created="Mon, 28 Jun 2010 18:43:19 +0100"/>
                            <attachment id="12447912" name="PIG-1389.patch" size="49423" author="rding" created="Thu, 24 Jun 2010 01:12:58 +0100"/>
                            <attachment id="12448259" name="PIG-1389_1.patch" size="35722" author="rding" created="Tue, 29 Jun 2010 01:28:00 +0100"/>
                            <attachment id="12448821" name="PIG-1389_2.patch" size="40258" author="rding" created="Tue, 6 Jul 2010 22:33:59 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 24 Jun 2010 07:22:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164881</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyapw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96506</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>