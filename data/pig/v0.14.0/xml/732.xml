<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 05:09:31 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/PIG-732/PIG-732.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[PIG-732] Utility UDFs </title>
                <link>https://issues.apache.org/jira/browse/PIG-732</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Two utility UDFs and their respective test cases.&lt;/p&gt;

&lt;p&gt;1. TopN - Accepts number of tuples (N) to retain in output, field number (type long) to use for comparison, and an sorted/unsorted bag of tuples. It outputs a bag containing top N tuples.&lt;/p&gt;

&lt;p&gt;2. SearchQuery - Accepts an encoded URL from any of the 4 search engines (Yahoo, Google, AOL, Live) and extracts and normalizes the search query present in it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12419378">PIG-732</key>
            <summary>Utility UDFs </summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ankur">Ankur</assignee>
                                    <reporter username="ankur">Ankur</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Mar 2009 09:48:57 +0000</created>
                <updated>Wed, 24 Mar 2010 22:10:57 +0000</updated>
                            <resolved>Thu, 30 Apr 2009 22:09:29 +0100</resolved>
                                                    <fixVersion>0.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12689050" author="ankur" created="Wed, 25 Mar 2009 09:49:59 +0000"  >&lt;p&gt;Since the UDFs are quite small, I combined them in a single patch instead of opening up a separate jira for each UDF. However if people believe having separate jira for each will help then I can split this up into 2.&lt;/p&gt;</comment>
                            <comment id="12689069" author="olgan" created="Wed, 25 Mar 2009 10:23:34 +0000"  >&lt;p&gt;Ankur,&lt;/p&gt;

&lt;p&gt;Thanks for contributing UDFs to PiggyBank!&lt;/p&gt;

&lt;p&gt;A couple of questions/comments on your patch:&lt;/p&gt;

&lt;p&gt;(1) Pig already supports limit operator. Would that serve your needs with TopN or you actually need to project bags of limitted size in foreach?&lt;br/&gt;
(2) Filtering UDFs are meant to be used as predicate in filter operators and as such should return Boolean values. I think your TopN should be in evaluation/util group&lt;br/&gt;
(3) Each file included needs to have Apache license header. You can just coppy it from one of the other files.&lt;/p&gt;

</comment>
                            <comment id="12689104" author="ankur" created="Wed, 25 Mar 2009 13:09:50 +0000"  >&lt;p&gt;Olga,&lt;br/&gt;
        Thanks for a quick review. &lt;br/&gt;
&amp;gt; (1) Pig already support limit operator ....&lt;br/&gt;
I have a relation where I need to group by field-1 and retain top-N occurrences of field-2. So I group by (field-1, field-2), generate counts and flattened tuple of the form (field-1, field2, &amp;lt;count&amp;gt;). Now I again group on field-1 and just retain top-N tuples. So I actually need to project bags of limited size. I don&apos;t think this can be done using LIMIT as it is not allowed inside FOREACH.&lt;/p&gt;

&lt;p&gt;&amp;gt; (2) Filtering UDFs are meant to be used as ....&lt;br/&gt;
Moved TopN and SearchQuery UDFs to  piggyBank/evaluation/util. Also moved the test cases to the appropriate location.&lt;/p&gt;

&lt;p&gt;&amp;gt; (3) Each file included needs to have Apache license header ....&lt;br/&gt;
Done.&lt;/p&gt;
</comment>
                            <comment id="12689153" author="olgan" created="Wed, 25 Mar 2009 16:37:31 +0000"  >&lt;p&gt;Ankur,&lt;/p&gt;

&lt;p&gt;Couple of additional comments:&lt;/p&gt;

&lt;p&gt;(1) Top N&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;You assume that you are getting data in as bytearrays (for n and fieldNum. It would be better if you assume the actual types (int) andlet Pig to do conversion for you because then your function will be able to work with data of different types. You do that by adding getArgToFuncMapping function. You can see the examples in other functions in the repository and also explanation of usage in the UDF manual. This is also applicable for your second UDF.&lt;/li&gt;
	&lt;li&gt;In the exec function, you check for 2 elements in the tuple but you are accessing&lt;/li&gt;
	&lt;li&gt;Looks like if you inserted too many elements you will be throwing away the head of the queue. Is that what you want?&lt;/li&gt;
	&lt;li&gt;You are not specifying tuple structure in your schema definition. This could be an issue for some of your queries.&lt;/li&gt;
&lt;/ul&gt;


</comment>
                            <comment id="12693701" author="ankur" created="Mon, 30 Mar 2009 10:21:17 +0100"  >&lt;p&gt;&amp;gt; You assume that your are getting ....&lt;br/&gt;
1. Fixed. Implemented getArgToFuncMapping() as suggested.&lt;/p&gt;

&lt;p&gt;&amp;gt; In the exec function, you check for 2 elements ....&lt;br/&gt;
2. Fixed. Changed to check for 3 arguments.&lt;/p&gt;

&lt;p&gt;&amp;gt; Looks like if you inserted .....&lt;br/&gt;
Yep that is the desired behavior.  The need is to keep top-N tuples and throw away the remaining. The head of the queue in this case would be the minimum element.&lt;/p&gt;

&lt;p&gt;&amp;gt; You are not specifying tuple structure....&lt;br/&gt;
The output tuple structure is really based upon the tuple structure in the input bag (field(2)). I have changed this slightly as per my understanding. If this can be better written, please suggest.&lt;/p&gt;</comment>
                            <comment id="12693737" author="hadoopqa" created="Mon, 30 Mar 2009 12:52:18 +0100"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12404118/udf.v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12404118/udf.v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 759376.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/17/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/17/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/17/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/17/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/17/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-minerva.apache.org/17/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12694036" author="ankur" created="Tue, 31 Mar 2009 10:34:45 +0100"  >&lt;p&gt;Not sure why the core tests fail. The automated test output don&apos;t seem to suggest anything patch specific or may be I am unable to spot in the console output.&lt;/p&gt;</comment>
                            <comment id="12696404" author="ankur" created="Tue, 7 Apr 2009 05:59:36 +0100"  >&lt;p&gt;Hi Olga, can you please take a look and suggest what&apos;s wrong?&lt;/p&gt;</comment>
                            <comment id="12696602" author="olgan" created="Tue, 7 Apr 2009 17:28:06 +0100"  >&lt;p&gt;Looks like there are issues with patch process and we are looking into it.&lt;/p&gt;

&lt;p&gt;Santhosh, could you take a look at how output schema for the UDF is constructed to make sure it is correct, thanks.&lt;/p&gt;</comment>
                            <comment id="12696669" author="sms" created="Tue, 7 Apr 2009 19:17:21 +0100"  >&lt;p&gt;Review comments for the outputSchema method in the UDFs&lt;/p&gt;

&lt;p&gt;Index: contrib/piggybank/java/src/main/java/org/apache/pig/piggybank/evaluation/util/SearchQuery.java&lt;br/&gt;
==========================================================================&lt;/p&gt;

&lt;p&gt;SearchQuery is returning String. The outputSchema method should return a Schema with a single column of type CHARARRAY. You could use one of the following two approaches:&lt;/p&gt;

&lt;p&gt;1. If you wish to call the column query then use the following.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Schema s = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Schema();
s.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Schema.FieldSchema(&lt;span class=&quot;code-quote&quot;&gt;&quot;query&quot;&lt;/span&gt;, DataType.CHARARRAY));
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; s;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2. If you wish to use an generated name then use the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Schema s = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Schema();
s.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Schema.FieldSchema(getSchemaName(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getClass().getName().toLowerCase(), input), DataType.CHARARRAY));
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; s;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The relevant portion of the patch is shown below.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  @Override
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Schema outputSchema(Schema input) {
+    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+      Schema s = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Schema();
+      s.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Schema.FieldSchema(&lt;span class=&quot;code-quote&quot;&gt;&quot;query&quot;&lt;/span&gt;, DataType.CHARARRAY));
+      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Schema(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Schema.FieldSchema(getSchemaName(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getClass()
+          .getName().toLowerCase(), input), s, DataType.CHARARRAY));
+    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
+      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
+    }
+  }
+}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12697425" author="ankur" created="Thu, 9 Apr 2009 09:06:05 +0100"  >&lt;p&gt;Incorporated the changes in SearchQuery.java as per suggestions.&lt;/p&gt;</comment>
                            <comment id="12704014" author="ankur" created="Wed, 29 Apr 2009 08:05:54 +0100"  >&lt;p&gt;If there aren&apos;t any other issues then can we go ahead and commit these ?&lt;/p&gt;</comment>
                            <comment id="12704426" author="olgan" created="Thu, 30 Apr 2009 02:01:51 +0100"  >&lt;p&gt;Ankur, thanks for your contribution and sorry for the delay.&lt;/p&gt;

&lt;p&gt;I integrated your patch and and ran the tests. I see one failure in the unit tests:&lt;/p&gt;

&lt;p&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.piggybank.test.evaluation.util.TestTopN FAILED&lt;/p&gt;

&lt;p&gt;The log file contains the following:&lt;/p&gt;

&lt;p&gt;Testsuite: org.apache.pig.piggybank.test.evaluation.util.TestTopN&lt;br/&gt;
Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 0.17 sec&lt;/p&gt;

&lt;p&gt;Testcase: testTopN took 0.152 sec&lt;br/&gt;
    Caused an ERROR&lt;br/&gt;
General Exception executing function: java.lang.ClassCastException: java.lang.Long cannot be cast to java.lang.Integer&lt;br/&gt;
java.lang.RuntimeException: General Exception executing function: java.lang.ClassCastException: java.lang.Long cannot be cast to java.lang.Integer&lt;br/&gt;
    at org.apache.pig.piggybank.evaluation.util.TopN.exec(TopN.java:112)&lt;br/&gt;
    at org.apache.pig.piggybank.test.evaluation.util.TestTopN.testTopN(Unknown Source)&lt;/p&gt;</comment>
                            <comment id="12704504" author="ankur" created="Thu, 30 Apr 2009 07:50:15 +0100"  >&lt;p&gt;Minor issue in test case, causing test failure. Fixed in latest upload - udf.v5.patch. Also changed TopN to Top. Should be good to go now.&lt;/p&gt;</comment>
                            <comment id="12704802" author="olgan" created="Thu, 30 Apr 2009 22:09:29 +0100"  >&lt;p&gt;Patch committed. Thanks, Ankur for contributing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12403595" name="udf.v1.patch" size="10456" author="ankur" created="Wed, 25 Mar 2009 09:49:59 +0000"/>
                            <attachment id="12403607" name="udf.v2.patch" size="13906" author="ankur" created="Wed, 25 Mar 2009 13:10:19 +0000"/>
                            <attachment id="12404118" name="udf.v3.patch" size="15176" author="ankur" created="Mon, 30 Mar 2009 10:26:46 +0100"/>
                            <attachment id="12405051" name="udf.v4.patch" size="15044" author="ankur" created="Thu, 9 Apr 2009 09:06:05 +0100"/>
                            <attachment id="12406880" name="udf.v5.patch" size="15441" author="ankur" created="Thu, 30 Apr 2009 07:50:15 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 25 Mar 2009 10:23:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72444</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyai93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95268</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>