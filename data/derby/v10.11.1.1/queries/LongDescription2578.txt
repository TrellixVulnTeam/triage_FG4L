I am starting to think about the code generation for DERBY-1478 language based ordering. Depending on the collation type of the DTD, we might want to generate CollatorSQLChar rather than SQLChar for instance. In order to centralize this code, I am changing CurrentDatetimeOperatorNode's generateExpression so that it goes through ExpressionClassBuilder.generateDataValue rather than doing TypeCompiler.generateDataValue. This way, hopefully, I will only have to change  ExpressionClassBuilder.generateDataValue to take care of the collation dependency of DVD generation. All the other classes which need to generate a DVD already go through ExpressionClassBuilder.generateDataValue. Will commit the patch for this soon. The tests have passed with no new failures.