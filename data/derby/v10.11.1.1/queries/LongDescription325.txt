The server hangs during XA operations. When it is restarted after being killed, it fails to start. Following error is logged:

Server is ready to accept connections on port 1527.
Connection number: 1.
----------------------------------------------------------------
2005-05-30 20:18:33.550 GMT:
 Booting Derby version The Apache Software Foundation - Apache Derby - 10.1.0.0 alpha - (178031M): instance c013800d-0104-2f41-2f4c-ffff83f23fc8
on database directory D:\DERBY\databases\tca 


------------  BEGIN SHUTDOWN ERROR STACK -------------

ERROR XSLA8: Cannot rollback transaction 2490, trying to compensate Page Operation: Page(1,Container(0, 945)) pageVersion 49 : UpdateField :  Slot=1 recordId=7 fieldId=1 operation with null
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:337)
	at org.apache.derby.impl.store.raw.log.FileLogger.undo(FileLogger.java:1045)
	at org.apache.derby.impl.store.raw.xact.Xact.abort(Xact.java:906)
	at org.apache.derby.impl.store.raw.xact.XactFactory.rollbackAllTransactions(XactFactory.java:498)
	at org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:1082)
	at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:323)
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985)
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:284)
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:539)
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418)
	at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:994)
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985)
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:284)
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:539)
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418)
	at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:752)
	at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:173)
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985)
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:284)
	at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1832)
	at org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(BaseMonitor.java:1698)
	at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(BaseMonitor.java:1577)
	at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:996)
	at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:988)
	at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Monitor.java:533)
	at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:1548)
	at org.apache.derby.impl.jdbc.EmbedConnection.<init>(EmbedConnection.java:193)
	at org.apache.derby.impl.jdbc.EmbedConnection30.<init>(EmbedConnection30.java:72)
	at org.apache.derby.jdbc.Driver30.getNewEmbedConnection(Driver30.java:73)
	at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:183)
	at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(EmbeddedDataSource.java:468)
	at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(EmbeddedDataSource.java:430)
	at org.apache.derby.jdbc.EmbeddedXADataSource.setupResourceAdapter(EmbeddedXADataSource.java:161)
	at org.apache.derby.jdbc.EmbeddedXADataSource.getXAConnection(EmbeddedXADataSource.java:119)
	at org.apache.derby.impl.drda.XADatabase.makeConnection(XADatabase.java:77)
	at org.apache.derby.impl.drda.DRDAConnThread.getConnFromDatabaseName(DRDAConnThread.java:1132)
	at org.apache.derby.impl.drda.DRDAConnThread.verifyUserIdPassword(DRDAConnThread.java:1110)
	at org.apache.derby.impl.drda.DRDAConnThread.parseSECCHK(DRDAConnThread.java:2648)
	at org.apache.derby.impl.drda.DRDAConnThread.parseDRDAConnection(DRDAConnThread.java:973)
	at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:816)
	at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:226)
============= begin nested exception, level (1) ===========
ERROR XBM0U: No class was registered for identifier 200
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:311)
	at org.apache.derby.impl.services.monitor.BaseMonitor.classFromIdentifier(BaseMonitor.java:648)
	at org.apache.derby.impl.services.monitor.BaseMonitor.newInstanceFromIdentifier(BaseMonitor.java:661)
	at org.apache.derby.iapi.services.monitor.Monitor.newInstanceFromIdentifier(Monitor.java:618)
	at org.apache.derby.impl.store.access.conglomerate.TemplateRow.allocate_objects(TemplateRow.java:91)
	at org.apache.derby.impl.store.access.conglomerate.TemplateRow.newRow(TemplateRow.java:205)
	at org.apache.derby.impl.store.access.btree.BTree.createTemplate(BTree.java:296)
	at org.apache.derby.impl.store.access.btree.index.B2IUndo.findUndo(B2IUndo.java:152)
	at org.apache.derby.impl.store.raw.data.LogicalPageOperation.findLogicalPage(LogicalPageOperation.java:357)
	at org.apache.derby.impl.store.raw.data.LogicalPageOperation.generateUndo(LogicalPageOperation.java:163)
	at org.apache.derby.impl.store.raw.log.FileLogger.undo(FileLogger.java:990)
	at org.apache.derby.impl.store.raw.xact.Xact.abort(Xact.java:906)
	at org.apache.derby.impl.store.raw.xact.XactFactory.rollbackAllTransactions(XactFactory.java:498)
	at org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:1082)
	at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:323)
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985)
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:284)
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:539)
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418)
	at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:994)
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985)
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:284)
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:539)
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418)
	at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:752)
	at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:173)
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985)
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:284)
	at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1832)
	at org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(BaseMonitor.java:1698)
	at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(BaseMonitor.java:1577)
	at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:996)
	at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:988)
	at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Monitor.java:533)
	at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:1548)
	at org.apache.derby.impl.jdbc.EmbedConnection.<init>(EmbedConnection.java:193)
	at org.apache.derby.impl.jdbc.EmbedConnection30.<init>(EmbedConnection30.java:72)
	at org.apache.derby.jdbc.Driver30.getNewEmbedConnection(Driver30.java:73)
	at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:183)
	at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(EmbeddedDataSource.java:468)
	at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(EmbeddedDataSource.java:430)
	at org.apache.derby.jdbc.EmbeddedXADataSource.setupResourceAdapter(EmbeddedXADataSource.java:161)
	at org.apache.derby.jdbc.EmbeddedXADataSource.getXAConnection(EmbeddedXADataSource.java:119)
	at org.apache.derby.impl.drda.XADatabase.makeConnection(XADatabase.java:77)
	at org.apache.derby.impl.drda.DRDAConnThread.getConnFromDatabaseName(DRDAConnThread.java:1132)
	at org.apache.derby.impl.drda.DRDAConnThread.verifyUserIdPassword(DRDAConnThread.java:1110)
	at org.apache.derby.impl.drda.DRDAConnThread.parseSECCHK(DRDAConnThread.java:2648)
	at org.apache.derby.impl.drda.DRDAConnThread.parseDRDAConnection(DRDAConnThread.java:973)
	at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:816)
	at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:226)
============= end nested exception, level (1) ===========


------------  END SHUTDOWN ERROR STACK -------------