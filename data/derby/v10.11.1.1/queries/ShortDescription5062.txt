[patch] push code assignments down to where they are used - part 2