The JUnit code already supports most of this, can probably build off that.