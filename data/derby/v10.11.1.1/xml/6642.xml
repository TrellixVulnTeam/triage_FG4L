<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:27:03 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6642/DERBY-6642.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6642] Make the JUnit result set assertion methods dump the actual rs when assertion fails</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6642</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Often, when researching intermittent regression test errors, an assertion on a result set fails, but the error report only shows which column in which row first fails to meet expectations. It would be good if the assertion methods could dump the actual result set in such cases so we&apos;d have more information to go on when trying to understand the cause of the problem.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12724519">DERBY-6642</key>
            <summary>Make the JUnit result set assertion methods dump the actual rs when assertion fails</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Jun 2014 20:16:59 +0100</created>
                <updated>Mon, 14 Jul 2014 13:38:35 +0100</updated>
                            <resolved>Tue, 1 Jul 2014 14:22:52 +0100</resolved>
                                                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="14048008" author="dagw" created="Mon, 30 Jun 2014 20:22:15 +0100"  >&lt;p&gt;Linking to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6628&quot; title=&quot;Intermittent error in TriggerGeneralTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6628&quot;&gt;&lt;del&gt;DERBY-6628&lt;/del&gt;&lt;/a&gt;. Remove special diagnostic code in that test when this issue if committed.&lt;/p&gt;</comment>
                            <comment id="14048013" author="dagw" created="Mon, 30 Jun 2014 20:27:08 +0100"  >&lt;p&gt;Attaching a patch that adds this functionality to org.apache.derbyTesting.junit.JDBC.&lt;/p&gt;

&lt;p&gt;Running regression. I am also testing most of the assertion methods on result sets manually, to see if they do the job under the different failure scenarios. One concern is that some tests might assert on very large result sets and formatting those as part of the error message would fill up a lot of log space... If this turns out to be an issue, we can make opt-out versions.&lt;/p&gt;</comment>
                            <comment id="14048024" author="dagw" created="Mon, 30 Jun 2014 20:36:04 +0100"  >&lt;p&gt;The patch works by always collecting columns and rows as they are read. The method JDBC#addRsToReport takes these collections and what&apos;s left of the result set and formats a dump of the result set and adds it to the text of already existing assertion failure. This is then (re)thrown.&lt;/p&gt;</comment>
                            <comment id="14048045" author="dagw" created="Mon, 30 Jun 2014 20:52:30 +0100"  >&lt;p&gt;Example of an error (faked one in InListMultiProbetest):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
1) testInListProbingWithOrderBy(org.apache.derbyTesting.functionTests.tests.lang.InListMultiProbeTest)junit.framework.AssertionFailedError: Column value mismatch @ column &apos;CHEESE_NAME&apos;, row 3:
    Expected: &amp;gt;EDAMM&amp;lt;
    Found:    &amp;gt;EDAM&amp;lt;

    CHEESE_CODE,CHEESE_NAME,CHEESE_COST,CHEESE_CODE,CHEESE_NAME,CHEESE_COST
    ----------- ----------- ----------- ----------- ----------- -----------
   {00000,EDAM,2.1111}
   {00000,EDAM,2.1111}
   {00000,EDAM,999.8888,00000,EDAM,2.1111}
   {00000,EDAM,2.1111,54321,EDAM,8.5646}
   {54321,EDAM,8.5646,54321,EDAM,8.5646}
   {AAAAA,EDAM,999.8888,54321,EDAM,8.5646}

	at org.apache.derbyTesting.junit.JDBC.addRsToReport(JDBC.java:1887)
	at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1377)
	at org.apache.derbyTesting.junit.JDBC.assertPartialResultSet(JDBC.java:1211)
	at org.apache.derbyTesting.functionTests.tests.lang.InListMultiProbeTest.testInListProbingWithOrderBy(InListMultiProbeTest.java:781)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:118)
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:440)
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:457)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)
	at singlederbyjunittest.SingleDerbyJunitTest.main(SingleDerbyJunitTest.java:22)

FAILURES!!!
Tests run: 15,  Failures: 1,  Errors: 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14048678" author="knutanders" created="Tue, 1 Jul 2014 10:27:21 +0100"  >&lt;p&gt;Looks fine to me. +1&lt;/p&gt;

&lt;p&gt;Nit 1: Double semicolon in addRsToReport():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                seenRow.clear();;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nit 2: The inner for loop in addRsToReport() could probably be replaced with row.toString(). (You&apos;d get square brackets instead of curly ones, though.)&lt;/p&gt;</comment>
                            <comment id="14048835" author="dagw" created="Tue, 1 Jul 2014 13:59:35 +0100"  >&lt;p&gt;Thanks, Knut. Uploading version b to fix the nits. Regressions passed.&lt;/p&gt;</comment>
                            <comment id="14048856" author="jira-bot" created="Tue, 1 Jul 2014 14:21:38 +0100"  >&lt;p&gt;Commit 1607069 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dagw&quot; class=&quot;user-hover&quot; rel=&quot;dagw&quot;&gt;Dag H. Wanvik&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1607069&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1607069&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6642&quot; title=&quot;Make the JUnit result set assertion methods dump the actual rs when assertion fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6642&quot;&gt;&lt;del&gt;DERBY-6642&lt;/del&gt;&lt;/a&gt; Make the JUnit result set assertion methods dump the actual rs when assertion fails&lt;/p&gt;

&lt;p&gt;Patch derby-6642b. The patch works by always collecting columns and&lt;br/&gt;
rows as they are read. The method JDBC#addRsToReport takes these&lt;br/&gt;
collections and what&apos;s left of the result set and formats a dump of&lt;br/&gt;
the result set and adds it to the text of already existing assertion&lt;br/&gt;
failure. This is then (re)thrown.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12722584">DERBY-6628</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12727074">DERBY-6660</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12653217" name="derby-6642.diff" size="17117" author="dagw" created="Mon, 30 Jun 2014 20:31:42 +0100"/>
                            <attachment id="12653387" name="derby-6642b.diff" size="16884" author="dagw" created="Tue, 1 Jul 2014 13:59:35 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Jul 2014 09:27:21 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>402702</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzr64f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>402769</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>