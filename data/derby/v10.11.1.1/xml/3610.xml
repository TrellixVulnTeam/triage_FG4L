<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:37:50 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3610/DERBY-3610.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3610] Confusing error message when granting execute privilege</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3610</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When the wrong keyword is used in a grant execute privilege statement, the error message&lt;br/&gt;
leads one the believe the identifier is neither a procedure or a function, when in deed it is one of the two.&lt;/p&gt;

&lt;p&gt;&amp;gt; create function bc(i int) returns int language java parameter style java external name &apos;java.lang.Integer.bitCount&apos; no sql;&lt;br/&gt;
&amp;gt; grant execute on procedure bc to foo;&lt;br/&gt;
ERROR 42Y03: &apos;BC&apos; is not recognized as a function or procedure.&lt;/p&gt;

&lt;p&gt;&amp;gt; grant execute on function bc to foo;&lt;br/&gt;
(works)&lt;/p&gt;

&lt;p&gt;The reason is that the error message is generic. It would be better to have an error message for each case.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12393527">DERBY-3610</key>
            <summary>Confusing error message when granting execute privilege</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hiranya">Hiranya Jayathilaka</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Apr 2008 13:27:33 +0100</created>
                <updated>Mon, 30 May 2011 16:22:46 +0100</updated>
                            <resolved>Wed, 15 Apr 2009 09:50:19 +0100</resolved>
                                                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12694515" author="hiranya" created="Wed, 1 Apr 2009 14:05:53 +0100"  >&lt;p&gt;I ran some debug sessions and found the cause of the issue. The problem is we only have one error message to handle both scenarios (42Y03). We can easily fix this by adding two new messages, one for each scenario and making some code changes in the PrivilegeNode class. I&apos;ve already done these changes in my local copy and it seems to be working fine. Before I submit a patch I want to know the rationale behind the coding scheme used to classify error messages. If I&apos;m to add two new messages what are the codes I should use to identify them (for the moment I&apos;m using 62Y03 and 72Y03).&lt;/p&gt;

&lt;p&gt;Can somebody please shed some light on the subject? &lt;/p&gt;</comment>
                            <comment id="12694517" author="hiranya" created="Wed, 1 Apr 2009 14:10:11 +0100"  >&lt;p&gt;In the proposed solution we don&apos;t remove the message 42Y03. This message is being referred to by many classes and it&apos;s probably not a good idea to remove it. That will cause many small code changes all over the code base. So I suggest simply adding two new messages and making some changes local to the PrivilegeNode class to tackle the reported issue. I think we also have to update the corresponding test cases in the GrantRevokeTest class and GrantRevokeDDLTest class. Thoughts?&lt;/p&gt;</comment>
                            <comment id="12694825" author="dagw" created="Thu, 2 Apr 2009 00:30:21 +0100"  >&lt;p&gt;Thanks for looking at this issue, Hiranya.&lt;/p&gt;

&lt;p&gt;You could make one new error message which can take an argument, &quot;procedure&quot; or &quot;function&quot;, and use that&lt;br/&gt;
in the PrivilegeNode as the case may be. Note that arguments to error messages need to be localized (i18n), but in this case the variability would be SQL keywords, so it&apos;s ok to use them as is. As for code assignment, &lt;br/&gt;
it is a bit messy already, but we should try to look at:&lt;/p&gt;

&lt;p&gt;a) SQL standard codes if prescribed in the standard, cf. Foundation(part 2), section 24.1&lt;br/&gt;
    (drafts can be found here: &lt;a href=&quot;http://www.wiscorp.com/SQLStandards.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.wiscorp.com/SQLStandards.html&lt;/a&gt;)&lt;br/&gt;
b) Derby established practice, cf. the comment headers in  reference/SQLState.java&lt;/p&gt;

&lt;p&gt;Is probably wise to avoid codes that have been used in the past (i.e. are commented out).&lt;br/&gt;
In this case I think it would be good to put it close to the existing one, e.g. 42Y21 is unused.&lt;/p&gt;</comment>
                            <comment id="12694828" author="dagw" created="Thu, 2 Apr 2009 00:35:42 +0100"  >&lt;p&gt;Yes, you would also have to update the test that would be affected by this change. GrantRevokeTest and GrantRevokeDDLTest are likely candidates, yes, and maybe the role tests.&lt;/p&gt;</comment>
                            <comment id="12695052" author="hiranya" created="Thu, 2 Apr 2009 17:26:17 +0100"  >&lt;p&gt;Thanks for the tips Dag. I&apos;m on this issue. Expect a patch soon.&lt;/p&gt;</comment>
                            <comment id="12695706" author="hiranya" created="Sat, 4 Apr 2009 11:58:07 +0100"  >&lt;p&gt;I&apos;m uploading a patch for a review. This patch solves the reported problem. I also verified the derbyall testsuite with this patch applied and didn&apos;t notice any issues. &lt;/p&gt;

&lt;p&gt;Your feedback is most appreciated. I&apos;m not 100% sure about the way I&apos;m passing the SQL keywords (procedure/function) to the error message. Is there a better way of doing that?&lt;/p&gt;</comment>
                            <comment id="12695883" author="knutanders" created="Sun, 5 Apr 2009 18:59:59 +0100"  >&lt;p&gt;I think it may be better to have two different error messages, since passing the words &quot;procedure&quot; and &quot;function&quot; as arguments to the error message doesn&apos;t work that well for other languages than English.&lt;/p&gt;

&lt;p&gt;It is possible to have many messages with the same SQLState, by adding a suffix that is only used by Derby internally. For example&lt;/p&gt;

&lt;p&gt;42Y21.S.0 - &lt;/p&gt;
{0} is not recognized as a procedure&lt;br/&gt;
42Y21.S.1 - {0}
&lt;p&gt; is not recognized as a function&lt;/p&gt;

&lt;p&gt;See here for a description of how Derby interprets the states: &lt;a href=&quot;http://db.apache.org/derby/javadoc/engine/org/apache/derby/shared/common/reference/SQLState.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/javadoc/engine/org/apache/derby/shared/common/reference/SQLState.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Perhaps we should reuse the SQLState 42Y03 instead of adding 42Y21, so that the change doesn&apos;t affect existing applications that check the SQLState. If the state is changed, we&apos;d need a release note to give a heads up to the users.&lt;/p&gt;</comment>
                            <comment id="12696688" author="dagw" created="Tue, 7 Apr 2009 19:55:04 +0100"  >&lt;p&gt;Thanks, Hiranya! &lt;br/&gt;
Knut, I don&apos;t think &quot;procedure&quot; and &quot;function&quot; is a problem, both are SQL keywords, we had similar cases in the past. But I like the idea of avoiding having to introduce a new error message so doing as you suggest is still good: +1.&lt;/p&gt;

&lt;p&gt;Patch looks good, but some nits: One of the lines was longer than 80 characters and had trailing whitespace. We try to avoid both.&lt;/p&gt;

&lt;p&gt;As a matter of style (feel free to disagree); I prefer this&lt;/p&gt;

&lt;p&gt;String keyword;&lt;/p&gt;

&lt;p&gt;if (rd.isFunction) &lt;/p&gt;
{
    keyword = &quot;function&quot;;
}
&lt;p&gt; else &lt;/p&gt;
{
   keyword = &quot;procedure&quot;;
}

&lt;p&gt;over:&lt;/p&gt;

&lt;p&gt;String keyword = &quot;procedure&quot;;&lt;br/&gt;
if (rd.isFunction) &lt;/p&gt;
{
   keyword = &quot;function&quot;;
}

&lt;p&gt;since in the function case there is one redundant assignment. I also find it easier to read.&lt;/p&gt;

&lt;p&gt;Some would perhaps prefer:&lt;/p&gt;

&lt;p&gt;String keyword = rd.isFunction ? &quot;function&quot; : &quot;procedure&quot;;&lt;/p&gt;

&lt;p&gt;but I find this harder to read. But in any case, using Knut&apos;s idea, this code would go away anyway... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="12696802" author="knutanders" created="Tue, 7 Apr 2009 23:52:33 +0100"  >&lt;p&gt;&amp;gt; Knut, I don&apos;t think &quot;procedure&quot; and &quot;function&quot; is a problem, both&lt;br/&gt;
&amp;gt; are SQL keywords, we had similar cases in the past. But I like the&lt;br/&gt;
&amp;gt; idea of avoiding having to introduce a new error message so doing as&lt;br/&gt;
&amp;gt; you suggest is still good: +1.&lt;/p&gt;

&lt;p&gt;Hm... I thought I proposed the opposite of what you said, that is&lt;br/&gt;
adding two new error messages, not avoiding the introduction of new&lt;br/&gt;
ones... But I&apos;m glad you support the idea! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;As to &quot;procedure&quot; and &quot;function&quot; being keywords, that&apos;s true, but we&lt;br/&gt;
normally use upper case letters when they are used as such. Looking at&lt;br/&gt;
the translations of the 42Y03 message, it seems like the translators&lt;br/&gt;
did not regard those words as SQL keywords in that message, but rather&lt;br/&gt;
as names of concepts that needed to be translated.&lt;/p&gt;</comment>
                            <comment id="12696815" author="dagw" created="Wed, 8 Apr 2009 00:25:10 +0100"  >&lt;p&gt;To be clear, I think it is good to reuse the SQL state (42Y03), but&lt;br/&gt;
introduce two new messages as you suggest (i.e. no new state).&lt;/p&gt;

&lt;p&gt;As for keywords in messages, all caps is probably advisable.  Still, in this&lt;br/&gt;
case, &quot;function&quot; and &quot;procedure&quot; are actually used as concepts more&lt;br/&gt;
than referring to the actual keyword (although that distinction is&lt;br/&gt;
often blurry it is fairly clear here), so providing a version of the&lt;br/&gt;
error messages that would allow these terms to be translated is good for&lt;br/&gt;
localization.&lt;/p&gt;

&lt;p&gt;So, +1 to two new messages reusing the old SQL state.&lt;/p&gt;</comment>
                            <comment id="12696816" author="dagw" created="Wed, 8 Apr 2009 00:26:05 +0100"  >&lt;p&gt;Hiranya, you may want to assign yourself to this issue.&lt;/p&gt;</comment>
                            <comment id="12696923" author="hiranya" created="Wed, 8 Apr 2009 08:24:16 +0100"  >&lt;p&gt;Thanks for all the comments folks. I just need a small clarification. Do you suggest something like this?&lt;/p&gt;

&lt;p&gt;42Y03.S.0 - &lt;/p&gt;
{0} is not recognized as a procedure&lt;br/&gt;
42Y03.S.1 - {0}
&lt;p&gt; is not recognized as a function&lt;/p&gt;

&lt;p&gt;If there are other classes which uses the state 42Y03, won&apos;t they get affected by this addition? &lt;/p&gt;</comment>
                            <comment id="12696945" author="knutanders" created="Wed, 8 Apr 2009 09:35:06 +0100"  >&lt;p&gt;Adding 42Y03.S.0 and 42Y03.S.1 won&apos;t affect those who already use 42Y03, as the three message ids are different. For consistency though, it may make sense to rename the original 42Y03 message to 42Y03.S.X so that we have&lt;/p&gt;

&lt;p&gt;42Y03.S.0 - &lt;/p&gt;
{0} is not recognized as a function or a procedure&lt;br/&gt;
42Y03.S.1 - {0}
&lt;p&gt; is not recognized as a procedure&lt;br/&gt;
42Y03.S.2 - &lt;/p&gt;
{0}
&lt;p&gt; is not recognized as a function&lt;/p&gt;

&lt;p&gt;The constant SQLState.LANG_NO_SUCH_METHOD_ALIAS and the &amp;lt;name&amp;gt; tag for that message in messages.xml will have to be updated.&lt;/p&gt;</comment>
                            <comment id="12697285" author="dagw" created="Wed, 8 Apr 2009 23:59:45 +0100"  >&lt;p&gt;Note that the tests can&apos;t just test for 42Y03 when we overload the SQL state. To verify that the correct error message is used, you will have to assert on the message text.&lt;/p&gt;</comment>
                            <comment id="12698655" author="hiranya" created="Tue, 14 Apr 2009 06:14:14 +0100"  >&lt;p&gt;Attaching the updated patch. Please review and provide feedback. Thanks Knut and Dag for all the support so far.&lt;/p&gt;</comment>
                            <comment id="12698782" author="knutanders" created="Tue, 14 Apr 2009 15:17:55 +0100"  >&lt;p&gt;Thanks! The patch looks good to me. I&apos;m running the regression tests now and will commit if they pass.&lt;/p&gt;</comment>
                            <comment id="12698791" author="knutanders" created="Tue, 14 Apr 2009 15:48:21 +0100"  >&lt;p&gt;I&apos;m seeing four failures in GrantRevokeTest when running with the patch. See the attached log for details.&lt;/p&gt;</comment>
                            <comment id="12699055" author="hiranya" created="Wed, 15 Apr 2009 06:13:51 +0100"  >&lt;p&gt;Looks like the error messages generated contains schema information causing the assertions on message text to fail. I&apos;ll fix this up asap and provide a patch. Thanks for pointing this out. &lt;/p&gt;</comment>
                            <comment id="12699074" author="hiranya" created="Wed, 15 Apr 2009 07:06:29 +0100"  >&lt;p&gt;Updated the GrantRevokeTest. Verified the overall functionality against derbylang test suite.&lt;/p&gt;</comment>
                            <comment id="12699120" author="knutanders" created="Wed, 15 Apr 2009 09:50:19 +0100"  >&lt;p&gt;Thanks, Hiranya.&lt;br/&gt;
Committed revision 765087.&lt;/p&gt;</comment>
                            <comment id="12703456" author="dagw" created="Tue, 28 Apr 2009 01:16:36 +0100"  >&lt;p&gt;Verified that the error messages now look clear for both function and procedure, closing.&lt;br/&gt;
Thanks, Hiranya and Knut.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12508649">DERBY-5252</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12405390" name="DERBY-3610-update1.patch" size="4813" author="hiranya" created="Tue, 14 Apr 2009 06:14:14 +0100"/>
                            <attachment id="12405503" name="DERBY-3610-update2.patch" size="4837" author="hiranya" created="Wed, 15 Apr 2009 07:06:29 +0100"/>
                            <attachment id="12404633" name="DERBY-3610.patch" size="4826" author="hiranya" created="Sat, 4 Apr 2009 11:58:07 +0100"/>
                            <attachment id="12405420" name="GrantRevokeTest.log" size="9169" author="knutanders" created="Tue, 14 Apr 2009 15:48:21 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 1 Apr 2009 13:05:53 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30923</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0g5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36435</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>