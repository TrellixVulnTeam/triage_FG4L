<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:33:11 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-491/DERBY-491.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-491] Protocol exception when Network Server tries to return ~32K of data or greater in a result set for a Java stored procedure.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-491</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When Derby Network Server tries to return ~32K or greater data as part of the result set for a stored procedure, a protocol exception occurs and causes deallocation of the connection. Repro can be found in the &quot;stored_proc_repro.java&quot; file, which uses the stored procedure &quot;BIG_COL&quot; declared in &quot;storedProcs.java&quot;. Both files are attached to this bug.&lt;/p&gt;</description>
                <environment>Derby Network Server running with either JDBC or ODBC driver.</environment>
        <key id="12313045">DERBY-491</key>
            <summary>Protocol exception when Network Server tries to return ~32K of data or greater in a result set for a Java stored procedure.</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="30720">DERBY-170</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="army">A B</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Aug 2005 04:58:41 +0100</created>
                <updated>Wed, 24 May 2006 04:59:53 +0100</updated>
                            <resolved>Sat, 29 Apr 2006 13:43:13 +0100</resolved>
                                    <version>10.0.2.2</version>
                    <version>10.1.1.0</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.1.3.1</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12317667" author="army" created="Fri, 5 Aug 2005 04:59:31 +0100"  >&lt;p&gt;Adding repro files (same as the files for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-170&quot; title=&quot;Inserting large string value into non-existent table causes communication link failure over Network Server.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-170&quot;&gt;&lt;del&gt;DERBY-170&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="12359759" author="bryanpendleton" created="Fri, 9 Dec 2005 04:33:39 +0000"  >&lt;p&gt;This wasn&apos;t immediately clear from the stored_proc_repro.java file, but I seem to &lt;b&gt;also&lt;/b&gt; get the same exception if I use the Derby Client Driver. I tweaked the reproduction code to say:&lt;/p&gt;

&lt;p&gt;      Class.forName(&quot;org.apache.derby.jdbc.ClientDriver&quot;).newInstance();&lt;br/&gt;
      Connection conn = DriverManager.getConnection( &quot;jdbc:derby://localhost:1527/testdb&quot;, &quot;bah&quot;, &quot;humbug&quot;);&lt;/p&gt;

&lt;p&gt;instead of referencing the DB2JCC driver, and I get the following exception, which I assume is the same as the bug you observed:&lt;/p&gt;

&lt;p&gt; &lt;del&gt;=&lt;/del&gt; ERROR 1 REPRODUCED:&lt;br/&gt;
org.apache.derby.client.am.DisconnectException: actual code point, -2 does not match expected code point, 8709&lt;br/&gt;
        at org.apache.derby.client.net.Reply.zThrowSyntaxError(Reply.java:1163)&lt;br/&gt;
        at org.apache.derby.client.net.Reply.parseLengthAndMatchCodePoint(Reply.java:1063)&lt;br/&gt;
        at org.apache.derby.client.net.NetStatementReply.parseOPNQRYRM(NetStatementReply.java:724)&lt;br/&gt;
        at org.apache.derby.client.net.NetStatementReply.parseResultSetCursor(NetStatementReply.java:400)&lt;br/&gt;
        at org.apache.derby.client.net.NetStatementReply.parseResultSetProcedure(NetStatementReply.java:377)&lt;br/&gt;
        at org.apache.derby.client.net.NetStatementReply.parseEXCSQLSTTreply(NetStatementReply.java:279)&lt;br/&gt;
        at org.apache.derby.client.net.NetStatementReply.readExecuteCall(NetStatementReply.java:97)&lt;br/&gt;
        at org.apache.derby.client.net.StatementReply.readExecuteCall(StatementReply.java:74)&lt;br/&gt;
        at org.apache.derby.client.net.NetStatement.readExecuteCall_(NetStatement.java:174)&lt;br/&gt;
        at org.apache.derby.client.am.Statement.readExecuteCall(Statement.java:1117)&lt;br/&gt;
        at org.apache.derby.client.am.PreparedStatement.flowExecute(PreparedStatement.java:1428)&lt;br/&gt;
        at org.apache.derby.client.am.CallableStatement.executeX(CallableStatement.java:124)&lt;br/&gt;
        at org.apache.derby.client.am.CallableStatement.execute(CallableStatement.java:114)&lt;br/&gt;
        at stored_proc_repro.main(stored_proc_repro.java:57)&lt;/p&gt;</comment>
                            <comment id="12362693" author="bryanpendleton" created="Sat, 14 Jan 2006 07:07:26 +0000"  >&lt;p&gt;Attached is a patch proposal which addresses both this bug and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-492&quot; title=&quot;Server hangs when trying to return high number (hundreds) of columns from a Java procedure to the client.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-492&quot;&gt;&lt;del&gt;DERBY-492&lt;/del&gt;&lt;/a&gt;. I have also included a document which provides background information for the reviewers. The patch proposal includes new tests and master files. HOWEVER: the new tests do not pass with this patch. In order for the tests to pass, you have to have the fixes for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-125&quot; title=&quot;Network Server can send DSS greater than 32K to client, which breaks DRDA protocol.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-125&quot;&gt;&lt;del&gt;DERBY-125&lt;/del&gt;&lt;/a&gt; first. My hope/intention is that we can review/commit the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-125&quot; title=&quot;Network Server can send DSS greater than 32K to client, which breaks DRDA protocol.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-125&quot;&gt;&lt;del&gt;DERBY-125&lt;/del&gt;&lt;/a&gt; fixes first, and then I can re-visit this patch and update it and then the tests will pass. In the meantime, if you take this patch for testing, be aware that you will get a diff in the procedure test, as follows:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;Start: procedure jdk1.4.2_06 DerbyNetClient derbynetmats:derbynetmats 2006-01-13 12:55:45 ***&lt;br/&gt;
941 del&lt;br/&gt;
&amp;lt; JIRA-492 successful &amp;#8211; no hang!&lt;br/&gt;
941 add&lt;br/&gt;
&amp;gt; ERROR (no SQLState): only one of the VCM, VCS length can be greater than 0&lt;br/&gt;
&amp;gt; org.apache.derby.client.am.DisconnectException: only one of the VCM, VCS length can be greater than 0&lt;br/&gt;
Test Failed.&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12363145" author="kmarsden" created="Thu, 19 Jan 2006 04:31:27 +0000"  >
&lt;p&gt;The change looks good.  When you sync up,  it would be good to add some comments about the changes to the code and include a reference to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-491&quot; title=&quot;Protocol exception when Network Server tries to return ~32K of data or greater in a result set for a Java stored procedure.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-491&quot;&gt;&lt;del&gt;DERBY-491&lt;/del&gt;&lt;/a&gt; and the changes.html here.&lt;/p&gt;

&lt;p&gt;The changes.html wonderful and educational as always.      I have not really worked with this low  level protocol code much  so it is great to have such a great tutorial included with the patch. &lt;/p&gt;

&lt;p&gt;After reading and learning more about these issues. I really think your proposal to fill the buffer with a known value in sane builds or if derby.drda.debug=true  would be very valuable.  It would be interesting even to see how we do in the tests with this  turned on.&lt;/p&gt;</comment>
                            <comment id="12363905" author="bryanpendleton" created="Wed, 25 Jan 2006 09:44:23 +0000"  >&lt;p&gt;Updated patch, against latest trunk. I added a few additional comments to this patch to try to explain the changes more clearly, and also I added a reference to this bug entry to help the reader find more information. Now that &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-125&quot; title=&quot;Network Server can send DSS greater than 32K to client, which breaks DRDA protocol.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-125&quot;&gt;&lt;del&gt;DERBY-125&lt;/del&gt;&lt;/a&gt; has been committed (thanks!), the regression test passes cleanly, and I have also run the entire derbyall suite with this patch.&lt;/p&gt;

&lt;p&gt;I think that this patch proposal is now ready for review. Kathey, Army, other interested reviewers, please have a look and tell me what you think!&lt;/p&gt;</comment>
                            <comment id="12364117" author="bryanpendleton" created="Fri, 27 Jan 2006 04:06:15 +0000"  >&lt;p&gt;Updated the comments in the regression test to explain the test behavior more clearly and accurately, and to include a pointer to this bug entry for the interested reader to get more details.&lt;/p&gt;

&lt;p&gt;Bernt, if you have the time to look at this and commit it, that would be great!&lt;/p&gt;

&lt;p&gt;thanks,&lt;/p&gt;

&lt;p&gt;bryan&lt;/p&gt;</comment>
                            <comment id="12364124" author="army" created="Fri, 27 Jan 2006 04:41:42 +0000"  >&lt;p&gt;For those wondering, Bryan&apos;s latest patch addreses comments I made here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://article.gmane.org/gmane.comp.apache.db.derby.devel/12818&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://article.gmane.org/gmane.comp.apache.db.derby.devel/12818&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks as always for the phenomenal explanations in the latest version of changes.html.  The new comments in the tests look good to me, and I have no other issues with the patch.&lt;/p&gt;

&lt;p&gt;This is great work...&lt;br/&gt;
+1 to commit.&lt;/p&gt;</comment>
                            <comment id="12364217" author="bernt" created="Sat, 28 Jan 2006 00:12:44 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="12373867" author="bryanpendleton" created="Tue, 11 Apr 2006 00:31:14 +0100"  >&lt;p&gt;Set fix version to 10.2.0.0. This bug was fixed in the trunk in January.&lt;/p&gt;</comment>
                            <comment id="12376946" author="bryanpendleton" created="Fri, 28 Apr 2006 22:17:59 +0100"  >&lt;p&gt;Re-opened to merge this fix to the 10.1 branch.&lt;/p&gt;</comment>
                            <comment id="12377066" author="bryanpendleton" created="Sat, 29 Apr 2006 13:43:13 +0100"  >&lt;p&gt;Merged the change from the trunk back to the 10.1 branch. The merge was straightforward. I verified that I could still reproduce the bug in 10.1, that the test demonstrated the bug, and that the code change fixed it.&lt;/p&gt;

&lt;p&gt;Committed to subversion as revision 398093:&lt;br/&gt;
svn.apache.org/viewcvs?rev=398093&amp;amp;view=rev&lt;/p&gt;</comment>
                            <comment id="12412994" author="army" created="Wed, 24 May 2006 04:59:53 +0100"  >&lt;p&gt;Issue has been fixed, tested, and ported back to 10.1, so I&apos;m now marking it as closed.  Thanks Bryan!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12322388" name="changes.html" size="21945" author="bryanpendleton" created="Fri, 27 Jan 2006 04:04:51 +0000"/>
                            <attachment id="12311556" name="storedProcs.java" size="13352" author="army" created="Fri, 5 Aug 2005 04:59:31 +0100"/>
                            <attachment id="12311557" name="stored_proc_repro.java" size="3785" author="army" created="Fri, 5 Aug 2005 04:59:31 +0100"/>
                            <attachment id="12321947" name="svn_Jan_13_2006.status" size="550" author="bryanpendleton" created="Sat, 14 Jan 2006 07:07:26 +0000"/>
                            <attachment id="12321948" name="svn_Jan_13_3006.diff" size="13724" author="bryanpendleton" created="Sat, 14 Jan 2006 07:07:26 +0000"/>
                            <attachment id="12322327" name="svn_jan_24_2006.diff" size="16106" author="bryanpendleton" created="Wed, 25 Jan 2006 09:44:23 +0000"/>
                            <attachment id="12322389" name="svn_jan_26_2006.diff" size="16446" author="bryanpendleton" created="Fri, 27 Jan 2006 04:06:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 9 Dec 2005 04:33:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29576</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy16dj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40683</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>