<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:20:12 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-147/DERBY-147.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-147] ERROR 42X79 not consistant ? - same column name specified twice</title>
                <link>https://issues.apache.org/jira/browse/DERBY-147</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;This happens from JDBC or ij. Here the output form ij&amp;gt;&lt;/p&gt;

&lt;p&gt;ij version 10.0 &lt;br/&gt;
CONNECTION0* - 	jdbc:derby:phsDB &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;= current connection&lt;br/&gt;
ij&amp;gt; select a1.XXX_foreign, a1.native, a1.kind, a1.XXX_foreign FROM slg_name_lookup a1 ORDER BY a1.XXX_foreign;&lt;br/&gt;
ERROR 42X79: Column name &apos;XXX_FOREIGN&apos; appears more than once in the result of the query expression. &lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;But when removing the ORDER BY and keeping the 2 same column names it works&lt;/p&gt;

&lt;p&gt;ij&amp;gt; select a1.XXX_foreign, a1.native, a1.kind, a1.XXX_foreign FROM slg_name_lookup a1;&lt;br/&gt;
XXX_FOREIGN                                                                     |NATIVE                                                                          |KIND                                    |XXX_FOREIGN                                                                      -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  &lt;br/&gt;
0 rows selected &lt;br/&gt;
ij&amp;gt; &lt;/p&gt;


&lt;p&gt;So - it seams to be OK to specify the same column twice - as long as you do not add the ORDER BY clause.  &lt;/p&gt;

&lt;p&gt;I woul dof course like that the system allows this - but at leats it should be consistant and either allow both or none of the two queries above.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="30160">DERBY-147</key>
            <summary>ERROR 42X79 not consistant ? - same column name specified twice</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="bruehlicke">Bernd Ruehlicke</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Feb 2005 06:28:16 +0000</created>
                <updated>Mon, 5 Jul 2010 18:12:14 +0100</updated>
                            <resolved>Tue, 19 Sep 2006 16:14:39 +0100</resolved>
                                                    <fixVersion>10.2.2.1</fixVersion>
                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="59231" author="rp0428" created="Wed, 16 Feb 2005 08:16:41 +0000"  >&lt;p&gt;I tested a similar query on Oracle9i rel 2 and Oracle accepts this syntax and returns an ordered result set.&lt;/p&gt;</comment>
                            <comment id="59278" author="bandaram" created="Thu, 17 Feb 2005 05:20:39 +0000"  >&lt;p&gt;I think the query should work too. Fix might be just to remove the error raising code in ResultColumnList.java in routine getOrderByColumn(). Note there are two versions of the function and both could use the same change.&lt;/p&gt;</comment>
                            <comment id="59875" author="bruehlicke" created="Tue, 1 Mar 2005 03:57:28 +0000"  >&lt;p&gt;Ok I made the changes and build Derby - and tested it - seams to work.&lt;/p&gt;

&lt;p&gt;We may consider to make this change permanent. &lt;/p&gt;

&lt;p&gt;Any reason for this error log was added ?&lt;/p&gt;

&lt;p&gt;Here the code snipled (need to chnage getOrderBy(String, String) and getOrderBy(String, String, int)&lt;/p&gt;

&lt;p&gt;...&lt;br/&gt;
			if (columnName.equals( resultColumn.getName()) )&lt;br/&gt;
			{&lt;br/&gt;
				if (retVal == null)&lt;/p&gt;
				{
					retVal = resultColumn;
				}
&lt;p&gt;//	&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-147&quot; title=&quot;ERROR 42X79 not consistant ? - same column name specified twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-147&quot;&gt;&lt;del&gt;DERBY-147&lt;/del&gt;&lt;/a&gt;				else if (index &amp;lt; size - orderBySelect)&lt;br/&gt;
//	&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-147&quot; title=&quot;ERROR 42X79 not consistant ? - same column name specified twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-147&quot;&gt;&lt;del&gt;DERBY-147&lt;/del&gt;&lt;/a&gt;				&lt;/p&gt;
{
//	DERBY-147					throw StandardException.newException(SQLState.LANG_DUPLICATE_COLUMN_FOR_ORDER_BY, columnName);
//	DERBY-147				}
&lt;p&gt;				else&lt;/p&gt;
				{// remove the column due to pullup of orderby item
					removeElement(resultColumn);
					decOrderBySelect();
					break;
				}
&lt;p&gt;			}&lt;br/&gt;
...&lt;/p&gt;


&lt;p&gt;By the way - if already at the code - and since the code is more or less the same  would be handy to refactor the getOrderBy(String, String) to &lt;/p&gt;

&lt;p&gt;getOrderBy(String, String)&lt;/p&gt;
{
   return getOrderBy(String, String, null);
}

&lt;p&gt;and handle &quot;null&quot; in the String, String, int method.&lt;/p&gt;


&lt;p&gt;B-)&lt;/p&gt;</comment>
                            <comment id="59923" author="bandaram" created="Tue, 1 Mar 2005 10:22:15 +0000"  >&lt;p&gt;Since you have already made some changes, would it be possible to submit this as a patch? Would also require adding couple of test cases.&lt;/p&gt;

&lt;p&gt;Let me know if for any reason you are not able to make the patch. May be I can help in that case.&lt;/p&gt;</comment>
                            <comment id="59963" author="bruehlicke" created="Wed, 2 Mar 2005 03:01:14 +0000"  >&lt;p&gt;I would like to make that patch. Give me some time to figure out the procedures how to submit such patch. Also I will need to make soem JUnit tests to see if this is actually working in all cases.&lt;/p&gt;

&lt;p&gt;B-)&lt;/p&gt;</comment>
                            <comment id="59964" author="bruehlicke" created="Wed, 2 Mar 2005 03:10:00 +0000"  >&lt;p&gt;...ehhh ... got a little lost here. Need some info of procedures of &quot;submitting to the trunk&quot;&lt;/p&gt;

&lt;p&gt;Shall I just use svn to submit ? and how ?&lt;/p&gt;

&lt;p&gt;Any example of how file  xyz.java  is submitted ?&lt;/p&gt;

&lt;p&gt;Sorry - but if I get around those trivial CM issues I can start committing stuff ..&lt;/p&gt;

&lt;p&gt;B-)&lt;/p&gt;</comment>
                            <comment id="61483" author="diljeet dhillon" created="Thu, 24 Mar 2005 21:24:14 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
Have we established whether a possible patch/fix will be provided for this issue. and what the possible timescales may be?&lt;/p&gt;


</comment>
                            <comment id="61494" author="bruehlicke" created="Fri, 25 Mar 2005 00:50:55 +0000"  >&lt;p&gt;I fixed it as Satheesh suggested. I have tested it in our location and it seams to work. &lt;br/&gt;
I have not have time to&lt;/p&gt;

&lt;p&gt;1) Write Tests&lt;br/&gt;
2) Figure out how to check it into the trunk &lt;/p&gt;

&lt;p&gt;I would like to work on this asap - it would help with just a few &quot;dummy&quot; steps how and from where to check out the file, check it back in. And where teh JUnit tests should be checked into.&lt;/p&gt;

&lt;p&gt;Bernd &lt;/p&gt;</comment>
                            <comment id="61505" author="bandaram" created="Fri, 25 Mar 2005 02:33:27 +0000"  >&lt;p&gt;Derby uses its own test harness and new tests need to be added with in that framework. Believe Shreyas has provided some pointers. If you need any additional help, or would like me to add the tests for you, I am willing to help.&lt;/p&gt;</comment>
                            <comment id="61512" author="bruehlicke" created="Fri, 25 Mar 2005 04:36:21 +0000"  >&lt;p&gt;&quot;Shreyas has provided some pointers&quot; .. - ehhh - where do I find them ?  Really - it&apos;s just to get started. So a a little example of how to checkout a file and check it back would do it.&lt;/p&gt;

&lt;p&gt;Thanx&lt;br/&gt;
Bernd&lt;/p&gt;</comment>
                            <comment id="61514" author="bruehlicke" created="Fri, 25 Mar 2005 05:47:42 +0000"  >&lt;p&gt;OK - found&lt;br/&gt;
&lt;a href=&quot;http://incubator.apache.org/derby/derby_comm.html#Contribute+Code+or+Documentation&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://incubator.apache.org/derby/derby_comm.html#Contribute+Code+or+Documentation&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;That should do it.&lt;/p&gt;
</comment>
                            <comment id="61529" author="bruehlicke" created="Fri, 25 Mar 2005 08:18:47 +0000"  >&lt;p&gt;Fixes made from TRUNK revision 158945 (Not for 10.0.2.1 release !!) Fixes applied to java/engine/org/apache/derby/impl/sql/compile/ResultColumnList.java&lt;/p&gt;

&lt;p&gt;ALL test have been run (derbyall) successfull after this.&lt;/p&gt;

&lt;p&gt;No new tests have been added to the harness - Satheesh I hope you can teach me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; - I.e. in case you add a test - tell me which and where so I can see howto.&lt;/p&gt;

&lt;p&gt;Else I have not understood how to submit a patch to the trunk - I tried different options with svn but do not understand - would be nice with a workflow &lt;/p&gt;

&lt;p&gt;1) How to check out a file - I got that&lt;br/&gt;
2) How to change a file - I got that&lt;br/&gt;
3) How to commit it back to the trunk - No idea how - or do you need to be &quot;committer&quot; for that ?&lt;/p&gt;
</comment>
                            <comment id="61531" author="bruehlicke" created="Fri, 25 Mar 2005 08:24:18 +0000"  >&lt;p&gt;Same fix as applied for the version checked out of the TRUNK, but this is from the 10.0 release branch&lt;/p&gt;</comment>
                            <comment id="61646" author="bruehlicke" created="Tue, 29 Mar 2005 03:54:33 +0100"  >&lt;p&gt;So - how do I make sure this stuff makes it into the 10.1 release ?&lt;/p&gt;</comment>
                            <comment id="12422456" author="bruehlicke" created="Thu, 20 Jul 2006 18:42:43 +0100"  >&lt;p&gt;Is thois one planned to go into 10.2.0.0 ?&lt;/p&gt;

&lt;p&gt;I attached the fix and it&apos;s really just merge it into the system&lt;/p&gt;

&lt;p&gt;Thanx&lt;br/&gt;
Bernd&lt;/p&gt;</comment>
                            <comment id="12422627" author="knutanders" created="Fri, 21 Jul 2006 13:35:36 +0100"  >&lt;p&gt;Hi Bernd,&lt;/p&gt;

&lt;p&gt;Thank you for providing the patch. I&apos;m sorry no one has picked it up&lt;br/&gt;
yet. I had a brief look at it, and I have a couple of comments:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Most of the changes in the patch are white-space changes. This makes&lt;br/&gt;
   it harder for reviewers to understand what parts of the code have&lt;br/&gt;
   actually been changed. If you submit a patch that only contains the&lt;br/&gt;
   actual changes needed to fix the bug, it is much more likely that&lt;br/&gt;
   someone will review it and eventually commit it.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;With your changes, the javadoc comment for getOrderByColumn()&lt;br/&gt;
   becomes outdated. It says &quot;ensure that there is only one match&quot; and&lt;br/&gt;
   &quot;@exception StandardException thrown on duplicate&quot;. It would be&lt;br/&gt;
   good to fix this as well.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;By removing the else-if clause, the code in the else clause is&lt;br/&gt;
   executed instead when you have a duplicate column. This means that&lt;br/&gt;
   duplicate columns are removed from the result list, which is not&lt;br/&gt;
   correct. I believe a correct fix would have to check that index is&lt;br/&gt;
   greater than or equal to (size - orderBySelect) before it calls&lt;br/&gt;
   removeElement() and decOrderBySelect(). The example below&lt;br/&gt;
   illustrates the problem:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ij&amp;gt; create table t (col1 int, col2 varchar(10));&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t values (1, &apos;one&apos;), (2, &apos;two&apos;), (3, &apos;three&apos;);&lt;br/&gt;
3 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; select col1, col2, col1 from t order by col1;&lt;br/&gt;
COL1       |COL2      &lt;br/&gt;
----------------------&lt;br/&gt;
1          |one       &lt;br/&gt;
2          |two       &lt;br/&gt;
3          |three     &lt;/p&gt;

&lt;p&gt;3 rows selected&lt;/p&gt;

&lt;p&gt;   COL1 should have occurred twice in the result.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;It would be really great if the patch had a regression test. It&lt;br/&gt;
   doesn&apos;t have to be more sophisticated than the query above. It&apos;s as&lt;br/&gt;
   simple as adding the query to&lt;br/&gt;
   java/testing/org/apache/derbyTesting/functionTests/tests/lang/orderby.sql&lt;br/&gt;
   and updating the master&lt;br/&gt;
   java/testing/org/apache/derbyTesting/functionTests/master/orderby.out&lt;br/&gt;
   with the expected results.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;The error message that was removed, is not used anywhere else in&lt;br/&gt;
   the code. Therefore, LANG_DUPLICATE_COLUMN_FOR_ORDER_BY could be&lt;br/&gt;
   removed from SQLState.java, and the corresponding error message&lt;br/&gt;
   could be removed from&lt;br/&gt;
   java/engine/org/apache/derby/loc/messages_en.properties.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thanks,&lt;br/&gt;
Knut Anders&lt;/p&gt;</comment>
                            <comment id="12422647" author="kmarsden" created="Fri, 21 Jul 2006 14:54:34 +0100"  >&lt;p&gt;Hi  Bernd,&lt;/p&gt;

&lt;p&gt;When you resubmit your patch,  please &lt;br/&gt;
1) Assign yourself&lt;br/&gt;
2) Mark the patch available checkbox.  (which probably didn&apos;t exist when you originally submitted your patch)&lt;br/&gt;
3)  Ping the list if you don&apos;t get a response after a week.&lt;/p&gt;

&lt;p&gt;I thought we were doing bad with a 3 and 4 month turnaround  on independent contributor patches but at &lt;b&gt;16 months&lt;/b&gt;, this one certainly takes the prize.&lt;br/&gt;
There has been discussion about mailing the patch list to the developer list and being more attentive to patches and hopefully we will get that under control, but  meanwhile there is a lot you can do streamline your  own patch and drive it to commit.  Please take a look at:&lt;br/&gt;
&lt;a href=&quot;http://wiki.apache.org/db-derby/PatchAdvice&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/PatchAdvice&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks for all your patience.&lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;</comment>
                            <comment id="12422715" author="bruehlicke" created="Fri, 21 Jul 2006 18:09:49 +0100"  >&lt;p&gt;Thanx a lot !!  I have to admit I did not watch this myselfe for a while &lt;span class=&quot;error&quot;&gt;&amp;#91;I was happy with my fix until I wanted to update Derby&amp;#93;&lt;/span&gt; - so my mistake.&lt;/p&gt;

&lt;p&gt;Thanx for the feedback Knut, you are 100% correct. Let me play with this for a while and see If I can make this happen. &lt;/p&gt;

&lt;p&gt;Kathey - thanx for the link to the PatchAdvice - I was looking for something like that.&lt;/p&gt;

&lt;p&gt;I have checked out the 10.1 branch and will work on that.&lt;/p&gt;

&lt;p&gt;Bernd&lt;/p&gt;</comment>
                            <comment id="12422745" author="bruehlicke" created="Fri, 21 Jul 2006 20:02:15 +0100"  >&lt;p&gt;Simple question:&lt;/p&gt;

&lt;p&gt;Is most of the source checked in from Linux /Unix ? It seems to me when I checout the code it gets reformatted.&lt;/p&gt;

&lt;p&gt;Here how part of the code of ./engine/org/apache/derby/impl/sql/compile/ResultColumnList.java  looks like just after checkout (not touched by my IDE yet)&lt;/p&gt;

&lt;p&gt;Any special standart who files are suppose to be checked in ? Aka Windows Ascii format or Unix  ?&lt;/p&gt;



&lt;p&gt;	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;For order by, get a ResultColumn that matches the specified&lt;/li&gt;
	&lt;li&gt;columnName and ensure that there is only one match before the bind process.&lt;br/&gt;
	 *&lt;/li&gt;
	&lt;li&gt;@param columnName	The ResultColumn to get from the list&lt;/li&gt;
	&lt;li&gt;@param tableName	The table name on the OrderByColumn, if any&lt;br/&gt;
	 *&lt;/li&gt;
	&lt;li&gt;@return	the column that matches that name.&lt;/li&gt;
	&lt;li&gt;@exception StandardException thrown on duplicate&lt;br/&gt;
	 */&lt;br/&gt;
	public ResultColumn getOrderByColumn(String columnName, TableName tableName)&lt;br/&gt;
		throws StandardException&lt;br/&gt;
	{&lt;br/&gt;
		int				size = size();&lt;br/&gt;
		ResultColumn	retVal = null, resultColumn;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;		for (int index = 0; index &amp;lt; size; index++)&lt;br/&gt;
		{&lt;br/&gt;
			resultColumn = (ResultColumn) elementAt(index);&lt;/p&gt;

&lt;p&gt;			// We may be checking on &quot;ORDER BY T.A&quot; against &quot;SELECT *&quot;.&lt;br/&gt;
			// exposedName will not be null and &quot;*&quot; will not have an expression&lt;br/&gt;
			// or tablename.&lt;br/&gt;
			// We may be checking on &quot;ORDER BY T.A&quot; against &quot;SELECT T.B, T.A&quot;.&lt;br/&gt;
			if (tableName != null)&lt;br/&gt;
			{&lt;br/&gt;
				ValueNode rcExpr = resultColumn.getExpression();&lt;br/&gt;
				if (rcExpr == null || ! (rcExpr instanceof ColumnReference))&lt;/p&gt;
                {
                    continue;
                }
&lt;p&gt;				ColumnReference cr = (ColumnReference) rcExpr;&lt;br/&gt;
                if( ! tableName.equals( cr.getTableNameNode()))&lt;br/&gt;
                    continue;&lt;br/&gt;
			}&lt;/p&gt;

&lt;p&gt;			/* We finally got past the qualifiers, now see if the column&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;names are equal.&lt;br/&gt;
			 */&lt;/li&gt;
&lt;/ul&gt;


</comment>
                            <comment id="12422749" author="bandaram" created="Fri, 21 Jul 2006 20:07:52 +0100"  >&lt;p&gt;Last time this patch was reviewed, there was also another concern about truely ambigious columns, like:&lt;/p&gt;

&lt;p&gt;Select a+b as x, c+d as x from T order by x&lt;/p&gt;

&lt;p&gt;This query should probably raise an error as X in ORDER BY clause is truely ambigious. To make this work, resolution process needs to find out if two different references to X actually correspond to same expression (or column) so that following is allowed:&lt;/p&gt;

&lt;p&gt;select a as x, a as x from T order by x&lt;br/&gt;
select a, a from T order by a&lt;/p&gt;</comment>
                            <comment id="12422761" author="bruehlicke" created="Fri, 21 Jul 2006 20:56:36 +0100"  >&lt;p&gt;OK got it perfectly working now. &lt;/p&gt;

&lt;p&gt;I also refactored the getOrderByColumn(String, TableName) to call the getOrderByColumn(String, TableName, int) instead of double the code. (See code below)&lt;/p&gt;

&lt;p&gt;After I have figured out why the source is distorted when I check it out with svn I will apply the diff and make a patch. (That&apos;s I guess is why my fist patch had so many spaces ...)&lt;/p&gt;


&lt;p&gt;ij&amp;gt;  select col1, col2, col1 from t order by col1;&lt;br/&gt;
COL1       |COL2      |COL1&lt;br/&gt;
----------------------------------&lt;br/&gt;
1          |one       |1&lt;br/&gt;
2          |two       |2&lt;br/&gt;
3          |three     |3&lt;/p&gt;

&lt;p&gt;3 rows selected&lt;br/&gt;
ij&amp;gt;  select col1, col2, col1 from t order by col1, col2;&lt;br/&gt;
COL1       |COL2      |COL1&lt;br/&gt;
----------------------------------&lt;br/&gt;
1          |one       |1&lt;br/&gt;
2          |two       |2&lt;br/&gt;
3          |three     |3&lt;/p&gt;

&lt;p&gt;3 rows selected&lt;br/&gt;
ij&amp;gt;  select col1, col2, col1, col1, col1, col2, col2 from t order by col1;&lt;br/&gt;
COL1       |COL2      |COL1       |COL1       |COL1       |COL2      |COL2&lt;br/&gt;
--------------------------------------------------------------------------------&lt;br/&gt;
1          |one       |1          |1          |1          |one       |one&lt;br/&gt;
2          |two       |2          |2          |2          |two       |two&lt;br/&gt;
3          |three     |3          |3          |3          |three     |three&lt;/p&gt;

&lt;p&gt;3 rows selected&lt;/p&gt;



&lt;p&gt;Codechange in  ./engine/org/apache/derby/impl/sql/compile/ResultColumnList.java&lt;/p&gt;


&lt;p&gt;        /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;For order by, get a ResultColumn that matches the specified&lt;/li&gt;
	&lt;li&gt;columnName&lt;br/&gt;
         *&lt;/li&gt;
	&lt;li&gt;@param columnName	The ResultColumn to get from the list&lt;/li&gt;
	&lt;li&gt;@param tableName	The table name on the OrderByColumn, if any&lt;/li&gt;
	&lt;li&gt;@param tableNumber	The tableNumber corresponding to the FromTable with the&lt;/li&gt;
	&lt;li&gt;exposed name of tableName, if tableName != null.&lt;br/&gt;
         *&lt;/li&gt;
	&lt;li&gt;@return	the column that matches that name.&lt;br/&gt;
         */&lt;br/&gt;
        public ResultColumn getOrderByColumn(String columnName, TableName tableName, int tableNumber)&lt;br/&gt;
        throws StandardException&lt;br/&gt;
        {&lt;br/&gt;
            int size = size();&lt;br/&gt;
            ResultColumn retVal = null, resultColumn;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;            for (int index = 0; index &amp;lt; size; index++)&lt;br/&gt;
            {&lt;br/&gt;
                resultColumn = (ResultColumn) elementAt(index);&lt;/p&gt;

&lt;p&gt;                /* The order by column is qualified, then it is okay to consider&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;this RC if:&lt;/li&gt;
	&lt;li&gt;o  The RC is qualified and the qualifiers on the order by column&lt;/li&gt;
	&lt;li&gt;and the RC are equal().&lt;/li&gt;
	&lt;li&gt;o  The RC is not qualified, but its expression is a ColumnReference&lt;/li&gt;
	&lt;li&gt;from the same table (as determined by the tableNumbers).&lt;br/&gt;
                 */&lt;br/&gt;
                if (tableName != null)
                {
                    ValueNode rcExpr = resultColumn.getExpression();
                    if (rcExpr == null || !(rcExpr instanceof ColumnReference))
                        continue;
                    
                    ColumnReference cr = (ColumnReference) rcExpr;
                    if( (! tableName.equals( cr.getTableNameNode())) &amp;amp;&amp;amp; tableNumber != cr.getTableNumber())
                        continue;
                }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;                /* We finally got past the qualifiers, now see if the column&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;names are equal.&lt;br/&gt;
                 */&lt;br/&gt;
                if (columnName.equals( resultColumn.getName()) )
                &lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {                    if (retVal == null)                    {
                        retVal = resultColumn;
                    }                    else if (index &amp;gt;= size - orderBySelect)                    {// remove the column due to pullup of orderby item
                        removeElement(resultColumn);
                        decOrderBySelect();
                        break;
                    }                }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;            }&lt;br/&gt;
            return retVal;&lt;br/&gt;
        }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;For order by, get a ResultColumn that matches the specified&lt;/li&gt;
	&lt;li&gt;columnName&lt;br/&gt;
	 *&lt;/li&gt;
	&lt;li&gt;@param columnName	The ResultColumn to get from the list&lt;/li&gt;
	&lt;li&gt;@param tableName	The table name on the OrderByColumn, if any&lt;br/&gt;
	 *&lt;/li&gt;
	&lt;li&gt;@return	the column that matches that name.&lt;br/&gt;
	 */&lt;br/&gt;
	public ResultColumn getOrderByColumn(String columnName, TableName tableName)&lt;br/&gt;
		throws StandardException
	{
            return getOrderByColumn(columnName, tableName, -1);
	}&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12435108" author="bryanpendleton" created="Fri, 15 Sep 2006 21:24:11 +0100"  >&lt;p&gt;Hi Bernd,&lt;/p&gt;

&lt;p&gt;I am interested in this problem too, as it affects one of my applications.&lt;/p&gt;

&lt;p&gt;I would like to work with you to get your patch prepared and committed.&lt;/p&gt;

&lt;p&gt;What is the current status of the work you&apos;re doing on this problem?&lt;/p&gt;

&lt;p&gt;Does your current patch address the comments from the reviewers?&lt;/p&gt;</comment>
                            <comment id="12435170" author="bruehlicke" created="Sat, 16 Sep 2006 02:51:45 +0100"  >&lt;p&gt;Hi Bryan,&lt;/p&gt;

&lt;p&gt;I checked out 10.1.3.2 and applied the code changes in my latest comment above (NOT the original patch I have attached.) This code change solves the problem and adresses the very true concern from Knut (thanx again Knut), but not the problem mentioned by Satheesh. But still - better than it is currently ! I rebuild Derby and all works wonderful now.&lt;/p&gt;

&lt;p&gt;Honestly I got lost in the regression test and in the checkout of the code since it more or less distoreted the file and when I made a diff more or less all showed to be different.. Anyhow I tried to add some tests in orderby.sql and orderby.out but could not get it to work. Now I have a deadline and cannot use much time on this.&lt;/p&gt;

&lt;p&gt;I made some JUnit tests in my application using this and it seems to work pretty well. Note also I simplified the &quot;getOrderByColumn(String columnName, TableName tableName) &quot; method simply by calling the other,&lt;/p&gt;

&lt;p&gt;So - even if the example from Satheesh is a problem we could at least checkin the code changes above which will get most of us going and than add the situation mentioned by Satheesh as a new issue to be fixed in future releases.  &lt;/p&gt;

&lt;p&gt;Bernd&lt;/p&gt;</comment>
                            <comment id="12435172" author="bryanpendleton" created="Sat, 16 Sep 2006 03:09:07 +0100"  >&lt;p&gt;Hi Bernd,&lt;/p&gt;

&lt;p&gt;It is great to hear that you have been successful with this fix in your environment.&lt;/p&gt;

&lt;p&gt;Let me see if I can put together a regression test; I think I have enough information to do this,&lt;br/&gt;
and then I will combine the regression test with your code changes and we can see about&lt;br/&gt;
whether that gives us a suitable patch.&lt;/p&gt;

&lt;p&gt;I will also have a look at Satheesh&apos;s comment; perhaps it will be not too hard to incorporate&lt;br/&gt;
those suggestions.&lt;/p&gt;</comment>
                            <comment id="12435347" author="bryanpendleton" created="Sun, 17 Sep 2006 21:52:13 +0100"  >&lt;p&gt;Attached is &quot;patch_with_tests.diff&quot;, a patch proposal.&lt;/p&gt;

&lt;p&gt;I took the work that Bernd did, examined the comments from&lt;br/&gt;
the reviewers, and added a bunch of tests. During the testing,&lt;br/&gt;
I determined that Satheesh&apos;s comment was pretty important, and&lt;br/&gt;
that there were actually a number of important ambiguous cases&lt;br/&gt;
that we needed to catch. Happily, I discovered that there was already&lt;br/&gt;
a method on ResultColumn called &quot;isEquivalent&quot; which appears to&lt;br/&gt;
have just the right semantics for distinguishing between cases&lt;br/&gt;
where the same column has been selected multiple times, and&lt;br/&gt;
cases where completely different columns happen to have the same&lt;br/&gt;
column name in the result list.&lt;/p&gt;

&lt;p&gt;Note that since we still have to catch and reject ambiguous SELECT&lt;br/&gt;
statements, we aren&apos;t able to remove the error message and the&lt;br/&gt;
SQL state as Knut Anders had hoped we could.&lt;/p&gt;

&lt;p&gt;Additionally, I discovered that there were some fairly complicated cases&lt;br/&gt;
involving the difference between the &quot;exposed&quot; name of a table and the&lt;br/&gt;
base name of the table, which meant that it was problematic to merge&lt;br/&gt;
the various getOrderByColumn methods as had been proposed in some&lt;br/&gt;
of the earlier patch proposals. Therefore, I reverted to a smaller patch,&lt;br/&gt;
which doesn&apos;t combine the nearly-redundant versions of getOrderByColumn,&lt;br/&gt;
but which preserves the existing behavior in the case of table correlation names.&lt;/p&gt;

&lt;p&gt;It took me a while to figure out how &quot;orderBySelect&quot; processing worked, so&lt;br/&gt;
I added a comment about that.&lt;/p&gt;

&lt;p&gt;The end result is a patch proposal which changes just 4 lines of code; the&lt;br/&gt;
rest is comments and tests.&lt;/p&gt;

&lt;p&gt;derbyall runs clean, and I added as many new tests as I could think of, so&lt;br/&gt;
hopefully I&apos;ve covered the testing pretty well. Still, I would love to hear&lt;br/&gt;
suggestions from reviewers regarding additional tests that could be added.&lt;/p&gt;

&lt;p&gt;Please have a look at this patch and let us know your comments.&lt;/p&gt;</comment>
                            <comment id="12435861" author="bryanpendleton" created="Tue, 19 Sep 2006 16:14:39 +0100"  >&lt;p&gt;Committed patch_with_tests.diff to subversion as revision 447877.&lt;/p&gt;

&lt;p&gt;Bernd, if you get a chance, please let us know if this resolves&lt;br/&gt;
the problem in your environment.&lt;/p&gt;

&lt;p&gt;Thanks much to Knut Anders and Satheesh for the reviews and suggestions.&lt;/p&gt;</comment>
                            <comment id="12551269" author="fuzzylogic" created="Thu, 13 Dec 2007 09:04:38 +0000"  >&lt;p&gt;This issue has been resolved for over a year with no further movement. Closing.&lt;/p&gt;</comment>
                            <comment id="12589745" author="mikem" created="Wed, 16 Apr 2008 23:09:24 +0100"  >&lt;p&gt;Rick merged this into the 10.2 branch with change 448966, not sure what version of 10.2 that was, so just marking it fixed in latest unreleased version of 10.2.&lt;/p&gt;</comment>
                            <comment id="12589750" author="diljeet dhillon" created="Wed, 16 Apr 2008 23:14:22 +0100"  >&lt;p&gt;I will be out of the office on the 14/04/08, returning on the 17/04/08.&lt;br/&gt;
For any urgent issues, please contact one of my colleagues on ext 5355.&lt;/p&gt;

&lt;p&gt;I will however respond to your message when I return.&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;

&lt;p&gt;Diljeet Dhillon&lt;br/&gt;
The PCMS Group plc,&lt;br/&gt;
PCMS House&lt;br/&gt;
Torwood Close&lt;br/&gt;
Coventry&lt;br/&gt;
CV4 8HX&lt;/p&gt;

&lt;p&gt;Tel: +44 (0) 24 7669 4455&lt;br/&gt;
Fax: +44 (0) 24 7642 1390&lt;/p&gt;

&lt;p&gt;Email Address:  diljeet.dhillon@pcmsgroup.com&lt;br/&gt;
Corporate Website: - www.pcmsgroup.com&lt;/p&gt;

&lt;p&gt;The Architecture Team promoting PCMS Values&lt;br/&gt;
&lt;sub&gt;Integrity~Respect~Commitment~Continuous Improvement&lt;/sub&gt;&lt;/p&gt;

&lt;p&gt;The information contained in this e-mail is intended only for the person or entity to which it is addressed and may contain confidential and/or privileged material.  If you are not the intended recipient of this e-mail, the use of this information or any disclosure, copying or distribution is prohibited and may be unlawful.  If you received this in error, please contact the sender and delete the material from any computer.  The views expressed in this e-mail may not necessarily be the views of the PCMS Group plc and should not be taken as authority to carry out any instruction contained.   The PCMS Group reserves the right to monitor and examine the content of all e-mails.&lt;/p&gt;

&lt;p&gt;The PCMS Group plc is a company registered in England and Wales with company number 1459419 whose registered office is at PCMS House, Torwood Close, Westwood Business Park, Coventry CV4 8HX, United Kingdom. VAT No: GB 705338743&lt;/p&gt;


</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12350104">DERBY-1861</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="19370" name="derby-147-10.0.2.1.diff" size="22227" author="bruehlicke" created="Fri, 25 Mar 2005 08:24:18 +0000"/>
                            <attachment id="19369" name="derby-147.diff" size="22380" author="bruehlicke" created="Fri, 25 Mar 2005 08:18:47 +0000"/>
                            <attachment id="12341013" name="patch_with_tests.diff" size="14228" author="bryanpendleton" created="Sun, 17 Sep 2006 21:52:13 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 16 Feb 2005 08:16:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21797</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0pwv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38016</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>