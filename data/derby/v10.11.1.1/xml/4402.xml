<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:24:10 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4402/DERBY-4402.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4402] Assert failure (sane) or Array out of bounds error (insane) when attempting to GROUP BY accumulator function</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4402</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The error checking fails to catch this wrong usage (accumulator function inside a group by column expression.&lt;br/&gt;
:&lt;br/&gt;
select sum&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from t group by (4+sum(j))&lt;br/&gt;
:&lt;br/&gt;
java.sql.SQLException: Java exception: &apos;ASSERT FAILED Unexpected Aggregate vector generated by Group By clause: org.apache.derby.shared.common.sanity.AssertFailure&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)&lt;br/&gt;
	... 16 more&lt;br/&gt;
Caused by: org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED Unexpected Aggregate vector generated by Group By clause&lt;br/&gt;
	at org.apache.derby.shared.common.sanity.SanityManager.ASSERT(SanityManager.java:120)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.SelectNode.bindExpressions(SelectNode.java:648)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.DMLStatementNode.bindExpressions(DMLStatementNode.java:227)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.DMLStatementNode.bind(DMLStatementNode.java:140)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.CursorNode.bindStatement(CursorNode.java:249)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:319)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:88)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:824)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:606)&lt;br/&gt;
	... 9 more&lt;/p&gt;

&lt;p&gt;The parser has a check against the top node of a &quot;groupingColumnReference&quot; being an aggregator, but fails to &quot;see&quot; inside an expression.&lt;br/&gt;
Maybe this check should be made by a visitor in the bind phase instead.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12437664">DERBY-4402</key>
            <summary>Assert failure (sane) or Array out of bounds error (insane) when attempting to GROUP BY accumulator function</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mamtas">Mamta A. Satoor</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Oct 2009 01:01:57 +0100</created>
                <updated>Wed, 12 May 2010 00:15:00 +0100</updated>
                            <resolved>Tue, 11 May 2010 00:41:59 +0100</resolved>
                                    <version>10.5.3.0</version>
                    <version>10.6.1.0</version>
                                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12776751" author="mamtas" created="Wed, 11 Nov 2009 23:54:37 +0000"  >&lt;p&gt;I am looking into this. Will post my findings.&lt;/p&gt;</comment>
                            <comment id="12778671" author="mamtas" created="Tue, 17 Nov 2009 00:50:13 +0000"  >&lt;p&gt;Committed a fix into trunk with revision 881074. The problem was that we were looking directly at the group bu column to be an instance of aggregator and if so, we would throw an exception. This would catch group by (sum(j)) but it would not catch say group by (4+sum(j)). &lt;/p&gt;

&lt;p&gt;Will work on backporting to 10.5 in few days once I know nothing broke down on trunk. derbyall and junit suite ran fine on my codeline.&lt;/p&gt;</comment>
                            <comment id="12778848" author="knutanders" created="Tue, 17 Nov 2009 13:02:10 +0000"  >&lt;p&gt;The fix looks fine to me, but could the &quot;if (true)&quot; part be removed in the following statement?&lt;/p&gt;

&lt;p&gt;+		if (visitor.hasNode())&lt;br/&gt;
+		{&lt;br/&gt;
+			&lt;/p&gt;
{if (true) throw StandardException.newException(
+				SQLState.LANG_AGGREGATE_IN_GROUPBY_LIST);}
&lt;p&gt;+		}&lt;/p&gt;</comment>
                            <comment id="12779052" author="mamtas" created="Tue, 17 Nov 2009 19:11:18 +0000"  >&lt;p&gt;You are right, Knut, there is no need for that if true. I got rid of it with revision 881444. The test that I added ran fine with that change.&lt;/p&gt;</comment>
                            <comment id="12833918" author="mamtas" created="Mon, 15 Feb 2010 18:44:44 +0000"  >&lt;p&gt;Migrated the change into 10.5 codeline.&lt;/p&gt;</comment>
                            <comment id="12865976" author="dagw" created="Tue, 11 May 2010 00:28:02 +0100"  >&lt;p&gt;Can this be resolved?&lt;/p&gt;</comment>
                            <comment id="12866387" author="dagw" created="Wed, 12 May 2010 00:15:00 +0100"  >&lt;p&gt;Verified that error no longer occurs on trunk, closing. Thanks for fixing this, Mamta!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 11 Nov 2009 23:54:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24233</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0qcf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38086</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10053"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>