<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:17:30 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5045/DERBY-5045.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5045] Assert failures in UpdateStatisticsTest</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5045</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I saw these failures when running suites.All against revision 1070949 + the 1b patch attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-642&quot; title=&quot;SELECT MAX doesn&amp;#39;t use indices optimally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-642&quot;&gt;&lt;del&gt;DERBY-642&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;junit.framework.AssertionFailedError: Index statistics for &amp;lt;ALL TABLES&amp;gt;&lt;br/&gt;
1: &lt;/p&gt;
{tableId=94a458d3-012e-2a1f-d23d-ffff93077fa3, tableName=&amp;lt;n/a&amp;gt;, indexName=&amp;lt;n/a&amp;gt;, lcols=1, rows=160, unique/card=160, created=2011-02-15 17:31:00.951}
&lt;p&gt; expected:&amp;lt;0&amp;gt; but was:&amp;lt;1&amp;gt;&lt;br/&gt;
	at org.apache.derbyTesting.junit.IndexStatsUtil.assertStats(IndexStatsUtil.java:132)&lt;br/&gt;
	at org.apache.derbyTesting.junit.IndexStatsUtil.assertNoStats(IndexStatsUtil.java:109)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.UpdateStatisticsTest.testUpdateStatistics(UpdateStatisticsTest.java:91)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:27)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:27)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;/p&gt;


&lt;p&gt;junit.framework.AssertionFailedError: Index statistics for &amp;lt;ALL TABLES&amp;gt;&lt;br/&gt;
1: &lt;/p&gt;
{tableId=94a458d3-012e-2a1f-d23d-ffff93077fa3, tableName=&amp;lt;n/a&amp;gt;, indexName=&amp;lt;n/a&amp;gt;, lcols=1, rows=160, unique/card=160, created=2011-02-15 17:31:00.951}
&lt;p&gt; expected:&amp;lt;0&amp;gt; but was:&amp;lt;1&amp;gt;&lt;br/&gt;
	at org.apache.derbyTesting.junit.IndexStatsUtil.assertStats(IndexStatsUtil.java:132)&lt;br/&gt;
	at org.apache.derbyTesting.junit.IndexStatsUtil.assertNoStats(IndexStatsUtil.java:109)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.UpdateStatisticsTest.testUpdateStatistics(UpdateStatisticsTest.java:91)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:27)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:27)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:27)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:27)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12498732">DERBY-5045</key>
            <summary>Assert failures in UpdateStatisticsTest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                            <label>derby_backport_reject_10_5</label>
                    </labels>
                <created>Wed, 16 Feb 2011 09:03:56 +0000</created>
                <updated>Mon, 17 Jun 2013 10:27:19 +0100</updated>
                            <resolved>Thu, 13 Sep 2012 00:20:04 +0100</resolved>
                                    <version>10.8.1.2</version>
                                    <fixVersion>10.8.1.2</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12996594" author="rhillegas" created="Fri, 18 Feb 2011 21:00:54 +0000"  >&lt;p&gt;I have not been able to reproduce this error on my Mac. I have set up a codeline which is revision 1070949 + the 1b patch attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-642&quot; title=&quot;SELECT MAX doesn&amp;#39;t use indices optimally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-642&quot;&gt;&lt;del&gt;DERBY-642&lt;/del&gt;&lt;/a&gt; and built both sane and insane jars. I have run UpdateStatisticsTest standalone 20 times against each set of jars. I have also run the lang _Suite against both sets of jars. Finally, I have run the full JUnit suite against both sets of jars. But I have been able to reproduce this problem.&lt;/p&gt;</comment>
                            <comment id="12996830" author="kristwaa" created="Sat, 19 Feb 2011 18:29:38 +0000"  >&lt;p&gt;Happened again in the nightly run for 2011-02-18 18:00:25 MET:&lt;br/&gt;
&lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.6/testing/testlog/vista/1072063-suitesAll_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.6/testing/testlog/vista/1072063-suitesAll_diff.txt&lt;/a&gt;&lt;br/&gt;
(overview of all runs this day at &lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.6/testing/Limited/testSummary-1072063.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.6/testing/Limited/testSummary-1072063.html&lt;/a&gt;)&lt;br/&gt;
Note that the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-642&quot; title=&quot;SELECT MAX doesn&amp;#39;t use indices optimally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-642&quot;&gt;&lt;del&gt;DERBY-642&lt;/del&gt;&lt;/a&gt; has been committed now.&lt;br/&gt;
Note also that the automatic statistics update feature is supposed to be disabled for this test.&lt;/p&gt;

&lt;p&gt;I don&apos;t know why there is no table/index name in the stats debug printout. But maybe someone knows which table has 160 rows &lt;span class=&quot;error&quot;&gt;&amp;#91;at some point in time&amp;#93;&lt;/span&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The test is checking for statistics for all tables, one step forward would be to figure out if the stats are actually for a table in the failing test, or if it is a left-over from another test.&lt;br/&gt;
If the stats belong to an unrelated table, we could use a clean database for the UpdateStatisticsTest, or query for the relevant tables only. The failure seems to be timing sensitive.&lt;/p&gt;</comment>
                            <comment id="13001554" author="rhillegas" created="Wed, 2 Mar 2011 19:07:13 +0000"  >&lt;p&gt;In a side conversation with Knut (which I am now bringing back to the community) it seemed that this test failure is evidence for a pre-existing bug in the cleanup after DROP TABLE. When a table is dropped, its dependent objects (like rows in SYSSTATISTICS) should be dropped too. The relationships between catalogs are not enforced by foreign keys. That is because the DataDictionary lives beneath the SQL layer. It is expected that the dependencies between catalogs will be handled by the DataDictionary itself. It seems that there may be a bug in the logic which keeps SYSTABLES and SYSSTATISTICS in sync. The UpdateStatisticsTest appears to trigger this bug occasionally.&lt;/p&gt;</comment>
                            <comment id="13005636" author="knutanders" created="Fri, 11 Mar 2011 13:49:29 +0000"  >&lt;p&gt;I performed an experiment to see if we could get these orphaned entries in SYSSTATISTICS if a table was dropped just as istat was about to write the statistics. The experiment is described in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5124&quot; title=&quot;NPE or assert failure printed when dropping table while statistics are written out&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5124&quot;&gt;&lt;del&gt;DERBY-5124&lt;/del&gt;&lt;/a&gt;, and resulted in a NullPointerException in the istat thread. However, if I comment out the log statement that causes the NPE and repeat the experiment, I do end up with a row in SYSSTATISTICTS describing an index that no longer exists. I don&apos;t see how this could happen without triggering the NPE, though. And the NPE causes the update in SYSSTATISTICS to be rolled back, so then we shouldn&apos;t see this problem.&lt;/p&gt;</comment>
                            <comment id="13005638" author="knutanders" created="Fri, 11 Mar 2011 13:56:13 +0000"  >&lt;p&gt;The log statement that caused the NPE was added in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5089&quot; title=&quot;Improve tracing/logging of runtime exceptions raised in the istat thread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5089&quot;&gt;&lt;del&gt;DERBY-5089&lt;/del&gt;&lt;/a&gt;, and I cannot find any occurrence of this test failure after &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5089&quot; title=&quot;Improve tracing/logging of runtime exceptions raised in the istat thread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5089&quot;&gt;&lt;del&gt;DERBY-5089&lt;/del&gt;&lt;/a&gt; was resolved. So it sounds likely that this issue is indeed caused by istat writing to SYSSTATISTICS after the index has been dropped, and thereby leaving an orphaned row. But right now the issue is hidden by the NPE in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5124&quot; title=&quot;NPE or assert failure printed when dropping table while statistics are written out&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5124&quot;&gt;&lt;del&gt;DERBY-5124&lt;/del&gt;&lt;/a&gt; (which is only printed, so it won&apos;t cause any test failures).&lt;/p&gt;</comment>
                            <comment id="13005664" author="knutanders" created="Fri, 11 Mar 2011 14:56:48 +0000"  >&lt;p&gt;I believe that the attached patch fixes the problem. Since the istat thread doesn&apos;t take any read locks, not even intention locks on the table, the index may be dropped by someone else until we start writing the stats to SYSSTATISTICS. Once we start writing to SYSSTATISTICS, the istat thread will have exclusive locks that prevent the table and its indexes from being dropped.&lt;/p&gt;

&lt;p&gt;The patch checks if the index still exists after it has written the new statistics to SYSSTATISTICS, but before it has committed the transaction. If the index doesn&apos;t exist, it aborts the transaction instead of committing it. When I run the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5124&quot; title=&quot;NPE or assert failure printed when dropping table while statistics are written out&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5124&quot;&gt;&lt;del&gt;DERBY-5124&lt;/del&gt;&lt;/a&gt; experiment with this patch, the orphaned rows don&apos;t turn up in SYSSTATISTICS.&lt;/p&gt;</comment>
                            <comment id="13006061" author="knutanders" created="Sat, 12 Mar 2011 16:48:22 +0000"  >&lt;p&gt;Committed revision 1080947.&lt;/p&gt;

&lt;p&gt;This should hopefully make the test failure go away. Resolving the issue on that assumption. Please reopen if the failure is still seen.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12501142">DERBY-5124</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12501142">DERBY-5124</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12501060">DERBY-5123</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12492660">DERBY-4939</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12473397" name="derby-5045-1a.diff" size="1333" author="knutanders" created="Fri, 11 Mar 2011 14:56:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 18 Feb 2011 21:00:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24616</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0a07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35439</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>