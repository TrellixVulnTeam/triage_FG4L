<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:09:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4388/DERBY-4388.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4388] NullPointerException in RIGHT JOIN with NOT BETWEEN</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4388</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;ij&amp;gt; create table t1(x int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; create table t2(x int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t2 values (1);&lt;br/&gt;
1 row inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; select * from t1 right join t2 on t1.x = t2.x where t1.x not between 0 and 4;&lt;br/&gt;
X          |X          &lt;br/&gt;
-----------------------&lt;br/&gt;
ERROR 38000: The exception &apos;java.lang.NullPointerException&apos; was thrown while evaluating an expression.&lt;br/&gt;
ERROR XJ001: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12436597">DERBY-4388</key>
            <summary>NullPointerException in RIGHT JOIN with NOT BETWEEN</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Sep 2009 14:07:29 +0100</created>
                <updated>Thu, 15 Oct 2009 10:47:00 +0100</updated>
                            <resolved>Thu, 15 Oct 2009 10:47:00 +0100</resolved>
                                    <version>10.0.2.1</version>
                    <version>10.1.3.1</version>
                    <version>10.2.2.0</version>
                    <version>10.3.3.0</version>
                    <version>10.4.2.0</version>
                    <version>10.5.3.0</version>
                    <version>10.6.1.0</version>
                                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12759520" author="knutanders" created="Fri, 25 Sep 2009 14:12:39 +0100"  >&lt;p&gt;The stack trace is similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4342&quot; title=&quot;SQLSTATE 38000 (NullPointerException) at inner self join and value(x1, x2...)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4342&quot;&gt;&lt;del&gt;DERBY-4342&lt;/del&gt;&lt;/a&gt;, but I&apos;m logging it as a separate issue since this query doesn&apos;t use VALUE or COALESCE. Also, &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4342&quot; title=&quot;SQLSTATE 38000 (NullPointerException) at inner self join and value(x1, x2...)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4342&quot;&gt;&lt;del&gt;DERBY-4342&lt;/del&gt;&lt;/a&gt; throws NPE during Statement.execute(), whereas the NPE in this issue is thrown during ResultSet.next().&lt;/p&gt;

&lt;p&gt;Here&apos;s the relevant part of the stack trace:&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.BaseActivation.getColumnFromRow(BaseActivation.java:1451)&lt;br/&gt;
	at org.apache.derby.exe.ac0b5b0099x0123xf14ex9cd1x000003c495d81.e4(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:147)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:268)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(BasicNoPutResultSetImpl.java:471)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:427)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedResultSet.next(EmbedResultSet.java:371)&lt;/p&gt;</comment>
                            <comment id="12762155" author="knutanders" created="Mon, 5 Oct 2009 12:38:40 +0100"  >&lt;p&gt;The query also fails if a left join is used:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; select * from t2 left join t1 on t1.x=t2.x where t1.x not between 0 and 4;&lt;br/&gt;
X          |X          &lt;br/&gt;
-----------------------&lt;br/&gt;
ERROR 38000: The exception &apos;java.lang.NullPointerException&apos; was thrown while evaluating an expression.&lt;br/&gt;
ERROR XJ001: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;/p&gt;</comment>
                            <comment id="12762184" author="knutanders" created="Mon, 5 Oct 2009 15:22:24 +0100"  >&lt;p&gt;BetweenOperatorNode.eliminateNots() rewrites T1.X NOT BETWEEN 0 AND 4 to T1.X &amp;lt; 0 OR T1.X &amp;gt; 4. I compared the optimized tree for a NOT BETWEEN query with a query manually rewritten to the equivalent less-than/greater-than form and saw that the structure of the column references was different.&lt;/p&gt;

&lt;p&gt;Looking at how other nodes implement eliminateNots(), I found that InListOperatorNode is similar to BetweenOperatorNode, except that it always clones the left operand if it is a ColumnReference. A comment told that the cloning was necessary because the reference could be remapped during optimization, and then the different nodes would need a separate instance. Changing BetweenOperatorNode to clone ColumnReferences appears to fix the NPE.&lt;/p&gt;</comment>
                            <comment id="12762189" author="knutanders" created="Mon, 5 Oct 2009 15:32:21 +0100"  >&lt;p&gt;Attaching a patch which changes BetweenOperatorNode.eliminateNots() to follow the same pattern as InListOperatorNode.eliminateNots() and adds a test case to InbetweenTest. No tests except InbetweenTest have been run yet, but I will start a full regression test run and report back.&lt;/p&gt;</comment>
                            <comment id="12762380" author="knutanders" created="Mon, 5 Oct 2009 22:21:04 +0100"  >&lt;p&gt;All the regression tests ran cleanly.&lt;/p&gt;</comment>
                            <comment id="12762441" author="dagw" created="Mon, 5 Oct 2009 23:58:53 +0100"  >&lt;p&gt;Thanks for this patch, Knut. I read the logic of InListOperatorNode.eliminateNots and that lead me to believe that only the&lt;br/&gt;
&lt;b&gt;second&lt;/b&gt; clone is necessary (the point being that the two &quot;new&quot; comparison operations not share the same column reference. I tried this&lt;br/&gt;
by substituting leftOperand for leftClone in the first comparison (leftO &amp;lt; rightOList.elementAt(0)), the test ran ok.&lt;br/&gt;
but it may be safer to clone both. Just thought I should mention it. &lt;br/&gt;
Without the patch, the test fails, withit it works, so an good improvement, I think.&lt;br/&gt;
+1&lt;/p&gt;</comment>
                            <comment id="12762546" author="knutanders" created="Tue, 6 Oct 2009 08:48:04 +0100"  >&lt;p&gt;Thanks for looking at the patch, Dag. I think you&apos;re right about the first clone not being necessary. I&apos;ve prepared a new patch (1b) which only clones the left operand in the second comparison. I&apos;m rerunning the regression tests and will commit if they pass.&lt;/p&gt;</comment>
                            <comment id="12762636" author="knutanders" created="Tue, 6 Oct 2009 15:20:00 +0100"  >&lt;p&gt;Committed revision 822289.&lt;/p&gt;

&lt;p&gt;I&apos;ll leave the issue open until the fix has been merged to 10.5.&lt;/p&gt;</comment>
                            <comment id="12765987" author="knutanders" created="Thu, 15 Oct 2009 10:44:33 +0100"  >&lt;p&gt;The regression test could not be merged to 10.5 because InbetweenTest does not exist on the 10.5 branch. derby-4388-10.5.diff contains the fix and adds a regression test case in the lang/inbetween.sql test, which is present in 10.5. The test case raises NPE without the fix.&lt;/p&gt;</comment>
                            <comment id="12765989" author="knutanders" created="Thu, 15 Oct 2009 10:47:00 +0100"  >&lt;p&gt;Committed to 10.5 with revision 825450.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12432434">DERBY-4342</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12421286" name="d4388-1a.diff" size="3308" author="knutanders" created="Mon, 5 Oct 2009 15:32:21 +0100"/>
                            <attachment id="12421287" name="d4388-1a.stat" size="168" author="knutanders" created="Mon, 5 Oct 2009 15:32:21 +0100"/>
                            <attachment id="12421395" name="d4388-1b.diff" size="2725" author="knutanders" created="Tue, 6 Oct 2009 08:48:04 +0100"/>
                            <attachment id="12422205" name="derby-4388-10.5.diff" size="3181" author="knutanders" created="Thu, 15 Oct 2009 10:44:33 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 5 Oct 2009 22:58:53 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24225</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0rpj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38307</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>