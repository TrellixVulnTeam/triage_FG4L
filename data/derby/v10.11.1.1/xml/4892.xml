<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:27:32 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4892/DERBY-4892.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4892] Unsafe use of BigDecimal constructors</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4892</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;We have some code that&apos;s supposed to work on Java 1.4, but that uses BigDecimal constructors that were not added until Java 5. The problematic constructors are the ones that take a single int or long.&lt;/p&gt;

&lt;p&gt;The constructors are used in the following classes:&lt;/p&gt;

&lt;p&gt;org.apache.derby.client.am.Cursor&lt;br/&gt;
org.apache.derbyTesting.functionTests.tests.lang.Price&lt;br/&gt;
org.apache.derbyTesting.system.oe.client.Submitter&lt;/p&gt;

&lt;p&gt;All of the classes are compiled against $&lt;/p&gt;
{java14compile.classpath}
&lt;p&gt;, so one would expect the build to fail when java14compile.classpath pointed to proper Java 1.4 libraries. However, there is a constructor with a double parameter in Java 1.4, and the compiler picks that constructor if it cannot find the ones for int and long. If that happens, the compiled byte-code works on Java 1.4 and newer, and everything is fine.&lt;/p&gt;

&lt;p&gt;The problem appears when the build does not use the Java 1.4 libraries. This can easily happen if you build without a customized ant.properties, and PropertySetter ends up building java14compile.classpath based on the auto-detected java15compile.classpath. In that case, the compiler finds the int and long variants of the constructor, even when building against java14compile.classpath. The compiled byte-code will therefore use those Java 5 constructors, and the code will fail at run-time if ever executed on a Java 1.4 JVM.&lt;/p&gt;

&lt;p&gt;To reproduce, build Derby without ant.properties on a system where PropertySetter doesn&apos;t find JDK 1.4. Verify with -DprintCompilerProperties=true that java14compile.classpath is built up of jar files from a Java 5 or Java 6 directory. Then run org.apache.derbyTesting.functionTests.tests.lang.UDTTest using a Java 1.4 JVM. You&apos;ll see two errors of this kind:&lt;/p&gt;

&lt;p&gt;1) test_06_casts(org.apache.derbyTesting.functionTests.tests.lang.UDTTest)java.lang.NoSuchMethodError: java.math.BigDecimal.&amp;lt;init&amp;gt;(I)V&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.Price.makePrice(Price.java:49)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.UDTTest.test_06_casts(UDTTest.java:501)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;/p&gt;

&lt;p&gt;The problem in client.am.Cursor can be seen if you follow the same procedure as above, and instead of UDTTest run ParameterMappingTest with the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4891&quot; title=&quot;Enable testing of boolean type in ParameterMappingTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4891&quot;&gt;&lt;del&gt;DERBY-4891&lt;/del&gt;&lt;/a&gt; that enables testing of booleans.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12479291">DERBY-4892</key>
            <summary>Unsafe use of BigDecimal constructors</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Sat, 6 Nov 2010 09:14:51 +0000</created>
                <updated>Mon, 29 Nov 2010 14:22:30 +0000</updated>
                            <resolved>Mon, 8 Nov 2010 08:03:10 +0000</resolved>
                                    <version>10.7.1.1</version>
                                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>JDBC</component>
                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12928945" author="knutanders" created="Sat, 6 Nov 2010 09:35:32 +0000"  >&lt;p&gt;The attached patch changes the use of the int/long constructors to calls to BigDecimal.valueOf(long). That method is available in Java 1.4 (and Foundation Profile 1.1). Its javadoc even says that it should be preferred to the int/long constructor (because it can reuse common values, which sounds like a good thing, in particular for the case in client.am.Cursor, where the value is always 0 or 1).&lt;/p&gt;

&lt;p&gt;The NoSuchMethodErrors in UDTTest and ParameterMappingTest went away with the patch.&lt;/p&gt;</comment>
                            <comment id="12928983" author="bryanpendleton" created="Sat, 6 Nov 2010 14:47:57 +0000"  >&lt;p&gt;It seems hard to believe that there is a substantial user-base for JDK 1.4 anymore,&lt;br/&gt;
but increased version portability is always a good thing.&lt;/p&gt;</comment>
                            <comment id="12929489" author="knutanders" created="Mon, 8 Nov 2010 08:03:10 +0000"  >&lt;p&gt;Committed revision 1032481.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12458989" name="valueof.diff" size="2411" author="knutanders" created="Sat, 6 Nov 2010 09:35:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 6 Nov 2010 14:47:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24513</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0olz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37805</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>