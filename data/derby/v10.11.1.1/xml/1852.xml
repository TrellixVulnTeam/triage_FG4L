<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:27:45 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1852/DERBY-1852.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1852] Wrong results: duplicate rows returned for nested UNIONs when they should be eliminated.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1852</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Regarding UNIONs, the Derby documentation says that if the &quot;ALL&quot; keyword is not specified, the default behavior is to remove duplicate rows from the result.   And for simple cases of UNIONs, that is indeed the case.  However, there are certain queries with nested UNIONs where Derby is supposed to remove duplicates from the result set, but does not.&lt;/p&gt;

&lt;p&gt;This is &lt;b&gt;NOT&lt;/b&gt; a regression.  I have been able to reproduce the behavior in early versions of 10.1.2 and also back to 10.0.2.2, which is the oldest client I have.&lt;/p&gt;

&lt;p&gt;To show the problem:&lt;/p&gt;

&lt;p&gt;create table t1 (i int, j int);&lt;br/&gt;
create table t2 (i int, j int);&lt;br/&gt;
insert into t1 values (1, 2), (2, 4), (3, 6), (4, 8), (5, 10);&lt;br/&gt;
insert into t2 values (1, 2), (2, -4), (3, 6), (4, -8), (5, 10);&lt;br/&gt;
insert into t2 values (3, 6), (4, 8), (3, -6), (4, -8);&lt;/p&gt;

&lt;p&gt;&amp;#8211; Following query correctly returns 13 rows; the first union&lt;br/&gt;
&amp;#8211; does not specify &quot;ALL&quot; and should therefore remove&lt;br/&gt;
&amp;#8211; duplicates.&lt;br/&gt;
select * from t1 union select * from t2 union all select * from t1;&lt;/p&gt;

&lt;p&gt;&amp;#8211; But if we do a join with the same query, we end up with&lt;br/&gt;
&amp;#8211; 19 rows instead of 13.  This is because the duplicate entries&lt;br/&gt;
&amp;#8211; are not correctly removed.&lt;br/&gt;
select * from t1 left outer join&lt;br/&gt;
  (select * from t1 union select * from t2 union all select * from t1) x2&lt;br/&gt;
on t1.i = x2.i;&lt;/p&gt;

&lt;p&gt;Just for sanity, I also ran these statements against DB2 and the result was of the last query was indeed 13 rows, not 19.  So I think this is a case where Derby is returning incorrect results.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12349956">DERBY-1852</key>
            <summary>Wrong results: duplicate rows returned for nested UNIONs when they should be eliminated.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="army">A B</assignee>
                                    <reporter username="army">A B</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Sep 2006 20:19:16 +0100</created>
                <updated>Tue, 30 Jun 2009 17:12:48 +0100</updated>
                            <resolved>Wed, 20 Jun 2007 02:34:43 +0100</resolved>
                                    <version>10.0.2.0</version>
                    <version>10.0.2.1</version>
                    <version>10.1.1.0</version>
                    <version>10.1.2.1</version>
                    <version>10.1.3.1</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12434781" author="army" created="Thu, 14 Sep 2006 20:22:56 +0100"  >&lt;p&gt;Attaching a quick patch to fix this issue.  I stumbled across this problem while investigating &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1777&quot; title=&quot;Regression: query works in 10.1.2.1 but fails with NullPointerException in 10.2.1.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1777&quot;&gt;&lt;del&gt;DERBY-1777&lt;/del&gt;&lt;/a&gt; and so I was able to tell what the issue is and how to fix it.  The attached patch fixes the problem and should be correct code-wise, but I haven&apos;t added any comments nor explanations, nor have I run derbyall yet.  So this is NOT to be committed.&lt;/p&gt;

&lt;p&gt;But since I&apos;m not sure how high this is on my priority list, I figured I&apos;d post the patch and if anyone else wants to finalize it by adding comments/explanations and a test case (could just take the one from the description), feel free!&lt;/p&gt;</comment>
                            <comment id="12484237" author="army" created="Mon, 26 Mar 2007 22:40:46 +0100"  >&lt;p&gt;Attaching d1852_engine_v1.patch, which has the same code changes as the original &quot;quick&quot; patch except that I&apos;ve added explanatory comments to the relevant files and I&apos;ve run both derbyall and suites.All with the changes (Red Hat Linux, ibm142) with no failures.&lt;/p&gt;

&lt;p&gt;I&apos;m also attaching d1852_tests_v1.patch, which contains two things:&lt;/p&gt;

&lt;p&gt;  1. Some new test cases added to lang/union.sql, along with the corresponding master update.&lt;/p&gt;

&lt;p&gt;  2. Master update for lang/predicatePushdown.out.  This turned out to be a&lt;br/&gt;
     pretty large diff (over 2000 lines) because the fix for this issue leads&lt;br/&gt;
     to a difference in the query plans generated for most of the queries.&lt;br/&gt;
     The difference is that we are now generating a SortResultSet where we&lt;br/&gt;
     didn&apos;t used to.  The reason is that Derby inserts an implicit DISTINCT&lt;br/&gt;
     node above all UNIONs with no &quot;ALL&quot;, but prior to the fix for this issue&lt;br/&gt;
     the DistinctNode was effectively being ignored. Now that we correctly&lt;br/&gt;
     enforce the Distinct we are seeing a sort result set in the query&lt;br/&gt;
     plans, which is to be expected (we have to sort in order to eliminate&lt;br/&gt;
     duplicates).&lt;/p&gt;

&lt;p&gt;The changes are pretty small and my hope is that the code comments give ample explanation. As I said, derbyall and suites.All both ran cleanly with these changes, so I think these changes are ready for commit.  Review comments would be appreciated.&lt;/p&gt;</comment>
                            <comment id="12486151" author="army" created="Mon, 2 Apr 2007 23:03:29 +0100"  >&lt;p&gt;Committed patch to trunk with svn #524940:&lt;/p&gt;

&lt;p&gt;  URL: &lt;a href=&quot;http://svn.apache.org/viewvc?view=rev&amp;amp;rev=524940&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=rev&amp;amp;rev=524940&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Marking issue as resolved and unchecking the &quot;patch available&quot; flag.&lt;/p&gt;</comment>
                            <comment id="12499355" author="myrna" created="Sat, 26 May 2007 21:50:41 +0100"  >&lt;p&gt;Giving a swing at a release note. Interested parties, please review and improve.&lt;/p&gt;</comment>
                            <comment id="12500236" author="army" created="Wed, 30 May 2007 21:58:15 +0100"  >&lt;p&gt;Thanks for starting the release note on this, Myrna.  I took your starting point and filled it out a bit.  Perhaps this is too much information--I was trying to be as clear as possible about when users may see a difference due to this change.  I am of course open to feedback if anyone has it...&lt;/p&gt;</comment>
                            <comment id="12501747" author="army" created="Wed, 6 Jun 2007 00:50:05 +0100"  >&lt;p&gt;Very slight tweak to the release note.&lt;/p&gt;</comment>
                            <comment id="12501995" author="army" created="Wed, 6 Jun 2007 18:09:51 +0100"  >&lt;p&gt;Fix is in trunk (10.3) and I haven&apos;t heard any objections to the release note, so closing.&lt;/p&gt;</comment>
                            <comment id="12505552" author="myrna" created="Sat, 16 Jun 2007 23:47:27 +0100"  >&lt;p&gt;scrubbed release note.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12354628">DERBY-2034</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12354259" name="d1852_engine_v1.patch" size="9127" author="army" created="Mon, 26 Mar 2007 22:40:46 +0100"/>
                            <attachment id="12340863" name="d1852_quick_doNOTcommit.diff" size="2688" author="army" created="Thu, 14 Sep 2006 20:22:56 +0100"/>
                            <attachment id="12354260" name="d1852_tests_v1.patch" size="68849" author="army" created="Mon, 26 Mar 2007 22:40:46 +0100"/>
                            <attachment id="12354261" name="d1852_v1.stat" size="388" author="army" created="Mon, 26 Mar 2007 22:40:46 +0100"/>
                            <attachment id="12359947" name="releaseNote.html" size="5610" author="myrna" created="Sat, 16 Jun 2007 23:47:27 +0100"/>
                            <attachment id="12359007" name="releaseNote.html" size="6044" author="army" created="Wed, 6 Jun 2007 00:50:05 +0100"/>
                            <attachment id="12358575" name="releaseNote.html" size="6058" author="army" created="Wed, 30 May 2007 21:58:15 +0100"/>
                            <attachment id="12358314" name="releaseNote.html" size="3350" author="myrna" created="Sat, 26 May 2007 21:50:41 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 26 May 2007 20:50:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22751</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10101"><![CDATA[Release Note Needed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0uhz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38759</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>