<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:15:22 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1152/DERBY-1152.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1152] Failures in sysinfo and sysinfo_withproperties induced by classpath wiring</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1152</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If you wire your classpath together out of the compiled classtree and the checked-in jars, you get the following error in the sysinfo and sysinfo_withproperties tests. You don&apos;t see this error if you run against the built Derby jar files:&lt;/p&gt;

&lt;p&gt;15d14&lt;br/&gt;
&amp;lt; Unable to analyze class path: access denied (java.util.PropertyPermission java.class.path read)&lt;br/&gt;
43d41&lt;br/&gt;
&amp;lt; Unable to analyze class path: access denied (java.util.PropertyPermission java.class.path read)&lt;br/&gt;
72d69&lt;br/&gt;
&amp;lt; Unable to analyze class path: access denied (java.util.PropertyPermission java.class.path read)&lt;br/&gt;
Test Failed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12330752">DERBY-1152</key>
            <summary>Failures in sysinfo and sysinfo_withproperties induced by classpath wiring</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Mar 2006 03:10:13 +0100</created>
                <updated>Thu, 7 Sep 2006 00:48:49 +0100</updated>
                            <resolved>Wed, 5 Apr 2006 04:02:16 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12372008" author="bryanpendleton" created="Tue, 28 Mar 2006 03:32:28 +0100"  >&lt;p&gt;Myrna van Lunteren wrote:&lt;br/&gt;
&amp;gt; However, sysinfo, accessing java.class.path, lives in both derbytools.jar and derby.jar and also in derbynet.jar. So, I imagine, when running with jars, if derby.jar is first in the classpath, that will be the sysinfo that is being picked up, and so, it can&apos;t access java.class.path.&lt;/p&gt;

&lt;p&gt;Thanks Myrna! That is exactly the behavior I see, too.&lt;/p&gt;

&lt;p&gt;Meanwhile, while experimenting with different orders of jars in my&lt;br/&gt;
classpath, I also discovered that the following two lines were added&lt;br/&gt;
to the derby.jar and derbynet.jar, but NOT to the derbytools.jar:&lt;/p&gt;

&lt;p&gt;  // BUG &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-622&quot; title=&quot;sysinfo incorrectly requires permission on Derby jar files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-622&quot;&gt;&lt;del&gt;DERBY-622&lt;/del&gt;&lt;/a&gt; derbynet/sysinfo.java&lt;br/&gt;
  permission java.io.FilePermission &quot;$&lt;/p&gt;
{derbyTesting.codedir}${/}*&quot;, &quot;read&quot;;&lt;br/&gt;
&lt;br/&gt;
This causes the access to the locale message jars to be inconsistent,&lt;br/&gt;
depending on which jar sysinfo is loaded from.&lt;br/&gt;
&lt;br/&gt;
So, depending on the details of my classpath, I can create &lt;b&gt;three&lt;/b&gt;&lt;br/&gt;
different behaviors for the derbynet/sysinfo.java test:&lt;br/&gt;
&lt;br/&gt;
1) If I run with jars, with either derby.jar or derbynet.jar first, I&lt;br/&gt;
   get the behavior which matches the master files that I submitted:&lt;br/&gt;
   - java.class.path cannot be accessed&lt;br/&gt;
   - locale message jars can be accessed.&lt;br/&gt;
&lt;br/&gt;
2) If I run with classes, I get the behavior which Rick &amp;amp; Dan described:&lt;br/&gt;
   - java.class.path can be accessed.&lt;br/&gt;
   - locale message jars can be accessed.&lt;br/&gt;
&lt;br/&gt;
3) If I run with jars, but with derbytools.jar first, I get still a&lt;br/&gt;
   third behavior:&lt;br/&gt;
   - java.class.path can be accessed.&lt;br/&gt;
   - locale message jars cannot be accessed.&lt;br/&gt;
&lt;br/&gt;
Perhaps the easiest way out, at this point, is to make the following changes:&lt;br/&gt;
1) Add&lt;br/&gt;
&lt;br/&gt;
   permission java.util.PropertyPermission &quot;java.class.path&quot;, &quot;read&quot;;&lt;br/&gt;
&lt;br/&gt;
   for derby.jar, derbynet.jar, and derbytools.jar in derby_tests.policy&lt;br/&gt;
&lt;br/&gt;
2) Add&lt;br/&gt;
&lt;br/&gt;
   // BUG &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-622&quot; title=&quot;sysinfo incorrectly requires permission on Derby jar files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-622&quot;&gt;&lt;del&gt;DERBY-622&lt;/del&gt;&lt;/a&gt; derbynet/sysinfo.java&lt;br/&gt;
   permission java.io.FilePermission &quot;${derbyTesting.codedir}
&lt;p&gt;$&lt;/p&gt;
{/}
&lt;p&gt;*&quot;, &quot;read&quot;;&lt;/p&gt;

&lt;p&gt;   to derbytools.jar in derby_tests.policy&lt;/p&gt;

&lt;p&gt;3) Update the master files to reflect that the sysinfo tests are allowed&lt;br/&gt;
   to read both java.class.path AND the locale message jars.&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;

&lt;p&gt;thanks,&lt;/p&gt;

&lt;p&gt;bryan&lt;/p&gt;

</comment>
                            <comment id="12372029" author="bryanpendleton" created="Tue, 28 Mar 2006 07:31:20 +0100"  >&lt;p&gt;Attached is a proposed patch, derby-1152-looser-policy.diff. &lt;/p&gt;

&lt;p&gt;This patch adds extra lines to derby_tests.policy.  &lt;/p&gt;

&lt;p&gt;The idea is that,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;with respect to reading java.class.path&lt;/li&gt;
	&lt;li&gt;and with respect to accessing the locale message files,&lt;br/&gt;
the sysinfo classes are now granted the same policy, regardless &lt;br/&gt;
of whether the sysinfo classes are loaded from:&lt;/li&gt;
	&lt;li&gt;the classes directory,&lt;/li&gt;
	&lt;li&gt;from derby.jar,&lt;/li&gt;
	&lt;li&gt;from derbynet.jar,&lt;/li&gt;
	&lt;li&gt;or from derbytools.jar.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Since the two sysinfo tests are no longer denied permission to&lt;br/&gt;
read java.class.path, the patch includes new master files with&lt;br/&gt;
the new expected output.&lt;/p&gt;

&lt;p&gt;Rick, and others who have been experiencing this problem, can you&lt;br/&gt;
please review this patch and see if it resolves your issues with&lt;br/&gt;
the sysinfo tests?&lt;/p&gt;

&lt;p&gt;Dan and Andrew, and others who have been investigating security&lt;br/&gt;
policy issues, can you please consider whether it is OK to&lt;br/&gt;
add these additional lines to derby_tests.policy?&lt;/p&gt;</comment>
                            <comment id="12372046" author="rhillegas" created="Tue, 28 Mar 2006 10:00:41 +0100"  >&lt;p&gt;Thanks, Bryan. This fixes my problem with the sysinfo tests.&lt;/p&gt;</comment>
                            <comment id="12372140" author="bryanpendleton" created="Wed, 29 Mar 2006 05:12:19 +0100"  >&lt;p&gt;Thanks Rick, I&apos;m glad to hear it fixes things for you.&lt;/p&gt;

&lt;p&gt;I&apos;m reluctant to commit this change until I get some more feedback about the implications of adding these lines to the policy file, though.&lt;/p&gt;</comment>
                            <comment id="12372471" author="bryanpendleton" created="Fri, 31 Mar 2006 03:01:06 +0100"  >&lt;p&gt;Andrew is still working on the relevant functionality as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-622&quot; title=&quot;sysinfo incorrectly requires permission on Derby jar files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-622&quot;&gt;&lt;del&gt;DERBY-622&lt;/del&gt;&lt;/a&gt;. Since this patch directly conflicts with that work (they touch the same policy file lines), resolution of this problem may have to wait until we&apos;ve determined the outcome of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-622&quot; title=&quot;sysinfo incorrectly requires permission on Derby jar files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-622&quot;&gt;&lt;del&gt;DERBY-622&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12373163" author="bryanpendleton" created="Wed, 5 Apr 2006 04:02:16 +0100"  >&lt;p&gt;I&apos;ve committed the &apos;looser-policy&apos; patch to subversion:&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewcvs?rev=391387&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=391387&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Rick, could you please confirm that the sysinfo and sysinfo_withproperties tests are now passing for you, and then close this bug? Thanks.&lt;/p&gt;</comment>
                            <comment id="12373171" author="fuzzylogic" created="Wed, 5 Apr 2006 04:41:12 +0100"  >&lt;p&gt;Sorry for the late reply, but yes, I believe adding these permissions to the test policy is ok. There are only two places in the code we try to get the classpath, sysinfo and the client trace code, both handle security exceptions, and I think it&apos;s unlikely that we&apos;ll need to get the contents of the classpath elsewhere, but you never know. Maybe we should mark this bug number in the policy file for future reference in case anyone wonders why these permissions were added. I can take care of that as I follow up on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-622&quot; title=&quot;sysinfo incorrectly requires permission on Derby jar files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-622&quot;&gt;&lt;del&gt;DERBY-622&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12432973" author="slc" created="Wed, 6 Sep 2006 22:36:35 +0100"  >&lt;p&gt;I am running through the examples in the alpha version of the docs for sysinfo.&lt;/p&gt;

&lt;p&gt;On this page: &lt;a href=&quot;http://db.apache.org/derby/docs/dev/tools/rtoolssysinfo41288.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/docs/dev/tools/rtoolssysinfo41288.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;is this statement:&lt;/p&gt;

&lt;p&gt;Use the sysinfo utility to display information about your Java environment and Derby (including version information). To use sysinfo, either derby.jar or derbytools.jar must be in your classpath. &lt;/p&gt;

&lt;p&gt;However, the output when including &lt;b&gt;only&lt;/b&gt; derby.jar or derbytools.jar is different. Derbytools.jar output does not include locale information.  Am I correct in assuming this bug was supposed to fix the output of sysinfo to be the same for derby.jar and derbytools.jar when only one or the other of those was in the classpath?  Or is the behaviour I am seeing correct?&lt;/p&gt;

&lt;p&gt;If it is correct I&apos;ll reflect that in the doc review and state that the output should be different if only one or the other is in the classpath.&lt;/p&gt;

&lt;p&gt;Output when only derby.jar is in the classpath:&lt;/p&gt;

&lt;p&gt;C:\derby_src\db-derby-10.2.1.2-bin\demo\databases&amp;gt;set CLASSPATH=C:\derby_src\db-&lt;br/&gt;
derby-10.2.1.2-bin\lib\derby.jar;&lt;/p&gt;

&lt;p&gt;C:\derby_src\db-derby-10.2.1.2-bin\demo\databases&amp;gt;java org.apache.derby.tools.sy&lt;br/&gt;
sinfo&lt;br/&gt;
------------------ Java Information ------------------&lt;br/&gt;
Java Version:    1.4.2_09&lt;br/&gt;
Java Vendor:     Sun Microsystems Inc.&lt;br/&gt;
Java home:       C:\JDK\jdk1.4.2_09\jre&lt;br/&gt;
Java classpath:  C:\derby_src\db-derby-10.2.1.2-bin\lib\derby.jar;&lt;br/&gt;
OS name:         Windows XP&lt;br/&gt;
OS architecture: x86&lt;br/&gt;
OS version:      5.1&lt;br/&gt;
Java user name:  slc&lt;br/&gt;
Java user home:  C:\Documents and Settings\Administrator&lt;br/&gt;
Java user dir:   C:\derby_src\db-derby-10.2.1.2-bin\demo\databases&lt;br/&gt;
java.specification.name: Java Platform API Specification&lt;br/&gt;
java.specification.version: 1.4&lt;br/&gt;
--------- Derby Information --------&lt;br/&gt;
JRE - JDBC: J2SE 1.4.2 - JDBC 3.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;C:\derby_src\db-derby-10.2.1.2-bin\lib\derby.jar&amp;#93;&lt;/span&gt; 10.2.1.2 beta - (439408)&lt;br/&gt;
------------------------------------------------------&lt;br/&gt;
----------------- Locale Information -----------------&lt;br/&gt;
Current Locale :  [English/United States &lt;span class=&quot;error&quot;&gt;&amp;#91;en_US&amp;#93;&lt;/span&gt;]&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;de_DE&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.2.1.2 - (439408)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;es&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.2.1.2 - (439408)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;fr&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.2.1.2 - (439408)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;it&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.2.1.2 - (439408)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;ja_JP&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.2.1.2 - (439408)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;ko_KR&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.2.1.2 - (439408)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;pt_BR&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.2.1.2 - (439408)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;zh_CN&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.2.1.2 - (439408)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;zh_TW&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.2.1.2 - (439408)&lt;br/&gt;
------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Output when only derbytools.jar is in the classpath:&lt;/p&gt;

&lt;p&gt;C:\derby_src\db-derby-10.2.1.2-bin\demo\databases&amp;gt;set CLASSPATH=C:\derby_src\db-&lt;br/&gt;
derby-10.2.1.2-bin\lib\derbytools.jar;&lt;/p&gt;

&lt;p&gt;C:\derby_src\db-derby-10.2.1.2-bin\demo\databases&amp;gt;java org.apache.derby.tools.sy&lt;br/&gt;
sinfo&lt;br/&gt;
------------------ Java Information ------------------&lt;br/&gt;
Java Version:    1.4.2_09&lt;br/&gt;
Java Vendor:     Sun Microsystems Inc.&lt;br/&gt;
Java home:       C:\JDK\jdk1.4.2_09\jre&lt;br/&gt;
Java classpath:  C:\derby_src\db-derby-10.2.1.2-bin\lib\derbytools.jar;&lt;br/&gt;
OS name:         Windows XP&lt;br/&gt;
OS architecture: x86&lt;br/&gt;
OS version:      5.1&lt;br/&gt;
Java user name:  slc&lt;br/&gt;
Java user home:  C:\Documents and Settings\Administrator&lt;br/&gt;
Java user dir:   C:\derby_src\db-derby-10.2.1.2-bin\demo\databases&lt;br/&gt;
java.specification.name: Java Platform API Specification&lt;br/&gt;
java.specification.version: 1.4&lt;br/&gt;
--------- Derby Information --------&lt;br/&gt;
JRE - JDBC: J2SE 1.4.2 - JDBC 3.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;C:\derby_src\db-derby-10.2.1.2-bin\lib\derbytools.jar&amp;#93;&lt;/span&gt; 10.2.1.2 beta - (439408)&lt;/p&gt;

&lt;p&gt;------------------------------------------------------&lt;br/&gt;
----------------- Locale Information -----------------&lt;br/&gt;
------------------------------------------------------&lt;/p&gt;</comment>
                            <comment id="12432990" author="bryanpendleton" created="Wed, 6 Sep 2006 23:50:28 +0100"  >&lt;p&gt;Hi Susan, thanks for having a look at this!&lt;/p&gt;

&lt;p&gt;I believe that the output is correct, and reflects an important difference between derby.jar&lt;br/&gt;
and derbytools.jar: derby.jar has an entry in its Manifest file which automatically loads all&lt;br/&gt;
of the locale-specific properties jars, whereas derbytools.jar doesnt.&lt;/p&gt;

&lt;p&gt;That is, when your classpath specifies only derby.jar, but you also have the local jars&lt;br/&gt;
in the same physical directory as derby.jar, the Java class loader reads the Manifest &lt;br/&gt;
classpath entry and automatically loads the locale jars when it loads derby.jar.&lt;/p&gt;

&lt;p&gt;But derbytools.jar, which omits that special Manifest entry, does not automatically load&lt;br/&gt;
those Manifest jars.&lt;/p&gt;

&lt;p&gt;Sysinfo, in my opinion, is faithfully reporting the actual environment as it finds it, and that&lt;br/&gt;
environment, with respect to the locale jars in the classpath, is indeed different in this case.&lt;/p&gt;
</comment>
                            <comment id="12432998" author="slc" created="Thu, 7 Sep 2006 00:48:49 +0100"  >&lt;p&gt;Hi Bryan,&lt;/p&gt;

&lt;p&gt;Thanks for your response.  I&apos;ll make an addition to the documentation to change it accordingly then.&lt;/p&gt;

&lt;p&gt;Susan&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12324622" name="derby-1152-looser-policy.diff" size="5342" author="bryanpendleton" created="Tue, 28 Mar 2006 07:31:19 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 28 Mar 2006 02:32:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22339</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy14ov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40410</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>