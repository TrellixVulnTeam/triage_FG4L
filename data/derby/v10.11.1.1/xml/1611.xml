<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:39:02 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1611/DERBY-1611.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1611] A  view should be dropped when a privilege required by the view is revoked.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1611</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;A view tracks its privileges requirements using Derby&apos;s Dependency Manager. If any one of those required privileges are revoked, the view should be dropped automatically. &lt;/p&gt;

&lt;p&gt;I am just creating a new jira entry here so it is easier to track sub items of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1330&quot; title=&quot;Provide runtime privilege checking for grant/revoke functionality&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1330&quot;&gt;&lt;del&gt;DERBY-1330&lt;/del&gt;&lt;/a&gt;. Will link this Jira entry to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1330&quot; title=&quot;Provide runtime privilege checking for grant/revoke functionality&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1330&quot;&gt;&lt;del&gt;DERBY-1330&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;See the functional spec attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1330&quot; title=&quot;Provide runtime privilege checking for grant/revoke functionality&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1330&quot;&gt;&lt;del&gt;DERBY-1330&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12346922">DERBY-1611</key>
            <summary>A  view should be dropped when a privilege required by the view is revoked.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mamtas">Mamta A. Satoor</assignee>
                                    <reporter username="mamtas">Mamta A. Satoor</reporter>
                        <labels>
                    </labels>
                <created>Mon, 31 Jul 2006 03:38:44 +0100</created>
                <updated>Wed, 1 Jul 2009 01:34:30 +0100</updated>
                            <resolved>Wed, 30 Aug 2006 07:20:27 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12425152" author="mamtas" created="Wed, 2 Aug 2006 07:25:35 +0100"  >&lt;p&gt;I have the next incremental patch for revoke privilege. This patch concentrates on basic revoke functionality for views. If revoke statement finds a view dependent on the table/column/routine on which privilege is being revoked, the view will be dropped automatically. This functionality is similar to what is supported for triggers. And just like triggers, more work is required so that view will get dropped only if it depends on the particular privilege TYPE or particular column that is being revoked. &lt;/p&gt;

&lt;p&gt;svn stat -q o/p is attached as DERBY1611_V1_stat_DropViewOnRevoke.txt &lt;/p&gt;

&lt;p&gt;Other than the test changes, the only file that got changed is ViewDescriptor.java. ViewDescriptor drops itself if it get a revoke invalidation action. This is a pretty straightforward change and would appreciate if anyone with cycles can review/commit this for me. derbyall ran fine with Sun&apos;s jdk1.4&lt;/p&gt;

&lt;p&gt;I have added quite a few tests into lang\grantRevokeDDL.sql and have names for the new tests in lang\grantRevokeDDL.sql for easy reference in the description below&lt;br/&gt;
1)Test1&lt;br/&gt;
A view should get dropped when one of the required privileges is revoked&lt;br/&gt;
2)Test2&lt;br/&gt;
Have the dba create a view in a schema owned by another user. The only way that view will get dropped will be via drop view statement. Since the view was created by dba, it doesn&apos;t have privilege dependencies and hence no revoke statement can automatically drop that view created by the dba. A drop view statement is the only way to drop a dba owned view.&lt;br/&gt;
3)Test3&lt;br/&gt;
Create a view that relies on a table level permission and a column level permission. Object should get dropped no matter which one of the 2 privileges get revoked first. &lt;br/&gt;
4)Test4&lt;br/&gt;
Create a view that relies on a user-level table privilege and a user-level column privilege. There also exists a PUBLIC-level column privilege but objects at the creation time always first look for the required privilege at the user level(&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1632&quot; title=&quot;During revoke privilege, Derby does not look for replacement privilege for the dependent objects and simply drops the dependent objects. This is not SQL compliant and should be fixed.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1632&quot;&gt;DERBY-1632&lt;/a&gt;). This behavior can be confirmed by the this test case where when PUBLIC-level column privilege is revoked, it does not impact the view in anyway because the view is relying on user-level column privilege. Confirm that object is relying on user-level privilege by revoking the user-level privilege and that should drop the object&lt;br/&gt;
5)Test5&lt;br/&gt;
Create a view that relies on a SELECT privilege on only one column of a table. revoke SELECT privilege on another column in that table and it ends up dropping the view. This is happening because the revoke privilege work is not completely finished and any dependent object on that permission type for table&apos;s columns get dropped when a revoke privilege is issued against any column of that table&lt;br/&gt;
6)Test6&lt;br/&gt;
Create a view that requires some privileges. Create a trigger that requires privileges on that view. When a privilege is revoked from the view, the view gets dropped. I have expected the trigger to fail when it gets fired next time. But it does not always happen because of the issue with trigger invalidation. &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1613&quot; title=&quot;A trigger does not get invalidated when the view used by it is dropped&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1613&quot;&gt;&lt;del&gt;DERBY-1613&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
7)Test7&lt;br/&gt;
Create a view that relies on a user level table privilege. The view will depend on the user level table privilege. Later grant the table privilege at the PUBLIC level too. So, there are 2 privileges available and the view relies on one of those privileges. Later, revoke the user level table privilege. This will end up dropping the view although there is another privilege available at PUBLIC level which can cover the view&apos;s requirements of privileges. But Derby does not support this automatic switching of privilege reliance on another available privilege when revoke is issued. &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1632&quot; title=&quot;During revoke privilege, Derby does not look for replacement privilege for the dependent objects and simply drops the dependent objects. This is not SQL compliant and should be fixed.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1632&quot;&gt;DERBY-1632&lt;/a&gt;&lt;br/&gt;
8)Test8&lt;br/&gt;
This test is similar to test7 above. Create a view that relies on a column level privilege. Later on, grant the same privilege at table level. Now, revoke the column level privilege. The view will get dropped automatically even though there is a covering privilege available at the table level.(&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1632&quot; title=&quot;During revoke privilege, Derby does not look for replacement privilege for the dependent objects and simply drops the dependent objects. This is not SQL compliant and should be fixed.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1632&quot;&gt;DERBY-1632&lt;/a&gt;)&lt;br/&gt;
9)Test9&lt;br/&gt;
Have SELECT privilege available both at column level and table level. When an object is created which requires the SELECT privilege, Derby is designed to pick up the table level privilege first. Later, when the table level privilege is revoke, the object gets dropped. The object really should start depending on the available column level privilege. &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1632&quot; title=&quot;During revoke privilege, Derby does not look for replacement privilege for the dependent objects and simply drops the dependent objects. This is not SQL compliant and should be fixed.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1632&quot;&gt;DERBY-1632&lt;/a&gt;&lt;br/&gt;
10)Test10&lt;br/&gt;
Create a view that relies on some privileges. Create another view based on that view. A revoke privilege on privilege required by the first view will fail because there is another view dependent on the first view. This is because Derby currently does not support cascade view drop (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1631&quot; title=&quot;Derby needs to support drop view cascade in order for revoke privilege to function correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1631&quot;&gt;&lt;del&gt;DERBY-1631&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;
</comment>
                            <comment id="12425622" author="djd" created="Thu, 3 Aug 2006 22:56:34 +0100"  >&lt;p&gt;Patch DERBY1611_V1_diff_DropViewOnRevoke.txt committed Revision: 428536 - Thanks Mamta&lt;/p&gt;</comment>
                            <comment id="12426955" author="djd" created="Wed, 9 Aug 2006 17:15:59 +0100"  >&lt;p&gt;Cleaning the summary&lt;/p&gt;</comment>
                            <comment id="12431484" author="mamtas" created="Wed, 30 Aug 2006 07:20:27 +0100"  >&lt;p&gt;Closing this issue since I am finished with the work targeted for 10.2 release. The remaining work for this issue is getting tracked in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1782&quot; title=&quot;When a privilege is revoked at table level, Derby should only drop objects that require that particular privilege and not all the objects that require some form of privilege on that table.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1782&quot;&gt;DERBY-1782&lt;/a&gt;. I will link the 2 issues so we can keep track of the correlation between the 2 jira entries.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12347130">DERBY-1631</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12343197">DERBY-1330</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12348900">DERBY-1782</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12337966" name="DERBY1611_V1_diff_DropViewOnRevoke.txt" size="52096" author="mamtas" created="Wed, 2 Aug 2006 07:25:35 +0100"/>
                            <attachment id="12337967" name="DERBY1611_V1_stat_DropViewOnRevoke.txt" size="319" author="mamtas" created="Wed, 2 Aug 2006 07:25:35 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Aug 2006 21:56:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30074</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0t4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38536</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>