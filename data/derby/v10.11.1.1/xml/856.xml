<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:31:43 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-856/DERBY-856.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-856] modify setCharacterStreamInternal to take a long for the length, and perform the &gt; max int check in the method</title>
                <link>https://issues.apache.org/jira/browse/DERBY-856</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;A similar change to setBinaryStreamInternal is being handled as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-599&quot; title=&quot;Using setBlob interface, should not materialize the entire blob value into memory.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-599&quot;&gt;&lt;del&gt;DERBY-599&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;
</description>
                <environment>All Environments</environment>
        <key id="12327983">DERBY-856</key>
            <summary>modify setCharacterStreamInternal to take a long for the length, and perform the &gt; max int check in the method</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="narayanan">V.Narayanan</assignee>
                                    <reporter username="narayanan">V.Narayanan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Jan 2006 17:25:04 +0000</created>
                <updated>Fri, 21 Jan 2011 18:08:52 +0000</updated>
                            <resolved>Sat, 4 Feb 2006 00:53:24 +0000</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12363625" author="narayanan" created="Mon, 23 Jan 2006 17:30:39 +0000"  >&lt;p&gt;I am attaching a patch for this issue. I have also attached the output of svn status.&lt;/p&gt;</comment>
                            <comment id="12363970" author="rhillegas" created="Thu, 26 Jan 2006 00:53:45 +0000"  >&lt;p&gt;This seems straightforward and the derbyall tests pass. NSinSameVM has the same errors we see in the mainline. There is some instability in readlocks.sql but that test passed when I re-ran it.&lt;/p&gt;</comment>
                            <comment id="12363989" author="rhillegas" created="Thu, 26 Jan 2006 03:40:10 +0000"  >&lt;p&gt;Hi Mike,&lt;/p&gt;

&lt;p&gt;Thanks for looking into the readlocks.sql failure. I ran the test under cygwin on XP (Version 2002, service pack 2). The machine is a 1 processor Toshiba Tecra 2. Here is the failure from the original testr un:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;Start: readlocks jdk1.4.2_08 storeall:storemore 2006-01-24 16:12:13 ***&lt;br/&gt;
19533a19534&lt;br/&gt;
&amp;gt; APP     |UserTran|ROW     |1   |S   |A           |(4,6)     |GRANT|ACTIVE  &lt;br/&gt;
Test Failed.&lt;/li&gt;
			&lt;li&gt;End:   readlocks jdk1.4.2_08 storeall:storemore 2006-01-24 16:14:00 ***&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12364041" author="davidvc" created="Thu, 26 Jan 2006 09:32:06 +0000"  >&lt;p&gt;I could have sworn Dan commented on this, but I can&apos;t find his email, so I&apos;ll say it: I think the code should use StandardException.newException() rather than Util.newEmbedSQLException.  This seems especially important as we look forward to JDBC4 support, as the recent thread with Anurag exemplifies...&lt;/p&gt;

&lt;p&gt;So, something like&lt;/p&gt;

&lt;p&gt;Util.generateCsSQLException(StandardException.newException(SQLState.LANG_INVALID_COLUMN_LENGTH, &quot;setCharacterStreamInternal&quot;));&lt;/p&gt;

&lt;p&gt;seems more standard&lt;/p&gt;

&lt;p&gt;David&lt;/p&gt;</comment>
                            <comment id="12364044" author="skambha" created="Thu, 26 Jan 2006 09:36:49 +0000"  >&lt;p&gt;Hi Narayanan,&lt;br/&gt;
As I posted a recent patch with similar changes to the setBinaryStreamInternal, I also looked briefly at your patch for the setCharacterStreamInternal changes. &lt;/p&gt;

&lt;p&gt;I have some comments. &lt;/p&gt;

&lt;p&gt;&amp;#8211; I think Dan pointed this out in a different patch. I dont think we should use Util.newEmbedSQLException, but instead use the newSQLException as the rest of the code in EmbedPreparedStatement does.&lt;/p&gt;

&lt;p&gt;+   	if (length &amp;gt; Integer.MAX_VALUE)&lt;br/&gt;
+		throw Util.newEmbedSQLException(SQLState.LANG_INVALID_COLUMN_LENGTH,&lt;br/&gt;
+                           new Object[]&lt;/p&gt;
{new String(&quot;setCharacterStreamInternal&quot;)}
&lt;p&gt;,&lt;br/&gt;
+                           StandardException.getSeverityFromIdentifier&lt;br/&gt;
+                           (SQLState.LANG_INVALID_COLUMN_LENGTH));&lt;/p&gt;

&lt;p&gt;&amp;#8211; There isnt a test to test this case where an exception would be thrown if the length &amp;gt;2G-1.  As part of my &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-599&quot; title=&quot;Using setBlob interface, should not materialize the entire blob value into memory.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-599&quot;&gt;&lt;del&gt;DERBY-599&lt;/del&gt;&lt;/a&gt; patch , I added a negative test for blobs in largedata/LobLimits.java to test for a 4G blob. This can be extended for clob too similarly. &lt;/p&gt;

&lt;p&gt;3) The error message if a clob &amp;gt;Integer.MAX_VALUE is sent, then the error msg thrown corresponds to &lt;br/&gt;
42X44=Invalid length &apos;&apos;&lt;/p&gt;
{0}&apos;&apos; in column specification.&lt;br/&gt;
&lt;br/&gt;
I am not sure if the error message is appropriate here ?  For my changes to setBinaryStreamInternal - I used SQLState.LANG_OUTSIDE_RANGE_FOR_DATATYPE, with message text  &apos;The resulting value is outside the range for the data type {0}
&lt;p&gt;&apos;.   Also I just posted my DERBY599 patch - so maybe better to wait if someone has any other comments on what error message would be more appropriate. &lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Sunitha.&lt;/p&gt;</comment>
                            <comment id="12364060" author="narayanan" created="Thu, 26 Jan 2006 14:52:09 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
Thanx for the reviews and comments. I am sorry for my late reply. &lt;/p&gt;

&lt;p&gt;Dan had commented on my earlier patch for jdbc4 clob blob methods. I had made the modification and posted the changes also. I will do the same here. &lt;/p&gt;

&lt;p&gt;Thanx for the comments David I will change it from using newEmbedSQLException to newSQLException.&lt;/p&gt;

&lt;p&gt;Thanx for taking a look at the patch sunitha. I will change newEmbedSQLException. Also I will look at the test and extend them for clob also. Also I shall wait for comments to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-599&quot; title=&quot;Using setBlob interface, should not materialize the entire blob value into memory.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-599&quot;&gt;&lt;del&gt;DERBY-599&lt;/del&gt;&lt;/a&gt; for the most appropriate message to be thrown.&lt;/p&gt;

&lt;p&gt;thanx&lt;br/&gt;
Narayanan&lt;/p&gt;
</comment>
                            <comment id="12364634" author="narayanan" created="Wed, 1 Feb 2006 01:25:29 +0000"  >&lt;p&gt;Thanks for the earlier guidance and comments for this patch.&lt;/p&gt;

&lt;p&gt;I have modified setCharacterStreamInternal to match changes to setBinaryStreamInternal(addressed in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-599&quot; title=&quot;Using setBlob interface, should not materialize the entire blob value into memory.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-599&quot;&gt;&lt;del&gt;DERBY-599&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Issues addressed&lt;br/&gt;
--------------------------------&lt;/p&gt;

&lt;p&gt;a) Have modified it to use newSQLException&lt;br/&gt;
b) Fixed the LobLimits test to test when a 4GB blob is inserted&lt;/p&gt;

&lt;p&gt;Narayanan&lt;/p&gt;</comment>
                            <comment id="12364635" author="narayanan" created="Wed, 1 Feb 2006 01:27:19 +0000"  >&lt;p&gt;Please note that the new patch is setCharacterStreamInternal_1.diff&lt;/p&gt;

&lt;p&gt;Narayanan&lt;/p&gt;</comment>
                            <comment id="12364906" author="skambha" created="Thu, 2 Feb 2006 10:29:31 +0000"  >&lt;p&gt;Thanks Narayanan for addressing my earlier comments.&lt;/p&gt;

&lt;p&gt;I looked at the setCharacterStreamInternal_1.diff patch and the code changes look right to me. &lt;/p&gt;

&lt;p&gt;I have some minor comments. &lt;/p&gt;

&lt;p&gt;1) In the below code, it would be good to update the comments to reflect the use of the intLength &lt;br/&gt;
variable instead of the length.&lt;/p&gt;

&lt;p&gt; @@ -662,19 +669,19 @@&lt;br/&gt;
                 // usableLength is the length of the data from stream that can&lt;br/&gt;
                 // be inserted which is min(colWidth,length) provided &lt;br/&gt;
                 // length - colWidth has trailing blanks only&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (colWidth &amp;lt; length)&lt;br/&gt;
+                if (colWidth &amp;lt; intLength)&lt;br/&gt;
                     usableLength = colWidth;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Maybe also good to put in a comment in the code where we check for the value &amp;gt;2G-1 to indicate that the check is because currently Derby doesnt handle clob greater than 2G-1 chars. &lt;/p&gt;

&lt;p&gt;2) There are some diffs that show up that are not related to this change, possibly because of change in indentation. It would be nice if this can be cleaned up. Also the indentation seems not quite right between the if(reader==null) block and the next block where you check for MAX_VALUE.&lt;/p&gt;

&lt;p&gt;Thanks for adding the testcase to test for the error message.  I applied your patch and have started a run of the largedata/LobLimits.java test. I&apos;ll post here once it completes ok.&lt;/p&gt;

&lt;p&gt;Can you also mention if derbyall ran successfully or not. &lt;/p&gt;

&lt;p&gt;Sunitha.&lt;/p&gt;</comment>
                            <comment id="12364931" author="skambha" created="Thu, 2 Feb 2006 15:09:06 +0000"  >&lt;p&gt;After applying the patch, I ran the entire largedata suite for embedded - which is largeDataTests suite and all tests passed (including the largedata/LobLimits.java). &lt;/p&gt;
</comment>
                            <comment id="12364954" author="narayanan" created="Thu, 2 Feb 2006 22:29:54 +0000"  >&lt;p&gt;Hi Sunitha,&lt;br/&gt;
Thanx for the reviews and comments. &lt;br/&gt;
a) I have fixed the comments to indicate that in intLength the length variable is being cast to an int and stored. Also I have mentioned that the cast is being done because derby currently supports Clob of size 2G-1&lt;br/&gt;
b) derbyall runs with failures. But none of them were related to my patch.&lt;/p&gt;

&lt;p&gt;I am resubmitting the patch again&lt;/p&gt;

&lt;p&gt;thanx&lt;br/&gt;
Narayanan&lt;/p&gt;</comment>
                            <comment id="12365024" author="davidvc" created="Fri, 3 Feb 2006 10:02:34 +0000"  >&lt;p&gt;Hi, Narayanan.  I took a quick look at this patch.  In general it looks quite good, except for one nit: the error message.&lt;/p&gt;

&lt;p&gt;Currently it says &lt;/p&gt;

&lt;p&gt;&quot;The resulting value is outside the range for the data type CLOB&quot;&lt;/p&gt;

&lt;p&gt;I know you are using an existing message, but since we&apos;re at it, it would be better if it said something a little more relevant to the end user, like:&lt;/p&gt;

&lt;p&gt;&quot;The resulting value is has a size of &lt;/p&gt;
{0}
&lt;p&gt; which exceeds the maximum length of &lt;/p&gt;
{1}
&lt;p&gt; for a Clob in Derby&quot;&lt;/p&gt;

&lt;p&gt;David&lt;/p&gt;</comment>
                            <comment id="12365033" author="skambha" created="Fri, 3 Feb 2006 11:30:16 +0000"  >&lt;p&gt;The patch &apos;setCharacterStreamInternal_2.diff&apos; looks good to me. Thanks for taking care of my comments. &lt;/p&gt;</comment>
                            <comment id="12365037" author="djd" created="Fri, 3 Feb 2006 13:13:00 +0000"  >&lt;p&gt;Patch looks good,  I don&apos;t agree the error message has to change, it&apos;s the standard Derby error message for the correct situation. We shouls not be adding special error messages for one off situations.&lt;/p&gt;</comment>
                            <comment id="12365041" author="djd" created="Fri, 3 Feb 2006 13:52:16 +0000"  >&lt;p&gt;It would be possible to replace the CLOB in the current error message with CLOB&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; where x is the correct size. In this case it would be:&lt;/p&gt;

&lt;p&gt;CLOB(2147483647)&lt;/p&gt;

&lt;p&gt;This would be by using &lt;/p&gt;

&lt;p&gt;preparedStatement.getParameterTypes()&lt;span class=&quot;error&quot;&gt;&amp;#91;parameterIndex-1&amp;#93;&lt;/span&gt;.getSQLstring()&lt;/p&gt;

&lt;p&gt;instead of&lt;/p&gt;

&lt;p&gt;getEmbedParameterSetMetaData().getParameterTypeName(&lt;br/&gt;
                  parameterIndex)&lt;/p&gt;</comment>
                            <comment id="12365043" author="narayanan" created="Fri, 3 Feb 2006 14:32:06 +0000"  >&lt;p&gt;Thanx for the comments and reviews. I will replace the CLOB in the current error message with CLOB&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; , reflect corresponding changes in the LobLimits.out file after running the test and submit my patch again. &lt;br/&gt;
thanx once again,&lt;br/&gt;
Narayanan&lt;/p&gt;</comment>
                            <comment id="12365072" author="narayanan" created="Fri, 3 Feb 2006 22:45:31 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
1) I have made the changes and am reattaching the patch again. &lt;br/&gt;
2) I ran derbyall and noticed failures. I noticed a failure in jdbcapi/LobTest.java. So I ran derbyall on a workspace on which I had&apos;nt applied this patch and   &lt;br/&gt;
    I observed the same failure. I then concluded that this failure was not due to me applying my patch.&lt;br/&gt;
3) I am attaching the  diff file setCharacterStreamInternal_3.diff as the new diff file.&lt;br/&gt;
thanx&lt;br/&gt;
Narayanan&lt;/p&gt;</comment>
                            <comment id="12365074" author="narayanan" created="Fri, 3 Feb 2006 22:48:28 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I am also attaching the LobTests.diff (The diff file of the failed test jdbcapi/LobTest.java) as part of the patch submission.&lt;br/&gt;
thanx&lt;br/&gt;
Narayanan&lt;/p&gt;</comment>
                            <comment id="12365082" author="djd" created="Sat, 4 Feb 2006 00:53:24 +0000"  >&lt;p&gt;Committed revision 374696. Thanks for the patch&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12322604" name="LOBTest.diff" size="29477" author="narayanan" created="Fri, 3 Feb 2006 22:48:28 +0000"/>
                            <attachment id="12322241" name="setCharacterStreamInternal.diff" size="3496" author="narayanan" created="Mon, 23 Jan 2006 17:30:39 +0000"/>
                            <attachment id="12322242" name="setCharacterStreamInternal.stat" size="74" author="narayanan" created="Mon, 23 Jan 2006 17:30:39 +0000"/>
                            <attachment id="12322510" name="setCharacterStreamInternal_1.diff" size="10998" author="narayanan" created="Wed, 1 Feb 2006 01:25:29 +0000"/>
                            <attachment id="12322561" name="setCharacterStreamInternal_2.diff" size="11240" author="narayanan" created="Thu, 2 Feb 2006 22:29:54 +0000"/>
                            <attachment id="12322562" name="setCharacterStreamInternal_2.stat" size="242" author="narayanan" created="Thu, 2 Feb 2006 22:29:54 +0000"/>
                            <attachment id="12322603" name="setCharacterStreamInternal_3.diff" size="11255" author="narayanan" created="Fri, 3 Feb 2006 22:45:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 26 Jan 2006 00:53:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29745</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0kn3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37162</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>