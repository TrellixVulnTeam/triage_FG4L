<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:52:30 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-265/DERBY-265.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-265] In Network Server retrieving BLOB values with autocommit off causes NullPointerException in INSANE build / AssertFailure in in BaseContainerHandle.getTransaction in SANE Build</title>
                <link>https://issues.apache.org/jira/browse/DERBY-265</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;problem when retreiving rows with BLOB &lt;br/&gt;
values with network server with autocommit on.  The workaround &lt;br/&gt;
was to turn autocommit off.  The Problem manifested itself with &lt;br/&gt;
this trace but there was  an underlying NPE in the &lt;br/&gt;
derby.log&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
 at com.ibm.db2.jcc.c.md.a(md.java:289)&lt;br/&gt;
 at &lt;br/&gt;
com.ibm.db2.jcc.c.SqlException.getMessage(SqlException.java:194)&lt;/p&gt;

&lt;p&gt; at &lt;br/&gt;
java.lang.Throwable.getLocalizedMessage(Throwable.java:266)&lt;br/&gt;
 at java.lang.Throwable.toString(Throwable.java:343)&lt;br/&gt;
 at java.lang.String.valueOf(String.java:2131)&lt;br/&gt;
 at java.io.PrintStream.print(PrintStream.java:462)&lt;br/&gt;
 at java.io.PrintStream.println(PrintStream.java:599)&lt;br/&gt;
 at java.lang.Throwable.printStackTrace(Throwable.java:461)&lt;br/&gt;
 at java.lang.Throwable.printStackTrace(Throwable.java:451)&lt;br/&gt;
 at temp.CloudscapeTest.&amp;lt;init&amp;gt;(CloudscapeTest.java:28)&lt;br/&gt;
 at temp.CloudscapeTest.main(CloudscapeTest.java:92)&lt;/p&gt;

&lt;p&gt;When run with a SANE Build with the attached repro, the &lt;br/&gt;
derby.log shows this trace.&lt;br/&gt;
}), Committing&lt;/p&gt;

&lt;p&gt;2005-02-08 21:19:45.626 GMT Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_2,5,main&amp;#93;&lt;/span&gt; &lt;br/&gt;
(XID = 2845), (SESSIONID = 1), (DATABASE = toursDB), (DRDAID = &lt;br/&gt;
NF000001.G838-866941820371235014&lt;/p&gt;
{10}), Executing prepared &lt;br/&gt;
statement: SELECT &quot;MAP_ID&quot;, &quot;MAP_NAME&quot;, &quot;REGION&quot;, &quot;AREA&quot;, &lt;br/&gt;
&quot;PHOTO_FORMAT&quot;, &quot;PICTURE&quot; FROM &quot;MAPS&quot; :End prepared statement&lt;br/&gt;
&lt;br/&gt;
2005-02-08 21:19:45.686 GMT Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_2,5,main&amp;#93;&lt;/span&gt; &lt;br/&gt;
(XID = 2845), (SESSIONID = 1), (DATABASE = toursDB), (DRDAID = &lt;br/&gt;
NF000001.G838-866941820371235014{10}
&lt;p&gt;), Executing prepared &lt;br/&gt;
statement: SELECT &quot;MAP_ID&quot;, &quot;MAP_NAME&quot;, &quot;REGION&quot;, &quot;AREA&quot;, &lt;br/&gt;
&quot;PHOTO_FORMAT&quot;, &quot;PICTURE&quot; FROM &quot;MAPS&quot; :End prepared statement&lt;/p&gt;

&lt;p&gt;2005-02-08 21:19:45.726 GMT Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_2,5,main&amp;#93;&lt;/span&gt; &lt;br/&gt;
(XID = 2845), (SESSIONID = 1), (DATABASE = toursDB), (DRDAID = &lt;br/&gt;
NF000001.G838-866941820371235014&lt;/p&gt;
{10}), Committing&lt;br/&gt;
&lt;br/&gt;
2005-02-08 21:19:45.726 GMT Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_2,5,main&amp;#93;&lt;/span&gt; &lt;br/&gt;
(XID = 2845), (SESSIONID = 1), (DATABASE = toursDB), (DRDAID = &lt;br/&gt;
NF000001.G838-866941820371235014{10}
&lt;p&gt;), Cleanup action starting&lt;/p&gt;

&lt;p&gt;2005-02-08 21:19:45.726 GMT Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_2,5,main&amp;#93;&lt;/span&gt; &lt;br/&gt;
(XID = 2845), (SESSIONID = 1), (DATABASE = toursDB), (DRDAID = &lt;br/&gt;
NF000001.G838-866941820371235014&lt;/p&gt;
{10}
&lt;p&gt;), Failed Statement is: &lt;br/&gt;
null&lt;/p&gt;

&lt;p&gt;org.apache.derby.iapi.services.sanity.AssertFailure: ASSERT &lt;br/&gt;
FAILED&lt;/p&gt;

&lt;p&gt;	at &lt;br/&gt;
org.apache.derby.iapi.services.sanity.SanityManager.ASSERT(Sanit&lt;br/&gt;
yManager.java:99)&lt;/p&gt;

&lt;p&gt;	at &lt;br/&gt;
org.apache.derby.impl.store.raw.data.BaseContainerHandle.getTran&lt;br/&gt;
saction(BaseContainerHandle.java:830)&lt;/p&gt;

&lt;p&gt;	at &lt;br/&gt;
org.apache.derby.impl.store.raw.data.OverflowInputStream.initStr&lt;br/&gt;
eam(OverflowInputStream.java:158)&lt;/p&gt;

&lt;p&gt;	at &lt;br/&gt;
org.apache.derby.iapi.services.io.FormatIdInputStream.initStream&lt;br/&gt;
(FormatIdInputStream.java:226)&lt;/p&gt;

&lt;p&gt;	at &lt;br/&gt;
org.apache.derby.impl.jdbc.EmbedBlob.&amp;lt;init&amp;gt;(EmbedBlob.java:12&lt;br/&gt;
8)&lt;/p&gt;

&lt;p&gt;	at &lt;br/&gt;
org.apache.derby.impl.jdbc.EmbedResultSet20.getBlob(EmbedResultS&lt;br/&gt;
et20.java:1552)&lt;/p&gt;

&lt;p&gt;	at &lt;br/&gt;
org.apache.derby.impl.drda.DRDAConnThread.writeFDODTA(DRDAConnTh&lt;br/&gt;
read.java:5871)&lt;/p&gt;

&lt;p&gt;	at &lt;br/&gt;
org.apache.derby.impl.drda.DRDAConnThread.writeQRYDTA(DRDAConnTh&lt;br/&gt;
read.java:5754)&lt;/p&gt;

&lt;p&gt;	at &lt;br/&gt;
org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDACo&lt;br/&gt;
nnThread.java:595)&lt;/p&gt;

&lt;p&gt;	at &lt;br/&gt;
org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.jav&lt;br/&gt;
a:226)&lt;/p&gt;

&lt;p&gt;It seems that network server is somehow closing the resultset &lt;br/&gt;
or committing too early. This problem may be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-213&quot; title=&quot;ResultSet.next() after last row of FORWARD_ONLY cursor throws an SQL Exception with Network Server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-213&quot;&gt;&lt;del&gt;DERBY-213&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;There seem to be some scenario in which Store throws this &lt;br/&gt;
ASSERTION instead of the proper user error if the blob is &lt;br/&gt;
accessed outside of the transaction, but we don&apos;t have a repro &lt;br/&gt;
outside of network server right now.&lt;/p&gt;



&lt;p&gt;This occurred with JCC 2.4. I have not tried it with derby client&lt;/p&gt;</description>
                <environment></environment>
        <key id="32326">DERBY-265</key>
            <summary>In Network Server retrieving BLOB values with autocommit off causes NullPointerException in INSANE build / AssertFailure in in BaseContainerHandle.getTransaction in SANE Build</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="skambha">Sunitha Kambhampati</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Sun, 8 May 2005 08:29:00 +0100</created>
                <updated>Sun, 5 Jun 2005 02:45:38 +0100</updated>
                            <resolved>Fri, 3 Jun 2005 07:19:58 +0100</resolved>
                                    <version>10.1.1.0</version>
                                    <fixVersion>10.1.1.0</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="65738" author="skambha" created="Thu, 19 May 2005 15:03:00 +0100"  >&lt;p&gt;MsgNpe does not have schema details etc. So attaching MsgNpe2.java -  a modified version of MsgNpe, which reproduces the problem mentioned in this bug.&lt;/p&gt;</comment>
                            <comment id="66922" author="skambha" created="Fri, 3 Jun 2005 07:19:58 +0100"  >&lt;p&gt;Committed revision 178803.&lt;/p&gt;

&lt;p&gt;Fix includes&lt;br/&gt;
&amp;#8211;    Adds check in  OverflowInputStream.initStream  to see if transaction of the container handle is null and throws a StandardException with SQLState.DATA_CONTAINER_CLOSED&lt;br/&gt;
&amp;#8211;    And at  the jdbc layer, this exception is wrapped with a user exception with an existing  SQLState XJ073             (SQLState.BLOB_ACCESSED_AFTER_COMMIT) for both getBlob and getClob.&lt;br/&gt;
The error message corresponding to this sqlstate is  &quot;The data in this Blob or Clob is no longer available. Possible reasons are that its transaction committed, or its  connection closed.&quot;&lt;br/&gt;
&amp;#8211;   Removed the ASSERT in BaseContainerHandle.getTransaction() &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="19949" name="MsgNpe.java" size="3352" author="kmarsden" created="Sun, 8 May 2005 08:33:36 +0100"/>
                            <attachment id="20153" name="MsgNpe2.java" size="5388" author="skambha" created="Thu, 19 May 2005 15:03:00 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 19 May 2005 14:03:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21868</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy187z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40982</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>