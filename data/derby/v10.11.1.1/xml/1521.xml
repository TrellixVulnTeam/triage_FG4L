<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:38:08 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1521/DERBY-1521.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1521] Upgrade test needs to be enhanced to test grant revoke</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1521</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Grant Revoke is one of the features targeted for 10.2 Release. The upgrade test should be modified to test this feature with various upgrade scenarios to make sure everything works fine.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12346113">DERBY-1521</key>
            <summary>Upgrade test needs to be enhanced to test grant revoke</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="deepa">Deepa Remesh</assignee>
                                    <reporter username="mamtas">Mamta A. Satoor</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Jul 2006 18:04:41 +0100</created>
                <updated>Thu, 13 Dec 2007 09:05:03 +0000</updated>
                            <resolved>Fri, 1 Sep 2006 20:39:24 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12422706" author="deepa" created="Fri, 21 Jul 2006 17:37:40 +0100"  >&lt;p&gt;Attaching a patch &apos;d1521-patch1-v1.diff&apos; which modifies UpgradeTester to test the grant/revoke feature. This is a preliminary patch which tests the default upgrade behaviour: In  upgrades from versions earlier than 10.2,&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;grant/revoke feature is not available in soft upgrade&lt;/li&gt;
	&lt;li&gt;grant/revoke feature is not available in full upgrade (by default). This feature will be available after full upgrade only if &quot;derby.database.sqlAuthorization&quot; is true.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The patch adds a method to UpgradeTester to test grant/revoke feature. This method currently checks that grant/revoke feature is not supported by issuing a grant command. I think we need to add more checks to this method. &lt;/p&gt;

&lt;p&gt;With this patch, I ran the upgrade test with sane classes and jars. This patch modifies only upgrade test. Please review/commit this patch if okay.&lt;/p&gt;

&lt;p&gt;As I mentioned before, this is a preliminary patch. More changes planned in subsequent patch(es):&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Test upgrade with derby.database.sqlAuthorization set&lt;/li&gt;
	&lt;li&gt;Add more checks to see grant/revoke feature not supported.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;grant/revoke not available on existing databases if derby.database.sqlAuthorization was not set to true during upgrade.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;Add basic tests to test grant/revoke feature works when upgraded with derby.database.sqlAuthorization set to true&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;grant/revoke works on the upgraded database&lt;/li&gt;
	&lt;li&gt;owner of system schemas is changed from pseudo user &apos;DBA&apos; to the authorizationID of the user invoking upgrade&lt;/li&gt;
	&lt;li&gt;check contents of new system tables related to grant/revoke&lt;/li&gt;
	&lt;li&gt;check that all tables and views will be owned by the database owner after upgrade.&lt;/li&gt;
	&lt;li&gt;check if it is better to add few basic tests to UpgradeTester or cover the testing by calling an existing grant/revoke test&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Do we need to cover anything else in the testing? &lt;/p&gt;</comment>
                            <comment id="12423477" author="djd" created="Tue, 25 Jul 2006 23:34:18 +0100"  >&lt;ul&gt;
	&lt;li&gt;Add basic tests to test grant/revoke feature works when upgraded with derby.database.sqlAuthorization set to true&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;owner of system schemas is changed from pseudo user &apos;DBA&apos; to the authorizationID of the user invoking upgrade&lt;br/&gt;
-----------------&lt;br/&gt;
Does this step happen regardless of the value of the property  derby.database.sqlAuthorization?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12423709" author="deepa" created="Wed, 26 Jul 2006 21:27:25 +0100"  >&lt;p&gt;For Dan&apos;s question: I think this is planned to be covered by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1544&quot; title=&quot;Address remaining upgrade task(s) to complete full upgrade mechanism for GRANT/REVOKE, specifically with changing database owner name from &amp;#39;DBA&amp;#39; to authorizationId of user invoking upgrade.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1544&quot;&gt;&lt;del&gt;DERBY-1544&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12423724" author="djd" created="Wed, 26 Jul 2006 23:08:17 +0100"  >&lt;p&gt;Patch Committed revision 425846.&lt;/p&gt;

&lt;p&gt;Two issues to be addressed though:&lt;/p&gt;

&lt;p&gt;1) The code that calls testGrantRevokeNotSupported() is a little confusing:&lt;/p&gt;

&lt;p&gt;+        case PH_SOFT_UPGRADE:&lt;br/&gt;
+        case PH_POST_SOFT_UPGRADE:&lt;br/&gt;
+        case PH_HARD_UPGRADE:&lt;br/&gt;
+        	if(grantRevokeNotSupported)&lt;br/&gt;
+        		passed = testGrantRevokeNotSupported(s, phase);&lt;br/&gt;
+ &lt;/p&gt;

&lt;p&gt;It would be good if this code continued to test correctly once this class supports the next  generation of upgrade.&lt;br/&gt;
So i think testGrantRevokeNotSupported would be always called, and pass in grantRevokeNotSupported, then&lt;br/&gt;
check the sql state for the exception based upon grantRevokeNotSupported and the phase.&lt;/p&gt;

&lt;p&gt;2) Should REVOKE be tested in the testGrantRevokeNotSupported()? (given the name of the method and  we want to ensure REVOKE fails as well)&lt;/p&gt;</comment>
                            <comment id="12423730" author="deepa" created="Wed, 26 Jul 2006 23:42:20 +0100"  >&lt;p&gt;Thanks Dan for looking at patch1. &lt;/p&gt;

&lt;p&gt;Answers to Dan&apos;s concerns:&lt;/p&gt;

&lt;p&gt;1) In the next patch I am working on, I will change &quot;testGrantRevokeNotSupported &quot; to &quot;testGrantRevokeSupport&quot; which will return pass/fail based on support for grant/revoke in a version/upgrade phase. Then same method can be called in all cases (for next generation of upgrade and also when we upgrade with sql authorization property set). &lt;/p&gt;

&lt;p&gt;2) Yes, I&apos;ll add REVOKE to the test.&lt;/p&gt;</comment>
                            <comment id="12423744" author="bandaram" created="Thu, 27 Jul 2006 01:06:49 +0100"  >&lt;p&gt;I seem to have missed one of Dan&apos;s questions about GRANT &amp;amp; REVOKE in this entry:&lt;/p&gt;

&lt;p&gt;&quot;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Add basic tests to test grant/revoke feature works when upgraded with derby.database.sqlAuthorization set to true&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;owner of system schemas is changed from pseudo user &apos;DBA&apos; to the authorizationID of the user invoking upgrade&lt;br/&gt;
-----------------&lt;br/&gt;
Does this step happen regardless of the value of the property derby.database.sqlAuthorization? &lt;br/&gt;
&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Yes... Current code is implemented such that authorizationID of the owner is recorded in system catalog for system schemas regardless of the value of property derby.database.sqlAuthorization. Updating system schema owner name during upgrade would facilitate switching over to SQL authorization mode later. In Derby authorization mode, this value is not used anyway.&lt;/p&gt;</comment>
                            <comment id="12424231" author="deepa" created="Sat, 29 Jul 2006 00:57:41 +0100"  >&lt;p&gt;Attaching a draft patch &apos;d1521-patch2-draft.diff&apos; which sets &quot;derby.database.sqlAuthorization&quot; for an upgraded database and tests that grant/revoke is available. This patch is not for commit as the upgrade test currently fails because of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1544&quot; title=&quot;Address remaining upgrade task(s) to complete full upgrade mechanism for GRANT/REVOKE, specifically with changing database owner name from &amp;#39;DBA&amp;#39; to authorizationId of user invoking upgrade.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1544&quot;&gt;&lt;del&gt;DERBY-1544&lt;/del&gt;&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1608&quot; title=&quot;Execution of builtin functions by a user who is not the owner of system schemas gives NPE when authentication and SQL authorization are on.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1608&quot;&gt;&lt;del&gt;DERBY-1608&lt;/del&gt;&lt;/a&gt;. Meantime, I am just posting this patch to get feedback. &lt;/p&gt;

&lt;p&gt;Tests are based on following understanding:&lt;br/&gt;
1) Grant/revoke feature is supported only if derby.database.sqlAuthorization is set to true&lt;br/&gt;
2) Grant/revoke feature available in 10.2 and higher versions&lt;br/&gt;
3) Related to upgrade, &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;grant/revoke feature is supported in following cases:&lt;br/&gt;
a)  hard upgrade to 10.2 or higher versions&lt;br/&gt;
b)  soft upgrade to versions higher than 10.2&lt;/li&gt;
	&lt;li&gt;grant/revoke feature is not supported in following cases:&lt;br/&gt;
c) soft upgrade to 10.2&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I have not covered 3b) in the current patch.&lt;/p&gt;

&lt;p&gt;Please provide feedback. Thanks.&lt;/p&gt;</comment>
                            <comment id="12424241" author="deepa" created="Sat, 29 Jul 2006 01:17:27 +0100"  >&lt;p&gt;Patch &apos;d1521-patch2-draft.diff &apos; available for review&lt;/p&gt;</comment>
                            <comment id="12424906" author="deepa" created="Tue, 1 Aug 2006 16:52:04 +0100"  >&lt;p&gt;Attaching patch &apos;d1521-patch2-v1.diff&apos; which is same as the draft patch &apos;d1521-patch2-draft.diff&apos;. Only difference is the new patch is based on later svn revision. With this patch, upgrade test passes as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1608&quot; title=&quot;Execution of builtin functions by a user who is not the owner of system schemas gives NPE when authentication and SQL authorization are on.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1608&quot;&gt;&lt;del&gt;DERBY-1608&lt;/del&gt;&lt;/a&gt; has been fixed by Satheesh. &lt;/p&gt;

&lt;p&gt;Please review/commit this patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="12425384" author="djd" created="Wed, 2 Aug 2006 22:36:57 +0100"  >&lt;p&gt;Patch d1521-patch2-v1.diff committed - Committed revision 428160. Thanks Deepa&lt;/p&gt;</comment>
                            <comment id="12425881" author="deepa" created="Fri, 4 Aug 2006 23:20:27 +0100"  >&lt;p&gt;Currently, only basic grant/revoke support is tested after upgrade. To run more grant/revoke tests after upgrade, I was thinking it may be good to run an existing grant/revoke test on an upgraded database. lang/grantRevokeDDL.sql seems to be a good candidate. I manually ran lang/grantRevokeDDL.sql on an upgraded database. With the patches for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1544&quot; title=&quot;Address remaining upgrade task(s) to complete full upgrade mechanism for GRANT/REVOKE, specifically with changing database owner name from &amp;#39;DBA&amp;#39; to authorizationId of user invoking upgrade.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1544&quot;&gt;&lt;del&gt;DERBY-1544&lt;/del&gt;&lt;/a&gt;, the test passes on an upgraded database. As this is a sql test, I do not see a way where I can pass in a different database (like an upgraded database) to the test. Converting this to a Java test seems to be an option. Thoughts/comments?&lt;/p&gt;</comment>
                            <comment id="12425904" author="djd" created="Sat, 5 Aug 2006 00:47:10 +0100"  >&lt;p&gt;Other options:&lt;br/&gt;
   1 - Use the new ij.runScript method to run the script, using a connection obtained in the upgrade test&lt;br/&gt;
   2 - wish all the tests were Junit ones then adding an additional test like this would be easy&lt;br/&gt;
   3 - convert all the tests to JUnit &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
   4 - convert the upgrade test to a Junit test as a first step&lt;br/&gt;
   5 - pick a task that helps the general effort in moving to Junit &lt;a href=&quot;http://wiki.apache.org/db-derby/KillDerbyTestHarness&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/KillDerbyTestHarness&lt;/a&gt;&lt;br/&gt;
   6 - spend time at the beach instead&lt;/p&gt;

&lt;p&gt;Seriously, I wouldn&apos;t work on converting this test to a java one while others are still implementing grant/revoke.&lt;br/&gt;
Option 1 might be interesting.&lt;/p&gt;</comment>
                            <comment id="12425908" author="deepa" created="Sat, 5 Aug 2006 01:10:11 +0100"  >&lt;p&gt;lang/grantRevokeDDL.sql test gets different connections as different users within the test . So I do not see a way where I can use ij.runScript directly. Maybe, I can specify the attributes for the secondary connections in &quot;ij.connection.&amp;lt;conn_name&amp;gt;&quot; properties. I&apos;ll give this a try. Thanks.&lt;/p&gt;</comment>
                            <comment id="12426698" author="deepa" created="Tue, 8 Aug 2006 21:11:40 +0100"  >&lt;p&gt;I found that after I change the existing test to use &quot;ij.connection.&amp;lt;conn_name&amp;gt;&quot; property, the test cannot be run with J2ME/foundation. &lt;/p&gt;</comment>
                            <comment id="12430266" author="rhillegas" created="Thu, 24 Aug 2006 16:14:42 +0100"  >&lt;p&gt;Bumping the urgency of this issue.&lt;/p&gt;</comment>
                            <comment id="12431750" author="deepa" created="Thu, 31 Aug 2006 01:06:37 +0100"  >&lt;p&gt;Current state of this issue - after upgrade, we test basic grant/revoke works and system tables are updated correctly.&lt;/p&gt;

&lt;p&gt;As mentioned earlier, it would be good to run the grant/revoke tests on the upgraded database. I tried running both the grant/revoke tests from the upgrade test but did not have much success. &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;In case of lang/grantRevokeDDL.sql, the script cannot be run directly as it has connect statements which refer to the database name directly.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;In case of grantRevoke.java, I modified the upgrade test to use the same user (who is the database owner in grantRevoke test) to perform the upgrade. Also modified the &quot;doIt&quot; method in grantRevoke test to take in a connection. So the upgrade test can call this method and pass in a connection to the upgraded database. This works okay and the setup part of the test runs fine. But I am not able to get new connection as other users from the test.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Any suggestions or other options to make these tests run from the upgrade test ? I think the same solution can also be used for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1522&quot; title=&quot;Switch(if supported) from Derby Authorization to Derby SQL Standard Authorization needs to be tested&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1522&quot;&gt;&lt;del&gt;DERBY-1522&lt;/del&gt;&lt;/a&gt; test. I would appreciate any help about how to proceed with this.&lt;/p&gt;</comment>
                            <comment id="12432214" author="deepa" created="Fri, 1 Sep 2006 20:39:24 +0100"  >&lt;p&gt;The following tests have been added to the upgrade test to test grant/revoke:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;grant/revoke feature is not available in soft upgrade&lt;/li&gt;
	&lt;li&gt;grant/revoke feature is not available in full upgrade (by default). This feature will be available after full upgrade only if &quot;derby.database.sqlAuthorization&quot; is true.&lt;/li&gt;
	&lt;li&gt;sets &quot;derby.database.sqlAuthorization&quot; for an upgraded database and tests basic grant/revoke works and system tables are updated correctly.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;As the upgrade test now covers grant/revoke testing, I&apos;m resolving this issue. I have opened a new issue &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1807&quot; title=&quot;Run more grant/revoke tests on an upgraded database&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1807&quot;&gt;DERBY-1807&lt;/a&gt; to add more grant/revoke tests to the upgrade test. &lt;/p&gt;</comment>
                            <comment id="12551372" author="fuzzylogic" created="Thu, 13 Dec 2007 09:05:03 +0000"  >&lt;p&gt;This issue has been resolved for over a year with no further movement. Closing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12312336">DERBY-464</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12337310" name="d1521-patch1-v1.diff" size="8359" author="deepa" created="Fri, 21 Jul 2006 17:37:40 +0100"/>
                            <attachment id="12337311" name="d1521-patch1-v1.status" size="281" author="deepa" created="Fri, 21 Jul 2006 17:37:40 +0100"/>
                            <attachment id="12337742" name="d1521-patch2-draft.diff" size="11715" author="deepa" created="Sat, 29 Jul 2006 00:57:41 +0100"/>
                            <attachment id="12337908" name="d1521-patch2-v1.diff" size="11715" author="deepa" created="Tue, 1 Aug 2006 16:52:04 +0100"/>
                            <attachment id="12337909" name="d1521-patch2-v1.status" size="281" author="deepa" created="Tue, 1 Aug 2006 16:52:04 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 21 Jul 2006 16:37:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30030</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy105z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39677</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10051"><![CDATA[Urgent]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>