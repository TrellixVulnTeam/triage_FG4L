<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:10:01 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-406/DERBY-406.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-406] Client DataSource should not require user property to be set</title>
                <link>https://issues.apache.org/jira/browse/DERBY-406</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;ClientDataSource should not require user to be set.  It should default to user APP as described in:&lt;br/&gt;
&lt;a href=&quot;http://incubator.apache.org/derby/docs/adminguide/cadminappsclient.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://incubator.apache.org/derby/docs/adminguide/cadminappsclient.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This all seems to work ok for for DriverManager connections but fails for ClientDataSource &lt;br/&gt;
run the attached repro &lt;/p&gt;


&lt;p&gt;$ java DataSourceNoUser&lt;br/&gt;
embedded no userid/password&lt;br/&gt;
client userid/password set&lt;br/&gt;
client no password&lt;br/&gt;
client no userid/no password&lt;br/&gt;
org.apache.derby.client.am.SqlException: null userid not supported&lt;br/&gt;
        at org.apache.derby.client.net.NetConnection.checkUser(NetConnection.java:998)&lt;br/&gt;
        at org.apache.derby.client.net.NetConnection.flowConnect(NetConnection.java:380)&lt;br/&gt;
        at org.apache.derby.client.net.NetConnection.initialize(NetConnection.java:233)&lt;br/&gt;
        at org.apache.derby.client.net.NetConnection.&amp;lt;init&amp;gt;(NetConnection.java:201)&lt;br/&gt;
        at org.apache.derby.jdbc.ClientDataSource.getConnection(ClientDataSource.java:156)&lt;br/&gt;
        at org.apache.derby.jdbc.ClientDataSource.getConnection(ClientDataSource.java:135)&lt;br/&gt;
        at DataSourceNoUser.main(DataSourceNoUser.java:42)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12311780">DERBY-406</key>
            <summary>Client DataSource should not require user property to be set</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="acadia_student_01">Philip Wilder</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Jun 2005 07:02:02 +0100</created>
                <updated>Thu, 26 Jan 2006 02:01:26 +0000</updated>
                            <resolved>Sun, 18 Sep 2005 01:05:16 +0100</resolved>
                                    <version>10.1.1.0</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.1.2.1</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12314907" author="acadia_student_01" created="Sat, 2 Jul 2005 04:08:46 +0100"  >&lt;p&gt;A Combined patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-406&quot; title=&quot;Client DataSource should not require user property to be set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-406&quot;&gt;&lt;del&gt;DERBY-406&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-409&quot; title=&quot;ClientDataSource setConnectionAttributes(&amp;quot;create=true&amp;quot;) fails with   &amp;quot;An attempt was made to access a database, mydbcreate=true, which was not found.&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-409&quot;&gt;&lt;del&gt;DERBY-409&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-410&quot; title=&quot;ClientDataSource should not require serverName/portNumber to  be set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-410&quot;&gt;&lt;del&gt;DERBY-410&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;#Warning#&lt;br/&gt;
When testing this patch there were locale (en_CA vs en_US) and version (10.2.0.0 vs 10.1.0.0) issues which I believe to be unique to my machine. While this should not affect anyone who wishes to test this patch, running the derbynetclientmats suite would be advisable prior to commit.&lt;/p&gt;

&lt;p&gt;For local the problem test was:&lt;br/&gt;
derbynet/sysinfo.java&lt;/p&gt;

&lt;p&gt;For version info the problem tests were:&lt;br/&gt;
jdbcapi/dbMetaDataJdbc30.java&lt;br/&gt;
jdbcapi/metadata.java&lt;br/&gt;
jdbcapi/odbc_metadata.java&lt;br/&gt;
jdbcapi/metadataJdbc20.java&lt;/p&gt;</comment>
                            <comment id="12314924" author="kmarsden" created="Sat, 2 Jul 2005 08:50:37 +0100"  >&lt;p&gt;I ran derbynetclientmatsand dataSourcePermissions_net.java under jcc for this  patch and all passed.  The patch looks good to me, but there are still some outstanding questions/comments from Dan, so I won&apos;t commit after all as I will be off-line for the next week.   Hopefully some other committer will pick this up after these issues are resolved.&lt;/p&gt;


&lt;p&gt;Dan&apos;s comments are in email at:&lt;br/&gt;
&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/db-derby-dev/200507.mbox/%3c42C5952B.8090304@debrunners.com%3e&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/db-derby-dev/200507.mbox/%3c42C5952B.8090304@debrunners.com%3e&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="12315009" author="acadia_student_01" created="Mon, 4 Jul 2005 22:51:51 +0100"  >&lt;p&gt;Sorry for any redundancy on this issue but I would like to make sure that everyone is on the same page as per the status of this patch.&lt;/p&gt;

&lt;p&gt;The July 1 patch makes the following changes:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Set user to default to &quot;APP&quot;&lt;/li&gt;
	&lt;li&gt;Set the default servername to &quot;localhost&quot;&lt;/li&gt;
	&lt;li&gt;Changed&lt;br/&gt;
 databaseName_ = dataSource.getDatabaseName() + attrString;&lt;br/&gt;
 to&lt;br/&gt;
 databaseName_ = dataSource.getDatabaseName() + &quot;;&quot; + attrString;&lt;br/&gt;
 in the connection class to avoid database names like myDBcreate=true when the setConnectionAttributes method is used.&lt;/li&gt;
	&lt;li&gt;Changed the dataSourcePermissions_net to include additional tests to check bug fixes and changed the associated.out file to match new output.&lt;/li&gt;
	&lt;li&gt;Commented sections of code associated with the fixes&lt;/li&gt;
	&lt;li&gt;Provided javadoc for new methods in dataSourcePermissions_net.java and the getPassword() method in ClientBaseDataSource.java&lt;/li&gt;
	&lt;li&gt;Changed the password, user and servername attributes to private so as to hopefully not conflict with his changes, as per his &quot;Client data source published api javadoc cleanup&quot; email.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12315084" author="djd" created="Wed, 6 Jul 2005 03:27:48 +0100"  >&lt;p&gt;Can you remove these changes from your patch?&lt;/p&gt;

&lt;p&gt;&amp;gt; - Changed the password, user and servername attributes to private so as to hopefully not conflict with his changes, as per his &quot;Client data source published api javadoc cleanup&quot; email. &lt;/p&gt;

&lt;p&gt;I need some more research to see if these changes are in fact correct.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Dan.&lt;/p&gt;</comment>
                            <comment id="12315137" author="acadia_student_01" created="Wed, 6 Jul 2005 23:31:56 +0100"  >&lt;p&gt;Removed the changes proposed by Dan Debrunner for an alternate patch.&lt;/p&gt;

&lt;p&gt;This patch makes the following changes&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Sets the username to start with the default value (&quot;APP&quot;, Derby-406 Fix)&lt;/li&gt;
	&lt;li&gt;Sets the server name to start with the default value (&quot;localhost&quot;, Derby-410 Fix)&lt;/li&gt;
	&lt;li&gt;Adds a semi-colon in the connection class to avoid databasenames like&lt;br/&gt;
myDBcreate=true resulting from no dividing semi-colon (Deby-409 Fix).&lt;/li&gt;
	&lt;li&gt;Add javadoced methods in the derbynet/dataSourcePermissions_net.java file to test this new functionality&lt;/li&gt;
	&lt;li&gt;Altered the output file for derbynet/dataSourcePermissions_net.java to accomodate for new tests.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Running the suite derbynetclientmats caused no problems. Running derbyall cause a single problem of the form:&lt;br/&gt;
 org.apache.derby.iapi.services.context.ShutdownException:&lt;br/&gt;
 agentThread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_5,5,derby.daemons&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Further investigation revealed that this was an intermittant problem for both the clean version of derby and my patched version. I ran 3 groups of test, each group running derbynet/dataSourcePermissions_net.java 20 times and these were my results (Apologies if there are formatting errors here):&lt;br/&gt;
                    Clean            Patched&lt;br/&gt;
Test 1     1/20 (5%)          5/20   (25%)&lt;br/&gt;
Test 2     3/20 (15%)        3/20   (15%)&lt;br/&gt;
Test 3     3/20 (15%)        4/20   (20%)&lt;br/&gt;
Total       7/60 (11.66%)   12/60 (20%)&lt;/p&gt;

&lt;p&gt;While the patched version does have a somewhat higher error rate it should be noted that as part of my added tests I add two additional calls to the dataSourcePermissions_net.java shutdown method.&lt;/p&gt;</comment>
                            <comment id="12315153" author="djd" created="Thu, 7 Jul 2005 02:56:17 +0100"  >&lt;p&gt;I&apos;m working on committing this patch, currently looking at the shutdown exceptions.&lt;/p&gt;</comment>
                            <comment id="12315155" author="acadia_student_01" created="Thu, 7 Jul 2005 03:21:40 +0100"  >&lt;p&gt;I think the issue of intermittent failures of this test is discussed in the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-273&quot; title=&quot;The derbynet/dataSourcePermissions_net.java test fails intermittently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-273&quot;&gt;&lt;del&gt;DERBY-273&lt;/del&gt;&lt;/a&gt; issue.&lt;/p&gt;</comment>
                            <comment id="12315168" author="djd" created="Thu, 7 Jul 2005 05:01:51 +0100"  >&lt;p&gt;Committed Revision: 209498 ( Derby406_409_410.patch)&lt;br/&gt;
As Phil pointed out,  &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-273&quot; title=&quot;The derbynet/dataSourcePermissions_net.java test fails intermittently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-273&quot;&gt;&lt;del&gt;DERBY-273&lt;/del&gt;&lt;/a&gt; already covers the test failure.&lt;/p&gt;

&lt;p&gt;I do not believe that this patch fully addresses these issues so they should not be closed, though it is good progress.&lt;br/&gt;
My concern is about the concept of defaults for DataSource properties, in these cases&lt;/p&gt;

&lt;p&gt;406 - user - default of APP&lt;br/&gt;
409 - connectionAttributes - default of  empty string&lt;br/&gt;
410 - serverName -  default of localhost&lt;/p&gt;

&lt;p&gt;All these properties are set to the default when the object is created, however if the values are set to null&lt;br/&gt;
(e.g. setConnecitonAttributes(null)) then should their values revert to the default or remain at null?&lt;br/&gt;
Existing data sources do not have any properties that have a default.&lt;/p&gt;

&lt;p&gt;In the case that the property remains at null, then tests would be needed to ensure null is handled correctly,&lt;br/&gt;
at least for connectionAttributes I think a NullPointerException will occur.&lt;/p&gt;</comment>
                            <comment id="12315172" author="acadia_student_01" created="Thu, 7 Jul 2005 05:49:53 +0100"  >&lt;p&gt;&quot;Existing data sources do not have any properties that have a default.&quot;&lt;/p&gt;

&lt;p&gt;Perhaps I am misunderstanding your comment. While EmbeddedSimpleDataSource did not have any default values ClientCaseDataSource is more of a mixed bag. There already existed propertyDefaults for  loginTimeout, portNumber, securityMechanism, retrieveMessageText and others. Even user had a propertyDefault of &quot;APP&quot; prior to the patch, it was simply not set. &lt;/p&gt;

&lt;p&gt;This said I acknowledge that it is an ongoing derby goal to have Client functionality more closely match Embedded. However, if this is the case then it might be necessary to undo considerably more then just user and servername. &lt;/p&gt;</comment>
                            <comment id="12315174" author="djd" created="Thu, 7 Jul 2005 06:14:21 +0100"  >&lt;p&gt;I meant, prior to the client data sources, Derby&apos;s embedded implementation of DataSource apis did not have the concept for default values for any of their Java Bean properties. Thus this default concept is new to Derby.&lt;br/&gt;
Note that the Derby &lt;b&gt;engine&lt;/b&gt; provides the default of APP for the user name., not EmbeddedDataSource. Its getUser method (corrresponding to its user property) will return null for a newly created EmbeddedDataSource.&lt;/p&gt;

&lt;p&gt;So I&apos;m not saying defaults are bad, just that we need to define what happens if the property is set to null, does it mean the property returns to its default value, or does it take on the null value? The point about no prior defaults means there is no prior behaviour to follow.&lt;/p&gt;</comment>
                            <comment id="12315197" author="djd" created="Thu, 7 Jul 2005 10:16:12 +0100"  >&lt;p&gt;One more minor issue for 409, the code currently has a default of &quot;&quot; (empty string) for connectionAttributes, but the functional spec&lt;br/&gt;
&lt;a href=&quot;http://incubator.apache.org/derby/papers/DerbyClientSpec.html#data_source_props&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://incubator.apache.org/derby/papers/DerbyClientSpec.html#data_source_props&lt;/a&gt;&lt;br/&gt;
indicates no default for this property. It&apos;s probably related to the code that uses the property will give a NPE if connectionAttributes is null.&lt;br/&gt;
Kathey implies in 409 that it should only be used &quot;if set&quot;&lt;/p&gt;</comment>
                            <comment id="12316290" author="bandaram" created="Thu, 21 Jul 2005 11:58:52 +0100"  >&lt;p&gt;Ported this fix from trunk to 10.1 with change number: 209498&lt;/p&gt;</comment>
                            <comment id="12329458" author="acadia_student_01" created="Fri, 16 Sep 2005 04:20:22 +0100"  >&lt;p&gt;Freeing this issue to anyone else who sees a way in which Dan&apos;s concerns about a lack of prior behaviour can be addressed.&lt;/p&gt;</comment>
                            <comment id="12329610" author="acadia_student_01" created="Sun, 18 Sep 2005 01:05:16 +0100"  >&lt;p&gt;The July 6, patch addressed the original concerns of this issue. While Dan brought up the potential issue of null handling further investigations appear to indicate null values are handled appropriately.&lt;/p&gt;</comment>
                            <comment id="12329887" author="kmarsden" created="Tue, 20 Sep 2005 03:55:35 +0100"  >&lt;p&gt;This did not actually go in until 10.1.2&lt;/p&gt;</comment>
                            <comment id="12330823" author="deepa" created="Fri, 30 Sep 2005 02:39:15 +0100"  >&lt;p&gt;Add fix version 10.1.1.1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12311011" name="DataSourceNoUser.java" size="2515" author="kmarsden" created="Thu, 30 Jun 2005 07:02:57 +0100"/>
                            <attachment id="12311097" name="Derby406_409_410.patch" size="10809" author="acadia_student_01" created="Wed, 6 Jul 2005 23:31:56 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 2 Jul 2005 03:08:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21936</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy179z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40829</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>