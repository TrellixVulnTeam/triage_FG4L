<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:16:02 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3280/DERBY-3280.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3280] Poor distribution of hash values from RecordId.hashCode()</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3280</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The hash values returned by RecordId.hashCode() are constructed by performing bitwise xor on the 32 least significant bits of the record number, the page number, the container id and the segment id. Since all of these values tend to be relatively small positive integers, the hash values also tend to be clustered in a very small range. This leads to a higher frequency of hash collisions in the lock table, which makes the hash tables work less efficiently and thereby reduces the performance.&lt;/p&gt;

&lt;p&gt;As an example, the simple join load in the test client attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1961&quot; title=&quot;Investigate resource usage for different types of load on an in-memory database&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1961&quot;&gt;&lt;del&gt;DERBY-1961&lt;/del&gt;&lt;/a&gt; uses two tables, TENKTUP and ONEKTUP, with 10000 rows and 1000 rows, respectively. The RecordIds for these 11000 rows map to less than 900 distinct hash codes.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12384708">DERBY-3280</key>
            <summary>Poor distribution of hash values from RecordId.hashCode()</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Sat, 15 Dec 2007 18:38:45 +0000</created>
                <updated>Mon, 29 Jun 2009 15:02:05 +0100</updated>
                            <resolved>Mon, 17 Dec 2007 10:36:38 +0000</resolved>
                                    <version>10.4.1.3</version>
                                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Services</component>
                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12552277" author="knutanders" created="Sun, 16 Dec 2007 19:13:34 +0000"  >&lt;p&gt;The attached patch (d3280.diff) changes the hashCode() methods in RecordId and PageKey. I let NetBeans generate the methods for me, and as far as I can tell, they use the approach described in Item 8 of Effective Java (&lt;a href=&quot;http://java.sun.com/docs/books/effective/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://java.sun.com/docs/books/effective/&lt;/a&gt;). I made some small changes to the generated methods, like removing null checks for fields that shouldn&apos;t ever be null. With these new methods, the 11000 records mentioned above all have distinct hash codes.&lt;/p&gt;

&lt;p&gt;To see the potential performance impact of the change, I had to make the following changes to the test client attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1961&quot; title=&quot;Investigate resource usage for different types of load on an in-memory database&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1961&quot;&gt;&lt;del&gt;DERBY-1961&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;use 16 sets of tables to increase the rate of collisions&lt;/li&gt;
	&lt;li&gt;let a repeatable read transaction obtain locks on all rows before the test starts, and keep them until the test stops, so that we know there are records to collide with in the lock table&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;With this modified test, the patch increased the performance for 16 concurrent clients running simple joins from ~32 tx/s to ~70 tx/s. Without the patch, the profiler told me that about 50% of the CPU was spent in RecordId.equals().&lt;/p&gt;

&lt;p&gt;Now, these numbers come from a test hand-crafted to show this particular problem, so I wouldn&apos;t expect any real-world applications to see similar improvements. Still, the test shows that, with some bad luck, one may notice a significant performance degradation because of the poor distribution of hash codes.&lt;/p&gt;</comment>
                            <comment id="12552366" author="knutanders" created="Mon, 17 Dec 2007 10:36:38 +0000"  >&lt;p&gt;Committed revision 604818.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12371762" name="TestClient.java" size="11355" author="knutanders" created="Sun, 16 Dec 2007 19:13:34 +0000"/>
                            <attachment id="12371761" name="d3280.diff" size="1182" author="knutanders" created="Sun, 16 Dec 2007 19:13:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10362"><![CDATA[Performance]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30793</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0wqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39121</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>