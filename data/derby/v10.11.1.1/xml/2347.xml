<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:45:23 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2347/DERBY-2347.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2347] Add code to support request and return of locators over DRDA</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2347</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Make the client able to send DRDA OUTOVR commands to request locators from&lt;br/&gt;
  Network Server.&lt;/li&gt;
	&lt;li&gt;Make the network server send locators instead of LOB values if locators has been&lt;br/&gt;
  requested.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This JIRA will not activate the code that request locators since the client is not yet able to handle locators. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12363011">DERBY-2347</key>
            <summary>Add code to support request and return of locators over DRDA</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="31583">DERBY-208</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="oysteing">&#216;ystein Gr&#248;vlen</assignee>
                                    <reporter username="oysteing">&#216;ystein Gr&#248;vlen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Feb 2007 13:35:45 +0000</created>
                <updated>Wed, 21 Mar 2007 07:47:36 +0000</updated>
                            <resolved>Wed, 7 Mar 2007 13:44:15 +0000</resolved>
                                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Network Client</component>
                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12473706" author="oysteing" created="Fri, 16 Feb 2007 14:02:47 +0000"  >&lt;p&gt;This work will be dependent on the Locator to LOB mapping that is part of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2257&quot; title=&quot;Implementing the stored procedures called by the LOB related JDBC methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2257&quot;&gt;&lt;del&gt;DERBY-2257&lt;/del&gt;&lt;/a&gt; . &lt;/p&gt;</comment>
                            <comment id="12474444" author="oysteing" created="Tue, 20 Feb 2007 13:58:57 +0000"  >&lt;p&gt;The attached patch, &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2347&quot; title=&quot;Add code to support request and return of locators over DRDA&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2347&quot;&gt;&lt;del&gt;DERBY-2347&lt;/del&gt;&lt;/a&gt;.diff, adds the necessary code for the&lt;br/&gt;
client to request locators to be sent instead of LOB values, and the&lt;br/&gt;
corresponding code for the network server to handle such requests.&lt;br/&gt;
This is achieved by using the DRDA OUTOVR (Output Override) command&lt;br/&gt;
with the the first CNTQRY command for a query.  It turned out that&lt;br/&gt;
much of the necessary code for generating and handling OUTOVR was&lt;br/&gt;
already there, and only few missing pieces were needed to get this to&lt;br/&gt;
work.&lt;/p&gt;

&lt;p&gt;For now, the client will not request the use of locators since it is&lt;br/&gt;
not yet able to handle locators.  (This will be added in (several)&lt;br/&gt;
later patches.)&lt;/p&gt;

&lt;p&gt;The DRDA spec also describes an outovropt parameter to the OPNQRY&lt;br/&gt;
command.  This can be used to specify whether an OUTOVR command will&lt;br/&gt;
only be sent with the first CNTQRY for the query, or it can be sent&lt;br/&gt;
with any CNTQRY.  As stated above, this implementation will only send&lt;br/&gt;
OUTOVR with the first CNTQRY, and since DRDA specifies this as the&lt;br/&gt;
default behavior, I have not used the outovropt parameter.  There is&lt;br/&gt;
currently nothing in the network server that rely on OUTOVR only being&lt;br/&gt;
used with the first CNTQRY, and no error is returned should later&lt;br/&gt;
CNTQRY countain OUTOVR.&lt;/p&gt;

&lt;p&gt;Note that this patch is dependent on the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2257&quot; title=&quot;Implementing the stored procedures called by the LOB related JDBC methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2257&quot;&gt;&lt;del&gt;DERBY-2257&lt;/del&gt;&lt;/a&gt; and&lt;br/&gt;
should not be committed until that is committed.I have run the junit&lt;br/&gt;
and derbyall test suites with this patch and the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2257&quot; title=&quot;Implementing the stored procedures called by the LOB related JDBC methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2257&quot;&gt;&lt;del&gt;DERBY-2257&lt;/del&gt;&lt;/a&gt;,&lt;br/&gt;
and no new errors was seen.&lt;/p&gt;

&lt;p&gt;A more detailed explanation of the changes:&lt;/p&gt;

&lt;p&gt;M      java/drda/org/apache/derby/impl/drda/DRDAResultSet.java&lt;/p&gt;

&lt;p&gt;       If the client has requested an output type to be overridden,&lt;br/&gt;
       return the requested type.&lt;/p&gt;

&lt;p&gt;M      java/drda/org/apache/derby/impl/drda/DRDAConnThread.java&lt;/p&gt;

&lt;p&gt;       If the output type is a locator type, add the LOB reference to&lt;br/&gt;
       the locator-to-LOB-mapping of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2257&quot; title=&quot;Implementing the stored procedures called by the LOB related JDBC methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2257&quot;&gt;&lt;del&gt;DERBY-2257&lt;/del&gt;&lt;/a&gt;, and write the&lt;br/&gt;
       returned locator as an integer.&lt;/p&gt;

&lt;p&gt;M      java/client/org/apache/derby/client/net/CodePointNameTable.java&lt;/p&gt;

&lt;p&gt;       Add tracing text for the DRDA OUTOVR command.  (This is for&lt;br/&gt;
       client, already existed in the server version of this file.)&lt;/p&gt;

&lt;p&gt;M      java/client/org/apache/derby/client/net/NetResultSetRequest.java&lt;/p&gt;

&lt;p&gt;       Replaced the no-op code of buildOUTOVR() with the code to&lt;br/&gt;
       actually build the command.  Only build it on the first CNTQRY&lt;br/&gt;
       command.  This code will remain disabled until the necessary&lt;br/&gt;
       changes is made to make the client able to handle locators.&lt;/p&gt;

&lt;p&gt;M      java/client/org/apache/derby/client/net/NetStatementRequest.java&lt;/p&gt;

&lt;p&gt;       In OUTOVR commands, the client will request locators for all&lt;br/&gt;
       LOB columns.  4 bytes will be used for locators.&lt;/p&gt;</comment>
                            <comment id="12474482" author="kristwaa" created="Tue, 20 Feb 2007 16:13:06 +0000"  >&lt;p&gt;Removed trailing spaces from and refreshed the patch (attached &apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2347&quot; title=&quot;Add code to support request and return of locators over DRDA&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2347&quot;&gt;&lt;del&gt;DERBY-2347&lt;/del&gt;&lt;/a&gt;-v1.diff&apos;).&lt;br/&gt;
I looked at the changes and they look reasonable.&lt;br/&gt;
Even though the patch is small, another review from someone that knows DRDA stuff might be useful.&lt;/p&gt;

&lt;p&gt;Note that the issue is still blocked and this patch must not be committed yet.&lt;/p&gt;</comment>
                            <comment id="12474873" author="bryanpendleton" created="Wed, 21 Feb 2007 23:33:11 +0000"  >&lt;p&gt;Why is the request to use locator format set on the CNTQRY rather than on the OPENQRY? I&apos;m concerned about the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-822&quot; title=&quot;Client driver: Pre-fetch data on executeQuery()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-822&quot;&gt;&lt;del&gt;DERBY-822&lt;/del&gt;&lt;/a&gt; pre-fetching behavior; isn&apos;t it necessary to send output format behavior requests like these on the OPENQRY message so that they are honored even if the server does pre-fetching?&lt;/p&gt;</comment>
                            <comment id="12474930" author="knutanders" created="Thu, 22 Feb 2007 07:28:52 +0000"  >&lt;p&gt;I don&apos;t think the DRDA protocol allows pre-fetching when the result contains LOBs. I haven&apos;t checked what the spec says, but I found these comments in DRDAConnThread:&lt;/p&gt;

&lt;p&gt;processCommands():&lt;br/&gt;
							if (stmt.getQryprctyp() == CodePoint.LMTBLKPRC &amp;amp;&amp;amp;&lt;br/&gt;
									stmt.getQryrowset() != 0) {&lt;br/&gt;
								// The DRDA spec allows us to send&lt;br/&gt;
								// QRYDTA here if there are no LOB&lt;br/&gt;
								// columns.&lt;/p&gt;

&lt;p&gt;parseEXCSQLSTT():&lt;br/&gt;
			/* Currently, if LMTBLKPRC is used, a pre-condition is that no lob columns.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;But in the future, when we do support LOB in LMTBLKPRC, the drda spec still&lt;/li&gt;
	&lt;li&gt;does not allow LOB to be sent with OPNQRYRM.  So this &quot;if&quot; here will have&lt;/li&gt;
	&lt;li&gt;to add &quot;no lob columns&quot;.&lt;br/&gt;
			 */&lt;br/&gt;
			if (stmt.getQryprctyp() == CodePoint.LMTBLKPRC)&lt;br/&gt;
				writeQRYDTA(stmt);&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12474932" author="oysteing" created="Thu, 22 Feb 2007 07:45:36 +0000"  >&lt;p&gt;As far as I can see, the DRDA protocol does not provide any ways to request locators as part of the OPNQRY.&lt;/p&gt;

&lt;p&gt;Anyhow, the client will be made so that it also handles receiving LOBs when it had requested locators.  Hence,  should pre-fetching include LOBs, which I do not think it does, it should still work.&lt;/p&gt;

&lt;p&gt;If LOBs where small, it would be desireable to allow prefetching.  However, if LOBs are small, you ideally would want the LOB values, not locators.  Since the client will handle LOB values, anyway, I have been thinking about sending values instead of locators if LOBs are small, but I suspect that would be a violation of the DRDA protocol. &lt;/p&gt;</comment>
                            <comment id="12475116" author="bryanpendleton" created="Thu, 22 Feb 2007 18:27:42 +0000"  >&lt;p&gt;Thanks Knut Anders and Oystein. That makes complete sense. If you haven&apos;t already done so, it might be worth updating the comment that Knut Anders referenced to explain this nuance of locator handling as part of your patch.&lt;/p&gt;</comment>
                            <comment id="12478719" author="oysteing" created="Wed, 7 Mar 2007 09:08:49 +0000"  >&lt;p&gt;Since DErBY-2257 has now been committed, this patch is ready for commit.&lt;/p&gt;</comment>
                            <comment id="12478726" author="kristwaa" created="Wed, 7 Mar 2007 09:43:20 +0000"  >&lt;p&gt;I&apos;m running tests on this patch, and will commit late today or tomorrow.&lt;/p&gt;

&lt;p&gt;I did not quite understand the request for an update of the comment(s) referenced, so I think more info is required for that update to happen.&lt;/p&gt;</comment>
                            <comment id="12478767" author="kristwaa" created="Wed, 7 Mar 2007 13:44:15 +0000"  >&lt;p&gt;Committed patch to trunk with revision 515563.&lt;/p&gt;

&lt;p&gt;Ran derbyall and suites.All with Sun JDK 5.0. Only setTransactionIsolationLevel failed (which I believe has been fixed by now).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12360843">DERBY-2257</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12351603" name="DERBY-2347-v1.diff" size="4246" author="kristwaa" created="Tue, 20 Feb 2007 16:13:05 +0000"/>
                            <attachment id="12351586" name="DERBY-2347.diff" size="4309" author="oysteing" created="Tue, 20 Feb 2007 13:58:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 20 Feb 2007 16:13:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30396</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy12rr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40099</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>