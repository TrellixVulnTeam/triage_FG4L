<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:11:06 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4829/DERBY-4829.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4829] dblook fails if there is a column privilege on a table whose name contains a quote</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4829</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Create a table with a column privilege like this in ij:&lt;/p&gt;

&lt;p&gt;connect &apos;jdbc:derby:db;create=true&apos;;&lt;br/&gt;
call syscs_util.syscs_set_database_property(&apos;derby.database.sqlAuthorization&apos;, &apos;true&apos;);&lt;br/&gt;
create table &quot;&quot;&quot;&quot; (x int);&lt;br/&gt;
disconnect;&lt;br/&gt;
connect &apos;jdbc:derby:db;shutdown=true&apos;;&lt;br/&gt;
connect &apos;jdbc:derby:db&apos;;&lt;br/&gt;
grant select &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; on &quot;&quot;&quot;&quot; to someone;&lt;br/&gt;
exit;&lt;/p&gt;

&lt;p&gt;If you then run dblook -d jdbc:derby:db, you&apos;ll see this:&lt;/p&gt;

&lt;p&gt;&amp;#8211; ----------------------------------------------&lt;br/&gt;
&amp;#8211; GRANT statements for columns&lt;br/&gt;
&amp;#8211; ----------------------------------------------&lt;/p&gt;

&lt;p&gt;&amp;#8211; Note: At least one unexpected error/warning message was&lt;br/&gt;
&amp;#8211; encountered during DDL generation.  See dblook.log&lt;br/&gt;
&amp;#8211; to review the message(s).&lt;/p&gt;

&lt;p&gt;And in dblook.log you&apos;ll find this:&lt;/p&gt;

&lt;p&gt;java.sql.SQLException: Invalid cursor state - no current row.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.newSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.ConnectionChild.newSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedResultSet.checkOnRow(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedResultSet.getColumn(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedResultSet.getString(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.tools.dblook.DB_GrantRevoke.mapColumnsToNames(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.tools.dblook.DB_GrantRevoke.columnPrivStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.tools.dblook.DB_GrantRevoke.generateColumnPrivs(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.tools.dblook.DB_GrantRevoke.doAuthorizations(Unknown Source)&lt;br/&gt;
	at org.apache.derby.tools.dblook.go(Unknown Source)&lt;br/&gt;
	at org.apache.derby.tools.dblook.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.tools.dblook.main(Unknown Source)&lt;br/&gt;
Caused by: java.sql.SQLException: Invalid cursor state - no current row.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source)&lt;br/&gt;
	... 16 more&lt;br/&gt;
&amp;#8211; **--&amp;gt; DEBUG: Invalid cursor state - no current row.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12475586">DERBY-4829</key>
            <summary>dblook fails if there is a column privilege on a table whose name contains a quote</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Oct 2010 10:06:48 +0100</created>
                <updated>Mon, 29 Nov 2010 14:20:12 +0000</updated>
                            <resolved>Thu, 7 Oct 2010 10:29:15 +0100</resolved>
                                    <version>10.6.2.1</version>
                                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12916835" author="knutanders" created="Fri, 1 Oct 2010 10:15:50 +0100"  >&lt;p&gt;The reason for this is that DB_GrantRevoke.generateColumnPrivs() generates a query:&lt;/p&gt;

&lt;p&gt;			String queryCols = &quot;SELECT COLUMNNUMBER, COLUMNNAME &quot; +&lt;br/&gt;
				&quot;FROM SYS.SYSCOLUMNS C, SYS.SYSTABLES T, SYS.SYSSCHEMAS S &quot; +&lt;br/&gt;
				&quot;WHERE T.TABLEID = C.REFERENCEID and S.SCHEMAID = T.SCHEMAID &quot;+&lt;br/&gt;
				&quot;and T.TABLENAME = &apos;&quot;&lt;ins&gt;tableName&lt;/ins&gt;&quot;&apos; AND SCHEMANAME = &apos;&quot;+schemaName +&lt;br/&gt;
				&quot;&apos; ORDER BY COLUMNNUMBER&quot;;&lt;/p&gt;

&lt;p&gt;tableName and schemaName have been pre-processed so that all their double quotes have been expanded to two double quotes. This would be correct if they were used as identifiers in the query, but since they are used as string literals, it&apos;s their single quotes that should have been expanded, not their double quotes.&lt;/p&gt;

&lt;p&gt;This query therefore doesn&apos;t produce any results. If the table names had contained single quotes, the query would have failed with a syntax error.&lt;/p&gt;</comment>
                            <comment id="12916837" author="knutanders" created="Fri, 1 Oct 2010 10:17:00 +0100"  >&lt;p&gt;Made the summary more general since this bug affects both single and double quotes.&lt;/p&gt;</comment>
                            <comment id="12916850" author="knutanders" created="Fri, 1 Oct 2010 11:16:10 +0100"  >&lt;p&gt;And when the query is fixed, the generated GRANT statement that&apos;s printed by dblook won&apos;t be usable because&lt;/p&gt;

&lt;p&gt;a) column names are not quoted&lt;/p&gt;

&lt;p&gt;b) the table name is missing&lt;/p&gt;</comment>
                            <comment id="12916855" author="knutanders" created="Fri, 1 Oct 2010 11:55:08 +0100"  >&lt;p&gt;When I&apos;m adding a test case for this in dblook_test, I also see that the GRANT statements for the column privileges are not correctly excluded if dblook is called with -t. This makes dblook_test print an error message. I think this also affects other GRANT statements produced by dblook, but dblook_test doesn&apos;t currently test any privileges, so that&apos;s not exposed. I&apos;ll just let dblook_test&apos;s canons expect these errors for now, and file a separate issue for fixing the exclusion logic for GRANT statements.&lt;/p&gt;</comment>
                            <comment id="12916856" author="knutanders" created="Fri, 1 Oct 2010 12:29:11 +0100"  >&lt;p&gt;Here&apos;s a patch with a fix and a test case.&lt;/p&gt;

&lt;p&gt;Description of the changes:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;impl/tools/dblook/DB_GrantRevoke.java:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;generateColumnPrivs:&lt;br/&gt;
Use a prepared statement instead of a statement so that the schema name and table name can be parameters. This avoids the trouble with having to quote them as string literals with single quotes. (We still need to quote them as identifiers with double quotes some places, but that was done correctly in the existing code.)&lt;/p&gt;

&lt;p&gt;generateColumnPrivs:&lt;br/&gt;
Also remember to close the statement and result set.&lt;/p&gt;

&lt;p&gt;mapColumnsToNames:&lt;br/&gt;
Quote the column names in the generated GRANT statement.&lt;/p&gt;

&lt;p&gt;columnPrivStatement:&lt;br/&gt;
Add the missing &quot;ON &amp;lt;schema name&amp;gt;.&amp;lt;table name&amp;gt;&quot; part of the generated GRANT statement.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;tests/tools/dblook_makeDB.sql:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Created table with special characters in name/columns and granted column privileges. Without the fix, this made the different variants of dblook_test fail because the dblook error log was not empty, and also because the dblook output got some extra statements.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;functionTests/master/*&lt;b&gt;/dblook_test&lt;/b&gt;.out:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Updated the canons for the dblook_test variants so that they expect the extra output caused by the new database objects added in dblook_makeDB.sql. Some of the canons also got this error text added, because of the bug in the table exclusion logic mentioned in my previous comment:&lt;/p&gt;

&lt;p&gt;+FAILED: to execute cmd from DDL script:&lt;br/&gt;
+GRANT SELECT(&quot;&apos;Single&apos; and &quot;&quot;double&quot;&quot; quoted column name&quot;) ON &quot;&apos;Single&apos; and &quot;&quot;double&quot;&quot; quoted schema name&quot;.&quot;&apos;Single&apos; and &quot;&quot;double&quot;&quot; quoted table name&quot; TO &quot;SOMEONE&quot;&lt;br/&gt;
+Schema &apos;&apos;Single&apos; and &quot;double&quot; quoted schema name&apos; does not exist&lt;/p&gt;

&lt;p&gt;I have only run the following tests yet:&lt;/p&gt;

&lt;p&gt;tools/dblook_test.java&lt;br/&gt;
tools/dblook_test_territory.java&lt;br/&gt;
derbynet/dblook_test_net.java (client and JCC)&lt;br/&gt;
derbynet/dblook_test_net_territory.java (client and JCC)&lt;/p&gt;

&lt;p&gt;I&apos;ll run the full regression test suite and come back with the results.&lt;/p&gt;</comment>
                            <comment id="12917563" author="knutanders" created="Mon, 4 Oct 2010 12:20:51 +0100"  >&lt;p&gt;All the regression tests ran cleanly.&lt;/p&gt;</comment>
                            <comment id="12918854" author="knutanders" created="Thu, 7 Oct 2010 10:29:15 +0100"  >&lt;p&gt;Committed revision 1005362.&lt;/p&gt;

&lt;p&gt;I&apos;ve logged the bug in the table exclusion logic as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4838&quot; title=&quot;dblook outputs GRANT statements for ignored tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4838&quot;&gt;DERBY-4838&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Closing this issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12476756">DERBY-4838</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12456105" name="derby-4829-1a.diff" size="15850" author="knutanders" created="Fri, 1 Oct 2010 12:29:11 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24485</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0p2v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37881</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>