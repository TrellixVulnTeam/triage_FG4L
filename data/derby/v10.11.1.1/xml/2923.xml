<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:53:36 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2923/DERBY-2923.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2923] Incorrect reading of nullable Blob/Clob columns during soft upgrade with client/server</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2923</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Select operations with client/server and soft upgrade mode will not see first byte of the Blob/Clob if the LOB column is nullable.&lt;/p&gt;

&lt;p&gt;The reason seems to be that during soft upgrade, the network server does not prepend the LOB data with the byte indicating whether the column is null or not.  Hence, the first data byte will be interpreted by the client as the null byte, and the reading of the LOB will start at the second byte.&lt;/p&gt;</description>
                <environment>Client/server soft upgrade</environment>
        <key id="12373509">DERBY-2923</key>
            <summary>Incorrect reading of nullable Blob/Clob columns during soft upgrade with client/server</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="oysteing">&#216;ystein Gr&#248;vlen</assignee>
                                    <reporter username="oysteing">&#216;ystein Gr&#248;vlen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Jul 2007 13:52:18 +0100</created>
                <updated>Tue, 30 Jun 2009 16:55:55 +0100</updated>
                            <resolved>Fri, 13 Jul 2007 12:59:55 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12511748" author="oysteing" created="Wed, 11 Jul 2007 14:02:52 +0100"  >&lt;p&gt;This application can be used to reproduce the problem.  Do as follows.&lt;/p&gt;

&lt;p&gt;1. Create a database with 10.2, and disconnect.&lt;br/&gt;
2. Start a 10.3 server.&lt;br/&gt;
3. Run attached application using the 10.3 derbyclient.jar &lt;/p&gt;</comment>
                            <comment id="12511749" author="oysteing" created="Wed, 11 Jul 2007 14:10:40 +0100"  >&lt;p&gt;I think this bug requires a new release candidate.  Blob/Clob will not work correctly in soft upgrade mode if this is not corrected.  I thought I had tested this earlier, but I must have done a mix-up of versions or something.  Mea culpa.&lt;/p&gt;</comment>
                            <comment id="12511799" author="djd" created="Wed, 11 Jul 2007 18:20:09 +0100"  >&lt;p&gt;Seems like a test case would fit into the existing upgrade tests easily.&lt;/p&gt;</comment>
                            <comment id="12511808" author="oysteing" created="Wed, 11 Jul 2007 18:45:14 +0100"  >&lt;p&gt;I have not been able to figure out how to run client/server tests in the upgrade test.&lt;br/&gt;
I tried using the clientServerDecorator, but then it was reported that another Derby instance had already booted the database.&lt;br/&gt;
I also tried using the defaultServerDecorator and use the derby.drda.startNetworkServer property to start a server, but then I was not able to get a connection even if the server seemed to have started.&lt;/p&gt;
</comment>
                            <comment id="12511810" author="djd" created="Wed, 11 Jul 2007 18:53:26 +0100"  >&lt;p&gt;Sorry, forgot the upgrade tests are embedded only.&lt;/p&gt;</comment>
                            <comment id="12511827" author="oysteing" created="Wed, 11 Jul 2007 19:58:23 +0100"  >&lt;p&gt;The attached patch, softupgradefix.diff, fixes the problem with soft upgrade.  &lt;/p&gt;

&lt;p&gt;It turns out one is determining nullability in a different way when writing EXTDTA than for other data.  When using OUTOVR to override types, a type value of 0 is a request for using the default type. DRDAResultSet#getRsDRDAType(int) had been fixed to handle this, but DRDAResultSet#isExtDtaValueNullable() uses DRDAResultSet#getRsDRDATypes() and fetches the entire array and does the lookup itself.&lt;/p&gt;

&lt;p&gt;This fix makes DRDAResultSet#isExtDtaValueNullable()  use DRDAResultSet#getRsDRDAType(int), instead.  &lt;/p&gt;

&lt;p&gt;I have manually tested that the failure during soft upgrade does not happen anymore. I am running the Junit All suite and derbyall and will report back with the result tomorrow.  &lt;/p&gt;

&lt;p&gt;I will also consider whether is possible to remove the DRDAResultSet#getRsDRDATypes()  entirely in order to avoid similar mistakes in the future.&lt;/p&gt;</comment>
                            <comment id="12511833" author="oysteing" created="Wed, 11 Jul 2007 20:27:57 +0100"  >&lt;p&gt;I have attached a new version of the patch, softupgradefix_v2.diff.  In addtion to the fix described above.  It removes the method DRDAResultSet#getRsDRDATypes()  in order to avoid similar mistakes in the future.  After the fix, this method was no longer in use.&lt;/p&gt;</comment>
                            <comment id="12511839" author="oysteing" created="Wed, 11 Jul 2007 20:36:22 +0100"  >&lt;p&gt;Oops, I was a bit quick here.  The method was in use by DRDAStatement.  I am deleting softupgradefix_v2.diff.  Will have to look into this a bit further, but the basic fix remains the same.&lt;/p&gt;</comment>
                            <comment id="12512122" author="oysteing" created="Thu, 12 Jul 2007 15:50:47 +0100"  >&lt;p&gt;I suggest that the current patch is considered for review/commit, and that the clean-up that I suggested can be performed by a separate JIRA.&lt;/p&gt;</comment>
                            <comment id="12512125" author="narayanan" created="Thu, 12 Jul 2007 15:53:49 +0100"  >&lt;p&gt;I have looked at softupgradefix.diff  and it looks good to me. The getRsDRDATypes method is being used only in one method in&lt;br/&gt;
DRDAStatement(getRsDRDATypes() ) and it is fine to leave the method as such now and go ahead with the fix proposed.&lt;/p&gt;

&lt;p&gt;+1.&lt;/p&gt;</comment>
                            <comment id="12512392" author="knutanders" created="Fri, 13 Jul 2007 08:52:18 +0100"  >&lt;p&gt;The fix looks fine to me too. I&apos;m running the regression tests on 10.3 now and will commit when they have completed.&lt;/p&gt;

&lt;p&gt;I noticed one potential improvement for later: After this change, we always convert the indexes we put into rsExtPositions from 1 based to 0 based, and always convert them back to 1 based when we retrieve the values. It would be good if we skipped the 1-&amp;gt;0 conversion in addExtDtaObject() and the 0-&amp;gt;1 conversion in isExtDtaValueNullable() and just stored the indexes 1 based in rsExtPositions.&lt;/p&gt;</comment>
                            <comment id="12512454" author="knutanders" created="Fri, 13 Jul 2007 12:59:55 +0100"  >&lt;p&gt;Committed to 10.3 with revision 555949.&lt;br/&gt;
Merged to trunk and committed revision 555956.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12361584" name="SimpleBlobTest.java" size="5254" author="oysteing" created="Wed, 11 Jul 2007 14:02:52 +0100"/>
                            <attachment id="12361607" name="softupgradefix.diff" size="669" author="oysteing" created="Wed, 11 Jul 2007 19:58:23 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 11 Jul 2007 17:20:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23322</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0upz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38795</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>