<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:44:39 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-337/DERBY-337.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-337] dblook doesn&apos;t generate SQL statements for SQL functions.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-337</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;DBLOOK schema dumping tool doesn&apos;t emit SQL statements for functions. It covers procedures and all other database objects, but not funtions. Here is an example I tried:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bandaram:satheesh&amp;#93;&lt;/span&gt; java org.apache.derby.tools.dblook -d &apos;jdbc:derby:tdb&apos;&lt;br/&gt;
&amp;#8211; Timestamp: 2005-06-05 09:41:20.603&lt;br/&gt;
&amp;#8211; Source database is: tdb&lt;br/&gt;
&amp;#8211; Connection URL is: jdbc:derby:tdb&lt;br/&gt;
&amp;#8211; appendLogs: false&lt;/p&gt;

&lt;p&gt;&amp;#8211; ----------------------------------------------&lt;br/&gt;
&amp;#8211; DDL Statements for tables&lt;br/&gt;
&amp;#8211; ----------------------------------------------&lt;/p&gt;

&lt;p&gt;CREATE TABLE &quot;APP&quot;.&quot;T&quot; (&quot;I&quot; INTEGER);&lt;/p&gt;

&lt;p&gt;At this point, the database has only one table &apos;T&apos;. Now create a function:&lt;/p&gt;

&lt;p&gt;C:\DerbyCode\bug&amp;gt;java -Dij.protocol=jdbc:derby: org.apache.derby.tools.ij&lt;br/&gt;
ij version 10.1&lt;br/&gt;
ij&amp;gt; connect &apos;tdb&apos;;&lt;br/&gt;
ij&amp;gt; create function gatp(SCH VARCHAR(128), TBL VARCHAR(128)) RETURNS VARCHAR(100&lt;br/&gt;
0)&lt;br/&gt;
EXTERNAL NAME &apos;org.apache.derbyTesting.functionTests.util.TestPropertyInfo.getAllTableProperties&apos;&lt;br/&gt;
LANGUAGE JAVA PARAMETER STYLE JAVA;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; quit;&lt;/p&gt;

&lt;p&gt;Now try dblook. Should show a function, but doesn&apos;t.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bandaram:satheesh&amp;#93;&lt;/span&gt; java org.apache.derby.tools.dblook -d &apos;jdbc:derby:tdb&apos;&lt;br/&gt;
&amp;#8211; Timestamp: 2005-06-05 09:41:20.603&lt;br/&gt;
&amp;#8211; Source database is: tdb&lt;br/&gt;
&amp;#8211; Connection URL is: jdbc:derby:tdb&lt;br/&gt;
&amp;#8211; appendLogs: false&lt;/p&gt;

&lt;p&gt;&amp;#8211; ----------------------------------------------&lt;br/&gt;
&amp;#8211; DDL Statements for tables&lt;br/&gt;
&amp;#8211; ----------------------------------------------&lt;/p&gt;

&lt;p&gt;CREATE TABLE &quot;APP&quot;.&quot;T&quot; (&quot;I&quot; INTEGER);&lt;/p&gt;

&lt;p&gt;Now create a procedure:&lt;/p&gt;

&lt;p&gt;C:\DerbyCode\bug&amp;gt;java -Dij.protocol=jdbc:derby: org.apache.derby.tools.ij&lt;br/&gt;
ij version 10.1&lt;br/&gt;
ij&amp;gt; connect &apos;tdb&apos;;&lt;br/&gt;
ij&amp;gt; create procedure insertAsciiColumn( stmtText varchar( 256), colNumber int) P&lt;br/&gt;
ARAMETER STYLE JAVA LANGUAGE JAVA MODIFIES SQL DATA&lt;br/&gt;
  EXTERNAL NAME &apos;org.apache.derbyTesting.functionTests.util.StreamUtil.insertAsc&lt;br/&gt;
iiColumn&apos;;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; &lt;/p&gt;

&lt;p&gt;DBLOOK output include newly created procedure, but still not function statement.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bandaram:satheesh&amp;#93;&lt;/span&gt; java org.apache.derby.tools.dblook -d &apos;jdbc:derby:tdb&apos;&lt;br/&gt;
&amp;#8211; Timestamp: 2005-06-05 09:43:09.5&lt;br/&gt;
&amp;#8211; Source database is: tdb&lt;br/&gt;
&amp;#8211; Connection URL is: jdbc:derby:tdb&lt;br/&gt;
&amp;#8211; appendLogs: false&lt;/p&gt;

&lt;p&gt;&amp;#8211; ----------------------------------------------&lt;br/&gt;
&amp;#8211; DDL Statements for stored procedures&lt;br/&gt;
&amp;#8211; ----------------------------------------------&lt;/p&gt;

&lt;p&gt;CREATE PROCEDURE &quot;APP&quot;.&quot;INSERTASCIICOLUMN&quot; (IN STMTTEXT VARCHAR(256),IN COLNUMBE&lt;br/&gt;
R INTEGER) LANGUAGE JAVA PARAMETER STYLE JAVA MODIFIES SQL DATA EXTERNAL NAME &apos;o&lt;br/&gt;
rg.apache.derbyTesting.functionTests.util.StreamUtil.insertAsciiColumn&apos; ;&lt;/p&gt;

&lt;p&gt;&amp;#8211; ----------------------------------------------&lt;br/&gt;
&amp;#8211; DDL Statements for tables&lt;br/&gt;
&amp;#8211; ----------------------------------------------&lt;/p&gt;

&lt;p&gt;CREATE TABLE &quot;APP&quot;.&quot;T&quot; (&quot;I&quot; INTEGER);&lt;/p&gt;</description>
                <environment>All platforms.</environment>
        <key id="12311072">DERBY-337</key>
            <summary>dblook doesn&apos;t generate SQL statements for SQL functions.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="army">A B</assignee>
                                    <reporter username="bandaram">Satheesh Bandaram</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Jun 2005 02:48:57 +0100</created>
                <updated>Tue, 20 Mar 2007 21:53:59 +0000</updated>
                            <resolved>Sat, 11 Jun 2005 01:50:18 +0100</resolved>
                                    <version>10.0.2.0</version>
                                    <fixVersion>10.1.1.0</fixVersion>
                                    <component>Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                            <comments>
                            <comment id="12312703" author="bandaram" created="Mon, 6 Jun 2005 08:58:28 +0100"  >&lt;p&gt;Fix cut and paste error in the description.&lt;/p&gt;</comment>
                            <comment id="12312943" author="army" created="Wed, 8 Jun 2005 07:40:48 +0100"  >&lt;p&gt;Attaching patch for this issue.  In order to get dblook to generate the DDL for Derby functions, this patch does the following:&lt;/p&gt;

&lt;p&gt;1 - Renames &quot;impl/tools/dblook/DB_StoredProcedure.java&quot; to &quot;impl/tools/dblook/DB_Alias.java&quot; because that file now handles stored procedures AND functions AND synonyms, all of which are based on the SYSALIASES system catalog.&lt;/p&gt;

&lt;p&gt;2 - Adds logic to new DB_Alias.java file to generate DDL for functions.&lt;/p&gt;

&lt;p&gt;3 - Modifies the &quot;toString()&quot; method of the catalog/types/RoutineAliasInfo file to generate a string that is SYNTACTICALLY VALID based on whether an instance of that class is for a PROCEDURE or for a FUNCTION.  The reason this change is required is because the &quot;ALIASINFO&quot; column that is returned as part of the SYS.SYSALIASES result set is an instance of RoutineAliasInfo, and thus a call to ResultSet.getString() on the ALIASINFO column ultimately makes a call to RoutineAliasInfo.toString().  That said, the dblook utility makes a &quot;getString()&quot; call on the ALIASINFO column and uses the result to generate the corresponding DDL.  Before this patch, the result of the toString() method always corresponded to the PROCEDURE syntax; but now, since dblook is generating DDL for FUNCTIONs, the RoutineAliasInfo.toString() method must recognize if an instance is a PROCEDURE or FUNCTION and return the appropriate syntax.&lt;/p&gt;

&lt;p&gt;4 - Adds test cases for FUNCTIONS to the dblook tests and updates the master files accordingly.&lt;/p&gt;

&lt;p&gt;I ran derbyall with these changes on Windows 2000 with Sun JDK 1.4.2, and all tests passed (except for one failure (testij.java) that is unrelated to my changes).&lt;/p&gt;

&lt;p&gt;NOTE TO COMMITTERS: Because this patch renames an existing file, it&apos;s a bit tricky to apply.  I had to copy &quot;DB_StoredProcedure.java&quot; to &quot;DB_Alias.java&quot; before applying the patch in order to get it to work.  I think Andrew suggested some time ago that a commiter use &quot;svn move&quot; to retain the history of the file that has changed names--I tried that, but after I did so the patch wouldn&apos;t apply.  So I just copied the file to it&apos;s new name, then applied the patch.  But I leave it up to people more familiar with svn to do the right thing here...&lt;/p&gt;</comment>
                            <comment id="12313102" author="bandaram" created="Thu, 9 Jun 2005 08:05:16 +0100"  >&lt;p&gt;Submitted this patch. I do see you have changed RoutineAliasInfo, a serialized java object that is saved in the disk. Please run some soft upgrade tests, to make sure procedures/functions created in 10.0 are still usable in 10.1 in soft upgrade. I think new fields and new methods you have added for RoutineAliasInfo may still make it compatible with 10.0 versions, but we definitely need to check.&lt;/p&gt;

&lt;p&gt;Sending        java\engine\org\apache\derby\catalog\types\RoutineAliasInfo.java&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\DerbyNet\dblook_test_net.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\DerbyNetClient\dblook_test_net.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\dblook_test.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\tools\dblook_makeDB.sql&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\tools\dblook_makeDB_2.sql&lt;br/&gt;
Adding         java\tools\org\apache\derby\impl\tools\dblook\DB_Alias.java&lt;br/&gt;
Deleting       java\tools\org\apache\derby\impl\tools\dblook\DB_StoredProcedure.java&lt;br/&gt;
Sending        java\tools\org\apache\derby\loc\toolsmessages.properties&lt;br/&gt;
Sending        java\tools\org\apache\derby\tools\dblook.java&lt;br/&gt;
Transmitting file data .........&lt;br/&gt;
Committed revision 189650.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;bandaram:satheesh&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="12313120" author="army" created="Thu, 9 Jun 2005 10:53:55 +0100"  >&lt;p&gt;In response to Satheesh&apos;s comments (see above), I ran the Java &quot;serialver&quot; utility against the RoutineAliasInfo class before and after my patch was applied.  Since the serialVersionUID &lt;em&gt;does&lt;/em&gt; change with my patch, I don&apos;t know if my initial changes are &quot;safe&quot; for sure.  Thus, attached is another, one-line patch that declares the new field in RoutineAliasInfo as &quot;transient&quot;; this simple changes makes it so that the serialVersionUID for RoutineAliasInfo is the same for 10.1 as it is for 10.0, and thus should avoid any problems in this area.&lt;/p&gt;

&lt;p&gt;Thanks to Satheesh for pointing this out.&lt;/p&gt;</comment>
                            <comment id="12313304" author="army" created="Sat, 11 Jun 2005 01:50:18 +0100"  >&lt;p&gt;Main patch was committed with svn revision 189650 and the followup patch was committed with svn revision 189835.  However, current discussion on derby-dev suggests that I may have to redo a small part of this patch to make it cleaner (see the thread here:  &lt;a href=&quot;http://article.gmane.org/gmane.comp.apache.db.derby.devel/5362&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://article.gmane.org/gmane.comp.apache.db.derby.devel/5362&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;So I&apos;m marking this issue as Resolved, but am not closing it until the above discussion thread is finalized.&lt;/p&gt;</comment>
                            <comment id="12313490" author="army" created="Tue, 14 Jun 2005 03:04:48 +0100"  >&lt;p&gt;Seeing no further discussion on this, I guess the clean-up work described above (and at the following link) can be made as an additional patch at a later time, by myself or by anyone else who&apos;d like to make it (it should be fairly straightforward):&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://article.gmane.org/gmane.comp.apache.db.derby.devel/5362&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://article.gmane.org/gmane.comp.apache.db.derby.devel/5362&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;Until then, I guess I&apos;ll keep this issue as &quot;resolved&quot; but not closed.&lt;/p&gt;

&lt;p&gt;On a different note, I think the Derby documentation of the &quot;dblook&quot; utility needs a slight modification to account for this issue.  In particular, the section entitled &quot;Generating the DDL for a database&quot; should add &quot;Functions&quot; to the list of database objects that dblook generates.  I&apos;m not sure if we need a separate JIRA entry for that or not?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12310624" name="d337_followup.patch" size="527" author="army" created="Thu, 9 Jun 2005 10:53:55 +0100"/>
                            <attachment id="12310581" name="derby-337.patch" size="25321" author="army" created="Wed, 8 Jun 2005 07:40:48 +0100"/>
                            <attachment id="12310580" name="derby-337.stat" size="796" author="army" created="Wed, 8 Jun 2005 07:40:48 +0100"/>
                    </attachments>
                <subtasks>
                            <subtask id="12311336">DERBY-356</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 8 Jun 2005 06:40:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21906</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy12z3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40132</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>