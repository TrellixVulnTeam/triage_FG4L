<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:52:42 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2495/DERBY-2495.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2495] Create framework for calling locator related stored procedures from client</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2495</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The client JDBC driver will need to call stored procedures (ref &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2257&quot; title=&quot;Implementing the stored procedures called by the LOB related JDBC methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2257&quot;&gt;&lt;del&gt;DERBY-2257&lt;/del&gt;&lt;/a&gt;) to operate on LOBs identified by locators.  We should create a framework that implement the stored procedure calls.  This way, the rest of the client code can call methods in this framework when needing to call the stored procedures without having to prepare SQL statements themselves.  &lt;/p&gt;

&lt;p&gt;The framework should make sure that prepared statements are reused within a connection.  Each procedure call should only be prepared once per connection.&lt;/p&gt;

&lt;p&gt;Since LOBs can not be parameters to stored procedures, the framework should make sure that calls involving a byte[] or String that does not fit in a VARCHAR (FOR BIT DATA), are split into several calls each operating on a fragment of the LOB.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12366007">DERBY-2495</key>
            <summary>Create framework for calling locator related stored procedures from client</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="31583">DERBY-208</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="oysteing">&#216;ystein Gr&#248;vlen</assignee>
                                    <reporter username="oysteing">&#216;ystein Gr&#248;vlen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Mar 2007 12:24:14 +0100</created>
                <updated>Wed, 11 Jul 2007 09:11:52 +0100</updated>
                            <resolved>Mon, 16 Apr 2007 15:21:48 +0100</resolved>
                                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12485503" author="oysteing" created="Fri, 30 Mar 2007 14:29:52 +0100"  >&lt;p&gt;The patch blobframework.diff adds a class CallableLocatorProcedures&lt;br/&gt;
that provides methods for calling the stored procedures used to&lt;br/&gt;
operate on LOBs identified by locators.  There will be one instance of&lt;br/&gt;
this class for each connection that has called any of the stored&lt;br/&gt;
procedures.  For each procedure that has been called, a reference is&lt;br/&gt;
kept to the CallableStatement object so that a call needs to be&lt;br/&gt;
prepared once per connection.&lt;/p&gt;

&lt;p&gt;If the byte[] and String parameters and return values for the methods&lt;br/&gt;
exceed the maximum size for such in stored procedure (i.e. the&lt;br/&gt;
maximum size for VARCHAR), repeated calls to the stored procedures&lt;br/&gt;
will be done to transfer the data to the server.&lt;/p&gt;

&lt;p&gt;NOTE: The use of locators are still not enabled so most of this code&lt;br/&gt;
when checked in, will not be executed.  (The changes to&lt;br/&gt;
PreparedStatement and CallableStatement will have effect.  However,&lt;br/&gt;
these changes only extract existing code into a separate method.) When&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2496&quot; title=&quot;Implement Blob support for Locators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2496&quot;&gt;&lt;del&gt;DERBY-2496&lt;/del&gt;&lt;/a&gt; is ready, locators will be enabled for Blobs.&lt;/p&gt;

&lt;p&gt;The patch changes the following files:&lt;/p&gt;

&lt;p&gt;M      java/client/org/apache/derby/client/am/Connection.java&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Adds a method that is to be used to get a reference to the&lt;br/&gt;
     CallableLocatorProcedures object for this Connection.  The object&lt;br/&gt;
     is created on the first invocation of this method.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Made prepareCallX package private so that it can be used by&lt;br/&gt;
     CallableLocatorProcedures to prepare the procedure calls.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;M      java/client/org/apache/derby/client/am/PreparedStatement.java&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added setLongX() similar to the existing setIntX().  Used by&lt;br/&gt;
     CallableLocatorProcedures and avoid the unecessary parameter&lt;br/&gt;
     testing and exception mismatch of setLong()&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;M      java/client/org/apache/derby/client/am/CallableStatement.java&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added getLongX() and getBytesX() for the same reasons as given&lt;br/&gt;
     above. &lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;A      java/client/org/apache/derby/client/am/CallableLocatorProcedures.java&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The above mention class which is used by callers of the stored&lt;br/&gt;
     procedures for locators.  The Blob methods of this class has been&lt;br/&gt;
     tested by code that I am currently working on for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2496&quot; title=&quot;Implement Blob support for Locators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2496&quot;&gt;&lt;del&gt;DERBY-2496&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
     The Clob methods have not yet been tested, but the code is very&lt;br/&gt;
     similar to the Blob methods.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;I am currently running the JUnit suit and derbyall for this patch, and&lt;br/&gt;
will get back to you with the results.  However, I do not expect to&lt;br/&gt;
see any problems since 97% of this code has not been enabled, and the&lt;br/&gt;
rest are very simple changes.  (I have also run these changes together&lt;br/&gt;
with other changes without seeing any problems.)&lt;/p&gt;</comment>
                            <comment id="12486141" author="oysteing" created="Mon, 2 Apr 2007 22:36:48 +0100"  >&lt;p&gt;Junit suit and derbyall was run with no errors, except the one that currently makes the Tinderbox test fail.&lt;/p&gt;</comment>
                            <comment id="12486247" author="narayanan" created="Tue, 3 Apr 2007 07:51:05 +0100"  >&lt;p&gt;I ran tests on this patch. I got one failure in SecurityPolicyReloadingTest (which has  already been failing in the tinderbox).&lt;/p&gt;

&lt;p&gt; The code is neatly documented with all javadoc and comments. &lt;/p&gt;

&lt;p&gt;The patch looks good to me +1 for a commit.&lt;/p&gt;</comment>
                            <comment id="12486343" author="oysteing" created="Tue, 3 Apr 2007 13:38:49 +0100"  >&lt;p&gt;blobframework_v2.diff is a new version of the patch which makes sure&lt;br/&gt;
that calling the LOB procedures does not initiate a commit when&lt;br/&gt;
running in auto-commit mode.  &lt;/p&gt;

&lt;p&gt;In addition to the earlier described changes, this version contains&lt;br/&gt;
the following new changes:&lt;/p&gt;

&lt;p&gt;A      java/client/org/apache/derby/client/am/CallableLocatorProcedures.java&lt;/p&gt;

&lt;p&gt;       For each prepared statement, the field&lt;br/&gt;
       isAutoCommittableStatement_ is set to false, to prevent&lt;br/&gt;
       committing the current user transaction when called in auto&lt;br/&gt;
       commit mode.&lt;/p&gt;

&lt;p&gt;M      java/client/org/apache/derby/client/am/Statement.java&lt;/p&gt;

&lt;p&gt;       Change the visibility of member isAutoCommittableStatement to&lt;br/&gt;
       package private.  No need to be public.&lt;/p&gt;</comment>
                            <comment id="12486345" author="oysteing" created="Tue, 3 Apr 2007 13:44:28 +0100"  >&lt;p&gt;Reattaching patch.  Forgot to grant license to ASF the first time.&lt;/p&gt;</comment>
                            <comment id="12489065" author="kristwaa" created="Mon, 16 Apr 2007 11:06:45 +0100"  >&lt;p&gt;Committed &apos;blobframework_v2.diff&apos; to trunk with revision 529185.&lt;/p&gt;

&lt;p&gt;Very nicely commented patch &#216;ystein!&lt;/p&gt;

&lt;p&gt;I reviewed the patch and have the following suggestions/comments for a followup patch:&lt;br/&gt;
 1) Would a comment that all the new set-/getX methods use 1-based indexes be helpful?&lt;br/&gt;
 2) Invalid @see tag in CallableLocatorProcedures (class JavaDoc).&lt;br/&gt;
 3) Any reason why CallableLocatorProcedures.connection isn&apos;t final?&lt;br/&gt;
 4) Can you get the value of VARCHAR_MAXWIDTH from somewhere, or use an existing constant?&lt;br/&gt;
    I would also make it private to signal that it is not supposed to be used outside this class (I seem to recall that it is defined in another class already).&lt;br/&gt;
 5) CallableLocatorProcedures.blobTruncate could add newlines around the paragraph tag.&lt;br/&gt;
 6) Why use new String(&quot;&quot;) in CallableLocatorProcedures.clobGetSubString?&lt;/p&gt;

&lt;p&gt;The methods using repeated procedure calls for large values is a bit tricky, so I hope there will be some (boundary) tests in place when the code is enabled.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;</comment>
                            <comment id="12489094" author="oysteing" created="Mon, 16 Apr 2007 13:25:47 +0100"  >&lt;p&gt;Thanks, Kristian for committing this.  I will make a follow-up patch&lt;br/&gt;
that addresses your comments.  See below for responses to your&lt;br/&gt;
comments.&lt;/p&gt;


&lt;p&gt;&amp;gt; Kristian Waagan updated &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2495&quot; title=&quot;Create framework for calling locator related stored procedures from client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2495&quot;&gt;&lt;del&gt;DERBY-2495&lt;/del&gt;&lt;/a&gt;:&lt;br/&gt;
&amp;gt; -----------------------------------&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt;     Derby Info:   (was: &lt;span class=&quot;error&quot;&gt;&amp;#91;Patch Available&amp;#93;&lt;/span&gt;)&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Committed &apos;blobframework_v2.diff&apos; to trunk with revision 529185.&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Very nicely commented patch &#216;ystein!&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; I reviewed the patch and have the following suggestions/comments for a followup patch:&lt;br/&gt;
&amp;gt;  1) Would a comment that all the new set-/getX methods use 1-based&lt;br/&gt;
&amp;gt;     indexes be helpful?&lt;/p&gt;

&lt;p&gt;I did not do this since similar existing methods did not have comments&lt;br/&gt;
like this, but I will add it in the follow-up patch. &lt;/p&gt;

&lt;p&gt;&amp;gt;  2) Invalid @see tag in CallableLocatorProcedures (class JavaDoc).&lt;/p&gt;

&lt;p&gt;Will fix.&lt;/p&gt;

&lt;p&gt;&amp;gt;  3) Any reason why CallableLocatorProcedures.connection isn&apos;t final?&lt;/p&gt;

&lt;p&gt;No, and it looks like you have already made it final.  Thanks.&lt;/p&gt;

&lt;p&gt;&amp;gt;  4) Can you get the value of VARCHAR_MAXWIDTH from somewhere, or use&lt;br/&gt;
&amp;gt;     an existing constant?&lt;/p&gt;

&lt;p&gt;As far as I know, the existing constant is only available in the&lt;br/&gt;
embedded driver.  Do you think I ought to make the effort to make it&lt;br/&gt;
shared?&lt;/p&gt;

&lt;p&gt;&amp;gt;     I would also make it private to signal that it is not supposed&lt;br/&gt;
&amp;gt;     to be used outside this class (I seem to recall that it is&lt;br/&gt;
&amp;gt;     defined in another class already).&lt;/p&gt;

&lt;p&gt;Good idea.&lt;/p&gt;

&lt;p&gt;&amp;gt;  5) CallableLocatorProcedures.blobTruncate could add newlines around&lt;br/&gt;
&amp;gt;     the paragraph tag.&lt;/p&gt;

&lt;p&gt;If I understand you correctly, you want newlines both before and after&lt;br/&gt;
&amp;lt;p&amp;gt;. In other words, &amp;lt;p&amp;gt; should be put on a separate line?  I will&lt;br/&gt;
fix that.&lt;/p&gt;

&lt;p&gt;&amp;gt;  6) Why use new String(&quot;&quot;) in&lt;br/&gt;
&amp;gt;     CallableLocatorProcedures.clobGetSubString?&lt;/p&gt;

&lt;p&gt;Good point.  I guess it was because I copied the way I had done it for&lt;br/&gt;
blobGetBytes (return new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;).  I will change it to just return &quot;&quot;.&lt;/p&gt;

&lt;p&gt;&amp;gt; &lt;br/&gt;
&amp;gt; The methods using repeated procedure calls for large values is a bit&lt;br/&gt;
&amp;gt; tricky, so I hope there will be some (boundary) tests in place when&lt;br/&gt;
&amp;gt; the code is enabled.&lt;/p&gt;

&lt;p&gt;Yes, where it does not already exist, I will add test cases for&lt;br/&gt;
different Blob/Clob lengths in order to make sure this code is well&lt;br/&gt;
covered by tests.&lt;/p&gt;

&lt;p&gt;&amp;#8211;&lt;br/&gt;
&#216;ystein&lt;/p&gt;</comment>
                            <comment id="12489096" author="kristwaa" created="Mon, 16 Apr 2007 13:41:28 +0100"  >&lt;p&gt;&#216;ystein, see my answers to selected questions below.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; 3) Any reason why CallableLocatorProcedures.connection isn&apos;t final?&lt;/p&gt;

&lt;p&gt;&amp;gt;No, and it looks like you have already made it final. Thanks. &lt;/p&gt;

&lt;p&gt;Woops, this was due to sloppy committer-work... I give myself a little slap on the hand for that one!&lt;br/&gt;
I was running tests with this modification, and making the constant VARCHAR_MAXWIDTH private, and accidentally committed them. Forgot to diff the diff.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; 4) Can you get the value of VARCHAR_MAXWIDTH from somewhere, or use&lt;br/&gt;
&amp;gt;&amp;gt; an existing constant?&lt;/p&gt;

&lt;p&gt;&amp;gt; As far as I know, the existing constant is only available in the&lt;br/&gt;
&amp;gt; embedded driver. Do you think I ought to make the effort to make it&lt;br/&gt;
&amp;gt; shared? &lt;/p&gt;

&lt;p&gt;No. Although it would be better, I don&apos;t think it is worth it.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; 5) CallableLocatorProcedures.blobTruncate could add newlines around&lt;br/&gt;
&amp;gt;&amp;gt; the paragraph tag.&lt;/p&gt;

&lt;p&gt;&amp;gt; If I understand you correctly, you want newlines both before and after&lt;br/&gt;
&amp;gt; &amp;lt;p&amp;gt;. In other words, &amp;lt;p&amp;gt; should be put on a separate line? I will&lt;br/&gt;
&amp;gt; fix that. &lt;/p&gt;

&lt;p&gt;I see others have done that, and I find it to be easy to read. You don&apos;t have to do it this way of course, but I thought the tag looked a bit &quot;lost&quot; in its current position.&lt;/p&gt;</comment>
                            <comment id="12489117" author="oysteing" created="Mon, 16 Apr 2007 14:50:42 +0100"  >&lt;p&gt;This follow-up patch, derby-2495/trunk/derby-2459-followup.diff, contains mostly javadoc changes etc.  In addition, a &apos;return new String(&quot;&quot;)&apos; had been changed to &apos;return &quot;&quot;&apos;.&lt;/p&gt;

&lt;p&gt;M      java/client/org/apache/derby/client/am/PreparedStatement.java&lt;br/&gt;
M      java/client/org/apache/derby/client/am/CallableLocatorProcedures.java&lt;/p&gt;</comment>
                            <comment id="12489125" author="kristwaa" created="Mon, 16 Apr 2007 15:21:48 +0100"  >&lt;p&gt;Committed &apos;derby-2459-followup.diff&apos; to trunk with revision 529259.&lt;/p&gt;

&lt;p&gt;Thanks for the followup patch &#216;ystein!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12354601" name="blobframework.diff" size="45213" author="oysteing" created="Fri, 30 Mar 2007 14:29:52 +0100"/>
                            <attachment id="12354834" name="blobframework_v2.diff" size="48732" author="oysteing" created="Tue, 3 Apr 2007 13:44:28 +0100"/>
                            <attachment id="12354833" name="blobframework_v2.diff" size="48732" author="oysteing" created="Tue, 3 Apr 2007 13:38:49 +0100"/>
                            <attachment id="12355607" name="derby-2459-followup.diff" size="2650" author="oysteing" created="Mon, 16 Apr 2007 14:50:42 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 3 Apr 2007 06:51:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30481</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy11fz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39884</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>