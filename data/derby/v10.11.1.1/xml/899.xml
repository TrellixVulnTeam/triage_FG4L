<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:39:22 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-899/DERBY-899.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-899] Cannot rollback to savepoint when using ClientXADataSource</title>
                <link>https://issues.apache.org/jira/browse/DERBY-899</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;From a user using client XA.&lt;/p&gt;

&lt;p&gt;save points don&apos;t seem to be working with DerbyClient using &lt;br/&gt;
XA.&lt;/p&gt;

&lt;p&gt;levels i am on:&lt;br/&gt;
10.1.2.2&lt;br/&gt;
Apache Derby&lt;/p&gt;

&lt;p&gt;Exception thrown is:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; &lt;br/&gt;
org.apache.derby.client.am.SqlException: SAVEPOINT, MyPoint &lt;br/&gt;
does not  exist or is not active in the current transaction.&lt;br/&gt;
	at org.apache.derby.client.am.Statement.completeSqlca(Unknown &lt;br/&gt;
Source)&lt;br/&gt;
	at &lt;br/&gt;
org.apache.derby.client.am.Statement.completeExecuteImmediate(Un&lt;br/&gt;
known Source)&lt;br/&gt;
	at &lt;br/&gt;
org.apache.derby.client.net.NetStatementReply.parseEXCSQLIMMrepl&lt;br/&gt;
y(Unknown Source)&lt;br/&gt;
	at &lt;br/&gt;
org.apache.derby.client.net.NetStatementReply.readExecuteImmedia&lt;br/&gt;
te(Unknown Source)&lt;br/&gt;
	at &lt;br/&gt;
org.apache.derby.client.net.StatementReply.readExecuteImmediate(&lt;br/&gt;
Unknown Source)&lt;br/&gt;
	at &lt;br/&gt;
org.apache.derby.client.net.NetStatement.readExecuteImmediate_(U&lt;br/&gt;
nknown Source)&lt;br/&gt;
	at &lt;br/&gt;
org.apache.derby.client.am.Statement.readExecuteImmediate(Unknow&lt;br/&gt;
n Source)&lt;br/&gt;
	at org.apache.derby.client.am.Statement.flowExecute(Unknown &lt;br/&gt;
Source)&lt;br/&gt;
	at org.apache.derby.client.am.Statement.executeX(Unknown &lt;br/&gt;
Source)&lt;br/&gt;
	at org.apache.derby.client.am.Connection.rollback(Unknown &lt;br/&gt;
Source)&lt;br/&gt;
	at &lt;br/&gt;
org.apache.derby.client.am.LogicalConnection.rollback(Unknown &lt;br/&gt;
Source)&lt;br/&gt;
	at &lt;br/&gt;
Derby.networkServer.NSConnection.main(NSConnection.java:103)&lt;/p&gt;

&lt;p&gt;Test case below &lt;/p&gt;

&lt;p&gt;class SavePointProblem337977  &lt;br/&gt;
{&lt;/p&gt;

&lt;p&gt;    public static void main (String args [])throws Exception {&lt;br/&gt;
    	//org.apache.derby.jdbc.ClientConnectionPoolDataSource ds &lt;br/&gt;
= new org.apache.derby.jdbc.ClientConnectionPoolDataSource();&lt;br/&gt;
    	org.apache.derby.jdbc.ClientXADataSource ds = new &lt;br/&gt;
org.apache.derby.jdbc.ClientXADataSource();&lt;/p&gt;

&lt;p&gt;    	Connection conn = null;&lt;br/&gt;
    	ds.setDatabaseName(&quot;e:\\temp&lt;br class=&quot;atl-forced-newline&quot; /&gt;sampl127;create=true&quot;);&lt;/p&gt;

&lt;p&gt;    	XAConnection xaCon = ds.getXAConnection() ;&lt;br/&gt;
         //PooledConnection xaCon = ds.getPooledConnection() ;&lt;/p&gt;


&lt;p&gt;         conn = xaCon.getConnection();&lt;/p&gt;



&lt;p&gt;        DatabaseMetaData md = conn.getMetaData() ;&lt;br/&gt;
        System.out.println(md.getDatabaseProductVersion());&lt;br/&gt;
        System.out.println(md.getDatabaseProductName());&lt;/p&gt;

&lt;p&gt;        Statement st = null;&lt;br/&gt;
        PreparedStatement ps1 = null;&lt;br/&gt;
         try&lt;br/&gt;
         {&lt;br/&gt;
             st = conn.createStatement ();&lt;br/&gt;
             try&lt;br/&gt;
             &lt;/p&gt;
{
             	st.executeUpdate (&quot;drop table TAB1&quot;);
             }
&lt;p&gt;catch (SQLException x)&lt;/p&gt;
             {
             	System.out.println (&quot;no table exists&quot;);
             }

&lt;p&gt;             ps1 = conn.prepareStatement(&quot;CREATE TABLE &lt;br/&gt;
TAB1(COL1 INT NOT NULL)&quot;);&lt;br/&gt;
             ps1.executeUpdate();&lt;/p&gt;

&lt;p&gt;             conn.commit ();&lt;br/&gt;
         } catch (SQLException x)&lt;/p&gt;
         {
             System.out.println (&quot;table already exists&quot;);
         }


&lt;p&gt;         conn.setAutoCommit(false);&lt;br/&gt;
         conn.createStatement().execute(&quot;update tab1 set col1 = &lt;br/&gt;
-1 where col1 = 9&quot;);&lt;br/&gt;
         Savepoint savepoint1 = conn.setSavepoint(&quot;MyPoint&quot;);&lt;/p&gt;

&lt;p&gt;         conn.rollback(savepoint1);&lt;br/&gt;
            }&lt;br/&gt;
}&lt;/p&gt;</description>
                <environment></environment>
        <key id="12328360">DERBY-899</key>
            <summary>Cannot rollback to savepoint when using ClientXADataSource</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="kmarsden">Kathey Marsden</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Feb 2006 05:21:44 +0000</created>
                <updated>Wed, 24 May 2006 05:56:49 +0100</updated>
                            <resolved>Sat, 4 Feb 2006 06:59:54 +0000</resolved>
                                    <version>10.1.1.0</version>
                    <version>10.1.2.1</version>
                                    <fixVersion>10.1.3.1</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Client</component>
                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12364701" author="kmarsden" created="Wed, 1 Feb 2006 05:30:01 +0000"  >&lt;p&gt;I have not actually looked at this issue yet  but am keen to get it fixed quickly in 10.1.    I plan to look it at right after  &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-898&quot; title=&quot;setAutoCommit(false) is not working properly for local transaction with ClientXADataSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-898&quot;&gt;&lt;del&gt;DERBY-898&lt;/del&gt;&lt;/a&gt;.  Any input is appreciated.&lt;/p&gt;
</comment>
                            <comment id="12364833" author="kmarsden" created="Thu, 2 Feb 2006 02:45:01 +0000"  >&lt;p&gt;This issue actually seems to be the same issue as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-899&quot; title=&quot;Cannot rollback to savepoint when using ClientXADataSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-899&quot;&gt;&lt;del&gt;DERBY-899&lt;/del&gt;&lt;/a&gt;.  It does not occur with my &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-898&quot; title=&quot;setAutoCommit(false) is not working properly for local transaction with ClientXADataSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-898&quot;&gt;&lt;del&gt;DERBY-898&lt;/del&gt;&lt;/a&gt; fix.&lt;/p&gt;
</comment>
                            <comment id="12365138" author="kmarsden" created="Sat, 4 Feb 2006 06:59:54 +0000"  >&lt;p&gt;This is a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-898&quot; title=&quot;setAutoCommit(false) is not working properly for local transaction with ClientXADataSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-898&quot;&gt;&lt;del&gt;DERBY-898&lt;/del&gt;&lt;/a&gt;. Submitted a test with that issue to verify savepoint rollabck.&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22196</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy16b3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40672</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>