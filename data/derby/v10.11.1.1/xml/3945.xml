<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:37:02 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3945/DERBY-3945.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3945] Generation clauses which mention user-coded functions may produce different resuls depending on who performs the triggering INSERT/UPDATE</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3945</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;This is similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3944&quot; title=&quot;CHECK constraints involving user-coded functions may return different results depending on who performs the triggering INSERT/UPDATE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3944&quot;&gt;&lt;del&gt;DERBY-3944&lt;/del&gt;&lt;/a&gt;. The compiler uses the current schema in order to resolve unqualifed function names when preparing INSERT/UPDATE statement. This means that a generation clause may evaluate differently depending on who invokes the triggering INSERT/UPDATE statement. This violates the requirement that generation clause should be deterministic (see part 2 of the ANSI/ISO standard, section 4.16.&lt;/p&gt;

&lt;p&gt;Hopefully, the same patch will fix both &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3944&quot; title=&quot;CHECK constraints involving user-coded functions may return different results depending on who performs the triggering INSERT/UPDATE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3944&quot;&gt;&lt;del&gt;DERBY-3944&lt;/del&gt;&lt;/a&gt; and this issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12408290">DERBY-3945</key>
            <summary>Generation clauses which mention user-coded functions may produce different resuls depending on who performs the triggering INSERT/UPDATE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Rick Hillegas</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Nov 2008 20:44:07 +0000</created>
                <updated>Thu, 6 Mar 2014 00:05:44 +0000</updated>
                            <resolved>Thu, 20 Nov 2008 17:05:19 +0000</resolved>
                                    <version>10.5.1.1</version>
                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12649090" author="rhillegas" created="Wed, 19 Nov 2008 16:49:59 +0000"  >&lt;p&gt;Attaching zz.sql, a script which demonstrates the problem.&lt;/p&gt;</comment>
                            <comment id="12649144" author="rhillegas" created="Wed, 19 Nov 2008 19:38:53 +0000"  >&lt;p&gt;Attaching derby-3945-01-aa-functionSchema.diff. This patch forces Derby to use the current schema at DDL time (rather than DML time) to resolve unqualified function references in generation clauses. Running tests now.&lt;/p&gt;

&lt;p&gt;There are two pieces to this fix:&lt;/p&gt;

&lt;p&gt;1) The persisted default descriptor now stores the current schema which was in effect when the generation clause was defined.&lt;/p&gt;

&lt;p&gt;2) At INSERT/UPDATE time, that saved schema temporarily becomes the current schema when we bind the generation clause.&lt;/p&gt;

&lt;p&gt;A similar approach could be used for the related bugs having to do with unqualified function names in CHECK constraints (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3944&quot; title=&quot;CHECK constraints involving user-coded functions may return different results depending on who performs the triggering INSERT/UPDATE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3944&quot;&gt;&lt;del&gt;DERBY-3944&lt;/del&gt;&lt;/a&gt;) and VIEWS (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3953&quot; title=&quot;VIEWS which invoke user-coded functions may return different results depending on who SELECTs from them&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3953&quot;&gt;&lt;del&gt;DERBY-3953&lt;/del&gt;&lt;/a&gt;). Note that this approach does not address the related issues with dblook (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3954&quot; title=&quot;dblook scripts cannot be relied on to recreate the permissions and schema objects of a database&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3954&quot;&gt;DERBY-3954&lt;/a&gt;).&lt;/p&gt;


&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/catalog/DefaultInfo.java&lt;br/&gt;
M      java/engine/org/apache/derby/catalog/types/DefaultInfoImpl.java&lt;/p&gt;

&lt;p&gt;Adds the DDL-time current schema to the default descriptor.&lt;/p&gt;


&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/compile/TableElementList.java&lt;/p&gt;

&lt;p&gt;Stuffs the current schema into the default descriptor at CREATE/ALTER time.&lt;/p&gt;


&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/compile/DMLModStatementNode.java&lt;/p&gt;

&lt;p&gt;Temporarily sets the current schema to the schema stored in the default when we bind generation clauses.&lt;/p&gt;


&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/lang/GeneratedColumnsPermsTest.java&lt;/p&gt;

&lt;p&gt;Adds tests.&lt;/p&gt;</comment>
                            <comment id="12649207" author="rhillegas" created="Wed, 19 Nov 2008 23:15:59 +0000"  >&lt;p&gt;Regression tests ran cleanly for me except for two errors which look like they were introduced by someone else&apos;s checkin today. Committed at subversion revision revision 719123. The two errors were:&lt;/p&gt;

&lt;p&gt;There were 2 errors:&lt;br/&gt;
1) testDefaultValues(org.apache.derbyTesting.unitTests.junit.CharacterStreamDescriptorTest)java.lang.NoClassDefFoundError: org/apache/derby/iapi/jdbc/CharacterStreamDescriptor$Builder&lt;br/&gt;
	at org.apache.derbyTesting.unitTests.junit.CharacterStreamDescriptorTest.testDefaultValues(CharacterStreamDescriptorTest.java:42)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:105)&lt;br/&gt;
2) testSetValues(org.apache.derbyTesting.unitTests.junit.CharacterStreamDescriptorTest)java.lang.NoClassDefFoundError: org/apache/derby/iapi/jdbc/CharacterStreamDescriptor$Builder&lt;br/&gt;
	at org.apache.derbyTesting.unitTests.junit.CharacterStreamDescriptorTest.testSetValues(CharacterStreamDescriptorTest.java:67)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:105)&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;br/&gt;
Tests run: 8900,  Failures: 0,  Errors: 2&lt;/p&gt;</comment>
                            <comment id="12649867" author="dagw" created="Sat, 22 Nov 2008 00:27:07 +0000"  >&lt;p&gt;Similar problem and possibly solution as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3270&quot; title=&quot;Delayed (on-demand) creation of current user schema makes select from view belonging to other schema fail.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3270&quot;&gt;&lt;del&gt;DERBY-3270&lt;/del&gt;&lt;/a&gt;, linking.&lt;/p&gt;</comment>
                            <comment id="12649868" author="dagw" created="Sat, 22 Nov 2008 00:32:54 +0000"  >&lt;p&gt;Patch looks good!&lt;br/&gt;
Note: The constructor of DefaultInfoImpl now lacks some @params in its javadoc.&lt;/p&gt;</comment>
                            <comment id="12652098" author="rhillegas" created="Mon, 1 Dec 2008 19:01:19 +0000"  >&lt;p&gt;Thanks for the review, Dag. Attaching derby-3945-02-aa-javadoc.diff, which address the javadoc issue. Committed at subversion revision 722177.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                                                <inwardlinks description="Is contained by">
                                        <issuelink>
            <issuekey id="12699020">DERBY-6498</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12312855">DERBY-481</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12408289">DERBY-3944</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12671616">DERBY-6361</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12384407">DERBY-3270</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12394275" name="derby-3945-01-aa-functionSchema.diff" size="11874" author="rhillegas" created="Wed, 19 Nov 2008 19:38:53 +0000"/>
                            <attachment id="12395030" name="derby-3945-02-aa-javadoc.diff" size="722" author="rhillegas" created="Mon, 1 Dec 2008 19:01:19 +0000"/>
                            <attachment id="12394252" name="zz.sql" size="993" author="rhillegas" created="Wed, 19 Nov 2008 16:49:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 22 Nov 2008 00:27:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23930</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0pif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37951</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>