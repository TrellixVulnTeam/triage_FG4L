<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:33:55 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5969/DERBY-5969.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5969] Encryption, re-encryption, and un-encryption silently fail if the database is already booted.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5969</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If the database is already booted, then the DBO&apos;s attempt to re-encrypt or un-encrypt the database will silently fail. It will appear to the DBO that the re(un)encryption succeeded but in fact the database will not be changed. Derby should raise an error if the database is already booted when the DBO attempts re(un)encryption.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12613925">DERBY-5969</key>
            <summary>Encryption, re-encryption, and un-encryption silently fail if the database is already booted.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Rick Hillegas</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                            <label>derby_backport_reject_10_9</label>
                    </labels>
                <created>Mon, 29 Oct 2012 17:54:26 +0000</created>
                <updated>Thu, 27 Jun 2013 23:42:34 +0100</updated>
                            <resolved>Thu, 27 Jun 2013 23:42:34 +0100</resolved>
                                    <version>10.10.1.1</version>
                                    <fixVersion>10.10.1.1</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13486211" author="rhillegas" created="Mon, 29 Oct 2012 18:00:39 +0000"  >&lt;p&gt;Linking to derby-5968 because this problem came up while thinking about that issue. Linking to derby-5792 because this cluster of issues came up while buddy-testing that feature.&lt;/p&gt;</comment>
                            <comment id="13486219" author="rhillegas" created="Mon, 29 Oct 2012 18:05:34 +0000"  >&lt;p&gt;The following script shows this problem:&lt;/p&gt;

&lt;p&gt;connect &apos;jdbc:derby:db;create=true;user=test_dbo;dataEncryption=true;bootPassword=foobarwibblewombat&apos;;&lt;/p&gt;

&lt;p&gt;call syscs_util.syscs_create_user( &apos;test_dbo&apos;, &apos;test_dbopassword&apos; );&lt;br/&gt;
call syscs_util.syscs_create_user( &apos;fred&apos;, &apos;fredpassword&apos; );&lt;/p&gt;

&lt;p&gt;&amp;#8211; shutdown the database&lt;br/&gt;
connect &apos;jdbc:derby:db;shutdown=true&apos;;&lt;/p&gt;

&lt;p&gt;&amp;#8211; let another user boot the database&lt;br/&gt;
connect &apos;jdbc:derby:db;user=fred;password=fredpassword;bootPassword=foobarwibblewombat&apos;;&lt;/p&gt;

&lt;p&gt;&amp;#8211; the following attempt to decrypt the database appears to work&lt;br/&gt;
&amp;#8211; but actually fails.&lt;br/&gt;
connect &apos;jdbc:derby:db;user=test_dbo;password=test_dbopassword;bootPassword=foobarwibblewombat;decryptDatabase=true&apos;;&lt;/p&gt;

&lt;p&gt;&amp;#8211; shutdown the database&lt;br/&gt;
connect &apos;jdbc:derby:db;shutdown=true;user=test_dbo;password=test_dbopassword&apos;;&lt;/p&gt;

&lt;p&gt;&amp;#8211;  this demonstrates that the unencryption failed&lt;br/&gt;
connect &apos;jdbc:derby:db;user=test_dbo;password=test_dbopassword&apos;;&lt;/p&gt;</comment>
                            <comment id="13488719" author="rhillegas" created="Thu, 1 Nov 2012 14:28:16 +0000"  >&lt;p&gt;Attaching derby-5969-01-aa-warnEncryptionOnBootedDB.diff. This patch raises a SQLWarning if you attempt to change the encryption on an already booted database. The warning tells you that the encryption state was not changed and that you need to shutdown the database before attempting the operation. Tests passed cleanly for me.&lt;/p&gt;

&lt;p&gt;A warning is now raised if you set one of the following attributes while connecting to an already booted database:&lt;/p&gt;

&lt;p&gt;  dataEncryption&lt;br/&gt;
  newBootPassword&lt;br/&gt;
  newEncryptionKey&lt;br/&gt;
  decryptDatabase&lt;/p&gt;


&lt;p&gt;My original plan was to raise an exception in these situations. The Reference Manual is quite clear that dataEncryption=true is supposed to be used to change the encryption state of a database. However, I decided that some applications may set dataEncryption=true every time that they connect to an encrypted database--in previous releases that attribute has been treated as a NOP if the database is already booted. So I downgraded the exception to a warning. I suppose that we could still raise an exception for the other attributes (I don&apos;t imagine anyone sets those attributes unless they really mean to change the encryption state of the database). But it seemed cleaner to me to have one SQLState for this condition and to treat all of the cases the same way.&lt;/p&gt;

&lt;p&gt;After committing this patch, we will want to modify the user guides to clarify the following point:&lt;/p&gt;

&lt;p&gt;o If you are changing the encryption state of the database, be sure to check for SQLWarnings after the change. The change succeeded only if there were no SQLWarnings or SQLExceptions.&lt;/p&gt;

&lt;p&gt;We should probably add a release note too just in case applications are checking for SQLWarnings after connecting to an already booted database with dataEncryption=true.&lt;/p&gt;

&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;------------------&lt;/p&gt;

&lt;p&gt;M       java/engine/org/apache/derby/impl/jdbc/EmbedConnection.java&lt;br/&gt;
M       java/engine/org/apache/derby/loc/messages.xml&lt;br/&gt;
M       java/shared/org/apache/derby/shared/common/reference/SQLState.java&lt;/p&gt;

&lt;p&gt;Raise new warning.&lt;/p&gt;

&lt;p&gt;------------------&lt;/p&gt;

&lt;p&gt;M       java/testing/org/apache/derbyTesting/functionTests/tests/store/DecryptDatabaseTest.java&lt;br/&gt;
M       java/testing/org/apache/derbyTesting/junit/BaseJDBCTestCase.java&lt;/p&gt;

&lt;p&gt;New tests to verify that the warning is raised.&lt;/p&gt;

&lt;p&gt;------------------&lt;/p&gt;

&lt;p&gt;M       java/testing/org/apache/derbyTesting/functionTests/master/URLCheck.out&lt;/p&gt;

&lt;p&gt;Adjust a test canon.&lt;/p&gt;</comment>
                            <comment id="13489389" author="rhillegas" created="Fri, 2 Nov 2012 12:31:23 +0000"  >&lt;p&gt;Committed derby-5969-01-aa-warnEncryptionOnBootedDB.diff at subversion revision 1404947.&lt;/p&gt;</comment>
                            <comment id="13489414" author="rhillegas" created="Fri, 2 Nov 2012 13:20:42 +0000"  >&lt;p&gt;Attaching the first rev of a release note for this issue.&lt;/p&gt;</comment>
                            <comment id="13493444" author="rhillegas" created="Thu, 8 Nov 2012 19:43:55 +0000"  >&lt;p&gt;Resolving this issue as fixed now that user documentation has been written and the release note has been posted.&lt;/p&gt;</comment>
                            <comment id="13695130" author="mikem" created="Thu, 27 Jun 2013 23:42:19 +0100"  >&lt;p&gt;don&apos;t think this one should be backported.  it is a behavior change with a release note for 10.10, so&lt;br/&gt;
not appropriate to backport to an existing release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12364289">DERBY-2409</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12613922">DERBY-5968</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12364289">DERBY-2409</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12558594">DERBY-5792</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12614376">DERBY-5976</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12551714" name="derby-5969-01-aa-warnEncryptionOnBootedDB.diff" size="5889" author="rhillegas" created="Thu, 1 Nov 2012 14:28:16 +0000"/>
                            <attachment id="12551859" name="releaseNote.html" size="3012" author="rhillegas" created="Fri, 2 Nov 2012 13:20:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10361"><![CDATA[Security]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 27 Jun 2013 22:42:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>252815</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10101"><![CDATA[Release Note Needed]]></customfieldvalue>
    <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy72yv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>75138</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>