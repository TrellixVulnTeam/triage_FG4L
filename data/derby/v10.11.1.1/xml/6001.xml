<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:49:09 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6001/DERBY-6001.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6001] ErrorMessageTest assert failure: Only one of the waiters should be aborted</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6001</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I occasionally see this test failure on some ARM devices:&lt;/p&gt;

&lt;p&gt;junit.framework.AssertionFailedError: Only one of the waiters should be aborted&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.ErrorMessageTest.testDeadlockTimeout(ErrorMessageTest.java:206)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:424)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:441)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;/p&gt;

&lt;p&gt;It&apos;s probably timing-dependent, since the failing test case runs two threads, and the devices where it&apos;s seen are slow compared to most other test servers.&lt;/p&gt;</description>
                <environment>Java SE Embedded 7u6 for ARM</environment>
        <key id="12617075">DERBY-6001</key>
            <summary>ErrorMessageTest assert failure: Only one of the waiters should be aborted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Nov 2012 10:06:57 +0000</created>
                <updated>Mon, 17 Jun 2013 10:27:20 +0100</updated>
                            <resolved>Thu, 29 Nov 2012 14:12:02 +0000</resolved>
                                    <version>10.10.1.1</version>
                                    <fixVersion>10.10.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13501837" author="knutanders" created="Wed, 21 Nov 2012 10:29:53 +0000"  >&lt;p&gt;Attaching d6001-1a-diagnostics.diff which makes the test print more information when this failure happens. It should now print the stack traces of both failing threads the next time it happens.&lt;/p&gt;

&lt;p&gt;Committed revision 1412042.&lt;/p&gt;</comment>
                            <comment id="13502717" author="knutanders" created="Thu, 22 Nov 2012 11:00:28 +0000"  >&lt;p&gt;This happened again. With the improved diagnostics, I found in the log that one of the threads failed with the expected deadlock exception, and the other thread failed with a timeout exception. So it seems like the difference between the deadlock timeout and the regular wait timeout is too small on this platform. The deadlock is detected, as expected, but the chosen victim is not terminated quickly enough to prevent the other transaction from timing out.&lt;/p&gt;

&lt;p&gt;Since this test case is not expected to produce a timeout, I think we can increase the lock timeout without slowing it down in the common case. That should give slower machines more time to kill the victim before the timeout expires. Faster machines don&apos;t need to wait for the timeout to happen, so they should be unaffected.&lt;/p&gt;</comment>
                            <comment id="13502750" author="knutanders" created="Thu, 22 Nov 2012 12:57:33 +0000"  >&lt;p&gt;Attaching d6001-2a-waitTimeout.diff which increases the wait timeout for testDeadlockTimeout to 60 seconds. The test still completes in just a few seconds, as the higher timeout just gives it a larger window, it doesn&apos;t require the test to use the entire available time slot.&lt;/p&gt;

&lt;p&gt;Since the test now uses different timeout values for testLockTimeout and testDeadlockTimeout, I also reduced the wait timeout for the former test case to speed it up. That test case is single-threaded and not timing sensitive, so reducing the timeout should not reduce the chance of success.&lt;/p&gt;

&lt;p&gt;I also reduced the deadlock timeout for testDeadlockTimeout to 1 second, as it is the difference between the wait timeout and the deadlock timeout that&apos;s determining the chance of success, not the size of the deadlock timeout. So we could just as well keep it short to make the test complete faster (even if it&apos;s just one second faster).&lt;/p&gt;

&lt;p&gt;I&apos;m running the test in a loop on one of the machines where I&apos;ve seen the problem (successfully so far). The problem happens a lot less frequently when the test runs standalone, though, so I&apos;m sure that necessarily will help finding out if it&apos;s fixed.&lt;/p&gt;

&lt;p&gt;(suites.All takes 15 hours on that platform, so I&apos;m not going to run suites.All in a loop to verify the fix...)&lt;/p&gt;</comment>
                            <comment id="13502811" author="knutanders" created="Thu, 22 Nov 2012 15:06:05 +0000"  >&lt;p&gt;The test has been running in a loop for a couple of hours without failing.&lt;/p&gt;

&lt;p&gt;Committed revision 1412577.&lt;/p&gt;

&lt;p&gt;I&apos;m keeping the issue open until we&apos;ve seen that the test runs more reliably in a few full test runs.&lt;/p&gt;</comment>
                            <comment id="13506485" author="knutanders" created="Thu, 29 Nov 2012 14:12:02 +0000"  >&lt;p&gt;Haven&apos;t seen this again after the fix went in. Resolving.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12431594">DERBY-4323</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12554478" name="d6001-1a-diagnostics.diff" size="2142" author="knutanders" created="Wed, 21 Nov 2012 10:29:53 +0000"/>
                            <attachment id="12554673" name="d6001-2a-waitTimeout.diff" size="3434" author="knutanders" created="Thu, 22 Nov 2012 12:57:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>259005</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyf21j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>121860</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>