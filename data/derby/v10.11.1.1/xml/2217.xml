<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:16:48 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2217/DERBY-2217.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2217] Convert upgrade tests to Junit</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2217</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Also support running against multiple old versions.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12359906">DERBY-2217</key>
            <summary>Convert upgrade tests to Junit</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="djd">Daniel John Debrunner</assignee>
                                    <reporter username="djd">Daniel John Debrunner</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Jan 2007 22:07:30 +0000</created>
                <updated>Fri, 25 Jul 2008 18:37:11 +0100</updated>
                            <resolved>Fri, 23 Mar 2007 22:21:23 +0000</resolved>
                                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12463147" author="djd" created="Mon, 8 Jan 2007 22:29:51 +0000"  >&lt;p&gt;Revision 494201 (trunk) has a working JUnit based upgrade test that handles multiple old versions and does not hit sealing issues seen by the older harness based test.&lt;br/&gt;
The test uses the same property to specifiy the location of the old released jars &lt;b&gt;but&lt;/b&gt; in a different way to the old test.&lt;/p&gt;

&lt;p&gt;The old test used&lt;/p&gt;

&lt;p&gt;$&lt;/p&gt;
{derbyTesting.jar.path}/M.m/derby.jar&lt;br/&gt;
&lt;br/&gt;
The new setup uses (to allow multiple releases at the same major.minor&lt;br/&gt;
&lt;br/&gt;
${derbyTesting.jar.path}
&lt;p&gt;/M.m.f.p/lib/derby.jar&lt;/p&gt;

&lt;p&gt;The set of old releases tested against is given by a list in _Suite. This was to allow a releases folder to contain a number of previous releases and have derbyTesting.jar.path point to it.&lt;br/&gt;
e.g.&lt;/p&gt;

&lt;p&gt;/derby/releases/10.0.2.1&lt;br/&gt;
/derby/releases/10.1.3.1&lt;br/&gt;
etc.&lt;/p&gt;

&lt;p&gt;I have not changed the tools/testing folder to the new scheme, this new JUnit upgrade test does not yet include all the cases from the old test. If we wanted to switch to the new scheme incrementally then I could change the property used by the JUnit test to something else (e.g. derbyTesting.oldReleases) and then we could run the tests in parallel until the new one is a super-set of the old.&lt;/p&gt;

&lt;p&gt;The test can be run as a standard JUnit test., though it has to be run using the _Suite class:&lt;/p&gt;

&lt;p&gt;org.apache.derbyTesting.functionTests.tests.upgradeTests._Suite&lt;/p&gt;

&lt;p&gt;If the system property derbyTesting.jar.path is not set, then no tests will be run.&lt;/p&gt;

&lt;p&gt;If for an old release the folder $&lt;/p&gt;
{derbyTesting.jar.path}
&lt;p&gt;/M.m.f.p/lib does not exist then that old release will be skipped.&lt;/p&gt;

&lt;p&gt;It&apos;s not hooked up into any standard run (e.g. suites.All) due to the changes need to jar layout and that in trunk upgrading from 10.0 fails (need to check out why).&lt;/p&gt;

&lt;p&gt;&apos;m also not sure if all the old releases should be in a code line, or just a sub-set. The test would handle either situation and maybe running all the old versions could be left to those that want to (by pointing the property to a folder with all the old releases).&lt;br/&gt;
(BTW currently with five old releases the test takes around 25 seconds)&lt;/p&gt;
</comment>
                            <comment id="12464054" author="myrna" created="Fri, 12 Jan 2007 00:02:03 +0000"  >&lt;p&gt;I generally like the new approach.&lt;/p&gt;

&lt;p&gt;I have some small concerns though.&lt;br/&gt;
1. This test presumably relies on the new changes to support junit tests...And thus it is not applicable for 10.2 branch.&lt;br/&gt;
    Where does that leave us for the 10.2 branch? Is it acceptable to continue automated runs there with an upgrade from 10.1.1.0 to 10.2.(latest)?&lt;br/&gt;
   I tried to use derbyTesting.jar with the new tests, and 10.2.2.0 derby.jar to see if that was an approach that would work, but I get errors.&lt;/p&gt;

&lt;p&gt;2. I noticed the automatic specification of the jarlocation  (done in upgradeTests/build.xml via a  _app file) has been dropped. I think that&apos;s ok - but it assumes we will have to run suites.All with the new property passed in, or the upgrade tests will get skipped.&lt;/p&gt;
</comment>
                            <comment id="12464072" author="djd" created="Fri, 12 Jan 2007 02:05:46 +0000"  >&lt;p&gt;Thanks for looking at the code Myrna.&lt;/p&gt;

&lt;p&gt;On 1) currently it&apos;s not my itch to solve the 10.2 tests. I too tried the 10.2 derby.jar with the new tests and had some issues, though I thought I&apos;d got it to work partially, since I managed to test the upgrade from 10.0 was not broken in 10.2. (see &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2221&quot; title=&quot;Cannot re-connect to 10.0 database after soft upgrade with 10.3 (trunk) code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2221&quot;&gt;&lt;del&gt;DERBY-2221&lt;/del&gt;&lt;/a&gt;). I&apos;ll re-run again and see what happens.&lt;/p&gt;

&lt;p&gt;On 2) I was hoping that I could set the property for the old release directory automatically when running the tests via the ant targets in build.xml.&lt;/p&gt;</comment>
                            <comment id="12464398" author="djd" created="Sat, 13 Jan 2007 02:20:26 +0000"  >&lt;p&gt;I changed the junit upgrade test to use a different property from the old test to describe the location of the old jars.&lt;br/&gt;
The new test uses:&lt;/p&gt;

&lt;p&gt;derbyTesting.oldReleasePath&lt;/p&gt;</comment>
                            <comment id="12465217" author="djd" created="Tue, 16 Jan 2007 17:10:56 +0000"  >&lt;p&gt;Need metadata tests in JUnit form for the upgrade tests.&lt;/p&gt;</comment>
                            <comment id="12465358" author="djd" created="Wed, 17 Jan 2007 04:44:12 +0000"  >&lt;p&gt;Current state.&lt;br/&gt;
The test currently passes with these JVMs (running trunk against all old releases except the incubator 10.0 release)&lt;/p&gt;

&lt;p&gt;Sun JDK 1.4.2&lt;br/&gt;
Sun JDK 1.5&lt;br/&gt;
IBM SDK 1.5&lt;/p&gt;

&lt;p&gt;With Java SE 6 the test fails, seems to find the classes for the new version when the old version is expected and successfully picked up by other JVMs.&lt;br/&gt;
Most likely the test configuration is looking for the JDBC 4 data sources which don&apos;t exist in the old versions of Derby, thus they resolve to the current version. Probably need to force JDBC 3 data sources as the data source class to use if the old version is older than 10.2.2.0.&lt;/p&gt;

&lt;p&gt;With these two J2ME/CDC/Foundation JVMs the test hangs.&lt;/p&gt;

&lt;p&gt;IBM WCTME 5.7&lt;br/&gt;
IBM WEME 6.1&lt;/p&gt;</comment>
                            <comment id="12483779" author="djd" created="Fri, 23 Mar 2007 22:21:23 +0000"  >&lt;p&gt;Test converted to JUnit, hooked into suites.All if property pointing to old releases is set.&lt;/p&gt;</comment>
                            <comment id="12484506" author="rhillegas" created="Tue, 27 Mar 2007 18:21:22 +0100"  >&lt;p&gt;This is great work. Thanks, Dan. I find that the JUnit-ized upgrade test runs cleanly against all of the releases from 10.1.1.0 onward. However, I see 4 errors when I run against 10.0.2.1:&lt;/p&gt;

&lt;p&gt;1) testNegValueSupportedLogRecord(org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3)java.sql.SQLException: &apos;SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE&apos; is not recognized as a function or procedure.&lt;/p&gt;

&lt;p&gt;...&lt;/p&gt;

&lt;p&gt;2) testGetTablesModify(org.apache.derbyTesting.functionTests.tests.jdbcapi.DatabaseMetaDataTest)java.sql.SQLException: Use of &apos;XML&apos; requires database to be upgraded from version 10.0 to version 10.1 or later.&lt;/p&gt;

&lt;p&gt;...&lt;/p&gt;

&lt;p&gt;3) testNegValueSupportedLogRecord(org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3)ERROR 42Y03: &apos;SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE&apos; is not recognized as a function or procedure.&lt;/p&gt;

&lt;p&gt;...&lt;/p&gt;

&lt;p&gt;4) Upgrade Phase: UPGRADEjava.sql.SQLException: Failed to start database &apos;singleUse/oneuse0&apos;, see the next exception for details.&lt;/p&gt;</comment>
                            <comment id="12484556" author="djd" created="Tue, 27 Mar 2007 20:20:30 +0100"  >&lt;p&gt;4) is probably the same as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2221&quot; title=&quot;Cannot re-connect to 10.0 database after soft upgrade with 10.3 (trunk) code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2221&quot;&gt;&lt;del&gt;DERBY-2221&lt;/del&gt;&lt;/a&gt;. I stopped running on 10.0 when I hit that issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12360547">DERBY-2242</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12348420">DERBY-1746</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 12 Jan 2007 00:02:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30329</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ymn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39428</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>