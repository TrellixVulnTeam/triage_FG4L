<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:17:06 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6346/DERBY-6346.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6346] NPE in left join whose inner table has a generated column</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6346</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Derby trips over an NPE while processing a left join whose inner table has a generated column. The NPE is not printed to derby.log, indicating another problem. The bug goes as far back as 10.5.1.1, the release which introduced generated columns. The NPE does NOT crash the connection. The application can continue issuing statements on the connection.&lt;/p&gt;

&lt;p&gt;The following script shows this problem:&lt;/p&gt;

&lt;p&gt;connect &apos;jdbc:derby:memory:db;create=true&apos;;&lt;/p&gt;

&lt;p&gt;create table t1( c1 int, c2 int generated always as ( -c1 ) );&lt;br/&gt;
create table t2( c1 int );&lt;/p&gt;

&lt;p&gt;insert into t1( c1 ) values ( 2 ), ( 20 );&lt;br/&gt;
insert into t2( c1 ) values ( 2 ), ( 200 );&lt;/p&gt;

&lt;p&gt;&amp;#8211; raises a SQLException wrapping an NPE&lt;br/&gt;
select * from t2 left join t1 on t1.c1 = t2.c1;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12668873">DERBY-6346</key>
            <summary>NPE in left join whose inner table has a generated column</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Rick Hillegas</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Sep 2013 20:42:10 +0100</created>
                <updated>Wed, 16 Apr 2014 03:41:09 +0100</updated>
                            <resolved>Wed, 18 Sep 2013 13:15:53 +0100</resolved>
                                    <version>10.5.1.1</version>
                                    <fixVersion>10.10.2.0</fixVersion>
                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13768685" author="rhillegas" created="Mon, 16 Sep 2013 21:01:05 +0100"  >&lt;p&gt;Attaching derby-6346-01-aa-logJavaException.diff. This patch adds some exception printing code to a utility method which wraps a SQLException around another Java exception. I will run tests.&lt;/p&gt;

&lt;p&gt;Touches the following file:&lt;/p&gt;

&lt;p&gt;M       java/engine/org/apache/derby/impl/jdbc/Util.java&lt;/p&gt;</comment>
                            <comment id="13769482" author="jira-bot" created="Tue, 17 Sep 2013 13:56:20 +0100"  >&lt;p&gt;Commit 1524026 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhillegas&quot; class=&quot;user-hover&quot; rel=&quot;rhillegas&quot;&gt;Rick Hillegas&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1524026&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1524026&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6346&quot; title=&quot;NPE in left join whose inner table has a generated column&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6346&quot;&gt;&lt;del&gt;DERBY-6346&lt;/del&gt;&lt;/a&gt;: Dump wrapped Java exceptions to derby.log; tests passed cleanly on derby-6346-01-aa-logJavaException.diff.&lt;/p&gt;</comment>
                            <comment id="13769520" author="jira-bot" created="Tue, 17 Sep 2013 14:34:13 +0100"  >&lt;p&gt;Commit 1524037 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhillegas&quot; class=&quot;user-hover&quot; rel=&quot;rhillegas&quot;&gt;Rick Hillegas&lt;/a&gt; in branch &apos;code/branches/10.10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1524037&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1524037&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6346&quot; title=&quot;NPE in left join whose inner table has a generated column&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6346&quot;&gt;&lt;del&gt;DERBY-6346&lt;/del&gt;&lt;/a&gt;: Port 1524026 from trunk to 10.10 branch.&lt;/p&gt;</comment>
                            <comment id="13769680" author="rhillegas" created="Tue, 17 Sep 2013 17:57:32 +0100"  >&lt;p&gt;Attaching derby-6346-02-aa-generateNullForLeftJoins.diff. This patches the code generator so that it doesn&apos;t skip creating NULL values for generated columns on the inner side of a LEFT JOIN. I am running tests now.&lt;/p&gt;

&lt;p&gt;The NPE occurs because the empty right row of the LEFT JOIN contains a Java null rather than a NULL DataValueDescriptor. This happens because of a bug in the code-generation of ResultColumnLists when generating code for generated columns. That, in turn, happens because the code-generation of generated columns happens elsewhere for INSERT and UPDATE statements. The fix is to try to distinguish a ResultColumnList for a SELECT from a ResultColumnList for an INSERT/UPDATE. If the ResultColumnList is for a SELECT, then we code-generate a NULL DataValueDescriptor for the generated column. Otherwise, we don&apos;t.&lt;/p&gt;

&lt;p&gt;The test for whether the ResultColumnList represents a SELECT is to check whether the ResultColumn&apos;s source expression is a VirtualColumnNode. This is tricky and brittle. This check can be improved if someone has a better suggestion for how to distinguish the two kinds of lists.&lt;/p&gt;

&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;---------&lt;/p&gt;

&lt;p&gt;M       java/engine/org/apache/derby/impl/sql/compile/ResultColumnList.java&lt;/p&gt;

&lt;p&gt;The fix.&lt;/p&gt;

&lt;p&gt;---------&lt;/p&gt;

&lt;p&gt;M       java/testing/org/apache/derbyTesting/functionTests/tests/lang/GeneratedColumnsTest.java&lt;/p&gt;

&lt;p&gt;Adds a regression test case for this bug.&lt;/p&gt;</comment>
                            <comment id="13769851" author="jira-bot" created="Tue, 17 Sep 2013 20:52:19 +0100"  >&lt;p&gt;Commit 1524194 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhillegas&quot; class=&quot;user-hover&quot; rel=&quot;rhillegas&quot;&gt;Rick Hillegas&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1524194&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1524194&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6346&quot; title=&quot;NPE in left join whose inner table has a generated column&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6346&quot;&gt;&lt;del&gt;DERBY-6346&lt;/del&gt;&lt;/a&gt;: Fix LEFT JOIN involving a table with a generated column; tests passed cleanly on derby-6346-02-aa-generateNullForLeftJoins.diff.&lt;/p&gt;</comment>
                            <comment id="13770697" author="jira-bot" created="Wed, 18 Sep 2013 13:12:40 +0100"  >&lt;p&gt;Commit 1524385 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhillegas&quot; class=&quot;user-hover&quot; rel=&quot;rhillegas&quot;&gt;Rick Hillegas&lt;/a&gt; in branch &apos;code/branches/10.10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1524385&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1524385&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6346&quot; title=&quot;NPE in left join whose inner table has a generated column&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6346&quot;&gt;&lt;del&gt;DERBY-6346&lt;/del&gt;&lt;/a&gt;: Port 1524194 from trunk to 10.10 branch.&lt;/p&gt;</comment>
                            <comment id="13770702" author="rhillegas" created="Wed, 18 Sep 2013 13:15:53 +0100"  >&lt;p&gt;Resolving as fixed in 10.11 and 10.10.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12603413" name="derby-6346-01-aa-logJavaException.diff" size="729" author="rhillegas" created="Mon, 16 Sep 2013 21:01:05 +0100"/>
                            <attachment id="12603615" name="derby-6346-02-aa-generateNullForLeftJoins.diff" size="3430" author="rhillegas" created="Tue, 17 Sep 2013 17:57:32 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 17 Sep 2013 12:56:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>348805</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzhzlj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>349103</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>