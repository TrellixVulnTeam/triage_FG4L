<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:46:59 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-738/DERBY-738.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-738] Initialize parameters within activation without using generated code.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-738</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;For each parameter in a query the following code is generated, e.g. for the 23rd parameter INT parameter.&lt;/p&gt;

&lt;p&gt;this.pvs.setStorableDataValue(&lt;br/&gt;
    this.getDataValueFactory().getNullInteger(),&lt;br/&gt;
    22, // parameter number&lt;br/&gt;
    4, // Types.INTEGER&lt;br/&gt;
     &quot;java.lang.Integer&quot;);&lt;/p&gt;

&lt;p&gt;Apart being a significant amount of code per parameter , each of these will result in a new class pool entry for:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;each parameter number (beyond 5)&lt;/li&gt;
	&lt;li&gt;each unique Types.XXX value (beyond 5)&lt;/li&gt;
	&lt;li&gt;each unique class name for a type&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(integer constants -1 through 5 are special cased as instructions in the JVM bytecode and do not require constant pool entries)&lt;/p&gt;

&lt;p&gt;This code is generated in the post constructor method of the generated class and its purpose is to allocate a holder DataValueDescriptor of the correct type to the ParameterValueSet for the statement. These are the parameters that will be directly set by the JDBC application.&lt;/p&gt;

&lt;p&gt;This code is generated by the method ParameterNode.generateHolder();&lt;/p&gt;

&lt;p&gt;The actual instanceof the ParameterValueSet is generated with a single call, by the generated code passing in the number of parameters to BaseActivation.setParameterValueSet. This then generates the structure for the parameters but does not create the DataValueDescriptors since the types are not known.&lt;/p&gt;

&lt;p&gt;The fix is to use the type definitions stored in the associated language PreparedStatement (prepared plan) DataTypeDescriptor[] to generate the null values and initalize the parameters.&lt;/p&gt;

&lt;p&gt;I&apos;m looking at replacing the ParameterValueSet.setStorableDataValue with an initialize method like:&lt;/p&gt;

&lt;p&gt;	public void initialize(DataTypeDescriptor[] types)&lt;br/&gt;
	{&lt;br/&gt;
		for (int i = 0; i &amp;lt; parms.length; i++)&lt;/p&gt;
		{
			DataTypeDescriptor dtd = types[i];
			
			parms[i].initialize(dtd.getNull(),
					dtd.getJDBCTypeId(),
                                        dtd.getTypeId().getCorrespondingJavaTypeName());
		}
&lt;p&gt;	}&lt;/p&gt;

&lt;p&gt;With this, no code is required in the postConstructor() for a parameter. The initialize method is called when&lt;br/&gt;
the activation is linked to its prepared statement.. With my prototype the generated code size for the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-732&quot; title=&quot;ERROR XBCM1: Java linkage error thrown during load of generated class  for  query with large number of logical operators and substitution parameters.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-732&quot;&gt;&lt;del&gt;DERBY-732&lt;/del&gt;&lt;/a&gt; query dropped from around 70k to 60k. Of course this does not fix &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-732&quot; title=&quot;ERROR XBCM1: Java linkage error thrown during load of generated class  for  query with large number of logical operators and substitution parameters.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-732&quot;&gt;&lt;del&gt;DERBY-732&lt;/del&gt;&lt;/a&gt;, since it is not reducing code in the where clause method.&lt;/p&gt;









</description>
                <environment></environment>
        <key id="12326252">DERBY-738</key>
            <summary>Initialize parameters within activation without using generated code.</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12326197">DERBY-732</parent>
                                    <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="djd">Daniel John Debrunner</assignee>
                                    <reporter username="djd">Daniel John Debrunner</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Dec 2005 05:25:40 +0000</created>
                <updated>Fri, 2 Nov 2007 15:45:05 +0000</updated>
                            <resolved>Tue, 6 Dec 2005 04:52:21 +0000</resolved>
                                    <version>10.1.3.2</version>
                                    <fixVersion>10.1.3.2</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12359338" author="djd" created="Tue, 6 Dec 2005 04:52:21 +0000"  >&lt;p&gt;Svn Revision: 354142&lt;/p&gt;</comment>
                            <comment id="12539622" author="kmarsden" created="Fri, 2 Nov 2007 15:45:05 +0000"  >&lt;p&gt;Merged fix 354142 to 10.1 for this issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 2 Nov 2007 15:45:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29681</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy10tz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39785</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>