<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:36:08 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1044/DERBY-1044.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1044] [xa] client XAConnection.getConnection()  does not have the correct  default isolation level if set by an earlier connection obtained from the same XAConnection</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1044</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If the isolation level is set on a connection obtained with XAConnection.getConnection()  and then another connection is obtained from the same XAConnection, then the isolation will not be the default READ_COMMITTED but will be the isolation level set on the previous connection.  &lt;/p&gt;

&lt;p&gt;See this code in checkDataSource.java&lt;br/&gt;
I will add a reference to this bug&lt;/p&gt;

&lt;p&gt;               cs1 = xac.getConnection();&lt;br/&gt;
		printState(&quot;new handle - local &quot;, cs1);&lt;br/&gt;
		cs1.close();&lt;/p&gt;

&lt;p&gt;		xar.start(xid, XAResource.TMJOIN);&lt;br/&gt;
		cs1 = xac.getConnection();&lt;br/&gt;
                cs1.setTransactionIsolation(Connection.TRANSACTION_REPEATABLE_READ);&lt;br/&gt;
		printState(&quot;pre-X1 commit - local&quot;, cs1);&lt;br/&gt;
		xar.start(xid, XAResource.TMJOIN);&lt;br/&gt;
		printState(&quot;pre-X1 commit - X1&quot;, cs1);&lt;br/&gt;
		xar.end(xid, XAResource.TMSUCCESS);&lt;br/&gt;
		printState(&quot;post-X1 end - local&quot;, cs1);&lt;br/&gt;
		xar.commit(xid, true);&lt;br/&gt;
		printState(&quot;post-X1 commit - local&quot;, cs1);&lt;br/&gt;
		cs1.close();&lt;/p&gt;

&lt;p&gt;		System.out.println(&quot;Some more isolation testing using SQL and JDBC api&quot;);&lt;br/&gt;
                //  The  initial isolation level for this connection is REPEATABLE_READ.  Left over from the last connection.&lt;br/&gt;
               // It should be READ_COMMITTED&lt;br/&gt;
		cs1 = xac.getConnection();&lt;br/&gt;
		s = cs1.createStatement();&lt;br/&gt;
		printState(&quot;initial local&quot;, cs1);&lt;/p&gt;</description>
                <environment></environment>
        <key id="12329406">DERBY-1044</key>
            <summary>[xa] client XAConnection.getConnection()  does not have the correct  default isolation level if set by an earlier connection obtained from the same XAConnection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kmarsden">Kathey Marsden</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Feb 2006 09:34:09 +0000</created>
                <updated>Sat, 8 Apr 2006 12:16:54 +0100</updated>
                            <resolved>Sat, 8 Apr 2006 12:16:31 +0100</resolved>
                                    <version>10.1.3.1</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.1.3.1</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12371107" author="kmarsden" created="Tue, 21 Mar 2006 00:38:30 +0000"  >&lt;p&gt;I looked at this a bit closer and it seems that it is the&lt;br/&gt;
return value of getTransactionIsolation that is wrong.&lt;br/&gt;
The connection acts like READ_COMMITTED so the two don&apos;t match.&lt;/p&gt;


&lt;p&gt;See attached standalone repro: Start Network Server and run:&lt;br/&gt;
java -Dframework=DerbyNetClient IsoChange&lt;/p&gt;


&lt;p&gt;D&amp;gt;java -Dframework=DerbyNetClient IsoChange&lt;br/&gt;
10.2.0.0 alpha&lt;br/&gt;
Apache Derby&lt;br/&gt;
Apache Derby Network Client JDBC Driver&lt;br/&gt;
done creating  table&lt;/p&gt;

&lt;p&gt;setTransactionIsolation(Connection.TRANSACTION_READ_UNCOMMITTED&lt;br/&gt;
conn.getTransactionIsolation()TRANSACTION_READ_UNCOMMITTED:1&lt;br/&gt;
BEHAVIOUR MATCHES READ_UNCOMMITTED&lt;/p&gt;

&lt;p&gt;Get a new connection with XAConnection.getConnection&lt;br/&gt;
Isolation level should be reset to READ_COMMITTED&lt;br/&gt;
conn.getTransactionIsolation()TRANSACTION_READ_UNCOMMITTED:1&lt;br/&gt;
LOCK TIMEOUT: BEHAVIOUR MATCHES READ_COMMITTED&lt;/p&gt;</comment>
                            <comment id="12371108" author="kmarsden" created="Tue, 21 Mar 2006 00:40:07 +0000"  >&lt;p&gt;Bumping to critical as this could cause wrong results  in a connection pooling environment.&lt;/p&gt;</comment>
                            <comment id="12371293" author="kmarsden" created="Wed, 22 Mar 2006 04:58:19 +0000"  >&lt;p&gt;I verified that this is a generic problem for connections obtained from PooledConnections so is not limitted to XA.  Should I open another issue for that or is it ok to just fix it under this one?&lt;/p&gt;

&lt;p&gt;This small change fixes the symptom but I am a bit perplexed about why it was  explicitly set to false to &lt;b&gt;not&lt;/b&gt;  recompute the state from the datasource before and the difference in the new connection case where it calls lightreset.&lt;/p&gt;

&lt;p&gt;Regardless, hopefully I will have a patch for this issue soon.  Please send on any comments or insight.  Thanks.&lt;/p&gt;


&lt;p&gt;Index: java/client/org/apache/derby/client/ClientPooledConnection.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; java/client/org/apache/derby/client/ClientPooledConnection.java     (revision 387603)&lt;br/&gt;
+++ java/client/org/apache/derby/client/ClientPooledConnection.java     (working copy)&lt;br/&gt;
@@ -173,7 +173,7 @@&lt;br/&gt;
             createLogicalConnection();&lt;/p&gt;

&lt;p&gt;             if (!newPC_) &lt;/p&gt;
{
-                physicalConnection_.reset(logWriter_, user_, password_, ds_, false); // false means do not recompute
+                physicalConnection_.reset(logWriter_, user_, password_, ds_, true); // true means do recompute
             }
&lt;p&gt;             // properties from the dataSource&lt;br/&gt;
             // properties don&apos;t change&lt;/p&gt;</comment>
                            <comment id="12371624" author="kmarsden" created="Fri, 24 Mar 2006 03:38:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1044&quot; title=&quot;[xa] client XAConnection.getConnection()  does not have the correct  default isolation level if set by an earlier connection obtained from the same XAConnection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1044&quot;&gt;&lt;del&gt;DERBY-1044&lt;/del&gt;&lt;/a&gt; is a manifistation of this bug&lt;/p&gt;</comment>
                            <comment id="12373710" author="kmarsden" created="Sat, 8 Apr 2006 12:16:29 +0100"  >&lt;p&gt;This issue is a manifestation of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1144&quot; title=&quot;With client PooledConnection.getConnection() does not reset holdability and isolation state properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1144&quot;&gt;&lt;del&gt;DERBY-1144&lt;/del&gt;&lt;/a&gt; and fixed with that issue.&lt;/p&gt;

&lt;p&gt;Date: Fri Apr  7 18:16:59 2006&lt;br/&gt;
New Revision: 392471&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12330618">DERBY-1144</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12324379" name="IsoChange.java" size="5165" author="kmarsden" created="Tue, 21 Mar 2006 00:38:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22279</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy16wn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40769</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>