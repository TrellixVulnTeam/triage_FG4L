<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:32:52 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1474/DERBY-1474.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1474] Add assertEquals overloads for Blob and Clob</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1474</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Add assertEquals(Blob,Blob) and assertEquals(Clob,Clob) to BaseJDBCTestCase.&lt;br/&gt;
The naming follows the JUnit scheme, and the methods throws an AssertionFailedError if the objects passed in are not equal.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12345367">DERBY-1474</key>
            <summary>Add assertEquals overloads for Blob and Clob</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12330375">DERBY-1122</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kristwaa">Kristian Waagan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Jul 2006 19:42:40 +0100</created>
                <updated>Fri, 7 Jul 2006 18:38:02 +0100</updated>
                            <resolved>Thu, 6 Jul 2006 20:59:56 +0100</resolved>
                                    <version>10.2.1.6</version>
                    <version>10.3.1.4</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12419094" author="kristwaa" created="Tue, 4 Jul 2006 19:59:00 +0100"  >&lt;p&gt;&apos;derby-1474-1a.diff&apos; implements the two methods assertEquals(Blob,Blob) and assertEquals(Clob,Clob) in BaseJDBCTestCase.&lt;/p&gt;

&lt;p&gt;Patch is ready for review/comments.&lt;/p&gt;</comment>
                            <comment id="12419490" author="kristwaa" created="Thu, 6 Jul 2006 19:43:36 +0100"  >&lt;p&gt;&apos;derby-1474-1b.diff&apos; replaces version 1a. Found two typos, causing the blob references to be compared instead of the blob bytes. The new patch only replaces two variable names in one location.&lt;/p&gt;

&lt;p&gt;Unless someone plans to review, I think a committer can have a look at the patch.&lt;/p&gt;</comment>
                            <comment id="12419510" author="knutanders" created="Thu, 6 Jul 2006 20:57:21 +0100"  >&lt;p&gt;I have reviewed the patch. The methods look very useful. I found one issue: assertEquals(Blob,Blob) has assertNull() on b1/b2 where the assert should be on is1/is2. Attached is an updated patch with that one fixed. Also, I fixed a spelling error in a comment and made the methods static. I will commit the new patch. Thank you, Kristian.&lt;/p&gt;</comment>
                            <comment id="12419513" author="knutanders" created="Thu, 6 Jul 2006 20:59:56 +0100"  >&lt;p&gt;Committed derby-1474-1c.diff into trunk with revision 419542.&lt;/p&gt;</comment>
                            <comment id="12419526" author="andreask" created="Thu, 6 Jul 2006 21:56:36 +0100"  >&lt;p&gt;Just some minor comments (sorry I did not catch this earlier), however I guess these comments can be addressed in an additional patch:&lt;/p&gt;

&lt;p&gt;In this while loops, the code will do a String-concatenation for each byte in the Blob:&lt;br/&gt;
+            int by1 = is1.read();&lt;br/&gt;
+            int by2 = is2.read();&lt;br/&gt;
+            do &lt;/p&gt;
{
+                assertEquals(&quot;Blobs differ at index &quot; + index,
+                        by1, by2);
+                index++;
+                by1 = is1.read();
+                by2 = is2.read();
+            }
&lt;p&gt; while ( by1 != -1 || by2 != -1);&lt;/p&gt;

&lt;p&gt;Maybe in this case, it is better to do a quick comparison before doing the call to assertEquals.&lt;/p&gt;

&lt;p&gt;The other comment, is about exception handling. I find it useful to get the stack trace of SQLException and IOException.&lt;br/&gt;
I would propose to either print the stacktrace (using printStackTrace()), or let the method throw these exceptions.&lt;/p&gt;

&lt;p&gt;+        } catch (IOException ioe) &lt;/p&gt;
{
+            fail(&quot;IOException while asserting Blob equality: &quot; +
+                    ioe.getMessage());
+        }

&lt;p&gt;+        } catch (SQLException sqle) &lt;/p&gt;
{
+            fail(&quot;SQLException while asserting Clob equality: &quot; +
+                    sqle.getMessage());
+        }
</comment>
                            <comment id="12419564" author="kristwaa" created="Fri, 7 Jul 2006 00:25:25 +0100"  >&lt;p&gt;Thanks for the comments Andreas.&lt;/p&gt;

&lt;p&gt;I have changed the following in the &lt;b&gt;additional&lt;/b&gt; patch &apos;derby-1474-2a.diff&apos;:&lt;br/&gt;
 1) Closed stream on successful execution through the assert methods. I don&apos;t see much need to close when an error happens (within the assert method), including when the LOB contents differ.&lt;/p&gt;

&lt;p&gt; 2) Avoided string concatenation for every byte/char.&lt;/p&gt;

&lt;p&gt; 3) Added a method to wrap an exception in an Error-object. I ask people to have a look at this issue, as there are many ways to do this.&lt;/p&gt;

&lt;p&gt;I had to use reflection in the &apos;generateError&apos;-method in BaseTestCase, because it is compiled with 1.3. Also, the way you want to throw the exception depends on the Java version.&lt;br/&gt;
If people think this is too much bloat, the exception stack traces can just be dumped to console.&lt;br/&gt;
I&apos;m open to other approaches, but I would like to avoid having assertEquals throwing checked exceptions.&lt;/p&gt;

&lt;p&gt;I included the output from a simple test I wrote in &apos;error-output.txt&apos;, for people to see what the output and stack traces will look like with the current implementation. The test simply reads from a closed stream.&lt;/p&gt;


&lt;p&gt;Awaiting feedback &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12419589" author="knutanders" created="Fri, 7 Jul 2006 03:52:35 +0100"  >&lt;p&gt;Hi Kristian,&lt;/p&gt;

&lt;p&gt;I think your approach is good. I have a couple of comments about your&lt;br/&gt;
BaseTestCase.generateError() method. All of them are minor and just a&lt;br/&gt;
matter of taste. Please ignore them if you disagree.&lt;/p&gt;

&lt;p&gt;1) I think I would have called it throwAssertionError() and let it&lt;br/&gt;
   throw the error, not return it. That would make it analogous to&lt;br/&gt;
   SanityManager.THROWASSERT().&lt;/p&gt;

&lt;p&gt;2) You don&apos;t need reflection to generate the&lt;br/&gt;
   junit.framework.AssertionFailedError (junit.jar is in the&lt;br/&gt;
   classpath).&lt;/p&gt;

&lt;p&gt;3) You could also avoid the use of reflection to generate the&lt;br/&gt;
   java.lang.AssertionError as well. To do this, you need to modify&lt;br/&gt;
   build.xml in the same directory as BaseTestCase.java. In the second&lt;br/&gt;
   javac clause, make this change:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&amp;lt;pathelement path=&quot;$
{compile.classpath}
&lt;p&gt;&quot;/&amp;gt;&lt;br/&gt;
+        &amp;lt;pathelement path=&quot;$&lt;/p&gt;
{java14compile.classpath}
&lt;p&gt;&quot;/&amp;gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   Then the classes will be compiled against the 1.4 libraries, but&lt;br/&gt;
   since source=&quot;1.3&quot; and target=&quot;1.3&quot;, they will run on 1.3 too. With&lt;br/&gt;
   this change, generateError() could be written as simple as this:&lt;/p&gt;

&lt;p&gt;        Error error = null;&lt;br/&gt;
        if (JVMInfo.JDK_ID &amp;lt;= JVMInfo.J2SE_13) &lt;/p&gt;
{
            error = new AssertionFailedError(msg + &quot; : &quot; + cause.getMessage());
            cause.printStackTrace();
        }
&lt;p&gt; else &lt;/p&gt;
{
            error = new AssertionError(msg);
            error.initCause(cause);
        }
&lt;p&gt;        return error;&lt;/p&gt;

&lt;p&gt;   This approach is also used in the client driver.&lt;/p&gt;</comment>
                            <comment id="12419596" author="andreask" created="Fri, 7 Jul 2006 04:12:52 +0100"  >&lt;p&gt;I do not think it is a problem to let the assertBlob(..) method throw checked exceptions. It is an assert method which is going to compare two  Blobs, and I think it is reasonable that it is allowed to throw SQLException and IOException if that happens when accessing the Blobs. &lt;/p&gt;</comment>
                            <comment id="12419620" author="kristwaa" created="Fri, 7 Jul 2006 07:17:27 +0100"  >&lt;p&gt;&apos;derby-1474-2b.diff&apos; addresses the two last comments, from Knut Anders and Andreas.&lt;/p&gt;

&lt;p&gt;Originally I didn&apos;t want to have the assertEquals-methods throw checked exceptions. This can cause some inconveniences* in test-methods throwing other IOExceptions, and it doesn&apos;t match the behavior of the rest of the JUnit assertEquals-methods. However, after having read up on the differences between failures and errors, and the feedback I got, I have decided to go for checked exceptions anyway. Makes the code simple. Thanks to Andreas for making me reconsider this.&lt;/p&gt;

&lt;p&gt;The solution makes the very good suggestions from Knut Anders non-applicable. Too bad &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Patch changes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;addition of throws clause&lt;/li&gt;
	&lt;li&gt;removal of try - catch&lt;/li&gt;
	&lt;li&gt;reindentation of the new code (sorry, made the patch a bit meaty)&lt;/li&gt;
	&lt;li&gt;moved the declaration of InputStream/Reader variables&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Ready for another review/commit round.&lt;/p&gt;


&lt;p&gt;*) For errors you usually want the full stack trace. If your test-method calls methods that you expect to throw IOExceptions, and/or you have a throws IOException clause, you should try to use as small try-catch blocks as possible to allow the IOException from assertEquals to be caught by the JUnit framework instead of your own catch block.&lt;/p&gt;</comment>
                            <comment id="12419657" author="andreask" created="Fri, 7 Jul 2006 16:27:07 +0100"  >&lt;p&gt;I think the new patch (&apos;derby-1474-2b.diff&apos;) is fine and can be committed.&lt;/p&gt;</comment>
                            <comment id="12419669" author="knutanders" created="Fri, 7 Jul 2006 17:22:35 +0100"  >&lt;p&gt;Committed derby-1474-2b.diff into trunk with revision 419848.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12336314" name="derby-1474-1a.diff" size="4341" author="kristwaa" created="Tue, 4 Jul 2006 19:59:00 +0100"/>
                            <attachment id="12336315" name="derby-1474-1a.stat" size="178" author="kristwaa" created="Tue, 4 Jul 2006 19:59:00 +0100"/>
                            <attachment id="12336424" name="derby-1474-1b.diff" size="4343" author="kristwaa" created="Thu, 6 Jul 2006 19:43:36 +0100"/>
                            <attachment id="12336434" name="derby-1474-1c.diff" size="4357" author="knutanders" created="Thu, 6 Jul 2006 20:57:21 +0100"/>
                            <attachment id="12336448" name="derby-1474-2a.diff" size="5890" author="kristwaa" created="Fri, 7 Jul 2006 00:25:25 +0100"/>
                            <attachment id="12336449" name="derby-1474-2a.stat" size="232" author="kristwaa" created="Fri, 7 Jul 2006 00:25:25 +0100"/>
                            <attachment id="12336462" name="derby-1474-2b.diff" size="5639" author="kristwaa" created="Fri, 7 Jul 2006 07:17:27 +0100"/>
                            <attachment id="12336450" name="error-output.txt" size="3658" author="kristwaa" created="Fri, 7 Jul 2006 00:25:25 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 6 Jul 2006 19:57:21 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30008</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy15vr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40603</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>