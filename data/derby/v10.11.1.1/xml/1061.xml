<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:43:22 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1061/DERBY-1061.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1061] SqlException while fetching message results in recursive calls between SqlException.getSQLException and Sqlca.getJDBCMessage</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1061</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;stored procedure is used to fetch localised message in net work client&lt;br/&gt;
because of issue 1059 the call to the stored prcedures fails resulting in SqlException. When  SqlException.getSQLException, to set exceptionThrownOnStoredProcInvocation_, is called it again results in a call to SqlException.getMessage which call Sqlca.getJDBCMessage. &lt;br/&gt;
The cycle repeats and finally ends up with StackOverfilowError&lt;/p&gt;

&lt;p&gt;fixing 1059 will solve this problem temporarily but some other situaltion may cause it again.&lt;/p&gt;

&lt;p&gt;Isuggest seting SqlException itself to exceptionThrownOnStoredProcInvocation_ to break this loop.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12329508">DERBY-1061</key>
            <summary>SqlException while fetching message results in recursive calls between SqlException.getSQLException and Sqlca.getJDBCMessage</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12328846">DERBY-955</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anurag">Anurag Shekhar</assignee>
                                    <reporter username="anurag">Anurag Shekhar</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Feb 2006 02:32:36 +0000</created>
                <updated>Thu, 13 Dec 2007 09:04:48 +0000</updated>
                            <resolved>Fri, 14 Apr 2006 06:23:33 +0100</resolved>
                                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12367992" author="anurag" created="Tue, 28 Feb 2006 02:35:22 +0000"  >&lt;p&gt;runnning test case  jdbcapi/connectionJdbc20.java exposes this bug&lt;/p&gt;</comment>
                            <comment id="12367994" author="anurag" created="Tue, 28 Feb 2006 02:47:09 +0000"  >&lt;p&gt;I didn&apos;t notice that SqlException doesn&apos;t extends from SQLException.&lt;br/&gt;
How about creating a SQLException in Sqlca itself with out going to SqlException, with information available in the exception ? It has SqlState and error code. &lt;/p&gt;</comment>
                            <comment id="12368241" author="anurag" created="Wed, 1 Mar 2006 18:03:43 +0000"  >&lt;p&gt;Added a if in Sqlca.getJDBCMessage to check if exceptionThrownOnStoredProcInvocation_ is null &lt;br/&gt;
if its not null it will mean the call to fetch message for the message key has failed and doesn&apos;t tries to fetch it again.&lt;/p&gt;</comment>
                            <comment id="12368423" author="rhillegas" created="Thu, 2 Mar 2006 10:19:17 +0000"  >&lt;p&gt;Hi Anurag,&lt;/p&gt;

&lt;p&gt;I applied this patch and ran derbyall. I saw 35 failed tests. Most of these are message formatting problems and so appear to be related to your patch. I&apos;m attaching the derbyall report.&lt;/p&gt;</comment>
                            <comment id="12369709" author="anurag" created="Fri, 10 Mar 2006 02:45:21 +0000"  >&lt;p&gt;In the catch block of getJDBCMessage of Sqlca changed the code to construct SQLException directly without first creating SqlException&lt;br/&gt;
So if there is a failure in fetching the message the resulting exception will not be localized, but at the same time it prevents &lt;br/&gt;
it from going into recursive call.&lt;/p&gt;

</comment>
                            <comment id="12369744" author="davidvc" created="Fri, 10 Mar 2006 05:21:08 +0000"  >&lt;p&gt;OK, I see the issue, and I see what you&apos;re trying to do to solve it.  &lt;/p&gt;

&lt;p&gt;However, I think the better approach is to change the declaration of exceptionThrownOnStoredProcInvocation_ to be of type SqlException instead of type java.sql.SQLException.  Then you can just assign it to &apos;e&apos; rather than calling &apos;e.getSQLException()&apos; or doing your information-lossy conversion to a SQLException.&lt;/p&gt;

&lt;p&gt;In my analysis using NetBeans&apos; &quot;findUsages&quot;, the only place where exceptionThrownOnStoredProcInvocation_ is used is in the printTrace() routine, where all it does is look at the error code.  This can be done with SqlException just as well as with SQLException.&lt;/p&gt;

&lt;p&gt;So I think the only change you need to make is from&lt;/p&gt;

&lt;p&gt;    java.sql.SQLException exceptionThrownOnStoredProcInvocation_;&lt;/p&gt;

&lt;p&gt;to&lt;/p&gt;

&lt;p&gt;    SqlException exceptionThrownOnStoredProcInvocation_;&lt;/p&gt;

&lt;p&gt;David&lt;/p&gt;
</comment>
                            <comment id="12369745" author="davidvc" created="Fri, 10 Mar 2006 05:22:39 +0000"  >&lt;p&gt;By the way, Anurag, thanks for catching this bug and making the effort to fix it even though your fix to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1059&quot; title=&quot;call to stored procedure with out params fails in embedded driver&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1059&quot;&gt;&lt;del&gt;DERBY-1059&lt;/del&gt;&lt;/a&gt; would have made it go away for you.  It shows your dedication to the quality of Derby, which I and I suspect the community in general really appreciates.&lt;/p&gt;

&lt;p&gt;David&lt;/p&gt;</comment>
                            <comment id="12369870" author="kristwaa" created="Fri, 10 Mar 2006 23:12:53 +0000"  >&lt;p&gt;Had some problems applying diff on Linux, seems to be related to newline style. Changed it and posted a updated file &apos;derby-1061_2-unix.diff&apos;.&lt;/p&gt;

&lt;p&gt;Tried out the patch, but it does not seem to fix my problem. I attach the repro &apos;JDBC4StackOverflowErrorReproduction.java&apos; that demonstrate the error. Might be a different problem than this issue is fixing, if so I hope the patch contributer can inform about that.&lt;/p&gt;

&lt;p&gt;To run, start a JDBC4 enabled network server (run with JDK 1.6), then run the script with JDK 1.6.&lt;/p&gt;</comment>
                            <comment id="12370062" author="knutanders" created="Sun, 12 Mar 2006 17:45:19 +0000"  >&lt;p&gt;I followed David&apos;s proposal, and it solved the problem for me. Attaching patch (derby-1061-david.diff). I haven&apos;t run derbyall yet. Anurag and Kristian, can you confirm whether this patch solves the problems you are seeing?&lt;/p&gt;</comment>
                            <comment id="12370067" author="kristwaa" created="Sun, 12 Mar 2006 22:31:46 +0000"  >&lt;p&gt;I tried the repro script with unpatched trunk, &apos;derby-1061_v2&apos; diff and &apos;derby-1061-david.diff&apos;. For me, running on Gentoo 2.6.15-gentoo-r7 64bit, only &apos;derby-1061-david.diff&apos; solved the problem. I have heard reports that also the v2 diff fixed it for others, but it did not for my environment. I would therefore recommend we commit patch &apos;derby-1061-david.diff&apos;, assuming that this patch also fixes the problem for others seeing this problem.&lt;/p&gt;</comment>
                            <comment id="12370068" author="knutanders" created="Sun, 12 Mar 2006 22:46:54 +0000"  >&lt;p&gt;Committed revision 385291.&lt;/p&gt;

&lt;p&gt;Anurag, please check if this solves the problem for you, and resolve/close the issue if it does.&lt;/p&gt;</comment>
                            <comment id="12551315" author="fuzzylogic" created="Thu, 13 Dec 2007 09:04:48 +0000"  >&lt;p&gt;This issue has been resolved for over a year with no further movement. Closing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12324022" name="JDBC4StackOverflowErrorReproduction.java" size="555" author="kristwaa" created="Fri, 10 Mar 2006 23:12:53 +0000"/>
                            <attachment id="12324066" name="derby-1061-david.diff" size="2185" author="knutanders" created="Sun, 12 Mar 2006 17:45:18 +0000"/>
                            <attachment id="12324067" name="derby-1061-david.stat" size="127" author="knutanders" created="Sun, 12 Mar 2006 17:45:19 +0000"/>
                            <attachment id="12323548" name="derby-1061.diff" size="1102" author="anurag" created="Wed, 1 Mar 2006 18:03:43 +0000"/>
                            <attachment id="12324023" name="derby-1061_2-unix.diff" size="1104" author="kristwaa" created="Fri, 10 Mar 2006 23:12:53 +0000"/>
                            <attachment id="12323984" name="derby-1061_2.diff" size="1128" author="anurag" created="Fri, 10 Mar 2006 02:45:21 +0000"/>
                            <attachment id="12323601" name="derbyall_report.txt" size="280522" author="rhillegas" created="Thu, 2 Mar 2006 10:19:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 2 Mar 2006 10:19:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29837</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy10dz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39713</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>