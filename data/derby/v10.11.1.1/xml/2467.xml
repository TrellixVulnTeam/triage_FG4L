<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:49:23 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2467/DERBY-2467.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2467] Convert lang/updateCursor.java to JUnit</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2467</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Convert lang/updateCursor.java to JUnit&lt;/p&gt;</description>
                <environment></environment>
        <key id="12365311">DERBY-2467</key>
            <summary>Convert lang/updateCursor.java to JUnit</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="matra">Ugo Matrangolo</assignee>
                                    <reporter username="matra">Ugo Matrangolo</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Mar 2007 00:19:31 +0000</created>
                <updated>Wed, 1 Jul 2009 00:40:21 +0100</updated>
                            <resolved>Fri, 13 Apr 2007 22:05:51 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12484616" author="matra" created="Tue, 27 Mar 2007 23:02:17 +0100"  >&lt;p&gt;First draft of the patch that converts updateCursor.java to JUnit. &lt;/p&gt;

&lt;p&gt;I think that the issue is almost resolved. The only thing that remains to do is to read in some way the property file linked with the old test. Unfortunately, I haven&apos;t found no example of how to accomplish this task. &lt;/p&gt;

&lt;p&gt;Can someone point me on how to allow my test to read the correct property file ???&lt;/p&gt;

&lt;p&gt;The code is simply a 1-1 translation of the old harness code to JUnit plus some string/code refactory.&lt;/p&gt;

&lt;p&gt;The test was executed on WinXP and Ubuntu with no problems. &lt;/p&gt;
</comment>
                            <comment id="12484628" author="matra" created="Tue, 27 Mar 2007 23:26:40 +0100"  >&lt;p&gt;please review&lt;/p&gt;</comment>
                            <comment id="12484795" author="fuzzylogic" created="Wed, 28 Mar 2007 11:10:40 +0100"  >&lt;p&gt;Ugo&amp;gt; I think that the issue is almost resolved. The only thing that remains to do is to read in some way the property file linked with the old test. Unfortunately, I haven&apos;t found no example of how to accomplish this task. &lt;/p&gt;

&lt;p&gt;Tests that are converted to JUnit should specify their necessary system properties programmatically, and not rely on external files. For system properties, there is a SystemPropertyTestSetup class, which provides a JUnit decorator for specifying system properties. &lt;/p&gt;

&lt;p&gt;Good examples of using this decorator are in tests/derbynet/ClientSideSystemPropertiesTest.suite() and tests/jdbcapi/AuthenticationTest.setBaseProps().&lt;/p&gt;

&lt;p&gt;A couple of other comments:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Instead of setting up the database in a setUp() method and then having your test be responsible for cleaning the database at teardown(), take a look at using the CleanDatabaseTestSetup decorator. A good example is in tests/lang/GroupByExpression test, but there are many other examples. Using this test decorator requires anonymous overloading of the CleanDatabaseTestSetup&apos;s decorateSQL method, but doing so will allow you to remove a lot of code related to setting up and cleaning out the database, which helps makes the test code in the test stand out from the &apos;background noise&apos; of the setup operations. Refer to other tests which make use of CleanDatabaseTestSetup to get a feel for how it is used.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Using the above may require rethinking how the data in the table is filled. At any rate, the process of assembling the insert statement that inserts the &apos;largeString&apos; into the test tables can probably be simplified. As it is now, there is a lot of object creation and method calling going on behind the scenes of the statement that assembles the String (and thus StringBuffer/StringBuilder) for inserting the &apos;largestring&apos; and various values of i into t1. Using a PreparedStatement here and setting its parameters for each iteration of the for loop would have noticable benefits, including reuse of the compiled PreparedStatement and avoiding unnecessary creation of String objects in that large string concatenation that occurs for each iteration of the for loop.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Because BaseJDBCTestCase extends from junit.framework.TestCase, it is usually not necessary to explicitly add the Assert classname to assert methods when using them in tests. e.g.:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Assert.assertNull(...);&lt;/p&gt;

&lt;p&gt;can usually be called as:&lt;/p&gt;

&lt;p&gt;assertNull(...);&lt;/p&gt;

&lt;p&gt;Thanks for taking the time to convert this test! I&apos;ll take a closer look at it tomorrow and let you know if I have any further comments.&lt;/p&gt;</comment>
                            <comment id="12485658" author="matra" created="Fri, 30 Mar 2007 22:44:07 +0100"  >&lt;p&gt;Andrew,&lt;/p&gt;

&lt;p&gt;thank you very much for your comments and suggestions. &lt;/p&gt;

&lt;p&gt;I took advantage of your suggestions to use the proper decorators for setting the test schema on the db and for setting up correct system properties.&lt;/p&gt;

&lt;p&gt;If you have the opportunity to review my code, please, tell me if you see other possible improvements.&lt;/p&gt;

&lt;p&gt;Again, the test was executed with no problems on Ubuntu and WinXP environments.&lt;/p&gt;
</comment>
                            <comment id="12486176" author="fuzzylogic" created="Tue, 3 Apr 2007 00:39:15 +0100"  >&lt;p&gt;Hi Ugo,&lt;/p&gt;

&lt;p&gt;I took a closer look at the test, a few comments:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I think a check for the order of the rows for column C3 should be added to testVirtualMemoryHeap(). The old test &apos;checked&apos; this by comparing the output of the order of the rows with a master file, but the test intends to check that rows are spilled from the hash table to VM to disk and that orders changes based on whether the rows are in the hashtable for the scan, virtual memory, or on disk. Please see the comment from  the previous test that was output to System.out. I think this comment should be retained in the new test as well so the intent of this test method is more clear.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Stylistically, I would have kept the SQL statements in the test fixtures instead of as instance variables. It&apos;s easier when reading through the test to understand what is being tested if the text of the SQL that is being executed is in the test fixture.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;verifyCount could be replaced with calls to assertUpdateCount() from BaseJDBCTestCase. Similarly, verifyBoolean could be replaced with JUnit&apos;s assertTrue() / assertFalse().&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Unchecking patch available. The last two are style issues, I&apos;ll be glad to commit a new patch with only the testVirtualMemoryHeap() issue fixed.&lt;/p&gt;</comment>
                            <comment id="12487109" author="matra" created="Thu, 5 Apr 2007 22:44:52 +0100"  >&lt;p&gt;Hi Andrew,&lt;/p&gt;

&lt;p&gt;I took advantage of your comments and added the check on the column.&lt;/p&gt;

&lt;p&gt;Thank you,&lt;br/&gt;
Ugo.&lt;/p&gt;

</comment>
                            <comment id="12487110" author="matra" created="Thu, 5 Apr 2007 22:48:26 +0100"  >&lt;p&gt;Fixed a missing fail string.&lt;/p&gt;</comment>
                            <comment id="12487166" author="fuzzylogic" created="Fri, 6 Apr 2007 07:23:09 +0100"  >&lt;p&gt;Committed &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2467&quot; title=&quot;Convert lang/updateCursor.java to JUnit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2467&quot;&gt;&lt;del&gt;DERBY-2467&lt;/del&gt;&lt;/a&gt;_diff_050407_2.txt to trunk with revision 526070. Made one minor change, removed the check of the text of the error message at the end, this is likely to differ between locales. It is sufficient to check that the SQLState is correct.&lt;/p&gt;

&lt;p&gt;Thank you for converting this test, Ugo!&lt;/p&gt;</comment>
                            <comment id="12488596" author="oysteing" created="Fri, 13 Apr 2007 08:13:18 +0100"  >&lt;p&gt;This test has been failing in the tinderbox test since it was checked in.  The failure the first time after it was checked in was:&lt;/p&gt;

&lt;p&gt;2) testVirtualMemoryHeap(org.apache.derbyTesting.functionTests.tests.lang.UpdateCursorTest)junit.framework.AssertionFailedError: Virtual memory heap test failed! Got unexpected value. expected:&amp;lt;202&amp;gt; but was:&amp;lt;103&amp;gt;&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.UpdateCursorTest.testVirtualMemoryHeap(UpdateCursorTest.java:178)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;/p&gt;</comment>
                            <comment id="12488767" author="matra" created="Fri, 13 Apr 2007 20:57:53 +0100"  >&lt;p&gt;I updated all the trunk code and restarted the test. It goes fine. &lt;/p&gt;

&lt;p&gt;I think that the failure is caused by the fact that the test is executed inside a suite where other tests can influence its environment.&lt;br/&gt;
The failing test depends heavily on the  derby.language.maxMemoryPerTable property. Changing this to a different value than 1&lt;br/&gt;
fails the test.&lt;/p&gt;

&lt;p&gt;I&apos;m investigating how this value can be influenced by other tests.&lt;/p&gt;
</comment>
                            <comment id="12488768" author="matra" created="Fri, 13 Apr 2007 20:58:17 +0100"  >&lt;p&gt;Test fails when executed in a suite&lt;/p&gt;</comment>
                            <comment id="12488783" author="fuzzylogic" created="Fri, 13 Apr 2007 22:05:51 +0100"  >&lt;p&gt;I&apos;ve commented out the failing testcase in the test until it can be fixed. A new JIRA issue has been filed for the testcase failure, please continue the discussion in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2543&quot; title=&quot; testVirtualMemoryHeap junit test fails with &amp;quot;Virtual memory heap test failed! Got unexpected value. expected:&amp;lt;202&amp;gt; but was:&amp;lt;103&amp;gt;&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2543&quot;&gt;&lt;del&gt;DERBY-2543&lt;/del&gt;&lt;/a&gt;. Thanks,&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12367115">DERBY-2543</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12354365" name="DERBY-2467_diff_03_27.txt" size="13665" author="matra" created="Tue, 27 Mar 2007 22:50:32 +0100"/>
                            <attachment id="12355044" name="DERBY-2467_diff_050407.txt" size="13052" author="matra" created="Thu, 5 Apr 2007 22:44:52 +0100"/>
                            <attachment id="12355046" name="DERBY-2467_diff_050407_2.txt" size="13106" author="matra" created="Thu, 5 Apr 2007 22:48:26 +0100"/>
                            <attachment id="12354645" name="DERBY-2467_diff_300307.txt" size="13683" author="matra" created="Fri, 30 Mar 2007 22:44:06 +0100"/>
                            <attachment id="12354366" name="DERBY-2467_stat_03_27.txt" size="254" author="matra" created="Tue, 27 Mar 2007 22:50:56 +0100"/>
                            <attachment id="12355045" name="DERBY-2467_stat_050407.txt" size="353" author="matra" created="Thu, 5 Apr 2007 22:44:52 +0100"/>
                            <attachment id="12354646" name="DERBY-2467_stat_300307.txt" size="353" author="matra" created="Fri, 30 Mar 2007 22:44:07 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 28 Mar 2007 10:10:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30462</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0u3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38694</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10053"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>