<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:33:58 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5964/DERBY-5964.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5964] Timestamp comparison failure in AutomaticIndexStatisticsTest.testStatisticsCorrectness</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5964</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;&lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.5/testing/testlog/lin/1402814-suitesAll_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.5/testing/testlog/lin/1402814-suitesAll_diff.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;1) testStatisticsCorrectness(org.apache.derbyTesting.functionTests.tests.store.AutomaticIndexStatisticsTest)junit.framework.AssertionFailedError&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.store.AutomaticIndexStatisticsTest.testStatisticsCorrectness(AutomaticIndexStatisticsTest.java:324)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:424)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:441)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;/p&gt;

&lt;p&gt;The failure is caused by this assert:&lt;/p&gt;

&lt;p&gt;            assertTrue(s.created.before(now));&lt;/p&gt;

&lt;p&gt;It might be a coincidence, but it happened the same night as Europe was switching from DST.&lt;/p&gt;

&lt;p&gt;It may also be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5046&quot; title=&quot;Intermittent assert failure in AutomaticIndexStatisticsTest.testStatisticsCorrectness&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5046&quot;&gt;&lt;del&gt;DERBY-5046&lt;/del&gt;&lt;/a&gt;, where a similar assert failed because poor clock resolution made the two timestamps equal.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12613874">DERBY-5964</key>
            <summary>Timestamp comparison failure in AutomaticIndexStatisticsTest.testStatisticsCorrectness</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Oct 2012 11:06:48 +0000</created>
                <updated>Wed, 24 Apr 2013 08:27:16 +0100</updated>
                            <resolved>Fri, 2 Nov 2012 07:33:11 +0000</resolved>
                                    <version>10.10.1.1</version>
                                    <fixVersion>10.8.3.3</fixVersion>
                    <fixVersion>10.9.2.2</fixVersion>
                    <fixVersion>10.10.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13485962" author="knutanders" created="Mon, 29 Oct 2012 11:10:38 +0000"  >&lt;p&gt;Saw a very similar stacktrace on another machine the same night (running on a Raspberry Pi with Java SE 7 Embedded):&lt;/p&gt;

&lt;p&gt;junit.framework.AssertionFailedError&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.store.AutomaticIndexStatisticsTest.testStatisticsCorrectness(AutomaticIndexStatisticsTest.java:324)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:424)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:441)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;/p&gt;

&lt;p&gt;Twice the same night &lt;b&gt;and&lt;/b&gt; coinciding with the DST switch.&lt;/p&gt;</comment>
                            <comment id="13485984" author="knutanders" created="Mon, 29 Oct 2012 12:19:16 +0000"  >&lt;p&gt;Make that four failures, same night:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.5/testing/testlog/vista-64/1402814-suitesAll_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.5/testing/testlog/vista-64/1402814-suitesAll_diff.txt&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.5/testing/testlog/vista/1402814-suitesAll_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.5/testing/testlog/vista/1402814-suitesAll_diff.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13486836" author="knutanders" created="Tue, 30 Oct 2012 12:37:24 +0000"  >&lt;p&gt;The test checks the value of the CREATIONTIMESTAMP column in SYS.SYSSTATISTICS to find out if the statistics have been updated. The timestamp in that column is stored in the local timezone. However, since Derby doesn&apos;t store the timezone offset, timestamps in the hour before the switch from DST to standard time and in the hour after the switch are ambiguous. So when the test fetches a timestamp, say, 2012-10-28 02:30:00 from SYSSTATISTICS, it doesn&apos;t know whether that represents 2012-10-28 02:30:00 CEST or 2012-10-28 02:30:00 CET, which both are valid times. The current logic in the Derby engine seems to consistently pick the latter value. This means that if the test runs during the hour before the switch to standard time, it looks as if the statistics are updated one hour into the future, and the test fails.&lt;/p&gt;</comment>
                            <comment id="13486841" author="knutanders" created="Tue, 30 Oct 2012 12:59:38 +0000"  >&lt;p&gt;One way to make the test handle the ambiguity around the DST switch, is to force it to run in the GMT timezone, which doesn&apos;t observe DST. See the attached patch.&lt;/p&gt;

&lt;p&gt;I changed the local time on my computer to one hour before the switch from DST and ran the store test suite with and without the patch. It failed without the patch, and passed when the patch was applied.&lt;/p&gt;</comment>
                            <comment id="13489298" author="knutanders" created="Fri, 2 Nov 2012 07:33:11 +0000"  >&lt;p&gt;Committed revision 1404886.&lt;/p&gt;

&lt;p&gt;When &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5974&quot; title=&quot;Convert TIMESTAMP metadata columns to TIMESTAMP WITH TIMEZONE after we implement that datatype.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5974&quot;&gt;DERBY-5974&lt;/a&gt; is fixed, the test can probably stop using TimeZoneTestSetup. But for now, run the test in the GMT time zone.&lt;/p&gt;</comment>
                            <comment id="13640185" author="knutanders" created="Wed, 24 Apr 2013 08:26:59 +0100"  >&lt;p&gt;Back-ported to 10.9 and 10.8 to allow back-porting of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6193&quot; title=&quot;AutomaticIndexStatisticsTest doesn&amp;#39;t delete its single-use database&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6193&quot;&gt;&lt;del&gt;DERBY-6193&lt;/del&gt;&lt;/a&gt; without conflicts.&lt;/p&gt;

&lt;p&gt;Committed to 10.9 with revision 1404886.&lt;br/&gt;
Committed to 10.8 with revision 1471270.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12498753">DERBY-5046</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12614192">DERBY-5974</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12551342" name="d5964-1a-run-in-gmt.diff" size="1888" author="knutanders" created="Tue, 30 Oct 2012 12:59:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>252733</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy6zrb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74618</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>