<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:46:01 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5172/DERBY-5172.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5172] testTimeAndDateWithCalendar (jdbcapi.CallableTest) fails intermittently with AssertionFailedError: hour expected: differs from actual.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5172</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I&apos;ve seen the following stack trace, for instance on 3/26/2011: &lt;a href=&quot;http://people.apache.org/~myrnavl/derby_test_results/v10_7/windows/testlog/ibm16/1085854-suites.All_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~myrnavl/derby_test_results/v10_7/windows/testlog/ibm16/1085854-suites.All_diff.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;1) testTimeAndDateWithCalendar(org.apache.derbyTesting.functionTests.tests.jdbcapi.CallableTest)junit.framework.AssertionFailedError: hour expected:&amp;lt;2&amp;gt; but was:&amp;lt;3&amp;gt;&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.jdbcapi.CallableTest.assertSameTime(CallableTest.java:504)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.jdbcapi.CallableTest.assertSameTimestamp(CallableTest.java:521)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.jdbcapi.CallableTest.testTimeAndDateWithCalendar(CallableTest.java:456)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.jdbcapi.CallableTest.testTimeAndDateWithCalendar(CallableTest.java:412)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:16)&lt;/p&gt;

&lt;p&gt;And another example, from&lt;br/&gt;
&lt;a href=&quot;http://people.apache.org/~myrnavl/derby_test_results/v10_5/windows/testlog/ibm16/1085628-suites.All_diff.txt:&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~myrnavl/derby_test_results/v10_5/windows/testlog/ibm16/1085628-suites.All_diff.txt:&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;1) testTimeAndDateWithCalendar(org.apache.derbyTesting.functionTests.tests.jdbcapi.CallableTest)junit.framework.AssertionFailedError: hour expected:&amp;lt;18&amp;gt; but was:&amp;lt;17&amp;gt;&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.jdbcapi.CallableTest.assertSameTime(CallableTest.java:512)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.jdbcapi.CallableTest.assertSameTimestamp(CallableTest.java:529)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.jdbcapi.CallableTest.testTimeAndDateWithCalendar(CallableTest.java:464)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.jdbcapi.CallableTest.testTimeAndDateWithCalendar(CallableTest.java:412)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;/p&gt;

&lt;p&gt;As this is happening on two different code lines and on both linux and windows and I&apos;ve recently updated the jvms, this could be a jvm issue, but that needs to be verified.&lt;/p&gt;</description>
                <environment>IBM jvms 1.5 (SR12 FP3) and 1.6 (SR9 FP1), Suse Linux and Windows XP</environment>
        <key id="12503095">DERBY-5172</key>
            <summary>testTimeAndDateWithCalendar (jdbcapi.CallableTest) fails intermittently with AssertionFailedError: hour expected: differs from actual.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                            <label>derby_triage10_10</label>
                    </labels>
                <created>Fri, 1 Apr 2011 07:26:46 +0100</created>
                <updated>Wed, 22 Oct 2014 20:23:28 +0100</updated>
                            <resolved>Wed, 3 Apr 2013 09:25:41 +0100</resolved>
                                    <version>10.5.3.2</version>
                    <version>10.7.1.4</version>
                                    <fixVersion>10.10.2.0</fixVersion>
                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13014560" author="knutanders" created="Fri, 1 Apr 2011 14:44:17 +0100"  >&lt;p&gt;Also seen once with Sun Java 1.6.0_24: &lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.6/testing/testlog/sol/1085766-suitesAll_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.6/testing/testlog/sol/1085766-suitesAll_diff.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Happened on the same date (2011-03-26). The switch to DST in Europe happened the day after. I suspect the one hour difference is related to that somehow.&lt;/p&gt;</comment>
                            <comment id="13015480" author="knutanders" created="Mon, 4 Apr 2011 17:14:15 +0100"  >&lt;p&gt;The failing test case uses System.currentTimeMillis(). If I instead hard-code it to use a value representing a time in the one-hour range between 2011-03-26 19:00:00 (inclusive) and 2011-03-26 20:00:00 (exclusive) Central European Time, it fails consistently in my environment. See the attached patch which hard-codes the time to 19:00:00.&lt;/p&gt;</comment>
                            <comment id="13619046" author="myrna" created="Mon, 1 Apr 2013 19:50:49 +0100"  >&lt;p&gt;This occurred again on 3 linux (vmware) machines; the ones running 10.8, 10.10 and trunk (no other Linux machines ran tests).&lt;br/&gt;
The trunk and 10.8 machine are running CentOS, the 10.10 is running RedHat.&lt;br/&gt;
On each machine 3 ibm jvms were running the tests concurrently - ibm 1.5, ibm 1.6, and ibm 1.7; each showed the same failures. For 10.10 and trunk there were 4 failures, for 10.8 only 2 per jvm.&lt;br/&gt;
This also happened on 1 windows machine (also vmware, also running test concurrently) - the one running 10.8, with weme6.2. &lt;br/&gt;
The failure was on the night from March 30 to March 31.  (Unfortunately, it looks like there was a hiccup in the reporting, so no report published in my apache pages shows this).&lt;/p&gt;

&lt;p&gt;Another interesting detail is that this does seem related to switch to Daylight Savings Time for Europe, although the machines are in the Pacific Time Zone.&lt;/p&gt;
</comment>
                            <comment id="13620018" author="knutanders" created="Tue, 2 Apr 2013 18:22:01 +0100"  >&lt;p&gt;The test uses explicit timezones, which is why it fails even if it has passed daylight savings time in the local timezone.&lt;/p&gt;

&lt;p&gt;A timestamp is passed to a stored procedure with an explicit timezone (using setTimestamp(int,Timestamp,Calendar)). The procedure simply copies the timestamp from an input parameter to an output parameter. The test then reads the timestamp using an explicit timestamp (getTimestamp(int,Calendar)), but not necessarily the same timezone that was used when passing it to the procedure.&lt;/p&gt;

&lt;p&gt;The test converts the timestamp between the two timezones before comparing them. However, Derby does not convert the timestamps directly from one timezone to the other in this case. When the timestamp is inside the stored procedure, it is actually in the local timezone. So the conversion is tz1 -&amp;gt; local timezone -&amp;gt; tz2. Around the time one of the timezones switch to DST, that conversion may be an hour off compared to a direct tz1 -&amp;gt; tz2 conversion.&lt;/p&gt;

&lt;p&gt;I&apos;ll update the test to use the same conversion as Derby does.&lt;/p&gt;</comment>
                            <comment id="13620070" author="knutanders" created="Tue, 2 Apr 2013 18:58:55 +0100"  >&lt;p&gt;The attached patch makes the test convert the original timestamp to the local timezone before converting it to the final timezone and comparing it with the actually returned timestamp.&lt;/p&gt;

&lt;p&gt;I&apos;ve verified that this makes the test pass when it&apos;s hard-coded with two known bad timestamps (2011-03-26 19:00:00 CEST and 2013-03-30 19:01:00 CEST).&lt;/p&gt;</comment>
                            <comment id="13620396" author="myrna" created="Wed, 3 Apr 2013 00:08:26 +0100"  >&lt;p&gt;I looked at the code and it seems like a good improvement. +1 to commit.&lt;/p&gt;</comment>
                            <comment id="13620723" author="knutanders" created="Wed, 3 Apr 2013 09:25:41 +0100"  >&lt;p&gt;Thanks, Myrna. Committed revision 1463874.&lt;/p&gt;</comment>
                            <comment id="13683519" author="jira-bot" created="Fri, 14 Jun 2013 17:53:00 +0100"  >&lt;p&gt;Commit 1493154 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kmarsden&quot; class=&quot;user-hover&quot; rel=&quot;kmarsden&quot;&gt;Kathey Marsden&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1493154&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1493154&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5172&quot; title=&quot;testTimeAndDateWithCalendar (jdbcapi.CallableTest) fails intermittently with AssertionFailedError: hour expected: differs from actual.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5172&quot;&gt;&lt;del&gt;DERBY-5172&lt;/del&gt;&lt;/a&gt; testTimeAndDateWithCalendar (jdbcapi.CallableTest) fails intermittently with AssertionFailedError: hour expected: differs from actual.&lt;br/&gt;
merge from trunk revision 1463874. Contributed by Knut Anders Hatlen&lt;/p&gt;</comment>
                            <comment id="14180377" author="myrna" created="Wed, 22 Oct 2014 20:23:28 +0100"  >&lt;p&gt;closing all resolved issues reported by me.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12576619" name="d5172-1a.diff" size="4637" author="knutanders" created="Tue, 2 Apr 2013 18:58:55 +0100"/>
                            <attachment id="12475387" name="failing-timestamp.diff" size="901" author="knutanders" created="Mon, 4 Apr 2011 17:14:15 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 1 Apr 2011 13:44:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24692</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy08iv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35199</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>