<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:45:47 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4669/DERBY-4669.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4669] ClassLoaderBootTest fails if derbyclient.jar comes before derby.jar on the classpath</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4669</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If derbyclient.jar comes before derby.jar on the classpath, and the build is sane, the test fails.&lt;/p&gt;

&lt;p&gt;java -cp derbyclient.jar:derby.jar:derbyTesting.jar:junit.jar junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.store.ClassLoaderBootTest&lt;br/&gt;
...&lt;br/&gt;
1) testBootingAnAlreadyBootedDatabase(org.apache.derbyTesting.functionTests.tests.store.ClassLoaderBootTest)java.lang.ExceptionInInitializerError&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDataSource.findDriver(EmbeddedDataSource.java:500)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(EmbeddedDataSource.java:479)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(EmbeddedDataSource.java:423)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.ClassLoaderBootTest.testBootingAnAlreadyBootedDatabase(ClassLoaderBootTest.java:178)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
Caused by: java.lang.SecurityException: sealing violation: package org.apache.derby.iapi.services.sanity is sealed&lt;br/&gt;
        at java.net.URLClassLoader.defineClass(URLClassLoader.java:234)&lt;br/&gt;
        at java.net.URLClassLoader.access$000(URLClassLoader.java:58)&lt;br/&gt;
        at java.net.URLClassLoader$1.run(URLClassLoader.java:197)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
        at java.net.URLClassLoader.findClass(URLClassLoader.java:190)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.ClassLoaderBootTest$DerbyURLClassLoader.loadClass(ClassLoaderBootTest.java:293)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.ClassLoaderBootTest$DerbyURLClassLoader.loadClass(ClassLoaderBootTest.java:303)&lt;br/&gt;
        at org.apache.derby.iapi.services.monitor.Monitor.startSystemModule(Monitor.java:369)&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.BaseMonitor.runWithState(BaseMonitor.java:386)&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.FileMonitor.&amp;lt;init&amp;gt;(FileMonitor.java:60)&lt;br/&gt;
        at org.apache.derby.iapi.services.monitor.Monitor.startMonitor(Monitor.java:289)&lt;br/&gt;
        at org.apache.derby.iapi.jdbc.JDBCBoot.boot(JDBCBoot.java:69)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDriver.boot(EmbeddedDriver.java:199)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDriver.&amp;lt;clinit&amp;gt;(EmbeddedDriver.java:96)&lt;br/&gt;
        ... 33 more&lt;br/&gt;
2) testBootingDatabaseShutdownByAnotherCLR(org.apache.derbyTesting.functionTests.tests.store.ClassLoaderBootTest)java.lang.ExceptionInInitializerError&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDataSource.findDriver(EmbeddedDataSource.java:500)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(EmbeddedDataSource.java:479)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(EmbeddedDataSource.java:423)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.ClassLoaderBootTest.testBootingDatabaseShutdownByAnotherCLR(ClassLoaderBootTest.java:208)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
Caused by: java.lang.SecurityException: sealing violation: package org.apache.derby.iapi.services.sanity is sealed&lt;br/&gt;
        at java.net.URLClassLoader.defineClass(URLClassLoader.java:234)&lt;br/&gt;
        at java.net.URLClassLoader.access$000(URLClassLoader.java:58)&lt;br/&gt;
        at java.net.URLClassLoader$1.run(URLClassLoader.java:197)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
        at java.net.URLClassLoader.findClass(URLClassLoader.java:190)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.ClassLoaderBootTest$DerbyURLClassLoader.loadClass(ClassLoaderBootTest.java:293)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.ClassLoaderBootTest$DerbyURLClassLoader.loadClass(ClassLoaderBootTest.java:303)&lt;br/&gt;
        at org.apache.derby.iapi.services.monitor.Monitor.startSystemModule(Monitor.java:369)&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.BaseMonitor.runWithState(BaseMonitor.java:386)&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.FileMonitor.&amp;lt;init&amp;gt;(FileMonitor.java:60)&lt;br/&gt;
        at org.apache.derby.iapi.services.monitor.Monitor.startMonitor(Monitor.java:289)&lt;br/&gt;
        at org.apache.derby.iapi.jdbc.JDBCBoot.boot(JDBCBoot.java:69)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDriver.boot(EmbeddedDriver.java:199)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDriver.&amp;lt;clinit&amp;gt;(EmbeddedDriver.java:96)&lt;br/&gt;
        ... 33 more&lt;/p&gt;</description>
                <environment></environment>
        <key id="12465012">DERBY-4669</key>
            <summary>ClassLoaderBootTest fails if derbyclient.jar comes before derby.jar on the classpath</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kristwaa">Kristian Waagan</reporter>
                        <labels>
                            <label>derby_triage10_8</label>
                    </labels>
                <created>Thu, 20 May 2010 11:08:54 +0100</created>
                <updated>Fri, 15 Nov 2013 08:15:13 +0000</updated>
                            <resolved>Tue, 3 Jul 2012 21:11:12 +0100</resolved>
                                    <version>10.5.3.0</version>
                                    <fixVersion>10.5.3.2</fixVersion>
                    <fixVersion>10.6.2.4</fixVersion>
                    <fixVersion>10.7.1.4</fixVersion>
                    <fixVersion>10.8.2.2</fixVersion>
                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Network Client</component>
                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12869565" author="knutanders" created="Thu, 20 May 2010 12:16:31 +0100"  >&lt;p&gt;I think this is because some client classes use org.apache.derby.iapi.services.sanity.SanityManager so that that class is included both in derby.jar and in derbyclient.jar. The client classes should use the SanityManager class in org.apache.derby.shared.common.sanity instead.&lt;/p&gt;</comment>
                            <comment id="12869580" author="knutanders" created="Thu, 20 May 2010 13:14:56 +0100"  >&lt;p&gt;The attached patch (client-imports.diff) makes four client classes use SanityManager from shared.common instead of iapi.services, just by changing some import statements. This change removes the org.apache.derby.iapi.services.sanity package from the sane version of derbyclient.jar.&lt;/p&gt;

&lt;p&gt;This is however only a partial fix. ClassLoaderBootTest still fails, but now with a slightly different error message:&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.SecurityException: sealing violation: package org.apache.derby.shared.common.sanity is sealed&lt;/p&gt;

&lt;p&gt;It looks like classes in the common.sanity package are included in both derbyclient.jar and derby.jar. I think this is because&lt;/p&gt;

&lt;p&gt;1) Some of the engine classes use SanityManager from common instead of iapi&lt;/p&gt;

&lt;p&gt;2) SanityManager and AssertFailure in iapi extend classes in common&lt;/p&gt;</comment>
                            <comment id="12869613" author="knutanders" created="Thu, 20 May 2010 15:18:22 +0100"  >&lt;p&gt;All the regression tests ran cleanly with client-imports.diff. Committed revision 946641.&lt;/p&gt;</comment>
                            <comment id="12869964" author="knutanders" created="Fri, 21 May 2010 13:32:00 +0100"  >&lt;p&gt;As to the engine problems, (1) should be easy to solve the same way as we did on the client. Not sure what&apos;s the best solution for (2).&lt;/p&gt;

&lt;p&gt;I don&apos;t think it was intentional when the shared.common.sanity variant of the SanityManager was introduced, that the iapi SanityManager should depend on it and need those classes in the jar file. If I remember the discussion about sharing code between the client and the engine correctly, it was said that it was OK to avoid duplicating constants by inheriting interfaces, because references to constants in interfaces will be inlined at compile-time and not introduce run-time dependencies. Classes and methods, on the other hand, would have to be duplicated, so that mixing different versions on the classpath would not cause problems.&lt;/p&gt;

&lt;p&gt;We could fix (2) by duplicating the code in the shared classes instead of using inheritance, and thereby making sure derby.jar doesn&apos;t contain the shared package. That would be more in line with the intention of the shared package, I believe. However, we may not be as worried about possible problems with mixed versions of debug jars as we are with insane production jars. So perhaps it would be acceptable simply to unseal the shared.common.sanity package.&lt;/p&gt;</comment>
                            <comment id="13041240" author="kristwaa" created="Mon, 30 May 2011 20:16:33 +0100"  >&lt;p&gt;I&apos;m getting fed up with this error, as it has now popped up again after I started using a new machine. The classpath is constructed using a &apos;for j in `ls *jar`&apos; loop, and derbyclient.jar ends up before derby.jar. It&apos;s annoying to work around this, and it is also a bad issue to hit for newcomers running the tests.&lt;/p&gt;

&lt;p&gt;I have logged &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5253&quot; title=&quot;Engine code references org.apache.derby.shared.common.sanity.SanityManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5253&quot;&gt;&lt;del&gt;DERBY-5253&lt;/del&gt;&lt;/a&gt; for (1), and I&apos;m uploading patch 2a to unseal the iapi.sanity package to address (2). The manifest entry will be present in insane (production) jars too, I don&apos;t know if that is an issue?&lt;/p&gt;

&lt;p&gt;Does anyone oppose to unseal the iapi.sanity package?&lt;/p&gt;</comment>
                            <comment id="13041500" author="knutanders" created="Tue, 31 May 2011 10:35:20 +0100"  >&lt;p&gt;Unsealing the sanity package sounds fine to me, as it should have no consequences for the production jars (except the extra entry in the manifest, but that&apos;s not a big deal, I think).&lt;/p&gt;</comment>
                            <comment id="13042085" author="kristwaa" created="Wed, 1 Jun 2011 11:13:36 +0100"  >&lt;p&gt;Attached patch 2b, which adds a comment and removes the tab used for indentation.&lt;/p&gt;

&lt;p&gt;Committed patch 2b to trunk with revision 1130084.&lt;/p&gt;

&lt;p&gt;I&apos;ll let this issue rest for a while, and then I plan to back-port (10.7 and 10.8) it if there are no objections or problems caused by the change.&lt;/p&gt;</comment>
                            <comment id="13045310" author="kristwaa" created="Tue, 7 Jun 2011 08:32:35 +0100"  >&lt;p&gt;I unsealed the wrong package in patch 2b, so here comes patch 3a...&lt;/p&gt;

&lt;p&gt;Patch 3a does the following:&lt;br/&gt;
 o replaces an import of iapi.sanity.SanityManager in a client class&lt;br/&gt;
 o changes an import to common.shared.sanity.SanityManager in the engine code. This breaks the current pattern, but makes it possible to unseal only the shared.common.sanity package. The reason is that the class JVMInfo is included in both the engine and the client code.&lt;br/&gt;
 o unseals shared.common.sanity, leaving iapi.sanity sealed&lt;/p&gt;

&lt;p&gt;The regression tests ran cleanly (Java 6, Solaris 11 Express).&lt;br/&gt;
Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="13046438" author="kristwaa" created="Thu, 9 Jun 2011 10:51:53 +0100"  >&lt;p&gt;Committed patch 3a to trunk with revision 1133752.&lt;/p&gt;

&lt;p&gt;I&apos;d like to backport this to 10.8, but not further. Will wait for a while to see if things work out as expected.&lt;/p&gt;</comment>
                            <comment id="13049757" author="kristwaa" created="Wed, 15 Jun 2011 14:03:18 +0100"  >&lt;p&gt;Backported to 10.8 with revision 1136020.&lt;/p&gt;</comment>
                            <comment id="13229385" author="kmarsden" created="Wed, 14 Mar 2012 17:19:48 +0000"  >&lt;p&gt;Reopen for 10.5 backport consideration. If working on the backport for this issue. Temporarily assign yourself and add a comment that you are working on it. When finished, reresolve with the new fix versions or label backport_reject_10_x as appropriate.&lt;/p&gt;</comment>
                            <comment id="13235209" author="kmarsden" created="Wed, 21 Mar 2012 23:42:52 +0000"  >&lt;p&gt;Changing assignee from Kristian to myself for backport&lt;/p&gt;</comment>
                            <comment id="13405996" author="kmarsden" created="Tue, 3 Jul 2012 21:11:12 +0100"  >&lt;p&gt;Resolving back to 10.5 and reassigning to Kristian. Neglected to do so back in March.&lt;br/&gt;
10.7: r1304465 | kmarsden | 2012-03-23 09:26:32 -0700 (Fri, 23 Mar 2012) | 5 lines&lt;br/&gt;
10.6:  r1304470 | kmarsden | 2012-03-23 09:41:26 -0700 (Fri, 23 Mar 2012) | 6 lines&lt;br/&gt;
10.5: r1304478 | kmarsden | 2012-03-23 09:55:04 -0700 (Fri, 23 , 23 Mar 2012) | 6 lines&lt;/p&gt;
</comment>
                            <comment id="13823424" author="knutanders" created="Fri, 15 Nov 2013 08:15:13 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update: close all resolved issues that haven&amp;#39;t had any activity the last year&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12508739">DERBY-5253</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12546430">DERBY-5654</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12445056" name="client-imports.diff" size="2672" author="knutanders" created="Thu, 20 May 2010 13:14:56 +0100"/>
                            <attachment id="12480867" name="derby-4669-2a-unseal_iapi_sanity.diff" size="549" author="kristwaa" created="Mon, 30 May 2011 20:16:33 +0100"/>
                            <attachment id="12481057" name="derby-4669-2b-unseal_iapi_sanity.diff" size="593" author="kristwaa" created="Wed, 1 Jun 2011 11:13:36 +0100"/>
                            <attachment id="12481669" name="derby-4669-3a-unseal_common.diff" size="2641" author="kristwaa" created="Tue, 7 Jun 2011 08:32:35 +0100"/>
                            <attachment id="12481668" name="derby-4669-3a-unseal_common.stat" size="208" author="kristwaa" created="Tue, 7 Jun 2011 08:32:35 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 20 May 2010 11:16:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24398</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0b7j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35634</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>