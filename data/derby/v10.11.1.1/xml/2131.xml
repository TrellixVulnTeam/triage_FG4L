<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:42:09 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2131/DERBY-2131.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2131] External DTD files are accessed without a privileged block when Derby parses XML values that reference such DTDs.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2131</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The Derby XMLPARSE operator ultimately makes a call to an external JAXP parser (ex. Xerces or Crimson) to parse an XML value.  If the XML value that is being parsed references an external DTD, then the JAXP parser will need to read the DTD file to complete parsing.  However, the current code in SqlXmlUtil.java does not use a privileged block when it calls out to the JAXP parser.  As a result, when a user who is running with a security manager tries to insert a document that references an external DTD, the call to XMLPARSE will fail with a security exception--even if the JAXP parser has the required &quot;read&quot; permissions.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12357300">DERBY-2131</key>
            <summary>External DTD files are accessed without a privileged block when Derby parses XML values that reference such DTDs.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="army">A B</assignee>
                                    <reporter username="army">A B</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Nov 2006 23:08:22 +0000</created>
                <updated>Mon, 11 Dec 2006 17:01:33 +0000</updated>
                            <resolved>Wed, 6 Dec 2006 00:18:05 +0000</resolved>
                                    <version>10.2.1.6</version>
                    <version>10.2.2.0</version>
                    <version>10.3.1.4</version>
                                    <fixVersion>10.2.2.0</fixVersion>
                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12454481" author="army" created="Wed, 29 Nov 2006 23:10:33 +0000"  >&lt;p&gt;Attaching a patch, d2131_v1.patch, that wraps the call to JAXP inside a priveleged block.  I ran tests with some local (soon-to-be-posted) changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1758&quot; title=&quot;Enable xmlSuite to run as part of derbyall in environments that have the required external jars.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1758&quot;&gt;&lt;del&gt;DERBY-1758&lt;/del&gt;&lt;/a&gt; to confirm that the patch solves the reported problem (i.e. that assignment of &quot;read&quot; permission to the JAXP parser allows successful execution of XMLPARSE).  I also ran derbyall on Red Hat Linux using ibm142 with no failures.  The &quot;XMLSuite&quot; JUnit suite also ran without error.&lt;/p&gt;

&lt;p&gt;The patch doesn&apos;t include any tests; however, relevant test cases will be enabled as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1758&quot; title=&quot;Enable xmlSuite to run as part of derbyall in environments that have the required external jars.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1758&quot;&gt;&lt;del&gt;DERBY-1758&lt;/del&gt;&lt;/a&gt; to verify the behavior.&lt;/p&gt;

&lt;p&gt;I am very new to the notion of security managers and privileged blocks, so while this is a small patch, I would appreciate it if someone could review it to make sure that the changes make sense...&lt;/p&gt;</comment>
                            <comment id="12454496" author="army" created="Thu, 30 Nov 2006 00:01:26 +0000"  >&lt;p&gt;Marking this issue as &quot;blocking&quot; &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1758&quot; title=&quot;Enable xmlSuite to run as part of derbyall in environments that have the required external jars.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1758&quot;&gt;&lt;del&gt;DERBY-1758&lt;/del&gt;&lt;/a&gt; since the latter cannot be resolved until the lang/XMLBindingTest is running under a security manager, and that cannot happen until this issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2131&quot; title=&quot;External DTD files are accessed without a privileged block when Derby parses XML values that reference such DTDs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2131&quot;&gt;&lt;del&gt;DERBY-2131&lt;/del&gt;&lt;/a&gt;) is resolved.&lt;/p&gt;</comment>
                            <comment id="12454788" author="army" created="Fri, 1 Dec 2006 00:22:23 +0000"  >&lt;p&gt;derbyall and suites.All both ran without errors and there were no objections to the posted patch, so I committed d2131_v1.patch with svn 481117.&lt;/p&gt;</comment>
                            <comment id="12454789" author="army" created="Fri, 1 Dec 2006 00:23:10 +0000"  >&lt;p&gt;Reopening to set fix version.&lt;/p&gt;</comment>
                            <comment id="12454791" author="djd" created="Fri, 1 Dec 2006 00:51:01 +0000"  >&lt;p&gt;Finally got around to looking at the patch. It&apos;s generally correct, but you probably want to catch the PrivilegedExceptionAction and unwrap it. Then if there&apos;s an i/o error accessing the DTD it won&apos;t appear as a possible security exception to the user.&lt;/p&gt;

&lt;p&gt;The other general rule with privileged blocks is to put as little code as possible into the priv block, I&apos;m not sure what code requires the privilege block, but here&apos;s an example re-write.&lt;/p&gt;

&lt;p&gt;       final InputSource is = new  InputSource(new StringReader(xmlAsText));&lt;br/&gt;
        aList.add( java.security.AccessController.doPrivileged(&lt;br/&gt;
            new java.security.PrivilegedExceptionAction()&lt;br/&gt;
            {&lt;br/&gt;
                public Object run() throws Exception&lt;/p&gt;
                {
                    return dBuilder.parse(is);
                }
&lt;p&gt;            }));&lt;/p&gt;
</comment>
                            <comment id="12454792" author="army" created="Fri, 1 Dec 2006 00:59:57 +0000"  >&lt;p&gt;Thanks for the suggestions, Dan.  This is good to know.  I&apos;ll work on a follow-up patch to make the changes you mention here and will post it tomorrow.&lt;/p&gt;

&lt;p&gt;Re-opening the issue for now.&lt;/p&gt;</comment>
                            <comment id="12454966" author="army" created="Fri, 1 Dec 2006 17:57:07 +0000"  >&lt;p&gt;Attaching a second patch, d2131_rewrite_v1.patch, that rewrites the privileged block (which has already been committed) to account for Dan&apos;s suggestions.&lt;/p&gt;

&lt;p&gt;Regarding &quot;you probably want to catch the PrivilegedExceptionAction and unwrap it. &quot;.  I did some quick looking at other places in the Derby code where PrivilegedExceptions are caught and it seems like unwrapping the exception is simply a matter of using the result of &quot;PrivilegedException.getException()&quot;--so in this case, we throw the result of &quot;getException()&quot; instead of throwing the PrivilegedException itself.&lt;/p&gt;

&lt;p&gt;If this was too simple of an interpretation (ex. if the unwrapping needs to be more extensive or should be selective to i/o errors), please let me know and I can try again...&lt;/p&gt;</comment>
                            <comment id="12454969" author="djd" created="Fri, 1 Dec 2006 18:43:02 +0000"  >&lt;p&gt;DocumentBuilder.parse() is documented to throw these exceptions: SAXException, IOException but the run() method declares itself as throwing Exception. WOuld it not be better to have the specific errors?&lt;/p&gt;</comment>
                            <comment id="12454970" author="army" created="Fri, 1 Dec 2006 19:01:54 +0000"  >&lt;p&gt;Another version of the &quot;rewrite&quot; patch that declares the correct exceptions on the privileged &quot;run&quot; method.  Thank you for pointing that out, Dan.&lt;/p&gt;</comment>
                            <comment id="12455399" author="army" created="Mon, 4 Dec 2006 19:36:04 +0000"  >&lt;p&gt;Committed d2131_rewrite_v2.patch with svn 482303.&lt;/p&gt;</comment>
                            <comment id="12455692" author="army" created="Tue, 5 Dec 2006 17:07:58 +0000"  >&lt;p&gt;Attaching a patch to port this fix back to 10.2.  I ran the old &quot;xmlSuite&quot; on 10.2 jars with this patch applied and they ran without problem.  I&apos;m running derbyall now just to be safe and will commit the patch to 10.2 if all goes well.&lt;/p&gt;

&lt;p&gt;d2131_10_2.patch was created as follows:&lt;/p&gt;

&lt;p&gt;svn merge -r 481116:481117 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/code/trunk&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/db/derby/code/trunk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;svn merge -r 482302:482303 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/code/truk&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/db/derby/code/truk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;svn diff &amp;gt; d2131_10_2.patch&lt;/p&gt;
</comment>
                            <comment id="12455824" author="army" created="Wed, 6 Dec 2006 00:18:05 +0000"  >&lt;p&gt;derbyall ran cleanly with 10.2 jars after applying this patch.  And the XML tests in suites.xmlSuite all ran cleanly, as well.  So I committed d2131_10_2.patch with svn 482837.&lt;/p&gt;</comment>
                            <comment id="12457413" author="army" created="Mon, 11 Dec 2006 17:01:32 +0000"  >&lt;p&gt;No further issues/comments after the changes were committed, so marking this as closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12348557">DERBY-1758</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12346460" name="d2131_10_2.patch" size="2229" author="army" created="Tue, 5 Dec 2006 17:07:58 +0000"/>
                            <attachment id="12346243" name="d2131_rewrite_v1.patch" size="2581" author="army" created="Fri, 1 Dec 2006 17:57:07 +0000"/>
                            <attachment id="12346244" name="d2131_rewrite_v2.patch" size="2597" author="army" created="Fri, 1 Dec 2006 19:01:54 +0000"/>
                            <attachment id="12346071" name="d2131_v1.patch" size="1776" author="army" created="Wed, 29 Nov 2006 23:10:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 1 Dec 2006 00:51:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22902</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy13tb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40268</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>