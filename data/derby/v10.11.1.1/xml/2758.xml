<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:35:33 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2758/DERBY-2758.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2758] ODBC metadata function &quot;SQLForeignKeys&quot; returns different results in 10.3.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2758</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;In Derby 10.2 and earlier an ODBC application which called the SQLForeignKeys function would return a set of &quot;imported&quot; and/or &quot;exported&quot; keys depending on the arguments passed in.  For more on that function and its arguments, see:&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;http://msdn.microsoft.com/library/default.asp?url=/library/en-us/odbc/htm/odbcsqlforeignkeys.asp&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://msdn.microsoft.com/library/default.asp?url=/library/en-us/odbc/htm/odbcsqlforeignkeys.asp&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In particular we have the following (pasted from the above link):&lt;/p&gt;

&lt;p&gt;&amp;lt;begin paste&amp;gt;&lt;/p&gt;

&lt;p&gt;If *PKTableName contains a table name, SQLForeignKeys returns a result set containing the primary key of the specified table and all of the foreign keys that refer to it. The list of foreign keys in other tables does not include foreign keys that point to unique constraints in the specified table.&lt;/p&gt;

&lt;p&gt;If *FKTableName contains a table name, SQLForeignKeys returns a result set containing all of the foreign keys in the specified table that point to primary keys in others tables, and the primary keys in the other tables to which they refer. The list of foreign keys in the specified table does not contain foreign keys that refer to unique constraints in other tables.&lt;/p&gt;

&lt;p&gt;If both *PKTableName and *FKTableName contain table names, SQLForeignKeys returns the foreign keys in the table specified in *FKTableName that refer to the primary key of the table specified in *PKTableName. This should be one key at most.&lt;/p&gt;

&lt;p&gt;&amp;lt;end paste&amp;gt;&lt;/p&gt;

&lt;p&gt;Note that either PKTableName or FKTableName could be missing, i.e. could be null.&lt;/p&gt;

&lt;p&gt;Now, in org/apache/derby/catalog/SystemProcedures.java, there is a static method called &quot;SQLFOREIGNKEYS&quot; which, to quote the javadoc, &quot;map&lt;span class=&quot;error&quot;&gt;&amp;#91;s&amp;#93;&lt;/span&gt; SQLForeignKeys to EmbedDatabaseMetaData.getImportedKeys, getExportedKeys, and getCrossReference&quot;.&lt;/p&gt;

&lt;p&gt;That method looks at some &quot;options&quot; that it receives from the client and makes a call to the corresponding method on EmbedDatabaseMetaData:&lt;/p&gt;

&lt;p&gt;        String exportedKeyProp = getOption(&quot;EXPORTEDKEY&quot;, options);&lt;br/&gt;
        String importedKeyProp = getOption(&quot;IMPORTEDKEY&quot;, options);&lt;/p&gt;

&lt;p&gt;        if (importedKeyProp != null &amp;amp;&amp;amp; importedKeyProp.trim().equals(&quot;1&quot;))&lt;br/&gt;
            rs&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; = getDMD().getImportedKeys(fkCatalogName,&lt;br/&gt;
                                        fkSchemaName,fkTableName);&lt;br/&gt;
        else if (exportedKeyProp != null &amp;amp;&amp;amp; exportedKeyProp.trim().equals(&quot;1&quot;))&lt;br/&gt;
            rs&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; = getDMD().getExportedKeys(pkCatalogName,&lt;br/&gt;
                                        pkSchemaName,pkTableName);&lt;br/&gt;
        else&lt;br/&gt;
            rs&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; = getDMD().getCrossReference (pkCatalogName,&lt;br/&gt;
                                           pkSchemaName,&lt;br/&gt;
                                           pkTableName,&lt;br/&gt;
                                           fkCatalogName,&lt;br/&gt;
                                           fkSchemaName,&lt;br/&gt;
                                           fkTableName);&lt;/p&gt;

&lt;p&gt;That said, when running with the DB2 Runtime Client the &quot;options&quot; argument only contains &quot;ODBC&quot;; it does not (appear to) contain &quot;IMPORTEDKEY&quot; nor &quot;EXPORTEDKEY&quot;.  So with that client we ultimately end up calling &quot;getCrossReference()&quot; every time.  And in EmbedDatabaseMetaData.getCrossReference(), we see:&lt;/p&gt;

&lt;p&gt;    PreparedStatement s = getPreparedQuery(&quot;getCrossReference&quot;);&lt;br/&gt;
    s.setString(1, swapNull(primaryCatalog));&lt;br/&gt;
    s.setString(2, swapNull(primarySchema));&lt;br/&gt;
    s.setString(3, swapNull(primaryTable));&lt;br/&gt;
    s.setString(4, swapNull(foreignCatalog));&lt;br/&gt;
    s.setString(5, swapNull(foreignSchema));&lt;br/&gt;
    s.setString(6, swapNull(foreignTable));&lt;br/&gt;
    return s.executeQuery();&lt;/p&gt;

&lt;p&gt;That is to say, if either primaryTable or foreignTable is null, we swap it with a &quot;%&quot; to be used for pattern matching.  Prior to the 10.3, that worked fine.  With &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2610&quot; title=&quot;Queries in metadata.properties allow tablepattern for JDBC methods that do not allow patterns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2610&quot;&gt;&lt;del&gt;DERBY-2610&lt;/del&gt;&lt;/a&gt;, though, the getCrossReference query in metadata.properties was changed to disallow pattern matching for the primary key:&lt;/p&gt;

&lt;p&gt;@@ -532,11 +532,15 @@&lt;br/&gt;
 #&lt;br/&gt;
 #param1 = pattern for the PRIMARY CATALOG name &lt;br/&gt;
 #param2 = pattern for the PRIMARY SCHEMA name &lt;br/&gt;
-#param3 = pattern for the PRIMARY TABLE name &lt;br/&gt;
+#param3 = PRIMARY TABLE name &lt;br/&gt;
 #&lt;br/&gt;
 #param4 = pattern for the FOREIGN CATALOG name (&apos;%&apos; for getExportedKeys())&lt;br/&gt;
 #param5 = pattern for the FOREIGN SCHEMA name (&apos;%&apos; for getExportedKeys())&lt;br/&gt;
 #param6 = pattern for the FOREIGN TABLE name (&apos;%&apos; for getExportedKeys())&lt;br/&gt;
+#  &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2610&quot; title=&quot;Queries in metadata.properties allow tablepattern for JDBC methods that do not allow patterns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2610&quot;&gt;&lt;del&gt;DERBY-2610&lt;/del&gt;&lt;/a&gt;: did not change from pattern matching to &quot;T2.TABLENAME=?&quot; &lt;br/&gt;
+#          because getExportedKeys uses this query with &apos;%&apos; for foreign table&lt;br/&gt;
+#  Future: may want to add a new query for getExportedKeys to remove the&lt;br/&gt;
+#          &quot;T2.TABLENAME LIKE ?&quot; pattern&lt;br/&gt;
 getCrossReference=\&lt;br/&gt;
 SELECT CAST (&apos;&apos; AS VARCHAR(128)) AS PKTABLE_CAT, \&lt;br/&gt;
         PKTABLE_SCHEM, \&lt;br/&gt;
@@ -587,7 +591,7 @@&lt;br/&gt;
                          WHERE \&lt;br/&gt;
                             ((1=1) OR ? IS NOT NULL) \&lt;br/&gt;
                             AND S.SCHEMANAME LIKE ? \&lt;br/&gt;
                             AND T.TABLENAME LIKE ? \     &amp;lt;-- removed w/ &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2610&quot; title=&quot;Queries in metadata.properties allow tablepattern for JDBC methods that do not allow patterns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2610&quot;&gt;&lt;del&gt;DERBY-2610&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
                             AND T.TABLENAME=? \  &amp;lt;-- added with &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2610&quot; title=&quot;Queries in metadata.properties allow tablepattern for JDBC methods that do not allow patterns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2610&quot;&gt;&lt;del&gt;DERBY-2610&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
                             AND S.SCHEMAID = T.SCHEMAID \&lt;/p&gt;

&lt;p&gt;As a result, the ODBC &quot;SQLForeignKeys&quot; function now returns zero rows because there is no table whose name equals the &quot;%&quot; that we swapped in for the null.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure what the best fix for this should be.  The JDBC API for getCrossReference() indicates that both primaryTable and foreignTable &quot;must match the table name as it is stored in the database&quot;, so perhaps the bug is in SystemProcedures.java, where the SQLForeignKeys function is mapped to a getCrossReference() call that passes nulls.  But one could argue that, given the lack of information in the &quot;options&quot; string received from the client (esp. the missing &quot;IMPORTEDKEY&quot; or &quot;EXPORTEDKEY&quot; keywords), SystemProcedures.java is actually doing the right thing.  Either way, it&apos;s not immediately clear to me how this should best be resolved...&lt;/p&gt;

&lt;p&gt;I&apos;m marking this as a 10.3 regression (with 10.3 fixin) since the behavior in the 10.3 trunk is different than what it was in previous releases.  If anyone disagrees with this, please feel free to say so and/or update accordingly.&lt;/p&gt;

&lt;p&gt;Note: I don&apos;t think this behavior is technically covered by the release note for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2610&quot; title=&quot;Queries in metadata.properties allow tablepattern for JDBC methods that do not allow patterns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2610&quot;&gt;&lt;del&gt;DERBY-2610&lt;/del&gt;&lt;/a&gt; because a) the release note does not mention getCrossReference() (should it??), and b) the call to &quot;getCrossReference()&quot; is made internally; a user&apos;s ODBC app would be calling SQLForeignKeys, for which a null primary/foreign table name are in fact perfectly legal.&lt;/p&gt;</description>
                <environment>DB2 Runtime Client running against Derby network server.</environment>
        <key id="12370876">DERBY-2758</key>
            <summary>ODBC metadata function &quot;SQLForeignKeys&quot; returns different results in 10.3.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jorgenlo">J&#248;rgen L&#248;land</assignee>
                                    <reporter username="army">A B</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Jun 2007 22:12:53 +0100</created>
                <updated>Tue, 30 Jun 2009 16:55:46 +0100</updated>
                            <resolved>Sun, 10 Jun 2007 12:29:01 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>JDBC</component>
                    <component>Miscellaneous</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12501476" author="jorgenlo" created="Tue, 5 Jun 2007 08:40:25 +0100"  >&lt;p&gt;Army, thanks for posting a very clear description of the problem.&lt;/p&gt;

&lt;p&gt;Since some of the methods that end up using the metadata.properties#getCrossReference query allow null values for table name while others don&apos;t, I think we should split the query into (at least) two queries. That way we can return correct results for both ?DBC, and possibly also fix the 2610-comment for the getCrossReference query at the same time (see metadata.properties).&lt;/p&gt;

&lt;p&gt;Of course, this comes with the cost of having to maintain an additional query.&lt;/p&gt;

&lt;p&gt;I also think the EmbedDatabaseMetaData#getCrossReference() method should be changed to not swap &apos;null&apos; with &apos;?&apos; since the metadata query ignores it anyway.&lt;/p&gt;

&lt;p&gt;Thus, as I see it, what needs to be done to get this right for all methods is to change SystemProcedures, EmbedDatabaseMetaData and metadata.properties so that calls to SystemProcedures#getCrossReference are mapped as follows:&lt;/p&gt;

&lt;p&gt;odbc sqlforeignkeys (and possibly other methods): &lt;br/&gt;
EmbedDBMD#getCrossReferenceTablePattern() (incl swapNull) -&amp;gt; metadata#getCrossReferenceTablePattern (allows tablenamepatterns like before 2610)&lt;/p&gt;

&lt;p&gt;jdbc methods (and possibly some odbc?):&lt;br/&gt;
EmbedDBMD#getCrossReference() (without swapNull) -&amp;gt; metadata#getCrossReference (does not allow patterns)&lt;/p&gt;

&lt;p&gt;Finally, the aforementioned release note for 2610 should be changed as described by Army.&lt;/p&gt;</comment>
                            <comment id="12501506" author="jorgenlo" created="Tue, 5 Jun 2007 10:58:31 +0100"  >&lt;p&gt;If it is agreed upon that having one getCrossReference() method that allows table name values &apos;null&apos; and one that does not in EmbedDatabaseMetaData, the one that does not allow null should throw an SQLException if a null value is found.  This is what happens in other similar methods in EmbedDatabaseMetaData. For details, see &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1484&quot; title=&quot;Client and embedded behave differently when the table name is null in DatabaseMetaData methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1484&quot;&gt;&lt;del&gt;DERBY-1484&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12501599" author="army" created="Tue, 5 Jun 2007 16:55:59 +0100"  >&lt;p&gt;Thanks for your comments on this, J&#248;rgen.  I think the addition of a new method &quot;getCrossReferenceTablePattern()&quot; is an acceptable approach for resolving this issue.  As you said, though, this is not ideal since it means we have to maintain another query that is almost identical to the existing getCrossReference query.  But that&apos;s probably better than breaking existing ODBC applications which may rely on the SQLForeignKeys function.&lt;/p&gt;

&lt;p&gt;A more ideal solution-&lt;del&gt;but also more difficult&lt;/del&gt;-would be to somehow add logic to the existing java/build/org/apache/derbyBuild/ODBCMetadataGenerator class to internally create an ODBC &quot;version&quot; of getCrossReference() that accepts patterns.  That class contains several other cases where ODBC-specific queries are generated, so it&apos;d be nice if code for this issue could go there, too.&lt;/p&gt;

&lt;p&gt;But that may be asking too much given the current release plans for 10.3, so a new metadata query (as you suggested) seems like a viable short-term solution...&lt;/p&gt;</comment>
                            <comment id="12502324" author="jorgenlo" created="Thu, 7 Jun 2007 13:47:51 +0100"  >&lt;p&gt;Army, I like your solution of using ODBCMetadataGenerator to create the odbc version of the query better. I see no reason to not make this right in the first place, so I&apos;m currently writing a patch using that technique.&lt;/p&gt;

&lt;p&gt;However, as I was working with ODBCMetadataGenerator, I stumbled across something that I think is a bug. Simply put, ODBCMetadataGenerator#generateODBCQuery removes &quot;order by&quot; from the original (jdbc) query and reattaches it in the  end, i.e. outside the subquery (because order by is not allowed inside a subquery). However, if the odbc query is created without a subquery, the stripped &quot;order by&quot; is never reattached. Compare getProcedures and odbc_getProcedures in classes/org/apache/derby/impl/jdbc/metadata.properties for an example.&lt;/p&gt;

&lt;p&gt;Unless my assumption is wrong, I&apos;ll attach the orderby String to the odbc queries (that do not use subqueries) as part of this patch.&lt;/p&gt;</comment>
                            <comment id="12502360" author="jorgenlo" created="Thu, 7 Jun 2007 15:34:09 +0100"  >&lt;p&gt;The patch (1) uses ODBCMetadataGenerator to create an odbc version of the getCrossReference metadata query.&lt;/p&gt;

&lt;p&gt;M      java/build/org/apache/derbyBuild/ODBCMetadataGenerator.java&lt;/p&gt;

&lt;p&gt;Added new method &quot;changeWhereClause&quot; that handles the &quot;T.TABLENAME=?&quot; to &quot;T.TABLENAME LIKE ?&quot; substitution. Also reattached &quot;order by&quot; to odbc queries that do not use subqueries, hence odbc queries are now ordered equally as their jdbc counterparts. See previous comment for details. &lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/impl/jdbc/EmbedDatabaseMetaData.java&lt;/p&gt;

&lt;p&gt;getCrossReference (used by JDBC) now throws SQLException if any of the table names == null. Added new method getCrossReferenceForODBC that uses the new generated odbc version of the query.&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/catalog/SystemProcedures.java&lt;/p&gt;

&lt;p&gt;Modified SQLFOREIGNKEYS. Now sends ODBC queries to EmbedDatabaseMetaData#getCrossReferenceForODBC, thus allowing table name values of null.&lt;/p&gt;

&lt;p&gt;suites.all and derbyall completed without errors.&lt;/p&gt;

&lt;p&gt;P.S: Remember to run this patch against a new DB if you want to test it manually. I spent quite some time figuring out why it didn&apos;t work when I used an old DB. DataDictionaryImpl does not find the SPS (stored procedure statement) for odbc_getCrossReference since these are added at creation or upgrade time. &lt;/p&gt;</comment>
                            <comment id="12502457" author="army" created="Thu, 7 Jun 2007 19:17:04 +0100"  >&lt;p&gt;Thank you very much for the patch, J&#248;rgen.  And thanks especially for tackling the ODBCMetadataGenerator approach, as I think that&apos;s a better way to go.&lt;/p&gt;

&lt;p&gt;I reviewed the patch and it looks good to me.  Thanks for finding/fixing the ORDER BY bug, as well.  I applied the patch cleanly and then re-ran the ODBC test that first showed this regression; it now runs cleanly again.  So the patch looks good and it solves the problem as far as I can see.&lt;/p&gt;

&lt;p&gt;Do you have any plans/inclination to add an appropropriate test case to the current regression tests?  It&apos;s possible to &quot;fake&quot; an ODBC metadata call by passing in &quot;DATATYPE=ODBC&quot; as the last argument to some system procedures that already exist in Derby.  See in particular jdbcapi/odbc_metadata.java and jdbcapi/DatabaseMetaDataTest.java.  I think it should be possible to come up with a test case that mimics the actions in DatabaseMetaDataTest.checkGetTablesODBC(...) method, except that it would call SYSIBM.SQLFOREIGNKEYS instead of SYSIBM.SQLTABLES.  Is that something you&apos;d be willing to look at?&lt;/p&gt;

&lt;p&gt;As it is, I&apos;m willing to commit the patch that you&apos;ve posted as it looks correct and it solves the reported problem.  Unless I hear objections I&apos;ll try to do that later today.  But I think it&apos;d be good get a test case, as well, so perhaps we can leave this issue Open until an appropriate test can be written.  Does that sound okay?&lt;/p&gt;

&lt;p&gt;Thanks again for your quick work with this!&lt;/p&gt;</comment>
                            <comment id="12502491" author="jorgenlo" created="Thu, 7 Jun 2007 20:38:46 +0100"  >&lt;p&gt;Thank you for reviewing the patch, Army. &lt;/p&gt;

&lt;p&gt;I was rather surprised that all tests passed without modifications, which, as you say, indicates that new test cases are required.&lt;br/&gt;
I&apos;ll look into the tests tomorrow or early next week. It would be great if the current patch was committed, though.&lt;/p&gt;</comment>
                            <comment id="12502540" author="army" created="Thu, 7 Jun 2007 22:39:37 +0100"  >&lt;p&gt;I ran derbyall and suites.All on SUSE Linux with ibm142 and there were no failures.  So I committed &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2758&quot; title=&quot;ODBC metadata function &amp;quot;SQLForeignKeys&amp;quot; returns different results in 10.3.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2758&quot;&gt;&lt;del&gt;DERBY-2758&lt;/del&gt;&lt;/a&gt;-1.diff with svn # 545321:&lt;/p&gt;

&lt;p&gt;  URL: &lt;a href=&quot;http://svn.apache.org/viewvc?view=rev&amp;amp;rev=545321&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=rev&amp;amp;rev=545321&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Leaving the Jira open until an appropriate test case can be contributed.&lt;/p&gt;

&lt;p&gt;Thanks again for addressing this issue, J&#248;rgen.&lt;/p&gt;</comment>
                            <comment id="12502810" author="jorgenlo" created="Fri, 8 Jun 2007 15:12:21 +0100"  >&lt;p&gt;Army, because I am a little short of cycles I added the test to jdbcapi/metadata_test.java. I verified that jdbcapi, derbynetmats and derbynetclientmats run cleanly when run standalone. &lt;/p&gt;

&lt;p&gt;I am currently running the complete derbyall test, but expect it to complete without errors since the standalone tests work fine. The results will not be posted until monday, however. suites.all results in the same errors reported in tinderbox.&lt;/p&gt;</comment>
                            <comment id="12503161" author="knutanders" created="Sun, 10 Jun 2007 12:29:01 +0100"  >&lt;p&gt;The test patch looks good and metadata/odbc_metadata ran cleanly under embedded, network client and JCC. Committed revision 545865.&lt;/p&gt;</comment>
                            <comment id="12503163" author="jorgenlo" created="Sun, 10 Jun 2007 12:51:32 +0100"  >&lt;p&gt;Thank you for reviewing and committing the patch, Knut.&lt;/p&gt;</comment>
                            <comment id="12503298" author="jorgenlo" created="Mon, 11 Jun 2007 07:33:28 +0100"  >&lt;p&gt;Just to confirm; derbyall runs the testpatch cleanly.&lt;/p&gt;</comment>
                            <comment id="12503665" author="army" created="Tue, 12 Jun 2007 00:01:33 +0100"  >&lt;p&gt;I started looking at the JUnit aspect of this test case last Friday so even though the odbc_metadata changes have gone in (thanks J&#248;rgen for the patch, and Knut Anders for the commit)), I decided to commit another test case for JUnit, as well.  The patch d2758_junit_test.patch has the new test fixture, which is in DatabaseMetaDataTest.java.&lt;/p&gt;

&lt;p&gt;I verified that the new test fixture runs cleanly in the current trunk and fails if the fix for this issue is backed out.  So committed with svn # 546312:&lt;/p&gt;

&lt;p&gt;  URL: &lt;a href=&quot;http://svn.apache.org/viewvc?view=rev&amp;amp;rev=546312&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=rev&amp;amp;rev=546312&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks again for resolving this issue, J&#248;rgen.&lt;/p&gt;</comment>
                            <comment id="12503668" author="army" created="Tue, 12 Jun 2007 00:03:42 +0100"  >&lt;p&gt;Issue fixed and test cases committed, so marking as closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12368656">DERBY-2610</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12359187" name="DERBY-2758-1.diff" size="9361" author="jorgenlo" created="Thu, 7 Jun 2007 15:34:09 +0100"/>
                            <attachment id="12359186" name="DERBY-2758-1.stat" size="207" author="jorgenlo" created="Thu, 7 Jun 2007 15:34:09 +0100"/>
                            <attachment id="12359281" name="DERBY-2758-test.diff" size="12001" author="jorgenlo" created="Fri, 8 Jun 2007 15:12:21 +0100"/>
                            <attachment id="12359280" name="DERBY-2758-test.stat" size="623" author="jorgenlo" created="Fri, 8 Jun 2007 15:12:21 +0100"/>
                            <attachment id="12359449" name="d2758_junit_test.patch" size="10000" author="army" created="Tue, 12 Jun 2007 00:01:31 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 5 Jun 2007 07:40:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23225</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0uw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38823</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10050"><![CDATA[Blocker]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>