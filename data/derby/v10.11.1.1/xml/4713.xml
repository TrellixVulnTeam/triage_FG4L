<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:28:23 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4713/DERBY-4713.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4713] Subclasses of ScriptTestCase can not run correctly with the non-English default locale</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4713</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If the default locale is not English, many subclasses of ScriptTestCase will fail. &lt;/p&gt;

&lt;p&gt;For example, run NetIjTest (a subclass of ScriptTestcase)  in a Chinese OS, the test case will fail:&lt;/p&gt;

&lt;p&gt;D:\derby\test&amp;gt;java junit.textui.TestRunner org.apache.derbyTesting.functionTests&lt;br/&gt;
.tests.derbynet.NetIjTest&lt;br/&gt;
.F&lt;br/&gt;
Time: 5.422&lt;br/&gt;
There was 1 failure:&lt;br/&gt;
1) testclientij(org.apache.derbyTesting.functionTests.tests.derbynet.NetIjTest)j&lt;br/&gt;
unit.framework.ComparisonFailure: Output at line 34 expected:&amp;lt;[ERROR 42X05: Tabl&lt;br/&gt;
e/View &apos;APP.NOTTHERE&apos; does not exist.]&amp;gt; but was:&amp;lt;[?? 42X05????&lt;cite&gt;APP.NOTTHERE&lt;/cite&gt;??&lt;br/&gt;
?]&amp;gt;&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.util.CanonTestCase.compareCanon&lt;br/&gt;
(CanonTestCase.java:106)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.util.ScriptTestCase.runTest(Scr&lt;br/&gt;
iptTestCase.java:198)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:&lt;br/&gt;
109)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:23)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:27)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57&lt;br/&gt;
)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:23)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:27)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57&lt;br/&gt;
)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:23)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:27)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:23)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:27)&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;br/&gt;
Tests run: 1, Failures: 1, Errors: 0 &lt;/p&gt;

&lt;p&gt;While, it succeed running with a English-language lcoale.&lt;/p&gt;

&lt;p&gt;D:\derby\test&amp;gt;java -Duser.language=en junit.textui.TestRunner org.apache.derbyTe&lt;br/&gt;
sting.functionTests.tests.derbynet.NetIjTest&lt;br/&gt;
.&lt;br/&gt;
Time: 6.187&lt;/p&gt;

&lt;p&gt;OK (1 test)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12467879">DERBY-4713</key>
            <summary>Subclasses of ScriptTestCase can not run correctly with the non-English default locale</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yunlee">Yun Lee</assignee>
                                    <reporter username="yunlee">Yun Lee</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Jun 2010 09:42:46 +0100</created>
                <updated>Mon, 17 Jun 2013 10:19:31 +0100</updated>
                            <resolved>Thu, 6 Jan 2011 18:44:48 +0000</resolved>
                                                    <fixVersion>10.8.1.2</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12882868" author="knutanders" created="Sat, 26 Jun 2010 18:31:44 +0100"  >&lt;p&gt;Sounds like a good idea, since the script tests won&apos;t pass in any locale for which we have translations. Perhaps the LocaleTestSetup decorator could be used for this?&lt;/p&gt;</comment>
                            <comment id="12883042" author="yunlee" created="Mon, 28 Jun 2010 07:28:36 +0100"  >&lt;p&gt;Thanks Knut. What you suggested works indeed!&lt;/p&gt;

&lt;p&gt;There are two ways to resolve this issue. One is to do change directly in ScriptTeseCase, the other is to change all the affected subclasses. I chose the second one. As I think, maybe some future test cases will do testing baseing on non-English Locale, if we do change directly in ScriptTeseCase, we will lose expandability.&lt;/p&gt;

&lt;p&gt;Please check the patch, thanks!&lt;/p&gt;</comment>
                            <comment id="12883092" author="knutanders" created="Mon, 28 Jun 2010 11:00:27 +0100"  >&lt;p&gt;Thanks for the patch, Yun.&lt;/p&gt;

&lt;p&gt;I don&apos;t think we lose expandability by doing this directly in ScriptTestCase (or perhaps better: in its super-class CanonTestCase?), since we can always add a locale parameter to one of the constructors if we need support for non-English locales later. That&apos;s the approach that was taken for the input and output encoding. The advantage of doing it in ScriptTestCase is that it will automatically be done correctly for tests we add later, even if the person who writes the test forgets to wrap it in a LocaleTestSetup.&lt;/p&gt;

&lt;p&gt;I&apos;m curious to know why the new constructor in LocaleTestSetup was needed. Couldn&apos;t the existing constructor be used with Locale.US as argument? I was thinking that preserving country and variant of the default locale could mean that things like dates and numbers are formatted differently, and that it would be more robust if we set all the components of the locale to known values.&lt;/p&gt;</comment>
                            <comment id="12883160" author="kmarsden" created="Mon, 28 Jun 2010 15:26:46 +0100"  >&lt;p&gt;I agree it is better to change in ScriptTestCase and then if someone wanted some Locale specific test they could override the behavior.&lt;/p&gt;</comment>
                            <comment id="12883443" author="yunlee" created="Tue, 29 Jun 2010 08:14:29 +0100"  >&lt;p&gt;I agree with both of your advice. It&apos;s a good to doing change in ScriptTestCase directly with a defined Locale.US. I will realize it.&lt;/p&gt;</comment>
                            <comment id="12884254" author="yunlee" created="Thu, 1 Jul 2010 12:47:38 +0100"  >&lt;p&gt;Ask for help&#65281;&lt;/p&gt;

&lt;p&gt;I have tried to do changing in ScriptTestSetup directly, just in the derby-4713-1.patch. However, it doesn&apos;t work as expected. Some  subclasses of ScriptTestSetupLangScripts, such as ImportExportIJTest, LangScripts, SURijTest and NistScripts (also a subclass of ScriptTestSetup) can not pass with a lot of &apos;?&apos; in the test result. I also attached bit.out (the output of bit test in LangScripts), in which you can see a lot of &apos;?&apos; in it.&lt;/p&gt;

&lt;p&gt;I have spent a lot of time on debugging this problem, but could not resolve it. I have also tried to do changing in CanonTestCase, the situation was also bad.  In my debugging, I&apos;m sure , the default Locale has changed indeed and the runTest() method of ScriptTestCase was running in a US Locale. I have also tried to use some other Locale, such as &quot;en_CN&quot;, but they all failed in the same situation.&lt;/p&gt;

&lt;p&gt;I have to ask for help to resolve this problem. As to my patch attcahed last time, it can works well for every test. It seems in the patch attached this time, ij has still run in a Locale not as expected. &lt;/p&gt;

&lt;p&gt;Please give some advice, thanks very much!&lt;/p&gt;</comment>
                            <comment id="12885238" author="knutanders" created="Mon, 5 Jul 2010 14:55:04 +0100"  >&lt;p&gt;Perhaps this happens because the default locale for a database is determined when the database is created, and the test harness reuses databases across tests. If that&apos;s the problem, we may get around it by creating a fresh database for these tests. See for example TestConfiguration.singleUseDatabaseDecorator().&lt;/p&gt;</comment>
                            <comment id="12885934" author="yunlee" created="Wed, 7 Jul 2010 14:09:09 +0100"  >&lt;p&gt;Knut, I have also test the TestConfiguration.singleUseDatabaseDecorator() just by your advice, it still failed. &lt;/p&gt;

&lt;p&gt;I have checked my last test result( not using TestConfiguration.singleUseDatabaseDecorator()), it seems, the default locale has been changed to US already. In CN locale, when the canon line is &apos;0 rows inserted/updated/deleted&apos;, the output is &apos;????????? 0 ?&apos;. After do changing in ScriptTestSetup directly, this line is OK, and the test fails on this canon line &apos;ERROR 42X14: &apos;NCLOB&apos; is not a column in table or VTI &apos;APP.B&apos;.&apos; with the output line &apos;ERROR 42X14: ?NCLOB????? VTI?APP.B?????&apos;. In other words, it fails only on error prompt, and pass on common sql result. Anyone can tell us which situation will cause this problem, please?&lt;/p&gt;</comment>
                            <comment id="12893830" author="myrna" created="Thu, 29 Jul 2010 22:19:39 +0100"  >&lt;p&gt;I&apos;ve played with this a bit. &lt;br/&gt;
Of course, I have en_US for my locale. So I tried to change this by running the tests (junit.textui.TestRunner) with -Duser.language=zh_CN.&lt;/p&gt;

&lt;p&gt;The second patch (patch1) didn&apos;t compile; I had to make an additional change to functionTests/util/IjTestCase - commenting out the &apos;throws Exception&apos; in the setUp() method. As this IjTestCase is not currently used, I guess it doesn&apos;t matter so much.&lt;/p&gt;

&lt;p&gt;Both the first (patch) and second (patch1) patches pass with English locale, and both have multiple failures with -Duser.language=zh_CN.&lt;br/&gt;
Any suggestions on how to test the patches when in US/English locale?&lt;/p&gt;

&lt;p&gt;Where did you try to put in Testconfiguration.singleUseDatabaseDecorator() when it failed? And in which way did that fail?&lt;/p&gt;
</comment>
                            <comment id="12898099" author="yunlee" created="Fri, 13 Aug 2010 07:11:12 +0100"  >&lt;p&gt;Hi,Myrna. I have been being puzzled about this issue for a long time. For the first patch, I did get it pass on my PC, but it failed in your environment. For the second patch, it should work accordingly with the first patch, but it still failed.&lt;/p&gt;

&lt;p&gt;After running applying the patch test time and time again, I think I have caught it, the two patch can work well &amp;#8212; while the second patch need remove the &apos;throws Exception&apos; in the IJScriptTest.setUp() method. &lt;/p&gt;

&lt;p&gt;When run the test, it&apos;s best to clean and rebuild the project, clean the &apos;fail&apos; document for test database. I&apos;ve gotten all the subclasses of ScriptTestcase pass. &lt;/p&gt;

&lt;p&gt;In derby-4732-2.patch, I removed  the &apos;throws Exception&apos; in the IJScriptTest.setUp() method, the remaining parts are the same with derby-4732-1.patch.  Please verify it, thanks!&lt;/p&gt;</comment>
                            <comment id="12978448" author="myrna" created="Thu, 6 Jan 2011 18:44:48 +0000"  >&lt;p&gt;I&apos;ve committed patch derby-4713-2 with revision 1055998.&lt;/p&gt;

&lt;p&gt;With this patch, I did not see any unexpected test failures in a run of suites.All (sane build, classes - ibm 1.6 - I saw one intermittent server ping issue in testSetPortPriority and testPing failed for me).&lt;/p&gt;

&lt;p&gt;Looking at the code of the patch, it seemed ike it would be an improvement.&lt;br/&gt;
Running suites.All with -Duser.language=zh_CN I still saw a lot of failures, including some of the scriptTestCase tests, but I&apos;m assuming that it&apos;s a problem with that setup, as Yun Lee said tests passed for him with the patch where before they failed.&lt;/p&gt;</comment>
                            <comment id="13685267" author="knutanders" created="Mon, 17 Jun 2013 10:19:31 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12401144">DERBY-3801</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12448489" name="bit.out" size="39591" author="yunlee" created="Thu, 1 Jul 2010 12:47:38 +0100"/>
                            <attachment id="12448488" name="derby-4713-1.patch" size="2947" author="yunlee" created="Thu, 1 Jul 2010 12:47:38 +0100"/>
                            <attachment id="12448490" name="derby-4713-1.stat" size="293" author="yunlee" created="Thu, 1 Jul 2010 12:47:38 +0100"/>
                            <attachment id="12451997" name="derby-4713-2.patch" size="3529" author="yunlee" created="Fri, 13 Aug 2010 07:11:12 +0100"/>
                            <attachment id="12451996" name="derby-4713-2.stat" size="372" author="yunlee" created="Fri, 13 Aug 2010 07:11:12 +0100"/>
                            <attachment id="12448180" name="derby-4713.patch" size="8741" author="yunlee" created="Mon, 28 Jun 2010 07:28:36 +0100"/>
                            <attachment id="12448179" name="derby-4713.stat" size="821" author="yunlee" created="Mon, 28 Jun 2010 07:28:36 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 26 Jun 2010 17:31:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24424</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0guf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36547</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>