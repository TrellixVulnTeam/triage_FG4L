<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:14:09 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2733/DERBY-2733.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2733] ij rolls through NullPointerException (NPE) with J2ME/JSR169/WEME 6.1.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2733</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When starting ij - with, or without any derby.properties, ij first shows this:&lt;br/&gt;
-------------------------------------------------------&lt;br/&gt;
java.lang.reflect.InvocationTargetException&lt;br/&gt;
        at java.lang.reflect.AccessibleObject.invokeL(AccessibleObject.java:215)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:272)&lt;br/&gt;
        at org.apache.derby.impl.tools.ij.util.getDataSourceConnection(util.java:426)&lt;br/&gt;
        at org.apache.derby.impl.tools.ij.util.startJBMS(util.java:516)&lt;br/&gt;
        at org.apache.derby.impl.tools.ij.util.startJBMS(util.java:585)&lt;br/&gt;
        at org.apache.derby.impl.tools.ij.ConnectionEnv.init(ConnectionEnv.java:64)&lt;br/&gt;
        at org.apache.derby.impl.tools.ij.utilMain.initFromEnvironment(utilMain.java:179)&lt;br/&gt;
        at org.apache.derby.impl.tools.ij.Main.&amp;lt;init&amp;gt;(Main.java:230)&lt;br/&gt;
        at org.apache.derby.impl.tools.ij.Main.getMain(Main.java:193)&lt;br/&gt;
        at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:178)&lt;br/&gt;
        at org.apache.derby.impl.tools.ij.Main.main(Main.java:73)&lt;br/&gt;
        at org.apache.derby.tools.ij.main(ij.java:67)&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.derby.jdbc.InternalDriver.embeddedDriverAcceptsURL(InternalDriver.java:116)&lt;br/&gt;
        at org.apache.derby.jdbc.InternalDriver.acceptsURL(InternalDriver.java:107)&lt;br/&gt;
        at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:126)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedSimpleDataSource.getConnection(EmbeddedSimpleDataSource.java:406)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedSimpleDataSource.getConnection(EmbeddedSimpleDataSource.java:373)&lt;br/&gt;
        at java.lang.reflect.AccessibleObject.invokeL(AccessibleObject.java:213)&lt;br/&gt;
        ... 11 more&lt;br/&gt;
ij version 10.3&lt;br/&gt;
ij&amp;gt;&lt;/p&gt;

&lt;p&gt;After that, ij does appear to start normal operations.&lt;/p&gt;</description>
                <environment>windows xp; j9 -jcl:foun11 -version:&lt;br/&gt;
&lt;br/&gt;
java version &amp;quot;J2ME Foundation Specification v1.1&amp;quot;&lt;br/&gt;
IBM J9 2.3 Windows XP x86-32  (JIT enabled)&lt;br/&gt;
J9VM - 20061023_08962_lHdSMR&lt;br/&gt;
JIT  - 20060629_1804ifx1_r8&lt;br/&gt;
GC   - 200609_15&lt;br/&gt;
JCL  - 20061020_1321,foun11&lt;br/&gt;
&lt;br/&gt;
Licensed Materials - Property of IBM&lt;br/&gt;
&lt;br/&gt;
J9 - VM for the Java(TM) platform, Version 2.3&lt;br/&gt;
(c) Copyright IBM Corp. 1991, 2006  All Rights Reserved&lt;br/&gt;
Target: 20061023_08962_lHdSMR (Windows XP 5.1 build 2600 Service Pack 2 x86)&lt;br/&gt;
JIT  - 20060629_1804ifx1_r8</environment>
        <key id="12370565">DERBY-2733</key>
            <summary>ij rolls through NullPointerException (NPE) with J2ME/JSR169/WEME 6.1.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="myrna">Myrna van Lunteren</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                    </labels>
                <created>Thu, 31 May 2007 04:22:10 +0100</created>
                <updated>Fri, 11 Jan 2008 19:54:22 +0000</updated>
                            <resolved>Fri, 11 Jan 2008 19:54:22 +0000</resolved>
                                    <version>10.1.2.1</version>
                    <version>10.2.2.0</version>
                    <version>10.3.1.4</version>
                                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Tools</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12503252" author="myrna" created="Mon, 11 Jun 2007 01:50:32 +0100"  >&lt;p&gt;well, I could&apos;ve sworn things worked normal after the NPE, i.e. I was able to connect with &apos;jdbc:derby:abcdb;create=true&apos;;, but now I consistently get &apos;JAVA ERROR: java.lang.NoClassDefFoundError: java.sql.Driver&apos;, when I try to connect.&lt;/p&gt;

&lt;p&gt;Also, when I attempt to connect with correct properties I get this error, after a different stack trace; after which the jvm just shuts down.&lt;/p&gt;

&lt;p&gt;I &lt;b&gt;know&lt;/b&gt; I&apos;ve been able to create databases with ij before with JSR169, not sure what is going on...&lt;/p&gt;


</comment>
                            <comment id="12503412" author="myrna" created="Mon, 11 Jun 2007 15:12:14 +0100"  >&lt;p&gt;I remembered how I got to working after the NPE - if you omit the protocol on the connect things work; i.e.: connect &apos;abcdb;create=true&apos;;&lt;/p&gt;</comment>
                            <comment id="12503684" author="myrna" created="Tue, 12 Jun 2007 00:47:56 +0100"  >&lt;p&gt;I made a small change to EmbeddedSimpleDataSource, but would appreciate someone reviewing it.&lt;/p&gt;

&lt;p&gt;Also I added an example to the ij.dataSource documentation to indicate you don&apos;t need the protocol with a datasource and that it is in fact hurting when you&apos;re using a jvm supporting JSR169.&lt;/p&gt;
</comment>
                            <comment id="12503712" author="djd" created="Tue, 12 Jun 2007 04:31:43 +0100"  >&lt;p&gt;I looked at the change for EmbeddedSimpleDataSource and I don&apos;t believe it is ok.&lt;br/&gt;
It changes getConnection() for the data source to return null, however null is not a valid return from getConnection.&lt;br/&gt;
javax.sql.DataSource.getConnection() either returns a valid Connection object or throws an exception.&lt;/p&gt;</comment>
                            <comment id="12504305" author="myrna" created="Wed, 13 Jun 2007 17:15:25 +0100"  >&lt;p&gt;I believe this is the right thing to do...&lt;br/&gt;
Derbyall and suites.all pass without any issues.&lt;/p&gt;</comment>
                            <comment id="12504391" author="kmarsden" created="Wed, 13 Jun 2007 21:03:22 +0100"  >&lt;p&gt;Shouldn&apos;t startJBMS() throw an exception if it does not connect?  I guess the thing I don&apos;t understand is why ij is trying to make a connection (calling startJBMS()) just because it was started.&lt;/p&gt;</comment>
                            <comment id="12504440" author="myrna" created="Wed, 13 Jun 2007 22:42:20 +0100"  >&lt;p&gt;IRC transcript between Kathey &amp;amp; me, ca 1.20 pm PDT&lt;/p&gt;

&lt;p&gt;myrna&amp;gt;	hi kathey?&lt;br/&gt;
	&amp;lt;kmarsden&amp;gt;	hi myrna&lt;br/&gt;
	&amp;lt;myrna&amp;gt;	I saw your reply re &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2733&quot; title=&quot;ij rolls through NullPointerException (NPE) with J2ME/JSR169/WEME 6.1.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2733&quot;&gt;&lt;del&gt;DERBY-2733&lt;/del&gt;&lt;/a&gt;...&lt;br/&gt;
	&amp;lt;kmarsden&amp;gt;	So why does startJBMS() get called, when all we are doing is starting ij?&lt;br/&gt;
	&amp;lt;myrna&amp;gt;	I could be wrong, but it seems to me a number of defaults are set up in startJBMS(), defaults that we&apos;d want.&lt;br/&gt;
	&amp;lt;myrna&amp;gt;	Such as, we default to use EmbeddedSimpleDataSource.&lt;br/&gt;
	&amp;lt;kmarsden&amp;gt;	why does the bug not occur for other jvms?&lt;br/&gt;
	&amp;lt;myrna&amp;gt;	because they don&apos;t &lt;b&gt;require&lt;/b&gt; a datasource; they are happy with loading the default driver.&lt;br/&gt;
	&amp;lt;myrna&amp;gt;	With j2ME, there is no default driver, so it rolls on with no info.&lt;br/&gt;
	&amp;lt;kmarsden&amp;gt;	do they return null from startJBMS() if ij.database is not set?&lt;br/&gt;
	&amp;lt;myrna&amp;gt;	With other jvms it tries to make the connection, (using drivermanager), and the connection comes out as null, and then yes, startJBMS returns null.&lt;br/&gt;
	&amp;lt;kmarsden&amp;gt;	it wouldn&apos;t be null. it would throw an exception no?&lt;br/&gt;
	&amp;lt;myrna&amp;gt;	no&lt;br/&gt;
	&amp;lt;myrna&amp;gt;	there&apos;s no need to start ij with a database!&lt;br/&gt;
	&amp;lt;myrna&amp;gt;	I&apos;m not at this point interested in fixing the entire logic of ij...&lt;br/&gt;
	&amp;lt;myrna&amp;gt;	I just want this little bit to work, and a follow up bit that prevents ij from attempting to load a driver if we have a datasource &amp;amp; we&apos;re using j2me.&lt;br/&gt;
	&amp;lt;myrna&amp;gt;	(cause in that case ij never even starts).&lt;br/&gt;
	&amp;lt;kmarsden&amp;gt;	hmmm... Well I can&apos;t say I understand the fix. At least the javadoc should be changed to say under what conditions startJBMS() returns null.&lt;br/&gt;
	&amp;lt;kmarsden&amp;gt;	Maybe Dan could take another peek.&lt;br/&gt;
	&amp;lt;kmarsden&amp;gt;	Sorry I wasn&apos;t so helpful on review.&lt;br/&gt;
	&amp;lt;myrna&amp;gt;	&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; you need to do what you think is right.&lt;br/&gt;
	&amp;lt;myrna&amp;gt;	At the same time, I need to go do other stuff...and an overhaul of ij is not on my list at this point.&lt;br/&gt;
	&amp;lt;myrna&amp;gt;	Even a full analysis of what situations startJBMS returns null wasn&apos;t on my list of things... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
	&amp;lt;myrna&amp;gt;	thx kathey&lt;br/&gt;
	&amp;lt;kmarsden&amp;gt;	ok myrna. &lt;/p&gt;</comment>
                            <comment id="12504490" author="myrna" created="Thu, 14 Jun 2007 02:01:23 +0100"  >&lt;p&gt;I looked at the code some more, and I really think the change is ok.&lt;br/&gt;
I committed the code change with revision 547069, and the doc change with revision 547071.&lt;/p&gt;</comment>
                            <comment id="12505296" author="myrna" created="Fri, 15 Jun 2007 17:27:55 +0100"  >&lt;p&gt;I don&apos;t know how I could let this happen, but the change actually caused all sql tests with weme6.1 to fail!&lt;br/&gt;
Backing out in a hurry.&lt;/p&gt;</comment>
                            <comment id="12545847" author="johnemb" created="Tue, 27 Nov 2007 14:12:24 +0000"  >&lt;p&gt;For what it&apos;s worth, I also see this with the phoneME Advanced VM (cvm), i.e. I&apos;m getting &lt;br/&gt;
java.lang.reflect.InvocationTargetException&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
if I try to start IJ without setting the ij.dataSource.databaseName property.&lt;/p&gt;

&lt;p&gt;I too think we should be able to start IJ without having to specify a database, or at least not connect to one! (I&apos;m sorry I don&apos;t have enough cycles available to look into the code changes at this time.)&lt;/p&gt;

&lt;p&gt;The documentation is inconsistent at this point. tools/rtoolsijproprefdatasource.html first says that:&lt;/p&gt;

&lt;p&gt;&quot;To establish a connection using ij.dataSource, you need to set the ij.dataSource.databaseName property.&quot;&lt;br/&gt;
(which matches the current implementation)&lt;/p&gt;

&lt;p&gt;But in Example 2 (added as part of this Jira issue), only ij.dataSource is specified, and IJ seems to start successfully (which in reality it will not do at this point). I think this should be corrected, in the 10.3 docs at least.&lt;/p&gt;</comment>
                            <comment id="12546363" author="myrna" created="Wed, 28 Nov 2007 19:37:41 +0000"  >&lt;p&gt;I plan to look at this again for 10.4, didn&apos;t anticipate doing anything for  10.3...&lt;br/&gt;
I couldn&apos;t remember the details of the behavior documented, so I went back and did some experimenting...&lt;/p&gt;

&lt;p&gt;It looks like all in all, currently, both with jdk15 and the java ME I have available(j9/weme6.1) the behavior is similar; if you don&apos;t specify ij.dataSource.databaseName it doesn&apos;t connect (of course)  to any database, but it does start ij after an error. &lt;br/&gt;
If you specify ij.dataSource.databaseName ij correctly connects to the intended database if it exists, if you it doesn&apos;t exists, it reports &apos;ERROR XJ004: database &apos;...&apos; not found&apos;. If you add the create it&apos;ll automatically create.&lt;/p&gt;

&lt;p&gt;So the only differences between jdk15 and j9 that I see are:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if you don&apos;t specify ij.dataSource.databaseName, with ij java ME encounters the inelegant NPE documented in this JIRA&lt;/li&gt;
	&lt;li&gt;if you happen to also have -Dij.protocol=jdbc:derby: floating around, ij won&apos;t start at all with j9 complaining about NoClassDefFound java.sql.Driver. I believe this is documented elsewhere (not to specify the protocol with dataSources) although I can&apos;t find it right now.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So, I&apos;m a bit lost trying to fix the docs for 10.3...&lt;br/&gt;
The only thing I can see basically wrong is the indication that you &lt;b&gt;must&lt;/b&gt; specify the databaseName property. If we added something like: &quot;If you do not specify the databaseName property, you will get an error. You can then still connect to the database if you omit the protocol.&quot;&lt;/p&gt;

&lt;p&gt;Suggestions?&lt;/p&gt;
</comment>
                            <comment id="12546626" author="johnemb" created="Thu, 29 Nov 2007 09:22:15 +0000"  >&lt;p&gt;From what I can see, the fact that ij runs into the NullPointerException when only ij.dataSource is set (to EmbeddedSimpleDataSource) is true for both Java ME and Java SE VMs. The only difference is, as you mention, that with Java ME ij fails to start if ij.protocol is also set.&lt;/p&gt;

&lt;p&gt;The only issue I have with the current documentation in this regard is that the second example (Example 2) does not show the real behavior of ij. If you do what the example in the docs say, you will run into the combined InvocationTargetException/NullPointerException before you can continue to use ij as if no error occurred (at least that is our perception at this point).&lt;/p&gt;

&lt;p&gt;I think it would be better to:&lt;/p&gt;

&lt;p&gt; a) Specify that you should not specify ij.protocol when using Java ME (EmbeddedSimpleDataSource) in the &quot;Function&quot; or &quot;Syntax&quot; section of the doc topic. (If you can&apos;t find where this is documented elsewhere, a user probably won&apos;t find it either.)&lt;/p&gt;

&lt;p&gt; b) Let the examples show actual Derby behavior and recommended usage. If ij, as this piece of documentation says, does not currently support setting ij.dataSource without also setting ij.dataSource.databaseName, then all ij.dataSource examples should set the latter property as well.&lt;/p&gt;

&lt;p&gt;So perhaps the easiest temporary solution would be to do a) above, and remove Example 2 from the docs until we have a solution in the code letting us do what Example 2 does without errors.&lt;/p&gt;

&lt;p&gt;It&apos;s no big deal, though - 10.3.2 will probably be released without such a change anyway, and for future releases we still have some time to fix the NPE (which would make example 2 valid).&lt;/p&gt;</comment>
                            <comment id="12557107" author="myrna" created="Wed, 9 Jan 2008 01:41:11 +0000"  >&lt;p&gt;I think the trouble is with the no-args constructor.&lt;br/&gt;
The newest patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2733&quot; title=&quot;ij rolls through NullPointerException (NPE) with J2ME/JSR169/WEME 6.1.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2733&quot;&gt;&lt;del&gt;DERBY-2733&lt;/del&gt;&lt;/a&gt;_3.diff) calls update() in the no-args constructor which then sets the jdbcurl to jdbc:derby and then there is no NPE anymore.&lt;/p&gt;

&lt;p&gt;This mimics what happens in ReferenceableDataSource. &lt;/p&gt;

&lt;p&gt;I did wonder about the meaning of the comment in EmbeddedDataSource (which extends ReferenceableDataSource) :&lt;br/&gt;
....&lt;br/&gt;
// needed by Object Factory&lt;br/&gt;
// don&apos;t put anything in here or in any of the set method because this&lt;br/&gt;
// object may be materialized in a remote machine and then sent thru&lt;br/&gt;
// the net to the machine where it will be used.&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;I think this comment is not (no longer?) applicable, possibly not even to EmbeddedDataSource, because stuff is put in various set methods...So I think it&apos;s OK to add the call as in the _3 patch.&lt;/p&gt;

&lt;p&gt;Starting ij without any properties now works exactly the same with my j2ME as with jdk15; both cases just give an XJ004 error and start ij without any connection. &lt;br/&gt;
suites.All ran fine with j9 and jdk15, and derbyall ran fine with j9. (I&apos;m still running derbyall with jdk15 for good measure, but I doubt that gives any trouble, I don&apos;t think any of the tests exercise EmbeddedSimpleDataSource.)&lt;/p&gt;

&lt;p&gt;I intend to commit this change tomorrow If there are no more comments.&lt;br/&gt;
Then I&apos;ll take another look at the docs.&lt;/p&gt;</comment>
                            <comment id="12557133" author="myrna" created="Wed, 9 Jan 2008 04:44:48 +0000"  >&lt;p&gt;Running the tests showed no trouble with the latest patch.&lt;/p&gt;</comment>
                            <comment id="12557366" author="myrna" created="Wed, 9 Jan 2008 18:11:55 +0000"  >&lt;p&gt;committed code change with revision 610484 (&lt;a href=&quot;http://svn.apache.org/viewvc?view=rev&amp;amp;revision=610484&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=rev&amp;amp;revision=610484&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="12557399" author="myrna" created="Wed, 9 Jan 2008 19:48:14 +0000"  >&lt;p&gt;attaching another attempt at documentation update for ij.dataSource. Again, I intend to commit tomorrow if there are no objections.&lt;/p&gt;</comment>
                            <comment id="12557404" author="djd" created="Wed, 9 Jan 2008 19:57:58 +0000"  >&lt;p&gt;In the documentation the first line has:&lt;br/&gt;
  &quot;When specifying a datasource, Derby does not use the DriverManager mechanism to establish connections.&quot;&lt;/p&gt;

&lt;p&gt;I think to be clearer it should be &quot;ij&quot; and not &quot;Derby&quot; in &quot;Derby does not use ...&quot;.&lt;/p&gt;

&lt;p&gt;In the syntax section it never actually states what the property needs to be set to, ie. what its value represents.&lt;br/&gt;
The section does have this:&lt;br/&gt;
    ij.dataSource=dataSourcename&lt;/p&gt;

&lt;p&gt;but I think that&apos;s misleading. A data source does have a name (java bean property dataSourceName) and that&apos;s not what is required here.&lt;br/&gt;
Instead the value is the class name of the data source.&lt;/p&gt;</comment>
                            <comment id="12557436" author="chaase3" created="Wed, 9 Jan 2008 21:24:14 +0000"  >&lt;p&gt;In addition to Dan&apos;s more substantive corrections, here are some suggestions about language and format.&lt;/p&gt;

&lt;p&gt;There&apos;s a run-on sentence here as well as some stray single quotation marks:&lt;/p&gt;

&lt;p&gt;&quot;To establish a connection using ij.dataSource, you should set the ij.dataSource.databaseName property, otherwise ij will start with an error indicating database &apos;&apos; was not found.&quot;&lt;/p&gt;

&lt;p&gt;I&apos;d suggest the following &amp;#8211;&lt;/p&gt;

&lt;p&gt;&quot;To establish a connection using ij.dataSource, set the ij.dataSource.databaseName property. If you do not set this property, ij will start with an error indicating that the database was not found.&quot;&lt;/p&gt;

&lt;p&gt;It might be clearer if the last sentence of the revised paragraph came after the three property syntax lines, and if you changed the passive voice to active. Also, should &quot;databaseName&quot; be in code font?&lt;/p&gt;

&lt;p&gt;&quot;If you do not specify ij.dataSource.databaseName, you can still connect to a database after the error indicating that no database was found, but you should not specify the protocol, just the databaseName, in the connect statement.&quot;&lt;/p&gt;

&lt;p&gt;In example 2, you need to add a line break in the java command, similar to the one in example 1. Otherwise the code line is too long in the output.&lt;/p&gt;</comment>
                            <comment id="12557508" author="myrna" created="Thu, 10 Jan 2008 01:15:40 +0000"  >&lt;p&gt;Attaching another version, incorporating Dan and Kim&apos;s comments.&lt;/p&gt;

&lt;p&gt;How&apos;s this look?&lt;/p&gt;</comment>
                            <comment id="12557587" author="johnemb" created="Thu, 10 Jan 2008 10:16:43 +0000"  >&lt;p&gt;Thank you for doing this Myrna, it is a great improvement!&lt;/p&gt;

&lt;p&gt;The code change works fine with my Java ME VM (phoneME Advanced).&lt;/p&gt;

&lt;p&gt;I will comment on the doc changes below, but first I&apos;d like to present my view of how this should ideally work:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I think it would be easier to use IJ with a datasource (and to document it) if IJ tries to connect automatically to a database ONLY IF ij.dataSource.databaseName is set. It makes no sense doing it otherwise.&lt;/li&gt;
	&lt;li&gt;If ij.dataSource.databaseName is set, and IJ successfully connects to the database automatically on startup, this should be indicated to the user, e.g. &quot;Connected to database &lt;span class=&quot;error&quot;&gt;&amp;#91;databaseName&amp;#93;&lt;/span&gt;&quot;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Given the current implementation, I have the following comments regarding the doc changes:&lt;/p&gt;

&lt;p&gt;First, I think it would be useful to explicitly say that ij will try to connect to your database automatically when you specify ij.dataSource. E.g.&lt;/p&gt;

&lt;p&gt;&quot;When you set the ij.dataSource property ij will automatically try to connect to a database. To establish a connection to a specific database using ij.dataSource, set the ij.dataSource.databaseName property. If you do not set this property, ij will start with an error...&quot;&lt;/p&gt;

&lt;p&gt;It&apos;s awkward, but I think it is needed given the current implementation.&lt;/p&gt;

&lt;p&gt;Second, I think the sentence&lt;/p&gt;

&lt;p&gt;&quot;If you do not specify ij.dataSource.databaseName, you can still connect to a database after the error indicating that no database was found, but you should not specify the protocol, just the databasename, in the connect statement.&quot;&lt;/p&gt;

&lt;p&gt;is a bit long and complex (I almost lose my breath reading it). Besides, I think &quot;just the databasename&quot; may be misleading (because you may include connection attributes as well), and that we should say &quot;connect command&quot; instead of &quot;connect statement&quot; (because that is how it is described in the Tools guide). I suggest the following:&lt;/p&gt;

&lt;p&gt;&quot;If you do not specify ij.dataSource.databaseName and get an error indicating that no database was found, you can still connect to a database manually by using ij&apos;s connect command. You should not specify the protocol (for example jdbc:derby&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; in the connect command when using ij.dataSource.&quot;&lt;/p&gt;

&lt;p&gt;Actually, I think Example 2 as it is in the current doc trunk is useful to show this &quot;feature&quot;, but it should include the error message:&lt;/p&gt;

&lt;p&gt;java -Dij.dataSource=org.apache.derby.jdbc.EmbeddedSimpleDataSource org.apache.derby.tools.ij&lt;br/&gt;
ERROR XJ004: Database &apos;&apos; not found.&lt;br/&gt;
ij version 10.4&lt;br/&gt;
ij&amp;gt; connect &apos;smalldb;create=true&apos;;&lt;br/&gt;
ij&amp;gt;&lt;/p&gt;

&lt;p&gt;The doc page should include a reference to the documentation for the connect command.&lt;/p&gt;

&lt;p&gt;Finally, the documentation for the connect command ( &lt;a href=&quot;http://db.apache.org/derby/docs/dev/tools/rtoolsijcomref22318.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/docs/dev/tools/rtoolsijcomref22318.html&lt;/a&gt; ) says:&lt;/p&gt;

&lt;p&gt;&quot;Connects to the database indicated by the ConnectionURLString. Specifically, takes the value of the string database connection URL and issues a java.sql.DriverManager.getConnection request to set the current connection to that database connection URL.&quot;&lt;/p&gt;

&lt;p&gt;which is incorrect if you specify ij.dataSource (and do not include the protocol in the URL - sigh...). Something like this is more correct, I guess:&lt;/p&gt;

&lt;p&gt;&quot;Connects to the database indicated by the ConnectionURLString. Specifically, ij takes the value of the string (the database connection URL) and issues a getConnection request using java.sql.DriverManager or a javax.sql.DataSource implementation (see the ij.dataSource property) to set the current connection to that database connection URL.&quot;&lt;/p&gt;

&lt;p&gt;(If the connect command docs should be handled in a separate Jira, feel free to create one, or let me know so I can do it myself).&lt;/p&gt;</comment>
                            <comment id="12557668" author="chaase3" created="Thu, 10 Jan 2008 15:19:40 +0000"  >&lt;p&gt;Thanks for the fixes, Myrna!&lt;/p&gt;

&lt;p&gt;I think John&apos;s suggestions are excellent too. I was puzzling over that long sentence but could not think of a way to improve it. I was also thinking it would be good to have an example showing how to connect without specifying the protocol, but I thought if you got a stack trace that might not be practical. If it&apos;s just the one-line error I think the example is very helpful &amp;#8211; and even if there is a stack trace you could just have a line with an ellipsis (...) to indicate that.&lt;/p&gt;

&lt;p&gt;I&apos;ll leave it to you to decide whether to file a separate issue for the related fix to the connect command doc or to include it here. I think there would be no harm fixing it as part of this issue, since it&apos;s related.&lt;/p&gt;</comment>
                            <comment id="12557693" author="djd" created="Thu, 10 Jan 2008 16:49:51 +0000"  >&lt;p&gt;John&amp;gt; - I think it would be easier to use IJ with a datasource (and to document it) if IJ tries to connect automatically to a database ONLY IF ij.dataSource.databaseName is set. It makes no sense doing it otherwise. &lt;/p&gt;

&lt;p&gt;That&apos;s true with Derby but technically may not be true for all data source implementations.&lt;br/&gt;
databaseName is a standard property for a data source but is not mandatory, so if ij remains a generic JDBC tool then there should not be a requirement for  ij.dataSource.databaseName to be set.&lt;/p&gt;</comment>
                            <comment id="12557794" author="johnemb" created="Thu, 10 Jan 2008 20:58:22 +0000"  >&lt;p&gt;Dan,&lt;/p&gt;

&lt;p&gt;You make a good point, but is there a requirement that ij MUST connect automatically to a database when ij.dataSource is set? If there is a DataSource which does not support the databaseName property, or if an ij user for some reason does not want to set it (must be an edge case...), I don&apos;t see why IJ should try to connect automatically to some (undefined) database (apart from backwards compatibility reasons). My proposal was to not connect automatically if the database name is not set - the user can always run the connect command in ij to connect to any given database using the specified datasource.&lt;/p&gt;</comment>
                            <comment id="12557845" author="myrna" created="Thu, 10 Jan 2008 23:28:29 +0000"  >&lt;p&gt;Another attempt at making the documentation reflect the current behavior.&lt;/p&gt;</comment>
                            <comment id="12557848" author="myrna" created="Thu, 10 Jan 2008 23:31:54 +0000"  >&lt;p&gt;I think further changes to the behavior  of ij/ij.dataSource can be addressed in a separate JIRA; this one specifically addresses the NPE when using EmbeddedSimpleDataSource...&lt;/p&gt;</comment>
                            <comment id="12557930" author="johnemb" created="Fri, 11 Jan 2008 08:13:09 +0000"  >&lt;p&gt;The output from the latest patch revision looks very good - thanks!&lt;/p&gt;

&lt;p&gt;I will consider opening another Jira issue for changing the behavior.&lt;/p&gt;</comment>
                            <comment id="12558089" author="myrna" created="Fri, 11 Jan 2008 19:54:22 +0000"  >&lt;p&gt;Committed doc changes as per patch _doc_5 with revision 611279.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12359450" name="DERBY-2733-doc.diff" size="2297" author="myrna" created="Tue, 12 Jun 2007 00:47:56 +0100"/>
                            <attachment id="12359452" name="DERBY-2733-src.diff" size="598" author="myrna" created="Tue, 12 Jun 2007 00:47:56 +0100"/>
                            <attachment id="12359613" name="DERBY-2733.diff2" size="662" author="myrna" created="Wed, 13 Jun 2007 17:15:25 +0100"/>
                            <attachment id="12372754" name="DERBY-2733_3.diff" size="432" author="myrna" created="Wed, 9 Jan 2008 01:41:11 +0000"/>
                            <attachment id="12372828" name="DERBY-2733_doc_3.diff" size="3179" author="myrna" created="Wed, 9 Jan 2008 19:48:14 +0000"/>
                            <attachment id="12372859" name="DERBY-2733_doc_4.diff" size="4052" author="myrna" created="Thu, 10 Jan 2008 01:15:40 +0000"/>
                            <attachment id="12372945" name="DERBY-2733_doc_5.diff" size="6028" author="myrna" created="Thu, 10 Jan 2008 23:28:29 +0000"/>
                            <attachment id="12372943" name="rtoolsijcomref22318.html" size="11038" author="myrna" created="Thu, 10 Jan 2008 23:28:29 +0000"/>
                            <attachment id="12372944" name="rtoolsijproprefdatasource.html" size="9016" author="myrna" created="Thu, 10 Jan 2008 23:28:29 +0000"/>
                            <attachment id="12372860" name="rtoolsijproprefdatasource.html" size="7858" author="myrna" created="Thu, 10 Jan 2008 01:15:40 +0000"/>
                            <attachment id="12372829" name="rtoolsijproprefdatasource.html" size="8440" author="myrna" created="Wed, 9 Jan 2008 19:48:14 +0000"/>
                            <attachment id="12359451" name="rtoolsijproprefdatasource.html" size="7544" author="myrna" created="Tue, 12 Jun 2007 00:47:56 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 12 Jun 2007 03:31:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23207</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0zrj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39612</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>