<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:30:41 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6380/DERBY-6380.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6380] Rolling log files do not get copied in failed directory when a junit test fails</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6380</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6350&quot; title=&quot;Provide a rolling file implementation of derby.log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6350&quot;&gt;&lt;del&gt;DERBY-6350&lt;/del&gt;&lt;/a&gt;(Provide a rolling file implementation of derby.log) is adding a very useful feature to Derby. To test the feature, I ran the junit suite with rollingFile option as shown below&lt;br/&gt;
time java -Dderby.stream.error.style=rollingFile -Dderby.tests.trace=true junit.textui.TestRunner org.apache.derbyTesting.functionTests.suites.All &amp;gt; runall.out 2&amp;gt;&amp;amp;1&lt;br/&gt;
I noticed that even though we are running junit suite with the rollingFile, we still create derby.log(although it was empty) along with expected derby-0.log and so on. I had not expected to see the traditional derby.log when running with rollingFile. In addition, when a test failed, the failed directory had empty derby.log copied but the rolling log files did not get copied. The code changes to copy the rolling log files in case of failure probably need to go into org.apache.derbyTesting.junit.BaseTestCase:runBare() in the &quot;catch (Throwable running) {&quot; section. The log files are crucial to do any test failure debugging and hence should get copied in the failed directory.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12674166">DERBY-6380</key>
            <summary>Rolling log files do not get copied in failed directory when a junit test fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="myrna">Myrna van Lunteren</assignee>
                                    <reporter username="mamtas">Mamta A. Satoor</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Oct 2013 19:01:29 +0100</created>
                <updated>Wed, 21 Jan 2015 00:23:51 +0000</updated>
                            <resolved>Mon, 2 Dec 2013 18:05:45 +0000</resolved>
                                    <version>10.11.1.1</version>
                                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13827057" author="myrna" created="Tue, 19 Nov 2013 22:57:44 +0000"  >&lt;p&gt;Attaching a patch, which creates the files created for all tests in a subdirectory, logfiles, and overrides the BasetTestCase.runBareOverrides class (as suggested in the comments) to copy this directory in its entirety when a test fails.&lt;/p&gt;

&lt;p&gt;I looked at modifying the creation of derby.log, but it&apos;s happening at a quite early time in the test process, and I think it gets created for any test. So I&apos;ve left that alone.&lt;/p&gt;

&lt;p&gt;Also, this test creates a number of other files, but some of the individual test cases specifically verify that they can be deleted afterwards, so I could not come up with an efficient way to copy those when the test fails.&lt;/p&gt;

&lt;p&gt;Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="13828129" author="mamtas" created="Wed, 20 Nov 2013 21:19:27 +0000"  >&lt;p&gt;Hi Myrna, thanks for working on this jira. &lt;/p&gt;

&lt;p&gt;It looks like the patch will handle if this specific test(ErrorStreamTest) failed and if so, the log files will get copied under a special directory under failed directory. I think this approach will be really helpful to debug any test fixture failures in ErrorStreamTest. &lt;/p&gt;

&lt;p&gt;But if in future we added a new rolling file test in a different test other than ErrorStreamTest, then they will need to make similar changes in that test to copy the log files in case of failure(similar to the patch). Or if someone decided to run the bigger junit suite with rolling files, the failures in that scenario will not have the log files copied in the failed directory. May be we do not anticipate many people doing a task of running junit suite with rolling files and hence may be we do not need to worry about that scenario but I just wanted to share those unique cases here if we want to handle those. Thanks&lt;/p&gt;</comment>
                            <comment id="13829692" author="myrna" created="Fri, 22 Nov 2013 06:17:42 +0000"  >&lt;p&gt;I was worrying whether such a global setting would get correctly passed on to all java processes, but that actually seems to work correctly - at least the property seemed to be known in various tests and decorators when I debugged.&lt;/p&gt;

&lt;p&gt;But I thought there were a few tests that actually check for contents of derby.log, hardcoding that name. So I ran the experiment, i.e. run all of suites.All with -Dderby.stream.error.style=rollingFile.&lt;br/&gt;
I got one derby.log in the main test directory, and one under system. Neither were empty.&lt;br/&gt;
I got only 3 test failures:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;DerbyNetAutoStart.testStartNetworkServerLogMessageOnDualStart&lt;/li&gt;
	&lt;li&gt;lang.SysDiagVTIMappingTest.test_5391 (1x emb, 1x net).&lt;br/&gt;
And indeed, the first actually check for derby.log, and the other sets derby.stream.error.file to test expects a specific name which setting is (as documented) overwritten by the style property. So these I think are understandable.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;But I think there are other &apos;failures&apos;, because I see a lot of output going to the console, which I think happens when there&apos;s something wrong in creating the errorlog file?&lt;br/&gt;
The first seems to happen in &lt;br/&gt;
(emb)store.ClassLoaderBootTest.tesBootingAnAlreadyBootedDatabase &lt;br/&gt;
and&lt;br/&gt;
(emb)store.ClassLoaderBootTes.testBootingDatabaseShutdownByAnotherCLR&lt;br/&gt;
There seems to be nothing specific to derby.log in these last two tests - so I do not understand that behavior.&lt;/p&gt;

&lt;p&gt;Another aspect that I noticed with this experiment is that the replication tests database directories which are always left behind after running the replication tests (db_master and db_slave) both have a derby.log file, so perhaps either the tests, or perhaps replication itself does not, or not correctly, work with the stream.error.style setting.&lt;/p&gt;

&lt;p&gt;Somehow, I do see a derby-0.log.lck, which I cannot find documented. Does anyone know where this comes from?&lt;/p&gt;

&lt;p&gt;In another run (in a different directory) I even got a derby-0.log.1 and derby-0.log.1.lck file created.&lt;/p&gt;

&lt;p&gt;On the whole though I think running all the tests with this setting is not very useful or interesting. I can see that running suites.All with specific properties is a valid/useful test because it forces all tests through the new code path. But in this case, I really don&apos;t think such a run is something we&apos;d be interested in doing more than once, and so I think making specific code in the framework to capture this possibility is overkill.&lt;/p&gt;</comment>
                            <comment id="13829726" author="myrna" created="Fri, 22 Nov 2013 06:51:12 +0000"  >&lt;p&gt;I forgot to say, that, if another test creates files that need to be saved to the fail directory, the test needs to make a similar adjustment as I did. The Replication Tests do this too. &lt;/p&gt;</comment>
                            <comment id="13829730" author="myrna" created="Fri, 22 Nov 2013 06:55:08 +0000"  >&lt;p&gt;Separate from the issues I found while running the tests, going back to attempting to address this particular issue.&lt;/p&gt;

&lt;p&gt;Attaching a second patch, which does the same for the ErrorStreamTest, but also copies any derby-#.log file to the fail directory.&lt;/p&gt;

&lt;p&gt;I did not run a performance check on a full suites.All to see if this slows down the full test run. It probably does, a little, because it tries to copy 10 files that might not exist, for each test run. &lt;/p&gt;

&lt;p&gt;So, is this something we want to do or should I only commit the ErrorStreamTest improvement (probably will create a separate issue for it) and mark this particular issue as &apos;Won&apos;t fix&apos;?&lt;/p&gt;

&lt;p&gt;Yet another approach is that I could make the change to BaseTestCase dependent on whether the property derby.stream.error.style is set to &apos;rollingFile&apos;. But it still seems a global change for an unlikely run scenario to me.&lt;/p&gt;</comment>
                            <comment id="13833505" author="jira-bot" created="Wed, 27 Nov 2013 06:14:27 +0000"  >&lt;p&gt;Commit 1545935 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=myrna&quot; class=&quot;user-hover&quot; rel=&quot;myrna&quot;&gt;Myrna van Lunteren&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1545935&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1545935&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6380&quot; title=&quot;Rolling log files do not get copied in failed directory when a junit test fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6380&quot;&gt;&lt;del&gt;DERBY-6380&lt;/del&gt;&lt;/a&gt;; Rolling log files do not get copied in failed directory when a junit test fails&lt;br/&gt;
   adjusting ErrorStreamTest to copy files created in it on fail, and BaseTestCase to copy defaults on fail.&lt;/p&gt;</comment>
                            <comment id="13833511" author="myrna" created="Wed, 27 Nov 2013 06:22:27 +0000"  >&lt;p&gt;I ran suites.All with and without my patch, and the run without was about 20 seconds faster (over 3 1/2 hours), which I think is not significant. So I committed, which should address the basic concern of this issue. &lt;br/&gt;
Note that it&apos;s only the default log file names (derby-&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;.log) that show up when running full suites.All with -Dderby.error.stream.style=logFile. &lt;br/&gt;
The caveats for the ErrorStreamTest still hold; the only files copied on fail are now the ones created in the setUp methods, because the fixtures themselves test the removal of other files created in those fixtures.&lt;/p&gt;</comment>
                            <comment id="13833568" author="jira-bot" created="Wed, 27 Nov 2013 08:16:05 +0000"  >&lt;p&gt;Commit 1545957 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=myrna&quot; class=&quot;user-hover&quot; rel=&quot;myrna&quot;&gt;Myrna van Lunteren&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1545957&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1545957&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6380&quot; title=&quot;Rolling log files do not get copied in failed directory when a junit test fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6380&quot;&gt;&lt;del&gt;DERBY-6380&lt;/del&gt;&lt;/a&gt;; Rolling log files do not get copied in failed directory when a junit test fails&lt;br/&gt;
   removing two &apos;fail&apos; commands left over from debugging, and streamlining clean up in ErrorStreamTest&lt;/p&gt;</comment>
                            <comment id="13836799" author="mamtas" created="Mon, 2 Dec 2013 19:04:22 +0000"  >&lt;p&gt;Thanks for working on this jira, Myrna. &lt;/p&gt;</comment>
                            <comment id="14284876" author="myrna" created="Wed, 21 Jan 2015 00:23:51 +0000"  >&lt;p&gt;bulk change to close all issues resolved but not closed and not changed since June 1, 2014.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12669518">DERBY-6350</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12614724" name="DERBY-6380.diff" size="5697" author="myrna" created="Tue, 19 Nov 2013 22:57:44 +0000"/>
                            <attachment id="12615285" name="DERBY-6380.diff_2" size="6951" author="myrna" created="Fri, 22 Nov 2013 06:55:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 19 Nov 2013 22:57:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353788</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hziu93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>354080</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>