<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:23:05 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4767/DERBY-4767.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4767] Detailed prompt for Error XCL16 is different between Client and Embed</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4767</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;For the sql script below:&lt;/p&gt;

&lt;p&gt;create table t1(c11 int, c12 int);&lt;/p&gt;

&lt;p&gt;&amp;#8211; insert data into tables&lt;br/&gt;
insert into t1 values(1,1);&lt;br/&gt;
insert into t1 values(2,2);&lt;/p&gt;

&lt;p&gt;&amp;#8211; set autocommit off&lt;br/&gt;
autocommit off;&lt;/p&gt;

&lt;p&gt;get with nohold cursor jdk1 as &apos;SELECT * FROM t1&apos;;&lt;/p&gt;

&lt;p&gt;&amp;#8211; do fetches from the cursor&lt;br/&gt;
next jdk1;&lt;/p&gt;

&lt;p&gt;--commit&lt;br/&gt;
commit;&lt;/p&gt;

&lt;p&gt;&amp;#8211; now try the fetch on cursor again after commit&lt;br/&gt;
&amp;#8211; cursors jdk1 will give Error XCL16&lt;br/&gt;
next jdk1;&lt;/p&gt;

&lt;p&gt;&amp;#8211; clean up.&lt;br/&gt;
close jdk1;&lt;/p&gt;

&lt;p&gt;for the line &quot;next jdk1;&quot;, an Error XCL16 will be thrown. However, detailed prompt for Error XCL16 is different between Client and Embed.&lt;br/&gt;
In client mode, we get &quot;ERROR XCL16: ResultSet not open.  Verify that autocommit is OFF.&quot;&lt;br/&gt;
While, in embed mode, we get &quot;ERROR XCL16: ResultSet not open. Operation &apos;next&apos; not permitted. Verify that autocommit is OFF.&quot;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12471291">DERBY-4767</key>
            <summary>Detailed prompt for Error XCL16 is different between Client and Embed</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yunlee">Yun Lee</assignee>
                                    <reporter username="yunlee">Yun Lee</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Aug 2010 14:51:47 +0100</created>
                <updated>Mon, 29 Nov 2010 14:23:26 +0000</updated>
                            <resolved>Mon, 16 Aug 2010 23:31:15 +0100</resolved>
                                                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12897270" author="yunlee" created="Wed, 11 Aug 2010 14:59:58 +0100"  >&lt;p&gt;I have a question about this. When I need change Derby client code to match behavior with Embedded driver, does it mean that for this sql script, CLIENT_RESULT_SET_NOT_OPEN(XCL16.S.1) should be replaced by LANG_RESULT_SET_NOT_OPEN(XCL16.S.0)? And then, why did DERBY created two different(but very similiar) messages?&lt;/p&gt;</comment>
                            <comment id="12897302" author="myrna" created="Wed, 11 Aug 2010 16:20:09 +0100"  >&lt;p&gt;The why is probably, because the client came from a different background than embedded.&lt;/p&gt;

&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3801&quot; title=&quot;Convert &amp;quot;org.apache.derbyTesting.functionTests.tests.lang.holdCursorIJ.sql&amp;quot; to junit. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3801&quot;&gt;&lt;del&gt;DERBY-3801&lt;/del&gt;&lt;/a&gt; I mentioned I took a quick look and &lt;b&gt;thought&lt;/b&gt; it was possible to pass on the operation that caused the CLIENT_RESULT_SET_NOT_OPEN to be passed on. But I&apos;m not a client/server/drda expert, so perhaps I&apos;m wrong.&lt;/p&gt;

&lt;p&gt;To pull these two messages together, without losing helpful information, the thing to do would be to add the information about the operation causing the error situation to be propogated.&lt;/p&gt;

&lt;p&gt;You cannot simply replace CLIENT_RESULT_SET_NOT_OPEN by LANG_RESULT_SET_NOT_OPEN, because the LANG one has an additional parameter, that&apos;s not available &lt;b&gt;right now&lt;/b&gt; for the CLIENT one. You&apos;d get NPEs at worst, empty strings at best. So, some work is involved in finding what the operation is in each call for the CLIENT one. &lt;/p&gt;

&lt;p&gt;As the CLIENT one seems to be called from one of two methods (client.am.ResultSet.checkForClosedResultSet(), and client.am.SectionManager()), those methods will need to be changed to pass the operation through. Judging by the usage of LANG_RESULT_SET_NOT_OPEN, depending on the situation, either variables for the operation strings (like they&apos;re defined for the LANG message in e.g. impl.sql.execute.BasicNoPutResultSetImpl.java)  will have to get defined somewhere (I don&apos;t know the best place for that, but I believe the client code has a central place for strings like that), or they can be hardcoded/ad hoc (like e.g. in MaterializedResultSet). &lt;/p&gt;

&lt;p&gt;(note, the operations are commands, not language constructs/messages, so don&apos;t need to be translated, and thus, can be hardcoded).&lt;/p&gt;</comment>
                            <comment id="12897778" author="yunlee" created="Thu, 12 Aug 2010 15:46:10 +0100"  >&lt;p&gt;Hi, Myrna. I have replaced CLIENT_RESULT_SET_NOT_OPEN by LANG_RESULT_SET_NOT_OPEN with the suitable params and cretaed a testxcl16.sql to test this issue. Please check the patch.&lt;/p&gt;

&lt;p&gt;Besides, I have a question, CLIENT_RESULT_SET_NOT_OPEN is not used anywhere now, except in SQLState.java, why not deleted it and change &quot;XCL16.S.0&quot; to &quot;XCL16.S&quot;?&lt;/p&gt;</comment>
                            <comment id="12897849" author="myrna" created="Thu, 12 Aug 2010 18:26:12 +0100"  >&lt;p&gt;You&apos;re correct - once the CLIENT_RESULT_SET_NOT_OPEN message is no longer needed, it also needs to be removed from SQLState.java.&lt;br/&gt;
And, as such, also from the related message.xml and for completeness&apos; sake, also from the related translation files.&lt;/p&gt;

&lt;p&gt;I will look at the current patch today.&lt;/p&gt;</comment>
                            <comment id="12898061" author="yunlee" created="Fri, 13 Aug 2010 04:38:30 +0100"  >&lt;p&gt;Hi, Myrna. I have removed CLIENT_RESULT_SET_NOT_OPEN and &quot;XCL16.S.1&quot;, just keeped &quot;XCL16.S&quot;, please check the new patch.&lt;/p&gt;</comment>
                            <comment id="12898621" author="myrna" created="Sat, 14 Aug 2010 19:11:50 +0100"  >&lt;p&gt;Thanks for the revised patch.&lt;/p&gt;

&lt;p&gt;I reviewed it, and made some minor adjustments:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;client.am.ResultSet.java&lt;/li&gt;
	&lt;li&gt;checkGetterPreconditions(), you passed on the hardcoded string &quot;operation&quot; instead of the parameter passed in to the method. I changed it, I&apos;m sure this was a typo&lt;/li&gt;
	&lt;li&gt;method lastX() is private - the operation would be &quot;last&quot; not &quot;lastX&quot;.&lt;/li&gt;
	&lt;li&gt;method previousX() is private - the operation would be &quot;previous&quot;&lt;/li&gt;
	&lt;li&gt;relativeX - similarly, should be &quot;relative&quot;&lt;/li&gt;
	&lt;li&gt;getRowX - &quot;getRow&quot;&lt;/li&gt;
	&lt;li&gt;rather than the small test you added which would result in another master, I&apos;ve added a couple of checks for the appropriate operation string to some existing tests:&lt;br/&gt;
M       java\testing\org\apache\derbyTesting\functionTests\tests\lang\UpdatableResultSetTest.java&lt;br/&gt;
M       java\testing\org\apache\derbyTesting\functionTests\tests\jdbc4\TestDbMetaData.java&lt;br/&gt;
M       java\testing\org\apache\derbyTesting\functionTests\tests\jdbc4\ResultSetTest.java&lt;br/&gt;
M       java\testing\org\apache\derbyTesting\functionTests\tests\jdbcapi\ResultSetMiscTest.java&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;I committed the change with revision 985550.&lt;/p&gt;

&lt;p&gt;I have two final comments:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I noticed that you made the operation in client.am.sectionManager.getPositionedUpdateResultSet &quot;next&quot;, but I think this should be &quot;update&quot;. I&apos;m rerunning tests with that minor change, and will commit that too if no failures arise.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;And, not relating to your change, but in looking through all the occurrences of LANG_RESULT_SET_NOT_OPEN I noticed in impl.sql.execute.ScrollInsensitiveResultSet.getPreviousRow() that the operation passed in is &quot;next&quot;. I&apos;m idly wondering if that perhaps should be &quot;previous&quot;. We should ask the community and/or log a tiny bug for that.&lt;/p&gt;</comment>
                            <comment id="12898661" author="myrna" created="Sun, 15 Aug 2010 05:19:33 +0100"  >&lt;p&gt;committed the change I mentioned above - passing in &apos;update&apos; instead of &apos;next&apos; in the getPositionedUpdateResultSet method in client.am.sectionManager with revision 985613.&lt;/p&gt;</comment>
                            <comment id="12898844" author="yunlee" created="Mon, 16 Aug 2010 10:57:47 +0100"  >&lt;p&gt;Thanks, Myrna. I have also created &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4776&quot; title=&quot;Correct wrong operation for LANG_RESULT_SET_NOT_OPEN  in ScrollInsensitiveResultSet.getPreviousRow() from &amp;#39;next&amp;#39; to &amp;#39;previous&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4776&quot;&gt;&lt;del&gt;DERBY-4776&lt;/del&gt;&lt;/a&gt; for ScrollInsensitiveResultSet.getPreviousRow() and submitted a patch.&lt;/p&gt;</comment>
                            <comment id="12899032" author="myrna" created="Mon, 16 Aug 2010 19:47:13 +0100"  >&lt;p&gt;I decided to add anoter check to one more test - jdbcapi.ClosedObjectTest - and it showed that the findColumnX method in client/am/ResultSet was called not just from findColumn, but a number of other methods. So, passing on &apos;findColumn&apos; was not the right thing to do there. Instead, I&apos;m adding a parameter to the method and passing in the appropriate operation for each time the findColumnX method is called.&lt;/p&gt;

&lt;p&gt;Also, this added check in ClosedObjectTest showed one more incorrect string in code not touched by the original patch, in impl.jdbc.EmbedResultSet, method rowDeleted(), the string passed on to the LANG_RESULT_SET_NOT_OPEN is &quot;rowUpdated&quot;. &lt;/p&gt;

&lt;p&gt;I&apos;ll fix up these issues, run tests and if this shows no further trouble, I&apos;ll commit.&lt;/p&gt;</comment>
                            <comment id="12899142" author="myrna" created="Mon, 16 Aug 2010 23:31:15 +0100"  >&lt;p&gt;Committed the patch to correct the findColumnX entries in client.am.ResultSet &amp;amp; the 1 occurrence in impl.jdbc.EmbedResultSet and the check added to functionTests.tests.jdbcapi.ClosedObjectTest with revision 986145.&lt;br/&gt;
Closing again.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="32841">DERBY-310</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12461296">DERBY-4609</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12471673">DERBY-4776</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12401144">DERBY-3801</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12452201" name="DERBY-4767.diff3" size="23424" author="myrna" created="Mon, 16 Aug 2010 19:50:06 +0100"/>
                            <attachment id="12452200" name="DERBY-4767.stat3" size="227" author="myrna" created="Mon, 16 Aug 2010 19:50:06 +0100"/>
                            <attachment id="12451998" name="derby-4767-1.patch" size="63984" author="yunlee" created="Fri, 13 Aug 2010 07:33:29 +0100"/>
                            <attachment id="12451999" name="derby-4767-1.stat" size="1702" author="yunlee" created="Fri, 13 Aug 2010 07:33:29 +0100"/>
                            <attachment id="12451908" name="derby-4767.patch" size="33284" author="yunlee" created="Thu, 12 Aug 2010 15:51:50 +0100"/>
                            <attachment id="12451909" name="derby-4767.stat" size="609" author="yunlee" created="Thu, 12 Aug 2010 15:51:50 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10363"><![CDATA[Embedded/Client difference]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 11 Aug 2010 15:20:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31366</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0oe7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37770</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>