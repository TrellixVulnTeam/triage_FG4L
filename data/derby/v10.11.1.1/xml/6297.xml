<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:38:36 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6297/DERBY-6297.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6297] Intermittent failures in XplainStatisticsTest.testSimpleXplainOnly</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6297</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;XplainStatisticsTest.testSimpleXplainOnly fails intermittently.&lt;/p&gt;

&lt;p&gt;Examples:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://download.java.net/javadesktop/derby/javadb-5579342-report/javadb-task-3689858.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://download.java.net/javadesktop/derby/javadb-5579342-report/javadb-task-3689858.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    junit.framework.AssertionFailedError: Column value mismatch @ column &apos;1&apos;, row 1:&lt;br/&gt;
    Expected: &amp;gt;1&amp;lt;&lt;br/&gt;
    Found:    &amp;gt;2&amp;lt;&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1278)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1190)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertFullResultSetMinion(JDBC.java:1077)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:1000)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:957)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:915)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertSingleValueResultSet(JDBC.java:900)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.XplainStatisticsTest.testSimpleXplainOnly(XplainStatisticsTest.java:1148)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:439)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:456)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://download.java.net/javadesktop/derby/javadb-5579365-report/javadb-task-3690182.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://download.java.net/javadesktop/derby/javadb-5579365-report/javadb-task-3690182.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    junit.framework.AssertionFailedError: Column value mismatch @ column &apos;1&apos;, row 1:&lt;br/&gt;
    Expected: &amp;gt;4&amp;lt;&lt;br/&gt;
    Found:    &amp;gt;7&amp;lt;&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1278)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1190)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertFullResultSetMinion(JDBC.java:1077)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:1000)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:957)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:915)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertSingleValueResultSet(JDBC.java:900)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.XplainStatisticsTest.testSimpleXplainOnly(XplainStatisticsTest.java:1183)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:439)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:456)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12658485">DERBY-6297</key>
            <summary>Intermittent failures in XplainStatisticsTest.testSimpleXplainOnly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Jul 2013 11:25:11 +0100</created>
                <updated>Wed, 21 Jan 2015 00:23:11 +0000</updated>
                            <resolved>Wed, 28 Aug 2013 11:44:15 +0100</resolved>
                                    <version>10.11.1.1</version>
                                    <fixVersion>10.10.2.0</fixVersion>
                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13720529" author="knutanders" created="Fri, 26 Jul 2013 09:24:29 +0100"  >&lt;p&gt;(See also discussion about this failure in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6216&quot; title=&quot;XPLAIN feature does not work and gives ERROR XCL16: ResultSet not open&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6216&quot;&gt;&lt;del&gt;DERBY-6216&lt;/del&gt;&lt;/a&gt;.)&lt;/p&gt;

&lt;p&gt;A workaround may be to add a WHERE clause to the SELECT statements so that they only look for the statements that are explicitly run by the test. Still, we should try to find out why the getSchema() meta-data queries sometimes turn up in the results and sometimes don&apos;t, before we close this issue.&lt;/p&gt;</comment>
                            <comment id="13746325" author="myrna" created="Wed, 21 Aug 2013 16:40:46 +0100"  >&lt;p&gt;Saw this here:&lt;br/&gt;
&lt;a href=&quot;http://people.apache.org/~myrnavl/derby_test_results/main/windows/testlog/ibm16/1516056-suites.All_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~myrnavl/derby_test_results/main/windows/testlog/ibm16/1516056-suites.All_diff.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The stack trace is similar to Knut&apos;s first example:&lt;br/&gt;
1) testSimpleXplainOnly(org.apache.derbyTesting.functionTests.tests.lang.XplainStatisticsTest)junit.framework.AssertionFailedError: Column value mismatch @ column &apos;1&apos;, row 1:&lt;br/&gt;
    Expected: &amp;gt;1&amp;lt;&lt;br/&gt;
    Found:    &amp;gt;2&amp;lt;&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1278)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1190)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertFullResultSetMinion(JDBC.java:1077)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:1000)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:957)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:915)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertSingleValueResultSet(JDBC.java:900)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.XplainStatisticsTest.testSimpleXplainOnly(XplainStatisticsTest.java:1148)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:439)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:456)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;/p&gt;</comment>
                            <comment id="13751234" author="knutanders" created="Tue, 27 Aug 2013 13:58:10 +0100"  >&lt;p&gt;I think I found the problem. The disableXplainStyle() method invokes the plan exporter tool. The plan exporter calls getSchemas() from AccessDatabase.schemaExists(), but it does not explicitly close the JDBC result set returned by getSchemas(). Eventually garbage collection and finalization will mark the corresponding activation as not in use. Once it is marked as unused, the activation and its language result sets will be closed on the next (auto-) commit performed on the same connection. Saving statistics is driven from the close() method of the language result set, and if xplain has been enabled between the execution of the getSchemas() query and the actual closing of the result set, statistics may be saved unintentionally.&lt;/p&gt;</comment>
                            <comment id="13751297" author="bryanpendleton" created="Tue, 27 Aug 2013 15:22:59 +0100"  >&lt;p&gt;Great catch!&lt;/p&gt;

&lt;p&gt;And an honest-to-goodness bug, not just a test harness problem, in the end, too!&lt;/p&gt;</comment>
                            <comment id="13751300" author="knutanders" created="Tue, 27 Aug 2013 15:26:16 +0100"  >&lt;p&gt;Attaching d6297-1a.diff which makes AccessDatabase.schemaExists() close the ResultSet before returning.&lt;/p&gt;

&lt;p&gt;The patch also adds an assert to testXplainOnlyExecutePrepared(). The reason for this, was that I found during debugging that the getSchemas query was recorded in the xplain tables much more frequently in this test case than in testSimpleXplainOnly(). But it didn&apos;t fail because it didn&apos;t check the xplain tables. With the extra assert, I could reproduce the intermittent failure much easier in my environment.&lt;/p&gt;

&lt;p&gt;All the regression tests passed with the patch.&lt;/p&gt;

&lt;p&gt;I also ran XplainStatisticsTest in a loop. It used to fail in approximately one out of five runs without the fix. With the fix, it ran 96 times in a row without failing. The 97th time, it failed with the same symptoms as reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6306&quot; title=&quot;XplainStatisticsTest.testSimpleQuery: BEGIN_COMP_TIME unexpectedly NULL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6306&quot;&gt;&lt;del&gt;DERBY-6306&lt;/del&gt;&lt;/a&gt;, which I believe is a different bug.&lt;/p&gt;</comment>
                            <comment id="13751302" author="knutanders" created="Tue, 27 Aug 2013 15:29:48 +0100"  >&lt;p&gt;Changing component from Test to Tools, since the bug was in the plan exporter tool.&lt;/p&gt;</comment>
                            <comment id="13752216" author="jira-bot" created="Wed, 28 Aug 2013 09:57:42 +0100"  >&lt;p&gt;Commit 1518111 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1518111&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1518111&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6297&quot; title=&quot;Intermittent failures in XplainStatisticsTest.testSimpleXplainOnly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6297&quot;&gt;&lt;del&gt;DERBY-6297&lt;/del&gt;&lt;/a&gt;: Intermittent failures in XplainStatisticsTest.testSimpleXplainOnly&lt;/p&gt;

&lt;p&gt;Make AccessDatabase.schemaExists() close the ResultSet.&lt;/p&gt;</comment>
                            <comment id="13752280" author="jira-bot" created="Wed, 28 Aug 2013 11:41:34 +0100"  >&lt;p&gt;Commit 1518150 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/branches/10.10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1518150&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1518150&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6297&quot; title=&quot;Intermittent failures in XplainStatisticsTest.testSimpleXplainOnly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6297&quot;&gt;&lt;del&gt;DERBY-6297&lt;/del&gt;&lt;/a&gt;: Intermittent failures in XplainStatisticsTest.testSimpleXplainOnly&lt;/p&gt;

&lt;p&gt;Merged revision 1518111 from trunk.&lt;/p&gt;</comment>
                            <comment id="13752281" author="knutanders" created="Wed, 28 Aug 2013 11:44:15 +0100"  >&lt;p&gt;I merged the fix to the 10.10 branch. The test cases that were touched by the original patch did not exist on 10.10, so that part of the patch was not backported.&lt;/p&gt;</comment>
                            <comment id="13918743" author="jira-bot" created="Mon, 3 Mar 2014 23:43:49 +0000"  >&lt;p&gt;Commit 1573813 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=myrna&quot; class=&quot;user-hover&quot; rel=&quot;myrna&quot;&gt;Myrna van Lunteren&lt;/a&gt; in branch &apos;code/branches/10.10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1573813&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1573813&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6216&quot; title=&quot;XPLAIN feature does not work and gives ERROR XCL16: ResultSet not open&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6216&quot;&gt;&lt;del&gt;DERBY-6216&lt;/del&gt;&lt;/a&gt;; XPLAIN feature does not work and gives ERROR XCL16: ResultSet not open&lt;br/&gt;
   backport of revision 1502795 from trunk; &lt;br/&gt;
   clean merge, but added modifications to XplainStatisticsTest from revision 1518111 (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6297&quot; title=&quot;Intermittent failures in XplainStatisticsTest.testSimpleXplainOnly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6297&quot;&gt;&lt;del&gt;DERBY-6297&lt;/del&gt;&lt;/a&gt;) not previously backported.&lt;/p&gt;</comment>
                            <comment id="14284760" author="myrna" created="Wed, 21 Jan 2015 00:23:11 +0000"  >&lt;p&gt;bulk change to close all issues resolved but not closed and not changed since June 1, 2014.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12646605">DERBY-6216</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12600174" name="d6297-1a.diff" size="3095" author="knutanders" created="Tue, 27 Aug 2013 15:26:16 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 21 Aug 2013 15:40:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>338679</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzg9bz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>338999</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>