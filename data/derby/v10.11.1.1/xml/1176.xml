<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:09:26 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1176/DERBY-1176.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1176] Stored prepared statements in the SYSIBM schema are not updated on upgrade</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1176</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When upgrading a database created with Derby 10.1 to 10.2, the SPSs in&lt;br/&gt;
the SYSIBM schema are not updated. SYSIBM.METADATA was modified in&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-965&quot; title=&quot;DatabaseMetadata method supportsResultSetConcurrency returns wrong result on network client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-965&quot;&gt;&lt;del&gt;DERBY-965&lt;/del&gt;&lt;/a&gt;, but it still has the old behaviour after the upgrade (both soft and&lt;br/&gt;
hard).&lt;/p&gt;

&lt;p&gt;How to reproduce:&lt;/p&gt;

&lt;p&gt;  1. Create a database with 10.1.&lt;/p&gt;

&lt;p&gt;    soft upgrade:&lt;/p&gt;

&lt;p&gt;  2. Start 10.2 network server.&lt;br/&gt;
  3. Connect to the 10.1 database with the 10.2 client driver and&lt;br/&gt;
     invoke DatabaseMetaData.supportsResultSetConcurrency(&lt;br/&gt;
     ResultSet.TYPE_FORWARD_ONLY, ResultSet.CONCUR_READ_ONLY). Return&lt;br/&gt;
     value: FALSE.&lt;/p&gt;

&lt;p&gt;    hard upgrade:&lt;/p&gt;

&lt;p&gt;  4. Restart 10.2 network server.&lt;br/&gt;
  5. Connect to the database with &quot;upgrade=true&quot; added to the&lt;br/&gt;
     URL. DatabaseMetaData.supportsResultSetConcurrency(&lt;br/&gt;
     Restart.TYPE_FORWARD_ONLY, ResultSet.CONCUR_READ_ONLY) returns&lt;br/&gt;
     FALSE.&lt;/p&gt;

&lt;p&gt;    observe correct behaviour:&lt;/p&gt;

&lt;p&gt;  6. Delete the database and recreate it with 10.2.&lt;br/&gt;
  7. Start 10.2 network server.&lt;br/&gt;
  8. Connect to the database with the client driver and invoke&lt;br/&gt;
     DatabaseMetaData.supportsResultSetConcurrency(&lt;br/&gt;
     Restart.TYPE_FORWARD_ONLY, ResultSet.CONCUR_READ_ONLY). Return&lt;br/&gt;
     value: TRUE.&lt;/p&gt;

&lt;p&gt;Proposed solution for hard upgrade: drop and recreate SPSs.&lt;/p&gt;

&lt;p&gt;Proposed solution for soft upgrade: read SYSIBM.METADATA from&lt;br/&gt;
metadata_net.properties.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12331518">DERBY-1176</key>
            <summary>Stored prepared statements in the SYSIBM schema are not updated on upgrade</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Apr 2006 22:48:10 +0100</created>
                <updated>Fri, 21 Apr 2006 15:07:06 +0100</updated>
                            <resolved>Fri, 21 Apr 2006 15:07:06 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12373595" author="knutanders" created="Fri, 7 Apr 2006 17:36:10 +0100"  >&lt;p&gt;&apos;derby-1176-v1.diff&apos; makes the metadata calls that depend on&lt;br/&gt;
SYSIBM.METADATA return the correct results after an upgrade from 10.1&lt;br/&gt;
(soft or hard).&lt;/p&gt;

&lt;p&gt;  1. DD_Version.doFullUpgrade() now drops and recreates SPSs in all&lt;br/&gt;
     system schemas, not SYSIBM only.&lt;/p&gt;

&lt;p&gt;  2. EmbedDatabaseMetaData already has the necessary machinery to load&lt;br/&gt;
     queries from system tables or metadata.properties depending on&lt;br/&gt;
     whether the engine is in soft upgrade mode or not. I extended it&lt;br/&gt;
     so that it could read queries from metadata_net.properties as&lt;br/&gt;
     well.&lt;/p&gt;

&lt;p&gt;  3. New method EmbedDatabaseMetaData.getClientCachedMetaData() which&lt;br/&gt;
     executes SYSIBM.METADATA (either from system table or&lt;br/&gt;
     metadata_net.properties) to fetch the metadata that will be&lt;br/&gt;
     cached on the client.&lt;/p&gt;

&lt;p&gt;  4. SystemProcedures.METADATA() now invokes&lt;br/&gt;
     EmbedDatabaseMetaData.getClientCachedMetaData() instead of&lt;br/&gt;
     executing the METADATA SPS directly.&lt;/p&gt;

&lt;p&gt;The patch passes derbyall and the upgrade test. I have verified&lt;br/&gt;
manually that the metadata calls on the client return the correct&lt;br/&gt;
values in soft and hard upgrade.&lt;/p&gt;

&lt;p&gt;Please review. Thanks.&lt;/p&gt;</comment>
                            <comment id="12375145" author="dagw" created="Thu, 20 Apr 2006 00:00:33 +0100"  >&lt;p&gt;Nice patch! I think the approach is sound; without it some metadata&lt;br/&gt;
changed for client SUR will be wrong on both soft and hard upgrade, so&lt;br/&gt;
thanks for this.&lt;/p&gt;

&lt;p&gt;Minor nit-picks:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;EmbedDatabaseMetaData.java&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Code readability:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  if ((removeSYSIBMonly &amp;amp;&amp;amp; isSYSIBM) || !removeSYSIBMonly) &lt;/p&gt;
{
     &amp;lt;do something&amp;gt;
  }

&lt;p&gt;  might be more readable as:&lt;/p&gt;

&lt;p&gt;  if (removeSYSIBMonly &amp;amp;&amp;amp; !isSYSIBM) &lt;/p&gt;
{
       // do nothing
  }
&lt;p&gt; else &lt;/p&gt;
{
       &amp;lt;do something&amp;gt;
  }

&lt;ul&gt;
	&lt;li&gt;Some comments mention only metadata.properties which should now&lt;br/&gt;
    also mention metadata_net.properties, e.g. on ca line 3339:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    //Can&apos;t use stored prepared statements because we are in soft upgrade&lt;br/&gt;
    //mode and hence need to get metadata sql from metadata.properties file &lt;/p&gt;

&lt;p&gt;    Similarly, the javadoc for getPreparedQuery also mentions&lt;br/&gt;
    metadata.properties in its description, but only introduces&lt;br/&gt;
    metadata_net.properties when explaining the parameters. There are&lt;br/&gt;
    other similar instances.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Specialized version (non-client) of getPreparedQuery and&lt;br/&gt;
    getSimpleQuery have been introduced with protected visibility.&lt;br/&gt;
    The general ones can now be made private (at least for now).&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12375381" author="knutanders" created="Thu, 20 Apr 2006 23:26:07 +0100"  >&lt;p&gt;Thanks, Dag and &#216;ystein, for your comments! I have uploaded a new patch with the modifications you suggested. Since I had problems deciding which elegant rewrite of the if statement I should choose, I chose a hybrid and added comments to clarify.&lt;/p&gt;

&lt;p&gt;The upgrade test still runs cleanly, and my manual test of the client/metadata issue passes too. Have started a derbyall run now, just in case. If there are no more comments, I will commit the patch tomorrow.&lt;/p&gt;</comment>
                            <comment id="12375503" author="knutanders" created="Fri, 21 Apr 2006 15:07:06 +0100"  >&lt;p&gt;Committed revision 395799.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12325036" name="derby-1176-v1.diff" size="13620" author="knutanders" created="Fri, 7 Apr 2006 17:36:09 +0100"/>
                            <attachment id="12325037" name="derby-1176-v1.stat" size="208" author="knutanders" created="Fri, 7 Apr 2006 17:36:10 +0100"/>
                            <attachment id="12325624" name="derby-1176-v2.diff" size="15528" author="knutanders" created="Thu, 20 Apr 2006 23:26:07 +0100"/>
                            <attachment id="12325625" name="derby-1176-v2.stat" size="301" author="knutanders" created="Thu, 20 Apr 2006 23:26:07 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 19 Apr 2006 23:00:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22353</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy16p3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40735</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>