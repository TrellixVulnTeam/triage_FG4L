<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:45:49 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4664/DERBY-4664.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4664] Change Derby internal stored procedures to avoid DriverManager.getConnection(&quot;jdbc:default:connection&quot;) as it may be recognized by other Drivers</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4664</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Some Derby internal Stored procedures and functions call DriverManager.getConnection(&quot;jdbc:default:connection&quot;); and this url can be recognized by another Driver in the same classpath that is used for server side JDBC for another product. For example the below occurred in NetworkServer when JCC was also loaded because the JCC Type 2 driver is used for server side JDBC:&lt;/p&gt;

&lt;p&gt;java.lang.UnsatisfiedLinkError:        &lt;br/&gt;
db2jcct2 (Not found in java.library.path):  ERRORCODE=-4472, SQLSTATE=null&lt;br/&gt;
com.ibm.db2.jcc.b.SqlException&lt;br/&gt;
        at com.ibm.db2.jcc.b.bd.a(bd.java:660)&lt;br/&gt;
        at com.ibm.db2.jcc.b.bd.a(bd.java:60)&lt;br/&gt;
        at com.ibm.db2.jcc.b.bd.a(bd.java:94)&lt;br/&gt;
        at com.ibm.db2.jcc.t2.a.a(a.java:37)&lt;br/&gt;
        at com.ibm.db2.jcc.t2.T2Configuration.&amp;lt;clinit&amp;gt;(T2Configuration.java:94)&lt;br/&gt;
        at java.lang.J9VMInternals.initializeImpl(Native Method)&lt;br/&gt;
        at java.lang.J9VMInternals.initialize(J9VMInternals.java:196)&lt;br/&gt;
        at com.ibm.db2.jcc.DB2Driver.connect(DB2Driver.java:211)&lt;br/&gt;
        at java.sql.DriverManager.getConnection(DriverManager.java:572)&lt;br/&gt;
        at java.sql.DriverManager.getConnection(DriverManager.java:218)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.LOBStoredProcedure.getEmbedConnection(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.LOBStoredProcedure.getClobObjectCorrespondingtoLOCATOR(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.LOBStoredProcedure.CLOBGETLENGTH(Unknown Source)&lt;br/&gt;
        at org.apache.derby.exe.acf81e0010x0128x864dxbe82x00004c9b380d12.e0(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.services.reflect.DirectCall.invoke(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.RowResultSet.getNextRowCore(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedResultSet.next(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedCallableStatement.executeStatement(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAStatement.execute(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLSTTobjects(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLSTT(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)&lt;/p&gt;

&lt;p&gt;I think we can avoid this specific error by changing LobStoredProcedure (and perhaps other internal procedures)  to  use the code in  SystemProcedures.getDefaultConn() which always connects to Derby by using = InternalDriver.activeDriver()&lt;/p&gt;

&lt;p&gt;This of course will not solve the general problem for any user created procedure or function that performs SQL.  I am not sure if there is a good solution for that.  I asked the JCC Driver team to see if there is a way they can determine if they are running inside the DB2 process or not. but regardless of these product workarounds I think the basic problem is design flaw in the specification.  DriverManager cannot differentiate the URL if all database products use the same one for server side JDBC.&lt;/p&gt;






</description>
                <environment></environment>
        <key id="12464844">DERBY-4664</key>
            <summary>Change Derby internal stored procedures to avoid DriverManager.getConnection(&quot;jdbc:default:connection&quot;) as it may be recognized by other Drivers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kmarsden">Kathey Marsden</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 May 2010 00:56:12 +0100</created>
                <updated>Wed, 12 Jan 2011 22:24:40 +0000</updated>
                            <resolved>Wed, 26 May 2010 01:21:26 +0100</resolved>
                                    <version>10.1.3.1</version>
                    <version>10.2.2.0</version>
                    <version>10.3.3.0</version>
                    <version>10.4.2.0</version>
                    <version>10.5.3.0</version>
                    <version>10.6.1.0</version>
                                    <fixVersion>10.3.3.1</fixVersion>
                    <fixVersion>10.4.2.1</fixVersion>
                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.2.1</fixVersion>
                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12869488" author="kmarsden" created="Thu, 20 May 2010 06:41:50 +0100"  >&lt;p&gt;Attached is a patch which fixes the internal procedures in LobStoredProcedures .  I could not find any Derby internal procedures that  use DriverManager with jdbc:default:connection.&lt;/p&gt;

&lt;p&gt;This fix does not solve the general issue of JCC hijacking the derby stored procedure connection for user procedures, but at least the internal procedures should not encounter the problem which I could reproduce simply by adding db2jcc4.jar (JCC 4.1) to my classpath and running the test jdbcapi.ClobStoredProcedureTest.&lt;/p&gt;
</comment>
                            <comment id="12869496" author="kristwaa" created="Thu, 20 May 2010 07:38:12 +0100"  >&lt;p&gt;The patch looks okay to me.&lt;br/&gt;
Note that the import of both Connection and DriverManager can be removed (they are unused).&lt;/p&gt;

&lt;p&gt;Other nits:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;one long line&lt;/li&gt;
	&lt;li&gt;blank line at the end of the method&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Interesting issue... &lt;/p&gt;</comment>
                            <comment id="12870233" author="kmarsden" created="Sat, 22 May 2010 00:49:32 +0100"  >&lt;p&gt;I backported this fix to 10.3 to meet urgent need there. I will take care of 10.6, 10.5, and 10.4 next week.&lt;/p&gt;</comment>
                            <comment id="12871456" author="kmarsden" created="Wed, 26 May 2010 01:21:26 +0100"  >&lt;p&gt;Fix checked into trunk and all branches back to 10.3. It looks like LOBStoredProcedure was not present in earlier releases so no  need to go back further.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12445026" name="derby-4664_diff.txt" size="1459" author="kmarsden" created="Thu, 20 May 2010 06:41:50 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 20 May 2010 06:38:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24394</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10422"><![CDATA[High Value Fix]]></customfieldvalue>
    <customfieldvalue key="10426"><![CDATA[Known fix]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0nwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37690</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>