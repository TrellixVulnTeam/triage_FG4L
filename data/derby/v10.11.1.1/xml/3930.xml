<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:33:28 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3930/DERBY-3930.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3930] SQL roles: Add VTI for CONTAINED_ROLES</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3930</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description></description>
                <environment></environment>
        <key id="12407415">DERBY-3930</key>
            <summary>SQL roles: Add VTI for CONTAINED_ROLES</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12359718">DERBY-2207</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Oct 2008 13:04:35 +0000</created>
                <updated>Thu, 13 Jan 2011 17:18:02 +0000</updated>
                            <resolved>Thu, 30 Oct 2008 22:27:10 +0000</resolved>
                                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12643481" author="dagw" created="Wed, 29 Oct 2008 13:19:25 +0000"  >&lt;p&gt;It can be useful to access the dictionary to see information about&lt;br/&gt;
what objects depend on granted roles (triggers, constraints,&lt;br/&gt;
views). An IDE might find it useful to show the user what roles&lt;br/&gt;
are contained in a given role (the grant closure). Since Derby does&lt;br/&gt;
not implement recursive queries, this cannot be done in a single&lt;br/&gt;
select without a VTI to get the closure. This issue tracks adding&lt;br/&gt;
SYSCS_DIAG.CONTAINED_ROLES. I propose to make a VTI with the following&lt;br/&gt;
API:&lt;/p&gt;

&lt;p&gt;     SYSCS_DIAG.CONTAINED_ROLES(&amp;lt;role identifier string&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;, &amp;lt;integer: if != 0, compute inverse&amp;#93;&lt;/span&gt;)&lt;/p&gt;

&lt;p&gt;It will be inclusive, i.e. the given role will be part of the result&lt;br/&gt;
set. As an example, the following ij query would show all persistent&lt;br/&gt;
objects that rely on on a role:&lt;/p&gt;


&lt;p&gt;prepare find_role_dependents as &apos;select objecttype, schemaname, tablename, name from  &lt;br/&gt;
 (&lt;br/&gt;
 &amp;#8211; show all constraints that depend on role, directly or indirectly&lt;br/&gt;
 select &apos;&apos;VIEW&apos;&apos;, cast(s.schemaname as varchar(20)), cast(t.tablename as varchar(20)), &lt;br/&gt;
 cast(null as varchar(20)), r.roleid from &lt;br/&gt;
 sys.sysdepends d, &lt;br/&gt;
 sys.sysroles r, &lt;br/&gt;
 sys.systables t, &lt;br/&gt;
 sys.sysschemas s where &lt;br/&gt;
 r.isdef=&apos;&apos;Y&apos;&apos; and &lt;br/&gt;
 r.uuid=d.providerid and t.tableid=d.dependentid and &lt;br/&gt;
 s.schemaid=t.schemaid &lt;br/&gt;
            UNION&lt;br/&gt;
 &amp;#8211; show all constraints that depend on role, directly or indirectly&lt;br/&gt;
 select &apos;&apos;CONSTRAINT&apos;&apos;, cast(s.schemaname as varchar(20)), cast(tab.tablename as varchar(20)), &lt;br/&gt;
 cast(t.constraintname as varchar(20)), r.roleid from &lt;br/&gt;
 sys.sysdepends d, &lt;br/&gt;
 sys.sysroles r, &lt;br/&gt;
 sys.sysconstraints t, &lt;br/&gt;
 sys.systables tab,&lt;br/&gt;
 sys.sysschemas s where &lt;br/&gt;
 r.isdef=&apos;&apos;Y&apos;&apos; and &lt;br/&gt;
 r.uuid=d.providerid and t.constraintid=d.dependentid and &lt;br/&gt;
 s.schemaid=t.schemaid and&lt;br/&gt;
 tab.tableid = t.tableid&lt;br/&gt;
            UNION&lt;br/&gt;
 &amp;#8211; show all triggers that depend on role, directly or indirectly&lt;br/&gt;
 select &apos;&apos;TRIGGER&apos;&apos;, cast(s.schemaname as varchar(20)), cast(tab.tablename as varchar(20)), &lt;br/&gt;
 cast(t.triggername as varchar(20)), r.roleid from &lt;br/&gt;
 sys.sysdepends d, &lt;br/&gt;
 sys.sysroles r, &lt;br/&gt;
 sys.systriggers t, &lt;br/&gt;
 sys.systables tab,&lt;br/&gt;
 sys.sysschemas s where &lt;br/&gt;
 r.isdef=&apos;&apos;Y&apos;&apos; and &lt;br/&gt;
 r.uuid=d.providerid and t.triggerid=d.dependentid and &lt;br/&gt;
 s.schemaid=t.schemaid and&lt;br/&gt;
 tab.tableid = t.tableid &lt;br/&gt;
 ) dt(objecttype, schemaname, tablename, name, roleid)&lt;br/&gt;
   WHERE dt.roleid in (select roleid from table(syscs_diag.contained_roles(?, 1))rt)&apos;;&lt;/p&gt;</comment>
                            <comment id="12643482" author="dagw" created="Wed, 29 Oct 2008 13:21:15 +0000"  >&lt;p&gt;Uploading a patch for this, and tests. Regressions (sane jars) ran ok.&lt;/p&gt;</comment>
                            <comment id="12643483" author="dagw" created="Wed, 29 Oct 2008 13:24:06 +0000"  >&lt;p&gt;Notice that the result contains role names that are in case normal form (useful when matching against dictionary as in the shown example), but the argument is a SQL identifier (not CNF).&lt;/p&gt;</comment>
                            <comment id="12643489" author="rhillegas" created="Wed, 29 Oct 2008 13:53:13 +0000"  >&lt;p&gt;Hi Dag,&lt;/p&gt;

&lt;p&gt;Thanks for the patch. It looks good to me. I noticed something which escaped my attention before: The is_show_roles_usr test is a recently added canon-based test. Is there any plan to replace this with a JUnit test?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="12643511" author="dagw" created="Wed, 29 Oct 2008 15:17:45 +0000"  >&lt;p&gt;Thanks for looking at this, Rick!&lt;br/&gt;
The &quot;ij_show*&quot; tests are driven from the JUnit test ToolScripts.java&lt;br/&gt;
I guess since this is partly ij tests, we do need to look at the output vs the canon.&lt;br/&gt;
Granted, the VTIs could be tested without using ij,&lt;br/&gt;
but the rest of the test (show &lt;span class=&quot;error&quot;&gt;&amp;#91;*_&amp;#93;&lt;/span&gt;roles) could not. It was just easier&lt;br/&gt;
to extend ToolScripts test with authorization (so that we can test the VTIs meaningfully)&lt;br/&gt;
than to extend SysDiagVTIMappingTest with authorization and users.&lt;br/&gt;
Do you think this acceptable?&lt;/p&gt;</comment>
                            <comment id="12643514" author="chaase3" created="Wed, 29 Oct 2008 15:26:10 +0000"  >&lt;p&gt;Would this involve a documentation change, specifically to &lt;a href=&quot;http://db.apache.org/derby/docs/dev/ref/rrefsyscsdiagtables.html?&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/docs/dev/ref/rrefsyscsdiagtables.html?&lt;/a&gt; If so, either it could be added to the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2207&quot; title=&quot;Improve usability of Derby&amp;#39;s client/server security by implementing ANSI Roles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2207&quot;&gt;&lt;del&gt;DERBY-2207&lt;/del&gt;&lt;/a&gt; spec, or one of us can file a separate JIRA.&lt;/p&gt;</comment>
                            <comment id="12643515" author="rhillegas" created="Wed, 29 Oct 2008 15:26:26 +0000"  >&lt;p&gt;Thanks for the explanation, Dag. This sounds ok to me.&lt;/p&gt;</comment>
                            <comment id="12643518" author="dagw" created="Wed, 29 Oct 2008 15:34:47 +0000"  >&lt;p&gt;Hi Kim, just uploaded version 10 of the spec to cover this addition.&lt;/p&gt;</comment>
                            <comment id="12643532" author="chaase3" created="Wed, 29 Oct 2008 17:07:17 +0000"  >&lt;p&gt;Thank you, Dag &amp;#8211; looks like most of the info I would need is in this JIRA (3930), so I can work from this.&lt;/p&gt;</comment>
                            <comment id="12644020" author="dagw" created="Thu, 30 Oct 2008 16:30:04 +0000"  >&lt;p&gt;Uploading version 2 of this patch, which&lt;br/&gt;
also removes SYSCS_DIAG.ENABLED_ROLES in favor of just&lt;br/&gt;
SYSCS_DIAG.CONTAINED_ROLES, since the former is equivalent to&lt;br/&gt;
SYSCS_DIAG.CONTAINED_ROLES(CURRENT_ROLE). To keep&lt;br/&gt;
API economy, I think it is better to make do with just the one VTI.&lt;/p&gt;

&lt;p&gt;The ij command &quot;show enabled_roles&quot; is retained, but its implementation&lt;br/&gt;
now uses SYSCS_DIAG.CONTAINED_ROLES instead.&lt;/p&gt;</comment>
                            <comment id="12644063" author="rhillegas" created="Thu, 30 Oct 2008 18:21:40 +0000"  >&lt;p&gt;Hi Dag,&lt;/p&gt;

&lt;p&gt;The second patch looks simpler and more elegant. +1&lt;/p&gt;</comment>
                            <comment id="12644136" author="dagw" created="Thu, 30 Oct 2008 22:27:10 +0000"  >&lt;p&gt;Committed derby-3930-2 as svn 709266, closing.&lt;/p&gt;</comment>
                            <comment id="12644289" author="rhillegas" created="Fri, 31 Oct 2008 13:46:55 +0000"  >&lt;p&gt;Attaching and committing derby-3930-3-buildJars.diff. This fixes an error which I saw when building the jars. Touches the following files:&lt;/p&gt;

&lt;p&gt;M      tools/jar/extraDBMSclasses.properties&lt;/p&gt;

&lt;p&gt;Replaces EnabledRoles with ContainedRoles in the list of extra classes which should be pulled into derby.jar.&lt;/p&gt;</comment>
                            <comment id="12644311" author="dagw" created="Fri, 31 Oct 2008 14:52:41 +0000"  >&lt;p&gt;Thanks, Rick!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12392983" name="derby-3930-1.diff" size="22651" author="dagw" created="Wed, 29 Oct 2008 13:21:15 +0000"/>
                            <attachment id="12392984" name="derby-3930-1.stat" size="651" author="dagw" created="Wed, 29 Oct 2008 13:21:15 +0000"/>
                            <attachment id="12393074" name="derby-3930-2.diff" size="24300" author="dagw" created="Thu, 30 Oct 2008 16:30:04 +0000"/>
                            <attachment id="12393075" name="derby-3930-2.stat" size="706" author="dagw" created="Thu, 30 Oct 2008 16:30:04 +0000"/>
                            <attachment id="12393153" name="derby-3930-3-buildJars.diff" size="753" author="rhillegas" created="Fri, 31 Oct 2008 13:46:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 29 Oct 2008 13:53:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31063</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0nsn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37673</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>