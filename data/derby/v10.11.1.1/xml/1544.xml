<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:12:19 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1544/DERBY-1544.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1544] Address remaining upgrade task(s) to complete full upgrade mechanism for GRANT/REVOKE, specifically with changing database owner name from &apos;DBA&apos; to authorizationId of user invoking upgrade.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1544</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Upgrading a database from 10.1 to 10.2 should automatically change database owner, recorded as owner of system schemas in sysschemas, from pseudo user &apos;DBA&apos; to authorizationID of the user attempting upgrade. &lt;/p&gt;

&lt;p&gt;Another upgrade change I am thinking about is to grant execute privilege to 5 system routines that by default have execute privilege to public when a new database is created. Five system routines, two compress routines and three statistics related routines are given execute privilege to public when a new 10.2 database is created. This is not done when a 10.1 database is upgraded to 10.2 and probably good to include these privileges during database upgrade.&lt;/p&gt;
</description>
                <environment>generic</environment>
        <key id="12346316">DERBY-1544</key>
            <summary>Address remaining upgrade task(s) to complete full upgrade mechanism for GRANT/REVOKE, specifically with changing database owner name from &apos;DBA&apos; to authorizationId of user invoking upgrade.</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12312336">DERBY-464</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="deepa">Deepa Remesh</assignee>
                                    <reporter username="bandaram">Satheesh Bandaram</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Jul 2006 02:12:32 +0100</created>
                <updated>Thu, 13 Dec 2007 09:05:04 +0000</updated>
                            <resolved>Tue, 8 Aug 2006 21:01:30 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12423717" author="bandaram" created="Wed, 26 Jul 2006 21:49:49 +0100"  >&lt;p&gt;Changes to update database owner is already present in Derby upgrade process.... it seems there is a defect that is either not committing this transaction during upgrade or starting transaction wrongly. Stepping through the code sometime ago, noticed upgrade does invoke this internal mechanism to update &apos;DBA&apos; as the owner of system schemas to authorizationID of the invoker of upgrade, but probably because of wrong internal transaction semantics, the change doesn&apos;t seem to get committed.&lt;/p&gt;

&lt;p&gt;For the second part of the sub-task, full upgrade needs to add 5 routine perm descriptors that allow GRANTing of EXECUTE privilege to 5 system routines that by default have execute access. This code needs to be added, much like code that adds 5 system routine permission descriptors during a NEW database creation.&lt;/p&gt;
</comment>
                            <comment id="12425360" author="deepa" created="Wed, 2 Aug 2006 20:50:51 +0100"  >&lt;p&gt;Attaching a draft patch &apos;d1544-patch1-draft.diff&apos; for the first part of this sub-task - Upgrading a database from 10.1 to 10.2 should automatically change database owner, recorded as owner of system schemas in sysschemas, from pseudo user &apos;DBA&apos; to authorizationID of the user attempting upgrade.&lt;/p&gt;

&lt;p&gt;This was being done in DataDictionaryImpl.updateSchemaAuth method. I think a wrong index was being used in the call to updateRow. Also the SCHEMAAID column which we are changing is not part of any index in SYSSCHEMAS. So there is no need to update any index.&lt;/p&gt;

&lt;p&gt;With this patch, I tested that after upgrade, the authorization id for the system schemas get changed to that of the user invoking upgrade. I have to create a regression test and also run more tests with this. Meantime, any feedback is appreciated. &lt;/p&gt;</comment>
                            <comment id="12425392" author="deepa" created="Wed, 2 Aug 2006 23:30:42 +0100"  >&lt;p&gt;Attaching a patch &apos;d1544-patch1-v1.diff&apos; which is same as the draft patch + a test. This patch solves the first part of this sub-task. &lt;/p&gt;

&lt;p&gt;This patch modifies only DataDictionaryImpl.updateSchemaAuth method which is used only in the upgrade path. Hence I have only run the upgrade test with this patch. I also verified that the newly added check in the test fails without the patch and passes with it.&lt;/p&gt;

&lt;p&gt;Please review/commit this patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="12425641" author="deepa" created="Fri, 4 Aug 2006 01:06:55 +0100"  >&lt;p&gt;Attaching a patch &apos;d1544-patch2-v1.diff&apos; for the second part of this sub-task - grant execute privilege to 5 system routines that by default have execute privilege to public when a new database is created.&lt;/p&gt;

&lt;p&gt;Changes are:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Adds a method &apos;grantPublicAccessToSystemRoutines&apos; to DataDictionaryImpl which is called when doing a full upgrade. This method goes through list of routines that needs to be granted public access and calls &apos;createRoutinePermPublicDescriptor&apos; for each routine. This is the same as the method that is called during database creation. It is slightly modified to allow specifying of an authorization id for the grantor. When upgrading, authorization id of user performing upgrade is used.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Adds a test to upgrade test to verify that the 5 system routines are added to the routine permissions table.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;With this patch, I ran the upgrade test successfully. derbyall is currently running. I&apos;ll post the results later.&lt;/p&gt;

&lt;p&gt;Please note patch1 is also pending review/commit. I would appreciate any feedback on these patches. &lt;/p&gt;</comment>
                            <comment id="12425767" author="deepa" created="Fri, 4 Aug 2006 16:05:11 +0100"  >&lt;p&gt;Ran derbyall with &apos;d1544-patch2-v1.diff&apos; using Sun jdk1.4.2 on Windows XP. No new failures.&lt;/p&gt;

&lt;p&gt;patch 1 and patch 2 are ready for review/commit. However, the files in patch 1 and patch 2 conflict with each other. So only one of these patches can be committed. They are independent patches and so any of these patches can be committed first. Later, I can sync up and upload an updated patch for the remaining part. Feedback on both patches appreciated.&lt;/p&gt;

</comment>
                            <comment id="12425848" author="djd" created="Fri, 4 Aug 2006 21:27:54 +0100"  >&lt;p&gt;Patch d1544-patch1-v1.diff committed revision 428872 - Thanks Deepa&lt;/p&gt;</comment>
                            <comment id="12425876" author="deepa" created="Fri, 4 Aug 2006 23:03:48 +0100"  >&lt;p&gt;Thanks Dan for committing patch 1.&lt;/p&gt;

&lt;p&gt;I am attaching &apos;d1544-patch2-v2.diff&apos;  after synchronizing to latest svn revision. No changes from &apos;d1544-patch2-v1.diff&apos;. Ran upgrade test successfully with this patch. Please take a look. Thanks.&lt;/p&gt;</comment>
                            <comment id="12425929" author="djd" created="Sat, 5 Aug 2006 04:35:25 +0100"  >&lt;p&gt;I&apos;ll commit the patch but I think a better test of if the routines have been granted permission by public to execute would be&lt;br/&gt;
to execute them by one or more users who is not the database owner. This is then testing the intended functionality rather&lt;br/&gt;
than a side effect.&lt;/p&gt;</comment>
                            <comment id="12425930" author="djd" created="Sat, 5 Aug 2006 04:46:04 +0100"  >&lt;p&gt;one question before I commit the change, the initial comments indicates that granting the execute permission to these five routines was done for create but not for upgrade. This change is addressing upgrade but seems to be adding new code. Is the code to grant permission for these routines shared between create and upgrade, or are there two separate mechanisms.?&lt;br/&gt;
for instance, I only see the method grantPublicAccessToSystemRoutines being called from doFullUpgrade. How are these permissions granted at create database time?&lt;/p&gt;</comment>
                            <comment id="12425967" author="deepa" created="Sat, 5 Aug 2006 16:30:52 +0100"  >&lt;p&gt;Thanks Dan for looking at patch 2. &lt;/p&gt;

&lt;p&gt;1) I agree a better test for this is to try executing of the system routines as a user other than database owner. This is being tested in lang/grantRevokeDDL.sql which I am planning to run from the upgrade test. I am trying to do this in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1521&quot; title=&quot;Upgrade test needs to be enhanced to test grant revoke&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1521&quot;&gt;&lt;del&gt;DERBY-1521&lt;/del&gt;&lt;/a&gt;. For now, I have verified this test passes on an upgraded database with this patch applied. It was failing before. &lt;/p&gt;

&lt;p&gt;2) Create and upgrade use the same basic mechanism to grant permissions to system routines. upgrade uses the method &quot;createRoutinePermPublicDescriptor&quot; which is the same method used during database creation. I had to slightly modify this method to allow specifying of an authorization id for the grantor. This is to allow using the authorization id of user performing upgrade as the grantor. &lt;/p&gt;

&lt;p&gt;In the upgrade path, I have added a wrapper method which gets the UUID of the five system routines and calls &quot;createRoutinePermPublicDescriptor&quot; on each of them. In the create path, there is no wrapper method as we get the UUID when we create the routine and directly call &quot;createRoutinePermPublicDescriptor&quot; immediately after creation of each routine. &lt;/p&gt;

&lt;p&gt;Though create and upgrade use same basic mechanism, I see there is a slight disconnect after this patch. I have introduced two lists &quot;sysUtilProceduresWithPublicAccess&quot; and &quot;sysUtilFunctionsWithPublicAccess&quot;. These are used only in upgrade path whereas in create path, we do not use these lists. I can submit a follow-up patch if it may be better to change the create path to use these lists. &lt;/p&gt;



</comment>
                            <comment id="12425968" author="djd" created="Sat, 5 Aug 2006 16:36:03 +0100"  >&lt;p&gt;Thanks for the follow up, if there are two lists for the same set of information thenit is pretty much guaranteed they will get out of sync leading to bugs.&lt;br/&gt;
If a single list is possible that should be done.&lt;/p&gt;</comment>
                            <comment id="12425981" author="deepa" created="Sat, 5 Aug 2006 18:16:59 +0100"  >&lt;p&gt;The lists are used only in upgrade path - one for functions and other for procedures. The create path is directly calling the method after creation of each routine.&lt;/p&gt;</comment>
                            <comment id="12425990" author="djd" created="Sat, 5 Aug 2006 20:32:58 +0100"  >&lt;p&gt;Patch d1544-patch2-v2.diff committed revision 429036 - Thanks Deepa&lt;/p&gt;</comment>
                            <comment id="12551377" author="fuzzylogic" created="Thu, 13 Dec 2007 09:05:04 +0000"  >&lt;p&gt;This issue has been resolved for over a year with no further movement. Closing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12338021" name="d1544-patch1-draft.diff" size="793" author="deepa" created="Wed, 2 Aug 2006 20:50:51 +0100"/>
                            <attachment id="12338028" name="d1544-patch1-v1.diff" size="3668" author="deepa" created="Wed, 2 Aug 2006 23:30:42 +0100"/>
                            <attachment id="12338029" name="d1544-patch1-v1.status" size="359" author="deepa" created="Wed, 2 Aug 2006 23:30:42 +0100"/>
                            <attachment id="12338110" name="d1544-patch2-v1.diff" size="8437" author="deepa" created="Fri, 4 Aug 2006 01:06:55 +0100"/>
                            <attachment id="12338111" name="d1544-patch2-v1.status" size="429" author="deepa" created="Fri, 4 Aug 2006 01:06:55 +0100"/>
                            <attachment id="12338190" name="d1544-patch2-v2.diff" size="8377" author="deepa" created="Fri, 4 Aug 2006 23:03:48 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 2 Aug 2006 19:50:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30043</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy105r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39676</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>