<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:49:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2066/DERBY-2066.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2066] DisconnectException: The DDM object 0x1232 is not supported following shutdown of embedded engine while network server is running</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2066</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Running all within the same JVM.&lt;br/&gt;
start network server using api&lt;br/&gt;
connect to database using client&lt;br/&gt;
close connection&lt;br/&gt;
shutdown engine (not network server) using jdbc:derby:;shutdown=true&lt;br/&gt;
connect to database using client - FAILS&lt;/p&gt;

&lt;p&gt;Caused by: org.apache.derby.client.am.DisconnectException: The DDM object 0x1232 is not supported.  The connection has been terminated.&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.doObjnsprmSemantics(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseCommonError(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseSecurityCheckError(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseSECCHKreply(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.readSecurityCheck(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.readSecurityCheckAndAccessRdb(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowSecurityCheckAndAccessRdb(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowUSRIDPWDconnect(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowConnect(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.ClientJDBCObjectFactoryImpl.newNetConnection(Unknown Source)&lt;br/&gt;
	... 33 more&lt;/p&gt;</description>
                <environment>JDK 142 windows</environment>
        <key id="12355196">DERBY-2066</key>
            <summary>DisconnectException: The DDM object 0x1232 is not supported following shutdown of embedded engine while network server is running</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Rick Hillegas</assignee>
                                    <reporter username="djd">Daniel John Debrunner</reporter>
                        <labels>
                            <label>derby_backport_reject_10_8</label>
                    </labels>
                <created>Thu, 9 Nov 2006 19:07:50 +0000</created>
                <updated>Mon, 17 Jun 2013 10:19:10 +0100</updated>
                            <resolved>Tue, 5 Apr 2011 19:46:42 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Network Client</component>
                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12448547" author="djd" created="Thu, 9 Nov 2006 19:08:38 +0000"  >&lt;p&gt;Will try  to add reproducible case to ShutDownDBWhenNSShutsDownTest since it is based upon the scenario there.&lt;/p&gt;</comment>
                            <comment id="12728564" author="knutanders" created="Wed, 8 Jul 2009 09:40:57 +0100"  >&lt;p&gt;Triaged for 10.5.2.&lt;/p&gt;</comment>
                            <comment id="13014656" author="rhillegas" created="Fri, 1 Apr 2011 16:06:15 +0100"  >&lt;p&gt;Attaching Test_2066.java, a repro for this problem.&lt;/p&gt;</comment>
                            <comment id="13014701" author="rhillegas" created="Fri, 1 Apr 2011 16:36:50 +0100"  >&lt;p&gt;The underlying problem seems to be that the EmbeddedDriver is not registered. According to the &quot;Shutting down the system&quot; section of the Developer&apos;s Guide, you have to re-register the EmbeddedDriver before re-connecting after an orderly shutdown. The problem goes away if you insert this statement before the second attempt to get a connection:&lt;/p&gt;

&lt;p&gt;Class.forName(org.apache.derby.jdbc.EmbeddedDriver).newInstance();&lt;/p&gt;

&lt;p&gt;The error message of course is utterly worthless.&lt;/p&gt;</comment>
                            <comment id="13014743" author="rhillegas" created="Fri, 1 Apr 2011 17:59:00 +0100"  >&lt;p&gt;Attaching derby-2066-01-aa-makeMessageIDaSQLState.diff. This results in a reasonable error message for this situation. I will run regression tests.&lt;/p&gt;

&lt;p&gt;I don&apos;t propose to commit this patch before creating the 10.8 branch. I would like to give people time to consider whether there are any problems with this solution:&lt;/p&gt;

&lt;p&gt;The worthless error message arises because the error condition creates a SQLException with no SQLState. In various places the network driver assumes that all SQLExceptions have SQLStates. In one place the network driver assumes that a SQLState will have exactly 5 characters. If these assumptions aren&apos;t true, then the protocol trips over NPEs and array bounds exceptions and coughs up the worthless error message seen in this bug report.&lt;/p&gt;

&lt;p&gt;Although I can fault the driver&apos;s graceless handling of violated assumptions, I think that it is reasonable to insist that all SQLExceptions have 5 character SQLStates.&lt;/p&gt;

&lt;p&gt;The &quot;unregistered driver&quot; error is raised twice in Derby code. In both cases it surfaces as a SQLException without a SQLState. The actual message handle for this error lives in MessageId.java. Comments in that class indicate that it is only for messages which DON&apos;T appear in SQLExceptions.&lt;/p&gt;

&lt;p&gt;I fixed the problem as follows:&lt;/p&gt;

&lt;p&gt;1) Moved the &quot;unregistered driver&quot; message from MessageId into SQLState. Along the way I gave it a new message handle and placed it in a block with other connection errors.&lt;/p&gt;

&lt;p&gt;2) Adjusted messages.xml accordingly.&lt;/p&gt;

&lt;p&gt;3) Changed the two places which raise this SQLException to also include the SQLState.&lt;/p&gt;

&lt;p&gt;If this seems like a reasonable way to ungarble this problem, then I think it would be worthwhile to examine MessageId to see if it contains other errors which are really surfacing as SQLExceptions. Those errors should get valid SQLStates and should move to SQLState.java too.&lt;/p&gt;


&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;----------&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/loc/messages.xml&lt;br/&gt;
M      java/shared/org/apache/derby/shared/common/reference/SQLState.java&lt;br/&gt;
M      java/shared/org/apache/derby/shared/common/reference/MessageId.java&lt;/p&gt;

&lt;p&gt;Make the &quot;unregistered driver&quot; error a SQLState rather than a MessageId.&lt;/p&gt;

&lt;p&gt;----------&lt;/p&gt;


&lt;p&gt;M      java/engine/org/apache/derby/jdbc/EmbeddedSimpleDataSource.java&lt;br/&gt;
M      java/engine/org/apache/derby/jdbc/AutoloadedDriver.java&lt;/p&gt;

&lt;p&gt;Include a SQLState in the &quot;unregistered driver&quot; SQLException.&lt;/p&gt;</comment>
                            <comment id="13014796" author="rhillegas" created="Fri, 1 Apr 2011 20:08:21 +0100"  >&lt;p&gt;The first rev of the patch showed a need to update ErrorCodeTest. Attaching a second rev of the patch which updates that test: derby-2066-01-ab-makeMessageIDaSQLState&lt;/p&gt;</comment>
                            <comment id="13015364" author="knutanders" created="Mon, 4 Apr 2011 12:44:30 +0100"  >&lt;p&gt;Hi Rick,&lt;/p&gt;

&lt;p&gt;It sounds reasonable to me to change this code so that the SQLExceptions have an SQLState. Perhaps not 08002, though, as that&apos;s reserved for &quot;connection name in use&quot;, if I read my copy of SQL:2003 correctly.&lt;/p&gt;

&lt;p&gt;Would it make sense to use Util.generateCsSQLException() instead of constructing a new SQLException directly? Then we&apos;d go through the exception factory and get the correct sub-class of SQLException.&lt;/p&gt;</comment>
                            <comment id="13016007" author="rhillegas" created="Tue, 5 Apr 2011 17:43:10 +0100"  >&lt;p&gt;Thanks, Knut. Those are good suggestions. Attaching a revised version of the patch, derby-2066-01-ac-makeMessageIDaSQLState.diff. I will run regression tests.&lt;/p&gt;

&lt;p&gt;This version makes the following changes:&lt;/p&gt;

&lt;p&gt;1) Uses Util.generateCsSQLException() to build the SQLException.&lt;/p&gt;

&lt;p&gt;2) Changes the SQLState to a form of 08006, the SQL Standard SQLState for connection failures.&lt;/p&gt;

&lt;p&gt;3) Updates the localizations to reflect the message id change.&lt;/p&gt;

&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/jdbc/EmbeddedSimpleDataSource.java&lt;br/&gt;
M      java/engine/org/apache/derby/jdbc/AutoloadedDriver.java&lt;br/&gt;
M      java/engine/org/apache/derby/loc/messages_de_DE.properties&lt;br/&gt;
M      java/engine/org/apache/derby/loc/messages_zh_CN.properties&lt;br/&gt;
M      java/engine/org/apache/derby/loc/messages_cs.properties&lt;br/&gt;
M      java/engine/org/apache/derby/loc/messages_ko_KR.properties&lt;br/&gt;
M      java/engine/org/apache/derby/loc/messages_pt_BR.properties&lt;br/&gt;
M      java/engine/org/apache/derby/loc/messages_es.properties&lt;br/&gt;
M      java/engine/org/apache/derby/loc/messages_fr.properties&lt;br/&gt;
M      java/engine/org/apache/derby/loc/messages_pl.properties&lt;br/&gt;
M      java/engine/org/apache/derby/loc/messages_hu.properties&lt;br/&gt;
M      java/engine/org/apache/derby/loc/messages_it.properties&lt;br/&gt;
M      java/engine/org/apache/derby/loc/messages_ja_JP.properties&lt;br/&gt;
M      java/engine/org/apache/derby/loc/messages.xml&lt;br/&gt;
M      java/engine/org/apache/derby/loc/messages_ru.properties&lt;br/&gt;
M      java/engine/org/apache/derby/loc/messages_zh_TW.properties&lt;br/&gt;
M      java/shared/org/apache/derby/shared/common/reference/SQLState.java&lt;br/&gt;
M      java/shared/org/apache/derby/shared/common/reference/MessageId.java&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/tests/lang/ErrorCodeTest.java&lt;/p&gt;</comment>
                            <comment id="13016073" author="rhillegas" created="Tue, 5 Apr 2011 19:46:42 +0100"  >&lt;p&gt;Tests passed cleanly. Committed derby-2066-01-ac-makeMessageIDaSQLState.diff at subversion revision 1089156.&lt;/p&gt;</comment>
                            <comment id="13086562" author="kmarsden" created="Wed, 17 Aug 2011 21:10:42 +0100"  >&lt;p&gt;marked derby_backport_reject_10_8 because of message changes,&lt;/p&gt;</comment>
                            <comment id="13685151" author="knutanders" created="Mon, 17 Jun 2013 10:19:10 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12503511">DERBY-5177</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12475230" name="Test_2066.java" size="1152" author="rhillegas" created="Fri, 1 Apr 2011 16:06:15 +0100"/>
                            <attachment id="12475239" name="derby-2066-01-aa-makeMessageIDaSQLState.diff" size="4685" author="rhillegas" created="Fri, 1 Apr 2011 17:59:00 +0100"/>
                            <attachment id="12475251" name="derby-2066-01-ab-makeMessageIDaSQLState.diff" size="5689" author="rhillegas" created="Fri, 1 Apr 2011 20:08:21 +0100"/>
                            <attachment id="12475503" name="derby-2066-01-ac-makeMessageIDaSQLState.diff" size="36815" author="rhillegas" created="Tue, 5 Apr 2011 17:43:10 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10365"><![CDATA[Crash]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 8 Jul 2009 08:40:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22866</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0e1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36095</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>