<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:13:54 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4526/DERBY-4526.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4526] A query (bug1) or a view (bug2) from a smaller db is at least order of magnitude slower than from a larger db despite indexes; the smalller db stores a subset of data stored in the larger db; the databases were created using the same script.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4526</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;See BugDemo.java in the attachment. Below is a code snippet. &lt;/p&gt;

&lt;p&gt;	public BugDemo()&lt;/p&gt;
	{
		/*
		 * BUG 1: Although Derby uses indexes, &quot;Hash table size = 31416&quot; (see small_derby1.log) is the suspect in case of small_db
		 */
		String sql = &quot;select f.file_id, f.name, f.is_directory from Files f, FileRestorePoints p where p.file_id=f.file_id&quot;
					+&quot; and p.restore_point_id=1 and f.parent_folder_id=?&quot;;
		demo(&quot;Bug1&quot;, large_db, sql); //no problem, 96547 rows, 8312 milliseconds on my PC
		demo(&quot;Bug1&quot;, small_db, sql); //too slow, 31416 rows, 504703 milliseconds on my PC, see small_derby1.log in the attachment
		
		/*
		 * BUG 2: Derby ignores indexes on table FileRestorePoints or rpTable when selecting from view &apos;rpView&apos; of small_db on tables
		 * (&apos;Files&apos;, &apos;FileRestorePoints&apos;, and &apos;rpTable&apos;) although indexes were created on each of the tables;
		 * 
		 *  but, in case of large_db, indexes are used properly (both databases were created from the same script)
		 */
		sql = &quot;select file_id, name, length, is_directory from rpView where parent_folder_id=?&quot;;
		demo(&quot;Bug2&quot;, large_db, sql); //no problem, 96547 rows, 13718 milliseconds on my PC
		demo(&quot;Bug2&quot;, small_db, sql); //too slow, 31416 rows, 204110 milliseconds on my PC, see small_derby2.log in the attachment
	}</description>
                <environment>see sysinfo.txt in the attachment</environment>
        <key id="12446719">DERBY-4526</key>
            <summary>A query (bug1) or a view (bug2) from a smaller db is at least order of magnitude slower than from a larger db despite indexes; the smalller db stores a subset of data stored in the larger db; the databases were created using the same script.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="pmichnik">Phil Michnik</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Jan 2010 19:21:01 +0000</created>
                <updated>Mon, 1 Feb 2010 09:46:32 +0000</updated>
                            <resolved>Mon, 1 Feb 2010 09:46:32 +0000</resolved>
                                    <version>10.5.3.0</version>
                                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12805501" author="pmichnik" created="Wed, 27 Jan 2010 13:22:10 +0000"  >&lt;p&gt;Unzip the attachment file &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4526&quot; title=&quot;A query (bug1) or a view (bug2) from a smaller db is at least order of magnitude slower than from a larger db despite indexes; the smalller db stores a subset of data stored in the larger db; the databases were created using the same script.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4526&quot;&gt;&lt;del&gt;DERBY-4526&lt;/del&gt;&lt;/a&gt; Bug Attachment.zip &lt;br/&gt;
See and run file BugDemo.java&lt;/p&gt;</comment>
                            <comment id="12805538" author="knutanders" created="Wed, 27 Jan 2010 15:33:35 +0000"  >&lt;p&gt;Do you also see this problem if you update the statistics for FILES and FILERESTOREPOINTS in the small database?&lt;/p&gt;

&lt;p&gt;call syscs_util.syscs_update_statistics(&apos;&amp;lt;SCHEMANAME&amp;gt;&apos;, &apos;FILES&apos;, null);&lt;br/&gt;
call syscs_util.syscs_update_statistics(&apos;&amp;lt;SCHEMANAME&amp;gt;&apos;, &apos;FILESTOREPOINTS&apos;, null);&lt;/p&gt;</comment>
                            <comment id="12805565" author="knutanders" created="Wed, 27 Jan 2010 16:42:03 +0000"  >&lt;p&gt;It looks like there are some files missing in the zip files:&lt;/p&gt;

&lt;p&gt;1) The BugDemo class refers to a DerbyDb class that&apos;s not included, so it doesn&apos;t compile.&lt;/p&gt;

&lt;p&gt;2) When I try to boot the databases in ij, I get this error message: ERROR XBM04: Collator support not available from the JVM for the database&apos;s locale &apos;en_US_caseinsensitive&apos;.&lt;/p&gt;</comment>
                            <comment id="12805613" author="philmichnik@hotmail.com" created="Wed, 27 Jan 2010 19:00:37 +0000"  >&lt;p&gt;I will resubmit it today. Thanks.&lt;/p&gt;
</comment>
                            <comment id="12805621" author="pmichnik" created="Wed, 27 Jan 2010 19:26:30 +0000"  >&lt;p&gt;1) BugDemo.java is updated to compile&lt;br/&gt;
2. en_US_caseinsensitive.jar should be placed into  JAVA_HOME&apos;s JRE\LIB\EXT to avoid message &quot;Collator support not available ...&quot;&lt;/p&gt;
</comment>
                            <comment id="12805934" author="knutanders" created="Thu, 28 Jan 2010 14:45:51 +0000"  >&lt;p&gt;Thanks Phil. I&apos;m getting closer, but I still get an error:&lt;/p&gt;

&lt;p&gt;java.sql.SQLException: Failed to start database &apos;large_db&apos;, see the next exception for details.&lt;br/&gt;
.&lt;br/&gt;
.&lt;br/&gt;
.&lt;br/&gt;
ERROR XBCXC: Encryption algorithm &apos;DES/CBC/NoPadding&apos; does not exist. Please check that the chosen provider &apos;default&apos; supports this algorithm.&lt;/p&gt;

&lt;p&gt;I see this with Sun&apos;s Java 6. What kind of JVM are you using? Have you installed some custom cryptography provider?&lt;/p&gt;</comment>
                            <comment id="12805998" author="philmichnik@hotmail.com" created="Thu, 28 Jan 2010 17:40:36 +0000"  >&lt;p&gt;Hi, Knut.&lt;br/&gt;
I used Eclipse with Sun&apos;s JVM (versions 4-6) for the derby development which &lt;br/&gt;
comes with default provider.&lt;br/&gt;
Use Eclipse or try to set more parameters for ij as following (I got them on &lt;br/&gt;
the Web, You might want to double check in case they do not help):&lt;/p&gt;

&lt;p&gt;dataEncryption=true;&lt;br/&gt;
bootPassword=&quot;derby_password&quot;;&lt;br/&gt;
encryptionProvider=com.sun.crypto.provider.SunJCE;&lt;br/&gt;
encryptionAlgorithm=DESede/CBC/NoPadding;&lt;/p&gt;

&lt;p&gt;If nothing works, let me know. I will redo the databases without encryption &lt;br/&gt;
then.&lt;/p&gt;
</comment>
                            <comment id="12806284" author="knutanders" created="Fri, 29 Jan 2010 08:39:51 +0000"  >&lt;p&gt;Sorry, my mistake... I set the java.ext.dirs property instead of copying the attached jar file into lib/ext, but that apparently prevented the JVM from loading the crypto jars it needed from lib/ext unless I also listed lib/ext in java.ext.dirs. Works now:&lt;/p&gt;

&lt;p&gt;Bug1 test start: large_db&lt;br/&gt;
Bug1 test end: large_db: elapsed 5618 millis&lt;/p&gt;

&lt;p&gt;Bug1 test start: small_db&lt;br/&gt;
Bug1 test end: small_db: elapsed 53488 millis&lt;/p&gt;

&lt;p&gt;Bug2 test start: large_db&lt;br/&gt;
Bug2 test end: large_db: elapsed 7824 millis&lt;/p&gt;

&lt;p&gt;Bug2 test start: small_db&lt;br/&gt;
Bug2 test end: small_db: elapsed 37766 millis&lt;/p&gt;</comment>
                            <comment id="12806318" author="knutanders" created="Fri, 29 Jan 2010 12:04:45 +0000"  >&lt;p&gt;Updating the statistics seems to help. I connected to the small_db database with ij and executed these statements:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; call syscs_util.syscs_update_statistics(&apos;APP&apos;, &apos;FILES&apos;, null);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; call syscs_util.syscs_update_statistics(&apos;APP&apos;, &apos;FILERESTOREPOINTS&apos;, null);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;/p&gt;

&lt;p&gt;Now, the demo runs faster with small_db than with large_db:&lt;/p&gt;

&lt;p&gt;Bug1 test start: large_db&lt;br/&gt;
Bug1 test end: large_db: elapsed 6063 millis&lt;/p&gt;

&lt;p&gt;Bug1 test start: small_db&lt;br/&gt;
Bug1 test end: small_db: elapsed 4476 millis&lt;/p&gt;

&lt;p&gt;Bug2 test start: large_db&lt;br/&gt;
Bug2 test end: large_db: elapsed 8115 millis&lt;/p&gt;

&lt;p&gt;Bug2 test start: small_db&lt;br/&gt;
Bug2 test end: small_db: elapsed 7870 millis&lt;/p&gt;

&lt;p&gt;The tuning guide contains more information about the problem with stale statistics: &lt;a href=&quot;http://db.apache.org/derby/docs/10.5/tuning/ctunstats46438.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/docs/10.5/tuning/ctunstats46438.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There&apos;s another issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3788&quot; title=&quot;Provide a zero-admin way of updating the statisitcs of an index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3788&quot;&gt;&lt;del&gt;DERBY-3788&lt;/del&gt;&lt;/a&gt;) tracking the work to get the statistics updated automatically when they become stale. I suggest we close this issue as a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3788&quot; title=&quot;Provide a zero-admin way of updating the statisitcs of an index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3788&quot;&gt;&lt;del&gt;DERBY-3788&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12806405" author="philmichnik@hotmail.com" created="Fri, 29 Jan 2010 17:40:37 +0000"  >&lt;p&gt;I agree.&lt;br/&gt;
Thank you.&lt;/p&gt;</comment>
                            <comment id="12828047" author="knutanders" created="Mon, 1 Feb 2010 09:46:32 +0000"  >&lt;p&gt;Closing as duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3788&quot; title=&quot;Provide a zero-admin way of updating the statisitcs of an index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3788&quot;&gt;&lt;del&gt;DERBY-3788&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12400682">DERBY-3788</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12431592" name="BugDemo.java" size="3645" author="pmichnik" created="Wed, 27 Jan 2010 19:26:30 +0000"/>
                            <attachment id="12431552" name="DERBY-4526 Bug Attachment.z01" size="10238976" author="pmichnik" created="Wed, 27 Jan 2010 13:08:52 +0000"/>
                            <attachment id="12431553" name="DERBY-4526 Bug Attachment.z02" size="10238976" author="pmichnik" created="Wed, 27 Jan 2010 13:09:38 +0000"/>
                            <attachment id="12431554" name="DERBY-4526 Bug Attachment.z03" size="10238976" author="pmichnik" created="Wed, 27 Jan 2010 13:10:21 +0000"/>
                            <attachment id="12431555" name="DERBY-4526 Bug Attachment.z04" size="10238976" author="pmichnik" created="Wed, 27 Jan 2010 13:11:06 +0000"/>
                            <attachment id="12431556" name="DERBY-4526 Bug Attachment.z05" size="10238976" author="pmichnik" created="Wed, 27 Jan 2010 13:11:53 +0000"/>
                            <attachment id="12431557" name="DERBY-4526 Bug Attachment.z06" size="10238976" author="pmichnik" created="Wed, 27 Jan 2010 13:12:40 +0000"/>
                            <attachment id="12431558" name="DERBY-4526 Bug Attachment.z07" size="10238976" author="pmichnik" created="Wed, 27 Jan 2010 13:14:01 +0000"/>
                            <attachment id="12431559" name="DERBY-4526 Bug Attachment.z08" size="10238976" author="pmichnik" created="Wed, 27 Jan 2010 13:14:52 +0000"/>
                            <attachment id="12431560" name="DERBY-4526 Bug Attachment.z09" size="10238976" author="pmichnik" created="Wed, 27 Jan 2010 13:16:06 +0000"/>
                            <attachment id="12431561" name="DERBY-4526 Bug Attachment.z10" size="10238976" author="pmichnik" created="Wed, 27 Jan 2010 13:16:59 +0000"/>
                            <attachment id="12431551" name="DERBY-4526 Bug Attachment.zip" size="7174615" author="pmichnik" created="Wed, 27 Jan 2010 13:07:54 +0000"/>
                            <attachment id="12431593" name="en_US_caseinsensitive.jar" size="1047" author="pmichnik" created="Wed, 27 Jan 2010 19:26:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>13.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10362"><![CDATA[Performance]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 27 Jan 2010 15:33:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24316</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ran:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38240</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>