<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:09:37 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-514/DERBY-514.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-514] Integrate upgrade tests into test suite</title>
                <link>https://issues.apache.org/jira/browse/DERBY-514</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Currently there are no upgrade tests in the derbyAll suite.&lt;/p&gt;

&lt;p&gt;The upgrade tests java/testing/org/apache/derbyTesting are run by script and require that the version to be tested by specified on the command line so that the classpath can be changed.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;runphases old_major old_minor old_engine new_engine&lt;br/&gt;
#&lt;/li&gt;
	&lt;li&gt;e.g.&lt;br/&gt;
#&lt;/li&gt;
	&lt;li&gt;runphases 10 0 c:/derby/10.0.2.1/lib c:/derby/trunk/jars/sane&lt;/li&gt;
&lt;/ol&gt;



&lt;p&gt;Perhaps this script can be rewritten in Java using class loaders and  previous Derby verssions such as 10.0 and 10.1 be checked in so that this testing can   be incorporated into the derbyAll test suite.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12313520">DERBY-514</key>
            <summary>Integrate upgrade tests into test suite</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="deepa">Deepa Remesh</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Aug 2005 23:03:55 +0100</created>
                <updated>Wed, 1 Jul 2009 00:55:08 +0100</updated>
                            <resolved>Wed, 7 Jun 2006 22:03:33 +0100</resolved>
                                    <version>10.1.2.1</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                            <comments>
                            <comment id="12319467" author="naka" created="Sat, 20 Aug 2005 23:33:05 +0100"  >&lt;p&gt;One of  problems is that this test needs database in previous version.&lt;/p&gt;

&lt;p&gt;Engine implementation of the version ,which are tested ,can not create database of previous vesion.&lt;br/&gt;
Then how to serve database in prevous version, which are upgraded in the test , must be considered.&lt;/p&gt;</comment>
                            <comment id="12358408" author="kmarsden" created="Thu, 24 Nov 2005 04:41:21 +0000"  >&lt;p&gt;I think that this will require that previous versions of Derby be checked into the codeline.&lt;br/&gt;
Then the tests will access the databases with the various versions.  I am not sure the best location for the jars to live.   Previous versions would be also be good to have for other tests such as client/server compatiblity tests.&lt;/p&gt;

&lt;p&gt;Also before rewriting these tests I think it would be good to have the  base upgrade infrastructure for 10.2.   I&apos;ll log a Jira isssue for that.&lt;/p&gt;</comment>
                            <comment id="12372050" author="deepa" created="Tue, 28 Mar 2006 10:47:50 +0100"  >&lt;p&gt;Attaching a patch &apos;derby-514-patch1-v1.diff&apos;. In the patch, I am trying to make the upgrade test run with &quot;RunTest&quot; in the test harness. I do not have a full solution for this yet and would appreciate any suggestions.&lt;/p&gt;

&lt;p&gt;Patch does the following:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Adds a property file with &quot;noSecurityManager=true&quot; because the upgrade test will require more permissions. A sub-task is open to make the test run with security manager.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Adds a sed file to sed out version information as the version is checked in the code itself.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Adds copyfiles.ant and a build file to allow copying of the new files. Also modifies testing/build.xml to include building of upgrade tests.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Modifies the master file UpgradeTest.out to remove all diffs.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;As RunTest does not allow taking parameters, I have used place holders (&amp;lt;LOCATION_OF_OLD_JARS&amp;gt; and &amp;lt;LOCATION_OF_NEW_JARS&amp;gt;) for the location of new and old jars in the test Upgrade_10_1_10_2.java  To run the test, these variables has to be changed to the location on the local machine. I am not comfortable with this solution and I am continuing work to avoid this. I had tried to pass these as propeties in jvmflags to the test harness but harness has problems with multilple properties in jvmflags. So here is what I am planning to do:&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;For new jars, I think we can get the location of jars from the classpath from which the test is run. This is currently done in the jvm class when tests are run with security manager. I am trying to see if I can use this existing code in some way.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;For old jars, they are planned to be checked into svn as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1049&quot; title=&quot;make existing derby release jars available for upgrade testing and client/server compatibility testing with derbyall&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1049&quot;&gt;&lt;del&gt;DERBY-1049&lt;/del&gt;&lt;/a&gt; and they will be avaialble in the svn workspace. But I do not know how the relative location of these jars can be obtained when running tests. Will these jars be included in the testing build ? Any ideas how else this can be done?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Some related things I am working on:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Make the upgrade test run with classes folder in addition to the jars&lt;/li&gt;
	&lt;li&gt;Do not depend on the new version. Upgrade_10_1_10_2.java may not be useful once we branch out to 10.3. So I am trying to see if I can make the test not dependent on the new version.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;With this patch, the test Upgrade_10_1_10_2.java runs cleanly. But the test cannot be run directly without replacing the place holders in the code to point to the old and new version jar locations on the local machine. I would appreciate any suggestions to proceed with this task.&lt;/p&gt;</comment>
                            <comment id="12372117" author="rhillegas" created="Wed, 29 Mar 2006 02:21:14 +0100"  >&lt;p&gt;Hi Deepa,&lt;/p&gt;

&lt;p&gt;I think it would be OK for the testing instructions in README.htm to say something like the following:&lt;/p&gt;

&lt;p&gt;o You have to create a properties file which says where the old jars live.&lt;/p&gt;

&lt;p&gt;o You have to make that properties file visible on your classpath.&lt;/p&gt;

&lt;p&gt;If the upgrade test can&apos;t find the properties file, then it can error out with a diagnostic which tells the user how to correct the problem. For extra credit, the build script could generate this properties file in a canonical place (and the clobber target could delete it). If you go down that route, I would recommend against generating the file in the compiled classtree--I don&apos;t think you want environment-specific cruft finding its way into the standard jars.&lt;/p&gt;

&lt;p&gt;Just a suggestion...&lt;/p&gt;

&lt;p&gt;-Rick&lt;/p&gt;</comment>
                            <comment id="12372134" author="deepa" created="Wed, 29 Mar 2006 04:22:38 +0100"  >&lt;p&gt;Rick, Thanks for the suggestion. I have been trying something along similar lines but when I am running the test using the test harness, the test jvm does not see the system properties set on the command-line. I tried using jvmflags to pass in the properties to the test jvm but this allows only 1 property to be passed because of known limitation (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1091&quot; title=&quot;Test harness does not pass jvm flags properly if there are more than 1 property in jvm flags&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1091&quot;&gt;&lt;del&gt;DERBY-1091&lt;/del&gt;&lt;/a&gt;). I think we will have to first extract the location of new jars from the user&apos;s classpath (I&apos;m working on this now). Once this is done, I can try to pass in the old jar location in jvmflags property to the test jvm. Your idea of the build script generating a properties file with location of the old jars sounds good. I will think about how to do this. Thanks again for looking into this.&lt;/p&gt;

&lt;p&gt;Adding the upgrade test to the harness seems to be more involved task than what I expected. So I am planning to break the changes in derby-514-patch1-v1.diff into smaller patches and will attach them. Please note that derby-514-patch1-v1.diff is not ready for commit. However, I would appreciate any other feedback on it.&lt;/p&gt;</comment>
                            <comment id="12373207" author="deepa" created="Wed, 5 Apr 2006 08:51:51 +0100"  >&lt;p&gt;Attaching a patch &apos;derby-514-buildfiles-v1.diff&apos; which adds the build files for upgrade tests. This patch also adds the properties file for upgrade test which specifies not to run with security manager as more work is needed in this area (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1135&quot; title=&quot;Run upgrade test using a security manager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1135&quot;&gt;&lt;del&gt;DERBY-1135&lt;/del&gt;&lt;/a&gt;). &lt;/p&gt;

&lt;p&gt;This patch affects upgrade tests only. This is an incremental patch and does not resolve the issue fully. Please take a look at this patch. Thanks.&lt;/p&gt;
</comment>
                            <comment id="12373411" author="deepa" created="Thu, 6 Apr 2006 04:05:09 +0100"  >&lt;p&gt;Attaching a patch &apos;derby-514-patch2-runtest-v1.diff&apos; which enables the upgrade test to run with the test harness. &lt;/p&gt;

&lt;p&gt;Summary:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;findCodeBase method in harness/jvm.java is changed to public. This method is used by upgrade test to get the location of new jar files.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Adds the other derby jars to the jar file list in UpgradeTester. This will allow the test to run in client framework. I tried running the test in client framework and it looks like this will need new master file and some more work.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;In UpgradeTester, File.toURL method is used when creating class loader. This seems to be a better way to construct the URL.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Master file update&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This patch combined with the previous patch (derby-514-buildfiles-v1.diff) will allow the upgrade test to be run using RunTest. The location of old jars has to be passed in as a property in jvmflags. Command to run:&lt;br/&gt;
java -Djvmflags=-DderbyTesting.oldJarLocation=&amp;lt;location of 10.1 jars&amp;gt; org.apache.derbyTesting.functionTests.harness.RunTest upgradeTests/Upgrade_10_1_10_2.java&lt;/p&gt;

&lt;p&gt;I am working on making the build use a new property in ant.properties file and use it to generate a property file for the test. As this work is not fully done, I am posting this interim patch. Currently the upgrade test will run only with jar files. To be able to run with classes folder, we will have to modify the metadata test in 10.1. Also, createClassLoader method will need to be changed. &lt;/p&gt;

&lt;p&gt;I would appreciate if someone can look at the following patches which are waiting for review/commit:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;derby-514-buildfiles-v1.diff&lt;/li&gt;
	&lt;li&gt;derby-514-patch2-runtest-v1.diff&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12373441" author="kmarsden" created="Thu, 6 Apr 2006 08:27:25 +0100"  >&lt;p&gt; I checked in &lt;br/&gt;
derby-514-buildfiles-v1.diff :&lt;br/&gt;
Date: Wed Apr  5 13:56:27 2006&lt;br/&gt;
New Revision: 391806&lt;br/&gt;
URL: &lt;a href=&quot;http://svn.apache.org/viewcvs?rev=391806&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=391806&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;derby-514-patch2-runtest-v1.diff:&lt;br/&gt;
Date: Wed Apr  5 16:20:47 2006&lt;br/&gt;
New Revision: 391844&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewcvs?rev=391844&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=391844&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;My only comment is that I think that it would be good if the test printed out a clear failure message if the  classes are in the classpath instead of the jars instead of failing with a class not found message on TestUtil.&lt;/p&gt;




</comment>
                            <comment id="12373560" author="deepa" created="Fri, 7 Apr 2006 10:03:40 +0100"  >&lt;p&gt;Kathey, Thanks for committing the previous patches. I have noted your concern about error reporting but not yet made that change in this next patch. &lt;/p&gt;

&lt;p&gt;&apos;derby-514-patch3-v1.diff&apos; patch changes the build script to use a property which points to the location of old jars. With this change, it should be possible to run the upgrade test using RunTest without any additional command-line flags. It requires a property to be set in ant.properties which will be used at build time.&lt;/p&gt;

&lt;p&gt;Summary:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Changes the build to use a property derbyTesting.jar.path and use it&apos;s value for the location of the jar files from previous release. This property has to be set in ant.propeties and is optional. It is required to run the upgrade tests.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Updates building.txt with the information about new property&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;During build, the new property will be read and used to set the property in the test properties file. Currently, it sets a property in Upgrade_10_1_10_2_app.properties. This needs to be generalized as more upgrade combinations will be tested. But I am having trouble doing it in a separate property file as it does not get loaded by harness. I will continue to look into this.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Changes UpgradeTester to use the new property. UpgradeTester finds out the location of old and new jars and hence these need not be passed into the class.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I ran the upgrade test with and without setting &quot;derbyTesting.jar.path&quot; property and it works as expected. I have not yet tried with Andrew&apos;s changes for derby-1049. &lt;/p&gt;

&lt;p&gt;Please take a look at this patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="12373881" author="deepa" created="Tue, 11 Apr 2006 01:17:33 +0100"  >&lt;p&gt;Attaching patch4 &apos;derby-514-patch4-sed.diff&apos; which removes the version information from the canons for upgrade test. The version information is already checked inside the code - using method &apos;checkVersion&apos; in UpgradeTester. So there is no need for it to be in the canon.&lt;/p&gt;

&lt;p&gt;I tried using &quot;substitute&quot; of 10.1.x.x but since this is also used in other parts of test, it did not work.  So I had to use &quot;delete&quot; in the sed.properties file.&lt;/p&gt;

&lt;p&gt;I also tried running the test with the jars checked into svn by Andrew and it runs successfully. There is one small difference from what Andrew suggested in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1049&quot; title=&quot;make existing derby release jars available for upgrade testing and client/server compatibility testing with derbyall&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1049&quot;&gt;&lt;del&gt;DERBY-1049&lt;/del&gt;&lt;/a&gt;. Instead of mapping the svn:external to derby/10.1.1.0, I mapped it to derby/10.1.This way, we can run the test using different 10.1 versions by just changing this mapping. I entered the following in the editor opened by svn:external command:&lt;/p&gt;

&lt;p&gt;derby/10.1 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/jars/10.1.1.0&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/db/derby/jars/10.1.1.0&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;Then I specified the following in ant.properties file:&lt;/p&gt;

&lt;p&gt;derbyTesting.jar.path=C:/deepa/derby_src/workspace1/trunk, where the path points to the location of my svn workspace files for trunk.&lt;/p&gt;

&lt;p&gt;One thing I would like to bring to attention is that the current diff file has these lines:&lt;/p&gt;

&lt;p&gt;Property changes on: tools\testing&lt;br/&gt;
___________________________________________________________________&lt;br/&gt;
Name: svn:externals&lt;br/&gt;
   + derby/10.1 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/jars/10.1.1.0&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/db/derby/jars/10.1.1.0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I do not know if this will cause problems on other machines when applying this patch. I would appreciate if Andrew or someone else can confirm this is expected.&lt;/p&gt;

&lt;p&gt;Status of remaining patches pending review/commit:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;derby-514-patch3-v1.diff - Patch which changes the build to use the location of old jars from properties file&lt;/li&gt;
	&lt;li&gt;derby-514-patch4-sed.diff - Patch which updates the canon to remove version information&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Please take a look at the above two patches.&lt;/p&gt;

&lt;p&gt;Question:&lt;br/&gt;
I also tried running the patch as part of a suite. I created a new suite named &quot;upgrade&quot;. The test has no problems when run using RunSuite. Is this okay or should I just add the upgrade test to an existing suite like derbylang? If I don&apos;t get an answer, I will submit patch with upgrade test in a new suite.&lt;/p&gt;</comment>
                            <comment id="12373935" author="fuzzylogic" created="Tue, 11 Apr 2006 06:29:47 +0100"  >&lt;p&gt;The lines in the patch for setting the svn:externals property should not cause any problems when applying the patch, but the svn property won&apos;t be set by the patch program. Anyone applying the patch will need to edit the property themselves with &apos;svn propedit svn:externals tools/testing&apos; as you described.&lt;/p&gt;

&lt;p&gt;I think the upgrade tests should be in their own suite, that will make it easier to skip them if the conditions to run them are not satisfied (like availability of the old jars).&lt;/p&gt;

&lt;p&gt;I&apos;ll go ahead and commit the patch4-sed.diff, I&apos;m still looking at patch3.&lt;/p&gt;</comment>
                            <comment id="12373946" author="fuzzylogic" created="Tue, 11 Apr 2006 08:02:27 +0100"  >&lt;p&gt;Committed derby-514-patch4-sed.diff to trunk with revision 393111.&lt;/p&gt;</comment>
                            <comment id="12374271" author="deepa" created="Thu, 13 Apr 2006 08:05:12 +0100"  >&lt;p&gt;Attaching a patch &apos;derby-514-patch3-v2.diff&apos; for Andrews comments in derby-dev mail - &lt;a href=&quot;http://www.nabble.com/Re%3A-jira-Updated%3A-%28DERBY-514%29-Integrate-upgrade-tests-into-test-suite-p3854692.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/Re%3A-jira-Updated%3A-%28DERBY-514%29-Integrate-upgrade-tests-into-test-suite-p3854692.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This patch changes the build script to use a property which points to the location of old jars. With this change, it should be possible to run the upgrade test using RunTest without any additional command-line flags. &lt;/p&gt;

&lt;p&gt;------------------------------------------------------------------------------------------&lt;br/&gt;
For Andrew&apos;s comments:&lt;br/&gt;
------------------------------------------------------------------------------------------&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Changed the requirement for setting of derbyTesting.jar.path property. It needs to be set only if we are running tests on a different machine where the source files are not available. If we run tests from the machine where source files are available, the jars will e picked up from tools/testing/derby.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Added better error message for the class not found exceptions.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;I had tried to make this run with classes folder. The problem is that we may need to keep changing the metadata test in the older version to be able to test the upgrade. Currently, we are using the test classes (derbyTesting.jar) from new version in all cases. This separation is not possible when we use classes folder. I am not planning to work on this now. I am just focussing to get this test into a suite.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;------------------------------------------------------------------------------------------&lt;br/&gt;
Summary of patch:&lt;br/&gt;
------------------------------------------------------------------------------------------&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Changes the build to use a property derbyTesting.jar.path from ant.properties and use it&apos;s value for the location of the jar files from previous release. This property has to be set in ant.properties if the tests will be run on a non-development machine. If the test is run on the machine where the svn source files are available, it is not required to set this property. The jars checked into svn will be used.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Updates building.txt with the information about new property&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;During build, the new property will be read and used to set the property in the test properties file. Currently, it sets a property in Upgrade_10_1_10_2_app.properties. This needs to be generalized as more upgrade combinations will be tested. But I am having trouble doing it in a separate property file as it does not get loaded by harness. I will continue to look into this.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Changes UpgradeTester to use the new property. UpgradeTester finds out the location of old and new jars and hence these need not be passed into the class.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Adds better error reporting to UpgradeTester&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;------------------------------------------------------------------------------------------&lt;br/&gt;
Tests:&lt;br/&gt;
------------------------------------------------------------------------------------------&lt;br/&gt;
Ran the upgrade test in following scenarios:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&quot;derbyTesting.jar.path&quot; property not set and jars checked out from svn into tools/testing/derby/10.1. Test passed.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&quot;derbyTesting.jar.path&quot; property not set and jars not checked out from svn. Test failed with message asking to check settings&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&quot;derbyTesting.jar.path&quot; property set to a correct location. Test passed.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&quot;derbyTesting.jar.path&quot; property set to a wrong location. Test failed with message asking to check settings&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Ran the test using classes folder in class path . Test failed with message asking to check settings&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;------------------------------------------------------------------------------------------&lt;br/&gt;
Next step&lt;br/&gt;
------------------------------------------------------------------------------------------&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;If this patch is okay, I&apos;ll submit the patch which adds a new suite with this test and make it part of derbyall. I checked this has no problems when using RunSuite&lt;/li&gt;
	&lt;li&gt;As Andrew suggested in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1049&quot; title=&quot;make existing derby release jars available for upgrade testing and client/server compatibility testing with derbyall&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1049&quot;&gt;&lt;del&gt;DERBY-1049&lt;/del&gt;&lt;/a&gt;, &quot;When the upgrade tests are in place and working, we should commit the setting of this property to the repository so that all subversion clients fetch the jars needed by the upgrade tests.&quot; - This will avoid the manual step of setting svn:externals. As I mentioned previously, one small change from what is mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1049&quot; title=&quot;make existing derby release jars available for upgrade testing and client/server compatibility testing with derbyall&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1049&quot;&gt;&lt;del&gt;DERBY-1049&lt;/del&gt;&lt;/a&gt; is - Instead of mapping to derby/10.1.1.0, we need to map it to derby/10.1 since we plan to have tests only at 
{major version}
&lt;p&gt;.&lt;/p&gt;
{minor version}
&lt;p&gt; level.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Please take a look at this patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="12374551" author="fuzzylogic" created="Sat, 15 Apr 2006 02:08:14 +0100"  >&lt;p&gt;Committed derby-514-patch3-v2.diff with revision 394157. &lt;/p&gt;

&lt;p&gt;Two minor comments: it would be nice if the properties file that contains the derbyTesting.jar.path property did not update on every recompile. You should be able to use Ant&apos;s &amp;lt;uptodate&amp;gt; task to determine if the file has already been modified and skip modifying it again. Also, I noticed that you removed the assignment of the first two arguments in UpgradeTester.java without shifting the other indices, but is this class meant to be run standalone anymore? It doesn&apos;t appear to be the case anymore, and maybe the main method could be removed.&lt;/p&gt;</comment>
                            <comment id="12375196" author="rhillegas" created="Thu, 20 Apr 2006 04:42:33 +0100"  >&lt;p&gt;Committed change to BUILDING.txt which somehow dropped out of patch derby-514-patch3-v2.diff. Committed at subversion revision 395390.&lt;/p&gt;</comment>
                            <comment id="12375564" author="deepa" created="Fri, 21 Apr 2006 22:05:14 +0100"  >&lt;p&gt;Attaching a patch &apos;derby-514-patch5-addtoderbyall.diff&apos; which adds upgrade test to a suite and makes the upgrade suite part of derbyall. With this patch, I ran derbyall on Windows XP with Sun JDK 1.4.2 and checked that the upgrade test passed. No other failures other than the intermittent failure in lang/wisconsin.java. Please take a look at this patch.&lt;/p&gt;

&lt;p&gt;I would appreciate if a committer who commits this patch can send out an alert to the community with the below note:&lt;/p&gt;

&lt;p&gt;NOTE: &lt;br/&gt;
The pre-requisites to run upgrade tests:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;If the tests are run on a machine where the svn source is not available, a property &apos;derbyTesting.jar.path&apos; needs to be set in ant.properties file. Details are in Section 3.2 in BUILDING.txt.&lt;/li&gt;
	&lt;li&gt;Upgrade test runs only with jar files in classpath. It fails when run with classes folder in the classpath.&lt;/li&gt;
&lt;/ul&gt;




</comment>
                            <comment id="12376354" author="deepa" created="Wed, 26 Apr 2006 06:54:48 +0100"  >&lt;p&gt;I have one more patch &apos;derby-514-patch6-build_changes.diff&apos; which attempts to address Andrew&apos;s comments. In this patch, I tried to update the build file for upgrade test to use ant&apos;s uptodate task. However, once I clobber and rebuild, it does not update the property. I tried a few other combinations of targets but do not have it working in all cases. Andrew, do you have any suggestions to make this work in all cases? &lt;/p&gt;

&lt;p&gt;Please note  there is another patch &apos;derby-514-patch5-addtoderbyall.diff&apos;&apos; which is pending review/commit.&lt;/p&gt;
</comment>
                            <comment id="12377012" author="fuzzylogic" created="Sat, 29 Apr 2006 06:07:31 +0100"  >&lt;p&gt;Hi Deepa,&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a patch, patch7, which combines your patch5 and patch6 and includes a change to BUILDING.txt that describes the derbyTesting.jar.path for testers who aren&apos;t building from source. I led you down the wrong path with using uptodate, sorry about that, this patch also includes changes to generate the property file so it doesn&apos;t get regenerated on a recompile.&lt;/p&gt;

&lt;p&gt;Please review the patch. If everything looks good, I&apos;ll go ahead and commit.&lt;/p&gt;</comment>
                            <comment id="12377031" author="deepa" created="Sat, 29 Apr 2006 07:25:17 +0100"  >&lt;p&gt;Thanks Andrew for looking at the patch. I tried to apply your patch to my workspace. But I get problems in Upgrade_10_1_10_2_app.properties.&lt;br/&gt;
Does the patch intend to delete this file from svn and just create it during build? I&apos;ll try to apply it from outside Eclipse and will try it out.&lt;/p&gt;




</comment>
                            <comment id="12377034" author="fuzzylogic" created="Sat, 29 Apr 2006 07:31:09 +0100"  >&lt;p&gt;Yes, patch7 should delete that file. Changes made to the build.xml file were made so that the properties file is generated from the svn source directory if derbyTesting.jar.path is not set, or from the value of derbyTesting.jar.path if it has been set in ant.properties.&lt;/p&gt;</comment>
                            <comment id="12377249" author="deepa" created="Tue, 2 May 2006 01:06:11 +0100"  >&lt;p&gt;Hi Andrew, &lt;/p&gt;

&lt;p&gt;I still cannot get the patch file to automatically delete Upgrade_10_1_10_2_app.properties. So I manually deleted the file to try out the patch. Few minor comments:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;If someone updates the &quot;derbyTesting.jar.path&quot; in ant.properties file and rebuilds without running &quot;clobber&quot;, the Upgrade_10_1_10_2_app.properties will not get updated since it gets updated depending on output of &quot;available&quot; task. I tried to add the uptodate task along with this but then it does not work when I run &quot;clobber&quot; target before building. Again, I am not able to get a combination which works in all build cases.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;The file for new suite &quot;upgrade.runall&quot; is missing in the new combined patch.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Your additions to BUILDING.txt make it more clear. Should we add the information about the command-line option to testing/readme.html file too?&lt;/li&gt;
&lt;/ul&gt;


</comment>
                            <comment id="12377621" author="djd" created="Thu, 4 May 2006 04:15:39 +0100"  >&lt;p&gt;Deepa wrote:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Upgrade test runs only with jar files in classpath. It fails when run with classes folder in the classpath.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I do not think it is acceptable to have a test failing in derbyall when running with the classes folder.&lt;br/&gt;
This will cause too many folks to keep investigating this failure.&lt;br/&gt;
I would recommend committing this patch to create the suite but don&apos;t add the suite to derbyall.&lt;/p&gt;</comment>
                            <comment id="12377912" author="fuzzylogic" created="Fri, 5 May 2006 07:12:38 +0100"  >&lt;p&gt;Attaching updated patch7 addressing Deepa&apos;s and Dan&apos;s comments. I will commit this if there are no other objections.&lt;/p&gt;</comment>
                            <comment id="12377918" author="deepa" created="Fri, 5 May 2006 08:14:23 +0100"  >&lt;p&gt;updated patch7 looks good to me. I took a quick look at it and also tried running the upgrade suite. As before, I had to manually delete Upgrade_10_1_10_2_app.properties though I see that the file delete is specified in the diff file.&lt;/p&gt;</comment>
                            <comment id="12377932" author="fuzzylogic" created="Fri, 5 May 2006 09:14:59 +0100"  >&lt;p&gt;Committed patch7-v2 to trunk with revision 399907.&lt;/p&gt;</comment>
                            <comment id="12379094" author="deepa" created="Fri, 12 May 2006 00:23:20 +0100"  >&lt;p&gt;Attaching a patch &apos;derby-514-runwithclasses.diff&apos; which enables upgrade suite to run with classes folder. This patch will resolve this issue fully. This patch adds upgrade suite to derbyall and also removes the previous upgrade test folder which is not used now.&lt;/p&gt;

&lt;p&gt;Initially, I had thought the following to be an issue when running with classes folder: &lt;br/&gt;
&quot;Currently, we are using the test classes (derbyTesting.jar) from new version in all cases. This separation is not possible when we use classes folder.&quot; &lt;/p&gt;

&lt;p&gt;Now, I have added the whole classes folder from new version at the end of search path of the old class loader. This means any classes which are added in the new version but not present in the old version will be available to the old class loader. This may limit testing certain upgrade features. However, this will be caught by running the test with jar files where we have a clear separation.&lt;/p&gt;

&lt;p&gt;With this patch, I ran the upgrade suite with both sane jars and classes. I also ran derbyall with classes and checked that upgrade test passes. Tests run with Sun JDK1.4.2 on Windows XP. &lt;/p&gt;

&lt;p&gt;Please take a look at this patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="12412255" author="fuzzylogic" created="Thu, 18 May 2006 07:10:12 +0100"  >&lt;p&gt;Committed runwithclasses patch to trunk with revision 407396. Deepa, just curious, was there a reason that isJar is a boolean array with a single element instead of just a plain boolean?&lt;/p&gt;

&lt;p&gt;Also, I&apos;m currently reviewing Myrna&apos;s patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-892&quot; title=&quot;add mechanism for specifying policy file for individual function tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-892&quot;&gt;&lt;del&gt;DERBY-892&lt;/del&gt;&lt;/a&gt;. Once that is committed, it may be easier to get the upgrade tests running under the security manager by adding a policy file for the upgrade tests with the required permissions.&lt;/p&gt;</comment>
                            <comment id="12412257" author="deepa" created="Thu, 18 May 2006 07:22:06 +0100"  >&lt;p&gt;Andrew, Thanks for committing the patch. For your question &quot;was there a reason that isJar is a boolean array with a single element instead of just a plain boolean? &quot;&lt;/p&gt;

&lt;p&gt;I am re-using the harness method jvm.findCodeBase which takes a boolean array as a parameter. Not sure why it does that. It seems to be using only the first element in the method too. &lt;/p&gt;
</comment>
                            <comment id="12415144" author="deepa" created="Wed, 7 Jun 2006 22:01:42 +0100"  >&lt;p&gt;Unchecking patch available box as all patches for this issue have been committed. Thanks Kathey, Rick and Andrew.&lt;/p&gt;</comment>
                            <comment id="12415145" author="deepa" created="Wed, 7 Jun 2006 22:03:33 +0100"  >&lt;p&gt;Resolving issue as upgrade test runs as part of derbyall now.&lt;/p&gt;</comment>
                            <comment id="12418744" author="kmarsden" created="Sat, 1 Jul 2006 08:42:12 +0100"  >&lt;p&gt;Upgrade tests committed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12329429">DERBY-1049</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12324951" name="derby-514-buildfiles-v1.diff" size="6068" author="deepa" created="Wed, 5 Apr 2006 08:51:51 +0100"/>
                            <attachment id="12324952" name="derby-514-buildfiles-v1.status" size="322" author="deepa" created="Wed, 5 Apr 2006 08:51:51 +0100"/>
                            <attachment id="12324644" name="derby-514-patch1-v1.diff" size="245785" author="deepa" created="Tue, 28 Mar 2006 10:47:50 +0100"/>
                            <attachment id="12324645" name="derby-514-patch1-v1.status" size="622" author="deepa" created="Tue, 28 Mar 2006 10:47:50 +0100"/>
                            <attachment id="12324991" name="derby-514-patch2-runtest-v1.diff" size="48449" author="deepa" created="Thu, 6 Apr 2006 04:05:09 +0100"/>
                            <attachment id="12324992" name="derby-514-patch2-runtest-v1.status" size="362" author="deepa" created="Thu, 6 Apr 2006 04:05:09 +0100"/>
                            <attachment id="12325023" name="derby-514-patch3-v1.diff" size="10499" author="deepa" created="Fri, 7 Apr 2006 10:03:37 +0100"/>
                            <attachment id="12325024" name="derby-514-patch3-v1.status" size="418" author="deepa" created="Fri, 7 Apr 2006 10:03:38 +0100"/>
                            <attachment id="12325270" name="derby-514-patch3-v2.diff" size="14655" author="deepa" created="Thu, 13 Apr 2006 08:05:12 +0100"/>
                            <attachment id="12325271" name="derby-514-patch3-v2.status" size="536" author="deepa" created="Thu, 13 Apr 2006 08:05:12 +0100"/>
                            <attachment id="12325147" name="derby-514-patch4-sed.diff" size="4584" author="deepa" created="Tue, 11 Apr 2006 01:17:33 +0100"/>
                            <attachment id="12325148" name="derby-514-patch4-sed.status" size="289" author="deepa" created="Tue, 11 Apr 2006 01:17:33 +0100"/>
                            <attachment id="12325672" name="derby-514-patch5-addtoderbyall.diff" size="1356" author="deepa" created="Fri, 21 Apr 2006 22:05:14 +0100"/>
                            <attachment id="12325673" name="derby-514-patch5-addtoderbyall.status" size="263" author="deepa" created="Fri, 21 Apr 2006 22:05:14 +0100"/>
                            <attachment id="12325861" name="derby-514-patch6-build_changes.diff" size="3475" author="deepa" created="Wed, 26 Apr 2006 06:54:48 +0100"/>
                            <attachment id="12325862" name="derby-514-patch6-build_changes.status" size="281" author="deepa" created="Wed, 26 Apr 2006 06:54:48 +0100"/>
                            <attachment id="12326035" name="derby-514-patch7-andrew.diff" size="8168" author="fuzzylogic" created="Sat, 29 Apr 2006 06:07:31 +0100"/>
                            <attachment id="12326269" name="derby-514-patch7-v2.diff" size="15818" author="fuzzylogic" created="Fri, 5 May 2006 07:12:38 +0100"/>
                            <attachment id="12326570" name="derby-514-runwithclasses.diff" size="18872" author="deepa" created="Fri, 12 May 2006 00:23:20 +0100"/>
                            <attachment id="12326571" name="derby-514-runwithclasses.status" size="484" author="deepa" created="Fri, 12 May 2006 00:23:20 +0100"/>
                    </attachments>
                <subtasks>
                            <subtask id="12329754">DERBY-1075</subtask>
                            <subtask id="12329756">DERBY-1076</subtask>
                            <subtask id="12330528">DERBY-1135</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 20 Aug 2005 22:33:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29586</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0tv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38656</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>