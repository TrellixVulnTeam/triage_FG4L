<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:13:00 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-366/DERBY-366.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-366] In jdk13, when a connection transitions from global transaction to local transaction, its default holdability of HOLD_CURSORS_OVER_COMMIT is not restored.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-366</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;A connection in local transaction has a default holdability of HOLD_CURSORS_OVER_COMMIT. When this connection becomes part of a global transaction, Derby internally switches its holdability to CLOSE_CURSORS_AT_COMMIT (this is because in Derby, holdable cursors do not work with XA transactions). When this connection returns back to local transaction, its holdability should automatically get switched to HOLD_CURSORS_OVER_COMMIT. When running under jdk13, Derby does not perform the last step of restoring the connection holdability. I have attached a program to reporduce this behavior. If this program is run under jdk14, the holdability is restored as expected.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12311402">DERBY-366</key>
            <summary>In jdk13, when a connection transitions from global transaction to local transaction, its default holdability of HOLD_CURSORS_OVER_COMMIT is not restored.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mamtas">Mamta A. Satoor</assignee>
                                    <reporter username="mamtas">Mamta A. Satoor</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Jun 2005 15:25:55 +0100</created>
                <updated>Wed, 12 Apr 2006 03:19:53 +0100</updated>
                            <resolved>Wed, 12 Apr 2006 03:19:54 +0100</resolved>
                                    <version>10.0.2.1</version>
                                    <fixVersion>10.1.1.0</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12313685" author="mamtas" created="Wed, 15 Jun 2005 18:06:33 +0100"  >&lt;p&gt;Earlier reproducible test case had a minor problem with it. Reattching the reproducible case with some modifications.&lt;/p&gt;</comment>
                            <comment id="12313961" author="mamtas" created="Sat, 18 Jun 2005 17:55:31 +0100"  >&lt;p&gt;I have a patch to fix Derby-8 (Connection object gets created with un-supported holdability on getting Connection object from XAConnection &quot;inside&quot; the global transaction) and Derby-366 (In jdk13, when a connection transitions from global transaction to local transaction, its default holdability of HOLD_CURSORS_OVER_COMMIT is not restored.) The patch is attached to both Derby-8 and Derby-366.&lt;/p&gt;

&lt;p&gt;The fix for both these bugs was centered around fixing the holdability handling in BrokeredConnection.java This was because BrokeredConnection.java had no code for restoring the holdability of real connection object and no code for saving the current holdability state of real connection object. I put fix for both these issues in BrokeredConnection.java so that both jdk13 and jdk14+ environments will be handled correctly. Had to use reflection for this holdability work&lt;br/&gt;
because Connection.setHoldability and Connection.getHoldability methods are not available through JDK13 apis.&lt;/p&gt;

&lt;p&gt;svn stat &lt;br/&gt;
M      java\engine\org\apache\derby\iapi\jdbc\BrokeredConnection.java&lt;br/&gt;
M      java\engine\org\apache\derby\iapi\jdbc\BrokeredConnection30.java&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\store\xaOffline1.sql&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\store\xab2354.sql&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\jdbcapi\xaAnotherTest.sql&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\jdbcapi\xaSimplePositive.sql&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\jdbcapi\xaSimpleNegative.sql&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\jdbcapi\checkDataSource30.java&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\master\xaOffline1.out&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\master\xaSimplePositive.out&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\master\xab2354.out&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\master\xaSimpleNegative.out&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\master\xaAnotherTest.out&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\master\checkDataSource30.out&lt;/p&gt;

&lt;p&gt;Kathey, may be you can try this fix with Network Server and see if it resolves any related issues you had there?&lt;/p&gt;

&lt;p&gt;I have run the test suite and this fix has not caused any failures. Have changed some of the existing XA tests so that they can rely on correct holdability status inside and outside global transaction.&lt;/p&gt;

&lt;p&gt;If no comments from anyone, can a commiter please commit this patch?&lt;/p&gt;</comment>
                            <comment id="12314197" author="kmarsden" created="Wed, 22 Jun 2005 14:10:08 +0100"  >&lt;p&gt;Checked this in.&lt;br/&gt;
Transmitting file data ...............&lt;br/&gt;
Committed revision 191755.&lt;/p&gt;</comment>
                            <comment id="12314275" author="mamtas" created="Thu, 23 Jun 2005 10:10:26 +0100"  >&lt;p&gt;Fix committed by Kathey&lt;/p&gt;</comment>
                            <comment id="12374085" author="mamtas" created="Wed, 12 Apr 2006 03:16:22 +0100"  >&lt;p&gt;Need to mark correct fixin version for this Jira entry&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12310837" name="Derby8_Derby366_061805.txt" size="34274" author="mamtas" created="Sat, 18 Jun 2005 17:55:31 +0100"/>
                            <attachment id="12310758" name="mamta.java" size="7670" author="mamtas" created="Wed, 15 Jun 2005 18:06:33 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 22 Jun 2005 13:10:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21919</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy16tb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40754</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>