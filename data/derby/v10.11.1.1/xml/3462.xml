<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:28:20 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3462/DERBY-3462.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3462] Require new permissions in o.a.d.security.SystemPermission to allow control to Derby&apos;s JMX management and to ensure information is not leaked through JMX</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3462</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Plan is to implement proposal defined in:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://wiki.apache.org/db-derby/JMXSecurityExpectations#head-de15a7e9d474784775933965fe963b6ac46e7ad0&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/JMXSecurityExpectations#head-de15a7e9d474784775933965fe963b6ac46e7ad0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;E.g.&lt;/p&gt;

&lt;p&gt;jmxControl for the ability to call the operations on ManagementMBean.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12389518">DERBY-3462</key>
            <summary>Require new permissions in o.a.d.security.SystemPermission to allow control to Derby&apos;s JMX management and to ensure information is not leaked through JMX</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12344126">DERBY-1387</parent>
                                    <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="djd">Daniel John Debrunner</assignee>
                                    <reporter username="djd">Daniel John Debrunner</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Feb 2008 19:06:55 +0000</created>
                <updated>Fri, 21 Jan 2011 17:51:33 +0000</updated>
                            <resolved>Fri, 4 Apr 2008 14:50:07 +0100</resolved>
                                    <version>10.4.1.3</version>
                                    <fixVersion>10.4.1.3</fixVersion>
                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>JMX</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12572280" author="djd" created="Mon, 25 Feb 2008 22:32:56 +0000"  >&lt;p&gt;Added a comment to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2109&quot; title=&quot;System privileges&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2109&quot;&gt;DERBY-2109&lt;/a&gt; about changing the permission names &amp;amp; actions so that names represent objects and actions actions, which is the intention of the Permission class. A name like jmxControl represents an action (control) and a name (jmx).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2109?focusedCommentId=12572278#action_12572278&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DERBY-2109?focusedCommentId=12572278#action_12572278&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12578702" author="johnemb" created="Fri, 14 Mar 2008 11:56:10 +0000"  >&lt;p&gt;I must admit it is not easy to follow all the commits going on in this area (system permissions and JMX). I hope others are able to look at these changes as well, eventually.&lt;/p&gt;

&lt;p&gt;In the default server policy, the following is granted to derby.jar:&lt;/p&gt;

&lt;p&gt;  // Gives permission for jmx to be used against Derby but&lt;br/&gt;
  // only if JMX authentication is not being used.&lt;br/&gt;
  // In that case the application would need to create&lt;br/&gt;
  // a whole set of fine-grained permissions to allow specific&lt;br/&gt;
  // users access to MBeans and actions they perform.&lt;br/&gt;
  permission org.apache.derby.security.SystemPermission &quot;jmx&quot;, &quot;control&quot;;&lt;br/&gt;
  permission org.apache.derby.security.SystemPermission &quot;engine&quot;, &quot;monitor&quot;;&lt;br/&gt;
  permission org.apache.derby.security.SystemPermission &quot;server&quot;, &quot;monitor&quot;;&lt;/p&gt;

&lt;p&gt;Does this mean that these permissions serve no purpose if JMX authentication is enabled? Or are these permissions needed in addition to any user-specific fine-grained permissions in that case?&lt;br/&gt;
I have not studied the code in detail yet, but I&apos;m trying to understand the comments independently from that...&lt;/p&gt;


&lt;p&gt;Regarding permission usage, I don&apos;t think I fully understand the reasoning behind it, but I guess that is to be expected given the following sentence from the wiki:&lt;br/&gt;
&quot;Exact use for these various permissions may become clear as attributes and operations are added to MBeans (and new MBeans added).&quot;&lt;/p&gt;

&lt;p&gt;For others trying to understand this, here are some notes (ramblings) I&apos;ve made that may of interest:&lt;/p&gt;

&lt;p&gt;Control is defined as &quot;Permission to perform control actions through JMX on engine, server or jmx&quot;.&lt;br/&gt;
Monitor is defined as &quot;Permission to perform monitoring actions through JMX on engine and server&quot;.&lt;/p&gt;

&lt;p&gt;Reading the following NetworkServerMBean attributes require the (&quot;server&quot;, &quot;control&quot;) permission:&lt;/p&gt;

&lt;p&gt; DrdaHost&lt;br/&gt;
 DrdaPortNumber&lt;br/&gt;
 DrdaSecurityMechanism&lt;br/&gt;
 DrdaSSLMode&lt;br/&gt;
 DrdaTraceDirectory&lt;/p&gt;

&lt;p&gt;The rest of the actions require the &quot;monitor&quot; permission. Both permissions are granted to the network server in the default policy.&lt;/p&gt;

&lt;p&gt;I do understand that &quot;control&quot; is used for attributes that are deemed more security sensitive than others. Intuitively, though, I would say that &lt;b&gt;all&lt;/b&gt; the current NetworkServerMBean actions are monitoring actions, not control actions, but I guess I&apos;ll get over it...&lt;br/&gt;
I guess &quot;control&quot; seems more like a description of a role than a specific action at this point.&lt;/p&gt;

&lt;p&gt;If both permissions (&quot;control&quot; and &quot;monitor&quot;) are included for the network server in the default policy file, why don&apos;t we leave distinguishing between sensitive actions and non-sensitive actions to the admin? Admins may have different views of which actions are security sensitive and which are not...  I guess if JMX authentication is enabled this (fine-grained permission grants) is still possible...&lt;/p&gt;</comment>
                            <comment id="12578746" author="djd" created="Fri, 14 Mar 2008 14:12:20 +0000"  >&lt;p&gt;&amp;gt; Does this mean that these permissions serve no purpose if JMX authentication is enabled?&lt;br/&gt;
The basic policy file is just that, a basic policy. If the JMX authentication is being used then the application needs to use a specific policy file that grants permissions to specific users as required, it&apos;s simply out of scope for the basic policy.&lt;/p&gt;

&lt;p&gt;&amp;gt; If both permissions (&quot;control&quot; and &quot;monitor&quot;) are included for the network server in the default policy file, why don&apos;t we leave distinguishing between sensitive actions and non-sensitive actions to the admin? Admins may have different views of which actions are security sensitive and which are not...&lt;/p&gt;

&lt;p&gt;I don&apos;t understand what you are proposing here. The code has to be the place that indicates what permissions are required, that can&apos;t be set by an application. An application can only decide what permissions are granted.&lt;/p&gt;</comment>
                            <comment id="12578772" author="johnemb" created="Fri, 14 Mar 2008 14:41:05 +0000"  >&lt;p&gt;Let me rephrase the first question, I hope this is more clear:&lt;br/&gt;
If JMX authentication is enabled, and the custom policy file includes permissions for a specific user to perform a set of JMX actions, then are the above mentioned permissions still needed for derby.jar, or are they not?&lt;br/&gt;
I guess I could find out by experimenting and reading code, but I thought I might just as well ask.&lt;/p&gt;

&lt;p&gt;The last part I guess was part of an attempt to understand the relationship between the new system permissions and MBeanPermission. Again, I think experimenting and studying code would help me do this, but some more examples on the wiki or in the javadocs probably woldn&apos;t hurt either.&lt;/p&gt;

&lt;p&gt;By the way, if you have any thoughts on what kind of documentation (DITA) should/could be included in 10.4 for the JMX work, please add a comment to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3540&quot; title=&quot;Document the JMX management and monitoring functionality&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3540&quot;&gt;&lt;del&gt;DERBY-3540&lt;/del&gt;&lt;/a&gt;. I guess doc efforts would depend on whether or not this security work is going to be part of 10.4, and when it will stabilize.&lt;/p&gt;</comment>
                            <comment id="12578800" author="djd" created="Fri, 14 Mar 2008 15:15:16 +0000"  >&lt;p&gt;&amp;gt; If JMX authentication is enabled, and the custom policy file includes permissions for a specific user to perform a set of JMX actions, then are the above mentioned permissions still needed for derby.jar,&lt;/p&gt;

&lt;p&gt;It&apos;s standard Java permission use, which I didn&apos;t think I wanted to explain in a comment in an internal policy file &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The permission needs to be granted to protection domains on the stack including derby.jar, since that is the code executing the permission check.&lt;br/&gt;
When Java Subject based authentication is used then the permission must be granted to those subjects as well.&lt;/p&gt;

&lt;p&gt;So at one level it&apos;s hard to answer the question because I don&apos;t know what permissions are granted in the custom policy file.&lt;br/&gt;
E.g. this in the policy file (guide only not exact syntax)&lt;/p&gt;

&lt;p&gt;grant principal JMXPrincipal &quot;DAN&quot; &lt;/p&gt;
{
  permission SystemPermission &quot;jmx&quot;, &quot;control&quot;;
}

&lt;p&gt;grants jmx control permission for the DAN for all code bases, thus no additional grant would be required.&lt;/p&gt;

&lt;p&gt;The following would not be sufficient as the code calling into Derby (the system jmx code in some cases) does not have the required permission.&lt;br/&gt;
Even though it is system code the permission needs to be granted to the code and the Subject in each domain, and the Subject (containing JMXPrincipal DAN) is not granted permissions outside of the protection domain including derby.jar&lt;/p&gt;

&lt;p&gt;grant codebase &quot;file...derby.jar&quot; principal JMXPrincipal &quot;DAN&quot; &lt;/p&gt;
{
  permission SystemPermission &quot;jmx&quot;, &quot;control&quot;
}</comment>
                            <comment id="12578808" author="johnemb" created="Fri, 14 Mar 2008 15:27:34 +0000"  >&lt;p&gt;Thanks, that was just about the kind of details I was looking for &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I will try to refresh my Java security know-how soon - I think it is needed...&lt;/p&gt;</comment>
                            <comment id="12578811" author="djd" created="Fri, 14 Mar 2008 15:35:20 +0000"  >&lt;p&gt;At a higher level with the basic server policy (the one installed automatically when the server is run through NetworkServerControl.main) we have a number of choices, all controlled through permissions we grant in the basic policy. Here&apos;s the list of the choices with the current answer for trunk:&lt;/p&gt;

&lt;p&gt;Do we allow the basic policy to ...&lt;/p&gt;

&lt;p&gt;A) Register JMX Mbeans   - YES&lt;/p&gt;

&lt;p&gt;B) Allow Derby monitoring capabilities - YES&lt;/p&gt;

&lt;p&gt;C) Allow Derby control capabilities - YES&lt;/p&gt;

&lt;p&gt;D) Allow local  (via process id) jmx - YES&lt;/p&gt;

&lt;p&gt;E) Allow remote jmx - YES&lt;/p&gt;

&lt;p&gt;F) Allow authenticated jmx - NO &lt;/p&gt;

&lt;p&gt;G) Allow JVM monitoring - not sure - nothing is done to enable or disable it by derby.&lt;/p&gt;

&lt;p&gt;H) Allow JVM control - not sure - nothing is done to enable or disable it by derby.&lt;/p&gt;

&lt;p&gt;My decisions here are based off a discussion we had when you (John) added the permissions to register MBeans to the basic policy, I asked something along the lines of what scenarios were you trying to support.&lt;/p&gt;

&lt;p&gt;I think this ends up with a useful set of jmx functionality when using local jmx (process id based) monitoring (D=YES). Since this can only be performed by the same OS user that started the server having the full JMX control (C=YES) does not introduce any security concerns.&lt;/p&gt;

&lt;p&gt;E=YES may pose concerns, as with F=NO, it&apos;s only unauthenticated JMX that is supported. The trouble is that we cannot tell the difference (from the Derby code point of view) between local jmx and remote jmx no authentication. Thus if  D=YES then E=YES. However it is a conscious decision for an application to start remote un-authenticated JMX monitoring. If they make that choice, it&apos;s their problem.&lt;/p&gt;

&lt;p&gt;F=NO is because the only way it would work would be to grant all permissions to all JMXPrincipals, which seems way too open to me. The only control an application could have is through JMX authorization, which would limit JMX users to be read-write (get &amp;amp; set attributes, invoke operations) or read-only (get attributes only).&lt;/p&gt;

&lt;p&gt;G,H - I only just thought about &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12578822" author="djd" created="Fri, 14 Mar 2008 15:53:31 +0000"  >&lt;p&gt;&amp;gt; an attempt to understand the relationship between the new system permissions and MBeanPermission&lt;/p&gt;

&lt;p&gt;There is no relationship, they are independent permissions.&lt;/p&gt;

&lt;p&gt;It&apos;s a multi-step process for a jmx client using an MBean.&lt;/p&gt;

&lt;p&gt;1) Get a handle to an MBean. This requires MBeanPermission in various forms, depending on how the MBean is obtained. This is standard JMX, the permissions are described in the javadoc for MBeanServerConnection.&lt;/p&gt;

&lt;p&gt;2) Get/set an attribute or invoke an operation - This requires MBeanPermission in various different forms from step 1, e.g. the &quot;Invoke&quot; action on the target-name.&lt;/p&gt;

&lt;p&gt;Note MBeanPermission allows fine grained control, the target-name is the &lt;/p&gt;
{classname,field,ObjectName}
&lt;p&gt; for the MBean and supports patterns. Thus I can give a user the ability to only invoke a specific operation on a single DerbyMBean, or just get attributes on all Derby Mbeans, or only find VersionMBeans and perform gets on those, or access all Derby&apos;s Mbeans etc.&lt;/p&gt;

&lt;p&gt;3) Get a Derby attribute or invoke an operation - This requires the Derby permission specific to that capability, at the moment it&apos;s one form of SystemPermission. With future capabilities it might require a database level GRANT/REVOKE permission.&lt;/p&gt;

&lt;p&gt;Note that this mimics what the jmx does with its platform MBeans&lt;/p&gt;</comment>
                            <comment id="12578867" author="djd" created="Fri, 14 Mar 2008 17:40:15 +0000"  >&lt;p&gt;I&apos;m planning to merge the security related changes to the 10.4 branch so that 10.4 is not released with security issues related to JMX and to avoids future backwards compatibility issues.&lt;/p&gt;</comment>
                            <comment id="12583628" author="johnemb" created="Mon, 31 Mar 2008 11:51:12 +0100"  >&lt;p&gt;Assigned this issue to Dan since he has been actively working on this.&lt;/p&gt;</comment>
                            <comment id="12584595" author="johnemb" created="Wed, 2 Apr 2008 15:39:07 +0100"  >&lt;p&gt;I&apos;d like to mark &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1387&quot; title=&quot;Add JMX extensions to Derby&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1387&quot;&gt;&lt;del&gt;DERBY-1387&lt;/del&gt;&lt;/a&gt; (this issue&apos;s parent) as resolved for the 10.4 release. Code related to this issue has gone into both trunk and 10.4, but I don&apos;t know if there are plans to do more. Should this issue be converted to a standalone issue, or could it be considered resolved/fixed?&lt;/p&gt;</comment>
                            <comment id="12585530" author="johnemb" created="Fri, 4 Apr 2008 14:50:07 +0100"  >&lt;p&gt;My understanding is that the suggested changes have been committed to both trunk and the 10.4 branch, with the following revision numbers:&lt;/p&gt;

&lt;p&gt;Trunk: 635723, 636493, 636878&lt;br/&gt;
10.4 (merges):  637237, 637294&lt;/p&gt;

&lt;p&gt;Marking this issue as Resolved/Fixed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12390071">DERBY-3491</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12393760">DERBY-3614</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10361"><![CDATA[Security]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 14 Mar 2008 11:56:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30869</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ln3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37324</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>