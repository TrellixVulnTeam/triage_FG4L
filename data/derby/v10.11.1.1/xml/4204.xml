<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:44:49 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4204/DERBY-4204.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4204] Runtime statistics not collected on re-execution of statement</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4204</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Runtime statistics are only collected the first time an insert/update/delete statement is executed. The behaviour changed between Derby 10.2.2.0 and Derby 10.3.1.4, so this was likely introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-827&quot; title=&quot;Performance can be improved by re-using language ResultSets across Activation executions.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-827&quot;&gt;&lt;del&gt;DERBY-827&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Reported on derby-dev:&lt;br/&gt;
&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/db-derby-dev/200904.mbox/%3c8a0216de0904291334j4bc715c3s6d46fb65e5953659@mail.gmail.com%3e&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/db-derby-dev/200904.mbox/%3c8a0216de0904291334j4bc715c3s6d46fb65e5953659@mail.gmail.com%3e&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12424270">DERBY-4204</key>
            <summary>Runtime statistics not collected on re-execution of statement</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Apr 2009 09:15:45 +0100</created>
                <updated>Tue, 2 Feb 2010 10:04:56 +0000</updated>
                            <resolved>Mon, 18 May 2009 12:15:37 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.5.2.0</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12704528" author="knutanders" created="Thu, 30 Apr 2009 09:21:09 +0100"  >&lt;p&gt;Here&apos;s a script that reproduces the problem.&lt;/p&gt;

&lt;p&gt;With Derby 10.2.2.0, the last call to syscs_get_runtimestatistics returns the following:&lt;/p&gt;

&lt;p&gt;Statement Name: &lt;br/&gt;
	null&lt;br/&gt;
Statement Text: &lt;br/&gt;
	insert into t values 1&lt;br/&gt;
.&lt;br/&gt;
.&lt;br/&gt;
.&lt;/p&gt;

&lt;p&gt;With 10.3.1.4 (and later), it returns this:&lt;/p&gt;

&lt;p&gt;Statement Name: &lt;br/&gt;
	null&lt;br/&gt;
Statement Text: &lt;br/&gt;
	values syscs_util.syscs_get_runtimestatistics()&lt;br/&gt;
.&lt;br/&gt;
.&lt;br/&gt;
.&lt;/p&gt;


&lt;p&gt;The behaviour in 10.2.2.0 is the expected one, since the insert statement was the last one to be executed before syscs_get_runtimestatistics was called.&lt;/p&gt;

&lt;p&gt;Re-execution of select statements appears to work as expected.&lt;/p&gt;</comment>
                            <comment id="12706806" author="knutanders" created="Thu, 7 May 2009 12:22:47 +0100"  >&lt;p&gt;Attached is a patch that adds JUnit test cases that test collection of runtime statistics for SELECT, UPDATE, INSERT, DELETE, VALUES and CALL when re-executing a prepared statement. The test cases for SELECT and VALUES pass, the rest of them fail.&lt;/p&gt;</comment>
                            <comment id="12706888" author="bryanpendleton" created="Thu, 7 May 2009 14:33:03 +0100"  >&lt;p&gt;In the trunk, it would be neat if we could write a test case for this using the new XPLAIN tables feature.&lt;/p&gt;

&lt;p&gt;I don&apos;t think we want to do that for the base patch because it would then be hard to back-port the&lt;br/&gt;
patch to 10.5 and earlier.&lt;/p&gt;

&lt;p&gt;But if you let me know when you&apos;re done with the basic patch, I&apos;ll try writing a separate test-only&lt;br/&gt;
patch for the trunk which uses the XPLAIN tables feature to confirm this fix.&lt;/p&gt;</comment>
                            <comment id="12708019" author="knutanders" created="Mon, 11 May 2009 14:19:52 +0100"  >&lt;p&gt;Good idea, Bryan. I tested it in ij and saw that re-execution of a prepared insert statement resulted in only one row in SYSXPLAIN_STATEMENTS, whereas re-execution of a prepared select statement resulted in one row per execution, so it should be possible to test this bug with the XPLAIN tables too.&lt;/p&gt;</comment>
                            <comment id="12708408" author="knutanders" created="Tue, 12 May 2009 12:58:05 +0100"  >&lt;p&gt;First I thought we should reset the NoRowsResultSetImpl&apos;s dumpedStats flag, either in close() or when reopening the result set. But when I looked closer, I noticed that dumpedStats is only ever used in close(), and close() is short-circuited before we dump the stats if close() is called again before the result set is reopened. So I think we could just as well remove the flag and rely on the isOpen flag to protect against dumping the same stats multiple times.&lt;/p&gt;

&lt;p&gt;The attached patch (d4204.diff) removes the dumpedStats flag and makes close() always dump the stats if the result set is open. It also adds regression tests for this bug.&lt;/p&gt;

&lt;p&gt;All the regression tests passed.&lt;/p&gt;</comment>
                            <comment id="12708882" author="knutanders" created="Wed, 13 May 2009 11:59:44 +0100"  >&lt;p&gt;Committed the patch to trunk with revision 774281.&lt;/p&gt;

&lt;p&gt;Bryan, it should be OK to add a regression test based on XPLAIN to trunk now, either as part of this issue or as a separate issue.&lt;/p&gt;

&lt;p&gt;I&apos;ll leave this issue open until the fix has been backported.&lt;/p&gt;</comment>
                            <comment id="12709202" author="bryanpendleton" created="Thu, 14 May 2009 00:05:33 +0100"  >&lt;p&gt;Attached &apos;addXPLAINTest.diff&apos; is a patch proposal which augments the test&lt;br/&gt;
that Knut added to additionally verify that the SYSXPLAIN_STATEMENTS&lt;br/&gt;
table sees 5 distinct rows when the statement is executed 5 times.&lt;/p&gt;

&lt;p&gt;I verified (by re-introducing the bug in my environment) that prior to the&lt;br/&gt;
fix, the UPDATE, DELETE, and INSERT statements only saw 1 row in SYSXPLAIN_STATEMENTS,&lt;br/&gt;
while the SELECT and VALUES statements saw 5 rows, while with the&lt;br/&gt;
code change in place, all the statements capture 5 rows into SYSXPLAIN_STATEMENTS.&lt;/p&gt;

&lt;p&gt;As opposed to the rest of the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4204&quot; title=&quot;Runtime statistics not collected on re-execution of statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4204&quot;&gt;&lt;del&gt;DERBY-4204&lt;/del&gt;&lt;/a&gt; fix, this change should NOT be backported&lt;br/&gt;
to prior branches, because the XPLAIN tables feature is only present in the trunk.&lt;/p&gt;

&lt;p&gt;Please let me know of any comments on the patch. If it seems OK, I&apos;ll commit it to the trunk.&lt;/p&gt;</comment>
                            <comment id="12709421" author="bryanpendleton" created="Thu, 14 May 2009 15:59:20 +0100"  >&lt;p&gt;Revised the new test slightly to make it more compact, by issuing&lt;br/&gt;
a COUNT query and using JDBC.assertFullResultSet to check the result.&lt;/p&gt;</comment>
                            <comment id="12709436" author="knutanders" created="Thu, 14 May 2009 16:31:17 +0100"  >&lt;p&gt;Thanks for writing the test, Bryan! The test looks much better now that the boilerplate is removed. +1 to commit.&lt;/p&gt;

&lt;p&gt;(One microscopic nit: assertSingleValueResultSet() would simplify the code slightly compared to assertFullResultSet(). And there&apos;s a typo in a comment: s/caputured/captured/)&lt;/p&gt;</comment>
                            <comment id="12709447" author="bryanpendleton" created="Thu, 14 May 2009 16:55:01 +0100"  >&lt;p&gt;Committed the revised test to the trunk as svn revision 774830. I&apos;m not intending to do any further work on this issue.&lt;/p&gt;</comment>
                            <comment id="12709450" author="knutanders" created="Thu, 14 May 2009 16:59:21 +0100"  >&lt;p&gt;Merged the fix to the 10.5 branch and committed revision 774831.&lt;/p&gt;

&lt;p&gt;This fix is a candidate for back-porting to 10.4 and 10.3 as well since it&apos;s a regression. However, the test case doesn&apos;t compile since it uses a helper method not present on the 10.4 branch, so some manual intervention is needed in order to back-port it all the way.&lt;/p&gt;</comment>
                            <comment id="12710334" author="knutanders" created="Mon, 18 May 2009 12:15:37 +0100"  >&lt;p&gt;Marking the issue as resolved since the fix has been committed to trunk and to the 10.5 branch.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12327853">DERBY-827</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12408062" name="addXPLAINTest.diff" size="4380" author="bryanpendleton" created="Thu, 14 May 2009 00:05:33 +0100"/>
                            <attachment id="12408138" name="addXPLAINTestUsingCOUNT.diff" size="3949" author="bryanpendleton" created="Thu, 14 May 2009 15:59:20 +0100"/>
                            <attachment id="12407865" name="d4204.diff" size="5150" author="knutanders" created="Tue, 12 May 2009 12:58:05 +0100"/>
                            <attachment id="12406886" name="repro.sql" size="270" author="knutanders" created="Thu, 30 Apr 2009 09:21:09 +0100"/>
                            <attachment id="12407454" name="test.diff" size="3991" author="knutanders" created="Thu, 7 May 2009 12:22:47 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 7 May 2009 13:33:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24099</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0r7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38225</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>