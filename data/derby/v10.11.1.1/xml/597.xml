<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:43:38 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-597/DERBY-597.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-597] Enhance ij connect statement to work in J2ME/CDC/FP</title>
                <link>https://issues.apache.org/jira/browse/DERBY-597</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The connect statement in ij currently uses DriverManager class to get a connection and so does not work in J2ME environment. Currently in tests, the startJBMS method can optionally use DataSource to get a connection. This approach can be used in &apos;connect&apos; statement too. This change will allow more tests to be run in J2ME.&lt;/p&gt;</description>
                <environment>J2ME/CDC/FP</environment>
        <key id="12317538">DERBY-597</key>
            <summary>Enhance ij connect statement to work in J2ME/CDC/FP</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="deepa">Deepa Remesh</assignee>
                                    <reporter username="deepa">Deepa Remesh</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Oct 2005 01:57:26 +0100</created>
                <updated>Wed, 12 Jul 2006 03:09:29 +0100</updated>
                            <resolved>Wed, 1 Mar 2006 04:06:24 +0000</resolved>
                                    <version>10.1.2.1</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12331183" author="deepa" created="Tue, 4 Oct 2005 02:06:24 +0100"  >&lt;p&gt;The attached patch &apos;derby-597.diff&apos; enables &apos;connect&apos; statement to work in J2ME/CDC/FP. With this patch, &apos;connect&apos; statement with urls that do not start with the protocol name (jdbc&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; will work in J2ME. Changes are:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Modified org\apache\derby\impl\tools\ij\util.java to add a method getDataSourceConnection.&lt;/li&gt;
	&lt;li&gt;If ij.dataSource property is set and the url in the &apos;connect&apos; statement does start with &apos;jdbc:&apos;, call util.getDataSourceConnection from ij parser.&lt;/li&gt;
	&lt;li&gt;Removed J2ME excludes from 13 tests which pass with this patch. Some tests needed changes in the connect statement url.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Ran derbyall in J2SE (with Sun jdk 1.4.2 ) and J2ME (IBM&apos;s WCTME 5.7). No failures in J2SE. 1 known failure in J2ME.&lt;/p&gt;

&lt;p&gt;Please review/commit this patch.&lt;/p&gt;</comment>
                            <comment id="12332536" author="deepa" created="Thu, 20 Oct 2005 10:00:59 +0100"  >&lt;p&gt;Attaching patch &apos;derby-597-v2.diff&apos; for Dan&apos;s comments&lt;/p&gt;

&lt;p&gt;Summary of patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;If ij.dataSource property is set and the url in the &apos;connect&apos; statement does not start with &apos;jdbc:&apos;, ij calls util.getDataSourceConnection to get connection (instead of using DriverManager).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Added getDataSourceConnection(String dsName,String user,String password,String dbName,boolean firstTime) to util.java. This returns a connection using the data source passed in ij.dataSource property. This method is called by startJBMS in util.java and ConnectStatement() in ij. The parameter  firstTime indicates whether this method is called at start of test by startJBMS or by ConnectStatement.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;getDataSourceConnection method in turn calls setupDataSource which calls the set methods of data source. If firstTime=true, it uses values of ij.dataSource.* properties to set up the data source object. Otherwise, the properties ij.dataSource.databaseName and ij.dataSource.createDatabase are ignored. Instead, value of &apos;dbName&apos; parameter is used.  &lt;span class=&quot;error&quot;&gt;&amp;#91;In first version of this patch, parameter &amp;#39;firstTime&amp;#39; was called &amp;#39;create&amp;#39;&amp;#93;&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Removed J2ME excludes from 13 tests which pass with this patch. Some tests needed changes in the connect statement url and master files.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;-----------&lt;br/&gt;
Tests (on Windows XP):&lt;br/&gt;
-----------&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Ran derbyall with Sun JDK 1.4.2. 1 test failed - derbyall/storeall/storeall.fail:store/readlocks.sql. I ran this test again and it passed. The failure is not related to this change.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Ran derbyall with IBM WCTME 5.7 CDC/FP. 3 tests failed:&lt;br/&gt;
 derbyall/derbyall.fail:jdbcapi/characterStreams.java&lt;br/&gt;
 derbyall/derbyall.fail:jdbcapi/nullSQLText.java&lt;br/&gt;
 derbyall/storeall/storeall.fail:unit/T_RawStoreFactory.unit&lt;br/&gt;
Failures are not related to this change: characterStreams.java and nullSQLText.java fail because of some new additions to the tests by other patches. They can be made to pass in CDC with minor changes.  T_RawStoreFactory.unit has to be excluded from CDC. This test fails intermittently (almost every time) in CDC. I will submit a separate patch for these 3 tests.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12355661" author="kmarsden" created="Tue, 25 Oct 2005 08:30:57 +0100"  >&lt;p&gt;I was wondering about the &quot;firstTime&quot; logic.  I don&apos;t understand why we wouldn&apos;t want to setCreateDatabase if this is not the first connection.   If I had an ij&amp;gt; connect &apos;somenewdb;create=true&apos; and it was not my first connection, would it still get created?&lt;/p&gt;
</comment>
                            <comment id="12355675" author="deepa" created="Tue, 25 Oct 2005 09:34:02 +0100"  >&lt;p&gt;setCreateDatabase is called using the value in ij.dataSource.createDatabase property. But in connect statement, if a database needs to be created it will be specified as an attribute (create=true). Hence I am not calling setCreateDatabase in this case. So if there is a ij&amp;gt; connect &apos;somenewdb;create=true&apos; and it is not a first connection, database will get created because the URL has create=true in it. &lt;/p&gt;

&lt;p&gt;I am trying to use one method and a parameter to differentiate what values will be used to set up the data source. I tried to put more comments in this version of patch explaining what I am trying to do. Looks like I am not very successful at it which makes this approach not very intuitive.&lt;/p&gt;

&lt;p&gt;Other option that I can think of is to use 2 methods:&lt;br/&gt;
1. setupDataSoureFromProperties, which will use properties in ij.dataSource.* and can be called from startJBMS.&lt;br/&gt;
2. setupDataSourceFromUrl, which will use values in the URL and can be called from connectStatement. &lt;br/&gt;
If this sounds better, I can rework the patch. &lt;/p&gt;</comment>
                            <comment id="12355683" author="kmarsden" created="Tue, 25 Oct 2005 13:27:05 +0100"  >&lt;p&gt;OK, I think I understand the problem and your solution better now.&lt;/p&gt;

&lt;p&gt;I   think one method is fine  but I noticed that startJBMS calls this method with a null dbname.    So it might be clearer if  we got rid of  the firsttime parameter and   then just evaluated ij.dataSource.databaseName if dbName is null.     Maybe that would make clearer that we are connecting to the database set in the property  if  one was not specified in the connect.. &lt;/p&gt;

&lt;p&gt;As for ij.dataSource.createDatabase, why should we ignore it for  subsequent connects?&lt;/p&gt;

&lt;p&gt;Anyway I committed the change as it is a marked improvement to connect not working.&lt;br/&gt;
You can submit a followon patch for any additional  cleanup or clarification.&lt;/p&gt;

&lt;p&gt;Committed revision 328246.&lt;/p&gt;</comment>
                            <comment id="12368151" author="deepa" created="Wed, 1 Mar 2006 04:06:24 +0000"  >&lt;p&gt;Code changes committed as svn revision 328246. Documentation added as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-391&quot; title=&quot;Tools and Utilities guide does not document ij.datasource, ij.user, nor ij.password&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-391&quot;&gt;&lt;del&gt;DERBY-391&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12314977" name="derby-597-v2.diff" size="19281" author="deepa" created="Thu, 20 Oct 2005 10:00:59 +0100"/>
                            <attachment id="12314978" name="derby-597-v2.status" size="1924" author="deepa" created="Thu, 20 Oct 2005 10:00:59 +0100"/>
                            <attachment id="12314684" name="derby-597.diff" size="18824" author="deepa" created="Tue, 4 Oct 2005 02:06:24 +0100"/>
                            <attachment id="12314685" name="derby-597.status" size="1924" author="deepa" created="Tue, 4 Oct 2005 02:06:24 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 25 Oct 2005 07:30:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29623</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy15in:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40544</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>