<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:11:32 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2692/DERBY-2692.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2692] Client driver doesn&apos;t chain exceptions received from the server</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2692</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When the client driver receives a chain of exceptions from the server, it generates one exception with the messages from all the server-side exceptions concatenated into one message. No next-exception chain is set up on the client. See the description of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1440&quot; title=&quot;jdk 1.6 client driver omits SQLStates and chained exceptions in error messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1440&quot;&gt;&lt;del&gt;DERBY-1440&lt;/del&gt;&lt;/a&gt; for an example.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12370202">DERBY-2692</key>
            <summary>Client driver doesn&apos;t chain exceptions received from the server</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 May 2007 20:35:05 +0100</created>
                <updated>Mon, 18 Jun 2007 15:45:51 +0100</updated>
                            <resolved>Fri, 1 Jun 2007 09:39:22 +0100</resolved>
                                    <version>10.2.1.6</version>
                    <version>10.2.2.0</version>
                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>JDBC</component>
                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12498967" author="knutanders" created="Fri, 25 May 2007 08:14:28 +0100"  >&lt;p&gt;The concatenation of the error messages happens in the stored procedure SYSIBM.SQLCAMESSAGE because the client passes in all the exceptions at once. I think that if the client receives a chain of exceptions, it should call SQLCAMESSAGE once for each exception in the chain and rebuild the exception chain as it was on the server.&lt;/p&gt;

&lt;p&gt;The logic in Sqlca.processSqlErrmcTokens() on the client seems to be broken. It tries to split an SQLERRMC message into tokens, but it uses a different token delimiter than the server (server uses \u0014, client uses \u00FF). Therefore, the client always thinks it gets one big token from the server. This doesn&apos;t seem to be a big problem, since it would anyway just split it into separate tokens and concatenate the tokens again, but it seems a little strange. If we want the client to split the SQLERRMC into a chain of exceptions, this has to be fixed though.&lt;/p&gt;</comment>
                            <comment id="12500123" author="knutanders" created="Wed, 30 May 2007 14:03:15 +0100"  >&lt;p&gt;Attaching a patch which makes the client recreate the chain of&lt;br/&gt;
exceptions sent by the server instead of concatenating the messages.&lt;/p&gt;

&lt;p&gt;Derbyall and suites.All ran cleanly on JDK5 and JDK6.&lt;/p&gt;

&lt;p&gt;Description of the changes:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;java/client/org/apache/derby/client/am/Sqlca.java:&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added a message number parameter to the methods that retrieved&lt;br/&gt;
    mesage and SQL state&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fixed SqlErrmc parsing (used the correct delimiter) and renamed&lt;br/&gt;
    sqlErrmcTokens_ to sqlErrmcMessages_ since the SqlErrmc was split&lt;br/&gt;
    into its separate messages, not its tokens&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added a string array called sqlStates_, which keeps the SQL states&lt;br/&gt;
    for each message in the chain&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;java/client/org/apache/derby/client/am/SqlException.java&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added a message number field to keep track of which message in the&lt;br/&gt;
    SQLCA to use&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;changed the constructor that takes an Sqlca argument so that it&lt;br/&gt;
    recursively builds the chain of exceptions when the Sqlca contains&lt;br/&gt;
    many messages&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;java/client/org/apache/derby/client/am/ExceptionFormatter.java&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;removed the printing of SqlErrmcTokens in printTrace(), because&lt;br/&gt;
    (a) that method was renamed, and (b) it contains the exact same&lt;br/&gt;
    information as SqlErrmc which is printed anyway&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;java/testing/org/apache/derbyTesting/junit/BaseJDBCTestCase.java&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;changed assertSQLState() so that it checks nested exceptions on&lt;br/&gt;
    the client the same way as on embedded&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;java/testing/org/apache/derbyTesting/functionTests/tests/lang/ProcedureInTriggerTest.java&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;enabled an assert that previously only worked on embedded&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12500325" author="knutanders" created="Thu, 31 May 2007 10:08:56 +0100"  >&lt;p&gt;Committed revision 543090.&lt;/p&gt;</comment>
                            <comment id="12500335" author="knutanders" created="Thu, 31 May 2007 10:42:15 +0100"  >&lt;p&gt;I&apos;m not marking the issue as resolved yet, since I think there is one more change that needs to be made. The embedded driver sets the next exception as cause of the exception with initCause() as well as with setNextException(). The client driver only uses setNextException() if the cause is an SQLException. I think the client should do the same as the embedded driver.&lt;/p&gt;</comment>
                            <comment id="12500381" author="knutanders" created="Thu, 31 May 2007 15:40:41 +0100"  >&lt;p&gt;Attaching a new patch which makes the client driver use initCause() in addition to setNextException() when the cause is an SQLException. It also removes the instance variable called throwable_ in SqlException and XaException and uses initCause()/getCause() instead, and it removes some code handling JVM&amp;lt;1.4 that is no longer needed. SqlExceptionTest had a test case which needed modifications because it tested that getCause() returned null when the cause was an SQLException.&lt;/p&gt;

&lt;p&gt;Derbyall and suites.All ran cleanly.&lt;/p&gt;</comment>
                            <comment id="12500621" author="knutanders" created="Fri, 1 Jun 2007 09:39:22 +0100"  >&lt;p&gt;Committed revision 543428.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="32841">DERBY-310</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12358619" name="d2692-2.diff" size="11303" author="knutanders" created="Thu, 31 May 2007 15:40:41 +0100"/>
                            <attachment id="12358620" name="d2692-2.stat" size="417" author="knutanders" created="Thu, 31 May 2007 15:40:41 +0100"/>
                            <attachment id="12358531" name="d2692.diff" size="22254" author="knutanders" created="Wed, 30 May 2007 14:03:14 +0100"/>
                            <attachment id="12358532" name="d2692.stat" size="360" author="knutanders" created="Wed, 30 May 2007 14:03:14 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23184</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy11pj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39927</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>