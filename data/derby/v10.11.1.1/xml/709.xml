<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:53:43 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-709/DERBY-709.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-709] SecurityException thrown when passing a relative path name when backing up database</title>
                <link>https://issues.apache.org/jira/browse/DERBY-709</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;CALL SYSCS_UTIL.SYSCS_BACKUP_DATABASE(&apos;extinout/bkup1&apos;);&lt;br/&gt;
ERROR 38000: The exception &apos;java.security.AccessControlException: access denied&lt;br/&gt;
(java.util.PropertyPermission user.dir read)&apos; was thrown while evaluating an exp&lt;br/&gt;
ression)&lt;/p&gt;

&lt;p&gt;Can be seen in the store/encryptionKey.sql test, modify the _app.properties file to enable the security manager.&lt;/p&gt;

&lt;p&gt;Due to logging messages using File.getCanonicalPath in RawStore.java, lines 675 and 686.&lt;/p&gt;

&lt;p&gt;Possible solutions:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;use a privileged block and required user.dir permission granted to user.dir to backup to a relative directory&lt;/li&gt;
	&lt;li&gt;use a privileged block,if a security exception is thrown then just display the relative name, otherwise display the full name. This would allow backups to succeed without requiring granting additional permissions to derby.jar&lt;/li&gt;
	&lt;li&gt;just log the relative path&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12325690">DERBY-709</key>
            <summary>SecurityException thrown when passing a relative path name when backing up database</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tsuresh">Suresh Thalamati</assignee>
                                    <reporter username="djd">Daniel John Debrunner</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Nov 2005 11:04:31 +0000</created>
                <updated>Tue, 30 Jun 2009 01:14:44 +0100</updated>
                            <resolved>Wed, 8 Mar 2006 02:24:12 +0000</resolved>
                                    <version>10.0.2.0</version>
                    <version>10.1.1.0</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12357751" author="djd" created="Wed, 16 Nov 2005 11:08:35 +0000"  >&lt;p&gt;Adding tests for absolute paths with backup would be good as well. Could use a Java function to create a absolute path from a relative name. In that case the code for the function would be in derby.jar whick can be granted permissions to read user.dir.&lt;/p&gt;

&lt;p&gt;E.g.&lt;/p&gt;

&lt;p&gt; CALL SYSCS_UTIL.SYSCS_BACKUP_DATABASE(FILENAME_RELATIVE(&apos;extinout/bkup1&apos;)); &lt;/p&gt;

&lt;p&gt;Maybe such tests exist already.&lt;/p&gt;</comment>
                            <comment id="12367585" author="tsuresh" created="Fri, 24 Feb 2006 07:38:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-709&quot; title=&quot;SecurityException thrown when passing a relative path name when backing up database&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-709&quot;&gt;&lt;del&gt;DERBY-709&lt;/del&gt;&lt;/a&gt;:&lt;br/&gt;
&amp;#8211; Removed the requirement for read permission on &quot;user.dir&quot; for backup to&lt;br/&gt;
run under security manager. Absolute Path were used only to log into backup&lt;br/&gt;
history file. Changed it to log canonical paths only if it can be obtainer&lt;br/&gt;
,otherwise only relative paths are written to the backup history file. &lt;/p&gt;

&lt;p&gt;&amp;#8211; Added a missing privileged blocks to the save service.properties file into the backup. &lt;/p&gt;

&lt;p&gt;&amp;#8211; Added  privileged blocks for  test util file functions that are called &lt;br/&gt;
   through SQL functions/procedures.&lt;/p&gt;

&lt;p&gt;&amp;#8211; Enabled some of the tests which were not running under security manager &lt;br/&gt;
   earlier because of this bug to run by default with security manager. &lt;/p&gt;

&lt;p&gt;Backup tests that test backup with jar Operations still can not be run under security&lt;br/&gt;
manager due to bug &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-537&quot; title=&quot;SQLJ.INSTALL_JAR and SQLJ.UPDATE_JAR fail when running with a SecurityManager enabled.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-537&quot;&gt;&lt;del&gt;DERBY-537&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;


&lt;p&gt;TESTS : derbyall test suite passed on Windows XP/JDK142&lt;/p&gt;

&lt;p&gt;It would be great if some can review and commit this patch. &lt;/p&gt;

&lt;p&gt;svn stat:&lt;/p&gt;

&lt;p&gt;M      java\engine\org\apache\derby\impl\services\monitor\StorageFactoryService.java&lt;br/&gt;
M      java\engine\org\apache\derby\impl\store\raw\RawStore.java&lt;br/&gt;
M      java\engine\org\apache\derby\iapi\reference\MessageId.java&lt;br/&gt;
M      java\engine\org\apache\derby\loc\messages_en.properties&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\storetests\st_1_app.properties&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\store\OnlineBackupTest1_app.properties&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\store\onlineBackupTest2_app.properties&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\store\rollForwardBackup_app.properties&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\store\RecoveryAfterBackup_app.properties&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\store\BackupPathTests_app.properties&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\store\backupRestore_app.properties&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\store\RecoveryAfterBackupSetup_app.properties&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\store\encryptionKey_app.properties&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\store\backupRestore1_app.properties&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\store\logDevice_app.properties&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\store\OnlineBackupTest3_app.properties&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\store\onlineBackupTest4_app.properties&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\store\rollForwardRecovery_app.properties&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\util\FTFileUtil.java&lt;/p&gt;</comment>
                            <comment id="12367990" author="mikem" created="Tue, 28 Feb 2006 02:20:13 +0000"  >&lt;p&gt;I reviewed and committed this patch:&lt;br/&gt;
m1_142:79&amp;gt;svn commit&lt;/p&gt;

&lt;p&gt;Sending        java\engine\org\apache\derby\iapi\reference\MessageId.java&lt;br/&gt;
Sending        java\engine\org\apache\derby\impl\services\monitor\StorageFactory&lt;br/&gt;
Service.java&lt;br/&gt;
Sending        java\engine\org\apache\derby\impl\store\raw\RawStore.java&lt;br/&gt;
Sending        java\engine\org\apache\derby\loc\messages_en.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\store\Ba&lt;br/&gt;
ckupPathTests_app.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\store\On&lt;br/&gt;
lineBackupTest1_app.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\store\On&lt;br/&gt;
lineBackupTest3_app.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\store\Re&lt;br/&gt;
coveryAfterBackupSetup_app.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\store\Re&lt;br/&gt;
coveryAfterBackup_app.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\store\ba&lt;br/&gt;
ckupRestore1_app.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\store\ba&lt;br/&gt;
ckupRestore_app.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\store\en&lt;br/&gt;
cryptionKey_app.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\store\lo&lt;br/&gt;
gDevice_app.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\store\on&lt;br/&gt;
lineBackupTest2_app.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\store\on&lt;br/&gt;
lineBackupTest4_app.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\store\ro&lt;br/&gt;
llForwardBackup_app.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\store\ro&lt;br/&gt;
llForwardRecovery_app.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\storetes&lt;br/&gt;
ts\st_1_app.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\util\FTFileUti&lt;br/&gt;
l.java&lt;br/&gt;
Transmitting file data ...................&lt;br/&gt;
Committed revision 381389.&lt;/p&gt;</comment>
                            <comment id="12368166" author="tsuresh" created="Wed, 1 Mar 2006 05:43:59 +0000"  >&lt;p&gt;This pach (derby-709_latest.diff)  fixes the  problems appreared with earlier patch when tests are run againest JARS. &lt;/p&gt;

&lt;p&gt;&amp;#8212; correctly catch the Security Exception  when  there is no permission to get a canonical path. &lt;br/&gt;
&amp;#8212;  Modified the deryb_tests.plocy to allow deltes in  $&lt;/p&gt;
{user.dir}
&lt;p&gt;$&lt;/p&gt;
{/}extinout${/}
&lt;p&gt;-    ., &lt;br/&gt;
      It is needed because , backup tests deletes the old copy of the backup  at the backup location.&lt;br/&gt;
&amp;#8212;  set noSecurityManager = true for the tests that can not  be run under security manager due to bug : 1066&lt;br/&gt;
&amp;#8212;  changes st_1   properties to use external  tests dirs ,  so  that  tests does not required  &quot;user.dir&quot; permission to create &lt;br/&gt;
     parent  directories for the backup paths. &lt;/p&gt;

&lt;p&gt;TESTS:  storeall, encryptionAll passed.  on Jdk142/WindowsXP;   &lt;/p&gt;

&lt;p&gt;It would be great if  some one can review and commit this patch. &lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
-suresht&lt;/p&gt;</comment>
                            <comment id="12368205" author="mikem" created="Wed, 1 Mar 2006 12:04:23 +0000"  >&lt;p&gt;I have committed the latest patch which should address the jar specific test failures seen with the last patch:&lt;/p&gt;

&lt;p&gt;m1_142:5&amp;gt;svn commit&lt;/p&gt;

&lt;p&gt;Sending        java\engine\org\apache\derby\impl\store\raw\RawStore.java&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\store\en&lt;br/&gt;
cryptionKey_app.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\store\lo&lt;br/&gt;
gDevice_app.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\store\ro&lt;br/&gt;
llForwardBackup_app.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\storetes&lt;br/&gt;
ts\st_1_app.properties&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\util\derby_tes&lt;br/&gt;
ts.policy&lt;br/&gt;
Transmitting file data ......&lt;br/&gt;
Committed revision 381883.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12323343" name="derby-709.diff" size="29857" author="tsuresh" created="Fri, 24 Feb 2006 07:38:21 +0000"/>
                            <attachment id="12323519" name="derby-709_latest.diff" size="4205" author="tsuresh" created="Wed, 1 Mar 2006 05:43:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10361"><![CDATA[Security]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 24 Feb 2006 07:38:21 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22104</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0v3r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38857</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>