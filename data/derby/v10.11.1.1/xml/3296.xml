<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:31:39 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3296/DERBY-3296.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3296] Importing to table in default schema fails when another table with the same name exists in a different schema</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3296</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I discovered this problem while trying to get suites.All to run on the phoneME advanced platform, but it is easy to reproduce also with Java SE. &lt;/p&gt;

&lt;p&gt;The problem is that importing a table fails if there exists a table with the same name in a different schema. The error is:&lt;/p&gt;

&lt;p&gt;ERROR 42X04: Column &apos;COLUMN2&apos; is either not in any table in the FROM list or appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE  statement then &apos;COLUMN2&apos; is not a column in the target table.&lt;/p&gt;

&lt;p&gt;If the table in the other schema is removed, the import command succeeds. If the import command is executed with an explicit schema name, instead of relying on &quot;null&quot; to give the default schema, the command also succeeds.&lt;/p&gt;

&lt;p&gt;I believe this is a bug.&lt;/p&gt;

&lt;p&gt;The following sequence of commands reproduces the problem:&lt;/p&gt;

&lt;p&gt;ij version 10.4&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby:MyDbTest;create=true&apos;;&lt;br/&gt;
ij&amp;gt; create table t1 (a int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t1 values 1,2,3;&lt;br/&gt;
3 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE(null, &apos;T1&apos;, &apos;t1.txt&apos;, null, null, null);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt;  create schema iep;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; create table iep.t1 (b int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE(null, &apos;T1&apos;, &apos;t1.txt&apos;, null, null, null, 0);&lt;br/&gt;
ERROR 38000: The exception &apos;java.sql.SQLException: Column &apos;COLUMN2&apos; is either not in any table in the FROM list or appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE  statement then &apos;COLUMN2&apos; is not a column in the target table.&apos; was thrown while evaluating an expression.&lt;br/&gt;
ERROR 42X04: Column &apos;COLUMN2&apos; is either not in any table in the FROM list or appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE  statement then &apos;COLUMN2&apos; is not a column in the target table.&lt;/p&gt;</description>
                <environment>java version &amp;quot;1.5.0_14&amp;quot;&lt;br/&gt;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_14-b03)&lt;br/&gt;
Java HotSpot(TM) Server VM (build 1.5.0_14-b03, mixed mode)&lt;br/&gt;
&lt;br/&gt;
Linux 2.4.21-40.ELsmp #1 SMP Thu Feb 2 22:14:12 EST 2006 i686 athlon i386 GNU/Linux</environment>
        <key id="12385438">DERBY-3296</key>
            <summary>Importing to table in default schema fails when another table with the same name exists in a different schema</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="vemund">Vemund &#216;stgaard</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Jan 2008 14:33:17 +0000</created>
                <updated>Sun, 1 Apr 2012 22:57:58 +0100</updated>
                            <resolved>Tue, 9 Jun 2009 19:15:33 +0100</resolved>
                                    <version>10.4.1.3</version>
                                    <fixVersion>10.5.2.0</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12712560" author="knutanders" created="Sun, 24 May 2009 15:38:40 +0100"  >&lt;p&gt;The problem here is that ColumnInfo uses DatabaseMetaData.getColumns() to find all the columns in the table. Since the schema is not specified (null), getColumns() returns the columns for all tables with the specified name in all schemas. This works fine as long as there&apos;s only one table with that name, but it breaks down when there&apos;s another table with the same name in another schema.&lt;/p&gt;

&lt;p&gt;The solution is simple, just get the current schema from the connection object if no schema is specified. The attached patch makes that change and adds a test case. The tools tests run cleanly with the patch. I&apos;ll start the full regression test suite now.&lt;/p&gt;</comment>
                            <comment id="12712609" author="knutanders" created="Sun, 24 May 2009 22:46:09 +0100"  >&lt;p&gt;All the regression tests passed.&lt;/p&gt;</comment>
                            <comment id="12712680" author="knutanders" created="Mon, 25 May 2009 11:12:05 +0100"  >&lt;p&gt;Here&apos;s an updated patch (d3296-2.diff). The only change is that the test now verifies that the rows were imported to the correct table.&lt;/p&gt;</comment>
                            <comment id="12714073" author="knutanders" created="Thu, 28 May 2009 18:27:06 +0100"  >&lt;p&gt;Committed to trunk with revision 779681.&lt;/p&gt;</comment>
                            <comment id="12717770" author="knutanders" created="Tue, 9 Jun 2009 19:15:33 +0100"  >&lt;p&gt;Merged to 10.5 and committed revision 783087.&lt;/p&gt;</comment>
                            <comment id="12727201" author="olesolberg" created="Sat, 4 Jul 2009 08:46:59 +0100"  >&lt;p&gt;Not seen since commit, so closing.&lt;/p&gt;</comment>
                            <comment id="13243076" author="eric.vergnaud@wanadoo.fr" created="Sat, 31 Mar 2012 08:58:50 +0100"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;this is broken again in 10.8.2.2 using EmbeddedDriver40 and Java 1.6 on MacOSX, even when specifying the schema&lt;/p&gt;

&lt;p&gt;I have a simple unit test running this code:&lt;br/&gt;
	public void csvImport(String csvFilePath) throws SQLException {&lt;br/&gt;
		final String sql = &quot;CALL SYSCS_UTIL.SYSCS_IMPORT_TABLE (&apos;PANDORA&apos;,&apos;COUNTRIES&apos;,&apos;&quot; + csvFilePath + &quot;&apos;,NULL,NULL,&apos;UTF-8&apos;,0)&quot;;	&lt;br/&gt;
		Connection cn = ds.getConnection();&lt;br/&gt;
		try {&lt;br/&gt;
			Statement st = cn.createStatement();&lt;br/&gt;
			try &lt;/p&gt;
{
				st.execute(sql);
			}
&lt;p&gt; finally &lt;/p&gt;
{
				st.close();
			}
&lt;p&gt;		} finally &lt;/p&gt;
{
			cn.close();
		}
&lt;p&gt;	}&lt;/p&gt;

&lt;p&gt;which throws the following exception:&lt;/p&gt;

&lt;p&gt;java.sql.SQLException: The exception &apos;java.sql.SQLException: Column &apos;COLUMN2&apos; is either not in any table in the FROM list or appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE  statement then &apos;COLUMN2&apos; is not a column in the target table.&apos; was thrown while evaluating an expression.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.seeNextException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)&lt;br/&gt;
	at pandora.CountryDAO.csvImport(CountryDAO.java:313)&lt;br/&gt;
	at pandora.TestCountryDAO.testImport(TestCountryDAO.java:99)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)&lt;br/&gt;
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)&lt;br/&gt;
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)&lt;br/&gt;
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)&lt;br/&gt;
	at org.junit.runners.BlockJUnit4ClassRunner.runNotIgnored(BlockJUnit4ClassRunner.java:79)&lt;br/&gt;
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:71)&lt;br/&gt;
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:49)&lt;br/&gt;
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)&lt;br/&gt;
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)&lt;br/&gt;
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)&lt;br/&gt;
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)&lt;br/&gt;
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)&lt;br/&gt;
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)&lt;br/&gt;
	at org.junit.runners.ParentRunner.run(ParentRunner.java:236)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:50)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)&lt;br/&gt;
Caused by: java.sql.SQLException: The exception &apos;java.sql.SQLException: Column &apos;COLUMN2&apos; is either not in any table in the FROM list or appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE  statement then &apos;COLUMN2&apos; is not a column in the target table.&apos; was thrown while evaluating an expression.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source)&lt;br/&gt;
	... 36 more&lt;br/&gt;
Caused by: java.sql.SQLException: Column &apos;COLUMN2&apos; is either not in any table in the FROM list or appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE  statement then &apos;COLUMN2&apos; is not a column in the target table.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement40.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.load.Import.performImport(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.load.Import.importTable(Unknown Source)&lt;br/&gt;
	at org.apache.derby.catalog.SystemProcedures.SYSCS_IMPORT_TABLE(Unknown Source)&lt;br/&gt;
	at org.apache.derby.exe.acdf1940dax0136x67bdx26aex0000041f37b01.g0(Unknown Source)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)&lt;br/&gt;
	... 29 more&lt;br/&gt;
Caused by: ERROR 42X04: Column &apos;COLUMN2&apos; is either not in any table in the FROM list or appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE  statement then &apos;COLUMN2&apos; is not a column in the target table.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ColumnReference.bindExpression(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ResultColumn.bindExpression(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ResultColumnList.bindExpressions(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.SelectNode.bindExpressions(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.SelectNode.bindExpressionsWithTables(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.DMLStatementNode.bindExpressionsWithTables(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.DMLStatementNode.bindResultSetsWithTables(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.InsertNode.bindStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source)&lt;br/&gt;
	... 48 more&lt;/p&gt;


</comment>
                            <comment id="13243877" author="knutanders" created="Sun, 1 Apr 2012 22:57:58 +0100"  >&lt;p&gt;Hi Eric,&lt;/p&gt;

&lt;p&gt;Please file a new JIRA issue for the problem you&apos;re seeing, and post the steps needed to reproduce it there so that we can look into it.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12514207">DERBY-5337</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12408934" name="d3296-2.diff" size="2219" author="knutanders" created="Mon, 25 May 2009 11:12:05 +0100"/>
                            <attachment id="12408908" name="d3296.diff" size="1999" author="knutanders" created="Sun, 24 May 2009 15:38:40 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 24 May 2009 14:38:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23552</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0chj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35841</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>