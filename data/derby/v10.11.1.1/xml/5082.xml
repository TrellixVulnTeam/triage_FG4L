<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:53:23 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5082/DERBY-5082.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5082] ShutdownException in ContextManager.checkInterrupt() during shutdown</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5082</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When running the attached repro script, I often (but not always) see a ShutdownException in ContextManager.checkInterrupt() when ij exits and shuts down the Derby engine. ij expects an exception here, but it expects an SQLException, not a ShutdownException.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12500174">DERBY-5082</key>
            <summary>ShutdownException in ContextManager.checkInterrupt() during shutdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Mar 2011 12:38:38 +0000</created>
                <updated>Tue, 19 Apr 2011 13:38:21 +0100</updated>
                            <resolved>Thu, 3 Mar 2011 00:11:43 +0000</resolved>
                                    <version>10.8.1.2</version>
                                    <fixVersion>10.8.1.2</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13001402" author="knutanders" created="Wed, 2 Mar 2011 12:42:11 +0000"  >&lt;p&gt;Attaching repro script. Here&apos;s what I see when running it:&lt;/p&gt;

&lt;p&gt;$ java org.apache.derby.tools.ij test.sql&lt;br/&gt;
ij version 10.8&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby:db;create=true&apos;;&lt;br/&gt;
ij&amp;gt; create table t(x int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
(...)&lt;br/&gt;
ij&amp;gt; insert into t select * from t;&lt;br/&gt;
22528 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from t where x &amp;gt; 50;&lt;br/&gt;
1          &lt;br/&gt;
-----------&lt;br/&gt;
4096       &lt;/p&gt;

&lt;p&gt;1 row selected&lt;br/&gt;
ij&amp;gt; Exception in thread &quot;main&quot; org.apache.derby.iapi.error.ShutdownException: &lt;br/&gt;
	at org.apache.derby.iapi.services.context.ContextManager.checkInterrupt(ContextManager.java:464)&lt;br/&gt;
	at org.apache.derby.iapi.services.context.ContextManager.popContext(ContextManager.java:202)&lt;br/&gt;
	at org.apache.derby.iapi.services.context.ContextImpl.popMe(ContextImpl.java:81)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.xact.Xact.close(Xact.java:1169)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.xact.Xact.destroy(Xact.java:1110)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMTransaction.destroy(RAMTransaction.java:2030)&lt;br/&gt;
	at org.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl.stop(IndexStatisticsDaemonImpl.java:866)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.stop(DataDictionaryImpl.java:974)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.stop(TopService.java:443)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.shutdown(TopService.java:394)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.shutdown(BaseMonitor.java:229)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.shutdown(BaseMonitor.java:199)&lt;br/&gt;
	at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:241)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:144)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(DriverManager.java:582)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(DriverManager.java:207)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.cleanupGo(utilMain.java:429)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:262)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.go(Main.java:229)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:184)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.main(Main.java:75)&lt;br/&gt;
	at org.apache.derby.tools.ij.main(ij.java:59)&lt;/p&gt;</comment>
                            <comment id="13001487" author="rhillegas" created="Wed, 2 Mar 2011 17:05:45 +0000"  >&lt;p&gt;Marking this as a blocker for 10.8.1 because I think this regression is likely to affect a lot of users.&lt;/p&gt;</comment>
                            <comment id="13001552" author="knutanders" created="Wed, 2 Mar 2011 19:04:47 +0000"  >&lt;p&gt;While running the repro script, I&apos;ve also seen this exception printed to the console:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;index-stat-thread&quot; org.apache.derby.iapi.error.ShutdownException: &lt;br/&gt;
	at org.apache.derby.iapi.services.context.ContextService.getFactory(ContextService.java:210)&lt;br/&gt;
	at org.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl.run(IndexStatisticsDaemonImpl.java:700)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;

&lt;p&gt;ij didn&apos;t error out in that case, though.&lt;/p&gt;</comment>
                            <comment id="13001714" author="kristwaa" created="Wed, 2 Mar 2011 22:10:27 +0000"  >&lt;p&gt;I extracted one of the istat bug reports (the one with the factory call) and created &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5088&quot; title=&quot;ShutdownException raised in istat thread during factory call&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5088&quot;&gt;&lt;del&gt;DERBY-5088&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13001764" author="kristwaa" created="Thu, 3 Mar 2011 00:08:21 +0000"  >&lt;p&gt;Attached patch 1a, which fixes the bug with a ShutdownException raised in ContextManager by avoiding to destroy the tx if the database is shut down. Also, if the transaction is being destroyed, catch ShutdownException in case someone shuts down the database under our feet. This is already done in the main processing loop if the worker thread detects that the daemon has been stopped.&lt;/p&gt;

&lt;p&gt;Since the patch is so small and isolated, I committed it right away with revision 1076462.&lt;/p&gt;

&lt;p&gt;The coming patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5088&quot; title=&quot;ShutdownException raised in istat thread during factory call&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5088&quot;&gt;&lt;del&gt;DERBY-5088&lt;/del&gt;&lt;/a&gt; will be larger, so I&apos;ll need to run more tests before committing.&lt;/p&gt;</comment>
                            <comment id="13001767" author="kristwaa" created="Thu, 3 Mar 2011 00:11:43 +0000"  >&lt;p&gt;I can&apos;t reproduce the bug with the fix applied, would be nice if others gave the repro a try too (it doesn&apos;t take long to run, but it is wise to delete the database between the runs).&lt;br/&gt;
I didn&apos;t see the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5088&quot; title=&quot;ShutdownException raised in istat thread during factory call&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5088&quot;&gt;&lt;del&gt;DERBY-5088&lt;/del&gt;&lt;/a&gt; either, but that must be because the timing is different on my machine.&lt;/p&gt;</comment>
                            <comment id="13001904" author="knutanders" created="Thu, 3 Mar 2011 08:04:57 +0000"  >&lt;p&gt;Thanks for fixing this, Kristian! I&apos;ve run the repro script 50 times without seeing the exception. It used to see it on every other run or so, so it appears to be fixed. Closing the bug.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12492660">DERBY-4939</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12500242">DERBY-5088</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12472489" name="derby-5082-1a-fix.diff" size="1534" author="kristwaa" created="Thu, 3 Mar 2011 00:08:21 +0000"/>
                            <attachment id="12472422" name="test.sql" size="544" author="knutanders" created="Wed, 2 Mar 2011 12:42:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 2 Mar 2011 17:05:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24637</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0h53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36595</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10050"><![CDATA[Blocker]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>