<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:23:14 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5801/DERBY-5801.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5801] Sub-processes should write EMMA coverage data to separate files</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5801</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When generating EMMA coverage reports after running suites.All, I frequently see that coverage.ec is corrupted, and no report is produced. Typical failures look like this:&lt;/p&gt;

&lt;p&gt;java.io.UTFDataFormatException: malformed input around byte 52&lt;br/&gt;
	at java.io.DataInputStream.readUTF(DataInputStream.java:656)&lt;br/&gt;
	at java.io.DataInputStream.readUTF(DataInputStream.java:564)&lt;br/&gt;
	at com.vladium.emma.data.ClassDescriptor.readExternal(ClassDescriptor.java:171)&lt;br/&gt;
	at com.vladium.emma.data.MetaData.readExternal(MetaData.java:228)&lt;br/&gt;
	at com.vladium.emma.data.DataFactory.readEntry(DataFactory.java:770)&lt;br/&gt;
	at com.vladium.emma.data.DataFactory.mergeload(DataFactory.java:461)&lt;br/&gt;
	at com.vladium.emma.data.DataFactory.load(DataFactory.java:56)&lt;br/&gt;
	at com.vladium.emma.report.ReportProcessor._run(ReportProcessor.java:175)&lt;br/&gt;
	at com.vladium.emma.Processor.run(Processor.java:54)&lt;br/&gt;
	at com.vladium.emma.report.reportCommand.run(reportCommand.java:130)&lt;br/&gt;
	at emma.main(emma.java:40)&lt;/p&gt;

&lt;p&gt;or&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; com.vladium.emma.EMMARuntimeException: unexpected failure: &lt;br/&gt;
        at com.vladium.emma.Command.exit(Command.java:237)&lt;br/&gt;
        at com.vladium.emma.report.reportCommand.run(reportCommand.java:145)&lt;br/&gt;
        at emma.main(emma.java:40)&lt;br/&gt;
Caused by: java.lang.OutOfMemoryError: Requested array size exceeds VM limit&lt;br/&gt;
        at java.util.HashMap.&amp;lt;init&amp;gt;(HashMap.java:181)&lt;br/&gt;
        at java.util.HashMap.&amp;lt;init&amp;gt;(HashMap.java:193)&lt;br/&gt;
        at com.vladium.emma.data.MetaData.readExternal(MetaData.java:223)&lt;br/&gt;
        at com.vladium.emma.data.DataFactory.readEntry(DataFactory.java:770)&lt;br/&gt;
        at com.vladium.emma.data.DataFactory.mergeload(DataFactory.java:461)&lt;br/&gt;
        at com.vladium.emma.data.DataFactory.load(DataFactory.java:56)&lt;br/&gt;
        at com.vladium.emma.report.ReportProcessor._run(ReportProcessor.java:175)&lt;br/&gt;
        at com.vladium.emma.Processor.run(Processor.java:54)&lt;br/&gt;
        at com.vladium.emma.report.reportCommand.run(reportCommand.java:130)&lt;br/&gt;
        ... 1 more&lt;/p&gt;

&lt;p&gt;I suspect that the problem is that all sub-processes spawned by the main test process write to the same file, sometimes multiple processes running at the same time, and that the file gets corrupted because there&apos;s no coordination between the processes when they&apos;re writing to it.&lt;/p&gt;

&lt;p&gt;Experiments I have run also indicate that making the sub-processes write to different files helps (I haven&apos;t managed to reproduce the corruption yet with that change), so I suggest we make that change.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12559656">DERBY-5801</key>
            <summary>Sub-processes should write EMMA coverage data to separate files</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Jun 2012 09:55:29 +0100</created>
                <updated>Tue, 24 Jul 2012 18:31:12 +0100</updated>
                            <resolved>Thu, 7 Jun 2012 16:17:42 +0100</resolved>
                                    <version>10.10.1.1</version>
                                    <fixVersion>10.10.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13290894" author="knutanders" created="Thu, 7 Jun 2012 10:05:46 +0100"  >&lt;p&gt;Attached is the patch I used for my experiments. It makes the sub-processes write coverage data to coverage-1.ec, coverage-2.ec, ..., instead of the coverage.ec file written to by the main test process.&lt;/p&gt;

&lt;p&gt;I created the test reports by running EMMA manually on the generated ec files when I ran these experiments, not by using the emma-all or emma-single ant targets. The final patch will have to update those targets as well so that they pick up all the ec files and not just coverage.ec.&lt;/p&gt;</comment>
                            <comment id="13290908" author="kristwaa" created="Thu, 7 Jun 2012 10:46:15 +0100"  >&lt;p&gt;I have been looking into adding support for JaCoCo to get code coverage for Derby, and I ended up with the same approach as you are using in your patch. Since it makes sense to run with either EMMA or JaCoCo, the same counter could be used for both tools.&lt;br/&gt;
If I understand the code correctly, the files will be saved in the same directory. This makes it easier to merge or pick them up in the reporting step.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13290934" author="knutanders" created="Thu, 7 Jun 2012 12:33:04 +0100"  >&lt;p&gt;Attaching a new patch that adds some comments to the code added in BaseTestCase, and it also updates the emma-report target so that it picks up all of the coverage files.&lt;/p&gt;</comment>
                            <comment id="13290940" author="knutanders" created="Thu, 7 Jun 2012 12:38:27 +0100"  >&lt;p&gt;&amp;gt; If I understand the code correctly, the files will be saved in the same directory. This makes it easier to merge or pick them up in the reporting step.&lt;/p&gt;

&lt;p&gt;That&apos;s right. The value of the emma.coverage.out.file property is prefixed with the working directory of the parent process. This way we don&apos;t have to search the file system for all coverage files, in case tests start sub-processes in a different directory (only the replication tests do that currently).&lt;/p&gt;</comment>
                            <comment id="13291067" author="knutanders" created="Thu, 7 Jun 2012 16:17:42 +0100"  >&lt;p&gt;Committed revision 1347667.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12531254" name="d5801-1a.diff" size="2673" author="knutanders" created="Thu, 7 Jun 2012 12:33:04 +0100"/>
                            <attachment id="12531243" name="separate.diff" size="1096" author="knutanders" created="Thu, 7 Jun 2012 10:05:46 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 7 Jun 2012 09:46:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245864</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0alz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35537</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>