<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:53:28 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2670/DERBY-2670.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2670] %a% and %aa% match too many rows in database with collation=TERRITORY_BASED and territory=no_NO</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2670</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;On a database with territory=no_NO and collation=TERRITORY_BASED, I get these results from a query which uses the LIKE predicate:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; select * from t where x like &apos;%a%&apos;;&lt;br/&gt;
X                   &lt;br/&gt;
--------------------&lt;br/&gt;
Waagan              &lt;br/&gt;
W&#229;han               &lt;br/&gt;
Wanvik              &lt;br/&gt;
W&#229;gan               &lt;br/&gt;
ekstrabetaling      &lt;br/&gt;
ekstra&#173;arbeid       &lt;br/&gt;
&#173;a                  &lt;br/&gt;
a                   &lt;br/&gt;
-a                  &lt;br/&gt;
 a                  &lt;br/&gt;
B                   &lt;br/&gt;
C                   &lt;/p&gt;

&lt;p&gt;12 rows selected&lt;/p&gt;

&lt;p&gt;The last two rows (&apos;B&apos; and &apos;C&apos;) should not have been included in the result, since they do not match the pattern &apos;%a%&apos;.&lt;/p&gt;

&lt;p&gt;Similar wrong results are seen with &apos;%aa%&apos;:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; select * from t where x like &apos;%aa%&apos;;&lt;br/&gt;
X                   &lt;br/&gt;
--------------------&lt;br/&gt;
Waagan              &lt;br/&gt;
ekstraarbeid        &lt;br/&gt;
B                   &lt;/p&gt;

&lt;p&gt;3 rows selected&lt;/p&gt;</description>
                <environment></environment>
        <key id="12369674">DERBY-2670</key>
            <summary>%a% and %aa% match too many rows in database with collation=TERRITORY_BASED and territory=no_NO</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikem">Mike Matrigali</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 May 2007 13:28:53 +0100</created>
                <updated>Sun, 27 May 2007 20:10:04 +0100</updated>
                            <resolved>Sat, 26 May 2007 00:49:42 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12496862" author="knutanders" created="Fri, 18 May 2007 13:30:52 +0100"  >&lt;p&gt;Attaching ij script which reproduces the bug.&lt;/p&gt;</comment>
                            <comment id="12496865" author="knutanders" created="Fri, 18 May 2007 13:40:02 +0100"  >&lt;p&gt;Attaching the same repro as a Java application. In the Java application I replaced &apos;&#229;&apos; with &apos;\u00E5&apos; and soft hyphen with &apos;\u00AD&apos; (to make the repro independent of locale/terminal and to make it clearer which characters the strings contained).&lt;/p&gt;</comment>
                            <comment id="12496958" author="mikem" created="Fri, 18 May 2007 18:11:05 +0100"  >&lt;p&gt;thanks very much for the early testing.  And we appreciate the java repro it makes it a lot easier for us to demonstrate and debug the issue here.&lt;/p&gt;</comment>
                            <comment id="12499010" author="mikem" created="Fri, 25 May 2007 10:46:47 +0100"  >&lt;p&gt;This problem is very sensitive to the data that exists in the table.  Removing a row that should not be affected by the query&lt;br/&gt;
changes the results.  &lt;/p&gt;

&lt;p&gt;I don&apos;t know if this is the problem, but it looks like the WorkHorseForCollatorDatatypes class may cache values in it..  Derby&lt;br/&gt;
may reuse a single DataValueDescriptor for multiple values.  This is why code like readExternal goes out of it&apos;s way to &lt;br/&gt;
reset fields in the datastructure when reading in a new value.  &lt;/p&gt;

&lt;p&gt;I think  this has to somehow get accomplished for the various uses of WorkHorseForCollatorDatatypes in:&lt;br/&gt;
CollatorSQLChar.java         CollatorSQLLongvarchar.java&lt;br/&gt;
CollatorSQLClob.java         CollatorSQLVarchar.java&lt;/p&gt;

&lt;p&gt;This problem is  showing up particularly for like as we create an array of collationElementsForString  and cache it so if we&lt;br/&gt;
a like again we don&apos;t rebuild it. &lt;/p&gt;</comment>
                            <comment id="12499258" author="mikem" created="Sat, 26 May 2007 00:49:42 +0100"  >&lt;p&gt;This issue is fixed by the following checkin.  This was only a problem in new code introduced in the trunk and&lt;br/&gt;
never affected any Derby release.&lt;/p&gt;

&lt;p&gt;Changed WorkHorseForCollatorDatatypes to not cache info about the collation&lt;br/&gt;
elements across calls to like on the object.  This info needed to get&lt;br/&gt;
invalidated when object for a column was reused to process the next row.&lt;br/&gt;
Added a test to CollationTest2 based on bug report.&lt;/p&gt;

&lt;p&gt;m2_ibm15:123&amp;gt;svn commit&lt;/p&gt;

&lt;p&gt;Sending        java\engine\org\apache\derby\iapi\types\WorkHorseForCollatorDatatypes.java&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\lang\CollationTest2.java&lt;br/&gt;
Transmitting file data ..&lt;br/&gt;
Committed revision 541822.&lt;/p&gt;</comment>
                            <comment id="12499405" author="knutanders" created="Sun, 27 May 2007 14:59:39 +0100"  >&lt;p&gt;Thanks Mike, your check-in solved the error in the repro. However, I still see some strange results. Using the same table as in the repro, &quot;a%&quot; matches &quot;\u00ADa&quot;, &quot;a&quot;, &quot;-a&quot;, &quot; a&quot; and &quot;A&quot;, which doesn&apos;t seem correct to me. Similar incorrect results with &quot;b%&quot; and &quot;c%&quot;. Is this the same issue, or should I open a new one?&lt;/p&gt;</comment>
                            <comment id="12499427" author="mikem" created="Sun, 27 May 2007 19:49:02 +0100"  >&lt;p&gt;I have logged &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2706&quot; title=&quot;fix like clauses with trailing % &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2706&quot;&gt;&lt;del&gt;DERBY-2706&lt;/del&gt;&lt;/a&gt; for the new problems you found knut.  My first guess is that this is not related to the previous problem, thus logged a new issue.  Of course won&apos;t really know until it is fixed.  If you come up with any other cases that &lt;br/&gt;
you think would be worthwhile add them to that issue and hopefully we can eventually get them into a junit test. &lt;/p&gt;</comment>
                            <comment id="12499436" author="knutanders" created="Sun, 27 May 2007 20:10:04 +0100"  >&lt;p&gt;Thank you for opening a new issue, Mike. Since the reported problem is fixed, I&apos;m closing this issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12370310">DERBY-2698</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12357625" name="coll.java" size="1046" author="knutanders" created="Fri, 18 May 2007 13:40:02 +0100"/>
                            <attachment id="12357624" name="collrepro.sql" size="323" author="knutanders" created="Fri, 18 May 2007 13:30:51 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 18 May 2007 17:11:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23166</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy122f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39985</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>