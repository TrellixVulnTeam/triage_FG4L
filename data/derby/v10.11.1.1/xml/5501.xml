<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:12:16 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5501/DERBY-5501.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5501] Subquery is only allowed to return a single column - When using derby with hibernate (or JPA) queries are created per JPA spec. For tables with multi-column PK, subqueries are created with two columns in select clause.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5501</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;ERROR: Subquery is only allowed to return a single column.&lt;br/&gt;
PROBLEM: When using derby with hibernate (or JPA) queries are created by the JPA engine per JPA spec. For tables with multi-column PK, subqueries are created with two columns in select clause (see select colofassig6_.activityID, colofassig6_.assigneeID from Assignment  in the query below).&lt;br/&gt;
Without this support, I can not use Derby with JPA.&lt;/p&gt;


&lt;p&gt;Hibernate: select distinct activitybe0_.activityID as activityID69_, activitybe0_.createdBy as createdBy69_, activitybe0_.createdOn as createdOn69_, activitybe0_.lastModifiedBy as lastModi4_69_, activitybe0_.lastModifiedOn as lastModi5_69_, activitybe0_.activityDate as activity6_69_, activitybe0_.activityTypeHierarchyID as activity7_69_, activitybe0_.activityTypeID as activity8_69_, activitybe0_.campaignID as campaignID69_, activitybe0_.comments as comments69_, activitybe0_.description as descrip11_69_, activitybe0_.inputID as inputID69_, activitybe0_.inputTypeID as inputTy13_69_, activitybe0_.name as name69_, activitybe0_.notes as notes69_, activitybe0_.organizationID as organiz16_69_, activitybe0_.parentActivityTypeID as parentA17_69_ from Activity activitybe0_, Activity activitybe1_ inner join ActivitySchedule colofactiv2_ on activitybe1_.activityID=colofactiv2_.activityID inner join ActivityScheduleStatus colofactiv3_ on colofactiv2_.activityScheduleID=colofactiv3_.activityScheduleID inner join ActivityScheduleStatusType activitysc4_ on colofactiv3_.activityScheduleStatusTypeID=activitysc4_.activityScheduleStatusTypeID, ActivityTypeHierarchy activityty5_ where activitybe0_.activityTypeHierarchyID=activityty5_.activityTypeHierarchyID and activityty5_.activityTypeHierarchyID=? and  not (exists (select colofassig6_.activityID, colofassig6_.assigneeID from Assignment colofassig6_ where activitybe0_.activityID=colofassig6_.activityID)) and (activitybe0_.activityID&amp;lt;&amp;gt;activitybe1_.activityID or activitysc4_.name&amp;lt;&amp;gt;&apos;Route&apos;)&lt;br/&gt;
2011-11-14 11:41:13,413 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;org.hibernate.util.JDBCExceptionReporter&amp;#93;&lt;/span&gt; (EJB-Timer-1321288405420&lt;span class=&quot;error&quot;&gt;&amp;#91;target=jboss.j2ee:ear=oecrm1.6.3RC1-derby-jboss.ear,jar=builder-ejb.jar,name=WorkflowActivatorBean,service=EJB3&amp;#93;&lt;/span&gt;) Subquery is only allowed to return a single column.&lt;/p&gt;</description>
                <environment>Max/Linux</environment>
        <key id="12531341">DERBY-5501</key>
            <summary>Subquery is only allowed to return a single column - When using derby with hibernate (or JPA) queries are created per JPA spec. For tables with multi-column PK, subqueries are created with two columns in select clause.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="sdixit@ohioedge.com">Sandeep Dixit</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Nov 2011 17:08:56 +0000</created>
                <updated>Mon, 17 Jun 2013 10:19:07 +0100</updated>
                            <resolved>Mon, 21 Nov 2011 21:27:34 +0000</resolved>
                                    <version>10.0.2.0</version>
                    <version>10.0.2.1</version>
                    <version>10.1.1.0</version>
                    <version>10.1.2.1</version>
                    <version>10.1.3.1</version>
                    <version>10.2.1.6</version>
                    <version>10.2.2.0</version>
                    <version>10.3.1.4</version>
                    <version>10.3.2.1</version>
                    <version>10.3.3.0</version>
                    <version>10.4.1.3</version>
                    <version>10.4.2.0</version>
                    <version>10.5.1.1</version>
                    <version>10.5.2.0</version>
                    <version>10.5.3.0</version>
                    <version>10.6.1.0</version>
                    <version>10.6.2.1</version>
                    <version>10.7.1.1</version>
                    <version>10.8.1.2</version>
                    <version>10.8.2.2</version>
                                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                            <comments>
                            <comment id="13151229" author="dagw" created="Wed, 16 Nov 2011 14:28:52 +0000"  >&lt;p&gt;Thanks for filing this issue. Changing to improvement request.&lt;/p&gt;</comment>
                            <comment id="13152157" author="dagw" created="Thu, 17 Nov 2011 17:42:35 +0000"  >&lt;p&gt;Attaching a repro (derby-5501-repro) as a diff to NestedWhereSubqueryTest.&lt;/p&gt;</comment>
                            <comment id="13152461" author="dagw" created="Thu, 17 Nov 2011 23:36:52 +0000"  >&lt;p&gt;Uploading a patch which lifts this restriction for EXISTS/NOT EXISTS and adds a test fixture to NestedWhereSubqueryTest. I haven&apos;t thought through the ramifications about allowing this, but right now I can&apos;t see why lifting this restriction would cause any problems: internally the select list is rewritten to a &quot;SELECT TRUE FROM..&quot; in any case. Interestingly, the case &quot;select *&quot; is already allowed, cf. the tests added.&lt;/p&gt;

&lt;p&gt;Running regressions.&lt;/p&gt;</comment>
                            <comment id="13152760" author="knutanders" created="Fri, 18 Nov 2011 10:09:54 +0000"  >&lt;p&gt;Derby currently implements SQL Feature E061-08, EXISTS PREDICATE,&lt;br/&gt;
which only allows an &amp;lt;asterisk&amp;gt; or a single &amp;lt;derived column&amp;gt;. There is&lt;br/&gt;
also Feature T501, Enhanced EXISTS predicate, which allows multiple&lt;br/&gt;
columns, but that feature is not supported by Derby yet.&lt;/p&gt;

&lt;p&gt;SQL:2003, part 2, 8.9 &amp;lt;exists predicate&amp;gt;:&lt;/p&gt;

&lt;p&gt;,----&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Conformance Rules&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1) Without Feature T501, &#8220;Enhanced EXISTS predicate&#8221;, conforming SQL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; language shall not contain an &amp;lt;exists predicate&amp;gt; that simply contains&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; a &amp;lt;table subquery&amp;gt; in which the &amp;lt;select list&amp;gt; of a &amp;lt;query&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; specification&amp;gt; directly contained in the &amp;lt;table subquery&amp;gt; does not&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; comprise either an &amp;lt;asterisk&amp;gt; or a single &amp;lt;derived column&amp;gt;.&lt;br/&gt;
`----&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;So it seems to me that the changes proposed here are allowed by the&lt;br/&gt;
SQL standard.&lt;/p&gt;

&lt;p&gt;The patch may need to make some changes to the&lt;br/&gt;
verifySelectStarSubquery() and setResultToBooleanTrueNode() overrides&lt;br/&gt;
too, as those methods assume that there&apos;s only one result column right&lt;br/&gt;
now (they only work on resultColumns.elementAt(0)).&lt;/p&gt;</comment>
                            <comment id="13153100" author="dagw" created="Fri, 18 Nov 2011 20:21:44 +0000"  >&lt;p&gt;Thanks, Knut. I missed that when scanning the standard on this; I only saw the &amp;lt;table subquery&amp;gt; and assumed it was a Derby specific restriction. In any case, it is as per the standard, and this issue is definitely not a bug then, but an improvement. I&apos;ll check the release note needed flag and file a documentation JIRA too.&lt;/p&gt;
</comment>
                            <comment id="13153294" author="dagw" created="Sat, 19 Nov 2011 01:02:16 +0000"  >&lt;p&gt;Uploading version 2 of the patch. I adjusted the logic in verifySelectStarSubquery and setResultToBooleanTrueNode, although I wasn&apos;t able to make any example fail &lt;b&gt;without&lt;/b&gt; adjusting them.&lt;/p&gt;

&lt;p&gt;1) If the test in verifySelectStarSubquery which throws SQLState.LANG_EXPOSED_NAME_NOT_FOUND is not made, the error will be caught later:&lt;/p&gt;

&lt;p&gt;Caused by: ERROR 42X10: &apos;FOO&apos; is not an exposed table name in the scope in which it appears.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:278)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.FromList.expandAll(FromList.java:514)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ResultColumnList.expandAllsAndNameColumns(ResultColumnList.java:1737)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ResultColumnList.bindExpressions(ResultColumnList.java:825)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.SelectNode.bindExpressions(SelectNode.java:555)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.SelectNode.bindTargetExpressions(SelectNode.java:734)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.SubqueryNode.bindExpression(SubqueryNode.java:532)&lt;/p&gt;

&lt;p&gt;so the check may be redundant. But I did adjust it so it catches the following bad in column 2 in the check in verifySelectStarSubquery (foo is bogus):&lt;/p&gt;

&lt;p&gt;select i from t5501b t1 where not exists (select t2.&lt;b&gt;,foo.&lt;/b&gt; from t5501a t2 where t1.i=t2.i)&lt;/p&gt;

&lt;p&gt;2) As for setResultToBooleanTrueNode, i adjusted it so the following would now (also) be rewritten:&lt;/p&gt;

&lt;p&gt;   select true, .. from ..  -&amp;gt; select true from ..&lt;/p&gt;

&lt;p&gt;although not doing so didn&apos;t seem to matter.&lt;/p&gt;

&lt;p&gt;3) I also adjusted a negative test case in lang/subquery.sql to becoming a positive one. &lt;/p&gt;

&lt;p&gt;Rerunning regressions.&lt;/p&gt;


</comment>
                            <comment id="13153619" author="knutanders" created="Sat, 19 Nov 2011 23:08:34 +0000"  >&lt;p&gt;Why would we need a release note for this issue? I can&apos;t spot anything obvious that would cause problems for existing applications.&lt;/p&gt;</comment>
                            <comment id="13154299" author="dagw" created="Mon, 21 Nov 2011 17:18:09 +0000"  >&lt;p&gt;No. It&apos;s the old knee jerk reaction I&apos;m having here: improvements should be documented in the release documentation, if not in the release notes.  I guess we could change the issue back to &quot;bug&quot; and be done with it.&lt;br/&gt;
Regressions passed with patch #2.&lt;/p&gt;</comment>
                            <comment id="13154529" author="dagw" created="Mon, 21 Nov 2011 21:16:42 +0000"  >&lt;p&gt;Uploading derby-5501-3, small polishing of patch 2 only.&lt;/p&gt;</comment>
                            <comment id="13154544" author="dagw" created="Mon, 21 Nov 2011 21:24:27 +0000"  >&lt;p&gt;Committed derby-5501-3 as svn 1204712, resolving. This is a back-port candidate. &lt;/p&gt;

&lt;p&gt;Sandeep, would you have a chance to validate this change in your environment either by compiling Derby trunk with the patch or downloading a binary snapshot?&lt;/p&gt;</comment>
                            <comment id="13154547" author="dix411004" created="Mon, 21 Nov 2011 21:26:51 +0000"  >&lt;p&gt;Sure - what is the URL to the binary snapshot?&lt;br/&gt;
&amp;#8211;&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Sandeep&lt;br/&gt;
216-926-6696&lt;/p&gt;





&lt;p&gt;On Mon, Nov 21, 2011 at 4:24 PM, Dag H. Wanvik (Commented) (JIRA)&lt;/p&gt;</comment>
                            <comment id="13154567" author="dagw" created="Mon, 21 Nov 2011 21:45:14 +0000"  >&lt;p&gt;Thanks, I&apos;ll mail you the URL.&lt;/p&gt;</comment>
                            <comment id="13154681" author="knutanders" created="Mon, 21 Nov 2011 22:25:59 +0000"  >&lt;p&gt;Just to clarify my comment about the release note needed flag: I think it&apos;s fine to mention this improvement as a new feature in the release notes, but that&apos;s not what the release note needed flag is used for. It&apos;s used to indicate to the release note generator that it should look for a releaseNote.html file that describes compatibility issues caused by the changes. I did not mean to suggest that the issue type should be changed from improvement to bug.&lt;/p&gt;

&lt;p&gt;I&apos;ve added this issue to the 10.9 feature list at &lt;a href=&quot;http://wiki.apache.org/db-derby/DerbyTenNineOneRelease&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/DerbyTenNineOneRelease&lt;/a&gt; to make the release manager remember to mention it.&lt;/p&gt;</comment>
                            <comment id="13155374" author="dagw" created="Tue, 22 Nov 2011 19:49:59 +0000"  >&lt;p&gt;I&apos;m on board with that, Knut. I discussed briefly with Rick offline if we might need a way to call out improvement fixes from the &quot;noise&quot; of errors fixes in the release notes when they aren&apos;t quite new features, but we decided to keep things as they are, so adding it to the feature list is fine, although probably stretching the definition of feature. Still better than to complicate things further..&lt;/p&gt;</comment>
                            <comment id="13685128" author="knutanders" created="Mon, 17 Jun 2013 10:19:07 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12504140" name="derby-5501-1.diff" size="3430" author="dagw" created="Thu, 17 Nov 2011 23:36:52 +0000"/>
                            <attachment id="12504141" name="derby-5501-1.stat" size="171" author="dagw" created="Thu, 17 Nov 2011 23:36:52 +0000"/>
                            <attachment id="12504317" name="derby-5501-2.diff" size="11657" author="dagw" created="Sat, 19 Nov 2011 01:02:16 +0000"/>
                            <attachment id="12504316" name="derby-5501-2.diff" size="11657" author="dagw" created="Sat, 19 Nov 2011 01:02:16 +0000"/>
                            <attachment id="12504560" name="derby-5501-3.diff" size="11883" author="dagw" created="Mon, 21 Nov 2011 21:16:42 +0000"/>
                            <attachment id="12504561" name="derby-5501-3.stat" size="476" author="dagw" created="Mon, 21 Nov 2011 21:16:42 +0000"/>
                            <attachment id="12504082" name="derby-5501-repro.diff" size="1490" author="dagw" created="Thu, 17 Nov 2011 17:42:35 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12531993">DERBY-5506</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10421"><![CDATA[Seen in production]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 16 Nov 2011 14:28:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>217077</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0eiv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36171</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>