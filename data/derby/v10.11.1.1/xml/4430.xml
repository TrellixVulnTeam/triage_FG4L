<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:34:37 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4430/DERBY-4430.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4430] Make ij&apos;s SHOW and DESCRIBE commands more db agnostic</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4430</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;ij&apos;s SHOW and DESCRIBE commands use DatabaseMetaData in order to be portable to other databases than Derby, and in many cases they work fine with other databases. However, the variants of the commands that take a table name or a schema name assume that unquoted identifiers are converted to and stored in upper case internally. This is not true for all databases, and since these commands don&apos;t accept quoted identifiers, there&apos;s currently no way to access tables/schemas that are not all upper case.&lt;/p&gt;

&lt;p&gt;One possible fix is to make the identifier() method in ij.jj use the DatabaseMetaData methods storesLowerCaseIdentifiers(), storesMixedCaseIdentifiers() and storesUpperCaseIdentifiers() to decide whether it should convert the identifier to lower case, keep it unchanged, or convert it to upper case. Currently, that method always converts the identifiers to upper case.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12439663">DERBY-4430</key>
            <summary>Make ij&apos;s SHOW and DESCRIBE commands more db agnostic</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sleroux">Sylvain Leroux</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Nov 2009 14:05:31 +0000</created>
                <updated>Sat, 14 Nov 2009 22:34:23 +0000</updated>
                            <resolved>Sat, 14 Nov 2009 22:34:23 +0000</resolved>
                                    <version>10.6.1.0</version>
                                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12772512" author="knutanders" created="Mon, 2 Nov 2009 14:10:36 +0000"  >&lt;p&gt;Example using ij to access a PostgreSQL database:&lt;/p&gt;

&lt;p&gt;ij version 10.6&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:postgresql://localhost/test&apos;;&lt;br/&gt;
ij&amp;gt; create table my_table(x int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; show tables;&lt;br/&gt;
table_schem         |table_name                    |remarks             &lt;br/&gt;
------------------------------------------------------------------------&lt;br/&gt;
information_schema  |sql_features                  |NULL                &lt;br/&gt;
information_schema  |sql_implementation_info       |NULL                &lt;br/&gt;
.&lt;br/&gt;
.&lt;br/&gt;
.&lt;br/&gt;
pg_catalog          |pg_type                       |NULL                &lt;br/&gt;
public              |my_table                      |NULL                &lt;/p&gt;

&lt;p&gt;48 rows selected&lt;/p&gt;

&lt;p&gt;The newly created table (my_table) shows up in the output from &quot;SHOW TABLES&quot;, but it&apos;s stored in lower case. Showing only the tables in the public schema is not possible, since ij converts the identifier to upper case:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; show tables in public;&lt;br/&gt;
table_schem         |table_name                    |remarks             &lt;br/&gt;
------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;0 rows selected&lt;/p&gt;

&lt;p&gt;And ij only supports unquoted identifiers:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; show tables in &quot;public&quot;;&lt;br/&gt;
ERROR 42601: ERROR: syntax error at or near &quot;in&quot;&lt;/p&gt;</comment>
                            <comment id="12774696" author="sleroux" created="Sun, 8 Nov 2009 00:49:38 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Here is a first fix for this issue.&lt;br/&gt;
As Knut suggested, it uses &apos;stores&lt;/p&gt;
{Upper,Lower}
&lt;p&gt;CaseIdentifiers&apos;. However, I&apos;m not sure it&apos;s very efficient to call getMetaData each time an identifier is encountered.&lt;/p&gt;

&lt;p&gt;The other two attachments are:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4430&quot; title=&quot;Make ij&amp;#39;s SHOW and DESCRIBE commands more db agnostic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4430&quot;&gt;&lt;del&gt;DERBY-4430&lt;/del&gt;&lt;/a&gt;.sql: the SQL file I used to manually test that patch against Postgre8.3&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4430&quot; title=&quot;Make ij&amp;#39;s SHOW and DESCRIBE commands more db agnostic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4430&quot;&gt;&lt;del&gt;DERBY-4430&lt;/del&gt;&lt;/a&gt;.ij.out: the output of ij when running this file&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ve added a test in ij7 to ensure that lower case identifiers are still converted to upper case when we are running ij against Derby. &lt;br/&gt;
This test passed - but only after I removed two white lines at the top of ij7.sql ???&lt;/p&gt;

&lt;p&gt;One thing I was wondering: why using the ENGLISH locale when converting an identifier to upper/lower case?&lt;/p&gt;</comment>
                            <comment id="12774776" author="knutanders" created="Sun, 8 Nov 2009 13:45:41 +0000"  >&lt;p&gt;Thanks for the patch, Sylvain! I had a quick look at it and it looks good. I&apos;ll give it a try.&lt;/p&gt;

&lt;p&gt;To your questions:&lt;/p&gt;

&lt;p&gt;1) I wouldn&apos;t worry too much about the calls to getMetaData(). Both the client driver and the embedded driver cache the DatabaseMetaData object in the Connection object, and DatabaseMetaData caches the values returned by stores*CaseIdentifiers, so I think there would be little to gain by caching them ourselves in ij.&lt;/p&gt;

&lt;p&gt;2) The ij7.sql test is run by the ToolScripts JUnit test. I see the same failure as you if I run it with the old style runner, o.a...functionTests.harness.RunTest, but not if I run it using the JUnit runner:&lt;/p&gt;

&lt;p&gt;java junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.tools.ToolScripts&lt;/p&gt;

&lt;p&gt;3) The English locale is used to prevent the JVM&apos;s default locale from influencing how the identifiers are handled. For instance, in Turkish locale, toUpper(&quot;insert&quot;) returns &quot;&#304;NSERT&quot; (note the upper-case i with a dot), and toLower(&quot;INSERT&quot;) returns &quot;&#305;nsert&quot; (dot-less lower-case i).&lt;/p&gt;</comment>
                            <comment id="12775413" author="knutanders" created="Tue, 10 Nov 2009 13:44:15 +0000"  >&lt;p&gt;I&apos;ve tested the patch with MySQL (where storesMixedCaseIdentifier() returns true) and PostgreSQL (where storesLowerCaseIdentifier() returns true). The SHOW and DESCRIBE commands now work fine on those databases too.&lt;/p&gt;</comment>
                            <comment id="12776442" author="knutanders" created="Wed, 11 Nov 2009 13:19:32 +0000"  >&lt;p&gt;I ran all the regression tests, and found that there&apos;s one problem that makes many of the derbyall tests fail. The problem is that the identifier() method now requires that there is a connection, whereas it is used by some ij commands that don&apos;t require that there is currently a connection to the database. One example is the CONNECT command, which now fails if the connection is named:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; connect &apos;jdbc:derby:test;create=true&apos; as c1;&lt;br/&gt;
IJ ERROR: Unable to establish connection&lt;/p&gt;

&lt;p&gt;I think we need to make sure that the new identifier() method is only used by the SHOW and DESCRIBE commands that reference objects in the database.&lt;/p&gt;</comment>
                            <comment id="12777896" author="sleroux" created="Sat, 14 Nov 2009 12:18:05 +0000"  >&lt;p&gt;Thanks for all these explanations.&lt;/p&gt;

&lt;p&gt;Here is a second version of the patch. Now, I let the identifier() method untouched. But I have introduced an other method caIdentifier() (for case-aware identifier). Only the latter uses database meta data to check for the case policy of the DB.&lt;/p&gt;

&lt;p&gt;I&apos;ve changed the rules for DESCRIBE and SHOW to use that new method instead of the standard one.&lt;/p&gt;

&lt;p&gt;Concerning the tests, it works against Postgre8.3. I join the corresponding SQL and IJ output.&lt;/p&gt;

&lt;p&gt;I ran ToolScripts (with junit) without any error.&lt;br/&gt;
I ran derbyall (harness-style) with only an error with &quot;bootLock&quot; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. Here is the relevant part of the report:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;
			&lt;ul&gt;
				&lt;li&gt;
				&lt;ul&gt;
					&lt;li&gt;
					&lt;ul&gt;
						&lt;li&gt;
						&lt;ul&gt;
							&lt;li&gt;
							&lt;ul&gt;
								&lt;li&gt;
								&lt;ul&gt;
									&lt;li&gt;Diff file storeall/storemore/bootLock.diff&lt;/li&gt;
								&lt;/ul&gt;
								&lt;/li&gt;
							&lt;/ul&gt;
							&lt;/li&gt;
						&lt;/ul&gt;
						&lt;/li&gt;
					&lt;/ul&gt;
					&lt;/li&gt;
				&lt;/ul&gt;
				&lt;/li&gt;
			&lt;/ul&gt;
			&lt;/li&gt;
			&lt;li&gt;Start: bootLock jdk1.6.0_12 storeall:storemore 2009-11-14 12:05:11 ***&lt;br/&gt;
2,4d1&lt;br/&gt;
&amp;lt; expected exception&lt;br/&gt;
&amp;lt; SQLSTATE(XJ040): &lt;br/&gt;
&amp;lt; SQLSTATE(XSDB6): &lt;br/&gt;
Test Failed.&lt;/li&gt;
			&lt;li&gt;End:   bootLock jdk1.6.0_12 storeall:storemore 2009-11-14 12:05:44 ***
			&lt;ul&gt;
				&lt;li&gt;
				&lt;ul&gt;
					&lt;li&gt;
					&lt;ul&gt;
						&lt;li&gt;
						&lt;ul&gt;
							&lt;li&gt;
							&lt;ul&gt;
								&lt;li&gt;
								&lt;ul&gt;
									&lt;li&gt;Diff file derbyall/storeall/storemore/bootLock.diff&lt;/li&gt;
								&lt;/ul&gt;
								&lt;/li&gt;
							&lt;/ul&gt;
							&lt;/li&gt;
						&lt;/ul&gt;
						&lt;/li&gt;
					&lt;/ul&gt;
					&lt;/li&gt;
				&lt;/ul&gt;
				&lt;/li&gt;
			&lt;/ul&gt;
			&lt;/li&gt;
			&lt;li&gt;Start: bootLock jdk1.6.0_12 storeall:storemore 2009-11-14 12:49:45 ***&lt;br/&gt;
2,4d1&lt;br/&gt;
&amp;lt; expected exception&lt;br/&gt;
&amp;lt; SQLSTATE(XJ040): &lt;br/&gt;
&amp;lt; SQLSTATE(XSDB6): &lt;br/&gt;
Test Failed.&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12777980" author="knutanders" created="Sat, 14 Nov 2009 18:14:31 +0000"  >&lt;p&gt;Thanks, Sylvain! The patch looks good to me. I&apos;ll run the tests and commit it if I don&apos;t see any failures. I&apos;ve made one change to the patch, re-introducing the comment that was removed from the original identifier() method.&lt;/p&gt;

&lt;p&gt;The failure you&apos;re seeing in bootLock is probably not related to the patch. I found a bug report, &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4179&quot; title=&quot;bootLock.java fails with missing exception on z/OS with  pmz3160sr2ifix-20081021_01(SR2+IZ32776+IZ33456), and Windows Vista&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4179&quot;&gt;&lt;del&gt;DERBY-4179&lt;/del&gt;&lt;/a&gt;, which described the same failure. It was closed because it only happened once, but I&apos;ve reopened it and pointed it to this issue.&lt;/p&gt;</comment>
                            <comment id="12778008" author="knutanders" created="Sat, 14 Nov 2009 22:34:23 +0000"  >&lt;p&gt;All the tests ran cleanly in my environment. Committed revision 836277.&lt;/p&gt;

&lt;p&gt;Thanks for working on this, Sylvain!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12424955" name="DERBY-4430.ij.out" size="1911" author="sleroux" created="Sat, 14 Nov 2009 12:18:05 +0000"/>
                            <attachment id="12424954" name="DERBY-4430.patch" size="5540" author="sleroux" created="Sat, 14 Nov 2009 12:18:05 +0000"/>
                            <attachment id="12424953" name="DERBY-4430.sql" size="347" author="sleroux" created="Sat, 14 Nov 2009 12:18:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 8 Nov 2009 00:49:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>662</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10423"><![CDATA[Newcomer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0rm7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38292</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>