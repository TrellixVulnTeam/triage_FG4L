<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:22:47 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3877/DERBY-3877.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3877] SQL roles: build support for dblook</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3877</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;dblook does have support for grant/revoke although I am unsure of its quality, cf, my questions&lt;br/&gt;
in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3868&quot; title=&quot;dblook generates SET SCHEMA null and fails to produce correct schema for view&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3868&quot;&gt;DERBY-3868&lt;/a&gt;. Nevertheless, I choose to build support for roles for dblook.&lt;br/&gt;
Since role creation and the granting of roles is only allowed for the data base owner in the first basic&lt;br/&gt;
roles implementation, expanding the existing dblook tests to just dump the roles and roles grants should be easy.&lt;/p&gt;

&lt;p&gt;In general though, the dblook output file, in order to receate a database, must potentially use several connection, so the objects will be owned by the original owner. &lt;span class=&quot;error&quot;&gt;&amp;#91;The model for running the presently generated script run seems to be within one connection.&amp;#93;&lt;/span&gt; Setting roles properly to be able to recreate a view with the correct owner, for example, would be part of such a more advanced script which would be object owner aware.&lt;/p&gt;

&lt;p&gt;My intention with this issue is just to add support for dumping roles and role grants.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12404336">DERBY-3877</key>
            <summary>SQL roles: build support for dblook</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12359718">DERBY-2207</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Sep 2008 03:02:13 +0100</created>
                <updated>Mon, 4 May 2009 19:22:17 +0100</updated>
                            <resolved>Mon, 29 Sep 2008 23:45:03 +0100</resolved>
                                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12631116" author="dagw" created="Mon, 15 Sep 2008 20:52:07 +0100"  >&lt;p&gt;Ths patch, derby-3877-1, adds the capability to dblook to output role&lt;br/&gt;
definition and role grants in two separate sections, headers localized for&lt;br/&gt;
English only at this point.&lt;/p&gt;

&lt;p&gt;The tests have been modified to run with authentication and&lt;br/&gt;
sqlAuthorization so roles can be used in the test. &lt;/p&gt;

&lt;p&gt;Detailed patch comments:&lt;/p&gt;

&lt;p&gt;M      java/tools/org/apache/derby/tools/dblook.java&lt;/p&gt;

&lt;p&gt;Now also calls DB_Roles.doRoles. Now, also supply user and passwords&lt;br/&gt;
in URLs.&lt;/p&gt;

&lt;p&gt;A      java/tools/org/apache/derby/impl/tools/dblook/DB_Roles.java&lt;/p&gt;

&lt;p&gt;The new class that handles output of role definitions and grants.&lt;/p&gt;

&lt;p&gt;M      java/tools/org/apache/derby/impl/tools/dblook/DB_GrantRevoke.java&lt;/p&gt;

&lt;p&gt;I noticed that authorization ids were not properly quoted on output.&lt;br/&gt;
I added that, since user/role names can also contain quotes and weird&lt;br/&gt;
characters. If desired, I can factor this out as a separate&lt;br/&gt;
issue/patch.&lt;/p&gt;

&lt;p&gt;M      java/tools/org/apache/derby/loc/toolsmessages.properties&lt;/p&gt;

&lt;p&gt;English locale text for headers for role definitions and grants.&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/tools/dblook_makeDB.sql&lt;/p&gt;

&lt;p&gt;Modified script to include creation of roles and granting of roles.&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/tools/dblook_test.java&lt;/p&gt;

&lt;p&gt;Added dumping of sys.sysroles to check that recreated databases have&lt;br/&gt;
the same schema/DDL as the original ones.  Note the somewhat opaque&lt;br/&gt;
logic for creating a unique key for the rows to ensure stable sorting&lt;br/&gt;
for master comparison: I chose to concatenate roleid+grantor+grantee&lt;br/&gt;
to achieve this, since the existing machinery wasn&apos;t sufficient.&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/tools/dblook_test_territory_app.properties&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/tests/tools/dblook_test_app.properties&lt;br/&gt;
A      java/testing/org/apache/derbyTesting/functionTests/tests/tools/dblook_test_territory_derby.properties&lt;br/&gt;
A      java/testing/org/apache/derbyTesting/functionTests/tests/tools/dblook_test_derby.properties&lt;br/&gt;
A      java/testing/org/apache/derbyTesting/functionTests/tests/derbynet/dblook_test_net_territory_derby.properties&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/tests/derbynet/dblook_test_net_territory_app.properties&lt;br/&gt;
A      java/testing/org/apache/derbyTesting/functionTests/tests/derbynet/dblook_test_net_derby.properties&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/tests/derbynet/dblook_test_net_app.properties&lt;/p&gt;

&lt;p&gt;Modifies tests to run with authentiction and sqlAuthorization. Data base owner is&lt;br/&gt;
still APP, but a password is now used.&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/master/DerbyNetClient/dblook_test_net.out&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/master/DerbyNetClient/dblook_test_net_territory.out&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/master/DerbyNet/dblook_test_net.out&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/master/DerbyNet/dblook_test_net_territory.out&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/master/dblook_test.out&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/master/dblook_test_territory.out&lt;/p&gt;

&lt;p&gt;Updated master files: dumping of sys.sysroles is the essential difference&lt;/p&gt;

&lt;p&gt;Regressions ran ok.&lt;/p&gt;
</comment>
                            <comment id="12634585" author="rhillegas" created="Thu, 25 Sep 2008 20:46:31 +0100"  >&lt;p&gt;Hi Dag. The description section of this JIRA says that you need multiple connections in order to faithfully recreate a database using the script generated by dblook. Is this problem introduced by roles or does the problem exist in earlier Derby versions like 10.4? Thanks.&lt;/p&gt;</comment>
                            <comment id="12634590" author="rhillegas" created="Thu, 25 Sep 2008 21:09:29 +0100"  >&lt;p&gt;Thanks for the patch, Dag. One small hygiene comment:&lt;/p&gt;

&lt;p&gt;DB_Roles:&lt;/p&gt;

&lt;p&gt;  doRoles():&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;You may want to close rs before assigning it to a new query result&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="12634608" author="dagw" created="Thu, 25 Sep 2008 21:44:39 +0100"  >&lt;p&gt;Thanks for looking at this patch, Rick!&lt;/p&gt;

&lt;p&gt;&amp;gt; The description section of this JIRA says that you need&lt;br/&gt;
&amp;gt; multiple connections in order to faithfully recreate a database using&lt;br/&gt;
&amp;gt; the script generated by dblook. Is this problem introduced by roles or&lt;br/&gt;
&amp;gt; does the problem exist in earlier Derby versions like 10.4?&lt;/p&gt;

&lt;p&gt;No, I was thinking of the situation after SQL authorization was added&lt;br/&gt;
(&amp;gt;=10.2).  I think many objects could be created by the DBO by&lt;br/&gt;
creating the schemas for other users with an explicit authorization&lt;br/&gt;
clause and then creating the objects from the DBO connection. The&lt;br/&gt;
objects would then belong to that user.&lt;/p&gt;

&lt;p&gt;But there is still the question of objects that in the original db&lt;br/&gt;
would depend on privileges to other objects that are tracked using the&lt;br/&gt;
dependency system. For example, is user X creates a view X_view that&lt;br/&gt;
depends on a select privilege to a table belonging to a user Y, then I&lt;br/&gt;
think that view would need to be created by a connection with user&lt;br/&gt;
authentication set to X in order for the correct dependency to be&lt;br/&gt;
created and tracked (if the DBO creates this view, a privilege would&lt;br/&gt;
not be required I assume). If the select privilege is later revoked,&lt;br/&gt;
we woul dget the wrong behavior if this is not tracked; the view would&lt;br/&gt;
not be impacted.&lt;/p&gt;

&lt;p&gt;Adding roles just adds more of the same problems. If the DBO had some&lt;br/&gt;
way of setting effective authentication id (think &quot;su(1)&quot;) the dblook&lt;br/&gt;
script would be runnable from the dbo connection (although the order&lt;br/&gt;
in which operations would need to be performed needs a topological&lt;br/&gt;
sort: privilege grants and object creations need to be interleaved the&lt;br/&gt;
right way).&lt;/p&gt;

&lt;p&gt;I can&apos;t find any existing tests for dblook and db with sqlAuthorization set.&lt;/p&gt;

&lt;p&gt;&amp;gt; &lt;br/&gt;
&amp;gt; Thanks for the patch, Dag. One small hygiene comment:&lt;br/&gt;
&amp;gt;     - You may want to close rs before assigning it to a new query result&lt;/p&gt;

&lt;p&gt;Thanks, will do.&lt;/p&gt;</comment>
                            <comment id="12634617" author="rhillegas" created="Thu, 25 Sep 2008 22:02:14 +0100"  >&lt;p&gt;Thanks, that was very helpful, Dag. Are these issues with dblook tracked by a JIRA?&lt;/p&gt;</comment>
                            <comment id="12634625" author="dagw" created="Thu, 25 Sep 2008 22:11:51 +0100"  >&lt;p&gt;Not as far as I know; I didn&apos;t find anything. But I did file &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3868&quot; title=&quot;dblook generates SET SCHEMA null and fails to produce correct schema for view&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3868&quot;&gt;DERBY-3868&lt;/a&gt; which&lt;br/&gt;
could be expanded to cover this I think. I briffly mentioned the issue&lt;br/&gt;
of SQL authorization in that jira.&lt;/p&gt;</comment>
                            <comment id="12634718" author="dagw" created="Fri, 26 Sep 2008 01:50:32 +0100"  >&lt;p&gt;Uploading revision 2 of this patch. It&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;closes the result set Rick pointed to&lt;/li&gt;
	&lt;li&gt;adds code in the harness files RunTest.java and NetServer.java&lt;br/&gt;
  to be able to shut down the server cleanly. It needs user/password with the&lt;br/&gt;
  modified dblook test which runs with authorization on. I noticed that net version of test hung&lt;br/&gt;
  when shutting down. The server process stopped eventually on timeout though, so it did work&lt;br/&gt;
  in the previous revision, but it seems cleaner to add this fix. And it saves test clock time.&lt;br/&gt;
  Hopefully we can move the dblook test to JUnit sometime soon.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I ran dblook_test&lt;span class=&quot;error&quot;&gt;&amp;#91;_territory&amp;#93;&lt;/span&gt;.java, dblook_test_net&lt;span class=&quot;error&quot;&gt;&amp;#91;_territory&amp;#93;&lt;/span&gt; individually as well as derbynetclientmats ok. &lt;br/&gt;
Running entire regression over again now.&lt;/p&gt;</comment>
                            <comment id="12635570" author="dagw" created="Mon, 29 Sep 2008 23:45:03 +0100"  >&lt;p&gt;Committed patch derby-3877-2 as 700295, closing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12403691">DERBY-3868</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12405234">DERBY-3884</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12390128" name="derby-3877-1.diff" size="35911" author="dagw" created="Mon, 15 Sep 2008 20:52:07 +0100"/>
                            <attachment id="12390129" name="derby-3877-1.stat" size="1864" author="dagw" created="Mon, 15 Sep 2008 20:52:07 +0100"/>
                            <attachment id="12390980" name="derby-3877-2.diff" size="41334" author="dagw" created="Fri, 26 Sep 2008 01:50:32 +0100"/>
                            <attachment id="12390981" name="derby-3877-2.stat" size="2024" author="dagw" created="Fri, 26 Sep 2008 01:50:32 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 25 Sep 2008 19:46:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31039</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0xs7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39291</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>