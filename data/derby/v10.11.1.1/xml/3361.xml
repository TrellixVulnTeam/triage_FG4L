<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:28:26 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3361/DERBY-3361.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3361] Specifying a non-existant slaveHost for startSlave seemingly succeeds in starting slave mode.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3361</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Specifying a non-existant slaveHost for startSlave seemingly succeeds in starting slave mode.&lt;br/&gt;
-----------------------------------------------------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt; CONNECT &apos;jdbc:derby://atum11:9999/test;startSlave=true;slaveHost=noSuchHost;slavePort=8989&apos;;&lt;br/&gt;
ERROR XRE08: DERBY SQL error: SQLCODE: -1, SQLSTATE: XRE08, SQLERRMC: Replication slave mode started successfully for database &apos;test&apos;. Connection refused because the database is in replication slave mode. &lt;/p&gt;



&lt;p&gt;Slave derby.log shows a NPE:&lt;br/&gt;
--------------------------------------&lt;/p&gt;

&lt;p&gt;2008-01-29 11:52:40.050 GMT:&lt;br/&gt;
 Booting Derby version The Apache Software Foundation - Apache Derby - 10.4.0.0 alpha - (615841M): instance c013800d-0117-c563-d051-000003bf6570&lt;br/&gt;
on database directory /export/home/tmp/os136789/Replication_common_Trunk/slave/test  &lt;/p&gt;

&lt;p&gt;Database Class Loader started - derby.database.classpath=&apos;&apos;&lt;/p&gt;

&lt;p&gt;2008-01-29 11:52:40.308 GMT:&lt;br/&gt;
Shutting down instance c013800d-0117-c563-d051-000003bf6570&lt;br/&gt;
----------------------------------------------------------------&lt;br/&gt;
----------------------------------------------------------------&lt;br/&gt;
2008-01-29 11:52:40.320 GMT:&lt;br/&gt;
 Booting Derby version The Apache Software Foundation - Apache Derby - 10.4.0.0 alpha - (615841M): instance a816c00e-0117-c563-d051-000003bf6570&lt;br/&gt;
on database directory /export/home/tmp/os136789/Replication_common_Trunk/slave/test  &lt;/p&gt;

&lt;p&gt;2008-01-29 11:52:40.814 GMT Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_2,5,main&amp;#93;&lt;/span&gt; Cleanup action starting&lt;br/&gt;
ERROR XRE08: Replication slave mode started successfully for database &apos;test&apos;. Connection refused because the database is in replication slave mode. &lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:290)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:423)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(EmbedConnection30.java:73)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection40.&amp;lt;init&amp;gt;(EmbedConnection40.java:54)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:68)&lt;br/&gt;
	at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:211)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:119)&lt;br/&gt;
	at org.apache.derby.impl.drda.Database.makeConnection(Database.java:234)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.getConnFromDatabaseName(DRDAConnThread.java:1346)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.verifyUserIdPassword(DRDAConnThread.java:1296)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.parseSECCHK(DRDAConnThread.java:3033)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.parseDRDAConnection(DRDAConnThread.java:1090)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:932)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:277)&lt;br/&gt;
Cleanup action completed&lt;br/&gt;
2008-01-29 11:52:40.816 GMT Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_2,5,main&amp;#93;&lt;/span&gt; Cleanup action starting&lt;br/&gt;
ERROR XRE08: Replication slave mode started successfully for database &apos;test&apos;. Connection refused because the database is in replication slave mode. &lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:290)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:423)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(EmbedConnection30.java:73)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection40.&amp;lt;init&amp;gt;(EmbedConnection40.java:54)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:68)&lt;br/&gt;
	at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:211)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:119)&lt;br/&gt;
	at org.apache.derby.impl.drda.Database.makeConnection(Database.java:234)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.getConnFromDatabaseName(DRDAConnThread.java:1346)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.verifyUserIdPassword(DRDAConnThread.java:1296)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.parseSECCHK(DRDAConnThread.java:3033)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.parseDRDAConnection(DRDAConnThread.java:1090)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:932)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:277)&lt;br/&gt;
Cleanup action completed&lt;br/&gt;
2008-01-29 11:52:40.816 GMT Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_2,5,main&amp;#93;&lt;/span&gt; (DATABASE = test), (DRDAID = &lt;/p&gt;
{1}
&lt;p&gt;), Replication slave mode started successfully for database &apos;test&apos;. Connection refused because the database is in replication slave mode. &lt;br/&gt;
New exception raised during cleanup null&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.services.replication.slave.SlaveController.stopSlave(SlaveController.java:259)&lt;br/&gt;
	at org.apache.derby.impl.services.replication.slave.SlaveController.stopSlave(SlaveController.java:287)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.stop(SlaveDatabase.java:149)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.stop(TopService.java:405)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.shutdown(TopService.java:349)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.shutdown(BaseMonitor.java:235)&lt;br/&gt;
	at org.apache.derby.impl.db.DatabaseContextImpl.cleanupOnError(DatabaseContextImpl.java:60)&lt;br/&gt;
	at org.apache.derby.iapi.services.context.ContextManager.cleanupOnError(ContextManager.java:330)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.cleanupOnError(TransactionResourceImpl.java:419)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:337)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:1859)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleStopReplicationSlave(EmbedConnection.java:747)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:296)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(EmbedConnection30.java:73)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection40.&amp;lt;init&amp;gt;(EmbedConnection40.java:54)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:68)&lt;br/&gt;
	at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:211)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:119)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.handleShutdown(SlaveDatabase.java:317)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.access$200(SlaveDatabase.java:73)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase$SlaveDatabaseBootThread.run(SlaveDatabase.java:293)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
Cleanup action completed&lt;/p&gt;
</description>
                <environment>Trunk (615841) + patch &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3205&quot; title=&quot;Replication: Add connection url command options for starting, stopping slave and for failover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3205&quot;&gt;&lt;strike&gt;DERBY-3205&lt;/strike&gt;&lt;/a&gt;/stopSlave_v1b </environment>
        <key id="12387373">DERBY-3361</key>
            <summary>Specifying a non-existant slaveHost for startSlave seemingly succeeds in starting slave mode.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jorgenlo">J&#248;rgen L&#248;land</assignee>
                                    <reporter username="olesolberg">Ole Solberg</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Jan 2008 12:02:13 +0000</created>
                <updated>Tue, 4 Mar 2008 08:54:28 +0000</updated>
                            <resolved>Fri, 8 Feb 2008 08:32:01 +0000</resolved>
                                    <version>10.4.1.3</version>
                                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12563489" author="jorgenlo" created="Tue, 29 Jan 2008 12:18:57 +0000"  >&lt;p&gt;Currently, any attempt of running startSlave that does not fail authorization will report that slave mode was started successfully. Before returning the &quot;successfully started&quot; message to the client, we need to verify that everything is well. This issue will handle the reported problem and any other reason for slave replication to fail starting.&lt;/p&gt;

&lt;p&gt;Note that the reason for this problem is that when SlaveDatabase is booted, it kicks off a new thread that boots the store modules. Hence, any exception thrown as part of booting store is not currently propagated to the client.&lt;/p&gt;</comment>
                            <comment id="12563500" author="oysteing" created="Tue, 29 Jan 2008 12:55:51 +0000"  >&lt;p&gt;Would it be an idea to wait in SlaveDatabase#boot until contact has been established between master and slave?  That would make it possible to report problems that occur during start-up.&lt;/p&gt;</comment>
                            <comment id="12563513" author="jorgenlo" created="Tue, 29 Jan 2008 13:20:53 +0000"  >&lt;p&gt;I think that&apos;s a good suggestion, &#216;ystein. Since the thread that boots store and starts replication functionality cannot contact SlaveDatabase &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, I think the best way to do this is to let the client thread pull the information from the SlaveController.&lt;/p&gt;

&lt;p&gt;An implication of this solution is, of course, that the connection attempt trying to start the slave will hang until the master has been started. I think that will be acceptable.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; Until the client thread leaves SlaveDatabase#boot, the Database service cannot be found by calling Monitor.findService&lt;/p&gt;</comment>
                            <comment id="12563992" author="jorgenlo" created="Wed, 30 Jan 2008 12:06:08 +0000"  >&lt;p&gt;Working on this issue, I realize that host and port information would help debugging failed replication startups. I think we should print to derby.log which host and port the ServerSocket is listening to. I plan to add this in the same patch.&lt;/p&gt;</comment>
                            <comment id="12565347" author="jorgenlo" created="Mon, 4 Feb 2008 13:09:45 +0000"  >&lt;p&gt;The attached patch makes the startSlave connection attempt hang until slave replication mode is confirmed started or until an error occurs.&lt;/p&gt;

&lt;p&gt;In addition, the patch adds host and port information to a derby.log message and a few exceptions for easier debugging. &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3356&quot; title=&quot;&amp;quot;Replication slave got a fatal error for database &amp;#39;test&amp;#39;. Replication will be stopped.&amp;quot; on insert on master db.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3356&quot;&gt;&lt;del&gt;DERBY-3356&lt;/del&gt;&lt;/a&gt; is also fixed by this patch.&lt;/p&gt;

&lt;p&gt;All tests passed; the patch is ready for review.&lt;/p&gt;</comment>
                            <comment id="12565697" author="oysteing" created="Tue, 5 Feb 2008 10:49:17 +0000"  >&lt;p&gt;Thanks for patch, J&#248;rgen.  It looks good, I have only minor remarks:&lt;/p&gt;

&lt;p&gt;1. ReplicationMessageReceive:  &lt;/p&gt;

&lt;p&gt;   a. Missing param javadoc for dbname in constructor.&lt;/p&gt;

&lt;p&gt;2. SlaveController: &lt;/p&gt;

&lt;p&gt;   a. Unused import: Property&lt;/p&gt;

&lt;p&gt;3. SlaveDatabase:&lt;/p&gt;

&lt;p&gt;   a. Unused import: UpdateServiceProperties&lt;/p&gt;

&lt;p&gt;   b. setSlaveFactory is not used anymore.  Any reason to keep it?&lt;/p&gt;

&lt;p&gt;   c. verifySuccessfulBoot: Suggest moving the logic of if-test to the&lt;br/&gt;
      while clause.  That should eliminate the need for the local&lt;br/&gt;
      variable &apos;verified&apos;.&lt;/p&gt;

</comment>
                            <comment id="12565730" author="jorgenlo" created="Tue, 5 Feb 2008 12:37:29 +0000"  >&lt;p&gt;Hi &#216;ystein, &lt;/p&gt;

&lt;p&gt;Thanks for reviewing the patch. Patch 1b addresses your comments.&lt;/p&gt;</comment>
                            <comment id="12566064" author="oysteing" created="Wed, 6 Feb 2008 10:00:46 +0000"  >&lt;p&gt;Thanks for the fix, J&#248;rgen.&lt;br/&gt;
Patch v1b committed as revision 618944.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12374673" name="derby-3361-1a.diff" size="16720" author="jorgenlo" created="Mon, 4 Feb 2008 13:09:37 +0000"/>
                            <attachment id="12374672" name="derby-3361-1a.stat" size="638" author="jorgenlo" created="Mon, 4 Feb 2008 13:09:25 +0000"/>
                            <attachment id="12374768" name="derby-3361-1b.diff" size="17824" author="jorgenlo" created="Tue, 5 Feb 2008 12:37:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 29 Jan 2008 12:18:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23595</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0z87:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39525</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>