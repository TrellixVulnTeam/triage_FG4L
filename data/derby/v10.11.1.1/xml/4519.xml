<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:17:05 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4519/DERBY-4519.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4519] Infinite loop in StreamFileContainer.writeColumn</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4519</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The offset and length argument have been swapped in the calls to InputStream.read(byte,offset, length) and write(byte,offset, length). This code is inside a do-while (true) loop, and the only normal way out is when InputStream.read returns -1. This will never happen since the stream is asked to read zero bytes. Derby ends up eating up all available CPU, limited to a single core / CPU.&lt;/p&gt;

&lt;p&gt;The bug hasn&apos;t been observed because Derby is materializing all values when calling this code. Enabling streaming capabilities in the sorter revealed it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12445938">DERBY-4519</key>
            <summary>Infinite loop in StreamFileContainer.writeColumn</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kristwaa">Kristian Waagan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 Jan 2010 15:10:58 +0000</created>
                <updated>Tue, 9 Feb 2010 10:35:51 +0000</updated>
                            <resolved>Wed, 20 Jan 2010 12:46:47 +0000</resolved>
                                    <version>10.0.2.1</version>
                    <version>10.1.3.1</version>
                    <version>10.2.2.0</version>
                    <version>10.3.3.0</version>
                    <version>10.4.2.0</version>
                    <version>10.5.3.0</version>
                    <version>10.6.1.0</version>
                                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12802300" author="kristwaa" created="Tue, 19 Jan 2010 15:16:49 +0000"  >&lt;p&gt;Attached patch 1a, which swaps the length and offset arguments.&lt;/p&gt;</comment>
                            <comment id="12802307" author="knutanders" created="Tue, 19 Jan 2010 15:45:56 +0000"  >&lt;p&gt;Another problem with this code is that it uses InputStream.available() to decide the size of the read buffer. If available() returns 0 (which it is allowed to) an empty read buffer is used, and this will also lead to an infinite loop, I think.&lt;/p&gt;

&lt;p&gt;The patch looks like an improvement, though. Minor nit: Calling the read(byte[]) method that takes no offset/length arguments would be equivalent to read(bufData,0,bufferLen) and slightly simpler.&lt;/p&gt;</comment>
                            <comment id="12802732" author="kristwaa" created="Wed, 20 Jan 2010 07:58:56 +0000"  >&lt;p&gt;Hi Knut,&lt;/p&gt;

&lt;p&gt;I think we can address the additional problem you spotted here as well. The question is which thresholds to use.&lt;br/&gt;
Assuming available() will give reasonable answers in most cases (may very well be the case if we are reading from internal store streams), which limits should we impose on the buffer size?&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;64, 8192&amp;#93;&lt;/span&gt;, which could look like something like this?&lt;br/&gt;
(BufferedInputStream uses 8 KB as default buffer size)&lt;/p&gt;

&lt;p&gt;int bufferLen = Math.min(Math.max(in.available(), 64), 8192).&lt;/p&gt;

&lt;p&gt;Based on the experiences from &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3791&quot; title=&quot;Excessive memory usage when fetching small Clobs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3791&quot;&gt;&lt;del&gt;DERBY-3791&lt;/del&gt;&lt;/a&gt;, I would be careful about defaulting to a largish size if we do get reasonable answers from available(). &lt;/p&gt;</comment>
                            <comment id="12802757" author="knutanders" created="Wed, 20 Jan 2010 09:07:13 +0000"  >&lt;p&gt;Hi Kristian,&lt;/p&gt;

&lt;p&gt;The suggested bounding of the buffer size sounds fine. We should probably also add a short comment about why it&apos;s needed.&lt;/p&gt;</comment>
                            <comment id="12802785" author="kristwaa" created="Wed, 20 Jan 2010 10:34:29 +0000"  >&lt;p&gt;Patch 2a deprecates patch 1a, and it also addresses the issue (and the nit) noted by Knut Anders.&lt;br/&gt;
The buffer size will now be determined by InputStream.available() given that it returns a value between 64 and 8192 (8 KB).&lt;br/&gt;
Since this code path doesn&apos;t appear to be reached currently, I don&apos;t expect any changes in behavior at this point.&lt;br/&gt;
The fix is an incremental improvement regardless of the exact values of the limits , as the existing code would cause Derby to enter an infinite loop if executed.&lt;/p&gt;

&lt;p&gt;Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="12802807" author="knutanders" created="Wed, 20 Jan 2010 12:20:32 +0000"  >&lt;p&gt;Thanks, Kristian. The patch looks good. +1&lt;/p&gt;</comment>
                            <comment id="12802813" author="kristwaa" created="Wed, 20 Jan 2010 12:46:47 +0000"  >&lt;p&gt;Thanks for the review,  Knut Anders.&lt;/p&gt;

&lt;p&gt;I committed patch 2a to trunk with revision 901165.&lt;br/&gt;
Back-ported to the 10.5 branch with revision 901167 for good measure, but I don&apos;t expect that we will enable the affected code on that branch. For the same reason I&apos;m not planning to back-port to older branches.&lt;/p&gt;</comment>
                            <comment id="12831404" author="kristwaa" created="Tue, 9 Feb 2010 10:35:51 +0000"  >&lt;p&gt;Closing the issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12430747" name="derby-4519-1a-argument_swap.diff" size="701" author="kristwaa" created="Tue, 19 Jan 2010 15:16:49 +0000"/>
                            <attachment id="12430870" name="derby-4519-2a-infinite_loop_fixes.diff" size="1535" author="kristwaa" created="Wed, 20 Jan 2010 10:34:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 19 Jan 2010 15:45:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24311</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0r5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38217</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>