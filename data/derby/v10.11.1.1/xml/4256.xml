<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:09:28 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4256/DERBY-4256.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4256] allow alter table to increase the maximum size of a blob and a clob.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4256</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Allow new syntax that allows user to alter the maximum length of a blob and/or clob column:&lt;br/&gt;
ALTER TABLE binarydata ALTER COLUMN data SET DATA TYPE blob(128M)&lt;/p&gt;

&lt;p&gt;The syntax should match up with the existing functionality to increase the size of varchar fields.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12427044">DERBY-4256</key>
            <summary>allow alter table to increase the maximum size of a blob and a clob.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="eranda">Eranda Sooriyabandara</assignee>
                                    <reporter username="mikem">Mike Matrigali</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Jun 2009 18:02:45 +0100</created>
                <updated>Fri, 4 Dec 2009 17:55:54 +0000</updated>
                            <resolved>Tue, 11 Aug 2009 04:42:13 +0100</resolved>
                                    <version>10.5.1.1</version>
                                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12715987" author="mikem" created="Wed, 3 Jun 2009 18:03:33 +0100"  >&lt;p&gt;I logged this issue based on the following discussion list posting:&lt;/p&gt;

&lt;p&gt;Hello again,&lt;/p&gt;

&lt;p&gt;As a corollary to my upgrade question, I have another issue I would like to get some input on.&lt;/p&gt;

&lt;p&gt;Several old databases in production were created with blob columns at the then default blob size of 1mb.  How can I go about upgrading these columns to be longer?&lt;/p&gt;

&lt;p&gt;This is the best approach I&apos;ve come up with so far:&lt;/p&gt;

&lt;p&gt;ALTER TABLE binarydata ADD COLUMN data2 blob(128M)&lt;br/&gt;
UPDATE binarydata SET data2 = data;&lt;br/&gt;
ALTER TABLE binarydata DROP COLUMN data RESTRICT;&lt;br/&gt;
RENAME COLUMN binarydata.data2 TO data;&lt;/p&gt;

&lt;p&gt;The issue with this approach is that some deployed databases are nearly 1GB in size with a large portion of that being in this table I&apos;m trying to adjust. When I ran this query as a test on such a database, the size of the db on disk balloon to over twice its starting size, and then failed because I was running it on a temp drive without enough storage to complete, so I haven&apos;t been able to fully test even if this will work.&lt;/p&gt;

&lt;p&gt;Is there a good reason why blob columns can&apos;t have their size adjusted directly?  I&apos;ve tried:&lt;/p&gt;

&lt;p&gt;ALTER TABLE binarydata ALTER COLUMN data SET DATA TYPE blob(128M)&lt;/p&gt;

&lt;p&gt;but this failed with an error.&lt;/p&gt;

&lt;p&gt;Any ideas?&lt;/p&gt;

&lt;p&gt;Evan&lt;/p&gt;</comment>
                            <comment id="12715990" author="mikem" created="Wed, 3 Jun 2009 18:09:31 +0100"  >&lt;p&gt;I believe that this project would be a good one for a new comer.  I don&apos;t think it would be too hard.  &lt;/p&gt;

&lt;p&gt;I would suggest finding the code path that allows alter table to increase the size of a varchar field and &lt;br/&gt;
mimic the code to apply to blob and clob fields.  It will require some parser changes and some execution&lt;br/&gt;
time changes.  The files can be pointed out if necessary.&lt;/p&gt;

&lt;p&gt;What makes this easy is to only allow INCREASE of size.  For blob and clob the size field is really only used&lt;br/&gt;
for error checking at the higher levels of the code, there is no storage difference between a small one and&lt;br/&gt;
a large one.  No format difference.  Also no space difference as we only use space to store whatever the&lt;br/&gt;
actual size is.  By only allowing increase then there is no need to go and check the length of every value, and&lt;br/&gt;
figure out what to do if there exists a value that exceeds the new proposed maximum.&lt;/p&gt;</comment>
                            <comment id="12715995" author="evan.leonard" created="Wed, 3 Jun 2009 18:24:44 +0100"  >&lt;p&gt;I&apos;ll try and take a look. Can you point me toward the VARCHAR work?&lt;/p&gt;</comment>
                            <comment id="12715998" author="bryanpendleton" created="Wed, 3 Jun 2009 18:35:42 +0100"  >&lt;p&gt;Hi Evan, thanks for having a look at this.&lt;/p&gt;

&lt;p&gt;I think the first place to start is with the &apos;checkUserType()&apos; method in&lt;br/&gt;
o.a.d.impl.sql.compile.ModifyColumnNode. Look around line 118.&lt;/p&gt;</comment>
                            <comment id="12716029" author="evan.leonard" created="Wed, 3 Jun 2009 19:58:04 +0100"  >&lt;p&gt;The changes there in ModifyColumnNode are straight forward enough. When Mike was referring to &quot;parser changes and some execution &lt;br/&gt;
time changes&quot; do you have a sense of where he&apos;s referring?&lt;/p&gt;</comment>
                            <comment id="12716055" author="bryanpendleton" created="Wed, 3 Jun 2009 21:32:53 +0100"  >&lt;p&gt;I&apos;m cautiously optimistic that no additional changes will be needed. I&apos;m eager to see what&lt;br/&gt;
results you find by simply modifying ModifyColumnNode.java.&lt;/p&gt;

&lt;p&gt;The relevant portion of the grammar is around line 12740 in the columnAlterClause()&lt;br/&gt;
method of impl/sql/compile/sqlgrammar.jj&lt;/p&gt;

&lt;p&gt;The relevant execution code is the modifyColumnType() method in&lt;br/&gt;
o.a.d.impl.sql.execute.AlterTableConstantAction&lt;/p&gt;

&lt;p&gt;I took a quick peek at both places and it &lt;b&gt;seemed&lt;/b&gt; like they should not require changes&lt;br/&gt;
for the extension to blob/clob. But it was a very quick peek...&lt;/p&gt;</comment>
                            <comment id="12716063" author="mikem" created="Wed, 3 Jun 2009 21:58:18 +0100"  >&lt;p&gt;go ahead and ignore my comments about parser, it was not based on reading the code.  I am sure about the&lt;br/&gt;
store part of my comments that it is safe to just go ahead and change the catalogs and not have to do anything&lt;br/&gt;
to the data.&lt;/p&gt;

&lt;p&gt;.  Bryan has the &lt;br/&gt;
experience in this area.  I was just thinking that it was going to add syntax and did not realize that datatype&lt;br/&gt;
part of the syntax would not need parser changes, but it looks like the part that&lt;br/&gt;
handles different datatypes does not really need parser changes.  The called routines can handle many&lt;br/&gt;
different datatypes.   &lt;/p&gt;</comment>
                            <comment id="12717568" author="knutanders" created="Tue, 9 Jun 2009 06:36:17 +0100"  >&lt;p&gt;This looks like a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3920&quot; title=&quot;Allow altering size limits for blob and clob columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3920&quot;&gt;&lt;del&gt;DERBY-3920&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12736479" author="eranda" created="Wed, 29 Jul 2009 08:05:16 +0100"  >&lt;p&gt;Hi Bryan,&lt;br/&gt;
I made some changes to the code as,&lt;br/&gt;
if (!(typeName.equals(TypeId.VARCHAR_NAME)) &amp;amp;&amp;amp;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;Unable to render embedded object: File ((typeName.equals(TypeId.VARBIT_NAME))&amp;amp;&amp;amp;) not found.&lt;/span&gt;(typeName.equals(TypeId.BLOB_NAME)))&lt;/p&gt;
{
throw StandardException.newException(
 SQLState.LANG_MODIFY_COLUMN_INVALID_TYPE);
}


&lt;p&gt;and this succeed the test&lt;/p&gt;

&lt;p&gt;ij version 10.6&lt;/p&gt;

&lt;p&gt;ij&amp;gt; connect &apos;jdbc:derby:testdb;create=true&apos;;&lt;/p&gt;

&lt;p&gt;ij&amp;gt; create table binarydata(c1 int,data blob(64));&lt;/p&gt;

&lt;p&gt;0 rows inserted/updated/deleted&lt;/p&gt;

&lt;p&gt;ij&amp;gt; ALTER TABLE binarydata ALTER COLUMN data SET DATA TYPE blob(256M);&lt;/p&gt;

&lt;p&gt;0 rows inserted/updated/deleted&lt;br/&gt;
Here I am attaching the patch file with this.&lt;/p&gt;</comment>
                            <comment id="12736489" author="eranda" created="Wed, 29 Jul 2009 08:37:17 +0100"  >&lt;p&gt;Hi Bryan,My last patch I was not think about the clob and I think to include&lt;br/&gt;
a little coding to enable the clob to be increase its size.&lt;br/&gt;
Here I attach the new patch with this.&lt;/p&gt;</comment>
                            <comment id="12736701" author="mamtas" created="Wed, 29 Jul 2009 17:47:58 +0100"  >&lt;p&gt;Eranda, I quickly went through your patch and it looks good to me. Would it be possible to try to create smaller blob/clob columns, increase their size and then insert data which is bigger than the original size but smaller than the new size to see if we are able to store and retrieve bigger data. Once we know this works fine on a standalone case, we should add a junit test to put it into our regression suite for this change.&lt;/p&gt;</comment>
                            <comment id="12740590" author="eranda" created="Fri, 7 Aug 2009 16:37:18 +0100"  >&lt;p&gt;Hi Bryan,Here is the java file I reproduce the bug. I find this code in a&lt;br/&gt;
IBM help site and edited my self.&lt;br/&gt;
I crated a clob column of 10K and alter that column to 20K.Also I use a&lt;br/&gt;
A.txt file about 19K with this to enter to the clob column and to show that&lt;br/&gt;
it works.&lt;br/&gt;
Thanks&lt;br/&gt;
Eranda&lt;/p&gt;

</comment>
                            <comment id="12740903" author="bryanpendleton" created="Sat, 8 Aug 2009 16:48:57 +0100"  >&lt;p&gt;Hi Eranda,&lt;/p&gt;

&lt;p&gt;This code seems like a good approach.&lt;/p&gt;

&lt;p&gt;Clob.java reproduces the bug for me, and I also confirmed that if I apply your change to ModifyColumnNode.java,&lt;br/&gt;
Clob.java then works correctly (it can insert the 20K clob into the column which has been altered from 10K).&lt;/p&gt;

&lt;p&gt;This is good progress, thanks for working on the test program.&lt;/p&gt;

&lt;p&gt;I think that we could avoid the need for a separate text file by constructing a string in memory , &lt;br/&gt;
and then constructing an input stream from the string by using ByteArrayInputStream and String.getBytes.&lt;/p&gt;

&lt;p&gt;That might make the test program easier to integrate into one of our existing classes&lt;/p&gt;

&lt;p&gt;For example, here&apos;s a simple method to construct a string in memory of an arbitrary length:&lt;/p&gt;

&lt;p&gt;    private static  String  makeString( int count )&lt;/p&gt;
    {
        char[]  raw = new char[ count ];
        Arrays.fill( raw, &apos;a&apos; );
        return new String( raw );
    }</comment>
                            <comment id="12740908" author="eranda" created="Sat, 8 Aug 2009 17:25:17 +0100"  >&lt;p&gt;Hi Bryan,&lt;br/&gt;
I created updated the AlterTableTest according to the new issue and add the&lt;br/&gt;
method testJira4256().&lt;br/&gt;
I think this will be fine as a test.(It takes my full day).What you think&lt;br/&gt;
about the test?&lt;br/&gt;
And the exception give as &quot;Only columns of type VARCHAR may have their&lt;br/&gt;
length altered&quot;.So we must add CLOB and BLOB as data types that can alter&lt;br/&gt;
its length.&lt;br/&gt;
Thanks&lt;br/&gt;
Eranda&lt;/p&gt;</comment>
                            <comment id="12740916" author="bryanpendleton" created="Sat, 8 Aug 2009 18:02:51 +0100"  >&lt;p&gt;Hi Eranda, this looks like a very good test, thanks for putting it together.&lt;/p&gt;

&lt;p&gt;I believe that you can alter the message by editing the file&lt;/p&gt;

&lt;p&gt;  java/engine/org/apache/derby/loc/messages.xml&lt;/p&gt;

&lt;p&gt;If you want to investigate modifying the message, then after that I&apos;ll&lt;br/&gt;
look into committing this fix.&lt;/p&gt;</comment>
                            <comment id="12740922" author="eranda" created="Sat, 8 Aug 2009 18:29:17 +0100"  >&lt;p&gt;Hi Bryan,&lt;br/&gt;
Here I change the error message and I am attaching the changed patch.&lt;/p&gt;</comment>
                            <comment id="12741355" author="bryanpendleton" created="Mon, 10 Aug 2009 15:52:29 +0100"  >&lt;p&gt;Thanks Eranda for the updated patch. I am running the full regression suite and will&lt;br/&gt;
commit this patch soon.&lt;/p&gt;</comment>
                            <comment id="12741671" author="bryanpendleton" created="Tue, 11 Aug 2009 04:01:32 +0100"  >&lt;p&gt;Hi Eranda, I think maybe you meant to attach these latest patches and comments to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4282&quot; title=&quot;strange behavior with the &amp;quot;update ... where current of c1&amp;quot; in the CheckConstraintTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4282&quot;&gt;&lt;del&gt;DERBY-4282&lt;/del&gt;&lt;/a&gt;, not &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4256&quot; title=&quot;allow alter table to increase the maximum size of a blob and a clob.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4256&quot;&gt;&lt;del&gt;DERBY-4256&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="12741678" author="bryanpendleton" created="Tue, 11 Aug 2009 04:42:13 +0100"  >&lt;p&gt;Patch committed to the trunk as svn revision 802985.&lt;/p&gt;

&lt;p&gt;Thanks for the contribution to Derby, Eranda!&lt;/p&gt;</comment>
                            <comment id="12741684" author="eranda" created="Tue, 11 Aug 2009 05:41:16 +0100"  >&lt;p&gt;Hi Bryan,I am sorry for the mistake I have done and thanks&lt;br/&gt;
for committing the patch.&lt;br/&gt;
I am closing this issue.&lt;/p&gt;</comment>
                            <comment id="12785987" author="evan.leonard" created="Fri, 4 Dec 2009 16:24:28 +0000"  >&lt;p&gt;Any chance this could be merged to 10.5? I&apos;d quite like to make use of this fix, but am not excited about having to wait for 10.6 next year.  From this attached diffs, it looks like it is a small localized fix that could safely be applied to 10.5.&lt;/p&gt;</comment>
                            <comment id="12786019" author="bryanpendleton" created="Fri, 4 Dec 2009 17:39:17 +0000"  >&lt;p&gt;Hi Evan,&lt;/p&gt;

&lt;p&gt;I think that the code changes are straightforward, and should apply to 10.5 without trouble.&lt;/p&gt;

&lt;p&gt;The test changes are trickier, because the relevant test (AlterTableTest.java) doesn&apos;t exist in 10.5.&lt;/p&gt;

&lt;p&gt;Attached is 10_5_codeOnly.diff, which is a patch that you should be able to&lt;br/&gt;
apply to the 10.5 branch in your environment. I created this patch by running&lt;/p&gt;

&lt;p&gt;   svn merge -r 802984:802985 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/code/trunk/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/db/derby/code/trunk/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and then reverting modifyColumn.out. (I didn&apos;t need to revert modifyColumn.out, but since&lt;br/&gt;
the test portion of the patch was mostly in AlterTableTest, I thought it would be&lt;br/&gt;
clearer if this diff &lt;b&gt;only&lt;/b&gt; contained code changes, not any partial test changes)&lt;/p&gt;

&lt;p&gt;Depending on what your needs are, hopefully the attached patch is useful to&lt;br/&gt;
you (e.g., if you want to build your own modified version of 10.5 and use it&lt;br/&gt;
to alter the column definitions in your database).&lt;/p&gt;</comment>
                            <comment id="12786032" author="evan.leonard" created="Fri, 4 Dec 2009 17:55:54 +0000"  >&lt;p&gt;Thank you Bryan for taking the time to create the 10.5 patch. However I&apos;m not sure this will suit my environment. We ship a product with many dependencies, derby being one of them, and its not advisable to start up custom branches of dependencies since we then have to track the changes in every subsequent release.&lt;/p&gt;

&lt;p&gt;Any chance this patch could be included in 10.5.3.1 or 10.5.4? What is the proper channel to request this?&lt;/p&gt;

&lt;p&gt;Thanks again!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12407052">DERBY-3920</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12415856" name="ASF.LICENSE.NOT.GRANTED--A.txt" size="19285" author="eranda" created="Fri, 7 Aug 2009 16:37:18 +0100"/>
                            <attachment id="12415857" name="ASF.LICENSE.NOT.GRANTED--Clob.java" size="1732" author="eranda" created="Fri, 7 Aug 2009 16:37:18 +0100"/>
                            <attachment id="12415949" name="ASF.LICENSE.NOT.GRANTED--derby4256.diff" size="5052" author="eranda" created="Sat, 8 Aug 2009 18:29:18 +0100"/>
                            <attachment id="12415940" name="ASF.LICENSE.NOT.GRANTED--derby4256.diff" size="4477" author="eranda" created="Sat, 8 Aug 2009 17:25:18 +0100"/>
                            <attachment id="12414857" name="ASF.LICENSE.NOT.GRANTED--derby4256.diff" size="818" author="eranda" created="Wed, 29 Jul 2009 08:37:18 +0100"/>
                            <attachment id="12414852" name="ASF.LICENSE.NOT.GRANTED--derby4256.diff" size="728" author="eranda" created="Wed, 29 Jul 2009 08:05:16 +0100"/>
                            <attachment id="12426922" name="ten_5_codeOnly.diff" size="1343" author="bryanpendleton" created="Fri, 4 Dec 2009 17:39:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 3 Jun 2009 17:24:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31177</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10423"><![CDATA[Newcomer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0rg7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38265</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>