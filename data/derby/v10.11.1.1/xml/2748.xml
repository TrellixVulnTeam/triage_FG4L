<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:39:15 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2748/DERBY-2748.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2748] TimeSlice and Socket-Timeout bounds checking wrong</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2748</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;ClientThread sets the Socket timeout based upon the timeslice value:&lt;/p&gt;

&lt;p&gt;	//set time out					&lt;br/&gt;
	//this looks highly suspect.  Why does timeSlice setSoTimeout?		&lt;br/&gt;
	if (timeSlice != 0)&lt;br/&gt;
		clientSocket.setSoTimeout(timeSlice);&lt;/p&gt;

&lt;p&gt;it gets the timeSlice from NetworkServerControlImpl which sets it like this:&lt;/p&gt;

&lt;p&gt;	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Set the current value of  time slice&lt;br/&gt;
	 *&lt;/li&gt;
	&lt;li&gt;@param value time slice value&lt;/li&gt;
	&lt;li&gt;@exception Exception if value is &amp;lt; 0&lt;br/&gt;
	 */&lt;br/&gt;
	private void setTimeSlice(int value)&lt;br/&gt;
		throws Exception
	&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {		if (value &amp;lt; MIN_TIMESLICE)			consolePropertyMessage(&amp;quot;DRDA_InvalidValue.U&amp;quot;, new String [] 				{new Integer(value).toString(), &quot;timeslice&quot;});		if (value == USE_DEFAULT)			value = DEFAULT_TIMESLICE;		synchronized(timeSliceSync) {
			timeSlice = value;
		}	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;but&lt;/p&gt;

&lt;p&gt;	private final static int MIN_TIMESLICE = -1;&lt;/p&gt;

&lt;p&gt;therefore a value of -1 is accepted by setTimeSlice, due to &quot;!= 0&quot; used for Socket.setSoTimeout which will bail out with an Exception:&lt;/p&gt;

&lt;p&gt;	if (timeout &amp;lt; 0)&lt;br/&gt;
	  throw new IllegalArgumentException(&quot;timeout can&apos;t be negative&quot;);&lt;/p&gt;

&lt;p&gt;According to the comments, the proper fix would be&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final static int MIN_TIMESLICE = -1;&lt;br/&gt;
+	private final static int MIN_TIMESLICE = 0;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;but I do not understand the timeslice at all, so this is just my guess.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12370759">DERBY-2748</key>
            <summary>TimeSlice and Socket-Timeout bounds checking wrong</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bernt">Bernt M. Johnsen</assignee>
                                    <reporter username="kurti">Kurt Huwig</reporter>
                        <labels>
                    </labels>
                <created>Sat, 2 Jun 2007 20:51:13 +0100</created>
                <updated>Fri, 21 Jan 2011 17:50:19 +0000</updated>
                            <resolved>Fri, 8 Jun 2007 09:23:03 +0100</resolved>
                                    <version>10.2.2.0</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12501137" author="bernt" created="Mon, 4 Jun 2007 09:11:54 +0100"  >&lt;p&gt;You are right. TimeSlice can not be negative. 0 translates into &quot;no timeslicing&quot; and any positive value will give you timeslicing.&lt;/p&gt;

&lt;p&gt;Timeslice is a crude mechanism that if maxThreads i set, allows more than maxThreads connections to share the avaliable number threads. The setting has no meaning if maxThreads is not set.&lt;/p&gt;</comment>
                            <comment id="12501176" author="bernt" created="Mon, 4 Jun 2007 12:16:23 +0100"  >&lt;p&gt;Simple code &amp;amp; doc change to reflect that -1 is not allowed as a timeslice value.&lt;/p&gt;</comment>
                            <comment id="12501181" author="kurti" created="Mon, 4 Jun 2007 12:29:38 +0100"  >&lt;p&gt;Code and doc look ok to me.&lt;/p&gt;</comment>
                            <comment id="12501547" author="bernt" created="Tue, 5 Jun 2007 13:43:54 +0100"  >&lt;p&gt;New patch that accepts -1 for default timeslice. This makes timeslice equal to e.g. maxthreads  (and no doc change). Will commit as soon as all tests have passed.&lt;/p&gt;</comment>
                            <comment id="12502716" author="bernt" created="Fri, 8 Jun 2007 09:23:03 +0100"  >&lt;p&gt;Committed revision 545454.&lt;/p&gt;</comment>
                            <comment id="12502795" author="myrna" created="Fri, 8 Jun 2007 14:40:07 +0100"  >&lt;p&gt;Could an existing application have misused this bug?&lt;br/&gt;
In other words, is a release note required?&lt;/p&gt;</comment>
                            <comment id="12503351" author="bernt" created="Mon, 11 Jun 2007 10:27:51 +0100"  >&lt;p&gt;Since Socket.setSoTimeout throws an exception when -1 is set, it can&apos;t be misused. No release note should the be required.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12358959" name="DERBY-2748-code-v2.diff" size="1334" author="bernt" created="Tue, 5 Jun 2007 13:43:53 +0100"/>
                            <attachment id="12358960" name="DERBY-2748-code-v2.stat" size="126" author="bernt" created="Tue, 5 Jun 2007 13:43:54 +0100"/>
                            <attachment id="12358843" name="DERBY-2748-code.diff" size="751" author="bernt" created="Mon, 4 Jun 2007 12:16:23 +0100"/>
                            <attachment id="12358844" name="DERBY-2748-doc.diff" size="951" author="bernt" created="Mon, 4 Jun 2007 12:16:23 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 4 Jun 2007 08:11:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23217</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0mbj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37434</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>