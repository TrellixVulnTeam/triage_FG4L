<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:49:13 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4671/DERBY-4671.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4671] Embedded driver does not work with jbossCache</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4671</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When trying to use jbossCache (version 3.2.5) and an embedded derby driver the following exception is thrown when jbossCache tries to persist information to the database&lt;/p&gt;

&lt;p&gt;48610 &lt;span class=&quot;error&quot;&gt;&amp;#91;AsyncCacheLoader-0&amp;#93;&lt;/span&gt; ERROR org.jboss.cache.loader.JDBCCacheLoader [] - Failed to insert node :Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
 48610 &lt;span class=&quot;error&quot;&gt;&amp;#91;AsyncCacheLoader-0&amp;#93;&lt;/span&gt; WARN  org.jboss.cache.loader.AsyncCacheLoader [] - Failed to process async modifications: java.lang.IllegalStateException: Failed to insert node: Java e&lt;br/&gt;
xception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
 48610 &lt;span class=&quot;error&quot;&gt;&amp;#91;AsyncCacheLoader-0&amp;#93;&lt;/span&gt; DEBUG org.jboss.cache.loader.AsyncCacheLoader [] - Exception:&lt;br/&gt;
 java.lang.IllegalStateException: Failed to insert node: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
        at org.jboss.cache.loader.AdjListJDBCCacheLoader.insertNode(AdjListJDBCCacheLoader.java:562)&lt;br/&gt;
        at org.jboss.cache.loader.JDBCCacheLoader.addNewSubtree(JDBCCacheLoader.java:367)&lt;br/&gt;
        at org.jboss.cache.loader.JDBCCacheLoader.put(JDBCCacheLoader.java:110)&lt;br/&gt;
        at org.jboss.cache.loader.AbstractCacheLoader.put(AbstractCacheLoader.java:303)&lt;br/&gt;
        at org.jboss.cache.loader.AbstractDelegatingCacheLoader.put(AbstractDelegatingCacheLoader.java:110)&lt;br/&gt;
        at org.jboss.cache.loader.AsyncCacheLoader.access$601(AsyncCacheLoader.java:105)&lt;br/&gt;
        at org.jboss.cache.loader.AsyncCacheLoader$AsyncProcessor.put(AsyncCacheLoader.java:417)&lt;br/&gt;
        at org.jboss.cache.loader.AsyncCacheLoader$AsyncProcessor.run0(AsyncCacheLoader.java:409)&lt;br/&gt;
        at org.jboss.cache.loader.AsyncCacheLoader$AsyncProcessor.run(AsyncCacheLoader.java:371)&lt;br/&gt;
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.javaException(Util.java:299)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2269)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&amp;lt;init&amp;gt;(EmbedPreparedStatement.java:148)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&amp;lt;init&amp;gt;(EmbedPreparedStatement20.java:82)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&amp;lt;init&amp;gt;(EmbedPreparedStatement30.java:63)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement40.&amp;lt;init&amp;gt;(EmbedPreparedStatement40.java:40)&lt;br/&gt;
        at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Driver40.java:105)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:1607)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:1435)&lt;br/&gt;
        at com.mchange.v2.c3p0.impl.NewProxyConnection.prepareStatement(NewProxyConnection.java:213)&lt;br/&gt;
        at org.jboss.cache.loader.AdjListJDBCCacheLoader.prepareAndLogStatement(AdjListJDBCCacheLoader.java:90)&lt;br/&gt;
        at org.jboss.cache.loader.AdjListJDBCCacheLoader.insertNode(AdjListJDBCCacheLoader.java:545)&lt;br/&gt;
        ... 14 more&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)&lt;br/&gt;
        ... 30 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.derby.impl.sql.compile.CharTypeCompiler.convertible(CharTypeCompiler.java:54)&lt;br/&gt;
        at org.apache.derby.impl.sql.compile.CharTypeCompiler.storable(CharTypeCompiler.java:100)&lt;br/&gt;
        at org.apache.derby.impl.sql.compile.ResultColumn.checkStorableExpression(ResultColumn.java:887)&lt;br/&gt;
        at org.apache.derby.impl.sql.compile.ResultColumn.checkStorableExpression(ResultColumn.java:879)&lt;br/&gt;
        at org.apache.derby.impl.sql.compile.ResultColumnList.checkStorableExpressions(ResultColumnList.java:953)&lt;br/&gt;
        at org.apache.derby.impl.sql.compile.InsertNode.bindStatement(InsertNode.java:456)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:324)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:90)&lt;br/&gt;
        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:828)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&amp;lt;init&amp;gt;(EmbedPreparedStatement.java:130)&lt;br/&gt;
        ... 23 more&lt;/p&gt;

&lt;p&gt;It works fine using ClientDriver.&lt;/p&gt;

&lt;p&gt;Sample code and configuration files are attached.&lt;/p&gt;</description>
                <environment>------------------ Java Information ------------------&lt;br/&gt;
Java Version:    1.5.0_12&lt;br/&gt;
Java Vendor:     Sun Microsystems Inc.&lt;br/&gt;
Java home:       c:\FDE\JDK1.5.0_12\jre&lt;br/&gt;
Java classpath:  .;C:\Program Files\Java\jre1.5.0_06\lib\ext\QTJava.zip;C:\FDE\db-derby-10.6.1.0-bin/lib/derby.jar;C:\FDE\db-derby-10.6.1.0-bin/lib/derbynet.jar;C:\FDE\db-derby-10&lt;br/&gt;
6.1.0-bin/lib/derbyclient.jar;C:\FDE\db-derby-10.6.1.0-bin/lib/derbytools.jar&lt;br/&gt;
OS name:         Windows XP&lt;br/&gt;
OS architecture: x86&lt;br/&gt;
OS version:      5.1&lt;br/&gt;
Java user name:  rayohagan&lt;br/&gt;
Java user home:  C:\Documents and Settings\rayohagan.FUTRIX&lt;br/&gt;
Java user dir:   C:\FDE\db-derby-10.6.1.0-bin\bin&lt;br/&gt;
java.specification.name: Java Platform API Specification&lt;br/&gt;
java.specification.version: 1.5&lt;br/&gt;
java.runtime.version: 1.5.0_12-b04&lt;br/&gt;
--------- Derby Information --------&lt;br/&gt;
JRE - JDBC: J2SE 5.0 - JDBC 3.0&lt;br/&gt;
[C:\FDE\db-derby-10.6.1.0-bin\lib\derby.jar] 10.6.1.0 - (938214)&lt;br/&gt;
[C:\FDE\db-derby-10.6.1.0-bin\lib\derbytools.jar] 10.6.1.0 - (938214)&lt;br/&gt;
[C:\FDE\db-derby-10.6.1.0-bin\lib\derbynet.jar] 10.6.1.0 - (938214)&lt;br/&gt;
[C:\FDE\db-derby-10.6.1.0-bin\lib\derbyclient.jar] 10.6.1.0 - (938214)&lt;br/&gt;
------------------------------------------------------&lt;br/&gt;
----------------- Locale Information -----------------&lt;br/&gt;
Current Locale :  [English/New Zealand [en_NZ]]&lt;br/&gt;
Found support for locale: [cs]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;version: 10.6.1.0 - (938214)&lt;br/&gt;
Found support for locale: [de_DE]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;version: 10.6.1.0 - (938214)&lt;br/&gt;
Found support for locale: [es]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;version: 10.6.1.0 - (938214)&lt;br/&gt;
Found support for locale: [fr]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;version: 10.6.1.0 - (938214)&lt;br/&gt;
Found support for locale: [hu]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;version: 10.6.1.0 - (938214)&lt;br/&gt;
Found support for locale: [it]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;version: 10.6.1.0 - (938214)&lt;br/&gt;
Found support for locale: [ja_JP]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;version: 10.6.1.0 - (938214)&lt;br/&gt;
Found support for locale: [ko_KR]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;version: 10.6.1.0 - (938214)&lt;br/&gt;
Found support for locale: [pl]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;version: 10.6.1.0 - (938214)&lt;br/&gt;
Found support for locale: [pt_BR]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;version: 10.6.1.0 - (938214)&lt;br/&gt;
Found support for locale: [ru]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;version: 10.6.1.0 - (938214)&lt;br/&gt;
Found support for locale: [zh_CN]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;version: 10.6.1.0 - (938214)&lt;br/&gt;
Found support for locale: [zh_TW]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;version: 10.6.1.0 - (938214)&lt;br/&gt;
------------------------------------------------------</environment>
        <key id="12465069">DERBY-4671</key>
            <summary>Embedded driver does not work with jbossCache</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="raimy69">Ray O&apos;Hagan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 May 2010 22:38:05 +0100</created>
                <updated>Mon, 17 Jun 2013 10:19:34 +0100</updated>
                            <resolved>Thu, 27 May 2010 13:23:04 +0100</resolved>
                                    <version>10.5.3.1</version>
                    <version>10.6.1.0</version>
                                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.2.1</fixVersion>
                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12869781" author="raimy69" created="Thu, 20 May 2010 22:42:03 +0100"  >&lt;p&gt;Also attached a full eclipseProject which contains all jars &amp;amp; code to reproduce the problem.&lt;/p&gt;</comment>
                            <comment id="12869913" author="knutanders" created="Fri, 21 May 2010 10:14:23 +0100"  >&lt;p&gt;The zip file contains a derby.log which shows the query that fails:&lt;/p&gt;

&lt;p&gt;INSERT INTO jbosscache (fqn, node, parent) SELECT ?, ?, ? FROM jbosscache_D WHERE NOT EXISTS (SELECT fqn FROM jbosscache WHERE fqn = ?)&lt;/p&gt;

&lt;p&gt;The NPE is easily reproducible in ij:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; create table t (x int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; prepare ps as &apos;insert into t select ? from t&apos;;&lt;br/&gt;
ERROR XJ001: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;/p&gt;

&lt;p&gt;Preparation of the insert statement fails with a NullPointerException in Derby 10.6.1.0, whereas 10.5.3.0 and earlier versions successfully prepare and execute the query.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if it is intentional that the older versions allow ? in the select list, as the same select statement fails when it&apos;s not within an insert statement:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; prepare ps as &apos;select ? from t&apos;;&lt;br/&gt;
ERROR 42X34: There is a ? parameter in the select list.  This is not allowed.&lt;/p&gt;

&lt;p&gt;I would have expected the same result from the insert statement. Anyhow, it should not fail with a NullPointerException.&lt;/p&gt;</comment>
                            <comment id="12869915" author="knutanders" created="Fri, 21 May 2010 10:16:25 +0100"  >&lt;p&gt;Attaching an SQL script that reproduces the NullPointerException on Derby 10.6.1.0. No error is raised with 10.5.3.0 and earlier releases.&lt;/p&gt;</comment>
                            <comment id="12869938" author="knutanders" created="Fri, 21 May 2010 11:51:45 +0100"  >&lt;p&gt;The NPE was introduced in this commit:&lt;/p&gt;

&lt;p&gt;------------------------------------------------------------------------&lt;br/&gt;
r832379 | kahatlen | 2009-11-03 11:31:21 +0100 (Tue, 03 Nov 2009) | 16 lines&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4420&quot; title=&quot;NullPointerException with INSERT INTO ... from EXCEPT/INTERSECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4420&quot;&gt;&lt;del&gt;DERBY-4420&lt;/del&gt;&lt;/a&gt;: NullPointerException with INSERT INTO ... from EXCEPT/INTERSECT&lt;/p&gt;

&lt;p&gt;The failing code in ResultSetNode.setTableConstructorTypes() was meant&lt;br/&gt;
to handle the case where the node represented a table constructor (aka&lt;br/&gt;
VALUES clause). UnionNode already had an override to make it a no-op&lt;br/&gt;
unless it actually represented a multi-row VALUES clause that had been&lt;br/&gt;
rewritten to a union of single-row VALUES clauses.&lt;/p&gt;

&lt;p&gt;Since a VALUES clause is never rewritten to EXCEPT or INTERSECT, the&lt;br/&gt;
correct handling is to make setTableConstructorTypes() a no-op in&lt;br/&gt;
IntersectOrExceptNode. Rather than adding an empty override in&lt;br/&gt;
IntersectOrExceptNode, the code was moved from&lt;br/&gt;
ResultSetNode.setTableConstructorTypes() to&lt;br/&gt;
RowResultSetNode.setTableConstructorTypes(), and the default&lt;br/&gt;
implementation in ResultSetNode was left empty.&lt;/p&gt;

&lt;p&gt;------------------------------------------------------------------------&lt;/p&gt;</comment>
                            <comment id="12869939" author="knutanders" created="Fri, 21 May 2010 11:53:06 +0100"  >&lt;p&gt;Adding 10.5.3.1 to the affected versions since &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4420&quot; title=&quot;NullPointerException with INSERT INTO ... from EXCEPT/INTERSECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4420&quot;&gt;&lt;del&gt;DERBY-4420&lt;/del&gt;&lt;/a&gt; was backported to the 10.5 branch.&lt;/p&gt;</comment>
                            <comment id="12869988" author="knutanders" created="Fri, 21 May 2010 15:07:48 +0100"  >&lt;p&gt;The attached patch fixes the NullPointerException by reintroducing some code that was removed in the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4420&quot; title=&quot;NullPointerException with INSERT INTO ... from EXCEPT/INTERSECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4420&quot;&gt;&lt;del&gt;DERBY-4420&lt;/del&gt;&lt;/a&gt; fix. Now the type will be initialized for dynamic parameters in the select list of INSERT INTO ... SELECT FROM statements, so that we don&apos;t run into a NullPointerException later in the compilation. The patch also adds a regression test case for this bug.&lt;/p&gt;

&lt;p&gt;I&apos;m running the full regression test suite now.&lt;/p&gt;</comment>
                            <comment id="12870028" author="bryanpendleton" created="Fri, 21 May 2010 17:08:54 +0100"  >&lt;p&gt;I&apos;m not completely sure I understand why this case is legal and the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4672&quot; title=&quot;NullPointerException in insert from nested select with parameter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4672&quot;&gt;DERBY-4672&lt;/a&gt; case&lt;br/&gt;
is an error. What sorts of setXXX calls are allowed to be used with&lt;/p&gt;

&lt;p&gt;    insert into t select ? from t&lt;/p&gt;

&lt;p&gt;Can I substitute a simple literal value into that statement? Can I substitute a column&lt;br/&gt;
name into that statement? Can I substitute a sub-query into that statement?&lt;/p&gt;

&lt;p&gt;I suppose what I&apos;m saying is that it seems like this statement should be illegal, too&lt;br/&gt;
(though it shouldn&apos;t throw a NPE, obviously)&lt;/p&gt;</comment>
                            <comment id="12870168" author="knutanders" created="Fri, 21 May 2010 22:22:53 +0100"  >&lt;p&gt;&amp;gt; I&apos;m not completely sure I understand why this case is legal and the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4672&quot; title=&quot;NullPointerException in insert from nested select with parameter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4672&quot;&gt;DERBY-4672&lt;/a&gt;  case&lt;br/&gt;
&amp;gt; is an error.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;br/&gt;
&amp;gt; I suppose what I&apos;m saying is that it seems like this statement should be illegal, too&lt;br/&gt;
&amp;gt; (though it shouldn&apos;t throw a NPE, obviously) &lt;/p&gt;

&lt;p&gt;I think we have two different classes of statements here:&lt;/p&gt;

&lt;p&gt;1) INSERT INTO ... SELECT FROM statements that have untyped parameter&lt;br/&gt;
markers in their top-level select lists. Inferring the type of the&lt;br/&gt;
parameter from the context is easy, because it&apos;s directly available&lt;br/&gt;
from the target column list. Derby has always accepted statements that&lt;br/&gt;
fall into this category.&lt;/p&gt;

&lt;p&gt;2) INSERT INTO ... SELECT FROM statements that have untyped parameter&lt;br/&gt;
markers in the select list of one of the sub-queries. Inferring the&lt;br/&gt;
type of the parameter from the context is trickier, because the target&lt;br/&gt;
column list is not on the same nesting level in the query. Derby has&lt;br/&gt;
always rejected statements that fall into this category.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4671&quot; title=&quot;Embedded driver does not work with jbossCache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4671&quot;&gt;&lt;del&gt;DERBY-4671&lt;/del&gt;&lt;/a&gt; belongs to category (1), whereas &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4672&quot; title=&quot;NullPointerException in insert from nested select with parameter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4672&quot;&gt;DERBY-4672&lt;/a&gt; belongs to&lt;br/&gt;
category (2).&lt;/p&gt;

&lt;p&gt;You may be right that category 1 statements are not conforming to the&lt;br/&gt;
standard and should be illegal too. It may even be the case that it&lt;br/&gt;
was unintentional that those statements were accepted by Derby in the&lt;br/&gt;
first place. However, since they have always been accepted, and there&lt;br/&gt;
apparently are applications that depend on this feature, I think it&apos;s&lt;br/&gt;
safer to keep the behaviour.&lt;/p&gt;

&lt;p&gt;So I guess my take on this is&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4671&quot; title=&quot;Embedded driver does not work with jbossCache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4671&quot;&gt;&lt;del&gt;DERBY-4671&lt;/del&gt;&lt;/a&gt; - this statement worked until &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4420&quot; title=&quot;NullPointerException with INSERT INTO ... from EXCEPT/INTERSECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4420&quot;&gt;&lt;del&gt;DERBY-4420&lt;/del&gt;&lt;/a&gt; broke it, so the&lt;br/&gt;
  correct fix is to make it work again. If there are compelling&lt;br/&gt;
  reasons to disallow the statement, and the benefits outweigh the&lt;br/&gt;
  disadvantage of breaking existing apps, we could consider&lt;br/&gt;
  disallowing it and document the changed behaviour in a release&lt;br/&gt;
  note. Currently, I don&apos;t see any compelling reasons to disallow it.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4672&quot; title=&quot;NullPointerException in insert from nested select with parameter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4672&quot;&gt;DERBY-4672&lt;/a&gt; - this statement has never worked, so making it fail&lt;br/&gt;
  gracefully is an improvement. Further improvement is possible&lt;br/&gt;
  later, though, if someone thinks it should be accepted.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&amp;gt; What sorts of setXXX calls are allowed to be used with&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt;     insert into t select ? from t&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; Can I substitute a simple literal value into that statement? Can I substitute a column&lt;br/&gt;
&amp;gt; name into that statement? Can I substitute a sub-query into that statement?&lt;/p&gt;

&lt;p&gt;Only literals.&lt;/p&gt;

&lt;p&gt;The type will be taken from the context, so if T has one INT column,&lt;br/&gt;
as in the example above, the statement will be equivalent to&lt;/p&gt;

&lt;p&gt;    insert into t select cast(? as int) from t&lt;/p&gt;

&lt;p&gt;(which is also accepted syntax, by the way). Then you can use&lt;br/&gt;
setInt(), setLong(), setString(), or any other of the setters we&lt;br/&gt;
accept for an INT parameter, to tell which value to insert into T.&lt;/p&gt;

&lt;p&gt;For example, the following code fragment&lt;/p&gt;

&lt;p&gt;    ps = c.prepareStatement(&quot;insert into t select ? from t&quot;);&lt;br/&gt;
    ps.setInt(1, 77);&lt;br/&gt;
    ps.executeUpdate();&lt;/p&gt;

&lt;p&gt;will double the number of rows in the table, and all the new rows will&lt;br/&gt;
have X=77. This is the same result as you get from this statement:&lt;/p&gt;

&lt;p&gt;    s.executeUpdate(&quot;insert into t select 77 from t&quot;);&lt;/p&gt;

&lt;p&gt;Note also that we allow parameters in the select list of plain SELECT&lt;br/&gt;
statements too, just not untyped ones, since there we don&apos;t have&lt;br/&gt;
context to get the type information from:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; prepare ps as &apos;select ? from t&apos;;&lt;br/&gt;
ERROR 42X34: There is a ? parameter in the select list.  This is not allowed.&lt;br/&gt;
ij&amp;gt; prepare ps as &apos;select cast(? as varchar(10)) from t&apos;;&lt;br/&gt;
ij&amp;gt; execute ps using &apos;values &apos;&apos;hello&apos;&apos;&apos;;&lt;br/&gt;
1         &lt;br/&gt;
----------&lt;br/&gt;
hello     &lt;br/&gt;
hello     &lt;br/&gt;
hello     &lt;/p&gt;

&lt;p&gt;3 rows selected&lt;br/&gt;
ij&amp;gt; prepare ps as &apos;select x+? from t&apos;;&lt;br/&gt;
ij&amp;gt; execute ps using &apos;values 1&apos;;&lt;br/&gt;
1          &lt;br/&gt;
-----------&lt;br/&gt;
2          &lt;br/&gt;
3          &lt;br/&gt;
4          &lt;/p&gt;

&lt;p&gt;3 rows selected&lt;/p&gt;</comment>
                            <comment id="12870169" author="knutanders" created="Fri, 21 May 2010 22:24:51 +0100"  >&lt;p&gt;All the regression tests ran cleanly with the patch, so I&apos;m setting Patch Available.&lt;/p&gt;</comment>
                            <comment id="12870218" author="bryanpendleton" created="Sat, 22 May 2010 00:21:24 +0100"  >&lt;p&gt;Thanks for the thorough and detailed explanation, it was quite clear and helpful!&lt;/p&gt;

&lt;p&gt;&amp;gt; this statement worked until &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4420&quot; title=&quot;NullPointerException with INSERT INTO ... from EXCEPT/INTERSECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4420&quot;&gt;&lt;del&gt;DERBY-4420&lt;/del&gt;&lt;/a&gt; broke it, so the correct fix is to make it work again&lt;/p&gt;

&lt;p&gt;Agreed. I&apos;m comfortable with this approach; your notes helped me understand the distinction.&lt;/p&gt;

&lt;p&gt;I also read your patch and it looks fine to me; there is a good variety of test cases there.&lt;/p&gt;</comment>
                            <comment id="12871157" author="knutanders" created="Tue, 25 May 2010 15:08:32 +0100"  >&lt;p&gt;Thanks for looking at the patch, Bryan.&lt;br/&gt;
Committed revision 948045.&lt;/p&gt;

&lt;p&gt;I plan to backport the fix to 10.6 and 10.5, since the fix that caused the NPE also went into those branches.&lt;/p&gt;</comment>
                            <comment id="12872193" author="knutanders" created="Thu, 27 May 2010 13:23:04 +0100"  >&lt;p&gt;Merged to 10.6 branch (revision 948798) and 10.5 branch (revision 948799). Marking the issue as resolved.&lt;/p&gt;</comment>
                            <comment id="13685284" author="knutanders" created="Mon, 17 Jun 2013 10:19:34 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12469683">DERBY-4749</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12465798">DERBY-4683</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12471880">DERBY-4780</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12438891">DERBY-4420</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12465124">DERBY-4672</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12445107" name="CacheIssue-eclipseProject.zip" size="7763503" author="raimy69" created="Thu, 20 May 2010 22:45:00 +0100"/>
                            <attachment id="12445105" name="CacheIssue.java" size="919" author="raimy69" created="Thu, 20 May 2010 22:42:03 +0100"/>
                            <attachment id="12445106" name="cache-config.xml" size="1367" author="raimy69" created="Thu, 20 May 2010 22:43:50 +0100"/>
                            <attachment id="12445168" name="derby-4671-1a.diff" size="4644" author="knutanders" created="Fri, 21 May 2010 15:07:48 +0100"/>
                            <attachment id="12445143" name="repro.sql" size="186" author="knutanders" created="Fri, 21 May 2010 10:16:24 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 21 May 2010 09:14:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24400</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0oq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37824</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>