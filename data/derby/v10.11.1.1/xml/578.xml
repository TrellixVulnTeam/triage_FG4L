<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:50:34 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-578/DERBY-578.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-578] Grouped select from temporary table raises null pointer exception in byte code generator</title>
                <link>https://issues.apache.org/jira/browse/DERBY-578</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The last statement in the following script:&lt;/p&gt;

&lt;p&gt;autocommit off;&lt;/p&gt;

&lt;p&gt;declare global temporary table session.ztemp&lt;br/&gt;
( orderID varchar( 50 ) )&lt;br/&gt;
not logged;&lt;/p&gt;

&lt;p&gt;select orderID from session.ztemp group by orderID;&lt;/p&gt;

&lt;p&gt;raises the following stack trace in the trunk:&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;/p&gt;

&lt;p&gt;	at java.util.Hashtable.get(Hashtable.java:333)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.iapi.services.classfile.ClassHolder.findMatchingEntry(ClassHolder.java:656)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.iapi.services.classfile.ClassHolder.addUtf8Entry(ClassHolder.java:482)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.iapi.services.classfile.ClassHolder.addString(ClassHolder.java:506)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.iapi.services.classfile.ClassHolder.addConstant(ClassHolder.java:302)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.services.bytecode.BCMethod.push(BCMethod.java:452)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.compile.FromBaseTable.generateDistinctScan(FromBaseTable.java:3216)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.compile.FromBaseTable.generateResultSet(FromBaseTable.java:3032)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.compile.FromBaseTable.generate(FromBaseTable.java:2978)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1196)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1145)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1196)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1145)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1196)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1145)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1196)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1145)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.compile.ScrollInsensitiveResultSetNode.generate(ScrollInsensitiveResultSetNode.java:109)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.compile.ReadCursorNode.generate(ReadCursorNode.java:118)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.compile.CursorNode.generate(CursorNode.java:546)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.compile.StatementNode.generate(StatementNode.java:232)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:433)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:107)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:704)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:533)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:480)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:299)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:433)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:310)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.tools.ij.Main.go(Main.java:203)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.tools.ij.main(ij.java:60)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12317113">DERBY-578</key>
            <summary>Grouped select from temporary table raises null pointer exception in byte code generator</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mkhettry">Manish Khettry</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Sep 2005 10:01:25 +0100</created>
                <updated>Thu, 2 May 2013 03:29:00 +0100</updated>
                            <resolved>Mon, 3 Jul 2006 10:39:42 +0100</resolved>
                                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Services</component>
                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12376974" author="mkhettry" created="Sat, 29 Apr 2006 01:59:56 +0100"  >&lt;p&gt;The problem is simple enough-- we didn&apos;t have a conglomerate name for temporary tables. I fixed the code to behave more like what fillInScanArgs does. Several master files had to be changed and I think I got to all of them. If there is a wiki entry on how to convert existing tests to JUnit or if there is some work underway, let me know!&lt;/p&gt;


</comment>
                            <comment id="12416403" author="rhillegas" created="Fri, 16 Jun 2006 04:53:59 +0100"  >&lt;p&gt;Hi Manish,&lt;/p&gt;

&lt;p&gt;I would like to take a look at this patch, but I get the following errors when I try to apply it to my workspace. Could you regenerate the patch? Thanks-Rick&lt;/p&gt;

&lt;p&gt;(Stripping trailing CRs from patch.)&lt;br/&gt;
patching file java/tools/org/apache/derby/impl/tools/ij/xaHelper.java&lt;br/&gt;
Hunk #1 succeeded at 64 (offset 1 line).&lt;br/&gt;
(Stripping trailing CRs from patch.)&lt;br/&gt;
patching file java/engine/org/apache/derby/impl/sql/compile/FromBaseTable.java&lt;br/&gt;
Hunk #1 succeeded at 3085 (offset 4 lines).&lt;br/&gt;
Hunk #2 succeeded at 3125 (offset 4 lines).&lt;br/&gt;
Hunk #3 succeeded at 3152 (offset 4 lines).&lt;br/&gt;
Hunk #4 succeeded at 3187 (offset 4 lines).&lt;br/&gt;
Hunk #5 succeeded at 3247 (offset 4 lines).&lt;br/&gt;
(Stripping trailing CRs from patch.)&lt;br/&gt;
patching file java/testing/org/apache/derbyTesting/functionTests/tests/lang/distinct.sql&lt;br/&gt;
(Stripping trailing CRs from patch.)&lt;br/&gt;
patching file java/testing/org/apache/derbyTesting/functionTests/master/distinctElimination.out&lt;br/&gt;
(Stripping trailing CRs from patch.)&lt;br/&gt;
patching file java/testing/org/apache/derbyTesting/functionTests/master/distinct.out&lt;br/&gt;
(Stripping trailing CRs from patch.)&lt;br/&gt;
patching file java/testing/org/apache/derbyTesting/functionTests/master/j9_13/distinct.out&lt;br/&gt;
(Stripping trailing CRs from patch.)&lt;br/&gt;
patching file java/testing/org/apache/derbyTesting/functionTests/master/j9_22/distinct.out&lt;br/&gt;
(Stripping trailing CRs from patch.)&lt;br/&gt;
patching file java/testing/org/apache/derbyTesting/functionTests/master/predicatePushdown.out&lt;br/&gt;
Hunk #1 succeeded at 9052 (offset 1480 lines).&lt;br/&gt;
Hunk #2 succeeded at 9071 (offset 1480 lines).&lt;br/&gt;
Hunk #3 succeeded at 9090 (offset 1480 lines).&lt;br/&gt;
Hunk #4 succeeded at 9109 with fuzz 1 (offset 1480 lines).&lt;br/&gt;
Hunk #5 FAILED at 9215.&lt;br/&gt;
Hunk #6 FAILED at 9234.&lt;br/&gt;
Hunk #7 succeeded at 9259 (offset 1480 lines).&lt;br/&gt;
Hunk #8 FAILED at 9278.&lt;br/&gt;
Hunk #9 succeeded at 9297 with fuzz 1 (offset 1480 lines).&lt;br/&gt;
Hunk #10 FAILED at 9316.&lt;br/&gt;
Hunk #11 succeeded at 9335 with fuzz 1 (offset 1480 lines).&lt;br/&gt;
4 out of 11 hunks FAILED &amp;#8211; saving rejects to file java/testing/org/apache/derbyTesting/functionTests/master/predicatePu&lt;br/&gt;
shdown.out.rej&lt;br/&gt;
(Stripping trailing CRs from patch.)&lt;br/&gt;
patching file java/testing/org/apache/derbyTesting/functionTests/master/subquery.out&lt;/p&gt;</comment>
                            <comment id="12416423" author="mkhettry" created="Fri, 16 Jun 2006 06:36:51 +0100"  >&lt;p&gt;Looks like the join order changed between when I generated the patch and now. Try this version of predicatePushdown.&lt;/p&gt;</comment>
                            <comment id="12416588" author="rhillegas" created="Sat, 17 Jun 2006 05:22:51 +0100"  >&lt;p&gt;Hi Manish,&lt;/p&gt;

&lt;p&gt;I&apos;m confused about what I&apos;m supposed to do with the latest attachment. It looks like it might just be the changes to predicatePushdown.out. Could you give me a single patch file which contains everything I need to apply this patch and which I can apply with a single patch command? Thanks-Rick&lt;/p&gt;</comment>
                            <comment id="12416627" author="mkhettry" created="Sat, 17 Jun 2006 23:32:00 +0100"  >&lt;p&gt;Try this one-- it is a complete patch and it should work.&lt;/p&gt;</comment>
                            <comment id="12416803" author="rhillegas" created="Tue, 20 Jun 2006 04:23:38 +0100"  >&lt;p&gt;Thanks, Manish. As you said, the fix looks pretty simple. I&apos;m running regression tests now. I have a couple questions:&lt;/p&gt;

&lt;p&gt;1) I don&apos;t understand the change to xaHelper. How is that related to this bugfix?&lt;/p&gt;

&lt;p&gt;2) Can you explain the test diffs? On the surface, it looks like a number of index scans have been replaced with table scans. However, it&apos;s hard to trust the original claim that an index was being used because there doesn&apos;t seem to be a usable index.  Please help me muddle through these diffs.&lt;/p&gt;

&lt;p&gt;-Rick&lt;/p&gt;</comment>
                            <comment id="12416814" author="mkhettry" created="Tue, 20 Jun 2006 06:16:00 +0100"  >&lt;p&gt;Thanks for taking time to review the fix. The xaHelper is not related to this but when I was debugging using ij, this bit of code would always throw a NPE in the debugger. &lt;/p&gt;

&lt;p&gt;You are right about 2. Earlier, we would set the indexName field in DistinctScanResult to the conglomerate name (cd.getName()) used to scan the table. If the conglomerate was the base table itself then this was just plain wrong. The change, for this patch, passes null if no index is being used. This in turn ended up causing all the diffs to the master files. I really wish we had assert tests; all the test output wants to check in this case is that a distinct scan is performed and not have all the other cruft output by runtime stats.&lt;/p&gt;

&lt;p&gt;The change to FromBaseTable is similar to the code in BaseJoinStrategy:fillInScanArgs2. I was tempted to try and have all the differfent code paths (DistinctScan, specialMaxScan) share the same code when it comes to filling in the scan args but I took the easy way out for this bug for now.&lt;/p&gt;


</comment>
                            <comment id="12416915" author="rhillegas" created="Tue, 20 Jun 2006 23:24:11 +0100"  >&lt;p&gt;Thanks for the explanation, Manish. I ran derbyall and came up with one unexpected diff in lang/subquery.sql. It&apos;s some extra cruft on the printout for some scan qualifiers. On its surface this suggests that a little work is needed to fix that printout. Would appreciate your opinion here.&lt;/p&gt;</comment>
                            <comment id="12418281" author="kmarsden" created="Thu, 29 Jun 2006 01:47:44 +0100"  >&lt;p&gt;In the interest of learning a little about a different code area  I did a bit of housekeeping on this patch.  Attaching:&lt;/p&gt;

&lt;p&gt;derby578_06282006_diff.txt&lt;br/&gt;
derby578_06282006_stat.txt&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;merged FromBaseTable now out of date and merged in general up to revision 417747&lt;/li&gt;
	&lt;li&gt;Fixed up the javadoc for the new method.&lt;/li&gt;
	&lt;li&gt;Added a comment about the fix for runtimestatistics incorrectly reporting.&lt;/li&gt;
	&lt;li&gt;Ran derbylang suite with no failures on Windows XP jdk 1.4.2.&lt;/li&gt;
	&lt;li&gt;Fixed master for subquery.out to remove white space diff.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Kathey&lt;/p&gt;</comment>
                            <comment id="12418683" author="kmarsden" created="Sat, 1 Jul 2006 01:12:37 +0100"  >&lt;p&gt;If there are no comments on the merge and comments I added I will run derbyall and commit this on Monday and put this poor patch (posted in April  28) out of its misery.  Thanks to Manish for the fix and Rick for the review.&lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;</comment>
                            <comment id="12418884" author="kmarsden" created="Mon, 3 Jul 2006 10:39:42 +0100"  >&lt;p&gt;Submitted to trunk.&lt;/p&gt;

&lt;p&gt;Date: Sun Jul  2 19:37:42 2006&lt;br/&gt;
New Revision: 418672&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=418672&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?rev=418672&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It is actually fixed in 10.2.0.4 but there is no such version in Jira so marked it 10.2.0.0&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12345202">DERBY-1464</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12335580" name="578.diff.new.txt" size="17107" author="mkhettry" created="Sat, 17 Jun 2006 23:32:00 +0100"/>
                            <attachment id="12326025" name="578.diff.txt" size="17098" author="mkhettry" created="Sat, 29 Apr 2006 01:59:56 +0100"/>
                            <attachment id="12336082" name="derby578_06282006_diff.txt" size="17120" author="kmarsden" created="Thu, 29 Jun 2006 01:47:44 +0100"/>
                            <attachment id="12335527" name="predicatePushdown.out.patch" size="4545" author="mkhettry" created="Fri, 16 Jun 2006 06:36:51 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 29 Apr 2006 00:59:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22027</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy15p3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40573</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>