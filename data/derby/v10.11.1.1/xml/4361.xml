<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:29:01 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4361/DERBY-4361.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4361] testDefault fixture in engine.ErrorStreamTest has been failing with junit.framework.AssertionFailedError: File C:\jartest\JarResults.XXdateXX\ibm15_suites.All\system\derby.log could not be deleted</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4361</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;testDefault fixture has been failing atleast since August 18th 2009 with following exception. I do not have access to test results fro 15th, 16th and 17th so not sure if the failure started earlier. It seemed to have run find on August 14th 2009.&lt;br/&gt;
1) testDefault(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)junit.framework.AssertionFailedError: File C:\jartest\JarResults.2009-08-18\ibm15_suites.All\system\derby.log could not be deleted&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest.testDefault(ErrorStreamTest.java:135)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:79)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)&lt;/p&gt;

&lt;p&gt;This is happening both on trunk and 10.5 codelines. Not sure of other codelines. The failure appears on Windows but not on Linux. The jvms that definitely show the failures are ibm 15 and ibm16&lt;/p&gt;

&lt;p&gt;Does anyone know of the cause of the failure?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12434083">DERBY-4361</key>
            <summary>testDefault fixture in engine.ErrorStreamTest has been failing with junit.framework.AssertionFailedError: File C:\jartest\JarResults.XXdateXX\ibm15_suites.All\system\derby.log could not be deleted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mamtas">Mamta A. Satoor</assignee>
                                    <reporter username="mamtas">Mamta A. Satoor</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Aug 2009 20:03:09 +0100</created>
                <updated>Fri, 21 Jan 2011 17:52:33 +0000</updated>
                            <resolved>Fri, 16 Oct 2009 19:39:51 +0100</resolved>
                                    <version>10.4.2.1</version>
                    <version>10.5.3.1</version>
                    <version>10.6.1.0</version>
                                    <fixVersion>10.4.2.1</fixVersion>
                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12748255" author="myrna" created="Thu, 27 Aug 2009 05:15:20 +0100"  >&lt;p&gt;I don&apos;t know why you don&apos;t have access to test results for 15/16/17 August, but perhaps your tests only run when there are changes? There were no check-ins on those days (sort of, depending on your timezone).&lt;br/&gt;
The following check-ins happened on the 17th and 18th:&lt;br/&gt;
r805275 | bpendleton | 2009-08-17 21:38:57 -0700 (Mon, 17 Aug 2009) | 13 lines&lt;br/&gt;
	&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4318&quot; title=&quot;convert inbetween.sql to JUNIT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4318&quot;&gt;&lt;del&gt;DERBY-4318&lt;/del&gt;&lt;/a&gt;: Convert inbetween.sql to JUnit&lt;br/&gt;
r805443 | rhillegas | 2009-08-18 08:08:18 -0700 (Tue, 18 Aug 2009) | 1 line&lt;br/&gt;
                     &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4092&quot; title=&quot;You should not be able to invoke a table function as a scalar function&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4092&quot;&gt;&lt;del&gt;DERBY-4092&lt;/del&gt;&lt;/a&gt;: Don&apos;t allow invocations of table functions in contexts which expect a scalar function return value.&lt;br/&gt;
r805448 | rhillegas | 2009-08-18 08:25:03 -0700 (Tue, 18 Aug 2009) | 1 line&lt;br/&gt;
	&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-700&quot; title=&quot;Derby does not prevent dual boot of database from different classloaders on Linux and Mac OS X&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-700&quot;&gt;&lt;del&gt;DERBY-700&lt;/del&gt;&lt;/a&gt;: Gracefully handle OverlappingFileLockException if someone attempts to  boot a database twice.&lt;/p&gt;</comment>
                            <comment id="12748300" author="olesolberg" created="Thu, 27 Aug 2009 09:36:57 +0100"  >&lt;p&gt;Also seen in the Sun testing: &lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.6/testing/Limited/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.6/testing/Limited/&lt;/a&gt; , &lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.5/testing/Limited/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.5/testing/Limited/&lt;/a&gt; and &lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.4/testing/Limited/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.4/testing/Limited/&lt;/a&gt; .&lt;/p&gt;

&lt;p&gt;I see that this is the same failure signature and method as in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3202&quot; title=&quot;&amp;#39;AccessControlException: access denied (java.io.FilePermission C:\....\file-2.log read)&amp;#39; in ErrorStreamTest.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3202&quot;&gt;&lt;del&gt;DERBY-3202&lt;/del&gt;&lt;/a&gt;. See e.g. &lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.6/FailReports/808072_bySig.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.6/FailReports/808072_bySig.html&lt;/a&gt; .&lt;/p&gt;</comment>
                            <comment id="12749603" author="mamtas" created="Mon, 31 Aug 2009 21:16:24 +0100"  >&lt;p&gt;I ran the test standalone and that doesn&apos;t repro the failure. &lt;/p&gt;

&lt;p&gt;Running it&apos;s suite also didn&apos;t repro the problem (it belongs to engine._suite). &lt;/p&gt;

&lt;p&gt;I modified AllPackages.java to run only following to see if I can reproduce the problem but that didn&apos;t help either. &lt;br/&gt;
        suite.addTest(org.apache.derbyTesting.functionTests.tests.tools._Suite.suite());&lt;br/&gt;
        suite.addTest(org.apache.derbyTesting.functionTests.tests.engine._Suite.suite());&lt;/p&gt;

&lt;p&gt;I will try to add few more suites to see what consistently reproduces the problem and debug it further.&lt;/p&gt;

&lt;p&gt;I looked at &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3202&quot; title=&quot;&amp;#39;AccessControlException: access denied (java.io.FilePermission C:\....\file-2.log read)&amp;#39; in ErrorStreamTest.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3202&quot;&gt;&lt;del&gt;DERBY-3202&lt;/del&gt;&lt;/a&gt; and it appears that this exact failure was noticed there and apparently after the fix went in for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3202&quot; title=&quot;&amp;#39;AccessControlException: access denied (java.io.FilePermission C:\....\file-2.log read)&amp;#39; in ErrorStreamTest.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3202&quot;&gt;&lt;del&gt;DERBY-3202&lt;/del&gt;&lt;/a&gt;, it was not reported again so I am not sure what has triggered it back.&lt;/p&gt;</comment>
                            <comment id="12750435" author="mamtas" created="Wed, 2 Sep 2009 14:35:34 +0100"  >&lt;p&gt;It appears that the problem can be consistently produced with having just two suites and I have changed store suite to only run suite.addTest(ClassLoaderBootTest.suite());&lt;br/&gt;
        suite.addTest(org.apache.derbyTesting.functionTests.tests.store._Suite.suite());&lt;br/&gt;
        suite.addTest(org.apache.derbyTesting.functionTests.tests.engine._Suite.suite());&lt;/p&gt;

&lt;p&gt;If I switch the order of the 2 suites above, the problem does not occur. So, it appears that the problem may have been caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-700&quot; title=&quot;Derby does not prevent dual boot of database from different classloaders on Linux and Mac OS X&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-700&quot;&gt;&lt;del&gt;DERBY-700&lt;/del&gt;&lt;/a&gt; which introduced the test ClassLoaderBootTest. I will look futher into &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-700&quot; title=&quot;Derby does not prevent dual boot of database from different classloaders on Linux and Mac OS X&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-700&quot;&gt;&lt;del&gt;DERBY-700&lt;/del&gt;&lt;/a&gt; changes but will appreciate if someone has insight on what is the dependency between ClassLoaderBootTest and ErrorStreamTest.&lt;/p&gt;</comment>
                            <comment id="12750630" author="rhillegas" created="Wed, 2 Sep 2009 20:45:26 +0100"  >&lt;p&gt;Hi Mamta,&lt;/p&gt;

&lt;p&gt;I notice that this test fails under Java 5. On that VM, only one of the ClassLoaderBootTests runs. That is testBootingDatabaseShutdownByAnotherCLR(). That test does the following:&lt;/p&gt;

&lt;p&gt;1) Boots a database in a separate class loader&lt;/p&gt;

&lt;p&gt;2) Shuts down the database&lt;/p&gt;

&lt;p&gt;3) Boots the database in a second class loader&lt;/p&gt;

&lt;p&gt;4) Shuts down the database&lt;/p&gt;

&lt;p&gt;Maybe ClassLoaderBootTest needs to shutdown the engine and not just shutdown the database. I can&apos;t test this theory because the tests run cleanly on my Mac OS X platform. But maybe you could try out this experiment on windows.&lt;/p&gt;</comment>
                            <comment id="12750740" author="mamtas" created="Thu, 3 Sep 2009 01:06:59 +0100"  >&lt;p&gt;Thanks for your comment, Rick. I tried putting at the end of testBootingDatabaseShutdownByAnotherCLR()&lt;br/&gt;
getTestConfiguration().shutdownEngine();&lt;br/&gt;
Shutting down the engine this way didn&apos;t fix the problem. Is that the right way of shutting down the engine when dealing with classloader scenario?&lt;/p&gt;</comment>
                            <comment id="12752854" author="mamtas" created="Wed, 9 Sep 2009 02:22:45 +0100"  >&lt;p&gt;Checked in a fix for the problem earlier today with revision 812669. As Rick correctly pointed out, it was not enough to just shutdown the database on Windows machine. I added the code to shutdown the engine using the supplied datasource as the parameter. It is not enough to use the existing method         getTestConfiguration().shutdownEngine();&lt;br/&gt;
to shutdown the engine because we want to shutdown the Derby instance created by the different classloaders here. &lt;/p&gt;

&lt;p&gt;I am attaching a very crude standalone version of the bug behavior (mamta.java). The bug behavior can be seen if one were to comment out the calls to datasource shutdown engine code in mamta.java&lt;br/&gt;
        JDBCDataSource.shutEngine(ds_2);&lt;br/&gt;
        JDBCDataSource.shutEngine(ds_1);&lt;/p&gt;</comment>
                            <comment id="12754573" author="mamtas" created="Sat, 12 Sep 2009 18:56:05 +0100"  >&lt;p&gt;Backported changes into 10.5 codeline using revision 814216&lt;/p&gt;</comment>
                            <comment id="12754645" author="mamtas" created="Sun, 13 Sep 2009 01:39:56 +0100"  >&lt;p&gt;backported the changes to 10.4 codeline&lt;/p&gt;</comment>
                            <comment id="12755113" author="mamtas" created="Mon, 14 Sep 2009 19:00:48 +0100"  >&lt;p&gt;Checked in fixes into trunk, 10.5 and 10.4 codeline and didn&apos;t see the failure again on my clients so will go ahead and close the jira.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12419008" name="mamta.java" size="6668" author="mamtas" created="Wed, 9 Sep 2009 02:22:45 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 27 Aug 2009 04:15:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24207</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0kzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37219</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>