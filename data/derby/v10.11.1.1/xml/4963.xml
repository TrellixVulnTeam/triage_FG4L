<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:27:58 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4963/DERBY-4963.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4963] Revert to FileDescriptor#sync from FileChannel#force to improve interrupt resilience</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4963</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;FileChannel.force is interruptable, and we really don&apos;t want to be interrupted when we flush the log file.  Happily, on most platforms, we use the &quot;rws&quot;/&quot;rwd&quot; file open mask which makes the writes thjemselves synchronized, so no subsequent explicit file level sync is needed anyway.&lt;/p&gt;

&lt;p&gt;DirFile4#getRandowmAccessFile should use plain DirRandomAccessFile instead of the current DirRandomAccessFile4. This will make StorageRandomAccessFile#sync map to FileDescriptor#sync instead of FileChannel#force (also for NIO supporting platforms). &lt;/p&gt;

&lt;p&gt;Since FileDescriptor#sync does not allow synching file data only (it also synchronizes metadata), those platforms which do not support write synchronization will experience a performance drop, but this is the price we have to pay to survive interrupts without shutting down the database on those platforms. &lt;/p&gt;

&lt;p&gt;Users which experience this as a problem, should update to a newer JVM which does support &quot;rws&quot;/&quot;rwd&quot; in the mode argument to java.io.RandomAccessFile (&lt;a href=&quot;http://download.oracle.com/javase/6/docs/api/java/io/RandomAccessFile.html#RandomAccessFile(java.io.File,%20java.lang.String&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://download.oracle.com/javase/6/docs/api/java/io/RandomAccessFile.html#RandomAccessFile(java.io.File,%20java.lang.String&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Cf. also discussion on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4741?focusedCommentId=12977862&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12977862&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DERBY-4741?focusedCommentId=12977862&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12977862&lt;/a&gt; .&lt;/p&gt;</description>
                <environment></environment>
        <key id="12495149">DERBY-4963</key>
            <summary>Revert to FileDescriptor#sync from FileChannel#force to improve interrupt resilience</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Jan 2011 17:31:41 +0000</created>
                <updated>Mon, 17 Jun 2013 10:19:22 +0100</updated>
                            <resolved>Tue, 11 Jan 2011 15:47:32 +0000</resolved>
                                                    <fixVersion>10.8.1.2</fixVersion>
                                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12979661" author="dagw" created="Mon, 10 Jan 2011 17:32:18 +0000"  >&lt;p&gt;Linking to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4741&quot; title=&quot;Make embedded Derby work reliably in the presence of thread interrupts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4741&quot;&gt;&lt;del&gt;DERBY-4741&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12979662" author="dagw" created="Mon, 10 Jan 2011 17:35:07 +0000"  >&lt;p&gt;Marking with &quot;release note needed&quot; since we lose performance on some old platforms.&lt;/p&gt;</comment>
                            <comment id="12979666" author="dagw" created="Mon, 10 Jan 2011 18:01:27 +0000"  >&lt;p&gt;Uploading patch derby-4961-1, running regressions.&lt;/p&gt;

&lt;p&gt;Since the new StorageRandomAccessFile#sync implementation will now never heed the metaflag, I removed it.&lt;/p&gt;</comment>
                            <comment id="12979899" author="dagw" created="Tue, 11 Jan 2011 01:30:39 +0000"  >&lt;p&gt;Regressions ran ok, will commit tomorrow.&lt;/p&gt;</comment>
                            <comment id="12980027" author="knutanders" created="Tue, 11 Jan 2011 09:58:54 +0000"  >&lt;p&gt;I ran the single-record update performance test in derbyTesting.jar on Solaris/JDK6 with the write-cache disabled, and I didn&apos;t see any performance loss with the patch. Solaris is one of the platforms on which rws vs rwd, or sync(true) vs sync(false), does make a difference, so it seems you&apos;re right that the code path in question is not executed on recent JVMs. If there had been a change from one write operation to two write operations per log flush, the single-record update performance test should have detected it.&lt;/p&gt;</comment>
                            <comment id="12980030" author="knutanders" created="Tue, 11 Jan 2011 10:03:54 +0000"  >&lt;p&gt;java/engine/org/apache/derby/impl/io/build.xml has two references to DirRandomAccessFile4.java. We should probably remove them as well now that we remove the file.&lt;/p&gt;</comment>
                            <comment id="12980122" author="dagw" created="Tue, 11 Jan 2011 14:37:28 +0000"  >&lt;p&gt;&amp;gt; java/engine/org/apache/derby/impl/io/build.xml has two references to DirRandomAccessFile4&lt;/p&gt;

&lt;p&gt;Thanks for test driving this patch and catching that omission, Knut! I agree those dangling references should be cleaned up.&lt;br/&gt;
Good to hear the performance test didn&apos;t show any drop! &lt;br/&gt;
I also verified in the debugger that the file level sync isn&apos;t used for flushing the log on platforms that support rws/rwd, so I think we are ok.&lt;/p&gt;</comment>
                            <comment id="12980148" author="dagw" created="Tue, 11 Jan 2011 15:47:32 +0000"  >&lt;p&gt;Committed derby-4963-2 as svn 1057702, resolving. WIll keep it open till I have produced a release note.&lt;/p&gt;</comment>
                            <comment id="13001031" author="rhillegas" created="Tue, 1 Mar 2011 19:12:06 +0000"  >&lt;p&gt;Attaching the first rev of a release note for this issue. Dag and Knut, you may want to sanity check this note since you are familiar with the patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="13001117" author="knutanders" created="Tue, 1 Mar 2011 21:15:12 +0000"  >&lt;p&gt;Thanks for writing the release note, Rick. It is clear and looks correct for the most part. The one thing I believe is inaccurate, is the sentence &quot;Solaris/JDK5 is one of these platforms.&quot; I don&apos;t think Solaris is affected by this change, at least not on JDK 5.&lt;/p&gt;

&lt;p&gt;I think the only platforms affected are those that suffered from &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1&quot; title=&quot;Can&amp;#39;t create a new db on OS X&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1&quot;&gt;&lt;del&gt;DERBY-1&lt;/del&gt;&lt;/a&gt;, which are some old releases of Java 1.4.2 and Java 5 on Mac OS/X and FreeBSD (and possibly other BSDs). And, looking at the code, it probably also affects a code path taken by all JVMs at version 1.4.0 and 1.4.1, but I&apos;m not sure if we still support those variants of 1.4 or if we require 1.4.2 now.&lt;/p&gt;

&lt;p&gt;Dag, does that sound correct, or did I garble things?&lt;/p&gt;</comment>
                            <comment id="13001344" author="knutanders" created="Wed, 2 Mar 2011 08:59:29 +0000"  >&lt;p&gt;Dag answered on derby-dev:&lt;/p&gt;

&lt;p&gt;Sounds right.&lt;/p&gt;

&lt;p&gt;Quote from Derby-4741:&lt;/p&gt;

&lt;p&gt;Cf. &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1&quot; title=&quot;Can&amp;#39;t create a new db on OS X&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1&quot;&gt;&lt;del&gt;DERBY-1&lt;/del&gt;&lt;/a&gt; and check in LogToFile#openLogFileInWriteMode which calls&lt;br/&gt;
checkJvmSyncError to determine this. The platforms mentioned are&lt;br/&gt;
(e.g. early versions of 1.4.2 and 1.5 on Mac OS and FreeBSD&lt;/p&gt;

&lt;p&gt;As for Sun JVM 1.4.0 and 1.4.1, I have not investigated those, but what&lt;br/&gt;
you say may be true.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Dag&lt;/p&gt;</comment>
                            <comment id="13001345" author="knutanders" created="Wed, 2 Mar 2011 09:02:32 +0000"  >&lt;p&gt;My comment about 1.4.0 and 1.4.1 was based on this comment in LogToFile:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Note: Why logging system support file sync and write sync ?&lt;/li&gt;
	&lt;li&gt;Note : The reason to support file and write sync of logs is&lt;/li&gt;
	&lt;li&gt;there was no support to do write sync until jdk1.4 and then&lt;/li&gt;
	&lt;li&gt;there was write sync jvm bug in jdk1.4.1, only in jdk1.4.2 write&lt;/li&gt;
	&lt;li&gt;sync(rws and rwd modes) mechanism can be used correctly.&lt;/li&gt;
	&lt;li&gt;Default in JVMS &amp;gt;= jdk1.4.2 is write sync(see the boot method for jvm checks).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;And in DirStorageFactory4:&lt;/p&gt;

&lt;p&gt;	private static final boolean	rwsOK = JVMInfo.JDK_ID &amp;gt;= JVMInfo.J2SE_142;&lt;/p&gt;</comment>
                            <comment id="13001588" author="rhillegas" created="Wed, 2 Mar 2011 20:08:50 +0000"  >&lt;p&gt;Attaching a new rev of the release note, incorporating feedback from Knut and Dag.&lt;/p&gt;</comment>
                            <comment id="13001918" author="knutanders" created="Thu, 3 Mar 2011 08:42:10 +0000"  >&lt;p&gt;Thanks, Rick! The release note looks fine to me.&lt;/p&gt;</comment>
                            <comment id="13685216" author="knutanders" created="Mon, 17 Jun 2013 10:19:22 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12469090">DERBY-4741</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12467901" name="derby-4963-1.diff" size="11934" author="dagw" created="Mon, 10 Jan 2011 18:01:27 +0000"/>
                            <attachment id="12467902" name="derby-4963-1.stat" size="914" author="dagw" created="Mon, 10 Jan 2011 18:01:27 +0000"/>
                            <attachment id="12468017" name="derby-4963-2.diff" size="12830" author="dagw" created="Tue, 11 Jan 2011 15:49:00 +0000"/>
                            <attachment id="12468018" name="derby-4963-2.stat" size="969" author="dagw" created="Tue, 11 Jan 2011 15:49:00 +0000"/>
                            <attachment id="12472457" name="releaseNote.html" size="4386" author="rhillegas" created="Wed, 2 Mar 2011 20:08:50 +0000"/>
                            <attachment id="12472344" name="releaseNote.html" size="4304" author="rhillegas" created="Tue, 1 Mar 2011 19:12:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 11 Jan 2011 09:58:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31454</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10101"><![CDATA[Release Note Needed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0h0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36576</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>