<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:28:31 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5234/DERBY-5234.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5234] Unable to insert data into table. Failed due be &quot;ERROR XSDG0: Page Page(51919,Container(0, 1104)) could not be read from disk.&quot;</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5234</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>
&lt;p&gt;One of the derby database table &quot;gets corrupted&quot;/&quot;indicates connection not available&quot; during processing inserts from java client application as shown in the trace and the only way to recover from this error is to rebuild the DB - by deleting the data and creating the tables again. This happens once in a while (thrice in a span of two months) and the java application (run in multiple servers), which updates the database, processes around 100 million transactions per hour (in total and each transation results in 4-5 updates to the DB) &lt;/p&gt;

&lt;p&gt;There are eight tables in the derby database.&lt;/p&gt;

&lt;p&gt;   TABLE NAME                           ROWS COUNT (at time of corruption)&lt;br/&gt;
---------------------------------------------------------------------------------&lt;br/&gt;
   KPI.KPI_MERGEIN;                     362917&lt;br/&gt;
   KPI.KPI_IN;                                 422508&lt;br/&gt;
   KPI.KPI_DROPPED;                    53667&lt;br/&gt;
   KPI.KPI_ERROR1;                       0&lt;br/&gt;
   KPI.KPI_ERROR2;                       2686&lt;br/&gt;
   KPI.KPI_ERRORMERGE;            0&lt;br/&gt;
   KPI.KPI_MERGEOUT;                 362669&lt;br/&gt;
   KPI.KPI_OUT;                             125873&lt;/p&gt;

&lt;p&gt;The derby database has been started with the following parameters &lt;/p&gt;

&lt;p&gt;CMD=&quot;java -Dderby.system.home=$DERBY_OPTS -Dderby.locks.monitor=true -Dderby.locks.deadlockTrace=true -Dderby.locks.escalationThreshold=50000 -Dderby.locks.waitTimeout=&lt;br/&gt;
-1 -Dderby.storage.pageCacheSize=100000 -Xms512M -Xmx3072M -XX:NewSize=256M -classpath $DERBY_CLASSPATH org.apache.derby.drda.NetworkServerControl start -h $KPIDERBYHOST -p $DERBY_KPI_PORT&quot;&lt;/p&gt;

&lt;p&gt;The corrupted database tar (filesystem) in live environment was moved to a test system (Solaris system) and few checks were run on the corrupted DB as part of analysis (DB does start fine)&lt;/p&gt;

&lt;p&gt;While trying to insert a row in any table expect KPI.KPI_MERGEIN, it is successful. But when a new row is inserted into KPI.KPI_MERGEIN table using command line tool it&apos;s throwing below error message (the same message that appeared in live &lt;/p&gt;

&lt;p&gt;ij&amp;gt; INSERT INTO KPI.KPI_MERGEIN (A0_TXN_ID, A1_NE_ID, A2_CHU_IP_ADDR, A3_BATCH_DATE,A5_CODE) VALUES (-1, &apos;BMTDE&apos;, &apos;192.2.1.3&apos;, 231456879, &apos;KSD&apos;);&lt;br/&gt;
ERROR 08006: A network protocol error was encountered and the connection has been terminated: the requested command encountered an unarchitected and implementation-specific condition for which there was no architected message&lt;/p&gt;


&lt;p&gt;and in derby.log file it shows below error stacktrace.&lt;/p&gt;

&lt;p&gt;ERROR XSDG0: Page Page(51919,Container(0, 1104)) could not be read from disk.&lt;br/&gt;
        at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.CachedPage.readPage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.CachedPage.setIdentity(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.services.cache.ConcurrentCache.find(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.FileContainer.initPage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.FileContainer.newPage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.BaseContainer.addPage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.BaseContainerHandle.addPage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.access.heap.HeapController.doInsert(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.access.heap.HeapController.insertAndFetchLocation(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.InsertResultSet.open(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLIMM(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)&lt;br/&gt;
Caused by: java.io.EOFException: Reached end of file while attempting to read a whole page.&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.RAFContainer4.readFull(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage0(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage(Unknown Source)&lt;br/&gt;
        ... 20 more&lt;br/&gt;
============= begin nested exception, level (1) ===========&lt;br/&gt;
java.io.EOFException: Reached end of file while attempting to read a whole page.&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.RAFContainer4.readFull(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage0(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.CachedPage.readPage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.CachedPage.setIdentity(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.services.cache.ConcurrentCache.find(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.FileContainer.initPage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.FileContainer.newPage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.BaseContainer.addPage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.BaseContainerHandle.addPage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.access.heap.HeapController.doInsert(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.access.heap.HeapController.insertAndFetchLocation(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.InsertResultSet.open(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLIMM(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)&lt;br/&gt;
============= end nested exception, level (1) ===========&lt;/p&gt;

&lt;p&gt;2011-05-16 10:37:21.392 GMT:&lt;br/&gt;
Shutting down instance a816c00e-012f-f85f-7892-ffff874c3ff6&lt;br/&gt;
----------------------------------------------------------------&lt;br/&gt;
Cleanup action completed&lt;/p&gt;


&lt;p&gt;The problem is only with INSERT statement. When i try SELECT statement on KPI.KPI_MERGEIN table it is working well.The database file system size (in seg0) is 1.3 GB&lt;/p&gt;

&lt;p&gt;Can anyone help me out in identifying the problem that why for one table alone its throwing the above error message ? Would upgrade to a new version help ? &lt;/p&gt;</description>
                <environment>HP-UX 11iv2 in production environment with JDK1.6; Solaris 5/10 in test environment with JDK 1.6</environment>
        <key id="12507367">DERBY-5234</key>
            <summary>Unable to insert data into table. Failed due be &quot;ERROR XSDG0: Page Page(51919,Container(0, 1104)) could not be read from disk.&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="soxdatabase">Varma R</reporter>
                        <labels>
                            <label>ERROR</label>
                            <label>XSDG0</label>
                            <label>apache</label>
                            <label>corruption</label>
                            <label>data</label>
                            <label>derby</label>
                            <label>derby_triage10_10</label>
                            <label>derby_triage10_9</label>
                    </labels>
                <created>Mon, 16 May 2011 14:57:15 +0100</created>
                <updated>Sat, 19 Oct 2013 04:12:49 +0100</updated>
                            <resolved>Wed, 16 Jan 2013 20:48:31 +0000</resolved>
                                    <version>10.5.3.0</version>
                                                    <component>Store</component>
                        <due></due>
                            <votes>7</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="13034210" author="kristwaa" created="Mon, 16 May 2011 20:19:14 +0100"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I can&apos;t say what has gone wrong, but have a few initial questions that may inform the debugging process:&lt;br/&gt;
 a) Can you run with the debug version of Derby?&lt;br/&gt;
     This would be best during normal operation, before the error has happened, but may not work because all the extra asserts slow down Derby a lot.&lt;br/&gt;
     Booting and accessing (SELECT/INSERT) the corrupted database with the debug version is also useful in some cases, and that&apos;s a lot simpler to do.&lt;br/&gt;
 b) Have you verified that there are no limits on the size of the database files, i.e. OS quotas or file system limitations, in the production environment?&lt;br/&gt;
 c) What happens if you run SYSCS_UTIL.SYSCS_COMPRESS_TABLE on KPI.KPI_MERGEIN after the insert fails?&lt;br/&gt;
     If the compress-operation succeeds, does the insert still fail afterwards?&lt;br/&gt;
 d) Looking at the data file for the corrupted table, is the size a multiple of the page size?&lt;/p&gt;

&lt;p&gt;The failing code is using NIO, but there doesn&apos;t seem to be a problem with interrupts (based on current info only). The two obvious ways the code can fail are if the file for some reason has been truncated or that the position argument is incorrect.&lt;/p&gt;</comment>
                            <comment id="13034679" author="soxdatabase" created="Tue, 17 May 2011 11:19:28 +0100"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Tried the above options mentioned.&lt;br/&gt;
a) Given the below debug option which starting the derby database.&lt;br/&gt;
-Dderby.debug.true=CacheTrace,DaemonTrace,DeadLockTrace,LockStackTrace,LockTrace,LogTrace,memoryLeakTrace,ScanTrace,SerializedTrace,SpaceTrace,TEST_LOG_FULL&lt;/p&gt;

&lt;p&gt;But this didn&apos;t print any additional information in the logs.&lt;/p&gt;

&lt;p&gt;b) Below are the command output&apos;s on test environment. &lt;br/&gt;
-bash-3.00$ ulimit -a | grep file&lt;br/&gt;
core file size        (blocks, -c) unlimited&lt;br/&gt;
file size             (blocks, -f) unlimited&lt;br/&gt;
open files                    (-n) 256&lt;br/&gt;
-bash-3.00$ plimit 5036&lt;br/&gt;
5036:   java -Dderby.system.home=/export/home/cmd -Dderby.locks.monitor=true -&lt;br/&gt;
   resource              current         maximum&lt;br/&gt;
  time(seconds)         unlimited       unlimited&lt;br/&gt;
  file(blocks)          unlimited       unlimited&lt;br/&gt;
  data(kbytes)          unlimited       unlimited&lt;br/&gt;
  stack(kbytes)         10240           unlimited&lt;br/&gt;
  coredump(blocks)      unlimited       unlimited&lt;br/&gt;
  nofiles(descriptors)  65536           65536&lt;br/&gt;
  vmemory(kbytes)       unlimited       unlimited&lt;/p&gt;

&lt;p&gt;you can see that there are no limits on the file system and 65536 is the hard limit for the file descriptors.&lt;/p&gt;

&lt;p&gt;c) After running SYSCS_UTIL.SYSCS_COMPRESS_TABLE procedure on KPI.KPI_MERGEIN table. INSERT command is working on KPI.KPI_MERGEIN table.&lt;/p&gt;

&lt;p&gt;d) How to find out the list of .dat files corresponding to a table in seg0 directory?&lt;/p&gt;

&lt;p&gt;This same application was load tested for higher transcation volume and no such error were reported during development. However the problem in production seems to be pointing to cumulative data/disk usage. Also would it be recommeneded to run SYSCS_UTIL.SYSCS_COMPRESS_TABLE once in a while?&lt;/p&gt;</comment>
                            <comment id="13034987" author="rhillegas" created="Tue, 17 May 2011 20:13:17 +0100"  >&lt;p&gt;Hi Varma,&lt;/p&gt;

&lt;p&gt;To find the data files corresponding to your tables, you can run the following script:&lt;/p&gt;

&lt;p&gt;create function toHexString( a bigint ) returns varchar( 25 )&lt;br/&gt;
language java parameter style java no sql&lt;br/&gt;
external name &apos;java.lang.Long.toHexString&apos;;&lt;/p&gt;

&lt;p&gt;select t.tableName, &apos;c&apos; || toHexString( c.conglomerateNumber ) || &apos;.dat&apos;&lt;br/&gt;
from sys.systables t, sys.sysconglomerates c, sys.sysschemas s&lt;br/&gt;
where t.tableID = c.tableID&lt;br/&gt;
and t.schemaID = s.schemaID&lt;br/&gt;
and s.schemaName not like &apos;SYS%&apos;;&lt;/p&gt;

&lt;p&gt;drop function toHexString;&lt;/p&gt;</comment>
                            <comment id="13035242" author="kristwaa" created="Wed, 18 May 2011 10:15:42 +0100"  >&lt;p&gt;Varma, some comments below:&lt;/p&gt;

&lt;p&gt;a) It&apos;s not clear to me if you run with the Derby debug build, i.e. the debug bundle named &quot;db-derby-10.x.y.z-lib-debug.zip&quot; (downloadable from the Apache Derby site).&lt;br/&gt;
    My hope was that it would detect if there was invalid metadata when accessing the table.&lt;/p&gt;

&lt;p&gt;b) This is probably a dead end anyway (unless item d suggests otherwise). In any case, I think it would only matter on the production system since I assume that&apos;s where the data was actually written to disk.&lt;/p&gt;

&lt;p&gt;c) Interesting. So it appears that the compress operation is able to rectify the state that&apos;s causing the insert to fail.&lt;br/&gt;
    If asked for, could the data file for the apparently corrupted table (or the whole database) be made public?&lt;/p&gt;

&lt;p&gt;Compressing a table is done to reclaim unused disk space for the base table and the indexes. If your load consists of a high rate of deletes and updates, it might be worth running it periodically if possible. See the Reference Guide and &quot;Reclaiming unused space&quot; in the Derby Server and Administration Guide for details.&lt;/p&gt;

&lt;p&gt;I&apos;m hoping someone with a more intimate knowledge about the Derby store can point us in the right direction, and it would be nice to obtain the size of the corrupted table.&lt;br/&gt;
It seems Derby fails to read back a newly created page, which is odd...&lt;/p&gt;</comment>
                            <comment id="13035384" author="soxdatabase" created="Wed, 18 May 2011 14:52:02 +0100"  >&lt;p&gt;@Kristian, Thanks for the help. The data however can&apos;t be made public&lt;/p&gt;

&lt;p&gt;1) Ran the corrupt db data with debug libraries. Here is the output in derby.log&lt;/p&gt;

&lt;p&gt;ERROR XSDG0: Page Page(51919,Container(0, 1104)) could not be read from disk.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:336)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.CachedPage.readPage(CachedPage.java:695)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.CachedPage.setIdentity(CachedPage.java:190)&lt;br/&gt;
	at org.apache.derby.impl.services.cache.ConcurrentCache.find(ConcurrentCache.java:295)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.FileContainer.initPage(FileContainer.java:2317)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.FileContainer.newPage(FileContainer.java:1800)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseContainer.addPage(BaseContainer.java:314)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseContainerHandle.addPage(BaseContainerHandle.java:183)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.HeapController.doInsert(HeapController.java:302)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.HeapController.insertAndFetchLocation(HeapController.java:599)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(RowChangerImpl.java:452)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1022)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:495)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:416)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:297)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:625)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(EmbedStatement.java:175)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLIMM(DRDAConnThread.java:5022)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:750)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:290)&lt;br/&gt;
Caused by: java.io.EOFException: Reached end of file while attempting to read a whole page.&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.RAFContainer4.readFull(RAFContainer4.java:474)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage0(RAFContainer4.java:242)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage(RAFContainer4.java:212)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.CachedPage.readPage(CachedPage.java:671)&lt;br/&gt;
	... 19 more&lt;br/&gt;
============= begin nested exception, level (1) ===========&lt;br/&gt;
java.io.EOFException: Reached end of file while attempting to read a whole page.&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.RAFContainer4.readFull(RAFContainer4.java:474)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage0(RAFContainer4.java:242)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage(RAFContainer4.java:212)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.CachedPage.readPage(CachedPage.java:671)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.CachedPage.setIdentity(CachedPage.java:190)&lt;br/&gt;
	at org.apache.derby.impl.services.cache.ConcurrentCache.find(ConcurrentCache.java:295)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.FileContainer.initPage(FileContainer.java:2317)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.FileContainer.newPage(FileContainer.java:1800)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseContainer.addPage(BaseContainer.java:314)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseContainerHandle.addPage(BaseContainerHandle.java:183)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.HeapController.doInsert(HeapController.java:302)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.HeapController.insertAndFetchLocation(HeapController.java:599)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(RowChangerImpl.java:452)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1022)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:495)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:416)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:297)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:625)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(EmbedStatement.java:175)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLIMM(DRDAConnThread.java:5022)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:750)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:290)&lt;br/&gt;
============= end nested exception, level (1) ===========&lt;/p&gt;


&lt;p&gt;------------  END SHUTDOWN ERROR STACK -------------&lt;/p&gt;

&lt;p&gt;DEBUG FileContainer OUTPUT: got exception from initPage:&lt;br/&gt;
reuse = true&lt;br/&gt;
syncFlag = 0&lt;br/&gt;
allocPage = *** Alloc page ***&lt;br/&gt;
nextAllocPageNumber = -1&lt;br/&gt;
nextAllocPageOffset = 0&lt;br/&gt;
reserved1 = 0&lt;br/&gt;
reserved2 = 0&lt;br/&gt;
reserved3 = 0&lt;br/&gt;
reserved4 = 0&lt;br/&gt;
borrowedSpace = 0&lt;br/&gt;
extent = ------------------------------------------------------------------------------&lt;br/&gt;
Extent map of from page 51918 to page 62341&lt;br/&gt;
	page 51918: valid, in use page&lt;br/&gt;
	page 51919: free page&lt;br/&gt;
	page 51920: free page&lt;br/&gt;
	page 51921: free page&lt;br/&gt;
	page 51922: free page&lt;br/&gt;
	page 51923: free page&lt;br/&gt;
	page 51924: free page&lt;br/&gt;
	page 51925: free page&lt;br/&gt;
	page 51926: free page&lt;br/&gt;
	page 51927: free page&lt;br/&gt;
	page 51928: free page&lt;br/&gt;
	page 51929: free page&lt;br/&gt;
	page 51930: free page&lt;br/&gt;
	page 51931: free page&lt;br/&gt;
	page 51932: free page&lt;br/&gt;
	page 51933: free page&lt;br/&gt;
	page 51934: free page&lt;br/&gt;
	page 51935: free page&lt;br/&gt;
	page 51936: free page&lt;br/&gt;
	page 51937: free page&lt;br/&gt;
	page 51938: free page&lt;br/&gt;
	page 51939: free page&lt;br/&gt;
	page 51940: free page&lt;br/&gt;
	page 51941: free page&lt;br/&gt;
	From 51941 to 62341 are un-allocated pages&lt;br/&gt;
------------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;---------------------------------------------------&lt;br/&gt;
page id: Page(51917,Container(0, 1104)) Overflow: false PageVersion: 51 SlotsInUse: 0 DeletedRowCount: 0 PageStatus: 1 NextId: 6 firstFreeByte: 109 freeSpace: 3979 totalSpace: 3979 spareSpace: 20% minimumRecordSize : 12 PageSize: 4096&lt;br/&gt;
---------------------------------------------------&lt;br/&gt;
Hex dump:&lt;br/&gt;
00000000: 0076 0000 0001 0000 0000 0000 0033 0000  .v...........3..&lt;br/&gt;
00000010: 0000 0006 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000020: 0000 0000 0001 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000030: 0000 0000 0000 0000 0000 0000 ffff ffff  ................&lt;br/&gt;
00000040: ffff ffff 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000050: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000060: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000070: 000c ace0 0000 0000 0000 00ca ce00 0000  ..?........??...&lt;br/&gt;
00000080: 0000 00f3 8500 0000 1830 0000 1200 0000  ....?....0......&lt;br/&gt;
00000090: 1800 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000000a0: 0000 0000 0000 0000 187f ffff 0000 0018  ................&lt;br/&gt;
000000b0: 7fff ff00 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000000c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000000d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000000e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000000f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000100: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000110: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000120: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000130: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000140: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000150: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000160: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000170: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000180: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000190: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000001a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000001b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000001c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000001d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000001e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000001f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000200: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000210: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000220: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000230: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000240: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000250: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000260: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000270: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000280: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000290: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000002a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000002b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000002c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000002d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000002e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000002f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000300: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000310: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000320: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000330: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000340: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000350: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000360: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000370: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000380: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000390: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000003a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000003b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000003c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000003d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000003e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000003f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000400: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000410: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000420: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000430: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000440: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000450: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000460: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000470: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000480: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000490: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000004a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000004b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000004c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000004d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000004e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000004f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000500: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000510: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000520: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000530: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000540: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000550: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000560: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000570: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000580: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000590: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000005a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000005b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000005c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000005d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000005e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000005f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000600: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000610: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000620: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000630: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000640: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000650: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000660: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000670: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000680: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000690: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000006a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000006b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000006c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000006d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000006e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000006f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000700: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000710: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000720: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000730: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000740: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000750: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000760: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000770: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000780: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000790: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000007a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000007b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000007c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000007d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000007e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000007f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000800: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000810: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000820: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000830: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000840: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000850: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000860: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000870: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000880: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000890: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000008a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000008b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000008c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000008d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000008e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000008f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000900: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000910: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000920: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000930: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000940: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000950: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000960: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000970: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000980: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000990: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000009a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000009b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000009c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000009d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000009e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
000009f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000a00: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000a10: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000a20: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000a30: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000a40: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000a50: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000a60: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000a70: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000a80: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000a90: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000aa0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000ab0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000ac0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000ad0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000ae0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000af0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000b00: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000b10: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000b20: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000b30: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000b40: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000b50: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000b60: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000b70: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000b80: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000b90: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000ba0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000bb0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000bc0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000bd0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000be0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000bf0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000c00: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000c10: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000c20: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000c30: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000c40: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000c50: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000c60: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000c70: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000c80: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000c90: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000ca0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000cb0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000cc0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000cd0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000ce0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000cf0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000d00: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000d10: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000d20: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000d30: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000d40: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000d50: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000d60: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000d70: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000d80: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000d90: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000da0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000db0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000dc0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000dd0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000de0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000df0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000e00: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000e10: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000e20: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000e30: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000e40: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000e50: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000e60: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000e70: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000e80: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000e90: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000ea0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000eb0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000ec0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000ed0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000ee0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000ef0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000f00: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000f10: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000f20: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000f30: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000f40: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000f50: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000f60: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000f70: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000f80: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000f90: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000fa0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000fb0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000fc0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000fd0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000fe0: 0000 0000 0000 0000 0000 0000 0000 0000  ................&lt;br/&gt;
00000ff0: 0000 0000 0000 0000 0000 0000 4dc3 fccd  ............M?.?&lt;br/&gt;
---------------------------------------------------&lt;/p&gt;

&lt;p&gt;2011-05-18 12:30:24.189 GMT Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_3,5,main&amp;#93;&lt;/span&gt; (XID = 28699230), (SESSIONID = 1), (DATABASE = kpidb), (DRDAID = GAEDD120.O4F6-4110096304207220172&lt;/p&gt;
{1}), Cleanup action starting&lt;br/&gt;
2011-05-18 12:30:24.189 GMT Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_3,5,main&amp;#93;&lt;/span&gt; (XID = 28699230), (SESSIONID = 1), (DATABASE = kpidb), (DRDAID = GAEDD120.O4F6-4110096304207220172{1}
&lt;p&gt;), Failed Statement is: INSERT INTO KPI.KPI_MERGEIN (A0_TXN_ID, A1_NE_ID, A2_CHU_IP_ADDR, A3_BATCH_DATE,A5_CODE) VALUES (-1, &apos;BMTDE&apos;, &apos;192.2.1.3&apos;, 231456879, &apos;KSD&apos;)&lt;br/&gt;
ERROR XSDG0: Page Page(51919,Container(0, 1104)) could not be read from disk.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:336)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.CachedPage.readPage(CachedPage.java:695)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.CachedPage.setIdentity(CachedPage.java:190)&lt;br/&gt;
	at org.apache.derby.impl.services.cache.ConcurrentCache.find(ConcurrentCache.java:295)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.FileContainer.initPage(FileContainer.java:2317)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.FileContainer.newPage(FileContainer.java:1800)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseContainer.addPage(BaseContainer.java:314)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseContainerHandle.addPage(BaseContainerHandle.java:183)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.HeapController.doInsert(HeapController.java:302)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.HeapController.insertAndFetchLocation(HeapController.java:599)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(RowChangerImpl.java:452)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1022)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:495)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:416)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:297)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:625)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(EmbedStatement.java:175)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLIMM(DRDAConnThread.java:5022)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:750)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:290)&lt;br/&gt;
Caused by: java.io.EOFException: Reached end of file while attempting to read a whole page.&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.RAFContainer4.readFull(RAFContainer4.java:474)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage0(RAFContainer4.java:242)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage(RAFContainer4.java:212)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.CachedPage.readPage(CachedPage.java:671)&lt;br/&gt;
	... 19 more&lt;br/&gt;
============= begin nested exception, level (1) ===========&lt;br/&gt;
java.io.EOFException: Reached end of file while attempting to read a whole page.&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.RAFContainer4.readFull(RAFContainer4.java:474)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage0(RAFContainer4.java:242)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage(RAFContainer4.java:212)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.CachedPage.readPage(CachedPage.java:671)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.CachedPage.setIdentity(CachedPage.java:190)&lt;br/&gt;
	at org.apache.derby.impl.services.cache.ConcurrentCache.find(ConcurrentCache.java:295)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.FileContainer.initPage(FileContainer.java:2317)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.FileContainer.newPage(FileContainer.java:1800)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseContainer.addPage(BaseContainer.java:314)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseContainerHandle.addPage(BaseContainerHandle.java:183)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.HeapController.doInsert(HeapController.java:302)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.HeapController.insertAndFetchLocation(HeapController.java:599)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(RowChangerImpl.java:452)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1022)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:495)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:416)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:297)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:625)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(EmbedStatement.java:175)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLIMM(DRDAConnThread.java:5022)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:750)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:290)&lt;br/&gt;
============= end nested exception, level (1) ===========&lt;/p&gt;

&lt;p&gt;2011-05-18 12:30:24.189 GMT:&lt;br/&gt;
Shutting down instance a816c00e-0130-0313-18c9-ffff874c3ff6&lt;br/&gt;
----------------------------------------------------------------&lt;br/&gt;
Cleanup action completed&lt;/p&gt;

&lt;p&gt;2) The production environment does include delete scripts to delete data older than 7 days and it is run every 15 minutes. Also SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE procedure is run once every day to release free pages to OS. &lt;/p&gt;

&lt;p&gt;Intersting observation however is, it is SYSCS_UTIL.SYSCS_COMPRESS_TABLE procedure on the corrupt db that made it work. Running SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE procedure on the corrupt db returned the following error.&lt;/p&gt;

&lt;p&gt;ERROR 38000: DERBY SQL error: SQLCODE: -1, SQLSTATE: 38000, SQLERRMC: java.sql.SQLException: Page Page(51919,Container(0, 1104)) could not be read from disk.38000XSDG0:Page(51919,Container(0, 1104))4096XSDG0.DXJ001:java.io.EOFExceptionReached end of file while attempting to read a whole page.XJ001.U&lt;br/&gt;
ERROR XSDG0: DERBY SQL error: SQLCODE: 0, SQLSTATE: XSDG0, SQLERRMC: Page(51919,Container(0, 1104))4096XSDG0.D&lt;br/&gt;
ERROR XJ001: DERBY SQL error: SQLCODE: 0, SQLSTATE: XJ001, SQLERRMC: java.io.EOFExceptionReached end of file while attempting to read a whole page.XJ001.U&lt;/p&gt;

&lt;p&gt;Would it be recommeneded to run the other compress script instead of inplace compress script? Also would upgrading to newer version would help.&lt;/p&gt;

&lt;p&gt;@Rick , regarding Page size query - the file system are indeed mutiple of 32Kb &lt;/p&gt;

&lt;p&gt;KPI_IN&lt;br/&gt;
254169088 c400.dat&lt;br/&gt;
44179456	 c501.dat&lt;br/&gt;
48295936	c581.dat&lt;br/&gt;
197808128	c481.dat&lt;br/&gt;
KPI_ERROR1	&lt;br/&gt;
8192	c591.dat&lt;br/&gt;
8192	c511.dat&lt;br/&gt;
8192	c491.dat&lt;br/&gt;
8192	c410.dat&lt;br/&gt;
KPI_ERROR2	&lt;br/&gt;
1630208	c420.dat&lt;br/&gt;
258048	c5a1.dat&lt;br/&gt;
184320	c521.dat&lt;br/&gt;
2142208	c4a1.dat&lt;br/&gt;
KPI_ERRORMERGE	&lt;br/&gt;
8192	c4b1.dat&lt;br/&gt;
8192	c430.dat&lt;br/&gt;
8192	c5b1.dat&lt;br/&gt;
8192	c531.dat&lt;br/&gt;
KPI_DROPPED	&lt;br/&gt;
4980736	c5c1.dat&lt;br/&gt;
3477504	c541.dat&lt;br/&gt;
15597568	c4c1.dat&lt;br/&gt;
31903744	c440.dat&lt;br/&gt;
KPI_MERGEIN	&lt;br/&gt;
43851776	c5d1.dat&lt;br/&gt;
27942912	c551.dat&lt;br/&gt;
148070400	c4d1.dat&lt;br/&gt;
212660224	c450.dat&lt;br/&gt;
KPI_MERGEOUT	&lt;br/&gt;
121430016	c4e1.dat&lt;br/&gt;
48001024	c460.dat&lt;br/&gt;
45146112	c5e1.dat&lt;br/&gt;
19886080	c561.dat&lt;br/&gt;
KPI_OUT	&lt;br/&gt;
7487488	c571.dat&lt;br/&gt;
15474688	c5f1.dat&lt;br/&gt;
46276608	c4f1.dat&lt;br/&gt;
57602048	c470.dat&lt;/p&gt;
</comment>
                            <comment id="13035388" author="bryanpendleton" created="Wed, 18 May 2011 14:57:20 +0100"  >&lt;p&gt;Any chance you&apos;re hitting a filesystem quota of some sort? Have you checked all the ulimit-like settings? This feels like the sort of problem where the operating system is truncating the file or partially writing it because the operating system thinks the process has hit its limit.&lt;/p&gt;</comment>
                            <comment id="13035420" author="soxdatabase" created="Wed, 18 May 2011 15:53:29 +0100"  >&lt;p&gt;@Bryan, I doubt. &lt;/p&gt;

&lt;p&gt;The corrupted DB was moved from Production (HP-UX) to test environment (Solaris &amp;amp; Windows) and the DB was started with the exact settings.  All three environments return the same error on INSERT in the KPI.KPI_MERGE_IN table&lt;/p&gt;</comment>
                            <comment id="13035551" author="rhillegas" created="Wed, 18 May 2011 19:29:00 +0100"  >&lt;p&gt;Hi Varma,&lt;/p&gt;

&lt;p&gt;This may be a red herring, but it is worth asking: does your application experience thread interrupts?&lt;/p&gt;

&lt;p&gt;Some useful information might surface if you run the DataFileReader tool against the corrupt heap conglomerate. The tool is attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5201&quot; title=&quot;Create tools for reading the contents of the seg0 directory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5201&quot;&gt;DERBY-5201&lt;/a&gt;. Redirect the output to a file and then attach that file to this JIRA issue. Help on the tool&apos;s usage can be obtained by typing&lt;/p&gt;

&lt;p&gt;  java DataFileReader&lt;/p&gt;

&lt;p&gt;I think that the following experiment would be useful (where $dbName is the name of your database directory):&lt;/p&gt;

&lt;p&gt;  java DataFileReader $dbName/seg0/c450.dat -v -p 51916 -n 6 &amp;gt; c450_partial.xml&lt;/p&gt;

&lt;p&gt;You can also use the -d option of the tool if you are willing to disclose the data which appears in the closing pages of the file. See the help output for a description of how to use the -d option. You can, of course, redact any sensitive information in the output.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13036774" author="soxdatabase" created="Fri, 20 May 2011 11:58:13 +0100"  >&lt;p&gt;Attached(DataFileReader_Output.zip) the XML files generated when DataFileReader.class run on KPI.KPI_MERGEIN table .DAT files.&lt;/p&gt;</comment>
                            <comment id="13037748" author="soxdatabase" created="Mon, 23 May 2011 07:14:10 +0100"  >&lt;p&gt;Current Version of Derby been used in production is 10.5.3.0. Will the problem be resolved by upgrading derby database to latest version(which is 10.8.1.2)?&lt;/p&gt;</comment>
                            <comment id="13038147" author="rhillegas" created="Mon, 23 May 2011 20:12:59 +0100"  >&lt;p&gt;Hi Varma,&lt;/p&gt;

&lt;p&gt;It&apos;s hard to say if an upgrade will fix this problem since we don&apos;t understand the root cause yet. The reason I asked whether your application experiences interrupts is that they could potentially result in a data corruption on version 10.5.3.0. Substantial work was put into protecting Derby from interrupts in 10.8.1.2. Can you say whether your application might be experiencing thread interrupts?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13038293" author="dagw" created="Mon, 23 May 2011 23:41:35 +0100"  >&lt;p&gt;The dump of the data pages seem to indicate that the file has no pages from page 51919 onwards (the last dumped is 515918 on c450.dat). The data dumped show that page 51917 has an extent that coincides with the one we saw dumped:&lt;br/&gt;
Start/end:: 51918:62341. And page 51918 is indeed present and valid in the dump. But no further pages are printed. Rick, does the tool continue printiing till it reaches EOF or does it stop according some variable in the container stating how many pages are allocated? I am not very familiar with this code at all, but doesn&apos;t the presence of the extent information on page 51917 indicated that pages from 51918:62341 should be allocated (e.g be not handled back to the operating system after an inline compress with truncate end option&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;)?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://db.apache.org/derby/docs/10.5/ref/rrefproceduresinplacecompress.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/docs/10.5/ref/rrefproceduresinplacecompress.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Btw, Varma, does the app ever perform in-place compress?&lt;/p&gt;</comment>
                            <comment id="13038555" author="rhillegas" created="Tue, 24 May 2011 14:40:38 +0100"  >&lt;p&gt;Hi, Dag. By default, the DataFileReader tool reads until it reaches EOF. You can also tell it to stop reading after a fixed number of pages. &lt;/p&gt;

&lt;p&gt;The page size of c450.dat is 4096, the file is 212660224 bytes long according to Varma&apos;s comment on 2011-05-18, so the number of pages in the file is 212660224 / 4096 = 51919. This agrees with what the tool found: the tool successfully decoded pages 0 - 51918.&lt;/p&gt;

&lt;p&gt;The extent lengths are:&lt;/p&gt;

&lt;p&gt;grep extentLength Output_c450.dat.xml &lt;br/&gt;
            &amp;lt;extentLength&amp;gt;10216&amp;lt;/extentLength&amp;gt;&lt;br/&gt;
            &amp;lt;extentLength&amp;gt;10424&amp;lt;/extentLength&amp;gt;&lt;br/&gt;
            &amp;lt;extentLength&amp;gt;10424&amp;lt;/extentLength&amp;gt;&lt;br/&gt;
            &amp;lt;extentLength&amp;gt;10424&amp;lt;/extentLength&amp;gt;&lt;br/&gt;
            &amp;lt;extentLength&amp;gt;10424&amp;lt;/extentLength&amp;gt;&lt;br/&gt;
            &amp;lt;extentLength&amp;gt;24&amp;lt;/extentLength&amp;gt;&lt;/p&gt;

&lt;p&gt;It does seem odd that the last allocation page thinks there are 24 more pages but there is really only 1 more page.&lt;/p&gt;</comment>
                            <comment id="13039363" author="mikem" created="Wed, 25 May 2011 22:59:23 +0100"  >&lt;p&gt;The issues here all have the feel of the database getting broken sometime in past.  Usually once broken not much can be&lt;br/&gt;
done, including upgrading - other than rebuild.  I would suggest running the consistency checker across the whole database&lt;br/&gt;
to see if there are other hidden problems lurking.&lt;/p&gt;

&lt;p&gt;Given the end of file issues it would be interesting to know:&lt;br/&gt;
    o I see you run online compress once a day, maybe there is a bug in this code.   Can you tell us exactly how you run this, as it has&lt;br/&gt;
       3 options that can be set.  This code definitely executes a path that manipulates the end of file which seems to where the problem&lt;br/&gt;
       is.  But the case you are noting more has the feel a problem in a normal allocation.  Derby will extend the file the file by a group&lt;br/&gt;
       of pages and then force these empty new pages to disk.  For some reason this group has not made it to disk, the extent map is&lt;br/&gt;
       indicating that it should be there, so an error results because we can&apos;t find it there.  Even though it is a new page, sometimes&lt;br/&gt;
       a free page is really a reused page and we need some information from the old page to properly create the new page.  &lt;br/&gt;
    o I am not too familar with HP unix, so not sure if these questions are applicable.  Can you describe the file system that derby &lt;br/&gt;
       is running on there.  Is there any chance that I/O system forces through java are not being respected by the filesystem/hardware.&lt;br/&gt;
       On other unix systems there are options available to force wait on synchronous writes, and derby depends on this.  Unfortunately&lt;br/&gt;
       often the default is to pretend that write sync is happening when it is not and this can cause problems for Derby.  &lt;/p&gt;

&lt;p&gt;Without the actual db it is hard to know what is going on exactly from just the stack.  I thought derby was meant to be able to handle&lt;br/&gt;
some &quot;missing&quot; pages at the end of the file, so this would be one case where it might be useful to try a more recent version of the&lt;br/&gt;
Derby software.  It could be that I am remembering recovery logic rather than runtime logic.&lt;br/&gt;
The missing pages feels like a lost &quot;force&quot; of the free pages thus the questions about filesystem/hardware settings.  Running the &lt;br/&gt;
consistency checker could find other lsot forces that may have existed.&lt;/p&gt;

&lt;p&gt;This kind of error can also come from users manipulating files in the log directory.  Have you ever &quot;fixed&quot; a problem where the&lt;br/&gt;
database would not boot by removing files from the log directory?&lt;/p&gt;

&lt;p&gt;In trying to understand what might have happened to cause the bug, can you correlate at all the problems happening with machine&lt;br/&gt;
crashes at all?  &lt;/p&gt;</comment>
                            <comment id="13039377" author="mikem" created="Wed, 25 May 2011 23:15:05 +0100"  >&lt;p&gt;I am not surprised that SYSCS_UTIL.SYSCS_COMPRESS_TABLE fixed the problem, as it seems the issue is in just the last few pages of the file that are marked free but not actually on disk.  This version of compress which I refer to as offline, just reads through the used pages of the file and inserts into the new table and never looks at the problem empty and not on disk pages at the end of the file.  &lt;/p&gt;
</comment>
                            <comment id="13039382" author="mikem" created="Wed, 25 May 2011 23:19:39 +0100"  >&lt;p&gt;it is interesting that the case is exactly at a new extent which may or may not be the issue.  It you have any other examples of this problem it would help to know if the end of the file looks the same as this one.  Again once this problem happens a number of things&lt;br/&gt;
are likely to break, and the real problem is not the insert but what allowed the allocate of the free pages to finish without the space on&lt;br/&gt;
disk being forced.  &lt;/p&gt;</comment>
                            <comment id="13039583" author="soxdatabase" created="Thu, 26 May 2011 09:15:49 +0100"  >&lt;p&gt;@Dag - Inplace Compress command is called once every day.&lt;/p&gt;</comment>
                            <comment id="13165312" author="stefan_sitte" created="Thu, 8 Dec 2011 16:36:18 +0000"  >&lt;p&gt;I have also problems with the inplace compress function of derby.&lt;br/&gt;
With the attached snippet (DbCompressErrorTester.java) i can reproduce the &quot;Reached end of file while attempting to read a whole page.&quot; exception. Perhaps it can help to fix the error.&lt;br/&gt;
Tested with derby version 10.8.1.2 and 10.8.2.2.&lt;/p&gt;

&lt;p&gt;I insert some data into a table. Then i delete all data and call SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE with PURGE_ROWS=0, DEFRAGMENT_ROWS=0 and TRUNCATE_END=1. After some additional insert derby throws following exception:&lt;br/&gt;
java.sql.SQLException: Page Page(10219,Container(0, 1136)) could not be read from disk.&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.seeNextException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(Unknown Source)&lt;br/&gt;
        at DbCompressErrorTester.insertData(DbCompressErrorTester.java:164)&lt;br/&gt;
        at DbCompressErrorTester.test(DbCompressErrorTester.java:118)&lt;br/&gt;
        at DbCompressErrorTester.main(DbCompressErrorTester.java:40)&lt;br/&gt;
Caused by: java.sql.SQLException: Page Page(10219,Container(0, 1136)) could not be read from disk.&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source)&lt;br/&gt;
        ... 13 more&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;Reached end of file while attempting to read a whole page.: java.io.EOFException&apos;.&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)&lt;br/&gt;
        ... 10 more&lt;br/&gt;
Caused by: java.io.EOFException: Reached end of file while attempting to read a whole page.&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.RAFContainer4.readFull(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage0(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.CachedPage.readPage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.CachedPage.setIdentity(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.services.cache.ConcurrentCache.find(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.FileContainer.initPage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.FileContainer.newPage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.BaseContainer.addPage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.BaseContainerHandle.addPage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.access.heap.HeapController.doInsert(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.access.heap.HeapController.insert(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.InsertResultSet.open(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)&lt;br/&gt;
        ... 6 more&lt;/p&gt;</comment>
                            <comment id="13165711" author="dagw" created="Fri, 9 Dec 2011 00:39:34 +0000"  >&lt;p&gt;Thanks for the enclosed repro, Stefan! It will increase your chances of getting a fix significantly &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I managed to reproduced the problem on Derby trunk. In my case it took about a minute.&lt;/p&gt;</comment>
                            <comment id="13165910" author="stefan_sitte" created="Fri, 9 Dec 2011 07:39:40 +0000"  >&lt;p&gt;That would be nice. I was suprised too, it could be reproduced in such an easy way. I hope it is a small thing to fix it.&lt;/p&gt;</comment>
                            <comment id="13166205" author="rhillegas" created="Fri, 9 Dec 2011 14:31:48 +0000"  >&lt;p&gt;Re-opening this issue. I don&apos;t understand why it was closed right after an easy repro was posted.&lt;/p&gt;</comment>
                            <comment id="13210451" author="kmarsden" created="Fri, 17 Feb 2012 19:05:36 +0000"  >&lt;p&gt;Triage for 10.9. Marking Critical priority,  Urgent Urgency, High Value Fix.  Changing component to store. I was able to reproduce with the attached repro at  10.9.0.0 alpha - (1242867)&lt;/p&gt;

&lt;p&gt;java.sql.SQLException: Page Page(10219,Container(0, 1168)) could not be read from disk.&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:98)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.seeNextException(Util.java:278)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:431)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2340)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:82)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1334)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1715)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:311)&lt;br/&gt;
        at DbCompressErrorTester.insertData(DbCompressErrorTester.java:162)&lt;br/&gt;
        at DbCompressErrorTester.test(DbCompressErrorTester.java:116)&lt;br/&gt;
        at DbCompressErrorTester.main(DbCompressErrorTester.java:38)&lt;br/&gt;
Caused by: java.sql.SQLException: Page Page(10219,Container(0, 1168)) could not be read from disk.&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:42)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:12&lt;br/&gt;
2)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)&lt;br/&gt;
        ... 12 more&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;Reached end of file while attempting to read a whole page.: java.io.E&lt;br/&gt;
OFException&apos;.&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:42)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:12&lt;br/&gt;
2)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.javaException(Util.java:299)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:436)&lt;br/&gt;
        ... 10 more&lt;br/&gt;
Caused by: java.io.EOFException: Reached end of file while attempting to read a whole page.&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.RAFContainer4.readFull(RAFContainer4.java:1169)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage0(RAFContainer4.java:430)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage(RAFContainer4.java:370)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage(RAFContainer4.java:263)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.CachedPage.readPage(CachedPage.java:673)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.CachedPage.setIdentity(CachedPage.java:193)&lt;br/&gt;
        at org.apache.derby.impl.services.cache.ConcurrentCache.find(ConcurrentCache.java:295)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.FileContainer.initPage(FileContainer.java:2430)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.FileContainer.newPage(FileContainer.java:1878)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.BaseContainer.addPage(BaseContainer.java:314)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.BaseContainerHandle.addPage(BaseContainerHandle.java:183)&lt;br/&gt;
        at org.apache.derby.impl.store.access.heap.HeapController.doInsert(HeapController.java:302)&lt;br/&gt;
        at org.apache.derby.impl.store.access.heap.HeapController.insert(HeapController.java:575)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(RowChangerImpl.java:457)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:999)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:519)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:443)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:324)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1242)&lt;br/&gt;
        ... 5 more&lt;/p&gt;

&lt;p&gt;  I have heard other anecdotal reports of possible corruption after introducing compress.     I hope this is it.&lt;/p&gt;


</comment>
                            <comment id="13260654" author="stefan_sitte" created="Tue, 24 Apr 2012 16:22:58 +0100"  >&lt;p&gt;Is there any fix or workaround available ?&lt;/p&gt;

&lt;p&gt;It seems to be a problem of the cache. How can i rebuild the cache after the exception occurs ?&lt;/p&gt;</comment>
                            <comment id="13260882" author="rhillegas" created="Tue, 24 Apr 2012 20:43:54 +0100"  >&lt;p&gt;I also can reproduce this problem by running the repro which Stefan supplied. I will look into this bug.&lt;/p&gt;

&lt;p&gt;Hi Stefan: From the stack trace it appears that a base table has become corrupted. I don&apos;t know of any way to rebound from this other than to restore your database from the last good backup. Hopefully we will have a fix for this problem in 10.9, but that will only prevent the problem from happening again. The fix will not repair an already broken database.&lt;/p&gt;</comment>
                            <comment id="13261022" author="mikem" created="Tue, 24 Apr 2012 22:18:11 +0100"  >&lt;p&gt;What I would do if looking at this would be to see if you can get it to reproduce with flags set to keep all the transaction logs around.  Using that with identifying when the page goes bad should get closer to where the problem is.  I would look for correlation of when &lt;br/&gt;
page alloc or page dealloc happens and when log records happen for the bad page.&lt;/p&gt;

&lt;p&gt;The stack printed has the feel of maybe looking for a page that is past the end of file?  Putting some debugging about the page table and the end of file at that stack might help.  &lt;/p&gt;</comment>
                            <comment id="13262776" author="stefan_sitte" created="Thu, 26 Apr 2012 18:31:12 +0100"  >&lt;p&gt;@Mike: How can i set the flags for transaction logging ?&lt;/p&gt;</comment>
                            <comment id="13264998" author="rhillegas" created="Mon, 30 Apr 2012 17:09:13 +0100"  >&lt;p&gt;Attaching 5234_alloc.out, 5234_page_10219.out, and 5234_summary.out.&lt;/p&gt;

&lt;p&gt;I turned on log archiving by calling SYSCS_UTIL.SYSCS_BACKUP_DATABASE_AND_ENABLE_LOG_ARCHIVE_MODE_NOWAIT. This resulted in accumulating 191 transaction log files. Fortunately, this did not affect the bug. The bug continues to occur on exactly the same page at exactly the same point in the test.&lt;/p&gt;

&lt;p&gt;To examine the transaction logs, I ran them through the LogFileReader program attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5195&quot; title=&quot;Create tools for browsing the files in the database log directory.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5195&quot;&gt;DERBY-5195&lt;/a&gt; and I looked for log records involving AllocPageOperation actions. 5234_alloc.out is the result of running the following script against the transaction logs:&lt;/p&gt;

&lt;p&gt;#! /bin/bash&lt;/p&gt;

&lt;p&gt;for file in `ls -1 -r -t *.dat`&lt;br/&gt;
do&lt;br/&gt;
  echo XXXXXXXXXXXXXXX $file XXXXXXXXXXXXXXX&lt;/p&gt;

&lt;p&gt;  java LogFileReader $file -v | grep -A 2 -i AllocPageOperation&lt;br/&gt;
done&lt;/p&gt;

&lt;p&gt;5234_page_10219.out was produced by running the following command to find references to actions on the bad page:&lt;/p&gt;

&lt;p&gt;#! /bin/bash&lt;/p&gt;

&lt;p&gt;for file in `ls -1 -r -t *.dat`&lt;br/&gt;
do&lt;br/&gt;
  echo XXXXXXXXXXXXXXX $file XXXXXXXXXXXXXXX&lt;/p&gt;

&lt;p&gt;  java LogFileReader $file -v | grep -A 2 -B 8 -i 10219&lt;br/&gt;
done&lt;/p&gt;

&lt;p&gt;5234_summary.out is a summary of all activity on the bad page which I could find in 5234_page_10219.out.&lt;/p&gt;

&lt;p&gt;I don&apos;t see anything odd in the transaction logs so far, but I probably don&apos;t know what to look for. Other suggestions for what I should look for in the transaction logs?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13265057" author="rhillegas" created="Mon, 30 Apr 2012 18:57:37 +0100"  >&lt;p&gt;Attaching log85.dat and log191.dat.&lt;/p&gt;

&lt;p&gt;log85.dat is the log file which contains the first, successful allocation of the bad page and then inserts into it. log191 is the last file, where Derby crashed at the point where it should have been logging a checksum.&lt;/p&gt;

&lt;p&gt;I decoded these log files as follows, but the output is too big to be attached to this JIRA:&lt;/p&gt;

&lt;p&gt;   java LogFileReader $logFile -v&lt;/p&gt;

&lt;p&gt;Here is the sequence of good operations from log85.dat:&lt;/p&gt;

&lt;p&gt;begin transaction&lt;br/&gt;
insert into slot 31 of page 10218&lt;br/&gt;
end transaction&lt;br/&gt;
checksum&lt;br/&gt;
begin transaction&lt;br/&gt;
initialize page 10219&lt;/p&gt;

&lt;p&gt;Here is the concluding sequence of operations from log191.dat&lt;/p&gt;

&lt;p&gt;begin transaction&lt;br/&gt;
insert into slot 31 of page 10218&lt;br/&gt;
end transaction&lt;br/&gt;
&amp;lt;end of log file, this is where Derby crashes&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13265148" author="rhillegas" created="Mon, 30 Apr 2012 20:45:22 +0100"  >&lt;p&gt;Might be a red herring, but I see that there is only one ChainAllocPageOperation in the transaction logs. That occurs in log85.dat. It allocates page 10217 (2 pages before the bad page) and chains it to page 0. I would expect to see a second ChainAllocPageOperation after the compress. But I don&apos;t.&lt;/p&gt;

&lt;p&gt;Here is the sequence of operations from log85.dat:&lt;/p&gt;

&lt;p&gt;begin transaction&lt;br/&gt;
insert into slot 31 of page 10216&lt;br/&gt;
end transaction&lt;br/&gt;
checksum&lt;br/&gt;
begin transaction&lt;br/&gt;
initialize page 10217&lt;br/&gt;
chain alloc page 10217 to page 0&lt;/p&gt;

&lt;p&gt;Here is the corresponding sequence of operations from log191.dat&lt;/p&gt;

&lt;p&gt;begin transaction&lt;br/&gt;
insert into slot 31 of page 10216&lt;br/&gt;
end transaction&lt;br/&gt;
checksum&lt;br/&gt;
begin transaction&lt;br/&gt;
initialize page 10218&lt;br/&gt;
alloc page 10218 (linking it to 10217)&lt;/p&gt;

&lt;p&gt;Something asymmetric is happening around page 10217.&lt;/p&gt;</comment>
                            <comment id="13266654" author="rhillegas" created="Wed, 2 May 2012 16:53:20 +0100"  >&lt;p&gt;Attaching derby-5234-01-aa-emptyAllocPage.diff. These small changes make the repro run correctly. Regression tests pass cleanly on this patch.&lt;/p&gt;

&lt;p&gt;I have stumbled across at least 3 separate problems in the compression code. However, that may simply mean that I don&apos;t understand the code. The 3 problems are:&lt;/p&gt;

&lt;p&gt;1) A boundary checking error which causes an allocation extent to think that it still has pages, even though those pages have been released to the operating system. This is what causes the repro to fail.&lt;/p&gt;

&lt;p&gt;2) A confusion about whether a variable represents a bit position or a page number. This causes the code to not understand that all of the pages in an extent have been released. Fixing this check does not change any user-visible behavior, but I think that fixing the check is a step in the right direction.&lt;/p&gt;

&lt;p&gt;3) The inability of the compression code to release pages held by the first allocation page. I don&apos;t understand this problem yet. Before looking into this one, I need advice about whether I am heading in the right direction.&lt;/p&gt;

&lt;p&gt;More information about these 3 problems follows:&lt;/p&gt;

&lt;p&gt;-------------------&lt;/p&gt;

&lt;p&gt;Concerning (1), the boundary check which causes the repro to fail:&lt;/p&gt;

&lt;p&gt;In AllocExtent.compressPages(), the new_highest_page argument can be -1. This happens if all of the pages in the extent turn out to be empty. However, if new_highest_page is -1, then the code does not fall into the block at line 577; that&apos;s the code which actually marks the pages as released. The value of new_highest_page was calculated by AllocExtent.compress(). The variable name new_highest_page is a confusing name. This is a bit position and not a page number, and in the case when it is -1, it is a flag that all pages are empty. AllocExtent.compress() returns new_highest_page + 1, triggering its caller to fall into a block at line 1074 in AllocPage.compress(); that block releases pages to the operating system. That is  how we end up in the situation that the pages are actually released but AllocExtent still thinks they are allocated. That, in turn, is what tricks a later INSERT into trying to write onto a non-existent page.&lt;/p&gt;

&lt;p&gt;The fix is to make the code fall into the block at 577 if new_highest_page is -1.&lt;/p&gt;


&lt;p&gt;-------------------&lt;/p&gt;

&lt;p&gt;Concerning (2), the confusion about whether AllocExtent.compress() returns a bit position or a page number:&lt;/p&gt;

&lt;p&gt;At line 1080 in AllocPage.compress(), the code compares a bit position to a page number. Bit positions are small integers, e.g., in the range 0-200. Page numbers are potentially larger integers in, say, the range 12000-12200. The weird comparison at line 1080 causes AllocPage.compress() to not recognize that all of the pages in the extent have been released.&lt;/p&gt;

&lt;p&gt;I have renamed last_valid_page to last_valid_page_bit to clarify that this is a bit position, not a page number. And I have changed the check at 1080 to compare the bit position to another bit position. This comparison deserves the attention of someone who knows this code better than I do. Is this the right comparison?&lt;/p&gt;

&lt;p&gt;In a follow-on cleanup issue, it might make sense to change variable names in the allocation code to clarify what is a bit number and what is a page number. This may disclose other questionable code in this area.&lt;/p&gt;


&lt;p&gt;-------------------&lt;/p&gt;

&lt;p&gt;Concerning (3), the inability of the compression code to release empty pages managed by the first allocation page:&lt;/p&gt;

&lt;p&gt;I had hoped that the change for (2) would cause the compress to release more space. But it didn&apos;t. The compress only releases the pages managed by the second (last) allocation page. All of the pages managed by the first allocation page are also empty, but they are not released. This seems wrong to me. I would expect the file to shrink back to its initial size.&lt;/p&gt;

&lt;p&gt;Before pursuing this follow-on issue, I would like advice about whether I am headed in the right direction. Should the compress shrink the page back to its initial size? Or should SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE(&apos;APP&apos;, &apos;OPERATIONS&apos;, 0, 0, 1) just release empty pages managed by the second and higher allocation pages?&lt;/p&gt;


&lt;p&gt;-------------------&lt;/p&gt;

&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;M       java/engine/org/apache/derby/impl/store/raw/data/AllocExtent.java&lt;/p&gt;

&lt;p&gt;Fix for (1).&lt;/p&gt;

&lt;p&gt;----------&lt;/p&gt;

&lt;p&gt;M       java/engine/org/apache/derby/impl/store/raw/data/AllocPage.java&lt;/p&gt;

&lt;p&gt;Clarification for (2).&lt;/p&gt;</comment>
                            <comment id="13267007" author="mikem" created="Thu, 3 May 2012 00:16:19 +0100"  >&lt;p&gt;Concerning the 3rd point above I have logged &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5738&quot; title=&quot;SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE only returns to the OS pages in the last extent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5738&quot;&gt;DERBY-5738&lt;/a&gt;.   looks like intent was to handle multiple extents but at least in 10.1 and later the code does not handle shrinking past an extent.&lt;/p&gt;</comment>
                            <comment id="13268498" author="mikem" created="Fri, 4 May 2012 17:21:31 +0100"  >&lt;p&gt;the patch changes look right to me.  the existing code (not just your changes) could use more comments, which probably led to the bugs in the first place. I like the changes to &lt;br/&gt;
var names to make it clear they are bit positions of the pages not page numbers.  I would be happy to add comments either after you checkin or produce a new patch based on your work, let me know how you want to procede.&lt;/p&gt;

&lt;p&gt;Definitely would be good to get a test case checked in with the patch.&lt;/p&gt;

&lt;p&gt;longer term - does not have to be part of this fix,  trying to think of some complete edge case test, as at least fix for 1 is an off by one error.  probably not for running every night.  Something like&lt;br/&gt;
2k page heap, &lt;br/&gt;
for (i up to some number bigger than a few extents)&lt;br/&gt;
drop/create table each time&lt;br/&gt;
add rows such that it fills i pages&lt;br/&gt;
delete all rows&lt;br/&gt;
inplace compress &lt;br/&gt;
some set of tests, at least insert i + n rows&lt;/p&gt;</comment>
                            <comment id="13268547" author="rhillegas" created="Fri, 4 May 2012 18:21:32 +0100"  >&lt;p&gt;Thanks, Mike. I will add a test case to the patch. Please add comments on top of the patch once I&apos;ve checked it in--I think that your comments will be more useful than mine. I will also put some thought into writing a follow-on patch containing tests for edge cases. Thanks.&lt;/p&gt;</comment>
                            <comment id="13269942" author="rhillegas" created="Mon, 7 May 2012 20:51:45 +0100"  >&lt;p&gt;Attaching Derby5234.java, a simpler, faster version of the repro. On my machine, this repro trips the bug in about 12 seconds. I will probably use this simpler code in the test case which will accompany the first patch.&lt;/p&gt;</comment>
                            <comment id="13270455" author="rhillegas" created="Tue, 8 May 2012 14:31:22 +0100"  >&lt;p&gt;Attaching derby-5234-01-ab-emptyAllocPage.diff. This adds a regression test case to the previous rev of the patch. The test runs correctly with the patch and fails with an EOFException without the patch. I am running full regression tests again.&lt;/p&gt;

&lt;p&gt;Touches the following additional files:&lt;/p&gt;

&lt;p&gt;M       java/testing/org/apache/derbyTesting/functionTests/tests/store/_Suite.java&lt;br/&gt;
A       java/testing/org/apache/derbyTesting/functionTests/tests/store/Derby5234Test.java&lt;/p&gt;</comment>
                            <comment id="13270522" author="rhillegas" created="Tue, 8 May 2012 16:10:43 +0100"  >&lt;p&gt;Tests passed cleanly for me. Committed derby-5234-01-ab-emptyAllocPage.diff at subversion revision 1335570.&lt;/p&gt;</comment>
                            <comment id="13270681" author="rhillegas" created="Tue, 8 May 2012 19:25:29 +0100"  >&lt;p&gt;Attaching derby-5234-02-aa-edgeCaseTests.diff. This adds a couple more edge cases to the test. Committed at subversion revision 1335677.&lt;/p&gt;</comment>
                            <comment id="13273382" author="saurabh_singhi" created="Fri, 11 May 2012 17:03:38 +0100"  >&lt;p&gt;I am getting the same error, even after calling  SYSCS_UTIL.SYSCS_COMPRESS_TABLE (or  SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE ) programatically, before and/or after the DELETE statement. The DB size is 1.3 gb. &lt;br/&gt;
Any updates on when a quick-fix or workaround or the actual fix would be available? This is an urgent requirement. Thanks.&lt;/p&gt;</comment>
                            <comment id="13273397" author="rhillegas" created="Fri, 11 May 2012 17:24:04 +0100"  >&lt;p&gt;Ported 1335570 and 1335677 from trunk to 10.8 branch at subversion revision 1337258.&lt;/p&gt;</comment>
                            <comment id="13273404" author="rhillegas" created="Fri, 11 May 2012 17:28:39 +0100"  >&lt;p&gt;Hi Saurabh,&lt;/p&gt;

&lt;p&gt;The 10.9 development trunk contains what we think is a fix for this bug. I have just ported that fix to the 10.8 branch.&lt;/p&gt;

&lt;p&gt;The fix should appear in the 10.9 feature release which we will evaluate later this month: &lt;a href=&quot;http://wiki.apache.org/db-derby/DerbyTenNineOneRelease&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/DerbyTenNineOneRelease&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There is also talk about producing a 10.8.3 maintenance release after the community publishes a 10.9 feature release. That maintenance release will also contain the fix.&lt;/p&gt;

&lt;p&gt;Hope this helps,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13273429" author="rhillegas" created="Fri, 11 May 2012 18:13:37 +0100"  >&lt;p&gt;Resolving this issue now that the fix has been backported to 10.8. Follow-on work was discussed on 2012-05-04. That work can continue under &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5761&quot; title=&quot;Add more comments to file compression code and add more tests for file compression.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5761&quot;&gt;DERBY-5761&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13273496" author="saurabh_singhi" created="Fri, 11 May 2012 19:36:32 +0100"  >&lt;p&gt;Hi Rick,&lt;/p&gt;

&lt;p&gt;I built version 10.8.2.3, but unfortunately, I&apos;m still getting the same errors. Here&apos;s a dump of the same (note that the container exception occurs a little deeper down the stack trace) :-&lt;/p&gt;

&lt;p&gt;*****************************************************************************************************************************************************************************&lt;br/&gt;
1 May 2012 11:29 DataDictionary.deleteHRData = deleteCmd = DELETE FROM APP.CPU_059222_HR WHERE SampleTimestamp &amp;lt;= ?&lt;br/&gt;
11 May 2012 11:29 DataDictionary.deleteHRData = Delete executed with Timestamp = Thu May 10 11:29:09 PDT 2012&lt;br/&gt;
11 May 2012 11:29 DataDictionary.reclaimDiskSpace = compressCmd:-&amp;gt;call SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE(&apos;APP&apos;, &apos;CPU_059222_HR&apos;,0,0, 1)&lt;br/&gt;
11 May 2012 11:29 DataDictionary.reclaimDiskSpace = compressSqlStmt executed for Table:-&amp;gt;CPU_059222_HR&lt;br/&gt;
11 May 2012 11:29 DataDictionary.deleteHRData = Hourly retention = 24&lt;br/&gt;
11 May 2012 11:29 DataDictionary.deleteHRData = deleteCmd = DELETE FROM APP.PROCESS_059222_HR WHERE SampleTimestamp &amp;lt;= ?&lt;br/&gt;
11 May 2012 11:29 DataDictionary.deleteHRData = deleteHRData: SQL error - Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
11 May 2012 11:29 SchemaDAO.tableExists = Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:98)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.javaException(Util.java:299)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:436)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2290)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:634)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(EmbedConnection30.java:73)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection40.&amp;lt;init&amp;gt;(EmbedConnection40.java:51)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:70)&lt;br/&gt;
	at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:248)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:144)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(Unknown Source)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(Unknown Source)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.dao.SchemaDAO.tableExists(SchemaDAO.java:59)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.dao.DataDictionary.deleteHRData(DataDictionary.java:464)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.service.CleanUpTask.run(CleanUpTask.java:54)&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)&lt;br/&gt;
	... 16 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:659)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:589)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.xact.Xact.openContainer(Xact.java:1316)&lt;br/&gt;
	at org.apache.derby.impl.store.access.conglomerate.OpenConglomerate.init(OpenConglomerate.java:910)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.Heap.open(Heap.java:689)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(RAMTransaction.java:476)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(RAMTransaction.java:1308)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndexMinion(DataDictionaryImpl.java:9271)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndex(DataDictionaryImpl.java:9229)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.locateSchemaRow(DataDictionaryImpl.java:1722)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getSchemaDescriptor(DataDictionaryImpl.java:1589)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.initDefaultSchemaDescriptor(GenericLanguageConnectionContext.java:425)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.initialize(GenericLanguageConnectionContext.java:401)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.setupConnection(BasicDatabase.java:295)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.startTransaction(TransactionResourceImpl.java:189)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.checkUserIsNotARole(EmbedConnection.java:1251)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.checkUserCredentials(EmbedConnection.java:1215)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:422)&lt;br/&gt;
	... 10 more&lt;br/&gt;
11 May 2012 11:29 SchemaDAO.tableExists = Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:98)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.javaException(Util.java:299)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:436)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2290)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:634)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(EmbedConnection30.java:73)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection40.&amp;lt;init&amp;gt;(EmbedConnection40.java:51)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:70)&lt;br/&gt;
	at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:248)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:144)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(Unknown Source)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(Unknown Source)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.dao.SchemaDAO.tableExists(SchemaDAO.java:59)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.dao.DataDictionary.deleteHRData(DataDictionary.java:464)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.service.CleanUpTask.run(CleanUpTask.java:54)&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)&lt;br/&gt;
	... 16 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:659)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:589)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.xact.Xact.openContainer(Xact.java:1316)&lt;br/&gt;
	at org.apache.derby.impl.store.access.conglomerate.OpenConglomerate.init(OpenConglomerate.java:910)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.Heap.open(Heap.java:689)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(RAMTransaction.java:476)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(RAMTransaction.java:1308)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndexMinion(DataDictionaryImpl.java:9271)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndex(DataDictionaryImpl.java:9229)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.locateSchemaRow(DataDictionaryImpl.java:1722)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getSchemaDescriptor(DataDictionaryImpl.java:1589)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.initDefaultSchemaDescriptor(GenericLanguageConnectionContext.java:425)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.initialize(GenericLanguageConnectionContext.java:401)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.setupConnection(BasicDatabase.java:295)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.startTransaction(TransactionResourceImpl.java:189)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.checkUserIsNotARole(EmbedConnection.java:1251)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.checkUserCredentials(EmbedConnection.java:1215)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:422)&lt;br/&gt;
	... 10 more&lt;br/&gt;
11 May 2012 11:29 SchemaDAO.tableExists = Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:98)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.javaException(Util.java:299)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:436)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2290)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:634)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(EmbedConnection30.java:73)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection40.&amp;lt;init&amp;gt;(EmbedConnection40.java:51)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:70)&lt;br/&gt;
	at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:248)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:144)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(Unknown Source)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(Unknown Source)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.dao.SchemaDAO.tableExists(SchemaDAO.java:59)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.dao.DataDictionary.deleteHRData(DataDictionary.java:464)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.service.CleanUpTask.run(CleanUpTask.java:54)&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)&lt;br/&gt;
	... 16 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:659)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:589)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.xact.Xact.openContainer(Xact.java:1316)&lt;br/&gt;
	at org.apache.derby.impl.store.access.conglomerate.OpenConglomerate.init(OpenConglomerate.java:910)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.Heap.open(Heap.java:689)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(RAMTransaction.java:476)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(RAMTransaction.java:1308)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndexMinion(DataDictionaryImpl.java:9271)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndex(DataDictionaryImpl.java:9229)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.locateSchemaRow(DataDictionaryImpl.java:1722)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getSchemaDescriptor(DataDictionaryImpl.java:1589)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.initDefaultSchemaDescriptor(GenericLanguageConnectionContext.java:425)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.initialize(GenericLanguageConnectionContext.java:401)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.setupConnection(BasicDatabase.java:295)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.startTransaction(TransactionResourceImpl.java:189)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.checkUserIsNotARole(EmbedConnection.java:1251)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.checkUserCredentials(EmbedConnection.java:1215)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:422)&lt;br/&gt;
	... 10 more&lt;br/&gt;
11 May 2012 11:29 SchemaDAO.tableExists = Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:98)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.javaException(Util.java:299)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:436)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2290)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:634)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(EmbedConnection30.java:73)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection40.&amp;lt;init&amp;gt;(EmbedConnection40.java:51)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:70)&lt;br/&gt;
	at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:248)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:144)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(Unknown Source)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(Unknown Source)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.dao.SchemaDAO.tableExists(SchemaDAO.java:59)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.dao.DataDictionary.deleteHRData(DataDictionary.java:464)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.service.CleanUpTask.run(CleanUpTask.java:54)&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)&lt;br/&gt;
	... 16 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:659)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:589)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.xact.Xact.openContainer(Xact.java:1316)&lt;br/&gt;
	at org.apache.derby.impl.store.access.conglomerate.OpenConglomerate.init(OpenConglomerate.java:910)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.Heap.open(Heap.java:689)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(RAMTransaction.java:476)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(RAMTransaction.java:1308)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndexMinion(DataDictionaryImpl.java:9271)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndex(DataDictionaryImpl.java:9229)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.locateSchemaRow(DataDictionaryImpl.java:1722)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getSchemaDescriptor(DataDictionaryImpl.java:1589)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.initDefaultSchemaDescriptor(GenericLanguageConnectionContext.java:425)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.initialize(GenericLanguageConnectionContext.java:401)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.setupConnection(BasicDatabase.java:295)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.startTransaction(TransactionResourceImpl.java:189)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.checkUserIsNotARole(EmbedConnection.java:1251)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.checkUserCredentials(EmbedConnection.java:1215)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:422)&lt;br/&gt;
	... 10 more&lt;br/&gt;
11 May 2012 11:29 SchemaDAO.tableExists = Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:98)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.javaException(Util.java:299)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:436)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2290)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:634)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(EmbedConnection30.java:73)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection40.&amp;lt;init&amp;gt;(EmbedConnection40.java:51)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:70)&lt;br/&gt;
	at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:248)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:144)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(Unknown Source)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(Unknown Source)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.dao.SchemaDAO.tableExists(SchemaDAO.java:59)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.dao.DataDictionary.deleteHRData(DataDictionary.java:464)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.service.CleanUpTask.run(CleanUpTask.java:54)&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)&lt;br/&gt;
	... 16 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:659)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:589)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.xact.Xact.openContainer(Xact.java:1316)&lt;br/&gt;
	at org.apache.derby.impl.store.access.conglomerate.OpenConglomerate.init(OpenConglomerate.java:910)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.Heap.open(Heap.java:689)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(RAMTransaction.java:476)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(RAMTransaction.java:1308)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndexMinion(DataDictionaryImpl.java:9271)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndex(DataDictionaryImpl.java:9229)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.locateSchemaRow(DataDictionaryImpl.java:1722)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getSchemaDescriptor(DataDictionaryImpl.java:1589)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.initDefaultSchemaDescriptor(GenericLanguageConnectionContext.java:425)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.initialize(GenericLanguageConnectionContext.java:401)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.setupConnection(BasicDatabase.java:295)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.startTransaction(TransactionResourceImpl.java:189)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.checkUserIsNotARole(EmbedConnection.java:1251)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.checkUserCredentials(EmbedConnection.java:1215)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:422)&lt;br/&gt;
	... 10 more&lt;br/&gt;
11 May 2012 11:29 SchemaDAO.tableExists = Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:98)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.javaException(Util.java:299)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:436)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2290)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:634)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(EmbedConnection30.java:73)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection40.&amp;lt;init&amp;gt;(EmbedConnection40.java:51)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:70)&lt;br/&gt;
	at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:248)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:144)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(Unknown Source)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(Unknown Source)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.dao.SchemaDAO.tableExists(SchemaDAO.java:59)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.dao.DataDictionary.deleteHRData(DataDictionary.java:464)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.service.CleanUpTask.run(CleanUpTask.java:54)&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)&lt;br/&gt;
	... 16 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:659)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:589)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.xact.Xact.openContainer(Xact.java:1316)&lt;br/&gt;
	at org.apache.derby.impl.store.access.conglomerate.OpenConglomerate.init(OpenConglomerate.java:910)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.Heap.open(Heap.java:689)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(RAMTransaction.java:476)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(RAMTransaction.java:1308)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndexMinion(DataDictionaryImpl.java:9271)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndex(DataDictionaryImpl.java:9229)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.locateSchemaRow(DataDictionaryImpl.java:1722)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getSchemaDescriptor(DataDictionaryImpl.java:1589)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.initDefaultSchemaDescriptor(GenericLanguageConnectionContext.java:425)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.initialize(GenericLanguageConnectionContext.java:401)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.setupConnection(BasicDatabase.java:295)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.startTransaction(TransactionResourceImpl.java:189)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.checkUserIsNotARole(EmbedConnection.java:1251)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.checkUserCredentials(EmbedConnection.java:1215)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:422)&lt;br/&gt;
	... 10 more&lt;br/&gt;
11 May 2012 11:29 SchemaDAO.tableExists = Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:98)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.javaException(Util.java:299)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:436)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2290)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:634)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(EmbedConnection30.java:73)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection40.&amp;lt;init&amp;gt;(EmbedConnection40.java:51)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:70)&lt;br/&gt;
	at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:248)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:144)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(Unknown Source)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(Unknown Source)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.dao.SchemaDAO.tableExists(SchemaDAO.java:59)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.dao.DataDictionary.deleteHRData(DataDictionary.java:464)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.service.CleanUpTask.run(CleanUpTask.java:54)&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)&lt;br/&gt;
	... 16 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:659)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:589)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.xact.Xact.openContainer(Xact.java:1316)&lt;br/&gt;
	at org.apache.derby.impl.store.access.conglomerate.OpenConglomerate.init(OpenConglomerate.java:910)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.Heap.open(Heap.java:689)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(RAMTransaction.java:476)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(RAMTransaction.java:1308)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndexMinion(DataDictionaryImpl.java:9271)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndex(DataDictionaryImpl.java:9229)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.locateSchemaRow(DataDictionaryImpl.java:1722)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getSchemaDescriptor(DataDictionaryImpl.java:1589)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.initDefaultSchemaDescriptor(GenericLanguageConnectionContext.java:425)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.initialize(GenericLanguageConnectionContext.java:401)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.setupConnection(BasicDatabase.java:295)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.startTransaction(TransactionResourceImpl.java:189)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.checkUserIsNotARole(EmbedConnection.java:1251)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.checkUserCredentials(EmbedConnection.java:1215)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:422)&lt;br/&gt;
	... 10 more&lt;br/&gt;
11 May 2012 11:29 ProcessDAO.insertData = Page Page(41494,Container(0, 2128)) could not be read from disk.&lt;br/&gt;
java.sql.BatchUpdateException: Page Page(41494,Container(0, 2128)) could not be read from disk.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeBatch(EmbedStatement.java:1008)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.dao.ProcessDAO.insertData(ProcessDAO.java:142)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.comm.CPUProcessDataStoreWriter.onData(CPUProcessDataStoreWriter.java:56)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.handler.CPUProcessDataHandler.gotData(CPUProcessDataHandler.java:205)&lt;br/&gt;
	at com.idelji.operations.ibase.core.comm.Connector.makeRequest(Connector.java:83)&lt;br/&gt;
	at com.idelji.operations.ibase.core.comm.EntityConnector.makeRequest(EntityConnector.java:36)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.comm.CPUProcessCommunicator.run(CPUProcessCommunicator.java:98)&lt;br/&gt;
Caused by: java.sql.SQLException: Page Page(41494,Container(0, 2128)) could not be read from disk.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:98)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.seeNextException(Util.java:278)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:431)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2290)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:82)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1334)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeBatchElement(EmbedPreparedStatement.java:1040)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeBatch(EmbedStatement.java:984)&lt;br/&gt;
	... 6 more&lt;br/&gt;
Caused by: java.sql.SQLException: Page Page(41494,Container(0, 2128)) could not be read from disk.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)&lt;br/&gt;
	... 15 more&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;Reached end of file while attempting to read a whole page.: java.io.EOFException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.javaException(Util.java:299)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:436)&lt;br/&gt;
	... 13 more&lt;br/&gt;
Caused by: java.io.EOFException: Reached end of file while attempting to read a whole page.&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.RAFContainer4.readFull(RAFContainer4.java:1165)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage0(RAFContainer4.java:429)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage(RAFContainer4.java:369)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.RAFContainer4.readPage(RAFContainer4.java:263)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.CachedPage.readPage(CachedPage.java:673)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.CachedPage.setIdentity(CachedPage.java:193)&lt;br/&gt;
	at org.apache.derby.impl.services.cache.ConcurrentCache.find(ConcurrentCache.java:295)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.FileContainer.initPage(FileContainer.java:2431)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.FileContainer.newPage(FileContainer.java:1879)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseContainer.addPage(BaseContainer.java:314)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseContainerHandle.addPage(BaseContainerHandle.java:183)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.HeapController.doInsert(HeapController.java:302)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.HeapController.insertAndFetchLocation(HeapController.java:599)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(RowChangerImpl.java:452)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1028)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:505)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:438)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:319)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1242)&lt;br/&gt;
	... 8 more&lt;br/&gt;
*****************************************************************************************************************************************************************************&lt;/p&gt;

&lt;p&gt;I could give you my database, if you need to run your own tests against it. &lt;br/&gt;
Best,&lt;br/&gt;
Saurabh&lt;/p&gt;
</comment>
                            <comment id="13273524" author="rhillegas" created="Fri, 11 May 2012 20:22:49 +0100"  >&lt;p&gt;Reopening this issue. Although the repro passes, the bug is not fixed in production.&lt;/p&gt;</comment>
                            <comment id="13273549" author="rhillegas" created="Fri, 11 May 2012 20:44:18 +0100"  >&lt;p&gt;Hi Saurabh,&lt;/p&gt;

&lt;p&gt;I just want to confirm whether your latest bug report was against a table which had been newly created with 10.8.2.3. Note the following:&lt;/p&gt;

&lt;p&gt;1) I observe that I can still reboot a database which was already corrupted by the original form of this bug. And I can successfully delete all rows in the corrupted table and I can run inplace compress on the table.&lt;/p&gt;

&lt;p&gt;2) The patch does not fix an already corrupted table. It only prevents a previously uncorrupted table from being corrupted this way.&lt;/p&gt;

&lt;p&gt;So I just want to confirm: Did you newly recreate the table using 10.8.2.3? Or was the table already corrupted and you were hoping that the patch would fix the broken table?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13273561" author="saurabh_singhi" created="Fri, 11 May 2012 21:02:59 +0100"  >&lt;p&gt;Hi Rick,&lt;/p&gt;

&lt;p&gt;1) It is an existing/corrupted data table that I ran the fix against.&lt;br/&gt;
It seems like after a certain limit (~1.3 gb), the database starts acting fuzzy and gets corrupted. Our (multi-threaded) application continually inserts data into the tables and periodically (once a day) deletes rows from the previous day and after the delete command, I am using the compress call to squeeze the db back into shape. Originally, I used the &apos;SYSCS_UTIL.SYSCS_COMPRESS_TABLE&apos; call, but that lead to: &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4275&quot; title=&quot;Query executions fail when compressing a table using SYSCS_UTIL.SYSCS_COMPRESS_TABLE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4275&quot;&gt;&lt;del&gt;DERBY-4275&lt;/del&gt;&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5351&quot; title=&quot;SYSCS_UTIL.SYSCS_COMPRESS_TABLE causes concurrent transactions to fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5351&quot;&gt;&lt;del&gt;DERBY-5351&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3683&quot; title=&quot;SYSCS_COMPRESS_TABLE gets deadlock while executing concurrently with other user threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3683&quot;&gt;DERBY-3683&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5358&quot; title=&quot;SYSCS_COMPRESS_TABLE failed with conglomerate not found exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5358&quot;&gt;&lt;del&gt;DERBY-5358&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
Following instructions, I used the &apos;INPLACE&apos; call and was able to get rid of those 2 problems but now I&apos;m stuck with this one.&lt;/p&gt;

&lt;p&gt;2) Before I try to insert new data, I&apos;m deleting (and compressing) the old (corrupted) data and if the corrupted data is being deleted, then why do I still get the error? &lt;/p&gt;

&lt;p&gt;3) This only started happening after I included the COMPRESS_TABLE calls. Prior to that, even though it didn&apos;t release the deleted rows&apos; space back to the OS, but it did not give errors.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;br/&gt;
Best,&lt;br/&gt;
Saurabh&lt;/p&gt;</comment>
                            <comment id="13274679" author="rhillegas" created="Mon, 14 May 2012 16:27:01 +0100"  >&lt;p&gt;Attaching a revised version of Derby5234.java. This version successfully selects all of the rows from the corrupted table. After the corruption occurs, the repro now does the following:&lt;/p&gt;

&lt;p&gt;1) Brings down the Derby engine.&lt;/p&gt;

&lt;p&gt;2) Gets a new connection to the database.&lt;/p&gt;

&lt;p&gt;3) Reads all of the rows in the table.&lt;/p&gt;</comment>
                            <comment id="13274684" author="rhillegas" created="Mon, 14 May 2012 16:34:11 +0100"  >&lt;p&gt;Hi Saurabh,&lt;/p&gt;

&lt;p&gt;Can you SELECT all of the rows in the corrupted table? I find that the table can still be read after the corruption when I run my toy test case Derby5234.&lt;/p&gt;

&lt;p&gt;If you can SELECT all of the rows from the corrupted table, then I suggest the following course of action:&lt;/p&gt;

&lt;p&gt;A) Using 10.8.2.3, create a new database.&lt;/p&gt;

&lt;p&gt;B) Copy all of the data from the corrupted database into the new database. You can use the dump and bulk load procedures to do this. Alternatively, you can use the schema-importing VTI attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4962&quot; title=&quot;Create a table function which efficiently migrates data out of foreign databases and which can be used for ongoing data integration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4962&quot;&gt;&lt;del&gt;DERBY-4962&lt;/del&gt;&lt;/a&gt;. The latter approach may be faster.&lt;/p&gt;

&lt;p&gt;C) Delete the old, corrupted database or rename it to make it clear that it should not be used in production anymore.&lt;/p&gt;

&lt;p&gt;D) Rename the new database to be the old name of the corrupted database.&lt;/p&gt;

&lt;p&gt;E) Continue running your application with 10.8.2.3 and the new (now renamed) database.&lt;/p&gt;

&lt;p&gt;Hope this helps,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13274687" author="saurabh_singhi" created="Mon, 14 May 2012 16:36:25 +0100"  >&lt;p&gt;Hi Rick,&lt;br/&gt;
Should I get the latest branch again? Would it have this fix? &lt;/p&gt;</comment>
                            <comment id="13274690" author="rhillegas" created="Mon, 14 May 2012 16:42:18 +0100"  >&lt;p&gt;Hi Saurabh,&lt;/p&gt;

&lt;p&gt;There is no additional fix. You just need a build from the 10.8 branch after revision 1337258.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13274734" author="saurabh_singhi" created="Mon, 14 May 2012 17:44:51 +0100"  >&lt;p&gt;Hi Rick,&lt;/p&gt;

&lt;p&gt;When I try to do a Select * on the table (via Squirrel Client) that I suspect is corrupted, it gives me a &quot;java.lang.OutOfMemoryError: Java heap space&quot; due to the fact that &quot;The query results have exceeded the maximum amount of memory allocated to this application.&quot;. The allocated memory seems to be 247 MB. &lt;br/&gt;
Could that be a cause for the fix not working?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Saurabh&lt;/p&gt;</comment>
                            <comment id="13274776" author="rhillegas" created="Mon, 14 May 2012 18:30:00 +0100"  >&lt;p&gt;Hi Saurabh,&lt;/p&gt;

&lt;p&gt;Hard to say where the OOM is coming from. It may be that the Squirrel Client runs out of memory while trying to prepare a big window for display. What happens if you SELECT COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from the corrupted table? The VTI attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4962&quot; title=&quot;Create a table function which efficiently migrates data out of foreign databases and which can be used for ongoing data integration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4962&quot;&gt;&lt;del&gt;DERBY-4962&lt;/del&gt;&lt;/a&gt; will not try to materialize all of the results at once. You may be able to use it to stream the corrupted table into a new, empty database.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13274800" author="saurabh_singhi" created="Mon, 14 May 2012 18:52:09 +0100"  >&lt;p&gt;Hi Rick,&lt;br/&gt;
The count query gives me 626677 rows. &lt;/p&gt;</comment>
                            <comment id="13274805" author="bbergquist" created="Mon, 14 May 2012 19:00:16 +0100"  >&lt;p&gt;Hi Saurabh,,&lt;/p&gt;

&lt;p&gt;Could it be the you have the SquirrelSQL client option turned off that retrieves only a limited set of rows (by default 100) and are returning many rows which is then causing the client to crash with the OutOfMemory and not the Derby engine crashing?&lt;/p&gt;

&lt;p&gt;Just a thought as I know that I have caused SquirrelSQL to do this when I have turned this option off and retrieved 10&apos;s of thousands of rows.  The tool tries to create a Swing table to display the rows and this causes the OutOfMemory condition in the tool, not the database engine.&lt;/p&gt;

&lt;p&gt;Brett&lt;/p&gt;</comment>
                            <comment id="13274807" author="rhillegas" created="Mon, 14 May 2012 19:00:35 +0100"  >&lt;p&gt;Hi Saurabh,&lt;/p&gt;

&lt;p&gt;The successful completion of the SELECT COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; is a good sign. At this point, I would try to dump the old, corrupted database and load it into a new 10.8.2.3 database.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13274813" author="saurabh_singhi" created="Mon, 14 May 2012 19:07:13 +0100"  >&lt;p&gt;Hi Rick,&lt;/p&gt;

&lt;p&gt;Actually, I ran my application with version 10.8.2.3 (before your changes to Derby5234.java), the tables did get created with 10.8.2.3 but the problem reoccurred. &lt;/p&gt;

&lt;p&gt;Do you think running it with the latest changes(post Derby5234.java revision), would make any difference?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;br/&gt;
Best,&lt;br/&gt;
Saurabh&lt;/p&gt;</comment>
                            <comment id="13274817" author="saurabh_singhi" created="Mon, 14 May 2012 19:09:50 +0100"  >&lt;p&gt;Hi Brett,&lt;br/&gt;
Actually, I do have the &quot;Limit rows to 100&quot; option disabled, so the DB is returning me all the rows.&lt;/p&gt;</comment>
                            <comment id="13274834" author="rhillegas" created="Mon, 14 May 2012 19:33:39 +0100"  >&lt;p&gt;Hi Saurabh,&lt;/p&gt;

&lt;p&gt;Derby5234.java is just a test case. It is not checked into the Derby codeline anywhere. You have the patched version of 10.8.2.3 provided that the revision stamp on derby.jar is bigger than revision 1337258. What do you see when you run sysinfo on your 10.8.2.3 installation:&lt;/p&gt;

&lt;p&gt;  java -jar lib/derbyrun.jar sysinfo&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13274995" author="saurabh_singhi" created="Mon, 14 May 2012 23:00:03 +0100"  >&lt;p&gt;Hi Rick,&lt;br/&gt;
I&apos;m running 10.8.2.3 (rev. 1338623). The tables were created using this revision and the problem still persists.&lt;br/&gt;
Thanks.&lt;br/&gt;
Best,&lt;br/&gt;
Saurabh&lt;/p&gt;</comment>
                            <comment id="13276076" author="rhillegas" created="Tue, 15 May 2012 19:12:46 +0100"  >&lt;p&gt;Hi Saurabh,&lt;/p&gt;

&lt;p&gt;Are you able to script the problem you are seeing? I am unable to reproduce it. Both of the repros attached to this issue now run correctly for me, even when I boost the number of rows by a factor of 10.&lt;/p&gt;

&lt;p&gt;What data compression command are you using? The repros use this command:&lt;/p&gt;

&lt;p&gt;    CALL SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE(&apos;APP&apos;, &apos;TABLENAME&apos;, 0, 0, 1)&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13276150" author="saurabh_singhi" created="Tue, 15 May 2012 20:42:23 +0100"  >&lt;p&gt;Hi Rick,&lt;/p&gt;

&lt;p&gt;I still cannot get past the problem. &lt;/p&gt;

&lt;p&gt;I&apos;m using the command : CALL SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE(&apos;APP&apos;, &apos;TABLENAME&apos;, 0, 0, 1) .&lt;/p&gt;

&lt;p&gt;I don&apos;t quite understand what do you mean by &quot;scripting&quot; it? Please elaborate.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;br/&gt;
-Saurabh&lt;/p&gt;</comment>
                            <comment id="13276158" author="rhillegas" created="Tue, 15 May 2012 20:50:28 +0100"  >&lt;p&gt;Hi Saurabh,&lt;/p&gt;

&lt;p&gt;By scripting, I mean: can you attach a program or ij script which causes this corruption? That will allow us to reproduce the problem in the laboratory.&lt;/p&gt;

&lt;p&gt;Have you considered setting the other trailing arguments of the compression procedure, like so:&lt;/p&gt;

&lt;p&gt;    CALL SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE(&apos;APP&apos;, &apos;TABLENAME&apos;, 1, 1, 1) &lt;/p&gt;

&lt;p&gt;This will cause the compression to take longer because Derby will do a more thorough job of garbage-collecting the empty space. That may take Derby down code paths which work around this bug. It would be interesting to know whether the bug occurs when you specify this extra garbage collection. To run this experiment you will again need to start with a new, uncorrupted database created by 10.8.2.3.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13276167" author="saurabh_singhi" created="Tue, 15 May 2012 20:58:11 +0100"  >&lt;p&gt;Hi Rick,&lt;/p&gt;

&lt;p&gt;Actually, I did not know about an ij script until you just mentioned. I&apos;ll create one and upload here. Also, I&apos;ll try to isolate the code that is making the calls and possibly upload that too here along with my db. &lt;/p&gt;

&lt;p&gt;One problem in doing so is that the application is doing delete, compress and insert operations simultaneously and it might be hard to separate the code, but I&apos;ll see if I can do that so that the bug can be reproduced at your end. &lt;/p&gt;

&lt;p&gt;Also, I did try calling the INPLACE command with all combinations and it did not have any effect.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;br/&gt;
Saurabh&lt;/p&gt;</comment>
                            <comment id="13277899" author="saurabh_singhi" created="Thu, 17 May 2012 16:40:33 +0100"  >&lt;p&gt;Hi Rick,&lt;br/&gt;
I created and ran an ij script against my database, but that does not reproduce the problem. &lt;br/&gt;
I&apos;m not really sure what else to do here.&lt;br/&gt;
Thanks,&lt;br/&gt;
Saurabh.&lt;/p&gt;</comment>
                            <comment id="13277936" author="rhillegas" created="Thu, 17 May 2012 17:22:02 +0100"  >&lt;p&gt;Hi Saurabh,&lt;/p&gt;

&lt;p&gt;Have you tried running SYSCS_COMPRESS_TABLE rather than SYSCS_INPLACE_COMPRESS_TABLE? On 2011-05-18, Varma reported that SYSCS_COMPRESS_TABLE improved the situation and may have fixed the corrupted table.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13278009" author="saurabh_singhi" created="Thu, 17 May 2012 18:42:11 +0100"  >&lt;p&gt;Rick,&lt;br/&gt;
I was using SYSCS_COMPRESS_TABLE originally, but that lead to: &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4275&quot; title=&quot;Query executions fail when compressing a table using SYSCS_UTIL.SYSCS_COMPRESS_TABLE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4275&quot;&gt;&lt;del&gt;DERBY-4275&lt;/del&gt;&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5351&quot; title=&quot;SYSCS_UTIL.SYSCS_COMPRESS_TABLE causes concurrent transactions to fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5351&quot;&gt;&lt;del&gt;DERBY-5351&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3683&quot; title=&quot;SYSCS_COMPRESS_TABLE gets deadlock while executing concurrently with other user threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3683&quot;&gt;DERBY-3683&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5358&quot; title=&quot;SYSCS_COMPRESS_TABLE failed with conglomerate not found exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5358&quot;&gt;&lt;del&gt;DERBY-5358&lt;/del&gt;&lt;/a&gt;, so I had to switch to the INPLACE version. &lt;br/&gt;
Thanks,&lt;br/&gt;
Saurabh&lt;/p&gt;</comment>
                            <comment id="13278025" author="rhillegas" created="Thu, 17 May 2012 18:58:26 +0100"  >&lt;p&gt;Thanks, Saurabh. I see that &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4275&quot; title=&quot;Query executions fail when compressing a table using SYSCS_UTIL.SYSCS_COMPRESS_TABLE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4275&quot;&gt;&lt;del&gt;DERBY-4275&lt;/del&gt;&lt;/a&gt; is fixed in the trunk and in the 10.8 branch. &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5351&quot; title=&quot;SYSCS_UTIL.SYSCS_COMPRESS_TABLE causes concurrent transactions to fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5351&quot;&gt;&lt;del&gt;DERBY-5351&lt;/del&gt;&lt;/a&gt; was closed as a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4275&quot; title=&quot;Query executions fail when compressing a table using SYSCS_UTIL.SYSCS_COMPRESS_TABLE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4275&quot;&gt;&lt;del&gt;DERBY-4275&lt;/del&gt;&lt;/a&gt;. However, it looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3683&quot; title=&quot;SYSCS_COMPRESS_TABLE gets deadlock while executing concurrently with other user threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3683&quot;&gt;DERBY-3683&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5358&quot; title=&quot;SYSCS_COMPRESS_TABLE failed with conglomerate not found exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5358&quot;&gt;&lt;del&gt;DERBY-5358&lt;/del&gt;&lt;/a&gt; are still open.&lt;/p&gt;

&lt;p&gt;Have you tried issuing a LOCK TABLE command to seize exclusive access to the table before you issue SYSCS_COMPRESS_TABLE? This will throttle your concurrency every time you compress the table, but that is better than corrupting the table.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13278036" author="saurabh_singhi" created="Thu, 17 May 2012 19:07:25 +0100"  >&lt;p&gt;Yes Rick, I have tried acquiring an exclusive lock before issuing the SYSCS_COMPRESS_TABLE, but that did not quite work either.&lt;br/&gt;
Thanks,&lt;br/&gt;
Saurabh&lt;/p&gt;</comment>
                            <comment id="13278039" author="rhillegas" created="Thu, 17 May 2012 19:11:08 +0100"  >&lt;p&gt;Thanks, Saurabh. Can you describe what went wrong when you locked the table before compressing it? Thanks.&lt;/p&gt;</comment>
                            <comment id="13281109" author="saurabh_singhi" created="Tue, 22 May 2012 18:41:27 +0100"  >&lt;p&gt;Hi Rick,&lt;br/&gt;
I tried locking the corrupted table but it did not yield any different results. Should I include a LOCK statement with the tables created and populated with the new 10.8 trunk and inform you of the results? &lt;/p&gt;</comment>
                            <comment id="13281118" author="rhillegas" created="Tue, 22 May 2012 18:53:44 +0100"  >&lt;p&gt;Hi Saurabh,&lt;/p&gt;

&lt;p&gt;Just want to make sure we&apos;re not talking past one another. The experiment (using a new, 10.8.2.3 database) would be to LOCK the table before compressing the table with SYSCS_COMPRESS_TABLE. On 2012-05-12 you said that you tried that experiment and something went wrong. It would be good to understand what went wrong.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13281124" author="saurabh_singhi" created="Tue, 22 May 2012 19:03:48 +0100"  >&lt;p&gt;Hi Rick,&lt;br/&gt;
The &quot;something&quot; that went wrong was the same container related exception that this thread is all about. And the new experiment that I&apos;m soon going to try out would be just as you suggested.&lt;br/&gt;
Thanks.&lt;br/&gt;
Saurabh&lt;/p&gt;</comment>
                            <comment id="13281224" author="saurabh_singhi" created="Tue, 22 May 2012 22:26:36 +0100"  >&lt;p&gt;Hi Rick,&lt;br/&gt;
My program created a new 10.8.2.3 database along with the regular select, delete, lock, compress and insert statements.&lt;br/&gt;
As per your suggestions, the program executed a LOCK statement (EXCLUSIVE lock)  before executing the SYSCS_COMPRESS_TABLE call. &lt;br/&gt;
I&apos;m still getting the deadlock exception (while selecting and inserting) shown below:- &lt;/p&gt;

&lt;p&gt;***********************************************************************************************************************************************************&lt;br/&gt;
22 May 2012 13:37:32 ProcessDAO.getLastRecordFromIntervalTableShowGap = A lock could not be obtained due to a deadlock, cycle of locks and waiters is:&lt;br/&gt;
Lock : TABLE, PROCESS_055234_HR, Tablelock&lt;br/&gt;
  Waiting XID : &lt;/p&gt;
{104215, IS} , APP, SELECT  CpuNum,  SampleTimestamp AS TimeStamp,  ProcBusyPercent AS BusyPercent FROM PROCESS_055234_HR WHERE SampleTimestamp &amp;gt;= ?  AND Volume=?  AND Subvol=?  AND Filename=?  AND ProcessName=?  AND CpuNum=?  AND PIN=?  ORDER BY SampleTimestamp &lt;br/&gt;
  Granted XID : {102377, X} &lt;br/&gt;
Lock : ROW, SYSCONGLOMERATES, (7,9)&lt;br/&gt;
  Waiting XID : {102377, X} , APP, alter table &quot;APP&quot;.&quot;PROCESS_055234_HR&quot; compress sequential&lt;br/&gt;
  Granted XID : {102377, S} , {104215, S} &lt;br/&gt;
. The selected victim is XID : 104215.&lt;br/&gt;
java.sql.SQLTransactionRollbackException: A lock could not be obtained due to a deadlock, cycle of locks and waiters is:&lt;br/&gt;
Lock : TABLE, PROCESS_055234_HR, Tablelock&lt;br/&gt;
  Waiting XID : {104215, IS}
&lt;p&gt; , APP, SELECT  CpuNum,  SampleTimestamp AS TimeStamp,  ProcBusyPercent AS BusyPercent FROM PROCESS_055234_HR WHERE SampleTimestamp &amp;gt;= ?  AND Volume=?  AND Subvol=?  AND Filename=?  AND ProcessName=?  AND CpuNum=?  AND PIN=?  ORDER BY SampleTimestamp &lt;br/&gt;
  Granted XID : &lt;/p&gt;
{102377, X} &lt;br/&gt;
Lock : ROW, SYSCONGLOMERATES, (7,9)&lt;br/&gt;
  Waiting XID : {102377, X}
&lt;p&gt; , APP, alter table &quot;APP&quot;.&quot;PROCESS_055234_HR&quot; compress sequential&lt;br/&gt;
  Granted XID : &lt;/p&gt;
{102377, S} , {104215, S} &lt;br/&gt;
. The selected victim is XID : 104215.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:89)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:256)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:424)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2290)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:82)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&amp;lt;init&amp;gt;(EmbedPreparedStatement.java:151)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&amp;lt;init&amp;gt;(EmbedPreparedStatement20.java:82)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&amp;lt;init&amp;gt;(EmbedPreparedStatement30.java:63)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement40.&amp;lt;init&amp;gt;(EmbedPreparedStatement40.java:40)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Driver40.java:107)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:1615)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:1443)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.dao.ProcessDAO.getLastRecordFromIntervalTableShowGap(ProcessDAO.java:503)&lt;br/&gt;
	at imon.utils.DataSourceRouter.getLatestProcessData(DataSourceRouter.java:608)&lt;br/&gt;
	at imon.db.ProcessDataProvider.getLatestData(ProcessDataProvider.java:131)&lt;br/&gt;
	at imon.charts.LineChartWithSlider.refreshChartData(LineChartWithSlider.java:558)&lt;br/&gt;
	at imon.charts.LineChartWithSlider$1.handle(LineChartWithSlider.java:327)&lt;br/&gt;
	at imon.charts.LineChartWithSlider$1.handle(LineChartWithSlider.java:322)&lt;br/&gt;
	at com.sun.scenario.animation.shared.TimelineClipCore.visitKeyFrame(TimelineClipCore.java:196)&lt;br/&gt;
	at com.sun.scenario.animation.shared.TimelineClipCore.playTo(TimelineClipCore.java:137)&lt;br/&gt;
	at javafx.animation.Timeline.impl_playTo(Timeline.java:163)&lt;br/&gt;
	at com.sun.scenario.animation.shared.InfiniteClipEnvelope.timePulse(InfiniteClipEnvelope.java:89)&lt;br/&gt;
	at javafx.animation.Animation.impl_timePulse(Animation.java:952)&lt;br/&gt;
	at com.sun.scenario.animation.shared.AnimationPulseReceiver.timePulse(AnimationPulseReceiver.java:75)&lt;br/&gt;
	at com.sun.scenario.animation.AbstractMasterTimer.timePulseImpl(AbstractMasterTimer.java:357)&lt;br/&gt;
	at com.sun.scenario.animation.AbstractMasterTimer$MainLoop.run(AbstractMasterTimer.java:280)&lt;br/&gt;
	at com.sun.javafx.tk.quantum.QuantumToolkit.pulse(QuantumToolkit.java:381)&lt;br/&gt;
	at com.sun.javafx.tk.quantum.QuantumToolkit$8.run(QuantumToolkit.java:311)&lt;br/&gt;
	at com.sun.glass.ui.win.WinApplication._runLoop(Native Method)&lt;br/&gt;
	at com.sun.glass.ui.win.WinApplication.access$100(WinApplication.java:29)&lt;br/&gt;
	at com.sun.glass.ui.win.WinApplication$2$1.run(WinApplication.java:62)&lt;br/&gt;
	at java.lang.Thread.run(Unknown Source)&lt;br/&gt;
&lt;br/&gt;
22 May 2012 13:37:52 ProcessDAO.insertData = A lock could not be obtained due to a deadlock, cycle of locks and waiters is:&lt;br/&gt;
Lock : ROW, SYSCONGLOMERATES, (7,9)&lt;br/&gt;
  Waiting XID : {104576, S} , APP, INSERT INTO PROCESS_055234_HR (SampleTimestamp,CpuNum,Pin,Priority,UserID,GroupID,ProcessName,Volume,SubVol,FileName,AncestorProcessName,ProcBusyPercent) VALUES (?,?,?,?,?,?,?,?,?,?,?,?)&lt;br/&gt;
  Granted XID : {102377, S}
&lt;p&gt; &lt;br/&gt;
Lock : ROW, SYSCONGLOMERATES, (7,8)&lt;br/&gt;
  Waiting XID : &lt;/p&gt;
{102377, X} , APP, alter table &quot;APP&quot;.&quot;PROCESS_055234_HR&quot; compress sequential&lt;br/&gt;
  Granted XID : {102377, S} , {104576, S} &lt;br/&gt;
. The selected victim is XID : 104576.&lt;br/&gt;
java.sql.SQLTransactionRollbackException: A lock could not be obtained due to a deadlock, cycle of locks and waiters is:&lt;br/&gt;
Lock : ROW, SYSCONGLOMERATES, (7,9)&lt;br/&gt;
  Waiting XID : {104576, S} , APP, INSERT INTO PROCESS_055234_HR (SampleTimestamp,CpuNum,Pin,Priority,UserID,GroupID,ProcessName,Volume,SubVol,FileName,AncestorProcessName,ProcBusyPercent) VALUES (?,?,?,?,?,?,?,?,?,?,?,?)&lt;br/&gt;
  Granted XID : {102377, S} &lt;br/&gt;
Lock : ROW, SYSCONGLOMERATES, (7,8)&lt;br/&gt;
  Waiting XID : {102377, X}
&lt;p&gt; , APP, alter table &quot;APP&quot;.&quot;PROCESS_055234_HR&quot; compress sequential&lt;br/&gt;
  Granted XID : &lt;/p&gt;
{102377, S}
&lt;p&gt; , &lt;/p&gt;
{104576, S}
&lt;p&gt; &lt;br/&gt;
. The selected victim is XID : 104576.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:89)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:256)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:424)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2290)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:82)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&amp;lt;init&amp;gt;(EmbedPreparedStatement.java:151)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&amp;lt;init&amp;gt;(EmbedPreparedStatement20.java:82)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&amp;lt;init&amp;gt;(EmbedPreparedStatement30.java:63)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement40.&amp;lt;init&amp;gt;(EmbedPreparedStatement40.java:40)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Driver40.java:107)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:1615)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:1443)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.dao.ProcessDAO.insertData(ProcessDAO.java:86)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.comm.CPUProcessDataStoreWriter.onData(CPUProcessDataStoreWriter.java:56)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.handler.CPUProcessDataHandler.gotData(CPUProcessDataHandler.java:205)&lt;br/&gt;
	at com.idelji.operations.ibase.core.comm.Connector.makeRequest(Connector.java:83)&lt;br/&gt;
	at com.idelji.operations.ibase.core.comm.EntityConnector.makeRequest(EntityConnector.java:36)&lt;br/&gt;
	at com.idelji.operations.iasset.plugin.imon.comm.CPUProcessCommunicator.run(CPUProcessCommunicator.java:98)&lt;/p&gt;

&lt;p&gt;***********************************************************************************************************************************************************&lt;/p&gt;</comment>
                            <comment id="13284846" author="rhillegas" created="Tue, 29 May 2012 15:24:31 +0100"  >&lt;p&gt;Thanks for the deadlock trace Saurabh. It looks similar to the stack trace for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3683&quot; title=&quot;SYSCS_COMPRESS_TABLE gets deadlock while executing concurrently with other user threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3683&quot;&gt;DERBY-3683&lt;/a&gt;. However, the explicit table lock doesn&apos;t help in your case. I am linking this issue to the other issues which prevent you from using SYSCS_COMPRESS_TABLE: &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3683&quot; title=&quot;SYSCS_COMPRESS_TABLE gets deadlock while executing concurrently with other user threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3683&quot;&gt;DERBY-3683&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5358&quot; title=&quot;SYSCS_COMPRESS_TABLE failed with conglomerate not found exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5358&quot;&gt;&lt;del&gt;DERBY-5358&lt;/del&gt;&lt;/a&gt;. Until we make progress on those issues, I am unable to recommend a workaround. Thanks.&lt;/p&gt;</comment>
                            <comment id="13286706" author="saurabh_singhi" created="Thu, 31 May 2012 17:18:58 +0100"  >&lt;p&gt;I have given up as well. Resorting to dynamic creation and deletion of tables (as opposed to rows)  for now.&lt;/p&gt;</comment>
                            <comment id="13419141" author="rhillegas" created="Fri, 20 Jul 2012 14:49:37 +0100"  >&lt;p&gt;Unassigning myself from this issue because I obviously haven&apos;t done anything on this issue for a long time. My sense is that the table compression code has a number of weaknesses and we should devote some serious effort to overhauling it.&lt;/p&gt;</comment>
                            <comment id="13453427" author="kmarsden" created="Tue, 11 Sep 2012 22:27:11 +0100"  >&lt;p&gt;Removing fix versions as from the comments it doesn&apos;t seem to be fixed.&lt;/p&gt;</comment>
                            <comment id="13463996" author="kmarsden" created="Wed, 26 Sep 2012 19:00:34 +0100"  >&lt;p&gt;Turning off repro attached and high value fix as from the comments it seems the attempted reproductions attached did not reproduce the issue for Rick.  The user resorted to working around the problem. It would be great to get a reproduction for the issue so we could fix it, but until then there is not much we can do.  &lt;br/&gt;
Should we close this cannot reproduce?&lt;/p&gt;
</comment>
                            <comment id="13464028" author="rhillegas" created="Wed, 26 Sep 2012 19:27:21 +0100"  >&lt;p&gt;Linking this issue to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5876&quot; title=&quot;Overhaul table compression code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5876&quot;&gt;DERBY-5876&lt;/a&gt;, a master issue for overhauling the table compression code. Hopefully the underlying issue with this bug will be addressed when we revamp table compression. However, without a repro we won&apos;t be able to prove that. Now that this issue is linked to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5876&quot; title=&quot;Overhaul table compression code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5876&quot;&gt;DERBY-5876&lt;/a&gt;, I don&apos;t see much point in keeping this unreproducible bug open. Thanks.&lt;/p&gt;</comment>
                            <comment id="13555437" author="rhillegas" created="Wed, 16 Jan 2013 20:48:31 +0000"  >&lt;p&gt;Without more information, we can&apos;t reproduce this problem. We can re-open this issue if more information becomes available.&lt;/p&gt;</comment>
                            <comment id="13555975" author="stefan_sitte" created="Thu, 17 Jan 2013 08:18:28 +0000"  >&lt;p&gt;I am very disappointed that even after one year you know this error and have a repro you closed the ticket.&lt;br/&gt;
I&apos;m wondering why the problems regarding the compression (inplace and normal) won&apos;t be fixed. In my opinion this is essential for running a database.&lt;/p&gt;</comment>
                            <comment id="13556022" author="knutanders" created="Thu, 17 Jan 2013 09:56:34 +0000"  >&lt;p&gt;The state of this bug report is a bit confusing, since it contains multiple reports of issues with similar symptoms. Those issues may or may not be related. One fix has been checked in and seems to have fixed one of the issues, but it also sounds like at least one of the problems remains unsolved.&lt;/p&gt;

&lt;p&gt;My reading of the comments on this bug report is that the issue Stefan saw could be reproduced, and it has been fixed. That fix is included in the 10.8.3.0 maintenance release. However, the problems reported by Varma and Saurabh have not been reproduced by anyone else yet. Saurabh has tested the fix and concluded that the fix for Stefan&apos;s issue did not fix the issue he saw. It is not known whether or not the fix addresses the problem reported by Varma.&lt;/p&gt;

&lt;p&gt;Does that accurately describe the current state of the bug report?&lt;/p&gt;</comment>
                            <comment id="13556148" author="rhillegas" created="Thu, 17 Jan 2013 13:11:36 +0000"  >&lt;p&gt;Knut&apos;s understanding of the bug agrees with mine. There seems to be consensus that the table compression code gives rise to many data corruptions and that code needs to be overhauled. That&apos;s why this issue was linked to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5876&quot; title=&quot;Overhaul table compression code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5876&quot;&gt;DERBY-5876&lt;/a&gt;, an issue which describes a systemic rather than piecemeal mini-project for re-writing that part of Derby. Thanks.&lt;/p&gt;</comment>
                            <comment id="13798572" author="kmarsden" created="Fri, 18 Oct 2013 00:07:45 +0100"  >&lt;p&gt;So, although it was closed CannotReproduce,  I think &lt;b&gt;something&lt;/b&gt; was fixed in this issue. 1335570 and 1335677 were committed to  trunk and ported to 10.8 branch at subversion revision 1337258.  For bookkeeping and possible further backport it would seem to make sense to open a separate  issue for what was fixed.&lt;/p&gt;</comment>
                            <comment id="13799058" author="jira-bot" created="Fri, 18 Oct 2013 13:12:47 +0100"  >&lt;p&gt;Commit 1533412 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kmarsden&quot; class=&quot;user-hover&quot; rel=&quot;kmarsden&quot;&gt;Kathey Marsden&lt;/a&gt; in branch &apos;code/branches/10.7&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1533412&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1533412&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6382&quot; title=&quot;After Inplace compress: java.sql.SQLException: Page Page(10219,Container(0, 1136)) could not be read from disk caused by Caused by: java.io.EOFException: Reached end of file while attempting to read a whole page.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6382&quot;&gt;&lt;del&gt;DERBY-6382&lt;/del&gt;&lt;/a&gt; fter Inplace compress: java.sql.SQLException: Page Page(10219,Container(0, 1136)) could not be read from disk caused by Caused by: java.io.EOFException: Reached end of file while attempting to read a whole page.&lt;/p&gt;

&lt;p&gt;This is a partial fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5234&quot; title=&quot;Unable to insert data into table. Failed due be &amp;quot;ERROR XSDG0: Page Page(51919,Container(0, 1104)) could not be read from disk.&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5234&quot;&gt;&lt;del&gt;DERBY-5234&lt;/del&gt;&lt;/a&gt;. Merged revision 1337258 from 10.8&lt;br/&gt;
Contributed by Rick Hillegas&lt;/p&gt;</comment>
                            <comment id="13799256" author="jira-bot" created="Fri, 18 Oct 2013 17:33:26 +0100"  >&lt;p&gt;Commit 1533540 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kmarsden&quot; class=&quot;user-hover&quot; rel=&quot;kmarsden&quot;&gt;Kathey Marsden&lt;/a&gt; in branch &apos;code/branches/10.6&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1533540&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1533540&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6382&quot; title=&quot;After Inplace compress: java.sql.SQLException: Page Page(10219,Container(0, 1136)) could not be read from disk caused by Caused by: java.io.EOFException: Reached end of file while attempting to read a whole page.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6382&quot;&gt;&lt;del&gt;DERBY-6382&lt;/del&gt;&lt;/a&gt; fter Inplace compress: java.sql.SQLException: Page Page(10219,Container(0, 1136)) could not be read from disk caused by Caused by: java.io.EOFException: Reached end of file while attempting to read a whole page.&lt;/p&gt;

&lt;p&gt;This is a partial fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5234&quot; title=&quot;Unable to insert data into table. Failed due be &amp;quot;ERROR XSDG0: Page Page(51919,Container(0, 1104)) could not be read from disk.&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5234&quot;&gt;&lt;del&gt;DERBY-5234&lt;/del&gt;&lt;/a&gt;. Merged revision 1337258 from 10.8&lt;br/&gt;
Contributed by Rick Hillegas&lt;/p&gt;</comment>
                            <comment id="13799743" author="jira-bot" created="Sat, 19 Oct 2013 04:12:49 +0100"  >&lt;p&gt;Commit 1533682 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kmarsden&quot; class=&quot;user-hover&quot; rel=&quot;kmarsden&quot;&gt;Kathey Marsden&lt;/a&gt; in branch &apos;code/branches/10.5&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1533682&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1533682&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6382&quot; title=&quot;After Inplace compress: java.sql.SQLException: Page Page(10219,Container(0, 1136)) could not be read from disk caused by Caused by: java.io.EOFException: Reached end of file while attempting to read a whole page.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6382&quot;&gt;&lt;del&gt;DERBY-6382&lt;/del&gt;&lt;/a&gt; fter Inplace compress: java.sql.SQLException: Page Page(10219,Container(0, 1136)) could not be read from disk caused by Caused by: java.io.EOFException: Reached end of file while attempting to read a whole page.&lt;/p&gt;

&lt;p&gt;This is a partial fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5234&quot; title=&quot;Unable to insert data into table. Failed due be &amp;quot;ERROR XSDG0: Page Page(51919,Container(0, 1104)) could not be read from disk.&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5234&quot;&gt;&lt;del&gt;DERBY-5234&lt;/del&gt;&lt;/a&gt;. Merged revision 1337258 from 10.8&lt;br/&gt;
Contributed by Rick Hillegas&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12674427">DERBY-6382</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12553680">DERBY-5738</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12396485">DERBY-3683</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12515751">DERBY-5358</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12554938">DERBY-5761</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12599854">DERBY-5876</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12525076" name="5234_alloc.out" size="8595751" author="rhillegas" created="Mon, 30 Apr 2012 17:09:13 +0100"/>
                            <attachment id="12525077" name="5234_page_10219.out" size="317231" author="rhillegas" created="Mon, 30 Apr 2012 17:09:13 +0100"/>
                            <attachment id="12525078" name="5234_summary.out" size="58855" author="rhillegas" created="Mon, 30 Apr 2012 17:09:13 +0100"/>
                            <attachment id="12479893" name="DataFileReader_Output.zip" size="860600" author="soxdatabase" created="Fri, 20 May 2011 11:58:13 +0100"/>
                            <attachment id="12506615" name="DbCompressErrorTester.java" size="6529" author="stefan_sitte" created="Thu, 8 Dec 2011 16:36:18 +0000"/>
                            <attachment id="12526769" name="Derby5234.java" size="9798" author="rhillegas" created="Mon, 14 May 2012 16:27:01 +0100"/>
                            <attachment id="12525911" name="Derby5234.java" size="7374" author="rhillegas" created="Mon, 7 May 2012 20:51:45 +0100"/>
                            <attachment id="12525307" name="derby-5234-01-aa-emptyAllocPage.diff" size="1880" author="rhillegas" created="Wed, 2 May 2012 16:53:20 +0100"/>
                            <attachment id="12525992" name="derby-5234-01-ab-emptyAllocPage.diff" size="9306" author="rhillegas" created="Tue, 8 May 2012 14:31:22 +0100"/>
                            <attachment id="12526027" name="derby-5234-02-aa-edgeCaseTests.diff" size="3751" author="rhillegas" created="Tue, 8 May 2012 19:25:29 +0100"/>
                            <attachment id="12525085" name="log191.dat" size="1048576" author="rhillegas" created="Mon, 30 Apr 2012 18:57:36 +0100"/>
                            <attachment id="12525084" name="log85.dat" size="1048704" author="rhillegas" created="Mon, 30 Apr 2012 18:57:36 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10364"><![CDATA[Data corruption]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 16 May 2011 19:19:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24725</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy09if:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35359</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10051"><![CDATA[Urgent]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>