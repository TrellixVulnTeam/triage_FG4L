<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:32:12 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5357/DERBY-5357.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5357] SQLJ.INSTALL_JAR shouldn&apos;t use identifier as file name</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5357</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When installing a jar file with the SQLJ.INSTALL_JAR procedure, it will copy the jar file to a subdirectory of the database directory. The name of the stored jar file is based on the qualified name specified by the second parameter in the procedure, and becomes something like: &amp;lt;DBDIR&amp;gt;/jar/&amp;lt;SCHEMA&amp;gt;/&amp;lt;JAR_NAME&amp;gt;.jar.&amp;lt;VERSION&amp;gt;&lt;/p&gt;

&lt;p&gt;This naming scheme is problematic because the qualified name of the jar file is an SQL identifier and may contain any characters, also characters with special meaning to the underlying file system.&lt;/p&gt;

&lt;p&gt;One example is this call:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; call sqlj.install_jar(&apos;/path/to/toursdb.jar&apos;, &apos;APP.&quot;../../../x/jar&quot;&apos;, 0);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;/p&gt;

&lt;p&gt;On Unix-like systems, this will install the jar in a subdirectory of the database directory&apos;s parent directory, which is clearly unfortunate as the database directory should be self-contained (an assumption used when taking backup of a database using operating system commands, or when moving the database to another location).&lt;/p&gt;

&lt;p&gt;There&apos;s probably also a possibility that INSTALL_JAR fails if the identifier contains a character that&apos;s not allowed in file names on the platform.&lt;/p&gt;

&lt;p&gt;It would be better if the jars were stored in a file whose name is independent of the identifier used, so that any valid SQL identifier could be used to name a jar file in the database without causing problems.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12515629">DERBY-5357</key>
            <summary>SQLJ.INSTALL_JAR shouldn&apos;t use identifier as file name</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                            <label>derby_backport_reject_10_8</label>
                            <label>derby_triage10_9</label>
                    </labels>
                <created>Thu, 28 Jul 2011 12:41:57 +0100</created>
                <updated>Mon, 17 Jun 2013 10:27:20 +0100</updated>
                            <resolved>Tue, 11 Sep 2012 19:19:49 +0100</resolved>
                                    <version>10.9.1.0</version>
                                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13220579" author="dagw" created="Fri, 2 Mar 2012 01:31:04 +0000"  >&lt;p&gt;Uploading a patch which replaces &apos;/&apos; or &apos;\&apos; with underscore when mapping SQL identifiers (schema, jarname) to filename.  The patch introduces a new method in FileUtil: sanitizeSqlIdAsFilename&lt;/p&gt;

&lt;p&gt;From its Javadoc: &quot;Since quoted SQL identifiers may contain any character, we cannot use an SQL identifier as a file name unconditionally. Return a safe (unexploitable) file name by replacing &apos;/&apos; or &apos;\&apos; with underscore, so one can&apos;t access a non-intended directory. &amp;lt;em&amp;gt;Note&amp;lt;/em&amp;gt;: we need to replace both to make database portable from Windows to *nix or vice versa.&quot;&lt;/p&gt;

&lt;p&gt;I don&apos;t think we need any upgrade logic here: It seems very unlikely anybody relies on this error. If they do, e.g. a &apos;/&apos; on a Windows system, the workaround is simple, just rename the affected jars. &lt;/p&gt;

&lt;p&gt;No tests yet beyond manual, running regressions.&lt;/p&gt;

</comment>
                            <comment id="13220581" author="dagw" created="Fri, 2 Mar 2012 01:33:12 +0000"  >&lt;p&gt;Changing urgency to normal and ticking the security flag.&lt;/p&gt;</comment>
                            <comment id="13220974" author="rhillegas" created="Fri, 2 Mar 2012 15:04:06 +0000"  >&lt;p&gt;Hi Dag,&lt;/p&gt;

&lt;p&gt;I agree that this vulnerability should be fixed. I believe that these identifiers are used by&lt;/p&gt;

&lt;p&gt;1) sqlj_install_jar&lt;/p&gt;

&lt;p&gt;2) sqlj.remove_jar&lt;/p&gt;

&lt;p&gt;3) sqlj.replace_jar&lt;/p&gt;

&lt;p&gt;4) and in the database classpaths bound to the derby.database.classpath property&lt;/p&gt;

&lt;p&gt;Unfortunately, I believe that your patch can break (2) and (3) for jar files which were stored prior to release 10.9. I don&apos;t think that the patch addresses (4).&lt;/p&gt;

&lt;p&gt;Here are some other approaches to consider:&lt;/p&gt;

&lt;p&gt;A) Raise an error if the identifier passed to sqlj.install_jar contains suspicious characters.&lt;/p&gt;

&lt;p&gt;B) Don&apos;t touch the identifier stored in SYSFILES.FILENAME. Instead, your regular transformation could be applied to FILENAME at the last possible moment when the file is actually copied, dropped, replaced, or included on the classpath. This approach would need to be used only for jar files which were installed or replaced by 10.9 or later. That, in turn, would require tagging jar files with version information. It might be possible to encode that information in SYSFILES.GENERATIONID.&lt;/p&gt;

&lt;p&gt;C) This is a variation on (B). Build the copied file name from SYSSCHEMAS.SCHEMAID and SYSFILES.FILEID rather than SYSSCHEMAS.SCHEMANAME and SYSFILES.FILENAME. Again, this could only be done for jar files installed/replaced by 10.9 and later releases and would also require some way of tagging the file with a Derby version number.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;
</comment>
                            <comment id="13221034" author="dagw" created="Fri, 2 Mar 2012 16:32:52 +0000"  >&lt;p&gt;Thanks, Rick. &quot;Instead, your regular transformation could be applied to FILENAME at the last possible moment when the file is actually copied, dropped, replaced, or included on the classpathInstead, your regular transformation could be applied to FILENAME at the last possible moment when the file is actually copied, dropped, replaced, or included on the classpath&quot; That&apos;s what I had in mind &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I&apos;ll research some more.&lt;/p&gt;</comment>
                            <comment id="13221048" author="dagw" created="Fri, 2 Mar 2012 16:56:13 +0000"  >&lt;p&gt;ij&amp;gt; select * from sys.sysfiles;&lt;br/&gt;
FILEID                              |SCHEMAID                            |FILENAME                                                                                                                        |GENERATIONID        &lt;br/&gt;
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;br/&gt;
08264012-0135-d0d5-9c5b-0000070b2ff0|80000000-00d2-b38f-4cda-000a0a412c00|../../../x/jar &lt;/p&gt;

&lt;p&gt;I think my code doesn&apos;t modify the FILENAME in SYSFILE, cf the select above. Here is the contents of the jar dir in wombat:&lt;/p&gt;

&lt;p&gt;/export/home/dag/wombat/jar/APP:&lt;br/&gt;
  total used in directory 390 available 10570418&lt;br/&gt;
  :&lt;br/&gt;
  &lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;- 1 dag staff 273331 2012-03-02 01:40 ..&lt;em&gt;..&lt;/em&gt;.._x_jar.jar.G1330648558257&lt;/p&gt;

&lt;p&gt;This mapping would would for all the three sqlj.* stored procs I believe. I&apos;ll look some more at your case 4).&lt;/p&gt;

&lt;p&gt;A problem with my approach is, as you say, that if (and only if) &apos;/&apos; or &apos;\&apos; were used in in a SQL id for a jar an old release, it would fail on upgrade: the jar would not be found.&lt;/p&gt;

&lt;p&gt;Another problem is that the mapping in the patch is effectively a hash: there maybe be a chance of collision, e.g. identifiers &quot;a_b&quot; and &quot;a/b&quot; would both map to filename &quot;a_b&quot;. &lt;/p&gt;</comment>
                            <comment id="13221138" author="dagw" created="Fri, 2 Mar 2012 18:39:38 +0000"  >&lt;p&gt;Btw, Rick&apos;s case 4) would be covered by the patch with the change to JarUtil.mkExternalName, too. &lt;a href=&quot;#initializeFromClasspath -&amp;gt; JarLoader#initialize- &amp;gt; BasicDatabase#getJarFile -&amp;gt; mkExternalName&quot;&gt;UpdateLoader#initializeFromClasspath -&amp;gt; JarLoader#initialize- &amp;gt; BasicDatabase#getJarFile -&amp;gt; mkExternalName&lt;/a&gt;. But the patch is obviously lacking: we need to tackle the unique mapping problem as well as the upgrade problem, since existing usages of file separators in SQL ids could have been bona fide, e.g. : &quot;a/b&quot;, although unlikely as an SQL name, would have worked just fine earlier and should not break on upgrade.&lt;/p&gt;</comment>
                            <comment id="13221268" author="mikem" created="Fri, 2 Mar 2012 21:14:10 +0000"  >&lt;p&gt;I think we should consider upgrade problems, even if the previous usage was unlikely.  I suggest that any new naming/finding&lt;br/&gt;
scheme be limited to hard upgraded databases, otherwise a user going back to a previous version may &quot;lose&quot; their jars.&lt;/p&gt;

&lt;p&gt;It would be cleaner if somehow a version could be associated with the naming, but I think you still need to maintain the old naming search for old versions.  And unless you do some sort of renaming for all existing dbs on hard upgrade, you probably&lt;br/&gt;
need to run both naming schemes in hard upgraded dbs.&lt;/p&gt;

&lt;p&gt;Could somehow the new naming map a new jar to a different &quot;old naming&quot; file?  This could lead to removing the wrong jar.  This&lt;br/&gt;
is sort of the hashing problem but from new to old rather than new to new.&lt;/p&gt;

&lt;p&gt;It seems like hashing where 2 filenames can collide to a single is a problem, as rick points out.  You could eliminate part of the backward compatibility problems by making new databases use a naming scheme that could never collide with with old databases.&lt;br/&gt;
Maybe a new directory (jar2 ?) for new jars in new databases, or maybe there is somethink that could not have been a valid&lt;br/&gt;
SQL identifier and thus could not have been an old filename (would adding a number at the beginning of the filename work?)  &lt;/p&gt;

&lt;p&gt;Is basing the new name on the old name a good idea still, maybe&lt;br/&gt;
there should just be a mapping in a catalog to a guaranteed new name, like a uuid or a sequence number.  &lt;/p&gt;
</comment>
                            <comment id="13222431" author="dagw" created="Mon, 5 Mar 2012 16:19:30 +0000"  >&lt;p&gt;Thanks, Mike and Rick! &lt;br/&gt;
I bit the bullet. Uploading a new proof-of-concept patch which introduces a new naming scheme, with full upgrade of old jar file storage at hard upgrade time. At soft upgrade time, the old code is still used. Still haven&apos;t written tests. I have done away with the schema subdirectories altogether and base the new scheme on uuids:&lt;/p&gt;

&lt;p&gt;Old style file name:   jar/&amp;lt;schema&amp;gt;/&amp;lt;name&amp;gt;.jar.&amp;lt;version&amp;gt;&lt;br/&gt;
New style file name:  jar/&amp;lt;uuid&amp;gt;&lt;del&gt;&amp;lt;safe schema&amp;gt;&lt;/del&gt;&amp;lt;safe name&amp;gt;.jar.&amp;lt;version&amp;gt;&lt;/p&gt;

&lt;p&gt;I included schema and name (sanitized) in the name for ease of debugging. Perhaps we might remove that if we fear users manually tampering with the stored jars..&lt;/p&gt;

&lt;p&gt;Running regressions.&lt;/p&gt;</comment>
                            <comment id="13222442" author="knutanders" created="Mon, 5 Mar 2012 16:44:00 +0000"  >&lt;p&gt;I see that the patch uses String.replaceAll(). That method isn&apos;t available on CDC/FP. Will that be a problem?&lt;/p&gt;

&lt;p&gt;I&apos;d prefer that we did not include &amp;lt;safe schema&amp;gt; and &amp;lt;safe name&amp;gt; in the file name, as they&apos;re not needed and I&apos;m not sure we can guarantee that they are really safe. We remove / and \ from the identifiers, but do we know that there are no other characters that have a special meaning in some file system?&lt;/p&gt;</comment>
                            <comment id="13222444" author="dagw" created="Mon, 5 Mar 2012 16:45:23 +0000"  >&lt;p&gt;diffstat and detailed patch comments (derby-5357-2):&lt;/p&gt;

&lt;p&gt; impl/sql/execute/JarUtil.java                    |  153 +++++++++++++++++++++--&lt;br/&gt;
 impl/sql/catalog/DataDictionaryImpl.java         |   85 ++++++++++++&lt;br/&gt;
 impl/store/raw/RawStore.java                     |   57 ++++++--&lt;br/&gt;
 iapi/sql/dictionary/DataDescriptorGenerator.java |   38 +++--&lt;br/&gt;
 iapi/services/io/FileUtil.java                   |   16 ++&lt;br/&gt;
 iapi/store/access/FileResource.java              |    5 &lt;br/&gt;
 impl/db/BasicDatabase.java                       |    3 &lt;br/&gt;
 impl/sql/catalog/DD_Version.java                 |    7 +&lt;br/&gt;
 impl/store/raw/data/RFResource.java              |    8 +&lt;/p&gt;

&lt;p&gt;M java/engine/org/apache/derby/impl/sql/execute/JarUtil.java&lt;/p&gt;

&lt;p&gt;mkExternalName now always takes uuid as argument. &lt;/p&gt;

&lt;p&gt;New methods: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;mkExternalNameInternal: used during upgrade to be able to construct both old an new style names&lt;/li&gt;
	&lt;li&gt;upgradeJar: upgrade one jar file to new style (&amp;gt;= 10.9)&lt;/li&gt;
	&lt;li&gt;removeOldDirs: Upgrade code: Remove the old directories names with contents (pre-10.9 style).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;M java/engine/org/apache/derby/impl/sql/catalog/DataDictionaryImpl.java&lt;/p&gt;

&lt;p&gt;New methods:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;getAllSysfileDescriptors: used by upgrade code: Return a list of all 
{@FileInfoDescriptor}
&lt;p&gt;s in SYSFILES scan.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;upgradeJarStorage: used by upgrade code. Called by the upgrade code to upgrade the way we store jar files in the database. We now use UUID as part of the file name and sanitize the SQL (schema, schema object) parts of the file name to avoid problems with path delimiters. Also, we henceforth use no schema subdirectories since there is no chance of name collision with the UUID.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;M java/engine/org/apache/derby/impl/store/raw/RawStore.java&lt;/p&gt;

&lt;p&gt;Modified backup code to handle new as well as old scheme (in soft&lt;br/&gt;
upgrade mode).&lt;/p&gt;


&lt;p&gt;M java/engine/org/apache/derby/iapi/services/io/FileUtil.java&lt;/p&gt;

&lt;p&gt;New method:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;sanitizeSqlIdAsFilename: Since quoted SQL identifiers may contain any character, we cannot use an SQL identifier as a file name unconditionally. Return a safe (unexploitable) file name by replacing &apos;/&apos; or &apos;\&apos; with underscore, so one can&apos;t access a non-intended directory. &amp;lt;em&amp;gt;Note&amp;lt;/em&amp;gt;: we need to replace both to make database portable from Windows to *nix or vice versa.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;M java/engine/org/apache/derby/iapi/store/access/FileResource.java&lt;br/&gt;
M java/engine/org/apache/derby/impl/store/raw/data/RFResource.java&lt;/p&gt;


&lt;p&gt;New method:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;getAsFile(String name) to be able to delete old directories during upgrade.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;M java/engine/org/apache/derby/impl/sql/catalog/DD_Version.java&lt;/p&gt;

&lt;p&gt;Add a line to call upgradeJarStorage when hard upgrading&lt;/p&gt;


&lt;p&gt;M java/engine/org/apache/derby/impl/db/BasicDatabase.java&lt;/p&gt;

&lt;p&gt;Interface adjustment.&lt;/p&gt;

&lt;p&gt;M java/engine/org/apache/derby/iapi/sql/dictionary/DataDescriptorGenerator.java&lt;/p&gt;

&lt;p&gt;interface adjustment&lt;/p&gt;</comment>
                            <comment id="13222448" author="dagw" created="Mon, 5 Mar 2012 16:56:24 +0000"  >&lt;p&gt;Thanks Knut, You are probably right about replaceAll. As far as other characters, I believe there are at least illegal characters in some file systems that could be seen to give issues, but so could too possible too large an identifier, although probably Derby&apos;s maximum identifier length makes our names small enough (16 + 1 + 128 + 1 + 128 + 4 (.jar) +  2 (.G) + maxDigits(long) is still quite a bit....). We could map only alphanumeric perhaps. I tend to agree with you, better remove that part of the name altogether. That removes the replaceAll issue, too.. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="13224936" author="dagw" created="Thu, 8 Mar 2012 02:05:09 +0000"  >&lt;p&gt;Uploading an enlarged version of this patch with upgrade logic and upgrade tests, and updates to dblook (dblook tests failed before with the new scheme).&lt;/p&gt;

&lt;p&gt;Note: the new code in RawStore had to accommodate the weird test in BackupPathTests.jar, which somewhat worryingly backs up &amp;lt;db&amp;gt; to &amp;lt;db&amp;gt;/jar (gave a recursion problem in the new code).&lt;/p&gt;

&lt;p&gt;I still have not removed the sanitized schema and SQL object names from the file name of the jar, nor the regexp code unwanted for CDC, but will do so in a final increment.&lt;/p&gt;

&lt;p&gt;Regressions passed.&lt;/p&gt;</comment>
                            <comment id="13227416" author="dagw" created="Mon, 12 Mar 2012 10:44:23 +0000"  >&lt;p&gt;Uploading a hopefully complete version of the patch. This now has dropped the schema/SQL object name in the file name of the stored jar file, and also gets rid of the non-CDC compliant regexp code, Changes10_9 swings its own mini regexp matcher instead.. Regressions passed. Please review.&lt;/p&gt;</comment>
                            <comment id="13227460" author="knutanders" created="Mon, 12 Mar 2012 12:28:32 +0000"  >&lt;p&gt;During full upgrade we remove the old jar directory before the new dictionary information is committed. Could this cause problems if the database crashes during upgrade (after removal of old jar dir and before committing the upgrade transaction)?&lt;/p&gt;

&lt;p&gt;DataDictionaryImpl.getAllSysfileDescriptors() builds a list of all the rows in SYSFILES. Could this cause memory problems during upgrade if SYSFILES is huge? Would it be safer to combine getAllSysfileDescriptors() and upgradeJarStorage() into a single method so that we don&apos;t need the intermediate list? (What you really want is lambda expressions, right? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13228349" author="dagw" created="Tue, 13 Mar 2012 12:13:12 +0000"  >&lt;p&gt;Thanks, Knut!&lt;/p&gt;

&lt;p&gt;&amp;gt; Could this cause problems if the database crashes during upgrade (after removal of old jar dir and before committing the upgrade transaction)&lt;/p&gt;

&lt;p&gt;Yes, it could. I thought of leaving the old jar dirs in place, but that may be no desirable either. I see SQLJ.REMOVE_JAR holds off the physical removal till transaction commit time, maybe I can do something similar during upgrade boot.&lt;/p&gt;

&lt;p&gt;&amp;gt; Could this cause memory problems during upgrade if SYSFILES is huge&lt;/p&gt;

&lt;p&gt;In theory, sure. There is precedent code using this idiom in DataDictionaryImpl, but you&apos;re right, I could easily merge the two methods to avoid the issue altogether.&lt;/p&gt;

&lt;p&gt;I also found that the upgrade test code which tests the upgraded jars with &quot;CALL EMC.ADDCONTACT&quot; won&apos;t run under CDC/JSR169 (nested connection requires DriverManager), so I&apos;ll just skip that part of the test on that platform.&lt;/p&gt;

&lt;p&gt;I&apos;ll spin a new rev.&lt;/p&gt;</comment>
                            <comment id="13228633" author="dagw" created="Tue, 13 Mar 2012 19:35:27 +0000"  >&lt;p&gt;Uploading derby-5357-with-tests-3 to handle the three issues mention above. Rerunning regressions.&lt;/p&gt;</comment>
                            <comment id="13228638" author="dagw" created="Tue, 13 Mar 2012 19:42:39 +0000"  >&lt;p&gt;A comment on the transaction safety of the removal of the old style jar files (and directories): We now schedule the removal as post-commit work, cf. the new method &lt;/p&gt;
{FileREsource/RFResource}
&lt;p&gt;#removeJarDir. &lt;/p&gt;</comment>
                            <comment id="13229119" author="dagw" created="Wed, 14 Mar 2012 10:22:10 +0000"  >&lt;p&gt;Regressions passed. I&apos;ll look to commit the patch by end of Friday CET unless there are further comments. Does this issue require a release note? We do change the internal storage format in a way that is visible to the user looking inside the &quot;jar&quot; directory, but then again, I don&apos;t believe that is/should be documented?&lt;/p&gt;</comment>
                            <comment id="13229140" author="knutanders" created="Wed, 14 Mar 2012 11:58:30 +0000"  >&lt;p&gt;With the patch, dblook doesn&apos;t work with databases that have been soft-upgraded to 10.9 if they contain jar files. dblook.log says:&lt;/p&gt;

&lt;p&gt;&amp;#8211; **--&amp;gt; DEBUG: Failed to load jar file /tmp/jartest/DBJARS/23ce809c-0136-10ee-5e54-0000037b37f8.jar.G1331723919074&lt;br/&gt;
java.io.FileNotFoundException: db/jar/23ce809c-0136-10ee-5e54-0000037b37f8.jar.G1331723919074 (No such file or directory)&lt;br/&gt;
	at java.io.FileInputStream.open(Native Method)&lt;br/&gt;
	at java.io.FileInputStream.&amp;lt;init&amp;gt;(FileInputStream.java:120)&lt;br/&gt;
	at java.io.FileInputStream.&amp;lt;init&amp;gt;(FileInputStream.java:79)&lt;br/&gt;
	at org.apache.derby.impl.tools.dblook.DB_Jar.doJars(DB_Jar.java:98)&lt;br/&gt;
	at org.apache.derby.tools.dblook.go(dblook.java:533)&lt;br/&gt;
	at org.apache.derby.tools.dblook.&amp;lt;init&amp;gt;(dblook.java:142)&lt;br/&gt;
	at org.apache.derby.tools.dblook.main(dblook.java:97)&lt;br/&gt;
	at org.apache.derby.iapi.tools.run.main(run.java:57)&lt;/p&gt;</comment>
                            <comment id="13230356" author="dagw" created="Thu, 15 Mar 2012 17:48:18 +0000"  >&lt;p&gt;Thanks for spotting that, Knut. Uploading rev #4 which addresses this problem. I believe we don&apos;t have tests that stress dblook in a soft upgrade mode, so this is a hole we may want to address. I tested it manually Rerunning regressions.&lt;/p&gt;</comment>
                            <comment id="13233348" author="dagw" created="Tue, 20 Mar 2012 11:06:30 +0000"  >&lt;p&gt;Committed patch derby-5357-with-tests-4 as svn 1302836, resolving. Not planning to backport this since it changes the database format.&lt;/p&gt;</comment>
                            <comment id="13453251" author="kmarsden" created="Tue, 11 Sep 2012 19:18:48 +0100"  >&lt;p&gt;Reopening to label as not appropriate for backport to 10.8&lt;/p&gt;</comment>
                            <comment id="13453253" author="kmarsden" created="Tue, 11 Sep 2012 19:19:49 +0100"  >&lt;p&gt;Reresolving. Issue not backportable to 10.8 because of database format change&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12517094" name="derby-5357-2.diff" size="22044" author="dagw" created="Mon, 5 Mar 2012 16:20:12 +0000"/>
                            <attachment id="12517095" name="derby-5357-2.stat" size="645" author="dagw" created="Mon, 5 Mar 2012 16:20:12 +0000"/>
                            <attachment id="12518001" name="derby-5357-with-tests-2.diff" size="39417" author="dagw" created="Mon, 12 Mar 2012 10:44:22 +0000"/>
                            <attachment id="12518002" name="derby-5357-with-tests-2.stat" size="792" author="dagw" created="Mon, 12 Mar 2012 10:44:22 +0000"/>
                            <attachment id="12518225" name="derby-5357-with-tests-3.diff" size="40076" author="dagw" created="Tue, 13 Mar 2012 19:35:27 +0000"/>
                            <attachment id="12518226" name="derby-5357-with-tests-3.stat" size="792" author="dagw" created="Tue, 13 Mar 2012 19:35:27 +0000"/>
                            <attachment id="12518487" name="derby-5357-with-tests-4.diff" size="46744" author="dagw" created="Thu, 15 Mar 2012 17:48:17 +0000"/>
                            <attachment id="12518488" name="derby-5357-with-tests-4.stat" size="792" author="dagw" created="Thu, 15 Mar 2012 17:48:18 +0000"/>
                            <attachment id="12517518" name="derby-5357-with-tests.diff" size="36640" author="dagw" created="Thu, 8 Mar 2012 02:48:15 +0000"/>
                            <attachment id="12517514" name="derby-5357-with-tests.stat" size="860" author="dagw" created="Thu, 8 Mar 2012 02:05:08 +0000"/>
                            <attachment id="12516773" name="derby-5357.diff" size="2171" author="dagw" created="Fri, 2 Mar 2012 01:31:04 +0000"/>
                            <attachment id="12516774" name="derby-5357.stat" size="135" author="dagw" created="Fri, 2 Mar 2012 01:31:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10361"><![CDATA[Security]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 2 Mar 2012 01:31:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24794</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0a5b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35462</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>