<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:51:01 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-737/DERBY-737.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-737] SYSCS_UTIL.SYSCS_COMPRESS_TABLE should create statistics if they do not exist</title>
                <link>https://issues.apache.org/jira/browse/DERBY-737</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;There must be an entry in the SYSSTATISTICS table in order for the cardinality statistics in SYSSTATISTICS to be created with SYSCS_UTIL.SYSCS_COMPRESS_TABLE &lt;/p&gt;

&lt;p&gt;SYSCS_UTIL.SYSCS_COMPRESS_TABLE  should create statistics if they don&apos;t exist.  The only way to create them if the index was created on an empty table, seems to be to drop and recreate the index after the table has been loaded.&lt;/p&gt;


&lt;p&gt;The documentation will also need updating if this change is made.&lt;br/&gt;
&lt;a href=&quot;http://db.apache.org/derby/docs/10.1/tuning/ctunstats57373.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/docs/10.1/tuning/ctunstats57373.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12326230">DERBY-737</key>
            <summary>SYSCS_UTIL.SYSCS_COMPRESS_TABLE should create statistics if they do not exist</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mamtas">Mamta A. Satoor</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Dec 2005 09:52:43 +0000</created>
                <updated>Thu, 11 Mar 2010 00:14:30 +0000</updated>
                            <resolved>Mon, 16 Oct 2006 22:44:06 +0100</resolved>
                                    <version>10.0.2.0</version>
                    <version>10.0.2.1</version>
                    <version>10.0.2.2</version>
                    <version>10.1.1.0</version>
                    <version>10.1.2.1</version>
                    <version>10.1.3.1</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.1.3.2</fixVersion>
                    <fixVersion>10.2.2.0</fixVersion>
                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12359669" author="mikem" created="Thu, 8 Dec 2005 08:51:15 +0000"  >&lt;p&gt;I don&apos;t see any downside to creating the statistics whether they exist or not.  Not sure why the distinction was made.  &lt;br/&gt;
First try at this might be just removing the if in opensource/java/engine/org/apache/derby/impl/sql/execute/AlterTableConstantAction.java!updateIndex():&lt;/p&gt;

&lt;p&gt;            if (td.statisticsExist(cd))&lt;/p&gt;
            {
                cCount = new CardinalityCounter(tc.openSortRowSource(sortIds[ind
ex]));
                updateStatistics = true;
            }
&lt;p&gt;            else&lt;br/&gt;
                cCount = tc.openSortRowSource(sortIds&lt;span class=&quot;error&quot;&gt;&amp;#91;index&amp;#93;&lt;/span&gt;);&lt;/p&gt;


&lt;p&gt;But life is probably not that easy.  Likely there is slightly more work to create the statistics row vs. updating it.  The work to insert the row can be&lt;br/&gt;
found in: &lt;br/&gt;
opensource/java/engine/org/apache/derby/impl/sql/execute/CreateIndexConstantAction.java&lt;/p&gt;</comment>
                            <comment id="12440039" author="mamtas" created="Thu, 5 Oct 2006 07:23:51 +0100"  >&lt;p&gt;I am slightly confused by the 1st line in the description of this Jira entry. It says &quot;There must be an entry in the SYSSTATISTICS table in order for the cardinality statistics in SYSSTATISTICS to be created with SYSCS_UTIL.SYSCS_COMPRESS_TABLE &quot;&lt;br/&gt;
Shouldn&apos;t it read &quot;There must be an entry in the SYSSTATISTICS table in order for the cardinality statistics in SYSSTATISTICS to be &lt;b&gt;updated&lt;/b&gt; with SYSCS_UTIL.SYSCS_COMPRESS_TABLE &quot;? The new sentence I am suggesting describes the current behavior of Derby which is that currently, SYSCS_UTIL.SYSCS_COMPRESS_TABLE can update statistics for indexes that already have rows in SYSSTATISTICS table. If there is no row for an index in SYSSTATISTICS table, then no statistics will be generated for that index.&lt;/p&gt;

&lt;p&gt;With this Jira, we want to change Derby behavior such that if there is no row for an index in SYSSTATISTICS table, then at the time of SYSCS_UTIL.SYSCS_COMPRESS_TABLE, we should create a row for that index into SYSSTATISTICS table(provided that there is data in the table on which SYSCS_UTIL.SYSCS_COMPRESS_TABLE is getting run, no?) . If a row already exists for an index, then SYSCS_UTIL.SYSCS_COMPRESS_TABLE already does the job of updating the statistics for that index.&lt;/p&gt;

&lt;p&gt;I am interested in working on this issue and want to be clear that I understand the current behavior and the expected new behavior.&lt;/p&gt;</comment>
                            <comment id="12440179" author="mikem" created="Thu, 5 Oct 2006 17:58:10 +0100"  >&lt;p&gt;I believe your interpretation is correct.  The request is to always &quot;update&quot; statistics when running the compress table command.  Internally this may mean updating a row or creating a new row - the difference need not be documented to the user.  Since the entire index is getting rebuilt, I can think of no reason not to gather the statistics and record them at this time.&lt;/p&gt;</comment>
                            <comment id="12441603" author="mamtas" created="Thu, 12 Oct 2006 04:11:59 +0100"  >&lt;p&gt;I would like to submit a patch for this Jira entry. It is attached as DERBY737_v1_diff_SYSCS_COMPRESS_TABLE.txt The changes have been very localized in AlterTableConstantAction.java!updateIndex() Currently, this method checks if statistics already exist for an index. If yes, then it sets a flag updateStatistics to true. Later, the code checks for this flag and drops the existing statistics and creates new statistics for that index provided the user table at this point is not empty. So, as we can see, if there is an index with no preexisting statistics, the flag updateStatistics will be set to false and hence no statistics related code is executed and hence even though the user table is not empty at the time of compress, no statistics get generated for such an index.&lt;/p&gt;

&lt;p&gt;I am proposing to fix the problem by still using the flag to see if an index has pre-existing statistics. If yes,&lt;br/&gt;
then we should drop those statistics. Next, whether the index has pre-existing statistics or not, go ahead and&lt;br/&gt;
create new statistics for the index provided the user table is not currently empty.&lt;/p&gt;

&lt;p&gt;I ran the derbyall suite on Windows XP with Sun JDK 1.4 and there were no new failures. In addition, I have added few tests to lang/compressTable.sql&lt;/p&gt;

&lt;p&gt;Can someone please review this patch for me?&lt;/p&gt;</comment>
                            <comment id="12442418" author="bryanpendleton" created="Sun, 15 Oct 2006 20:04:21 +0100"  >&lt;p&gt;Hi Mamta, I had a look at your patch.&lt;/p&gt;

&lt;p&gt;Your changes seem good to me. Your new tests failed as expected without the code changes,&lt;br/&gt;
and passed as expected with the code changes. I also had a clean derbyall run with your changes.&lt;/p&gt;

&lt;p&gt;Do you feel that this change is ready for commit? Is anyone else reviewing this change?&lt;/p&gt;</comment>
                            <comment id="12442614" author="mamtas" created="Mon, 16 Oct 2006 15:24:05 +0100"  >&lt;p&gt;Thanks for taking the time out to review the patch, Bryan. Yes, the patch is ready for commit unless someone else is reviewing it too. Thanks again.&lt;/p&gt;</comment>
                            <comment id="12442636" author="bryanpendleton" created="Mon, 16 Oct 2006 17:33:42 +0100"  >&lt;p&gt;Committed the patch to subversion as revision 464551.&lt;/p&gt;

&lt;p&gt;Mamta, do you think this patch needs to be ported to any prior releases?&lt;/p&gt;</comment>
                            <comment id="12442641" author="mamtas" created="Mon, 16 Oct 2006 17:45:03 +0100"  >&lt;p&gt;Bryan, thanks for committing the patch to the trunk. I think it will be useful to port this patch to prior releases because optimizer relies on the statistics information for indexes on a table. As for documentation, I will open another Jira entry for the doc changes.&lt;/p&gt;</comment>
                            <comment id="12442684" author="bryanpendleton" created="Mon, 16 Oct 2006 20:45:56 +0100"  >&lt;p&gt;The merge to the 10.2 branch was straightforward, and my 10.2 derbyall test run was clean. I propose to commit this merged change to the 10.2 branch.&lt;/p&gt;</comment>
                            <comment id="12442714" author="bryanpendleton" created="Mon, 16 Oct 2006 22:44:06 +0100"  >&lt;p&gt;Merged the trunk fix to the 10.2 branch and committed to subversion&lt;br/&gt;
as revision 464683.&lt;/p&gt;</comment>
                            <comment id="12573364" author="mamtas" created="Thu, 28 Feb 2008 17:21:21 +0000"  >&lt;p&gt;Merged changes into 10.1 codeline using revision 632065&lt;/p&gt;</comment>
                            <comment id="12843841" author="kmarsden" created="Thu, 11 Mar 2010 00:14:30 +0000"  >&lt;p&gt;updating fix version to reflect 10.1 fix&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12353309">DERBY-1964</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12342766" name="DERBY737_v1_diff_SYSCS_COMPRESS_TABLE.txt" size="15512" author="mamtas" created="Thu, 12 Oct 2006 04:11:59 +0100"/>
                            <attachment id="12342767" name="DERBY737_v1_stat_SYSCS_COMPRESS_TABLE.txt" size="389" author="mamtas" created="Thu, 12 Oct 2006 04:11:59 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 8 Dec 2005 08:51:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29680</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0qyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38186</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>