<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:20:16 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4502/DERBY-4502.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4502] Can&apos;t define view against system table when SQL authorization is enabled--attempting to do so kills your connection</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4502</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Derby fails on an NPE if you try to create the following view when authorization is turned on:&lt;/p&gt;

&lt;p&gt;  create view v2( a ) as select tablename from sys.systables;&lt;/p&gt;

&lt;p&gt;The NPE occurs when the dependency manager trips across a dummy permission constructed on-the-fly. The dummy permission is created by PermissionsCacheable and is supposed to represent the implicit grant to PUBLIC of SELECT privilege on the system table. PermissionsCacheable doesn&apos;t bother to give the dummy permission a corresponding dummy UUID. The dependency manager falls down when trying to deference the null UUID of the dummy permission.&lt;/p&gt;

&lt;p&gt;The following script shows this problem:&lt;/p&gt;

&lt;p&gt;connect &apos;jdbc:derby:memory:dummy;create=true;user=test_dbo;password=test_dbopassword&apos; as test_dbo_conn;&lt;/p&gt;

&lt;p&gt;connect &apos;jdbc:derby:memory:dummy;user=ruth;password=ruthpassword&apos; as ruth_conn;&lt;/p&gt;

&lt;p&gt;create table t( b int );&lt;/p&gt;


&lt;p&gt;create view v1( a ) as select b from t;&lt;br/&gt;
create view v2( a ) as select tablename from sys.systables;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12444620">DERBY-4502</key>
            <summary>Can&apos;t define view against system table when SQL authorization is enabled--attempting to do so kills your connection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Rick Hillegas</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Jan 2010 20:31:17 +0000</created>
                <updated>Tue, 13 Jul 2010 14:25:11 +0100</updated>
                            <resolved>Tue, 13 Jul 2010 13:59:32 +0100</resolved>
                                                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12796695" author="rhillegas" created="Tue, 5 Jan 2010 15:18:24 +0000"  >&lt;p&gt;Attaching derby-4502-01-aa-dummyUUID.diff. This fixes the problem. I am running regression tests now.&lt;/p&gt;

&lt;p&gt;The quick fix is to give the dummy permissions descriptor a dummy UUID, viz., the UUID of the system table. A more elaborate fix would be to allocate a new set of UUIDs, one for each system table, and use those UUIDs instead. The more elaborate fix would be useful if we ever wanted to regard UUIDs as self-describing object IDs, capable of reconstructing the objects they identify. However, that is not how we use UUIDs today. Today, looking up an object involves knowing both its UUID and the object&apos;s type (e.g., table, index, constraint, function, procedure, trigger, etc..). With this fix, we maintain the current contract: UUIDs are unique within a given type namespace.&lt;/p&gt;

&lt;p&gt;Migrating to the more elaborate scheme should be possible if we decide later on that we want UUIDs to be self-describing.&lt;/p&gt;

&lt;p&gt;In writing the regression test for this problem, I tripped across another bug: After a reboot, the system SchemaDescriptors have a null authorization id. I fixed this problem by poking the correct authorization id into the system SchemaDescriptors during database reboot.&lt;/p&gt;

&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/catalog/PermissionsCacheable.java&lt;/p&gt;

&lt;p&gt;This is the fix to the bug described by this JIRA. A dummy UUID is added to the implicit permission descriptors which are cooked up to represent SELECT privilege granted to PUBLIC on the system tables.&lt;/p&gt;


&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/catalog/DataDictionaryImpl.java&lt;br/&gt;
M      java/engine/org/apache/derby/iapi/sql/dictionary/SchemaDescriptor.java&lt;/p&gt;

&lt;p&gt;This is the fix to the reboot problem in the DataDictionary.&lt;/p&gt;


&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/lang/GrantRevokeDDLTest.java&lt;/p&gt;

&lt;p&gt;Regression test case for this bug.&lt;/p&gt;</comment>
                            <comment id="12796784" author="rhillegas" created="Tue, 5 Jan 2010 17:42:26 +0000"  >&lt;p&gt;Committed derby-4502-01-aa-dummyUUID.diff at subversion revision 896146.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12429458" name="derby-4502-01-aa-dummyUUID.diff" size="4457" author="rhillegas" created="Tue, 5 Jan 2010 15:18:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10365"><![CDATA[Crash]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24302</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0plr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37966</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>