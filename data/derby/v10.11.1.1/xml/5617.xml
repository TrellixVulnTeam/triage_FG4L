<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:12:33 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5617/DERBY-5617.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5617] Improve process handling in SpawnedProcess</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5617</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;SpawnedProcess wraps a java.lang.Process and performs various tasks related to process handling. Using external processes from Java is somewhat tricky, in part because of sub-optimal behavior in the methods provided by Process.&lt;/p&gt;

&lt;p&gt;I plan to implement the following improvements:&lt;br/&gt;
 a) Kill the process after a timeout (the clock starts ticking when you create the SpawnedProcess instance).&lt;br/&gt;
 b) Don&apos;t let interrupts stop SpawnedProcess from waiting for / terminating the process.&lt;br/&gt;
 c) Clean up the Process properly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12542660">DERBY-5617</key>
            <summary>Improve process handling in SpawnedProcess</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kristwaa">Kristian Waagan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Feb 2012 10:59:01 +0000</created>
                <updated>Thu, 1 Nov 2012 21:10:43 +0000</updated>
                            <resolved>Tue, 17 Apr 2012 15:03:33 +0100</resolved>
                                    <version>10.9.1.0</version>
                                    <fixVersion>10.8.3.0</fixVersion>
                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13208390" author="kristwaa" created="Wed, 15 Feb 2012 11:42:25 +0000"  >&lt;p&gt;Attaching patch 1a, implementing the items a-c.&lt;/p&gt;

&lt;p&gt;This patch has been tested by Myrna (see &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5601&quot; title=&quot;Windows hang in NativeAuthenticationServiceTest testAll with prior interrupt error in SecureServerTest and other cascade errors and failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5601&quot;&gt;&lt;del&gt;DERBY-5601&lt;/del&gt;&lt;/a&gt;), and seems to be ready for commit.&lt;/p&gt;

&lt;p&gt;Committed the patch to trunk with revision 1244444.&lt;/p&gt;</comment>
                            <comment id="13208411" author="kristwaa" created="Wed, 15 Feb 2012 12:18:49 +0000"  >&lt;p&gt;A few things to consider:&lt;br/&gt;
 o Is the outer timeout too high?&lt;br/&gt;
    It is set to 45 minutes, and the clock starts ticking when you create the SpawnedProcess instance. This mechanism protects against inter-process communications hangs/bugs, for instance when a bug in the DRDA flow causes both sides to wait for more data. It must be high enough to avoid killing running test suites. This has been made configurable in case someone are running on painfully slow machines, or want to kill tests sooner.&lt;br/&gt;
 o Should there be a default timeout also for complete(), or is it okay to rely on the timeout above?&lt;br/&gt;
 o It may be useful to review the usages of complete(), and consider if a timeout value should be specified explicitly. This would be context-/test-dependent.&lt;/p&gt;

&lt;p&gt;I don&apos;t plan any further work on this issue, but won&apos;t close it yet in case there are problems to fix with the new code.&lt;/p&gt;</comment>
                            <comment id="13212337" author="myrna" created="Tue, 21 Feb 2012 04:10:25 +0000"  >&lt;p&gt;I think perhaps there might have been some fall out of this check-in on Feb 16, with ibm 1.5. &lt;br/&gt;
See: &lt;a href=&quot;http://people.apache.org/~myrnavl/derby_test_results/main/linux/testSummary-1245297.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~myrnavl/derby_test_results/main/linux/testSummary-1245297.html&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://people.apache.org/~myrnavl/derby_test_results/main/linux/testlog/ibm15/1245297-suites.All_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~myrnavl/derby_test_results/main/linux/testlog/ibm15/1245297-suites.All_diff.txt&lt;/a&gt;&lt;br/&gt;
There are 3 failures (the fourth is &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5377&quot; title=&quot;AssertionFailedError in testCaseCS4595B_NonUniqueIndex in AccessTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5377&quot;&gt;&lt;del&gt;DERBY-5377&lt;/del&gt;&lt;/a&gt;) that look related and there are some additional similar failures...&lt;br/&gt;
------------------------------&lt;br/&gt;
1) test_05_MaxThreads_Neg1(org.apache.derbyTesting.functionTests.tests.derbynet.NetworkServerControlApiTest)junit.framework.AssertionFailedError: Could not find expectedString:Max threads changed to 0. in output:&amp;lt;STDOUT&amp;gt; &amp;lt;END STDOUT&amp;gt;&lt;br/&gt;
&amp;lt;STDERR&amp;gt;&amp;lt;END STDERR&amp;gt;&lt;/p&gt;

&lt;p&gt;	at org.apache.derbyTesting.junit.BaseTestCase.assertExecJavaCmdAsExpected(BaseTestCase.java:520)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.NetworkServerControlApiTest.test_05_MaxThreads_Neg1(NetworkServerControlApiTest.java:361)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:79)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
2) test_09_MaxThreads_Invalid(org.apache.derbyTesting.functionTests.tests.derbynet.NetworkServerControlApiTest)junit.framework.AssertionFailedError: Could not find expectedString:Max threads changed to 10000. in output:&amp;lt;STDOUT&amp;gt; &amp;lt;END STDOUT&amp;gt;&lt;br/&gt;
&amp;lt;STDERR&amp;gt;&amp;lt;END STDERR&amp;gt;&lt;/p&gt;

&lt;p&gt;	at org.apache.derbyTesting.junit.BaseTestCase.assertExecJavaCmdAsExpected(BaseTestCase.java:520)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.NetworkServerControlApiTest.test_09_MaxThreads_Invalid(NetworkServerControlApiTest.java:422)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:79)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
3) test_20_TimeSlice_a(org.apache.derbyTesting.functionTests.tests.derbynet.NetworkServerControlApiTest)junit.framework.AssertionFailedError: Could not find expectedString:Time slice changed to 8000. in output:&amp;lt;STDOUT&amp;gt; &amp;lt;END STDOUT&amp;gt;&lt;br/&gt;
&amp;lt;STDERR&amp;gt;&amp;lt;END STDERR&amp;gt;&lt;/p&gt;

&lt;p&gt;	at org.apache.derbyTesting.junit.BaseTestCase.assertExecJavaCmdAsExpected(BaseTestCase.java:520)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.NetworkServerControlApiTest.test_20_TimeSlice_a(NetworkServerControlApiTest.java:559)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:79)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
-----------------------&lt;/p&gt;</comment>
                            <comment id="13212445" author="kristwaa" created="Tue, 21 Feb 2012 08:13:47 +0000"  >&lt;p&gt;Attaching patch 2a.&lt;/p&gt;

&lt;p&gt;Thanks, Myrna.&lt;br/&gt;
I have messed up the order in which the process is cleaned up, which includes closing the streams assoicated with the process, and waiting for the output drainer streams to terminate. On some machines this causes truncated output (scheduler/timing/performance issue), and in any case the ordering is incorrect.&lt;/p&gt;

&lt;p&gt;Fixed with patch 2a, which also takes care of a few typos. Committed to trunk with revision 1291631.&lt;/p&gt;</comment>
                            <comment id="13218081" author="kristwaa" created="Tue, 28 Feb 2012 11:48:07 +0000"  >&lt;p&gt;Attached patch 3a, committed to trunk with revision 1294592.&lt;/p&gt;

&lt;p&gt;The patch addresses the fact that I have forgotten to make the timer run as a daemon. This may cause the VM to stay alive for up to 45 minutes longer than it should have to.&lt;/p&gt;</comment>
                            <comment id="13223185" author="kristwaa" created="Tue, 6 Mar 2012 12:17:32 +0000"  >&lt;p&gt;The next step for this issue is backporting it (required by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5608&quot; title=&quot;BaseTestCase.readProcessOutput should read getInputStream()  and getErrorStream() in separate threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5608&quot;&gt;&lt;del&gt;DERBY-5608&lt;/del&gt;&lt;/a&gt;). I&apos;ll wait for a little while longer to allow people to analyze their test results first, reducing the chance of backporting something that causes trouble.&lt;/p&gt;</comment>
                            <comment id="13255568" author="kristwaa" created="Tue, 17 Apr 2012 15:03:34 +0100"  >&lt;p&gt;Backported to 10.8, together with &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5608&quot; title=&quot;BaseTestCase.readProcessOutput should read getInputStream()  and getErrorStream() in separate threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5608&quot;&gt;&lt;del&gt;DERBY-5608&lt;/del&gt;&lt;/a&gt;, with revision 1327102.&lt;br/&gt;
Resolving issue.&lt;/p&gt;</comment>
                            <comment id="13281469" author="kristwaa" created="Wed, 23 May 2012 10:03:48 +0100"  >&lt;p&gt;Closing issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12514629" name="derby-5617-1a-spawnedprocess_improvements.diff" size="21285" author="kristwaa" created="Wed, 15 Feb 2012 11:42:25 +0000"/>
                            <attachment id="12515335" name="derby-5617-2a-join_destroy_ordering.diff" size="1820" author="kristwaa" created="Tue, 21 Feb 2012 08:13:47 +0000"/>
                            <attachment id="12516314" name="derby-5617-3a-timer_as_daemon_thread.diff" size="807" author="kristwaa" created="Tue, 28 Feb 2012 11:48:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 21 Feb 2012 04:10:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>227946</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0bnr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35707</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>