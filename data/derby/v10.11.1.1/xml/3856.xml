<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:30:12 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3856/DERBY-3856.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3856] difference between Embedded vs DerbyNetClient in format of return from timestamp(cast(? as varchar(32)))</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3856</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;There is a slight difference in how Embedded vs. DerbyNetClient return a specific cast.&lt;br/&gt;
This showed up during conversion of the test lang/datetime.sql which before was only run with Embedded...&lt;/p&gt;

&lt;p&gt;The following sql: &lt;br/&gt;
prepare dateTimePS as &apos;values( date(cast(? as integer)),timestamp(cast(? as varchar(32))))&apos;;&lt;br/&gt;
execute dateTimePS using &apos;values(cast(1 as integer), &apos;&apos;2003-03-05-17.05.43.111111&apos;&apos;)&apos;;&lt;br/&gt;
gives:&lt;br/&gt;
                               1         |2                         &lt;br/&gt;
                               -------------------------------------&lt;br/&gt;
Embedded:         1970-01-01|2003-03-05-17.05.43.111111&lt;br/&gt;
DerbyNetClient:  1970-01-01|2003-03-05 17:05:43.111111&lt;br/&gt;
(in Embedded there&apos;s a &apos;-&apos; between date and time part, with DerbyNetClient a space; with Embedded the separator between time elements is ., with DerbyNetClient :. Embedded reflects the data as passed in, with DerbyNetClient it seems to be the default timestamp format).&lt;/p&gt;

&lt;p&gt;I am not sure which is correct at this point, but I confirmed the behavior is like this in latest builds of trunk and 10.3 and 10.4 branches.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12403104">DERBY-3856</key>
            <summary>difference between Embedded vs DerbyNetClient in format of return from timestamp(cast(? as varchar(32)))</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Aug 2008 20:11:36 +0100</created>
                <updated>Thu, 13 Jan 2011 21:23:20 +0000</updated>
                            <resolved>Mon, 12 Jul 2010 19:12:48 +0100</resolved>
                                    <version>10.3.3.1</version>
                    <version>10.4.2.0</version>
                    <version>10.5.1.1</version>
                                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.2.1</fixVersion>
                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12626970" author="dagw" created="Fri, 29 Aug 2008 14:40:25 +0100"  >&lt;p&gt;The SQL standard has these productions:&lt;/p&gt;

&lt;p&gt;&amp;lt;timestamp literal&amp;gt; ::= TIMESTAMP &amp;lt;timestamp string&amp;gt;&lt;br/&gt;
&amp;lt;timestamp string&amp;gt; ::= &amp;lt;quote&amp;gt; &amp;lt;unquoted timestamp string&amp;gt; &amp;lt;quote&amp;gt;&lt;br/&gt;
&amp;lt;unquoted timestamp string&amp;gt; ::= &amp;lt;unquoted date string&amp;gt; &amp;lt;space&amp;gt; &amp;lt;unquoted time string&amp;gt;&lt;/p&gt;

&lt;p&gt;so DerbyNetClient seems the closest to the standard. Derby doesn&apos;t&lt;br/&gt;
accept the TIMESTAMP literal either, of course,&lt;br/&gt;
cf. &lt;a href=&quot;http://wiki.apache.org/db-derby/SQLvsDerbyFeatures&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/SQLvsDerbyFeatures&lt;/a&gt;, but uses a&lt;br/&gt;
built-in function. Still, it would be nice if the syntax for the&lt;br/&gt;
&amp;lt;timestamp string&amp;gt; was compliant, or at least lenient to accept the&lt;br/&gt;
standard form:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; values timestamp(&apos;2003-03-05 17.05.43.111111&apos;);&lt;br/&gt;
ERROR 22008: &apos;2003-03-05 17.05.43.111111&apos; is an invalid argument to the timestamp function.&lt;br/&gt;
java.sql.SQLDataException: &apos;2003-03-05 17.05.43.111111&apos; is an invalid argument to the timestamp function.&lt;/p&gt;

&lt;p&gt;ij&amp;gt; values timestamp(&apos;2003-03-05-17.05.43.111111&apos;);&lt;br/&gt;
1                         &lt;br/&gt;
--------------------------&lt;br/&gt;
2003-03-05 17:05:43.111111&lt;/p&gt;

&lt;p&gt;1 row selected&lt;/p&gt;

</comment>
                            <comment id="12726863" author="kristwaa" created="Fri, 3 Jul 2009 11:08:31 +0100"  >&lt;p&gt;Triaged July 3, 2009:  Assigned normal urgency, marked as Deviation from standard.&lt;/p&gt;</comment>
                            <comment id="12876212" author="knutanders" created="Mon, 7 Jun 2010 12:39:36 +0100"  >&lt;p&gt;When not using a cast, embedded returns the same value as the client driver, as can be seen from these two statements executed on the embedded driver:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; values timestamp(&apos;2003-03-05-17.05.43.111111&apos;);&lt;br/&gt;
1                         &lt;br/&gt;
--------------------------&lt;br/&gt;
2003-03-05 17:05:43.111111&lt;/p&gt;

&lt;p&gt;1 row selected&lt;br/&gt;
ij&amp;gt; values timestamp(cast(&apos;2003-03-05-17.05.43.111111&apos; as varchar(32)));&lt;br/&gt;
1                         &lt;br/&gt;
--------------------------&lt;br/&gt;
2003-03-05-17.05.43.111111&lt;/p&gt;

&lt;p&gt;1 row selected&lt;/p&gt;

&lt;p&gt;I think it would be reasonable to expect those two statements to return the same value.&lt;/p&gt;</comment>
                            <comment id="12876242" author="knutanders" created="Mon, 7 Jun 2010 14:52:11 +0100"  >&lt;p&gt;IJ uses getString() and not getTimestamp() to fetch the timestamps. SQLTimestamp.getString() uses a cached string value, or generates a new string representing the timestamp if a cached string value is not available. The method that parses the timestamp for the TIMESTAMP function (SQLTimestamp.parseTimestamp()) initializes the cached string value to the input string.&lt;/p&gt;

&lt;p&gt;The reason why the result is different on embedded and client, is that the network server uses getTimestamp() instead of getString() to access the value that it sends to the client, so a normalized timestamp string is seen on the client.&lt;/p&gt;

&lt;p&gt;The two statements that give different results on the embedded driver, differ because the statement without a cast parses the timestamp at compile time and the one with a cast parses the timestamp at execution time. The timestamp in the first statement is represented by a java.sql.Timestamp in the execution plan, so that the input string is not preserved and a normalized timestamp string will be returned instead. The statement with the cast will do the parsing at execution time and return the SQLTimestamp returned from the parse method, which has cached the original input string.&lt;/p&gt;</comment>
                            <comment id="12876253" author="knutanders" created="Mon, 7 Jun 2010 15:23:40 +0100"  >&lt;p&gt;Same problem can be seen with the DATE function. Example output from the embedded driver:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; values date(&apos;10/07/2008&apos;);&lt;br/&gt;
1         &lt;br/&gt;
----------&lt;br/&gt;
2008-10-07&lt;/p&gt;

&lt;p&gt;1 row selected&lt;br/&gt;
ij&amp;gt; values date(cast(&apos;10/07/2008&apos; as varchar(32)));&lt;br/&gt;
1         &lt;br/&gt;
----------&lt;br/&gt;
10/07/2008&lt;/p&gt;

&lt;p&gt;1 row selected&lt;/p&gt;

&lt;p&gt;Client driver returns 2008-10-07 for both.&lt;/p&gt;

&lt;p&gt;The TIME function does not appear to have this problem. With the embedded driver:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; values time(cast(&apos;10.00.00&apos; as varchar(32)));&lt;br/&gt;
1       &lt;br/&gt;
--------&lt;br/&gt;
10:00:00&lt;/p&gt;

&lt;p&gt;1 row selected&lt;/p&gt;

&lt;p&gt;Notice that the time string is normalized (dots turned into colons).&lt;/p&gt;</comment>
                            <comment id="12876268" author="knutanders" created="Mon, 7 Jun 2010 16:09:53 +0100"  >&lt;p&gt;Attaching a suggested fix for the issue. I have only run DateTimeTest on it yet.&lt;/p&gt;

&lt;p&gt;Changes made by the patch:&lt;/p&gt;

&lt;p&gt;java/engine/org/apache/derby/iapi/types/SQLTimestamp.java:&lt;br/&gt;
java/engine/org/apache/derby/iapi/types/SQLDate.java:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Don&apos;t set valueString in parseTimestamp()/parseDate(). Since it&apos;s left as null, it will be generated (and cached) on the first invocation of getString(), and it will be on a normalized form.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;java/testing/org/apache/derbyTesting/functionTests/tests/lang/DateTimeTest.java:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Removed code to work around this issue.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added regression test cases for TIMESTAMP, DATE and TIME.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12876434" author="knutanders" created="Mon, 7 Jun 2010 22:41:47 +0100"  >&lt;p&gt;All the regression tests ran cleanly with the patch.&lt;/p&gt;</comment>
                            <comment id="12876453" author="dagw" created="Mon, 7 Jun 2010 23:21:23 +0100"  >&lt;p&gt;Seems like the correct solution to treat all these cases uniformly so as to always get the normalized version. Test appears&lt;br/&gt;
to cover the cases.  Verified that two fixtures throw errors without the patch: test_DateAndDatetimeFunctionsMore and testDerby3856,&lt;br/&gt;
but work when the rest of the patch is applied.&lt;/p&gt;

&lt;p&gt;+1 from me.&lt;/p&gt;
</comment>
                            <comment id="12876609" author="knutanders" created="Tue, 8 Jun 2010 10:19:55 +0100"  >&lt;p&gt;Thanks for testing out the patch, Dag!&lt;br/&gt;
Committed revision 952581.&lt;/p&gt;</comment>
                            <comment id="12884457" author="lilywei" created="Thu, 1 Jul 2010 23:11:22 +0100"  >&lt;p&gt;Reopen to 10.5 back port&lt;/p&gt;</comment>
                            <comment id="12886144" author="mikem" created="Wed, 7 Jul 2010 23:55:36 +0100"  >&lt;p&gt;i am working on backporting this issue.&lt;/p&gt;</comment>
                            <comment id="12886841" author="mikem" created="Fri, 9 Jul 2010 20:14:05 +0100"  >&lt;p&gt;backporting change #952581 from trunk to 10.5 branch.&lt;/p&gt;

&lt;p&gt;m105_jdk16:37&amp;gt;svn commit&lt;br/&gt;
Sending        .&lt;br/&gt;
Sending        java/engine/org/apache/derby/iapi/types/SQLDate.java&lt;br/&gt;
Sending        java/engine/org/apache/derby/iapi/types/SQLTimestamp.java&lt;br/&gt;
Sending        java/testing/org/apache/derbyTesting/functionTests/tests/lang/DateTimeTest.java&lt;br/&gt;
Transmitting file data ...&lt;br/&gt;
Committed revision 962640.&lt;/p&gt;</comment>
                            <comment id="12887233" author="mikem" created="Sun, 11 Jul 2010 22:17:46 +0100"  >&lt;p&gt;backporting change #952581 from trunk to 10.6 branch.&lt;/p&gt;

&lt;p&gt;m106_jdk16:14&amp;gt;svn commit&lt;br/&gt;
Sending        .&lt;br/&gt;
Sending        java/engine/org/apache/derby/iapi/types/SQLDate.java&lt;br/&gt;
Sending        java/engine/org/apache/derby/iapi/types/SQLTimestamp.java&lt;br/&gt;
Sending        java/testing/org/apache/derbyTesting/functionTests/tests/lang/DateTimeTest.java&lt;br/&gt;
Transmitting file data ...&lt;br/&gt;
Committed revision 963150.&lt;/p&gt;</comment>
                            <comment id="12887449" author="mikem" created="Mon, 12 Jul 2010 19:12:47 +0100"  >&lt;p&gt;backported to 10.5 and 10.6, resolving as fixed, and reassigning orginal fixer.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="32841">DERBY-310</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12468384">DERBY-4728</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12446490" name="fix.diff" size="5037" author="knutanders" created="Mon, 7 Jun 2010 16:09:52 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10367"><![CDATA[Deviation from standard]]></customfieldvalue>
    <customfieldvalue key="10363"><![CDATA[Embedded/Client difference]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 29 Aug 2008 13:40:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23879</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0nk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37635</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>