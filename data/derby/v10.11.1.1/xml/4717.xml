<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:16:41 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4717/DERBY-4717.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4717] Driver trace file isn&apos;t closed/released on physical connection close when specified with the traceFile attribute/setter</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4717</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When specifying a trace file with the traceFile connection URL attribute or with the data source setter method, the handle to the trace file isn&apos;t released when the physical connection is closed.&lt;br/&gt;
The problem may be specific to the implementations of ConnectionPoolDataSource and XADataSource, as using a plain data source doesn&apos;t involve reuse (i.e another mechanism may close the trace file handle).&lt;/p&gt;

&lt;p&gt;Two potential problems caused by this bug:&lt;br/&gt;
 o resource leak  (i.e., too many file handles open)&lt;br/&gt;
 o trace files cannot be deleted on Windows (seen for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4709&quot; title=&quot;Create test that parse client trace file to detect round-trips for Derby-4653&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4709&quot;&gt;&lt;del&gt;DERBY-4709&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12468022">DERBY-4717</key>
            <summary>Driver trace file isn&apos;t closed/released on physical connection close when specified with the traceFile attribute/setter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kristwaa">Kristian Waagan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Jun 2010 08:48:28 +0100</created>
                <updated>Mon, 29 Nov 2010 14:20:29 +0000</updated>
                            <resolved>Thu, 1 Jul 2010 09:32:57 +0100</resolved>
                                    <version>10.7.1.1</version>
                                    <fixVersion>10.4.2.1</fixVersion>
                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.2.1</fixVersion>
                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12883118" author="kristwaa" created="Mon, 28 Jun 2010 13:01:42 +0100"  >&lt;p&gt;Attaching patch 1a, which consists of the following changes:&lt;/p&gt;

&lt;p&gt;(production code)&lt;br/&gt;
 a) Make Derby close the trace file when the physical connection is closed and the trace file is specified using &apos;traceFile&apos; (attribute or setter).&lt;br/&gt;
(test code)&lt;br/&gt;
 b) Disabled the test &apos;testClientMessageTextConnectionAttribute&apos;, as the test started failing when I corrected the test. It was using (ConnectionPool|XA)DataSource.getConnection() to obtain a connection. This method is not an API method, it&apos;s an artifact due to Derby&apos;s subclassing (the two mentioned data sources extend ClientBaseDataSource). &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4067&quot; title=&quot;ClientConnectionPoolDataSource.getPooledConnection and ClientXADataSource.getXAConnection ignore connection attributes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4067&quot;&gt;&lt;del&gt;DERBY-4067&lt;/del&gt;&lt;/a&gt; trace the problem that the connection attributes are not picked up.&lt;br/&gt;
 c) Made the tests obtain the physical connections from data source by using the correct method (i.e. getXAConnection, getPooledConnection or getConnection).&lt;br/&gt;
 d) Extended the test &apos;testClientTraceFileDSConnectionAttribute&apos; to also make sure the trace files can be deleted (regression test for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4717&quot; title=&quot;Driver trace file isn&amp;#39;t closed/released on physical connection close when specified with the traceFile attribute/setter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4717&quot;&gt;&lt;del&gt;DERBY-4717&lt;/del&gt;&lt;/a&gt;).&lt;br/&gt;
 e) Added &apos;getPhysicalConnection(Object ds)&apos; for the cases where a physical connection is to be obtained, but the data source can be of any (Derby) type.&lt;/p&gt;

&lt;p&gt;I need someone to test this patch on Windows, i.e. that jdbcapi.J2EEDataSourceTest.testClientTraceFileDSConnectionAttribute fails without the changes to ClientBaseDataSource.&lt;/p&gt;

&lt;p&gt;Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="12883280" author="lilywei" created="Mon, 28 Jun 2010 21:31:01 +0100"  >&lt;p&gt;Apply the patch and test it on Windows. With or without ClienBaseDataSource changes, the tests both failed with not privilege on delete data files on assertTraceFilesExistAndCanBeDeleted&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Error/failure logged at Mon Jun 28 13:04:48 PDT 2010&amp;#93;&lt;/span&gt;&lt;br/&gt;
junit.framework.AssertionFailedError: Delete failed&lt;br/&gt;
        at junit.framework.Assert.fail(Assert.java:47)&lt;br/&gt;
        at junit.framework.Assert.assertTrue(Assert.java:20)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.jdbcapi.J2EEDataSourceTest$8.run(J2EEDataSour&lt;br/&gt;
ceTest.java:2695)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.jdbcapi.J2EEDataSourceTest.assertTraceFilesEx&lt;br/&gt;
istAndCanBeDeleted(J2EEDataSourceTest.java:2685)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.jdbcapi.J2EEDataSourceTest.testClientTraceFil&lt;br/&gt;
eDSConnectionAttribute(J2EEDataSourceTest.java:2675)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Unknown Source)&lt;br/&gt;
        at junit.framework.TestCase.runTest(TestCase.java:154)&lt;br/&gt;
        at junit.framework.TestCase.runBare(TestCase.java:127)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)&lt;br/&gt;
        at junit.framework.TestResult$1.protect(TestResult.java:106)&lt;br/&gt;
        at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
        at junit.framework.TestResult.run(TestResult.java:109)&lt;br/&gt;
        at junit.framework.TestCase.run(TestCase.java:118)&lt;/p&gt;</comment>
                            <comment id="12883457" author="kristwaa" created="Tue, 29 Jun 2010 09:20:09 +0100"  >&lt;p&gt;Thanks, Lily.&lt;/p&gt;

&lt;p&gt;Attaching revision 1b, which hopefully fixes the problem (seen on Windows).&lt;br/&gt;
The existing test didn&apos;t close the connection, and I forgot to change it.&lt;/p&gt;</comment>
                            <comment id="12883597" author="lilywei" created="Tue, 29 Jun 2010 17:10:36 +0100"  >&lt;p&gt;Thanks, Kristian and Dag. The test passed for me on Windows. Yeah!!!&lt;/p&gt;</comment>
                            <comment id="12884217" author="kristwaa" created="Thu, 1 Jul 2010 09:32:57 +0100"  >&lt;p&gt;Thanks, Dag and Lily.&lt;/p&gt;

&lt;p&gt;Committed and backported:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;trunk: 959550&lt;/li&gt;
	&lt;li&gt;10.6 : 959552&lt;/li&gt;
	&lt;li&gt;10.5 : 959553&lt;/li&gt;
	&lt;li&gt;10.4 : 959554&lt;/li&gt;
&lt;/ul&gt;

</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12467635">DERBY-4709</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12448204" name="derby-4717-1a.diff" size="10403" author="kristwaa" created="Mon, 28 Jun 2010 13:01:41 +0100"/>
                            <attachment id="12448292" name="derby-4717-1b.diff" size="10506" author="kristwaa" created="Tue, 29 Jun 2010 09:20:09 +0100"/>
                            <attachment id="12448238" name="derby.log" size="67141" author="lilywei" created="Mon, 28 Jun 2010 21:31:01 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 28 Jun 2010 20:31:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24426</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0p0n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37871</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>