<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:14:04 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2515/DERBY-2515.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2515] Network client does not retain the INOUT parameter value change for subsequent execution</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2515</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt; If I set a INOUT parameter to a value (say 12.3) and it gets &lt;br/&gt;
modified by the procedure to another value (say 45.6) then on &lt;br/&gt;
the next execution&lt;br/&gt;
     of the same CallableStatement, embedded maintains the &lt;br/&gt;
current value (45.6), while network server reverts to the &lt;br/&gt;
former value (12.3).  &lt;/p&gt;

&lt;p&gt;This issue was found while converting the test lang/procedure.java.  See references to this issue in the converted LangProcedureTest.java&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12366428">DERBY-2515</key>
            <summary>Network client does not retain the INOUT parameter value change for subsequent execution</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Rick Hillegas</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                            <label>derby_triage10_8</label>
                    </labels>
                <created>Tue, 3 Apr 2007 00:26:36 +0100</created>
                <updated>Mon, 17 Jun 2013 10:19:40 +0100</updated>
                            <resolved>Wed, 21 Mar 2012 13:02:50 +0000</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.5.3.2</fixVersion>
                    <fixVersion>10.6.2.4</fixVersion>
                    <fixVersion>10.7.1.4</fixVersion>
                    <fixVersion>10.8.1.2</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12486170" author="kmarsden" created="Tue, 3 Apr 2007 00:27:43 +0100"  >&lt;p&gt;This issue was found while converting procedure.java&lt;/p&gt;</comment>
                            <comment id="12994494" author="kmarsden" created="Mon, 14 Feb 2011 21:06:40 +0000"  >&lt;p&gt;Triage for 10.8. Marking Urgent as it seems we would get wrong results if the in/out value is not updated properly.&lt;br/&gt;
Marking newcomer hoping it is a contained jdbc fix.&lt;/p&gt;</comment>
                            <comment id="13010209" author="rhillegas" created="Wed, 23 Mar 2011 16:40:10 +0000"  >&lt;p&gt;Attaching Test_2515.java, a test case which shows this behavior. The embedded and network drivers both reset purely OUT args the same way. INOUT args are treated differently: the embedded driver does not touch the last value returned but the client driver resets the INOUT arg to the last value set by its setXXX() method.&lt;/p&gt;</comment>
                            <comment id="13012499" author="rhillegas" created="Tue, 29 Mar 2011 15:16:46 +0100"  >&lt;p&gt;Attaching derby-2515-01-ac-copyINOUTreturnValues.diff. This patch fixes the bug by copying output values to the corresponding input array in the network driver.&lt;/p&gt;

&lt;p&gt;The tests passed cleanly for me except for known Heisenbugs and a new failure in ProcedureTest introduced by this patch. The new test case in ProcedureTest discloses &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5162&quot; title=&quot;CLOB INOUT arg set to NULL by procedure does not preserve NULL value when re-invoked&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5162&quot;&gt;&lt;del&gt;DERBY-5162&lt;/del&gt;&lt;/a&gt;. Once that bug is fixed, ProcedureTest should run cleanly too.&lt;/p&gt;

&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;----------&lt;/p&gt;

&lt;p&gt;M      java/client/org/apache/derby/client/am/CallableStatement.java&lt;/p&gt;

&lt;p&gt;In the network driver, input args and output args are maintained in two separate arrays. This patch copies the output values of INOUT args to the corresponding slots in the input array.&lt;/p&gt;

&lt;p&gt;----------&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/ProcedureTest.java&lt;/p&gt;

&lt;p&gt;Adds a test case to verify that INOUT values are preserved across invocations for all datatypes.&lt;/p&gt;</comment>
                            <comment id="13012765" author="rhillegas" created="Wed, 30 Mar 2011 00:04:54 +0100"  >&lt;p&gt;Now that the blocking bug is fixed, committed derby-2515-01-ac-copyINOUTreturnValues.diff at subversion revision 1086799.&lt;/p&gt;</comment>
                            <comment id="13012922" author="knutanders" created="Wed, 30 Mar 2011 12:53:27 +0100"  >&lt;p&gt;Hi Rick,&lt;/p&gt;

&lt;p&gt;Thanks for fixing this bug. I have two questions about the patch:&lt;/p&gt;

&lt;p&gt;1)&lt;br/&gt;
+                    //&lt;br/&gt;
+                    // special case to coerce Integer to Short for SMALLINT&lt;br/&gt;
+                    //&lt;br/&gt;
+                    if ( parameterMetaData_.types_[ i ] == Types.SMALLINT )&lt;br/&gt;
+                    {&lt;br/&gt;
+                        if ( (returnArg != null) &amp;amp;&amp;amp; (returnArg instanceof Integer) )&lt;br/&gt;
+                        &lt;/p&gt;
{
+                            returnArg = new Short( ((Integer) returnArg).shortValue() );
+                        }
&lt;p&gt;+                    }&lt;/p&gt;

&lt;p&gt;When we get here, have we already checked that the Integer argument fits in a SMALLINT, or do we risk that Integer.shortValue() silently truncates the original value?&lt;/p&gt;

&lt;p&gt;2)&lt;br/&gt;
+        } catch (Exception se)&lt;br/&gt;
+        &lt;/p&gt;
{
+            throw new IllegalArgumentException( se.getMessage() );
+        }

&lt;p&gt;What kind of exceptions do we expect here, and why convert to IllegalArgumentException? Is that something expected by the higher levels of the code?&lt;/p&gt;</comment>
                            <comment id="13012936" author="rhillegas" created="Wed, 30 Mar 2011 13:57:41 +0100"  >&lt;p&gt;Thanks for looking at the patch, Knut. Some answers to your questions follow:&lt;/p&gt;

&lt;p&gt;1) No checking has been made to ensure that the Integer won&apos;t truncate silently when it is stuffed into the Short. I can run some experiments to see what happens when you try to send a large int across the network for use by a SMALLINT INOUT arg.&lt;/p&gt;

&lt;p&gt;2) Cursor.getObject() can raise SqlException. But if it does that probably indicates a bug--it is returning what java.sql.CallableStatement.getObject() is supposed to return. I could narrow that catch down to just filter out SqlExceptions. StatementCallbackInterface.completeExecuteCall() raises no errors and its callers perform no error handling other than to relay DisconnectExceptions up the call stack.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13013940" author="knutanders" created="Thu, 31 Mar 2011 13:07:22 +0100"  >&lt;p&gt;Thanks for the explanations, Rick.&lt;/p&gt;

&lt;p&gt;1) I asked because I wasn&apos;t sure if the Integer objects originated from user input. If they come from the server, and the server says the type is SMALLINT, I think we should trust the server. So I&apos;m comfortable with the current code.&lt;/p&gt;

&lt;p&gt;2) Right, it looks like Cursor.getObject() raises an exception if it doesn&apos;t understand the JDBC type of the column, which would indicate a bug. And adding a new checked exception type to the throws clause is a bit awkward here, I agree, at least when it&apos;s just to handle a case that&apos;s not supposed to happen. Narrowing it down to SqlException only, and possibly also making the try block smaller so that it only encloses the expression that may raise the exception, sounds like a good improvement. For extra bonus, you might want to call initCause() on the wrapper to preserve the stack trace if this is ever going to happen.&lt;/p&gt;</comment>
                            <comment id="13014028" author="rhillegas" created="Thu, 31 Mar 2011 16:43:19 +0100"  >&lt;p&gt;Attaching derby-2515-02-aa-polishCatchBlock.diff, which incorporates Knut&apos;s excellent suggestions. Committed at subversion revision 1087346.&lt;/p&gt;</comment>
                            <comment id="13222580" author="rhillegas" created="Mon, 5 Mar 2012 20:14:10 +0000"  >&lt;p&gt;I think that this work should be safe to backport to older releases.&lt;/p&gt;</comment>
                            <comment id="13229383" author="kmarsden" created="Wed, 14 Mar 2012 17:19:48 +0000"  >&lt;p&gt;Reopen for 10.5 backport consideration. If working on the backport for this issue. Temporarily assign yourself and add a comment that you are working on it. When finished, reresolve with the new fix versions or label backport_reject_10_x as appropriate.&lt;/p&gt;</comment>
                            <comment id="13231653" author="kmarsden" created="Fri, 16 Mar 2012 21:34:35 +0000"  >&lt;p&gt;Assign temporarily for backport&lt;/p&gt;</comment>
                            <comment id="13234330" author="kmarsden" created="Wed, 21 Mar 2012 13:02:31 +0000"  >&lt;p&gt;Reassigning to Rick and resolving. Also restoring the affects version. This was accidentally changed with the bulk reopen. I had intended to add 10.5 as an affects version but unfortunately that replaced what was there.&lt;/p&gt;</comment>
                            <comment id="13685319" author="knutanders" created="Mon, 17 Jun 2013 10:19:40 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12365135">DERBY-2461</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12546430">DERBY-5654</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12502719">DERBY-5162</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12474411" name="Test_2515.java" size="3517" author="rhillegas" created="Wed, 23 Mar 2011 16:40:10 +0000"/>
                            <attachment id="12474883" name="derby-2515-01-ac-copyINOUTreturnValues.diff" size="24844" author="rhillegas" created="Tue, 29 Mar 2011 15:16:46 +0100"/>
                            <attachment id="12475113" name="derby-2515-02-aa-polishCatchBlock.diff" size="2777" author="rhillegas" created="Thu, 31 Mar 2011 16:43:19 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10363"><![CDATA[Embedded/Client difference]]></customfieldvalue>
    <customfieldvalue key="10366"><![CDATA[Wrong query result]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 23 Mar 2011 16:40:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23083</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10422"><![CDATA[High Value Fix]]></customfieldvalue>
    <customfieldvalue key="10423"><![CDATA[Newcomer]]></customfieldvalue>
    <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ckv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35856</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10051"><![CDATA[Urgent]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>