<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:48:57 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2658/DERBY-2658.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2658] Convert jdbcapi/parameterMetaDataJdbc30.java to JUnit</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2658</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Convert jdbcapi/parameterMetaDataJdbc30.java to JUnit.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12369466">DERBY-2658</key>
            <summary>Convert jdbcapi/parameterMetaDataJdbc30.java to JUnit</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="moazeni">Ramin Moazeni</assignee>
                                    <reporter username="moazeni">Ramin Moazeni</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 May 2007 08:51:35 +0100</created>
                <updated>Wed, 1 Jul 2009 00:40:19 +0100</updated>
                            <resolved>Wed, 19 Mar 2008 16:14:45 +0000</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.3.0</fixVersion>
                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12500070" author="moazeni" created="Wed, 30 May 2007 09:46:16 +0100"  >&lt;p&gt;Please review the attached interim patch.&lt;/p&gt;</comment>
                            <comment id="12500234" author="kmarsden" created="Wed, 30 May 2007 21:50:29 +0100"  >&lt;p&gt;Thanks Ramin for looking at this test conversion.  The main thing I think is that we really need to make sure that we are testing everything the old test tested.  Below are some specific comments, but it would be good to do a close review comparing the old and new test to make sure that we have assertions for all of the cases that were tested by canon comparison before.  Anyway, here are some comments ....&lt;/p&gt;

&lt;p&gt;Typically the test class name for the junit tests starts with a capital letter. e.g. ParameterMetaDataJdbc30Test&lt;/p&gt;

&lt;p&gt;parameterMetaDataJdbc30_app.properties and master/parameterMetaDataJdbc30.out  should be deleted.&lt;/p&gt;

&lt;p&gt;Attach the output of svn stat to your next patch.&lt;/p&gt;


&lt;p&gt;When I run the test all the tests fail with&lt;br/&gt;
parameterMetaDataJdbc30Test)java.sql.SQLException: Schema &apos;SAMPLE&apos; does not exist&lt;br/&gt;
This is I think because setUp attempts to drop the table that is not there.&lt;br/&gt;
I think you would be better off using  CleanDatabaseSetup and the decorateSQL method to create your table and function, rather than creating it with each fixture.  There are lots of examples of CleanDatabaseSetup usage in other tests.&lt;/p&gt;

&lt;p&gt;The dumpExpectedSQLExceptions method only checks an SQLException&apos;s sqlstate against itself, so would always pass.  Instead of calls to dumpExpectedSQLExceptions &lt;br/&gt;
you should have assertSQLState(&quot;XXXXX&quot;,e) where XXXX is the hardcoded expected SQLState. You can see the expected states by looking at the canon in functionTests/master/parameterMetaDataJdbc30.out or just temporarily printing  SQLState to see what it is.&lt;/p&gt;


&lt;p&gt;Calls like 	assertTrue (&quot;Jira 44 failed.&quot;, &quot;22019&quot;.equals(e.getSQLState()) can be replaced by assertSQLState &lt;/p&gt;

&lt;p&gt;The System.out&apos;s in the old test need to be translated into assertions. e.g.&lt;br/&gt;
//System.out.println(&quot;parameters count for callable statement is: &quot; + paramMetaData.getParameterCount());&lt;br/&gt;
should be replaced with an assertEquals call.&lt;/p&gt;

&lt;p&gt;dumpParameterMetaDataNegative doesn&apos;t look quite right to me. It seems like it would always fail. Instead of &lt;/p&gt;

&lt;p&gt;try &lt;/p&gt;
{
                        fail(&quot;parameter isNullable &quot; + paramMetaData.isNullable(-1));
                }
&lt;p&gt; catch (SQLException e) &lt;/p&gt;
{
                        dumpExpectedSQLExceptions(e);
                }

&lt;p&gt;I would expect something like.&lt;br/&gt;
try &lt;/p&gt;
{
	parameterMetaData.isNullable(-1);
	fail(&quot;parameterMetaData.isNullable(-1) should have failed);
    }
&lt;p&gt; catch (SQLException se)&lt;/p&gt;
	{
	assertSQLState(&quot;XCL13&quot;,se.getSQLState());
	}

&lt;p&gt;For the code where we have if(!usingDerbyNetClient()) there should be an explanation of why we don&apos;t run with client with a Jira reference.  If there is a bug and it is not filed, file one.&lt;/p&gt;

&lt;p&gt;The fixtures testParameterMetadataWithXXXParameters () doesn&apos;t actually seem to test the parameterMetaData.  I don&apos;t know if that is an artifact of the old test but we should add in some testing.&lt;/p&gt;

</comment>
                            <comment id="12502646" author="myrna" created="Fri, 8 Jun 2007 06:01:44 +0100"  >&lt;p&gt;Unchecking 10.3. If this conversion gets checked in before 10.3, it can be marked fixed in 10.3 when it&apos;s being resolved. &lt;/p&gt;</comment>
                            <comment id="12502866" author="moazeni" created="Fri, 8 Jun 2007 17:19:31 +0100"  >&lt;p&gt;Attaching another patch with this issue that address the previous review.&lt;br/&gt;
Feedback is appreciated.&lt;/p&gt;</comment>
                            <comment id="12502879" author="kmarsden" created="Fri, 8 Jun 2007 17:56:20 +0100"  >&lt;p&gt;Hi Ramin,&lt;/p&gt;

&lt;p&gt;I think we are still in a situation where we are not testing everything the original test tested.&lt;br/&gt;
In the old test for each parameter it would print the following information:&lt;/p&gt;

&lt;p&gt;parameters count for callable statement is 4&lt;br/&gt;
Parameter number : 1&lt;br/&gt;
parameter isNullable PARAMETER_NULLABLE&lt;br/&gt;
parameter isSigned true&lt;br/&gt;
parameter getPrecision 10&lt;br/&gt;
parameter getScale 0&lt;br/&gt;
parameter getParameterType 4&lt;br/&gt;
parameter getParameterTypeName INTEGER&lt;br/&gt;
parameter getParameterClassName java.lang.Integer&lt;br/&gt;
parameter getParameterMode PARAMETER_MODE_IN&lt;/p&gt;

&lt;p&gt;That means that you will need to add assertions for each of these calls for each of the parameters in order to test the same thing.&lt;/p&gt;</comment>
                            <comment id="12504375" author="moazeni" created="Wed, 13 Jun 2007 20:12:52 +0100"  >&lt;p&gt;Attaching another patch that addresses previous review.&lt;/p&gt;</comment>
                            <comment id="12504867" author="kmarsden" created="Thu, 14 Jun 2007 19:34:49 +0100"  >&lt;p&gt;Thanks Ramin for the patch.&lt;br/&gt;
I committed it with revision &lt;br/&gt;
New Revision: 547349&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewvc?view=rev&amp;amp;rev=547349&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=rev&amp;amp;rev=547349&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It would be good to add some javadoc comments and I did have this question. There is a comment &lt;/p&gt;

&lt;p&gt;      		// TODO: Some of the OUT params are getting reported as IN_OUT for embedded.&lt;br/&gt;
      		// Network server reports it correctly.&lt;/p&gt;

&lt;p&gt;but I don&apos;t see any test showing this behavior. Do we need a new test and Jira entry for this or is it no longer an issue?&lt;/p&gt;</comment>
                            <comment id="12505076" author="knutanders" created="Fri, 15 Jun 2007 08:41:47 +0100"  >&lt;p&gt;JDBCHarnessJavaTest started failing with ClassNotFoundException after this commit. Fixed in revision 547567.&lt;/p&gt;</comment>
                            <comment id="12505886" author="moazeni" created="Mon, 18 Jun 2007 18:08:06 +0100"  >&lt;p&gt;Hi Kathey&lt;/p&gt;

&lt;p&gt;I have added javadoc comments to the test. The patch is attached.&lt;/p&gt;

&lt;p&gt;As for the following comment, &lt;br/&gt;
       // TODO: Some of the OUT params are getting reported as IN_OUT for embedded.&lt;br/&gt;
       // Network server reports it correctly. &lt;br/&gt;
I was not able to reproduce it and therefore, I removed the comment.&lt;/p&gt;

&lt;p&gt;Please note that derbyall and suites.All both passed without any errors.&lt;/p&gt;</comment>
                            <comment id="12506320" author="army" created="Tue, 19 Jun 2007 23:38:27 +0100"  >&lt;p&gt;As of svn # 547349 for this issue, suites.All has been failing when run with weme6.1.  It turns out the that new ParameterMetaDataJdbc30Test fails with the following error:&lt;/p&gt;

&lt;p&gt;  Failed to invoke suite():java.lang.NoClassDefFoundError: java.sql.ParameterMetaData&lt;/p&gt;

&lt;p&gt;There&apos;s no stack trace or logging so I don&apos;t have any more than that...&lt;/p&gt;</comment>
                            <comment id="12507454" author="army" created="Fri, 22 Jun 2007 18:07:53 +0100"  >&lt;p&gt;Filed &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2862&quot; title=&quot;ParameterMetaDataJdbc30 fails for weme6.1, which prevents rest of suites.All from completing.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2862&quot;&gt;&lt;del&gt;DERBY-2862&lt;/del&gt;&lt;/a&gt; for the weme6.1 failure since I haven&apos;t heard anything back on this...&lt;/p&gt;</comment>
                            <comment id="12508420" author="myrna" created="Wed, 27 Jun 2007 06:03:44 +0100"  >&lt;p&gt;Now this is interesting, what do I mark this fixed as? The new test went into 10.3.0.0, the cleanup into 10.4 and 10.3.1.1. As test issues don&apos;t need to go into the release notes, it doesn&apos;t matter from that point of view. Marking all 3 versions. &lt;/p&gt;</comment>
                            <comment id="12523132" author="moazeni" created="Tue, 28 Aug 2007 00:24:01 +0100"  >&lt;p&gt;Reopening this issue to fix the assertSQLState()s.&lt;/p&gt;

&lt;p&gt;The following is the comments from Dan posted on derby-dev alias:&lt;br/&gt;
-----------------------------------------------------------------------------------------&lt;br/&gt;
All the assertSQLState() have the incorrect parameters in that test&lt;br/&gt;
(parameterMetadataJdbc30Test) so that they can never fail.&lt;/p&gt;

&lt;p&gt;E.g.&lt;/p&gt;

&lt;p&gt;assertSQLState(&quot;22019&quot;, e.getSQLState(), e);&lt;/p&gt;


&lt;p&gt;The first argument is the message, the second the expected state. Here&lt;br/&gt;
the SQL state from the exception itself is being passed as expected, and&lt;br/&gt;
thus will be compared to itself and always pass. If no message is needed&lt;br/&gt;
then the call should be:&lt;/p&gt;

&lt;p&gt;assertSQLState(&quot;22019&quot;, e);&lt;br/&gt;
-----------------------------------------------------------------------------------------&lt;/p&gt;</comment>
                            <comment id="12524627" author="moazeni" created="Tue, 4 Sep 2007 07:20:39 +0100"  >&lt;p&gt;Attaching the v4 diff to fix the issues Dan pointed out with regard to assertSQLState()s. &lt;/p&gt;</comment>
                            <comment id="12551254" author="fuzzylogic" created="Thu, 13 Dec 2007 08:33:17 +0000"  >&lt;p&gt;Should rev 572662 be backported to the 10.3 branch so we can close this issue again?&lt;/p&gt;</comment>
                            <comment id="12580433" author="dyret" created="Wed, 19 Mar 2008 16:14:28 +0000"  >&lt;p&gt;rev 572662 merged to 10.3 in revision 638919.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12371219">DERBY-2786</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12372231">DERBY-2862</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12377318">DERBY-3039</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12358513" name="DERBY-2658.diff" size="38530" author="moazeni" created="Wed, 30 May 2007 09:46:16 +0100"/>
                            <attachment id="12359289" name="DERBY-2658.diff-060807" size="58304" author="moazeni" created="Fri, 8 Jun 2007 17:18:25 +0100"/>
                            <attachment id="12359648" name="DERBY-2658.diff-061307" size="72642" author="moazeni" created="Thu, 14 Jun 2007 02:12:58 +0100"/>
                            <attachment id="12359290" name="DERBY-2658.stat-060807" size="572" author="moazeni" created="Fri, 8 Jun 2007 17:19:31 +0100"/>
                            <attachment id="12360045" name="DERBY-2658_061807.diff" size="37486" author="moazeni" created="Mon, 18 Jun 2007 18:08:44 +0100"/>
                            <attachment id="12360046" name="DERBY-2658_061807.stat" size="494" author="moazeni" created="Mon, 18 Jun 2007 18:09:01 +0100"/>
                            <attachment id="12365045" name="DERBY-2658v4.diff" size="2346" author="moazeni" created="Tue, 4 Sep 2007 07:20:39 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 30 May 2007 20:50:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30557</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0u67:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38706</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>