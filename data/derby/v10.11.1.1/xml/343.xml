<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:07:30 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-343/DERBY-343.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-343] Clean up DRDA classes handling of OPNQRY options</title>
                <link>https://issues.apache.org/jira/browse/DERBY-343</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The follow is a list of changes to be implemented in the DRDAConnThread, DRDAStatement and DRDAResultSet. It is hoped that these changes will clean up code related to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-213&quot; title=&quot;ResultSet.next() after last row of FORWARD_ONLY cursor throws an SQL Exception with Network Server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-213&quot;&gt;&lt;del&gt;DERBY-213&lt;/del&gt;&lt;/a&gt; and make the fix easier to implement.&lt;/p&gt;

&lt;p&gt;###################################&lt;/p&gt;

&lt;p&gt;Step 1:&lt;/p&gt;

&lt;p&gt;In org.apache.derby.impl.drda.DRDAResultSet add&lt;br/&gt;
public static final int QRYCLSIMP_DEFAULT = CodePoint.QRYCLSIMP_NO;&lt;/p&gt;

&lt;p&gt;############################&lt;/p&gt;

&lt;p&gt;Step 2:&lt;/p&gt;

&lt;p&gt;Copy the org.apache.derby.impl.drda.DRDAStatement.setOPNQRYOptions() method to the org.apache.derby.impl.drda.DRDAResultSet class and &lt;br/&gt;
change the logic of set setOPNQRYOptions() to remove the setting of the qryclsimp value to QRYCLSIMP_SERVER_CHOICE. Only the values of YES or NO will ever be stored internally.&lt;/p&gt;

&lt;p&gt;e.g.&lt;/p&gt;

&lt;p&gt;DRDAResultSet.setOPNQRYOptions(int blksize, int qryblkctl, int maxblkext, int outovropt, int qryrowset, &lt;br/&gt;
    int qryclsimpl) {&lt;br/&gt;
	this.blksize = blksize;&lt;br/&gt;
	setQryprctyp(qryblkctl);&lt;br/&gt;
	this.maxblkext = maxblkext;&lt;br/&gt;
	this.outovropt = outovropt;&lt;br/&gt;
	this.qryrowset = qryrowset;&lt;br/&gt;
	this.qryclsimp = (qryclsimpl == CodePoint.QRYCLSIMP_SERVER_CHOICE)&lt;br/&gt;
			? DRDAResultSet.QRYCLSIMP_DEFAULT : qryclsimpl;&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Thereafter change to the DRDAStatement.setOPNQRYOptions() to a delegation method which calls the method in DRDAResultSet&lt;/p&gt;

&lt;p&gt;e.g.&lt;/p&gt;

&lt;p&gt;DRDAStatement.setOPNQRYOptions(int blksize, int qryblkctl, 								  int maxblkext, int outovropt,int qryrowset,int qryclsimpl)&lt;br/&gt;
{&lt;br/&gt;
    currentDrdaRs.setOPNQRYOptions(blksize, qryblkctl, maxblkext, &lt;br/&gt;
        outovropt, qryrowset, qryclsimpl);&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;###################################&lt;/p&gt;

&lt;p&gt;Step 3:&lt;/p&gt;

&lt;p&gt;Add org.apache.derby.impl.drda.DRDAResultSet.isRSCloseImplicit() which will test to see if the resultset should close implicitly&lt;/p&gt;

&lt;p&gt;e.g.&lt;/p&gt;

&lt;p&gt;boolean DRDAResultSet.isRSCloseImplicit() {&lt;br/&gt;
	return currentDrdaRs.qryclsimp == CodePoint.QRYCLSIMP_YES &amp;amp;&amp;amp; &lt;br/&gt;
		stmt.getQryprctyp() != CodePoint.LMTBLKPRC&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Then add a corresponding delegation method in org.apache.derby.impl.drda.DRDAStatement()&lt;/p&gt;

&lt;p&gt;boolean DRDAStatement.isRSCloseImplicit() {&lt;br/&gt;
	return currentDrdaRs.isRSCloseImplicit();&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;###################################&lt;/p&gt;

&lt;p&gt;Step 4:&lt;/p&gt;

&lt;p&gt;Remove org.apache.derby.impl.drda.DRDAStatment.setQryclsimp(int value)&lt;/p&gt;

&lt;p&gt;###################################&lt;/p&gt;

&lt;p&gt;Step 5: &lt;/p&gt;

&lt;p&gt;Remove all references to &lt;br/&gt;
if (qryclsimp == CodePoint.QRYCLSIMP_YES &amp;amp;&amp;amp;&lt;br/&gt;
	stmt.getQryprctyp() != CodePoint.LMTBLKPRC)  { ...&lt;br/&gt;
logic and replace with &lt;br/&gt;
if (drdaStatement.isRSCloseImplicit()) { ...&lt;/p&gt;

&lt;p&gt;This should remove all references to org.apache.derby.impl.drda.DRDAStatment.getQryclsimp() which can in turn be removed.&lt;/p&gt;

&lt;p&gt;###################################&lt;/p&gt;

&lt;p&gt;Step 6: &lt;/p&gt;

&lt;p&gt;In org.apache.derby.drda.impl.DRDAResultSet change:&lt;/p&gt;

&lt;p&gt;protected int qryclsimp&lt;br/&gt;
to&lt;br/&gt;
private int qryclsimp;&lt;/p&gt;

&lt;p&gt;###################################&lt;/p&gt;

&lt;p&gt;Step 7:&lt;/p&gt;

&lt;p&gt;In org.apache.derby.drda.impl.DRDAConnThread.parseOPNQRY() change the line&lt;br/&gt;
int qryclsimp = CodePoint.QRYCLSIMP_DEFAULT;&lt;br/&gt;
to &lt;br/&gt;
int qryclsimp = DRDAResultSet.QRYCLSIMP_DEFAULT&lt;/p&gt;

&lt;p&gt;###################################&lt;/p&gt;

&lt;p&gt;Step 8:&lt;/p&gt;

&lt;p&gt;In org.apache.derby.drda.impl.CodePoint remove&lt;br/&gt;
static final int QRYCLSIMP_DEFAULT = QRYCLSIMP_SERVER_CHOICE;&lt;/p&gt;

&lt;p&gt;###################################&lt;/p&gt;

&lt;p&gt;Step 9: Insure that the new methods and changed methods have appropriate java documentation.&lt;/p&gt;

&lt;p&gt;###################################&lt;/p&gt;

&lt;p&gt;Step 10: Organize the import for the DRDAConnThread, DRDAStatement and DRDAResultSet classes found in the org.apache.derby.drda.impl package.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12311127">DERBY-343</key>
            <summary>Clean up DRDA classes handling of OPNQRY options</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="31588">DERBY-213</parent>
                                    <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="acadia_student_01">Philip Wilder</assignee>
                                    <reporter username="acadia_student_01">Philip Wilder</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Jun 2005 23:45:45 +0100</created>
                <updated>Fri, 10 Jun 2005 04:20:32 +0100</updated>
                            <resolved>Fri, 10 Jun 2005 04:20:18 +0100</resolved>
                                    <version>10.0.2.0</version>
                    <version>10.0.2.1</version>
                                    <fixVersion>10.1.1.0</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12312899" author="acadia_student_01" created="Wed, 8 Jun 2005 02:13:56 +0100"  >&lt;p&gt;My first potential patch. The patch in question is designed to addressed the problems mentioned in the description for this issue.&lt;br/&gt;
Could one or more people please review this to insure that everything is done properly.&lt;/p&gt;</comment>
                            <comment id="12313159" author="kmarsden" created="Thu, 9 Jun 2005 22:58:36 +0100"  >
&lt;p&gt;Sending        java\drda\org\apache\derby\impl\drda\CodePoint.java&lt;br/&gt;
Sending        java\drda\org\apache\derby\impl\drda\DRDAConnThread.java&lt;br/&gt;
Sending        java\drda\org\apache\derby\impl\drda\DRDAResultSet.java&lt;br/&gt;
Sending        java\drda\org\apache\derby\impl\drda\DRDAStatement.java&lt;br/&gt;
Transmitting file data ....&lt;br/&gt;
Committed revision 189752.&lt;/p&gt;</comment>
                            <comment id="12313177" author="acadia_student_01" created="Fri, 10 Jun 2005 04:20:17 +0100"  >&lt;p&gt;The patch committed by kmarsden closes this issue. However a cleanup to remove all warnings from DRDA compilation may occur at a later time.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12310573" name="Derby213.diff" size="12312" author="acadia_student_01" created="Wed, 8 Jun 2005 02:13:53 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 9 Jun 2005 21:58:36 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29499</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy182f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40957</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>