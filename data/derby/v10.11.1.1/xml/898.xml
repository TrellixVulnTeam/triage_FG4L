<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:39:22 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-898/DERBY-898.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-898] setAutoCommit(false) is not working properly for local transaction with ClientXADataSource</title>
                <link>https://issues.apache.org/jira/browse/DERBY-898</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt; Network Server is not honoring local &lt;br/&gt;
transaction rollback using ClientXADataSource.  Run the following standalone JDBC code.  &lt;br/&gt;
The output shows that after rolling back the local transaction, &lt;br/&gt;
the inserted data is still present.&lt;/p&gt;

&lt;p&gt;        final org.apache.derby.jdbc.ClientXADataSource ds =&lt;br/&gt;
            new org.apache.derby.jdbc.ClientXADataSource();&lt;br/&gt;
        ds.setServerName(&quot;localhost&quot;);&lt;br/&gt;
        ds.setPortNumber(1527);&lt;/p&gt;

&lt;p&gt;ds.setDatabaseName(&quot;WOMBAT&quot;);&lt;br/&gt;
        ds.setTraceLevel(-1);&lt;/p&gt;

&lt;p&gt;ds.setSecurityMechanism(ds.CLEAR_TEXT_PASSWORD_SECURITY);&lt;br/&gt;
        ds.setUser(&quot;dbuser1&quot;);&lt;br/&gt;
        ds.setPassword(&quot;dbpwd1&quot;);&lt;br/&gt;
        //ds.setLogWriter(new &lt;br/&gt;
java.io.PrintWriter(System.out));&lt;/p&gt;

&lt;p&gt;        XAConnection xaConn = ds.getXAConnection();&lt;br/&gt;
        Connection conn = xaConn.getConnection();&lt;/p&gt;


&lt;p&gt;conn.setTransactionIsolation(Connection.TRANSACTION_REPEATABLE_R&lt;br/&gt;
EAD);&lt;/p&gt;

&lt;p&gt;        conn.setAutoCommit(true);&lt;/p&gt;

&lt;p&gt;        System.out.println(&quot;Database product: &quot; + &lt;br/&gt;
conn.getMetaData().getDatabaseProductName());&lt;br/&gt;
        System.out.println(&quot;Database version: &quot; + &lt;br/&gt;
conn.getMetaData().getDatabaseProductVersion());&lt;br/&gt;
        System.out.println(&quot;Driver name:      &quot; + &lt;br/&gt;
conn.getMetaData().getDriverName());&lt;br/&gt;
        System.out.println(&quot;Driver version:   &quot; + &lt;br/&gt;
conn.getMetaData().getDriverVersion());&lt;/p&gt;

&lt;p&gt;        Statement stmt = conn.createStatement();&lt;/p&gt;

&lt;p&gt;        try &lt;/p&gt;
{ stmt.execute(&quot;drop table cmtest&quot;); }
&lt;p&gt;        catch (SQLException sqlX) {} // ok, didn&apos;t exist&lt;/p&gt;

&lt;p&gt;        stmt.execute(&quot;CREATE TABLE cmtest (id integer not null &lt;br/&gt;
primary key, name varchar(60))&quot;);&lt;br/&gt;
        stmt.close();&lt;/p&gt;

&lt;p&gt;        conn.setAutoCommit(false);&lt;/p&gt;

&lt;p&gt;        PreparedStatement pstmt = conn.prepareStatement(&lt;br/&gt;
            &quot;INSERT INTO cmtest (id, name) VALUES(?,?)&quot;,&lt;br/&gt;
            ResultSet.TYPE_FORWARD_ONLY,&lt;br/&gt;
            ResultSet.CONCUR_READ_ONLY);&lt;/p&gt;

&lt;p&gt;        pstmt.setInt(1, 13);&lt;br/&gt;
        pstmt.setString(2, &quot;blah1&quot;);&lt;br/&gt;
        pstmt.executeUpdate();&lt;/p&gt;

&lt;p&gt;        pstmt.setInt(1, 2);&lt;br/&gt;
        pstmt.setString(2, &quot;blah2&quot;);&lt;br/&gt;
        pstmt.executeUpdate();&lt;/p&gt;

&lt;p&gt;        conn.rollback();&lt;/p&gt;

&lt;p&gt;        PreparedStatement pstmt2 = conn.prepareStatement(&lt;br/&gt;
            &quot;SELECT * FROM cmtest WHERE id = ?&quot;,&lt;br/&gt;
            ResultSet.TYPE_FORWARD_ONLY,&lt;br/&gt;
            ResultSet.CONCUR_READ_ONLY);&lt;/p&gt;

&lt;p&gt;        pstmt2.setInt(1, 13);&lt;/p&gt;

&lt;p&gt;        ResultSet rset = pstmt2.executeQuery();&lt;/p&gt;

&lt;p&gt;        if (rset.next())&lt;/p&gt;
        {
            System.out.println(&quot;Test fails. First insert was 
not rolled back.&quot;);
            System.out.println(&quot;The data is still present. It 
is: &quot; + rset.getObject(1) +
                               &quot;, &quot; + rset.getObject(2));
        }
&lt;p&gt;        else&lt;br/&gt;
            System.out.println(&quot;Test passes. First insert was &lt;br/&gt;
rolled back.&quot;);&lt;/p&gt;

&lt;p&gt;Here&apos;s the output,&lt;/p&gt;

&lt;p&gt;    Database product: Apache Derby&lt;br/&gt;
    Database version: 10.1.2.2&lt;br/&gt;
    Driver name:      Apache Derby Network Client JDBC Driver&lt;br/&gt;
    Driver version:   10.1.2.2&lt;br/&gt;
    Test fails. First insert was not rolled back.&lt;br/&gt;
    The data is still present. It is: 13, blah1&lt;/p&gt;

&lt;p&gt;On some brief investigation I see that the Network Server embedded connection is  in autocomit mode so is autocommitting the transaction before the rollback.   Network server should always have autocommit false and let the client drive the commit.  &lt;/p&gt;
</description>
                <environment></environment>
        <key id="12328359">DERBY-898</key>
            <summary>setAutoCommit(false) is not working properly for local transaction with ClientXADataSource</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kmarsden">Kathey Marsden</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Feb 2006 05:15:00 +0000</created>
                <updated>Thu, 9 Feb 2006 23:04:21 +0000</updated>
                            <resolved>Thu, 9 Feb 2006 23:03:45 +0000</resolved>
                                    <version>10.1.1.0</version>
                    <version>10.1.2.1</version>
                                    <fixVersion>10.1.3.1</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12365092" author="kmarsden" created="Sat, 4 Feb 2006 02:26:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-898&quot; title=&quot;setAutoCommit(false) is not working properly for local transaction with ClientXADataSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-898&quot;&gt;&lt;del&gt;DERBY-898&lt;/del&gt;&lt;/a&gt; setAutoCommit(false) is not working properly with connections objtained with ClientXADataSource.&lt;/p&gt;

&lt;p&gt;The problem in this case was that the  server side connection was  set to autocommit true.  Even when the client has autocommit on, the server side connection should be autocommit false and let the client drive the commits.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Changes server side connection for network server XA to autocommit false.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Adds connections obtained from an XADataSource to the savepointJdbc30 test to verify that autocommit is being set properly and also verify that &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-899&quot; title=&quot;Cannot rollback to savepoint when using ClientXADataSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-899&quot;&gt;&lt;del&gt;DERBY-899&lt;/del&gt;&lt;/a&gt; (a dup of this issue) is fixed.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I will commit to 10.1 later today.&lt;/p&gt;</comment>
                            <comment id="12365127" author="kmarsden" created="Sat, 4 Feb 2006 06:05:37 +0000"  >&lt;p&gt;Checked in fix to 10.1&lt;/p&gt;

&lt;p&gt;Date: Fri Feb  3 13:00:35 2006&lt;br/&gt;
New Revision: 374742&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewcvs?rev=374742&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=374742&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12365518" author="kmarsden" created="Wed, 8 Feb 2006 13:13:52 +0000"  >&lt;p&gt;OK. So I decided to go with option 1), but wonder what the naming convention should be for this.&lt;br/&gt;
Right now I have simpleSavepointJdbc30.java for the base test that runs with all jvms and extendedSavepointJdbc30.java for the one that has the non J2ME/CDC/FP functionality, but would there be a better naming convention? &lt;/p&gt;


</comment>
                            <comment id="12365520" author="djd" created="Wed, 8 Feb 2006 13:37:44 +0000"  >&lt;p&gt;I think it would be good to get the names to reflect the reality that  CDC/Foundation/JSR169 is a sub-set of the JDBC 3.0 spec,&lt;br/&gt;
not that JDBC 3.0 is an extended version of  JSR169. &lt;/p&gt;

&lt;p&gt;Possible names&lt;/p&gt;

&lt;p&gt;savepointJdbc30_JSR169&lt;br/&gt;
savepointJdbc30_XA&lt;/p&gt;

&lt;p&gt;or&lt;/p&gt;

&lt;p&gt;savepointJdbc30&lt;br/&gt;
savepointJdbc30_XA&lt;/p&gt;

&lt;p&gt;IThe XA iaccurately depicts what is being tested, rather than just saying extended.&lt;/p&gt;
</comment>
                            <comment id="12365735" author="kmarsden" created="Thu, 9 Feb 2006 23:03:45 +0000"  >&lt;p&gt;Date: Thu Feb  9 06:02:18 2006&lt;br/&gt;
New Revision: 376296&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewcvs?rev=376296&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=376296&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12365736" author="kmarsden" created="Thu, 9 Feb 2006 23:04:21 +0000"  >&lt;p&gt;fixed in trunk and 10.1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12322612" name="DERBY-898.diff" size="20164" author="kmarsden" created="Sat, 4 Feb 2006 02:26:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 8 Feb 2006 13:37:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22195</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy1773:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40816</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>