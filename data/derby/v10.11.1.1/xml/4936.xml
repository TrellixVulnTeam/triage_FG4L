<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:38:35 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4936/DERBY-4936.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4936] Add core istat daemon</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4936</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Tracks the task of adding the core daemon code, which will be responsible to do the heavy lifting for the istat feature.&lt;br/&gt;
Note that the code will be left disabled, enabling it will be done under a separate Jira.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12492657">DERBY-4936</key>
            <summary>Add core istat daemon</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12492655">DERBY-4934</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kristwaa">Kristian Waagan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Dec 2010 21:06:26 +0000</created>
                <updated>Tue, 19 Apr 2011 13:39:23 +0100</updated>
                            <resolved>Mon, 3 Jan 2011 11:02:59 +0000</resolved>
                                    <version>10.8.1.2</version>
                                    <fixVersion>10.8.1.2</fixVersion>
                                    <component>SQL</component>
                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12969291" author="kristwaa" created="Wed, 8 Dec 2010 12:46:35 +0000"  >&lt;p&gt;Attaching patch 1a, which adds the core daemon code for the istat feature. For some more discussion, see &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4771&quot; title=&quot;Continue investigation of automatic creation/update of index statistics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4771&quot;&gt;&lt;del&gt;DERBY-4771&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This patch is not ready for commit, as there are some issues left to address. Note that to test this feature now, you have to apply the patch(es) for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4938&quot; title=&quot;Implement istat scheduling/triggering&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4938&quot;&gt;&lt;del&gt;DERBY-4938&lt;/del&gt;&lt;/a&gt; and set derby.storage.indexStats.auto=true. This will most likely change after &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4939&quot; title=&quot;Enable istat daemon and tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4939&quot;&gt;&lt;del&gt;DERBY-4939&lt;/del&gt;&lt;/a&gt; has been resolved, since the feature should be enabled by default &lt;/p&gt;

&lt;p&gt;Remaining issues (copied from &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4771&quot; title=&quot;Continue investigation of automatic creation/update of index statistics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4771&quot;&gt;&lt;del&gt;DERBY-4771&lt;/del&gt;&lt;/a&gt;, I have given them names):&lt;/p&gt;

&lt;p&gt;A Yes, but not at this level. I thought it would be nice to have a name for the&lt;br/&gt;
  transaction to identify it in the transaction table.&lt;br/&gt;
  I think some new methods must be added to be able to name a transaction at&lt;br/&gt;
  this level, so I&apos;m not sure if it is worth the trouble.&lt;br/&gt;
  I&apos;m keeping the TODO for now, might remove it in the next iteration.&lt;/p&gt;

&lt;p&gt;  Opinions? &lt;/p&gt;

&lt;p&gt;B It isn&apos;t needed now. Since the interface is internal, and there is only one&lt;br/&gt;
  implementation of it, I suppose the best action to take now is to remove it.&lt;br/&gt;
  We can introduce it again later, and then probably in a shape more like you&lt;br/&gt;
  have described. It feels a bit odd to say in the JavaDoc that scheduling&lt;br/&gt;
  requests may be denied, and not have a way to learn if it happened or not...&lt;/p&gt;

&lt;p&gt;  Opinions?&lt;/p&gt;

&lt;p&gt;C Added synchronization for runningThread in the finally-block.&lt;br/&gt;
  The current code will let the thread die and then create a new one on the&lt;br/&gt;
  next update request. I considered adding a sleep before letting the thread&lt;br/&gt;
  die, in case a new request would come in quickly.&lt;/p&gt;

&lt;p&gt;  Opinions? &lt;/p&gt;

&lt;p&gt;D Do you mean we should call TransactionResourceImpl#handleException explicitly&lt;br/&gt;
  here?&lt;br/&gt;
  I think the comment meant to say that the daemon will be disabled elsewhere.&lt;br/&gt;
  I&apos;ll address this issue in the next iteration.&lt;/p&gt;

&lt;p&gt;Further review is welcome!&lt;/p&gt;</comment>
                            <comment id="12970180" author="kristwaa" created="Fri, 10 Dec 2010 14:31:04 +0000"  >&lt;p&gt;First, I added logic to shutdown on too many consecutive errors (too many set to 50) in 1a (different from &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4771&quot; title=&quot;Continue investigation of automatic creation/update of index statistics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4771&quot;&gt;&lt;del&gt;DERBY-4771&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Attaching patch 1b, with the following changes from revision a:&lt;/p&gt;

&lt;p&gt;A    java/engine/org/apache/derby/impl/services/daemon/IndexStatisticsDaemonImpl.java&lt;/p&gt;

&lt;p&gt;o Rewrote/added some comments.&lt;br/&gt;
o Removed &quot;utilization rate&quot; and just printed the time spent working and the age of the daemon.&lt;br/&gt;
o Require log stream to be non-null (IllegalArgumentException)&lt;br/&gt;
o Rewrote retry-logic in generateStatistics.&lt;br/&gt;
o Folded method updateAllIndexesStats into generateStatistics (because I had to move invalidateStatements)&lt;br/&gt;
o Changed order of actions in writeUpdatedStats. It will no do:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;setHeapRowEstimate&lt;/li&gt;
	&lt;li&gt;invalidateStatements&lt;/li&gt;
	&lt;li&gt;dropStats&lt;/li&gt;
	&lt;li&gt;addStats&lt;br/&gt;
o Made writeUpdatedStat return also for background task if numRows == zero.&lt;br/&gt;
o Fancier retry logic in invalidateStatements.&lt;br/&gt;
o Moved some code related to lcc/tx initialization&lt;br/&gt;
o Call ContextManager.cleanupOnError for fatal errors,  and some changes to the error handling flow.&lt;br/&gt;
o Destroy tx when stopping (if idle).&lt;br/&gt;
o Added debug method extratIstatInfo(StandardException), which will print to lines of the stack for known errors. It will print the last line of code invoked in the daemon together with the next class/method called. This allows us to better understand why/where an expected error was thrown without logging the full stack.&lt;br/&gt;
o I kept STORAGE_AUTO_INDEX_STATS_DEBUG_ABSDIFF_THRESHOLD,  but set the default to zero. Makes it easy to work around problems caused by disabling the check (i.e., set it to a non-zero value).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I will commit this patch now.&lt;/p&gt;</comment>
                            <comment id="12970210" author="kristwaa" created="Fri, 10 Dec 2010 16:11:26 +0000"  >&lt;p&gt;Committed patch 1b to trunk with revision 1044413.&lt;br/&gt;
I will wait a few days before I commit &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4937&quot; title=&quot;Enable explicit mode istat daemon code for UPDATE_STATISTICS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4937&quot;&gt;&lt;del&gt;DERBY-4937&lt;/del&gt;&lt;/a&gt; to go through a few days of automated testing to be sure this code didn&apos;t cause any trouble.&lt;/p&gt;

&lt;p&gt;You may see a new line in your derby.log file when shutting down your database, but it will always report zero or false for everything. If you want to suppress it, specify derby.storage.indexStats.log=false.&lt;br/&gt;
I have enabled logging by default now during initial testing to make sure there is some information available about what the daemon is doing in case problems occur.&lt;/p&gt;</comment>
                            <comment id="12976697" author="kristwaa" created="Mon, 3 Jan 2011 11:02:59 +0000"  >&lt;p&gt;Initial core code added. Bugs and required changes will be addressed under separate JIRAs.&lt;/p&gt;</comment>
                            <comment id="12999570" author="kristwaa" created="Fri, 25 Feb 2011 21:07:44 +0000"  >&lt;p&gt;Closing issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12492658">DERBY-4937</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12492659">DERBY-4938</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12465798" name="derby-4936-1a-core_istat_daemon.diff" size="69429" author="kristwaa" created="Wed, 8 Dec 2010 12:46:35 +0000"/>
                            <attachment id="12465797" name="derby-4936-1a-core_istat_daemon.stat" size="535" author="kristwaa" created="Wed, 8 Dec 2010 12:46:34 +0000"/>
                            <attachment id="12465987" name="derby-4936-1b-core_istat_daemon.diff" size="73360" author="kristwaa" created="Fri, 10 Dec 2010 14:31:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31446</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0gjb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36497</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>