<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:46:18 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2014/DERBY-2014.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2014] NullPointerException with NULLIF in GROUP BY clause</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2014</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;A NPE occurs when NULLIF is used in the GROUP BY clause.&lt;/p&gt;

&lt;p&gt;ij&amp;gt; create table t1 (c1 int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t1 values 1,2,2,3;&lt;br/&gt;
4 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; select nullif(c1,c1) from t1 group by nullif(c1,c1);&lt;br/&gt;
ERROR XJ001: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;/p&gt;

&lt;p&gt;Stacktrace:&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ConstantNode.isEquivalent(ConstantNode.java:285)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.CastNode.isEquivalent(CastNode.java:1044)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ConditionalNode.isEquivalent(ConditionalNode.java:518)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.GroupByList.findGroupingColumn(GroupByList.java:244)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.VerifyAggregateExpressionsVisitor.skipChildren(VerifyAggregateExpressionsVisitor.java:146)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ConditionalNode.accept(ConditionalNode.java:484)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ResultColumn.accept(ResultColumn.java:1515)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.QueryTreeNodeVector.accept(QueryTreeNodeVector.java:159)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.SelectNode.bindExpressions(SelectNode.java:619)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.FromSubquery.bindExpressions(FromSubquery.java:262)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.FromList.bindExpressions(FromList.java:337)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.SelectNode.bindExpressions(SelectNode.java:500)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.DMLStatementNode.bindExpressions(DMLStatementNode.java:249)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.DMLStatementNode.bind(DMLStatementNode.java:162)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.CursorNode.bind(CursorNode.java:253)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:345)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:119)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:745)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:568)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:517)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:321)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:517)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:370)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:268)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.go(Main.java:204)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:170)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:56)&lt;br/&gt;
	at org.apache.derby.tools.ij.main(ij.java:71)&lt;/p&gt;

&lt;p&gt;sysinfo:&lt;/p&gt;

&lt;p&gt;------------------ Java Information ------------------&lt;br/&gt;
Java Version:    1.4.2_12&lt;br/&gt;
Java Vendor:     Sun Microsystems Inc.&lt;br/&gt;
Java home:       C:\jdk142\jre&lt;br/&gt;
Java classpath:  classes;.&lt;br/&gt;
OS name:         Windows XP&lt;br/&gt;
OS architecture: x86&lt;br/&gt;
OS version:      5.1&lt;br/&gt;
Java user name:  yip&lt;br/&gt;
Java user home:  C:\Documents and Settings\Administrator&lt;br/&gt;
Java user dir:   C:\derby\trunk&lt;br/&gt;
java.specification.name: Java Platform API Specification&lt;br/&gt;
java.specification.version: 1.4&lt;br/&gt;
--------- Derby Information --------&lt;br/&gt;
JRE - JDBC: J2SE 1.4.2 - JDBC 3.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;C:\derby\trunk\classes&amp;#93;&lt;/span&gt; 10.3.0.0 alpha - (1)&lt;br/&gt;
------------------------------------------------------&lt;br/&gt;
----------------- Locale Information -----------------&lt;br/&gt;
Current Locale :  [English/United States &lt;span class=&quot;error&quot;&gt;&amp;#91;en_US&amp;#93;&lt;/span&gt;]&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;de_DE&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;es&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;fr&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;it&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;ja_JP&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;ko_KR&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;pt_BR&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;zh_CN&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;zh_TW&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.0.0 alpha - (1)&lt;br/&gt;
------------------------------------------------------&lt;/p&gt;</description>
                <environment>Any</environment>
        <key id="12354209">DERBY-2014</key>
            <summary>NullPointerException with NULLIF in GROUP BY clause</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yipng">Yip Ng</assignee>
                                    <reporter username="yipng">Yip Ng</reporter>
                        <labels>
                    </labels>
                <created>Sat, 28 Oct 2006 19:40:57 +0100</created>
                <updated>Thu, 13 Dec 2007 09:05:17 +0000</updated>
                            <resolved>Sun, 5 Nov 2006 16:47:28 +0000</resolved>
                                    <version>10.2.1.6</version>
                    <version>10.3.1.4</version>
                                    <fixVersion>10.2.2.0</fixVersion>
                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12445474" author="yipng" created="Sun, 29 Oct 2006 23:13:47 +0000"  >&lt;p&gt;Attaching patch derby2014-trunk-diff01.txt for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2014&quot; title=&quot;NullPointerException with NULLIF in GROUP BY clause&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2014&quot;&gt;&lt;del&gt;DERBY-2014&lt;/del&gt;&lt;/a&gt;.  Again the NPE happens in isEquivalent() method where it does not handle value is null.  (same symptom as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2008&quot; title=&quot;NullPointerException with LTRIM, RTRIM and 2-argument SUBSTR() call in GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2008&quot;&gt;&lt;del&gt;DERBY-2008&lt;/del&gt;&lt;/a&gt;) and the patch addresses this + additonal testcases.  derbyall + junit suite passes.&lt;/p&gt;</comment>
                            <comment id="12445682" author="mkhettry" created="Mon, 30 Oct 2006 18:33:38 +0000"  >&lt;p&gt;The change to ConstantNode is fine. Thanks for finding and fixing this. On adding tests for this bug: Would it be better to add it to the JUnit test (GroupByExpression.java) rather than the old canon style test?&lt;/p&gt;</comment>
                            <comment id="12445854" author="bernt" created="Tue, 31 Oct 2006 09:32:54 +0000"  >&lt;p&gt;I&apos;m not sure what kind of equivalence isEquivalent, but is the following correct?&lt;/p&gt;

&lt;p&gt;+			// value can be null which represents a SQL NULL value.&lt;br/&gt;
+			return ( (other.getValue() == null &amp;amp;&amp;amp; getValue() == null) || &lt;/p&gt;

&lt;p&gt;I&apos;m always ware wrt. comparision of SQL NULL values, since &lt;br/&gt;
    NULL = whatever &lt;br/&gt;
(and any other comparision operator) will evaluate to UNKNOWN, not TRUE.&lt;/p&gt;</comment>
                            <comment id="12445862" author="yipng" created="Tue, 31 Oct 2006 10:24:02 +0000"  >&lt;p&gt;Thanks Manish and Bernt for reviewing the patch.  &lt;/p&gt;

&lt;p&gt;Bernt:  Good question.  If I am not mistaken, the isEquivalent() method is used to compare the select column against the group by with expression.  Note that it is comparing the structural form of the two expressions for equivalence at bind phase and not comparing the actual row values at runtime to produce a result.  Thus, I believe  in this context, it is valid.  &lt;/p&gt;

&lt;p&gt;Manish:  I&apos;ll see if I can find some time to convert the testcases in the patch to JUnit testcases.  Thanks for the suggestion.  &lt;/p&gt;</comment>
                            <comment id="12445933" author="djd" created="Tue, 31 Oct 2006 15:58:52 +0000"  >&lt;p&gt;The behaviour of isEquivalent() is described by the javadoc comments for ValueNode.isEquivalent().&lt;/p&gt;

&lt;p&gt;Bernt, do you think the description needs to be improved in some way? It&apos;s vital to get the javadoc for such a method to be accurate and clear.&lt;/p&gt;</comment>
                            <comment id="12445969" author="bryanpendleton" created="Tue, 31 Oct 2006 17:33:50 +0000"  >&lt;p&gt;Dan is this the Javadoc you are referring to?&lt;br/&gt;
&lt;a href=&quot;http://db.apache.org/derby/javadoc/engine/org/apache/derby/impl/sql/compile/ValueNode.html#isEquivalent(org.apache.derby.impl.sql.compile.ValueNode&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/javadoc/engine/org/apache/derby/impl/sql/compile/ValueNode.html#isEquivalent(org.apache.derby.impl.sql.compile.ValueNode&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;If so, then yes, I think the description needs to be improved. I think&lt;br/&gt;
that the topics that need to be described include:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;equivalency of basic data types, including &quot;interesting&quot; data types&lt;br/&gt;
   such as floating point and date types&lt;/li&gt;
	&lt;li&gt;behavior of NULL in equivalency checks&lt;/li&gt;
	&lt;li&gt;equivalency of expressions&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Yip, do you think you can propose some candidate Javadoc for us to review?&lt;/p&gt;</comment>
                            <comment id="12445976" author="yipng" created="Tue, 31 Oct 2006 17:57:46 +0000"  >&lt;p&gt;Sure, I&apos;ll be submitting a follow-up patch - addressing junit testcase conversion + the javadoc issue in ValueNode.isEquivalent.&lt;/p&gt;</comment>
                            <comment id="12446782" author="yipng" created="Fri, 3 Nov 2006 00:42:02 +0000"  >&lt;p&gt;Attaching patch derby2014-trunk-diff02.txt for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2014&quot; title=&quot;NullPointerException with NULLIF in GROUP BY clause&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2014&quot;&gt;&lt;del&gt;DERBY-2014&lt;/del&gt;&lt;/a&gt;.  This patch converts all the tests in the previous patch into junit.  Also the javadoc for ValueNode.isEquivalent() method has been updated.  Please review.  (I hope the javadoc is clear, if not, please let me know.)&lt;/p&gt;</comment>
                            <comment id="12447105" author="bryanpendleton" created="Sat, 4 Nov 2006 01:33:44 +0000"  >&lt;p&gt;Thanks Yip! The new Javadoc is clear and detailed and very useful.&lt;/p&gt;

&lt;p&gt;The new JUnit tests are also very clear and easy to follow. The only little nit I have is that &lt;br/&gt;
they seem to mix tabs and spaces.&lt;/p&gt;</comment>
                            <comment id="12447119" author="yipng" created="Sat, 4 Nov 2006 04:48:18 +0000"  >&lt;p&gt;Sorry about the mix of tabs and space, I was using 2 different editors.  Submitting patch derby2014-trunk-diff03.txt.  This patch fixes the mixed tab/spaces and uses 80 character column margin for the updated javadoc for ValueNode.isEquivalent() method.  Please review.&lt;/p&gt;</comment>
                            <comment id="12447153" author="bryanpendleton" created="Sat, 4 Nov 2006 15:35:20 +0000"  >&lt;p&gt;I&apos;m ready to commit this, but I wanted to confirm the Javadoc change and am having trouble running &apos;ant derbydocs&apos;, even on a clean trunk. I sent mail to the developer list asking for help.&lt;/p&gt;</comment>
                            <comment id="12447266" author="bryanpendleton" created="Sun, 5 Nov 2006 16:47:28 +0000"  >&lt;p&gt;Andrew fixed the problem I was having with the derbydocs build (thanks Andrew!)&lt;/p&gt;

&lt;p&gt;I added a few paragraph and list tags to the ValueNode.isEquivalent javadoc to&lt;br/&gt;
make it a bit more friendly in the HTML display and committed the 03 patch to&lt;br/&gt;
subversion as revision 471459.&lt;/p&gt;</comment>
                            <comment id="12454199" author="rhillegas" created="Wed, 29 Nov 2006 00:36:25 +0000"  >&lt;p&gt;Ported to 10.2 branch at subversion revision 480306.&lt;/p&gt;</comment>
                            <comment id="12551434" author="fuzzylogic" created="Thu, 13 Dec 2007 09:05:17 +0000"  >&lt;p&gt;This issue has been resolved for over a year with no further movement. Closing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12328186">DERBY-883</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12343852" name="derby2014-trunk-diff01.txt" size="5743" author="yipng" created="Sun, 29 Oct 2006 23:13:47 +0000"/>
                            <attachment id="12344253" name="derby2014-trunk-diff02.txt" size="11222" author="yipng" created="Fri, 3 Nov 2006 00:42:02 +0000"/>
                            <attachment id="12344320" name="derby2014-trunk-diff03.txt" size="11859" author="yipng" created="Sat, 4 Nov 2006 04:48:18 +0000"/>
                            <attachment id="12343851" name="derby2014-trunk-stat01.txt" size="328" author="yipng" created="Sun, 29 Oct 2006 23:13:47 +0000"/>
                            <attachment id="12344252" name="derby2014-trunk-stat02.txt" size="494" author="yipng" created="Fri, 3 Nov 2006 00:42:02 +0000"/>
                            <attachment id="12344319" name="derby2014-trunk-stat03.txt" size="494" author="yipng" created="Sat, 4 Nov 2006 04:48:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 30 Oct 2006 18:33:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22836</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0zwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39634</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>