<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:49:59 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5098/DERBY-5098.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5098] embedded/in-memory: SQLNonTransientConnectionException: No current connection   due to invalid page format</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5098</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;In my case I am inserting many many rows in a in memory derby DB. After a while (a few minutes) I get a &quot;SQLNonTransientConnectionException: No current connection&quot; and the derby.log (see attachment) contains a complaint about an invalid page format with a dump of the page in question (which is completely zeros). The derby.log also contains another entry before the error (usually the same time stamp as the error): Cleanup action starting&lt;br/&gt;
Maybe this is related to the error.&lt;br/&gt;
Please find attached a test case to reproduce the issue. Just give it enough memory (-Xmx4g). It will insert a lot of rows to an in-memory derby DB with several threads over several connections. In case you want to run only one thread with one connection you might want to set these properties:&lt;br/&gt;
 -DuseSingleConnectionOnly=true -DuseSynchronousCommit=true -DnumberOfAsyncThreadsPerGenerator=1 -DnumberOfGeneratorThreads=1 -DnubmerOfRowsPerThread=100000000 &lt;/p&gt;

&lt;p&gt;Thank you very much&lt;br/&gt;
Christian&lt;/p&gt;</description>
                <environment>OS: windows 2008 R2 x64, AIX 7.1, possibly other&lt;br/&gt;
JVM: SUN/Oracle 1.6.0_24 server x64, IBM J9 Java5 vm2.3.sr12.j9vmap6423-20100630, possibly others</environment>
        <key id="12500721">DERBY-5098</key>
            <summary>embedded/in-memory: SQLNonTransientConnectionException: No current connection   due to invalid page format</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="chrissid">Christian Deutsch</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Mar 2011 04:09:28 +0000</created>
                <updated>Mon, 17 Jun 2013 10:19:32 +0100</updated>
                            <resolved>Thu, 26 May 2011 10:39:00 +0100</resolved>
                                    <version>10.6.1.0</version>
                    <version>10.7.1.1</version>
                    <version>10.8.1.2</version>
                                    <fixVersion>10.6.2.4</fixVersion>
                    <fixVersion>10.7.1.4</fixVersion>
                    <fixVersion>10.8.2.2</fixVersion>
                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13032425" author="kristwaa" created="Thu, 12 May 2011 15:24:07 +0100"  >&lt;p&gt;Assigning issue to myself while doing some initial investigations.&lt;/p&gt;</comment>
                            <comment id="13033938" author="kristwaa" created="Mon, 16 May 2011 10:49:53 +0100"  >&lt;p&gt;Attaching patch 1a, which fixes the problem reported.&lt;/p&gt;

&lt;p&gt;The bug is an int overflow, which causes the in-memory backend  to allocate a new page instead of using the existing page. This is why the page contains zeros only.&lt;br/&gt;
I also changed a few other places in the code where there&apos;s a possibility for int overflow, by casting one of the operands to long.&lt;/p&gt;

&lt;p&gt;A cautionary note about running the repro unmodified, it seems to require more than 20 GB to finish. Is this another observation of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2338&quot; title=&quot;improve page allocation when there are many threaded inserts to same table .&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2338&quot;&gt;DERBY-2338&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;suites.All ran successfully on Solaris 11 Express with Java SE 6.&lt;/p&gt;


&lt;p&gt;Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="13033948" author="knutanders" created="Mon, 16 May 2011 11:10:52 +0100"  >&lt;p&gt;The changes in the patch look fine to me. +1 to commit.&lt;/p&gt;

&lt;p&gt;Since there is a check in increaseCapacity() that&apos;s making it a no-op in the case where the current capacity is larger than the requested capacity, maybe we could even remove the redundant checks around the calls to increaseCapacity()? Then we&apos;d only have to worry about overflow at one place.&lt;/p&gt;</comment>
                            <comment id="13033958" author="kristwaa" created="Mon, 16 May 2011 11:42:14 +0100"  >&lt;p&gt;Thanks, Knut. I committed patch 1a to trunk with revision 1103681.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit a patch with the suggested follow-up changes shortly.&lt;/p&gt;</comment>
                            <comment id="13033998" author="kristwaa" created="Mon, 16 May 2011 13:43:25 +0100"  >&lt;p&gt;Attached patch 2a, which removes the redundant checks as suggested by Knut.&lt;/p&gt;

&lt;p&gt;Committed to trunk with revision 1103718.&lt;/p&gt;

&lt;p&gt;I don&apos;t expect more work on this issue, but will keep the issue open for backporting. I&apos;ll look into that after checking the results of the nightly tests.&lt;/p&gt;</comment>
                            <comment id="13039612" author="kristwaa" created="Thu, 26 May 2011 10:39:01 +0100"  >&lt;p&gt;Back-ported fix:&lt;br/&gt;
 o 10.8: 1127842&lt;br/&gt;
 o 10.7: 1127843&lt;br/&gt;
 o 10.6: 1127844&lt;/p&gt;

&lt;p&gt;Resolving issue, ready for verification.&lt;/p&gt;</comment>
                            <comment id="13685273" author="knutanders" created="Mon, 17 Jun 2013 10:19:32 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12472905" name="DerbyRepro5098.java" size="8562" author="chrissid" created="Tue, 8 Mar 2011 04:14:40 +0000"/>
                            <attachment id="12479305" name="derby-5098-1a-overflow_fixes.diff" size="1755" author="kristwaa" created="Mon, 16 May 2011 10:49:53 +0100"/>
                            <attachment id="12479306" name="derby-5098-1a-overflow_fixes.stat" size="301" author="kristwaa" created="Mon, 16 May 2011 10:49:53 +0100"/>
                            <attachment id="12479322" name="derby-5098-2a-remove_redundant_checks.diff" size="1177" author="kristwaa" created="Mon, 16 May 2011 13:43:25 +0100"/>
                            <attachment id="12472909" name="derby.10.6.1.0.IBM_J9.java5.vm2.3.sr12.j9vmap6423-20100630.log" size="60982" author="chrissid" created="Tue, 8 Mar 2011 04:14:40 +0000"/>
                            <attachment id="12472906" name="derby.10.6.1.0_1.6.0_24.log" size="40856" author="chrissid" created="Tue, 8 Mar 2011 04:14:40 +0000"/>
                            <attachment id="12472910" name="derby.10.7.1.1.IBM_J9.java5.vm2.3.sr12.j9vmap6423-20100630.log" size="82759" author="chrissid" created="Tue, 8 Mar 2011 04:14:40 +0000"/>
                            <attachment id="12472907" name="derby.10.7.1.1_1.6.0_24.log" size="122758" author="chrissid" created="Tue, 8 Mar 2011 04:14:40 +0000"/>
                            <attachment id="12472908" name="derby.10.7.1.1_1.6.0_24__singleThreaded.log" size="21139" author="chrissid" created="Tue, 8 Mar 2011 04:14:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10365"><![CDATA[Crash]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 12 May 2011 14:24:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24644</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0eqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36205</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>