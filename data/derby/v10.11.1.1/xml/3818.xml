<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:16:10 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3818/DERBY-3818.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3818] client Insert/retrieval of 18MB  Clob is extremely slow  in MultiByteClobTest</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3818</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;In the test memory.MultiByteClobTest that was added for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3741&quot; title=&quot;SQL LENGTH function materializes CLOB into memory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3741&quot;&gt;&lt;del&gt;DERBY-3741&lt;/del&gt;&lt;/a&gt;, the client version of the test took 525000ms vs 9578ms for embedded, so I disabled the client test for now.  The client test should be analyzed to determine why Clob handling is so slow.   I am not sure if the problem is on the insert, the retrieval or both.  Once this issue is resolved it would be good to enable the test for client.  &lt;/p&gt;

</description>
                <environment></environment>
        <key id="12401696">DERBY-3818</key>
            <summary>client Insert/retrieval of 18MB  Clob is extremely slow  in MultiByteClobTest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Aug 2008 13:43:52 +0100</created>
                <updated>Tue, 30 Jun 2009 17:02:42 +0100</updated>
                            <resolved>Thu, 30 Oct 2008 10:13:14 +0000</resolved>
                                    <version>10.5.1.1</version>
                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>JDBC</component>
                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12619937" author="kristwaa" created="Tue, 5 Aug 2008 17:02:25 +0100"  >&lt;p&gt;Insert performance is acceptable.&lt;/p&gt;

&lt;p&gt;The problem is the select. We fetch the Clob piece by piece. Again we&apos;re hit by the problem I tried to solve with &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3769&quot; title=&quot;Make LOBStoredProcedure on the server side smarter about the read buffer size&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3769&quot;&gt;&lt;del&gt;DERBY-3769&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
The limit for what we can transfer in one go is not 32672 characters, it seems to be 32672 bytes. So Derby ends up advancing the stream too far, and has to reset the stream and skip the data until correctly positioned again. Probably we obtain a substring of 32672 characters, call String.getBytes(UTF8) and then selects the first 32672 bytes of the resulting byte array. The rest is discarded.&lt;br/&gt;
Data is going over the line as UTF-8.&lt;/p&gt;

&lt;p&gt;The next problem hit is the naive repositioning algorithm, which we cannot avoid by adjusting the buffer size. This is the same issue as for Blob (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3766&quot; title=&quot;EmbedBlob.setPosition is highly ineffective for streams&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3766&quot;&gt;&lt;del&gt;DERBY-3766&lt;/del&gt;&lt;/a&gt;). I&apos;ll log a Jira for this, and maybe upload a patch for review before I go on vacation.&lt;/p&gt;

&lt;p&gt;I haven&apos;t spent a lot of time investigating this, but a simple experiment (with some other unfinished code as well) brought the time on my machine down to 60 seconds, running both the embedded and the client suite.&lt;/p&gt;</comment>
                            <comment id="12643507" author="kristwaa" created="Wed, 29 Oct 2008 14:54:49 +0000"  >&lt;p&gt;Patch 1a enables the client test.&lt;/p&gt;

&lt;p&gt;The poor performance has been resolved by other patches, most probably &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3825&quot; title=&quot;StoreStreamClob.getReader(charPos) performs poorly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3825&quot;&gt;&lt;del&gt;DERBY-3825&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3769&quot; title=&quot;Make LOBStoredProcedure on the server side smarter about the read buffer size&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3769&quot;&gt;&lt;del&gt;DERBY-3769&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
For me, MultiByteClobTest takes a little less than 1 minute with embedded only and around 2 minutes with both embedded and client tests.&lt;br/&gt;
I plan to commit the patch tomorrow.&lt;/p&gt;</comment>
                            <comment id="12643797" author="kristwaa" created="Thu, 30 Oct 2008 10:13:14 +0000"  >&lt;p&gt;Committed patch 1a to trunk with revision 709132.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12392990" name="derby-3818-1a-enable_client_test.diff" size="1058" author="kristwaa" created="Wed, 29 Oct 2008 14:54:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10362"><![CDATA[Performance]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 5 Aug 2008 16:02:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23861</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10422"><![CDATA[High Value Fix]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0uov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38790</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>