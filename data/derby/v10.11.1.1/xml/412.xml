<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:12:39 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-412/DERBY-412.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-412] Connection toString should show type information and  the meaning of the identifier that it prints</title>
                <link>https://issues.apache.org/jira/browse/DERBY-412</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;After the change for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-243&quot; title=&quot;connection toString should uniquely identify the connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-243&quot;&gt;&lt;del&gt;DERBY-243&lt;/del&gt;&lt;/a&gt; the  connection toString() output is  an integer which correspond to SESSIONID.  The output should identify the type and also the meaning of the identifier that it prints.  Perhaps a format that appends the default toString output with the sessionid information as it prints in the derby.log would be more informative.&lt;/p&gt;

&lt;p&gt;org.apache.derby.impl.jdbc.EmbedConnection@efd552 (SESSONID = 2)&lt;/p&gt;


&lt;p&gt;Ultimately this could be expanded to included other diagnostic information e.g&lt;/p&gt;

&lt;p&gt;org.apache.derby.impl.jdbc.EmbedConnection@efd552 (XID = 132), (SESSIONID = 5), (DATABASE = wombat), (DRDAID = NF000001.H324-940125304405039114&lt;/p&gt;
{7}
&lt;p&gt;)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12311787">DERBY-412</key>
            <summary>Connection toString should show type information and  the meaning of the identifier that it prints</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davidvc">David Van Couvering</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Jun 2005 07:53:44 +0100</created>
                <updated>Sat, 1 Jul 2006 08:47:12 +0100</updated>
                            <resolved>Sun, 28 Aug 2005 07:52:22 +0100</resolved>
                                    <version>10.1.1.0</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12314715" author="davidvc" created="Thu, 30 Jun 2005 09:15:18 +0100"  >&lt;p&gt;It only makes sense for me to take this one &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.  Thanks for the format suggestion!&lt;/p&gt;</comment>
                            <comment id="12314717" author="fuzzylogic" created="Thu, 30 Jun 2005 09:22:51 +0100"  >&lt;p&gt;Moving Fix In to 10.2.&lt;/p&gt;</comment>
                            <comment id="12314718" author="kmarsden" created="Thu, 30 Jun 2005 09:25:06 +0100"  >&lt;p&gt;Thanks David. Once you have a  solidified a proposal for the different connection types, can you submit it to the community for vote?&lt;/p&gt;</comment>
                            <comment id="12315613" author="davidvc" created="Wed, 13 Jul 2005 04:14:11 +0100"  >&lt;p&gt;I am planning on using the following format for connection strings.  This addresses only embedded connections.  &lt;/p&gt;

&lt;p&gt;A separate JIRA item (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-293&quot; title=&quot;Correlate client connection with embedded connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-293&quot;&gt;DERBY-293&lt;/a&gt;) addresses network client connections.&lt;/p&gt;

&lt;p&gt;For some background on the different types of connections in Derby, see the comments for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-243&quot; title=&quot;connection toString should uniquely identify the connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-243&quot;&gt;&lt;del&gt;DERBY-243&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here are the message strings I am proposing:&lt;/p&gt;

&lt;p&gt;Physical Connections, Pooled Connections (EmbedConnection, EmbedConnection30,&lt;br/&gt;
 BrokeredConnection, BrokeredConnection30):&lt;br/&gt;
    &amp;lt;classname&amp;gt;@&amp;lt;hashcode&amp;gt; (DATABASE=&amp;lt;dbname&amp;gt;), (SESSID=&amp;lt;sessid&amp;gt;), (DRDAID=&amp;lt;drdaid&amp;gt;), (TXID=&amp;lt;txid&amp;gt;)&lt;/p&gt;

&lt;p&gt;Pooled Connections (EmbedPooledConnection, EmbedXAConnection):&lt;br/&gt;
    &amp;lt;classname&amp;gt;@&amp;lt;hashcode&amp;gt; (ID=&amp;lt;uniqueid&amp;gt;), Physical Connection=&amp;lt;underlying connection string&amp;gt;&lt;/p&gt;

&lt;p&gt;Comments are most welcome&lt;/p&gt;</comment>
                            <comment id="12315626" author="kmarsden" created="Wed, 13 Jul 2005 06:11:01 +0100"  >&lt;p&gt;I think it would be good to have the names  match those that print in the derby.log instead of having a different but similar ones  for Connection toString&lt;/p&gt;

&lt;p&gt;e.g use  XID instead of TXID, SESSIONID instead of SESSID.&lt;/p&gt;
</comment>
                            <comment id="12315947" author="davidvc" created="Sat, 16 Jul 2005 06:53:08 +0100"  >&lt;p&gt;Attached is the patch to resolve this bug.  I adjusted the order of the fields to match the output of the error log, otherwise it is as proposed for the vote.&lt;/p&gt;

&lt;p&gt;derbyall passes with no failures&lt;/p&gt;

&lt;p&gt;svn status output:&lt;br/&gt;
M      java/engine/org/apache/derby/impl/jdbc/EmbedConnection.java&lt;br/&gt;
M      java/engine/org/apache/derby/jdbc/EmbedPooledConnection.java&lt;/p&gt;
</comment>
                            <comment id="12316381" author="kmarsden" created="Fri, 22 Jul 2005 02:50:58 +0100"  >&lt;p&gt;Hi David,&lt;/p&gt;

&lt;p&gt;It seems that Brokered connections print the EmbeddedConnection classname instead of the actual class name (BrokeredConnection30).  Is the format tested? I remember you adding tests for your original change but don&apos;t see test changes in this patch.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;

&lt;p&gt;CODE:&lt;br/&gt;
org.apache.derby.jdbc.EmbeddedXADataSource ds =&lt;br/&gt;
                new org.apache.derby.jdbc.EmbeddedXADataSource();&lt;/p&gt;


&lt;p&gt;            ds.setDatabaseName(&quot;wombat&quot;);&lt;br/&gt;
            ds.setUser(&quot;dbuser1&quot;);&lt;br/&gt;
            ds.setPassword(&quot;******&quot;);&lt;br/&gt;
            XAConnection xaConn = ds.getXAConnection();&lt;br/&gt;
            Connection conn = xaConn.getConnection();&lt;br/&gt;
			System.out.println(&quot;xaConn.toString():&quot; + xaConn.toString());&lt;br/&gt;
			System.out.println(&quot;conn.toString():&quot; + conn.toString());&lt;br/&gt;
			System.out.println(&quot;conn.getClass().getName()&quot; + conn.getClass().getName());&lt;/p&gt;


&lt;p&gt;OUTPUT&lt;/p&gt;

&lt;p&gt;xaConn.toString():org.apache.derby.jdbc.EmbedXAConnection@7866553 (ID = 0), Physical Connection = org.apache.derby.impl.jdbc.EmbedConnection30@25197736 (XID = 19), (SESSIONID = 1), (DATABASE = wombat), (DRDAID = null) &lt;br/&gt;
conn.toString():org.apache.derby.impl.jdbc.EmbedConnection30@25197736 (XID = 19), (SESSIONID = 1), (DATABASE = wombat), (DRDAID = null) &lt;br/&gt;
conn.getClass().getName()org.apache.derby.iapi.jdbc.BrokeredConnection30&lt;/p&gt;
</comment>
                            <comment id="12316388" author="davidvc" created="Fri, 22 Jul 2005 03:40:54 +0100"  >&lt;p&gt;Yes, you are right, the output doesn&apos;t match the agreed upon output.  I still have code in  BrokeredConnection that just prints out the toString() of the connection it wraps. &lt;/p&gt;

&lt;p&gt;Looking at this more closely, however, it is probably useful to know the class of the connection wrapped by BrokeredConnection.    And if we do that, I think it&apos;s important to provide a unique id for each BrokeredConnection instance&lt;/p&gt;

&lt;p&gt;So instead of &lt;/p&gt;

&lt;p&gt;&quot;org.apache.derby.iapi.jdbc.BrokeredConnection30@54322190 (XID = 19), (SESSIONID = 1), (DATABASE = wombat), (DRDAID = null) &quot;&lt;/p&gt;

&lt;p&gt;it should be&lt;/p&gt;

&lt;p&gt;&quot;org.apache.derby.iapi.jdbc.BrokeredConnection30@54322190 (ID=22), Wrapped Connection = org.apache.derby.impl.jdbc.EmbedConnection30@25197736 (XID = 19), (SESSIONID = 1), (DATABASE = wombat), (DRDAID = null) &quot;&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="12316398" author="kmarsden" created="Fri, 22 Jul 2005 04:11:30 +0100"  >&lt;p&gt;What would that ID mean? Would it be the id of the EmbedXAConnection or EmbedPooledConnection  from whence it came or something else?   &lt;br/&gt;
If it is something else, at this point I don&apos;t think I need another ID in my life&lt;/p&gt;

&lt;p&gt;I&apos;m ok with&lt;br/&gt;
&quot;org.apache.derby.iapi.jdbc.BrokeredConnection30@54322190 (XID = 19), (SESSIONID = 1), (DATABASE = wombat), (DRDAID = null) &quot; &lt;/p&gt;
</comment>
                            <comment id="12316405" author="davidvc" created="Fri, 22 Jul 2005 05:26:44 +0100"  >&lt;p&gt;It was supposed to be the id of the Brokered Connection instance.&lt;/p&gt;

&lt;p&gt;If  you don&apos;t feel the need to know the class name of the underlying wrapped connection, that&apos;s fine.  Let&apos;s go with your suggestion and see how it goes, we can always adjust in the future.  I&apos;ll submit a new patch soon.&lt;/p&gt;</comment>
                            <comment id="12316427" author="davidvc" created="Fri, 22 Jul 2005 09:21:28 +0100"  >&lt;p&gt;OK, we have a bit of a problem here.  BrokeredConnection does not have direct access to the SESSIONID, DATABASE, etc., because it does not have access to the LanguageConnectionContext.&lt;/p&gt;

&lt;p&gt;It has a method getRealConnection() that returns a Connection.  I could cast it to EmbedConnection and then use that to get access to the LanguageConnectionContext, but that doesn&apos;t seem right to me.  I think that really BrokeredConnection shouldn&apos;t make any assumptions about the underlying type of the Connection.  So I think it should just print the toString() of the wrapped connection.&lt;/p&gt;

&lt;p&gt;So I&apos;m proposing we go with&lt;/p&gt;

&lt;p&gt;&quot;org.apache.derby.iapi.jdbc.BrokeredConnection30@54322190, Wrapped Connection = org.apache.derby.impl.jdbc.EmbedConnection30@32423513 (XID = 19), (SESSIONID = 1), (DATABASE = wombat), (DRDAID = null)&quot;&lt;/p&gt;

&lt;p&gt;Any objections?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;David&lt;/p&gt;</comment>
                            <comment id="12316433" author="kmarsden" created="Fri, 22 Jul 2005 10:04:36 +0100"  >&lt;p&gt;I think it is fine if it prints the class name of the underlying wrapped connection or doesn&apos;t but think the hashcode is good enough as an instance identifier and is pretty self documenting as such. It is great you added  in the XID, DATABASE, DRDAID  etc.  That information will be really useful.&lt;/p&gt;</comment>
                            <comment id="12317110" author="davidvc" created="Fri, 29 Jul 2005 03:55:11 +0100"  >&lt;p&gt;This patch contains the changes based on Kathey&apos;s feedback.  In particular, I fixed BrokeredConnection.  I also verify that the format of the connection strings is correct in the test code.&lt;/p&gt;

&lt;p&gt;derbyall passes all tests&lt;/p&gt;

&lt;p&gt;svn status output:&lt;/p&gt;

&lt;p&gt;M      java\engine\org\apache\derby\impl\jdbc\EmbedConnection.java&lt;br/&gt;
M      java\engine\org\apache\derby\iapi\jdbc\BrokeredConnection.java&lt;br/&gt;
M      java\engine\org\apache\derby\jdbc\EmbedPooledConnection.java&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\jdbcapi\build.xml&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\jdbcapi\checkDataSource.java&lt;/p&gt;</comment>
                            <comment id="12320305" author="naka" created="Sun, 28 Aug 2005 07:52:22 +0100"  >&lt;p&gt;Patch was commited to trunk ,where developping 10.2.0.0 .&lt;/p&gt;</comment>
                            <comment id="12418746" author="kmarsden" created="Sat, 1 Jul 2006 08:47:12 +0100"  >&lt;p&gt;Thanks David for the great embedded fix.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-293&quot; title=&quot;Correlate client connection with embedded connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-293&quot;&gt;DERBY-293&lt;/a&gt; has been filed for the client correlation.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 30 Jun 2005 08:15:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29534</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy160v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40626</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>