<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:38:48 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2103/DERBY-2103.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2103] After a Lexical Error due to syntax error ,    even a simple create table does not work  on the same connection.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2103</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;connect &apos;jdbc:derby:wombat;create=true&apos;;&lt;br/&gt;
create table t1(a int ) ;&lt;br/&gt;
create table &quot;t2&quot;(a int ) ;&lt;br/&gt;
&amp;#8211; this should fail. &lt;br/&gt;
create table foo (a int ,  \&quot;YEAR\&quot; int ) ;&lt;br/&gt;
&amp;#8211; but this should not fail. But failing&lt;br/&gt;
create table t4 ( b int ) ;&lt;/p&gt;

&lt;p&gt;FYI:&lt;br/&gt;
$ java org.apache.derby.tools.ij&lt;br/&gt;
ij version 10.3&lt;br/&gt;
ij&amp;gt; run &apos;weird1.sql&apos;;&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby:wombat;create=true&apos;;&lt;br/&gt;
ij&amp;gt; create table t1(a int ) ;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; create table &quot;t2&quot;(a int ) ;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; &amp;#8211; this should fail.&lt;br/&gt;
create table foo (a int ,  \&quot;YEAR\&quot; int ) ;&lt;br/&gt;
ERROR 42X02: Lexical error at line 2, column 28.  Encountered: &quot;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&quot; (92), after&lt;br/&gt;
: &quot;&quot;.&lt;br/&gt;
ij&amp;gt; &amp;#8211; but this should not fail. But failing&lt;br/&gt;
create table t4 ( b int ) ;&lt;br/&gt;
ERROR 42X01: Syntax error: Encountered &quot;&quot; at line 2, column 21.&lt;br/&gt;
ij&amp;gt;&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12356222">DERBY-2103</key>
            <summary>After a Lexical Error due to syntax error ,    even a simple create table does not work  on the same connection.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mayureshnirhali">Mayuresh Nirhali</assignee>
                                    <reporter username="tsuresh">Suresh Thalamati</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Nov 2006 00:02:02 +0000</created>
                <updated>Fri, 21 Jan 2011 17:49:29 +0000</updated>
                            <resolved>Wed, 24 Jan 2007 08:13:25 +0000</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.2.2.1</fixVersion>
                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12465138" author="mayureshnirhali" created="Tue, 16 Jan 2007 12:04:06 +0000"  >&lt;p&gt;After some investigation, I found that, when the expected error happens, lookingAhead flag in SQLParser implementation is true and due  to the exception this flag is not cleared. The parser object is cached and later used by the next parsing activity. Following code demonstrates the scenario.&lt;/p&gt;

&lt;p&gt;  final private boolean jj_3_12() &lt;/p&gt;
{
    Token xsp;
    xsp = jj_scanpos;
    lookingAhead = true;
    jj_semLA = getToken(3).kind != LARGE;   // ------- The exception happens in this call   
    lookingAhead = false;                                    // ------- This is not called due to the exception.
    if (!jj_semLA || jj_3R_60()) return true;
    if (jj_3R_61()) return true;
    return false;
  }

&lt;p&gt;The simple fix could be to wrap the lookingAhead assignment  after the call within finally block.&lt;br/&gt;
then, the same method would look like below,&lt;/p&gt;

&lt;p&gt;    lookingAhead = true;&lt;br/&gt;
    try &lt;/p&gt;
{ jj_semLA = getToken(3).kind != LARGE; }
&lt;p&gt;    finally &lt;/p&gt;
{ lookingAhead = false; }

&lt;p&gt;I tried this and this has fixed the testcase.&lt;br/&gt;
Now, my concern is that, there are many such methods in SQLParser implementation.For the fix to be complete and to be able to avoid future issues due to same problem, all methods which should change needs to identified.&lt;br/&gt;
While, I am trying to do the same, I would really appreciate any inputs in this regard.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Mayuresh&lt;/p&gt;</comment>
                            <comment id="12465141" author="mayureshnirhali" created="Tue, 16 Jan 2007 12:07:42 +0000"  >&lt;p&gt;derbyall testrun just finished with the proposed fix and it did not show any new failures.&lt;/p&gt;

&lt;p&gt;Mayuresh&lt;/p&gt;</comment>
                            <comment id="12465742" author="mayureshnirhali" created="Thu, 18 Jan 2007 12:34:33 +0000"  >&lt;p&gt;I figured that there is a better way to fix this issue by cleaning up the cachedParser object, (only) in case of Exception. This ensures that for subsequent compilation a clean Parser object is populated. This approach does not touch the sql grammer code. The bug is a side affect of caching the parser for the subsequent compilations and hence it makes sense to fix that in the SqlParserImpl instead of changes to grammer.&lt;/p&gt;

&lt;p&gt;Derbyall runs fine without any errors... This patch is ready for review.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="12465783" author="mayureshnirhali" created="Thu, 18 Jan 2007 15:32:01 +0000"  >&lt;p&gt;uploading a new patch with comments for the code change. &lt;br/&gt;
please review derby2103_v2.diff&lt;/p&gt;</comment>
                            <comment id="12465784" author="mayureshnirhali" created="Thu, 18 Jan 2007 15:32:44 +0000"  >&lt;p&gt;had removed 10.3 in Fix Version field by mistake.&lt;/p&gt;</comment>
                            <comment id="12465942" author="dagw" created="Fri, 19 Jan 2007 02:13:48 +0000"  >&lt;p&gt;I looked at this, the fix will work, but it seems to me this might&lt;br/&gt;
be an bug in JavaCC and should be fixed there; why isn&apos;t this &lt;br/&gt;
state flag reset by the (generated) ReInit method(s)? &lt;br/&gt;
I didn&apos;t find any issue in JavaCC&apos;s bug database and &lt;br/&gt;
I also looked at the source of JavaCC and it is never generates a&lt;br/&gt;
reset on reinitialization; so it might be worth raising the issue with&lt;br/&gt;
the JavaCC folks..&lt;/p&gt;

</comment>
                            <comment id="12465948" author="mayureshnirhali" created="Fri, 19 Jan 2007 03:17:48 +0000"  >&lt;p&gt;Thanks Dag!&lt;/p&gt;

&lt;p&gt;I have raised this with javacc (issue-152).&lt;br/&gt;
So, does it make sense to treat this as a workaround or should we wait for javacc team to respond ??&lt;/p&gt;

&lt;p&gt;I believe, the cost of committing this workaround (temporarily) is that in case of exceptions the parser object will be populated again, and this is a small performance hit compared to the performance if the bug is fixed in javacc itself.&lt;/p&gt;</comment>
                            <comment id="12466049" author="dagw" created="Fri, 19 Jan 2007 13:49:59 +0000"  >&lt;p&gt;I agree this is a good workaround. Might be good to&lt;br/&gt;
update the patch comment with this new info so it can be&lt;br/&gt;
removed if/when this is fixed in JavaCC. If they accept&lt;br/&gt;
issue-152, you might want to make a new JIRA to track a &lt;br/&gt;
cleanup.&lt;/p&gt;</comment>
                            <comment id="12466685" author="mayureshnirhali" created="Tue, 23 Jan 2007 09:50:02 +0000"  >&lt;p&gt;I have attached version 3 of this patch modifying comments.&lt;br/&gt;
The comments now clarify that this is a workaround and the issue has been raised with javacc team.&lt;/p&gt;

&lt;p&gt;I will monitor the javacc-152 issue and depending on their analysis, I will file a bug to remove this workaround, as Dag suggested. Thanks dag for your expert comments on this.&lt;/p&gt;</comment>
                            <comment id="12466730" author="kristwaa" created="Tue, 23 Jan 2007 12:40:36 +0000"  >&lt;p&gt;New revision of the patch looks good. I will commit this after my test-run has completed.&lt;/p&gt;</comment>
                            <comment id="12466943" author="kristwaa" created="Wed, 24 Jan 2007 08:13:25 +0000"  >&lt;p&gt;Committed &apos;Derby2103_v3.diff &apos; to trunk with revision 499299.&lt;br/&gt;
Merged fix to 10.2 (svn merge -c 499299 .) with revision 499304.&lt;/p&gt;</comment>
                            <comment id="12559880" author="kristwaa" created="Thu, 17 Jan 2008 10:02:27 +0000"  >&lt;p&gt;The javacc-152 issue has been fixed, and is marked for inclusion in the 4.1 milestone.&lt;br/&gt;
I do not know the planned release date, but we should keep our eyes open and consider upgrading JavaCC when the update is out.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12349430" name="Derby2103_v3.diff" size="948" author="mayureshnirhali" created="Tue, 23 Jan 2007 09:50:02 +0000"/>
                            <attachment id="12349160" name="derby2103.diff" size="486" author="mayureshnirhali" created="Thu, 18 Jan 2007 12:30:26 +0000"/>
                            <attachment id="12349183" name="derby2103_v2.diff" size="865" author="mayureshnirhali" created="Thu, 18 Jan 2007 15:31:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 16 Jan 2007 12:04:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22887</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0muv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37521</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>