<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:46:55 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5311/DERBY-5311.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5311] Convert tools/ij4.sql  to junit</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5311</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description></description>
                <environment></environment>
        <key id="12512720">DERBY-5311</key>
            <summary>Convert tools/ij4.sql  to junit</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12511998">DERBY-5302</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="houxzhang">Houx Zhang</assignee>
                                    <reporter username="houxzhang">Houx Zhang</reporter>
                        <labels>
                            <label>gsoc2011</label>
                    </labels>
                <created>Mon, 4 Jul 2011 14:57:28 +0100</created>
                <updated>Tue, 12 Jul 2011 13:41:27 +0100</updated>
                            <resolved>Tue, 12 Jul 2011 02:23:33 +0100</resolved>
                                                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13059446" author="houxzhang" created="Mon, 4 Jul 2011 15:03:06 +0100"  >&lt;p&gt;I have removed &lt;/p&gt;

&lt;p&gt;&apos;connect &apos;jdbc:derby:wombat;create=true&apos;;&apos;&lt;/p&gt;

&lt;p&gt;in ij4.sql. As for a subclass of ScriptTestCase,  a default database(wombat) will be connected, so maybe this line is redundant.&lt;/p&gt;

&lt;p&gt;Wish for your opinion.&lt;/p&gt;</comment>
                            <comment id="13059491" author="bryanpendleton" created="Mon, 4 Jul 2011 16:54:14 +0100"  >&lt;p&gt;The patch looks simple and clean to me. In my environment, both tests.tools._Suite and derbytools&lt;br/&gt;
run successfully with the patch applied, with ij4 moved successfully to the former from&lt;br/&gt;
the latter. I am intending to commit this patch.&lt;/p&gt;</comment>
                            <comment id="13059844" author="knutanders" created="Tue, 5 Jul 2011 12:30:21 +0100"  >&lt;p&gt;The patch looks fine to me too. By the way, why was a SecurityManagerSetup needed in this test?&lt;/p&gt;

&lt;p&gt;I don&apos;t know, but it doesn&apos;t look like the original test was meant to test ij.showNoConnectionsAtStart and ij.showNoCountForSelect specifically. Perhaps we could just skip setting those properties? Then we could add ij4 directly to one of the arrays in ToolScripts and remove the ij4Test class. Might be a useful simplification while we&apos;re in there.&lt;/p&gt;

&lt;p&gt;I don&apos;t see anything in the test that won&apos;t run on Java ME (except the original connect command, which was removed by the patch), so I think it would be safe to remove the check for JDBC.vmSupportsJSR169() and enable the test on Java ME now.&lt;/p&gt;</comment>
                            <comment id="13059905" author="bryanpendleton" created="Tue, 5 Jul 2011 14:55:41 +0100"  >&lt;p&gt;I committed the initial patch prior to seeing the comments by Knut Anders. Trunk revision 1143062.&lt;/p&gt;

&lt;p&gt;I haven&apos;t marked the issue resolved yet, since I think we&apos;d like to consider the feedback some more first.&lt;/p&gt;</comment>
                            <comment id="13059915" author="bryanpendleton" created="Tue, 5 Jul 2011 15:10:14 +0100"  >&lt;p&gt;If I remove the noSecurityManager() call, the test fails with &lt;/p&gt;

&lt;p&gt; ij4(org.apache.derbyTesting.functionTests.tests.tools.ij4Test)junit.framework.AssertionFailedError: More output from test than expected&lt;/p&gt;

&lt;p&gt;However, if I remove the system properties and the JSR 169&lt;br/&gt;
code, the test still passes as expected. I&apos;ve attached the&lt;br/&gt;
diff as 5311-followup.txt.&lt;/p&gt;

&lt;p&gt;I like the idea of using ToolsScripts.java directly; Houx,&lt;br/&gt;
what do you think about that approach?&lt;/p&gt;</comment>
                            <comment id="13059945" author="knutanders" created="Tue, 5 Jul 2011 16:10:14 +0100"  >&lt;p&gt;The failure with security manager enabled looks like a bug. ij&apos;s exit command attempts to read the system property ij.expect, but it doesn&apos;t do so in a privileged block. The attached patch makes it use a helper method that does the required security manager magic. Both tools._Suite and derbytools ran cleanly with the patch, so I took the chance and committed it (revision 1143093).&lt;/p&gt;</comment>
                            <comment id="13059975" author="knutanders" created="Tue, 5 Jul 2011 17:03:00 +0100"  >&lt;p&gt;The tinderbox had three failures in the i18n tests after the test was converted:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/tinderbox_trunk16/jvm1.6/testing/testlog/SunOS-5.10_i86pc-i386/1143066-org.apache.derbyTesting.functionTests.suites.All_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/tinderbox_trunk16/jvm1.6/testing/testlog/SunOS-5.10_i86pc-i386/1143066-org.apache.derbyTesting.functionTests.suites.All_diff.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Maybe the maximumdisplaywidth setting must be reset before we continue with the other tests?&lt;/p&gt;</comment>
                            <comment id="13060226" author="bryanpendleton" created="Wed, 6 Jul 2011 02:14:29 +0100"  >&lt;p&gt;Thanks for tracking down the security manager issue with ij&apos;s exit command! I verified that, with the latest trunk, I no longer need the security manager test setup, and have attached the resulting patch to ij4Test.java as noSecMgr.txt.&lt;/p&gt;

&lt;p&gt;Regarding the maximumdisplaywidth issue, it seems certainly cleaner to reset it at the end of the test. I attached a simple &apos;resetWidth.txt&apos; patch which resets the max width to 128 at the end of the test. I&apos;m not sure I have the appropriate test setup to verify whether that fixes the problem seen in the full test suite or not.&lt;/p&gt;</comment>
                            <comment id="13060445" author="knutanders" created="Wed, 6 Jul 2011 10:35:12 +0100"  >&lt;p&gt;I added ij4Test to i18n._Suite before the other tests in the suite, and then I could reproduce the failures by running only that suite. resetWidth.txt fixed the failures, so +1 to that patch. (The maximumdisplaywidth command affecting all ij sessions in the JVM might perhaps be considered a bug, but fixing that is outside the scope of this JIRA.)&lt;/p&gt;

&lt;p&gt;The noSecMgr.txt patch also looks like an improvement. Since there&apos;s no special setup in ij4Test after those changes, I don&apos;t think there&apos;s anything stopping us from adding it to ToolScripts and removing the ij4Test class. Hopefully the same could be done with the other ij*.sql tests.&lt;/p&gt;</comment>
                            <comment id="13060569" author="houxzhang" created="Wed, 6 Jul 2011 14:27:45 +0100"  >&lt;p&gt;Hi, thanks for your wonderful work, Bryan and Knut.&lt;/p&gt;

&lt;p&gt;I also prefer to add new tests by modifying ToolScripts.java, and hope it does work for ij*.sqls.&lt;/p&gt;

&lt;p&gt;In 5311-2.patch, ij4.sql is added into ToolScripts.java, and maximumdisplaywidth reseting is adopted.&lt;/p&gt;

&lt;p&gt;Please check the new patch, thanks!&lt;/p&gt;</comment>
                            <comment id="13060586" author="bryanpendleton" created="Wed, 6 Jul 2011 14:57:12 +0100"  >&lt;p&gt;The new patch looks great to me, and the tools suite runs fine on my configuration with the new patch.&lt;/p&gt;

&lt;p&gt;Committed to the trunk as revision 1143416.&lt;/p&gt;

&lt;p&gt;I haven&apos;t marked this issue as resolved yet, because I&apos;d like to see that we are getting clean runs&lt;br/&gt;
of the complete suites in the master test configurations, first.&lt;/p&gt;</comment>
                            <comment id="13062846" author="bryanpendleton" created="Mon, 11 Jul 2011 04:37:33 +0100"  >&lt;p&gt;I think we could resolve this issue now, does that sound good?&lt;/p&gt;</comment>
                            <comment id="13063645" author="bryanpendleton" created="Tue, 12 Jul 2011 02:23:33 +0100"  >&lt;p&gt;Marking as resolved, since no additional problems appear to have arisen.&lt;/p&gt;</comment>
                            <comment id="13063855" author="houxzhang" created="Tue, 12 Jul 2011 13:41:27 +0100"  >&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12485147" name="5311-1.patch" size="6850" author="houxzhang" created="Mon, 4 Jul 2011 15:03:06 +0100"/>
                            <attachment id="12485148" name="5311-1.stat" size="498" author="houxzhang" created="Mon, 4 Jul 2011 15:03:06 +0100"/>
                            <attachment id="12485420" name="5311-2.patch" size="6042" author="houxzhang" created="Wed, 6 Jul 2011 14:27:45 +0100"/>
                            <attachment id="12485421" name="5311-2.stat" size="411" author="houxzhang" created="Wed, 6 Jul 2011 14:27:45 +0100"/>
                            <attachment id="12485281" name="5311-followup.txt" size="1574" author="bryanpendleton" created="Tue, 5 Jul 2011 15:10:14 +0100"/>
                            <attachment id="12485355" name="noSecMgr.txt" size="1632" author="bryanpendleton" created="Wed, 6 Jul 2011 02:14:29 +0100"/>
                            <attachment id="12485356" name="resetWidth.txt" size="2080" author="bryanpendleton" created="Wed, 6 Jul 2011 02:14:29 +0100"/>
                            <attachment id="12485291" name="sysprop.diff" size="727" author="knutanders" created="Tue, 5 Jul 2011 16:10:14 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 4 Jul 2011 15:54:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31596</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0fp3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36361</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>