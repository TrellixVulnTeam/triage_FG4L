<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:10:45 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4624/DERBY-4624.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4624] Broken logic for avoiding testing across midnight in TimestampArithTest</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4624</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;TimestampArithTest&apos;s decorator has this code to avoid failures in case the test starts close to midnight:&lt;/p&gt;

&lt;p&gt;				/*&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Make sure that we are not so close to midnight that TODAY&lt;/li&gt;
	&lt;li&gt;might be yesterday before we are finished using it.&lt;br/&gt;
				 */&lt;br/&gt;
				while (calendar.get(Calendar.HOUR) == 23&lt;br/&gt;
						&amp;amp;&amp;amp; calendar.get(Calendar.MINUTE) &amp;gt;= 58) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {					try {
						Thread.sleep((60 - calendar.get(Calendar.SECOND)) * 1000);
					} catch (InterruptedException ie) {
						// ignore it
					}				}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;There are at least three problems with this code:&lt;/p&gt;

&lt;p&gt;1) (calendar.get(Calendar.HOUR) == 23) never evaluates to true, because calendar.get(Calendar.HOUR) returns values in the range 0-11. Calendar.HOUR_OF_DAY should be used instead.&lt;/p&gt;

&lt;p&gt;2) If the current time is after 23:58 and before 23:59, the code sleeps until 23:59, the test will wait until 23:59 before it starts, making it even more likely that it will cross midnight while running.&lt;/p&gt;

&lt;p&gt;3) The code is executed after the Calendar object has been initialized, so if this code is ever triggered and waits until after midnight, the TODAY field is guaranteed to be yesterday when the test starts executing.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12462634">DERBY-4624</key>
            <summary>Broken logic for avoiding testing across midnight in TimestampArithTest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Apr 2010 11:30:55 +0100</created>
                <updated>Mon, 29 Nov 2010 14:21:24 +0000</updated>
                            <resolved>Wed, 19 May 2010 08:57:41 +0100</resolved>
                                    <version>10.6.1.0</version>
                                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12867686" author="dagw" created="Fri, 14 May 2010 22:34:53 +0100"  >&lt;p&gt;2): wouldn&apos;t it just loop forever (since no new time instant is instantiated)?&lt;/p&gt;</comment>
                            <comment id="12867704" author="knutanders" created="Fri, 14 May 2010 23:28:27 +0100"  >&lt;p&gt;Good point. I&apos;ve never seen this test fail because it runs across midnight, so perhaps we should just remove the code rather than trying to fix it?&lt;/p&gt;</comment>
                            <comment id="12867995" author="lilywei" created="Sun, 16 May 2010 16:04:41 +0100"  >&lt;p&gt;Will it be okay if we kind of guess the range the test will run and just check the time frame in that range? Will that be a valid test to know most of the validation is accurate?&lt;/p&gt;</comment>
                            <comment id="12868638" author="knutanders" created="Tue, 18 May 2010 14:24:07 +0100"  >&lt;p&gt;Possibly... But when looking at the test again, I don&apos;t really see why this code is needed. We get the Calendar object once and do arithmetic on it, but we never use the current time to verify the values. So I don&apos;t see how crossing midnight while running the test will cause any harm.&lt;/p&gt;</comment>
                            <comment id="12868654" author="knutanders" created="Tue, 18 May 2010 15:12:23 +0100"  >&lt;p&gt;The Calendar object is actually only used to initialize some unused fields, so I think removing it along with the dead code is the simplest and best resolution to this issue. The attached patch removes the Calendar object, the broken midnight check that uses the Calendar, and the unused fields ONE_BILLION, TODAY, TOMORROW, YEAR_FROM_TOMORROW, YEAR_FROM_TODAY, YESTERDAY and WEEK_FROM_TODAY, as well as the method isoFormatDate() that&apos;s only used to initialize the unused fields.&lt;/p&gt;</comment>
                            <comment id="12869053" author="knutanders" created="Wed, 19 May 2010 08:57:41 +0100"  >&lt;p&gt;Committed revision 946079.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12444794" name="remove_calendar.diff" size="3032" author="knutanders" created="Tue, 18 May 2010 15:12:23 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 14 May 2010 21:34:53 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24375</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ouf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37843</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>