<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:13:41 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2047/DERBY-2047.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2047] TestDataSourceFactory doesn&apos;t work correctly outside the old harness</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2047</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;TestDataSourceFactory uses TestUtil to create DataSource, ConnectionPoolDataSource and XADataSource objects. TestUtil needs to run in the old harness in order to detect which framework it is running under, so it will create embedded data sources for all JUnit tests that are run outside the old harness.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12354767">DERBY-2047</key>
            <summary>TestDataSourceFactory doesn&apos;t work correctly outside the old harness</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="djd">Daniel John Debrunner</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Sat, 4 Nov 2006 17:59:36 +0000</created>
                <updated>Fri, 16 Feb 2007 13:26:49 +0000</updated>
                            <resolved>Fri, 10 Nov 2006 15:29:15 +0000</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12447182" author="knutanders" created="Sat, 4 Nov 2006 20:10:18 +0000"  >&lt;p&gt;The attached patch (derby-2047.diff) makes TestDataSourceFactory&lt;br/&gt;
independent of TestUtil. Description of the patch:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Two new methods in JDBCClient: getConnectionPoolDataSourceClassName()&lt;br/&gt;
    and getXADataSourceClassName()&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;JDBCClient now returns correct class names for JDBC 4.0 data sources&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;TestDataSourceFactory uses the methods in JDBCClient instead of&lt;br/&gt;
    TestUtil to create data sources.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;The methods in TestDataSourceFactory now throw exceptions&lt;br/&gt;
    (ClassNotFoundException, IllegalAccessException, etc.) instead of&lt;br/&gt;
    printing them.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Since TestConfiguration.getConnection() uses data sources in some&lt;br/&gt;
    setups, it had to be modified to handle the new exceptions thrown by&lt;br/&gt;
    TestDataSourceFactory.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;The following tests (all part of the jdbc4 test suite) used&lt;br/&gt;
    TestDataSourceFactory and needed to handle the new exceptions:&lt;br/&gt;
    ClosedObjectTest, VerifySignatures, StatementEventsTest, XA40Test,&lt;br/&gt;
    DataSourceTest, DataSourceTest.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I have run the full JUnit suite and the jdbc40 suite under the embedded and&lt;br/&gt;
DerbyNet frameworks and didn&apos;t see any problem related to the patch. Please&lt;br/&gt;
review. Thanks.&lt;/p&gt;</comment>
                            <comment id="12447211" author="djd" created="Sun, 5 Nov 2006 01:17:45 +0000"  >&lt;p&gt;I was also working on this issue under &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2043&quot; title=&quot;NIST suite run as a Junit test fails on J2ME with WCTME 5.7&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2043&quot;&gt;&lt;del&gt;DERBY-2043&lt;/del&gt;&lt;/a&gt; taking a slightly different approach and not getting as far as Knut.&lt;/p&gt;

&lt;p&gt;I was moving the DataSource methods over to the jutil package as this is very much part of that package and extends beyond functional tests.&lt;/p&gt;

&lt;p&gt;The other differences in approach were driving the data source bean properties from the TestConfiguration  and using a HashMap to define the data source properties, not a Properites object. This then allowed the caller to specifiy the type of the bean by passing an object of the correct type, rather than having the bean types hard coded at the low level generic code.&lt;/p&gt;

&lt;p&gt;Attached is a DataSource class, very much a work in progress and untested, e.g. null is passed for the data source name as I hadn&apos;t got around to setting it, just wanted the code to compile.&lt;/p&gt;</comment>
                            <comment id="12447484" author="knutanders" created="Mon, 6 Nov 2006 17:57:16 +0000"  >&lt;p&gt;Thanks Dan, I hadn&apos;t noticed your comment about this problem under &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2043&quot; title=&quot;NIST suite run as a Junit test fails on J2ME with WCTME 5.7&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2043&quot;&gt;&lt;del&gt;DERBY-2043&lt;/del&gt;&lt;/a&gt;. Your approach sounds cleaner to me. Feel free to take over the issue and continue as you had planned.&lt;/p&gt;

&lt;p&gt;There is at least one problem with my patch. JDBCClient.getDataSourceClassName() doesn&apos;t return the correct name for JSR169, so BaseJDBCTestCase.getConnection() won&apos;t work under JSR169. Should be easy to fix, though. I think the changes I made to JDBCClient will be useful for your approach too.&lt;/p&gt;</comment>
                            <comment id="12447491" author="djd" created="Mon, 6 Nov 2006 18:15:28 +0000"  >&lt;p&gt;Thanks Knut, I&apos;ll look at combinging the code.&lt;/p&gt;</comment>
                            <comment id="12447882" author="djd" created="Tue, 7 Nov 2006 18:25:43 +0000"  >&lt;p&gt;Committed revision 472187 makes some initial changes for regular DataSource and embedded.&lt;br/&gt;
I hit return too quikcly on the commit and so missed giving credit to Knut Anders Hatlen for the changes to JDBCClient.&lt;/p&gt;</comment>
                            <comment id="12448383" author="knutanders" created="Thu, 9 Nov 2006 07:29:45 +0000"  >&lt;p&gt;It seems like the 472187 and/or 472228 commit broke a couple of tests in the old harness:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;
			&lt;ul&gt;
				&lt;li&gt;
				&lt;ul&gt;
					&lt;li&gt;
					&lt;ul&gt;
						&lt;li&gt;
						&lt;ul&gt;
							&lt;li&gt;
							&lt;ul&gt;
								&lt;li&gt;
								&lt;ul&gt;
									&lt;li&gt;Diff file derbyall/derbynetclientmats/DerbyNetClient/derbynetmats/derbynetmats/ShutDownDBWhenNSShutsDownTest.diff&lt;/li&gt;
								&lt;/ul&gt;
								&lt;/li&gt;
							&lt;/ul&gt;
							&lt;/li&gt;
						&lt;/ul&gt;
						&lt;/li&gt;
					&lt;/ul&gt;
					&lt;/li&gt;
				&lt;/ul&gt;
				&lt;/li&gt;
			&lt;/ul&gt;
			&lt;/li&gt;
			&lt;li&gt;Start: ShutDownDBWhenNSShutsDownTest jdk1.6.0-rc DerbyNetClient derbynetmats:derbynetmats 2006-11-09 04:35:03 ***&lt;br/&gt;
0 add&lt;br/&gt;
&amp;gt; .F.&lt;br/&gt;
&amp;gt; There was 1 failure:&lt;br/&gt;
&amp;gt; 1) testEngineShutdownDoesNotTakeDownNS(org.apache.derbyTesting.functionTests.tests.derbynet.ShutDownDBWhenNSShutsDownTest)junit.framework.ComparisonFailure: Engine shutdown expected:&amp;lt;XJ0&lt;span class=&quot;error&quot;&gt;&amp;#91;15&amp;#93;&lt;/span&gt;&amp;gt; but was:&amp;lt;XJ0&lt;span class=&quot;error&quot;&gt;&amp;#91;28&amp;#93;&lt;/span&gt;&amp;gt;&lt;br/&gt;
&amp;gt; FAILURES!!!&lt;br/&gt;
&amp;gt; Tests run: 2,  Failures: 1,  Errors: 0&lt;br/&gt;
Test Failed.&lt;/li&gt;
			&lt;li&gt;End:   ShutDownDBWhenNSShutsDownTest jdk1.6.0-rc DerbyNetClient derbynetmats:derbynetmats 2006-11-09 04:35:15 ***&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;
			&lt;ul&gt;
				&lt;li&gt;
				&lt;ul&gt;
					&lt;li&gt;
					&lt;ul&gt;
						&lt;li&gt;
						&lt;ul&gt;
							&lt;li&gt;
							&lt;ul&gt;
								&lt;li&gt;
								&lt;ul&gt;
									&lt;li&gt;Diff file derbyall/jdbc40/VerifySignatures.diff&lt;/li&gt;
								&lt;/ul&gt;
								&lt;/li&gt;
							&lt;/ul&gt;
							&lt;/li&gt;
						&lt;/ul&gt;
						&lt;/li&gt;
					&lt;/ul&gt;
					&lt;/li&gt;
				&lt;/ul&gt;
				&lt;/li&gt;
			&lt;/ul&gt;
			&lt;/li&gt;
			&lt;li&gt;Start: VerifySignatures jdk1.6.0-rc derbyall:jdbc40 2006-11-09 04:24:15 ***&lt;br/&gt;
0 add&lt;br/&gt;
&amp;gt; Failed to invoke suite():java.sql.SQLException: Database &apos;wombat&apos; not found.&lt;br/&gt;
Test Failed.&lt;/li&gt;
			&lt;li&gt;End:   VerifySignatures jdk1.6.0-rc derbyall:jdbc40 2006-11-09 04:24:16 ***&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12448776" author="djd" created="Fri, 10 Nov 2006 15:29:15 +0000"  >&lt;p&gt;Committed revision 473366.&lt;br/&gt;
TestDataSourceFactory removed and replaced with J2EEDataSourrce and JDBCDataSource which are&lt;br/&gt;
independent of the old harness.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12344338" name="DataSource.java" size="2244" author="djd" created="Sun, 5 Nov 2006 01:17:45 +0000"/>
                            <attachment id="12344332" name="derby-2047.diff" size="20877" author="knutanders" created="Sat, 4 Nov 2006 20:10:18 +0000"/>
                            <attachment id="12344333" name="derby-2047.stat" size="682" author="knutanders" created="Sat, 4 Nov 2006 20:10:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 5 Nov 2006 01:17:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22851</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy13d3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40195</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>