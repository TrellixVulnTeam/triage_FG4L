<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:31:18 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1846/DERBY-1846.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1846] Create a script that allows users to easily update their Derby jars with the JDBC4 classes.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1846</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Since the resolution of the JDBC 4 licensing issue was to not ship a build that includes Derby&apos;s JDBC 4 code, but continue to ship the Derby source files for them, a script which automatically compiles and updates the Derby jars with the JDBC 4 classes would be useful.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12349857">DERBY-1846</key>
            <summary>Create a script that allows users to easily update their Derby jars with the JDBC4 classes.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fuzzylogic">Andrew McIntyre</assignee>
                                    <reporter username="fuzzylogic">Andrew McIntyre</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Sep 2006 20:25:53 +0100</created>
                <updated>Fri, 8 Aug 2008 15:37:20 +0100</updated>
                            <resolved>Fri, 22 Sep 2006 19:43:53 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Demos/Scripts</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12434526" author="fuzzylogic" created="Wed, 13 Sep 2006 20:27:02 +0100"  >&lt;p&gt;Attaching a patch with a shell script for this. Working on a batch version also, but thought I would go ahead and post the shell script so that people could review it.&lt;/p&gt;</comment>
                            <comment id="12434539" author="davidvc" created="Wed, 13 Sep 2006 21:22:14 +0100"  >&lt;p&gt;Hi, Andrew, thanks for jumping on this!  Is there any reason this isn&apos;t an ant script?  Is it so that users don&apos;t have to download ant?  I&apos;m concerned that not everyone has a shell environment, especially those on Windows.  Are we going to build a .bat version as well?&lt;/p&gt;</comment>
                            <comment id="12434544" author="fuzzylogic" created="Wed, 13 Sep 2006 22:11:51 +0100"  >&lt;p&gt;Yes, so you don&apos;t have to download Ant. I did say that I would build a batch version. It won&apos;t be quite as nice as the shell script, but it will get the job done. E.g. the batch script won&apos;t check that the jvm you are running with is a 1.6 VM, since Windows has no string manipulation /comparison utilities like sed or expr and it won&apos;t do any error checking.&lt;/p&gt;

&lt;p&gt;Almost everyone has a shell (or cmd.exe on windows). If you think an Ant build.xml would also be useful, feel free to put one together.&lt;/p&gt;</comment>
                            <comment id="12434567" author="fuzzylogic" created="Thu, 14 Sep 2006 00:34:08 +0100"  >&lt;p&gt;Updated patch which includes a batch file.&lt;/p&gt;</comment>
                            <comment id="12434568" author="fuzzylogic" created="Thu, 14 Sep 2006 00:35:56 +0100"  >&lt;p&gt;Committed to trunk with revision 443167. Leaving open until merged to 10.2&lt;/p&gt;</comment>
                            <comment id="12435742" author="johnemb" created="Tue, 19 Sep 2006 11:25:06 +0100"  >&lt;p&gt;I tried the &apos;update-with-jdbc4&apos; script on a Solaris box (default shell is bash), and it failed with the message &lt;/p&gt;

&lt;p&gt;&quot;The JVM in $JAVA_HOME is not version 1.6.0&lt;br/&gt;
To use this script to compile the JDBC 4.0 Derby classes,&lt;br/&gt;
you need a 1.6.0 level VM&quot;&lt;/p&gt;

&lt;p&gt;But $JAVA_HOME was indeed set to a JDK 1.6 installation before running the script.&lt;/p&gt;

&lt;p&gt;There seems to be a problem with the following check in the script:&lt;/p&gt;

&lt;p&gt;if [ -z &quot;$JAVA_HOME&quot; ]; then&lt;br/&gt;
  if [ -n &quot;$darwin&quot; ]; then&lt;br/&gt;
    JAVA_HOME=/System/Library/Frameworks/JavaVM.framework/Home&lt;br/&gt;
  fi else if [ -d /usr/j2se -a -x /usr/j2se/bin/javac ]; then&lt;br/&gt;
    JAVA_HOME=/usr/j2se&lt;br/&gt;
  fi&lt;br/&gt;
fi&lt;/p&gt;

&lt;p&gt;I say this because in my environment, JAVA_HOME is always set to /usr/j2se by the script (I added an echo statement to verify this), and since that location contains a JDK 1.4.2 installation, the subsequent version check fails (I later modified the script so that it would echo something if the first condition shown above is true. It did not, meaning that JAVA_HOME was set, but that the script modified it anyway).&lt;/p&gt;

&lt;p&gt;Perhaps an if - elif - fi construct may be more usable in the Bourne shell?&lt;/p&gt;
</comment>
                            <comment id="12435817" author="johnemb" created="Tue, 19 Sep 2006 15:42:51 +0100"  >&lt;p&gt;I have also tried the batch script on a Windows XP box. I found four issues:&lt;/p&gt;

&lt;p&gt;1)&lt;/p&gt;

&lt;p&gt;   Missing @echo off - the output is very messy without it&lt;/p&gt;

&lt;p&gt;2)&lt;/p&gt;

&lt;p&gt;   The cleanup command &quot;@erase /s /q %DERBY_HOME%/jdbc4classes&quot; should use a backslash instead of a forward slash when specifying the jdkc4classes directory. Here is the output I get with 1) fixed:&lt;/p&gt;

&lt;p&gt;   &quot;Building Derby client classes for JDBC 4.0&quot;&lt;br/&gt;
   &quot;Updating c:\programfiler\derby\sandboxes\bin-10.2.1.3\db-derby-10.2.1.3-bin\lib\derbyclient.jar&quot;&lt;br/&gt;
   &quot;Building Derby engine classes for JDBC 4.0&quot;&lt;br/&gt;
   &quot;Updating c:\programfiler\derby\sandboxes\bin-10.2.1.3\db-derby-10.2.1.3-bin\lib\derby.jar&quot;&lt;br/&gt;
   &quot;Cleaning up&quot;&lt;br/&gt;
   Invalid switch - &quot;jdbc4classes&quot;.&lt;br/&gt;
   &quot;Done.&quot;&lt;/p&gt;

&lt;p&gt;3)&lt;/p&gt;

&lt;p&gt;   Double quotes around the echo strings are displayed as-is, as shown above. It looks more professional without them, and it still works (on my machine at least).&lt;/p&gt;

&lt;p&gt;4)&lt;/p&gt;

&lt;p&gt;   The cleanup command mentioned in 2) does not delete the empty directories after deleting the JDBC 4 class files. Perhaps the rmdir command works better?&lt;/p&gt;


&lt;p&gt;I have attached a patch fixing issues 1), 2) and 3), &apos;derby1846-batchFix_v1.diff&apos;, and the resulting output, output_batchFix_v1.txt&lt;/p&gt;

&lt;p&gt;I tested the script by running it from trunk, with DERBY_HOME pointing to a 10.2.1.3-beta installation where I replaced the jars in lib/ with jars from the trunk, without JDBC 4. I looked for org/apache/derby/.../xxx40.class file entries in the derby.jar file (jar tf derby.jar), as a preliminary quick check. I&apos;m sure there are better ways to check whether or not the script was successful...&lt;/p&gt;
</comment>
                            <comment id="12435979" author="fuzzylogic" created="Tue, 19 Sep 2006 20:44:13 +0100"  >&lt;p&gt;Thanks for the review John. I have found several other issues with the scripts as well, and i&apos;ll incorporate your suggested changes when I commit the improvements.&lt;/p&gt;

&lt;p&gt;Currently the scripts don&apos;t produce usable jars because we need to patch up modules.properties to include the JDBC4 driver properties.&lt;/p&gt;</comment>
                            <comment id="12436007" author="fuzzylogic" created="Tue, 19 Sep 2006 22:04:31 +0100"  >&lt;p&gt;Committed vastly improved scripts with revision 447970. Jars updated with these scripts pass the JDBC 4 suite. Main fix was to patch up modules.properties, there are many other improvements to get the scripts to work in Cygwin, MKS, bash/tcsh, etc.&lt;/p&gt;

&lt;p&gt;I&apos;m satisfied with these scripts now, since the jars built with them pass the JDBC 4 suite. Always happy to hear suggestions for further improvements. Also, if anyone has the time to verify on, say, Solaris or Linux, that would be great.&lt;/p&gt;</comment>
                            <comment id="12436025" author="rhillegas" created="Tue, 19 Sep 2006 22:54:56 +0100"  >&lt;p&gt;I tried update-with-jdbc4 on Linux and saw a lot of the following diagnostics as the script looped through the client classes:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;compile the client classes&lt;br/&gt;
echo &quot;Compiling the client classes for JDBC 4.0&quot;&lt;br/&gt;
Compiling the client classes for JDBC 4.0&lt;br/&gt;
for i in `cat client.list`&lt;br/&gt;
do&lt;br/&gt;
  FILE=`echo $i | tr &apos;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&apos; &apos;/&apos; | sed &apos;s/.$//g&apos;`&lt;br/&gt;
  CLASSES=&quot;$FILE $CLASSES&quot;&lt;br/&gt;
done&lt;br/&gt;
cat client.list&lt;br/&gt;
echo $i | tr &apos;\&apos; &apos;/&apos; | sed &apos;s/.$//g&apos;&lt;br/&gt;
tr: invalid backslash escape at end of string&lt;br/&gt;
echo $i | tr &apos;\&apos; &apos;/&apos; | sed &apos;s/.$//g&apos;&lt;br/&gt;
tr: invalid backslash escape at end of string&lt;br/&gt;
echo $i | tr &apos;\&apos; &apos;/&apos; | sed &apos;s/.$//g&apos;&lt;br/&gt;
tr: invalid backslash escape at end of string&lt;br/&gt;
echo $i | tr &apos;\&apos; &apos;/&apos; | sed &apos;s/.$//g&apos;&lt;br/&gt;
tr: invalid backslash escape at end of string&lt;br/&gt;
echo $i | tr &apos;\&apos; &apos;/&apos; | sed &apos;s/.$//g&apos;&lt;br/&gt;
tr: invalid backslash escape at end of string&lt;br/&gt;
echo $i | tr &apos;\&apos; &apos;/&apos; | sed &apos;s/.$//g&apos;&lt;br/&gt;
tr: invalid backslash escape at end of string&lt;br/&gt;
echo $i | tr &apos;\&apos; &apos;/&apos; | sed &apos;s/.$//g&apos;&lt;br/&gt;
tr: invalid backslash escape at end of string&lt;br/&gt;
echo $i | tr &apos;\&apos; &apos;/&apos; | sed &apos;s/.$//g&apos;&lt;br/&gt;
tr: invalid backslash escape at end of string&lt;br/&gt;
echo $i | tr &apos;\&apos; &apos;/&apos; | sed &apos;s/.$//g&apos;&lt;br/&gt;
tr: invalid backslash escape at end of string&lt;br/&gt;
echo $i | tr &apos;\&apos; &apos;/&apos; | sed &apos;s/.$//g&apos;&lt;br/&gt;
tr: invalid backslash escape at end of string&lt;br/&gt;
echo $i | tr &apos;\&apos; &apos;/&apos; | sed &apos;s/.$//g&apos;&lt;br/&gt;
tr: invalid backslash escape at end of string&lt;br/&gt;
echo $i | tr &apos;\&apos; &apos;/&apos; | sed &apos;s/.$//g&apos;&lt;br/&gt;
tr: invalid backslash escape at end of string&lt;br/&gt;
echo $i | tr &apos;\&apos; &apos;/&apos; | sed &apos;s/.$//g&apos;&lt;br/&gt;
tr: invalid backslash escape at end of string&lt;br/&gt;
echo $i | tr &apos;\&apos; &apos;/&apos; | sed &apos;s/.$//g&apos;&lt;br/&gt;
tr: invalid backslash escape at end of string&lt;br/&gt;
echo $i | tr &apos;\&apos; &apos;/&apos; | sed &apos;s/.$//g&apos;&lt;br/&gt;
tr: invalid backslash escape at end of string&lt;br/&gt;
echo $i | tr &apos;\&apos; &apos;/&apos; | sed &apos;s/.$//g&apos;&lt;br/&gt;
tr: invalid backslash escape at end of string&lt;br/&gt;
echo $i | tr &apos;\&apos; &apos;/&apos; | sed &apos;s/.$//g&apos;&lt;br/&gt;
tr: invalid backslash escape at end of string&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="12436027" author="fuzzylogic" created="Tue, 19 Sep 2006 23:05:37 +0100"  >&lt;p&gt;Ah, the joys of making scripts work everywhere. Rick, can you try replacing the &apos;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&apos; in the script with \\\\ and let me know if that fixes your problem?&lt;/p&gt;</comment>
                            <comment id="12436057" author="rhillegas" created="Wed, 20 Sep 2006 00:28:49 +0100"  >&lt;p&gt;Hi Andrew,&lt;/p&gt;

&lt;p&gt;Adding the &apos;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&apos; fixes the build problem on Linux. I&apos;m getting odd results at run-time however. The network version of the jdbc4 suite runs cleanly against the patched jar files. However, I&apos;m getting abstract method errors during the embedded run of the suite. For some reason, the test is picking up EmbedConnection30 as the connection class even though I can see EmbedConnection40 in derby.jar.&lt;/p&gt;</comment>
                            <comment id="12436059" author="fuzzylogic" created="Wed, 20 Sep 2006 00:41:10 +0100"  >&lt;p&gt;org/apache/derby/modules.properties in derby.jar needs to be updated to include the information about the JDBC 4 driver. It sounds like something went wrong with the update. That should be handled by the part of the script starting with &quot;# patch up modules.properties so the driver will load&quot;&lt;/p&gt;

&lt;p&gt;The update is very simple: unpack modules.properties from derby.jar, then cat the needed updates to the end, trimming the line endings as necessary. It then is picked up with the rest of the classes when derby.jar is updated. Can you check and see what happened to modules.properties during the update?&lt;/p&gt;</comment>
                            <comment id="12436367" author="rhillegas" created="Wed, 20 Sep 2006 22:53:02 +0100"  >&lt;p&gt;Hi Andrew,&lt;/p&gt;

&lt;p&gt;I&apos;ve attached the modules.properties from the patched derby.jar which gives rise to the abstract method errors. A further detail: I wrote a test program which verifies the following: If I run with a security manager and the test policy, then I get a 30 connection, but if I run without a security manager, then I get a 40 connection.&lt;/p&gt;</comment>
                            <comment id="12436397" author="fuzzylogic" created="Thu, 21 Sep 2006 00:34:20 +0100"  >&lt;p&gt;The attached modules.properties has not been updated to include the JDBC 4 driver properties. You can try setting the update_jdbc4_debug flag and running the script to see if some sort of error  is occurring that isn&apos;t being reported, or you could comment out the cleanup of the jdbc4classes at the end to inspect the modules.properties that was jarred up. Lastly, make sure that modules.patch in tools/jdbc4 looks correct for the driver properties.&lt;/p&gt;

&lt;p&gt;In the meantime, I&apos;ll see if I can reproduce this on a Linux box of my own. What shell are you using? bash?&lt;/p&gt;</comment>
                            <comment id="12436552" author="johnemb" created="Thu, 21 Sep 2006 16:18:11 +0100"  >&lt;p&gt;I tried the script again (from an updated trunk) on Solaris 10 x86, bash shell (version 3.00.16), and after doing the double-to-quadruple-backslash fix (at two places in the script), I get the following error:&lt;/p&gt;

&lt;p&gt;-------&lt;del&gt;8&amp;gt;&lt;/del&gt;--------------------------------------&lt;br/&gt;
Compiling the client classes for JDBC 4.0&lt;br/&gt;
/home/user/apache/Derby/clean/trunk/java/client/org/apache/derby/client/net/NetConnection.java:43: org.apache.derby.client.net.NetConnection is not abstract and does not override abstract method createStruct(java.lang.String,java.lang.Object[]) in java.sql.Connection&lt;br/&gt;
public class NetConnection extends org.apache.derby.client.am.Connection {&lt;br/&gt;
       ^&lt;br/&gt;
Note: /home/user/apache/Derby/clean/trunk/java/client/org/apache/derby/client/net/NetConnection.java uses unchecked or unsafe operations.&lt;br/&gt;
Note: Recompile with -Xlint:unchecked for details.&lt;br/&gt;
1 error&lt;br/&gt;
There was an error compiling the client classes. Exiting.&lt;br/&gt;
-------&lt;del&gt;8&amp;gt;&lt;/del&gt;--------------------------------------&lt;/p&gt;

&lt;p&gt;Not sure yet what is causing this. Could it be a user error? I hope someone else is able to try it on Solaris as well...&lt;/p&gt;

&lt;p&gt;I also tried the updated batch script on Win XP, and it went fine - at least the jdbc40 suite passes in both Embedded and DerbyNetClient frameworks. The only thing I wanted to comment is that the script started out by reporting &quot;The system cannot find the file specified&quot;, which is caused by trying to remove a %DERBY_HOME%\jdbc4classes directory that does not exist yet. No big deal, its just something that may scare users (unless it is documented properly).&lt;/p&gt;
</comment>
                            <comment id="12436565" author="andreask" created="Thu, 21 Sep 2006 16:55:24 +0100"  >&lt;p&gt;I think the script update-with-jdbc4 as it is now in SVN has a dangling-else problem if JAVA_HOME is set. The scripts sets my JAVA_HOME to /usr/j2se&lt;/p&gt;

&lt;p&gt;After modifying the script from:&lt;br/&gt;
-if [ -z &quot;$JAVA_HOME&quot; ]; then&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if [ -n &quot;$darwin&quot; ]; then&lt;/li&gt;
	&lt;li&gt;JAVA_HOME=/System/Library/Frameworks/JavaVM.framework/Home&lt;/li&gt;
	&lt;li&gt;fi else if [ -d /usr/j2se -a -x /usr/j2se/bin/javac ]; then&lt;/li&gt;
	&lt;li&gt;JAVA_HOME=/usr/j2se&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;to:&lt;/p&gt;

&lt;p&gt;+&lt;br/&gt;
+if [ -n &quot;$JAVA_HOME&quot; ]; then&lt;br/&gt;
+  test&lt;br/&gt;
+else &lt;br/&gt;
+  if [ -n &quot;$darwin&quot; ]; then &lt;br/&gt;
+    JAVA_HOME=/System/Library/Frameworks/JavaVM.framework/Home &lt;br/&gt;
+  else&lt;br/&gt;
+    if [ -d /usr/j2se -a -x /usr/j2se/bin/javac ]; then&lt;br/&gt;
+       JAVA_HOME=/usr/j2se&lt;br/&gt;
+    fi&lt;/p&gt;

&lt;p&gt;I got past this problem. I am not a shell-expert so there is probably a better solution.&lt;/p&gt;</comment>
                            <comment id="12436571" author="fuzzylogic" created="Thu, 21 Sep 2006 17:08:17 +0100"  >&lt;p&gt;John: not sure about this error:&lt;/p&gt;

&lt;p&gt;org.apache.derby.client.net.NetConnection is not abstract and does not override abstract method createStruct(java.lang.String,java.lang.Object[]) in java.sql.Connection&lt;/p&gt;

&lt;p&gt;A compiled version of NetConnection should already be on the classpath, so the compiler should not be trying to recompile it. I saw something similar on Windows, though, which I fixed by expanding the class into the output directory before calling javac. I&apos;ll let you know if I hit this in my Linux testing today.&lt;/p&gt;

&lt;p&gt;Andreas: that should (hopefully) already be fixed in the latest version of the script. let me know if it is not.&lt;/p&gt;</comment>
                            <comment id="12436579" author="johnemb" created="Thu, 21 Sep 2006 17:43:25 +0100"  >&lt;p&gt;The &quot;NetConnection is not abstract&quot; error went away after I recompiled the non-JDBC4 jars (ant clobber;ant all;ant buildjarsclean) and copied them to my $DERBY_HOME/lib (after deleting the old ones). The error was probably caused by me running svn update (getting updates from last night) and forgetting to recompile and rebuild the jars.&lt;/p&gt;

&lt;p&gt;The jdbc40 suite passed in both Embedded and DerbyNetClient frameworks with updated jars (using a derbyTesting.jar with jdbc4 tests included, of course). I must say I admire your scripting skills, Andrew &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12436593" author="fuzzylogic" created="Thu, 21 Sep 2006 19:04:26 +0100"  >&lt;p&gt;Committed fix for issue with tr on Linux with revision 448617. Rick, I couldn&apos;t reproduce the issue with the modules.properties patch that you reported on Linux. Could you please recheck with the latest version of the script and modules.patch?&lt;/p&gt;</comment>
                            <comment id="12436603" author="rhillegas" created="Thu, 21 Sep 2006 19:36:05 +0100"  >&lt;p&gt;Hi Andrew,&lt;/p&gt;

&lt;p&gt;I&apos;m not sure what experiment you want me to run. This is what I did:&lt;/p&gt;

&lt;p&gt;1) I svn updated my Linux workspace in order to get your latest changes to update-with-jdbc4&lt;/p&gt;

&lt;p&gt;2) Then a ran that script&lt;/p&gt;

&lt;p&gt;It failed as follows:&lt;/p&gt;

&lt;p&gt;sungod024 jdbc4 (1.6) &amp;gt; ./update-with-jdbc4&lt;br/&gt;
Compiling the client classes for JDBC 4.0&lt;br/&gt;
/home/rh161140/derby/mainline/trunk/java/client/org/apache/derby/client/net/NetConnection.java:43: org.apache.derby.clie&lt;br/&gt;
nt.net.NetConnection is not abstract and does not override abstract method createStruct(java.lang.String,java.lang.Objec&lt;br/&gt;
t[]) in java.sql.Connection&lt;br/&gt;
public class NetConnection extends org.apache.derby.client.am.Connection {&lt;br/&gt;
       ^&lt;br/&gt;
Note: /home/rh161140/derby/mainline/trunk/java/client/org/apache/derby/client/net/NetConnection.java uses unchecked or u&lt;br/&gt;
nsafe operations.&lt;br/&gt;
Note: Recompile with -Xlint:unchecked for details.&lt;br/&gt;
1 error&lt;br/&gt;
There was an error compiling the client classes. Exiting.&lt;/p&gt;</comment>
                            <comment id="12436604" author="fuzzylogic" created="Thu, 21 Sep 2006 19:40:36 +0100"  >&lt;p&gt;Running the script will do, that&apos;s what we&apos;re trying to get to work.&lt;/p&gt;

&lt;p&gt;As for the error with NetConnection, see note from John, he ran into a similar error after running &apos;svn up&apos; and needed to rebuild his non-JDBC4 jars: &lt;a href=&quot;http://issues.apache.org/jira/browse/DERBY-1846#action_12436579&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/DERBY-1846#action_12436579&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12436608" author="rhillegas" created="Thu, 21 Sep 2006 19:54:50 +0100"  >&lt;p&gt;I&apos;m afraid I don&apos;t understand the workaround. It appears that John regenerated all of the jars from scratch. If we&apos;re going to do that, then why are we writing this script in the first place? Why don&apos;t we just tell the users:&lt;/p&gt;

&lt;p&gt;1) Unzip the source distribution.&lt;/p&gt;

&lt;p&gt;2) Point ant.properties at your JDK 6 installation.&lt;/p&gt;

&lt;p&gt;3) Build Derby.&lt;/p&gt;

&lt;p&gt;4) Viola!&lt;/p&gt;
</comment>
                            <comment id="12436667" author="fuzzylogic" created="Thu, 21 Sep 2006 22:56:21 +0100"  >&lt;p&gt;Sorry, Rick, I&apos;m unable to reproduce the problem you&apos;re seeing. Could you try two things?&lt;/p&gt;

&lt;p&gt;a) remove $DERBY_HOME/jdbc4classes and try again. Maybe something stale from previous attempts is causing a problem.&lt;/p&gt;

&lt;p&gt;b) if that doesn&apos;t work, try with the attached patch which expands NetConnection into the output dir, so that hopefully javac won&apos;t try to recompile it.&lt;/p&gt;</comment>
                            <comment id="12436798" author="andreask" created="Fri, 22 Sep 2006 10:11:27 +0100"  >&lt;p&gt;I have successfully used this script now on solarisx86. My previous test was from the 10.2 branch.&lt;br/&gt;
To test it, I did the following:&lt;br/&gt;
1. Compiled my sources without jdbc4 :ant clobber all buildcleanjars&lt;br/&gt;
2. In my trunk directory, added a softlink: ln -s jars/sane lib (to simulate a distribution)&lt;br/&gt;
3. Set DERBY_HOME to my trunk directory&lt;br/&gt;
4.Set JAVA_HOME to my jdk1.6.0 installation&lt;/p&gt;

&lt;p&gt;Now, I ran the script, and it compiled all the jdbc4 stuff, and added the classes to the jar files.&lt;/p&gt;

&lt;p&gt;I think this script is very useful if we make a binary release of Derby with JDBC4 as source. Then users can compile jdbc4 wihtout downloading java 1.3, java 1.4, ant, and other libraries which are required to compile the Derby engine.&lt;/p&gt;</comment>
                            <comment id="12436871" author="djd" created="Fri, 22 Sep 2006 15:30:10 +0100"  >&lt;p&gt;Does the script compile the test classes? From Andreas&apos;s description I would assume not, since a distribution is not laid out with derbyTesting.jar in lib. Would be good to document if it does or does not  build the JD BC 4 tests in any instructions.&lt;/p&gt;</comment>
                            <comment id="12436945" author="fuzzylogic" created="Fri, 22 Sep 2006 18:52:08 +0100"  >&lt;p&gt;The script does not compile the test classes, an oversight on my part. It would be very simple to add to the scripts, since compiling an entire directory of classes is much simpler than cherry-picking specific files out of a hierarchy. It looks like I might have missed the first candidate, but in case there&apos;s a second rc, i&apos;ll see what I can do to get the test classes compiled in.&lt;/p&gt;</comment>
                            <comment id="12436953" author="fuzzylogic" created="Fri, 22 Sep 2006 19:30:20 +0100"  >&lt;p&gt;The jdbc4 classes depend on junit, which we are not able to ship. Since we cannot guarantee that junit.jar will be there and I don&apos;t think adding an extra step is desirable in order to keep things as simple as possible, I don&apos;t think compiling the test classes is something worth pursuing, especially considering that these scripts will probably only be needed for the 10.2.1 release.&lt;/p&gt;</comment>
                            <comment id="12436961" author="fuzzylogic" created="Fri, 22 Sep 2006 19:43:53 +0100"  >&lt;p&gt;Marking resolved, no further work planned on this issue.&lt;/p&gt;</comment>
                            <comment id="12437677" author="rhillegas" created="Mon, 25 Sep 2006 23:18:31 +0100"  >&lt;p&gt;Thanks, Andrew. Looks good to me. I ran the following experiment on a Linux machine:&lt;/p&gt;

&lt;p&gt;1) Untarred the 10.2.1.5 bin distribution and pointed DERBY_HOME at the root of the untarred tree (the directory containing LICENSE).&lt;/p&gt;

&lt;p&gt;2) Set my java environment to be jdk 1.6 build 99.&lt;/p&gt;

&lt;p&gt;3) Untarred the 10.2.1.5 src distribution and cd&apos;d to tools/jdbc4 inside the untarred tree.&lt;/p&gt;

&lt;p&gt;4) Gave execute permission to update-with-jdbc4.&lt;/p&gt;

&lt;p&gt;5) Ran that script.&lt;/p&gt;

&lt;p&gt;The script compiled the optional JDBC4 driver classes and stuffed them into derby.jar and derbyclient.jar. I then continued:&lt;/p&gt;

&lt;p&gt;6) Copied over a derbyTesting.jar from a 10.2 build.&lt;/p&gt;

&lt;p&gt;7) Ran the jdbc4 suite in embedded and DerbyNetClient frameworks.&lt;/p&gt;

&lt;p&gt;The tests ran cleanly. Thanks again!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12402000">DERBY-3826</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12341333" name="derby-1846-netconnection.diff" size="837" author="fuzzylogic" created="Thu, 21 Sep 2006 22:56:21 +0100"/>
                            <attachment id="12340754" name="derby-1846-v1.diff" size="6625" author="fuzzylogic" created="Wed, 13 Sep 2006 20:27:02 +0100"/>
                            <attachment id="12340786" name="derby-1846-v2.diff" size="9928" author="fuzzylogic" created="Thu, 14 Sep 2006 00:34:08 +0100"/>
                            <attachment id="12341124" name="derby1846-batchFix_v1.diff" size="1739" author="johnemb" created="Tue, 19 Sep 2006 15:42:51 +0100"/>
                            <attachment id="12341240" name="modules.properties" size="4082" author="rhillegas" created="Wed, 20 Sep 2006 22:53:02 +0100"/>
                            <attachment id="12341123" name="output_batchFix_v1.txt" size="6554" author="johnemb" created="Tue, 19 Sep 2006 15:42:51 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 13 Sep 2006 20:22:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30159</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0yif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39409</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>