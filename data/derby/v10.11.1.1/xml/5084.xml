<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:53:27 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5084/DERBY-5084.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5084] convert ijConnName.sql to a ScriptTest junit test</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5084</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3089&quot; title=&quot;convert tests that cause failures because of jvm based messages to junit, or adjust old test harness files, for test failures during iseries run&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3089&quot;&gt;&lt;del&gt;DERBY-3089&lt;/del&gt;&lt;/a&gt; it is mentioned that tools/ijConnName.sql should get converted to a junit test, probably using ScriptTest.&lt;/p&gt;

&lt;p&gt;Making a separate issue so that that issue can be closed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12500201">DERBY-5084</key>
            <summary>convert ijConnName.sql to a ScriptTest junit test</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="houxzhang">Houx Zhang</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                            <label>derby_triage10_8</label>
                    </labels>
                <created>Wed, 2 Mar 2011 17:15:23 +0000</created>
                <updated>Tue, 25 Oct 2011 18:09:37 +0100</updated>
                            <resolved>Thu, 28 Apr 2011 15:26:32 +0100</resolved>
                                                    <fixVersion>10.8.2.2</fixVersion>
                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13003171" author="houxzhang" created="Sun, 6 Mar 2011 13:28:16 +0000"  >&lt;p&gt;I&apos;m interested in this issue, and I think it&apos;s a good point for a new comer. I will read some infomation about Derby testing, and hope to attach a patch some days later.&lt;/p&gt;</comment>
                            <comment id="13006940" author="houxzhang" created="Tue, 15 Mar 2011 14:34:07 +0000"  >&lt;p&gt;Ask for help&#65281;&lt;/p&gt;

&lt;p&gt;I have provided an attach for this issue. However, it hasn&apos;t passed yet. I have some questions about it:&lt;/p&gt;

&lt;p&gt;1. I have changed ijConnName.out by adding a empty line, as it&apos;s obviously right. It seems, the sql test hasn&apos;t been runned for a long time. Is it so?&lt;/p&gt;

&lt;p&gt;2. When running my test case extending ScriptTestcase.java, the test failed in &quot;CONNONE* - 	jdbc:derby:wombat&quot; by &quot;CONNECTION1* - 	jdbc:derby:wombat&quot;. I &lt;/p&gt;

&lt;p&gt;have setting system prompties with SystemPropertyTestSetup, however it seems making no effect. So, I wonder how to set the properties in junit Testcase just &lt;/p&gt;

&lt;p&gt;like in ijConnName_app.properties.&lt;/p&gt;

&lt;p&gt;Thanks for your advice!&lt;/p&gt;</comment>
                            <comment id="13008156" author="kmarsden" created="Thu, 17 Mar 2011 21:37:59 +0000"  >&lt;p&gt;Hello Houx. Thank you for contributing to derby.&lt;/p&gt;

&lt;p&gt;For 1) Adding the blank line is fine.   This is covered in the &lt;a href=&quot;http://wiki.apache.org/db-derby/ConvertSqlScriptTestsToJunit&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/ConvertSqlScriptTestsToJunit&lt;/a&gt; page under Test fails. Because the old harness did a sed of the output it can have white space differences.&lt;/p&gt;

&lt;p&gt;Part of the final patch will need to be to take the test out of the old harness which will mean at least taking it out of suites/tools.runall and taking out the ijConnName*properties files.&lt;/p&gt;

&lt;p&gt;I am not sure about the SystemProperty problem.  I wonder if ScriptTestCase sets up its own connection that interferes?&lt;/p&gt;

</comment>
                            <comment id="13008171" author="kmarsden" created="Thu, 17 Mar 2011 21:48:05 +0000"  >&lt;p&gt;I just noticed there is a ScriptTestCase(String script, boolean useSystemProperties) constructor. Maybe us that one instead?&lt;/p&gt;</comment>
                            <comment id="13008775" author="houxzhang" created="Sat, 19 Mar 2011 14:19:09 +0000"  >&lt;p&gt;Thanks very much, Kathey. Your advice is helpful.&lt;/p&gt;

&lt;p&gt;ScriptTestCase(String script, boolean useSystemProperties) constructor can work as you advised. With setting it true, the System Properties are set up OK.&lt;/p&gt;

&lt;p&gt;However, my junit test case can not pass, while the harness.RunTest can pass. I have attached the file &quot;ijConnName-1.tmp&quot;, which is created by harness.RunTest, and the file &quot;ijConnName-1.out&quot;, created by my junit test case. In the file &quot;ijConnName-1.out&quot;, we can see, &lt;/p&gt;

&lt;p&gt;&quot;&lt;br/&gt;
show connections;&lt;br/&gt;
CONNECTION0* - 	jdbc:derby:wombat&lt;br/&gt;
CONNONE - 	jdbc:derby:wombat&lt;br/&gt;
&quot;&lt;/p&gt;

&lt;p&gt;A connection with the name &quot;CONNECTION0&quot; has been created before the testing. Maybe it&apos;s the connection created in BaseJDBCTestCase, however, I have tried to override the setup() method to close the connection, but it can not work, too.&lt;/p&gt;

&lt;p&gt;How can I go ahead? I doubt this .sql is not fit to converted into a junit test case, in other word, harness is it&apos;s only way to work. &lt;/p&gt;

&lt;p&gt;Comments are welcome. Thanks!&lt;/p&gt;</comment>
                            <comment id="13009207" author="myrna" created="Mon, 21 Mar 2011 17:00:30 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I don&apos;t see a .out nor .tmp file attached, did you forget that step (you wouldn&apos;t be the first, nor, I&apos;m sure, the last) or did it fail?&lt;/p&gt;

&lt;p&gt;Though tempting to convert this to a straight junit test, where you have more control over the output, the name indicates this is a test intended to test the ij commands to manage connections. So converting it to straight junit would defeat the purpose of the test - it &lt;b&gt;has&lt;/b&gt; to activate ij.&lt;/p&gt;

&lt;p&gt;Perhaps you can add a &apos;disconnect all&apos; to the top of the sql script and get closer to the current output?&lt;/p&gt;

&lt;p&gt;The &apos;master&apos; file (the expected output, which is saved in &amp;lt;trunk&amp;gt;/java/testing/org/apache/derbyTesting/functionTests/master/ijConnName.out) can be updated. As long as the result is equivalent, makes sense, doesn&apos;t hide any bugs, and is always the same (i.e. for all jvms, for embedded and client/server if the test runs both ways, for all operating systems).&lt;/p&gt;</comment>
                            <comment id="13010140" author="houxzhang" created="Wed, 23 Mar 2011 14:24:53 +0000"  >&lt;p&gt;Oh, Myrna, I&apos;m sorry for my mistake, let me post the patch first.&lt;/p&gt;</comment>
                            <comment id="13010199" author="houxzhang" created="Wed, 23 Mar 2011 16:18:55 +0000"  >&lt;p&gt;Myrna, thanks for your advice. I have update the .sql file and the .out file by keeping the original opinion for testing. Now it can run well. &lt;/p&gt;

&lt;p&gt;However, as two new databases are created after one run, the second run will failed. Is there any TestSetup tool class that can remove the temporary databases, please? Thanks!&lt;/p&gt;</comment>
                            <comment id="13010675" author="houxzhang" created="Thu, 24 Mar 2011 13:50:31 +0000"  >&lt;p&gt;I have also tried to use &quot;TestConfiguration.singleUseDatabaseDecorator&quot; to decorate the test case, but the second run failed still.&lt;/p&gt;

&lt;p&gt;public class IjConnNameTest extends ScriptTestCase {&lt;/p&gt;

&lt;p&gt;    private static String test_script = &quot;ijConnName&quot;;&lt;/p&gt;

&lt;p&gt;    public IjConnNameTest(String name) &lt;/p&gt;
{
        super(name, true);
    }

&lt;p&gt;    public static Test suite() &lt;/p&gt;
{        
        TestSuite suite = new TestSuite(&quot;IjConnNameTest&quot;);
        suite.addTest(getTestCase());
        suite.addTest(TestConfiguration.clientServerDecorator(getTestCase()));
        
        return suite; 
    }

&lt;p&gt;    private static Test getTestCase() &lt;/p&gt;
{
        return TestConfiguration.singleUseDatabaseDecorator(new IjConnNameTest(test_script));
    }
&lt;p&gt;}&lt;/p&gt;</comment>
                            <comment id="13011067" author="myrna" created="Fri, 25 Mar 2011 01:44:49 +0000"  >&lt;p&gt;Firstly, thank you for working on this issue.&lt;/p&gt;

&lt;p&gt;I took a closer look at your patch, and I think the problem you&apos;re seeing - the second run (probably the second one is the network server run, but the order depends on the jvm) fails with &apos;connection made to existing database instead&apos; is because the sql script creates its own database using the connect statement with &quot;;create=true&quot;. Most tests don&apos;t test database creation, and can rely on methods in TestConfiguration such as CleanDatabaseSetup or singleUseDatabaseDecorator...But we cannot do that in this case.&lt;/p&gt;

&lt;p&gt;Using TestConfiguration.singleUseDatabaseDecorator was a good attempt, but - as you can see by reading the javadoc description of the method - it&apos;s creating databases with a specific naming scheme. &lt;/p&gt;

&lt;p&gt;CleanDatabaseSetup assumes it will create the database to be used and the name will be &apos;wombat&apos;.&lt;/p&gt;

&lt;p&gt;I think I ran into these same problems before, and ended up creating a separate teardown method in at least one instance, see org.apache.derbyTesting.functionTests.tests.i18n.LocalizedAttributeScriptTest.java.&lt;br/&gt;
Note also that the .sql script for that test has a shutdown of the system to ensure the database directories can be removed; ijConnName.sql will need something similar.&lt;/p&gt;

&lt;p&gt;Note finally, that as this test uses some hard-coded urls that only reflect embedded, it would be pointless to run this with networkserver; it&apos;ll only connect using the embedded driver but start network server for no reason. Perhaps a similar test (.sql file) can be made to use network server urls and run that through NetworkServerTestSetup, but I&apos;d say that would be an improvement beyond the scope of this JIRA.&lt;/p&gt;

&lt;p&gt;Apart from the database creation and cleanup issues, I don&apos;t think the current test is testing the same as the original one.&lt;br/&gt;
Although it certainly manages to create a database using the same (or similar) URL, the original tests some ij specific properties which were set in the _app.properties file. You&apos;ve rolled those properties into the url in the connect statement in the .sql file, which is not the same thing...&lt;/p&gt;

&lt;p&gt;I think you will need to wrap the test in a SystemPropertyTestSetup of some sort to set up those ij properties (which would unset them automatically afterwards).&lt;/p&gt;

&lt;p&gt;Finally, you should run the suite through the getIJConfig() method. This ensures that the test only runs when ij is available in the classpath. &lt;/p&gt;








</comment>
                            <comment id="13011780" author="houxzhang" created="Sun, 27 Mar 2011 12:45:34 +0100"  >&lt;p&gt;Myrna, thanks very much for your detailed insctruction, it&apos;s valuale to me.&lt;/p&gt;

&lt;p&gt;Following your advice, I have finished &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5084&quot; title=&quot;convert ijConnName.sql to a ScriptTest junit test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5084&quot;&gt;&lt;del&gt;DERBY-5084&lt;/del&gt;&lt;/a&gt;-3.patch. In it, removal of the lemming database is resolved well, and SystemPropertySetUp is used to perform the original aim in ijConnName_app.properties. In the beginning of the .sql script, I added:&lt;/p&gt;

&lt;p&gt;---disconnect connection created by ScriptTestCase &lt;br/&gt;
show connections;&lt;br/&gt;
disconnect CONNECTION0;&lt;br/&gt;
set connection connOne; &lt;/p&gt;

&lt;p&gt;I suppose, CONNECTION0(wombat) is created by the Derby JUnit framework, our connOne connected to the same database in fact, so &quot;disconnect CONNECTION0&quot; and &quot;set connection connOne&quot; can give a clear view.&lt;/p&gt;


&lt;p&gt;Please check the patch, thanks!&lt;/p&gt;

&lt;p&gt;Besides, if drop a temporary database is common, why not extract out a util class to do this? Maybe a new issue can be created to deal with it. There is already DropDatabaseSetup which can do this, but it&apos;s not visible, and just able to remove a specially named database.&lt;/p&gt;

&lt;p&gt;Regards&lt;/p&gt;</comment>
                            <comment id="13013600" author="myrna" created="Wed, 30 Mar 2011 20:25:30 +0100"  >&lt;p&gt;Attaching a modified patch.&lt;br/&gt;
It differs from the _3.patch in that:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the last line in the suite() method returns the test, rather than the suite. When returning the suite, I got no (0) tests run. I don&apos;t understand how you could&apos;ve gotten that to work, but it works well enough when the &apos;test&apos; is returned:&lt;br/&gt;
    &amp;lt; +        return getIJConfig(test);&lt;br/&gt;
    &amp;#8212;&lt;br/&gt;
    &amp;gt; +        return getIJConfig(suite);&lt;/li&gt;
	&lt;li&gt;I&apos;ve commented out the noSecurityManager call. It seemed unnecessary. If you agree, we could just remove it altogether.&lt;br/&gt;
    &amp;lt; +        //test = SecurityManagerSetup.noSecurityManager(test);&lt;br/&gt;
    &amp;#8212;&lt;br/&gt;
    &amp;gt; +        test = SecurityManagerSetup.noSecurityManager(test);&lt;/li&gt;
	&lt;li&gt;I changed the eol-style property for the new file to native (by doing svn propset svn:eol-style native. There&apos;s instructions on the web how to do this automatically for svn).&lt;/li&gt;
	&lt;li&gt;(nit&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I removed one of the dashes from the comment you added; normally a comment in ij is two dashes.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;However, there is still an issue with this test conversion.&lt;/p&gt;

&lt;p&gt;When I ran the test with these changes with ibm 1.6 (both on windows and linux, with classes or jars), I did get a mostly successful run, but the .out file was slightly different; instead of:&lt;br/&gt;
  +ERROR XJ004: Database &apos;nevercreated&apos; not found.&lt;br/&gt;
  +ERROR 08001: No suitable driver found for jdbc:noone:fruitfly;create=true&lt;br/&gt;
I got: &lt;br/&gt;
  +ERROR 08001: No suitable driver&lt;br/&gt;
  +ERROR XJ004: Database &apos;nevercreated&apos; not found.&lt;/p&gt;

&lt;p&gt;My patch has the ibm jvm output.&lt;br/&gt;
The original test hid this difference by using the _sed.properties file. I&apos;m not sure what the solution for this is...&lt;/p&gt;
</comment>
                            <comment id="13013617" author="kmarsden" created="Wed, 30 Mar 2011 20:55:53 +0100"  >&lt;p&gt;Well, one thing to consider is that neither of these cases were actually tested with the old test because it had in the ijConnName_sed.properties:&lt;br/&gt;
&amp;#8211;&lt;br/&gt;
delete=ERROR 08001:&lt;b&gt;,ERROR XJ004:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;but both are perfectly valid cases that should be tested.&lt;br/&gt;
So I would say for the converted ijConnName test, keep the property ij.connection.connFour=jdbc:derby:nevercreated&lt;/p&gt;

&lt;p&gt;and test that case.  &lt;/p&gt;


&lt;p&gt;For ij.connection.connThree=jdbc:noone:fruitfly;create=true  , since the JVM messages differ I think we will need to think of  a different way to test that one outside of the master based ScriptTestCase.  I don&apos;t think it would be a major loss now with the conversion of this test as we are currrently deleting both these lines when run in the old harness.&lt;/p&gt;</comment>
                            <comment id="13013679" author="myrna" created="Wed, 30 Mar 2011 22:40:03 +0100"  >&lt;p&gt;What Kathey said is true. I&apos;ve modified the test once more, to eliminate the noone protocol property; and adjusted the master/ijConnName.out file accordingly.&lt;br/&gt;
If there are no comments I&apos;ll check that part of the converted test in.&lt;/p&gt;

&lt;p&gt;I think the remaining property could get tested by making a separate test in a similar way to the SysinfoCPCheckTest and SysinfoAPITest. There is no need for a .sql script as there can be no connection; but if we catch the output in that mechanism we can check for the string &apos;08001&apos; and &apos;Driver not found&apos; in the output.&lt;/p&gt;</comment>
                            <comment id="13013987" author="houxzhang" created="Thu, 31 Mar 2011 15:12:20 +0100"  >&lt;p&gt;Myrna and Kathey, thanks for your working and advice on this issue.&lt;/p&gt;

&lt;p&gt;@Myrna&lt;br/&gt;
As to &quot;the last line in the suite() method returns the test, rather than the suite&quot;, I&apos;m very sorry to have submitted a temporary patch by mistake. I will be more careful next time.&lt;/p&gt;

&lt;p&gt;As to &quot;ERROR 08001: No suitable driver&quot;, I wil provide another patch on it later.&lt;/p&gt;

&lt;p&gt;Thanks again!&lt;/p&gt;
</comment>
                            <comment id="13014203" author="myrna" created="Thu, 31 Mar 2011 22:01:03 +0100"  >&lt;p&gt;committed the patch after the changes as per &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5084&quot; title=&quot;convert ijConnName.sql to a ScriptTest junit test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5084&quot;&gt;&lt;del&gt;DERBY-5084&lt;/del&gt;&lt;/a&gt;_5.diff with revision 1087433. &lt;br/&gt;
I&apos;ll leave this open for the follow up patch for testing the ij property with a url with bad protocol. &lt;/p&gt;</comment>
                            <comment id="13022783" author="houxzhang" created="Thu, 21 Apr 2011 16:25:56 +0100"  >&lt;p&gt;Hi, Myrna, I have submitted derby-5084-6.patch, which tests &apos;jdbc:noone:fruitfly;create=true&apos;. Please check it, thanks!&lt;/p&gt;</comment>
                            <comment id="13023076" author="bryanpendleton" created="Fri, 22 Apr 2011 02:50:35 +0100"  >&lt;p&gt;When I try to build patch 6 in my environment I get a compilation error (see below).&lt;/p&gt;

&lt;p&gt;I think that String.contains() is new with JDK 1.5, and this section of the code is by&lt;br/&gt;
default compiled with JDK 1.4 compatibility, so we can&apos;t use that method.&lt;/p&gt;


&lt;p&gt;compilet1:&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; Compiling 2 source files to /home/bpendleton/src/derby/trunk/classes&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/bpendleton/src/derby/trunk/java/testing/org/apache/derbyTesting/functionTests/tests/tools/IjConnNameWithWrongDriverTest.java:31: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; symbol  : method contains(java.lang.String)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; location: class java.lang.String&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         assertTrue(ijResult.contains(&quot;08001&quot;));&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                            ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /home/bpendleton/src/derby/trunk/java/testing/org/apache/derbyTesting/functionTests/tests/tools/IjConnNameWithWrongDriverTest.java:32: cannot find symbol&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; symbol  : method contains(java.lang.String)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; location: class java.lang.String&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;         assertTrue(ijResult.contains(&quot;No suitable driver&quot;));&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                            ^&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; 2 errors&lt;/p&gt;

&lt;p&gt;BUILD FAILED&lt;/p&gt;</comment>
                            <comment id="13023092" author="myrna" created="Fri, 22 Apr 2011 04:26:06 +0100"  >&lt;p&gt;I agree Bryan. I had made a similar comment - but my session had expired. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I think on the whole the patch looks good, I have just 2 comments:&lt;/p&gt;

&lt;p&gt;1. You cannot use contains(String). This only works as of java 1.5; if you compile with 1.4.2 libraries, you&apos;d get the build error Bryan described.&lt;br/&gt;
We support jvm 1.4.2, so you cannot use this construct unless the class is explicitly getting built with 1.5 or higher (see the tools/build.xml; you can see source and target are defined as 1.4). &lt;br/&gt;
To prevent this kind of issue with your patches, you should obtain a 1.4.2 jre, see trunk/&amp;lt;BUILDING.html&amp;gt;. &lt;br/&gt;
There&apos;s also been discussions on this in the past, you can search the list archives. I think typically we use a construct like: assertTrue((ijResult.indexOf(&quot;08001&quot;)&amp;gt;1);&lt;/p&gt;

&lt;p&gt;2. As there is no protocol specified, there&apos;s no point running this test with both embedded and client, the only thing it would do with client is starting and shutting down NetworkServer for no reason. I suggest you use EmbeddedSuite() instead of defaultSuite().&lt;/p&gt;

&lt;p&gt;Did you run suites.All? You didn&apos;t say...&lt;/p&gt;</comment>
                            <comment id="13025268" author="houxzhang" created="Tue, 26 Apr 2011 16:09:40 +0100"  >&lt;p&gt;Thanks, Bryan and Myrna. I have summitted the new patch by your advice.&lt;/p&gt;

&lt;p&gt;@Myrna&lt;br/&gt;
I have only run the tools.Suite, but not suites.All. And now, I have run the complete test, and I&apos;m sure the new patch doesn&apos;t make bad effect on old testing.&lt;/p&gt;

&lt;p&gt;Besides, I&apos;m not sure whether it&apos;s neccesary to run the complete for this patch, as it&apos;s just to have added a new test class, not changed any product code, maybe it&apos;s safe even not run the complete test suite. It have cost me over 5 hour in my PC for one run and I have to run again when testing was broken down by accident.&lt;/p&gt;
</comment>
                            <comment id="13025599" author="myrna" created="Wed, 27 Apr 2011 05:27:42 +0100"  >&lt;p&gt;There&apos;s indeed no need to run the full suites.All for such a small test as with this patch. &lt;/p&gt;

&lt;p&gt;I took a look at your new patch, and find I didn&apos;t check the first patch (-6.patch) properly, I apologize for that. &lt;/p&gt;

&lt;p&gt;I don&apos;t think the new test is doing the same thing as the original test. The original test was setting the connection with the bad subprotocol (&apos;jdbc:noone:&apos;, it should be jdbc:derby, of course) using an ij property. The new test is using a simple ij connect statement with a bad subprotocol. &lt;/p&gt;

&lt;p&gt;I did a simple &apos;grep&apos; and didn&apos;t find another test where a bad subprotocol was lobbed at ij...(jdbcapi/DriverTest and management.JDBCMBeanTest do test incorrect subprotocol). So I guess this test does test something useful, but it&apos;s not the same as the original test. &lt;/p&gt;

&lt;p&gt;Also, but that&apos;s more of a nit, the name is not really right, because we&apos;re not even specifying a driver, just a bad subprotocol (which results in derby not finding any driver to use). &lt;/p&gt;

&lt;p&gt;Can you add the testing of passing in the bad subprotocol with a system property? &lt;/p&gt;</comment>
                            <comment id="13025850" author="houxzhang" created="Wed, 27 Apr 2011 16:43:27 +0100"  >&lt;p&gt;Hi, Myrna. Thanks for your advice. I have summitted 5084-8.patch, and it should meet all demands.&lt;/p&gt;</comment>
                            <comment id="13025857" author="houxzhang" created="Wed, 27 Apr 2011 16:53:21 +0100"  >&lt;p&gt;I have added checking Derby.hasTools() in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5084&quot; title=&quot;convert ijConnName.sql to a ScriptTest junit test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5084&quot;&gt;&lt;del&gt;DERBY-5084&lt;/del&gt;&lt;/a&gt;-9.patch. Please check it, thanks!&lt;/p&gt;</comment>
                            <comment id="13026321" author="myrna" created="Thu, 28 Apr 2011 15:26:32 +0100"  >&lt;p&gt;I committed patch -9 to trunk with revision 1097460, with 2 minor modifications:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;this test - because there is no pre-decided use of client or embedded driver - will cause java.sql.Driver to be invoked, which isn&apos;t available with JSR169. So I added a section at the top of the suite method:&lt;br/&gt;
          if (JDBC.vmSupportsJSR169())&lt;br/&gt;
            return new TestSuite(&quot;empty: no support for Driver.sql.Manager with jsr 169&quot;);&lt;/li&gt;
	&lt;li&gt;I changed the name of the method that does the actual asserts from &apos;testConnectWrongSubprotocol&apos; to &apos;checkConnectWrongSubprotocol&apos;. I find it easier to identify the fixtures when they start with &apos;test&apos; when I look at the code. But this was more a personal preference, no technical reason.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Then I noticed that we missed adding the apache licence header to IjConnNameTest and the new test, and added them to trunk with revision  1097469.&lt;br/&gt;
(Then I realized I forgot to change the name after cut-and-paste in one of the headers and fixed that up with reivision 1097471).&lt;/p&gt;

&lt;p&gt;I backported these changed to 10.8 with revision 1097477.&lt;/p&gt;

&lt;p&gt;Thank you for your work on this issue!&lt;/p&gt;</comment>
                            <comment id="13026349" author="houxzhang" created="Thu, 28 Apr 2011 16:30:28 +0100"  >&lt;p&gt;Thanks for your help on this issue, Myrna. I have harvested a lot. Thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12523773">DERBY-5424</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12379151">DERBY-3089</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12474399" name="DERBY-5084-1.patch" size="2279" author="houxzhang" created="Wed, 23 Mar 2011 14:24:53 +0000"/>
                            <attachment id="12474408" name="DERBY-5084-2.patch" size="10019" author="houxzhang" created="Wed, 23 Mar 2011 16:18:55 +0000"/>
                            <attachment id="12474730" name="DERBY-5084-3.patch" size="11426" author="houxzhang" created="Sun, 27 Mar 2011 12:45:34 +0100"/>
                            <attachment id="12474729" name="DERBY-5084-3.stat" size="11746" author="houxzhang" created="Sun, 27 Mar 2011 12:45:34 +0100"/>
                            <attachment id="12477559" name="DERBY-5084-9.patch" size="4199" author="houxzhang" created="Wed, 27 Apr 2011 16:53:21 +0100"/>
                            <attachment id="12473684" name="DERBY-5084.patch" size="3275" author="houxzhang" created="Tue, 15 Mar 2011 14:34:07 +0000"/>
                            <attachment id="12475001" name="DERBY-5084_4.diff" size="11446" author="myrna" created="Wed, 30 Mar 2011 20:25:30 +0100"/>
                            <attachment id="12475017" name="DERBY-5084_5.diff" size="11323" author="myrna" created="Wed, 30 Mar 2011 22:40:03 +0100"/>
                            <attachment id="12477012" name="derby-5084-6.patch" size="2815" author="houxzhang" created="Thu, 21 Apr 2011 16:25:56 +0100"/>
                            <attachment id="12477416" name="derby-5084-7.patch" size="2836" author="houxzhang" created="Tue, 26 Apr 2011 16:09:40 +0100"/>
                            <attachment id="12477554" name="derby-5084-8.patch" size="4017" author="houxzhang" created="Wed, 27 Apr 2011 16:43:27 +0100"/>
                            <attachment id="12474400" name="ijConnName-1.out" size="2613" author="houxzhang" created="Wed, 23 Mar 2011 14:24:53 +0000"/>
                            <attachment id="12474401" name="ijConnName-1.tmp" size="2301" author="houxzhang" created="Wed, 23 Mar 2011 14:24:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>13.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 6 Mar 2011 13:28:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31499</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ew7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36231</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10053"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>