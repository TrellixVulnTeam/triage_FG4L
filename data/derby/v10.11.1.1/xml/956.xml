<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:42:14 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-956/DERBY-956.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-956] OutOfMemoryError: Java heap space in stress.multi</title>
                <link>https://issues.apache.org/jira/browse/DERBY-956</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Diff: &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;Start: stress jdk1.5.0_03 encryption:multi 2006-02-09 23:37:11 ***&lt;br/&gt;
3a4&lt;br/&gt;
&amp;gt; Exception in thread &quot;Thread-1&quot; java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
6 del&lt;br/&gt;
&amp;lt; TEST CASE SUMMARY: normal termination&lt;br/&gt;
7 del&lt;br/&gt;
&amp;lt; ...running last checks via final.sql&lt;br/&gt;
7 add&lt;br/&gt;
&amp;gt; TEST CASE SUMMARY: abnormal termination due to error(s) &amp;#8211; see test log (./stress/stress.log) for details &lt;br/&gt;
Test Failed.&lt;/li&gt;
			&lt;li&gt;End:   stress jdk1.5.0_03 encryption:multi 2006-02-09 23:41:28 ***&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;First seen in&lt;br/&gt;
&lt;a href=&quot;http://www.multinet.no/~solberg/public/Apache/TinderBox_Derby/testlog/SunOS-5.10_i86pc-i386/370061-encryption_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.multinet.no/~solberg/public/Apache/TinderBox_Derby/testlog/SunOS-5.10_i86pc-i386/370061-encryption_diff.txt&lt;/a&gt;&lt;/p&gt;</description>
                <environment>Red Hat Enterprise Linux AS release 3 (Taroon Update 4) - Linux 2.4.21-27.ELsmp #1 SMP Wed Dec 1 21:50:31 EST 2004 GNU/Linux, JVM: Sun Microsystems Inc. 1.5.0_03&lt;br/&gt;
Solaris 10 3/05 s10_74L2a X86 - SunOS 5.10 Generic, JVM: Sun Microsystems Inc. 1.5.0_04&lt;br/&gt;
Solaris 10 3/05 s10_74L2a SPARC - SunOS 5.10 Generic, JVM: Sun Microsystems Inc. 1.5.0_03&lt;br/&gt;
Solaris 9 9/04 s9s_u7wos_09 SPARC - SunOS 5.9 Generic_118558-11, JVM: Sun Microsystems Inc. 1.5.0_03</environment>
        <key id="12328847">DERBY-956</key>
            <summary>OutOfMemoryError: Java heap space in stress.multi</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="deepa">Deepa Remesh</assignee>
                                    <reporter username="olesolberg">Ole Solberg</reporter>
                        <labels>
                    </labels>
                <created>Sat, 11 Feb 2006 09:27:31 +0000</created>
                <updated>Mon, 29 Jun 2009 23:57:45 +0100</updated>
                            <resolved>Sat, 11 Mar 2006 10:04:29 +0000</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12366281" author="skambha" created="Tue, 14 Feb 2006 11:01:06 +0000"  >&lt;p&gt;Hi Ole, &lt;/p&gt;

&lt;p&gt;Where can I get the derby.log and other files from this testrun. Can you point me to them or upload them to jira. I would like to take a look.  &lt;/p&gt;

&lt;p&gt;Thanks. &lt;br/&gt;
Sunitha.&lt;/p&gt;</comment>
                            <comment id="12366292" author="kmarsden" created="Tue, 14 Feb 2006 12:49:19 +0000"  >&lt;p&gt;I am changing this to Blocker.  &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stress/multi showing OutOfMemoryError has traditionally been an indication of a serious leak memory leak in the product.&lt;/li&gt;
	&lt;li&gt;wisconsin.sql has been acting up recently and choosing an alternate plan is also typically memory related.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think until the problem is understood, we should be very careful about what we let in the trunk.&lt;/p&gt;

&lt;p&gt;Can stress/multi  be changed to use jvmFlags to reduce the heap to compare the 10.1 and 10.2 heap needed for this test ?&lt;/p&gt;
</comment>
                            <comment id="12366314" author="olesolberg" created="Tue, 14 Feb 2006 17:29:42 +0000"  >&lt;p&gt;Hi Sunitha,&lt;/p&gt;

&lt;p&gt;This is the zip from the first&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; occurence of the failure.&lt;br/&gt;
(&lt;a href=&quot;http://www.multinet.no/~solberg/public/Apache/TinderBox_Derby/Limited/testSummary-370061.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.multinet.no/~solberg/public/Apache/TinderBox_Derby/Limited/testSummary-370061.html&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;I will also attache a newer one.&lt;/p&gt;


&lt;p&gt;&amp;#8211; Ole&lt;/p&gt;</comment>
                            <comment id="12366395" author="skambha" created="Wed, 15 Feb 2006 07:45:02 +0000"  >&lt;p&gt;Thanks Ole for posting the files. &lt;/p&gt;

&lt;p&gt;I looked at the 377554.zip and stress.multi didnt fail as part of derbyall run but it failed as part of the individual encryption suite run. &lt;/p&gt;

&lt;p&gt;When I look further into the encryption suite directory (.\encryption\encryption\multi\stress&amp;#41;, I usually check the derby.log to see what errors are .. but I see that the derby.log is empty. &lt;/p&gt;

&lt;p&gt;Anyone know what could be happening ?  Thanks. &lt;/p&gt;</comment>
                            <comment id="12367402" author="kartha" created="Thu, 23 Feb 2006 05:32:56 +0000"  >&lt;p&gt;I am starting to think if this failure is caused due to some kernel issue.  I used one of the recent builds 10.2.0.0 alpha - (379197) to investigate this failure.&lt;/p&gt;

&lt;p&gt;But any number of runs on:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Linux  2.6.5-7.244-smp #1 SMP Mon Dec 12 18:32:25 UTC 2005 i686 i686 i386 GNU/Linux&lt;br/&gt;
    (with JVMs ibm142, ibm15, jdk142  and jdk15 (build 1.5.0_06-b05) )&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SunOS 5.10 Generic_118822-25 sun4u sparc SUNW,Ultra-4 Solaris and jdk 15 (build 1.5.0_06-b05)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;did not yield the OutofMemory exception for this test.&lt;/p&gt;

&lt;p&gt;On the contrary,  with the following Linux:&lt;/p&gt;

&lt;p&gt;Linux 2.4.21-27.ELsmp #1 SMP Wed Dec 1 21:59:02 EST 2004 i686 i686 i386 GNU/Linux&lt;br/&gt;
(This seems to be the same version,  where the failure was initially observed)&lt;/p&gt;

&lt;p&gt;for all the same JVMs mentioned above the test fails with OOM  exception each and every time it is run.&lt;/p&gt;

&lt;p&gt;The kernel version in the latter  is  an older one and does seem to be the issue (since the JVMs used are the same). &lt;/p&gt;

&lt;p&gt;Having said that, if someone else can also confirm the above, we can downgrade this issue from being a Blocker.&lt;/p&gt;</comment>
                            <comment id="12367988" author="kartha" created="Tue, 28 Feb 2006 02:08:29 +0000"  >&lt;p&gt;I tried the encryptionAll suite multiple times  with latest v10.1 jars and this issue is not seen on any of the above OSes.  It is quite strange&lt;br/&gt;
why on specific systems this test fails for 10.2 therefore merits further investigation.&lt;/p&gt;

&lt;p&gt;I agree with leaving this issue a Blocker till we have discussed a resolution.&lt;/p&gt;</comment>
                            <comment id="12368571" author="mikem" created="Fri, 3 Mar 2006 04:05:44 +0000"  >&lt;p&gt;when you ran the test on 10.1 did you use the 10.1 tests or the 10.2 tests?  I think there may be changes in 10.2 in what tests we run.  &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-238&quot; title=&quot;Testharness: testEncryptionAlgorithm property is not being picked up correctly for some encryption suites&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-238&quot;&gt;&lt;del&gt;DERBY-238&lt;/del&gt;&lt;/a&gt; seems one such instance.&lt;/p&gt;</comment>
                            <comment id="12369354" author="skambha" created="Wed, 8 Mar 2006 09:53:33 +0000"  >&lt;p&gt;This test failed in one of the nighlty runs (2006/03/06) on platform &lt;br/&gt;
OS name:         Linux&lt;br/&gt;
OS architecture: i386&lt;br/&gt;
OS version:      2.6.5-7.201-bigsmp&lt;br/&gt;
Java Version:    1.5.0_06&lt;br/&gt;
Java Vendor:     Sun Microsystems Inc.&lt;br/&gt;
insane jars with version10.2.0.0 alpha - (383748)&lt;br/&gt;
diff: &lt;br/&gt;
3a4&lt;br/&gt;
&amp;gt; Exception in thread &quot;Thread-8&quot; java.lang.OutOfMemoryError: Java heap space&lt;/p&gt;
</comment>
                            <comment id="12369534" author="mikem" created="Thu, 9 Mar 2006 03:17:00 +0000"  >&lt;p&gt;I did some analysis using the sun test regression histories, I didn&apos;t realize how long they had that&lt;br/&gt;
around.  We probably should automatically be doing this as a first step to analysing any bug&lt;br/&gt;
that reproduces 100% on any platform.  The analysis is below.  I just looked at the change&lt;br/&gt;
diff for 370059 and noticed it had a change to ij in the area of multi-threaded &amp;#8211; it looked very&lt;br/&gt;
innocuous, but given that the problem seems to have started with one of the 3 changes &lt;br/&gt;
in the report - and I looked at the other 2 which seemed only test related in other areas I would&lt;br/&gt;
guess it is related to 370059.  &lt;/p&gt;

&lt;p&gt; I suggest building&lt;br/&gt;
a trunk version at 369956 just before the change, and then at 370059 and see if that verifies&lt;br/&gt;
my guess.&lt;/p&gt;

&lt;p&gt;Here is the history analysis I did by hand doing binary search on the sun test histories:&lt;/p&gt;

&lt;p&gt;For instance I was trying to do some analysis on the stress memory&lt;br/&gt;
heap issue, and found:&lt;/p&gt;

&lt;p&gt;test failed on linux platform 100% time (actually I didn&apos;t check&lt;br/&gt;
every run, just did a few probes), first encountered in &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.multinet.no/~solberg/public/Apache/Derby/Limited/testSummary-370210.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.multinet.no/~solberg/public/Apache/Derby/Limited/testSummary-370210.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;3 changes happened in that test run:&lt;br/&gt;
&lt;a href=&quot;http://www.multinet.no/~solberg/public/Apache/Derby/UpdateInfo/370210.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.multinet.no/~solberg/public/Apache/Derby/UpdateInfo/370210.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Of which I would look at 370059 as it makes an ij change with respect to &lt;br/&gt;
muti-threaded ij.&lt;/p&gt;</comment>
                            <comment id="12369705" author="kartha" created="Fri, 10 Mar 2006 02:37:33 +0000"  >&lt;p&gt;As Mike suggested, I synced up to the 369956 trunk version and tried the test encryptionAll suite on the same Linux -  2.4.21-27.ELsmp (with the &lt;br/&gt;
consistent OutOf Memory failures) with  the following scenarios.&lt;/p&gt;

&lt;p&gt;1) derby jars(10.2.0.0 alpha - (369956)) and derbyTesting.jar (369956) no exceptions&lt;br/&gt;
2) derby jars(10.2.0.0 alpha - (369956)) and derbyTesting.jar (379197)  ** OutOfMemory exception ** &lt;br/&gt;
3) derby jars (10.2.0.0 alpha - (379197)) and derbyTesting.jar (369956) no exceptions&lt;br/&gt;
4) derby jars (10.2.0.0 alpha - (379197)) and derbyTesting.jar (379197) ** OutOfMemory exception ** &lt;/p&gt;

&lt;p&gt;The (379197)  is one of the  last week&apos;s jars, and from the above  seems evident that the harness change ( after 369956 (370059 ?) ) &lt;br/&gt;
is causing some sort of leak.  &lt;/p&gt;

&lt;p&gt;We need more investigation to look into what effect the usage of datasources is having on this test.   &lt;/p&gt;

&lt;p&gt;I am glad we are closing in on the real issue.&lt;/p&gt;</comment>
                            <comment id="12369910" author="deepa" created="Sat, 11 Mar 2006 03:17:18 +0000"  >&lt;p&gt;Attaching a patch &apos;derby-956-draft1.diff&apos; which I think will resolve the test failure. Attaching as draft (not to be committed) since this still needs to be tested on linux or other platform where this failure was seen.&lt;/p&gt;

&lt;p&gt;Patch changes mtTestCase.java to use the url in &quot;ij.database&quot; property instead of &quot;database&quot; property. This way the test can continue to work in j2me environment too.&lt;/p&gt;

&lt;p&gt;I have run derbyall with this patch on Windows with Sun JDK 1.4.2. No failures other than lang/wisconsin.java. I am testing it out on a linux machine but I am facing some other setup problem which I need to solve. I would appreciate if anyone who has an environment where this test fails can try this patch to see if it solves the issue.&lt;/p&gt;</comment>
                            <comment id="12369931" author="fuzzylogic" created="Sat, 11 Mar 2006 06:01:57 +0000"  >&lt;p&gt;Hi Deepa, I got access to an environment where this is failing. (Thanks Rajesh!) &lt;/p&gt;

&lt;p&gt;The patch does indeed solve the problem, and unless anyone objects, I&apos;m planning on committing it, although it would be nice if someone else with an environment where this is failing could confirm it as well. But I&apos;m left wondering why this made such a difference, and why only in certain environments. We should probably file a JIRA to followup on that.&lt;/p&gt;</comment>
                            <comment id="12369940" author="deepa" created="Sat, 11 Mar 2006 07:07:52 +0000"  >&lt;p&gt;Thanks Andrew for verifying. I have also verified this test passes with the patch (in an environment where it fails without the patch).&lt;/p&gt;

&lt;p&gt;I have not figured out from where the OutOfMemoryError comes from. Here is what I found so far. Before this patch, when stress.multi gets run as part of encryption suite, the encryption attributes were not getting added to the database URL. This was because mtTestCase.java looks for &quot;database&quot; property whereas I had changed the properties file to use &quot;ij.database&quot; instead. This was a routine thing I was doing to enable tests for j2me and never imagined it had this side-effect for the multi test till Mike tracked it down. &lt;/p&gt;

&lt;p&gt;So, the connect to the database fails and the output of running the sql files would be something like this:&lt;/p&gt;

&lt;p&gt;-------------&lt;del&gt;init.sql&lt;/del&gt;----------------&lt;br/&gt;
ERROR 08001: No suitable driver&lt;br/&gt;
ij version 10.2&lt;br/&gt;
ij&amp;gt; drop function PADSTRING;&lt;br/&gt;
IJ ERROR: Unable to establish connection&lt;/p&gt;

&lt;p&gt;The tester threads were not doing anything in this situation because they fail to get a connection itself. So we were not testing anything here. Now, it is more confuing how we can get an OutOfMemoryError in such situation. As Andrew suggested, I&apos;ll open a jira issue to track what is causing the memory error.&lt;/p&gt;</comment>
                            <comment id="12369941" author="fuzzylogic" created="Sat, 11 Mar 2006 07:13:13 +0000"  >&lt;p&gt;Committed patch to mtTestCase with revision 384946. Deepa, I&apos;ll leave it to you to file the followup JIRA. I&apos;m leaving this open until we verify that it is fixed in the tinderbox run.&lt;/p&gt;</comment>
                            <comment id="12369942" author="djd" created="Sat, 11 Mar 2006 07:13:32 +0000"  >&lt;p&gt;I&apos;ve seen this failure continually with windows and ibm142 and with the patch the test passes.&lt;/p&gt;</comment>
                            <comment id="12369953" author="deepa" created="Sat, 11 Mar 2006 10:04:29 +0000"  >&lt;p&gt;Thanks Andrew for committing this change. I checked the tinderbox run with this change and derbyall has run cleanly.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12322958" name="370061.zip" size="5580536" author="olesolberg" created="Tue, 14 Feb 2006 17:29:42 +0000"/>
                            <attachment id="12322959" name="377554.zip" size="1382412" author="olesolberg" created="Tue, 14 Feb 2006 17:35:27 +0000"/>
                            <attachment id="12324035" name="derby-956-draft1.diff" size="1192" author="deepa" created="Sat, 11 Mar 2006 03:17:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 14 Feb 2006 11:01:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22217</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0vvz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38984</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>