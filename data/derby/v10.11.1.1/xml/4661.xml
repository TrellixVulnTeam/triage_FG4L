<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:48:15 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4661/DERBY-4661.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4661] Reduce size of encoding buffer for short character values</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4661</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When inserting character values Derby converts from Java char to an on-disk encoding of UTF-8. To to this, the user stream is read and the resulting bytes after conversion are placed in a &quot;translation buffer&quot;. The default size of the buffer is 32 KB. When inserting a lot of short values, the pressure on the Java garbage collector is unnecessary high and the allocation/GC also causes a somewhat higher CPU usage.&lt;/p&gt;

&lt;p&gt;This effect of this issue can easily be reduced by sizing the buffer in the appropriate cases.&lt;/p&gt;</description>
                <environment>Inserts using setXStream(int, Reader/InputStream, int/long) for short values on character columns</environment>
        <key id="12464522">DERBY-4661</key>
            <summary>Reduce size of encoding buffer for short character values</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kristwaa">Kristian Waagan</reporter>
                        <labels>
                            <label>CLOB</label>
                    </labels>
                <created>Fri, 14 May 2010 12:54:40 +0100</created>
                <updated>Mon, 29 Nov 2010 14:21:06 +0000</updated>
                            <resolved>Tue, 25 May 2010 16:12:53 +0100</resolved>
                                    <version>10.7.1.1</version>
                                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.2.1</fixVersion>
                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12867488" author="kristwaa" created="Fri, 14 May 2010 13:09:04 +0100"  >&lt;p&gt;Attaching patch 1a.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;iapi/types/ReaderToUTF8Stream&lt;br/&gt;
The actual fix. Note the special case when the value length is zero. To avoid the issue for shorter header lengths in the future, I used Math.max instead of handling valueLength == 0 specifically.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;other classes&lt;br/&gt;
Added StreamHeaderGenerater.getMaxHdrLength() and made SQLClob use it.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Some simple tests showed a performance improvement of around 30%. Real world workloads will not see such a gain, but the fix may help heavily loaded servers somewhat where users are inserting small data values using the streaming classes.&lt;/p&gt;

&lt;p&gt;Regression tests passed.&lt;br/&gt;
Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="12867505" author="knutanders" created="Fri, 14 May 2010 15:11:06 +0100"  >&lt;p&gt;This looks like a useful improvement. A couple of minor comments:&lt;/p&gt;

&lt;p&gt;I think the code would be easier to follow if some of the magic numbers were replaced by constants or expressions. In particular:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the number 10922 could be replaced by bz/3. That would make it clearer where the number came from, and it would reduce the likelihood of bugs being introduced if we change the default buffer size later.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;using a constant (e.g., READ_BUFFER_RESERVATION) instead of the number 6 in ReaderToUTF8Stream&apos;s constructor and in fillBuffer() would make the relation between those methods easier to see.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Perhaps it would be better to call the new method in StreamHeaderGenerator getMaxHeaderLength()?&lt;/p&gt;

&lt;p&gt;The call to LimitReader.setLimit() in the lengthless constructor was made redundant by the patch. Should it be removed?&lt;/p&gt;</comment>
                            <comment id="12869546" author="kristwaa" created="Thu, 20 May 2010 11:03:33 +0100"  >&lt;p&gt;Attached patch 1b.&lt;/p&gt;

&lt;p&gt;Thanks for reviewing the patch, Knut Anders.&lt;/p&gt;

&lt;p&gt;I have addressed your suggestions, and I also made a few other changes (size logic, fixed two typos).&lt;br/&gt;
Regression tests passed (suites.All).&lt;/p&gt;

&lt;p&gt;Patch ready for a second review.&lt;/p&gt;</comment>
                            <comment id="12871060" author="knutanders" created="Tue, 25 May 2010 10:02:25 +0100"  >&lt;p&gt;Thanks for making these changes, Kristian. The 1b patch looks good to me.&lt;/p&gt;

&lt;p&gt;I assume this part of the patch was unintended, though:&lt;/p&gt;

&lt;p&gt;Property changes on: java/engine/org/apache/derby/iapi/types&lt;br/&gt;
___________________________________________________________________&lt;br/&gt;
Added: svn:ignore&lt;br/&gt;
   + .ReaderToUTF8Stream.java.swp&lt;/p&gt;</comment>
                            <comment id="12871188" author="kristwaa" created="Tue, 25 May 2010 16:11:15 +0100"  >&lt;p&gt;Yes, that change wasn&apos;t intended (my IDE did that for me).&lt;/p&gt;

&lt;p&gt;Uploaded a new rev of patch 1b, and committed it to trunk with revision 948069.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;</comment>
                            <comment id="12875560" author="kristwaa" created="Fri, 4 Jun 2010 12:08:57 +0100"  >&lt;p&gt;Backported to the 10.5 branch with revision 951363.&lt;br/&gt;
Backported to the 10.6 branch with revision 951362.&lt;/p&gt;</comment>
                            <comment id="12878547" author="kristwaa" created="Mon, 14 Jun 2010 12:55:50 +0100"  >&lt;p&gt;Closing issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12444487" name="derby-4661-1a-reduce_encoding_bz.diff" size="5496" author="kristwaa" created="Fri, 14 May 2010 13:09:04 +0100"/>
                            <attachment id="12444488" name="derby-4661-1a-reduce_encoding_bz.stat" size="366" author="kristwaa" created="Fri, 14 May 2010 13:09:04 +0100"/>
                            <attachment id="12445462" name="derby-4661-1b-reduce_encoding_bz.diff" size="7731" author="kristwaa" created="Tue, 25 May 2010 16:11:15 +0100"/>
                            <attachment id="12445046" name="derby-4661-1b-reduce_encoding_bz.diff" size="7915" author="kristwaa" created="Thu, 20 May 2010 11:03:33 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10362"><![CDATA[Performance]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 14 May 2010 14:11:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31321</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ow7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37851</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>