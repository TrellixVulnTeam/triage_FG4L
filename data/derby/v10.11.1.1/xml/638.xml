<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:25:40 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-638/DERBY-638.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-638] Network driver setTransactionIsolation() causes a commit, but does not complete it locally</title>
                <link>https://issues.apache.org/jira/browse/DERBY-638</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When autocommit is set to false, a call to setTransactionIsolation using client driver does not end the transaction when the method exits. When a close() is called on the conection, it throws an exception.&lt;/p&gt;

&lt;p&gt;Running the code below:&lt;/p&gt;

&lt;p&gt;       conn.setAutoCommit(false);&lt;br/&gt;
       conn.setTransactionIsolation(Connection.TRANSACTION_READ_COMMITTED);&lt;br/&gt;
       try&lt;/p&gt;
{
               conn.close();
       }
&lt;p&gt;catch(SQLException se)&lt;/p&gt;
{
               System.out.println(&quot;Got exception when closing the connection&quot;);
               se.printStackTrace();
       }

&lt;p&gt;with client driver gives:&lt;br/&gt;
Got exception when closing the connection&lt;br/&gt;
org.apache.derby.client.am.SqlException: java.sql.Connection.close() requested while a transaction is in progress on the connection.The transaction remains active, and the connection cannot be closed.&lt;/p&gt;

&lt;p&gt;with embedded driver, it works okay and does not throw any exception.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12318226">DERBY-638</key>
            <summary>Network driver setTransactionIsolation() causes a commit, but does not complete it locally</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bernt">Bernt M. Johnsen</assignee>
                                    <reporter username="deepa">Deepa Remesh</reporter>
                        <labels>
                    </labels>
                <created>Sat, 22 Oct 2005 04:33:59 +0100</created>
                <updated>Thu, 13 Dec 2007 09:04:44 +0000</updated>
                            <resolved>Thu, 16 Nov 2006 12:24:39 +0000</resolved>
                                    <version>10.1.3.1</version>
                    <version>10.2.1.6</version>
                    <version>10.3.1.4</version>
                                    <fixVersion>10.1.3.2</fixVersion>
                    <fixVersion>10.2.2.0</fixVersion>
                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12332725" author="deepa" created="Sat, 22 Oct 2005 04:49:57 +0100"  >&lt;p&gt;Attaching a repro for this. To run with embedded driver, use &quot;java d638&quot;. To run with client driver, start network server on port 1528 and use &quot;java d638 client&quot;. Client driver throws an exception. It should not throw this exception and should match the behaviour of embedded driver.&lt;/p&gt;</comment>
                            <comment id="12332727" author="bandaram" created="Sat, 22 Oct 2005 05:04:35 +0100"  >&lt;p&gt;I think this bug needs to be cross linked to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-310&quot; title=&quot;Document and/or change Derby client code to match behavior with Embedded driver where possible.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-310&quot;&gt;&lt;del&gt;DERBY-310&lt;/del&gt;&lt;/a&gt;, that tracks all known differences between Derby client and embedded drivers.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://issues.apache.org/jira/browse/DERBY-310&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/DERBY-310&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12447819" author="bernt" created="Tue, 7 Nov 2006 15:04:13 +0000"  >&lt;p&gt;Simple patch for this case. Ideally setTransactionIsolation should have been done with some DRDA mechanism piggybacking the next query/update and (e.g. like setQueryTimeout were done), but this would do as long as we&apos;re using statement.execute(&quot;SET CURRENT ISOLATION...&quot;);&lt;/p&gt;</comment>
                            <comment id="12448139" author="bernt" created="Wed, 8 Nov 2006 13:53:26 +0000"  >&lt;p&gt;After some investigation, I have found that this is actually three separate issues:&lt;/p&gt;

&lt;p&gt;1) There is a difference between the embedded driver where setTransacionIsolation  does not cause a commit and the nework client where setTransactionIsolation causes a commit (Side effect of using SET CURRENT ISOLATION).&lt;/p&gt;

&lt;p&gt;2) setTransactionIsolation in the network client does not do the proper householding activity wrt. this is an implicit commit and that Statement.execute(&quot;SET CURRENT ISOLATION...&quot;) is used to implement it, and hence you get the exception documented in the description&lt;/p&gt;

&lt;p&gt;3) (Small) The SQLState and error message is different when Connection.close() is done on an active transaction&lt;/p&gt;

&lt;p&gt;Suggest that 1) &amp;amp; 3) is placed into separate issues while this issue is related to 2) which is the short term fix for the reported exception. &lt;/p&gt;

&lt;p&gt;BTW: I think the attached patch si not sufficient in the general case, where there may be some open transaction when setTranascationIsolation is called, and that transaction is implicitely committed. &lt;/p&gt;</comment>
                            <comment id="12448167" author="bernt" created="Wed, 8 Nov 2006 15:23:40 +0000"  >&lt;p&gt;Simpler, cleaner, more correct.&lt;/p&gt;</comment>
                            <comment id="12448196" author="bryanpendleton" created="Wed, 8 Nov 2006 17:00:14 +0000"  >&lt;p&gt;Hi Bernt, I haven&apos;t read your code, just trying to follow the comments, but: are you proposing&lt;br/&gt;
to change the client to match the embedded behavior, or are you proposing to change&lt;br/&gt;
embedded to match the client behavior (or maybe you&apos;re proposing some 3rd thing entirely)?&lt;/p&gt;</comment>
                            <comment id="12448200" author="deepa" created="Wed, 8 Nov 2006 17:15:40 +0000"  >&lt;p&gt;Thanks Bernt for looking at this issue. &lt;/p&gt;

&lt;p&gt;Patch1 seems better to me and will match more with the embedded implementation. With patch1, we do not commit any other statements which could be executed in the meantime. But with patch2, client driver will commit everything executed before the call to setTransactionIsolation. This, I think is not expected when we have explicitly set the connection&apos;s auto-commit to false. &lt;/p&gt;

&lt;p&gt;I am attaching a modified repro &apos;d638_repro2.java&apos; which executes some statements after setting auto-commit to false and before the call to setTransactionIsolation. With patch1, both embedded and client driver show uncommitted transactions. With patch2, client driver commits everything.&lt;/p&gt;

&lt;p&gt;However, it is not clear to me what the correct behaviour should be as the JDBC spec only has recommendations for the implementation of setTransactionIsolation method. But I think it will be good to keep embedded and client behaviour similar.&lt;/p&gt;</comment>
                            <comment id="12448292" author="bernt" created="Wed, 8 Nov 2006 22:20:29 +0000"  >&lt;p&gt;Bryan: I propose that we on the short term (and in 10.2 and possibly 10.1) fix the misleading exception which this report is about, but keep the difference. And that the different behaviour will be fixed e.g. for 10.3&lt;/p&gt;

&lt;p&gt;Deepa: The current implementation will commit the active transaction. The exception is misleading, since there is no active transaction after setTransactionIsolation in the client. Try out d638_repro3.java. I agree that trying to make embedded and client behaviour similar is ideal, but neither of my patches will actually fix that. &lt;/p&gt;

&lt;p&gt;The JDBC spec just says that &quot;If this method is called during a transaction, the result is implementation-defined.&quot;&lt;/p&gt;</comment>
                            <comment id="12448320" author="deepa" created="Wed, 8 Nov 2006 23:50:42 +0000"  >&lt;p&gt;I now see the current implementation will commit the transaction in all cases. The exception was indeed misleading and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-638&quot; title=&quot;Network driver setTransactionIsolation() causes a commit, but does not complete it locally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-638&quot;&gt;&lt;del&gt;DERBY-638&lt;/del&gt;&lt;/a&gt;-v2.diff is more correct. I agree it will be good to fix  this misleading exception and open separate JIRAs for the other two issues. It will be good if the repro can be included as a test case in the patch. &lt;/p&gt;</comment>
                            <comment id="12448767" author="bernt" created="Fri, 10 Nov 2006 15:15:38 +0000"  >&lt;p&gt;Uploaded new patch (V3) whith test change that will catch changes in wether setTransactionIsolation commits or not.&lt;/p&gt;</comment>
                            <comment id="12449636" author="bernt" created="Tue, 14 Nov 2006 10:27:14 +0000"  >&lt;p&gt;Committed revision 474720.&lt;/p&gt;</comment>
                            <comment id="12450324" author="bernt" created="Thu, 16 Nov 2006 09:26:37 +0000"  >&lt;p&gt;Committed revision 475651&lt;/p&gt;</comment>
                            <comment id="12450365" author="bernt" created="Thu, 16 Nov 2006 12:09:19 +0000"  >&lt;p&gt;Backport for 10.1 branch&lt;/p&gt;</comment>
                            <comment id="12450369" author="bernt" created="Thu, 16 Nov 2006 12:24:39 +0000"  >&lt;p&gt;Backported from trunk.&lt;br/&gt;
Committed revision 475707&lt;/p&gt;</comment>
                            <comment id="12551295" author="fuzzylogic" created="Thu, 13 Dec 2007 09:04:44 +0000"  >&lt;p&gt;This issue has been resolved for over a year with no further movement. Closing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="32841">DERBY-310</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12355129">DERBY-2064</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12355583">DERBY-2084</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12344589" name="DERBY-638-v2.diff" size="776" author="bernt" created="Wed, 8 Nov 2006 15:23:40 +0000"/>
                            <attachment id="12345119" name="DERBY-638-v3-for-10.1.diff" size="6063" author="bernt" created="Thu, 16 Nov 2006 12:09:19 +0000"/>
                            <attachment id="12344762" name="DERBY-638-v3.diff" size="6214" author="bernt" created="Fri, 10 Nov 2006 15:15:38 +0000"/>
                            <attachment id="12344763" name="DERBY-638-v3.stat" size="532" author="bernt" created="Fri, 10 Nov 2006 15:15:38 +0000"/>
                            <attachment id="12344484" name="DERBY-638.diff" size="741" author="bernt" created="Tue, 7 Nov 2006 15:04:13 +0000"/>
                            <attachment id="12315033" name="d638.java" size="1017" author="deepa" created="Sat, 22 Oct 2005 04:49:43 +0100"/>
                            <attachment id="12344603" name="d638_repro2.java" size="1306" author="deepa" created="Wed, 8 Nov 2006 17:15:40 +0000"/>
                            <attachment id="12344617" name="d638_repro3.java" size="1574" author="bernt" created="Wed, 8 Nov 2006 22:21:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 22 Oct 2005 04:04:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22064</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy10gn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39725</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>