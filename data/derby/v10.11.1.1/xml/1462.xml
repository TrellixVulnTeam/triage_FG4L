<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:36:38 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1462/DERBY-1462.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1462] Test harness incorrectly catches db.lck WARNINGS generated during STORE tests and lists the tests as failed in *_fail.txt.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1462</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The following store tests from derbyall do not shutdown cleanly so leave the db.lck file on disk.  This is OK! It is done by design to test recovery.  THE PROBLEM, when run on Linux using IBM JRE 1.3.1 sp 10 the test harness &apos;sees&apos; the warnings and lists the tests as having failed.  The harness should ignore this warnings as the tests proceed and complete cleanly.&lt;/p&gt;

&lt;p&gt;Tests INCORRECLTY reported as failed:&lt;/p&gt;

&lt;p&gt;derbyall/derbynetclientmats/derbynetmats.fail:stress/stress.multi&lt;br/&gt;
derbyall/derbynetmats/derbynetmats.fail:stress/stress.multi&lt;br/&gt;
derbyall/storeall/storeall.fail:storetests/st_1.sql&lt;br/&gt;
derbyall/storeall/storeall.fail:unit/recoveryTest.unit&lt;br/&gt;
 erbyall/storeall/storeall.fail:store/LogChecksumRecovery.java&lt;br/&gt;
derbyall/storeall/storeall.fail:store/LogChecksumRecovery1.java&lt;br/&gt;
 erbyall/storeall/storeall.fail:store/MaxLogNumberRecovery.java&lt;br/&gt;
derbyall/storeall/storeall.fail:store/oc_rec1.java&lt;br/&gt;
derbyall/storeall/storeall.fail:store/oc_rec2.java&lt;br/&gt;
derbyall/storeall/storeall.fail:store/oc_rec3.java&lt;br/&gt;
derbyall/storeall/storeall.fail:store/oc_rec4.java&lt;br/&gt;
derbyall/storeall/storeall.fail:store/dropcrash.java&lt;br/&gt;
derbyall/storeall/storeall.fail:store/dropcrash2.java&lt;/p&gt;

&lt;p&gt;Example Error message:&lt;/p&gt;

&lt;p&gt;WARNING: Derby (instance xxxxFILTERED-UUIDxxxx) is attempting to boot the database csf:/local1/131TST/Store1/storeall/storerecovery/storerecovery/wombat even though Derby (instance xxxxFILTERED-UUIDxxxx) may still be active.  Only one instance of Derby should boot a database at a time. Severe and non-recoverable corruption can result and may have already occurred.&lt;/p&gt;</description>
                <environment>IBM 1.3.1 JRE for LINUX (and possibly other JRE 1.3.1 environments)</environment>
        <key id="12345168">DERBY-1462</key>
            <summary>Test harness incorrectly catches db.lck WARNINGS generated during STORE tests and lists the tests as failed in *_fail.txt.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="myrna">Myrna van Lunteren</assignee>
                                    <reporter username="stan">Stan Bradbury</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Jun 2006 07:39:13 +0100</created>
                <updated>Wed, 1 Jul 2009 01:10:10 +0100</updated>
                            <resolved>Mon, 31 Jul 2006 20:57:34 +0100</resolved>
                                    <version>10.1.2.1</version>
                    <version>10.1.3.1</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12420945" author="myrna" created="Fri, 14 Jul 2006 05:48:04 +0100"  >&lt;p&gt;I do not believe this is a test harness issue.&lt;/p&gt;

&lt;p&gt;If I run these steps with another jvm, these warnings do not appear.&lt;/p&gt;

&lt;p&gt;I experimented, and I can make the warning appear with this ibm 1.3.1 SR10 with only ij, but not with another jvm by doing the following:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;start ij:&lt;br/&gt;
   java org.apache.derby.tools.ij&lt;br/&gt;
   ij&amp;gt;connect &apos;jdbc:derby:tstdb;create=true&apos;;&lt;br/&gt;
   ij&amp;gt; create table t1 (c1 int);&lt;br/&gt;
   ij&amp;gt; disconnect;&lt;br/&gt;
   ij&amp;gt; exit;&lt;/li&gt;
	&lt;li&gt;ls tstdb and observe there is no db.lck file&lt;/li&gt;
	&lt;li&gt;start ij again, select from t, and ctrl-c out:&lt;br/&gt;
   java org.apache.derby.tools.ij&lt;br/&gt;
   ij&amp;gt; connect &apos;jdbc:derby:tstdb&apos;;&lt;br/&gt;
   ij&amp;gt; select * from t1;&lt;br/&gt;
   CTRL-C&lt;/li&gt;
	&lt;li&gt;ls tstdb and observe there is a db.lck file now&lt;/li&gt;
	&lt;li&gt;start ij again, and connect again, and see that only with ibm 1.3.1 do you see the warning.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I have no jdk131 installed on the machine I was doing this on. Maybe someone else can verify this behavior for that.&lt;/p&gt;

&lt;p&gt;I worked on making _sed.properties files for all the affected tests (for 10.2, we have one extra tests failing - st_derby715.java) but this does not work for the stress tests, and possibly this is not the right thing to do in the first place.  &lt;/p&gt;</comment>
                            <comment id="12420977" author="myrna" created="Fri, 14 Jul 2006 09:57:35 +0100"  >&lt;p&gt;cut-and-paste comment on the list by Mike Matrigali:&lt;br/&gt;
--------------- agree, I think this a problem with these particular tests on pre 1.4&lt;br/&gt;
jvms, on non windows platforms - their output is different - it would&lt;br/&gt;
not be right to somehow get&lt;br/&gt;
the harness to supress every connect warning printed.  Fixing with test&lt;br/&gt;
specific seds is fine.&lt;/p&gt;

&lt;p&gt;I checked all the tests below except for the stress ones, they all are&lt;br/&gt;
setup to run on an existing db and are coded to crash with no cleanup so&lt;br/&gt;
that subsequent test will run recovery.  A side effect of that crash on&lt;br/&gt;
pre-1.4 jvms on non windows platforms is that it leaves a lock file&lt;br/&gt;
around which derby can&apos;t tell&lt;br/&gt;
if it is an active lock file and thus the reconnect correctly prints a&lt;br/&gt;
warning in those cases.&lt;/p&gt;

&lt;p&gt;The stress ones are a little puzzling, I didn&apos;t think we reconnected to&lt;br/&gt;
the same db - I have not really looked at how we run those tests in&lt;br/&gt;
the network server framework.  Is it likely we are trying to run those&lt;br/&gt;
tests on an existing db?&lt;br/&gt;
------------------------------------&lt;/p&gt;

&lt;p&gt;I think with the stress test &amp;amp; networkserver the last tester gets interrupted because of the timeout (10 minutes), so that process leaves the db.lck behind, which will cause the final.sql to hit the WARNING, so that&apos;s to be expected too.&lt;/p&gt;</comment>
                            <comment id="12420980" author="myrna" created="Fri, 14 Jul 2006 10:07:47 +0100"  >&lt;p&gt;Attached patch for 10.2 - &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1462&quot; title=&quot;Test harness incorrectly catches db.lck WARNINGS generated during STORE tests and lists the tests as failed in *_fail.txt.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1462&quot;&gt;&lt;del&gt;DERBY-1462&lt;/del&gt;&lt;/a&gt;_102_20060713.* - adds _sed.properties files for all the tests that are listed as failing, plus for st_derby715.java which also fails.&lt;/p&gt;

&lt;p&gt;In addition, I had to modify RunTest.java to pick up the stress_sed.properties file (which was not happening because the multi test sits in a different location from the rest of the tests).&lt;/p&gt;

&lt;p&gt;Finally I modified 2 build.xmls to no longer need the copyfiles.ant - which is how other test dirs have their build.xml now. (eliminating the maintenance pain of coyfiles.ant).&lt;/p&gt;

&lt;p&gt;I ran the troublesome test suites with ibm131 and ibm142 on Linux with only failures in stress multi which appeared to be the known intermittent problem (I reran that until it passed once...) and is at least not related to this issue.&lt;/p&gt;</comment>
                            <comment id="12424390" author="myrna" created="Sun, 30 Jul 2006 15:06:22 +0100"  >&lt;p&gt;Fixing a problem in the previous patch with this one - &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1462&quot; title=&quot;Test harness incorrectly catches db.lck WARNINGS generated during STORE tests and lists the tests as failed in *_fail.txt.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1462&quot;&gt;&lt;del&gt;DERBY-1462&lt;/del&gt;&lt;/a&gt;_20060730.diff. The test store/streamingColumn.java would fail because shortbanner was not found - fixed up the build.xml.&lt;br/&gt;
Lesson to self...&lt;/p&gt;</comment>
                            <comment id="12424632" author="fuzzylogic" created="Mon, 31 Jul 2006 20:57:34 +0100"  >&lt;p&gt;Committed to trunk with revision 427237. It would be nice if there was a way that we could tag this for cleanup when it comes time to remove support with jdk1.3, like e.g. including &lt;span class=&quot;error&quot;&gt;&amp;#91;JDK13CLEANUP&amp;#93;&lt;/span&gt; in the comments.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12336836" name="DERBY-1462_102_20060713.diff" size="28929" author="myrna" created="Fri, 14 Jul 2006 10:07:47 +0100"/>
                            <attachment id="12336835" name="DERBY-1462_102_20060713.stat" size="1962" author="myrna" created="Fri, 14 Jul 2006 10:07:47 +0100"/>
                            <attachment id="12337781" name="DERBY-1462_102_20060730.diff" size="29130" author="myrna" created="Sun, 30 Jul 2006 15:06:22 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 14 Jul 2006 04:48:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22521</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0tcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38573</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>