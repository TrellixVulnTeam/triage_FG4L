<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:50:16 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2932/DERBY-2932.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2932] Connection.createClob() and Connection.createBlob() throw a procedure not found exception and do not switch to non-locator code upon soft upgrade</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2932</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description></description>
                <environment></environment>
        <key id="12373633">DERBY-2932</key>
            <summary>Connection.createClob() and Connection.createBlob() throw a procedure not found exception and do not switch to non-locator code upon soft upgrade</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="narayanan">V.Narayanan</assignee>
                                    <reporter username="narayanan">V.Narayanan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Jul 2007 15:01:59 +0100</created>
                <updated>Tue, 30 Jun 2009 16:55:46 +0100</updated>
                            <resolved>Fri, 13 Jul 2007 13:06:31 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12512102" author="narayanan" created="Thu, 12 Jul 2007 15:09:58 +0100"  >&lt;p&gt;The problem can be reproduced with the following series of steps&lt;/p&gt;

&lt;p&gt;1. Create a database with 10.2, and disconnect.&lt;br/&gt;
2. Start a 10.3 server.&lt;br/&gt;
3. get a connection and call createClob() or createBlob() methods on the&lt;br/&gt;
    connection interface.&lt;/p&gt;

&lt;p&gt;SYSIBM.BLOBCREATELOCATOR is not recognized as a function or procedure &lt;br/&gt;
is thrown upon createBlob and &lt;/p&gt;

&lt;p&gt;SYSIBM.CLOBCREATELOCATOR is not recognized as a function or procedure&lt;br/&gt;
is thrown upon doing a createClob&lt;/p&gt;</comment>
                            <comment id="12512113" author="narayanan" created="Thu, 12 Jul 2007 15:45:15 +0100"  >&lt;p&gt;The same problem can be reproduced when a 10.2 server is run&lt;br/&gt;
with a 10.3 client. In this case also the stored procedures will not be&lt;br/&gt;
present and will result in the same bug.&lt;/p&gt;</comment>
                            <comment id="12512116" author="narayanan" created="Thu, 12 Jul 2007 15:46:59 +0100"  >&lt;p&gt;CallableLocatorProcedures makes a call to the stored procedure&lt;/p&gt;

&lt;p&gt;SYSIBM.BLOBCREATELOCATOR() to get a valid Blob locator value&lt;br/&gt;
SYSIBM.CLOBCREATELOCATOR() to get a valid Clob locator value&lt;/p&gt;

&lt;p&gt;and then returns a Blob or a Clob object created using these&lt;br/&gt;
locator values.&lt;/p&gt;

&lt;p&gt;When soft-upgrade happens these stored procedures would not be present.&lt;/p&gt;

&lt;p&gt;Hence the exception thrown upon not finding the stored procedures has&lt;br/&gt;
to be caught and a non-locator LOB object has to e returned.&lt;/p&gt;

&lt;p&gt;This exception that the stored procedure is not present on the&lt;br/&gt;
server is thrown from connection.prepareCallX when the CallableStatement&lt;br/&gt;
is constructed rather than at executeX().&lt;/p&gt;

&lt;p&gt;The problem occurred because only executeX() was enclosed in the try catch&lt;br/&gt;
block and was solved by simply moving connection.prepareCallX into the&lt;br/&gt;
try catch.&lt;/p&gt;

&lt;p&gt;The above attached patch achieves the same&lt;/p&gt;

&lt;p&gt;I haven&apos;t yet run junit All on this patch. I shall run the tests&lt;br/&gt;
and revert back. However I did repeat the steps outlined to reproduce&lt;br/&gt;
this bug and did not find the exception.&lt;/p&gt;</comment>
                            <comment id="12512146" author="oysteing" created="Thu, 12 Jul 2007 16:40:36 +0100"  >&lt;p&gt;Patch looks good.  Without the patch I saw the errors reported here when I ran the jdb4/BlobTest in soft-upgrade mode.  With the patch (and the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2923&quot; title=&quot;Incorrect reading of nullable Blob/Clob columns during soft upgrade with client/server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2923&quot;&gt;&lt;del&gt;DERBY-2923&lt;/del&gt;&lt;/a&gt;), these errors has disappeared but I get the following failures:&lt;/p&gt;

&lt;p&gt;There were 2 failures:&lt;br/&gt;
1) testGetBinaryStreamCreateBlob(org.apache.derbyTesting.functionTests.tests.jdbc4.BlobTest)junit.framework.AssertionFailedError: Streams differ at index 0 expected:&amp;lt;101&amp;gt; but was:&amp;lt;-1&amp;gt;&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.assertEquals(BaseTestCase.java:302)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.jdbc4.BlobTest.testGetBinaryStreamCreateBlob(BlobTest.java:551)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
2) testGetBinaryStreamBlobUpdates(org.apache.derbyTesting.functionTests.tests.jdbc4.BlobTest)junit.framework.AssertionFailedError: Streams differ at index 0 expected:&amp;lt;-1&amp;gt; but was:&amp;lt;101&amp;gt;&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.assertEquals(BaseTestCase.java:302)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.jdbc4.BlobTest.testGetBinaryStreamBlobUpdates(BlobTest.java:604)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;br/&gt;
Tests run: 10,  Failures: 2,  Errors: 0&lt;/p&gt;

</comment>
                            <comment id="12512375" author="narayanan" created="Fri, 13 Jul 2007 07:33:06 +0100"  >&lt;p&gt;This is because soft upgrade causes the client to switch to  the old &lt;br/&gt;
behaviour. Since the stored&lt;br/&gt;
procedures related to the locator implementation are not present anymore &lt;br/&gt;
doing a getBinaryStream&lt;br/&gt;
will not return the update sensitive streams. These streams would not &lt;br/&gt;
reflect the updates in LOB&lt;br/&gt;
after a stream has been got. In both the test cases below the following &lt;br/&gt;
sequence of steps is followed.&lt;/p&gt;

&lt;p&gt;1) get a new Blob (using con.createBlob())&lt;br/&gt;
2) get a InputStream from this Blob&lt;br/&gt;
3) write data into the Blob&lt;br/&gt;
4) verify that the stream contains this&lt;br/&gt;
     data.&lt;/p&gt;

&lt;p&gt;Since 10.3 onwards due to the presence of the Update sensitive streams &lt;br/&gt;
we would get the new data.&lt;br/&gt;
However softupgrade and running with a 10.2 server would both result in &lt;br/&gt;
the new data not being&lt;br/&gt;
reflected in the streams returned.&lt;/p&gt;

&lt;p&gt;I have run tests on the attached patch and I did not see any failures.&lt;/p&gt;

&lt;p&gt;I request for this patch to be considered for reviews and comments and &lt;br/&gt;
if everything is OK a commit&lt;br/&gt;
too.&lt;/p&gt;


</comment>
                            <comment id="12512380" author="oysteing" created="Fri, 13 Jul 2007 07:45:06 +0100"  >&lt;p&gt;Narayanan, your explanation makes sense.  I agree that these errors are to be expected.  This change in behavior is explained in the release note on the locator-based implementation.&lt;/p&gt;

&lt;p&gt;As I said, the patch looks good and I have tested that it solves the described problem.&lt;br/&gt;
+1 to commit.&lt;/p&gt;</comment>
                            <comment id="12512394" author="knutanders" created="Fri, 13 Jul 2007 09:17:36 +0100"  >&lt;p&gt;Looks good to me too. Will run the tests and commit.&lt;/p&gt;</comment>
                            <comment id="12512455" author="knutanders" created="Fri, 13 Jul 2007 13:06:30 +0100"  >&lt;p&gt;Committed to 10.3 with revision 555959.&lt;br/&gt;
Merged to trunk and committed revision 555960.&lt;/p&gt;</comment>
                            <comment id="12559485" author="dyret" created="Wed, 16 Jan 2008 13:02:25 +0000"  >&lt;p&gt;Blocker issues that have been &apos;Resolved&apos; for a long time (6 months+)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12361680" name="SoftUpgrade_createClob_createBlob_v1.diff" size="3198" author="narayanan" created="Thu, 12 Jul 2007 15:46:59 +0100"/>
                            <attachment id="12361681" name="SoftUpgrade_createClob_createBlob_v1.stat" size="104" author="narayanan" created="Thu, 12 Jul 2007 15:46:59 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 12 Jul 2007 15:40:36 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23325</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0uvz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38822</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10050"><![CDATA[Blocker]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>