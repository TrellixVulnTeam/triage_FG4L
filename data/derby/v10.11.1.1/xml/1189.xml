<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:54:12 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1189/DERBY-1189.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1189] latch self deadlock when running inplace compress</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1189</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The following script , before the fix, causes online compress to attempt to latch the same page twice in a nested user transaction causing a self deadlock of the form:&lt;br/&gt;
ij&amp;gt; CALL SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE(&apos;APP&apos;, &apos;T1&apos;, 1, 1, 1);&lt;br/&gt;
ERROR 40001: A lock could not be obtained due to a deadlock, cycle of locks and&lt;br/&gt;
waiters is:&lt;br/&gt;
Lock : LATCH, T1, Page(35,Container(0, 1728))&lt;br/&gt;
  Waiting XID : &lt;/p&gt;
{385920, BaseContainerHandle:(Container(0, 1728))}
&lt;p&gt; , APP, CALL S&lt;br/&gt;
YSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE(&apos;APP&apos;, &apos;T1&apos;, 1, 1, 1)&lt;br/&gt;
  Granted XID : &lt;/p&gt;
{385920, BaseContainerHandle:(Container(0, 1728))}
&lt;p&gt;. The selected victim is XID : 385920.&lt;/p&gt;

&lt;p&gt;script that reproduces it:&lt;br/&gt;
drop table t1;&lt;br/&gt;
create table t1 (i integer primary key, j integer, c char(200));&lt;br/&gt;
insert into t1 values (1, 1, &apos;a&apos;);&lt;br/&gt;
insert into t1 (select t1.i + 2,    t1.j + 2,    t1.c from t1);&lt;br/&gt;
insert into t1 (select t1.i + 4,    t1.j + 4,    t1.c from t1);&lt;br/&gt;
insert into t1 (select t1.i + 8,    t1.j + 8,    t1.c from t1);&lt;br/&gt;
insert into t1 (select t1.i + 16,   t1.j + 16,   t1.c from t1);&lt;br/&gt;
insert into t1 (select t1.i + 32,   t1.j + 32,   t1.c from t1);&lt;br/&gt;
insert into t1 (select t1.i + 64,   t1.j + 64,   t1.c from t1);&lt;br/&gt;
insert into t1 (select t1.i + 128,  t1.j + 128,  t1.c from t1);&lt;br/&gt;
insert into t1 (select t1.i + 256,  t1.j + 256,  t1.c from t1);&lt;br/&gt;
insert into t1 (select t1.i + 512,  t1.j + 512,  t1.c from t1);&lt;br/&gt;
insert into t1 (select t1.i + 1024, t1.j + 1024, t1.c from t1);&lt;/p&gt;

&lt;p&gt;delete from t1 where j=1;&lt;/p&gt;

&lt;p&gt;CALL SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE(&apos;APP&apos;, &apos;T1&apos;, 1, 1, 1);&lt;/p&gt;

&lt;p&gt;delete from t1 where j=2;&lt;/p&gt;

&lt;p&gt;CALL SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE(&apos;APP&apos;, &apos;T1&apos;, 1, 1, 1);&lt;/p&gt;

&lt;p&gt;delete from t1 where i &amp;gt; 1024;&lt;/p&gt;

&lt;p&gt;CALL SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE(&apos;APP&apos;, &apos;T1&apos;, 1, 1, 1);&lt;/p&gt;

&lt;p&gt;delete from t1 where i &amp;lt; 512;&lt;/p&gt;

&lt;p&gt;CALL SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE(&apos;APP&apos;, &apos;T1&apos;, 1, 1, 1);&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12331748">DERBY-1189</key>
            <summary>latch self deadlock when running inplace compress</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikem">Mike Matrigali</assignee>
                                    <reporter username="mikem">Mike Matrigali</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Apr 2006 08:40:14 +0100</created>
                <updated>Wed, 12 Jul 2006 04:24:20 +0100</updated>
                            <resolved>Sat, 8 Apr 2006 01:27:49 +0100</resolved>
                                    <version>10.1.1.0</version>
                    <version>10.1.2.1</version>
                    <version>10.1.3.1</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.1.3.1</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12373557" author="mikem" created="Fri, 7 Apr 2006 08:42:39 +0100"  >&lt;p&gt;It is likely this is the same problem as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1118&quot; title=&quot;ERROR XBCA0: Cannot create new object with key Page(644,Container(0, 928))in PageCache cache. The object already exists in the cache.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1118&quot;&gt;&lt;del&gt;DERBY-1118&lt;/del&gt;&lt;/a&gt;, but I have reported as a separate issue as I did not reproduce the &lt;br/&gt;
Cache errors reported in that issue.  Once this fix is made to the trunk  I hope that the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1118&quot; title=&quot;ERROR XBCA0: Cannot create new object with key Page(644,Container(0, 928))in PageCache cache. The object already exists in the cache.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1118&quot;&gt;&lt;del&gt;DERBY-1118&lt;/del&gt;&lt;/a&gt; reporter can rerun &lt;br/&gt;
their tests to see if it is also fixed.&lt;/p&gt;</comment>
                            <comment id="12373656" author="mikem" created="Sat, 8 Apr 2006 01:27:49 +0100"  >&lt;p&gt;Checked in the fix:&lt;br/&gt;
Author: mikem&lt;br/&gt;
Date: Thu Apr  6 23:11:13 2006&lt;br/&gt;
New Revision: 392194&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewcvs?rev=392194&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=392194&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1189&quot; title=&quot;latch self deadlock when running inplace compress&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1189&quot;&gt;&lt;del&gt;DERBY-1189&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;inplace compress could self deadlock on a latch/latch conflict.  Changed&lt;br/&gt;
the insert page find code for defragment to never return a page which is&lt;br/&gt;
higher than the source page of the row.  Previously the upper level code&lt;br/&gt;
made this decision, but that was too late.  As part of the change also &lt;br/&gt;
optimized the &quot;unfilled&quot; search to be biased towards those pages near&lt;br/&gt;
the front of the container.  Checkin includes simple sql script which &lt;br/&gt;
reproduced the deadlock prior to the fix.&lt;/p&gt;



&lt;p&gt;Added:&lt;/p&gt;</comment>
                            <comment id="12374365" author="mikem" created="Fri, 14 Apr 2006 00:40:54 +0100"  >&lt;p&gt;backported trunk fix into 10.1 branch for 10.1.3 release:&lt;br/&gt;
m101_142:91&amp;gt;svn commit&lt;br/&gt;
Sending        java\engine\org\apache\derby\impl\store\raw\data\FileContainer.java&lt;br/&gt;
Adding         java\testing\org\apache\derbyTesting\functionTests\master\st_derby1189.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\suites\storetests.runall&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\storetests\copyfiles.ant&lt;br/&gt;
Adding         java\testing\org\apache\derbyTesting\functionTests\tests\storetests\st_derby1189.sql&lt;br/&gt;
Adding         java\testing\org\apache\derbyTesting\functionTests\tests\storetests\st_derby1189_app.properties&lt;br/&gt;
Transmitting file data ...&lt;br/&gt;
Committed revision 393855&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22359</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy15fz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40532</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>