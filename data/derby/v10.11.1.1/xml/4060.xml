<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:41:25 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4060/DERBY-4060.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4060] Blob.getBinaryStream(long,long) is off by one for the pos+len check</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4060</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If you have a BLOB of length 20, and call blob.getBinaryStream(11,10), it will give you an error:&lt;/p&gt;

&lt;p&gt;    java.sql.SQLException: Sum of position(&apos;11&apos;) and length(&apos;10&apos;) is greater than the size of the LOB.&lt;/p&gt;

&lt;p&gt;This is following word for word an error in the JDBC Javadoc:&lt;/p&gt;

&lt;p&gt;        SQLException - if pos is less than 1 or if pos is greater than the number of bytes in the Blob or if pos + length is greater than the number of bytes in the Blob&lt;/p&gt;

&lt;p&gt;So it&apos;s checking 11 + 10 &amp;gt; 20, but it should check 11 + 10 &amp;gt; 21    (pos + len &amp;gt; blob.length() + 1) to allow reading the last byte.&lt;/p&gt;

&lt;p&gt;The Javadoc for Clob.getCharacterStream(long,long) has similar wording so it may have the same issue.&lt;/p&gt;

&lt;p&gt;Likewise, the client driver may have the same issue &amp;#8211; I haven&apos;t yet checked.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12414899">DERBY-4060</key>
            <summary>Blob.getBinaryStream(long,long) is off by one for the pos+len check</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="trejkaz">Trejkaz</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Feb 2009 22:00:06 +0000</created>
                <updated>Wed, 12 May 2010 08:39:13 +0100</updated>
                            <resolved>Mon, 9 Mar 2009 09:54:47 +0000</resolved>
                                    <version>10.3.3.1</version>
                    <version>10.4.2.0</version>
                    <version>10.5.1.1</version>
                                    <fixVersion>10.3.3.1</fixVersion>
                    <fixVersion>10.4.2.1</fixVersion>
                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>JDBC</component>
                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12674136" author="kristwaa" created="Tue, 17 Feb 2009 08:15:27 +0000"  >&lt;p&gt;This issue is present for both Blob and Clob, and also in the client driver.&lt;/p&gt;</comment>
                            <comment id="12676971" author="kristwaa" created="Thu, 26 Feb 2009 11:44:46 +0000"  >&lt;p&gt;The patch &apos;derby-4060-1a-sub_stream_fix.diff&apos; fixes the reported bug.&lt;br/&gt;
The changes in the production code consist of subtracting one from the position when checking against the length.&lt;br/&gt;
Using the example from the report;&lt;br/&gt;
 o current: 11 + 10 &amp;gt; 20 = true (exception thrown)&lt;br/&gt;
 o with patch: (11 -1) + 10 &amp;gt; 20 = false (check passes)&lt;/p&gt;

&lt;p&gt;I made some more changes to the test code. Three tests were added, one for Blob and two for Clob (one Clob loaded with latin chars only, one loaded with CJK chars).&lt;br/&gt;
In addition, CharAlphabet-objects cannot be shared between readers. I dealt with this by adding getClone method to the CharAlphabet-class, and getting a clone when creating the LoopingAlphabetReader. This should maybe be changed in a more robust way.&lt;br/&gt;
It should also be noted that the method draining the stream and returning the last byte/char, performs more checks than usual.&lt;/p&gt;

&lt;p&gt;Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="12677927" author="kristwaa" created="Mon, 2 Mar 2009 08:48:31 +0000"  >&lt;p&gt;Attached an updated patch, adding two more comments.&lt;/p&gt;</comment>
                            <comment id="12677928" author="kristwaa" created="Mon, 2 Mar 2009 08:49:32 +0000"  >&lt;p&gt;Committed patch 1b to trunk with revision 749235.&lt;/p&gt;</comment>
                            <comment id="12677931" author="kristwaa" created="Mon, 2 Mar 2009 09:05:16 +0000"  >&lt;p&gt;The fix seems to merge cleanly with both 10.4 and 10.3 (I haven&apos;t run tests yet).&lt;br/&gt;
I&apos;ll wait for a few days to see if any comments or problems show up, and if not I&apos;ll backport the fix.&lt;/p&gt;</comment>
                            <comment id="12678268" author="knutanders" created="Tue, 3 Mar 2009 09:25:48 +0000"  >&lt;p&gt;Should we also update the javadoc comments in EmbedBlob and EmbedClob (they still say that we throw SQLException if pos+length is greater than the number of bytes/characters)?&lt;/p&gt;

&lt;p&gt;Same goes for the error message (XJ087.S) which says &quot;Sum of position(&apos;&lt;/p&gt;
{0}
&lt;p&gt;&apos;) and length(&apos;&lt;/p&gt;
{1}
&lt;p&gt;&apos;) is greater than the size of the LOB.&quot;&lt;/p&gt;</comment>
                            <comment id="12678688" author="kristwaa" created="Wed, 4 Mar 2009 11:02:35 +0000"  >&lt;p&gt;Thank you for the comment, Knut Anders.&lt;br/&gt;
Patch 2a changes the JavaDoc and the error message.&lt;br/&gt;
Feel free to comment on the wording.&lt;/p&gt;

&lt;p&gt;I plan to commit this on Monday.&lt;br/&gt;
Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="12678719" author="knutanders" created="Wed, 4 Mar 2009 12:46:40 +0000"  >&lt;p&gt;The patch looks good to me. (I was wondering what we should do with the translations, but it appears that we are only required to do something if the message parameters are changed, see comment near the top of messages.xml. For now it&apos;s probably better to leave the (possibly inaccurate) translated messages than to remove them.)&lt;/p&gt;</comment>
                            <comment id="12679143" author="kristwaa" created="Thu, 5 Mar 2009 10:29:38 +0000"  >&lt;p&gt;Backported patch 1b to 10.4 with revision 750409 and to 10.3 with revision 750410.&lt;/p&gt;</comment>
                            <comment id="12680104" author="kristwaa" created="Mon, 9 Mar 2009 09:54:47 +0000"  >&lt;p&gt;Committed patch 2a to trunk with revision 751637.&lt;br/&gt;
Backported to 10.4 and 10.3 with revisions 751639 and 751640.&lt;/p&gt;

&lt;p&gt;This concludes my work on this issue.&lt;/p&gt;</comment>
                            <comment id="12866493" author="kristwaa" created="Wed, 12 May 2010 08:39:13 +0100"  >&lt;p&gt;Been resolved for more than a year. Closing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12401023" name="derby-4060-1a-sub_stream_fix.diff" size="14874" author="kristwaa" created="Thu, 26 Feb 2009 11:44:46 +0000"/>
                            <attachment id="12401024" name="derby-4060-1a-sub_stream_fix.stat" size="532" author="kristwaa" created="Thu, 26 Feb 2009 11:44:46 +0000"/>
                            <attachment id="12401223" name="derby-4060-1b-sub_stream_fix.diff" size="15307" author="kristwaa" created="Mon, 2 Mar 2009 08:48:31 +0000"/>
                            <attachment id="12401398" name="derby-4060-2a-doc_changes.diff" size="4012" author="kristwaa" created="Wed, 4 Mar 2009 11:02:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 17 Feb 2009 08:15:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24000</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0qbz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38084</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>