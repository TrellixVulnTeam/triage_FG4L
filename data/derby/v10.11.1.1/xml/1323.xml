<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:40:31 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1323/DERBY-1323.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1323] Detectability methods rowUpdated, rowInserted, rowDeleted can be called from illegal states in both clients</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1323</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Please see enclosed repro.&lt;/p&gt;

&lt;p&gt;These detectability methods fail to check that they can be called in&lt;br/&gt;
some states. In the repro, calls are allowed while on insert row and&lt;br/&gt;
when after last row. These should both fail. Both clients have the&lt;br/&gt;
same problem. All three detectability methods have the same problem.&lt;br/&gt;
(repro only shows it for a subset of the cases).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12334154">DERBY-1323</key>
            <summary>Detectability methods rowUpdated, rowInserted, rowDeleted can be called from illegal states in both clients</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 May 2006 22:51:48 +0100</created>
                <updated>Tue, 30 Jun 2009 17:12:48 +0100</updated>
                            <resolved>Tue, 23 May 2006 19:45:38 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>JDBC</component>
                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12402259" author="dagw" created="Mon, 15 May 2006 11:08:51 +0100"  >&lt;p&gt;This patch adds checks for the cases described below, for both&lt;br/&gt;
clients, in the JDBC ResultSet API methods rowUpdated, rowDeleted and&lt;br/&gt;
rowInserted.&lt;/p&gt;

&lt;p&gt;In all cases, the exception &quot;no current row&quot; (SQLState 24000) is&lt;br/&gt;
thrown. A new test has been added to jdbcapi/SURTest.java to exercise&lt;br/&gt;
all cases.&lt;/p&gt;

&lt;p&gt;The JDBC API and specification does not state explicitly what to do in&lt;br/&gt;
these situations, as far as I can see.  For the &quot;forward only&quot; case, a&lt;br/&gt;
slight, albeit unlikely regression is introduced. I will back out this&lt;br/&gt;
change if people think it is risky. I view it as a correction, though.&lt;br/&gt;
This is the reason for the changed master files for&lt;br/&gt;
lang/updatableResultSet.java.&lt;/p&gt;

&lt;p&gt;Now, the cases:&lt;/p&gt;

&lt;p&gt;For result sets of type TYPE_SCROLL_INSENSITIVE and CONCUR_UPDATABLE:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;before positioning&lt;/li&gt;
	&lt;li&gt;on insertRow&lt;/li&gt;
	&lt;li&gt;on beforeFirst row&lt;/li&gt;
	&lt;li&gt;on afterLast row&lt;/li&gt;
	&lt;li&gt;after deleteRow, before new positioning&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;For result sets of type TYPE_FORWARD_ONLY and CONCUR_UPDATABLE:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;before positioning (***)&lt;/li&gt;
	&lt;li&gt;on insertRow&lt;/li&gt;
	&lt;li&gt;after updateRow, before new positioning &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/li&gt;
	&lt;li&gt;after deleteRow, before new positioning (**)&lt;/li&gt;
	&lt;li&gt;after rs emptied out (***)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Detectability is currently not implemented for &quot;forward only&quot; result&lt;br/&gt;
sets and the methods always used to return false, even in the states&lt;br/&gt;
indicated. The new checks added by this patch (needed for scrollable&lt;br/&gt;
result sets) introduce a slight regression, in that calls may now&lt;br/&gt;
throw an exception. Cases &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and (**) broke the regression test as&lt;br/&gt;
mentioned, but I think the use of detection methods in these states is&lt;br/&gt;
rather meaningless, since Derby can no longer access a row in these&lt;br/&gt;
cases anyway - until a next() is performed. Even less problematic&lt;br/&gt;
should be &lt;/p&gt;
{TYPE_FORWARD_ONLY, CONCUR_READ_ONLY}
&lt;p&gt; in the cases (***).&lt;/p&gt;

&lt;p&gt;I have run derbyall with no related errors and the patch is ready for&lt;br/&gt;
review.&lt;/p&gt;</comment>
                            <comment id="12411942" author="fernanda" created="Tue, 16 May 2006 19:29:00 +0100"  >&lt;p&gt;Review:&lt;/p&gt;

&lt;p&gt;The patch looks good. I just have a couple of questions.&lt;/p&gt;

&lt;p&gt;1. java/client/org/apache/derby/client/am/ResultSet.java&lt;/p&gt;

&lt;p&gt;This check has been added in several places:&lt;/p&gt;

&lt;p&gt;+            if (isOnInsertRow_ || !isValidCursorPosition_) &lt;/p&gt;
{
+                throw new SqlException
+                    (agent_.logWriter_, 
+                     new ClientMessageId(SQLState.NO_CURRENT_ROW));
+            }

&lt;p&gt;Could it be put in a private method? &lt;/p&gt;

&lt;p&gt;2. java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/SURTest.java&lt;/p&gt;

&lt;p&gt;Is it really necessary to use reflection?&lt;/p&gt;</comment>
                            <comment id="12412442" author="dagw" created="Fri, 19 May 2006 07:09:33 +0100"  >&lt;p&gt;This is version 2 of this patch. It addresses both comments of Fernanda&apos;s review.&lt;br/&gt;
Changes were only made to client code and SURTest.java, so i ran&lt;br/&gt;
derbynetclientmats again as well as SURTest on embedded without &lt;br/&gt;
problems&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; derbynetclientmats failed on NSinSameJVM.java and DerbyNetNewServer,&lt;br/&gt;
though - I don&apos;t think it is related; I ran on a sane build from the classes directory with &lt;br/&gt;
Sun JDK 1.5.&lt;/p&gt;</comment>
                            <comment id="12412784" author="fernanda" created="Mon, 22 May 2006 22:49:39 +0100"  >&lt;p&gt;All of my comments have been addressed in the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1323&quot; title=&quot;Detectability methods rowUpdated, rowInserted, rowDeleted can be called from illegal states in both clients&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1323&quot;&gt;&lt;del&gt;DERBY-1323&lt;/del&gt;&lt;/a&gt;-2.diff. &lt;/p&gt;

&lt;p&gt;The following changes seem unnecessary to me:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;br/&gt;
+            checkForClosedResultSet();&lt;br/&gt;
+            checkPositionedOnPlainRow();&lt;br/&gt;
+&lt;br/&gt;
             boolean rowInserted = false;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;checkForClosedResultSet();&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/li&gt;
	&lt;li&gt;boolean rowDeleted = (resultSetType_ == ResultSet.TYPE_SCROLL_INSENSITIVE) ?&lt;/li&gt;
	&lt;li&gt;cursor_.getIsUpdateDeleteHole() :&lt;/li&gt;
	&lt;li&gt;false;&lt;br/&gt;
+            boolean rowDeleted = &lt;br/&gt;
+                (resultSetType_ == ResultSet.TYPE_SCROLL_INSENSITIVE) ?&lt;br/&gt;
+                cursor_.getIsUpdateDeleteHole() : false;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I have seen comments against cosmetic changes before, but I am not sure we have a policy against it.&lt;/p&gt;</comment>
                            <comment id="12412918" author="bernt" created="Tue, 23 May 2006 19:45:38 +0100"  >&lt;p&gt;Committed revision 408875.&lt;/p&gt;</comment>
                            <comment id="12435504" author="dagw" created="Mon, 18 Sep 2006 16:52:48 +0100"  >&lt;p&gt;Release note for this issue:&lt;/p&gt;


&lt;p&gt;PROBLEM&lt;/p&gt;

&lt;p&gt;For a JDBC ResultSet with type TYPE_FORWARD_ONLY, the methods&lt;br/&gt;
rowUpdated, rowDeleted and rowInserted could previously be called&lt;br/&gt;
while not on a row, i.e. before positioning in the result set, while&lt;br/&gt;
on insertRow, after updateRow before new positioning, after deleteRow&lt;br/&gt;
before new positioning and when after last row. This is now&lt;br/&gt;
disallowed.&lt;/p&gt;

&lt;p&gt;SYMPTOMS&lt;/p&gt;

&lt;p&gt;Calls to any of these methods while not on a row will now throw&lt;br/&gt;
SQLException with SQLState 24000.&lt;/p&gt;

&lt;p&gt;CAUSE&lt;/p&gt;

&lt;p&gt;Derby now disallows these calls when not on a row.&lt;/p&gt;

&lt;p&gt;SOLUTION&lt;/p&gt;

&lt;p&gt;Change the application to not call these methods unless on a row. Note&lt;br/&gt;
that using them at all is rather meaningless for a ResultSet of type&lt;br/&gt;
TYPE_FORWARD_ONLY since the returned result will always be &apos;false&apos;.&lt;br/&gt;
This is because once you modify a row, it can no longer be accessed,&lt;br/&gt;
you need to move to the next row, if there is one, to get a new&lt;br/&gt;
current row. Presently in Derby, these methods are only really&lt;br/&gt;
meaningfully useed for result sets of type TYPE_SCROLL_INSENSITIVE and&lt;br/&gt;
of concurrency CONCUR_UPDATABLE in which case updated and deleted rows&lt;br/&gt;
can be detected.&lt;/p&gt;

&lt;p&gt;WORKAROUND&lt;/p&gt;

&lt;p&gt;None.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12331894" name="DERBY-1323-1.diff" size="19198" author="dagw" created="Mon, 15 May 2006 11:08:51 +0100"/>
                            <attachment id="12331893" name="DERBY-1323-1.stat" size="961" author="dagw" created="Mon, 15 May 2006 11:08:51 +0100"/>
                            <attachment id="12334297" name="DERBY-1323-2.diff" size="19491" author="dagw" created="Fri, 19 May 2006 07:09:33 +0100"/>
                            <attachment id="12334296" name="DERBY-1323-2.stat" size="961" author="dagw" created="Fri, 19 May 2006 07:09:33 +0100"/>
                            <attachment id="12327416" name="Main.java" size="7748" author="dagw" created="Fri, 12 May 2006 22:53:31 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 16 May 2006 18:29:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22436</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10101"><![CDATA[Release Note Needed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0uhr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38758</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>