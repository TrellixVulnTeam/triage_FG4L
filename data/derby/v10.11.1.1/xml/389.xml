<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:13:07 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-389/DERBY-389.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-389] With Network Server Database hangs after some time with many connections executing prepareStatement()</title>
                <link>https://issues.apache.org/jira/browse/DERBY-389</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Rajesh found this issue in running Network Server system tests for the 10.1 release candidate&lt;/p&gt;

&lt;p&gt;While running the Network Server system test with 210 clients, &lt;br/&gt;
the  Network Server and all the clients hangs after some time. &lt;br/&gt;
A Ctrl+\ on the Network Server shows that upto 180 threads &lt;br/&gt;
waiting on the PreparedStatements to compile and comes from the &lt;br/&gt;
embedded engine. The following is the stack trace from the java &lt;br/&gt;
dump.&lt;/p&gt;

&lt;p&gt;3XMTHREADINFO      &quot;DRDAConnThread_181&quot; (TID:1007C998, &lt;br/&gt;
sys_thread_t:85C4478, state:CW, native ID:4575ABB0) prio=5&lt;br/&gt;
4XESTACKTRACE          at java.lang.Object.wait(Native Method)&lt;br/&gt;
4XESTACKTRACE          at &lt;br/&gt;
java.lang.Object.wait(Object.java(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at &lt;br/&gt;
org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericSta&lt;br/&gt;
tement.java(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at &lt;br/&gt;
org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatem&lt;br/&gt;
ent.java)&lt;br/&gt;
4XESTACKTRACE          at &lt;br/&gt;
org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.&lt;br/&gt;
prepareInternalStatement(GenericLanguageConnectionContext.java)&lt;/p&gt;

&lt;p&gt;4XESTACKTRACE          at &lt;br/&gt;
org.apache.derby.impl.jdbc.EmbedPreparedStatement.&amp;lt;init&amp;gt;(Embe&lt;br/&gt;
dPreparedStatement.java)&lt;br/&gt;
4XESTACKTRACE          at &lt;br/&gt;
org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&amp;lt;init&amp;gt;(Em&lt;br/&gt;
bedPreparedStatement20.java)&lt;br/&gt;
4XESTACKTRACE          at &lt;br/&gt;
org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&amp;lt;init&amp;gt;(Em&lt;br/&gt;
bedPreparedStatement30.java)&lt;br/&gt;
4XESTACKTRACE          at &lt;br/&gt;
org.apache.derby.jdbc.Driver30.newEmbedPreparedStatement(Driver3&lt;br/&gt;
0.java)&lt;br/&gt;
4XESTACKTRACE          at &lt;br/&gt;
org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Embe&lt;br/&gt;
dConnection.java)&lt;br/&gt;
4XESTACKTRACE          at &lt;br/&gt;
org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Embe&lt;br/&gt;
dConnection.java)&lt;br/&gt;
4XESTACKTRACE          at &lt;br/&gt;
sun.reflect.GeneratedMethodAccessor3.invoke(Unknown Source)&lt;br/&gt;
4XESTACKTRACE          at &lt;br/&gt;
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethod&lt;br/&gt;
AccessorImpl.java(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at &lt;br/&gt;
java.lang.reflect.Method.invoke(Method.java(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at &lt;br/&gt;
org.apache.derby.impl.drda.DRDAStatement.prepareStatementJDBC3(D&lt;br/&gt;
RDAStatement.java)&lt;br/&gt;
4XESTACKTRACE          at &lt;br/&gt;
org.apache.derby.impl.drda.DRDAStatement.prepare(DRDAStatement.j&lt;br/&gt;
ava)&lt;br/&gt;
4XESTACKTRACE          at &lt;br/&gt;
org.apache.derby.impl.drda.DRDAStatement.explicitPrepare(DRDASta&lt;br/&gt;
tement.java(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at &lt;br/&gt;
org.apache.derby.impl.drda.DRDAConnThread.parsePRPSQLSTT(DRDACon&lt;br/&gt;
nThread.java(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at &lt;br/&gt;
org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDACo&lt;br/&gt;
nnThread.java(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at &lt;br/&gt;
org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.jav&lt;br/&gt;
a)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12311643">DERBY-389</key>
            <summary>With Network Server Database hangs after some time with many connections executing prepareStatement()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kmarsden">Kathey Marsden</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Jun 2005 22:38:49 +0100</created>
                <updated>Fri, 16 Sep 2005 05:29:12 +0100</updated>
                            <resolved>Fri, 22 Jul 2005 23:09:02 +0100</resolved>
                                    <version>10.1.1.0</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.1.1.0</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>JDBC</component>
                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12314318" author="kmarsden" created="Thu, 23 Jun 2005 22:44:49 +0100"  >&lt;p&gt;This is the java core file.  I do not yet have  a repro I can attach.&lt;/p&gt;</comment>
                            <comment id="12314319" author="kmarsden" created="Thu, 23 Jun 2005 22:55:24 +0100"  >&lt;p&gt;Rajesh, could you please try a run with your test with a sane debug build and attach the core file and runtimeinfo to this Jira entry?&lt;/p&gt;</comment>
                            <comment id="12314350" author="kmarsden" created="Fri, 24 Jun 2005 05:38:24 +0100"  >&lt;p&gt;Manjula sent me  this trace when the server was in a similar state,  &lt;/p&gt;

&lt;p&gt; &quot;DRDAConnThread_7&quot; prio=5 tid=0x0ae97d18 nid=0x988 waiting for monitor entry [0x&lt;br/&gt;
0bdcf000..0x0bdcf9e4]&lt;br/&gt;
        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.remov&lt;br/&gt;
eStatement(GenericLanguageConnectionContext.java)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x02fdfcd0&amp;gt; (a org.apache.derby.impl.services.cache.C&lt;br/&gt;
lock)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatemen&lt;br/&gt;
t.java)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.j&lt;br/&gt;
ava)&lt;br/&gt;
        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepa&lt;br/&gt;
reInternalStatement(GenericLanguageConnectionContext.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&amp;lt;init&amp;gt;(EmbedPrepare&lt;br/&gt;
dStatement.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&amp;lt;init&amp;gt;(EmbedPrepa&lt;br/&gt;
redStatement20.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&amp;lt;init&amp;gt;(EmbedPrepa&lt;br/&gt;
redStatement30.java)&lt;br/&gt;
        at org.apache.derby.jdbc.Driver30.newEmbedPreparedStatement(Driver30.jav&lt;br/&gt;
a)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConn&lt;br/&gt;
ection.java)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x03db03e0&amp;gt; (a org.apache.derby.impl.jdbc.EmbedConnection30)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConn&lt;br/&gt;
ection.java)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor10.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces&lt;br/&gt;
sorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAStatement.prepareStatementJDBC3(DRDASt&lt;br/&gt;
atement.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAStatement.prepare(DRDAStatement.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAStatement.explicitPrepare(DRDAStatemen&lt;br/&gt;
t.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.parsePRPSQLSTT(DRDAConnThre&lt;br/&gt;
ad.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThr&lt;br/&gt;
ead.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;DRDAConnThread_6&quot; prio=5 tid=0x0aeb8d28 nid=0x998 in Object.wait() [0x0bd8f000.&lt;br/&gt;
.0x0bd8fa64]&lt;br/&gt;
        at java.lang.Object.wait(Native Method)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting on &amp;lt;0x03db4a78&amp;gt; (a org.apache.derby.impl.services.cache.Cached&lt;br/&gt;
Item)&lt;br/&gt;
        at java.lang.Object.wait(Object.java:474)&lt;br/&gt;
        at org.apache.derby.impl.services.cache.CachedItem.remove(CachedItem.jav&lt;br/&gt;
a)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x03db4a78&amp;gt; (a org.apache.derby.impl.services.cache.CachedItem&lt;br/&gt;
)&lt;br/&gt;
        at org.apache.derby.impl.services.cache.Clock.remove(Clock.java)&lt;br/&gt;
        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.remov&lt;br/&gt;
eStatement(GenericLanguageConnectionContext.java)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x02fdfcd0&amp;gt; (a org.apache.derby.impl.services.cache.Clock)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatemen&lt;br/&gt;
t.java)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.j&lt;br/&gt;
ava)&lt;br/&gt;
        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepa&lt;br/&gt;
reInternalStatement(GenericLanguageConnectionContext.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&amp;lt;init&amp;gt;(EmbedPrepare&lt;br/&gt;
dStatement.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&amp;lt;init&amp;gt;(EmbedPrepa&lt;br/&gt;
redStatement20.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&amp;lt;init&amp;gt;(EmbedPrepa&lt;br/&gt;
redStatement30.java)&lt;br/&gt;
        at org.apache.derby.jdbc.Driver30.newEmbedPreparedStatement(Driver30.jav&lt;br/&gt;
a)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConn&lt;br/&gt;
ection.java)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x03db5ad8&amp;gt; (a org.apache.derby.impl.jdbc.EmbedConnection30)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConn&lt;br/&gt;
ection.java)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor10.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces&lt;br/&gt;
sorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAStatement.prepareStatementJDBC3(DRDASt&lt;br/&gt;
atement.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAStatement.prepare(DRDAStatement.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAStatement.explicitPrepare(DRDAStatemen&lt;br/&gt;
t.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.parsePRPSQLSTT(DRDAConnThre&lt;br/&gt;
ad.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThr&lt;br/&gt;
ead.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;DRDAConnThread_5&quot; prio=5 tid=0x0adb94c8 nid=0x9a8 waiting for monitor entry [0x&lt;br/&gt;
0bd4f000..0x0bd4fae4]&lt;br/&gt;
        at org.apache.derby.impl.services.cache.Clock.find(Clock.java)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x02fdfcd0&amp;gt; (a org.apache.derby.impl.services.cache.C&lt;br/&gt;
lock)&lt;br/&gt;
        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.looku&lt;br/&gt;
pStatement(GenericLanguageConnectionContext.java)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatemen&lt;br/&gt;
t.java)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.j&lt;br/&gt;
ava)&lt;br/&gt;
        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepa&lt;br/&gt;
reInternalStatement(GenericLanguageConnectionContext.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java&lt;br/&gt;
)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x03e07518&amp;gt; (a org.apache.derby.impl.jdbc.EmbedConnection30)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(EmbedStatemen&lt;br/&gt;
t.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLIMM(DRDAConnThre&lt;br/&gt;
ad.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThr&lt;br/&gt;
ead.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;DRDAConnThread_4&quot; prio=5 tid=0x009febe8 nid=0x9c0 waiting for monitor entry [0x&lt;br/&gt;
0bd0f000..0x0bd0fb64]&lt;br/&gt;
        at org.apache.derby.impl.services.cache.Clock.find(Clock.java)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x02fdfcd0&amp;gt; (a org.apache.derby.impl.services.cache.C&lt;br/&gt;
lock)&lt;br/&gt;
        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.looku&lt;br/&gt;
pStatement(GenericLanguageConnectionContext.java)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatemen&lt;br/&gt;
t.java)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.j&lt;br/&gt;
ava)&lt;br/&gt;
        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepa&lt;br/&gt;
reInternalStatement(GenericLanguageConnectionContext.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&amp;lt;init&amp;gt;(EmbedPrepare&lt;br/&gt;
dStatement.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&amp;lt;init&amp;gt;(EmbedPrepa&lt;br/&gt;
redStatement20.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&amp;lt;init&amp;gt;(EmbedPrepa&lt;br/&gt;
redStatement30.java)&lt;br/&gt;
        at org.apache.derby.jdbc.Driver30.newEmbedPreparedStatement(Driver30.jav&lt;br/&gt;
a)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConn&lt;br/&gt;
ection.java)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x03dbd7f8&amp;gt; (a org.apache.derby.impl.jdbc.EmbedConnection30)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConn&lt;br/&gt;
ection.java)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor10.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces&lt;br/&gt;
sorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAStatement.prepareStatementJDBC3(DRDASt&lt;br/&gt;
atement.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAStatement.prepare(DRDAStatement.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAStatement.explicitPrepare(DRDAStatemen&lt;br/&gt;
t.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.parsePRPSQLSTT(DRDAConnThre&lt;br/&gt;
ad.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThr&lt;br/&gt;
ead.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;DRDAConnThread_3&quot; prio=5 tid=0x0ba4b5b8 nid=0x9d0 waiting for monitor entry [0x&lt;br/&gt;
0bccf000..0x0bccfbe4]&lt;br/&gt;
        at org.apache.derby.impl.services.cache.Clock.find(Clock.java)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x02fdfcd0&amp;gt; (a org.apache.derby.impl.services.cache.C&lt;br/&gt;
lock)&lt;br/&gt;
        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.looku&lt;br/&gt;
pStatement(GenericLanguageConnectionContext.java)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatemen&lt;br/&gt;
t.java)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.j&lt;br/&gt;
ava)&lt;br/&gt;
        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepa&lt;br/&gt;
reInternalStatement(GenericLanguageConnectionContext.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java&lt;br/&gt;
)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x03e078d8&amp;gt; (a org.apache.derby.impl.jdbc.EmbedConnection30)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(EmbedStatemen&lt;br/&gt;
t.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLIMM(DRDAConnThre&lt;br/&gt;
ad.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThr&lt;br/&gt;
ead.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;derby.rawStoreDaemon&quot; daemon prio=5 tid=0x0ad29d68 nid=0x9d8 in Object.wait() [&lt;br/&gt;
0x0b88f000..0x0b88fc64]&lt;br/&gt;
        at java.lang.Object.wait(Native Method)&lt;br/&gt;
        at org.apache.derby.impl.services.daemon.BasicDaemon.rest(BasicDaemon.ja&lt;br/&gt;
va)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;locked &amp;lt;0x02fcf1e0&amp;gt; (a org.apache.derby.impl.services.daemon.BasicDaem&lt;br/&gt;
on)&lt;br/&gt;
        at org.apache.derby.impl.services.daemon.BasicDaemon.run(BasicDaemon.jav&lt;br/&gt;
a)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:595)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;DRDAConnThread_2&quot; prio=5 tid=0x0ae1e448 nid=0x9e0 waiting for monitor entry [0x&lt;br/&gt;
0b84f000..0x0b84fce4]&lt;br/&gt;
        at org.apache.derby.impl.services.cache.Clock.release(Clock.java)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x02fdfcd0&amp;gt; (a org.apache.derby.impl.services.cache.C&lt;br/&gt;
lock)&lt;br/&gt;
        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.looku&lt;br/&gt;
pStatement(GenericLanguageConnectionContext.java)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatemen&lt;br/&gt;
t.java)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.j&lt;br/&gt;
ava)&lt;br/&gt;
        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepa&lt;br/&gt;
reInternalStatement(GenericLanguageConnectionContext.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&amp;lt;init&amp;gt;(EmbedPrepare&lt;br/&gt;
dStatement.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&amp;lt;init&amp;gt;(EmbedPrepa&lt;br/&gt;
redStatement20.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&amp;lt;init&amp;gt;(EmbedPrepa&lt;br/&gt;
redStatement30.java)&lt;br/&gt;
        at org.apache.derby.jdbc.Driver30.newEmbedPreparedStatement(Driver30.jav&lt;br/&gt;
a)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConn&lt;br/&gt;
ection.java)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x03dca718&amp;gt; (a org.apache.derby.impl.jdbc.EmbedConnection30)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConn&lt;br/&gt;
ection.java)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor10.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces&lt;br/&gt;
sorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAStatement.prepareStatementJDBC3(DRDASt&lt;br/&gt;
atement.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAStatement.prepare(DRDAStatement.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAStatement.explicitPrepare(DRDAStatemen&lt;br/&gt;
t.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.parsePRPSQLSTT(DRDAConnThre&lt;br/&gt;
ad.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThr&lt;br/&gt;
ead.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;Thread-1&quot; prio=5 tid=0x0ad8cde8 nid=0xa54 runnable &lt;span class=&quot;error&quot;&gt;&amp;#91;0x0b7ff000..0x0b7ffd64&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.net.PlainSocketImpl.socketAccept(Native Method)&lt;br/&gt;
        at java.net.PlainSocketImpl.accept(PlainSocketImpl.java:384)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;locked &amp;lt;0x02faf708&amp;gt; (a java.net.SocksSocketImpl)&lt;br/&gt;
        at java.net.ServerSocket.implAccept(ServerSocket.java:450)&lt;br/&gt;
        at java.net.ServerSocket.accept(ServerSocket.java:421)&lt;br/&gt;
        at org.apache.derby.impl.drda.ClientThread$1.run(ClientThread.java)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
        at org.apache.derby.impl.drda.ClientThread.run(ClientThread.java)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:595)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;derby.antiGC&quot; daemon prio=2 tid=0x0ad2cc40 nid=0xa5c in Object.wait() [0x0af3f0&lt;br/&gt;
00..0x0af3f9e4]&lt;br/&gt;
        at java.lang.Object.wait(Native Method)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting on &amp;lt;0x02fa2150&amp;gt; (a org.apache.derby.impl.services.monitor.Anti&lt;br/&gt;
GC)&lt;br/&gt;
        at java.lang.Object.wait(Object.java:474)&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.AntiGC.run(BaseMonitor.java)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x02fa2150&amp;gt; (a org.apache.derby.impl.services.monitor.AntiGC)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:595)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;Low Memory Detector&quot; daemon prio=5 tid=0x009d2f60 nid=0x5cc runnable [0x0000000&lt;br/&gt;
0..0x00000000]&lt;/p&gt;

&lt;p&gt;&quot;CompilerThread0&quot; daemon prio=10 tid=0x009d1ac0 nid=0xa68 waiting on condition [&lt;br/&gt;
0x00000000..0x0ac6f8bc]&lt;/p&gt;

&lt;p&gt;&quot;Signal Dispatcher&quot; daemon prio=10 tid=0x009d0cf8 nid=0x6d8 waiting on condition&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00000000..0x00000000&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&quot;Finalizer&quot; daemon prio=9 tid=0x009c81a8 nid=0x17c in Object.wait() [0x0abef000.&lt;br/&gt;
.0x0abefc64]&lt;br/&gt;
        at java.lang.Object.wait(Native Method)&lt;br/&gt;
        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:116)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;locked &amp;lt;0x02f82798&amp;gt; (a java.lang.ref.ReferenceQueue$Lock)&lt;br/&gt;
        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:132)&lt;br/&gt;
        at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;Reference Handler&quot; daemon prio=10 tid=0x009c6cb8 nid=0xa6c in Object.wait() [0x&lt;br/&gt;
0abaf000..0x0abafce4]&lt;br/&gt;
        at java.lang.Object.wait(Native Method)&lt;br/&gt;
        at java.lang.Object.wait(Object.java:474)&lt;br/&gt;
        at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:116)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;locked &amp;lt;0x02f82818&amp;gt; (a java.lang.ref.Reference$Lock)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;main&quot; prio=5 tid=0x00236e80 nid=0x6dc in Object.wait() &lt;span class=&quot;error&quot;&gt;&amp;#91;0x0006f000..0x0006fc38&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;        at java.lang.Object.wait(Native Method)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting on &amp;lt;0x02f996d0&amp;gt; (a java.lang.Object)&lt;br/&gt;
        at java.lang.Object.wait(Object.java:474)&lt;br/&gt;
        at org.apache.derby.impl.drda.NetworkServerControlImpl.blockingStart(Net&lt;br/&gt;
workServerControlImpl.java)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x02f996d0&amp;gt; (a java.lang.Object)&lt;br/&gt;
        at org.apache.derby.impl.drda.NetworkServerControlImpl.executeWork(Netwo&lt;br/&gt;
rkServerControlImpl.java)&lt;br/&gt;
        at org.apache.derby.drda.NetworkServerControl.main(NetworkServerControl.&lt;br/&gt;
java)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;VM Thread&quot; prio=10 tid=0x009c4308 nid=0x740 runnable&lt;/p&gt;

&lt;p&gt;&quot;VM Periodic Task Thread&quot; prio=10 tid=0x009d44f8 nid=0xa64 waiting on condition&lt;/p&gt;

</comment>
                            <comment id="12314358" author="kartha" created="Fri, 24 Jun 2005 07:37:51 +0100"  >&lt;p&gt;Please find attached the javacore, server runtime info and derby.log file. I re-ran the test on SLES 9.0 and IBM jdk 1.4.2 with the latest sane build from the 10.1 codeline. The same behaviour is seen with jdk15 also.&lt;/p&gt;

&lt;p&gt;--------- Derby Information --------&lt;br/&gt;
JRE - JDBC: J2SE 1.4.2 - JDBC 3.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/home/rajeshk/derby/lib/derby.jar&amp;#93;&lt;/span&gt; 10.1.1.0 beta - (201435)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/home/rajeshk/derby/lib/derbynet.jar&amp;#93;&lt;/span&gt; 10.1.1.0 beta - (201435)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/home/rajeshk/derby/lib/derbyclient.jar&amp;#93;&lt;/span&gt; 10.1.1.0 beta - (201435)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/home/rajeshk/derby/lib/derbytools.jar&amp;#93;&lt;/span&gt; 10.1.1.0 beta - (201435)&lt;br/&gt;
------------------------------------------------------&lt;/p&gt;</comment>
                            <comment id="12314369" author="kmarsden" created="Fri, 24 Jun 2005 09:39:29 +0100"  >&lt;p&gt;I am in the early stages with  this very serious stress bug for 10.1. The test is a network server test but the problem is occuring when network server prepares the statement and appears to me to be related to the statement cache. Rajesh is trying to reproduce on embedded.   He says he can reproduce this very quickly  with his test.  10 mintutes or so and then nothing else can be done with the database all clients hang.  He can create other databases, run runtimeinfo etc, so Network server seems ok.&lt;/p&gt;


&lt;p&gt;Nothing notable about the log except a lot of expected table not found errors. First wild guess is  somethng related to some sort of lock problem when failed statements are handled by the  cache.&lt;/p&gt;

&lt;p&gt;One of the traces has  removeStatement which looks interesting to me.&lt;/p&gt;

&lt;p&gt;&quot;DRDAConnThread_7&quot; prio=5 tid=0x0ae97d18 nid=0x988 waiting for monitor entry &lt;span class=&quot;error&quot;&gt;&amp;#91;0x0bdcf000..0x0bdcf9e4&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.removeStatement(GenericLanguageConnectionContext.java)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x02fdfcd0&amp;gt; (a org.apache.derby.impl.services.cache.C&lt;br/&gt;
lock)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;This method will get called if the statement is referencing tables in SESSION schema.&lt;/li&gt;
	&lt;li&gt;We do not want to cache such statements because multiple connections can have&lt;/li&gt;
	&lt;li&gt;different definition of the same table name and hence compiled plan for one connection&lt;/li&gt;
	&lt;li&gt;may not make sense for some other connection. Because of this, remove the statement from the cache&lt;br/&gt;
     *&lt;/li&gt;
	&lt;li&gt;@exception StandardException thrown if lookup goes wrong.&lt;br/&gt;
     */&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Were there any changes this release related to or that might affect statement caching or does this ring a bell for anyone?&lt;/p&gt;
</comment>
                            <comment id="12314407" author="djd" created="Sat, 25 Jun 2005 03:05:42 +0100"  >&lt;p&gt;Kathey, you may be correct in your  guess about removeStatement. The implmentation of that method synchronizes using the statement cache object. It is not required that callers of the cache synchronize on it, all of its methods are thread safe.&lt;br/&gt;
Indeed it may cause hangs, as the cache may release its syncrhonization (and expect it to be released) while it waits on its entries to perform actions.&lt;/p&gt;</comment>
                            <comment id="12314434" author="kmarsden" created="Sat, 25 Jun 2005 08:33:43 +0100"  >&lt;p&gt;Indeed, removing the sychronization in removeStatement seems to have resolved the problem.    So I&apos;ll run tests and get this checked into the trunk.  I don&apos;t have a standalone test for this but Rajesh does run his stress test with every release, so we will have to test that way.&lt;br/&gt;
This one probably  ought to go into 10.1 branch as well.&lt;/p&gt;
</comment>
                            <comment id="12314445" author="kmarsden" created="Sat, 25 Jun 2005 09:37:43 +0100"  >&lt;p&gt;QUESTION ON JAVADOC FOR GenericLanguageConnectionContext.removeStatement() &lt;/p&gt;

&lt;p&gt; removeStatement() removes statements from the cache and seems to only be called  when an SQLException occurs on prepare. This makes sense in the context that  Rajesh&apos;s test had lots of  failed statements and those were probably causing  &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-389&quot; title=&quot;With Network Server Database hangs after some time with many connections executing prepareStatement()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-389&quot;&gt;&lt;del&gt;DERBY-389&lt;/del&gt;&lt;/a&gt; to occur.&lt;/p&gt;

&lt;p&gt;The javadoc for this method says something else entirely and seems kind&lt;br/&gt;
of misleading. It talks about statements in the SESSION schema (temp table schema) getting removed. I don&apos;t  see this method being called&lt;br/&gt;
for any special handling of  temp tables and based on the comment it&lt;br/&gt;
sounds like it would be a bad thing for those statements to be in the&lt;br/&gt;
cache at all.&lt;/p&gt;


&lt;p&gt;I want to change the javadoc comment to take out the reference to the SESSION schema.   Does anyone have any issues with this change?  Am I missing an important piece of history or misunderstanding the use of this method?&lt;/p&gt;


&lt;p&gt;OLD JAVADOC&lt;/p&gt;

&lt;p&gt;/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;This method will get called if the statement is referencing&lt;br/&gt;
tables in SESSION schema.&lt;/li&gt;
	&lt;li&gt;We do not want to cache such statements because multiple&lt;br/&gt;
connections can have&lt;/li&gt;
	&lt;li&gt;different definition of the same table name and hence compiled&lt;br/&gt;
plan for one connection&lt;/li&gt;
	&lt;li&gt;may not make sense for some other connection. Because of this,&lt;br/&gt;
remove the statement from the cache&lt;br/&gt;
     *&lt;/li&gt;
	&lt;li&gt;@exception StandardException thrown if lookup goes wrong.&lt;br/&gt;
     */&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt; NEW JAVADOC&lt;/p&gt;

&lt;p&gt;/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;This method will remove a statement from the  statement cache.&lt;/li&gt;
	&lt;li&gt;It will be called,  for example, if there is an exception preparing&lt;/li&gt;
	&lt;li&gt;the statement.&lt;br/&gt;
*&lt;/li&gt;
	&lt;li&gt;@param statement    Statement to remove&lt;/li&gt;
	&lt;li&gt;@exception StandardException thrown if lookup goes wrong.&lt;br/&gt;
 */&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;THE ONE removeStatement REFERENCE&lt;/p&gt;

&lt;p&gt;from  GenericStatement.prepMinion()&lt;br/&gt;
....&lt;br/&gt;
catch (StandardException se)&lt;br/&gt;
                {&lt;br/&gt;
                    lcc.commitNestedTransaction();&lt;br/&gt;
                    if (foundInCache)&lt;/p&gt;

&lt;p&gt;((GenericLanguageConnectionContext)lcc).removeStatement(this);&lt;br/&gt;
                      .....&lt;/p&gt;




</comment>
                            <comment id="12314485" author="kmarsden" created="Sat, 25 Jun 2005 22:39:55 +0100"  >&lt;p&gt;This patch fixes the hang in the network server stress test.  The change was to remove the synchronization on the statement cache from the removeStatement method of GenericLanguageConnectionContext.  It is not needed because  the statement cache handles its own synchronization.   Also changes the javadoc to remove some incorrect info about temp tables. I will check this in later today if I hear no objections.&lt;/p&gt;
</comment>
                            <comment id="12314494" author="kmarsden" created="Sun, 26 Jun 2005 07:54:19 +0100"  >&lt;p&gt;Checked in the fix to 10.2 (trunk) &lt;br/&gt;
Not marking resolved until backported to 10.1&lt;/p&gt;

&lt;p&gt;Sending        java\engine\org\apache\derby\impl\sql\conn\GenericLanguageConnectionContext.java&lt;br/&gt;
Transmitting file data .&lt;br/&gt;
Committed revision 201792.&lt;/p&gt;</comment>
                            <comment id="12316466" author="kmarsden" created="Fri, 22 Jul 2005 23:09:02 +0100"  >&lt;p&gt;merged to 10.1 by andrew with r208776&lt;br/&gt;
Rajesh please close once verified.&lt;/p&gt;</comment>
                            <comment id="12329467" author="kmarsden" created="Fri, 16 Sep 2005 05:28:18 +0100"  >&lt;p&gt;This was actually fixed in 10.1.1.0&lt;/p&gt;</comment>
                            <comment id="12329468" author="kmarsden" created="Fri, 16 Sep 2005 05:29:12 +0100"  >&lt;p&gt;Rajesh verified with his sytem tests.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12310928" name="RTINFO.txt" size="11897" author="kartha" created="Fri, 24 Jun 2005 07:37:51 +0100"/>
                            <attachment id="12310929" name="derby.log" size="1409986" author="kartha" created="Fri, 24 Jun 2005 07:37:51 +0100"/>
                            <attachment id="12310955" name="derby389.diff" size="1436" author="kmarsden" created="Sat, 25 Jun 2005 22:39:55 +0100"/>
                            <attachment id="12310919" name="javacore.20050622.135027.2491.txt" size="923236" author="kmarsden" created="Thu, 23 Jun 2005 22:44:49 +0100"/>
                            <attachment id="12310927" name="javacore.20050623.150509.22394.txt" size="348725" author="kartha" created="Fri, 24 Jun 2005 07:37:51 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 24 Jun 2005 06:37:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21928</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy17qn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40904</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>