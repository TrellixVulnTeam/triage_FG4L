<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:09:31 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5536/DERBY-5536.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5536] Client&apos;s ResultSet#getLong does not range check when converting from a DECIMAL column</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5536</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Derby&apos;s DECIMAL can contain an integer of 31 digits. This can overflow a long. The embedded JDBC driver catches this, but the client does not and can yield a corrupt long, cf enclosed repro.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12535050">DERBY-5536</key>
            <summary>Client&apos;s ResultSet#getLong does not range check when converting from a DECIMAL column</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                            <label>derby_backport_reject_10_8</label>
                    </labels>
                <created>Tue, 13 Dec 2011 23:02:12 +0000</created>
                <updated>Wed, 7 Aug 2013 18:08:23 +0100</updated>
                            <resolved>Mon, 9 Jan 2012 10:21:28 +0000</resolved>
                                                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>JDBC</component>
                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13169620" author="dagw" created="Wed, 14 Dec 2011 19:43:10 +0000"  >&lt;p&gt;The bug also is present for getInt, getShort and getByte sinc ethey rely on getLong. The error lies in am.Decimal#getLong, which contains this loop:&lt;/p&gt;

&lt;p&gt;   // compute the integer part only.&lt;br/&gt;
   int leftOfDecimalPoint = length * 2 - 1 - scale;&lt;br/&gt;
   long integer = 0;&lt;br/&gt;
   if (leftOfDecimalPoint &amp;gt; 0) {&lt;br/&gt;
       int i = 0;&lt;br/&gt;
       for (; i &amp;lt; leftOfDecimalPoint / 2; i++) &lt;/p&gt;
{
           integer = integer * 10 + signum * ((buffer[offset + i] &amp;amp; 0xF0) &amp;gt;&amp;gt;&amp;gt; 4); // high nybble.
           integer = integer * 10 + signum * (buffer[offset + i] &amp;amp; 0x0F);        // low nybble.
       }
&lt;p&gt;    :&lt;/p&gt;

&lt;p&gt;If the scale is high, say, 31, the accumulating value &quot;integer&quot; will wrap around here with no warning.&lt;/p&gt;</comment>
                            <comment id="13172887" author="dagw" created="Tue, 20 Dec 2011 03:21:18 +0000"  >&lt;p&gt;Uploading derby-5536 which changes the implementation of am.Decimal#getLong to allow it to detect overflow. If the number of digits indicate it can&apos;t happen we use an optimized path. Uncommented a overflow test case in ParameterMappingTest which was disabled due to this error and and added a new positive test case since we changed the implementation. &lt;/p&gt;

&lt;p&gt;Running regressions.&lt;/p&gt;</comment>
                            <comment id="13173324" author="dagw" created="Tue, 20 Dec 2011 17:22:23 +0000"  >&lt;p&gt;Regressions passed.&lt;/p&gt;</comment>
                            <comment id="13179745" author="dagw" created="Wed, 4 Jan 2012 18:53:16 +0000"  >&lt;p&gt;Uploading a revised patch, derby-5536-2. Small test improvement only. Will commit soon, so please review.&lt;/p&gt;</comment>
                            <comment id="13180490" author="knutanders" created="Thu, 5 Jan 2012 16:03:08 +0000"  >&lt;p&gt;The patch looks good to me.&lt;/p&gt;

&lt;p&gt;Might be worthwhile adding a comment saying that the conversion BigDecimal-&amp;gt;BigInteger-&amp;gt;BigDecimal in Decimal.getLong() is done to strip off the fraction part.&lt;/p&gt;

&lt;p&gt;Do the existing tests cover the case where a DECIMAL with non-zero scale and non-zero fraction part is converted to long? The new test cases only test numbers with no fraction part, I think.&lt;/p&gt;</comment>
                            <comment id="13182424" author="dagw" created="Mon, 9 Jan 2012 09:19:53 +0000"  >&lt;p&gt;Uploading patch #3 which address your comments, Knut. This tests a non-zero fractional part as well (rounding towards zero) and adds a comment as suggested.&lt;/p&gt;</comment>
                            <comment id="13182441" author="knutanders" created="Mon, 9 Jan 2012 10:16:20 +0000"  >&lt;p&gt;Thanks, Dag. The changes look good to me. Maybe the select statement in the new test case for non-zero fraction should have an ORDER BY clause to ensure stable results, since the rows are not guaranteed to be returned in insertion order? And perhaps factor out that test case in a separate test method? (The test method in which it is currently located, is actually for testing that the SQLStates are correct.)&lt;/p&gt;</comment>
                            <comment id="13182444" author="dagw" created="Mon, 9 Jan 2012 10:18:33 +0000"  >&lt;p&gt;Committed on trunk as svn 1229082, resolving.&lt;/p&gt;</comment>
                            <comment id="13182445" author="dagw" created="Mon, 9 Jan 2012 10:22:59 +0000"  >&lt;p&gt;Thanks, Knut. I committed before I saw your latest comment. I&apos;ll address this in a follow-up patch.&lt;/p&gt;</comment>
                            <comment id="13183131" author="dagw" created="Tue, 10 Jan 2012 07:41:54 +0000"  >&lt;p&gt;Attaching a follow-up patch which factors out the test cases for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5536&quot; title=&quot;Client&amp;#39;s ResultSet#getLong does not range check when converting from a DECIMAL column&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5536&quot;&gt;&lt;del&gt;DERBY-5536&lt;/del&gt;&lt;/a&gt; into a separate fixture, adding &quot;order by&quot; to secure correct row retrieval order.&lt;/p&gt;</comment>
                            <comment id="13183134" author="dagw" created="Tue, 10 Jan 2012 07:56:06 +0000"  >&lt;p&gt;Committed the followup patch derby-5536-refactor as svn 1229481.&lt;/p&gt;</comment>
                            <comment id="13685328" author="knutanders" created="Mon, 17 Jun 2013 10:19:42 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                            <comment id="13732089" author="kmarsden" created="Wed, 7 Aug 2013 16:12:43 +0100"  >&lt;p&gt;Assign to myself for backport&lt;/p&gt;</comment>
                            <comment id="13732173" author="kmarsden" created="Wed, 7 Aug 2013 18:08:23 +0100"  >&lt;p&gt;Won&apos;t backport after all. This fix uses BigDecimal.longValueExact() which is not available in 1.4.2 so the fix does not build on 10.8.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12534820">DERBY-5533</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12507263" name="MissingRangeCheck.java" size="4573" author="dagw" created="Tue, 13 Dec 2011 23:03:12 +0000"/>
                            <attachment id="12509442" name="derby-5536-2.diff" size="11388" author="dagw" created="Wed, 4 Jan 2012 18:53:16 +0000"/>
                            <attachment id="12509443" name="derby-5536-2.stat" size="218" author="dagw" created="Wed, 4 Jan 2012 18:53:16 +0000"/>
                            <attachment id="12509885" name="derby-5536-3.diff" size="12675" author="dagw" created="Mon, 9 Jan 2012 09:21:41 +0000"/>
                            <attachment id="12509886" name="derby-5536-3.stat" size="218" author="dagw" created="Mon, 9 Jan 2012 09:21:41 +0000"/>
                            <attachment id="12510015" name="derby-5536-refactor.diff" size="6151" author="dagw" created="Tue, 10 Jan 2012 07:41:54 +0000"/>
                            <attachment id="12508036" name="derby-5536.diff" size="10560" author="dagw" created="Tue, 20 Dec 2011 03:21:18 +0000"/>
                            <attachment id="12508037" name="derby-5536.stat" size="218" author="dagw" created="Tue, 20 Dec 2011 03:21:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10367"><![CDATA[Deviation from standard]]></customfieldvalue>
    <customfieldvalue key="10363"><![CDATA[Embedded/Client difference]]></customfieldvalue>
    <customfieldvalue key="10366"><![CDATA[Wrong query result]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 5 Jan 2012 16:03:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>220734</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0e9b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36128</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>