<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:30:44 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4553/DERBY-4553.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4553] In ij GETCURRENTROWNUMBER directly writeits result  to output</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4553</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;In ij, the statement GETCURRENTROWNUMBER directly write its result to output instead of returning it:&lt;/p&gt;

&lt;p&gt;Here are the faulty lines in ij.ij, method GetCurrentRowNumber():&lt;br/&gt;
	...&lt;br/&gt;
	LocalizedResource.OutputWriter().println(utilInstance.getCurrentRowNumber(rs));&lt;br/&gt;
	return null;&lt;/p&gt;

&lt;p&gt;This interferes with testing - and possibly with any external tool using the ij.ij parser.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12456589">DERBY-4553</key>
            <summary>In ij GETCURRENTROWNUMBER directly writeits result  to output</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sleroux">Sylvain Leroux</assignee>
                                    <reporter username="sleroux">Sylvain Leroux</reporter>
                        <labels>
                            <label>ij</label>
                    </labels>
                <created>Wed, 17 Feb 2010 21:28:12 +0000</created>
                <updated>Fri, 5 Mar 2010 11:04:44 +0000</updated>
                            <resolved>Fri, 5 Mar 2010 11:04:44 +0000</resolved>
                                                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12835044" author="sleroux" created="Wed, 17 Feb 2010 23:22:26 +0000"  >&lt;p&gt;Attaching a repro for this issue.&lt;/p&gt;

&lt;p&gt;The repro just create a cursor and add a call to GETCURRENTROWNUMBER at the end of ij7.sql. Running the ToolScripts test suite produce the following result:&lt;br/&gt;
  sh$ ant all &amp;amp;&amp;amp; java junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.tools.ToolScripts &lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;snip&amp;#93;&lt;/span&gt;&lt;br/&gt;
  .0&lt;br/&gt;
  F....0&lt;br/&gt;
  F...&lt;br/&gt;
  Time: 130.112&lt;br/&gt;
  There were 2 failures:&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;snip&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The &apos;0&apos;s in the output are the result of GETCURRENTROWNUMBER. And are not caught by the test tool. That leads to a failure of the corresponding test.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;By looking at the source of ij, it seems there is currently no class implementing ijResult suitable to return only one value. An option would be to create a new class derived of ijResultVector to implement scalar results as 1-dimension vector.&lt;/p&gt;</comment>
                            <comment id="12835404" author="sleroux" created="Thu, 18 Feb 2010 21:14:53 +0000"  >&lt;p&gt;Attaching a patch for this issue. Ready for review.&lt;/p&gt;

&lt;p&gt;This patch introduce the classe ijScalarResult representing a single value returned from an ij statement. ijScalarResult is defined as a subclass of ijVectorResult. I use it to store the integer value returned by getCurrentRowNumber().&lt;/p&gt;

&lt;p&gt;However, according to the comment on ijVectorResult, that class is for vectors of /strings/. But, the only usage for such vectors ends up in org.apache.derby.impl.tools.ij.util.DisplayVector(LocalizedOutput, Vector) where a println is issued for each item. So, I don&apos;t think it is a problem to feed such a vector with other kind of objects. Moreover, ijVectorResult is package-private so there is little chance  this break anything outside of ij.&lt;/p&gt;


&lt;p&gt;I wasn&apos;t able to find where ij&apos;s cursor statements are tested (are they?). So I add a simple test for GETCURRENTROWNUMBER in ij7.sql&lt;/p&gt;


&lt;p&gt;Pass ToolScript test suite:&lt;br/&gt;
    sh$ java junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.tools.ToolScripts &lt;br/&gt;
    ........&lt;br/&gt;
    Time: 24.031&lt;/p&gt;

&lt;p&gt;    OK (8 tests)&lt;/p&gt;</comment>
                            <comment id="12835698" author="knutanders" created="Fri, 19 Feb 2010 11:06:16 +0000"  >&lt;p&gt;Hi Sylvain,&lt;/p&gt;

&lt;p&gt;The fix looks fine to me, but I think we need to update the comments if we start allowing other objects than strings in ijVectorResult. I&apos;m wondering, though, if we need the new class, or if it would be better to just add an extra constructor to ijVectorResult that takes a string argument. Not a big issue, but that would give slightly less code and less files to maintain.&lt;/p&gt;

&lt;p&gt;(On a side note, this would not have been an issue if only ijVectorResult had used java.util.List instead of java.util.Vector. Then we could produce a scalar result as simple as this, without any new class or new constructor: &quot;new ijVectorResult(Collections.singletonList(result)), null);&quot; But cleaning up the ij code and making it use the more modern collection classes is outside the scope of this issue.)&lt;/p&gt;</comment>
                            <comment id="12835765" author="sleroux" created="Fri, 19 Feb 2010 14:58:05 +0000"  >&lt;p&gt;Hi Knut,&lt;/p&gt;

&lt;p&gt;Thanks for reviewing such a critical issue &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I attach here a new patch for this issue:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I agree with you to add extra constructors to ijVectorResult instead of coding a new class.&lt;/li&gt;
	&lt;li&gt;I have updated the comment about ijVectorResult accepting any object.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Pass derbytools ant ToolScripts test suite.&lt;/p&gt;


&lt;p&gt;Concerning your side note, I think ij deserves some cleaning up. Both at source level - and maybe as well in terms of functionality? According to a comment in java/tools/org/apache/derby/impl/tools/ij/Main.java, it was first designed as a testing tool. But ij could have some &quot;advanced&quot; feature to ease database maintenance tasks. &lt;/p&gt;</comment>
                            <comment id="12835777" author="knutanders" created="Fri, 19 Feb 2010 15:27:08 +0000"  >&lt;p&gt;Thanks, Sylvain! I&apos;ll run the full regression test suite and commit the patch if nothing breaks.&lt;/p&gt;</comment>
                            <comment id="12835916" author="knutanders" created="Fri, 19 Feb 2010 19:37:58 +0000"  >&lt;p&gt;The tests ran cleanly in my environment. Committed revision 911952.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12436247" name="DERBY-4553.patch" size="3717" author="sleroux" created="Thu, 18 Feb 2010 21:14:53 +0000"/>
                            <attachment id="12436327" name="DERBY-4553_2.patch" size="3029" author="sleroux" created="Fri, 19 Feb 2010 14:58:03 +0000"/>
                            <attachment id="12436147" name="DERBY-4553_repro.patch" size="1073" author="sleroux" created="Wed, 17 Feb 2010 23:22:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 19 Feb 2010 11:06:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24334</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10423"><![CDATA[Newcomer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0qzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38191</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>