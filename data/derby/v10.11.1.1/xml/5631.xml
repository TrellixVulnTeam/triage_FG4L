<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:55:07 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5631/DERBY-5631.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5631] Extend SecurityManagerSetup to add extra privileges to the set of default privileges (merge two policy files)</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5631</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When moving ProtocolTest into suites all (see &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2031&quot; title=&quot;Convert derbynet/testProtocol.java to JUnit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2031&quot;&gt;&lt;del&gt;DERBY-2031&lt;/del&gt;&lt;/a&gt;), I needed to allow the test code to create a socket. There was already a policy file for the old harness for doing this, but when using this with the JUnit framework I ended up adding privilege after privilege to get the framework itself running.&lt;br/&gt;
Instead of creating a large policy file duplicating all the privileges that the framework requires to function properly, I think it would be better to make the SecurityManagerSetup capable of merging the test specific policy file with the default policy file.&lt;br/&gt;
This mode of operation can be used when you need a few extra privileges to execute the test, but there are probably also tests where you want full control of the privileges - in which case you use the existing mode of operation.&lt;/p&gt;

&lt;p&gt;I&apos;m not 100% sure this approach will always work, but basic testing has shown promising results.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12544063">DERBY-5631</key>
            <summary>Extend SecurityManagerSetup to add extra privileges to the set of default privileges (merge two policy files)</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kristwaa">Kristian Waagan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Feb 2012 21:53:28 +0000</created>
                <updated>Tue, 17 Apr 2012 11:44:55 +0100</updated>
                            <resolved>Fri, 9 Mar 2012 15:02:05 +0000</resolved>
                                    <version>10.9.1.0</version>
                                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13216153" author="kristwaa" created="Sat, 25 Feb 2012 00:12:14 +0000"  >&lt;p&gt;Attaching patch 1a, which adds a new constructor with a third boolean argument to SecurityManagerSetup.&lt;br/&gt;
If true, the specified policy file is appended to the default policy (written to a new file) and the merged policy installed.&lt;/p&gt;

&lt;p&gt;I chose &quot;system/var&quot; as the home for these merged policy files. I haven&apos;t added any removal-code for these files.&lt;/p&gt;

&lt;p&gt;I tested the patch manually (modified AssertFailureTest), I plan to use the functionality in the coming patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2031&quot; title=&quot;Convert derbynet/testProtocol.java to JUnit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2031&quot;&gt;&lt;del&gt;DERBY-2031&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I also did some minor cleanup/refactoring (JavaDoc, added NO_POLICY constant).&lt;/p&gt;

&lt;p&gt;Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="13216628" author="dagw" created="Sun, 26 Feb 2012 04:45:33 +0000"  >&lt;p&gt;Looks like a useful addition. Now we should go back a remove stuff from the default test policy file &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;br/&gt;
Nits:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;introduced new or changed lines with leading tabs&lt;/li&gt;
	&lt;li&gt;Might it be cleaner to have the two policies as arguments to mergeWithDefaultPolicyFile? Perhaps by storing one (added==null) or two policies as members and drop the boolean member mergeWithDefault?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13217139" author="kristwaa" created="Mon, 27 Feb 2012 10:15:36 +0000"  >&lt;p&gt;Thanks, Dag.&lt;/p&gt;

&lt;p&gt;I pulled all the NO_POLICY changes into patch 2a and committed it to trunk with revision 1294088.&lt;br/&gt;
I&apos;ll have a look at your suggestions, and at the very least post a new patch which addresses the whitespace issues.&lt;/p&gt;</comment>
                            <comment id="13217195" author="kristwaa" created="Mon, 27 Feb 2012 13:59:54 +0000"  >&lt;p&gt;Attaching patch 1b, which replaces patch 1a.&lt;/p&gt;

&lt;p&gt;I&apos;ve fixed the whitespace issues commented on by Dag, and I&apos;ve also rewritten the method as suggested by Dag. Made the method static, updated some comments, and added a debug println:&lt;br/&gt;
DEBUG: &lt;/p&gt;
{SecurityManagerSetup} installed policy &lt;a href=&quot;file:/C:/.../derby/test/system/var/AssertFailureTest.policy-MERGED_WITH-derby_tests.policy&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/C:/.../derby/test/system/var/AssertFailureTest.policy-MERGED_WITH-derby_tests.policy&lt;/a&gt;&lt;br/&gt;
DEBUG: {SecurityManagerSetup}
&lt;p&gt; installed policy jar:&lt;a href=&quot;file:/C:/.../derby/jars/sane/derbyTesting.jar!/org/apache/derbyTesting/unitTests/junit/AssertFailureTest1.policy&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/C:/.../derby/jars/sane/derbyTesting.jar!/org/apache/derbyTesting/unitTests/junit/AssertFailureTest1.policy&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Patch ready for review.&lt;br/&gt;
I hope to commit patch 1b soon.&lt;/p&gt;</comment>
                            <comment id="13219707" author="dagw" created="Thu, 1 Mar 2012 01:32:50 +0000"  >&lt;p&gt;Patch 1b looks good to me. I have one more small nit: I&apos;d prefer the test on policy2 == null to be outside of mergePolicies, since in that case no merging takes place making the name of the method a bit misleading. Alternately, change the name to cater for both one and two policies, e.g. &quot;getEffectivePolicyResourceString&quot;. Up to you, +1 in any case.&lt;/p&gt;</comment>
                            <comment id="13219863" author="kristwaa" created="Thu, 1 Mar 2012 07:06:17 +0000"  >&lt;p&gt;Thanks for the additional review, Dag.&lt;br/&gt;
I&apos;ve made some further changes based on your feedback, see attached patch 1c.&lt;/p&gt;

&lt;p&gt;Committed patch 1c to trunk with revision 1295436.&lt;/p&gt;</comment>
                            <comment id="13219866" author="kristwaa" created="Thu, 1 Mar 2012 07:07:34 +0000"  >&lt;p&gt;Resolving issue.&lt;br/&gt;
I don&apos;t plan to backport.&lt;/p&gt;</comment>
                            <comment id="13219956" author="kristwaa" created="Thu, 1 Mar 2012 10:59:18 +0000"  >&lt;p&gt;Auch, my last commit broke all tests using no security policy (&amp;lt;NONE&amp;gt;).  Mental note: run tests properly - run all tests and preferably with the correct patch applied...&lt;br/&gt;
Committed patch 1d to trunk with revision 1295507.&lt;/p&gt;

&lt;p&gt;Sorry for the noise.&lt;/p&gt;</comment>
                            <comment id="13223182" author="kristwaa" created="Tue, 6 Mar 2012 12:13:17 +0000"  >&lt;p&gt;Attaching patch 1e, which committed already on Thursday.&lt;br/&gt;
It deals with more variations of denoting a policy resource, i.e. how to get from String to URL.&lt;/p&gt;

&lt;p&gt;Committed to trunk with revision 1295609.&lt;/p&gt;

&lt;p&gt;Hopefully the last commit on this issue. The new functionality will be run as part of suites.All when &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2031&quot; title=&quot;Convert derbynet/testProtocol.java to JUnit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2031&quot;&gt;&lt;del&gt;DERBY-2031&lt;/del&gt;&lt;/a&gt; goes in.&lt;/p&gt;</comment>
                            <comment id="13224070" author="kristwaa" created="Wed, 7 Mar 2012 07:24:25 +0000"  >&lt;p&gt;Reopening to add a missing doPrivileged-block.&lt;/p&gt;</comment>
                            <comment id="13224074" author="kristwaa" created="Wed, 7 Mar 2012 07:33:34 +0000"  >&lt;p&gt;Attaching patch 1f, which adds a missing privileged block in mergePolicies.&lt;/p&gt;

&lt;p&gt;Changes in order of importance:&lt;br/&gt;
 o added doPrivileged-block when converting from File to URI to URL to String&lt;br/&gt;
 o replaced code block with utility method in setSecurityPolicy&lt;br/&gt;
 o imported some security classes and removed package prefix (i.e. new java.security.PrivilegedAction to new PrivilegedAction)&lt;br/&gt;
 o added a missing word to a @throws tag&lt;/p&gt;

&lt;p&gt;suites.All passed on both Solaris 11 and Linux with this patch (and the new ProtocolTest enabled).&lt;br/&gt;
Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="13224345" author="rhillegas" created="Wed, 7 Mar 2012 14:00:42 +0000"  >&lt;p&gt;Thanks for the patch, Kristian. These changes look like good defensive logic to me. +1&lt;/p&gt;</comment>
                            <comment id="13226001" author="kristwaa" created="Fri, 9 Mar 2012 10:58:26 +0000"  >&lt;p&gt;Thank you, Rick.&lt;br/&gt;
Committed patch 1f to trunk with revision 1298787. Will re-enable the test under &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2031&quot; title=&quot;Convert derbynet/testProtocol.java to JUnit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2031&quot;&gt;&lt;del&gt;DERBY-2031&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13226120" author="kristwaa" created="Fri, 9 Mar 2012 15:02:05 +0000"  >&lt;p&gt;Resolving, the tinderbox test passed &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;.&lt;br/&gt;
Any further problems can be dealt with as separate issues.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/tinderbox_trunk16/jvm1.6/testing/Limited/testSummary-1298791.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/tinderbox_trunk16/jvm1.6/testing/Limited/testSummary-1298791.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13255455" author="kristwaa" created="Tue, 17 Apr 2012 11:44:55 +0100"  >&lt;p&gt;Closing issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12516003" name="derby-5631-1a-merge_policy_files.diff" size="10346" author="kristwaa" created="Sat, 25 Feb 2012 00:12:14 +0000"/>
                            <attachment id="12516164" name="derby-5631-1b-merge_policy_files.diff" size="8724" author="kristwaa" created="Mon, 27 Feb 2012 13:59:54 +0000"/>
                            <attachment id="12516649" name="derby-5631-1c-merge_policy_files.diff" size="9493" author="kristwaa" created="Thu, 1 Mar 2012 07:06:17 +0000"/>
                            <attachment id="12516667" name="derby-5631-1d-merge_policy_files-fix.diff" size="1893" author="kristwaa" created="Thu, 1 Mar 2012 10:59:18 +0000"/>
                            <attachment id="12517228" name="derby-5631-1e-merge_policy_files-fix-url.diff" size="2037" author="kristwaa" created="Tue, 6 Mar 2012 12:13:17 +0000"/>
                            <attachment id="12517376" name="derby-5631-1f-merge_policy_files_fix-priv.diff" size="4711" author="kristwaa" created="Wed, 7 Mar 2012 07:33:34 +0000"/>
                            <attachment id="12516154" name="derby-5631-2a-introduce_NO_POLICY_constant.diff" size="3156" author="kristwaa" created="Mon, 27 Feb 2012 10:15:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 26 Feb 2012 04:45:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>229301</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0cdj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35823</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>