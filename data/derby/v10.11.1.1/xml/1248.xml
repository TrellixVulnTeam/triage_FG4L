<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:39:26 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1248/DERBY-1248.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1248] Assert failure in BasePage.shiftUp() when running store/onlineBackupTest4.sql</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1248</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I saw this error when I ran derbyall.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;
			&lt;ul&gt;
				&lt;li&gt;
				&lt;ul&gt;
					&lt;li&gt;
					&lt;ul&gt;
						&lt;li&gt;
						&lt;ul&gt;
							&lt;li&gt;
							&lt;ul&gt;
								&lt;li&gt;
								&lt;ul&gt;
									&lt;li&gt;Diff file derbyall/storeall/storemore/onlineBackupTest4.diff&lt;/li&gt;
								&lt;/ul&gt;
								&lt;/li&gt;
							&lt;/ul&gt;
							&lt;/li&gt;
						&lt;/ul&gt;
						&lt;/li&gt;
					&lt;/ul&gt;
					&lt;/li&gt;
				&lt;/ul&gt;
				&lt;/li&gt;
			&lt;/ul&gt;
			&lt;/li&gt;
			&lt;li&gt;Start: onlineBackupTest4 jdk1.5.0_04 storeall:storemore 2006-04-24 11:51:50 ***&lt;br/&gt;
68 del&lt;br/&gt;
&amp;lt; ij(CONNECTION1)&amp;gt; select * from ctest;&lt;br/&gt;
69 del&lt;br/&gt;
&amp;lt; ID         |NAME                                                                                                                            &lt;br/&gt;
70 del&lt;br/&gt;
&amp;lt; --------------------------------------------------------------------------------------------------------------------------------------------&lt;br/&gt;
71 del&lt;br/&gt;
&amp;lt; 1          |derby backup/compress test                                                                                                     &amp;amp;&lt;br/&gt;
72 del&lt;br/&gt;
&amp;lt; 2          |derby backup/compress test                                                                                                     &amp;amp;&lt;br/&gt;
73 del&lt;br/&gt;
&amp;lt; 300        |derby backup/compress test                                                                                                     &amp;amp;&lt;br/&gt;
74 del&lt;br/&gt;
&amp;lt; 509        |derby backup/compress test                                                                                                     &amp;amp;&lt;br/&gt;
75 del&lt;br/&gt;
&amp;lt; 510        |derby backup/compress test                                                                                                     &amp;amp;&lt;br/&gt;
76 del&lt;br/&gt;
&amp;lt; 511        |derby backup/compress test                                                                                                     &amp;amp;&lt;br/&gt;
77 del&lt;br/&gt;
&amp;lt; 512        |derby backup/compress test                                                                                                     &amp;amp;&lt;br/&gt;
78 del&lt;br/&gt;
&amp;lt; ij(CONNECTION1)&amp;gt; insert into ctest values(2000, &apos;restore was successfil&apos;) ;&lt;br/&gt;
79 del&lt;br/&gt;
&amp;lt; 1 row inserted/updated/deleted&lt;br/&gt;
80 del&lt;br/&gt;
&amp;lt; ij(CONNECTION1)&amp;gt; &lt;br/&gt;
80 add&lt;br/&gt;
&amp;gt; org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED shiftUp failed, low must be between 0 and recordCount.  low = 140, recordCount = 2&lt;br/&gt;
&amp;gt; ERROR XJ040: Failed to start database &apos;wombat&apos;, see the next exception for details.&lt;br/&gt;
&amp;gt; ERROR XJ001: Java exception: &apos;ASSERT FAILED shiftUp failed, low must be between 0 and recordCount.  low = 140, recordCount = 2: org.apache.derby.shared.common.sanity.AssertFailure&apos;.&lt;br/&gt;
&amp;gt; ij&amp;gt; select * from ctest;&lt;br/&gt;
&amp;gt; IJ ERROR: Unable to establish connection&lt;br/&gt;
&amp;gt; ij&amp;gt; insert into ctest values(2000, &apos;restore was successfil&apos;) ;&lt;br/&gt;
&amp;gt; IJ ERROR: Unable to establish connection&lt;br/&gt;
&amp;gt; ij&amp;gt; &lt;br/&gt;
Test Failed.&lt;/li&gt;
			&lt;li&gt;End:   onlineBackupTest4 jdk1.5.0_04 storeall:storemore 2006-04-24 11:51:56 ***&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The test usually succeeds, but I managed to reproduce the failure by running this loop in the shell:&lt;/p&gt;

&lt;p&gt;touch onlineBackupTest4.pass&lt;br/&gt;
while [ -f onlineBackupTest4.pass ]; do&lt;br/&gt;
    rm onlineBackupTest4.pass&lt;br/&gt;
    java org.apache.derbyTesting.functionTests.harness.RunTest store/onlineBackupTest4.sql&lt;br/&gt;
done&lt;/p&gt;</description>
                <environment>Sun JVM 1.5.0_04 on Solaris 10 x86. Derby from trunk (revision 396285). Sane build.</environment>
        <key id="12332596">DERBY-1248</key>
            <summary>Assert failure in BasePage.shiftUp() when running store/onlineBackupTest4.sql</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikem">Mike Matrigali</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Apr 2006 20:40:55 +0100</created>
                <updated>Mon, 29 Jun 2009 23:43:01 +0100</updated>
                            <resolved>Thu, 10 Aug 2006 15:36:48 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12376025" author="knutanders" created="Mon, 24 Apr 2006 20:48:32 +0100"  >&lt;p&gt;Attaching zip file with the storemore directory from the failing run of derbyall.&lt;/p&gt;</comment>
                            <comment id="12419280" author="knutanders" created="Wed, 5 Jul 2006 22:25:37 +0100"  >&lt;p&gt;I also see this failure on Linux, but not as frequently as on Solaris (had to run the test 125 times on Linux, whereas it fails after about 25 runs on Solaris). I have not been able to reproduce the failure on machines with single CPU.&lt;/p&gt;</comment>
                            <comment id="12419431" author="knutanders" created="Thu, 6 Jul 2006 15:33:10 +0100"  >&lt;p&gt;Attaching two new zips. One for a failure on Linux and one for a failure on Solaris. They also include the database directory (extinout/mybackup/wombat). The failures have different low values, but recordCount is always 2.&lt;/p&gt;</comment>
                            <comment id="12419576" author="skambha" created="Fri, 7 Jul 2006 02:31:23 +0100"  >&lt;p&gt;I ran this test on two different machines with the similar hardware , 2cpu intel xeon 2.8 ghz, 4g ram. Hyperthreadign enabled so seems like a 4cpu. &lt;/p&gt;

&lt;p&gt;One machine has windows2000 server and other machine has linux, RHEL AS release 4.&lt;/p&gt;

&lt;p&gt;So far, bug only reproduces on the linux machine.  Details below:&lt;/p&gt;

&lt;p&gt;On linux test machine (RHEL AS release 4. JVM - IBM 1.4.2)&lt;/p&gt;

&lt;p&gt;FIRST TIME REPRO:  bug in testrun 335. &lt;br/&gt;
The attached jar - test335.jar has the entire test directory.&lt;br/&gt;
--------------------------------------------------------------------------------&lt;br/&gt;
&amp;gt; org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED shiftUp failed, low must be between 0 and recordCount.  low = 101, recordCount = 2&lt;br/&gt;
&amp;gt;       at org.apache.derby.impl.store.raw.data.BasePage.shiftUp(BasePage.java(Inlined Compiled Code))&lt;br/&gt;
&amp;gt;       at org.apache.derby.impl.store.raw.data.StoredPage.storeRecordForInsert(StoredPage.java(Compiled Code))&lt;br/&gt;
&amp;gt;       at org.apache.derby.impl.store.raw.data.StoredPage.storeRecord(StoredPage.java(Compiled Code))&lt;br/&gt;
&amp;gt; ERROR XJ040: Failed to start database &apos;wombat&apos;, see the next exception for details.&lt;br/&gt;
&amp;gt; ERROR XJ001: Java exception: &apos;ASSERT FAILED shiftUp failed, low must be between 0 and recordCount.  low = 101, recordCount = 2: org.apache.derby.shared.common.sanity.AssertFailure&apos;.&lt;br/&gt;
-----------------------------------------------------------------&lt;/p&gt;


&lt;p&gt;SECOND TIME REPRO: bug reproduced in testrun 379.  test2_379.jar is attached with the db and logs.&lt;/p&gt;

&lt;p&gt;------------------------------------------------------------------------------------------&lt;br/&gt;
&amp;gt; org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED shiftUp failed, low must be between 0 and recordCount.  low = 12, recordCount = 2&lt;br/&gt;
&amp;gt;       at org.apache.derby.impl.store.raw.data.BasePage.shiftUp(BasePage.java(Inlined Compiled Code))&lt;br/&gt;
&amp;gt;       at org.apache.derby.impl.store.raw.data.StoredPage.storeRecordForInsert(StoredPage.java(Compiled Code))&lt;br/&gt;
&amp;gt;       at org.apache.derby.impl.store.raw.data.StoredPage.storeRecord(StoredPage.java(Compiled Code))&lt;br/&gt;
&amp;gt; ERROR XJ040: Failed to start database &apos;wombat&apos;, see the next exception for details.&lt;br/&gt;
&amp;gt; ERROR XJ001: Java exception: &apos;ASSERT FAILED shiftUp failed, low must be between 0 and recordCount.  low = 12, recordCount = 2: org.apache.derby.shared.common.sanity.AssertFailure&apos;.&lt;br/&gt;
------------------------------------------------------------------------------------------&lt;/p&gt;


&lt;p&gt;WINDOWS MACHINE: &lt;br/&gt;
On Windows on a similar hardware as the linux machine, I have not been able to reproduce the failure so far. The test has run about 2208 times so far.  I am leaving the test running, to see if this bug will reproduce.&lt;/p&gt;</comment>
                            <comment id="12419686" author="knutanders" created="Fri, 7 Jul 2006 18:57:59 +0100"  >&lt;p&gt;Now I have seen this failure on a single-CPU machine as well. I was running derbyall on a Pentium 4, 2.66 GHz, Solaris 10. Attached log and db in solaris-singlecpu.zip. Note that the test failed with recordCount=0, not 2 as the previous failures.&lt;/p&gt;

&lt;p&gt;ERROR XJ001: Java exception: &apos;ASSERT FAILED shiftUp failed, low must be between 0 and recordCount.  low = 7, recordCount = 0: org.apache.derby.shared.common.sanity.AssertFailure&apos;.&lt;/p&gt;</comment>
                            <comment id="12419745" author="mikem" created="Sat, 8 Jul 2006 00:38:50 +0100"  >&lt;p&gt;The following is from looking at the test335 failure.&lt;/p&gt;

&lt;p&gt;My interpretation so far is that the online backup has data page changes without the corresponding log records&lt;br/&gt;
for those changes.  The test takes a backup concurrently with a compress, and then tries to apply the backup&lt;br/&gt;
and check it.  Unfortunately I this means it deletes the original db, which would be interesting to have to compare&lt;br/&gt;
to the backup.  Connecting the the backup by hand I get the same error as is reported by the test (which is what&lt;br/&gt;
I would expect from a boot recovery error).  &lt;/p&gt;

&lt;p&gt;It looks like an undo of  Page(3,Container(0, 913)) , PageVersion: 579 is being attempted, but the last  redo record of&lt;br/&gt;
that page attempted was page version 477.  Has the feel of a missing log file from the backup copy.&lt;/p&gt;

&lt;p&gt;Another issue is that I am surprised that we got the BasePage error, I thought that we would get an error higher up from&lt;br/&gt;
undo saying that we could not apply undo page version 477 to page version 579.&lt;/p&gt;

&lt;p&gt;Here are just the log records for this page applied during recovery, gotten by connecting with a sane server and &lt;br/&gt;
derby.debug.true=LogTrace property:&lt;/p&gt;

&lt;p&gt;DEBUG LogTrace OUTPUT: scanned 253 : Page Operation: Page(3,Container(0, 913)) pageVersion 386 :  Delete : Slot=110 recordId=116 delete=true instant = (1,270917) logEnd = (1,270977) logIn at 25 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 253 : Page Operation: Page(3,Container(0, 913)) pageVersion 387 :  Delete : Slot=110 recordId=116 delete=false instant = (1,270977) logEnd = (1,271037) logIn at 25 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 253 : Page Operation: Page(3,Container(0, 913)) pageVersion 388 : UpdateField :  Slot=110 recordId=116 fieldId=1 instant = (1,271037) logEnd = (1,271108) logIn at 25 available 30&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 389 : Purge : 1 slots starting at 190 (recordId=196) instant = (1,274147) logEnd = (1,274205) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 390 : Purge : 1 slots starting at 189 (recordId=195) instant = (1,274205) logEnd = (1,274263) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 391 : Purge : 1 slots starting at 188 (recordId=194) instant = (1,274263) logEnd = (1,274321) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 392 : Purge : 1 slots starting at 187 (recordId=193) instant = (1,274321) logEnd = (1,274379) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 393 : Purge : 1 slots starting at 186 (recordId=192) instant = (1,274379) logEnd = (1,274437) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 394 : Purge : 1 slots starting at 185 (recordId=191) instant = (1,274437) logEnd = (1,274495) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 395 : Purge : 1 slots starting at 184 (recordId=190) instant = (1,274495) logEnd = (1,274553) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 396 : Purge : 1 slots starting at 183 (recordId=189) instant = (1,274553) logEnd = (1,274611) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 397 : Purge : 1 slots starting at 182 (recordId=188) instant = (1,274611) logEnd = (1,274669) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 398 : Purge : 1 slots starting at 181 (recordId=187) instant = (1,274669) logEnd = (1,274727) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 399 : Purge : 1 slots starting at 180 (recordId=186) instant = (1,274727) logEnd = (1,274785) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 400 : Purge : 1 slots starting at 179 (recordId=185) instant = (1,274785) logEnd = (1,274843) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 401 : Purge : 1 slots starting at 178 (recordId=184) instant = (1,274843) logEnd = (1,274901) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 402 : Purge : 1 slots starting at 177 (recordId=183) instant = (1,274901) logEnd = (1,274959) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 403 : Purge : 1 slots starting at 176 (recordId=182) instant = (1,274959) logEnd = (1,275017) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 404 : Purge : 1 slots starting at 175 (recordId=181) instant = (1,275017) logEnd = (1,275075) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 405 : Purge : 1 slots starting at 174 (recordId=180) instant = (1,275075) logEnd = (1,275133) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 406 : Purge : 1 slots starting at 173 (recordId=179) instant = (1,275133) logEnd = (1,275191) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 407 : Purge : 1 slots starting at 172 (recordId=178) instant = (1,275191) logEnd = (1,275249) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 408 : Purge : 1 slots starting at 171 (recordId=177) instant = (1,275249) logEnd = (1,275307) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 409 : Purge : 1 slots starting at 170 (recordId=176) instant = (1,275307) logEnd = (1,275365) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 410 : Purge : 1 slots starting at 169 (recordId=175) instant = (1,275365) logEnd = (1,275423) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 411 : Purge : 1 slots starting at 168 (recordId=174) instant = (1,275423) logEnd = (1,275481) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 412 : Purge : 1 slots starting at 167 (recordId=173) instant = (1,275481) logEnd = (1,275539) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 413 : Purge : 1 slots starting at 166 (recordId=172) instant = (1,275539) logEnd = (1,275597) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 414 : Purge : 1 slots starting at 165 (recordId=171) instant = (1,275597) logEnd = (1,275655) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 415 : Purge : 1 slots starting at 164 (recordId=170) instant = (1,275655) logEnd = (1,275713) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 416 : Purge : 1 slots starting at 163 (recordId=169) instant = (1,275713) logEnd = (1,275771) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 417 : Purge : 1 slots starting at 162 (recordId=168) instant = (1,275771) logEnd = (1,275829) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 418 : Purge : 1 slots starting at 161 (recordId=167) instant = (1,275829) logEnd = (1,275887) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 419 : Purge : 1 slots starting at 160 (recordId=166) instant = (1,275887) logEnd = (1,275945) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 420 : Purge : 1 slots starting at 159 (recordId=165) instant = (1,275945) logEnd = (1,276003) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 421 : Purge : 1 slots starting at 158 (recordId=164) instant = (1,276003) logEnd = (1,276061) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 422 : Purge : 1 slots starting at 157 (recordId=163) instant = (1,276061) logEnd = (1,276119) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 423 : Purge : 1 slots starting at 156 (recordId=162) instant = (1,276119) logEnd = (1,276177) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 424 : Purge : 1 slots starting at 155 (recordId=161) instant = (1,276177) logEnd = (1,276235) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 425 : Purge : 1 slots starting at 154 (recordId=160) instant = (1,276235) logEnd = (1,276293) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 426 : Purge : 1 slots starting at 153 (recordId=159) instant = (1,276293) logEnd = (1,276351) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 427 : Purge : 1 slots starting at 152 (recordId=158) instant = (1,276351) logEnd = (1,276409) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 428 : Purge : 1 slots starting at 151 (recordId=157) instant = (1,276409) logEnd = (1,276467) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 429 : Purge : 1 slots starting at 150 (recordId=156) instant = (1,276467) logEnd = (1,276525) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 430 : Purge : 1 slots starting at 149 (recordId=155) instant = (1,276525) logEnd = (1,276583) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 431 : Purge : 1 slots starting at 148 (recordId=154) instant = (1,276583) logEnd = (1,276641) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 432 : Purge : 1 slots starting at 147 (recordId=153) instant = (1,276641) logEnd = (1,276699) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 433 : Purge : 1 slots starting at 146 (recordId=152) instant = (1,276699) logEnd = (1,276757) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 434 : Purge : 1 slots starting at 145 (recordId=151) instant = (1,276757) logEnd = (1,276815) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 435 : Purge : 1 slots starting at 144 (recordId=150) instant = (1,276815) logEnd = (1,276873) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 436 : Purge : 1 slots starting at 143 (recordId=149) instant = (1,276873) logEnd = (1,276931) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 437 : Purge : 1 slots starting at 142 (recordId=148) instant = (1,276931) logEnd = (1,276989) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 438 : Purge : 1 slots starting at 141 (recordId=147) instant = (1,276989) logEnd = (1,277047) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 439 : Purge : 1 slots starting at 140 (recordId=146) instant = (1,277047) logEnd = (1,277105) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 440 : Purge : 1 slots starting at 139 (recordId=145) instant = (1,277105) logEnd = (1,277163) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 441 : Purge : 1 slots starting at 138 (recordId=144) instant = (1,277163) logEnd = (1,277221) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 442 : Purge : 1 slots starting at 137 (recordId=143) instant = (1,277221) logEnd = (1,277279) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 443 : Purge : 1 slots starting at 136 (recordId=142) instant = (1,277279) logEnd = (1,277337) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 444 : Purge : 1 slots starting at 135 (recordId=141) instant = (1,277337) logEnd = (1,277395) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 445 : Purge : 1 slots starting at 134 (recordId=140) instant = (1,277395) logEnd = (1,277453) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 446 : Purge : 1 slots starting at 133 (recordId=139) instant = (1,277453) logEnd = (1,277511) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 447 : Purge : 1 slots starting at 132 (recordId=138) instant = (1,277511) logEnd = (1,277569) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 448 : Purge : 1 slots starting at 131 (recordId=137) instant = (1,277569) logEnd = (1,277627) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 449 : Purge : 1 slots starting at 130 (recordId=136) instant = (1,277627) logEnd = (1,277685) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 450 : Purge : 1 slots starting at 129 (recordId=135) instant = (1,277685) logEnd = (1,277743) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 451 : Purge : 1 slots starting at 128 (recordId=134) instant = (1,277743) logEnd = (1,277801) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 452 : Purge : 1 slots starting at 127 (recordId=133) instant = (1,277801) logEnd = (1,277859) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 453 : Purge : 1 slots starting at 126 (recordId=132) instant = (1,277859) logEnd = (1,277917) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 454 : Purge : 1 slots starting at 125 (recordId=131) instant = (1,277917) logEnd = (1,277975) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 455 : Purge : 1 slots starting at 124 (recordId=130) instant = (1,277975) logEnd = (1,278033) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 456 : Purge : 1 slots starting at 123 (recordId=129) instant = (1,278033) logEnd = (1,278091) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 457 : Purge : 1 slots starting at 122 (recordId=128) instant = (1,278091) logEnd = (1,278149) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 458 : Purge : 1 slots starting at 121 (recordId=127) instant = (1,278149) logEnd = (1,278207) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 459 : Purge : 1 slots starting at 120 (recordId=126) instant = (1,278243) logEnd = (1,278301) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 460 : Purge : 1 slots starting at 119 (recordId=125) instant = (1,278301) logEnd = (1,278359) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 461 : Purge : 1 slots starting at 118 (recordId=124) instant = (1,278359) logEnd = (1,278417) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 462 : Purge : 1 slots starting at 117 (recordId=123) instant = (1,278417) logEnd = (1,278475) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 463 : Purge : 1 slots starting at 116 (recordId=122) instant = (1,278475) logEnd = (1,278533) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 464 : Purge : 1 slots starting at 115 (recordId=121) instant = (1,278533) logEnd = (1,278591) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 465 : Purge : 1 slots starting at 114 (recordId=120) instant = (1,278591) logEnd = (1,278649) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 466 : Purge : 1 slots starting at 113 (recordId=119) instant = (1,278649) logEnd = (1,278707) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 467 : Purge : 1 slots starting at 112 (recordId=118) instant = (1,278707) logEnd = (1,278765) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 468 : Purge : 1 slots starting at 111 (recordId=117) instant = (1,278765) logEnd = (1,278823) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 469 : Purge : 1 slots starting at 109 (recordId=115) instant = (1,278823) logEnd = (1,278881) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 470 : Purge : 1 slots starting at 108 (recordId=114) instant = (1,278881) logEnd = (1,278939) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 471 : Purge : 1 slots starting at 107 (recordId=113) instant = (1,278939) logEnd = (1,278997) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 472 : Purge : 1 slots starting at 106 (recordId=112) instant = (1,278997) logEnd = (1,279055) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 473 : Purge : 1 slots starting at 105 (recordId=111) instant = (1,279055) logEnd = (1,279113) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 474 : Purge : 1 slots starting at 104 (recordId=110) instant = (1,279113) logEnd = (1,279171) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 475 : Purge : 1 slots starting at 103 (recordId=109) instant = (1,279171) logEnd = (1,279229) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 476 : Purge : 1 slots starting at 102 (recordId=108) instant = (1,279229) logEnd = (1,279287) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: scanned 255 : Page Operation: Page(3,Container(0, 913)) pageVersion 477 : Purge : 1 slots starting at 101 (recordId=107) instant = (1,279388) logEnd = (1,279446) logIn at 23 available 19&lt;br/&gt;
DEBUG LogTrace OUTPUT: Rollback log record at instant (1,279388) : Page Operation: Page(3,Container(0, 913)) pageVersion 477 : Purge : 1 slots starting at 101 (recordId=107)&lt;br/&gt;
page id Page(3,Container(0, 913)) Overflow: false PageVersion: 579 SlotsInUse: 2 DeletedRowCount: 0 PageStatus: 1 NextId: 199 firstFreeByte: 133 freeSpace: 3943 totalSpace: 4028 spareSpace: 0 PageSize: 4096&lt;br/&gt;
page id Page(3,Container(0, 913)) Overflow: false PageVersion: 579 SlotsInUse: 2 DeletedRowCount: 0 PageStatus: 1 NextId: 199 firstFreeByte: 133 freeSpace: 3943 totalSpace: 4028 spareSpace: 0 PageSize: 4096&lt;/p&gt;</comment>
                            <comment id="12419746" author="mikem" created="Sat, 8 Jul 2006 00:40:44 +0100"  >&lt;p&gt;This is full recovery debug log from the 335 repro.&lt;/p&gt;</comment>
                            <comment id="12419765" author="mikem" created="Sat, 8 Jul 2006 02:14:43 +0100"  >&lt;p&gt;After a bit more thought the code can not throw an assert during undo based on page versions.  It may &lt;br/&gt;
be perfectly valid to appy a version 400 undo record to a version 500 page, due to row level locking where&lt;br/&gt;
100 changes have committed but the 400th change needs to be undone.  So the only issue is that  in &lt;br/&gt;
the recovery case on the backup it is seeing version 579 of the page, but the log is only up to version &lt;br/&gt;
476 of the page.  &lt;/p&gt;

&lt;p&gt;I have committed a new test OnlineBackupTest5.sql, which is the same as OnlineBackupTest4.sql except&lt;br/&gt;
that it restores the backup to a new location, leaving the evidence of the old db.  If this one reproduces the&lt;br/&gt;
problem it should be clear whether this is a backup problem, or a mainline recovery problem.  So far I have&lt;br/&gt;
not been able to reproduce on my hardware/os, would appreciate it if someone can iterate over the new &lt;br/&gt;
test and post the results if it fails.&lt;/p&gt;</comment>
                            <comment id="12419965" author="knutanders" created="Mon, 10 Jul 2006 14:12:38 +0100"  >&lt;p&gt;Attached &apos;test5.zip&apos; which contains logs/db from a failure in OnlineBackupTest5.sql.&lt;/p&gt;</comment>
                            <comment id="12420232" author="mikem" created="Tue, 11 Jul 2006 15:20:46 +0100"  >&lt;p&gt;After looking at the test5.zip, I believe I understand what is going on.  The original database has a single log file file: log1.dat.&lt;br/&gt;
It&apos;s last record is (1,285606), while in the backup the last log record is (1,279540).  So the &quot;missing&quot; log records are all in the last block of the log file.  I think the problem is that the online backup reads page &quot;through&quot; the cache, rather than from disk so it is picking up &quot;dirty&quot; pages where the associated log records have not yet been flushed to disk.  The backup of the log file on the other hand goes directly from disk and thus sometimes in this concurrent test misses some of the log records in the unflushed part of the log file.  In this test most of the &quot;concurrent&quot; work is actually post commit committed delete cleanup which happens to use &quot;no-sync&quot; commit, thus the only flushes coming are either from filling a block or from the backup itself.&lt;/p&gt;

&lt;p&gt;I believe the fix is easy, just have the backup flush the log file after it has backed up all the data, and before backing up the&lt;br/&gt;
remaining log files at the end.  I spent some time trying to get a more reproducible case but haven&apos;t gotten anywhere there. It &lt;br/&gt;
makes sense that it is more likely on multiprocessors where the backup and other threads can be running at same time.  &lt;/p&gt;</comment>
                            <comment id="12427240" author="mikem" created="Thu, 10 Aug 2006 15:36:48 +0100"  >&lt;p&gt;committed fix to trunk:&lt;br/&gt;
m3_142:80&amp;gt;svn commit&lt;/p&gt;

&lt;p&gt;Sending        java\engine\org\apache\derby\impl\store\raw\log\LogToFile.java&lt;br/&gt;
Transmitting file data .&lt;br/&gt;
Committed revision 430396.&lt;/p&gt;</comment>
                            <comment id="12427825" author="knutanders" created="Mon, 14 Aug 2006 08:30:55 +0100"  >&lt;p&gt;Verified the fix. Thanks Mike!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12336508" name="derby_335.log" size="146204" author="mikem" created="Sat, 8 Jul 2006 00:40:44 +0100"/>
                            <attachment id="12336405" name="linuxfailure.zip" size="110138" author="knutanders" created="Thu, 6 Jul 2006 15:33:10 +0100"/>
                            <attachment id="12336501" name="solaris-singlecpu.zip" size="63072" author="knutanders" created="Fri, 7 Jul 2006 18:57:59 +0100"/>
                            <attachment id="12336406" name="solarisfailure.zip" size="110274" author="knutanders" created="Thu, 6 Jul 2006 15:33:10 +0100"/>
                            <attachment id="12325765" name="storemore.zip" size="69100" author="knutanders" created="Mon, 24 Apr 2006 20:48:32 +0100"/>
                            <attachment id="12336453" name="test2_379.jar" size="113166" author="skambha" created="Fri, 7 Jul 2006 02:31:23 +0100"/>
                            <attachment id="12336452" name="test335.jar" size="111216" author="skambha" created="Fri, 7 Jul 2006 02:31:23 +0100"/>
                            <attachment id="12336560" name="test5.zip" size="209193" author="knutanders" created="Mon, 10 Jul 2006 14:12:38 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 7 Jul 2006 01:31:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22394</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0w4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39022</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>