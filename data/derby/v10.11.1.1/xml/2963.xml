<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:39:39 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2963/DERBY-2963.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2963] AccessControlException: Access denied java.net.SocketPermission &lt;client ip&gt; accept,resolve</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2963</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I start the server using an ipv4 address&lt;/p&gt;

&lt;p&gt;java derbyrun.jar server start -h x.x.x.x&lt;/p&gt;

&lt;p&gt;Then I connect from a remote client  and hit an AccessControlException&lt;/p&gt;

&lt;p&gt;The ip in the exception is that of the &lt;b&gt;client&lt;/b&gt;, not the server.&lt;/p&gt;

&lt;p&gt;This setup works in 10.2.2.0.&lt;/p&gt;

&lt;p&gt;Same problem if the hostname is in derby.properties&lt;/p&gt;

&lt;p&gt;Problem can be worked around by using -noSecurityManager when starting the server&lt;/p&gt;</description>
                <environment>SuseLinux 10&lt;br/&gt;
IBM JVM 1.5</environment>
        <key id="12374281">DERBY-2963</key>
            <summary>AccessControlException: Access denied java.net.SocketPermission &lt;client ip&gt; accept,resolve</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="djd">Daniel John Debrunner</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Jul 2007 19:14:52 +0100</created>
                <updated>Tue, 30 Jun 2009 16:55:45 +0100</updated>
                            <resolved>Wed, 25 Jul 2007 23:18:47 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12514288" author="mkutty" created="Fri, 20 Jul 2007 20:17:40 +0100"  >&lt;p&gt;I found it happening on both Ipv6 and Ipv4 machines. Ipv6 machines gave me the stack trace as follows&lt;br/&gt;
java.security.AccessControlException: Access denied (java.net.SocketPermission &lt;span class=&quot;error&quot;&gt;&amp;#91;2002:92a:8f7a:13:9:42:73:218&amp;#93;&lt;/span&gt;:32813 accept,resolve)&lt;br/&gt;
        at java.security.AccessController.checkPermission(AccessController.java:104)&lt;br/&gt;
        at java.lang.SecurityManager.checkPermission(SecurityManager.java:547)&lt;br/&gt;
        at java.lang.SecurityManager.checkAccept(SecurityManager.java:1172)&lt;br/&gt;
        at java.net.ServerSocket.implAccept(ServerSocket.java:466)&lt;br/&gt;
        at java.net.ServerSocket.accept(ServerSocket.java:433)&lt;br/&gt;
        at org.apache.derby.impl.drda.ClientThread$1.run(Unknown Source)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(AccessController.java:242)&lt;br/&gt;
        at org.apache.derby.impl.drda.ClientThread.run(Unknown Source)&lt;/p&gt;


&lt;p&gt;Ipv4 machine didn&apos;t give any exception other the the following error message&lt;br/&gt;
ij&amp;gt;connect &apos;jdbc:derby://incus.rtp.raleigh.ibm.com:1527/ipv6db;create=true;user=user2;password=pass2&apos;;&lt;br/&gt;
ERROR 58009: Insufficient data while reading from the network - expected a minimum of 6 bytes and received only -1 bytes.  The connection has been terminated.&lt;br/&gt;
ij&amp;gt;&lt;/p&gt;

</comment>
                            <comment id="12514439" author="myrna" created="Sat, 21 Jul 2007 21:03:31 +0100"  >&lt;p&gt;Just to make sure - is this only when using derbyrun.jar, or also when using NetworkServerControl directly? &lt;/p&gt;</comment>
                            <comment id="12514461" author="mkutty" created="Sun, 22 Jul 2007 07:50:25 +0100"  >&lt;p&gt;No, it is not with the derbyrun.jar. I haven&apos;t used derbyrun.jar at all. It is from using the NetworkServerControl command. Is there a known problem with the derbyrun.jar ?&lt;/p&gt;</comment>
                            <comment id="12514473" author="myrna" created="Sun, 22 Jul 2007 15:51:07 +0100"  >
&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; See the problem description of this bug:&lt;/p&gt;

&lt;p&gt;Dan wrote:&lt;/p&gt;

&lt;p&gt;I was pretty sure this is what you&apos;d say, - derbyrun.jar kicks off&lt;br/&gt;
NetworkServerControl - but I just wanted to be sure.&lt;/p&gt;

&lt;p&gt;My next questions are:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;what is the difference between this approach and the steps you&lt;br/&gt;
tested that worked for ipv6 for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2874&quot; title=&quot;NetworkServer not accepting connections with default security manager on Ipv6 machines&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2874&quot;&gt;&lt;del&gt;DERBY-2874&lt;/del&gt;&lt;/a&gt;?&lt;br/&gt;
and to pinpoint the problem better:&lt;/li&gt;
	&lt;li&gt;does the current problem happen with 10.3.0.0 beta? 10.3.1.1?&lt;/li&gt;
	&lt;li&gt;does the problem occur with 10.2.2.0 when security policy is enabled&lt;br/&gt;
(i.e. is it a problem with the security policy being on by default, or&lt;br/&gt;
is it a more insidious problem with network server. I&apos;m asking because&lt;br/&gt;
Dan reported the problem does not occur with 10.3.1.2 when the server&lt;br/&gt;
is started with -noSecurityManager).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I hope someone with access to an IPV6 can go through the hoops of&lt;br/&gt;
providing these answers, or someone with understanding of the problem&lt;br/&gt;
can come forward and fix it.&lt;br/&gt;
I believe Rick, who implemented the secure server by default (&amp;amp;fixed&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2874&quot; title=&quot;NetworkServer not accepting connections with default security manager on Ipv6 machines&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2874&quot;&gt;&lt;del&gt;DERBY-2874&lt;/del&gt;&lt;/a&gt;) is not available this week to fix anything, so if it&apos;s in&lt;br/&gt;
that area we may have to wait for more than a week for a fix unless&lt;br/&gt;
someone else steps up...&lt;/p&gt;

&lt;p&gt;Myrna&lt;/p&gt;</comment>
                            <comment id="12514645" author="dagw" created="Mon, 23 Jul 2007 15:47:20 +0100"  >&lt;p&gt;I also see the issue regardless of whether derbyrun.jar is used or not (IPv4,&lt;br/&gt;
on Solaris).&lt;/p&gt;

&lt;p&gt;It seems the default policy file installed intentionally does &lt;b&gt;not&lt;/b&gt;&lt;br/&gt;
open access to remote clients. I am not sure, but I seem to remember&lt;br/&gt;
this being discussed (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2196&quot; title=&quot;Run standalone network server with security manager by default&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2196&quot;&gt;&lt;del&gt;DERBY-2196&lt;/del&gt;&lt;/a&gt;) and found to be acceptable? However,&lt;br/&gt;
the release notes do not indicate this, which would seem to indicate&lt;br/&gt;
it is not the intended behavior, in which case it is a bug, not a&lt;br/&gt;
&quot;feature&quot;.&lt;/p&gt;

&lt;p&gt;Changing this line in server.policy:&lt;/p&gt;

&lt;p&gt;  permission java.net.SocketPermission &quot;$&lt;/p&gt;
{derby.security.host}
&lt;p&gt;&quot;, &quot;accept&quot;; &lt;/p&gt;

&lt;p&gt;to:&lt;/p&gt;

&lt;p&gt;  permission java.net.SocketPermission &quot;*&quot;, &quot;accept&quot;; &lt;/p&gt;

&lt;p&gt;lets me connect from any host to the interface name given in -h option.&lt;/p&gt;</comment>
                            <comment id="12514658" author="dagw" created="Mon, 23 Jul 2007 16:53:37 +0100"  >&lt;p&gt;Uploading a tentative patch against 10.3 trunk widening the&lt;br/&gt;
SocketPermission to &quot;*&quot;, &quot;accept&quot; (not for commit yet).&lt;br/&gt;
Running regression tests now.&lt;/p&gt;

&lt;p&gt;If we make this change this we would need to update the documentation&lt;br/&gt;
(and preferably the func spec).&lt;/p&gt;</comment>
                            <comment id="12514678" author="djd" created="Mon, 23 Jul 2007 17:51:16 +0100"  >&lt;p&gt;Does this patch work if localhost is specified as the host to listen on?&lt;/p&gt;

&lt;p&gt;Just wondering because the security documentation has the permission &quot;listen&quot; which is only used for localhost, so I wonder if accept works when listening on localhost.&lt;/p&gt;</comment>
                            <comment id="12514795" author="mkutty" created="Mon, 23 Jul 2007 22:48:38 +0100"  >&lt;p&gt;This was working with 551289M with Rick&apos;s fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2874&quot; title=&quot;NetworkServer not accepting connections with default security manager on Ipv6 machines&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2874&quot;&gt;&lt;del&gt;DERBY-2874&lt;/del&gt;&lt;/a&gt; on Ipv6 machines. &lt;/p&gt;</comment>
                            <comment id="12514803" author="dagw" created="Mon, 23 Jul 2007 23:27:55 +0100"  >&lt;p&gt;Good question, Dan. My testing indicates it works, but I don&apos;t really understand why.&lt;br/&gt;
I can&apos;t find anywhere that &quot;listen&quot; is implied by &quot;accept&quot;.  I&apos;ll see what I can find out.&lt;/p&gt;</comment>
                            <comment id="12515028" author="dagw" created="Tue, 24 Jul 2007 17:58:50 +0100"  >&lt;p&gt;Did some digging on the &quot;listen&quot; privilege and the other socket&lt;br/&gt;
privileges.&lt;/p&gt;

&lt;p&gt;The default policy file (java.home/lib/security/java.policy) contains&lt;br/&gt;
this line:&lt;/p&gt;

&lt;p&gt;        // allows anyone to listen on un-privileged ports&lt;br/&gt;
	permission java.net.SocketPermission &quot;localhost:1024-&quot;, &quot;listen&quot;;&lt;/p&gt;

&lt;p&gt;If the user specifies a port below 1024, the default policy file would&lt;br/&gt;
not work for any interface. Is this acceptable? For running with root&lt;br/&gt;
privileges, privileged ports is a valid use case, otherwise &quot;1024-&quot; is&lt;br/&gt;
enough. To handle privileged ports we need to add another line the&lt;br/&gt;
policy file:&lt;/p&gt;

&lt;p&gt;       permission java.net.SocketPermission &quot;localhost&quot;, &quot;listen&quot;; &lt;/p&gt;

&lt;p&gt;or, to tighten it down, add code to produced the correct line e.g. so&lt;br/&gt;
for IPv4 (would not work for IPv6 probably..)&lt;/p&gt;

&lt;p&gt;    permission java.net.SocketPermission &quot;localhost:$&lt;/p&gt;
{derby.security.port}
&lt;p&gt;&quot;, &quot;listen&quot;; &lt;/p&gt;

&lt;p&gt;(Note that even if we specify -h x.x.x.x it is still &quot;localhost&quot; that&lt;br/&gt;
needs to get the extra privileges for listening.)&lt;/p&gt;

&lt;p&gt;Other than &quot;listen&quot; and &quot;accept&quot;, we also need &quot;resolve&quot;, but that is&lt;br/&gt;
implied by &quot;accept&quot;.&lt;/p&gt;

&lt;p&gt;So in summary, the present patch is sufficient; unless we want the&lt;br/&gt;
default policy to allow using privileged ports. What do you think?&lt;/p&gt;</comment>
                            <comment id="12515084" author="mkutty" created="Tue, 24 Jul 2007 21:23:26 +0100"  >&lt;p&gt;This solution looks fine to me. Also I don&apos;t think we should allow default policy to allow using previleged ports. I will be applying the patch and will test on both regular and ipv6 machines&lt;/p&gt;</comment>
                            <comment id="12515126" author="mkutty" created="Wed, 25 Jul 2007 01:37:40 +0100"  >&lt;p&gt;This patch works fine. I tested the following scenarios &lt;/p&gt;

&lt;p&gt;1. starting the server by giving -h option with ipaddress&lt;br/&gt;
java org.apache.derby.drda.NetworkServerControl start -h 9.72.143.153&lt;/p&gt;

&lt;p&gt;2. Starting the server with -h 0.0.0.0&lt;br/&gt;
java org.apache.derby.drda.NetworkServerControl start -h 0.0.0.0&lt;/p&gt;

&lt;p&gt;3.  starting the server by giving -h option with ipaddress on ipv6 machines&lt;br/&gt;
java org.apache.derby.drda.NetworkServerControl start -h 2002:92a:8f7a:13:9:42:74:19&lt;/p&gt;


&lt;p&gt;All of them works fine. I would appreciate if we could include this patch in our release candidate&lt;/p&gt;</comment>
                            <comment id="12515318" author="dagw" created="Wed, 25 Jul 2007 16:30:18 +0100"  >&lt;p&gt;Committed on trunk as svn 559436. I will merge to the 10.3 branch&lt;br/&gt;
as soon as my tests are done.&lt;/p&gt;</comment>
                            <comment id="12515319" author="dagw" created="Wed, 25 Jul 2007 16:34:30 +0100"  >&lt;p&gt;Uploading the the version I committed. I improved the&lt;br/&gt;
comment a bit relative to the first version, since the&lt;br/&gt;
tempate policy file will go into the manual, too.&lt;/p&gt;</comment>
                            <comment id="12515385" author="dagw" created="Wed, 25 Jul 2007 19:53:21 +0100"  >&lt;p&gt;Committed on the 10.3 branch as svn 559555.&lt;/p&gt;</comment>
                            <comment id="12515427" author="dagw" created="Wed, 25 Jul 2007 22:25:18 +0100"  >&lt;p&gt;Uploading a diff for the admin guide to it can stay in synch&lt;br/&gt;
with the policy template file.&lt;/p&gt;</comment>
                            <comment id="12515429" author="dagw" created="Wed, 25 Jul 2007 22:31:00 +0100"  >&lt;p&gt;Committed doc patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2963&quot; title=&quot;AccessControlException: Access denied java.net.SocketPermission &amp;lt;client ip&amp;gt; accept,resolve&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2963&quot;&gt;&lt;del&gt;DERBY-2963&lt;/del&gt;&lt;/a&gt;-docs-1) to doc trunk as svn 559616.&lt;/p&gt;</comment>
                            <comment id="12515443" author="dagw" created="Wed, 25 Jul 2007 23:17:30 +0100"  >&lt;p&gt;Merged doc patch to docs 10.3 branch as svn 559632.&lt;/p&gt;</comment>
                            <comment id="12515444" author="dagw" created="Wed, 25 Jul 2007 23:18:47 +0100"  >&lt;p&gt;Fixed in source and docs on trunk and 10.3, resolving.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12359060">DERBY-2196</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12362535" name="DERBY-2963-1.diff" size="1900" author="dagw" created="Wed, 25 Jul 2007 16:34:30 +0100"/>
                            <attachment id="12362347" name="DERBY-2963-1.diff" size="1376" author="dagw" created="Mon, 23 Jul 2007 16:53:37 +0100"/>
                            <attachment id="12362348" name="DERBY-2963-1.stat" size="108" author="dagw" created="Mon, 23 Jul 2007 16:53:37 +0100"/>
                            <attachment id="12362559" name="DERBY-2963-docs-1.diff" size="960" author="dagw" created="Wed, 25 Jul 2007 22:25:18 +0100"/>
                            <attachment id="12362560" name="DERBY-2963-docs-1.stat" size="46" author="dagw" created="Wed, 25 Jul 2007 22:25:18 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 20 Jul 2007 19:17:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23347</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0uwn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38825</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>