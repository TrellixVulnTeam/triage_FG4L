<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:45:01 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1466/DERBY-1466.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1466] Network Server should flush the PrintWriter after console output</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1466</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If Network Server is started with a PrintWriter specified for console output it will not automatically flush output such as  starting the server.  This can be confusing as the console output shows no activity.&lt;/p&gt;

&lt;p&gt;Users currently need to specify the PrintWriter to autoflush  e.g.&lt;br/&gt;
 starterWriter = new PrintWriter(new FileOutputStream(new File(SERVER_START_LOG)),true); &lt;/p&gt;

&lt;p&gt;derbyServer = new NetworkServerControl();&lt;br/&gt;
 derbyServer.start(starterWriter); &lt;/p&gt;


&lt;p&gt;For repro see:&lt;br/&gt;
&lt;a href=&quot;http://www.nabble.com/Questions-about-Network-Server-API-Behavior-p5055814.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/Questions-about-Network-Server-API-Behavior-p5055814.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And change the following line in the program to not autoflush as follows:&lt;br/&gt;
starterWriter = new PrintWriter(new FileOutputStream(new File(SERVER_START_LOG)),false); &lt;/p&gt;</description>
                <environment></environment>
        <key id="12345204">DERBY-1466</key>
            <summary>Network Server should flush the PrintWriter after console output</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="skambha">Sunitha Kambhampati</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Jun 2006 21:23:51 +0100</created>
                <updated>Thu, 10 Aug 2006 23:42:58 +0100</updated>
                            <resolved>Mon, 17 Jul 2006 21:02:17 +0100</resolved>
                                    <version>10.1.2.1</version>
                                    <fixVersion>10.1.3.2</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                            <comments>
                            <comment id="12420949" author="skambha" created="Fri, 14 Jul 2006 06:07:35 +0100"  >&lt;p&gt;I took a quick look at this and want to  start a discussion on how this could be solved. &lt;/p&gt;

&lt;p&gt;Per java api for PrintWriter&lt;br/&gt;
&amp;#8211; There is no method to turn autoflush on an existing PrintWriter object.&lt;br/&gt;
&amp;#8211; when autoflush is on, flush will happen on the println statement only.&lt;/p&gt;

&lt;p&gt;some solution options:&lt;br/&gt;
1) one is wrap the user&apos;s writer object with a PrintWriter and set autoflush to true&lt;br/&gt;
    &amp;#8211; change in code only required in two places.&lt;br/&gt;
    &amp;#8211; maybe ugly to wrap the object.&lt;/p&gt;

&lt;p&gt;2)  explicitly call flush in all places after  we write to this writer object.&lt;/p&gt;

&lt;p&gt;In Eclipse, searched for places where the logWriter in NetworkServerControl is referenced, here is the list&lt;br/&gt;
NetworkServerControlImpl - org.apache.derby.impl.drda - java/drda - ks_trunk&lt;br/&gt;
consoleExceptionPrintTrace(Throwable) (3 potential matches)&lt;br/&gt;
consoleMessage(String) (3 potential matches)&lt;br/&gt;
executeWork(String[]) (potential match)&lt;br/&gt;
setLogWriter(PrintWriter) (potential match)&lt;br/&gt;
shutdown() (2 potential matches)&lt;/p&gt;

&lt;p&gt;So that is not a lot of places. so option 2 should be simple too. unless we miss to call flush in all the places.&lt;br/&gt;
------------------&lt;/p&gt;

&lt;p&gt;There is one case where the writer is passed to exception.printStackTrace . If this gets flushed correctly in autoflush mode, I think #1 seems ok to me, less number of changes than #2.&lt;/p&gt;

&lt;p&gt;I  was concerned a bit if setting autoflush will have any performance impact.  But maybe it is ok since console output is not expected to be verbose anyways.&lt;/p&gt;

&lt;p&gt;Comments/thoughts ?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="12420953" author="kmarsden" created="Fri, 14 Jul 2006 06:22:19 +0100"  >&lt;p&gt;Hi Sunitha,&lt;/p&gt;

&lt;p&gt;I do not have an opinion on implementation but think it is important for the  console printwriter to flush whenever there is a message.    I don&apos;t  think it is a performance issue.  If nothing goes wrong this is just the startup and the shutdown message.  If something does go wrong, we &lt;b&gt;really&lt;/b&gt; want to see it because  if there is a crash of some  sort it will never be seen,  especailly with &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1456&quot; title=&quot;Network Server agentError calls log only to console and are hard to diagnose&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1456&quot;&gt;&lt;del&gt;DERBY-1456&lt;/del&gt;&lt;/a&gt; outstanding.&lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;</comment>
                            <comment id="12421243" author="skambha" created="Fri, 14 Jul 2006 23:42:04 +0100"  >&lt;p&gt;Thanks to everyone who responded on this issue.&lt;/p&gt;

&lt;p&gt;I am attaching a patch &apos;derby1466.diff.txt&apos; and corresponding &apos;derby1466.stat.txt&apos; which uses approach 1 to autoflush the data written to the console. &lt;/p&gt;

&lt;p&gt;This patch does&lt;br/&gt;
&amp;#8211; wrap the printwriter that the user&apos;s uses with another printwriter with autoflush as true.&lt;br/&gt;
This will ensure that data will be flushed at println calls. Also, exception.printStackTrace(writer) will also flush data to the writer correctly. &lt;/p&gt;

&lt;p&gt;&amp;#8211; There is a prexisting test - DerbyNetNewserver.java that is meant to test the&lt;br/&gt;
Test NetworkServerControl.start(PrintWriter) call.  In the test, the user is passing a printwriter, that has autoflush=true. &lt;/p&gt;

&lt;p&gt;From looking at this test, it seemed to me that the original intent was to have user specify the autoflush=true option when using the NetworkServerControl.start(PrintWriter) call. &lt;/p&gt;

&lt;p&gt;Now with &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1466&quot; title=&quot;Network Server should flush the PrintWriter after console output&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1466&quot;&gt;&lt;del&gt;DERBY-1466&lt;/del&gt;&lt;/a&gt;, we want all messages to be flushed by default, so I have made changes to this test to pass a PrintWriter without autoflush=true. &lt;/p&gt;

&lt;p&gt;derbynetclientmats and derbynetmats ran fine on ibm142/linux.  My derbyall is currently running.&lt;/p&gt;

&lt;p&gt;Can someone please review.  Thanks.&lt;/p&gt;
</comment>
                            <comment id="12421247" author="davidvc" created="Sat, 15 Jul 2006 00:00:52 +0100"  >&lt;p&gt;I looked at the patch, it looks pretty simple, +1.  I haven&apos;t tried to apply it.  If it passes derbyall for Sunitha, I can apply it and run a sanity test before checking in.&lt;/p&gt;</comment>
                            <comment id="12421317" author="skambha" created="Sat, 15 Jul 2006 19:53:29 +0100"  >&lt;p&gt;derbyall passed ok on ibm142/linux.   Thanks David for looking at the patch. &lt;/p&gt;</comment>
                            <comment id="12421710" author="davidvc" created="Mon, 17 Jul 2006 21:02:17 +0100"  >&lt;p&gt;Submitted revision 42286&lt;/p&gt;</comment>
                            <comment id="12422243" author="kartha" created="Wed, 19 Jul 2006 21:51:14 +0100"  >&lt;p&gt;Can this issue be ported to the 10.1 branch, in which case &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1485&quot; title=&quot;Document that autoflush is needed if Network Server is started with a PrintWriter specified for console output&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1485&quot;&gt;&lt;del&gt;DERBY-1485&lt;/del&gt;&lt;/a&gt; can also be closed as well.&lt;/p&gt;</comment>
                            <comment id="12427362" author="kmarsden" created="Thu, 10 Aug 2006 23:42:58 +0100"  >&lt;p&gt;t&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12336916" name="derby1466.diff.txt" size="2415" author="skambha" created="Fri, 14 Jul 2006 23:42:04 +0100"/>
                            <attachment id="12336917" name="derby1466.stat.txt" size="242" author="skambha" created="Fri, 14 Jul 2006 23:42:04 +0100"/>
                    </attachments>
                <subtasks>
                            <subtask id="12345588">DERBY-1485</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 14 Jul 2006 05:07:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30002</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy14xj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40449</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>