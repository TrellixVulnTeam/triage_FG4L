<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:26:09 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4081/DERBY-4081.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4081] BTreeController.comparePreviousRecord() may fail to release latch on left-most leaf</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4081</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If comparePreviousRecord() is called on some other leaf page than the left-most leaf, and all the rows to the left of the current position are deleted so that the position is moved all the way to slot 0 on the left-most leaf, comparePreviousRecord() will return without releasing the latch on the left-most leaf. Only the leaf on which comparePreviousRecord() is called should be latched when the method returns.&lt;/p&gt;

&lt;p&gt;Since comparePreviousRecord() currently fails to continue after finding a deleted row, this bug is not possible to expose until &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4028&quot; title=&quot;two rows can be inserted with the same value in a column that a unique constraint on that column should prevent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4028&quot;&gt;&lt;del&gt;DERBY-4028&lt;/del&gt;&lt;/a&gt; is fixed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12415992">DERBY-4081</key>
            <summary>BTreeController.comparePreviousRecord() may fail to release latch on left-most leaf</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Mar 2009 11:02:21 +0000</created>
                <updated>Mon, 5 Jul 2010 17:39:33 +0100</updated>
                            <resolved>Thu, 20 Aug 2009 13:18:00 +0100</resolved>
                                    <version>10.4.2.0</version>
                                    <fixVersion>10.4.2.1</fixVersion>
                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12678296" author="knutanders" created="Tue, 3 Mar 2009 12:01:23 +0000"  >&lt;p&gt;I believe that the attached patch solves the problem. It releases the latch on the previous page earlier, so that it is already released when the method detects that it is positioned before the left-most leaf and returns NO_MATCH. This is the same thing as compareNextRecord() does when it detects that it&apos;s positioned after the right-most leaf.&lt;/p&gt;</comment>
                            <comment id="12726629" author="rhillegas" created="Thu, 2 Jul 2009 19:57:00 +0100"  >&lt;p&gt;July 2, 2009: Marked PatchAvailable and assigned normal urgency.&lt;/p&gt;</comment>
                            <comment id="12744438" author="knutanders" created="Tue, 18 Aug 2009 10:56:57 +0100"  >&lt;p&gt;Thanks for the reminder, Rick.&lt;/p&gt;

&lt;p&gt;I think I&apos;ve found a way to expose this problem now. Just continuously executing &quot;insert into t&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; values 0&quot; followed by &quot;delete from t&quot;, where T.X is unique nullable and with auto-commit off, consistently hangs on the 372nd iteration.&lt;/p&gt;

&lt;p&gt;On 10.5.1.1 that repro fails with a WaitError (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4097&quot; title=&quot;&amp;#39;testMixedInsertDelete(org.apache.derbyTesting.functionTests.tests.lang.NullableUniqueConstraintTest)org.apache.derby.client.am.BatchUpdateException&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4097&quot;&gt;&lt;del&gt;DERBY-4097&lt;/del&gt;&lt;/a&gt;). It does not expose the problem on 10.4.2.0 or earlier since &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4028&quot; title=&quot;two rows can be inserted with the same value in a column that a unique constraint on that column should prevent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4028&quot;&gt;&lt;del&gt;DERBY-4028&lt;/del&gt;&lt;/a&gt; hides the problem by stopping the check for duplicates too early.&lt;/p&gt;</comment>
                            <comment id="12744465" author="knutanders" created="Tue, 18 Aug 2009 12:34:47 +0100"  >&lt;p&gt;Attached a new patch (1b) with no changes from 1a except that a test case has been added to NullableUniqueConstraintTest. The test case never completes without the fix because it runs into a self-deadlock (or actually a livelock) caused by the latch it forgot to release. The test case runs and completes successfully with the fix.&lt;/p&gt;</comment>
                            <comment id="12744466" author="knutanders" created="Tue, 18 Aug 2009 12:35:42 +0100"  >&lt;p&gt;Derbyall and suites.All ran cleanly with the patch.&lt;/p&gt;</comment>
                            <comment id="12744957" author="knutanders" created="Wed, 19 Aug 2009 09:33:46 +0100"  >&lt;p&gt;Committed revision 805696. I will keep the bug open until it has been back-ported to 10.5. Perhaps it should go all way back to 10.4, since &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4028&quot; title=&quot;two rows can be inserted with the same value in a column that a unique constraint on that column should prevent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4028&quot;&gt;&lt;del&gt;DERBY-4028&lt;/del&gt;&lt;/a&gt;, which made it possible to expose this bug, was also back-ported to 10.4.&lt;/p&gt;</comment>
                            <comment id="12745421" author="knutanders" created="Thu, 20 Aug 2009 13:17:59 +0100"  >&lt;p&gt;Merged fix to 10.4 (revision 806139) and 10.5 (revision 806138).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12401305" name="derby-4081-1a.diff" size="1262" author="knutanders" created="Tue, 3 Mar 2009 12:01:23 +0000"/>
                            <attachment id="12416864" name="derby-4081-1b.diff" size="3033" author="knutanders" created="Tue, 18 Aug 2009 12:34:47 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 2 Jul 2009 18:57:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24014</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0pzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38028</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>