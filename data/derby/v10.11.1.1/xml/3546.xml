<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:39:28 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3546/DERBY-3546.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3546] Failed to get database schemas of a JAR database</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3546</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When a database residing in a JAR file is open via Derby embedded JDBC connection, the getSchemas() call on the connection&apos;s DatabaseMetaData fails with an exception: ERROR 40XD1: Container was opened in read-only mode.&lt;/p&gt;

&lt;p&gt;STEPS TO REPRODUCE:&lt;br/&gt;
(1) Download the attached JAR database, BirtSample.jar, and place it in C:\ (or if another location, update the dbFile variable in  test code below).&lt;br/&gt;
(2) Run the following Java test code, with derby.jar (version 10.3.1.1) in classpath.&lt;/p&gt;

&lt;p&gt;// *** BEGIN TEST CODE&lt;br/&gt;
import java.sql.Connection;&lt;br/&gt;
import java.sql.DatabaseMetaData;&lt;br/&gt;
import java.sql.DriverManager;&lt;br/&gt;
import java.sql.ResultSet;&lt;/p&gt;

&lt;p&gt;public class TestGetDBMetaData&lt;br/&gt;
{&lt;br/&gt;
	public static void main(String[] args) throws Exception&lt;/p&gt;
	{
		final String dbFile = &quot;c:/BirtSample.jar&quot;;
		final String driverClass = &quot;org.apache.derby.jdbc.EmbeddedDriver&quot;;
		final String url= &quot;jdbc:derby:jar:(&quot; + dbFile + &quot;)BirtSample&quot;;
		final String user = &quot;ClassicModels&quot;;
		final String pwd = &quot;&quot;;
	
		Class.forName( driverClass );
		Connection conn = DriverManager.getConnection( url, user, pwd);
		DatabaseMetaData dbmd = conn.getMetaData();
		ResultSet rs = dbmd.getSchemas();
		rs.close();
		conn.close();
	}
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;// ***END TEST CODE&lt;/p&gt;

&lt;p&gt;The following exception happens in the getSchemas() call:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.sql.SQLException: Container was opened in read-only mode.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver30.newEmbedPreparedStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.prepareMetaDataStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedDatabaseMetaData.prepareSPS(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedDatabaseMetaData.getPreparedQueryUsingSystemTables(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedDatabaseMetaData.getPreparedQuery(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedDatabaseMetaData.getPreparedQuery(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedDatabaseMetaData.getSchemas(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedDatabaseMetaData.getSchemas(Unknown Source)&lt;br/&gt;
	at TestGetDBMetaData.main(TestGetDBMetaData.java:34)&lt;br/&gt;
Caused by: ERROR 40XD1: Container was opened in read-only mode.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseContainer.use(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseContainerHandle.useContainer(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.xact.Xact.openContainer(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.access.conglomerate.OpenConglomerate.init(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.Heap.open(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.RowChangerImpl.openForUpdate(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.RowChangerImpl.open(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.TabInfoImpl.deleteRows(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.TabInfoImpl.deleteRow(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.dropDependentsStoredDependencies(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.depend.BasicDependencyManager.clearDependencies(Unknown Source)&lt;br/&gt;
	at org.apache.derby.iapi.sql.dictionary.SPSDescriptor.compileStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.iapi.sql.dictionary.SPSDescriptor.prepareAndRelease(Unknown Source)&lt;br/&gt;
	at org.apache.derby.iapi.sql.dictionary.SPSDescriptor.getPreparedStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.iapi.sql.dictionary.SPSDescriptor.getPreparedStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ExecSPSNode.generate(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source)&lt;br/&gt;
	... 12 more&lt;/p&gt;


&lt;p&gt;NOTE:&lt;br/&gt;
This is an identical issue as reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-854&quot; title=&quot;DatabaseMetaData methods fail on read-only database&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-854&quot;&gt;&lt;del&gt;DERBY-854&lt;/del&gt;&lt;/a&gt;. It was reported as resolved but is still reproducible in 10.3.2.1., the latest official release as of this report.&lt;/p&gt;</description>
                <environment>Sun JRE 1.5.0_08&lt;br/&gt;
Windows Server 2003</environment>
        <key id="12391490">DERBY-3546</key>
            <summary>Failed to get database schemas of a JAR database</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kmarsden">Kathey Marsden</assignee>
                                    <reporter username="gxue">Gary Xue</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Mar 2008 19:52:25 +0000</created>
                <updated>Fri, 21 Jan 2011 17:51:46 +0000</updated>
                            <resolved>Sun, 25 May 2008 18:26:29 +0100</resolved>
                                    <version>10.3.2.1</version>
                                    <fixVersion>10.3.3.1</fixVersion>
                    <fixVersion>10.4.2.0</fixVersion>
                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12578909" author="gxue" created="Fri, 14 Mar 2008 19:55:42 +0000"  >&lt;p&gt;correction on (2) in STEPS TO REPRODUCE, derby.jar version should be version 10.3.2.1. This is the version of derby used to create the attached JAR database&lt;/p&gt;</comment>
                            <comment id="12597559" author="kmarsden" created="Fri, 16 May 2008 19:08:30 +0100"  >&lt;p&gt;The attached patch fixes the issue for 10.3.  This is not for commit as I haven&apos;t yet run tests or gotten a regression test, but wanted to check if it is the right approach.  For read only databases metadata calls  will read from the metadata.properties instead of attempting to use the Stored Prepared Statements, because those cannot be stored in the database.&lt;/p&gt;</comment>
                            <comment id="12597596" author="kmarsden" created="Fri, 16 May 2008 21:04:56 +0100"  >&lt;p&gt;A workaround for this issue is to connect to the database and make the database metadata calls that are needed once before jaring up the database. The the stored prepared statements will already be in the database and Derby won&apos;t try to create them.&lt;/p&gt;</comment>
                            <comment id="12597745" author="kmarsden" created="Sat, 17 May 2008 20:35:16 +0100"  >&lt;p&gt;Here is a patch for the trunk with a test.  I will check in Monday afternoon if I hear no comments.&lt;/p&gt;</comment>
                            <comment id="12599247" author="dagw" created="Fri, 23 May 2008 00:45:53 +0100"  >&lt;p&gt;I verified that the new test failed without the rest of the patch on trunk as expected, and worked&lt;br/&gt;
when the rest was added.&lt;br/&gt;
Approach looks good to me!&lt;br/&gt;
+1&lt;/p&gt;</comment>
                            <comment id="12599250" author="kmarsden" created="Fri, 23 May 2008 00:54:44 +0100"  >&lt;p&gt;Thanks Dag for looking at the patch!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12377940" name="BirtSample.jar" size="505496" author="gxue" created="Fri, 14 Mar 2008 19:54:06 +0000"/>
                            <attachment id="12382193" name="derby-3546_10.3_diff.txt" size="1307" author="kmarsden" created="Fri, 16 May 2008 19:08:30 +0100"/>
                            <attachment id="12382251" name="derby-3546_trunk_diff.txt" size="7791" author="kmarsden" created="Sat, 17 May 2008 20:35:16 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 16 May 2008 18:08:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23704</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ljr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37309</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>