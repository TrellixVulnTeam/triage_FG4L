<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:41:26 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4061/DERBY-4061.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4061] InputStream returned from Blob.getBinaryStream(long, long) terminates the stream by returning 0, should return -1</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4061</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Take the following code to copy a sub-stream from a BLOB:&lt;/p&gt;

&lt;p&gt;Blob blob = rs.getBlob(1);&lt;br/&gt;
InputStream stream = blob.getBinaryStream(1000, 2000);&lt;br/&gt;
try {&lt;br/&gt;
  IOUtils.copy(stream, out);&lt;br/&gt;
} finally {&lt;br/&gt;
  stream.close();&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;This will loop forever in IOUtils.copy, as the InputStream is returning 0 at end of stream instead of -1.  It probably should return -1 to comply with the Javadoc for InputStream.&lt;/p&gt;

&lt;p&gt;Notes:&lt;br/&gt;
I have not yet checked Blob.getBinaryStream(), or any of the Clob methods, or the client driver.  So some of these may have a similar issue.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12414901">DERBY-4061</key>
            <summary>InputStream returned from Blob.getBinaryStream(long, long) terminates the stream by returning 0, should return -1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="trejkaz">Trejkaz</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Feb 2009 22:05:55 +0000</created>
                <updated>Wed, 12 May 2010 08:38:57 +0100</updated>
                            <resolved>Tue, 24 Feb 2009 14:34:14 +0000</resolved>
                                    <version>10.3.3.0</version>
                    <version>10.4.2.0</version>
                    <version>10.5.1.1</version>
                                    <fixVersion>10.3.3.1</fixVersion>
                    <fixVersion>10.4.2.1</fixVersion>
                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12674114" author="kristwaa" created="Tue, 17 Feb 2009 07:23:50 +0000"  >&lt;p&gt;I think the problem is restricted to UpdatableBlobStream only. The combinations I tried with Clob succeeded, and the client driver also succeeds with the repro for both Blob and Clob.&lt;br/&gt;
The problem in UpdatableBlobStream, is that the underlying source is asked to read zero bytes, which it does... The calling code fails to handle this scenario, which is a valid one seen from InputStream (from JavaDoc: &quot;If len is zero, then no bytes are read and 0 is returned; otherwise, there is an attempt to read at least one byte.&quot;).&lt;/p&gt;</comment>
                            <comment id="12675310" author="kristwaa" created="Fri, 20 Feb 2009 10:09:08 +0000"  >&lt;p&gt;Patch 1a fixes the bug and adds a regression test. I think there is at least one more bug in the class, I&apos;ll investigate later.&lt;br/&gt;
Note that the regression test will cause a hang if the fix is removed.&lt;/p&gt;

&lt;p&gt;Patch ready for review.&lt;br/&gt;
Running the regression suite.&lt;/p&gt;</comment>
                            <comment id="12675356" author="knutanders" created="Fri, 20 Feb 2009 13:09:23 +0000"  >&lt;p&gt;I think there is one tiny problem with the patch, but I haven&apos;t actually tested that it is a problem. I believe that in this code&lt;/p&gt;

&lt;p&gt;+        if (remaining == 0 &amp;amp;&amp;amp; len != 0) &lt;/p&gt;
{
+            return -1;
+        }

&lt;p&gt;(len != 0) should be replaced with (len &amp;gt; 0). Otherwise, we return -1 when len is negative instead of throwing an IndexOutOfBoundsException.&lt;/p&gt;

&lt;p&gt;In the test there&apos;s a typo (infinit -&amp;gt; infinite), and the variable n is unused.&lt;/p&gt;</comment>
                            <comment id="12675365" author="kristwaa" created="Fri, 20 Feb 2009 13:30:07 +0000"  >&lt;p&gt;Regression tests passed without failures on Solaris 10, Java SE 6.&lt;/p&gt;</comment>
                            <comment id="12675369" author="kristwaa" created="Fri, 20 Feb 2009 13:49:17 +0000"  >&lt;p&gt;Thanks for the review and the comments, Knut.&lt;/p&gt;

&lt;p&gt;Patch 1b addresses the comments.&lt;br/&gt;
Committed to trunk with revision 746236.&lt;/p&gt;</comment>
                            <comment id="12676296" author="kristwaa" created="Tue, 24 Feb 2009 14:34:14 +0000"  >&lt;p&gt;Backported fix to 10.4 with revision 747393 and to 10.3 with revision 747395.&lt;/p&gt;</comment>
                            <comment id="12676706" author="kristwaa" created="Wed, 25 Feb 2009 17:00:44 +0000"  >&lt;p&gt;Tinderbox tests for 10.4 and 10.3 ran successfully.&lt;br/&gt;
This issue can be verified and, if found to be fixed, closed by the reporter.&lt;/p&gt;</comment>
                            <comment id="12866492" author="kristwaa" created="Wed, 12 May 2010 08:38:57 +0100"  >&lt;p&gt;Been resolved for more than a year. Closing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12400598" name="derby-4061-1a.diff" size="2443" author="kristwaa" created="Fri, 20 Feb 2009 10:09:08 +0000"/>
                            <attachment id="12400608" name="derby-4061-1b.diff" size="2473" author="kristwaa" created="Fri, 20 Feb 2009 13:49:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 17 Feb 2009 07:23:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24001</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0qc7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38085</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>