<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:20:31 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2711/DERBY-2711.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2711] If large blob is updated after InputStream is fetched (using getBinaryStream), the stream continues to point ot old data</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2711</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;While using a large blob (so that blob doesn&apos;t gets materialized while fetching from database) getBinaryStream returns stream linked to dvd. After blob is is updated internally the blob data is materialized in LOBStreamControl class but the stream continues to point to dvd hence giving out old data.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12370387">DERBY-2711</key>
            <summary>If large blob is updated after InputStream is fetched (using getBinaryStream), the stream continues to point ot old data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anurag">Anurag Shekhar</assignee>
                                    <reporter username="anurag">Anurag Shekhar</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 May 2007 08:48:31 +0100</created>
                <updated>Fri, 15 Jun 2007 13:38:20 +0100</updated>
                            <resolved>Fri, 8 Jun 2007 14:33:16 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12499507" author="anurag" created="Mon, 28 May 2007 10:00:46 +0100"  >&lt;p&gt;I have introduced a new stream class UpdateableBlobStream to handle the switching from dvd stream to LOBInputStream.&lt;br/&gt;
blob.getBinaryStream now returns UpdateableBlobStream is the blob is not yet materialized. This stream keeps tracks of current position of the stream, and checks if blob is materialized since it was last accessed. If the blob is materialized it gets the stream again from blob and updates the stream and sets the position of the stream by calling skip. If the blob has been truncated and now is smaller than the current position user will get an IOException.&lt;/p&gt;

&lt;p&gt;Modified Files&lt;br/&gt;
  java/engine/org/apache/derby/impl/jdbc/EmbedBlob.java&lt;br/&gt;
         getBinaryStream now returns UpdateableBlobStream if the blob is not materialized.&lt;br/&gt;
New File&lt;br/&gt;
   java/engine/org/apache/derby/impl/jdbc/UpdateableBlobStream.java&lt;br/&gt;
         This class handles the switching from dvd stream to LOBInputStream&lt;/p&gt;

&lt;p&gt;Tests&lt;br/&gt;
java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/BlobUpdateableStreamTest.java&lt;br/&gt;
 Added a new test to test switching from dvd stream to LOBInputStream.&lt;br/&gt;
java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/_Suite.java&lt;br/&gt;
  Added an entry for BlobUpdateableStreamTest.java&lt;/p&gt;


</comment>
                            <comment id="12502366" author="kristwaa" created="Thu, 7 Jun 2007 15:40:02 +0100"  >&lt;p&gt;I&apos;m running tests for the change now.&lt;/p&gt;

&lt;p&gt;I have a few requests/questions for the patch:&lt;br/&gt;
 a) It can no longer be cleanly applied because of a (trivial) conflict in _Suite (easy to fix)&lt;br/&gt;
 b) One line in the new file contains tabs.&lt;br/&gt;
 c) Is it necessary to copy all the JavaDoc from InputStream.read? I think a shorter JavaDoc and a reference to InputStream would suffice, but maybe people disagree with this?&lt;br/&gt;
 d) Another suggestion, not a requirement, it to rename updateIfRequired to something like updateStream and only call it when necessary. This would require &apos;if (!materialized &amp;amp;&amp;amp; blob.isMaterialized())&apos; all places where updateIfRequired is called currently. This is more a personal preference of mine, so you are free to ignore it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I just want to point out that once a Blob has been &quot;materialized&quot;, that is transferred from the store to what I tend to call a temporary blob, it cannot go back to be a Blob working on top of a store stream. For this to happen you must reinsert the Blob into the database and fetch it again, thus getting a new Blob object to work on.&lt;/p&gt;

&lt;p&gt;The patch looks good functionally, and I expect to commit it tomorrow if the tests run cleanly.&lt;/p&gt;

&lt;p&gt;thanks,&lt;/p&gt;</comment>
                            <comment id="12502739" author="anurag" created="Fri, 8 Jun 2007 10:54:58 +0100"  >&lt;p&gt;In this patch I have addressed points a b and c of Kristian.&lt;/p&gt;

&lt;p&gt;a. Resolved conflicts.&lt;br/&gt;
b. Removed Excess docs and added link to java.io.InputStream&lt;br/&gt;
c. Replaced tab by spaces.&lt;/p&gt;</comment>
                            <comment id="12502773" author="kristwaa" created="Fri, 8 Jun 2007 13:48:15 +0100"  >&lt;p&gt;Committed &apos;derby-2711v2.diff&apos; to trunk with revision 545495.&lt;br/&gt;
Tests ran cleanly except for the current noise in the tinderbox/nightlies (46+1 failing tests).&lt;br/&gt;
A small additional patch with non-functional changes will follow.&lt;/p&gt;

&lt;p&gt;Thank you Anurag!&lt;/p&gt;</comment>
                            <comment id="12502786" author="kristwaa" created="Fri, 8 Jun 2007 14:28:09 +0100"  >&lt;p&gt;&apos;derby-2711-3a-additional.diff&apos; must be committed on top of v2, and does the following:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Made variable blob final.&lt;/li&gt;
	&lt;li&gt;Throws exception that was caught and wrapped.&lt;/li&gt;
	&lt;li&gt;Added a comment that the stream will update itself and reflect the new content in all read/skip methods.&lt;/li&gt;
	&lt;li&gt;Changed normal comments into JavaDoc for updateIfRequired.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In addition it removes trailing whitespace and cleans up a few JavaDoc things.&lt;/p&gt;</comment>
                            <comment id="12502792" author="kristwaa" created="Fri, 8 Jun 2007 14:33:16 +0100"  >&lt;p&gt;Committed &apos;derby-2711-3a-additional.diff&apos; to trunk with revision 545501.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12370518">DERBY-2730</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12359275" name="derby-2711-3a-additional.diff" size="7643" author="kristwaa" created="Fri, 8 Jun 2007 14:28:08 +0100"/>
                            <attachment id="12358359" name="derby-2711.diff" size="17509" author="anurag" created="Mon, 28 May 2007 10:00:46 +0100"/>
                            <attachment id="12359263" name="derby-2711v2.diff" size="14243" author="anurag" created="Fri, 8 Jun 2007 10:54:58 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 7 Jun 2007 14:40:02 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23195</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy11sv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39942</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>