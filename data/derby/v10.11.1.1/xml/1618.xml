<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:39:29 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1618/DERBY-1618.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1618] store/BootAllTest.junit fails on with jdk13 based jvms</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1618</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;bootAll test fails on ibm131, wctme5.7.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;
			&lt;ul&gt;
				&lt;li&gt;
				&lt;ul&gt;
					&lt;li&gt;
					&lt;ul&gt;
						&lt;li&gt;
						&lt;ul&gt;
							&lt;li&gt;
							&lt;ul&gt;
								&lt;li&gt;
								&lt;ul&gt;
									&lt;li&gt;Diff file derbyall/storeall/storemore/BootAllTest.diff&lt;/li&gt;
								&lt;/ul&gt;
								&lt;/li&gt;
							&lt;/ul&gt;
							&lt;/li&gt;
						&lt;/ul&gt;
						&lt;/li&gt;
					&lt;/ul&gt;
					&lt;/li&gt;
				&lt;/ul&gt;
				&lt;/li&gt;
			&lt;/ul&gt;
			&lt;/li&gt;
			&lt;li&gt;Start: BootAllTest jdk1.3.1 storeall:storemore 2006-07-30 06:35:16 ***&lt;br/&gt;
0 add&lt;br/&gt;
&amp;gt; .F&lt;br/&gt;
&amp;gt; There was 1 failure:&lt;br/&gt;
&amp;gt; 1) testSettingBootAllPropertyWithHomePropertySet(org.apache.derbyTesting.functionTests.tests.store.BootAllTest)junit.framework.AssertionFailedError: The number of databases should be expected:&amp;lt;3&amp;gt; but was:&amp;lt;0&amp;gt;&lt;br/&gt;
&amp;gt; FAILURES!!!&lt;br/&gt;
&amp;gt; Tests run: 1,  Failures: 1,  Errors: 0&lt;br/&gt;
Test Failed.&lt;/li&gt;
			&lt;li&gt;End:   BootAllTest jdk1.3.1 storeall:storemore 2006-07-30 06:35:35 ***&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>windows. (insane jars) 10.2.0.5 alpha - (426734)&lt;br/&gt;
</environment>
        <key id="12346997">DERBY-1618</key>
            <summary>store/BootAllTest.junit fails on with jdk13 based jvms</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="myrna">Myrna van Lunteren</assignee>
                                    <reporter username="skambha">Sunitha Kambhampati</reporter>
                        <labels>
                    </labels>
                <created>Mon, 31 Jul 2006 23:08:24 +0100</created>
                <updated>Wed, 1 Jul 2009 18:05:32 +0100</updated>
                            <resolved>Thu, 14 Sep 2006 17:50:18 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12429111" author="stan" created="Fri, 18 Aug 2006 21:14:48 +0100"  >&lt;p&gt;Same failure on SLES 9 using IBM131 SR10 - testing 10.2.1.0 beta&lt;/p&gt;</comment>
                            <comment id="12431379" author="myrna" created="Tue, 29 Aug 2006 22:40:24 +0100"  >&lt;p&gt;There are actually 2 failing behaviors with this test&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;jdk131/ibm131: 3 databases expected, was 3 (stack 1 below)&lt;br/&gt;
  But the databases are actually there.&lt;/li&gt;
	&lt;li&gt;wsdd5.6/wctme5.7/wctme5.7_foundation:&lt;br/&gt;
  AccessPropertylPermission framework read denied (stack 2 below)&lt;br/&gt;
  Odd because these environments don&apos;t run with security manager from the &apos;old&apos; test harness, so not sure how it can give this error.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;stack1: &lt;br/&gt;
There was 1 failure:&lt;br/&gt;
1) testSettingBootAllPropertyWithHomePropertySet(org.apache.derbyTesting.functionTests.tests.store.BootAllTest)junit.framework.AssertionFailedError: The number of databases should be expected:&amp;lt;3&amp;gt; but was:&amp;lt;0&amp;gt;&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.store.BootAllTest.testSettingBootAllPropertyWithHomePropertySet(BootAllTest.java:129)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:76)&lt;/p&gt;

&lt;p&gt;stack 2:&lt;br/&gt;
There was 1 error:&lt;br/&gt;
1) testSettingBootAllPropertyWithHomePropertySet(org.apache.derbyTesting.functionTests.tests.store.BootAllTest)java.security.AccessControlException: Access denied (java.util.PropertyPermission framework read)&lt;br/&gt;
	at java.security.AccessController.checkPermission(AccessController.java:74)&lt;br/&gt;
	at java.lang.SecurityManager.checkPermission(SecurityManager.java:612)&lt;br/&gt;
	at java.lang.SecurityManager.checkPropertyAccess(SecurityManager.java:366)&lt;br/&gt;
	at java.lang.System.getProperty(System.java:319)&lt;br/&gt;
	at java.lang.System.getProperty(System.java:301)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.util.TestUtil$1.run(TestUtil.java:177)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(AccessController.java:147)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.util.TestUtil.getFramework(TestUtil.java:174)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.util.TestUtil.getDataSourcePrefix(TestUtil.java:391)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.util.TestUtil.getSimpleDataSource(TestUtil.java:330)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.util.TestUtil.getDataSource(TestUtil.java:324)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.util.TestDataSourceFactory.getDataSource(TestDataSourceFactory.java:47)&lt;br/&gt;
	at org.apache.derbyTesting.junit.TestConfiguration.openConnection(TestConfiguration.java:336)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.openConnection(BaseJDBCTestCase.java:197)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.store.BootAllTest.setUp(BootAllTest.java:58)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:76)&lt;/p&gt;</comment>
                            <comment id="12431712" author="myrna" created="Wed, 30 Aug 2006 22:46:19 +0100"  >&lt;p&gt;This second problem is now logged as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1785&quot; title=&quot;junit tests fail with permission access problems when run with j9 jvms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1785&quot;&gt;&lt;del&gt;DERBY-1785&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12431731" author="myrna" created="Wed, 30 Aug 2006 23:24:42 +0100"  >&lt;p&gt;modifying the title to move this failure onto the general radar.&lt;/p&gt;

&lt;p&gt;So far I&apos;ve narrowed down the problem to when the test is accessing the field DriverPropertyInfo.choices. &lt;/p&gt;

&lt;p&gt;Note that I would&apos;ve expected this access to get tested in the test lang/GetPropertyInfoTest.java, but it&apos;s not there - nor are the fields description or required. &lt;/p&gt;

&lt;p&gt;The problem appears that the services array isn&apos;t populated the same way with jdk131 as it is with jdk142 - the method startProviderService from java/engine/org/apache/derby/impl/services/monitor/BaseMonitor never gets called with jdk131.&lt;/p&gt;




</comment>
                            <comment id="12432191" author="myrna" created="Fri, 1 Sep 2006 18:32:34 +0100"  >&lt;p&gt;Attaching a patch which I think addresses this issue. &lt;br/&gt;
The patch changes these files:&lt;br/&gt;
M      java\engine\org\apache\derby\impl\io\DirStorageFactory.java&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\lang\GetPropertyInfoTest.java&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\master\GetPropertyInfoTest.out&lt;/p&gt;

&lt;p&gt;It appeared to me that for some reason, with jdk131, in the situation invoked by the testSettingBootAllPropertyWithHomePropertySet() test in BootAllTest.java, when the DriverPropertyInfo.choices were accessed, the problem was because in BaseMonitor.java there were no elements found resulting from provider.getBootTimeServices(), which was because in StorageFactoryService the following:&lt;br/&gt;
                            StorageFile properties = storageFactory.newStorageFile( PersistentService.PROPERTIES_NAME);&lt;br/&gt;
                            if (!properties.exists())&lt;br/&gt;
resulted in no properties files found. Here, however, I found that the properties with jdk14 had a path prepended, but jdk13 did not. &lt;br/&gt;
And this was because of DirStorageFactory4 prepending the canonicalName, but DirStorageFactory not.&lt;/p&gt;

&lt;p&gt;So this patch copies a section of code of DirStorageFactory4.&lt;br/&gt;
That fixes the failure in BootAllTest.java with jdk131 and ibm131. Derbyall passes with jdk14 (except for failure in CheckDataSource, which also fails in nightlies, so is unrelated). Still running with ibm131.&lt;/p&gt;

&lt;p&gt;If a reviewer has a suggestion of where this can be placed better, I&apos;d be interested. &lt;/p&gt;

&lt;p&gt;I modified the test lang/GetPropertyInfoTest.java to access the choices, description, and required fields, but it didn&apos;t actually duplicate the problem in BootAllTest.java. But as that&apos;s in that test I thought it was unnecessary to add more...&lt;/p&gt;





&lt;p&gt;Poking further showed that th&lt;/p&gt;</comment>
                            <comment id="12432354" author="myrna" created="Sun, 3 Sep 2006 17:12:35 +0100"  >&lt;p&gt;No further poking showed anything - that last bit in my previous comment should&apos;ve gotten deleted. &lt;/p&gt;

&lt;p&gt;ibm131 results showed no new failures (encryption failed because of the really old jvm version I had on the machine, it does the same with other derby versions).&lt;/p&gt;</comment>
                            <comment id="12433274" author="tsuresh" created="Fri, 8 Sep 2006 00:25:49 +0100"  >&lt;p&gt;Thanks for working on this bug, Mryna.  I briefly looked at the patch, &lt;br/&gt;
this issue seems to be related to the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1296&quot; title=&quot;Setting property derby.system.bootAll causes an Exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1296&quot;&gt;&lt;del&gt;DERBY-1296&lt;/del&gt;&lt;/a&gt;, fix for that seems to have &lt;br/&gt;
addressed the problem on jdk14 jvms and above, but not on jvms version before that. &lt;/p&gt;

&lt;p&gt;Following code you copied to DirStorageFactory.java from DirStorageFactor4.java&lt;/p&gt;

&lt;p&gt;+        String dir = dataDirectory;&lt;br/&gt;
+        if (canonicalName != null &amp;amp;&amp;amp; path != null &amp;amp;&amp;amp; home != null &amp;amp;&amp;amp; &lt;br/&gt;
+                !path.startsWith(home)) {&lt;br/&gt;
+            dir = canonicalName;&lt;/p&gt;

&lt;p&gt;is not the ideal fix.  I think  dataDirecroy , should get set to the correct&lt;br/&gt;
value in the DirStorageFactory.doInit() throws IOException method. &lt;/p&gt;


&lt;p&gt;I think there is also another method in DirStorageFactory.java/DirStorageFactory4.java,&lt;br/&gt;
where the  database directory may be set to a wrong value. &lt;/p&gt;

&lt;p&gt;StorageFile newPersistentFile( String directoryName, String fileName)&lt;/p&gt;
{
        return new DirFile( separatedDataDirectory + directoryName, fileName);
}


&lt;p&gt;if the dataDirectory value is wrong for the method you are fixing , I am sure&lt;br/&gt;
the above method also will get the wrong path. I think instead of adding checks&lt;br/&gt;
for individual methods;   dataDirectory  should get set to the correct value&lt;br/&gt;
in the doInit() method. &lt;/p&gt;

&lt;p&gt;Thanks for updating the GetPropertyInfoTest.java to print all the fields. &lt;/p&gt;
</comment>
                            <comment id="12433760" author="myrna" created="Mon, 11 Sep 2006 04:10:54 +0100"  >&lt;p&gt;Here&apos;s a patch - &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1618&quot; title=&quot;store/BootAllTest.junit fails on with jdk13 based jvms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1618&quot;&gt;&lt;del&gt;DERBY-1618&lt;/del&gt;&lt;/a&gt;_20060910.* - which tries to force the correct value for dataDirectory in the doInit() method of DirStorageFactory.&lt;br/&gt;
I hope this is what was intended...Again I&apos;ve run derbyall with jdk14 and ibm13 without seeing new failures.&lt;/p&gt;</comment>
                            <comment id="12434273" author="tsuresh" created="Tue, 12 Sep 2006 21:57:34 +0100"  >&lt;p&gt;I reviewed the latest patch, it  look good.   I wanted to  check with you couple of small  changes in the diff file, &lt;br/&gt;
before committing  the patch. &lt;/p&gt;

&lt;p&gt;1)   How  is the following change in the diff is related to this bug fix ?&lt;br/&gt;
Name: svn:externals&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;derby/10.1 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/jars/10.1.1.0&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/db/derby/jars/10.1.1.0&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; + derby/10.1 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/jars/10.1.3.1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/db/derby/jars/10.1.3.1&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;2)  There are some new  println() statements in BootAllTest.java , which are commented out.  I typically remove such debug statements, once I  find the problem.   I am ok , if you  would  like to keep them there. &lt;/p&gt;

&lt;p&gt;+println(&quot; start testSettingBootAllPropertyWithHomePropertySet &quot;);&lt;br/&gt;
+        //println(&quot; attributes length:  &quot; + attributes.length);&lt;br/&gt;
 //println(&quot; attributes&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot; + i + &amp;quot;&amp;#93;&lt;/span&gt;.name&quot;  + attributes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.name);&lt;br/&gt;
...etc.&lt;/p&gt;



&lt;p&gt;Thanks&lt;br/&gt;
/suresh&lt;/p&gt;

</comment>
                            <comment id="12434288" author="myrna" created="Tue, 12 Sep 2006 22:38:32 +0100"  >&lt;p&gt;Thx for looking at the patch and apologies for the unrelated changes that I left in.&lt;/p&gt;

&lt;p&gt;Attached patch - &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1618&quot; title=&quot;store/BootAllTest.junit fails on with jdk13 based jvms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1618&quot;&gt;&lt;del&gt;DERBY-1618&lt;/del&gt;&lt;/a&gt;_20060912.* - reverts those mistakenly left modified things - the BootAllTest.java should&apos;ve been left untouched, and the externals for the 10.1 jars were modified for another bug.&lt;/p&gt;

&lt;p&gt;Apart from those, this patch is the same as the one from Sept 10, I haven&apos;t even done a sync in between.&lt;/p&gt;

&lt;p&gt;As the relevant parts have not changed (I did not run upgrade tests on this machine, so the externals setting didn&apos;t matter to my test run, and the println statements don&apos;t affect the BootAllTest unless you run with derby.tests.debug=true) I can&apos;t imagine the reverting of those 2 issues to impact the behavior, so I&apos;m not rerunning the tests...&lt;/p&gt;</comment>
                            <comment id="12434495" author="tsuresh" created="Wed, 13 Sep 2006 18:23:52 +0100"  >&lt;p&gt;Committed &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1618&quot; title=&quot;store/BootAllTest.junit fails on with jdk13 based jvms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1618&quot;&gt;&lt;del&gt;DERBY-1618&lt;/del&gt;&lt;/a&gt;_20060912.diff to trunk on revision 443038.&lt;/p&gt;</comment>
                            <comment id="12434732" author="myrna" created="Thu, 14 Sep 2006 17:50:17 +0100"  >&lt;p&gt;fixed in 10.3 - leaving open until this has gotten merged into 10.2.1. &lt;/p&gt;</comment>
                            <comment id="12435147" author="myrna" created="Sat, 16 Sep 2006 00:10:32 +0100"  >&lt;p&gt;mega-merged into 10.2 with 446709.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12340071" name="DERBY-1618_20060901.diff" size="7581" author="myrna" created="Fri, 1 Sep 2006 18:32:34 +0100"/>
                            <attachment id="12340542" name="DERBY-1618_20060910.diff" size="10170" author="myrna" created="Mon, 11 Sep 2006 04:10:54 +0100"/>
                            <attachment id="12340541" name="DERBY-1618_20060910.stat" size="500" author="myrna" created="Mon, 11 Sep 2006 04:10:54 +0100"/>
                            <attachment id="12340687" name="DERBY-1618_20060912.diff" size="8589" author="myrna" created="Tue, 12 Sep 2006 22:38:32 +0100"/>
                            <attachment id="12340686" name="DERBY-1618_20060912.stat" size="390" author="myrna" created="Tue, 12 Sep 2006 22:38:32 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 18 Aug 2006 20:14:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22601</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0sbz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38408</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>