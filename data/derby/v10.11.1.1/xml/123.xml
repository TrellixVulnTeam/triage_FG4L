<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:49:31 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-123/DERBY-123.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-123] Derby incorrectly rounds double values down during insert into NUMERIC</title>
                <link>https://issues.apache.org/jira/browse/DERBY-123</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When inserting a double value into a field defined as NUMERIC(a,b) using PreparedStatement.setDouble(), Derby may incorrectly round the number down. &lt;/p&gt;

&lt;p&gt;For example, a NUMERIC(5,2) field with a double = 4.64 ends up with a value of 4.63 in the database. This works fine in Oracle and other databases.&lt;/p&gt;

&lt;p&gt;The problem occurs because double cannot represent 4.64 exactly, so the actual value is 4.6399999... SQLDecimal.setCoreValue uses BigDecimal(double) which constructs a BigDecimal of 4.6399999... and then SQLDecimal.setWidth uses value.setScale(desiredScale, BigDecimal.ROUND_DOWN); Note that BigDecimal javadoc recommends that the double constructor be avoided for this reason.&lt;/p&gt;

&lt;p&gt;One fix appears to be to change SQLDecimal.setCoreValue(double) to avoid using the double constructor of BigDecimal. Using Double.toString() and BigDecimal(String) looks as if it would work as expected, because Double.toString() has &quot;special rounding abilities&quot; and converts 4.639999... back to 4.64.&lt;/p&gt;</description>
                <environment>Linux JDK 1.4.2</environment>
        <key id="29486">DERBY-123</key>
            <summary>Derby incorrectly rounds double values down during insert into NUMERIC</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="k1w1m8">Geoff Soutter</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Jan 2005 19:47:05 +0000</created>
                <updated>Thu, 10 Feb 2005 04:38:29 +0000</updated>
                            <resolved>Thu, 10 Feb 2005 04:38:07 +0000</resolved>
                                    <version>10.0.2.1</version>
                                    <fixVersion>10.1.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="58294" author="shreyas" created="Mon, 31 Jan 2005 18:03:24 +0000"  >&lt;p&gt;The javadoc for BigDecimal constructor that takes a double as argument is as below:&lt;/p&gt;

&lt;p&gt;public BigDecimal(double val)&lt;/p&gt;

&lt;p&gt;    Translates a double into a BigDecimal which is the exact decimal representation of the double&apos;s binary floating-point value. The scale of the returned BigDecimal is the smallest value such that (10scale &#215; val) is an integer.&lt;/p&gt;

&lt;p&gt;    Notes:&lt;/p&gt;

&lt;p&gt;       1. The results of this constructor can be somewhat unpredictable. One might assume that writing new        BigDecimal(0.1) in Java creates a BigDecimal which is exactly equal to 0.1 (an unscaled value of 1, with a scale of 1), but it is actually equal to 0.1000000000000000055511151231257827021181583404541015625. This is because 0.1 cannot be represented exactly as a double (or, for that matter, as a binary fraction of any finite length). Thus, the value that is being passed in to the constructor is not exactly equal to 0.1, appearances notwithstanding.&lt;/p&gt;

&lt;p&gt;       2. The String constructor, on the other hand, is perfectly predictable: writing new BigDecimal(&quot;0.1&quot;) creates a BigDecimal which is exactly equal to 0.1, as one would expect. Therefore, it is generally recommended that the String constructor be used in preference to this one.&lt;/p&gt;

&lt;p&gt;       3. When a double must be used as a source for a BigDecimal, note that this constructor provides an exact conversion; it does not give the same result as converting the double to a String using the Double.toString(double) method and then using the BigDecimal(String) constructor. To get that result, use the static valueOf(double) method. &lt;/p&gt;


&lt;p&gt;    Parameters:&lt;br/&gt;
        val - double value to be converted to BigDecimal. &lt;br/&gt;
    Throws:&lt;br/&gt;
        NumberFormatException - if val is infinite or NaN.&lt;/p&gt;

&lt;p&gt;From the &lt;b&gt;Notes&lt;/b&gt; section it is clear that double values cannto be stored precisely as the value that is represented since it might not be possible to represent it as a fraction of finite length, hence the behaviour here.&lt;/p&gt;

&lt;p&gt;So it suggested we construct the BigDecimal value by using Double.toString() method and passing the value to BigDecimal constructor to build the exact value.&lt;/p&gt;
</comment>
                            <comment id="58841" author="bandaram" created="Thu, 10 Feb 2005 04:38:07 +0000"  >&lt;p&gt;Committed this patch for Shreyas Kaushik. (Shreyas.Kaushik@Sun.COM)&lt;/p&gt;</comment>
                            <comment id="58842" author="bandaram" created="Thu, 10 Feb 2005 04:38:29 +0000"  >&lt;p&gt;Fix submitted to trunk version.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 31 Jan 2005 18:03:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21780</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy18mn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>41048</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>