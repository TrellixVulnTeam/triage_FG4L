<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:40:10 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1091/DERBY-1091.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1091] Test harness does not pass jvm flags properly if there are more than 1 property in jvm flags</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1091</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;To run Derby tests with EMMA for Code coverage, there is a need to set up emma flag -Djvmflags=-Demma.verbosity.level=silent. This is basically to enable EMMA not to print out any messages to avoid having any diffs. This all works fine when running Derby tests with EMMA for jdk142, jdk15, jdk131 etc because there is no other jvm flag that is passed while calling RunSuite Command. &lt;/p&gt;

&lt;p&gt;Now, while running tests with j2me/cdc/foundation, another value needs to be passed as jvmflag which is&lt;br/&gt;
-Djvmflags=&quot;Dij.dataSource=org.apache.derby.jdbc.EmbeddedSimpleDataSource&quot;.&lt;/p&gt;

&lt;p&gt;I tried to combine values for both jvm flags as following, but it did not work properly:&lt;/p&gt;

&lt;p&gt;1. -Djvmflags=&apos;-Demma.verbosity.level=silent -Dij.dataSource=org.apache.derby.jdbc.EmbeddedSimpleDataSource&apos;&lt;br/&gt;
During this run, the value that was further passed while running one test was Djvmflags=&quot;&apos;-Demma.verbosity.level=silent&quot;.&lt;br/&gt;
As you can notice it took jvm flag as &apos;-Demma.verbosity.level=silent &lt;/p&gt;

&lt;p&gt;2. -Djvmflags=&quot;-Demma.verbosity.level=silent -Dij.dataSource=org.apache.derby.jdbc.EmbeddedSimpleDataSource&quot;&lt;br/&gt;
During this run, the value that was further passed while running one test was Djvmflags=&quot;&quot;-Demma.verbosity.level=silent&quot;.&lt;br/&gt;
As you can notice it took jvm flag as &quot;-Demma.verbosity.level=silent &lt;/p&gt;

&lt;p&gt;From the above it looks like test harness needs to be changed so that it can parse multiple values for jvm flags properly.&lt;/p&gt;
</description>
                <environment>Windows 2000</environment>
        <key id="12330003">DERBY-1091</key>
            <summary>Test harness does not pass jvm flags properly if there are more than 1 property in jvm flags</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="myrna">Myrna van Lunteren</assignee>
                                    <reporter username="ramank">Ramandeep Kaur</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Mar 2006 06:04:15 +0000</created>
                <updated>Wed, 1 Jul 2009 01:13:01 +0100</updated>
                            <resolved>Mon, 31 Jul 2006 19:05:11 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12378990" author="ramank" created="Thu, 11 May 2006 06:42:19 +0100"  >&lt;p&gt;Another problem with parsing of -Djvmflags is found while running test suite largeData. While running this suite, I need to pass -Djvmflags=&quot;-mx512M -ms512M&quot; so that the values  &quot;-mx512M -ms512M&quot;  are passed while running individual test cases and while starting network server in case of framework=DerbNetClient. &lt;/p&gt;

&lt;p&gt;However, RunSuite class does not seem to parse -Djvmflags well and does not further pass it properply whereas RunTest class parses the flags properly. &lt;/p&gt;</comment>
                            <comment id="12414134" author="mkutty" created="Thu, 1 Jun 2006 03:32:56 +0100"  >&lt;p&gt;As a note:&lt;/p&gt;

&lt;p&gt;I ran the derbyall with an option -Xjit:count=0 as -Djvmflags and it got passed through the individual tests.&lt;/p&gt;

&lt;p&gt;I ran the suite like this: java -Djvmflags=&quot;-Xjit:count=0&quot; org.apache.derbyTesting.functionTests.harness.RunSuite derbyall&lt;/p&gt;
</comment>
                            <comment id="12417897" author="myrna" created="Tue, 27 Jun 2006 05:42:48 +0100"  >&lt;p&gt;I&apos;ve been pecking away at this issue, and I&apos;ve had some struggles with it.&lt;/p&gt;

&lt;p&gt;I am not ready with a patch yet but to show some activity on this issue here a few of my findings and thoughts.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I found that Manjula&apos;s report that the &lt;del&gt;Xjit:count=0 (which is similiar to using any other non&lt;/del&gt;&apos;-D&apos; kind of flag, like -d32 / -D64) works, actually only holds true for Windows. That is, using the -jvmflags=-Xjit:count:0  with an ibm 15 jvm worked for me on Windows, but not on Linux. The problem was that somehow, adding quotes as was done in RunList.java caused the jvm on (at least) Linux to think a class name was being passed in. Because I couldn&apos;t work my way through this bug fast enough this issue was handled separately in bug &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1444&quot; title=&quot;Using -Djvmflags option causes NoClassDefFoundError&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1444&quot;&gt;&lt;del&gt;DERBY-1444&lt;/del&gt;&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I noticed that 123 of the .java tests do the following ij invocation:&lt;br/&gt;
	ij.getPropertyArg(argv); &lt;br/&gt;
  This makes the .java test look at a properties file listed with -p. And this explains why even with a .java test the harness passes on a -p &amp;lt;test_app.properties&amp;gt; to the jvm.&lt;br/&gt;
I have no idea how many of these tests actually depend on the properties in the _app.properties files, but getting rid of the _app.property file for .java files could get pretty involved.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;one requirement for use of jvmflags is twofold:&lt;/li&gt;
	&lt;li&gt;to pass on any and all flags and have them be added to whatever flags are already present&lt;/li&gt;
	&lt;li&gt;to overwrite specific flags that have been set in any kind of property file (with precedence rule: commandline over suite properties over derby.properties or test_app.properties).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Jvmflags are hard to deal with because they can be non-standard, and can be used to mean anything.&lt;br/&gt;
For instance, the -Dpropertykey=propertyvalue is pretty standard, and the harness could go through the list in jvmflags, evaluate wether the propertykey is already present, and let the commandline item overwrite the suite setting overwrite the test setting. But if we&apos;re talking about a -Xmx value, or like the -mx512M, the harness would need special knowledge about that to overwrite settings for that. &lt;br/&gt;
Judging from the mechanisms in place, the folks initially creating the harness gave a swing at doing this, but it looks like it doesn&apos;t quite work correctly. (see Raman&apos;s report re -mx etc).&lt;br/&gt;
However, there is no logic in place to evaluate this in the test harness. I assume the jvm has some logic - i.e. if a jvm is confronted with two -X values, what does it take? If a jvm that accepts -Xmx as well as -mx, and both properties are passed in, and they&apos;re different, what will get used?&lt;/p&gt;

&lt;p&gt;Another question, is try to totally revamp the test property mechanisms in place, or just try to make something work for now. There are currently three sort of properties that get passed about from RunSuite via Runlist to RunTest: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;jvmflags&lt;/li&gt;
	&lt;li&gt;testJavaFlags&lt;/li&gt;
	&lt;li&gt;testSpecialProps&lt;br/&gt;
Not all of these get passed on correctly or appropriately. The entire handling is severly convoluted because RunTest itself adds things to the local variable jvmflags, and because it tries to evaluate jvmflags as well for test harness properties.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The harness (RunTest/jvm.java) currently adds -D to jvmflags not starting with -X or -D.&lt;/p&gt;

&lt;p&gt;The harness currently adds some jvmflags to both the test_app.properties file and to the commandline for the jvm.&lt;/p&gt;

&lt;p&gt;The harness (RunTest/SpecialFlags.java) currently splits the jvmflags into either ij-related properties, to go into the &amp;lt;test&amp;gt;_app.properties file, and &apos;server&apos;-related properties (apparently any starting with &apos;derby&apos;), which &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; either get passed on to the jvm or get placed into the derby.properties file.&lt;br/&gt;
It&apos;s not clear what happens to properties that don&apos;t start with ij nor derby.&lt;/p&gt;

&lt;p&gt;RunTest.java (for multi tests) and NetServer.java explicitly set the mx and ms values if jvmflags doesn&apos;t have anything for them...but it&apos;s looking for the -ms or -mx value, not for the now also valid -Xmx or -Xms...&lt;/p&gt;

&lt;p&gt;After lengthy (and including various abortive derbyall runs) this is my plan:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;for now, leave the testJavaFlags and testSpecialProps unchanged, but no longer use them in any tests/suite properties, instead, use jvmflags. document.&lt;/li&gt;
	&lt;li&gt;leave the &amp;lt;test&amp;gt;_app.properties in place (even though it&apos;s counter-intuitive to use ij in a .java test) because of the limitations to the length of a commandline string on windows platform (I don&apos;t actually know what the limits are, but I know it&apos;s there).&lt;/li&gt;
	&lt;li&gt;make jvmflags property take a &apos;^&apos; separated list rather than a space-separated list as a propertyvalue, which gets converted into a space-separated list in the local variable in RunTest.java.&lt;br/&gt;
i.e. you pass the properties like so:[ -Djvmflags=-Da=1^-Db=2^-Xblah^-yo  ] to RunSuite/RunTest. &lt;/li&gt;
	&lt;li&gt;modify padding with &apos;D&apos;to only when there is no &apos;-&apos;&lt;/li&gt;
	&lt;li&gt;make the command line flags be passed after the suite flags and the suite flags after the test flags, so that the jvm follows the desired precedence of commandline-suite-test because the jvm (supposedly) picks up the &apos;last&apos; setting.&lt;/li&gt;
	&lt;li&gt;for harness properties (properties the harness evaluates) ensure this sequence is kept in mind too - to ensure precedence/overwriting.&lt;/li&gt;
	&lt;li&gt;adjust NetServer and RunTest to check for -Xmx and -Xms as well as -mx and -ms&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12419144" author="myrna" created="Tue, 4 Jul 2006 23:43:32 +0100"  >&lt;p&gt;Attaching a patch - &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1091&quot; title=&quot;Test harness does not pass jvm flags properly if there are more than 1 property in jvm flags&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1091&quot;&gt;&lt;del&gt;DERBY-1091&lt;/del&gt;&lt;/a&gt;_20060702.* - which:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;as planned leaves testJavaFlags and testSpecialProps unchanged, except for correcting some illogical reference to testflags in RunSuite; leaves the &amp;lt;test&amp;gt;_app.properties in place; makes jvmflags a &apos;^&apos; separated list rather than a space-separated list as a propertyvalue, which gets converted into a space-separated list in the local variable in RunTest.java.; modify padding with &apos;D&apos;to only when there is no &apos;-&apos; ; make the command line flags be passed after the suite flags and the suite flags after the test flags, so that the jvm follows the desired precedence of commandline-suite-test because the jvm (supposedly) picks up the &apos;last&apos; setting; adjust NetServer and RunTest to check for -Xmx and -Xms as well as -mx and -ms&lt;/li&gt;
	&lt;li&gt;in addition modified README.htm to document this&lt;/li&gt;
	&lt;li&gt;modified the test properties files where jvmflags was used.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I would appreciate it if people that use/need to use specific jvmflags in their testing could verify this patch works as expected.&lt;/p&gt;

&lt;p&gt;Note: derbyall passed on linux - except for some odd java.util.PropertyPermission read errors on user.dir, which appear to be related to the jvm release I was running (ibm 142 build cxia32142-20060421 (SR5)). At least these failing (store) tests passed when run with sun&apos;s jdk 142 or an older ibm 142 build...&lt;/p&gt;</comment>
                            <comment id="12419830" author="fuzzylogic" created="Sat, 8 Jul 2006 12:30:14 +0100"  >&lt;p&gt;Committed revision 420048.&lt;/p&gt;</comment>
                            <comment id="12424268" author="myrna" created="Sat, 29 Jul 2006 04:17:17 +0100"  >&lt;p&gt;A mistake has slipped in - when running with j2ME (j9_foundation) we routinely pass on -Djvmflags=-Dij.dataSource=org.apache.derby.jdbc.EmbeddedSimpleDataSource and this now gets passed on to RunTest as ^-Dij.dataSource=org.apache.derby.jdbc.EmbeddedSimpleDataSource, resulting in a java.lang.NoClassDefFoundError:&lt;/p&gt;

&lt;p&gt;This results in all tests except for nist &amp;amp; 3 lang tests to fail with this jvm.&lt;br/&gt;
(oops). &lt;/p&gt;</comment>
                            <comment id="12424353" author="myrna" created="Sun, 30 Jul 2006 06:20:27 +0100"  >&lt;p&gt;Fixing the regression with j2ME I caused...with &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1091&quot; title=&quot;Test harness does not pass jvm flags properly if there are more than 1 property in jvm flags&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1091&quot;&gt;&lt;del&gt;DERBY-1091&lt;/del&gt;&lt;/a&gt;_20060729.diff.&lt;/p&gt;</comment>
                            <comment id="12424592" author="fuzzylogic" created="Mon, 31 Jul 2006 19:05:11 +0100"  >&lt;p&gt;Committed to trunk with revision 427190.&lt;/p&gt;</comment>
                            <comment id="12424594" author="myrna" created="Mon, 31 Jul 2006 19:19:32 +0100"  >&lt;p&gt;I had marked it regression because the original patch caused a regression in that running with j2ME (j9_foundation) was broken. taking off regression as the original issue is not actually a regression.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12346946">DERBY-1614</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12336332" name="DERBY-1091_20060702.diff" size="17090" author="myrna" created="Tue, 4 Jul 2006 23:43:32 +0100"/>
                            <attachment id="12336331" name="DERBY-1091_20060702.stat" size="922" author="myrna" created="Tue, 4 Jul 2006 23:43:32 +0100"/>
                            <attachment id="12337764" name="DERBY-1091_20060729.diff" size="1043" author="myrna" created="Sun, 30 Jul 2006 06:20:27 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 1 Jun 2006 02:32:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22301</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0t8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38555</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10051"><![CDATA[Urgent]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>