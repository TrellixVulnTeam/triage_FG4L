<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:07:25 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4449/DERBY-4449.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4449] ArrayIndexOutOfBoundsException when inserting DEFAULT into unspecified column</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4449</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When inserting rows into a table, with just a subset of the table&apos;s columns in the target column list, an ArrayIndexOutOfBoundsException is raised if the table constructor contains the same number of columns as the target table, and the extra columns are specified as DEFAULT:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; create table t (a int, b int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t(a) values (1,default);&lt;br/&gt;
ERROR XJ001: Java exception: &apos;1 &amp;gt;= 1: java.lang.ArrayIndexOutOfBoundsException&apos;.&lt;/p&gt;

&lt;p&gt;The insert statement should have failed with this error:&lt;/p&gt;

&lt;p&gt;ERROR 42802: The number of values assigned is not the same as the number of specified or implied columns.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12441104">DERBY-4449</key>
            <summary>ArrayIndexOutOfBoundsException when inserting DEFAULT into unspecified column</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Nov 2009 21:47:33 +0000</created>
                <updated>Mon, 29 Nov 2010 14:22:34 +0000</updated>
                            <resolved>Mon, 12 Jul 2010 21:17:48 +0100</resolved>
                                    <version>10.5.3.0</version>
                    <version>10.6.1.0</version>
                                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12875007" author="knutanders" created="Thu, 3 Jun 2010 09:36:24 +0100"  >&lt;p&gt;42X06 may be a better error than 42802, based on this script:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; create table t(x int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t values (default, default);&lt;br/&gt;
ERROR 42X06: Too many result columns specified for table &apos;&quot;APP&quot;.&quot;T&quot;&apos;.&lt;br/&gt;
ij&amp;gt; insert into t&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; values (default, default);&lt;br/&gt;
ERROR XJ001: Java exception: &apos;1 &amp;gt;= 1: java.lang.ArrayIndexOutOfBoundsException&apos;.&lt;/p&gt;</comment>
                            <comment id="12875011" author="knutanders" created="Thu, 3 Jun 2010 09:43:40 +0100"  >&lt;p&gt;Here&apos;s the failing code:&lt;/p&gt;

&lt;p&gt;				// Get ColumnDescriptor by name or by position?&lt;br/&gt;
				ColumnDescriptor cd;&lt;br/&gt;
				if (tcl == null)&lt;/p&gt;
				{
					cd = ttd.getColumnDescriptor(index + 1);
				}
&lt;p&gt;				else&lt;/p&gt;
				{
					ResultColumn trc = (ResultColumn) tcl.elementAt(index);
					cd = ttd.getColumnDescriptor(trc.getName());
				}

&lt;p&gt;				// Too many RCs if no ColumnDescriptor&lt;br/&gt;
				if (cd == null)&lt;/p&gt;
				{
					throw StandardException.newException(SQLState.LANG_TOO_MANY_RESULT_COLUMNS, 
									ttd.getQualifiedName());
				}

&lt;p&gt;The call to tcl.elementAt(index) is the one that raises the AIOOBE. Note that the code expects that there may be too many columns, and then getColumnDescriptor() should return null. But in the case where we have a target column list, we fail before we get to the point where getColumnDescriptor() is called.&lt;/p&gt;

&lt;p&gt;I think it would be sufficient to check that the index is within range before calling elementAt() and set cd to null if it&apos;s not.&lt;/p&gt;</comment>
                            <comment id="12875018" author="knutanders" created="Thu, 3 Jun 2010 10:24:27 +0100"  >&lt;p&gt;The attached patch adds a check of the array index and skips the look-up in the array if the index is out of range, so that the null check right below is triggered instead and makes the statement fail gracefully. It also adds a regression test case in InsertTest.&lt;/p&gt;

&lt;p&gt;I&apos;ve started the full regression test suite.&lt;/p&gt;</comment>
                            <comment id="12875054" author="knutanders" created="Thu, 3 Jun 2010 12:07:10 +0100"  >&lt;p&gt;Regression tests ran cleanly.&lt;/p&gt;</comment>
                            <comment id="12875101" author="bryanpendleton" created="Thu, 3 Jun 2010 14:32:19 +0100"  >&lt;p&gt;+1 to your proposed fix.&lt;/p&gt;</comment>
                            <comment id="12875561" author="knutanders" created="Fri, 4 Jun 2010 12:10:29 +0100"  >&lt;p&gt;Thanks, Bryan!&lt;br/&gt;
Committed revision 951366.&lt;/p&gt;</comment>
                            <comment id="12886460" author="lilywei" created="Thu, 8 Jul 2010 21:38:52 +0100"  >&lt;p&gt;Will back port to 10.5&lt;/p&gt;</comment>
                            <comment id="12886496" author="lilywei" created="Thu, 8 Jul 2010 22:32:44 +0100"  >&lt;p&gt;derby-4449-10.5.diff is the patch for back port to 10.5&lt;/p&gt;</comment>
                            <comment id="12886773" author="lilywei" created="Fri, 9 Jul 2010 18:10:24 +0100"  >&lt;p&gt;derby-4449-10.5.diff passed suites.all and derbyall. It is ready to submit.&lt;/p&gt;</comment>
                            <comment id="12887499" author="lilywei" created="Mon, 12 Jul 2010 21:17:48 +0100"  >&lt;p&gt;finish backport to 10.5&lt;/p&gt;</comment>
                            <comment id="12887530" author="knutanders" created="Mon, 12 Jul 2010 22:07:37 +0100"  >&lt;p&gt;Restoring fix version 10.7.0.0.&lt;br/&gt;
(This bug is now in the somewhat unusual state of being fixed in 10.7 and 10.5, but not in 10.6.)&lt;/p&gt;</comment>
                            <comment id="12887553" author="lilywei" created="Mon, 12 Jul 2010 22:51:31 +0100"  >&lt;p&gt;Will back port to 10.6&lt;/p&gt;</comment>
                            <comment id="12887666" author="lilywei" created="Tue, 13 Jul 2010 06:49:47 +0100"  >&lt;p&gt;Attach back port to 10.6 (derby-4449-10.6.diff) suites.All and derbyall test suites are all fine. It is ready to submit to 10.6 port.&lt;/p&gt;</comment>
                            <comment id="12887682" author="knutanders" created="Tue, 13 Jul 2010 08:37:22 +0100"  >&lt;p&gt;Thanks Lily. Committed revision 963617.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12468384">DERBY-4728</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12449013" name="derby-4449-10.5.diff" size="2493" author="lilywei" created="Thu, 8 Jul 2010 22:32:43 +0100"/>
                            <attachment id="12449323" name="derby-4449-10.6.diff" size="2489" author="lilywei" created="Tue, 13 Jul 2010 06:49:47 +0100"/>
                            <attachment id="12446236" name="derby-4449-1a.diff" size="2478" author="knutanders" created="Thu, 3 Jun 2010 10:24:27 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Jun 2010 13:32:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24262</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0olb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37802</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>