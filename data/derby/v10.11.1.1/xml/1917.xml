<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:36:33 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1917/DERBY-1917.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1917] Clob.position fails with Embedded driver and large Clobs</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1917</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The method Clob.position(String searchstr, long start) fails when used on large lobs if the searchstr is bigger than 256 characters. I have seen two different errors, if the search string it bigger than 256 character it is not found and if the search string is bigger than 512 characters an exception is thrown.&lt;/p&gt;


&lt;p&gt;/* Repro */&lt;/p&gt;

&lt;p&gt;            // Connect&lt;br/&gt;
            Class.forName(&quot;org.apache.derby.jdbc.EmbeddedDriver&quot;);&lt;br/&gt;
            Connection conn = DriverManager.getConnection(&quot;jdbc:derby:ReproClob;create=true&quot;, &quot;app&quot;, &quot;app&quot;);&lt;/p&gt;

&lt;p&gt;            // Create table and populate&lt;br/&gt;
            Statement stmt = conn.createStatement();&lt;br/&gt;
            try &lt;/p&gt;
{
                stmt.executeUpdate(&quot;DROP TABLE tmpClob&quot;);
            }
&lt;p&gt; catch (SQLException se) {}&lt;br/&gt;
            stmt.executeUpdate(&quot;CREATE TABLE tmpClob (a int, b clob(40K))&quot;);&lt;/p&gt;

&lt;p&gt;            PreparedStatement ps = conn.prepareStatement(&quot;INSERT INTO tmpClob VALUES (?, ?)&quot;);&lt;br/&gt;
            String tmp = &quot;abcdefghijklmnopqrstuvxyz&quot;;&lt;br/&gt;
            StringBuilder sb = new StringBuilder();&lt;br/&gt;
            for (int i=0; i&amp;lt;1500; i++) &lt;/p&gt;
{
                sb.append(tmp);
            }
&lt;p&gt;            ps.setInt(1, 1);&lt;br/&gt;
            ps.setString(2, sb.toString());&lt;br/&gt;
            ps.executeUpdate();&lt;br/&gt;
            ps.close();&lt;/p&gt;

&lt;p&gt;            ResultSet rs = stmt.executeQuery(&quot;SELECT * FROM tmpClob&quot;);&lt;br/&gt;
            if (rs.next()) {&lt;br/&gt;
                Clob c = rs.getClob(2);&lt;br/&gt;
                // Bug #1&lt;br/&gt;
                String subString1 = c.getSubString(100, 513);&lt;br/&gt;
                try &lt;/p&gt;
{
                    long i1 = c.position(subString1, 90);
                    System.out.println(&quot;Found searched string at: &quot; + i1);
                }
&lt;p&gt; catch (SQLException se) {&lt;br/&gt;
                    System.out.println(&quot;FAILURE REPRODUCED: Clob.position(string, int) throws an exception when the length of the search string is bigger than 512&quot;);&lt;br/&gt;
                    se.printStackTrace();&lt;br/&gt;
                    while (se != null) &lt;/p&gt;
{
                        System.out.println(&quot;FAIL: &quot; + se.getMessage());
                        se = se.getNextException();
                    }
&lt;p&gt;                }&lt;/p&gt;

&lt;p&gt;                // Bug #2&lt;br/&gt;
                String subString2 = c.getSubString(100, 257);&lt;br/&gt;
                long i2 = c.position(subString2, 90);&lt;br/&gt;
                if (i2 == -1) &lt;/p&gt;
{
                    System.out.println(&quot;FAILURE REPRODUCED: Clob.position(string, int) does not find the search string if its length is bigger than 256&quot;);
                }
&lt;p&gt; else &lt;/p&gt;
{
                    System.out.println(&quot;Found searched string at: &quot; + i2);
                }
&lt;p&gt;            }&lt;br/&gt;
            rs.close();&lt;br/&gt;
            stmt.close();&lt;br/&gt;
            conn.rollback();&lt;br/&gt;
            conn.close();&lt;/p&gt;</description>
                <environment></environment>
        <key id="12352282">DERBY-1917</key>
            <summary>Clob.position fails with Embedded driver and large Clobs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="narayanan">V.Narayanan</assignee>
                                    <reporter username="fernanda">Fernanda Pizzorno</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Oct 2006 12:51:17 +0100</created>
                <updated>Fri, 16 Feb 2007 13:37:46 +0000</updated>
                            <resolved>Sat, 6 Jan 2007 00:59:57 +0000</resolved>
                                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12444210" author="knutanders" created="Tue, 24 Oct 2006 07:10:17 +0100"  >&lt;p&gt;BlobClob4BlobTest has a workaround for this issue. When the bug is fixed, the test should be updated.&lt;/p&gt;</comment>
                            <comment id="12461385" author="narayanan" created="Fri, 29 Dec 2006 14:57:32 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Pls find a patch attached to this issue and the related explanation doc. &lt;/p&gt;

&lt;p&gt;I will run derbyall and the the Junit test suite and will post the results as soon as they finish.&lt;/p&gt;

&lt;p&gt;thanx,&lt;br/&gt;
V.Narayanan&lt;/p&gt;</comment>
                            <comment id="12461416" author="bryanpendleton" created="Fri, 29 Dec 2006 17:30:55 +0000"  >&lt;p&gt;Thanks for providing the explanation notes and good comments! &lt;/p&gt;

&lt;p&gt;Your description makes sense to me, and the code changes look reasonable.&lt;/p&gt;

&lt;p&gt;Three comments:&lt;br/&gt;
1) Do you feel that we have adequate test coverage in this area?&lt;br/&gt;
2) It seems as though there may be some white-space/indentation mismatches&lt;br/&gt;
in your diff. Your new lines uses spaces for indentation, but the surrounding&lt;br/&gt;
code uses tabs. Also, your new lines assume a tab setting of 8, where 4 is&lt;br/&gt;
more common in the Derby code&lt;br/&gt;
3) I don&apos;t really understand the significance of the number 256 in this code. Is&lt;br/&gt;
there something fundamental going on, or did the original code just pick an&lt;br/&gt;
arbitrary constant to use as a &quot;search chunk size&quot;. Would the code work&lt;br/&gt;
correctly if all the occurrences of 256 in this section were changed to some&lt;br/&gt;
other number, or is there some reason why 256 is a magic number here?&lt;/p&gt;</comment>
                            <comment id="12461669" author="narayanan" created="Tue, 2 Jan 2007 04:47:12 +0000"  >&lt;p&gt;Thanks for taking a look at this issue and commenting on it.&lt;/p&gt;

&lt;p&gt;1) I will change the identation to use tabs instead of spaces and repost my patch&lt;/p&gt;

&lt;p&gt;2) Would&apos;nt changing the new lines to use 4 spaces make those lines stand out from sorrounding code?&lt;/p&gt;

&lt;p&gt;3) The position method was earlier being tested for search strings of length only within 256  as a workaround in BlobClob4BlobTest (That is the only &lt;br/&gt;
     place in my knowledge that carries a test for the position method). Now it has been changed to test for arbitary length strings. &lt;/p&gt;

&lt;p&gt;4) But as a specific test for this bug I can add the repro attached with this issue as a test case. Since the chunk size is 256 I could probably add test &lt;br/&gt;
    cases to test for a range of chunk sizes like 0-256, 256-512.... But IMHO the existing test case and the repro(if required) should be good enough.&lt;/p&gt;

&lt;p&gt;5) From my knowledge of tracing this algorithm it would work irrespective of the number 256&lt;/p&gt;

&lt;p&gt;6) I however do not know if 256 is something like a most efficient chunk size. I mean the algorithm works most efficiently if your chunk size is 256. I &lt;br/&gt;
    have not tested this.&lt;/p&gt;

&lt;p&gt;thanx once again for the comments and guidance,&lt;br/&gt;
Narayanan&lt;/p&gt;</comment>
                            <comment id="12461672" author="narayanan" created="Tue, 2 Jan 2007 05:52:32 +0000"  >&lt;p&gt;Please find two files Change256_128.diff and Change256_128.stat attached. I changed the constant 256 to 128 and ran the BlobClob4BlobTest and the repro seems to work fine for me. I did this to confirm that the code would work correctly irrespective of the constant we choose.&lt;/p&gt;

&lt;p&gt;thanx,&lt;br/&gt;
Narayanan&lt;/p&gt;</comment>
                            <comment id="12461757" author="bryanpendleton" created="Tue, 2 Jan 2007 16:19:41 +0000"  >&lt;p&gt;Thanks for investigating the 256 value. It is good to know that it is&lt;br/&gt;
just an arbitrary constant. I suppose that at some point we could&lt;br/&gt;
replace it with a static final int, but that doesn&apos;t seem important for this fix.&lt;/p&gt;

&lt;p&gt;Regarding the testing, I agree that re-enabling the existing tests should&lt;br/&gt;
be adequate.&lt;/p&gt;

&lt;p&gt;So in my opinion the only blocking issue is to resolve the tab/space issue,&lt;br/&gt;
so that the modified code matches the style of the existing code.&lt;/p&gt;

&lt;p&gt;thanks, &lt;br/&gt;
bryan&lt;/p&gt;</comment>
                            <comment id="12462455" author="narayanan" created="Fri, 5 Jan 2007 10:43:04 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
pls find attached a new patch(position_patch_v2.diff) with the indentation issues fixed. The junit suite ran without errors when I ran it. &lt;/p&gt;

&lt;p&gt;thanx,&lt;br/&gt;
Narayanan &lt;/p&gt;</comment>
                            <comment id="12462615" author="bryanpendleton" created="Fri, 5 Jan 2007 21:31:42 +0000"  >&lt;p&gt;Thanks for the revised patch. The indentation looks much better now.&lt;/p&gt;

&lt;p&gt;I ran your modified test without the code patch, and the test failed as expected,&lt;br/&gt;
and then I applied your code patch and the test succeeded.&lt;/p&gt;

&lt;p&gt;I intend to commit position_patch_v2.diff to the trunk. If anyone else is reviewing&lt;br/&gt;
this change please let us know.&lt;/p&gt;</comment>
                            <comment id="12462663" author="bryanpendleton" created="Sat, 6 Jan 2007 00:59:57 +0000"  >&lt;p&gt;Committed position_patch_v2.diff to the trunk as revision 493262.&lt;/p&gt;</comment>
                            <comment id="12462667" author="narayanan" created="Sat, 6 Jan 2007 01:39:26 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
Thank you for the commit !&lt;br/&gt;
Narayanan&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12348146" name="Change256_128.diff" size="2526" author="narayanan" created="Tue, 2 Jan 2007 05:49:41 +0000"/>
                            <attachment id="12348147" name="Change256_128.stat" size="249" author="narayanan" created="Tue, 2 Jan 2007 05:49:41 +0000"/>
                            <attachment id="12348060" name="Position_patch_explanation.txt" size="2865" author="narayanan" created="Fri, 29 Dec 2006 14:57:32 +0000"/>
                            <attachment id="12348061" name="position_patch_v1.diff" size="5579" author="narayanan" created="Fri, 29 Dec 2006 14:57:32 +0000"/>
                            <attachment id="12348062" name="position_patch_v1.stat" size="249" author="narayanan" created="Fri, 29 Dec 2006 14:57:32 +0000"/>
                            <attachment id="12348345" name="position_patch_v2.diff" size="4632" author="narayanan" created="Fri, 5 Jan 2007 10:40:39 +0000"/>
                            <attachment id="12348346" name="position_patch_v2.stat" size="249" author="narayanan" created="Fri, 5 Jan 2007 10:40:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 24 Oct 2006 06:10:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22790</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy13c7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40191</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>