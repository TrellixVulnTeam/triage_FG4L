<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:12:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3829/DERBY-3829.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3829] Convert derbynet/sysinfo and derbynet/sysinfo_with_properties to JUnit</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3829</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I&apos;m guessing these two can be combined into one file&lt;/p&gt;</description>
                <environment></environment>
        <key id="12402081">DERBY-3829</key>
            <summary>Convert derbynet/sysinfo and derbynet/sysinfo_with_properties to JUnit</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ebirkenes">Erlend Birkenes</assignee>
                                    <reporter username="ebirkenes">Erlend Birkenes</reporter>
                        <labels>
                    </labels>
                <created>Sun, 10 Aug 2008 18:11:42 +0100</created>
                <updated>Fri, 21 Jan 2011 17:52:05 +0000</updated>
                            <resolved>Thu, 3 Dec 2009 17:46:47 +0000</resolved>
                                    <version>10.5.1.1</version>
                                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12621285" author="kmarsden" created="Sun, 10 Aug 2008 18:38:15 +0100"  >&lt;p&gt;or you might be able to add them to  NetworkServerControlApiTest&lt;/p&gt;</comment>
                            <comment id="12621286" author="ebirkenes" created="Sun, 10 Aug 2008 18:44:56 +0100"  >&lt;p&gt;Good idea, I&apos;ll try that.&lt;/p&gt;</comment>
                            <comment id="12621379" author="ebirkenes" created="Mon, 11 Aug 2008 09:23:49 +0100"  >&lt;p&gt;Here is a complete patch. Please review and commit if it&apos;s ok.&lt;/p&gt;

&lt;p&gt;I put both the old tests into one new one called derbynet/SysinfoTest. I thought about adding them to NetworkServerControlApiTest but I figured it would make NetworkServerControlApiTest very messy.&lt;/p&gt;

&lt;p&gt;A few things:&lt;br/&gt;
The old test tested localized sysinfo, but the output from the server is not actually localized. It&apos;s exactly the same as en_US output. I included the localized test, but it tests against the same string as the en_US one. If the output is changed in the future a separate string can easily be added for localized. &lt;br/&gt;
Is that ok, or should I try to find a way to test the localization?&lt;/p&gt;

&lt;p&gt;Also, when the tests run from jars, all the locale info is not included in the output at all so I just removed it from all the tests to make it simpler. Hope that&apos;s ok too.&lt;/p&gt;

&lt;p&gt;I added the new test to derbynet/_Suite and removed the old one and all its files (i think..), i ran the _Suite both from classes and jars.&lt;/p&gt;

&lt;p&gt;Ok, I hope I remembered everything!&lt;/p&gt;

&lt;p&gt;-Erlend&lt;/p&gt;</comment>
                            <comment id="12622637" author="myrna" created="Thu, 14 Aug 2008 19:44:31 +0100"  >&lt;p&gt;Looks mostly ok, however I got 5 failures when I ran the test (with classes), and I think the main cause is this:&lt;br/&gt;
testSysinfoMethod(org.apache.derbyTesting.functionTests.tests.derbynet.SysinfoTest)java.lang.Exception: DRDA_InvalidReplyTooShort.S:Invalid reply from network server: Insufficient data.&lt;/p&gt;

&lt;p&gt;I see you&apos;ve used BufferedOutputStream and ExecProcUtil.execCmdDumpResults(SysInfoLocaleCmd,vCmd,bos).&lt;/p&gt;

&lt;p&gt;The ExecProcUtil is really part of the &quot;old&quot; test harness...&lt;/p&gt;

&lt;p&gt;Furthermore, what comes through the buffer may not always be the same, or the full output. That&apos;s why we used an InputStreamReader with the BaseTestCase.assertExecJavaCmdAsExpected.&lt;/p&gt;

</comment>
                            <comment id="12622639" author="kmarsden" created="Thu, 14 Aug 2008 19:50:21 +0100"  >&lt;p&gt;The comments regarding BufferedOutputStream may indeed be an issue, but I don&apos;t think it is the cause of the error.  That error looks like a protocol error that shouldn&apos;t happen at all.  Do we get a protocol error if permissions are not right?&lt;/p&gt;</comment>
                            <comment id="12622718" author="myrna" created="Thu, 14 Aug 2008 22:36:13 +0100"  >&lt;p&gt;I don&apos;t know, but I do get a permissions problem reading from my classes dir...From derby.log:&lt;br/&gt;
2008-08-14 21:31:21.109 GMT : access denied (java.io.FilePermission &amp;lt;...my classes dir...&amp;gt; read)&lt;br/&gt;
java.security.AccessControlException: access denied (java.io.FilePermission &amp;lt;...my classes dir...&amp;gt; read)&lt;br/&gt;
	at java.security.AccessControlContext.checkPermission(AccessControlContext.java:264)&lt;br/&gt;
	at java.security.AccessController.checkPermission(AccessController.java:427)&lt;br/&gt;
	at java.lang.SecurityManager.checkPermission(SecurityManager.java:532)&lt;br/&gt;
	at java.lang.SecurityManager.checkRead(SecurityManager.java:871)&lt;br/&gt;
	at java.io.File.exists(File.java:700)&lt;br/&gt;
	at java.io.Win32FileSystem.canonicalize(Win32FileSystem.java:401)&lt;br/&gt;
	at java.io.File.getCanonicalPath(File.java:531)&lt;br/&gt;
	at org.apache.derby.impl.tools.sysinfo.Main.formatURL(Main.java:1260)&lt;br/&gt;
	at org.apache.derby.impl.tools.sysinfo.Main.loadZipFromResource(Main.java:877)&lt;br/&gt;
	at org.apache.derby.impl.tools.sysinfo.Main.getAllInfo(Main.java:781)&lt;br/&gt;
	at org.apache.derby.impl.tools.sysinfo.Main.reportDerby(Main.java:241)&lt;br/&gt;
	at org.apache.derby.impl.tools.sysinfo.Main.getMainInfo(Main.java:141)&lt;br/&gt;
	at org.apache.derby.impl.drda.NetworkServerControlImpl.getCLSSysInfo(NetworkServerControlImpl.java:2092)&lt;br/&gt;
	at org.apache.derby.impl.drda.NetworkServerControlImpl.sendSysInfo(NetworkServerControlImpl.java:1980)&lt;br/&gt;
	at org.apache.derby.impl.drda.NetworkServerControlImpl.processCommands(NetworkServerControlImpl.java:1659)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.sessionInitialState(DRDAConnThread.java:645)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:279)&lt;/p&gt;</comment>
                            <comment id="12622749" author="ebirkenes" created="Fri, 15 Aug 2008 01:03:44 +0100"  >&lt;p&gt;Hmm, I don&apos;t get the permissions errors or any other errors here, seems something is different on windows. I&apos;ll try to figure out what..&lt;/p&gt;

&lt;p&gt;I&apos;ll change ExecProcUtil.execCmdDumpResults to something else. I could have just used BaseTestCase.assertExecJavaCmdAsExpected if it could deal with the parts of the output that are variable.. &lt;/p&gt;

&lt;p&gt;Is it a good idea to extract the command-running part of  assertExecJavaCmdAsExpected into a new method that just runs the command and returns the output? assertExecJavaCmdAsExpected would call the new method so it would stay the same, but the output would be available for manipulation when that&apos;s needed. That would be useful for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3824&quot; title=&quot;Rollback to savepoint fails on phoneME - xtestRollbackWillReleaseLaterSavepoints: &amp;quot;T1&amp;quot; row count: expected:&amp;lt;1&amp;gt; but was:&amp;lt;8&amp;gt;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3824&quot;&gt;&lt;del&gt;DERBY-3824&lt;/del&gt;&lt;/a&gt; as well. The exact same thing is done there, so it would at least save some duplicate code. However, this is the last two places where execCmdDumpResults is used, so maybe it&apos;s not worth messing with it..&lt;/p&gt;</comment>
                            <comment id="12622769" author="myrna" created="Fri, 15 Aug 2008 02:41:56 +0100"  >&lt;p&gt;Hm...&lt;br/&gt;
I can do some further experimenting with the permissions...and/or send you the output I get. Maybe I can modify the exec command so it starts the sysinfo call without security manager..&lt;br/&gt;
But it&apos;s sort of late in the day here though and I need to do other stuff, I&apos;ll try to look into this further tomorrow...&lt;/p&gt;

&lt;p&gt;I think if you can make a variation of assertExecJavaCmdAsExpected to return the full output that would be good. I&apos;m fairly certain I tried that at some point and there was some reason why that didn&apos;t work well...Can&apos;t remember the details. &lt;br/&gt;
(The buffer would get closed before it got to the calling method? Or it would never release and hang the test/networkserver? Or keep the pointer  open &amp;amp; thus leak memory? Something like that.)&lt;br/&gt;
I&apos;ll see if I can find notes/remarks...(they&apos;re probably buried somewhere in a comment).&lt;/p&gt;

&lt;p&gt;But if we could do it, I&apos;d prefer that over using execCmdDumpResults. We probably should remove that method, if it&apos;s not used anywhere anymore, to prevent future confusion...&lt;/p&gt;</comment>
                            <comment id="12622783" author="myrna" created="Fri, 15 Aug 2008 03:39:18 +0100"  >&lt;p&gt;Some of the troubles I had before the assertExecJavaCmdAsExpected got its current shape are documented in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3088&quot; title=&quot;convert to junit, or otherwise eliminate version in tests which require an update of the master in the release management process&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3088&quot;&gt;&lt;del&gt;DERBY-3088&lt;/del&gt;&lt;/a&gt;...&lt;/p&gt;</comment>
                            <comment id="12623130" author="ebirkenes" created="Sat, 16 Aug 2008 15:58:04 +0100"  >&lt;p&gt;There is still something wrong with the way assertExecJavaCmdAsExpected captures output. &lt;/p&gt;

&lt;p&gt;I get this output:&lt;/p&gt;

&lt;p&gt;--------- Derby Network Server Information --------&lt;br/&gt;
Version: CSS10050/10.5.0.0 alpha - (1)  Build: 1  DRDA Product Id: CSS10050  ** SANE BUILD **&lt;br/&gt;
&amp;#8211; listing properties &amp;#8211;&lt;br/&gt;
derby.drda.traceDirectory=/home/erlend/workspace/Derby/system&lt;br/&gt;
derby.drda.maxThreads=0&lt;br/&gt;
derby.drda.sslMode=off&lt;br/&gt;
derby.drda.keepAlive=true&lt;br/&gt;
derby.drda.minThreads=0&lt;br/&gt;
derby.drda.portNumber=1527&lt;br/&gt;
derby.drda.logConnections=false&lt;br/&gt;
derby.drda.timeSlice=0&lt;br/&gt;
derby.drda.startNetworkServer=false&lt;br/&gt;
derby.drda.host=127.0.0.1&lt;br/&gt;
derby.drda.traceAll=false&lt;br/&gt;
------------------ Java Information ------------------&lt;br/&gt;
Java Version:    1.5.0_15&lt;br/&gt;
Java Vendor:     Sun Microsystems Inc.&lt;br/&gt;
Java home:       /usr/lib/jvm/java-1.5.0-sun-1.5.0.15/jre&lt;br/&gt;
Java classpath:  /home/erlend/workspace/Derby/classes:/home/erlend/Download/eclipse/plugins/org.junit_3.8.2.v200706111738/junit.jar:/home/erlend/Download/eclipse/configuration/org.eclipse.osgi/bundles/79/1/.cp/:/home/erlend/Download/eclipse/configuration/org.eclipse.osgi/bundles/7/1/.cp/&lt;br/&gt;
OS name:         Linux&lt;br/&gt;
OS architecture: i386&lt;br/&gt;
OS version:2.6.24-19-generic&lt;br/&gt;
Java user name:  erlend&lt;br/&gt;
Java user home:  /home/erlend&lt;br/&gt;
Java user dir:   /home/erlend/workspace/Derby&lt;br/&gt;
java.specification.name: Java Platform API Specification&lt;br/&gt;
java.specification.version: 1.5&lt;br/&gt;
--------- Derby Information --------&lt;br/&gt;
JRE - JDBC: J2SE 5.0 - JDBC 3.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/home/erlend/workspace/Derby/classes&amp;#93;&lt;/span&gt; 10.5.0.0 alpha - (1)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Java Security Exception: access denied (java.io.FilePermission /home/erlend/Download/eclipse/plugins/org.junit_3.8.2.v200706111738/junit.jar read)&amp;#93;&lt;/span&gt; &amp;lt;null&amp;gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Java Security Exception: access denied (java.io.FilePermission /home/erlend/Download/eclipse/configuration/org.eclipse.osgi/bundles/79/1/.cp read)&amp;#93;&lt;/span&gt; &amp;lt;null&amp;gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Java Security Exception: access denied (java.io.FilePermission /home/erlend/Download/eclipse/configuration/org.eclipse.osgi/bundles/7/1/.cp read)&amp;#93;&lt;/span&gt; &amp;lt;null&amp;gt;&lt;br/&gt;
------------------------------------------------------&lt;br/&gt;
----------------- Locale Information -----------------&lt;br/&gt;
Current Locale :  [English/United States &lt;span class=&quot;error&quot;&gt;&amp;#91;en_US&amp;#93;&lt;/span&gt;]&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;cs&amp;#93;&lt;/span&gt;&lt;br/&gt;
	 version: 10.5.0.0 alpha- (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;de_DE&amp;#93;&lt;/span&gt;&lt;br/&gt;
	 version: 10.5.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;es&amp;#93;&lt;/span&gt;&lt;br/&gt;
	 version: 10.5.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;fr&amp;#93;&lt;/span&gt;&lt;br/&gt;
	 version: 10.5.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;hu&amp;#93;&lt;/span&gt;&lt;br/&gt;
	 version: 10.5.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;it&amp;#93;&lt;/span&gt;&lt;br/&gt;
	 version: 10.5.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;ja_JP&amp;#93;&lt;/span&gt;&lt;br/&gt;
	 version: 10.5.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;ko_KR&amp;#93;&lt;/span&gt;&lt;br/&gt;
	 version: 10.5.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;pl&amp;#93;&lt;/span&gt;&lt;br/&gt;
	 version: 10.5.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;pt_BR&amp;#93;&lt;/span&gt;&lt;br/&gt;
	 version: 10.5.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;ru&amp;#93;&lt;/span&gt;&lt;br/&gt;
	 version: 10.5.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;zh_CN&amp;#93;&lt;/span&gt;&lt;br/&gt;
	 version: 10.5.0.0 alpha - (1)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;zh_TW&amp;#93;&lt;/span&gt;&lt;br/&gt;
	 version: 10.5.0.0 alpha - (1)&lt;br/&gt;
------------------------------------------------------&lt;/p&gt;

&lt;p&gt;-------------------------&lt;br/&gt;
----------------- Locale Information -----------------&lt;br/&gt;
Current Locale :  [English/United States &lt;span class=&quot;error&quot;&gt;&amp;#91;en_US&amp;#93;&lt;/span&gt;]&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;cs&amp;#93;&lt;/span&gt;&lt;br/&gt;
	 version: 10.5.0.0 alpha&lt;/p&gt;



&lt;p&gt;The last 5 lines should not be there.. i tried playing with the char[] length and it changes the output, but I can&apos;t get it to go away. And if it did I suspect it could still be wrong with different output.&lt;/p&gt;
</comment>
                            <comment id="12623132" author="ebirkenes" created="Sat, 16 Aug 2008 16:09:14 +0100"  >&lt;p&gt;Never mind, I think I fixed it. If I change it to char&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;  and remove the .trim() from output = output + new String(ca).trim() it works fine. &lt;br/&gt;
The other tests which use this still seems to work too.&lt;/p&gt;</comment>
                            <comment id="12623223" author="ebirkenes" created="Sun, 17 Aug 2008 21:27:40 +0100"  >&lt;p&gt;In this patch i changed BaseTestCase.assertExecJavaCmdAsExpected and added two new methods named execJavaCmd (which executes the command and returns a Process) and readProcessOutput which reads the output from a Process and returns it as a String. Two methods was necessary to allow  assertExecJavaCmdAsExpected to check the exit code of the process. &lt;/p&gt;

&lt;p&gt;the new method BaseTestCase.execJavaCmd is exactly the same as Utilities.execJavaCmd, and that method was only used in one test, derbynet/ServerPropertiesTest, so I changed it to use the new BaseTestCase.execJavaCmd instead and removed  Utilities.execJavaCmd.&lt;/p&gt;

&lt;p&gt;derbynet/runtimeinfo still uses ExecProcUtil.execCmdDumpResults but when &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3834&quot; title=&quot;Convert derbynet/runtimeinfo to JUnit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3834&quot;&gt;&lt;del&gt;DERBY-3834&lt;/del&gt;&lt;/a&gt; is resolved I will remove ExecProcUtil as there is only that one method in there.&lt;/p&gt;

&lt;p&gt;I also added a singleUseDatabaseDecorator, because of the problem in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3834&quot; title=&quot;Convert derbynet/runtimeinfo to JUnit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3834&quot;&gt;&lt;del&gt;DERBY-3834&lt;/del&gt;&lt;/a&gt;, just in case.&lt;/p&gt;

&lt;p&gt;I didn&apos;t do anything about the permissions-problem Myrna was seeing, because I don&apos;t have that problem here and need more information about it.&lt;/p&gt;

&lt;p&gt;I ran the test from classes and jars and ran derbynet/_Suite. Also ran all the tests that uses assertExecJavaCmdAsExpected to confirm that it still works the same way.&lt;/p&gt;</comment>
                            <comment id="12623505" author="myrna" created="Tue, 19 Aug 2008 01:04:50 +0100"  >&lt;p&gt;I&apos;m looking at the  new patch, and on the whole, I like it; however, I still get a similar failure as before...&lt;br/&gt;
I did verify the failure happens only on my windows XP system.&lt;br/&gt;
I&apos;m trying to figure out what the problem is...&lt;/p&gt;</comment>
                            <comment id="12624040" author="myrna" created="Wed, 20 Aug 2008 17:37:47 +0100"  >&lt;p&gt;I finally figured out that the problem was with the sed() method and the comparisons;&lt;br/&gt;
on windows, the end-of-line character is not \n, but \n\r, at least for most lines (empirically, it seemed, the &apos;Version...&apos; line has \n. But I could have been dreaming that up).&lt;br/&gt;
I added a replaceAll line to swap all \n\r to \n and then my problems went away.&lt;br/&gt;
I assume the permissions problem I saw was a result of left over policy file settings.&lt;/p&gt;

&lt;p&gt;other modifications over previous patch:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the new class had somehow gotten a mix of tabs and spaces. I turned it into all spaces.&lt;/li&gt;
	&lt;li&gt;network server tests can&apos;t run with JSR169 - nor when derbynet is not available.&lt;br/&gt;
  added those two conditions to the suite() method (returns empty suite if not ok).&lt;/li&gt;
	&lt;li&gt;the code in org.apache.derbyTesting.functionTests.harness should not be used anymore, this&lt;br/&gt;
  includes references to the jvm class, and setting of j9_13 jvm etc.&lt;br/&gt;
  I took that section out.&lt;/li&gt;
	&lt;li&gt;junit keeps state of all global variables until the entire suite (e.g. suites.All) is done.&lt;br/&gt;
  So, using global variables is a drain on resources.&lt;br/&gt;
  If it can&apos;t be avoided making a variable global, then it should get set to null in a teardown() method.&lt;br/&gt;
  I took care of this&lt;/li&gt;
	&lt;li&gt;the print variable was no longer needed but was accidentally left behind&lt;/li&gt;
	&lt;li&gt;the makePolicyName() was doing a System.out.println. I see this is done in some other tests (e.g.&lt;br/&gt;
  ServerPropertiesTest, which I converted), but we might as well make it fail, I think.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12624043" author="myrna" created="Wed, 20 Aug 2008 17:43:53 +0100"  >&lt;p&gt;I attached my variations on patch Derby-3829_2.diff, and ran tests - derbynet._Suite and individual tests, and suites.All on linux, and it all went swimmingly...&lt;br/&gt;
But then I ran suites.All on wnidows and got 2 failures in the new sysinfo test (on top of some replication failures):&lt;/p&gt;

&lt;p&gt;1) testSysinfoMethod(org.apache.derbyTesting.functionTests.tests.derbynet.SysinfoTest)java.lang.Exception: DRDA_InvalidReplyTooShort.S:Invalid reply from network server: Insufficient data.&lt;br/&gt;
	at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessageWork(NetworkServerControlImpl.java:3179)&lt;br/&gt;
	at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessage(NetworkServerControlImpl.java:1835)&lt;br/&gt;
	at org.apache.derby.impl.drda.NetworkServerControlImpl.fillReplyBuffer(NetworkServerControlImpl.java:2771)&lt;br/&gt;
	at org.apache.derby.impl.drda.NetworkServerControlImpl.readStringReply(NetworkServerControlImpl.java:2828)&lt;br/&gt;
	at org.apache.derby.impl.drda.NetworkServerControlImpl.sysinfo(NetworkServerControlImpl.java:1282)&lt;br/&gt;
	at org.apache.derby.drda.NetworkServerControl.getSysinfo(NetworkServerControl.java:469)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.SysinfoTest.testSysinfoMethod(SysinfoTest.java:208)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:104)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
I am trying to figure out what&apos;s up with this...&lt;/p&gt;</comment>
                            <comment id="12624048" author="ebirkenes" created="Wed, 20 Aug 2008 17:53:15 +0100"  >&lt;p&gt;Thanks Myrna, thats great! I never thought of the difference in newline characters.&lt;/p&gt;

&lt;p&gt;I too get the permissions errors I think, at least I saw some when I printed out the whole output from sysinfo, but those lines are removed so they don&apos;t affect the test. &lt;br/&gt;
I will try to figure out what causes it though, as it can be confusing and messy that they are present in the log. &lt;/p&gt;

&lt;p&gt;I&apos;m working on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3834&quot; title=&quot;Convert derbynet/runtimeinfo to JUnit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3834&quot;&gt;&lt;del&gt;DERBY-3834&lt;/del&gt;&lt;/a&gt; right now and alot of your modifications are appropriate there as well, so I&apos;ll put them in before I post it.&lt;/p&gt;</comment>
                            <comment id="12624051" author="ebirkenes" created="Wed, 20 Aug 2008 17:59:50 +0100"  >
&lt;p&gt;I got that error once too. Only one time and I haven&apos;t been able to reproduce it. It seems like it might be a bug in the server or something.&lt;br/&gt;
Does it happen every time? &lt;/p&gt;</comment>
                            <comment id="12624057" author="myrna" created="Wed, 20 Aug 2008 18:24:03 +0100"  >&lt;p&gt;It now looks to me like the error only occurs when I run with classes, not with jars...&lt;/p&gt;</comment>
                            <comment id="12624419" author="knutanders" created="Thu, 21 Aug 2008 17:32:51 +0100"  >&lt;p&gt;Didn&apos;t notice that the problems with assertExecJavaCmdAsExpected() were discussed here until after I checked in a fix for it under &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3841&quot; title=&quot;&amp;#39;testTimeSlice_*(NetworkServerControlApiTest.java)&amp;#39; fails on Jvm1.5/vista, Jvm1.4/SunOS 5.11&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3841&quot;&gt;&lt;del&gt;DERBY-3841&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;FWIW, I think using a char&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; buffer instead of a char&lt;span class=&quot;error&quot;&gt;&amp;#91;1024&amp;#93;&lt;/span&gt; buffer isn&apos;t the best way to handle this in readProcessOutput(). Probably better to keep the larger buffer, store the return value from Reader.read(char[],int,int) in a variable, and use the String(char[],int,int) constructor to specify which part of the char array to use.&lt;/p&gt;</comment>
                            <comment id="12624553" author="myrna" created="Fri, 22 Aug 2008 05:34:04 +0100"  >&lt;p&gt;Attaching a new patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3829&quot; title=&quot;Convert derbynet/sysinfo and derbynet/sysinfo_with_properties to JUnit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3829&quot;&gt;&lt;del&gt;DERBY-3829&lt;/del&gt;&lt;/a&gt;_m5.diff) which attempts to address the permissions problem I saw on windows.&lt;br/&gt;
Turns out sysinfo needs read access to org.apache.derby.info.DBMS.properties. If we&apos;re using jars, that&apos;s in derby.jar, and I guess permission is already granted (I didn&apos;t double check that, it seemed logical).&lt;br/&gt;
I struggled for a while trying to grant java.io.FilePermission read to $derbyTesting.codeclasses, but that one uses the actual OS&apos;s file separator and the FilePermission needs the forward slash - or so it seemed empirically.&lt;br/&gt;
So the latest patch adds a property to just the SysinfoTest.policy and wraps that property into a  SystemProperty Setup around the test&apos;s networkserver setup if we&apos;re using classes.&lt;/p&gt;

&lt;p&gt;I think there are some other tests that just return an empty suite if we&apos;re running with classes for similar reasons, but I thought it worthwhile to make it work as we&apos;re already using a decidated policy file.&lt;/p&gt;

&lt;p&gt;I svn updated before building this patch and tried to incorporate the recent changes to BaseTestCase.assertExecJavaCmdOK, but I wasn&apos;t quite sure that all intended changes were in or not, so a review will be appreciated.&lt;/p&gt;

&lt;p&gt;I ran suites.All with jars on linux (no problems), and with classes on windows...On windows I ran twice and got some strange what looked like cleanup-related errors the first time around, especially in the upgrade tests...(warnings like, table already exist etc), but they didn&apos;t show up a second time...&lt;/p&gt;

&lt;p&gt;All in all, if there are no further suggestions, I&apos;d like to commit this latest variation on Erlend&apos;s work...&lt;/p&gt;</comment>
                            <comment id="12624620" author="knutanders" created="Fri, 22 Aug 2008 09:19:09 +0100"  >&lt;p&gt;The changes to assertExecJavaCmdAsExpected() seem to have been incorporated correctly. Thanks!&lt;/p&gt;

&lt;p&gt;One minor comment (not important enough to hold the commit) is that I think the three new methods in BaseTestCase could be static. That would allow them to be used in more contexts than if they&apos;re not static.&lt;/p&gt;

&lt;p&gt;Another minor issue (copied from the existing code, not introduced here) is that the catch block in execJavaCmd() casts pe.getException() to SecurityException, but since SecurityException is a RuntimeException, it&apos;s never going to be wrapped in a PrivilegedActionException. (Some may say that it&apos;s better if the test code doesn&apos;t unwrap the PrivilegedActionExceptions, because that would simplify the code and the underlying cause would be reported by JUnit anyway.)&lt;/p&gt;</comment>
                            <comment id="12624878" author="myrna" created="Fri, 22 Aug 2008 16:49:31 +0100"  >&lt;p&gt;Thx for the review!&lt;br/&gt;
I went ahead and committed my latest variation on the original patch with revision 688103.&lt;br/&gt;
Leaving open so Knut&apos;s comments can be addressed in a follow-up patch.&lt;/p&gt;</comment>
                            <comment id="12706675" author="kmarsden" created="Thu, 7 May 2009 01:05:55 +0100"  >&lt;p&gt;Unassigning Erlend as I don&apos;t think he is still working on this issue. Erlend if you want to pick it back up, please reassign yourself.&lt;/p&gt;</comment>
                            <comment id="12784952" author="myrna" created="Wed, 2 Dec 2009 18:42:18 +0000"  >&lt;p&gt;attaching a follow-up patch which I think takes care of Knut&apos;s comments.&lt;br/&gt;
Will run regression tests.&lt;/p&gt;</comment>
                            <comment id="12785059" author="knutanders" created="Wed, 2 Dec 2009 23:37:37 +0000"  >&lt;p&gt;Thanks, Myrna. The changes look good. +1 to commit if the regression tests pass.&lt;/p&gt;</comment>
                            <comment id="12785405" author="myrna" created="Thu, 3 Dec 2009 17:29:20 +0000"  >&lt;p&gt;Regression tests passed; committed to trunk (10.6) with revision 886857.&lt;/p&gt;</comment>
                            <comment id="12785413" author="myrna" created="Thu, 3 Dec 2009 17:46:47 +0000"  >&lt;p&gt;Resolving; final comments addressed; assigning to Erlend as he did most of the work; marking fixed in 10.6, but most of this did go into 10.5.&lt;/p&gt;</comment>
                            <comment id="12852469" author="myrna" created="Thu, 1 Apr 2010 18:35:41 +0100"  >&lt;p&gt;With revision 930052 I backported the conversion to 10.4, as a step to addressing &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4536&quot; title=&quot;testProperties and sysinfo_withproperties test failures with ibm 1.6 on 10.3&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4536&quot;&gt;&lt;del&gt;DERBY-4536&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12402157">DERBY-3834</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12388606" name="DERBY-3829_m3.diff" size="70584" author="myrna" created="Wed, 20 Aug 2008 17:37:47 +0100"/>
                            <attachment id="12388711" name="DERBY-3829_m5.diff" size="72637" author="myrna" created="Fri, 22 Aug 2008 05:34:03 +0100"/>
                            <attachment id="12426694" name="DERBY-3829_m6.diff" size="1731" author="myrna" created="Wed, 2 Dec 2009 18:42:18 +0000"/>
                            <attachment id="12387933" name="Derby-3829_1.diff" size="54968" author="ebirkenes" created="Mon, 11 Aug 2008 09:23:49 +0100"/>
                            <attachment id="12388395" name="Derby-3829_2.diff" size="68805" author="ebirkenes" created="Sun, 17 Aug 2008 21:27:40 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 10 Aug 2008 17:38:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31018</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0lb3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37270</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>