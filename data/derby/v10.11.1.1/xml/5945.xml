<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:22:03 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5945/DERBY-5945.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5945] Inappropriate error message when calling a procedure as a function (as if it had a return value)</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5945</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description></description>
                <environment></environment>
        <key id="12611402">DERBY-5945</key>
            <summary>Inappropriate error message when calling a procedure as a function (as if it had a return value)</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="ickzon">Holger Rehn</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Oct 2012 19:00:53 +0100</created>
                <updated>Fri, 18 Jan 2013 08:22:43 +0000</updated>
                            <resolved>Sat, 5 Jan 2013 03:14:39 +0000</resolved>
                                                    <fixVersion>10.10.1.1</fixVersion>
                                    <component>JDBC</component>
                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13474382" author="ickzon" created="Thu, 11 Oct 2012 19:10:14 +0100"  >&lt;p&gt;When a procedure is created and later called with non-matching parameters (namely with a return value), Derby raises an error like&lt;br/&gt;
&apos;PROC&apos; is not recognized as a function or procedure.&lt;/p&gt;

&lt;p&gt;But the procedure exists. If trying to re-create the procedure, Derby correctly throws an error &quot;PROCEDURE &apos;PROC&apos; already exists.&quot;, and the procedure can be dropped via &quot;drop procedure PROC&quot;.&lt;/p&gt;

&lt;p&gt;to reproduce just execute...&lt;/p&gt;

&lt;p&gt;&quot;CREATE PROCEDURE PROC( inout ret in ) parameter style java modifies sql data language java external name &apos;DBProcs.PROC&apos;&quot;&lt;br/&gt;
&quot;{?=call PROC(1)}&quot;&lt;/p&gt;

&lt;p&gt;The error message should point out, that either the procedure cannot return a value or that no matching procedure can be found.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
momo&lt;/p&gt;
</comment>
                            <comment id="13478917" author="dagw" created="Thu, 18 Oct 2012 12:29:54 +0100"  >&lt;p&gt;Moved diagnostic patches over from &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2927&quot; title=&quot;Procedures can&amp;#39;t return values other than ResultSets&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2927&quot;&gt;DERBY-2927&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13478918" author="dagw" created="Thu, 18 Oct 2012 12:30:49 +0100"  >&lt;p&gt;For discussion of patches up and including derby-2927-5945-diag-3, see &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2927&quot; title=&quot;Procedures can&amp;#39;t return values other than ResultSets&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2927&quot;&gt;DERBY-2927&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13542719" author="dagw" created="Thu, 3 Jan 2013 05:11:56 +0000"  >&lt;p&gt;Cf &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2516&quot; title=&quot;Network Client allows execution of callable statement when one of the parameters is not set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2516&quot;&gt;&lt;del&gt;DERBY-2516&lt;/del&gt;&lt;/a&gt;: When this is fixed, enable LangProcedureTest.&lt;/p&gt;</comment>
                            <comment id="13542815" author="knutanders" created="Thu, 3 Jan 2013 09:29:09 +0000"  >&lt;p&gt;The patch looks like a good improvement. Some small comments about the test:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;testDerby2927() should probably use this bug number (5945) instead.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The try/catch statements in testDerby2927() should call fail() last in the try blocks to report if the call unexpectedly succeeds.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;When checking the message text, maybe use getMessage() instead of toString(), since toString() includes the exception class name, and I suspect the assert will fail on Java 5 (where it&apos;s a plain SQLException vs SQLSyntaxErrorException on Java 6 and later).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;testDerby2927() ends with a call to rollback(), but it never disables auto-commit, so that&apos;s presumably a no-op.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The suite() method sets the locale by using territory based collation. Strictly speaking, changing the collation isn&apos;t necessary, so an alternative is to use TestConfiguration.singleUseDatabaseDecorator() + LocaleTestSetup.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13543685" author="dagw" created="Fri, 4 Jan 2013 08:00:23 +0000"  >&lt;p&gt;Thanks, Knut. Took those comments, and also cleaned up LangProcedureTest wrt long lines, whitespace and IDE warnings. I also went through it to vet any embedded/client differences and could remove one that was no longer needed (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2515&quot; title=&quot;Network client does not retain the INOUT parameter value change for subsequent execution&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2515&quot;&gt;&lt;del&gt;DERBY-2515&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Uploaded a new patch derby-5945. Running regressions. &lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Update: regressions passed with no errors&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="13544550" author="dagw" created="Sat, 5 Jan 2013 03:14:18 +0000"  >&lt;p&gt;Committed patch as svn 1429197, resolving.&lt;/p&gt;</comment>
                            <comment id="13544551" author="dagw" created="Sat, 5 Jan 2013 03:16:20 +0000"  >&lt;p&gt;Holger, if you believe this patch solves the issue, please close it.&lt;/p&gt;</comment>
                            <comment id="13544673" author="ickzon" created="Sat, 5 Jan 2013 11:21:57 +0000"  >&lt;p&gt;Dag, thanks for your efforts! I&apos;m currently out of office but will take a look when I&apos;m back in a week.&lt;/p&gt;</comment>
                            <comment id="13549124" author="myrna" created="Wed, 9 Jan 2013 22:34:55 +0000"  >&lt;p&gt;The change to outparams.out was also required for the j9_foundation canon. I updated this with revision 1431120: &lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1431120&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1431120&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13549355" author="dagw" created="Thu, 10 Jan 2013 04:54:11 +0000"  >&lt;p&gt;Sorry for missing that one, Myrna! Thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Dag&lt;/p&gt;

</comment>
                            <comment id="13555388" author="ickzon" created="Wed, 16 Jan 2013 19:48:26 +0000"  >&lt;p&gt;Hi Dag,&lt;/p&gt;

&lt;p&gt;I just build Derby from SVN trunk (revision 1433353) to test your changes but am now getting an NPE. Any idea what I am doing wrong?&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
momo&lt;/p&gt;


&lt;p&gt;java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:98)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.javaException(Util.java:299)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:436)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2400)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:82)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:619)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:559)&lt;br/&gt;
	at com.sqlgmbh.tc.test.adapter.jdbc.OutboundTest.Proc(OutboundTest.java:367)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:601)&lt;br/&gt;
	at org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:80)&lt;br/&gt;
	at org.testng.internal.Invoker.invokeMethod(Invoker.java:714)&lt;br/&gt;
	at org.testng.internal.Invoker.invokeTestMethod(Invoker.java:901)&lt;br/&gt;
	at org.testng.internal.Invoker.invokeTestMethods(Invoker.java:1231)&lt;br/&gt;
	at org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:127)&lt;br/&gt;
	at org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:111)&lt;br/&gt;
	at org.testng.TestRunner.privateRun(TestRunner.java:767)&lt;br/&gt;
	at org.testng.TestRunner.run(TestRunner.java:617)&lt;br/&gt;
	at org.testng.SuiteRunner.runTest(SuiteRunner.java:334)&lt;br/&gt;
	at org.testng.SuiteRunner.runSequentially(SuiteRunner.java:329)&lt;br/&gt;
	at org.testng.SuiteRunner.privateRun(SuiteRunner.java:291)&lt;br/&gt;
	at org.testng.SuiteRunner.run(SuiteRunner.java:240)&lt;br/&gt;
	at org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)&lt;br/&gt;
	at org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:86)&lt;br/&gt;
	at org.testng.TestNG.runSuitesSequentially(TestNG.java:1197)&lt;br/&gt;
	at org.testng.TestNG.runSuitesLocally(TestNG.java:1122)&lt;br/&gt;
	at org.testng.TestNG.run(TestNG.java:1030)&lt;br/&gt;
	at org.testng.remote.RemoteTestNG.run(RemoteTestNG.java:111)&lt;br/&gt;
	at org.testng.remote.RemoteTestNG.initAndRun(RemoteTestNG.java:204)&lt;br/&gt;
	at org.testng.remote.RemoteTestNG.main(RemoteTestNG.java:175)&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:42)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)&lt;br/&gt;
	... 33 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.StaticMethodCallNode.coerceMethodParameter(StaticMethodCallNode.java:702)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.StaticMethodCallNode.resolveRoutine(StaticMethodCallNode.java:620)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.StaticMethodCallNode.bindExpression(StaticMethodCallNode.java:270)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.JavaToSQLValueNode.bindExpression(JavaToSQLValueNode.java:237)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ResultColumn.bindExpression(ResultColumn.java:737)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ResultColumnList.bindExpressions(ResultColumnList.java:831)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.RowResultSetNode.bindExpressions(RowResultSetNode.java:261)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.DMLStatementNode.bindExpressions(DMLStatementNode.java:227)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.DMLStatementNode.bind(DMLStatementNode.java:140)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.CursorNode.bindStatement(CursorNode.java:267)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:400)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:99)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:1103)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:610)&lt;br/&gt;
	... 26 more&lt;/p&gt;</comment>
                            <comment id="13555880" author="dagw" created="Thu, 17 Jan 2013 05:38:19 +0000"  >&lt;p&gt;Not sure. Seems there is a bug in the code base if you built correctly. Can you post a repro? I&apos;ll take a look at it.&lt;/p&gt;</comment>
                            <comment id="13556028" author="ickzon" created="Thu, 17 Jan 2013 10:03:32 +0000"  >&lt;p&gt;Thanks for your fast reply. To reproduce the problem, simply execute the following few lines of code:&lt;/p&gt;

&lt;p&gt;      Class.forName( &quot;org.apache.derby.jdbc.EmbeddedDriver&quot; );&lt;br/&gt;
      Connection conn = DriverManager.getConnection( &quot;jdbc:derby:db;create=true&quot;, &quot;user&quot;, &quot;pwd&quot; );&lt;br/&gt;
      Statement sta = conn.createStatement();&lt;/p&gt;

&lt;p&gt;      try&lt;/p&gt;
      {
         sta.executeUpdate( &quot;drop procedure \&quot;PROC\&quot;&quot; );
      }
&lt;p&gt;      catch( Exception e )&lt;/p&gt;
      {
         // ignore, PROC doesn&apos;t exist when run for the first time
      }

&lt;p&gt;      sta.execute( &quot;create procedure PROC( inout x int ) parameter style java modifies sql data language java external name &apos;DUMMY.PROC&apos;&quot; );&lt;br/&gt;
      sta.execute( &quot;&lt;/p&gt;
{call PROC(1)}
&lt;p&gt;&quot; );&lt;/p&gt;


&lt;p&gt;Please note, that there is only one parameter of type INOUT and the parameter value is provided directly.&lt;/p&gt;


&lt;p&gt;Beside the NPE thing, your fix to the original bug seems to work well. Should I close this ticket then or would you prefer to keep it open until you had a look into the NPE problem which didn&apos;t occur before?&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
momo&lt;/p&gt;</comment>
                            <comment id="13556928" author="dagw" created="Fri, 18 Jan 2013 03:28:29 +0000"  >&lt;p&gt;Thanks for trying it out! Please close this issue; what you are seeing is an unrelated error (a regression), I&apos;ll file a new issue for it. &lt;span class=&quot;error&quot;&gt;&amp;#91;Update: done; DERBY-6047&amp;#93;&lt;/span&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12373599">DERBY-2927</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12365135">DERBY-2461</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12366429">DERBY-2516</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12549668" name="derby-2927-5945-diag-2.diff" size="44070" author="dagw" created="Thu, 18 Oct 2012 12:29:54 +0100"/>
                            <attachment id="12549669" name="derby-2927-5945-diag-2.stat" size="464" author="dagw" created="Thu, 18 Oct 2012 12:29:54 +0100"/>
                            <attachment id="12549670" name="derby-2927-5945-diag-3.diff" size="45844" author="dagw" created="Thu, 18 Oct 2012 12:29:54 +0100"/>
                            <attachment id="12549671" name="derby-2927-5945-diag-3.stat" size="464" author="dagw" created="Thu, 18 Oct 2012 12:29:54 +0100"/>
                            <attachment id="12549666" name="derby-2927-5945-diag.diff" size="43018" author="dagw" created="Thu, 18 Oct 2012 12:29:54 +0100"/>
                            <attachment id="12549667" name="derby-2927-5945-diag.stat" size="384" author="dagw" created="Thu, 18 Oct 2012 12:29:54 +0100"/>
                            <attachment id="12563255" name="derby-5945.diff" size="119835" author="dagw" created="Fri, 4 Jan 2013 08:00:23 +0000"/>
                            <attachment id="12563256" name="derby-5945.stat" size="464" author="dagw" created="Fri, 4 Jan 2013 08:00:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10421"><![CDATA[Seen in production]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 18 Oct 2012 11:29:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>247755</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy2k6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48752</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>