<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:53:03 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-119/DERBY-119.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-119] Add ALTER TABLE option to change column from NULL to NOT NULL</title>
                <link>https://issues.apache.org/jira/browse/DERBY-119</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;There was a thread about this on the Cloudscape forum&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www-106.ibm.com/developerworks/forums/dw_thread.jsp?message=4103269&amp;amp;cat=19&amp;amp;thread=59941&amp;amp;forum=370#4103269&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www-106.ibm.com/developerworks/forums/dw_thread.jsp?message=4103269&amp;amp;cat=19&amp;amp;thread=59941&amp;amp;forum=370#4103269&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Since this describes the problem I will just copy the content of this entry as my dexscription&lt;/p&gt;


&lt;p&gt;The content of this was &lt;/p&gt;

&lt;p&gt;&quot;&lt;br/&gt;
Hi,&lt;/p&gt;

&lt;p&gt;I stumbled across a behaviour of cloudscape which is not a bug but IMHO an implementation choice. To assign a primary key to a table using ALTER TABLE all columns must be declared NOT NULL first, which can only be specified upon column creation (no ALTER TABLE statement exists to change the NOT NULL property of a column).&lt;/p&gt;

&lt;p&gt;Most databases I know do two things differently:&lt;br/&gt;
1) when a primary key is assigned all pk columns are automatically set to NOT NULL, if one of them contains NULL values, the ALTER TABLE statement fails&lt;br/&gt;
2) it is possible to alter the column to set the NOT NULL property after column creation (fails when there are already records containing NULL values)&lt;/p&gt;

&lt;p&gt;If I have understood the limitations correctly in Cloudscape I have no choice but to remove and re-add the column which is supposed to be used in the primary key, if it is not already declared as NOT NULL. This means that in the case of a table containing valid data (unique and not null) in the column in all records, I would have to export the data, remove and re-add the column and reimport that data, which would not be necessary e.g. in Oracle or MaxDB.&lt;/p&gt;

&lt;p&gt;Is it possible to change that behaviour or is there a good reason for it? It looks as if it makes the life of the user more difficult than necessary for certain metadata manipulations. Making it possible to alter the NOT NULL property of a column would solve this and IMHO having a primary key constraint do this implicitly makes sense as well. &lt;/p&gt;

&lt;p&gt;Thanks in advance for any insight on this,&lt;/p&gt;

&lt;p&gt;Robert&quot;&lt;/p&gt;
</description>
                <environment></environment>
        <key id="29461">DERBY-119</key>
            <summary>Add ALTER TABLE option to change column from NULL to NOT NULL</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="bruehlicke">Bernd Ruehlicke</reporter>
                        <labels>
                    </labels>
                <created>Sat, 15 Jan 2005 07:05:51 +0000</created>
                <updated>Thu, 2 May 2013 03:29:01 +0100</updated>
                            <resolved>Sat, 26 Aug 2006 20:41:42 +0100</resolved>
                                                    <fixVersion>10.2.1.6</fixVersion>
                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="12421451" author="bryanpendleton" created="Sun, 16 Jul 2006 17:01:03 +0100"  >&lt;p&gt;Attached is alterColumnNotNull_1.diff, a proposed patch which merges the db2AlterColumn and columnAlterClause routines in the parser to provide a single ALTER TABLE ALTER COLUMN statement that provides support for changing the NULL/NOT NULL constraint on a column in a table.&lt;/p&gt;</comment>
                            <comment id="12424649" author="djd" created="Mon, 31 Jul 2006 21:52:50 +0100"  >&lt;p&gt;Does the patch complete this feature or is it just parser changes. The comment seems to indicate it is parser changes but the tests seem to imply the feature is working.&lt;/p&gt;</comment>
                            <comment id="12424654" author="bryanpendleton" created="Mon, 31 Jul 2006 22:01:56 +0100"  >&lt;p&gt;I believe the patch completes the future, sorry for the confusing comment. I believe that the existing execution code in AlterTableConstantAction.java is fine as is, and so this new feature just requires parser changes and tests. When I apply the patch in my environment, the feature seems to be working fine.&lt;/p&gt;

&lt;p&gt;I suspect that I haven&apos;t added enough tests, so suggestions and feedback about how to write more tests would be helpful; I don&apos;t have a lot of experience writing tests in this area.&lt;/p&gt;</comment>
                            <comment id="12425049" author="deepa" created="Tue, 1 Aug 2006 23:50:06 +0100"  >&lt;p&gt;I think the following additional tests will be good to add:&lt;/p&gt;

&lt;p&gt;1) Check that a column in a primary key cannot be modified to null.&lt;br/&gt;
2) Check that a column defined as UNIQUE cannot be modified to null.&lt;br/&gt;
3) Add a check to see specifying &quot;COLUMN&quot; in the alter statement is optional.&lt;/p&gt;

&lt;p&gt;I tried the above tests with &apos;alterColumnNotNull_1.diff&apos; patch. 1)  and 3) pass. In case of 2) no exception is thrown. We can alter a column defined as UNIQUE to null. And we can also insert null values into the unique column.&lt;/p&gt;

&lt;p&gt;Derby reference guide mentions this about UNIQUE constraint:&lt;br/&gt;
&quot;Specifies that values in the columns must be unique. The identified columns must be defined as NOT NULL.&quot;&lt;/p&gt;

&lt;p&gt;Dev guide mentions this:&lt;br/&gt;
&quot;The SQL standard defines that unique constraints on nullable columns allow any number of nulls; Derby does not permit unique constraints on nullable columns.&quot;&lt;/p&gt;

&lt;p&gt;Based on this, I think we should be checking that we cannot modify a UNIQUE column to null.&lt;/p&gt;

&lt;p&gt;I see that in the test, you have a comment in the form of a question:&lt;br/&gt;
+ij&amp;gt; &amp;#8211; Now that B has a null value, can I modify it to NOT NULL?&lt;/p&gt;

&lt;p&gt;I think the current behaviour is correct. It should not be possible to modify a column which already has a null value to NOT NULL.&lt;/p&gt;</comment>
                            <comment id="12425064" author="bryanpendleton" created="Wed, 2 Aug 2006 00:49:47 +0100"  >&lt;p&gt;Thank you very much for the review, Deepa. I will investigate the issues that you raised.&lt;/p&gt;</comment>
                            <comment id="12425068" author="fuzzylogic" created="Wed, 2 Aug 2006 01:05:49 +0100"  >&lt;p&gt;Another reason to not allow nulling of unique columns: with the patch, the engine will only allow you to insert one null in the table:&lt;/p&gt;

&lt;p&gt;ij version 10.2&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby:checkalter;create=true&apos;;&lt;br/&gt;
ij&amp;gt; create table t1 (i1 int unique not null, v1 varchar(10));&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t1 values (1, &apos;foo&apos;);&lt;br/&gt;
1 row inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; alter table t1 alter column i1 null;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t1 values (null, &apos;oof&apos;);&lt;br/&gt;
1 row inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t1 values (null, &apos;oof&apos;);&lt;br/&gt;
ERROR 23505: The statement was aborted because it would have caused a duplicate key value in a unique or primary key constraint or unique index identified by &apos;SQL060801045657420&apos; defined on &apos;T1&apos;.&lt;/p&gt;

&lt;p&gt;which, according to what Deepa quoted, would contradict the language in the SQL standard, although I haven&apos;t checked it myself.&lt;/p&gt;</comment>
                            <comment id="12425978" author="bryanpendleton" created="Sat, 5 Aug 2006 17:58:31 +0100"  >&lt;p&gt;Cleared patch available; I need to revise the patch to incorporate the suggestions from reviewers.&lt;/p&gt;</comment>
                            <comment id="12427758" author="bryanpendleton" created="Sun, 13 Aug 2006 16:37:19 +0100"  >&lt;p&gt;attached is alterColumnNotNull_v2.diff, a revised patch proposal&lt;br/&gt;
which adds some additional tests and addresses the issue with&lt;br/&gt;
altering a UNIQUE column to NULL.&lt;/p&gt;

&lt;p&gt;This patch prevents you from altering a UNIQUE column to NULL,&lt;br/&gt;
but I encountered some uncertainty about whether to create an&lt;br/&gt;
entirely new error message for this case, or just to extend the&lt;br/&gt;
existing PRIMARY KEY error message.&lt;/p&gt;

&lt;p&gt;The path I took in this patch was to use the existing message, but&lt;br/&gt;
alter the message text to make it clear that it covers both cases now.&lt;/p&gt;

&lt;p&gt;So I changed the check in ModifyColumnNode.java from&lt;/p&gt;

&lt;p&gt;                   (existingConstraint.getConstraintType() ==&lt;br/&gt;
                    DataDictionary.PRIMARYKEY_CONSTRAINT))&lt;br/&gt;
to &lt;br/&gt;
                   ((existingConstraint.getConstraintType() ==&lt;br/&gt;
                    DataDictionary.PRIMARYKEY_CONSTRAINT) ||&lt;br/&gt;
                    (existingConstraint.getConstraintType() ==&lt;br/&gt;
                    DataDictionary.UNIQUE_CONSTRAINT)))&lt;/p&gt;

&lt;p&gt;and I changed the text of the error message to read:&lt;/p&gt;

&lt;p&gt;42Z20=Column &apos;&apos;&lt;/p&gt;
{0}
&lt;p&gt;&apos;&apos; cannot be made nullable. It is part of a primary key or unique constraint, which cannot have any nullable columns.&lt;/p&gt;

&lt;p&gt;Reviewers: do you think it would be better to create an entirely&lt;br/&gt;
new message to cover the UNIQUE case, rather than extending the&lt;br/&gt;
existing message to cover the additional case?&lt;/p&gt;
</comment>
                            <comment id="12427996" author="deepa" created="Tue, 15 Aug 2006 01:17:39 +0100"  >&lt;p&gt;Thanks Bryan for the updated patch. I read through the patch. It addresses my previous comments and looks good to me. For your question:&lt;br/&gt;
&quot;&lt;br/&gt;
Reviewers: do you think it would be better to create an entirely&lt;br/&gt;
new message to cover the UNIQUE case, rather than extending the&lt;br/&gt;
existing message to cover the additional case?&lt;br/&gt;
&quot;&lt;/p&gt;

&lt;p&gt;In my opinion, it is okay to re-use the same message as this message is used only once in the code. So changing the message text shouldn&apos;t affect any other scenario. Also, I think it is good to re-use messages where possible as this would help keep the jar size down.  &lt;/p&gt;

&lt;p&gt;One small comment: Along with changing the message text, it may be good to change the name of the SQLState variable &quot;LANG_MODIFY_COLUMN_PKEY_CONSTRAINT&quot; to indicate it also covers UNIQUE constraint.&lt;/p&gt;</comment>
                            <comment id="12428334" author="bryanpendleton" created="Wed, 16 Aug 2006 07:14:47 +0100"  >&lt;p&gt;Hi Deepa, thanks for re-reviewing the patch. I think your idea about renaming the &lt;br/&gt;
SQLState constant is a good one. Attached is alterColumnNotNull_v3.diff, which&lt;br/&gt;
 differs from alterColumnNotNull_v2.diff in that it renames &lt;br/&gt;
      LANG_MODIFY_COLUMN_PKEY_CONSTRAINT&lt;br/&gt;
to&lt;br/&gt;
     LANG_MODIFY_COLUMN_EXISTING_CONSTRAINT&lt;/p&gt;</comment>
                            <comment id="12430781" author="bryanpendleton" created="Sat, 26 Aug 2006 20:41:42 +0100"  >&lt;p&gt;Committed alterColumnNotNull_v3.diff to the trunk as revision 437215.&lt;/p&gt;

&lt;p&gt;Marked issue resolved and cleared Patch Available.&lt;/p&gt;

&lt;p&gt;I still need to write a Release Note for this issue, to alert users to the new feature.&lt;/p&gt;

&lt;p&gt;I also will open a new separate JIRA issue to cover updating the documentation&lt;br/&gt;
for the new feature.&lt;/p&gt;

&lt;p&gt;Thanks everyone for your reviews and suggestions regarding the implementation!&lt;/p&gt;</comment>
                            <comment id="12430785" author="bryanpendleton" created="Sat, 26 Aug 2006 20:58:14 +0100"  >&lt;p&gt;Here&apos;s a short release note:&lt;/p&gt;

&lt;p&gt;The ALTER TABLE statement now includes the additional ability to alter&lt;br/&gt;
the NULL / NOT NULL constraint on a column in a table. The syntax is:&lt;/p&gt;

&lt;p&gt;  ALTER TABLE table ALTER &lt;span class=&quot;error&quot;&gt;&amp;#91;COLUMN&amp;#93;&lt;/span&gt; column &lt;span class=&quot;error&quot;&gt;&amp;#91;NOT&amp;#93;&lt;/span&gt; NULL&lt;/p&gt;

&lt;p&gt;You cannot remove the NOT NULL constraint if the column is used&lt;br/&gt;
in a PRIMARY KEY or UNIQUE constraint.&lt;/p&gt;

&lt;p&gt;You cannot add the NOT NULL constraint if there are existing NULL&lt;br/&gt;
values for the column in the table.&lt;/p&gt;</comment>
                            <comment id="12432551" author="bryanpendleton" created="Tue, 5 Sep 2006 00:04:22 +0100"  >&lt;p&gt;Changes merged to the 10.2 branch. Merge was clean, derbyall was troublefree.&lt;br/&gt;
Committed to subversion as revision 440203.&lt;/p&gt;</comment>
                            <comment id="12432604" author="heath_david" created="Tue, 5 Sep 2006 14:00:48 +0100"  >&lt;p&gt;Do you have an idea when this feature will make it into a non-alpha release - will it make it into 10.1 branch?&lt;/p&gt;

&lt;p&gt;Derby is one of the DBMS we use in our application and currently we are working on tools to help in the migration of our data model from one version to the next. In doing so, I am hoping to have the ability to change the NULL constraint on a column. I had assumed Derby already supported this behavior and only discovered yesterday that its is a new feature and has only made it into the 10.2 branch.&lt;/p&gt;</comment>
                            <comment id="12496134" author="rhillegas" created="Tue, 15 May 2007 22:04:05 +0100"  >&lt;p&gt;Attaching a releaseNote.html based on the release note sketched in the comments.&lt;/p&gt;</comment>
                            <comment id="12510918" author="myrna" created="Sat, 7 Jul 2007 20:25:55 +0100"  >&lt;p&gt;This was backported to 10.2. branch apparently on time for 10.2.1.6, at least, it appears in the release notes for that version. (See: &lt;a href=&quot;http://db.apache.org/derby/releases/release-10.2.1.6.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/releases/release-10.2.1.6.html&lt;/a&gt;)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12311732">DERBY-396</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12348690">DERBY-1765</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12336968" name="alterColumnNotNull_1.diff" size="8461" author="bryanpendleton" created="Sun, 16 Jul 2006 17:01:03 +0100"/>
                            <attachment id="12338763" name="alterColumnNotNull_v2.diff" size="12840" author="bryanpendleton" created="Sun, 13 Aug 2006 16:37:19 +0100"/>
                            <attachment id="12338937" name="alterColumnNotNull_v3.diff" size="13738" author="bryanpendleton" created="Wed, 16 Aug 2006 07:14:47 +0100"/>
                            <attachment id="12357422" name="releaseNote.html" size="1424" author="rhillegas" created="Tue, 15 May 2007 22:04:05 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 16 Jul 2006 16:01:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29407</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10101"><![CDATA[Release Note Needed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ndz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37607</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>