<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:50:09 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4495/DERBY-4495.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4495] Add NATURAL JOIN syntax</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4495</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;It would be nice if Derby supported the NATURAL JOIN syntax (feature F401-01 in SQL:2003).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12444199">DERBY-4495</key>
            <summary>Add NATURAL JOIN syntax</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Dec 2009 22:22:22 +0000</created>
                <updated>Fri, 8 Jan 2010 12:40:02 +0000</updated>
                            <resolved>Fri, 8 Jan 2010 12:40:02 +0000</resolved>
                                    <version>10.6.1.0</version>
                                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12794574" author="knutanders" created="Fri, 25 Dec 2009 23:19:06 +0000"  >&lt;p&gt;Here&apos;s a quick attempt to add NATURAL JOIN. No sanity/error checking or tests, but it seems to work in the simplest case, at least:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; select cast(schemaname as char(5)), cast(tablename as char(5))&lt;br/&gt;
&amp;gt;  from sys.sysschemas natural join sys.systables where schemaname = &apos;APP&apos;;&lt;br/&gt;
1    |2    &lt;br/&gt;
-----------&lt;br/&gt;
APP  |T    &lt;br/&gt;
APP  |T1   &lt;br/&gt;
APP  |T2   &lt;/p&gt;

&lt;p&gt;3 rows selected&lt;/p&gt;</comment>
                            <comment id="12794821" author="knutanders" created="Mon, 28 Dec 2009 14:53:05 +0000"  >&lt;p&gt;Things that are known not to work with the preview patch, are:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;expansion of asterisks should follow rules similar to the ones for the USING clause (see &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4370&quot; title=&quot;Implement JOIN ... USING syntax&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4370&quot;&gt;&lt;del&gt;DERBY-4370&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if there are no common columns, NATURAL JOIN should behave like CROSS JOIN, but currently throws a NullPointerException&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12795028" author="knutanders" created="Tue, 29 Dec 2009 08:58:05 +0000"  >&lt;p&gt;Uploading a new preview patch that addresses the known issues with the first patch and also adds some test cases. To get the correct expansion of asterisks, the natural join was transformed to a USING join earlier, at the end of bindExpression(). Also, the transformation of a USING clause to a join condition was modified so that it generates a valid join clause if there are no common columns (otherwise it would generate an AndNode with no children and cause a NullPointerException).&lt;/p&gt;

&lt;p&gt;One new problem was found: Combining NATURAL with other join operators may fail with a NullPointerException. For example, this query fails:&lt;/p&gt;

&lt;p&gt;  SELECT * FROM T1 CROSS JOIN T2 NATURAL JOIN T3&lt;/p&gt;

&lt;p&gt;The problem appears to be that the RCL of the CROSS JOIN operation has not been instantiated when the USING clause for the NATURAL JOIN operation is generated. The RCL is actually still null when the expansion of asterisks happens, so simply delaying the generation of the USING clause until we need it doesn&apos;t prevent the NPE (we need to know the common columns to expand asterisks correctly).&lt;/p&gt;</comment>
                            <comment id="12797083" author="knutanders" created="Wed, 6 Jan 2010 12:04:18 +0000"  >&lt;p&gt;The NPE when combining join operators was caused by JoinNode&apos;s late&lt;br/&gt;
building of the RCL (it&apos;s not done in bindExpressions(), but in&lt;br/&gt;
deferredBindExpressions()). However, the column names are available if&lt;br/&gt;
you call getAllResultColumns(null) instead of getResultColumns(), so&lt;br/&gt;
the solution to that problem was straightforward.&lt;/p&gt;

&lt;p&gt;I&apos;m uploading a new patch (derby-4495-1a.diff) with that change, as&lt;br/&gt;
well as more comments and tests. All the regression tests ran cleanly,&lt;br/&gt;
so the patch is ready for review.&lt;/p&gt;

&lt;p&gt;Here&apos;s a description of the changes in the patch:&lt;/p&gt;

&lt;p&gt;JoinNode.java:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added a flag for natural join.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In the bind phase, generate a USING clause containing all the common&lt;br/&gt;
  columns in the natural join.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In the code that transforms USING to ON (deferredBindExpressions),&lt;br/&gt;
  remove the implicit assumption that USING clauses contain at least&lt;br/&gt;
  one column name (the USING syntax requires at least one column, but&lt;br/&gt;
  natural joins between tables with no common columns can make us&lt;br/&gt;
  generate empty USING clauses internally, breaking that assumption)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;sqlgrammar.jj:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Factored out existing code to generate a new join node to avoid&lt;br/&gt;
  having to duplicate that code for natural join.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added new rule naturalJoin and wired it into joinedTableExpression.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;JoinTest.java:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added test cases for the new syntax. I&apos;ve verified that the results&lt;br/&gt;
  are the same as with PostgreSQL (with the exception of the&lt;br/&gt;
  statements that use asterisked identifier chains - see discussion on&lt;br/&gt;
  &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4370&quot; title=&quot;Implement JOIN ... USING syntax&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4370&quot;&gt;&lt;del&gt;DERBY-4370&lt;/del&gt;&lt;/a&gt;). There&apos;s always room for more tests. Suggestions are&lt;br/&gt;
  welcome.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12798000" author="knutanders" created="Fri, 8 Jan 2010 12:40:02 +0000"  >&lt;p&gt;I committed the patch to trunk with revision 897190 so that people can start testing the new syntax. Problems could be reported in separate JIRA issues. Closing this issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12444785">DERBY-4506</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12429522" name="derby-4495-1a.diff" size="22890" author="knutanders" created="Wed, 6 Jan 2010 12:04:18 +0000"/>
                            <attachment id="12429521" name="derby-4495-1a.stat" size="220" author="knutanders" created="Wed, 6 Jan 2010 12:04:18 +0000"/>
                            <attachment id="12428965" name="natural_preview.diff" size="9466" author="knutanders" created="Fri, 25 Dec 2009 23:19:06 +0000"/>
                            <attachment id="12429059" name="natural_preview_v2.diff" size="15830" author="knutanders" created="Tue, 29 Dec 2009 08:58:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31253</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0rdj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38253</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>