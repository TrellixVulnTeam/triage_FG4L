<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:47:11 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3151/DERBY-3151.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3151] Reduce dependency on NetworkServerControl in TestConfiguration</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3151</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Code has been added in TestConfiguration to allow for starting and stopping a Derby network server.&lt;br/&gt;
Even if you know will not need this functionality, or you simply don&apos;t want to have this functionality available, you must include derbynet.jar (or point to classes/).&lt;/p&gt;

&lt;p&gt;I think this dependency should be reduced, by not having any instance variables and by not importing the class with an explicit import statement. The existing instance variables are not used.&lt;/p&gt;

&lt;p&gt;With this planned change, you can run tests without including derbynet.jar on the classpath, as long as they don&apos;t call &apos;startNetworkServer&apos; or &apos;stopNetworkServer&apos;. Most often these methods will be called by a decorator.&lt;/p&gt;

&lt;p&gt;The downside of this change, is that you won&apos;t get any error messages before the mentioned methods are actually executed.&lt;br/&gt;
A typical error message:&lt;br/&gt;
Failed to invoke suite():java.lang.NoClassDefFoundError: org/apache/derby/drda/NetworkServerControl&lt;/p&gt;

&lt;p&gt;I&apos;m sure there are other solutions as well, but this one is really easy.&lt;br/&gt;
Any opinions on this change?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12381216">DERBY-3151</key>
            <summary>Reduce dependency on NetworkServerControl in TestConfiguration</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kristwaa">Kristian Waagan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Oct 2007 06:45:46 +0100</created>
                <updated>Mon, 4 May 2009 19:22:12 +0100</updated>
                            <resolved>Fri, 20 Jun 2008 08:06:32 +0100</resolved>
                                    <version>10.4.1.3</version>
                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12537849" author="kristwaa" created="Fri, 26 Oct 2007 07:27:25 +0100"  >&lt;p&gt;&apos;derby-3151-1a-proposal.diff&apos; is a proposal of what can be done.&lt;/p&gt;</comment>
                            <comment id="12537979" author="djd" created="Fri, 26 Oct 2007 15:50:58 +0100"  >&lt;p&gt;Was there some recent change that caused this? I used to run tests without derbynet.jar with no problems.&lt;br/&gt;
That&apos;s alos how the J2ME foundation runs are usually made.&lt;/p&gt;

&lt;p&gt;There is a test method to see if the network server is available, Derby.hasServer.&lt;/p&gt;</comment>
                            <comment id="12537988" author="kristwaa" created="Fri, 26 Oct 2007 16:41:03 +0100"  >&lt;p&gt;I haven&apos;t studied the history much, but maybe something has been added that we already have support for?&lt;br/&gt;
The import statement was added the 9th of September, revision 574053.&lt;/p&gt;

&lt;p&gt;If I write this test;&lt;br/&gt;
package org.apache.derbyTesting.functionTests.tests.jdbcapi;&lt;br/&gt;
import junit.framework.Test;&lt;br/&gt;
import org.apache.derbyTesting.junit.BaseJDBCTestCase;&lt;br/&gt;
import org.apache.derbyTesting.junit.TestConfiguration;&lt;/p&gt;

&lt;p&gt;public class BogusTest extends BaseJDBCTestCase {&lt;/p&gt;

&lt;p&gt;    public BogusTest(String name) &lt;/p&gt;
{
        super(name);
    }

&lt;p&gt;    public static Test suite() &lt;/p&gt;
{
        return TestConfiguration.embeddedSuite(BogusTest.class);
    }
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;And then run it:&lt;br/&gt;
java -classpath jars/sane/derbyTesting.jar:jars/sane/derby.jar:tools/java/junit.jar junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.jdbcapi.BogusTest&lt;/p&gt;

&lt;p&gt;I get:&lt;br/&gt;
Failed to invoke suite():java.lang.NoClassDefFoundError: org/apache/derby/drda/NetworkServerControl&lt;/p&gt;

&lt;p&gt;To me this seems like a problem, since I haven&apos;t planned to run a network server at all. I just want to run my tests with the embedded driver.&lt;br/&gt;
Have I overlooked something?&lt;/p&gt;</comment>
                            <comment id="12545741" author="mamtas" created="Tue, 27 Nov 2007 07:57:18 +0000"  >&lt;p&gt;Once we reach a resolution to this jira entry, we should provide a similar central mechanism to start and stop network server in 10.3 codeline. Currently, in 10.3 codeline,  tests like TestConnectionMethods.java and OutBufferedStream.java have their own code to start and stop network server. I will be soon committing changes(in 10.3 codeline) into jdbcapi.DataSourceTest and jdbc4.DataSourceTest which will also have code to start and stop network server. It will be good for the some base class in 10.3 to provide start and stop network server functionality so specific tests can rely on that functionality rather than duplicating code.&lt;/p&gt;</comment>
                            <comment id="12604167" author="kristwaa" created="Wed, 11 Jun 2008 10:21:48 +0100"  >&lt;p&gt;Attaching another fix and a test to demonstrate the problem/fix (see earlier comment for how to run the test).&lt;/p&gt;

&lt;p&gt;&apos;derby-3151-2a-wrapper.diff&apos; removes references to NetworkServerControl in TestConfiguration, and uses a wrapper class to start and shutdown a server. I tried using an existing class (NetworkServerTestSetup), but wasn&apos;t able to do that easily.&lt;br/&gt;
Note that the wrapper class is only intended to solve the problem related to importing NetworkServerControl in TestConfiguration.&lt;/p&gt;

&lt;p&gt;Patch ready for review.&lt;br/&gt;
Is the patch solving  a problem, or am I just adding complexity?&lt;/p&gt;</comment>
                            <comment id="12604388" author="dagw" created="Thu, 12 Jun 2008 01:07:57 +0100"  >&lt;p&gt;In derby-3151-2a-wrapper, the contructor seems to push and then immediately pop&lt;br/&gt;
the value of derby.drda.sslMode. What is the purpose of this?&lt;/p&gt;</comment>
                            <comment id="12604463" author="kristwaa" created="Thu, 12 Jun 2008 10:45:44 +0100"  >&lt;p&gt;&apos;derby-3151-2b-wrapper.diff&apos; has the following changes: some restructuring in the constructor, fixed typos, removed a commented code line and added comments.&lt;/p&gt;

&lt;p&gt;Thank you for reviewing the patch Dag.&lt;br/&gt;
There is no purpose of what you describe. It&apos;s a bug I introduced by copying code and then making some small changes...&lt;/p&gt;

&lt;p&gt;The second revision is available for review.&lt;/p&gt;</comment>
                            <comment id="12605112" author="dagw" created="Sun, 15 Jun 2008 00:27:13 +0100"  >&lt;p&gt;I am curious as to why it works to remove the import and just specify the class fully qualified.&lt;br/&gt;
It seems the the class loader refrains from looking up NetworkServerControl when you use this trick.&lt;br/&gt;
Is this behavior documented anywhere, and is if VM specific? I would have though the only safe way to achive this&lt;br/&gt;
late binding was by using reflection, but if this is good enough, thats fine &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12605275" author="rhillegas" created="Mon, 16 Jun 2008 14:00:05 +0100"  >&lt;p&gt;This may address Dag&apos;s question about class name resolution: The VM spec allows a lot of flexibility in when class references are resolved. See the second paragraph in this section of the vm spec: &lt;a href=&quot;http://java.sun.com/docs/books/jvms/second_edition/html/Concepts.doc.html#22574&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://java.sun.com/docs/books/jvms/second_edition/html/Concepts.doc.html#22574&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12605308" author="kristwaa" created="Mon, 16 Jun 2008 15:58:27 +0100"  >&lt;p&gt;&apos;derby-3151-4a-wrapper_with_reflection.diff&apos; uses reflection.&lt;br/&gt;
The regression tests haven&apos;t completed yet.&lt;/p&gt;

&lt;p&gt;Ready for comments!&lt;/p&gt;</comment>
                            <comment id="12605617" author="kristwaa" created="Tue, 17 Jun 2008 15:28:20 +0100"  >&lt;p&gt;Uploaded a new version of the 4a patch. There was no reason to duplicate the logic, so reflection is now being used to obtain a NetworkServerControl instance through a static method in NetworkServerTestSetup (as before).&lt;br/&gt;
I found it easier to keep the new wrapper class, but in theory this code could be moved into TestConfiguration. I do feel that TestConfiguration is large enough as it is, so I prefer not to add more code to it unless it is necessary.&lt;/p&gt;

&lt;p&gt;I&apos;m a bit unsure about the error handling. Is it sufficient?&lt;/p&gt;

&lt;p&gt;My regression test got aborted, so I&apos;ve restarted it. &lt;br/&gt;
Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="12605796" author="dagw" created="Wed, 18 Jun 2008 02:09:50 +0100"  >&lt;p&gt;Looks good to me, +1.Just some nits (non-blockers):&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;header of NetworkServerControlWrapper&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;is depending -&amp;gt; depends&lt;/li&gt;
	&lt;li&gt;typo: reqired&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Is the NO_ARGS and NO_ARGS_CLASS objects really needed? I think you&lt;br/&gt;
  can just use &quot;null&quot;. E.g., quoting from Method#invoke JavaDoc:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  &quot;If the number of formal parameters required by the underlying&lt;br/&gt;
  method is 0, the supplied args array may be of length 0 or null.&lt;/p&gt;

&lt;p&gt;I tried to see if this patch changed anything by removing derbynet.jar&lt;br/&gt;
and derbyrun.jar from my classpatch a running a test which uses&lt;/p&gt;

&lt;p&gt;            TestConfiguration.clientServerDecorator&lt;/p&gt;

&lt;p&gt;but in my environment that worked even without the patch (the&lt;br/&gt;
decorator omits the test), cf. TestConfiguration#defaultServerDecorator &lt;br/&gt;
which tests if there are suitable jars available.  But perhaps this is a&lt;br/&gt;
problem for other environments like JME &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="12605891" author="kristwaa" created="Wed, 18 Jun 2008 10:08:56 +0100"  >&lt;p&gt;&apos;derby-3151-4b-wrapper_with_reflection.diff&apos; replaces patch 4a and addresses the comments made by Dag. Thanks for the tip about using &apos;null&apos; instead of empty arrays!&lt;/p&gt;

&lt;p&gt;I don&apos;t understand why you don&apos;t see the exception. I picked a random test in lang, and got this when I tried running &apos;lang.TimeHandlingTest&apos; without derbynet.jar and derbyrun.jar:&lt;br/&gt;
Failed to invoke suite():java.lang.NoClassDefFoundError: org/apache/derby/drda/NetworkServerControl&lt;/p&gt;

&lt;p&gt;I ran this with Sun JDK 1.6. With the patch applied, 3 tests were run (as opposed to 6 with everything on the classpat).&lt;br/&gt;
Can you try to run &apos;lang.TimeHandlingTest&apos; to confirm, so I don&apos;t commit anything that&apos;s not required?&lt;/p&gt;


&lt;p&gt;thanks,&lt;/p&gt;</comment>
                            <comment id="12605921" author="dagw" created="Wed, 18 Jun 2008 12:54:28 +0100"  >&lt;p&gt;Sorry for the red herring; it was late, I must have forgotten to rebuild the jars so I ran &lt;b&gt;with&lt;/b&gt; the patch also when I thought I didn&apos;t.&lt;br/&gt;
So, yes, the patch is needed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;+1 (modulo some property changes I didn&apos;t understand at the beginning of the diff...)&lt;/p&gt;</comment>
                            <comment id="12605999" author="kristwaa" created="Wed, 18 Jun 2008 17:18:30 +0100"  >&lt;p&gt;Thanks for the confirmation and spotting the diff error, Dag.&lt;br/&gt;
I accidentally included some property changes done by my IDE in the diff. I&apos;m uploading a new patch (same name).&lt;/p&gt;

&lt;p&gt;I intend to commit this tomorrow.&lt;/p&gt;</comment>
                            <comment id="12606651" author="kristwaa" created="Fri, 20 Jun 2008 08:06:32 +0100"  >&lt;p&gt;Committed &apos;derby-3151-4b-wrapper_with_reflection.diff&apos; to trunk with revision 669808.&lt;/p&gt;

&lt;p&gt;This patch can be backported to 10.4, but it will require either backporting another small change (BaseTestCase.fail(String,Exception)) or a few small changes to the patch (manual merge).&lt;br/&gt;
I&apos;ll do the backport if I get any requests to do so.&lt;/p&gt;</comment>
                            <comment id="12608379" author="kristwaa" created="Thu, 26 Jun 2008 11:15:18 +0100"  >&lt;p&gt;There has been no request for a backport, so I&apos;m closing the issue.&lt;br/&gt;
A backport can easily be done later anyway.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12368454" name="derby-3151-1a-proposal.diff" size="1908" author="kristwaa" created="Fri, 26 Oct 2007 07:27:25 +0100"/>
                            <attachment id="12383814" name="derby-3151-2a-wrapper.diff" size="5132" author="kristwaa" created="Wed, 11 Jun 2008 10:21:48 +0100"/>
                            <attachment id="12383815" name="derby-3151-2a-wrapper.stat" size="156" author="kristwaa" created="Wed, 11 Jun 2008 10:21:48 +0100"/>
                            <attachment id="12383901" name="derby-3151-2b-wrapper.diff" size="5505" author="kristwaa" created="Thu, 12 Jun 2008 10:45:44 +0100"/>
                            <attachment id="12383816" name="derby-3151-3a-test.diff" size="1222" author="kristwaa" created="Wed, 11 Jun 2008 10:21:48 +0100"/>
                            <attachment id="12384135" name="derby-3151-4a-wrapper_with_reflection.diff" size="6976" author="kristwaa" created="Tue, 17 Jun 2008 15:28:20 +0100"/>
                            <attachment id="12384220" name="derby-3151-4b-wrapper_with_reflection.diff" size="6694" author="kristwaa" created="Wed, 18 Jun 2008 17:18:30 +0100"/>
                            <attachment id="12384203" name="derby-3151-4b-wrapper_with_reflection.diff" size="7011" author="kristwaa" created="Wed, 18 Jun 2008 10:08:56 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 26 Oct 2007 14:50:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30743</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0xuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39303</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>