<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:22:12 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3016/DERBY-3016.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3016] Replication: Add code that parses a chunk of log records (byte[]) into individual log records </title>
                <link>https://issues.apache.org/jira/browse/DERBY-3016</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The derby instance that has the slave role for a database &apos;x&apos; has to redo log records sent from the master. These log records are sent in chunks as a byte[]. To be useful to the slave, these chunks of log records must be parsed into individual log records. &lt;/p&gt;

&lt;p&gt;The actual format of the received log record chunks is defined by the replication log buffer (see &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2926&quot; title=&quot;Replication: Add a log buffer for log records that should be shipped to the slave&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2926&quot;&gt;&lt;del&gt;DERBY-2926&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12376392">DERBY-3016</key>
            <summary>Replication: Add code that parses a chunk of log records (byte[]) into individual log records </summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12374543">DERBY-2978</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jorgenlo">J&#248;rgen L&#248;land</assignee>
                                    <reporter username="jorgenlo">J&#248;rgen L&#248;land</reporter>
                        <labels>
                    </labels>
                <created>Mon, 20 Aug 2007 10:51:33 +0100</created>
                <updated>Fri, 21 Jan 2011 18:17:04 +0000</updated>
                            <resolved>Wed, 29 Aug 2007 00:04:17 +0100</resolved>
                                    <version>10.4.1.3</version>
                                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12521757" author="jorgenlo" created="Wed, 22 Aug 2007 12:16:42 +0100"  >&lt;p&gt;The attached patch, v1, contains a class ReplicationLogScan that will be used to parse chunks of log received from the master. It contains an implementation for reading int, long and bytes from a byte[] instead of using java.nio.ByteBuffer. As discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2926&quot; title=&quot;Replication: Add a log buffer for log records that should be shipped to the slave&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2926&quot;&gt;&lt;del&gt;DERBY-2926&lt;/del&gt;&lt;/a&gt;, this is done in case we want to allow replication in j2me applications.&lt;/p&gt;

&lt;p&gt;The patch also adds a new error code to SQLState.java. I chose error codes XRExx to be the range for replication errors since X is an implementation specific range according to the SQL standard, and XRE fits the naming pattern used for other derby specific error messages.&lt;/p&gt;

&lt;p&gt;Edit: note that ReplicationLogScan is not used Derby yet.&lt;/p&gt;</comment>
                            <comment id="12523060" author="dagw" created="Mon, 27 Aug 2007 18:17:31 +0100"  >&lt;p&gt;The patch looks good to me. &lt;/p&gt;

&lt;p&gt;It provides an abstraction for accessing the incoming log records. The&lt;br/&gt;
&apos;data&apos; and &apos;optional data&apos; fields are copied once more before they can be&lt;br/&gt;
accessed by the slave redo.&lt;br/&gt;
This seems unncessary since the lifetime of the objects created is&lt;br/&gt;
shorter than the underlying buffer source (logToScan), but may be&lt;br/&gt;
convenient given the usage intended: One needs to get at a byte[]&lt;br/&gt;
array for the data to be present in the  shape and form as expected&lt;br/&gt;
for the for the reDo step, perhaps? Guessing..&lt;/p&gt;

&lt;p&gt;Nits, pick and choose &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Class level javadoc: Would be good with a @see tag in the reference&lt;br/&gt;
  to point to the class definining the record format, and perhaps omit&lt;br/&gt;
  the reduncancy here?&lt;/li&gt;
	&lt;li&gt;&quot;When a new chunk of log record is to be scanned&quot;&lt;br/&gt;
                                *s&lt;/li&gt;
	&lt;li&gt;form -&amp;gt; from&lt;/li&gt;
	&lt;li&gt;The information on this last read
	&lt;ul&gt;
		&lt;li&gt;in&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;only one thread will be receiving
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;
			&lt;ul&gt;
				&lt;li&gt;
				&lt;ul&gt;
					&lt;li&gt;
					&lt;ul&gt;
						&lt;li&gt;
						&lt;ul&gt;
							&lt;li&gt;
							&lt;ul&gt;
								&lt;li&gt;
								&lt;ul&gt;
									&lt;li&gt;
									&lt;ul&gt;
										&lt;li&gt;per database being replicated ? So&lt;br/&gt;
       ReplicationLogScan is not really a singleton, right?&lt;/li&gt;
									&lt;/ul&gt;
									&lt;/li&gt;
								&lt;/ul&gt;
								&lt;/li&gt;
							&lt;/ul&gt;
							&lt;/li&gt;
						&lt;/ul&gt;
						&lt;/li&gt;
					&lt;/ul&gt;
					&lt;/li&gt;
				&lt;/ul&gt;
				&lt;/li&gt;
			&lt;/ul&gt;
			&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;init(): Missing @param&lt;/li&gt;
	&lt;li&gt;next(): Under &quot;side effect include&quot;: Mention currentPosition,&lt;br/&gt;
  perhaps? Then you can drop &quot;include&quot;.&lt;/li&gt;
	&lt;li&gt;successfull -&amp;gt; successfully&lt;/li&gt;
	&lt;li&gt;// ..In theory,&lt;br/&gt;
  // it should not be possible for currentPosition to be&lt;br/&gt;
  I woudl drop &quot;in theory&quot;, it is an invariant, right?&lt;br/&gt;
  And you do check for it in the get methods.&lt;/li&gt;
	&lt;li&gt;getInstant plus the other getters:&lt;br/&gt;
  &quot;NoSuchElementException&quot; : you could add that this should only&lt;br/&gt;
  happen under wrong usage of this class, perhaps.&lt;/li&gt;
	&lt;li&gt;retrieve methods: I would suggest the wording &quot;increments&lt;br/&gt;
  currentPosition&quot; over the two present wordings (&quot;adds&quot;,&lt;br/&gt;
  &quot;increases&quot;).&lt;/li&gt;
	&lt;li&gt;retreiveBytes: missing @param tags&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Code:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;retrieve methods: sanity messages: suggest blanks around &quot;+&quot;&lt;br/&gt;
  operator for readbility.&lt;/li&gt;
	&lt;li&gt;retrieveLong: deserialization: why use both (long) casting and &quot;&amp;amp;&lt;br/&gt;
  xxL&quot; widening methods? Suggest sticking to explicit cast.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12523183" author="jorgenlo" created="Tue, 28 Aug 2007 09:12:42 +0100"  >&lt;p&gt;Thanks for reviewing the patch, Dag. &lt;/p&gt;

&lt;p&gt;Attaching a new patch, slave_logscan_2, addressing your comments.&lt;/p&gt;

&lt;p&gt;I have fixed all your suggestions except the code change in&lt;br/&gt;
retrieveLong. I tried to change it, but found the code harder to read&lt;br/&gt;
afterwards. Ideally, I would use 0xffL on the first byte as well, but&lt;br/&gt;
that one has to be cast.&lt;/p&gt;

&lt;p&gt;Since the log format description in ReplicationLogScan was changed to&lt;br/&gt;
point to the log buffer package (with a @see tag), I also added a log&lt;br/&gt;
format description to the LogBufferElement.java javadoc.&lt;/p&gt;

&lt;p&gt;&amp;gt;It provides an abstraction for accessing the incoming log records. The&lt;br/&gt;
&amp;gt;&apos;data&apos; and &apos;optional data&apos; fields are copied once more before they can be&lt;br/&gt;
&amp;gt;accessed by the slave redo.&lt;br/&gt;
&amp;gt;This seems unncessary since the lifetime of the objects created is&lt;br/&gt;
&amp;gt;shorter than the underlying buffer source (logToScan), but may be&lt;br/&gt;
&amp;gt;convenient given the usage intended: One needs to get at a byte[]&lt;br/&gt;
&amp;gt;array for the data to be present in the  shape and form as expected&lt;br/&gt;
&amp;gt;for the for the reDo step, perhaps? Guessing..&lt;/p&gt;

&lt;p&gt;I was not explicit about this, but you are absolutely right; the data&lt;br/&gt;
and optionalData byte[] are needed in their original form. They will&lt;br/&gt;
be used as parameters in calls to&lt;br/&gt;
org.apache.derby.impl.store.raw.log.LogToFile#appendLogRecord&lt;/p&gt;</comment>
                            <comment id="12523384" author="dagw" created="Wed, 29 Aug 2007 00:02:00 +0100"  >&lt;p&gt;Committed as svn 570589 on trunk. No errors in regression tests&lt;br/&gt;
modulo known intermittent error store/readlocks.sql.&lt;/p&gt;</comment>
                            <comment id="12523387" author="dagw" created="Wed, 29 Aug 2007 00:04:17 +0100"  >&lt;p&gt;Seems work planned for this issue is complete, so resolving.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12364301" name="slave_logscan_1.diff" size="17469" author="jorgenlo" created="Wed, 22 Aug 2007 12:16:42 +0100"/>
                            <attachment id="12364300" name="slave_logscan_1.stat" size="288" author="jorgenlo" created="Wed, 22 Aug 2007 12:16:42 +0100"/>
                            <attachment id="12364669" name="slave_logscan_2.diff" size="19644" author="jorgenlo" created="Tue, 28 Aug 2007 09:12:42 +0100"/>
                            <attachment id="12364668" name="slave_logscan_2.stat" size="378" author="jorgenlo" created="Tue, 28 Aug 2007 09:12:42 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 27 Aug 2007 17:17:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30697</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0jzb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37055</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>