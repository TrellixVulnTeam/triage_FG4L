<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:32:29 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4313/DERBY-4313.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4313] JDBC.dropUsingDMD() may skip dropping objects</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4313</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;This loop in JDBC.dropUsingDMD() looks broken:&lt;/p&gt;

&lt;p&gt;        // Remove any statements from the list that succeeded.&lt;br/&gt;
		boolean didDrop = false;&lt;br/&gt;
		for (int i = 0; i &amp;lt; results.length; i++)&lt;/p&gt;
		{
			int result = results[i];
			if (result == -3 /* Statement.EXECUTE_FAILED*/)
				hadError = true;
			else if (result == -2/*Statement.SUCCESS_NO_INFO*/)
				didDrop = true;
			else if (result &amp;gt;= 0)
				didDrop = true;
			else
				Assert.fail(&quot;Negative executeBatch status&quot;);
            
            if (didDrop)
                ddl.set(i, null);
		}

&lt;p&gt;It is supposed to check the status of each individual statement executed in a batch, and clear the successful ones from an ArrayList so that only the unsuccessful ones are left.&lt;/p&gt;

&lt;p&gt;However, if one of the statements is reported to have failed, and one of the proceeding statements has been successful, the failed statement will be removed from the ArrayList because didDrop is true. This means that some of the failed statements are not retried later. The statements normally fail because some other object depends on the object being dropped, and they usually succeed when they are retried after the other objects have been dropped. By not retrying, some objects that were supposed to be dropped may be left in the database.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12430781">DERBY-4313</key>
            <summary>JDBC.dropUsingDMD() may skip dropping objects</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Jul 2009 15:01:57 +0100</created>
                <updated>Wed, 22 Jul 2009 20:07:18 +0100</updated>
                            <resolved>Wed, 22 Jul 2009 20:07:18 +0100</resolved>
                                    <version>10.6.1.0</version>
                                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12732537" author="knutanders" created="Fri, 17 Jul 2009 15:10:32 +0100"  >&lt;p&gt;I tested this manually by making dropUsingDMD() public and use it to drop these three tables:&lt;/p&gt;

&lt;p&gt;        s.execute(&quot;create table a(x int)&quot;);&lt;br/&gt;
        s.execute(&quot;create table b(x int primary key)&quot;);&lt;br/&gt;
        s.execute(&quot;create table c(x int references b&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&quot;);&lt;/p&gt;

&lt;p&gt;Using the embedded driver, all the tables were dropped after dropUsingDMD() had returned. Using the client driver, the table B was still there after dropUsingDMD().&lt;/p&gt;

&lt;p&gt;The difference seems to be that the embedded driver stops executing the statements in the batch after the first failure and only returns the status for the succeeding statements, whereas the client driver continues executing statements after the first failure in the batch. I&apos;ll log a separate issue for the difference between client and embedded in handling errors in a batch. Only the bug in dropUsingDMD() will be handled in this issue.&lt;/p&gt;</comment>
                            <comment id="12732549" author="knutanders" created="Fri, 17 Jul 2009 15:38:34 +0100"  >&lt;p&gt;dropUsingDMD.diff fixes the loop by only removing the DDL statement from the ArrayList if it had succeeded, which appears to be the intent of the code judging by the comments. The three tables mentioned in my previous comment were successfully dropped when this patch was applied. I&apos;ll also run suites.All to see if it causes problems for any of the tests.&lt;/p&gt;</comment>
                            <comment id="12732614" author="knutanders" created="Fri, 17 Jul 2009 18:17:22 +0100"  >&lt;p&gt;suites.All ran cleanly with the patch. I haven&apos;t run derbyall since the patch only touches code used by the JUnit tests.&lt;/p&gt;</comment>
                            <comment id="12734252" author="knutanders" created="Wed, 22 Jul 2009 20:07:17 +0100"  >&lt;p&gt;Committed revision 796834.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12413823" name="dropUsingDMD.diff" size="901" author="knutanders" created="Fri, 17 Jul 2009 15:38:34 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24178</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0rzb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38351</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>