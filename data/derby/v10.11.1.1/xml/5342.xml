<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:28:54 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5342/DERBY-5342.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5342] make ScriptTestCase support &quot;ij.showNoCountForSelect&quot; and &quot;ij.showNoConnectionsAtStart&quot;</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5342</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Now, ScriptTestCase doesn&apos;t support property &quot;ij.showNoConnectionsAtStart&quot; (do nothing for it) and &quot;ij.showNoCountForSelect&quot;(it always works as &quot;ij.showNoCountForSelect&quot; = &quot;flase&quot;).&lt;/p&gt;

&lt;p&gt;It will be better if the two properties be supported. To realise this, utilMain.goScript(Connection conn, LocalizedInput in) should be changed. Besides, some subclasses of ScripTestCase will be adapted accordingly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12514437">DERBY-5342</key>
            <summary>make ScriptTestCase support &quot;ij.showNoCountForSelect&quot; and &quot;ij.showNoConnectionsAtStart&quot;</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="houxzhang">Houx Zhang</assignee>
                                    <reporter username="houxzhang">Houx Zhang</reporter>
                        <labels>
                            <label>gsoc2011</label>
                    </labels>
                <created>Mon, 18 Jul 2011 14:17:46 +0100</created>
                <updated>Sun, 7 Apr 2013 18:27:42 +0100</updated>
                            <resolved>Sun, 7 Apr 2013 18:27:42 +0100</resolved>
                                                    <fixVersion>10.8.3.3</fixVersion>
                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13067433" author="bryanpendleton" created="Tue, 19 Jul 2011 02:22:31 +0100"  >&lt;p&gt;Is this project related to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5332&quot; title=&quot;Convert tools/ij3.sql  to junit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5332&quot;&gt;&lt;del&gt;DERBY-5332&lt;/del&gt;&lt;/a&gt;? That is, if this change is made, would we&lt;br/&gt;
be able to put ij3.sql in ToolScripts.java?&lt;/p&gt;</comment>
                            <comment id="13067636" author="houxzhang" created="Tue, 19 Jul 2011 12:39:00 +0100"  >&lt;p&gt;Hi, Bryan.&lt;/p&gt;

&lt;p&gt;This project doesn&apos;t related to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5332&quot; title=&quot;Convert tools/ij3.sql  to junit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5332&quot;&gt;&lt;del&gt;DERBY-5332&lt;/del&gt;&lt;/a&gt;, as in ij3_app.properties, it says:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;ij3 wants to test an alternate path for driver loading&lt;/li&gt;
	&lt;li&gt;from URL setting along&lt;br/&gt;
ij.database=jdbc:derby:wombat;create=true&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;so I think it&apos;s better to make a new subclass of ScriptTestCase than to add it in ToolScripts.&lt;/p&gt;

&lt;p&gt;In fact, this project relates to &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5327&quot; title=&quot;Convert tools/ij5.sql  to junit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5327&quot;&gt;&lt;del&gt;DERBY-5327&lt;/del&gt;&lt;/a&gt;&quot;, in ij5_app.properties, it says:&lt;br/&gt;
ij.showNoConnectionsAtStart=false&lt;br/&gt;
ij.showNoCountForSelect=false&lt;/p&gt;

&lt;p&gt;however, ScriptTestCase doesn&apos;t support this two properties. With the two properties supporting, ij5.sql is fit to add into ToolScripts.&lt;/p&gt;

&lt;p&gt;I have changed utilMain in 5342-1.patch to support the two properties, and tested it well, however, I haven&apos;t yet to change  the test cases affected by it. &lt;/p&gt;

&lt;p&gt;I&apos;m not sure weather you think this project is not neccessary, so I will have a break first and get your advice. Thanks!&lt;/p&gt;</comment>
                            <comment id="13067717" author="bryanpendleton" created="Tue, 19 Jul 2011 14:34:37 +0100"  >&lt;p&gt;Thank you for the clear explanation.&lt;/p&gt;

&lt;p&gt;I think this is a good plan.&lt;/p&gt;

&lt;p&gt;I suggest that you continue working on this project, and on the related ij5 testing work.&lt;/p&gt;

&lt;p&gt;Meanwhile, I will move ahead with the ij3-related patches in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5332&quot; title=&quot;Convert tools/ij3.sql  to junit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5332&quot;&gt;&lt;del&gt;DERBY-5332&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13068308" author="houxzhang" created="Wed, 20 Jul 2011 13:04:20 +0100"  >&lt;p&gt;Thanks for your encouragement, I will go on.&lt;/p&gt;</comment>
                            <comment id="13068384" author="houxzhang" created="Wed, 20 Jul 2011 14:56:48 +0100"  >&lt;p&gt;In 5342-2.patch, utilMain.goScript() has been changed to support &quot;ij.ShowNoCountForSelect&quot; and &quot;ij.showNoConnectionsAtStart&quot;. Besides, ScriptTestCase is changed:&lt;/p&gt;

&lt;p&gt;         super(script, outputEnc);&lt;br/&gt;
+        BaseTestCase.setSystemProperty(&quot;ij.showNoConnectionsAtStart&quot;, &quot;true&quot;);&lt;br/&gt;
+        BaseTestCase.setSystemProperty(&quot;ij.showNoCountForSelect&quot;, &quot;true&quot;);&lt;/p&gt;

&lt;p&gt;         inputEncoding = (inputEnc == null) ? DEFAULT_ENCODING : inputEnc;&lt;/p&gt;

&lt;p&gt;two properties are set to true to fit the current state of ScrtipTestCase.&lt;/p&gt;

&lt;p&gt;With the patch, tools._Suite can pass OK, and other classes affected are tested.&lt;/p&gt;

&lt;p&gt;Please check it, thanks!&lt;/p&gt;</comment>
                            <comment id="13068989" author="bryanpendleton" created="Thu, 21 Jul 2011 15:09:56 +0100"  >&lt;p&gt;I don&apos;t understand what this new line in utilMain.goscript() is intending:&lt;/p&gt;

&lt;p&gt;+        ijParser.(connEnv&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, (numConnections &amp;gt; 1));&lt;/p&gt;

&lt;p&gt;Is that possibly a typographical error in patch-2? It looks like it is incomplete, to me.&lt;/p&gt;

&lt;p&gt;When I remove that line, the patch builds cleanly for me, and tools._Suite passes&lt;br/&gt;
for me as well.&lt;/p&gt;</comment>
                            <comment id="13069529" author="houxzhang" created="Fri, 22 Jul 2011 13:52:55 +0100"  >&lt;p&gt;Hi, Bryan.&lt;/p&gt;

&lt;p&gt;I&apos;m sorry for this typographical error.&lt;/p&gt;

&lt;p&gt;It should be &lt;br/&gt;
+        ijParser.setConnection(connEnv&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, (numConnections &amp;gt; 1));&lt;br/&gt;
just like used in utilMain.go().&lt;/p&gt;

&lt;p&gt;Please check the new patch, thanks!&lt;/p&gt;</comment>
                            <comment id="13069879" author="bryanpendleton" created="Sat, 23 Jul 2011 02:40:18 +0100"  >&lt;p&gt;When I run the complete JUnit test suite with the patch applied, I see three failures.&lt;/p&gt;

&lt;p&gt;I&apos;ve pasted the information below.&lt;/p&gt;

&lt;p&gt;There were 3 failures:&lt;br/&gt;
1) LocalizedConnectionAttribute(org.apache.derbyTesting.functionTests.tests.i18n.LocalizedAttributeScriptTest)junit.framework.ComparisonFailure: Output at line 1 expected:&amp;lt;ij&amp;gt; --&amp;gt; but was:&amp;lt;CONNECTION0* - 	jdbc:derby:singleUse/oneuse55&amp;gt;&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.util.CanonTestCase.compareCanon(CanonTestCase.java:109)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.util.ScriptTestCase.runTest(ScriptTestCase.java:205)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
2) LocalizedDisplay(org.apache.derbyTesting.functionTests.tests.i18n.LocalizedDisplayScriptTest)junit.framework.ComparisonFailure: Output at line 1 expected:&amp;lt;ij&amp;gt; --&amp;gt; but was:&amp;lt;CONNECTION0* - 	jdbc:derby:singleUse/oneuse56&amp;gt;&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.util.CanonTestCase.compareCanon(CanonTestCase.java:109)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.util.ScriptTestCase.runTest(ScriptTestCase.java:205)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
3) LocalizedDisplay(org.apache.derbyTesting.functionTests.tests.i18n.LocalizedDisplayScriptTest)junit.framework.ComparisonFailure: Output at line 1 expected:&amp;lt;ij&amp;gt; --&amp;gt; but was:&amp;lt;CONNECTION0* - 	jdbc:derby://localhost:1527/singleUse/oneuse57;create=true&amp;gt;&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.util.CanonTestCase.compareCanon(CanonTestCase.java:109)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.util.ScriptTestCase.runTest(ScriptTestCase.java:205)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;br/&gt;
Tests run: 14216,  Failures: 3,  Errors: 0&lt;/p&gt;</comment>
                            <comment id="13070468" author="houxzhang" created="Mon, 25 Jul 2011 13:42:14 +0100"  >&lt;p&gt;When tested individually, each of them is OK. It&apos;s also OK when tested org.apache.derbyTesting.functionTests.tests.i18n._Suite. I will run the completed test to see the problem.&lt;/p&gt;</comment>
                            <comment id="13070882" author="bryanpendleton" created="Tue, 26 Jul 2011 01:57:51 +0100"  >&lt;p&gt;For me, too, the individual tests run correctly, and I also see no problems when &lt;br/&gt;
just running i18n suite and tools suite.&lt;/p&gt;

&lt;p&gt;It is possible that there is some sort of underlying resource or capacity problem &lt;br/&gt;
on the machine I am using for Derby development; it is a very under-powered computer...&lt;/p&gt;

&lt;p&gt;Please let me know the outcome of your experiment.&lt;/p&gt;

&lt;p&gt;Assuming the tests run properly, I think the patch is good and ready to commit.&lt;/p&gt;</comment>
                            <comment id="13071071" author="houxzhang" created="Tue, 26 Jul 2011 13:50:18 +0100"  >&lt;p&gt;Hi, Bryan, I have located the problem, but didn&apos;t know how to resolve it.&lt;/p&gt;

&lt;p&gt;In a complete testing, LocalizedAttributeScriptTest and LocalizedDisplayScriptTest failed because of IjConnNameTest. I have added the two tests into tools._Suite.suite() to  make the failures reoccur fast.&lt;/p&gt;

&lt;p&gt;As shown in 5342-4-test.patch, after IjConnNameTest ran, LocalizedAttributeScriptTest and LocalizedDisplayScriptTest   failed just because util.getSystemProperty(&quot;ij.showNoConnectionsAtStart&quot;)  is false in utilMain.goScript(). &lt;/p&gt;

&lt;p&gt;Besides, with the patch below, everything runs well:&lt;/p&gt;

&lt;p&gt;Index: java/testing/org/apache/derbyTesting/functionTests/tests/i18n/LocalizedAttributeScriptTest.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; java/testing/org/apache/derbyTesting/functionTests/tests/i18n/LocalizedAttributeScriptTest.java	(revision 1149133)&lt;br/&gt;
+++ java/testing/org/apache/derbyTesting/functionTests/tests/i18n/LocalizedAttributeScriptTest.java	(working copy)&lt;br/&gt;
@@ -106,6 +106,8 @@&lt;/p&gt;

&lt;p&gt;         uiProps.put(&quot;derby.ui.locale&quot;,&quot;de_DE&quot;);&lt;br/&gt;
         uiProps.put(&quot;derby.ui.codeset&quot;,&quot;ISO-8859-1&quot;);&lt;br/&gt;
+        uiProps.put(&quot;ij.showNoConnectionsAtStart&quot;, &quot;true&quot;);&lt;br/&gt;
+        uiProps.put(&quot;ij.showNoCountForSelect&quot;, &quot;true&quot;);&lt;br/&gt;
         suite.addTest(new SystemPropertyTestSetup(&lt;br/&gt;
                 new LocalizedAttributeScriptTest(&quot;LocalizedConnectionAttribute&quot;), uiProps));&lt;/p&gt;

&lt;p&gt;Index: java/testing/org/apache/derbyTesting/functionTests/tests/i18n/LocalizedDisplayScriptTest.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; java/testing/org/apache/derbyTesting/functionTests/tests/i18n/LocalizedDisplayScriptTest.java	(revision 1149133)&lt;br/&gt;
+++ java/testing/org/apache/derbyTesting/functionTests/tests/i18n/LocalizedDisplayScriptTest.java	(working copy)&lt;br/&gt;
@@ -110,6 +110,8 @@&lt;br/&gt;
         Properties uiProps = new Properties();&lt;br/&gt;
         uiProps.put(&quot;derby.ui.locale&quot;,&quot;es_AR&quot;);&lt;br/&gt;
         uiProps.put(&quot;derby.ui.codeset&quot;,&quot;EUC_JP&quot;);&lt;br/&gt;
+        uiProps.put(&quot;ij.showNoConnectionsAtStart&quot;, &quot;true&quot;);&lt;br/&gt;
+        uiProps.put(&quot;ij.showNoCountForSelect&quot;, &quot;true&quot;);&lt;br/&gt;
         suite.addTest(new SystemPropertyTestSetup(&lt;br/&gt;
                 new LocalizedDisplayScriptTest(&quot;LocalizedDisplay&quot;), uiProps));&lt;br/&gt;
         return getIJConfig(suite);&lt;/p&gt;

&lt;p&gt;However, I think this is not the right way to the problem.&lt;/p&gt;

&lt;p&gt;Now, I&apos;m strange with why the two properties has been changed after IjConnNameTest ran.&lt;/p&gt;</comment>
                            <comment id="13071092" author="bryanpendleton" created="Tue, 26 Jul 2011 14:32:46 +0100"  >&lt;p&gt;Yes, if I modify tools._Suite.java so that it contains just:&lt;br/&gt;
1) IjConnNameTest&lt;br/&gt;
2) LocalizedAttributeScriptTest&lt;br/&gt;
3) LocalizedDisplayScriptTest&lt;/p&gt;

&lt;p&gt;then the failure reproduces easily for me. Thank you for this suggestion,&lt;br/&gt;
it should make it easier to study this problem.&lt;/p&gt;</comment>
                            <comment id="13071121" author="bryanpendleton" created="Tue, 26 Jul 2011 15:33:27 +0100"  >&lt;p&gt;Perhaps the code in ScriptTestCase.java which sets the ij properties should be moved&lt;br/&gt;
from the ScriptTestCase constructor to ScriptTestCase.setUp()?&lt;/p&gt;

&lt;p&gt;I.e., something like:&lt;/p&gt;

&lt;p&gt;Index: java/testing/org/apache/derbyTesting/functionTests/util/ScriptTestCase.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; java/testing/org/apache/derbyTesting/functionTests/util/ScriptTestCase.java	(revision 1149636)&lt;br/&gt;
+++ java/testing/org/apache/derbyTesting/functionTests/util/ScriptTestCase.java	(working copy)&lt;br/&gt;
@@ -26,6 +26,7 @@&lt;br/&gt;
 import java.util.Locale;&lt;/p&gt;

&lt;p&gt; import org.apache.derby.iapi.tools.i18n.LocalizedResource;&lt;br/&gt;
+import org.apache.derbyTesting.junit.BaseTestCase;&lt;br/&gt;
 import org.apache.derbyTesting.junit.Derby;&lt;/p&gt;

&lt;p&gt; import junit.framework.Test;&lt;br/&gt;
@@ -215,6 +216,9 @@&lt;br/&gt;
             }&lt;br/&gt;
         });&lt;/p&gt;

&lt;p&gt;+        BaseTestCase.setSystemProperty(&quot;ij.showNoConnectionsAtStart&quot;, &quot;true&quot;);&lt;br/&gt;
+        BaseTestCase.setSystemProperty(&quot;ij.showNoCountForSelect&quot;, &quot;true&quot;);&lt;br/&gt;
+&lt;br/&gt;
         // Reset IJ&apos;s locale to allow it to pick up the new locale from&lt;br/&gt;
         // the environment.&lt;br/&gt;
         LocalizedResource.resetLocalizedResourceCache();&lt;/p&gt;
</comment>
                            <comment id="13071470" author="bryanpendleton" created="Wed, 27 Jul 2011 02:18:21 +0100"  >&lt;p&gt;The reason why I think moving those calls is appropriate is because the ScriptTestCase constructor&lt;br/&gt;
gets run when the entire test Suite is initially constructed, whereas the setUp() method gets run&lt;br/&gt;
right before each individual test case. Since ScriptTestCase wants those properties to be&lt;br/&gt;
initialized to true for each test case, it is better to do that in setUp() I think.&lt;/p&gt;

&lt;p&gt;However we still need to figure out how individual test cases which extend ScriptTestCase&lt;br/&gt;
can arrange to have their own values for those properties.&lt;/p&gt;
</comment>
                            <comment id="13071691" author="houxzhang" created="Wed, 27 Jul 2011 13:43:45 +0100"  >&lt;p&gt;Yes, Bryan. I agree that it&apos;s better to add the properties setting into the constructor of ScriptTestCase. It works well just like in 5342-5.patch. Please check it.&lt;/p&gt;

&lt;p&gt;As to why IjConnNameTest affected other tests, I think it has been resolved in the new patch.&lt;/p&gt;</comment>
                            <comment id="13072120" author="bryanpendleton" created="Thu, 28 Jul 2011 01:31:32 +0100"  >&lt;p&gt;My revised testing was clean. I think this patch is ready to go,&lt;br/&gt;
so I committed it to the trunk as revision 1151691.&lt;/p&gt;</comment>
                            <comment id="13072348" author="houxzhang" created="Thu, 28 Jul 2011 14:41:53 +0100"  >&lt;p&gt;Thanks, Bryan.&lt;/p&gt;</comment>
                            <comment id="13072377" author="houxzhang" created="Thu, 28 Jul 2011 15:35:17 +0100"  >&lt;p&gt;I&apos;m sorry to reopen this issue, as in my working on ij5.sql, I&apos;ve found the patch can not work well. &lt;/p&gt;

&lt;p&gt;I will show the failure in the next patch.&lt;/p&gt;</comment>
                            <comment id="13072382" author="houxzhang" created="Thu, 28 Jul 2011 15:44:54 +0100"  >&lt;p&gt;In 5342-6-testing.patch, ij3Test sets &quot;ij.showNoConnectionsAtStart&quot; to false, &lt;/p&gt;

&lt;p&gt;props.setProperty(&quot;ij.showNoConnectionsAtStart&quot;, &quot;false&quot;);&lt;/p&gt;

&lt;p&gt;but the test still passes, which is not expected. Furthermore, &lt;br/&gt;
utilMain.goScript() show the property is still true.&lt;/p&gt;

&lt;p&gt;This is because ScriptTestcase.setUp() run after SystemPropertySetUp.setUp(), so the two properties setted in SystemPropertySetUp.setUp() will be covered.&lt;/p&gt;

&lt;p&gt;Now, let&apos;s return to 5342-3.patch, and to focus on why LocalizedAttributeScriptTest and LocalizedDisplayScriptTest  are affected by ijConNameTest.&lt;/p&gt;


</comment>
                            <comment id="13072406" author="houxzhang" created="Thu, 28 Jul 2011 17:00:21 +0100"  >&lt;p&gt;Oh, I have found the key to resolve this problem, and will post the reason and attach a new patch  tomorrow.&lt;/p&gt;</comment>
                            <comment id="13072612" author="bryanpendleton" created="Fri, 29 Jul 2011 00:56:53 +0100"  >&lt;p&gt;Perhaps the code in ScriptTestCase.setUp() should be conditional, something like:&lt;/p&gt;

&lt;p&gt;    if( getproperty(&quot;ij.showNoConnectionsAtStart&quot;) == null)&lt;br/&gt;
        setProperty(&quot;ij.showNoConnectionsAtStart&quot;, true);&lt;/p&gt;

&lt;p&gt;Then the setProperty calls wouldn&apos;t run in the ij3Test case.&lt;/p&gt;</comment>
                            <comment id="13072799" author="houxzhang" created="Fri, 29 Jul 2011 13:54:19 +0100"  >&lt;p&gt;I have posted 5342-7-test.patch to show the problem.&lt;/p&gt;

&lt;p&gt;When run tools._Suite, I&apos;ve got the log below:&lt;br/&gt;
---&lt;del&gt;sys.setup&lt;/del&gt;------------showNoCountForSelect=true&lt;br/&gt;
---------&lt;del&gt;script.setup()&lt;/del&gt;------showNoCountForSelect=true&lt;br/&gt;
showNoCountForSelect=true&lt;br/&gt;
---------&lt;del&gt;script.teardown()&lt;/del&gt;------showNoCountForSelect=true&lt;br/&gt;
---&lt;del&gt;sys.teardown&lt;/del&gt;------------showNoCountForSelect=true&lt;br/&gt;
---&lt;del&gt;sys.teardown&lt;/del&gt;------------showNoCountForSelect=null&lt;br/&gt;
---&lt;del&gt;sys.teardown&lt;/del&gt;------------showNoCountForSelect=null&lt;br/&gt;
---&lt;del&gt;sys.teardown&lt;/del&gt;------------showNoCountForSelect=null&lt;/p&gt;

&lt;p&gt;---&lt;del&gt;sys.setup&lt;/del&gt;------------showNoCountForSelect=null&lt;br/&gt;
---------&lt;del&gt;script.setup()&lt;/del&gt;------showNoCountForSelect=null&lt;br/&gt;
showNoCountForSelect=false&lt;br/&gt;
---------&lt;del&gt;script.teardown()&lt;/del&gt;------showNoCountForSelect=null&lt;br/&gt;
---&lt;del&gt;sys.teardown&lt;/del&gt;------------showNoCountForSelect=null&lt;br/&gt;
---&lt;del&gt;sys.teardown&lt;/del&gt;------------showNoCountForSelect=null&lt;br/&gt;
---&lt;del&gt;sys.teardown&lt;/del&gt;------------showNoCountForSelect=null&lt;br/&gt;
---&lt;del&gt;sys.teardown&lt;/del&gt;------------showNoCountForSelect=null&lt;/p&gt;

&lt;p&gt;---&lt;del&gt;sys.setup&lt;/del&gt;------------showNoCountForSelect=null&lt;br/&gt;
---------&lt;del&gt;script.setup()&lt;/del&gt;------showNoCountForSelect=null&lt;br/&gt;
showNoCountForSelect=false&lt;br/&gt;
---------&lt;del&gt;script.teardown()&lt;/del&gt;------showNoCountForSelect=null&lt;br/&gt;
---&lt;del&gt;sys.teardown&lt;/del&gt;------------showNoCountForSelect=null&lt;br/&gt;
---&lt;del&gt;sys.teardown&lt;/del&gt;------------showNoCountForSelect=null&lt;br/&gt;
---&lt;del&gt;sys.teardown&lt;/del&gt;------------showNoCountForSelect=null&lt;br/&gt;
---&lt;del&gt;sys.teardown&lt;/del&gt;------------showNoCountForSelect=null&lt;/p&gt;

&lt;p&gt;---&lt;del&gt;sys.setup&lt;/del&gt;------------showNoCountForSelect=null&lt;br/&gt;
---------&lt;del&gt;script.setup()&lt;/del&gt;------showNoCountForSelect=null&lt;br/&gt;
showNoCountForSelect=false&lt;br/&gt;
---------&lt;del&gt;script.teardown()&lt;/del&gt;------showNoCountForSelect=null&lt;br/&gt;
---&lt;del&gt;sys.teardown&lt;/del&gt;------------showNoCountForSelect=null&lt;br/&gt;
---&lt;del&gt;sys.teardown&lt;/del&gt;------------showNoCountForSelect=null&lt;br/&gt;
---&lt;del&gt;sys.teardown&lt;/del&gt;------------showNoCountForSelect=null&lt;br/&gt;
---&lt;del&gt;sys.teardown&lt;/del&gt;------------showNoCountForSelect=null&lt;/p&gt;


&lt;p&gt;We can see that, after run IjConnNameTest, &quot;ij.showNoCountForSelect&quot; is set to null. In fact, it&apos;s removed in SystemPropertyTestSetup.tearDown(). This hits a bug in SystemPropertyTestSetup. In SystemPropertyTestSetup.setUp() setProperties() is called, a property won&apos;t be added into oldValues if the old value equals the new one, so the property will be removed in tearDown() later. &lt;/p&gt;

&lt;p&gt;With 5342-8.patch, everything is OK, please check it, thanks!&lt;/p&gt;</comment>
                            <comment id="13073016" author="bryanpendleton" created="Fri, 29 Jul 2011 21:55:58 +0100"  >&lt;p&gt;Your analysis makes sense to me. I tried the trick of putting the i18n tests at the end of tools.Suite and&lt;br/&gt;
the tests still passed. And I ran the full test suite successfully.&lt;/p&gt;

&lt;p&gt;So I committed patch 8 to the trunk as revision 1152371.&lt;/p&gt;

&lt;p&gt;Thank you for following up on this to improve the behavior!&lt;/p&gt;</comment>
                            <comment id="13073523" author="houxzhang" created="Mon, 1 Aug 2011 14:09:46 +0100"  >&lt;p&gt;Thanks for your encourage and for your advices on my working.&lt;/p&gt;

&lt;p&gt;And what do you think about resolve this issue, pleas? &lt;/p&gt;</comment>
                            <comment id="13073553" author="bryanpendleton" created="Mon, 1 Aug 2011 15:24:34 +0100"  >&lt;p&gt;Yes, I think we can resolve this issue; I think you have the right Jira privileges to do that, right?&lt;/p&gt;</comment>
                            <comment id="13076149" author="houxzhang" created="Tue, 2 Aug 2011 13:03:34 +0100"  >&lt;p&gt;Yes, Bryan, I will close it!&lt;/p&gt;</comment>
                            <comment id="13624973" author="kmarsden" created="Sun, 7 Apr 2013 18:27:05 +0100"  >&lt;p&gt;reopen to change fix version&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12486995" name="5342-1.patch" size="2895" author="houxzhang" created="Tue, 19 Jul 2011 12:39:00 +0100"/>
                            <attachment id="12487153" name="5342-2.patch" size="3824" author="houxzhang" created="Wed, 20 Jul 2011 14:56:48 +0100"/>
                            <attachment id="12487154" name="5342-2.stat" size="148" author="houxzhang" created="Wed, 20 Jul 2011 14:56:48 +0100"/>
                            <attachment id="12487430" name="5342-3.patch" size="3880" author="houxzhang" created="Fri, 22 Jul 2011 13:52:55 +0100"/>
                            <attachment id="12487431" name="5342-3.stat" size="148" author="houxzhang" created="Fri, 22 Jul 2011 13:52:55 +0100"/>
                            <attachment id="12487822" name="5342-4-test.patch" size="5902" author="houxzhang" created="Tue, 26 Jul 2011 13:50:18 +0100"/>
                            <attachment id="12487970" name="5342-5.patch" size="3861" author="houxzhang" created="Wed, 27 Jul 2011 13:43:45 +0100"/>
                            <attachment id="12487971" name="5342-5.stat" size="148" author="houxzhang" created="Wed, 27 Jul 2011 13:43:45 +0100"/>
                            <attachment id="12488109" name="5342-6-testing.patch" size="1781" author="houxzhang" created="Thu, 28 Jul 2011 15:44:54 +0100"/>
                            <attachment id="12488202" name="5342-7-test.patch" size="7326" author="houxzhang" created="Fri, 29 Jul 2011 13:54:19 +0100"/>
                            <attachment id="12488203" name="5342-8.patch" size="1889" author="houxzhang" created="Fri, 29 Jul 2011 13:54:19 +0100"/>
                            <attachment id="12488204" name="5342-8.stat" size="164" author="houxzhang" created="Fri, 29 Jul 2011 13:54:19 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 19 Jul 2011 01:22:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31608</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0fkf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36340</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>