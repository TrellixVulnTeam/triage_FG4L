<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:25:59 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1454/DERBY-1454.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1454] DRDA Protocol Exception when DSS is exactly 32767 in length</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1454</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The server is disconnecting the client connection.  Client is sending a CNTQRY, the server is receiving it &lt;br/&gt;
and then server disconnects the client.   When I start the server, after a while, I see the message&lt;br/&gt;
agentThread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_4,5,main&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;Further debugging, this message gets printed out  because of the agentError that is thrown in splitQRYDTA.&lt;/p&gt;

&lt;p&gt;The error seems to come from this part of the code  in splitQRYDTA,  It hits the temp.length==0 case.&lt;/p&gt;

&lt;p&gt;   private void splitQRYDTA(DRDAStatement stmt, int blksize) throws SQLException,&lt;br/&gt;
           DRDAProtocolException&lt;/p&gt;
   {
       // make copy of extra data
       byte [] temp = writer.copyDSSDataToEnd(blksize);
       // truncate to end of blocksize
       writer.truncateDSS(blksize);
       if (temp.length == 0)
           agentError(&quot;LMTBLKPRC violation: splitQRYDTA was &quot; +
               &quot;called to split a QRYDTA block, but the &quot; +
               &quot;entire row fit successfully into the &quot; +
               &quot;current block. Server rowsize computation &quot; +
               &quot;was probably incorrect (perhaps an off-by-&quot; +
               &quot;one bug?). QRYDTA blocksize: &quot; + blksize);
       stmt.setSplitQRYDTA(temp);
   }
&lt;p&gt;  In doneData and writeFDODTA, it looks like if (writer.getDSSLength() &amp;gt;= blksize)  , then the splitQRYDTA &lt;br/&gt;
is called. From testing, it seems like they are hitting an edge case, where the writer.getDSSLength() &lt;br/&gt;
is equal to blksize and this DSS is the only dss in the send buffer. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12344903">DERBY-1454</key>
            <summary>DRDA Protocol Exception when DSS is exactly 32767 in length</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="30720">DERBY-170</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="bryanpendleton">Bryan Pendleton</reporter>
                        <labels>
                    </labels>
                <created>Sun, 25 Jun 2006 01:54:08 +0100</created>
                <updated>Tue, 30 Jun 2009 17:12:52 +0100</updated>
                            <resolved>Mon, 26 Jun 2006 01:17:28 +0100</resolved>
                                    <version>10.1.3.1</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.1.3.1</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12417642" author="bryanpendleton" created="Sun, 25 Jun 2006 01:55:20 +0100"  >&lt;p&gt;Attached as &apos;newBug.java&apos; is a simple repro program that you can run to demonstrate the&lt;br/&gt;
bug for yourself. Compile it, then start up the Network Server and&lt;br/&gt;
run the program with &quot;java newBug 12749&quot;. That exact length for column&lt;br/&gt;
&quot;c2&quot; will trigger the edge case you&apos;ve found.&lt;/p&gt;</comment>
                            <comment id="12417644" author="bryanpendleton" created="Sun, 25 Jun 2006 02:17:50 +0100"  >&lt;p&gt;Attached &apos;derby-1454.diff&apos; is a proposed patch for this issue.&lt;/p&gt;

&lt;p&gt;The patch corrects the two splitQRYDTA calls to use &amp;gt; rather&lt;br/&gt;
than &amp;gt;= to determine if the DSS needs to be split.&lt;/p&gt;

&lt;p&gt;The patch also contains a new test case in derbynet/prepStmt.java&lt;br/&gt;
to demonstrate the bug and its fix.&lt;/p&gt;

&lt;p&gt;Please review. Thanks!&lt;/p&gt;</comment>
                            <comment id="12417646" author="bryanpendleton" created="Sun, 25 Jun 2006 02:48:51 +0100"  >&lt;p&gt;I didn&apos;t mark this a regression and I don&apos;t think it is. The erroneous &amp;gt;= has&lt;br/&gt;
been in the code for a while, and was not introduced by recent fixes.&lt;/p&gt;

&lt;p&gt;However, recent fixes (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-614&quot; title=&quot;Execution failed because of a Distributed Protocol Error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-614&quot;&gt;&lt;del&gt;DERBY-614&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-170&quot; title=&quot;Inserting large string value into non-existent table causes communication link failure over Network Server.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-170&quot;&gt;&lt;del&gt;DERBY-170&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-491&quot; title=&quot;Protocol exception when Network Server tries to return ~32K of data or greater in a result set for a Java stored procedure.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-491&quot;&gt;&lt;del&gt;DERBY-491&lt;/del&gt;&lt;/a&gt;) are indeed&lt;br/&gt;
relevant since before those changes we could not see this bug; we would&lt;br/&gt;
have encountered one of the other bugs instead first.&lt;/p&gt;</comment>
                            <comment id="12417647" author="skambha" created="Sun, 25 Jun 2006 03:28:39 +0100"  >&lt;p&gt;Thanks much Bryan for posting the patch.  The changes look good to me.  I successfully applied the derby-1454.diff patch on the trunk. I ran the test derbynet/prepStmt with both derbynet and derbynetclient frameworks and test passes with fix  and fails without the fix, with a disconnect exception.  Thanks for adding such good comments to the testcase. &lt;/p&gt;

&lt;p&gt;+1 for commit.   &lt;/p&gt;

&lt;p&gt;I agree with you, that this is not a regression.  &lt;/p&gt;

&lt;p&gt;Thanks.&lt;br/&gt;
Sunitha.&lt;/p&gt;</comment>
                            <comment id="12417650" author="bryanpendleton" created="Sun, 25 Jun 2006 04:54:40 +0100"  >&lt;p&gt;Thank you Sunitha for the quick review.&lt;/p&gt;

&lt;p&gt;derbyall ran clean for me, so I am committing this fix. SVN revision 416959.&lt;/p&gt;</comment>
                            <comment id="12417687" author="bryanpendleton" created="Mon, 26 Jun 2006 01:15:56 +0100"  >&lt;p&gt;Merged fix to 10.1. Reopening to mark fixin fields properly.&lt;/p&gt;</comment>
                            <comment id="12417688" author="bryanpendleton" created="Mon, 26 Jun 2006 01:17:28 +0100"  >&lt;p&gt;Merged trunk revision 416959 to 10.1 branch and committed&lt;br/&gt;
to subversion as revision 417032.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12335869" name="derby-1454.diff" size="5922" author="bryanpendleton" created="Sun, 25 Jun 2006 02:17:50 +0100"/>
                            <attachment id="12335868" name="newBug.java" size="1501" author="bryanpendleton" created="Sun, 25 Jun 2006 01:55:20 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 25 Jun 2006 02:28:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29998</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10101"><![CDATA[Release Note Needed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ugf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38752</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>