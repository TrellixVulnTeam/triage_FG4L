<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:50:42 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2800/DERBY-2800.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2800] Implement Clob.truncate for embedded driver</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2800</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description></description>
                <environment></environment>
        <key id="12371406">DERBY-2800</key>
            <summary>Implement Clob.truncate for embedded driver</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12343409">DERBY-1341</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anurag">Anurag Shekhar</assignee>
                                    <reporter username="anurag">Anurag Shekhar</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Jun 2007 18:11:15 +0100</created>
                <updated>Fri, 15 Jun 2007 13:28:53 +0100</updated>
                            <resolved>Tue, 12 Jun 2007 08:21:35 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12503489" author="anurag" created="Mon, 11 Jun 2007 18:30:15 +0100"  >&lt;p&gt;ClobStreamControl provides most the the method required to implement Clob.truncate. This patch does implements a few new methods for efficiency.&lt;/p&gt;

&lt;p&gt;File Modified&lt;/p&gt;

&lt;p&gt;java/engine/org/apache/derby/impl/jdbc/EmbedClob.java&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;makeWritableClobClone (long length)&lt;br/&gt;
   This is a  new overload  of  makeWritableClobClone. This method is to avoid copying entire StoreStreamClob to ClobStreamControl and then performing truncate on it. This methods calls out the similar new method &lt;br/&gt;
ClobStreamControl.cloneClobContent to copy specified number of char to the new InternalClob.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;truncate (long len)&lt;br/&gt;
  Removed notImplimented Exception. Calling makeWritableClobClone in case of StoreStreamClob and InternalClob.truncate in case of writable clob.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;java/engine/org/apache/derby/impl/jdbc/ClobStreamControl.java&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;copyClobContent(InternalClob clob, long length)&lt;br/&gt;
   This is a new method which creates a new Internal copy with only part of the clob. It copies length chars to the new InternalClob&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;cloneClobContent(String dbName,&lt;br/&gt;
                                         ConnectionChild conChild,&lt;br/&gt;
                                         InternalClob clob,&lt;br/&gt;
                                         long length)&lt;br/&gt;
This new overload calls out new copyClobContent to make a clone with only part of the clob data.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;*truncate (long)&lt;br/&gt;
  This method had a small bug. It was treating the parameter as byte length but the doc says its char length. Added code to convert it into byte length.&lt;/p&gt;

&lt;p&gt;java/engine/org/apache/derby/impl/jdbc/LOBStreamControl.java&lt;/p&gt;

&lt;p&gt;*copyData (InputStream, long)&lt;br/&gt;
Modified to take care of stream.read when the read bytes are lesser than number bytes asked for.&lt;br/&gt;
java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/ClobTruncateTest.java&lt;/p&gt;

&lt;p&gt;Added a new test suite to test Clob.truncate. Right now its enabled for embedded driver only as the length chaching on network client causes length check to fail after truncate.&lt;br/&gt;
java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/_Suite.java&lt;/p&gt;

&lt;p&gt;added entry for java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/ClobTruncateTest.java&lt;/p&gt;





</comment>
                            <comment id="12503682" author="kristwaa" created="Tue, 12 Jun 2007 00:41:15 +0100"  >&lt;p&gt;Had a look at the patch, and it looks very good. I have two comments:&lt;br/&gt;
 1) In ClobStreamControl.truncate, the wrong length is used for the check to reset the position cache. The byte position is compared to the char position in the cache object. I think &apos;length&apos; should be renamed to &apos;byteLength&apos; and &apos;newLength&apos; possibly to &apos;newCharLength&apos;. Thanks for fixing the existing bug in there.&lt;/p&gt;

&lt;p&gt; 2) ClobStreamControl.copyClobContent(InternalClob,long) should use more verbose variable names, like &apos;charLength&apos; and &apos;byteLength&apos;. The same could be done for the static method, even if there is only one length variable there.&lt;/p&gt;

&lt;p&gt; 3) The test has some spelling errors and unused imports.&lt;/p&gt;

&lt;p&gt;I plan to add some more tests (I made some notes in the new jdbcapi/ClobTest), and I think adding them to a separate class as you have is a nice idea to keep the size of the test classes down.&lt;/p&gt;


&lt;p&gt;thanks,&lt;/p&gt;</comment>
                            <comment id="12503727" author="anurag" created="Tue, 12 Jun 2007 06:31:29 +0100"  >&lt;p&gt;Thanks for the review&lt;/p&gt;

&lt;p&gt; 1) In ClobStreamControl.truncate, the wrong length is used for the check to reset the position cache. The byte position is compared to the char position in the cache object. I think &apos;length&apos; should be renamed to &apos;byteLength&apos; and &apos;newLength&apos; possibly to &apos;newCharLength&apos;. Thanks for fixing the existing bug in there.&lt;/p&gt;

&lt;p&gt;fixed the issue and changed the variable names&lt;/p&gt;

&lt;p&gt; 2) ClobStreamControl.copyClobContent(InternalClob,long) should use more verbose variable names, like &apos;charLength&apos; and &apos;byteLength&apos;. The same could be done for the static method, even if there is only one length variable there.&lt;/p&gt;

&lt;p&gt;changed variable names&lt;/p&gt;

&lt;p&gt; 3) The test has some spelling errors and unused imports.&lt;/p&gt;

&lt;p&gt;fixed typos and imports&lt;/p&gt;

&lt;p&gt;I plan to add some more tests (I made some notes in the new jdbcapi/ClobTest), and I think adding them to a separate class as you have is a nice idea to keep the size of the test classes down. &lt;/p&gt;</comment>
                            <comment id="12503763" author="kristwaa" created="Tue, 12 Jun 2007 08:21:34 +0100"  >&lt;p&gt;Thanks for the updated patch Anurag.&lt;/p&gt;

&lt;p&gt;Committed &apos;derby-2800v2.diff&apos; to trunk with revision 546404.&lt;br/&gt;
Run suites.All without failures (Java 1.5), running derbyall again for v2.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12359437" name="derby-2800.diff" size="11381" author="anurag" created="Mon, 11 Jun 2007 18:30:15 +0100"/>
                            <attachment id="12359464" name="derby-2800v2.diff" size="11786" author="anurag" created="Tue, 12 Jun 2007 06:31:28 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 Jun 2007 23:41:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30603</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy11vj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39954</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>