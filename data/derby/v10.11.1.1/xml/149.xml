<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:17:49 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-149/DERBY-149.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-149] Server hang when invalid string is bound to datetime columns.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-149</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When running against Derby Network Server with the JCC driver, attempts to bind an invalid date/time string to a date/time/timestamp parameter lead to a hang in either the JCC client or in the Network Server (not sure which).&lt;/p&gt;

&lt;p&gt;The problem does NOT occur if the same thing is run against a DB2 server, which suggests the bug is in Network Server, not in the JCC driver.  That said, though, the problem also does NOT happen if one uses an ODBC client to connect to Network Server, instead of a JDBC client--so perhaps it&apos;s a problem with JCC, after all...hard to say one way or the other...&lt;/p&gt;

&lt;p&gt;Here&apos;s a simple program to reproduce the problem:&lt;/p&gt;

&lt;p&gt;import java.sql.*;&lt;/p&gt;

&lt;p&gt;public class go {&lt;/p&gt;

&lt;p&gt;	public static void main (String[] args) throws Exception {&lt;/p&gt;

&lt;p&gt;		Class.forName(&quot;com.ibm.db2.jcc.DB2Driver&quot;);&lt;br/&gt;
		Connection c = DriverManager.getConnection(&lt;br/&gt;
			&quot;jdbc:derby:net://localhost:1527/ugh;create=true&quot;, &quot;bah&quot;, &quot;humbug&quot;);&lt;/p&gt;

&lt;p&gt;		Statement s = c.createStatement();&lt;br/&gt;
		try &lt;/p&gt;
{
			s.execute(&quot;drop table dt&quot;);
		}
&lt;p&gt; catch (SQLException se) {}&lt;/p&gt;

&lt;p&gt;		s.execute(&quot;create table dt (d date)&quot;);&lt;br/&gt;
		PreparedStatement pSt = c.prepareStatement(&quot;insert into dt values &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&quot;);&lt;/p&gt;

&lt;p&gt;		try &lt;/p&gt;
{
			pSt.setString(1, &quot;oops&quot;); // invalid date value.
			pSt.execute();
		}
&lt;p&gt; catch (SQLException se) &lt;/p&gt;
{
			System.out.println(&quot;Got &quot; + se.getSQLState() + &quot;: &quot; + se.getMessage());
		}
&lt;p&gt;	}&lt;/p&gt;

&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;Of course, in order for the program to run, one must start the Network Server on port 1527 first.&lt;/p&gt;</description>
                <environment>Derby running with Network Server via JDBC universal driver.</environment>
        <key id="30260">DERBY-149</key>
            <summary>Server hang when invalid string is bound to datetime columns.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kmarsden">Kathey Marsden</assignee>
                                    <reporter username="army">A B</reporter>
                        <labels>
                    </labels>
                <created>Sat, 19 Feb 2005 06:37:37 +0000</created>
                <updated>Wed, 4 Jan 2006 08:05:44 +0000</updated>
                            <resolved>Tue, 11 Oct 2005 13:56:53 +0100</resolved>
                                                    <fixVersion>10.1.2.1</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="59411" author="army" created="Sat, 19 Feb 2005 07:03:00 +0000"  >&lt;p&gt;The description originally said that the hang was in the &quot;client program.&quot;  I&apos;m changing it to say that the hang is either in the JCC client or else in the Network Server, since that seems like a more accurate statement.&lt;/p&gt;</comment>
                            <comment id="12330055" author="kmarsden" created="Wed, 21 Sep 2005 10:59:26 +0100"  >&lt;p&gt;Looking at this problem, I see that other types of errors, such as insert of a null value into a not null column seem to work ok. Looking at two types of errors in the trace,  I see the following.&lt;/p&gt;

&lt;p&gt;SUCCESSFUL ERROR PROCESSING (invalid insert of null value. handled ok)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;derby&amp;#93;&lt;/span&gt;        SEND BUFFER: EXCSQLSTT             &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;derby&amp;#93;&lt;/span&gt;        SEND BUFFER: SQLDTA       &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;derby&amp;#93;&lt;/span&gt;        SEND BUFFER: RDBCMM      &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;derby&amp;#93;&lt;/span&gt;        RECEIVE BUFFER: SQLCARD (With error 23502)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;derby&amp;#93;&lt;/span&gt;        RECEIVE BUFFER: ENDUOWRM  &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;derby&amp;#93;&lt;/span&gt;        RECEIVE BUFFER: SQLCARD   (null SQLCARD)&lt;/p&gt;


&lt;p&gt;PROBLEM  ERROR PROCESSING (invalid conversion)&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;derby&amp;#93;&lt;/span&gt;        SEND BUFFER: EXCSQLSTT  &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;derby&amp;#93;&lt;/span&gt;        SEND BUFFER: SQLDTA   &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;derby&amp;#93;&lt;/span&gt;        SEND BUFFER: RDBCMM  &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;derby&amp;#93;&lt;/span&gt;        RECEIVE BUFFER: SQLCARD (Exception 22007)&lt;/p&gt;

&lt;p&gt;In the  problem  case, the server never sends the ENDUOWRM and SQLCARD that it should. The client blocks waiting for a response to its chained RDBCMM which the server never sent.&lt;/p&gt;

&lt;p&gt;In the server, in parseSQLDTA on exception, we call skipRemainder(false) to skip the rest of the DSS. The false parameter  means it will skip DSS&apos;s even if they have a different correlation id, which means in this case it gets a little too skippy and skips the RDBCMM Command.&lt;/p&gt;

&lt;p&gt;Changing the line to skipRemainder(true) fixes the problem and makes sense to me because the DRDA manual seems to indicate that you should only get a new correlation identifier for a new command (page 76).   &lt;/p&gt;

&lt;p&gt;My specific question (at last)  is this:&lt;/p&gt;

&lt;p&gt;Are there any situations where we might need to skip a DSS with a different correlation ID  when parsing the parameters in parseSQLDTA?  &lt;/p&gt;</comment>
                            <comment id="12330242" author="army" created="Fri, 23 Sep 2005 10:13:31 +0100"  >&lt;p&gt;I looked at the rest of the DRDAConnThread file and the only other places where &quot;skipRemainder(false)&quot; is called are 1) during connection authentication and 2) in cases where the client explicitly specified that severe errors should break the chain (in which case we call &quot;errorInChain&quot; and that method calls &quot;skipRemainder(false)&quot;).  I can understand it&apos;s use in both of these cases--but like you say, Kathey, I don&apos;t really understand why we would be passing &quot;false&quot; to skipRemainder for the parseSQLDTA method.  &lt;/p&gt;

&lt;p&gt;I skimmed through what I thought were the relevant sections of the DRDA/DDM manuals and I saw nothing in them to indicate that we should be skipping DSSes with different correlation id&apos;s  when parsing the parameters for SQLDTA causes an error.  So if changing the &quot;skipRemainder&quot; call to pass &quot;true&quot; fixes the problem and all of our other tests pass, it seems like it&apos;s an acceptable fix to me...&lt;/p&gt;

&lt;p&gt;(For what that&apos;s worth.)&lt;/p&gt;</comment>
                            <comment id="12330500" author="kmarsden" created="Tue, 27 Sep 2005 05:42:22 +0100"  >&lt;p&gt;checked in fix to  the trunk.  Thanks Arm for looking at it so carefully.&lt;/p&gt;

&lt;p&gt;Date: Mon Sep 26 12:39:26 2005&lt;br/&gt;
New Revision: 291721&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewcvs?rev=291721&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=291721&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-149&quot; title=&quot;Server hang when invalid string is bound to datetime columns.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-149&quot;&gt;&lt;del&gt;DERBY-149&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
Fix Server hang when invalid string is bound to datetime columns.&lt;br/&gt;
Changes network server to skip only the current DSS and not all chained DSS&apos;s &lt;br/&gt;
when parsing parameter data in SQLDTA.&lt;/p&gt;
</comment>
                            <comment id="12331767" author="kmarsden" created="Tue, 11 Oct 2005 13:56:53 +0100"  >&lt;p&gt;Checked this issue into 10.1&lt;/p&gt;

&lt;p&gt;Date: Mon Oct 10 20:46:53 2005&lt;br/&gt;
New Revision: 312801&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewcvs?rev=312801&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=312801&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12361684" author="kristwaa" created="Wed, 4 Jan 2006 08:05:44 +0000"  >&lt;p&gt;Verified the fix on 10.1.2.1 and trunk, and closed the issue.&lt;br/&gt;
Also tested that the test program indeed did hang on 10.0.2.1 and 10.1.1.0.&lt;/p&gt;

&lt;p&gt;Output from test program on 10.1.2.1:&lt;br/&gt;
]$ java -classpath ./db2jcc.jar:./db2jcc_license_c.jar:../db-derby-10.1.2.1-lib/lib/derbyclient.jar:./ go&lt;br/&gt;
Got 22007: DB2 SQL error: SQLCODE: -1, SQLSTATE: 22007, SQLERRMC: 22007.S.181&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 21 Sep 2005 09:59:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21799</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy17g7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40857</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>