<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:54:06 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3173/DERBY-3173.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3173] Removed cached String objects from SQLDate, SQLTime and SQLTimestamp</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3173</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;These type classes save a copy of the value when it is converted to a String (e.g. through a ResultSet.getString()). This complicates the code &amp;amp; increases memory use for little value, in most cases the cached value will never be used. E.g. for any type of scan the String value will be discarded when moving to the next row. In most cases applications do not call getString() twice on a column.&lt;/p&gt;

&lt;p&gt;The code has some historical basis in the fact that these types used to be represented by a java.sql.Time/Date/Timestamp object and its conversion to String was slow. Now the conversion of all these types to a String is simple.&lt;/p&gt;

&lt;p&gt;In addition I think the getString() will sometimes return a non-normalized form, if the value is set by a non-standard format then the cached String is set to the non-standard format, not the standard format, I believe this is incorrect.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12381730">DERBY-3173</key>
            <summary>Removed cached String objects from SQLDate, SQLTime and SQLTimestamp</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="eranda">Eranda Sooriyabandara</assignee>
                                    <reporter username="djd">Daniel John Debrunner</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Nov 2007 19:07:43 +0000</created>
                <updated>Mon, 17 Jun 2013 10:19:35 +0100</updated>
                            <resolved>Tue, 31 Aug 2010 09:53:17 +0100</resolved>
                                                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12706951" author="kmarsden" created="Thu, 7 May 2009 16:54:26 +0100"  >&lt;p&gt;Sounds appropriate for a newcomer. Please correct if I am wrong.&lt;/p&gt;</comment>
                            <comment id="12890776" author="eranda" created="Wed, 21 Jul 2010 18:00:05 +0100"  >&lt;p&gt;Hi,&lt;br/&gt;
Where is this caching done? Also appreciate if can you provide more details which will be helpful when proceed with this issue.&lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="12890797" author="knutanders" created="Wed, 21 Jul 2010 19:01:25 +0100"  >&lt;p&gt;Hi Eranda,&lt;br/&gt;
Take a look at the field named valueString in the classes SQLDate, SQLTime and SQLTimestamp. I think what Dan suggested was that this field was removed, and getString() was changed so that it always regenerates the string representation of the object.&lt;/p&gt;</comment>
                            <comment id="12890800" author="knutanders" created="Wed, 21 Jul 2010 19:04:40 +0100"  >&lt;p&gt;Dan wrote:&lt;/p&gt;

&lt;p&gt;&amp;gt; In addition I think the getString() will sometimes return a&lt;br/&gt;
&amp;gt; non-normalized form, if the value is set by a non-standard format&lt;br/&gt;
&amp;gt; then the cached String is set to the non-standard format, not the&lt;br/&gt;
&amp;gt; standard format, I believe this is incorrect.&lt;/p&gt;

&lt;p&gt;This part of the issue sounds like the problem that caused &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3856&quot; title=&quot;difference between Embedded vs DerbyNetClient in format of return from timestamp(cast(? as varchar(32)))&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3856&quot;&gt;&lt;del&gt;DERBY-3856&lt;/del&gt;&lt;/a&gt;,&lt;br/&gt;
which has later been fixed.&lt;/p&gt;</comment>
                            <comment id="12899477" author="eranda" created="Tue, 17 Aug 2010 18:15:22 +0100"  >&lt;p&gt;Hi Knut,&lt;br/&gt;
According to your guidance I came up with a patch to remove caching the value of SQLDate. &lt;br/&gt;
Here I remove the part &quot;ClassSize.estimateMemoryUsage( valueString)&quot; which allocate the memory for caching. And declare the valueString inside the getString.&lt;br/&gt;
Is it what addressed here?&lt;br/&gt;
thanks&lt;/p&gt;</comment>
                            <comment id="12901362" author="knutanders" created="Mon, 23 Aug 2010 12:58:40 +0100"  >&lt;p&gt;Hi Eranda,&lt;/p&gt;

&lt;p&gt;Thanks for posting the patch. Your changes look good to me. I&apos;m running the regression tests now and intend to commit it if the tests run cleanly. Before starting the tests, I made two minor changes to your patch (see the attached sqldate.diff): 1) Removed trailing blanks. 2) Narrowed the scope of the local variable valueString in getString() since it&apos;s only used inside the first branch of the if statement.&lt;/p&gt;</comment>
                            <comment id="12901378" author="knutanders" created="Mon, 23 Aug 2010 13:58:44 +0100"  >&lt;p&gt;All tests ran cleanly. Committed revision 988107.&lt;/p&gt;

&lt;p&gt;I&apos;m leaving the issue open until SQLTime and SQLTimestamp have been fixed.&lt;/p&gt;</comment>
                            <comment id="12902554" author="eranda" created="Wed, 25 Aug 2010 19:16:15 +0100"  >&lt;p&gt;Hi Knut,&lt;br/&gt;
I do some updates in SQLTime and SQLTimestamp as I did in SQLDate and run the regression tests which ran successfully. Here I am attaching the patch for your concern.&lt;br/&gt;
thanks&lt;/p&gt;</comment>
                            <comment id="12902826" author="knutanders" created="Thu, 26 Aug 2010 12:41:36 +0100"  >&lt;p&gt;Thank you, Eranda. The patch looks fine to me, but I think there&apos;s a small problem with this change in SQLTime:&lt;/p&gt;

&lt;p&gt;@@ -551,7 +526,6 @@&lt;br/&gt;
                 else if( hour &amp;gt; 12)&lt;br/&gt;
                     throw StandardException.newException( SQLState.LANG_DATE_RANGE_EXCEPTION);&lt;br/&gt;
             }&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;valueString = parser.checkEnd();&lt;br/&gt;
             encodedTime = computeEncodedTime( hour, minute, second);&lt;br/&gt;
         }&lt;br/&gt;
         else&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The call to checkEnd() performs some extra input validation that we shouldn&apos;t remove. For example, the following query used to be rejected:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; values time(&apos;05 am pm&apos;);&lt;br/&gt;
ERROR 22007: The syntax of the string representation of a datetime value is incorrect.&lt;/p&gt;

&lt;p&gt;With the patch, the query is now accepted:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; values time(&apos;05 am pm&apos;);&lt;br/&gt;
1       &lt;br/&gt;
--------&lt;br/&gt;
05:00:00&lt;/p&gt;

&lt;p&gt;1 row selected&lt;/p&gt;

&lt;p&gt;Instead of removing that line completely, I think we should keep the call to checkEnd() and just discard the return value.&lt;/p&gt;</comment>
                            <comment id="12902828" author="knutanders" created="Thu, 26 Aug 2010 12:48:49 +0100"  >&lt;p&gt;The latest patch opens up for some simplifications in the DateTimeParser class too:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the getTrimmedString() method isn&apos;t called anymore, so it can be removed&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;none of the callers use the return value from checkEnd() anymore, so the return type could be changed to void&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the field trimmedString can be removed&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12902935" author="eranda" created="Thu, 26 Aug 2010 18:10:34 +0100"  >&lt;p&gt;Hi Knut,&lt;br/&gt;
Thanks for got the thing and I did the changes as you suggest and here I am attaching the patch with this. It seems to be working now.&lt;/p&gt;

&lt;p&gt;ij&amp;gt; values time(&apos;05 am pm&apos;); &lt;br/&gt;
ERROR 22007: The syntax of the string representation of a datetime value is incorrect.&lt;br/&gt;
ij&amp;gt; values time(&apos;05 am&apos;);            &lt;br/&gt;
1       &lt;br/&gt;
--------&lt;br/&gt;
05:00:00&lt;/p&gt;

&lt;p&gt;1 row selected&lt;br/&gt;
ij&amp;gt; values time(&apos;05 pm&apos;);    &lt;br/&gt;
1       &lt;br/&gt;
--------&lt;br/&gt;
17:00:00&lt;/p&gt;

&lt;p&gt;1 row selected&lt;/p&gt;

&lt;p&gt;thanks&lt;/p&gt;</comment>
                            <comment id="12903045" author="knutanders" created="Thu, 26 Aug 2010 21:59:06 +0100"  >&lt;p&gt;Thanks, Eranda. I made two small changes to the patch before I committed it:&lt;/p&gt;

&lt;p&gt;1) Adjusted the indentation a couple of places. (It looks like your IDE is configured with tab size 8, whereas the code is written with tab size 4.)&lt;/p&gt;

&lt;p&gt;2) Removed more code from the checkEnd() method (there was a loop that only modified the local variable end, which was no longer in use)&lt;/p&gt;

&lt;p&gt;Committed revision 989918.&lt;/p&gt;</comment>
                            <comment id="12903240" author="eranda" created="Fri, 27 Aug 2010 06:43:21 +0100"  >&lt;p&gt;Thanks Knut for committing. I am closing this issue. &lt;/p&gt;</comment>
                            <comment id="12904524" author="eranda" created="Tue, 31 Aug 2010 06:51:29 +0100"  >&lt;p&gt;Due to javadoc warning which appear due to comment error. &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;javadoc&amp;#93;&lt;/span&gt; C:\trunk\java\engine\org\apache\derby\iapi\types\DateTimeParser.java:191:&lt;br/&gt;
warning - @return tag cannot be used in method with void return type.&lt;/p&gt;</comment>
                            <comment id="12904526" author="eranda" created="Tue, 31 Aug 2010 06:52:58 +0100"  >&lt;p&gt;Here I am attaching the patch in which I remove the @return part.&lt;/p&gt;</comment>
                            <comment id="12904563" author="knutanders" created="Tue, 31 Aug 2010 09:53:17 +0100"  >&lt;p&gt;Thanks, Eranda. Committed revision 991124.&lt;/p&gt;</comment>
                            <comment id="13685293" author="knutanders" created="Mon, 17 Jun 2013 10:19:35 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12453146" name="Derby-3173.diff" size="6372" author="eranda" created="Thu, 26 Aug 2010 18:10:34 +0100"/>
                            <attachment id="12453065" name="Derby-3173.diff" size="4867" author="eranda" created="Wed, 25 Aug 2010 19:16:15 +0100"/>
                            <attachment id="12452293" name="Derby-3173.diff" size="1774" author="eranda" created="Tue, 17 Aug 2010 18:15:22 +0100"/>
                            <attachment id="12453163" name="d3173.diff" size="7459" author="knutanders" created="Thu, 26 Aug 2010 21:59:06 +0100"/>
                            <attachment id="12453496" name="d3173_warning.diff" size="640" author="eranda" created="Tue, 31 Aug 2010 06:52:58 +0100"/>
                            <attachment id="12452807" name="sqldate.diff" size="1675" author="knutanders" created="Mon, 23 Aug 2010 12:58:40 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 7 May 2009 15:54:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30754</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10423"><![CDATA[Newcomer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0p2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37880</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>