<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:18:31 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1125/DERBY-1125.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1125] Getting security exception when derbyclient.jar is before derby.jar  because classes in iapi.services.info have been added to derbyclient.jar</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1125</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;This security exception can occur if derbyclient.jar is before derby.jar after revision 370815.  &lt;br/&gt;
See:&lt;br/&gt;
&lt;a href=&quot;http://www.nabble.com/regression-%21-all-tests-in-jdbcapi-fails-for-me-t1298249.html#a3462544&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/regression-%21-all-tests-in-jdbcapi-fails-for-me-t1298249.html#a3462544&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;From Andrew&apos;s email:&lt;/p&gt;

&lt;p&gt;On 3/17/06, Andreas Korneliussen &amp;lt;Andreas.Korneliussen@sun.com&amp;gt; wrote:&lt;br/&gt;
&amp;gt; &amp;lt;/snip a whole bunch of stuff&amp;gt;&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; Exception: java.lang.SecurityException: sealing violation: can&apos;t seal package org.apache.derby.iapi.services.info:&lt;br/&gt;
already loaded&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-848&quot; title=&quot;Internationalize NetSqldta to OpenSocketAction in org.apache.derby.client.net&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-848&quot;&gt;&lt;del&gt;DERBY-848&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1046&quot; title=&quot;JVMInfo is duplicated in derbyclient.jar&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1046&quot;&gt;&lt;del&gt;DERBY-1046&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;iapi.services.info.ProductVersionHolder and friends were added to&lt;br/&gt;
derbyclient.jar by David in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-848&quot; title=&quot;Internationalize NetSqldta to OpenSocketAction in org.apache.derby.client.net&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-848&quot;&gt;&lt;del&gt;DERBY-848&lt;/del&gt;&lt;/a&gt;, specifically with revision&lt;br/&gt;
370815.&lt;/p&gt;

&lt;p&gt;There are two clear solutions: unseal iapi.services.info or copy the&lt;br/&gt;
info classes to a new shared info package.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12330399">DERBY-1125</key>
            <summary>Getting security exception when derbyclient.jar is before derby.jar  because classes in iapi.services.info have been added to derbyclient.jar</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davidvc">David Van Couvering</assignee>
                                    <reporter username="davidvc">David Van Couvering</reporter>
                        <labels>
                    </labels>
                <created>Sat, 18 Mar 2006 05:00:18 +0000</created>
                <updated>Wed, 12 Jul 2006 05:11:03 +0100</updated>
                            <resolved>Thu, 23 Mar 2006 05:05:28 +0000</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Build tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12370904" author="davidvc" created="Sat, 18 Mar 2006 07:13:29 +0000"  >&lt;p&gt;OK, to be clear, what happened was not that I included the iapi/services/info package, that has been there for a while.&lt;/p&gt;

&lt;p&gt;What happened was I &lt;b&gt;copied&lt;/b&gt; JVMInfo from iapi/services/info to shared/common/info.  At that time I was unaware that iapi/services/info was being included in derbyclient.jar.&lt;/p&gt;

&lt;p&gt;Then Knut discovered that JVMInfo was in two places in derbyclient.jar (iapi/services/info and shared/common/info), so I then excluded services/info/JVMInfo.class from the derbyclient jar file.  Case solved (hah!).&lt;/p&gt;

&lt;p&gt;So now what happens is that services/info/JVMInfo is loaded from derby.jar when you run with derby.jar and derbyclient.jar in the same classpath.  And then if you have derbyclient.jar in from of derby.jar all other classes from the package services/info are loaded from derbyclient.jar.  This is not allowed for sealed packages, thus the security exception.&lt;/p&gt;

&lt;p&gt;I made my copy of JVMInfo because I had assumed it was a Bad Thing to copy the same classes into two separate jar files.  This is called Code Sharing and is Not Allowed.  But it&apos;s been there for quite a while. So in a mixed version environment you can have the same shadowing/compatibility issues that have been painstakingly documented for code sharing in general.&lt;/p&gt;

&lt;p&gt;So, we have the following choices:&lt;/p&gt;

&lt;p&gt;(1)  I can remove the copy of JVMInfo in shared/common/info, and go back to the way things were.  In my client code I can import org.apache.derby.iapi.services.info.JVMInfo instead of org.apache.derby.shared.common.info.JVMInfo.    This is the way things were and would probably be the simplest solution, but we would continue to have the potential issues around compatibility and shadowing in a mixed version environment.  It is worth noting that this has not come up as an issue as of yet.&lt;/p&gt;

&lt;p&gt;(2) I can copy everything into org.apache.derby.shared.common and fix all client code so it refers to the shared versions of this stuff.  The risk of this is now we have a fair amount of code duplication, and things can get skewed pretty easily&lt;/p&gt;

&lt;p&gt;(3) I can implement the proposal we had earlier, which was to use a build script to automatically make a copy of the classes in iapi/services/info and put them in shared.  The engine code would continue to use iapi/services/info, and the client code would use shared/common/info.  I do have to wonder what is going on with the tools and network jar files, however, as I think they are also making use of iapi/services/info classes.  This could turn into a Big Project if I have to make copies for each jar file.&lt;/p&gt;

&lt;p&gt;(4) Unseal iapi/services/info.  This seems like the wrong way to go.  This is an internal package and we don&apos;t want it to be possible to interject &quot;new&quot; implementations of these classes from other code bases.&lt;/p&gt;

&lt;p&gt;My current itch is to put things back the way they were, and solve the longer-term code sharing problem as part of the code sharing JIRA, &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-289&quot; title=&quot;Enable code sharing between Derby client and engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-289&quot;&gt;DERBY-289&lt;/a&gt;.  So I am going to go with option (1).  But please let me know if you have an opinion on this.&lt;/p&gt;</comment>
                            <comment id="12370911" author="fuzzylogic" created="Sat, 18 Mar 2006 08:05:51 +0000"  >&lt;p&gt;I agree, option 1 is the way to go.&lt;/p&gt;

&lt;p&gt;I remembered after you brought it up in option 3 above that currently the code is already duplicated in the tools jar. It is assumed that the network server will be running alongside the engine, so classlister filters out the info classes from derbynet.jar.&lt;/p&gt;

&lt;p&gt;These classes are fairly stable. JVMInfo is the only one that has seen any change, and that was to add a new identifier for JDK 1.6. That change was made in 10.2. The potential for problems with shadowing, etc. are already there with the duplication in derbytools.jar, I suppose, but I think the potential for problems is minor, and the problem in a mixed environment would be fairly obvious to spot.&lt;/p&gt;</comment>
                            <comment id="12371345" author="kmarsden" created="Wed, 22 Mar 2006 07:41:36 +0000"  >&lt;p&gt;I am coming into this issue late so might really be misunderstanding things but  I don&apos;t   like this idea of importing engine classes into the client no matter how stable  we think they are.  Doing this means that every line of code has to be evaluated for impact.&lt;/p&gt;

&lt;p&gt;This strategy was discussed on the list previously and the concensus I thought was that for client a copy would be put in the shared directory and at such time as we had a code sharing solution, the files would be combined.  If the files are really that stable it shouldn&apos;t be hard to resolve differences.&lt;/p&gt;

&lt;p&gt;Also, the description of this bug does not describe the circumstances under which a user might see this issue.  I seem to recall that it imposed some sort of required classpath order. Is that correct?&lt;/p&gt;

&lt;p&gt;If so I think it is a regression and needs to be moved up to Blocker for 10.2.&lt;/p&gt;





</comment>
                            <comment id="12371349" author="davidvc" created="Wed, 22 Mar 2006 07:46:24 +0000"  >&lt;p&gt;Hi, Kathey, I was wondering when you were going to join in on the fun &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The thing is, that these classes have been imported into the client jar for as long as I have been on the project.  So I can&apos;t imagine it can be a regression to put it back the way things were.&lt;/p&gt;

&lt;p&gt;If you don&apos;t like the solution of reverting back to how things were, can you suggest another one?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;David&lt;/p&gt;</comment>
                            <comment id="12371352" author="davidvc" created="Wed, 22 Mar 2006 07:52:09 +0000"  >&lt;p&gt;Also, to answer your question, yes, my understanding is that the bug reveals itself when derbyclient.jar is in front of derby.jar.  Please feel free to upgrade to Blocker.  I was working on implementing Solution 1 as described above but I&apos;m on hold now until we can finish our discussion of potential issues around this solution and what the best alternative might be, if any.&lt;/p&gt;</comment>
                            <comment id="12371361" author="kmarsden" created="Wed, 22 Mar 2006 08:12:02 +0000"  >&lt;p&gt;Thanks David, that is my mistake. I did not realize that this was part of the sysinfo code imported into client in 10.1. Please go ahead and switch it back to the 10.1 setup.&lt;/p&gt;

&lt;p&gt;The defect itself  is a regression because a classpath order that worked in 10.1 derbyclient.jar;derby.jar does not currently work in 10.2.  I found the mail:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.nabble.com/regression-%21-all-tests-in-jdbcapi-fails-for-me-t1298249.html#a3462544&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/regression-%21-all-tests-in-jdbcapi-fails-for-me-t1298249.html#a3462544&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll bump it up to Critical I guess.  But a must fix for 10.2 I think. As we get closer to the release I think it is important that product regressions be properly identified and not slip through the cracks so that is why I brought it up.&lt;/p&gt;

&lt;p&gt;Thanks for taking care of this issue.&lt;/p&gt;
</comment>
                            <comment id="12371464" author="davidvc" created="Thu, 23 Mar 2006 05:05:26 +0000"  >&lt;p&gt;Committed revision 387905&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 18 Mar 2006 08:05:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22323</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy15f3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40528</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>