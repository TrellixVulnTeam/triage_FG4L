<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:36:55 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5097/DERBY-5097.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5097]  testMTSelect(org.apache.derbyTesting.functionTests.tests.store.AutomaticIndex StatisticsMultiTest)junit.framework.AssertionFailedError: failed to get statisti cs for table MTSEL (#expected=2, timeout=0) on AIX IBM JDK 1.5</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5097</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I need to check if this is intermittent, but noticed the following failure running suites.All on AIX with IBM 1.5.&lt;/p&gt;

&lt;p&gt;1) testMTSelect(org.apache.derbyTesting.functionTests.tests.store.AutomaticIndex&lt;br/&gt;
StatisticsMultiTest)junit.framework.AssertionFailedError: failed to get statisti&lt;br/&gt;
cs for table MTSEL (#expected=2, timeout=0)&lt;br/&gt;
Index statistics for MTSEL&lt;br/&gt;
 : &amp;lt;no stats&amp;gt;&lt;br/&gt;
 expected:&amp;lt;2&amp;gt; but was:&amp;lt;0&amp;gt;&lt;br/&gt;
        at org.apache.derbyTesting.junit.IndexStatsUtil.getStatsTable(IndexStats&lt;br/&gt;
Util.java:236)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.AutomaticIndexStati&lt;br/&gt;
sticsMultiTest.verifyStatistics(AutomaticIndexStatisticsMultiTest.java:143)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.AutomaticIndexStati&lt;br/&gt;
sticsMultiTest.testMTSelect(AutomaticIndexStatisticsMultiTest.java:87)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.&lt;br/&gt;
java:79)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces&lt;br/&gt;
sorImpl.java:43)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:&lt;br/&gt;
112)&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;br/&gt;
Tests run: 11518,  Failures: 1,  Errors: 0&lt;/p&gt;</description>
                <environment>$ java -version&lt;br/&gt;
java version &amp;quot;1.5.0&amp;quot;&lt;br/&gt;
Java(TM) 2 Runtime Environment, Standard Edition (build pap32dev-20100813 (SR12&lt;br/&gt;
FP1 ))&lt;br/&gt;
IBM J9 VM (build 2.3, J2RE 1.5.0 IBM J9 2.3 AIX ppc-32 j9vmap3223-20100808 (JIT&lt;br/&gt;
enabled)&lt;br/&gt;
J9VM - 20100629_60535_bHdSMr&lt;br/&gt;
JIT  - 20100623_16197_r8&lt;br/&gt;
GC   - 20100211_AA)&lt;br/&gt;
JCL  - 20100813</environment>
        <key id="12500719">DERBY-5097</key>
            <summary> testMTSelect(org.apache.derbyTesting.functionTests.tests.store.AutomaticIndex StatisticsMultiTest)junit.framework.AssertionFailedError: failed to get statisti cs for table MTSEL (#expected=2, timeout=0) on AIX IBM JDK 1.5</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Mar 2011 02:40:59 +0000</created>
                <updated>Tue, 25 Oct 2011 18:09:50 +0100</updated>
                            <resolved>Thu, 9 Jun 2011 10:34:24 +0100</resolved>
                                                    <fixVersion>10.8.2.2</fixVersion>
                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13004547" author="rhillegas" created="Wed, 9 Mar 2011 14:01:12 +0000"  >&lt;p&gt;Hi Kathey, does this test fail reliably on AIX? The test may be vulnerable to timing problems--it is suspicious that the test cranks up 5 threads.&lt;/p&gt;

&lt;p&gt;This error may flag a bug in the automatic collection of statistics, however. The test fails because it is expects that statistics were collected automatically and in this case they weren&apos;t.&lt;/p&gt;

&lt;p&gt;It seems to me that this bug is not a regression: the failure to collect statistics will not cause wrong results and it will not even cause a query to run worse than it did in 10.7. This may just be evidence that in some situations istat is not delivering its promised benefits in the expected timeframe.&lt;/p&gt;</comment>
                            <comment id="13004671" author="kmarsden" created="Wed, 9 Mar 2011 17:33:03 +0000"  >&lt;p&gt;It is intermittent but I saw it two out of four runs, so could probably get it to pop if you would like me to add some diagnostic code to narrow down the problem.    Probably best just to check in some verbosity with derby.tests.debug=true and then I can run it with that.&lt;/p&gt;

&lt;p&gt;I agree it is  not a product regression as statistics collection is a new feature.   As with all  test failures though it would be good to resolve before the platform tests kick off if anyone has ideas as trying to map the failures can be a chore  when there are a lot of failures and a lot of platforms.&lt;/p&gt;</comment>
                            <comment id="13004785" author="kristwaa" created="Wed, 9 Mar 2011 20:35:44 +0000"  >&lt;p&gt;Haven&apos;t spent much time on this, but if this is easily reproducible it may be better to simply use a non-zero timeout value for the utility class that fetches/verifies the statistics (see line 142 in the test class).&lt;br/&gt;
As Rick suggests, it may very well be that the background thread is never allowed to run (it is supposed to be started immediately) due to differences in the OS scheduling policy. It would also be good to enable logging/tracing and compare the output between a working and a failing run.&lt;/p&gt;</comment>
                            <comment id="13036490" author="myrna" created="Thu, 19 May 2011 22:28:35 +0100"  >&lt;p&gt;I thought I&apos;d check how hard this is to reproduce, and with ibm 1.6 (SR9 FP1), against 10.8.1.2 release, on AIX this test failed with this error message 11 out of 100 times.&lt;/p&gt;</comment>
                            <comment id="13039342" author="kristwaa" created="Wed, 25 May 2011 22:25:40 +0100"  >&lt;p&gt;I can&apos;t reproduce on my machine with a sane build at least.&lt;br/&gt;
Did you use sane or insane?&lt;br/&gt;
How many cpus/cores on the machine?&lt;/p&gt;

&lt;p&gt;If possible, can you add a timeout value to the IndexStatsUtil instance on line 142? For the sake of ruling out &quot;delayed istats&quot;, the timeout value can be rather high (ten seconds?).&lt;/p&gt;</comment>
                            <comment id="13042483" author="myrna" created="Wed, 1 Jun 2011 23:18:33 +0100"  >&lt;p&gt;My previous result was with 10.8.1.2, insane. &lt;br/&gt;
The machine has 1 core, 1 cpu.&lt;/p&gt;

&lt;p&gt;I then tried an sane trunk build with the same jvm, same machine, unmodified, and it failed 77 out of 100 times.&lt;/p&gt;

&lt;p&gt;Then I modified line 142 as you said, with a timeout of 10 seconds, and there were 0 failures out of 100 runs...&lt;/p&gt;</comment>
                            <comment id="13043353" author="kristwaa" created="Fri, 3 Jun 2011 14:36:54 +0100"  >&lt;p&gt;Attaching patch 1a, which adds the timeout that seems to stop the test from failing.&lt;/p&gt;

&lt;p&gt;Committed to trunk with revision 1131030.&lt;br/&gt;
Waiting for verification, then I&apos;ll back-port it to 10.8.&lt;/p&gt;</comment>
                            <comment id="13046009" author="myrna" created="Wed, 8 Jun 2011 16:31:15 +0100"  >&lt;p&gt;I sync-ed up and ran the test 100 times both with insane and sane jars; insane had no failures, sane 1.&lt;br/&gt;
That would work for me, and I think I&apos;m the only one running regular (but not nightly) tests on this platform, and never with sane jars.&lt;br/&gt;
+1 for the backport.&lt;/p&gt;</comment>
                            <comment id="13046153" author="kristwaa" created="Wed, 8 Jun 2011 20:28:41 +0100"  >&lt;p&gt;Thanks, Myrna &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll up the time the test will wait, it will retry every 250 ms so a higher value shouldn&apos;t matter. I&apos;m thinking of setting it to five seconds, and then backport.&lt;/p&gt;</comment>
                            <comment id="13046166" author="myrna" created="Wed, 8 Jun 2011 20:50:12 +0100"  >&lt;p&gt;ok...&lt;/p&gt;</comment>
                            <comment id="13046424" author="kristwaa" created="Thu, 9 Jun 2011 10:28:21 +0100"  >&lt;p&gt;Increased timeout with patch 2a.&lt;br/&gt;
Committed to trunk with revision 1133741.&lt;/p&gt;</comment>
                            <comment id="13046428" author="kristwaa" created="Thu, 9 Jun 2011 10:34:24 +0100"  >&lt;p&gt;Backported fix to 10.8 with revision 1133747.&lt;br/&gt;
Ready for verification/close.&lt;/p&gt;</comment>
                            <comment id="13046861" author="myrna" created="Thu, 9 Jun 2011 23:25:42 +0100"  >&lt;p&gt;ran once more 100 times with sane trunk jars, and no failures. Thanks Kristian.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12504703">DERBY-5199</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12481341" name="derby-5097-1a-add_timeout.diff" size="1081" author="kristwaa" created="Fri, 3 Jun 2011 14:36:54 +0100"/>
                            <attachment id="12481900" name="derby-5097-2a-increase_timeout.diff" size="934" author="kristwaa" created="Thu, 9 Jun 2011 10:28:21 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 9 Mar 2011 14:01:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24643</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ep3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36199</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>