<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:39:01 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1537/DERBY-1537.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1537] Boot-time exception when running Derby tests with derbytools.jar in front of derby.jar in the classpath.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1537</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When running derbyall against sane jars all tests that create the &quot;wombat&quot; database fail at boot-time if the classpath has derbytools.jar before derby.jar. The failure occurs when the test tries to create the database.  I can successfully create a database manually, but for whatever reason the test harness is unable to do so. &lt;/p&gt;

&lt;p&gt;I&apos;ve set the component to &quot;Test&quot; but I don&apos;t know if this a test harness problem or something more severe.&lt;/p&gt;

&lt;p&gt;The full stack trace is below.  If I switch the order of derby.jar and derbytools.jar, everything works as expected.&lt;/p&gt;

&lt;p&gt;ERROR XBM01: Startup failed due to an exception. See next exception for details.&lt;br/&gt;
    at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:297)&lt;br/&gt;
    at org.apache.derby.iapi.services.monitor.Monitor.exceptionStartingModule(Monitor.java:668)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1849)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.createPersistentService(BaseMonitor.java:1013)&lt;br/&gt;
    at org.apache.derby.iapi.services.monitor.Monitor.createPersistentService(Monitor.java:587)&lt;br/&gt;
    at org.apache.derby.impl.jdbc.EmbedConnection.createDatabase(EmbedConnection.java:1563)&lt;br/&gt;
    at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:243)&lt;br/&gt;
    at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(EmbedConnection30.java:72)&lt;br/&gt;
    at org.apache.derby.jdbc.Driver30.getNewEmbedConnection(Driver30.java:73)&lt;br/&gt;
    at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:209)&lt;br/&gt;
    at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:116)&lt;br/&gt;
    at java.sql.DriverManager.getConnection(DriverManager.java:539)&lt;br/&gt;
    at java.sql.DriverManager.getConnection(DriverManager.java:158)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.util.startJBMS(util.java:491)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.util.startJBMS(util.java:571)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.ConnectionEnv.init(ConnectionEnv.java:62)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.utilMain.&amp;lt;init&amp;gt;(utilMain.java:149)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.utilMain14.&amp;lt;init&amp;gt;(utilMain14.java:51)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.Main14.getutilMain(Main14.java:102)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.Main.&amp;lt;init&amp;gt;(Main.java:232)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.Main14.&amp;lt;init&amp;gt;(Main14.java:68)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.Main14.getMain(Main14.java:91)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:170)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55)&lt;br/&gt;
    at org.apache.derby.tools.ij.main(ij.java:60)&lt;br/&gt;
============= begin nested exception, level (1) ===========&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
    at java.io.Reader.&amp;lt;init&amp;gt;(Reader.java(Inlined Compiled Code))&lt;br/&gt;
    at java.io.InputStreamReader.&amp;lt;init&amp;gt;(InputStreamReader.java(Inlined Compiled Code))&lt;br/&gt;
    at java.util.Properties.load(Properties.java(Compiled Code))&lt;br/&gt;
    at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.run(DataDictionaryImpl.java:9757)&lt;br/&gt;
    at java.security.AccessController.doPrivileged1(Native Method)&lt;br/&gt;
    at java.security.AccessController.doPrivileged(AccessController.java:287)&lt;br/&gt;
    at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getQueryDescriptions(DataDictionaryImpl.java:9747)&lt;br/&gt;
    at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.createSPSSet(DataDictionaryImpl.java:8275)&lt;br/&gt;
    at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.createSystemSps(DataDictionaryImpl.java:8262)&lt;br/&gt;
    at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.boot(DataDictionaryImpl.java:651)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1996)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:542)&lt;br/&gt;
    at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418)&lt;br/&gt;
    at org.apache.derby.impl.sql.conn.GenericLanguageConnectionFactory.bootDataDictionary(GenericLanguageConnectionFactory.java:357)&lt;br/&gt;
    at org.apache.derby.impl.sql.conn.GenericLanguageConnectionFactory.boot(GenericLanguageConnectionFactory.java:330)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1996)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:542)&lt;br/&gt;
    at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418)&lt;br/&gt;
    at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:193)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1996)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1831)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.createPersistentService(BaseMonitor.java:1013)&lt;br/&gt;
    at org.apache.derby.iapi.services.monitor.Monitor.createPersistentService(Monitor.java:587)&lt;br/&gt;
    at org.apache.derby.impl.jdbc.EmbedConnection.createDatabase(EmbedConnection.java:1563)&lt;br/&gt;
    at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:243)&lt;br/&gt;
    at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(EmbedConnection30.java:72)&lt;br/&gt;
    at org.apache.derby.jdbc.Driver30.getNewEmbedConnection(Driver30.java:73)&lt;br/&gt;
    at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:209)&lt;br/&gt;
    at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:116)&lt;br/&gt;
    at java.sql.DriverManager.getConnection(DriverManager.java:539)&lt;br/&gt;
    at java.sql.DriverManager.getConnection(DriverManager.java:158)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.util.startJBMS(util.java:491)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.util.startJBMS(util.java:571)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.ConnectionEnv.init(ConnectionEnv.java:62)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.utilMain.&amp;lt;init&amp;gt;(utilMain.java:149)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.utilMain14.&amp;lt;init&amp;gt;(utilMain14.java:51)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.Main14.getutilMain(Main14.java:102)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.Main.&amp;lt;init&amp;gt;(Main.java:232)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.Main14.&amp;lt;init&amp;gt;(Main14.java:68)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.Main14.getMain(Main14.java:91)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:170)&lt;br/&gt;
    at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55)&lt;br/&gt;
    at org.apache.derby.tools.ij.main(ij.java:60)&lt;br/&gt;
============= end nested exception, level (1) ===========&lt;br/&gt;
Cleanup action completed &lt;/p&gt;</description>
                <environment>This issue impacts 10.1 as well.&lt;br/&gt;
</environment>
        <key id="12346270">DERBY-1537</key>
            <summary>Boot-time exception when running Derby tests with derbytools.jar in front of derby.jar in the classpath.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fuzzylogic">Andrew McIntyre</assignee>
                                    <reporter username="army">A B</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Jul 2006 18:01:57 +0100</created>
                <updated>Fri, 26 Jun 2009 17:15:35 +0100</updated>
                            <resolved>Wed, 2 Aug 2006 01:19:26 +0100</resolved>
                                    <version>10.1.3.1</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Build tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12422782" author="kmarsden" created="Fri, 21 Jul 2006 22:45:37 +0100"  >&lt;p&gt;RegressionSearchAndDestroy hint:&lt;/p&gt;

&lt;p&gt;This issue looks like low hanging fruit for anyone wishing to participate in the RegressionSearchAndDestroy contest or for any eager QA person looking for a point.  Just a little investigation might expose it as an important blocker issue for the release. &lt;/p&gt;

&lt;p&gt;It is a new NPE  loading core derby properties from  org.apache.derby.impl.sql.catalog.DataDictionaryImpl based on classpath order but  is marked.  &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Priority : Low&lt;/li&gt;
	&lt;li&gt;Component: Test&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It would certainly be a great quality contribution to 10.2  and ease upgrade to get it marked as  a &quot;Regression&quot;  and priority and component adjusted if needed.&lt;/p&gt;</comment>
                            <comment id="12423182" author="kmarsden" created="Mon, 24 Jul 2006 23:38:39 +0100"  >&lt;p&gt;Changing this to Critical and Fix Version 10.2 because it certainly looks like a serious product issue to me and a regression if we are getting an NPE booting the server as it is reading properties.   I think it should be  resolved or at least understood before we  release 10.2&lt;/p&gt;

&lt;p&gt;ava.lang.NullPointerException&lt;br/&gt;
    at java.io.Reader.&amp;lt;init&amp;gt;(Reader.java(Inlined Compiled Code))&lt;br/&gt;
    at java.io.InputStreamReader.&amp;lt;init&amp;gt;(InputStreamReader.java(Inlined Compiled Code))&lt;br/&gt;
    at java.util.Properties.load(Properties.java(Compiled Code))&lt;br/&gt;
    at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.run(DataDictionaryImpl.java:9757)&lt;/p&gt;</comment>
                            <comment id="12423212" author="fuzzylogic" created="Tue, 25 Jul 2006 01:40:46 +0100"  >&lt;p&gt;This problem only occurs when running with the security manager enabled. The underlying problem is that there is a copy of org/apache/derby/impl/jdbc metadata.properties in derbytools.jar. When running with the security manager enabled, with the test policy file, the engine requests metadata.properties and the first copy it finds is in derbytools.jar. However, derby.jar does not have the necessary FilePermission to read files in derbytools.jar, so getResourceAsStream() returns null for the file. The NPE is then thrown because of the next line of code when it calls Properties.load() with a null reference.&lt;/p&gt;

&lt;p&gt;It&apos;s not technically a regression, since derbytools.jar has apparently included a copy of metadata.properties since the beginning. We just had never spotted it because the tests were not running with the security manager. And up until last week, no one had tried putting tools.jar first.&lt;/p&gt;

&lt;p&gt;That said, the fact that there&apos;s a copy of metadata.properties in derbytools.jar is certainly a bug, and one that I&apos;ll fix. Preliminary investigation indicates the problem is with the classlister utility which generates the dependency list for the jar.&lt;/p&gt;</comment>
                            <comment id="12423922" author="rhillegas" created="Thu, 27 Jul 2006 21:59:35 +0100"  >&lt;p&gt;Bumping urgency.&lt;/p&gt;</comment>
                            <comment id="12424455" author="bryanpendleton" created="Mon, 31 Jul 2006 01:01:22 +0100"  >&lt;p&gt;The symptoms are different, but see also &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-645&quot; title=&quot;derbynet/sysinfo.java fails  showing  missing locale support due to  AccessControlExceptions if derbytools.jar is before derby.jar in the classpath&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-645&quot;&gt;&lt;del&gt;DERBY-645&lt;/del&gt;&lt;/a&gt; for another problem with the order of derbytools.jar and derby.jra in the classpath.&lt;/p&gt;</comment>
                            <comment id="12424730" author="fuzzylogic" created="Tue, 1 Aug 2006 05:31:31 +0100"  >&lt;p&gt;Attching a patch for this issue. Currently, for every class scanned by classlister, the package of that class is also checked for a few certain properties files. If found, these properties files are added to the list of files tracked by the dependency manager. Currently, this is only used by the engine build for metadata.properties. I&apos;ve turned it off for the tools jar build by wrapping it in a if (!db2jtools) {} block. This prevents classlister from including org.apache.derby.impl.jdbc.metadata.properties because it scanned and added org.apache.derby.impl.jdbc.EmbedSQLException, a dependent of org.apache.derby.iapi.error.StandardException.&lt;/p&gt;

&lt;p&gt;Classlister could use some cleanup, but that should be handled separately from this issue.&lt;/p&gt;

&lt;p&gt;I&apos;ve verified that the fix solves the underlying problem and the exposed issue, the classpath ordering problem. Unless there are any comments, I will commit this in the next day or so.&lt;/p&gt;</comment>
                            <comment id="12425069" author="fuzzylogic" created="Wed, 2 Aug 2006 01:19:26 +0100"  >&lt;p&gt;Committed to trunk with revision 427816.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12324988">DERBY-645</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12324988">DERBY-645</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12337854" name="derby-1537-v1.diff" size="954" author="fuzzylogic" created="Tue, 1 Aug 2006 05:31:30 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 21 Jul 2006 21:45:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22557</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0wvr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39145</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10051"><![CDATA[Urgent]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>