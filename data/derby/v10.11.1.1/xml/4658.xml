<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:08:06 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4658/DERBY-4658.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4658] Allow explicit casts of string values to BOOLEAN</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4658</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The SQL Standard allows strings to be explicitly cast to BOOLEAN values. Strings are the only type (other than BOOLEAN itself) which can be cast to BOOLEAN. As part of our expanding support for the BOOLEAN datatype, we should allow these casts.&lt;/p&gt;

&lt;p&gt;Casting string types to boolean is defined by part 2, section 6.12 (&amp;lt;cast specification&amp;gt;), general rule 20:&lt;/p&gt;

&lt;p&gt;a) Trim whitespace off the string&lt;/p&gt;

&lt;p&gt;b) Then apply the rules in section 5.3 (&amp;lt;literal&amp;gt;). This means that the trimmed string must be &apos;TRUE&apos;, &apos;FALSE&apos;, or &apos;UNKNOWN&apos;, regardless of case.&lt;/p&gt;

&lt;p&gt;c) Otherwise, raise an exception.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12464439">DERBY-4658</key>
            <summary>Allow explicit casts of string values to BOOLEAN</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Rick Hillegas</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 May 2010 17:04:02 +0100</created>
                <updated>Fri, 23 May 2014 14:35:21 +0100</updated>
                            <resolved>Fri, 18 Jun 2010 13:18:15 +0100</resolved>
                                                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12879429" author="rhillegas" created="Wed, 16 Jun 2010 19:04:16 +0100"  >&lt;p&gt;Attaching derby-4658-01-aa-booleanCasts.diff. This patch makes it possible to cast values to BOOLEAN. I need to run regression tests.&lt;/p&gt;

&lt;p&gt;Makes the following changes:&lt;/p&gt;

&lt;p&gt;1) Makes parser accept CAST (... AS BOOLEAN)&lt;/p&gt;

&lt;p&gt;2) Allows those casts to succeed provided that the source datatype is a string and the actual value satisfies the SQL Standard&apos;s rules.&lt;/p&gt;

&lt;p&gt;3) Adds regression tests for this feature.&lt;/p&gt;

&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;--------------&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/compile/sqlgrammar.jj&lt;/p&gt;

&lt;p&gt;Parser now accepts explicit casts to BOOLEAN.&lt;/p&gt;

&lt;p&gt;--------------&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/compile/CastNode.java&lt;br/&gt;
M      java/engine/org/apache/derby/impl/sql/compile/BooleanConstantNode.java&lt;br/&gt;
M      java/engine/org/apache/derby/iapi/types/SQLBoolean.java&lt;/p&gt;

&lt;p&gt;Standard support for the string value &quot;UNKNOWN&quot;.&lt;/p&gt;

&lt;p&gt;--------------&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/lang/BooleanValuesTest.java&lt;/p&gt;

&lt;p&gt;Regression tests.&lt;/p&gt;</comment>
                            <comment id="12879720" author="knutanders" created="Thu, 17 Jun 2010 10:28:33 +0100"  >&lt;p&gt;The patch looks fine to me. Some minor comments, though:&lt;/p&gt;

&lt;p&gt;In BooleanConstantNode.init(), would it be better to pass Boolean.TRUE as the second argument to super.init()? That&apos;s the argument that specifies nullability. Perhaps that would also remove the need to call setNullability(true) in CastNode?&lt;/p&gt;

&lt;p&gt;The tests look fairly complete, but they all use true/false/unknown in lowercase. Would it be worthwhile to add a test case to verify that strings with upper case or mixed case also can be cast to boolean?&lt;/p&gt;

&lt;p&gt;And, a nit, this change in BooleanConstantNode.init() is unnecessary since (arg1 instanceof Boolean) implies (arg1 != null):&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (arg1 instanceof Boolean)&lt;br/&gt;
+		if ( (arg1 != null) &amp;amp;&amp;amp; (arg1 instanceof Boolean) )&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Perhaps, for clarity, it may be better to have the null case first, though:&lt;/p&gt;

&lt;p&gt;if (arg1 == null) &lt;/p&gt;
{
    ...
} else if (arg1 instanceof Boolean) {
    ...
}
&lt;p&gt; else &lt;/p&gt;
{
    ...
}</comment>
                            <comment id="12879792" author="rhillegas" created="Thu, 17 Jun 2010 15:30:56 +0100"  >&lt;p&gt;Thanks for the quick review, Knut. I have incorporated your suggestions in the next version of this patch, which I am attaching: derby-4658-01-ab-booleanCasts.diff. I plan to commit this revised patch if the tests pass.&lt;/p&gt;

&lt;p&gt;In the LangScripts test there was a diff, which this new patch addresses too:&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/master/cast.out&lt;/p&gt;

&lt;p&gt;An error message changed because casts to BOOLEAN now pass the parser.&lt;/p&gt;</comment>
                            <comment id="12879798" author="knutanders" created="Thu, 17 Jun 2010 16:01:45 +0100"  >&lt;p&gt;Thanks, Rick. I see that CastNode still calls cn.setNullability(true). Weren&apos;t the changes in BooleanConstantNode.init() sufficient to get the nullability correctly initialized?&lt;/p&gt;</comment>
                            <comment id="12879809" author="rhillegas" created="Thu, 17 Jun 2010 16:34:44 +0100"  >&lt;p&gt;Hi Knut. Thanks for taking a look at the new patch. I don&apos;t think that the changes in BooleanConstantNode affect the line in CastNode which you&apos;re referring to. The problem there is that the nullability of the CastNode is copied from the nullability of the source cast operand. In the following statement&lt;/p&gt;

&lt;p&gt;  cast ( &apos;unknown&apos; as boolean )&lt;/p&gt;

&lt;p&gt;the source operand is a string constant which is not nullable, but the result of the cast is nullable--in fact, it is NULL.&lt;/p&gt;</comment>
                            <comment id="12879814" author="rhillegas" created="Thu, 17 Jun 2010 16:40:49 +0100"  >&lt;p&gt;On second thought, Knut, you may be right. You are welcome to sand this down further after I commit this patch.&lt;/p&gt;</comment>
                            <comment id="12879832" author="rhillegas" created="Thu, 17 Jun 2010 17:26:36 +0100"  >&lt;p&gt;Tests passed cleanly for me. Committed derby-4658-01-ab-booleanCasts.diff at revision 955666.&lt;/p&gt;</comment>
                            <comment id="12880123" author="knutanders" created="Fri, 18 Jun 2010 09:43:29 +0100"  >&lt;p&gt;I followed the calls from ConstantNode.init(), and it does seem like the data type of the constant is initialized with the nullability specified in the second argument. I tried to apply the first patch and remove the call to setNullability(), and then BooleanValuesTest failed in test_08_stringCasts, but only in client/server mode. When I applied the second patch, BooleanValuesTest ran cleanly also with setNullability() removed.&lt;/p&gt;

&lt;p&gt;The attached patch nullability.diff adds a new test case that tests the nullability explicitly. It fails (also in embedded mode) when setNullability() is removed from the first patch, and runs cleanly when setNullability() is removed from the second patch. The patch also removes the call to setNullability() from CastNode.&lt;/p&gt;</comment>
                            <comment id="12880165" author="knutanders" created="Fri, 18 Jun 2010 12:22:22 +0100"  >&lt;p&gt;All the regression tests ran cleanly. Committed revision 955940.&lt;/p&gt;</comment>
                            <comment id="12880174" author="rhillegas" created="Fri, 18 Jun 2010 13:18:15 +0100"  >&lt;p&gt;Thanks, Knut.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12313174">DERBY-499</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12716315">DERBY-6584</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12447246" name="derby-4658-01-aa-booleanCasts.diff" size="13752" author="rhillegas" created="Wed, 16 Jun 2010 19:04:16 +0100"/>
                            <attachment id="12447346" name="derby-4658-01-ab-booleanCasts.diff" size="15689" author="rhillegas" created="Thu, 17 Jun 2010 15:30:56 +0100"/>
                            <attachment id="12447441" name="nullability.diff" size="2783" author="knutanders" created="Fri, 18 Jun 2010 09:43:29 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 17 Jun 2010 09:28:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31318</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0oz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37864</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>