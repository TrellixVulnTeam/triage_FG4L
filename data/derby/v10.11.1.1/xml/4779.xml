<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:19:44 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4779/DERBY-4779.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4779] NPE while inserting into a table which has a generated column and an insert trigger</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4779</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The following script generates an NPE on the concluding insert:&lt;/p&gt;

&lt;p&gt;connect &apos;jdbc:derby:memory:dummy;create=true&apos;;&lt;/p&gt;

&lt;p&gt;create function getRegion( v int )&lt;br/&gt;
returns varchar( 20 )&lt;br/&gt;
language java parameter style java deterministic no sql&lt;br/&gt;
external name &apos;java.lang.Integer.toString&apos;&lt;br/&gt;
;&lt;/p&gt;

&lt;p&gt;create table orders&lt;br/&gt;
(&lt;br/&gt;
    orderID bigint primary key,&lt;br/&gt;
    salesPrice int not null,&lt;br/&gt;
    region generated always as ( getRegion( salesPrice ) )&lt;br/&gt;
)&lt;br/&gt;
;&lt;br/&gt;
create table dummy( a int );&lt;/p&gt;

&lt;p&gt;create trigger newOrderTrigger&lt;br/&gt;
after insert on orders&lt;br/&gt;
for each row&lt;br/&gt;
insert into dummy( a ) values ( 1 )&lt;br/&gt;
;&lt;/p&gt;

&lt;p&gt;insert into orders( orderID, salesPrice ) values ( 1, 2 )&lt;br/&gt;
;&lt;/p&gt;

&lt;p&gt;------------------------&lt;/p&gt;


&lt;p&gt;Here is the NPE:&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.DMLWriteResultSet.objectifyStreams(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.DMLWriteResultSet.getNextRowCore(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.InsertResultSet.open(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.go(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.main(Unknown Source)&lt;br/&gt;
	at org.apache.derby.tools.ij.main(Unknown Source)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12471838">DERBY-4779</key>
            <summary>NPE while inserting into a table which has a generated column and an insert trigger</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="siddharthsrivastava">Siddharth Srivastava</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                            <label>derby_triage10_8</label>
                    </labels>
                <created>Tue, 17 Aug 2010 20:40:50 +0100</created>
                <updated>Fri, 14 Jun 2013 18:34:01 +0100</updated>
                            <resolved>Fri, 16 Mar 2012 21:19:56 +0000</resolved>
                                    <version>10.5.3.0</version>
                    <version>10.6.1.0</version>
                    <version>10.7.1.1</version>
                                    <fixVersion>10.5.3.2</fixVersion>
                    <fixVersion>10.6.2.4</fixVersion>
                    <fixVersion>10.7.1.4</fixVersion>
                    <fixVersion>10.8.2.2</fixVersion>
                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13011853" author="siddharthsrivastava" created="Sun, 27 Mar 2011 22:45:22 +0100"  >&lt;p&gt;Updating the error log to include the line numbers where the error occurs (previous log consisted of UNKNOWN SOURCE in place of linu numbers)&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.DMLWriteResultSet.objectifyStreams(DMLWriteResultSet.java:155)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.DMLWriteResultSet.getNextRowCore(DMLWriteResultSet.java:135)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:504)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:436)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:317)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1242)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:630)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:559)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:367)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:521)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:363)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:261)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.go(Main.java:229)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:184)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.main(Main.java:75)&lt;br/&gt;
	at org.apache.derby.tools.ij.main(ij.java:59)&lt;br/&gt;
	at org.apache.derby.iapi.tools.run.main(run.java:53)&lt;/p&gt;</comment>
                            <comment id="13046230" author="siddharthsrivastava" created="Wed, 8 Jun 2011 22:20:49 +0100"  >&lt;p&gt;The patch for this issue is attached. (The regression tests are going on)&lt;/p&gt;

&lt;p&gt;The NPE doesn&apos;t occur after the concluding insert anymore.&lt;/p&gt;

&lt;p&gt;Verified that the trigger is fired after insert:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; select * from dummy;&lt;br/&gt;
A&lt;br/&gt;
-----------&lt;br/&gt;
1&lt;/p&gt;

&lt;p&gt;1 row selected&lt;/p&gt;</comment>
                            <comment id="13047095" author="siddharthsrivastava" created="Fri, 10 Jun 2011 10:18:00 +0100"  >&lt;p&gt;Regression Test Update: The patch has passed the regression test.&lt;/p&gt;</comment>
                            <comment id="13047276" author="rhillegas" created="Fri, 10 Jun 2011 17:32:04 +0100"  >&lt;p&gt;Thanks for the patch, Siddharth. It looks good to me. Just needs a regression test case--you might want to add a test case to GeneratedColumnsTest. Thanks!&lt;/p&gt;</comment>
                            <comment id="13052102" author="siddharthsrivastava" created="Mon, 20 Jun 2011 18:52:19 +0100"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;I have added the test for this test. &lt;br/&gt;
I tried to maintain the existing structure, but I get the following error when I run the test: &lt;/p&gt;

&lt;p&gt;There was 1 failure:&lt;br/&gt;
1) test_007_basicTriggers(org.apache.derbyTesting.functionTests.tests.lang.Gener&lt;br/&gt;
atedColumnsTest)junit.framework.AssertionFailedError&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.lang.GeneratedColumnsHelp&lt;br/&gt;
er.assertResults(GeneratedColumnsHelper.java:379)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.lang.GeneratedColumnsTest&lt;br/&gt;
.assertTriggerStatus(GeneratedColumnsTest.java:5575)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.lang.GeneratedColumnsTest&lt;br/&gt;
.test_007_basicTriggers(GeneratedColumnsTest.java:1037)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:&lt;br/&gt;
112)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57&lt;br/&gt;
)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;/p&gt;

&lt;p&gt;How can I verify the contents of the table this way ?&lt;/p&gt;</comment>
                            <comment id="13052162" author="rhillegas" created="Mon, 20 Jun 2011 20:05:08 +0100"  >&lt;p&gt;Hi Siddharth,&lt;/p&gt;

&lt;p&gt;You seem to be calling assertTriggerStatus() in order to confirm the behavior of the table and trigger you added. That method verifies the behavior of triggers which call the report_proc procedure. Your trigger doesn&apos;t call report_proc. Instead, your trigger just inserts into a dummy table. To verify the operation of your trigger, you need to verify the contents of the dummy table. To fix the test, I would do one of the following:&lt;/p&gt;

&lt;p&gt;1) Rewrite your trigger so that it calls report_proc like the other triggers in test_007_basicTriggers().&lt;/p&gt;

&lt;p&gt;2) Or rewrite your assertion to invoke assertResults() rather than assertTriggerStatus().&lt;/p&gt;

&lt;p&gt;Hope this helps,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13054918" author="siddharthsrivastava" created="Sat, 25 Jun 2011 16:17:38 +0100"  >&lt;p&gt;The attached diff contains the fix and the test for the same.&lt;/p&gt;</comment>
                            <comment id="13055089" author="siddharthsrivastava" created="Sun, 26 Jun 2011 15:27:49 +0100"  >&lt;p&gt;Update: The patch has passed the regression tests&lt;/p&gt;</comment>
                            <comment id="13055619" author="rhillegas" created="Mon, 27 Jun 2011 17:07:03 +0100"  >&lt;p&gt;Thanks for the revised patch with test, Siddharth. Looks good to me. Committed at subversion revision 1140222. Regression tests passed cleanly for me except for a ping test problem which does not seem to be related to your patch:&lt;/p&gt;

&lt;p&gt;1) testPingWithWrongHost(org.apache.derbyTesting.functionTests.tests.derbynet.NetworkServerControlClientCommandTest)junit.framework.AssertionFailedError: Could not find expectedString:Unable to find host in output:Mon Jun 27 07:21:11 PDT 2011 : Could not connect to Derby Network Server on host nothere, port 1527: Operation timed out&lt;/p&gt;

&lt;p&gt;	at org.apache.derbyTesting.junit.BaseTestCase.assertExecJavaCmdAsExpected(BaseTestCase.java:516)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.NetworkServerControlClientCommandTest.assertFailedPing(NetworkServerControlClientCommandTest.java:147)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.NetworkServerControlClientCommandTest.testPingWithWrongHost(NetworkServerControlClientCommandTest.java:112)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;br/&gt;
Tests run: 9164,  Failures: 1,  Errors: 0&lt;/p&gt;
</comment>
                            <comment id="13086557" author="kmarsden" created="Wed, 17 Aug 2011 21:02:42 +0100"  >&lt;p&gt;This looks like  a good candidate for backport.&lt;/p&gt;</comment>
                            <comment id="13089600" author="myrna" created="Tue, 23 Aug 2011 18:20:11 +0100"  >&lt;p&gt;reopen for backport to 10.8&lt;/p&gt;</comment>
                            <comment id="13089925" author="myrna" created="Wed, 24 Aug 2011 02:06:55 +0100"  >&lt;p&gt;backported to 10.8 with revision 1160950.&lt;/p&gt;</comment>
                            <comment id="13229390" author="kmarsden" created="Wed, 14 Mar 2012 17:19:49 +0000"  >&lt;p&gt;Reopen for 10.5 backport consideration. If working on the backport for this issue. Temporarily assign yourself and add a comment that you are working on it. When finished, reresolve with the new fix versions or label backport_reject_10_x as appropriate.&lt;/p&gt;</comment>
                            <comment id="13231359" author="kmarsden" created="Fri, 16 Mar 2012 16:40:03 +0000"  >&lt;p&gt;Reassigning to myself for backport&lt;/p&gt;</comment>
                            <comment id="13231412" author="kmarsden" created="Fri, 16 Mar 2012 17:33:43 +0000"  >&lt;p&gt;10.5 required manual merge. Attaching patch derby-4779_10_5_diff.txt &lt;/p&gt;</comment>
                            <comment id="13231639" author="kmarsden" created="Fri, 16 Mar 2012 21:19:56 +0000"  >&lt;p&gt;Resolving and reassigning to Siddharth. Ported back to 10.5 along with &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5304&quot; title=&quot;test_derby_4779 (lang.GeneratedColumnsTest) fails with ibm 1.4.2; ERROR 42X50; No method was found that matched the method call java.lang.Integer.signum(int)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5304&quot;&gt;&lt;del&gt;DERBY-5304&lt;/del&gt;&lt;/a&gt; &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12546430">DERBY-5654</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12483820" name="d4779.diff" size="5148" author="siddharthsrivastava" created="Sat, 25 Jun 2011 16:17:38 +0100"/>
                            <attachment id="12481869" name="d4779.diff" size="2488" author="siddharthsrivastava" created="Wed, 8 Jun 2011 22:20:49 +0100"/>
                            <attachment id="12518708" name="derby-4779_10_5_diff.txt" size="5975" author="kmarsden" created="Fri, 16 Mar 2012 17:33:43 +0000"/>
                            <attachment id="12483182" name="test1.diff" size="6697" author="siddharthsrivastava" created="Mon, 20 Jun 2011 18:52:19 +0100"/>
                            <attachment id="12483183" name="testreport.txt" size="1382" author="siddharthsrivastava" created="Mon, 20 Jun 2011 18:52:19 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 27 Mar 2011 21:45:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24460</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10422"><![CDATA[High Value Fix]]></customfieldvalue>
    <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0cnj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35868</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>