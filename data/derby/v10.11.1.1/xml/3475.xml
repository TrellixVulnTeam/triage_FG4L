<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:24:36 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3475/DERBY-3475.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3475] Replication:  Slave reports ERROR XSLA7: Cannot redo operation null in the log.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3475</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Master:&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby:masterDB;user=oystein;password=pass;startMaster=true;slaveHost=localhost&apos;;&lt;br/&gt;
ij(CONNECTION1)&amp;gt; delete from t where i &amp;gt; 8192;&lt;br/&gt;
253952 rows inserted/updated/deleted&lt;br/&gt;
ij(CONNECTION1)&amp;gt; connect &apos;jdbc:derby:masterDB;user=oystein;password=pass;failover=true&apos;;&lt;br/&gt;
ERROR XJ001: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;/p&gt;

&lt;p&gt;Slave reports in the log:&lt;/p&gt;


&lt;p&gt;------------  BEGIN SHUTDOWN ERROR STACK -------------&lt;/p&gt;

&lt;p&gt;ERROR XSLA7: Cannot redo operation null in the log.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:296)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1525)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:920)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:334)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)&lt;br/&gt;
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:1019)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)&lt;br/&gt;
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:793)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:205)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.bootBasicDatabase(SlaveDatabase.java:425)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.access$000(SlaveDatabase.java:70)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase$SlaveDatabaseBootThread.run(SlaveDatabase.java:312)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
Caused by: ERROR XSLAO: Recovery failed unexpected problem log record is Not first but transaction is not in transaction table : 58625.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1289)&lt;br/&gt;
	... 17 more&lt;br/&gt;
============= begin nested exception, level (1) ===========&lt;br/&gt;
ERROR XSLAO: Recovery failed unexpected problem log record is Not first but transaction is not in transaction table : 58625.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1289)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:920)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:334)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)&lt;br/&gt;
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:1019)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)&lt;br/&gt;
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:793)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:205)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.bootBasicDatabase(SlaveDatabase.java:425)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.access$000(SlaveDatabase.java:70)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase$SlaveDatabaseBootThread.run(SlaveDatabase.java:312)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
============= end nested exception, level (1) ===========&lt;/p&gt;


&lt;p&gt;------------  END SHUTDOWN ERROR STACK -------------&lt;/p&gt;

&lt;p&gt;--------  BEGIN REPLICATION ERROR MESSAGE ---------&lt;br/&gt;
Replication slave got a fatal error for database &apos;slaveDB&apos;. Replication will be stopped.&lt;br/&gt;
Replication slave role was stopped for database &apos;slaveDB&apos;.&lt;/p&gt;

&lt;p&gt;2008-02-27 12:03:00.830 GMT:&lt;br/&gt;
Shutting down instance a816c00e-0118-5ac5-f06b-000003e6d478&lt;br/&gt;
----------------------------------------------------------------&lt;br/&gt;
ERROR XSLAA: The store has been marked for shutdown by an earlier exception.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:279)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.LogToFile.appendLogRecord(LogToFile.java:3696)&lt;br/&gt;
	at org.apache.derby.impl.services.replication.slave.SlaveController$SlaveLogReceiverThread.handleLogChunk(SlaveController.java:540)&lt;br/&gt;
	at org.apache.derby.impl.services.replication.slave.SlaveController$SlaveLogReceiverThread.run(SlaveController.java:486)&lt;br/&gt;
Caused by: ERROR XSLA7: Cannot redo operation null in the log.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:296)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1525)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:920)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:334)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)&lt;br/&gt;
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:1019)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)&lt;br/&gt;
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:793)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:205)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.bootBasicDatabase(SlaveDatabase.java:425)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.access$000(SlaveDatabase.java:70)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase$SlaveDatabaseBootThread.run(SlaveDatabase.java:312)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
Caused by: ERROR XSLAO: Recovery failed unexpected problem log record is Not first but transaction is not in transaction table : 58625.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1289)&lt;br/&gt;
	... 17 more&lt;br/&gt;
============= begin nested exception, level (1) ===========&lt;br/&gt;
ERROR XSLA7: Cannot redo operation null in the log.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:296)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1525)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:920)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:334)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)&lt;br/&gt;
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:1019)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)&lt;br/&gt;
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:793)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:205)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.bootBasicDatabase(SlaveDatabase.java:425)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.access$000(SlaveDatabase.java:70)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase$SlaveDatabaseBootThread.run(SlaveDatabase.java:312)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
Caused by: ERROR XSLAO: Recovery failed unexpected problem log record is Not first but transaction is not in transaction table : 58625.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1289)&lt;br/&gt;
	... 17 more&lt;br/&gt;
============= end nested exception, level (1) ===========&lt;br/&gt;
============= begin nested exception, level (2) ===========&lt;br/&gt;
ERROR XSLAO: Recovery failed unexpected problem log record is Not first but transaction is not in transaction table : 58625.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1289)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:920)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:334)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)&lt;br/&gt;
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:1019)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)&lt;br/&gt;
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:793)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:205)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.bootBasicDatabase(SlaveDatabase.java:425)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.access$000(SlaveDatabase.java:70)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase$SlaveDatabaseBootThread.run(SlaveDatabase.java:312)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
============= end nested exception, level (2) ===========&lt;/p&gt;

&lt;p&gt;---------  END REPLICATION ERROR MESSAGE ----------&lt;br/&gt;
Replication slave role was stopped for database &apos;slaveDB&apos;.&lt;/p&gt;
</description>
                <environment>Derby trunk revision 631534 + DERBY 3205 patch failover-slave-2a.</environment>
        <key id="12389682">DERBY-3475</key>
            <summary>Replication:  Slave reports ERROR XSLA7: Cannot redo operation null in the log.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jorgenlo">J&#248;rgen L&#248;land</assignee>
                                    <reporter username="oysteing">&#216;ystein Gr&#248;vlen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Feb 2008 12:44:05 +0000</created>
                <updated>Tue, 4 Mar 2008 11:40:01 +0000</updated>
                            <resolved>Tue, 4 Mar 2008 10:54:54 +0000</resolved>
                                    <version>10.4.1.3</version>
                                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12572898" author="oysteing" created="Wed, 27 Feb 2008 12:51:37 +0000"  >&lt;p&gt;If I try to do recovery on the slave database, I get the same error again:&lt;/p&gt;

&lt;p&gt;------------  BEGIN SHUTDOWN ERROR STACK -------------&lt;/p&gt;

&lt;p&gt;ERROR XSLA7: Cannot redo operation null in the log.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:296)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1525)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:920)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:334)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)&lt;br/&gt;
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:1019)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)&lt;br/&gt;
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:793)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:205)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1836)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(BaseMonitor.java:1702)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(BaseMonitor.java:1582)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:1001)&lt;br/&gt;
	at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Monitor.java:542)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:2369)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:336)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(EmbedConnection30.java:73)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection40.&amp;lt;init&amp;gt;(EmbedConnection40.java:54)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:68)&lt;br/&gt;
	at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:226)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:119)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(DriverManager.java:582)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(DriverManager.java:154)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.ij.dynamicConnection(ij.java:1238)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.ij.ConnectStatement(ij.java:1088)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.ij.ijStatement(ij.java:916)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:328)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:248)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.go(Main.java:215)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.main(Main.java:73)&lt;br/&gt;
	at org.apache.derby.tools.ij.main(ij.java:59)&lt;br/&gt;
	at org.apache.derby.iapi.tools.run.main(run.java:51)&lt;br/&gt;
Caused by: ERROR XSLAO: Recovery failed unexpected problem log record is Not first but transaction is not in transaction table : 58625.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1289)&lt;br/&gt;
	... 39 more&lt;br/&gt;
============= begin nested exception, level (1) ===========&lt;br/&gt;
ERROR XSLAO: Recovery failed unexpected problem log record is Not first but transaction is not in transaction table : 58625.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1289)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:920)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:334)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)&lt;br/&gt;
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:1019)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)&lt;br/&gt;
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:793)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:205)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1836)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(BaseMonitor.java:1702)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(BaseMonitor.java:1582)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:1001)&lt;br/&gt;
	at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Monitor.java:542)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:2369)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:336)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(EmbedConnection30.java:73)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection40.&amp;lt;init&amp;gt;(EmbedConnection40.java:54)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:68)&lt;br/&gt;
	at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:226)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:119)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(DriverManager.java:582)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(DriverManager.java:154)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.ij.dynamicConnection(ij.java:1238)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.ij.ConnectStatement(ij.java:1088)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.ij.ijStatement(ij.java:916)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:328)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:248)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.go(Main.java:215)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.main(Main.java:73)&lt;br/&gt;
	at org.apache.derby.tools.ij.main(ij.java:59)&lt;br/&gt;
	at org.apache.derby.iapi.tools.run.main(run.java:51)&lt;br/&gt;
============= end nested exception, level (1) ===========&lt;/p&gt;


&lt;p&gt;------------  END SHUTDOWN ERROR STACK -------------&lt;/p&gt;</comment>
                            <comment id="12572900" author="oysteing" created="Wed, 27 Feb 2008 13:01:53 +0000"  >&lt;p&gt;slaveDB.zip contains the slave database.&lt;br/&gt;
Doing recovery on this DB should provoke the error.&lt;/p&gt;
</comment>
                            <comment id="12573285" author="jorgenlo" created="Thu, 28 Feb 2008 13:56:43 +0000"  >&lt;p&gt;I have a pretty strong theory on this one:&lt;/p&gt;

&lt;p&gt;connect with startSlave option does the following:&lt;/p&gt;

&lt;p&gt;boot db in pre-slave mode to check authentication. No datapages or log is modified by this boot.&lt;br/&gt;
shutdown db&lt;br/&gt;
boot db in slavemode.&lt;/p&gt;

&lt;p&gt;Theory: When booting up the second time, LogToFile#recover tries to read the last checkpoint. However, the log.ctrl file has been modified by the pre-slave boot and the checkpoint is therefore not found. It then tries to read the log from the beginning, and encounteres a log record that is not in the transaction table and is not a begin transaction. If this theory is correct, we have not noticed earlier because we started out with an empty master, and all log files therefore exist on the slave after the copy.&lt;/p&gt;

&lt;p&gt;I will investigate this further.&lt;/p&gt;</comment>
                            <comment id="12573710" author="jorgenlo" created="Fri, 29 Feb 2008 12:39:47 +0000"  >&lt;p&gt;As expected, the problem was caused by the log.ctrl file pointing to the wrong place in the log. Patch 1a ensures that the control file is not updated when the database is booted in slave pre mode.&lt;/p&gt;

&lt;p&gt;Without the patch, the error can be reproduced by using any master database where some old log files have been deleted.&lt;/p&gt;

&lt;p&gt;All tests passed. Request for review.&lt;/p&gt;</comment>
                            <comment id="12574392" author="oysteing" created="Mon, 3 Mar 2008 09:19:19 +0000"  >&lt;p&gt;If I run ReplicationRun_Local with this patch, the slave fails with the following error:&lt;/p&gt;

&lt;p&gt;2008-03-03 08:56:46.374 GMT:&lt;br/&gt;
Shutting down instance 72e9c096-0118-73db-611b-ffffb3022b6a&lt;br/&gt;
----------------------------------------------------------------&lt;br/&gt;
New exception raised during cleanup 0 &amp;gt;= 0&lt;br/&gt;
java.lang.ArrayIndexOutOfBoundsException: 0 &amp;gt;= 0&lt;br/&gt;
	at java.util.Vector.setElementAt(Vector.java:483)&lt;br/&gt;
	at org.apache.derby.impl.services.daemon.BasicDaemon.unsubscribe(BasicDaemon.java:180)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.LogToFile.stop(LogToFile.java:3402)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.stop(TopService.java:405)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.shutdown(TopService.java:349)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.shutdown(BaseMonitor.java:237)&lt;br/&gt;
	at org.apache.derby.impl.db.DatabaseContextImpl.cleanupOnError(DatabaseContextImpl.java:60)&lt;br/&gt;
	at org.apache.derby.iapi.services.context.ContextManager.cleanupOnError(ContextManager.java:332)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.cleanupOnError(TransactionResourceImpl.java:419)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:337)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2082)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:454)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(EmbedConnection30.java:73)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection40.&amp;lt;init&amp;gt;(EmbedConnection40.java:54)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:68)&lt;br/&gt;
	at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:226)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:119)&lt;br/&gt;
	at org.apache.derby.impl.drda.Database.makeConnection(Database.java:238)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.getConnFromDatabaseName(DRDAConnThread.java:1387)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.verifyUserIdPassword(DRDAConnThread.java:1337)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.parseSECCHK(DRDAConnThread.java:3122)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.parseDRDAConnection(DRDAConnThread.java:1131)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:937)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:279)&lt;br/&gt;
Cleanup action completed&lt;br/&gt;
--------  BEGIN REPLICATION ERROR MESSAGE ---------&lt;br/&gt;
Replication slave got a fatal error for database &apos;/export/tmp/oysteing/derby-repl/testing_repl/db_master/wombat&apos;. Replication will be stopped.&lt;br/&gt;
---------  END REPLICATION ERROR MESSAGE ----------&lt;/p&gt;</comment>
                            <comment id="12574393" author="oysteing" created="Mon, 3 Mar 2008 09:25:40 +0000"  >&lt;p&gt;If I understand the patch correctly, when in replication slave pre&lt;br/&gt;
mode, it both prevents checkpoints from being initiated and makes sure&lt;br/&gt;
a checkpoint is a null op.  Would not just making checkpoint be a null&lt;br/&gt;
op be sufficient?&lt;/p&gt;
</comment>
                            <comment id="12574507" author="jorgenlo" created="Mon, 3 Mar 2008 13:59:36 +0000"  >&lt;p&gt;I agree - it&apos;s easier to read the code if only checkpoint is made a noop. The reported exception illustrates this perfectly. Patch v1b only makes checkpoint a noop. All tests passed. &lt;/p&gt;</comment>
                            <comment id="12574926" author="oysteing" created="Tue, 4 Mar 2008 10:46:07 +0000"  >&lt;p&gt;Patch 1b committed as revision 633419.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12376821" name="derby-3475-1a.diff" size="1486" author="jorgenlo" created="Fri, 29 Feb 2008 12:39:47 +0000"/>
                            <attachment id="12376820" name="derby-3475-1a.stat" size="70" author="jorgenlo" created="Fri, 29 Feb 2008 12:39:47 +0000"/>
                            <attachment id="12376975" name="derby-3475-1b.diff" size="814" author="jorgenlo" created="Mon, 3 Mar 2008 13:59:36 +0000"/>
                            <attachment id="12376621" name="slaveDB.zip" size="4476394" author="oysteing" created="Wed, 27 Feb 2008 13:01:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 28 Feb 2008 13:56:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23658</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0z7j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39522</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>