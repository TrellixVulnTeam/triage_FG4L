<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:24:01 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2701/DERBY-2701.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2701] many sealing violation errors in ibm142 and ibm15 jvm test runs of junit tests.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2701</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The regression runs against the ibm jvms for the past 2 days are seeing 390 errors which I think the majority are coming from this sealing error.&lt;/p&gt;

&lt;p&gt;I am trying to figure out if this is a build/testing machine problem or a real problem introduced by thursday night checkins which included:&lt;br/&gt;
541131 TO 541503:&lt;/p&gt;

&lt;p&gt;I ran in my own client against classes and ibm15 and passed the junit suite.  &lt;/p&gt;

&lt;p&gt;see:&lt;br/&gt;
&lt;a href=&quot;http://people.apache.org/~fuzzylogic/derby_test_results/main/testlog/ibm142/541503-suites.All_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~fuzzylogic/derby_test_results/main/testlog/ibm142/541503-suites.All_diff.txt&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://people.apache.org/~fuzzylogic/derby_test_results/main/testlog/ibm15/541503-suites.All_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~fuzzylogic/derby_test_results/main/testlog/ibm15/541503-suites.All_diff.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;1) PrepareStatementTest:embeddedjava.lang.ExceptionInInitializerError&lt;br/&gt;
	at java.lang.Class.forName1(Native Method)&lt;br/&gt;
	at java.lang.Class.forName(Class.java:180)&lt;br/&gt;
	at org.apache.derbyTesting.junit.DriverManagerConnector.loadJDBCDriver(DriverManagerConnector.java:143)&lt;br/&gt;
	at org.apache.derbyTesting.junit.DriverManagerConnector.openConnection(DriverManagerConnector.java:72)&lt;br/&gt;
	at org.apache.derbyTesting.junit.DriverManagerConnector.openConnection(DriverManagerConnector.java:43)&lt;br/&gt;
	at org.apache.derbyTesting.junit.TestConfiguration.openDefaultConnection(TestConfiguration.java:957)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestSetup.getConnection(BaseJDBCTestSetup.java:74)&lt;br/&gt;
	at org.apache.derbyTesting.junit.CleanDatabaseTestSetup.setUp(CleanDatabaseTestSetup.java:65)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:18)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
Caused by: java.lang.SecurityException: sealing violation: can&apos;t seal package org.apache.derby.iapi.services.io: already loaded&lt;br/&gt;
	at java.net.URLClassLoader.defineClass(URLClassLoader.java:412)&lt;br/&gt;
	at java.net.URLClassLoader.access$500(URLClassLoader.java:109)&lt;br/&gt;
	at java.net.URLClassLoader$ClassFinder.run(URLClassLoader.java:848)&lt;br/&gt;
	at java.security.AccessController.doPrivileged1(Native Method)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(AccessController.java:389)&lt;br/&gt;
	at java.net.URLClassLoader.findClass(URLClassLoader.java:371)&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(ClassLoader.java:570)&lt;br/&gt;
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:442)&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(ClassLoader.java:502)&lt;br/&gt;
	at org.apache.derby.iapi.jdbc.JDBCBoot.boot(Unknown Source)&lt;br/&gt;
	at org.apache.derby.jdbc.EmbeddedDriver.boot(Unknown Source)&lt;br/&gt;
	at org.apache.derby.jdbc.EmbeddedDriver.&amp;lt;clinit&amp;gt;(Unknown Source)&lt;br/&gt;
	... 23 more&lt;/p&gt;</description>
                <environment>am seeing the sealing errors on windows, under ibm15 and ibm142 jvms.  </environment>
        <key id="12370317">DERBY-2701</key>
            <summary>many sealing violation errors in ibm142 and ibm15 jvm test runs of junit tests.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="mikem">Mike Matrigali</reporter>
                        <labels>
                    </labels>
                <created>Sat, 26 May 2007 13:09:11 +0100</created>
                <updated>Mon, 29 Jun 2009 23:43:27 +0100</updated>
                            <resolved>Mon, 28 May 2007 09:48:40 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Build tools</component>
                    <component>Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12499308" author="mikem" created="Sat, 26 May 2007 13:20:20 +0100"  >&lt;p&gt;My best guess so far at what is going on is that it looks like derbytools.jar has classes from the &quot;org.apache.derby.iapi.services.io&quot;&lt;br/&gt;
package, which seem like they should only be in derby.jar.  In build of  541131 the derbytools.jar has way fewer classes than in a build&lt;br/&gt;
of 541503.  I haven&apos;t gotten a chance to narrow down the problem. &lt;/p&gt;

&lt;p&gt;I&apos;ll attach listing of the classes in the 2 jar files.&lt;/p&gt;

&lt;p&gt;My question is whether this is likely a problem with a code checkin, for instance incorrectly using a module where it should not be.  Or  &lt;br/&gt;
has a correct usage somehow just broke the tools that figure out how to make derbytools.jar?&lt;/p&gt;</comment>
                            <comment id="12499309" author="mikem" created="Sat, 26 May 2007 13:22:40 +0100"  >&lt;p&gt;derbytools_build541131.jar.out is the output of jar -tvf on a derbytools.jar build as of 541131&lt;/p&gt;</comment>
                            <comment id="12499310" author="mikem" created="Sat, 26 May 2007 13:23:36 +0100"  >&lt;p&gt;derbytools_build541503.jar.out is the output of a jar -tvf  on a derbytools.jar build from 541503&lt;/p&gt;</comment>
                            <comment id="12499311" author="mikem" created="Sat, 26 May 2007 13:26:29 +0100"  >&lt;p&gt;Am only seeing errors in the junit suite run.  Derbyall finishes either all  clean or mostly clean, no sealing errors.&lt;/p&gt;</comment>
                            <comment id="12499314" author="knutanders" created="Sat, 26 May 2007 15:09:16 +0100"  >&lt;p&gt;FWIW, I noticed the same thing on OpenSolaris and Sun Java 1.5/1.6 with insane jars. It worked when I switched to sane jars.&lt;/p&gt;</comment>
                            <comment id="12499348" author="mikem" created="Sat, 26 May 2007 20:38:50 +0100"  >&lt;p&gt;I have not had a chance to do anymore debugging on this issue, but wanted to summarize some info I learned from myrna about  the environment  that the ibm jvm regressions tests are run.&lt;/p&gt;

&lt;p&gt;1) recently the class path for running the junit suite was changed to not include derby.jar, as it should be automatically &lt;br/&gt;
     brought in as part of other jar&apos;s.  In the regression tests only this suite&apos;s classpath was changed.  The derbyall &lt;br/&gt;
     classpath was not changed so it explicitly has derby.jar in classpath.  Maybe sealing violation only happens if a duplicate&lt;br/&gt;
     class is found in a jar that is faulted in, in this manner?  I am not sure exactly when this change went in but I believe it&lt;br/&gt;
     predated when all these errors started appearing.&lt;/p&gt;

&lt;p&gt;2) some other junit suite runs  against the same set of jars on linux with ibm15, with the old classpath  are not seeing &lt;br/&gt;
     sealing violation.&lt;/p&gt;

&lt;p&gt;If I get time I may kick off a script which does a jar build for each change between 541131 and 541503 to figure out what&lt;br/&gt;
change triggered the bloat in derbytools.jar.  If anyone already has these jars, let me know.&lt;/p&gt;

&lt;p&gt;If anyone knows what the classpath looks like for the sun regression test suites do let the list know.&lt;/p&gt;</comment>
                            <comment id="12499350" author="mikem" created="Sat, 26 May 2007 21:19:59 +0100"  >&lt;p&gt;From doing builds it looks like the following change caused the derbytools.jar bloat.  Again I have no idea if the change is wrong, or if the change just added new requirements to the tools that build the jar files:&lt;br/&gt;
------------------------------------------------------------------------&lt;br/&gt;
r541435 | kahatlen | 2007-05-24 14:21:27 -0700 (Thu, 24 May 2007) | 37 lines&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1440&quot; title=&quot;jdk 1.6 client driver omits SQLStates and chained exceptions in error messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1440&quot;&gt;&lt;del&gt;DERBY-1440&lt;/del&gt;&lt;/a&gt;: jdk 1.6 client driver omits SQLStates and chained exceptions in&lt;br/&gt;
error messages&lt;/p&gt;

&lt;p&gt;While working on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2472&quot; title=&quot;Use Throwable.initCause() to improve error reporting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2472&quot;&gt;&lt;del&gt;DERBY-2472&lt;/del&gt;&lt;/a&gt; I found out what caused this difference between&lt;br/&gt;
the JDBC 3.0 driver and the JDBC 4.0 driver. There are three&lt;br/&gt;
problems. Firstly, StandardException.unexpectedUserException() doesn&apos;t&lt;br/&gt;
recognize that an SQLException is generated Derby since it is not an&lt;br/&gt;
EmbedSQLException. Secondly, TransactionResourceImpl.wrapInSQLException()&lt;br/&gt;
invokes SQLException.setNextException() explicitly so that the required&lt;br/&gt;
chaining/ferrying logic in the exception factory and in EmbedSQLException&apos;s&lt;br/&gt;
constructor is not used. Thirdly,&lt;br/&gt;
SQLException40.wrapArgsForTransportAcrossDRDA() puts a standard&lt;br/&gt;
SQLException, not an EmbedSQLException, in the argument ferry&apos;s&lt;br/&gt;
next-exception chain, which prevents the network server from seeing it as a&lt;br/&gt;
Derby exception.&lt;/p&gt;

&lt;p&gt;The attached patch fixes the problem by&lt;/p&gt;

&lt;p&gt;  1) using SQLExceptionFactory.getArgumentFerry() to find out whether the&lt;br/&gt;
     exception is a Derby exception in unexpectedUserException()&lt;/p&gt;

&lt;p&gt;  2) using factory methods instead of setNextException() to do the chaining&lt;br/&gt;
     in wrapInSQLException()&lt;/p&gt;

&lt;p&gt;  3) improving Util.javaException() so that it sets up a next-exception&lt;br/&gt;
     chain if the Java exception contains nested exceptions&lt;/p&gt;

&lt;p&gt;  4) changing wrapArgsForTransportAcrossDRDA() to create an argument ferry&lt;br/&gt;
     whose next exception is the argument ferry of the main exception&apos;s next&lt;br/&gt;
     exception&lt;/p&gt;

&lt;p&gt;This patch also fixes all the JUnit tests that contain code looking like this:&lt;/p&gt;

&lt;p&gt;    assertStatementError(JDBC.vmSupportsJDBC4() ? &quot;38000&quot; : &quot;42X62&quot;, cSt);&lt;/p&gt;

&lt;p&gt;Now, the check for JDBC level is not needed anymore for those tests.&lt;/p&gt;

&lt;p&gt;------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;U  java\engine\org\apache\derby\impl\jdbc\EmbedResultSet.java&lt;br/&gt;
U  java\engine\org\apache\derby\impl\jdbc\SQLExceptionFactory40.java&lt;br/&gt;
U  java\engine\org\apache\derby\impl\jdbc\Util.java&lt;br/&gt;
U  java\engine\org\apache\derby\impl\jdbc\TransactionResourceImpl.java&lt;br/&gt;
U  java\engine\org\apache\derby\iapi\error\StandardException.java&lt;br/&gt;
U  java\engine\org\apache\derby\jdbc\EmbedXAResource.java&lt;br/&gt;
U  java\testing\org\apache\derbyTesting\functionTests\tests\lang\XMLTypeAndOpsTest.java&lt;br/&gt;
U  java\testing\org\apache\derbyTesting\functionTests\tests\lang\SysDiagVTIMappingTest.java&lt;br/&gt;
U  java\testing\org\apache\derbyTesting\functionTests\tests\lang\ProcedureInTriggerTest.java&lt;br/&gt;
U  java\testing\org\apache\derbyTesting\functionTests\tests\tools\ImportExportLobTest.java&lt;br/&gt;
U  java\testing\org\apache\derbyTesting\functionTests\tests\tools\ImportExportBinaryDataTest.java&lt;br/&gt;
U  java\testing\org\apache\derbyTesting\functionTests\tests\tools\ImportExportTest.java&lt;br/&gt;
Updated to revision 541410.&lt;/p&gt;</comment>
                            <comment id="12499351" author="mikem" created="Sat, 26 May 2007 21:27:12 +0100"  >&lt;p&gt;in case anyone is interested here is the crude ksh script I used to do builds on a per change basis.  I got&lt;br/&gt;
the changes by hand but there must be some magic svn and sed I could have done to get the list between&lt;br/&gt;
2 changes.  &lt;/p&gt;

&lt;p&gt;Someday I would like a script to do a set of builds and run a test to see what change introduced a bug.  Tinderbox is very useful, but often more than one change goes into a tinderbox run.&lt;/p&gt;

&lt;p&gt;you may have to fiddle with the cd&apos;s and ant commands to get it to work in your env.&lt;/p&gt;</comment>
                            <comment id="12499360" author="mikem" created="Sat, 26 May 2007 23:26:42 +0100"  >&lt;p&gt;I narrowed down the problem to just the changes to these 2 files:&lt;br/&gt;
M      java/engine/org/apache/derby/impl/jdbc/Util.java&lt;br/&gt;
M      java/engine/org/apache/derby/iapi/error/StandardException.java&lt;/p&gt;

&lt;p&gt;The change to StandardException adds an import:&lt;br/&gt;
import org.apache.derby.impl.jdbc.Util;&lt;/p&gt;

&lt;p&gt;The class already had an import to another impl file:&lt;br/&gt;
import org.apache.derby.impl.jdbc.EmbedSQLException;&lt;/p&gt;

&lt;p&gt;The util file goes on to import stuff from there.&lt;/p&gt;

&lt;p&gt;I verified that if I comment out the import in StandardException.java and the code that uses it then the derbytools.jar shrinks.&lt;/p&gt;</comment>
                            <comment id="12499366" author="mikem" created="Sun, 27 May 2007 00:50:27 +0100"  >&lt;p&gt;derby2701.diff creates a derbytools.jar that is a lot smaller.   I have not run any tests, as I have not actually been able to reproduce the sealing violation problem on my machine.  The change is to add to the list of packages &lt;br/&gt;
that this tool was already explicitly not includeing for derbytools.jar.  &lt;/p&gt;

&lt;p&gt;If anyone can reproduce the current problem and then apply this and see if it fixes it, let me know.&lt;/p&gt;</comment>
                            <comment id="12499377" author="myrna" created="Sun, 27 May 2007 04:01:32 +0100"  >&lt;p&gt;I could duplicate the behavior on my machine. I&apos;m trying out the patch and will report back.&lt;/p&gt;</comment>
                            <comment id="12499379" author="myrna" created="Sun, 27 May 2007 04:32:50 +0100"  >&lt;p&gt;Unfortunately, I see the same error after applying the patch...&lt;/p&gt;</comment>
                            <comment id="12499401" author="knutanders" created="Sun, 27 May 2007 12:56:13 +0100"  >&lt;p&gt;Thanks for narrowing it down, Mike!&lt;/p&gt;

&lt;p&gt;I think the real problem is that derbytools.jar should not reference StandardException in the first place. It seems like it only uses it where it accesses JDBC 3.0 methods via reflection. The attached patch makes utilMain.java call JDBC 3.0 methods directly and removes the import of StandardException. I haven&apos;t tested the patch yet, but it does remove these classes from derbytools.jar compared to revision 541131:&lt;/p&gt;

&lt;p&gt;9,11d8&lt;br/&gt;
&amp;lt; org/apache/derby/iapi/error/PublicAPI.class&lt;br/&gt;
&amp;lt; org/apache/derby/iapi/error/StandardException$BadMessageArgumentException.class&lt;br/&gt;
&amp;lt; org/apache/derby/iapi/error/StandardException.class&lt;br/&gt;
21d17&lt;br/&gt;
&amp;lt; org/apache/derby/impl/jdbc/EmbedSQLException.class&lt;/p&gt;</comment>
                            <comment id="12499402" author="knutanders" created="Sun, 27 May 2007 13:31:33 +0100"  >&lt;p&gt;The 2701-2 patch removed the sealing violation problem on my machine.&lt;br/&gt;
Committed revision 541977.&lt;/p&gt;</comment>
                            <comment id="12499403" author="knutanders" created="Sun, 27 May 2007 13:38:48 +0100"  >&lt;p&gt;Would it make sense to seal org.apache.derby.iapi.error and org.apache.derby.impl.jdbc now that derby.jar is the only jar file which contains classes from those packages? Attaching patch (2701-3) which modifies build.xml so that those packages are sealed.&lt;/p&gt;</comment>
                            <comment id="12499504" author="knutanders" created="Mon, 28 May 2007 09:48:40 +0100"  >&lt;p&gt;Sealed the two packages and committed revision 542155.&lt;/p&gt;</comment>
                            <comment id="12559482" author="dyret" created="Wed, 16 Jan 2008 13:02:23 +0000"  >&lt;p&gt;Blocker issues that have been &apos;Resolved&apos; for a long time (6 months+)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12358324" name="2701-2.diff" size="3772" author="knutanders" created="Sun, 27 May 2007 12:56:13 +0100"/>
                            <attachment id="12358325" name="2701-3.diff" size="856" author="knutanders" created="Sun, 27 May 2007 13:38:48 +0100"/>
                            <attachment id="12358319" name="derby2701.diff" size="694" author="mikem" created="Sun, 27 May 2007 00:50:27 +0100"/>
                            <attachment id="12358301" name="derbytools_build541131.jar.out" size="7239" author="mikem" created="Sat, 26 May 2007 13:22:40 +0100"/>
                            <attachment id="12358302" name="derbytools_build541503.jar.out" size="69824" author="mikem" created="Sat, 26 May 2007 13:23:36 +0100"/>
                            <attachment id="12358312" name="dobuilds2.ksh" size="584" author="mikem" created="Sat, 26 May 2007 21:27:12 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 26 May 2007 14:09:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23189</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0vxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38991</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>