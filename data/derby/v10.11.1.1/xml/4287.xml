<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:12:57 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4287/DERBY-4287.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4287] call to System.getProperty in BCClass.java is not wrapped in a priv block so may fail when running under SecurityManager</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4287</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I noticed in org.apache.derby.impl.services.bytecode.BCClass.java we have this code:&lt;/p&gt;

&lt;p&gt;			String systemHome = System.getProperty(Property.SYSTEM_HOME_PROPERTY,&quot;.&quot;);&lt;br/&gt;
				writeClassFile(systemHome,false,null);&lt;/p&gt;


&lt;p&gt;which will fail when run under security manager because we have no privilege block.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12428686">DERBY-4287</key>
            <summary>call to System.getProperty in BCClass.java is not wrapped in a priv block so may fail when running under SecurityManager</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kmarsden">Kathey Marsden</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Jun 2009 18:52:15 +0100</created>
                <updated>Wed, 12 Jan 2011 22:24:31 +0000</updated>
                            <resolved>Fri, 26 Jun 2009 17:18:27 +0100</resolved>
                                    <version>10.1.3.1</version>
                    <version>10.2.2.0</version>
                    <version>10.3.3.0</version>
                    <version>10.4.2.0</version>
                    <version>10.5.1.1</version>
                    <version>10.6.1.0</version>
                                    <fixVersion>10.1.3.3</fixVersion>
                    <fixVersion>10.2.2.1</fixVersion>
                    <fixVersion>10.3.3.1</fixVersion>
                    <fixVersion>10.4.2.1</fixVersion>
                    <fixVersion>10.5.2.0</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12723382" author="kmarsden" created="Wed, 24 Jun 2009 01:36:06 +0100"  >&lt;p&gt;confirmed the problem by starting network server with the default security manager and running&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby://localhost:1527/wombat&apos;;&lt;br/&gt;
ij&amp;gt; select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from sys.systables;&lt;/p&gt;

&lt;p&gt;Trace in the derby.log is:&lt;br/&gt;
NID = 1), (DATABASE = wombat), (DRDAID = NF000001.GA72-580400156173718907&lt;/p&gt;
{1}
&lt;p&gt;), Failed Statement is: select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from sys.systables&lt;/p&gt;

&lt;p&gt;java.security.AccessControlException: Access denied (java.util.PropertyPermission derby.system.home read)&lt;/p&gt;

&lt;p&gt;	at java.security.AccessControlException.&amp;lt;init&amp;gt;(AccessControlException.java:62)&lt;/p&gt;

&lt;p&gt;	at java.security.AccessController.checkPermission(AccessController.java:68)&lt;/p&gt;

&lt;p&gt;	at java.lang.SecurityManager.checkPermission(SecurityManager.java:532)&lt;/p&gt;

&lt;p&gt;	at java.lang.SecurityManager.checkPropertyAccess(SecurityManager.java:1285)&lt;/p&gt;

&lt;p&gt;	at java.lang.System.getProperty(System.java:378)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.services.bytecode.BCClass.getClassBytecode(BCClass.java:152)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.services.bytecode.GClass.getGeneratedClass(GClass.java:59)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.compile.ExpressionClassBuilder.getGeneratedClass(ExpressionClassBuilder.java:849)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.compile.StatementNode.generate(StatementNode.java:390)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:449)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:88)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:822)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&amp;lt;init&amp;gt;(EmbedPreparedStatement.java:121)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Driver40.java:105)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:1542)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:1423)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.drda.DRDAStatement.prepare(DRDAStatement.java:635)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.drda.DRDAStatement.explicitPrepare(DRDAStatement.java:596)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.drda.DRDAConnThread.parsePRPSQLSTT(DRDAConnThread.java:3701)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:801)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:290)&lt;/p&gt;</comment>
                            <comment id="12723736" author="kmarsden" created="Wed, 24 Jun 2009 22:05:12 +0100"  >&lt;p&gt;Attached is a patch for this issue.  There was also a call to new FileOuputStream which needed wrapping as well, so I did that. I was, however,  a bit perplexed that the creation of the class file still seemed to happen even without the FileOutputStream change.&lt;/p&gt;</comment>
                            <comment id="12723798" author="knutanders" created="Thu, 25 Jun 2009 00:28:11 +0100"  >&lt;p&gt;The default policy grants some file permissions to derbynet.jar. Could that be why it doesn&apos;t choke on the FileOutputStream?&lt;/p&gt;</comment>
                            <comment id="12724081" author="kmarsden" created="Thu, 25 Jun 2009 14:14:39 +0100"  >&lt;p&gt;Thank you Knut, I think that must be the reason.  If I try with ij and the derby_tests.policy file with just the property part of the change. I can get an error on creation of the FileOutputStream.  With the full change the class file is created properly.&lt;/p&gt;

&lt;p&gt;This makes me  wonder if in general, liberal permissions in derbyTesting.jar might be masking security manager issues in the product.&lt;/p&gt;


</comment>
                            <comment id="12724345" author="kmarsden" created="Fri, 26 Jun 2009 00:56:03 +0100"  >&lt;p&gt;I think perhaps the behavior I was seeing where  an unwrapped FileOutputStream creation failed to throw an exception is an IBM 1.6 bug.  The attached program (in fost.zip) does not throw an exception with IBM 1.6, but does with Sun 1.6 and  IBM 1.5.&lt;/p&gt;

&lt;p&gt;To run change the script runfost.sh to have the class/policy file location for fostloc and run the script ./runfost.sh&lt;/p&gt;

&lt;p&gt;IBM 1.6 will complete and create the file myfile.out. Other jvms throw an Exception:&lt;br/&gt;
Exception in thread &quot;main&quot; java.security.AccessControlException: access denied (java.io.FilePermission myfile.out write)&lt;/p&gt;

&lt;p&gt;        at java.security.AccessControlContext.checkPermission(AccessControlContext.java:323)&lt;br/&gt;
        at java.security.AccessController.checkPermission(AccessController.java:546)&lt;br/&gt;
        at java.lang.SecurityManager.checkPermission(SecurityManager.java:532)&lt;br/&gt;
        at java.lang.SecurityManager.checkWrite(SecurityManager.java:962)&lt;br/&gt;
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:169)&lt;br/&gt;
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:131)&lt;br/&gt;
        at FileOutputStreamTest.main(FileOutputStreamTest.java:29)&lt;/p&gt;

&lt;p&gt;(You can also run with the &quot;withdopriv&quot; option to wrap the call correctly) &lt;br/&gt;
I will try to find some documentation that the doPrivileged should be  required when running under security manager.&lt;/p&gt;
</comment>
                            <comment id="12724600" author="kmarsden" created="Fri, 26 Jun 2009 17:18:27 +0100"  >&lt;p&gt;Checked in the fix and backported back to 10.1. When testing the 10..1 fix I encountered &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1537&quot; title=&quot;Boot-time exception when running Derby tests with derbytools.jar in front of derby.jar in the classpath.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1537&quot;&gt;&lt;del&gt;DERBY-1537&lt;/del&gt;&lt;/a&gt; which was never backported to 10.1.  I reversed my classpath order to correct that problem and adjusted the affects version for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1537&quot; title=&quot;Boot-time exception when running Derby tests with derbytools.jar in front of derby.jar in the classpath.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1537&quot;&gt;&lt;del&gt;DERBY-1537&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12411702" name="derby-4287_diff.txt" size="3034" author="kmarsden" created="Wed, 24 Jun 2009 22:05:12 +0100"/>
                            <attachment id="12411874" name="fost.zip" size="1994" author="kmarsden" created="Fri, 26 Jun 2009 00:56:03 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 24 Jun 2009 23:28:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24158</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10423"><![CDATA[Newcomer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0nyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37699</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>