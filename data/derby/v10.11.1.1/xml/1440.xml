<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:29:21 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1440/DERBY-1440.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1440] jdk 1.6 client driver omits SQLStates and chained exceptions in error messages</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1440</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When running some SQL queries through ij that fails it seems like some&lt;br/&gt;
information about chained exceptions is not presented to the user when&lt;br/&gt;
running with the client driver and jdk 1.6.&lt;/p&gt;


&lt;p&gt;One example SQL that fails (taken from the ieptests.sql):&lt;br/&gt;
=========================================================&lt;/p&gt;

&lt;p&gt;ij&amp;gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE (&apos;inventory&apos;, &apos;ORDERTABLE&apos; ,&lt;br/&gt;
&apos;extinout/order.dat&apos;, null, null, null) ;&lt;/p&gt;

&lt;p&gt;When running this in ij the following error message is produced:&lt;/p&gt;



&lt;p&gt;Java 1.6 Embedded driver:&lt;br/&gt;
=========================&lt;/p&gt;

&lt;p&gt;ERROR 38000: The exception &apos;java.sql.SQLSyntaxErrorException: Schema&lt;br/&gt;
&apos;inventory&apos; does not exist&apos; was thrown while evaluating an expression.&lt;br/&gt;
ERROR 42Y07: Schema &apos;inventory&apos; does not exist&lt;/p&gt;


&lt;p&gt;Java 1.5 Client driver:&lt;br/&gt;
=======================&lt;/p&gt;

&lt;p&gt;ERROR 38000: The exception &apos;SQL Exception: Schema &apos;inventory&apos; does not&lt;br/&gt;
exist&apos; was thrown while evaluating an expression. SQLSTATE: 42Y07:&lt;br/&gt;
Schema &apos;inventory&apos; does not exist&lt;/p&gt;


&lt;p&gt;Java 1.6 Client driver:&lt;br/&gt;
=======================&lt;/p&gt;

&lt;p&gt;ERROR 38000: The exception &apos;java.sql.SQLSyntaxErrorException: Schema&lt;br/&gt;
&apos;inventory&apos; does not exist&apos; was thrown while evaluating an expression.&lt;/p&gt;


&lt;p&gt;The bug (or difference) here is that the client driver when running&lt;br/&gt;
with jdk 1.6 does not print the chained exception and SQL state.&lt;br/&gt;
It would be nice to have the same information in the output as what is&lt;br/&gt;
written by the embedded driver (or client driver running with jdk&lt;br/&gt;
1.5).&lt;/p&gt;
</description>
                <environment>Sun JDK 1.6</environment>
        <key id="12344800">DERBY-1440</key>
            <summary>jdk 1.6 client driver omits SQLStates and chained exceptions in error messages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="olav">Olav Sandstaa</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Jun 2006 00:54:48 +0100</created>
                <updated>Fri, 21 Jan 2011 17:49:04 +0000</updated>
                            <resolved>Mon, 28 May 2007 15:01:45 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>JDBC</component>
                    <component>Network Client</component>
                    <component>Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12477468" author="fuzzylogic" created="Fri, 2 Mar 2007 22:00:37 +0000"  >&lt;p&gt;Ran into this converting importExport.java to JUnit. I was rather surprised by the lack of information provided by the JDBC 4 client driver and the fact that the exception message text no longer contained the SQLState of even the top-level exception, not to mention the SQLStates of the nested exceptions.&lt;/p&gt;

&lt;p&gt;Also, linking this to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-310&quot; title=&quot;Document and/or change Derby client code to match behavior with Embedded driver where possible.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-310&quot;&gt;&lt;del&gt;DERBY-310&lt;/del&gt;&lt;/a&gt;, the master client/embedded differences issue. &lt;/p&gt;</comment>
                            <comment id="12477470" author="fuzzylogic" created="Fri, 2 Mar 2007 22:07:50 +0000"  >&lt;p&gt;Readjusting the summary to reflect that this is a general problem and not specific to ij.&lt;/p&gt;</comment>
                            <comment id="12498558" author="knutanders" created="Thu, 24 May 2007 10:23:10 +0100"  >&lt;p&gt;While working on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2472&quot; title=&quot;Use Throwable.initCause() to improve error reporting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2472&quot;&gt;&lt;del&gt;DERBY-2472&lt;/del&gt;&lt;/a&gt; I found out what caused this difference between the JDBC 3.0 driver and the JDBC 4.0 driver. There are three problems. Firstly, StandardException.unexpectedUserException() doesn&apos;t recognize that an SQLException is generated Derby since it is not an EmbedSQLException. Secondly, TransactionResourceImpl.wrapInSQLException() invokes SQLException.setNextException() explicitly so that the required chaining/ferrying logic in the exception factory and in EmbedSQLException&apos;s constructor is not used. Thirdly, SQLException40.wrapArgsForTransportAcrossDRDA() puts a standard SQLException, not an EmbedSQLException, in the argument ferry&apos;s next-exception chain, which prevents the network server from seeing it as a Derby exception.&lt;/p&gt;

&lt;p&gt;The attached patch fixes the problem by&lt;br/&gt;
  1) using SQLExceptionFactory.getArgumentFerry() to find out whether the exception is a Derby exception in unexpectedUserException()&lt;br/&gt;
  2) using factory methods instead of setNextException() to do the chaining in wrapInSQLException()&lt;br/&gt;
  3) improving Util.javaException() so that it sets up a next-exception chain if the Java exception contains nested exceptions&lt;br/&gt;
  4) changing wrapArgsForTransportAcrossDRDA() to create an argument ferry whose next exception is the argument ferry of the main exception&apos;s next exception&lt;/p&gt;

&lt;p&gt;This patch also fixes all the JUnit tests that contain code looking like this:&lt;/p&gt;

&lt;p&gt;    assertStatementError(JDBC.vmSupportsJDBC4() ? &quot;38000&quot; : &quot;42X62&quot;, cSt);&lt;/p&gt;

&lt;p&gt;Now, the check for JDBC level is not needed anymore for those tests.&lt;/p&gt;

&lt;p&gt;Derbyall and suites.All ran cleanly on Java 1.5 and Java 1.6.&lt;/p&gt;</comment>
                            <comment id="12498812" author="oysteing" created="Thu, 24 May 2007 21:30:32 +0100"  >&lt;p&gt;Patch looks good and it solves my issue from &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2496&quot; title=&quot;Implement Blob support for Locators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2496&quot;&gt;&lt;del&gt;DERBY-2496&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
+1 to commit.&lt;/p&gt;

&lt;p&gt;My only comment is that I did not quite follow the changes in TransactionResourceImpl.wrapInSQLException so maybe some explanation would be good there.&lt;br/&gt;
It seems nextSQLException here represents something different from what is handled by setNextException.  Maybe it would be better if it was called something else. Also I do not quite understand the role of seeNextException and the recursive call to wrapInSQLException.&lt;/p&gt;

</comment>
                            <comment id="12498857" author="knutanders" created="Thu, 24 May 2007 22:42:12 +0100"  >&lt;p&gt;Thanks for the review, &#216;ystein! I have committed 1440.diff to trunk with revision 541435 and will address your comments in a follow-up patch by adding more comments to wrapInSQLException(). I agree that nextSQLException should be renamed to something which matches how it&apos;s currently being used.&lt;/p&gt;

&lt;p&gt;The purpose of seeNextException and the recursive call to wrapInSQLException() is to convert a StandardException to an SQLException and add a next pointer from the SQLException to another SQLException which wraps the cause of the StandardException. For the JDBC 3.0 driver, this should have the same effect as before (when it created the SQLException from the StandardException, wrapped the cause of the StandardException and chained them with setNextException()), whereas the JDBC 4.0 driver now will create the correct chain of DRDA ferry wrappers since Util.seeNextException() goes through the exception factory instead of calling setNextException() directly.&lt;/p&gt;</comment>
                            <comment id="12499525" author="knutanders" created="Mon, 28 May 2007 11:43:46 +0100"  >&lt;p&gt;Attaching a follow-up patch to address &#216;ystein&apos;s comments. The patch removes the nextSQLException variable, adds more comments to wrapInSQLException, and also fixes some minor javadoc issues in TransactionResourceImpl.&lt;/p&gt;</comment>
                            <comment id="12499574" author="knutanders" created="Mon, 28 May 2007 15:01:45 +0100"  >&lt;p&gt;Committed the follow-up patch with revision 542232.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="32841">DERBY-310</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12358363" name="1440-followup.diff" size="4370" author="knutanders" created="Mon, 28 May 2007 11:43:46 +0100"/>
                            <attachment id="12358073" name="1440.diff" size="17928" author="knutanders" created="Thu, 24 May 2007 10:23:10 +0100"/>
                            <attachment id="12358074" name="1440.stat" size="976" author="knutanders" created="Thu, 24 May 2007 10:23:10 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 2 Mar 2007 22:00:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22507</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0n47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37563</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>