<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:52:36 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6012/DERBY-6012.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6012] Print thread dump and dump javacore if NetworkServerTestSetup has to kill off the Network Server start up  process due to timeout</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6012</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If Network Server startup hangs or times out as in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5991&quot; title=&quot;SSLTest timed out waiting for network server to start&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5991&quot;&gt;&lt;del&gt;DERBY-5991&lt;/del&gt;&lt;/a&gt;, we should generate a javacore or a thread dump so the cause of the problem can be more easily diagnosed.&lt;/p&gt;</description>
                <environment>&lt;br/&gt;
</environment>
        <key id="12623166">DERBY-6012</key>
            <summary>Print thread dump and dump javacore if NetworkServerTestSetup has to kill off the Network Server start up  process due to timeout</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Dec 2012 16:05:00 +0000</created>
                <updated>Thu, 22 Jan 2015 23:00:13 +0000</updated>
                            <resolved>Thu, 22 Jan 2015 23:00:12 +0000</resolved>
                                    <version>10.8.3.0</version>
                                    <fixVersion>10.10.2.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13528031" author="kmarsden" created="Mon, 10 Dec 2012 16:05:42 +0000"  >&lt;p&gt;Linking to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5991&quot; title=&quot;SSLTest timed out waiting for network server to start&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5991&quot;&gt;&lt;del&gt;DERBY-5991&lt;/del&gt;&lt;/a&gt; as this change will help diagnose that issue.&lt;/p&gt;</comment>
                            <comment id="13535013" author="mamtas" created="Tue, 18 Dec 2012 16:19:43 +0000"  >&lt;p&gt;Kathey, in your earlier comment, I think you meant &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5991&quot; title=&quot;SSLTest timed out waiting for network server to start&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5991&quot;&gt;&lt;del&gt;DERBY-5991&lt;/del&gt;&lt;/a&gt; rather than &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5591&quot; title=&quot;Imprecise wording in documentation in ref man on DROP VIEW&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5591&quot;&gt;&lt;del&gt;DERBY-5591&lt;/del&gt;&lt;/a&gt;. Jira won&apos;t let me change your comment probably because only the owner of the comment can change it.&lt;/p&gt;</comment>
                            <comment id="13535016" author="mamtas" created="Tue, 18 Dec 2012 16:22:41 +0000"  >&lt;p&gt;If I have understood this jira correctly, then attached patch should give more information on threads and dump the java core if we encounter timeout during network server start. Please let me know if there are any comments to the patch.&lt;/p&gt;</comment>
                            <comment id="13536198" author="mamtas" created="Wed, 19 Dec 2012 17:57:33 +0000"  >&lt;p&gt;Committed the attached patch with revision 1423985 into trunk.&lt;/p&gt;</comment>
                            <comment id="13536371" author="knutanders" created="Wed, 19 Dec 2012 20:04:40 +0000"  >&lt;p&gt;@@ -218,6 +220,9 @@ final public class NetworkServerTestSetu&lt;br/&gt;
                         spawnedServer = null;&lt;br/&gt;
                     }&lt;br/&gt;
                     fail(msg);&lt;br/&gt;
+                    //&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6012&quot; title=&quot;Print thread dump and dump javacore if NetworkServerTestSetup has to kill off the Network Server start up  process due to timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6012&quot;&gt;&lt;del&gt;DERBY-6012&lt;/del&gt;&lt;/a&gt; print thread dump and java core&lt;br/&gt;
+                    fail(ExceptionUtil.dumpThreads());&lt;br/&gt;
+                    JVMInfo.javaDump();&lt;br/&gt;
                 }&lt;br/&gt;
             }&lt;br/&gt;
         }&lt;/p&gt;

&lt;p&gt;Won&apos;t the first call to fail() prevent dumpThreads() and javaDump() from getting called?&lt;/p&gt;</comment>
                            <comment id="13536582" author="mamtas" created="Wed, 19 Dec 2012 23:31:11 +0000"  >&lt;p&gt;I should have tried to hand force the failure and see what happens. I just ran the suite with the changes and since there was no failure, I didn&apos;t notice fail(msg) preventing the new code from executing. &lt;/p&gt;

&lt;p&gt;I probably should first call JVMInfo.javaDump(); and then use a StringBuffer to collect the existing error info and add to it the thread dump info and call fail on that string as shown below.&lt;br/&gt;
                    JVMInfo.javaDump();&lt;br/&gt;
                    StringBuffer sb = new StringBuffer(msg);&lt;br/&gt;
                    sb.append(ExceptionUtil.dumpThreads());&lt;br/&gt;
                    fail(sb.toString());&lt;br/&gt;
The code above will replace the existing fail(msg) call;&lt;br/&gt;
Let me if that sounds correct.&lt;/p&gt;</comment>
                            <comment id="13536810" author="mamtas" created="Thu, 20 Dec 2012 06:13:27 +0000"  >&lt;p&gt;Attaching a proof of concept patch where I am forcing the code to fail and confirm that it is indeed doing java core dump and dumping the threads.(I had to do teardown only for testing the force failure, it will not be part of the actual commit). Actual code change will be something like following&lt;br/&gt;
                    //&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6012&quot; title=&quot;Print thread dump and dump javacore if NetworkServerTestSetup has to kill off the Network Server start up  process due to timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6012&quot;&gt;&lt;del&gt;DERBY-6012&lt;/del&gt;&lt;/a&gt; print thread dump and java core&lt;br/&gt;
                    StringBuffer sb = new StringBuffer(msg);&lt;br/&gt;
                    sb.append(ExceptionUtil.dumpThreads());&lt;br/&gt;
                    JVMInfo.javaDump();&lt;br/&gt;
                    fail(sb.toString());&lt;/p&gt;


&lt;p&gt;If the idea of the actual code change looks good, I will go ahead and commit it tomorrow. &lt;/p&gt;</comment>
                            <comment id="13536880" author="knutanders" created="Thu, 20 Dec 2012 09:17:40 +0000"  >&lt;p&gt;Sounds fine to me. Since this is called from test code, maybe it&apos;s cleaner to use functionTests.util.TestUtil.dumpAllStackTracesIfSupported() instead of iapi.error.ExceptionUtil.dumpThread().&lt;/p&gt;</comment>
                            <comment id="13537219" author="mamtas" created="Thu, 20 Dec 2012 18:13:33 +0000"  >&lt;p&gt;Knut, thanks for reviewing the code. functionTests.util.TestUtil.dumpAllStackTracesIfSupported() sounds like a good idea but it takes a PrintWriter argument which we don&apos;t have access to. I can change the signature of functionTests.util.TestUtil.dumpAllStackTracesIfSupported() and have it return the String it writes to PrintWriter. So, the method will check if the PrintWriter is null, if yes, then do nothing. If not null, write the String to the PrintWriter. Additionally, irrespective of the value of PrintWriter, return the String to the caller. Then my code can take that String and send it to fail() method as shown below. Thanks&lt;br/&gt;
                    //&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6012&quot; title=&quot;Print thread dump and dump javacore if NetworkServerTestSetup has to kill off the Network Server start up  process due to timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6012&quot;&gt;&lt;del&gt;DERBY-6012&lt;/del&gt;&lt;/a&gt; print thread dump and java core &lt;br/&gt;
                    StringBuffer sb = new StringBuffer(msg); &lt;br/&gt;
                    sb.append(functionTests.util.TestUtil.dumpAllStackTracesIfSupported(null)); &lt;br/&gt;
                    JVMInfo.javaDump(); &lt;br/&gt;
                    fail(sb.toString()); &lt;/p&gt;

</comment>
                            <comment id="13539635" author="kmarsden" created="Wed, 26 Dec 2012 18:43:26 +0000"  >&lt;p&gt;One troublesome bit is that we want to get the the thread dump of the spawned Network Server process  which is presumably hung.  I think this patch will print the thread dump of the test process which probably won&apos;t be as helpful. I am not sure how to get a thread dump of the spawned process though.&lt;/p&gt;</comment>
                            <comment id="13541226" author="dagw" created="Mon, 31 Dec 2012 02:20:29 +0000"  >&lt;p&gt;I guess you could use jps + jstack?&lt;/p&gt;</comment>
                            <comment id="13557678" author="mamtas" created="Fri, 18 Jan 2013 22:14:27 +0000"  >&lt;p&gt;Dag, is jps+jstack combo more a command line tools? I think we need more of a programmatic way of getting the Network Server process stack trace if we find that we have timed out waiting for the Network Server to start.&lt;/p&gt;</comment>
                            <comment id="13558509" author="dagw" created="Mon, 21 Jan 2013 03:53:42 +0000"  >&lt;p&gt;Yes they are command line tools, but use programmatic APIs that are documented to get that information AFAIK, e.g.&lt;br/&gt;
&lt;a href=&quot;http://javasourcecode.org/html/open-source/jdk/jdk-6u23/sun/jvm/hotspot/bugspot/BugSpotAgent.java.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://javasourcecode.org/html/open-source/jdk/jdk-6u23/sun/jvm/hotspot/bugspot/BugSpotAgent.java.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It could be a non-trivial effort, though...&lt;/p&gt;</comment>
                            <comment id="13584098" author="kristwaa" created="Fri, 22 Feb 2013 08:51:18 +0000"  >&lt;p&gt;I&apos;ve attached an incremental improvement for the error reporting as patch 1a, and committed it to trunk with revision 1448941.&lt;/p&gt;

&lt;p&gt;I don&apos;t know how hard it it to use the programmatic APIs, but I do know that using the command line tools is non-trivial. There are also differences between platforms. One issue is getting the id of the spawned process.&lt;/p&gt;</comment>
                            <comment id="13682809" author="kmarsden" created="Thu, 13 Jun 2013 22:56:59 +0100"  >&lt;p&gt;Removing High Value fix and Newcomer as getting a trace from the launched program will be non-trivial.&lt;/p&gt;</comment>
                            <comment id="13769670" author="mamtas" created="Tue, 17 Sep 2013 17:53:17 +0100"  >&lt;p&gt;Not working on this jira currently&lt;/p&gt;</comment>
                            <comment id="14174715" author="myrna" created="Fri, 17 Oct 2014 05:22:13 +0100"  >&lt;p&gt;I am wondering if we should mark this as either won&apos;t fix (because making a spawned server process dump info is non-trivial) or as fixed (because we did get more information printed from NetworkServerTestSetup)...&lt;/p&gt;</comment>
                            <comment id="14288396" author="myrna" created="Thu, 22 Jan 2015 23:00:13 +0000"  >&lt;p&gt;Resolving this as won&apos;t fix now. &lt;br/&gt;
If there is a reproducible situation the server can be instrumented and more information can be obtained that way. But for intermittent test aggrevation to dump more information it seems the options for getting information are too involved.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12615881">DERBY-5991</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12561507" name="DERBY6012_patch1_diff.txt" size="964" author="mamtas" created="Tue, 18 Dec 2012 16:22:41 +0000"/>
                            <attachment id="12561847" name="DERBY6012_patch2_diff.txt" size="1427" author="mamtas" created="Thu, 20 Dec 2012 06:13:27 +0000"/>
                            <attachment id="12570448" name="derby-6012-1a-error_reporting.diff" size="2987" author="kristwaa" created="Fri, 22 Feb 2013 08:51:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 18 Dec 2012 16:19:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>296773</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyybsf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>234251</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>