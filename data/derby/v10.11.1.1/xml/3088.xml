<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:47:50 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3088/DERBY-3088.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3088] convert to junit, or otherwise eliminate version in tests which require an update of the master in the release management process</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3088</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;There are a number of tests that require a master update every time the version number is bumped.&lt;br/&gt;
This is a tedious and error prone detail in the release management process.&lt;/p&gt;

&lt;p&gt;Currently affected masters are listed in tools/release/build.xml:&lt;br/&gt;
java/testing/org/apache/derbyTesting/functionTests/master/DerbyNetClient/metadata.out&lt;br/&gt;
java/testing/org/apache/derbyTesting/functionTests/master/DerbyNetClient/odbc_metadata.out&lt;br/&gt;
java/testing/org/apache/derbyTesting/functionTests/master/metadata.out&lt;br/&gt;
java/testing/org/apache/derbyTesting/functionTests/master/odbc_metadata.out&lt;br/&gt;
java/testing/org/apache/derbyTesting/functionTests/master/NSinSameJVM.out&lt;br/&gt;
java/testing/org/apache/derbyTesting/functionTests/master/checkToursDB.out&lt;br/&gt;
java/testing/org/apache/derbyTesting/functionTests/master/testclientij.out&lt;br/&gt;
java/testing/org/apache/derbyTesting/functionTests/master/testProperties.out&lt;/p&gt;

&lt;p&gt;It would streamline the release process if these tests in particular were either converted to junit, or if the version numbers would be eliminated.&lt;/p&gt;


&lt;p&gt;Note: there already is a bug for metadata.java conversion: &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2242&quot; title=&quot;Convert jdbcapi/metadata.java to JUnit test.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2242&quot;&gt;&lt;del&gt;DERBY-2242&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12379149">DERBY-3088</key>
            <summary>convert to junit, or otherwise eliminate version in tests which require an update of the master in the release management process</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="myrna">Myrna van Lunteren</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Sep 2007 00:39:05 +0100</created>
                <updated>Wed, 13 Feb 2008 07:34:33 +0000</updated>
                            <resolved>Mon, 4 Feb 2008 23:09:12 +0000</resolved>
                                                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Build tools</component>
                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12537375" author="myrna" created="Wed, 24 Oct 2007 19:20:36 +0100"  >&lt;p&gt;removed metadata* from the list by commenting out the driver version test (it&apos;s already in DatabaseMetadata) with revision 587953.&lt;/p&gt;</comment>
                            <comment id="12548495" author="myrna" created="Wed, 5 Dec 2007 01:20:15 +0000"  >&lt;p&gt;Attaching an attempt of converting testProperties.java to ServerPropertiesTest.java.&lt;br/&gt;
However, this is only an initial patch, the test isn&apos;t workable yet, but I&apos;m sort of stuck.&lt;br/&gt;
I hope someone can review and come up with suggestions.&lt;/p&gt;

&lt;p&gt;The current test has the following awful problems:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;test fixtures testDefaultProperties, testTraceOn, testTraceOff and testLogConnectionsOn attempt to use a setup that starts a networkserver process, but the setup hangs, or at least, as best as I can tell, there&apos;s a timeout waiting for the server to start.&lt;br/&gt;
I tried to imitate what was done in SecureServerTest and SSLTest, but that may be part of the problem (see also &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3248&quot; title=&quot;SecureServerTest needs cleanup runServerCommand, possibly causing test failures when tests are run through ant.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3248&quot;&gt;DERBY-3248&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3250&quot; title=&quot;NetworkServerTestSetup will fail when starting the server as a process if any of the command line arguments contains a space&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3250&quot;&gt;&lt;del&gt;DERBY-3250&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3251&quot; title=&quot;NetworkServerTestSetup.startSeparateProcess() can end up with the server stalled.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3251&quot;&gt;DERBY-3251&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;test fixture testWrongCommands uses NetworkServerControlMain, which is especially awful, because it somewhere does a System.exit. Also, there is no checking of the result yet.  I suspect this will have to do something like the ProcessStream classes of the old test harness.&lt;/li&gt;
	&lt;li&gt;test fixture testDefaultProperties now works for me on windows, but needs to be verified on other platforms.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;One more note re the testDefaultProperties fixture: I did not use a setup for this, because I wanted to test the starting and shutting down of servers with a different port, and the only way I thought of to ensure the priority of the port-setting mechanisms, without hardcoding the port(s), was to not use a setup or decorator, but to start multiple servers in sequence.&lt;br/&gt;
Possibly there is a smarter way to achieve this too...&lt;/p&gt;</comment>
                            <comment id="12550197" author="djd" created="Mon, 10 Dec 2007 21:29:25 +0000"  >&lt;p&gt;I think this code in the decorateTest() is problematic:&lt;/p&gt;

&lt;p&gt;+        NetworkServerTestSetup networkServerTestSetup =&lt;br/&gt;
+            new NetworkServerTestSetup(spt,&lt;br/&gt;
+                startupProps, startupArgs, true, true, &lt;br/&gt;
+                spt._inputStreamHolder);&lt;br/&gt;
+        spt.nsTestSetup = networkServerTestSetup;&lt;br/&gt;
+        Test testSetup =&lt;br/&gt;
+            SecurityManagerSetup.noSecurityManager(networkServerTestSetup);&lt;br/&gt;
+        Test test = TestConfiguration.defaultServerDecorator(testSetup);&lt;br/&gt;
+        test = TestConfiguration.clientServerDecorator(test);&lt;/p&gt;

&lt;p&gt;Two NetworkServerTestSetup decorators are being used, one explicitly and one by clientServerDecorator. Both of these will try to start the server, I believe on the same port, which wil probably lead to hangs.&lt;/p&gt;
</comment>
                            <comment id="12550226" author="djd" created="Mon, 10 Dec 2007 23:02:00 +0000"  >&lt;p&gt;One comment I have to to re-use the code in NetworkServerTestSetup as much as possible and do not duplicate it in this (or any) specific test.&lt;br/&gt;
That is code that starts the server, checks for it coming up, execs the server as a different process etc.&lt;/p&gt;</comment>
                            <comment id="12555447" author="myrna" created="Thu, 3 Jan 2008 00:03:12 +0000"  >&lt;p&gt;Attaching a new patch, which has all 5 tests working.&lt;/p&gt;

&lt;p&gt;If there are no objections, I&apos;d like to commit this.&lt;/p&gt;

&lt;p&gt;I still need to do further recrafting of the first fixture, so it (re)uses junit classes as Dan suggested. I&apos;m open to further suggestions on how to approach this (in this fixture, consecutive servers are started in a variety of mechanisms - that&apos;s what&apos;s being tested - and I find it hard to envisage how one setup would handle this.)&lt;br/&gt;
The current test also still uses  noSecurityManager in one case,  (with -p) I am thinking of modifying that to use the test&apos;s policy file.&lt;br/&gt;
Finally I want to see if I can figure a way to make this test run with classes - currently you&apos;ll get a message complaining about needing derbynet.jar.&lt;br/&gt;
But I&apos;d like to address these issues in a follow up patch.&lt;/p&gt;</comment>
                            <comment id="12559792" author="myrna" created="Thu, 17 Jan 2008 03:10:37 +0000"  >&lt;p&gt;Revision 612684 improves the ServerPropertiesTest a little in that it now runs with either classes or jars - there is one fixture that needs jars, so there&apos;s an if in place.&lt;br/&gt;
Also uses a new BaseTestCase method assertExecJavaCmdAsExpected instead of a similar one just in this test, and modified the test NetworkServerControlClientCommandTest to use it instead of the Utilities method.&lt;br/&gt;
The execJavaCmd method in Utilites would hang on the pr.waitFor() method if there was more than a little data in the buffer, so it didn&apos;t work for all cases I needed to know a java command executed. I left it in place, for now.&lt;/p&gt;


</comment>
                            <comment id="12563166" author="myrna" created="Mon, 28 Jan 2008 15:19:26 +0000"  >&lt;p&gt;Attaching a patch that reworks the ServerPropertiesTest so the first fixture uses NetworkServerTestSetup.&lt;br/&gt;
Reworked NetworkServerTestSetup; added some helper methods and reworked pingForServerStart (to pingForServerUp) so that the method that pings has intelligence about the expected outcome - if the server is expected up, it will ping for a while until the ping is either successful, or timed out; if the server is expected down, it will ping for a while until unsuccessful or timed out. Also made it ping first, before sleeping.&lt;br/&gt;
Reworked Utilities.ExecJavaCmd to only return the Process; the caller then needs to do the appropriate. Reason for this was that previously, if there was a lot of data from pr.getInputStream, the method would hang itsefl on the pr.waitFor().&lt;/p&gt;

&lt;p&gt;This passed suites.All for me.&lt;/p&gt;</comment>
                            <comment id="12564409" author="myrna" created="Thu, 31 Jan 2008 17:18:40 +0000"  >&lt;p&gt;I committed patch &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3088&quot; title=&quot;convert to junit, or otherwise eliminate version in tests which require an update of the master in the release management process&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3088&quot;&gt;&lt;del&gt;DERBY-3088&lt;/del&gt;&lt;/a&gt;_ServerPropertiesTest_3.diff with revision 616982. &lt;br/&gt;
I saw no problems during my testrun,  and the tinderbox also appears clean, and the results for windows at IBM (&lt;a href=&quot;http://people.apache.org/~fuzzylogic/derby_test_results/main/windows/testSummary-current.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~fuzzylogic/derby_test_results/main/windows/testSummary-current.html&lt;/a&gt; - for 616990) also show no new failures.&lt;/p&gt;</comment>
                            <comment id="12565517" author="myrna" created="Mon, 4 Feb 2008 20:47:33 +0000"  >&lt;p&gt;I&apos;ve been looking at the last remaining test master/canon - testclientij.out - that shows the version number.&lt;br/&gt;
It looks like this test was explicitly intended as a .sql test to test DerbyNetClient connection strings, so converting to a .java junit test does not seem appropriate.&lt;/p&gt;

&lt;p&gt;The difference between other tests executing .sql files (e.g. NistScripts, LangScripts, ToolScripts) is that this one emulates the old harness&apos; RunTest mechanism of using ij.main(&quot;-fr&quot;, &quot;filename&quot;) (by extending util.IjTestCase), whereas the other tests use ij.runScript(..).&lt;/p&gt;

&lt;p&gt;-fr is possibly intended to be a undocumented feature, at least, I could find no documentation, even the ij javadoc is very quiet about it, and if you use it incorrectly, (e.g. : java org.apache.derby.tools.ij testclientij.sql) you get an NPE rather than an appropriate message.&lt;br/&gt;
I gather it&apos;s supposed to list the file in it&apos;s full resource path - e.g.: java org.apache.derby.tools.ij /testclientij.sql (if . is in your classpath and the file sits in the current dir).&lt;/p&gt;

&lt;p&gt;Apparently, and per the code, running main vs runScript results in some slight differences:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;no version number printed&lt;/li&gt;
	&lt;li&gt;first connection is already started&lt;/li&gt;
	&lt;li&gt;no messages indicating number of rows selected&lt;br/&gt;
These differences do not seem relevant to this particular test.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think the util.IjTestCase mechanism may possibly be of use in testing ij in the future, but at present, in NetIjTest, it appears to be just another way of doing the same thing as e.g. NistScripts, a way that has the unfortunate effect of printing the version number.&lt;/p&gt;

&lt;p&gt;We could consider adding the script to the tools directory/_Suite...But I think it is more appropriate in its current spot. Thus, I intend to rewrite NetIjTest to use the same mechanism as NistScripts. When this is done, I intend to get rid of the master-editing target in tools/release/build.xml.&lt;br/&gt;
I&apos;ll leave IjTestCase in place for future use. If used, it would need a different compareCanon method in CanonTestCase, one that ignores lines with specified strings (or maybe specifically checks on the version number without it being in the canon).&lt;/p&gt;</comment>
                            <comment id="12565592" author="myrna" created="Mon, 4 Feb 2008 23:09:12 +0000"  >&lt;p&gt;I rewrote the test NetIjTest which uses the remaining master file - testclientij.out - that shows the version and committed with revision 618472.&lt;br/&gt;
Also with this revision I removed the now unnecessary regex.masters target.&lt;/p&gt;

&lt;p&gt;I then edited  the wiki page &lt;a href=&quot;http://wiki.apache.org/db-derby/DerbySnapshotOrRelease&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/DerbySnapshotOrRelease&lt;/a&gt; and removed the references to the now no longer existing targets.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12382691">DERBY-3211</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12385104">DERBY-3294</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12371947">DERBY-2843</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12385014">DERBY-3291</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12360547">DERBY-2242</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12374714" name="DERBY-3088_NetIjTest.diff" size="6463" author="myrna" created="Mon, 4 Feb 2008 21:57:12 +0000"/>
                            <attachment id="12370989" name="DERBY-3088_ServerPropertiesTest.diff" size="25689" author="myrna" created="Wed, 5 Dec 2007 01:20:14 +0000"/>
                            <attachment id="12372434" name="DERBY-3088_ServerPropertiesTest2.diff" size="48627" author="myrna" created="Thu, 3 Jan 2008 00:03:11 +0000"/>
                            <attachment id="12374185" name="DERBY-3088_ServerPropertiesTest_3.diff" size="28790" author="myrna" created="Mon, 28 Jan 2008 15:19:26 +0000"/>
                            <attachment id="12374184" name="DERBY-3088_ServerPropertiesTest_3.stat" size="427" author="myrna" created="Mon, 28 Jan 2008 15:19:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 10 Dec 2007 21:29:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30721</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0zfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39558</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>