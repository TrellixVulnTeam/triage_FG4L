<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:27:16 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2556/DERBY-2556.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2556] Code paths for db restore do not use doPrivileged-calls, causing SecurityException</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2556</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When using &apos;createFrom&apos; or &apos;restoreFrom&apos; in the JDBC url to restore a database from a backup image, a SecurityException is thrown even though the policyfile for codebase derby.jar is correctly configured (giving Derby access to the backup image).&lt;/p&gt;

&lt;p&gt;A few comments on this issue can be found here (and in subsequent comments): &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1001#action_12439811&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DERBY-1001#action_12439811&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;A workaround is wrapping the connection call in doPrivileged at the &quot;application-level code&quot;, or granting the required permissions to the application codebase as well.&lt;/p&gt;</description>
                <environment>Derby running with a security manager.</environment>
        <key id="12367374">DERBY-2556</key>
            <summary>Code paths for db restore do not use doPrivileged-calls, causing SecurityException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kristwaa">Kristian Waagan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Apr 2007 13:10:15 +0100</created>
                <updated>Fri, 31 Oct 2008 09:40:09 +0000</updated>
                            <resolved>Fri, 31 Oct 2008 09:40:09 +0000</resolved>
                                    <version>10.2.2.0</version>
                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                            <comments>
                            <comment id="12489379" author="kristwaa" created="Tue, 17 Apr 2007 13:11:24 +0100"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1001&quot; title=&quot;Rewrite &amp;#39;store/encryptionKey.sql&amp;#39; to a JUnit test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1001&quot;&gt;&lt;del&gt;DERBY-1001&lt;/del&gt;&lt;/a&gt; for a stack trace and some additional comments/info.&lt;/p&gt;</comment>
                            <comment id="12494091" author="kmarsden" created="Mon, 7 May 2007 18:46:39 +0100"  >&lt;p&gt;I applied the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1001&quot; title=&quot;Rewrite &amp;#39;store/encryptionKey.sql&amp;#39; to a JUnit test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1001&quot;&gt;&lt;del&gt;DERBY-1001&lt;/del&gt;&lt;/a&gt; and found that testRestoreFrom seems to work just fine.  Is it possible that this issue has already been fixed or am I missing something?&lt;/p&gt;</comment>
                            <comment id="12494159" author="kristwaa" created="Tue, 8 May 2007 00:40:05 +0100"  >&lt;p&gt;The test includes a workaround, where the getConnection-call is wrapped in a doPrivileged-call (see getPrivilegedConnection). If you remove these, I suppose you should still see the error. &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2555&quot; title=&quot;Remove use of doPrivileged in EncryptionKeyTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2555&quot;&gt;&lt;del&gt;DERBY-2555&lt;/del&gt;&lt;/a&gt; is the issue tracking this task. If you don&apos;t beat me to it, I can create a patch for it tomorrow, which you can apply and see if you see the problem reappear.&lt;/p&gt;

&lt;p&gt;I would recommend reading the comments in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1001&quot; title=&quot;Rewrite &amp;#39;store/encryptionKey.sql&amp;#39; to a JUnit test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1001&quot;&gt;&lt;del&gt;DERBY-1001&lt;/del&gt;&lt;/a&gt;, as it was not clear to me at first what the correct solution would be. Dan gave his opinion, and when I thought about the issue again, his suggestion seemed right.&lt;/p&gt;</comment>
                            <comment id="12494268" author="kristwaa" created="Tue, 8 May 2007 12:41:04 +0100"  >&lt;p&gt;I have uploaded a patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2555&quot; title=&quot;Remove use of doPrivileged in EncryptionKeyTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2555&quot;&gt;&lt;del&gt;DERBY-2555&lt;/del&gt;&lt;/a&gt;. If it is applied, the EncryptionKeyXXXTests will fail. I believe it is with the error I created this issue for.&lt;/p&gt;</comment>
                            <comment id="12494538" author="kmarsden" created="Wed, 9 May 2007 18:45:56 +0100"  >&lt;p&gt;Here is preliminary patch for this issue which also includes the changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2555&quot; title=&quot;Remove use of doPrivileged in EncryptionKeyTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2555&quot;&gt;&lt;del&gt;DERBY-2555&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
I&apos;ll commit tomorrow if all tests pass tonight and I hear no objections.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;</comment>
                            <comment id="12494553" author="kristwaa" created="Wed, 9 May 2007 19:50:56 +0100"  >&lt;p&gt;I reviewed the patch, and have some questions/comments:&lt;/p&gt;

&lt;p&gt; 1) Then run method is declared to throw a number of exceptions, but only SecurityException can be thrown.&lt;br/&gt;
 2) The patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2555&quot; title=&quot;Remove use of doPrivileged in EncryptionKeyTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2555&quot;&gt;&lt;del&gt;DERBY-2555&lt;/del&gt;&lt;/a&gt; seems to be included. This doesn&apos;t really matter, but the two patches can be committed separately (though only in one order).&lt;br/&gt;
 3) The newly added method mixes tabs and spaces for indentation (also on the same line).&lt;br/&gt;
 4) Missing JavaDoc (not required?)&lt;/p&gt;


&lt;p&gt;thanks,&lt;/p&gt;</comment>
                            <comment id="12494585" author="kmarsden" created="Wed, 9 May 2007 23:09:48 +0100"  >&lt;p&gt;Thanks Kristian for the review.  I made the changes you suggested and committed the change.&lt;br/&gt;
Date: Wed May  9 15:01:34 2007&lt;br/&gt;
New Revision: 536677&lt;/p&gt;</comment>
                            <comment id="12494695" author="kristwaa" created="Thu, 10 May 2007 11:25:54 +0100"  >&lt;p&gt;Reopening the issue due to failures in the tinderbox test.&lt;/p&gt;

&lt;p&gt;Stack trace with debug/sane information below, and the traces look the same for all failures.&lt;/p&gt;

&lt;p&gt;============= begin nested exception, level (1) ===========&lt;br/&gt;
java.sql.SQLException: Java exception: &apos;access denied (java.io.FilePermission extinout/backups/encryptionKeyDBToCreateFrom read): java.security.AccessControlException&apos;.&lt;br/&gt;
    at java.security.AccessControlContext.checkPermission(AccessControlContext.java:264)&lt;br/&gt;
    at java.security.AccessController.checkPermission(AccessController.java:427)&lt;br/&gt;
    at java.lang.SecurityManager.checkPermission(SecurityManager.java:532)&lt;br/&gt;
    at java.lang.SecurityManager.checkRead(SecurityManager.java:871)&lt;br/&gt;
    at java.io.File.list(File.java:935)&lt;br/&gt;
    at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.restoreDataDirectory(BaseDataFileFactory.java:2516)&lt;br/&gt;
    at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.boot(BaseDataFileFactory.java:349)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1994)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:546)&lt;br/&gt;
    at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)&lt;br/&gt;
    at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:183)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1994)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:546)&lt;br/&gt;
    at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)&lt;br/&gt;
    at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:985)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1994)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:546)&lt;br/&gt;
    at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)&lt;br/&gt;
    at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:767)&lt;br/&gt;
    at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:196)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1994)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1829)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(BaseMonitor.java:1695)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(BaseMonitor.java:1575)&lt;br/&gt;
    at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:994)&lt;br/&gt;
    at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Monitor.java:542)&lt;br/&gt;
    at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:1796)&lt;br/&gt;
    at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:253)&lt;br/&gt;
    at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(EmbedConnection30.java:73)&lt;br/&gt;
    at org.apache.derby.jdbc.Driver30.getNewEmbedConnection(Driver30.java:80)&lt;br/&gt;
    at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:209)&lt;br/&gt;
    at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(EmbeddedDataSource.java:479)&lt;br/&gt;
    at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(EmbeddedDataSource.java:423)&lt;br/&gt;
    at org.apache.derbyTesting.functionTests.tests.store.EncryptionKeyTest.getConnection(EncryptionKeyTest.java:580)&lt;br/&gt;
    at org.apache.derbyTesting.functionTests.tests.store.EncryptionKeyTest.testCreateDbFromBackup(EncryptionKeyTest.java:279)&lt;/p&gt;</comment>
                            <comment id="12494696" author="kristwaa" created="Thu, 10 May 2007 11:29:40 +0100"  >&lt;p&gt;There is at least a problem in the following code in BaseDataFileFactory. Not sure how to interpret the comment, but I think adding more doPrivileged-blocks is the right approach. Any comments on this?&lt;/p&gt;

&lt;p&gt;	private void restoreDataDirectory(String backupPath) &lt;br/&gt;
        throws StandardException&lt;br/&gt;
	{&lt;br/&gt;
        File bsegdir;   //segment directory in the backup&lt;br/&gt;
        File backupRoot = new java.io.File(backupPath);	//root dir of backup db&lt;/p&gt;

&lt;p&gt;        /* To be safe we first check if the backup directory exist and it has&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;atleast one seg* directory before removing the current data directory.&lt;br/&gt;
         *&lt;/li&gt;
	&lt;li&gt;This will fail with a security exception unless the database engine&lt;/li&gt;
	&lt;li&gt;and all its callers have permission to read the backup directory.&lt;br/&gt;
         */&lt;br/&gt;
        String[] bfilelist = backupRoot.list();&lt;br/&gt;
        if(bfilelist !=null)&lt;br/&gt;
        {&lt;br/&gt;
            boolean segmentexist = false;&lt;br/&gt;
            for (int i = 0; i &amp;lt; bfilelist.length; i++) &lt;br/&gt;
            {&lt;br/&gt;
                //check if it is a  seg* directory&lt;br/&gt;
                if(bfilelist&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.startsWith(&quot;seg&quot;))
                &lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {                    bsegdir = new File(backupRoot , bfilelist[i]);                    if(bsegdir.exists() &amp;amp;&amp;amp; bsegdir.isDirectory())                    {
                        segmentexist = true;
                        break;
                    }                }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;            }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12494738" author="kristwaa" created="Thu, 10 May 2007 13:59:06 +0100"  >&lt;p&gt;&apos;derby-2556-2a_whitespace-javadoc.diff&apos; replaces a few tabs with spaces in the JavaDoc for the newly added privExists-methods. Also updated the JavaDoc.&lt;/p&gt;

&lt;p&gt;Committed to trunk with revision 536856.&lt;/p&gt;</comment>
                            <comment id="12494791" author="kmarsden" created="Thu, 10 May 2007 18:01:14 +0100"  >&lt;p&gt;&amp;gt; There is at least a problem in the following code in BaseDataFileFactory. Not sure how to interpret the comment, &amp;gt;but I think adding more doPrivileged-blocks is the right approach. Any comments on this?&lt;/p&gt;

&lt;p&gt;Yes, I do think the exists() need privilege blocks for this code.&lt;/p&gt;

&lt;p&gt; Thanks Kristian for looking at this.  I am not sure how my tests passed while the tinderbox failed but I will take a closer look.&lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;
</comment>
                            <comment id="12494798" author="kmarsden" created="Thu, 10 May 2007 18:39:09 +0100"  >&lt;p&gt;I am still a bit baffled and am seeing these tests pass.  If I can&apos;t figure out what is going on this morning, I will back out the test change.&lt;br/&gt;
java junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.store.EncryptionKeyAESTest&lt;br/&gt;
........&lt;br/&gt;
Time: 23.781&lt;/p&gt;

&lt;p&gt;OK (8 tests)&lt;/p&gt;

&lt;p&gt; java junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.store.EncryptionKeyBlowfishTest&lt;br/&gt;
........&lt;br/&gt;
Time: 25.094&lt;/p&gt;

&lt;p&gt;OK (8 tests)&lt;/p&gt;</comment>
                            <comment id="12495050" author="kristwaa" created="Fri, 11 May 2007 14:34:31 +0100"  >&lt;p&gt;The test failed for me when I ran it individually, but I don&apos;t think I saw the previous errors when I ran it outside suites.All. Maybe I&apos;ll look at it later.&lt;/p&gt;

&lt;p&gt;I made an alternative patch, which seems to fix the problem that caused 9 failures. It is only half-baked, and the previous patch for this issue is also required. A final patch will have to be made anyway, in one or the other direction... (can be done in two steps though)&lt;/p&gt;

&lt;p&gt;The patch &apos;derby-2556-3a_alternative-patch.diff&apos; adds a utility class for running file operations in a privileged block. It is kept very simple, which does duplicate some code, but reduces complexity.&lt;br/&gt;
Any comments on this issue?&lt;/p&gt;

&lt;p&gt;As far as I can tell, there are more places where the &quot;machinery&quot;  to run in a privileged block can be simplified by reuse. I will create a separate Jira for this if the approach is acceptable.&lt;/p&gt;

&lt;p&gt;To finish this patch, the added privExists method must be removed, and the appropriate calls to PrivilegedFileOps must be inserted. If you test the patch, don&apos;t forget to apply the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2555&quot; title=&quot;Remove use of doPrivileged in EncryptionKeyTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2555&quot;&gt;&lt;del&gt;DERBY-2555&lt;/del&gt;&lt;/a&gt; as well!&lt;/p&gt;</comment>
                            <comment id="12495199" author="kmarsden" created="Sat, 12 May 2007 00:09:58 +0100"  >&lt;p&gt;Thanks Kristian for the patch.&lt;/p&gt;

&lt;p&gt;I did not notice your alternative patch until after I had made another patch myself.  I preferred yours so made the changes to StorageFactoryService and corrected a small compile error in the patch.&lt;br/&gt;
I seem to be having inconsistant results running these tests.  Now I am seeing errors starting the database with the trace below.  This is what I was getting when I first tried your patch and may be related to my environment.  Anyway could you give it a try and commit if it works ok for you.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;

&lt;p&gt;....XSDG8 : Unable to copy directory &apos;verifyKey.dat&apos; to &apos;C:\test\extinout\restor&lt;br/&gt;
erifyKey.dat&apos; during restore. Please make sure that there is enough space and pe&lt;br/&gt;
java.sql.SQLException: Unable to copy directory &apos;verifyKey.dat&apos; to &apos;C:\test\exti&lt;br/&gt;
mRestored\verifyKey.dat&apos; during restore. Please make sure that there is enough s&lt;br/&gt;
        at org.apache.derby.iapi.error.StandardException.newException(StandardEx&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.privRestoreD&lt;br/&gt;
02)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.run(BaseData&lt;br/&gt;
        at java.security.AccessController.doPrivileged1(Native Method)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(AccessController.java(Com&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.restoreDataD&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.boot(BaseDat&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.j&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.TopService.bootModule(TopServi&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMo&lt;br/&gt;
        at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Moni&lt;br/&gt;
        at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:183)&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.j&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.TopService.bootModule(TopServi&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMo&lt;br/&gt;
        at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Moni&lt;br/&gt;
        at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessMan&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.j&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.TopService.bootModule(TopServi&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMo&lt;br/&gt;
        at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Moni&lt;br/&gt;
        at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:7&lt;br/&gt;
        at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:196)&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.j&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.TopService.bootModule(TopServi&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMo&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.BaseMonitor.startProviderServi&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndSta&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentSer&lt;br/&gt;
        at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnecti&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.jav&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(EmbedConnection30&lt;br/&gt;
        at org.apache.derby.jdbc.Driver30.getNewEmbedConnection(Driver30.java:80&lt;br/&gt;
        at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:209)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(EmbeddedDataSo&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(EmbeddedDataSo&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.EncryptionKeyTest.g&lt;/p&gt;

&lt;p&gt;        at org.apache.derbyTesting.functionTests.tests.store.EncryptionKeyTest.a&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.EncryptionKeyTest$2&lt;br/&gt;
        at java.security.AccessController.doPrivileged1(Native Method)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(AccessController.java(Com&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.EncryptionKeyTest.g&lt;br/&gt;
.java:552)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.EncryptionKeyTest.t&lt;br/&gt;
java:280)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java(Compiled Code))&lt;br/&gt;
        at junit.framework.TestCase.runTest(TestCase.java:154)&lt;br/&gt;
        at junit.framework.TestCase.runBare(TestCase.java:127)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:&lt;br/&gt;
        at junit.framework.TestResult$1.protect(TestResult.java:106)&lt;br/&gt;
        at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
        at junit.framework.TestResult.run(TestResult.java:109)&lt;br/&gt;
        at junit.framework.TestCase.run(TestCase.java:118)&lt;br/&gt;
        at junit.framework.TestSuite.runTest(TestSuite.java:208)&lt;br/&gt;
        at junit.framework.TestSuite.run(TestSuite.java:203)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at junit.textui.TestRunner.doRun(TestRunner.java:116)&lt;br/&gt;
        at junit.textui.TestRunner.start(TestRunner.java:172)&lt;br/&gt;
        at junit.textui.TestRunner.main(TestRunner.java:138)&lt;/p&gt;

</comment>
                            <comment id="12495500" author="kristwaa" created="Mon, 14 May 2007 08:32:48 +0100"  >&lt;p&gt;Committed &apos;derby-2556-4a_alternative-patch.diff&apos; to trunk with revision 537735.&lt;/p&gt;

&lt;p&gt;I ran derbyall/suites.All four times (once without &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2555&quot; title=&quot;Remove use of doPrivileged in EncryptionKeyTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2555&quot;&gt;&lt;del&gt;DERBY-2555&lt;/del&gt;&lt;/a&gt;, the rest with). No failures seen. I plan to commit &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2555&quot; title=&quot;Remove use of doPrivileged in EncryptionKeyTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2555&quot;&gt;&lt;del&gt;DERBY-2555&lt;/del&gt;&lt;/a&gt; tomorrow, after a tinderbox test has confirmed that this patch is okay by itself. The tests were run with Sun JVMs 1.4, 1.5 and 1.6, all on Solaris 10.&lt;br/&gt;
If the tinderbox fails again, there must be something funny going on with my environment.&lt;/p&gt;

&lt;p&gt;Thanks for the additional work on the patch Kathey.&lt;/p&gt;</comment>
                            <comment id="12496216" author="kristwaa" created="Wed, 16 May 2007 08:40:03 +0100"  >&lt;p&gt;Problems seem to be fixed. Closing issue.&lt;/p&gt;</comment>
                            <comment id="12619647" author="djd" created="Mon, 4 Aug 2008 20:06:50 +0100"  >&lt;p&gt;PrivilegedFileOps is a utility class with privileged blocks which is strongly discouraged by Java docs (see comment in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3745&quot; title=&quot;Derby can leak classloaders in an app server environment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3745&quot;&gt;&lt;del&gt;DERBY-3745&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;This fix needs to be re-worked to not open uch security holes.&lt;/p&gt;</comment>
                            <comment id="12619648" author="djd" created="Mon, 4 Aug 2008 20:07:39 +0100"  >&lt;p&gt;Assigning to original coder&lt;/p&gt;</comment>
                            <comment id="12619659" author="kristwaa" created="Mon, 4 Aug 2008 20:37:27 +0100"  >&lt;p&gt;I&apos;ll have a look at this tomorrow and try to get it done before the 10.4 release.&lt;/p&gt;</comment>
                            <comment id="12620224" author="kristwaa" created="Wed, 6 Aug 2008 13:06:03 +0100"  >&lt;p&gt;Patch 5a removes the utility class and duplicates the required code in a few places.&lt;br/&gt;
I decided not to write separate classes for the various Privileged&lt;span class=&quot;error&quot;&gt;&amp;#91;Exception&amp;#93;&lt;/span&gt;Actions, because they are all so simple.&lt;br/&gt;
It would be nice if someone could look at the permission changes I did.&lt;/p&gt;

&lt;p&gt;Running suites.All/derbyall.&lt;br/&gt;
Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="12620352" author="kristwaa" created="Wed, 6 Aug 2008 18:57:02 +0100"  >&lt;p&gt;I&apos;m still getting three errors in deryball, which I guess is related to missing file properties.&lt;br/&gt;
I&apos;ll upload a new revision tomorrow, but the other changes in the patch can still be reviewed.&lt;/p&gt;</comment>
                            <comment id="12627613" author="kristwaa" created="Tue, 2 Sep 2008 10:19:46 +0100"  >&lt;p&gt;Revision 5b runs without failures (derbyall and suites.All).&lt;/p&gt;

&lt;p&gt;I plan to commit it tomorrow.&lt;/p&gt;</comment>
                            <comment id="12627867" author="dagw" created="Wed, 3 Sep 2008 01:39:02 +0100"  >&lt;p&gt;Looks good,&lt;/p&gt;

&lt;p&gt; +1&lt;/p&gt;

&lt;p&gt;Minor note, why not factor out the privileged ops as private methods in &lt;br/&gt;
BaseDataFileFactory as well (e.g. as in Export). Would improve readabilty I think.&lt;/p&gt;</comment>
                            <comment id="12627967" author="kristwaa" created="Wed, 3 Sep 2008 12:48:36 +0100"  >&lt;p&gt;Committed patch 5b to trunk with revision 691576.&lt;/p&gt;

&lt;p&gt;Thanks for looking at the patch, Dag.&lt;br/&gt;
I decided to not factor out the privileged ops into private methods in BaseDataFileFactory because each File method is called only once, and there is a run method calling the same File methods that doesn&apos;t require a separate AccessController.doPrivileged call. The reason is because the run method itself is executed in a privileged block. I thought it would be confusing to add methods and not use them consistently.&lt;/p&gt;

&lt;p&gt;I agree on the readability aspect though, and factoring out the methods is very easy.&lt;/p&gt;

&lt;p&gt;Regarding backporting, I think it will require some manual changes due to a test change. The GetCurrentProperties test was recently converted to JUnit, and a different policy file would have to be modified. I also got a conflict in DssTrace, maybe because the functionality to create the trace directory has been added?&lt;/p&gt;

&lt;p&gt;Does anyone have thoughts on the factoring and backporting issues?&lt;/p&gt;</comment>
                            <comment id="12627971" author="kristwaa" created="Wed, 3 Sep 2008 12:55:08 +0100"  >&lt;p&gt;Created subtask &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3864&quot; title=&quot;Remove utility class PrivilegedFileOps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3864&quot;&gt;&lt;del&gt;DERBY-3864&lt;/del&gt;&lt;/a&gt; to track the PrivilegedFileOps issue (i.e. affects and fix versions).&lt;/p&gt;</comment>
                            <comment id="12644173" author="kmarsden" created="Fri, 31 Oct 2008 00:03:13 +0000"  >&lt;p&gt;I wonder if this issue can be resolved. &lt;/p&gt;</comment>
                            <comment id="12644248" author="kristwaa" created="Fri, 31 Oct 2008 09:40:09 +0000"  >&lt;p&gt;Thanks for bringing this up again, Kathey.&lt;/p&gt;

&lt;p&gt;I&apos;m closing the issue, and I&apos;m not planning to port it to 10.4.&lt;br/&gt;
There are conflicts in the merge, and in my view the potential security threat is limited (exists, isDirectory, list, mkdirs).&lt;/p&gt;

&lt;p&gt;In case anyone feel differently, porting the fix is doable with some manual changes.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12367371">DERBY-2555</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12329112">DERBY-1001</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12357037" name="derby-2556-2a_whitespace-javadoc.diff" size="1392" author="kristwaa" created="Thu, 10 May 2007 13:59:06 +0100"/>
                            <attachment id="12357106" name="derby-2556-3a_alternative-patch.diff" size="6978" author="kristwaa" created="Fri, 11 May 2007 14:34:31 +0100"/>
                            <attachment id="12357107" name="derby-2556-3a_alternative-patch.stat" size="150" author="kristwaa" created="Fri, 11 May 2007 14:34:31 +0100"/>
                            <attachment id="12357150" name="derby-2556-4a_alternative-patch.diff" size="9590" author="kmarsden" created="Sat, 12 May 2007 00:09:57 +0100"/>
                            <attachment id="12357151" name="derby-2556-4a_alternative-patch.stat" size="306" author="kmarsden" created="Sat, 12 May 2007 00:10:21 +0100"/>
                            <attachment id="12387632" name="derby-2556-5a-reworked_fix.diff" size="19810" author="kristwaa" created="Wed, 6 Aug 2008 13:06:03 +0100"/>
                            <attachment id="12387633" name="derby-2556-5a-reworked_fix.stat" size="642" author="kristwaa" created="Wed, 6 Aug 2008 13:06:03 +0100"/>
                            <attachment id="12389336" name="derby-2556-5b-reworked_fix.diff" size="21047" author="kristwaa" created="Tue, 2 Sep 2008 10:19:46 +0100"/>
                            <attachment id="12389337" name="derby-2556-5b-reworked_fix.stat" size="747" author="kristwaa" created="Tue, 2 Sep 2008 10:19:46 +0100"/>
                            <attachment id="12356984" name="derby-2556_diff.txt" size="6746" author="kmarsden" created="Wed, 9 May 2007 18:45:56 +0100"/>
                            <attachment id="12356985" name="derby-2556_stat.txt" size="248" author="kmarsden" created="Wed, 9 May 2007 18:46:28 +0100"/>
                    </attachments>
                <subtasks>
                            <subtask id="12403607">DERBY-3864</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 7 May 2007 17:46:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23100</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ydz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39389</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>