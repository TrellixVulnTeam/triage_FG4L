<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:34:02 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3663/DERBY-3663.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3663] Convert store/streamingColumn to JUnit</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3663</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Convert org.apache.derbyTesting.functionTests.tests.store.streamingColumn to a JUnit testcase.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12395334">DERBY-3663</key>
            <summary>Convert store/streamingColumn to JUnit</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="suranjay">Suran Jayathilaka</assignee>
                                    <reporter username="suranjay">Suran Jayathilaka</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 May 2008 16:57:20 +0100</created>
                <updated>Thu, 2 May 2013 03:29:15 +0100</updated>
                            <resolved>Thu, 12 Jun 2008 18:06:40 +0100</resolved>
                                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12599184" author="suranjay" created="Thu, 22 May 2008 21:58:04 +0100"  >&lt;p&gt;Note: This patch (derby-3663-1.diff) is NOT commit-ready.&lt;/p&gt;

&lt;p&gt;Submitted for initial review. &lt;/p&gt;

&lt;p&gt;TO DO:&lt;br/&gt;
Fix &apos;file access permission denied&apos; errors&lt;br/&gt;
investigate testDerby500 failure&lt;/p&gt;</comment>
                            <comment id="12599230" author="kmarsden" created="Thu, 22 May 2008 23:53:24 +0100"  >&lt;p&gt;Hi Suran, I have started going through the test but will be out tomorrow so may not finish my review until Monday.  I am marking patch available in the hopes that someone else has some time to look at it as well.  It is a big test so more eyes would be better.&lt;/p&gt;
</comment>
                            <comment id="12599249" author="kmarsden" created="Fri, 23 May 2008 00:51:05 +0100"  >&lt;p&gt;Here are some comments.  I will look more on Monday.  &lt;br/&gt;
Probably already have these on your list.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;add test to suite.&lt;/li&gt;
	&lt;li&gt;remove from derbyall and cleanup old test files.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Comments on StreamingColumnTest&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;It&apos;s a failing of the original test, but it would be great to have some javadoc comments for the fixtures.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The unused method private static void expectedException1(SQLException sqle) can be removed.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&amp;#8211; basesuite()&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In basesuite we have&lt;br/&gt;
	TestSuite suite = new TestSuite(name);&lt;br/&gt;
		suite.addTestSuite(StreamingColumnTest.class);&lt;br/&gt;
		Test test = new SupportFilesSetup(suite, new String[] 
{
				&quot;functionTests/tests/store/short.data&quot;,
				&quot;functionTests/tests/store/shortbanner&quot;,
				&quot;functionTests/tests/store/derby.banner&quot;,
				&quot;functionTests/tests/store/empty.data&quot;}
&lt;p&gt; );&lt;br/&gt;
		return new CleanDatabaseTestSetup(DatabasePropertyTestSetup&lt;br/&gt;
				.setLockTimeouts(suite, 2, 4)) {&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Shouldn&apos;t it be test and not suite that gets passed to CleanDatabaseTestSetup?&lt;/p&gt;


&lt;p&gt;&amp;#8211; testStream1()&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;We have:&lt;br/&gt;
	try 
{// if trying to insert data &amp;gt; 32700, there will be an
					// exception
					ps.executeUpdate();
					println(&quot;No truncation and hence no error&quot;);
				}
&lt;p&gt; catch (SQLException e) {&lt;br/&gt;
					if (fileLength&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; &amp;gt; Limits.DB2_LONGVARCHAR_MAXWIDTH) {&lt;br/&gt;
						assertSQLState(&quot;22001&quot;, e); // was getting data longer&lt;br/&gt;
						// than maxValueAllowed&lt;br/&gt;
						println(&quot;expected exception for data &amp;gt; &quot;&lt;br/&gt;
								+ Limits.DB2_LONGVARCHAR_MAXWIDTH&lt;br/&gt;
								+ &quot; in length&quot;);&lt;br/&gt;
			\&lt;br/&gt;
There should be a fail(....) after the ps.excecuteUpdate for the cases where we expect an exception.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I know it was part of the original test, but it seems strange that the test imports and uses mport org.apache.derby.iapi.reference.Limits.  Typically the test code does not use the engine code.  Perhaps we could use constants in the test insteadx.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;--testStream2*() &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I feel a little funny about the duplicate code in testStream2_1500, testStream2_5000 and testStream2_10000.  Could you extract some of the code and have a&lt;br/&gt;
testStream2(long length, String tablename) that you call from these methods?&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;&amp;#8211; testStream3*()&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Same comment about duplicate code.&lt;/li&gt;
	&lt;li&gt;Statement sourceStmt = createStatement(); is not needed&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&amp;#8211; testStream4()&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;local variable met is not used.&lt;/li&gt;
	&lt;li&gt;you can remove the catch and throw of the exception since the method already throws Exception.&lt;/li&gt;
	&lt;li&gt;one thing that is funny is that the results that are processed don&apos;t seem to be checked at all.  This is a carryover from the original test, but at least perhaps we could check the columnSize.&lt;/li&gt;
&lt;/ul&gt;


</comment>
                            <comment id="12599293" author="kristwaa" created="Fri, 23 May 2008 08:26:12 +0100"  >&lt;p&gt;Now, this is a big test!&lt;/p&gt;

&lt;p&gt;I had a look, and found two things that should be fixed:&lt;br/&gt;
 a) Change the class name in the license header.&lt;br/&gt;
 b) Replace all tabs with spaces (4 spaces per tab for indentation).&lt;/p&gt;

&lt;p&gt;Regarding point b, there are tabs both at the beginning of the lines and elsewhere. There are also a few occurrences of trailing whitespace on some lines.&lt;/p&gt;

&lt;p&gt;Maybe I get some time to look more in detail at the tests themselves later, after you have addressed the comments from Kathey.&lt;br/&gt;
Keep up the good work &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12600264" author="suranjay" created="Tue, 27 May 2008 21:18:34 +0100"  >&lt;p&gt;Thanks a lot for the comments.&lt;/p&gt;

&lt;p&gt;Attaching derby-3663-2.diff for further review.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;This patch is NOT commit ready.***&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;TO DOs:&lt;br/&gt;
1. Investigate remaining test failures and fix errors&lt;br/&gt;
2. Remove old test and support files and references&lt;br/&gt;
3. Additional javadoc comments&lt;br/&gt;
4. Rectify style and formatting issues&lt;br/&gt;
5. Anything else?&lt;/p&gt;</comment>
                            <comment id="12600545" author="kmarsden" created="Wed, 28 May 2008 19:00:03 +0100"  >&lt;p&gt;I looked at the new patch. Thank you for converting this big test.  In general I think you need to review the places where you catch exceptions and make sure there is a fail call if the exception is expected and assertSQLState for the expected exceptions.  I have a few specific comments below. &lt;/p&gt;


&lt;p&gt;&amp;#8211; Where you have code that catches an exception and rethrows it or prints the stack trace, you can eliminate the try catch block and just let the exception be thrown.&lt;br/&gt;
.... e.g.&lt;/p&gt;

&lt;p&gt;} catch (Exception e) &lt;/p&gt;
{
			throw e;
		}

&lt;p&gt;			} catch (SQLException sqle) &lt;/p&gt;
{
				println(&quot;UNEXPECTED EXCEPTION - update should have actually gone through&quot;);
				throw sqle;
			}

&lt;p&gt;&amp;#8211; You can eliminate the unused local variables for ResultSetMetaData and ResultSet.&lt;/p&gt;


&lt;p&gt;&amp;#8211; We could probably use java.util.Arrays.equals() instead of byteArrayEquals&lt;/p&gt;


&lt;p&gt;&amp;#8211; insertDataUsingConcat &lt;br/&gt;
we have:&lt;br/&gt;
		// for varchars, trailing blank truncation will not throw an exception.&lt;br/&gt;
		// Only non-blank characters will cause truncation error&lt;br/&gt;
		// for long varchars, any character truncation will throw an exception.&lt;br/&gt;
	try &lt;/p&gt;
{
			stmt.execute(sql);
			println(&quot;No truncation and hence no error.&quot;);
		}
&lt;p&gt; catch (SQLException e) &lt;/p&gt;
{
			assertSQLState(&quot;22001&quot;, e); // truncation error
			println(&quot;expected exception for data &amp;gt; &quot; + maxValueAllowed
					+ &quot; in length&quot;);
		}

&lt;p&gt;There is Is no fail call after stmt.execute(sql) for the cases that are expected to fail.&lt;br/&gt;
 Similar problem in insertDataUsingCharacterStream, insertDataUsingAsciiStream, testStream1.&lt;/p&gt;

&lt;p&gt;--testDerby500&lt;br/&gt;
Need a fail before catching the expected SQLException.&lt;br/&gt;
and should assertSQLState for the expected exception&lt;br/&gt;
			println(&quot;DERBY500 #1 Rows updated  =&quot; + rowCount);&lt;/p&gt;

&lt;p&gt;			} catch (SQLException sqle) &lt;/p&gt;
{
				println(&quot;EXPECTED EXCEPTION - streams cannot be re-used&quot;);
				// expectedException(sqle);
				rollback();
			}
</comment>
                            <comment id="12603423" author="suranjay" created="Sun, 8 Jun 2008 20:01:56 +0100"  >&lt;p&gt;All fixtures pass, although testStream11 depends on the patch for derby-3705 being applied.&lt;/p&gt;

&lt;p&gt;I think I have addressed the issues pointed out in the previous submissions. Also removed the old files for streamingColumn.&lt;/p&gt;

&lt;p&gt;Please review. derby-3663-3.diff&lt;/p&gt;</comment>
                            <comment id="12603424" author="suranjay" created="Sun, 8 Jun 2008 20:04:06 +0100"  >&lt;p&gt;Fixture testStream11 depends on the patch for derby-3705 to pass.&lt;/p&gt;</comment>
                            <comment id="12603630" author="kmarsden" created="Mon, 9 Jun 2008 19:03:39 +0100"  >&lt;p&gt;Thanks Suran for converting this huge test.  I think it is getting very close. Just a couple of nits.  There is some code like this:&lt;br/&gt;
try &lt;/p&gt;
{
			psu2.setBinaryStream(1, new ByteArrayInputStream(buf), len);
			psu2.setAsciiStream(2, new ByteArrayInputStream(buf), len);
			psu2.setInt(3, 0);
			rowCount += psu2.executeUpdate();
			println(&quot;DERBY500 #2 Rows updated  =&quot; + rowCount);
		}
&lt;p&gt; catch (SQLException sqle) &lt;/p&gt;
{
			println(&quot;UNEXPECTED EXCEPTION - update should have actually gone through&quot;);
			throw sqle;
		}

&lt;p&gt;Where you catch the exception, just to throw it again. I think it would be better to just remove the try/catch blocks and let the exception be thrown.&lt;/p&gt;

&lt;p&gt;The code should be reformatted to have space indentation instead of tabs.&lt;/p&gt;

&lt;p&gt;There were a couple of properties in the streamingColumn_derby.properties which should probably be set for the test. you can use SystemPropertyTestSetup to set these.&lt;/p&gt;

&lt;p&gt;derby.storage.sortBufferMax=5&lt;br/&gt;
derby.debug.true=testSort&lt;/p&gt;

&lt;p&gt;I noticed these jvmflags  in the app.properties&lt;br/&gt;
jvmflags=-ms32M^-mx128M&lt;/p&gt;

&lt;p&gt;Looking back into the archives this was added a long time ago to increase the memory available not to restrict memory for the test, so I think it is ok to just run with the default memory configuration with modern jvms.&lt;/p&gt;</comment>
                            <comment id="12603664" author="suranjay" created="Mon, 9 Jun 2008 20:55:49 +0100"  >&lt;p&gt;derby-3663-4.diff has the following improvements.&lt;/p&gt;

&lt;p&gt;1. Removed unnecessary try/catch blocks.&lt;br/&gt;
2. Replaced tabs with spaces.&lt;br/&gt;
3. Set properties with SystemPropertyTestSetup &lt;br/&gt;
                derby.storage.sortBufferMax=5&lt;br/&gt;
                derby.debug.true=testSort&lt;/p&gt;
</comment>
                            <comment id="12603680" author="kmarsden" created="Mon, 9 Jun 2008 21:49:47 +0100"  >&lt;p&gt;Thanks Suran,&lt;/p&gt;

&lt;p&gt;I&apos;ll run tests and commit this and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3705&quot; title=&quot;In Net Client mode, negative values for stream length are accepted without an exception for PreparedStatement.setAsciiStream()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3705&quot;&gt;&lt;del&gt;DERBY-3705&lt;/del&gt;&lt;/a&gt; if all goes well. One important thing I noticed is that the test was not added to the store _Suite. I will add it.&lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;</comment>
                            <comment id="12604579" author="suranjay" created="Thu, 12 Jun 2008 18:06:40 +0100"  >&lt;p&gt;Test converted and committed. Old test removed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12351772">DERBY-1888</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12397404">DERBY-3705</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12382597" name="derby-3663-1.diff" size="83621" author="suranjay" created="Thu, 22 May 2008 21:58:04 +0100"/>
                            <attachment id="12382874" name="derby-3663-2.diff" size="80785" author="suranjay" created="Tue, 27 May 2008 21:18:34 +0100"/>
                            <attachment id="12383658" name="derby-3663-3.diff" size="167253" author="suranjay" created="Sun, 8 Jun 2008 20:01:56 +0100"/>
                            <attachment id="12383706" name="derby-3663-4.diff" size="181818" author="suranjay" created="Mon, 9 Jun 2008 20:55:49 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 22 May 2008 22:53:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30943</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0lef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37285</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>