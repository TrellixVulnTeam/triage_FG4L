<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:32:39 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1277/DERBY-1277.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1277] Call to rs.isLast() may cause rs.getXXX() return values from the last row instead of the current row in scrollable resultsets</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1277</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;In scrollable updatable resultset, a call to rs.isLast() may cause rs.getXXX() return values from the last row, instead of for the current row.  This may be related to the fact that on calls to isLast() the scroll insensitive resultset moves to the last row, and then moves back to the current row (see &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1276&quot; title=&quot;Calling ResultSet.isLast() on a scrollable insensitive resultset, causes the entire ResultSet to be populated&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1276&quot;&gt;&lt;del&gt;DERBY-1276&lt;/del&gt;&lt;/a&gt; for related information). The call to isLast() seems to have a sideeffect when the resultset is updatable.&lt;/p&gt;

&lt;p&gt;I have test which does the following:&lt;br/&gt;
        Statement stmt1 = con.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE);&lt;br/&gt;
        ResultSet rs = stmt1.executeQuery(&quot;select * from testRelative&quot;);&lt;/p&gt;

&lt;p&gt;        rs.next(); // First Record&lt;br/&gt;
        System.out.println(&quot;First record is: &quot; + rs.getString(&quot;name&quot;));&lt;br/&gt;
        rs.relative(2); // Third Record        &lt;br/&gt;
        System.out.println(&quot;Third record is: &quot; + rs.getString(&quot;name&quot;));&lt;br/&gt;
        System.out.println(&quot; isLast=&quot; + rs.isLast());&lt;br/&gt;
        System.out.println(&quot;Third record is: &quot; + rs.getString(&quot;name&quot;));&lt;/p&gt;

&lt;p&gt;The output is:&lt;br/&gt;
First record is: work1&lt;br/&gt;
Third record is: work3&lt;br/&gt;
 isLast=false&lt;br/&gt;
Third record is: work4&lt;br/&gt;
isLast()==false&lt;/p&gt;

&lt;p&gt;The issue may also be reproduced by applying the following patch to testRelative:&lt;/p&gt;

&lt;p&gt;Index: java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/testRelative.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/testRelative.java  (revision 399224)&lt;br/&gt;
+++ java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/testRelative.java  (working copy)&lt;br/&gt;
@@ -60,7 +60,7 @@&lt;br/&gt;
                        pStmt.executeBatch();&lt;br/&gt;
                        con.commit();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stmt1 = con.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_READ_ONLY);&lt;br/&gt;
+                       stmt1 = con.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE);&lt;br/&gt;
                        rs = stmt1.executeQuery(&quot;select * from testRelative&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;                        rs.next(); // First Record&lt;/p&gt;</description>
                <environment></environment>
        <key id="12333054">DERBY-1277</key>
            <summary>Call to rs.isLast() may cause rs.getXXX() return values from the last row instead of the current row in scrollable resultsets</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="andreask">Andreas Korneliussen</assignee>
                                    <reporter username="andreask">Andreas Korneliussen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 May 2006 19:44:09 +0100</created>
                <updated>Wed, 12 Jul 2006 02:38:01 +0100</updated>
                            <resolved>Sat, 6 May 2006 07:55:06 +0100</resolved>
                                    <version>10.1.2.1</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12378066" author="andreask" created="Sat, 6 May 2006 00:03:51 +0100"  >&lt;p&gt;After analyzing this bug, I found that it is caused by TableScanResultSet and EmbedResultSet sharing DataValueColumn descriptors, and that the call to isLast() will make TableScanResultSet modify the data.&lt;/p&gt;

&lt;p&gt;This bug was first only detected in updatable resultset, because they will have use TableScanResultSet as source, while read-only resultsets use BulkTableScanResultSet as source.  &lt;/p&gt;

&lt;p&gt;If the select statement contains &quot;FOR UPDATE&quot;, also read-only scrollable resultsets will use a TableScanResultSet as source. &lt;/p&gt;

&lt;p&gt;The bug is reproducable in Derby 10.1.2, ie. by modifying the select statement to contain &quot;FOR UPDATE&quot;, and open the resultset with concurrency CONCUR_READ_ONLY.&lt;/p&gt;

&lt;p&gt;I will upload a patch, were ScrollInsensitiveResultSet is modified so that it will give a reference to data which is in the hashtable.&lt;/p&gt;
</comment>
                            <comment id="12378070" author="andreask" created="Sat, 6 May 2006 00:19:55 +0100"  >&lt;p&gt;Attaching a fix, were ScrollInsensitiveResultSet do not return ExecRow from the source resultset, only from the hashtable. This ensures that navigation in source resultsets do not affect the current row of the scrollinsensitive resultset.&lt;/p&gt;

&lt;p&gt;Also extended the test testRelative to test with concurrency mode CONCUR_UPDATABLE, and fixed it so that it can run in derbynetclient framework.&lt;/p&gt;</comment>
                            <comment id="12378071" author="andreask" created="Sat, 6 May 2006 00:24:00 +0100"  >&lt;p&gt;A patch is now available for review.&lt;/p&gt;</comment>
                            <comment id="12378171" author="knutanders" created="Sat, 6 May 2006 07:55:06 +0100"  >&lt;p&gt;The patch looks very good. All tests ran cleanly. Committed revision 400212.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12326316" name="DERBY-1277.diff" size="9142" author="andreask" created="Sat, 6 May 2006 00:19:55 +0100"/>
                            <attachment id="12326317" name="DERBY-1277.stat" size="411" author="andreask" created="Sat, 6 May 2006 00:19:55 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 6 May 2006 06:55:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22411</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy15n3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40564</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>