<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:52:21 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-285/DERBY-285.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-285] Network Client should not print non-ascii token separators in message when it cannot connect to the server to retrieve the error message</title>
                <link>https://issues.apache.org/jira/browse/DERBY-285</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If Network Client cannot connect to the database to retrieve an error message, it will print only the message tokens, the non-ascii token separators, and derby log location.  It would be good if at least the message could be formatted to present a better message to the user without the non-ascii characters.&lt;/p&gt;


&lt;p&gt;To reproduce try a database shutdown.  Because the database is shutdown, the client cannot retrieve the actual message from the server. It therefore just prints the tokens.&lt;/p&gt;

&lt;p&gt;Start network server&lt;/p&gt;

&lt;p&gt;java org.apache.derby.drda.NetworkServerControl start&lt;/p&gt;

&lt;p&gt;$ java org.apache.derby.tools.ij&lt;br/&gt;
ij version 10.1&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby://localhost:1527/wombat;create=true&apos;;&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby://localhost:1527/wombat;shutdown=true&apos;;&lt;br/&gt;
ERROR 08006: DERBY SQL error: SQLCODE: -1, SQLSTATE: 08006, SQLERRMC: wombat[]08006.D[]Database &apos;wombat&apos; shutdown.[](server log:derby.log)&lt;br/&gt;
ij&amp;gt;&lt;/p&gt;

&lt;p&gt;Note: The actual offending characters have been replaced in the output in this bug by []. This is because they break Jira XML retrieval!&lt;/p&gt;</description>
                <environment></environment>
        <key id="32595">DERBY-285</key>
            <summary>Network Client should not print non-ascii token separators in message when it cannot connect to the server to retrieve the error message</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kmarsden">Kathey Marsden</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Sat, 14 May 2005 09:11:47 +0100</created>
                <updated>Wed, 24 May 2006 06:03:38 +0100</updated>
                            <resolved>Mon, 6 Jun 2005 02:16:11 +0100</resolved>
                                    <version>10.1.1.0</version>
                                    <fixVersion>10.1.2.1</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12312662" author="kmarsden" created="Sun, 5 Jun 2005 07:24:27 +0100"  >&lt;p&gt;The offending characters appear for severe error messages where the client cannot call the server to retrieve the message text. &lt;/p&gt;

&lt;p&gt;So my planned solution is to not send message arguments in the sqlerrmc for severe messages, but rather send the full message text localized according the the server locale.  This will make the error messages more readable and eliminate the offending characters.&lt;/p&gt;</comment>
                            <comment id="12312678" author="kmarsden" created="Mon, 6 Jun 2005 01:27:14 +0100"  >&lt;p&gt;Rattaching patch after synching up with Dyre&apos;s change for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-128&quot; title=&quot;Network Server Gives NPE if SQLException has null arguments   (e.g. for ERROR XBM0H)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-128&quot;&gt;&lt;del&gt;DERBY-128&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-285&quot; title=&quot;Network Client should not print non-ascii token separators in message when it cannot connect to the server to retrieve the error message&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-285&quot;&gt;&lt;del&gt;DERBY-285&lt;/del&gt;&lt;/a&gt; Network Client should not print non-ascii token separators in message when it cannot connect to the server to retrieve the error message&lt;/p&gt;

&lt;p&gt;This patch  changes network server to send the complete message in its own locale instead of just the message arguments and delimiters if the exception is severe enough to terminate the connection.     This will eliminate the special characters and provide a more readable message. &lt;br/&gt;
I also cleaned up the code a bit in this area.  I removed the extra logging for the severe exceptions as these will already be logged as part of the normal Derby error logging.&lt;/p&gt;</comment>
                            <comment id="12312684" author="kmarsden" created="Mon, 6 Jun 2005 02:16:11 +0100"  >&lt;p&gt;Fixed&lt;/p&gt;

&lt;p&gt;Sending        java\drda\org\apache\derby\impl\drda\DRDAConnThread.java&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\DerbyNet\badConnection.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\DerbyNet\dataSourcePermissions_net.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\DerbyNet\secureUsers.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\DerbyNet\secureUsers1.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\DerbyNet\users.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\DerbyNet\users2.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\DerbyNetClient\badConnection.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\DerbyNetClient\dataSourcePermissions_net.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\DerbyNetClient\netxaPositive.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\DerbyNetClient\secureUsers.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\DerbyNetClient\secureUsers1.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\DerbyNetClient\testij.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\DerbyNetClient\users.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\DerbyNetClient\users2.out&lt;br/&gt;
Transmitting file data ...............&lt;br/&gt;
Committed revision 180107.&lt;/p&gt;
</comment>
                            <comment id="12413011" author="kmarsden" created="Wed, 24 May 2006 06:03:38 +0100"  >&lt;p&gt;Closing this issue. Some cases still remain where non-ascii characters print. This is filed as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-958&quot; title=&quot;Network Client should not print non-ascii token separators in message  for NullPointerExceptions or other serious non SQLExceptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-958&quot;&gt;DERBY-958&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12310544" name="derby285.diff" size="42093" author="kmarsden" created="Mon, 6 Jun 2005 01:27:14 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29474</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy16af:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40669</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>