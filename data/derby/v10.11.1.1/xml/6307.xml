<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:53:14 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6307/DERBY-6307.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6307] Improve the code coverage of org.apache.derby.iapi.services.info.JVMInfo</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6307</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;According to the coverage reports, org.apache.derby.iapi.services.info.JVMInfo is poorly exercised by the Derby regression tests.&lt;/p&gt;

&lt;p&gt;This sub-task is to improve that test coverage.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12660575">DERBY-6307</key>
            <summary>Improve the code coverage of org.apache.derby.iapi.services.info.JVMInfo</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12641844">DERBY-6164</parent>
                                    <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ahsancse">ahsan shamsudeen</assignee>
                                    <reporter username="ahsancse">ahsan shamsudeen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Jul 2013 07:50:28 +0100</created>
                <updated>Wed, 3 Sep 2014 09:31:35 +0100</updated>
                            <resolved>Sat, 24 Aug 2013 16:26:40 +0100</resolved>
                                                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13734366" author="bryanpendleton" created="Fri, 9 Aug 2013 04:49:23 +0100"  >&lt;p&gt;Hi Ahsan,&lt;/p&gt;

&lt;p&gt;You should have a look through &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3176&quot; title=&quot;J2ME support for phoneME platform disabled in 10.3&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3176&quot;&gt;&lt;del&gt;DERBY-3176&lt;/del&gt;&lt;/a&gt; to get some history about the JVMInfo class.&lt;/p&gt;

&lt;p&gt;I think we should try adding some tests in org.apache.derbyTesting.functionTests.tests.tools.SysinfoAPITest&lt;/p&gt;

&lt;p&gt;Can you try just adding:&lt;/p&gt;

&lt;p&gt;import org.apache.derby.iapi.services.info.JVMInfo;&lt;/p&gt;

&lt;p&gt;and then add some test cases that directly invoke the methods in JVMinfo?&lt;/p&gt;

&lt;p&gt;The first test to add is just something like:&lt;/p&gt;

&lt;p&gt;  assertTrue( &lt;br/&gt;
       JVMInfo.JDK_ID == JVMInfo.J2SE_16 ||&lt;br/&gt;
       JVMInfo.JDK_ID == JVMInfo.J2SE_17 ||&lt;br/&gt;
       JVMInfo.JDK_ID == JVMInfo.J2SE_18 );&lt;/p&gt;</comment>
                            <comment id="13734369" author="bryanpendleton" created="Fri, 9 Aug 2013 04:52:46 +0100"  >&lt;p&gt;We also need to look at &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2343&quot; title=&quot;sysinfo API only returns correct information for the first jar file on the classpath&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2343&quot;&gt;DERBY-2343&lt;/a&gt;, as that may impact our ability to test JVMInfo using SysinfoAPITest.&lt;/p&gt;

&lt;p&gt;Perhaps the new tests should be placed into SysinfoCPCheckTest.java instead, at least&lt;br/&gt;
until &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2343&quot; title=&quot;sysinfo API only returns correct information for the first jar file on the classpath&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2343&quot;&gt;DERBY-2343&lt;/a&gt; is fixed.&lt;/p&gt;</comment>
                            <comment id="13736245" author="ahsancse" created="Sun, 11 Aug 2013 11:00:32 +0100"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;In my new derby checkout , I am unable to run test classes. It will throw the following error. Frustrating.&lt;/p&gt;

&lt;p&gt;Class not found testing.org.apache.derbyTesting.functionTests.tests.tools.SysinfoCPCheckTest&lt;br/&gt;
java.lang.ClassNotFoundException: testing.org.apache.derbyTesting.functionTests.tests.tools.SysinfoCPCheckTest&lt;br/&gt;
	at java.net.URLClassLoader$1.run(Unknown Source)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
	at java.net.URLClassLoader.findClass(Unknown Source)&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(Unknown Source)&lt;br/&gt;
	at sun.misc.Launcher$AppClassLoader.loadClass(Unknown Source)&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(Unknown Source)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.loadClass(RemoteTestRunner.java:693)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.loadClasses(RemoteTestRunner.java:429)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:452)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)&lt;/p&gt;

&lt;p&gt;Is there any versioning issues associated with this ?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Ahsan&lt;/p&gt;</comment>
                            <comment id="13736327" author="kmarsden" created="Sun, 11 Aug 2013 17:13:42 +0100"  >&lt;p&gt;It sounds like a CLASSPATH issue.  Compare your CLASSPATH to the actual location of your jars under &amp;lt;top of workspace&amp;gt;/jars/&amp;lt;sane|insane&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13736343" author="bryanpendleton" created="Sun, 11 Aug 2013 18:18:50 +0100"  >&lt;p&gt;I have a 1-line batch file that I use to set my CLASSPATH for running junit tests directly. Here it is:&lt;/p&gt;

&lt;p&gt;set CLASSPATH=\users\Bryan\derby\trunk\jars\sane\derbyrun.jar;\users\bryan\derby\trunk\jars\sane\derbyTesting.jar;\users\bryan\derby\trunk\tools\java\junit.jar;\users\bryan\derby\trunk\tools\java\jakarta-oro-2.0.8.jar&lt;/p&gt;

&lt;p&gt;Of course, on your computer, you would change &apos;/users/bryan/derby&apos; to the correct values for your configuration.&lt;/p&gt;</comment>
                            <comment id="13740854" author="ahsancse" created="Thu, 15 Aug 2013 11:29:09 +0100"  >&lt;p&gt;Some of the methods in the JVMinfo class has methods which return boolean values(isSunJVM(), isIBMJVM()).These methods only returns true or false. For this case, i just need to compare the output with expected or any other standard ways exist? &lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Ahsan&lt;/p&gt;</comment>
                            <comment id="13740991" author="bryanpendleton" created="Thu, 15 Aug 2013 15:18:03 +0100"  >&lt;p&gt;For the isSunJVM and isIBMJVM methods, I think all we want to do is call the methods and&lt;br/&gt;
verify that they don&apos;t throw an exception. Since we sometimes run our test suites using the&lt;br/&gt;
Sun JVM, and sometimes using the IBM JVM, the expected results could be either true or&lt;br/&gt;
false, and neither one is the &quot;right&quot; answer, always.&lt;/p&gt;

&lt;p&gt;So either true or false is valid, and the test should pass either way, but throwing an exception&lt;br/&gt;
is a failure.&lt;/p&gt;

&lt;p&gt;bryan&lt;/p&gt;</comment>
                            <comment id="13741093" author="ahsancse" created="Thu, 15 Aug 2013 16:49:57 +0100"  >&lt;p&gt;I have added test cases for some methods. I&apos;ll working on the rest. Look at this and suggest me any required improvements.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Ahsan&lt;/p&gt;</comment>
                            <comment id="13743122" author="bryanpendleton" created="Sun, 18 Aug 2013 05:03:46 +0100"  >&lt;p&gt;The patch applies and builds fine in my environment (Sun 1.7 JDK).&lt;/p&gt;

&lt;p&gt;There is a duplicate &quot;import&quot; statement in the patch which seems unneeded.&lt;/p&gt;

&lt;p&gt;I ran SysinfoCPCheckTest under Jacoco with the patch applied, and&lt;br/&gt;
the expected methods are recorded as being covered now.&lt;/p&gt;

&lt;p&gt;The only method that is reported as uncovered now is &quot;javaDump&quot;,&lt;br/&gt;
but I&apos;m not sure what that method does (I don&apos;t have an IBM JDK).&lt;/p&gt;</comment>
                            <comment id="13744738" author="ahsancse" created="Tue, 20 Aug 2013 07:04:52 +0100"  >&lt;p&gt;This patch covers all the method except javadump(). I don&apos;t have an IBM JDK(same like Bryan) and This method have void as the return type. Any ideas to get this method done ?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Ahsan&lt;/p&gt;</comment>
                            <comment id="13745125" author="myrna" created="Tue, 20 Aug 2013 17:56:11 +0100"  >&lt;p&gt;I do have an IBM jvm, but I&apos;ve not been following your code coverage work closely and I&apos;m not sure what I can do to help. Can you give suggestions?&lt;/p&gt;</comment>
                            <comment id="13745270" author="ahsancse" created="Tue, 20 Aug 2013 19:45:46 +0100"  >&lt;p&gt;I need to write test case for the following method.&lt;/p&gt;

&lt;p&gt;public static void javaDump() {&lt;br/&gt;
        if (isIBMJVM()) {&lt;br/&gt;
            Class&amp;lt;?&amp;gt; ibmc = null;&lt;br/&gt;
            try {&lt;br/&gt;
                ibmc = Class.forName(&quot;com.ibm.jvm.Dump&quot;);&lt;br/&gt;
                final Method ibmm = ibmc.getMethod(&quot;JavaDump&quot;, new Class&amp;lt;?&amp;gt;[] {});&lt;/p&gt;

&lt;p&gt;                AccessController.doPrivileged(new PrivilegedExceptionAction&amp;lt;Object&amp;gt;() {&lt;br/&gt;
                    public Object run() throws IllegalAccessException,&lt;br/&gt;
                            MalformedURLException, InstantiationException,&lt;br/&gt;
                            InvocationTargetException {&lt;br/&gt;
                        return ibmm.invoke(null, new Object[] {});&lt;/p&gt;

&lt;p&gt;                    }&lt;br/&gt;
                });&lt;br/&gt;
            } catch (Exception e) {&lt;br/&gt;
                if (SanityManager.DEBUG) &lt;/p&gt;
{
                    SanityManager
                            .THROWASSERT(
                                    &quot;Failed to execute com.ibm.jvm.Dump.JavaDump in IBM JVM&quot;,
                                    e);
                }
&lt;p&gt;            }&lt;br/&gt;
        }&lt;br/&gt;
    }&lt;/p&gt;


&lt;p&gt;Since, I don&apos;t have an IBM JVM, I couldn&apos;t execute this in my environment.Because the condition isIBMJVM() is always tends to be false in my environment.&lt;/p&gt;

&lt;p&gt;Bryan, correct me If I&apos;m wrong.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Ahsan  &lt;/p&gt;</comment>
                            <comment id="13745653" author="bryanpendleton" created="Wed, 21 Aug 2013 00:57:30 +0100"  >&lt;p&gt;Hi Myrna, thanks for the offer of help.&lt;/p&gt;

&lt;p&gt;I think the question is: if we add a new test method in &lt;br/&gt;
SysinfoCPCheckTest.java, something like:&lt;/p&gt;

&lt;p&gt;    public void testJavaDump()&lt;/p&gt;
    {
        /* We just want to call this method to verify that it doesn&apos;t crash */
        JVMInfo.javaDump();
    }

&lt;p&gt;will that test reliably pass for test configurations&lt;br/&gt;
that use an IBM JVM?&lt;/p&gt;

&lt;p&gt;thanks,&lt;/p&gt;

&lt;p&gt;bryan&lt;/p&gt;</comment>
                            <comment id="13748315" author="myrna" created="Fri, 23 Aug 2013 06:51:49 +0100"  >&lt;p&gt;Thanks Bryan, for spelling it out in detail...&lt;/p&gt;

&lt;p&gt;The javadump method allows a programmer with access to ibm jvms to request a javacore dump file at any practical spot. &lt;/p&gt;

&lt;p&gt;Yes, adding such a fixture to that test passes, I tried with ibm 16, and jdk prerelease 1.8. &lt;br/&gt;
However, I have the following concerns:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;with IBM jvms (I believe &amp;gt; 1.5) the javadump method generates a file, something like javacore.20130822.123456.1234.0001.txt. I&apos;m not entirely sure of all the pieces, but the first is the date, and the last is a sequence number.&lt;br/&gt;
This file should get deleted after the test is done, for it might seem like something bad happened&lt;/li&gt;
	&lt;li&gt;with IBM jvms, it also prints out a message to the console, if my test dir is: c:\myrna\d6164tst it is:&lt;br/&gt;
&quot;JVMDUMP034I User requested Java dump using &apos;C:\myrna\d6164tst\javacore.20130822.144351.7688.0001.txt&apos; through com.ibm.jvm.Dump.JavaDump&lt;br/&gt;
JVMDUMP010I Java dump written to C:\myrna\d6164tst\javacore.20130822.144351.7688.0001.txt&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think this is two lines.&lt;br/&gt;
I know some automatic checking scripts look for strings like this to decide on failure, so these lines should get caught and perhaps even be checked.&lt;br/&gt;
I&apos;ve been trying to mimic what&apos;s done in the SysinfoCPCheckPathTest fixture testClassPathChecker but so far it&apos;s not working. I thought perhaps checking on System.out was the wrong thing, and I should be redirecting System.err instead, but so far, it still prints out to the console, and my stream is null.&lt;br/&gt;
I&apos;ll give it another go tomorrow, if I cannot figure it out, I&apos;ll post my attempt, perhaps someone else can see where I go wrong.&lt;/p&gt;
</comment>
                            <comment id="13749411" author="jira-bot" created="Sat, 24 Aug 2013 16:24:40 +0100"  >&lt;p&gt;Commit 1517149 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bryanpendleton&quot; class=&quot;user-hover&quot; rel=&quot;bryanpendleton&quot;&gt;Bryan Pendleton&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1517149&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1517149&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6307&quot; title=&quot;Improve the code coverage of org.apache.derby.iapi.services.info.JVMInfo&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6307&quot;&gt;&lt;del&gt;DERBY-6307&lt;/del&gt;&lt;/a&gt;: Improve code coverage of org.apache.derby.iapi.services.info&lt;/p&gt;

&lt;p&gt;This patch was contributed by Ahsan Shamsudeen (ahsan dot competition at gmail dot com)&lt;/p&gt;

&lt;p&gt;This patch adds several tests which directly exercise the utility methods in&lt;br/&gt;
org.apache.derby.iapi.services.info.JVMInfo.&lt;/p&gt;

&lt;p&gt;Note that the precise code paths that are tested by these new test cases will&lt;br/&gt;
depend on the configuration of the test environment, since the JVMInfo code&lt;br/&gt;
is highly sensitive to the user&apos;s JDK level and JDK vendor.&lt;/p&gt;

&lt;p&gt;The only JVMInfo method not directly tested at this point is javaDump,&lt;br/&gt;
which is a bit delicate to directly test because exercising this method can&lt;br/&gt;
give the appearance that a fatal error has occurred, which might confuse&lt;br/&gt;
somebody running the tests into thinking there was a real crash instead of&lt;br/&gt;
just an artificial execution of javaDump. So testing that method is deferred&lt;br/&gt;
until a later date.&lt;/p&gt;</comment>
                            <comment id="13749413" author="bryanpendleton" created="Sat, 24 Aug 2013 16:26:40 +0100"  >&lt;p&gt;Committed to the trunk as revision 1517149.&lt;/p&gt;

&lt;p&gt;Ahsan, thank you for the contribution to Derby!&lt;/p&gt;

&lt;p&gt;Myrna, thank you for your help, and for your explanation of&lt;br/&gt;
the complexities of testing javaDump. For the time being,&lt;br/&gt;
it seems best to defer this work, and leave it for a later&lt;br/&gt;
project. The patch as is adds value to the test suite, so&lt;br/&gt;
I decided to move ahead with it.&lt;/p&gt;

&lt;p&gt;I believe we can declare this issue resolved.&lt;/p&gt;</comment>
                            <comment id="13750292" author="myrna" created="Mon, 26 Aug 2013 18:41:43 +0100"  >&lt;p&gt;I agree that deferring testing of the javaDump() method is the right thing to do.&lt;br/&gt;
To document my findings: I tried to capture the output, but it appears the method causes the IBM JVMs to send a request to the OS, which 1. is possibly different per OS and so gives possibly different results per OS, and 2. prints out text that cannot be captured by System.out or System.err. Perhaps if we&apos;d call the method in a different process, but I think it all gets too complex for the usage of the method.&lt;br/&gt;
The method is only used in two places (NetworkServerTestSetup, which I don&apos;t think counts in the code coverage, and ContextManager, in the case of an error).&lt;/p&gt;</comment>
                            <comment id="14119603" author="knutanders" created="Wed, 3 Sep 2014 09:31:35 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12598912" name="DERBY-6307.patch" size="2275" author="ahsancse" created="Tue, 20 Aug 2013 07:04:52 +0100"/>
                            <attachment id="12598233" name="DERBY-6307Temp.patch" size="2424" author="ahsancse" created="Thu, 15 Aug 2013 16:49:57 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 9 Aug 2013 03:49:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>340765</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzgm6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>341083</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>