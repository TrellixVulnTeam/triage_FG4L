<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:47:48 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-654/DERBY-654.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-654] unit/T_RawStoreFactory.unit fails with an assert failure in J2ME/CDC/FP</title>
                <link>https://issues.apache.org/jira/browse/DERBY-654</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I am thinking this is a bug and opening a JIRA issue since I did not get any response to my question in derby-dev. One more thing I noticed is this test passes in 10.1 branch.  It is failing only in trunk.&lt;/p&gt;

&lt;p&gt;The test unit/T_RawStoreFactory.unit fails with an assert failure in CDC/FP. This failure looks like an intermittent one though it is failing all the time now. I have run this test successfully some time back. I would like to find out if this is a bug (Derby or jvm) or just an intermittent failure. I am using j9 foundation  from IBM WCTME5.7.&lt;/p&gt;

&lt;p&gt;---------------------------------------------------------------------&lt;br/&gt;
diff for the test:&lt;br/&gt;
---------------------------------------------------------------------&lt;br/&gt;
 &amp;lt; &amp;#8211; Unit Test T_RawStoreFactory finished&lt;br/&gt;
 2 add&lt;br/&gt;
 &amp;gt; There should be 0 observers, but we still have 1 observers.&lt;br/&gt;
&amp;gt; Shutting down due to unit test failure.&lt;br/&gt;
---------------------------------------------------------------------&lt;br/&gt;
stack trace for AssertFailure in derby.log is:&lt;br/&gt;
---------------------------------------------------------------------&lt;br/&gt;
 FAIL - org.apache.derby.iapi.services.sanity.AssertFailure: ASSERT&lt;br/&gt;
FAILED still on observer list&lt;br/&gt;
org.apache.derby.impl.store.raw.data.TruncateOnCommit@f147d525&lt;br/&gt;
org.apache.derby.iapi.services.sanity.AssertFailure: ASSERT FAILED&lt;br/&gt;
still on observer list&lt;br/&gt;
org.apache.derby.impl.store.raw.data.TruncateOnCommit@f147d525&lt;br/&gt;
       at org.apache.derby.iapi.services.sanity.SanityManager.THROWASSERT(SanityManager.java:150)&lt;br/&gt;
       at org.apache.derby.impl.store.raw.data.TruncateOnCommit.update(TruncateOnCommit.java:69)&lt;br/&gt;
       at java.util.Observable.notifyObservers(Observable.java:117)&lt;br/&gt;
       at org.apache.derby.iapi.store.raw.xact.RawTransaction.notifyObservers(RawTransaction.java:313)&lt;br/&gt;
       at org.apache.derby.impl.store.raw.xact.Xact.doComplete(Xact.java:1927)&lt;br/&gt;
       at org.apache.derby.impl.store.raw.xact.Xact.preComplete(Xact.java:1880)&lt;br/&gt;
       at org.apache.derby.impl.store.raw.xact.Xact.prepareCommit(Xact.java:726)&lt;br/&gt;
       at org.apache.derby.impl.store.raw.xact.Xact.commit(Xact.java:839)&lt;br/&gt;
       at org.apache.derby.impl.store.raw.xact.Xact.commit(Xact.java:636)&lt;br/&gt;
       at org.apache.derbyTesting.unitTests.store.T_Util.t_commit(T_Util.java:838)&lt;br/&gt;
       at org.apache.derbyTesting.unitTests.store.T_RawStoreFactory.TC001(T_RawStoreFactory.java:7435)&lt;br/&gt;
       at org.apache.derbyTesting.unitTests.store.T_RawStoreFactory.runTempTests(T_RawStoreFactory.java:420)&lt;br/&gt;
       at org.apache.derbyTesting.unitTests.store.T_RawStoreFactory.runTestSet(T_RawStoreFactory.java:247)&lt;br/&gt;
       at org.apache.derbyTesting.unitTests.harness.T_MultiIterations.runTests(T_MultiIterations.java:94)&lt;br/&gt;
       at org.apache.derbyTesting.unitTests.harness.T_MultiThreadedIterations.runTests(T_MultiThreadedIterations.java:91)&lt;br/&gt;
       at org.apache.derbyTesting.unitTests.harness.T_Generic.Execute(T_Generic.java:117)&lt;br/&gt;
       at org.apache.derbyTesting.unitTests.harness.BasicUnitTestManager.runATest(BasicUnitTestManager.java:183)&lt;br/&gt;
       at org.apache.derbyTesting.unitTests.harness.BasicUnitTestManager.runTests(BasicUnitTestManager.java:245)&lt;br/&gt;
       at org.apache.derbyTesting.unitTests.harness.BasicUnitTestManager.boot(BasicUnitTestManager.java:92)&lt;br/&gt;
       at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:2008)&lt;br/&gt;
       at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290)&lt;br/&gt;
       at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1846)&lt;br/&gt;
       at org.apache.derby.impl.services.monitor.BaseMonitor.startServices(BaseMonitor.java:966)&lt;br/&gt;
       at org.apache.derby.impl.services.monitor.BaseMonitor.runWithState(BaseMonitor.java:398)&lt;br/&gt;
       at org.apache.derby.impl.services.monitor.FileMonitor.&amp;lt;init&amp;gt;(FileMonitor.java:59)&lt;br/&gt;
       at org.apache.derby.iapi.services.monitor.Monitor.startMonitor(Monitor.java:288)&lt;br/&gt;
       at org.apache.derbyTesting.unitTests.harness.UnitTestMain.main(UnitTestMain.java:50)&lt;br/&gt;
---------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;On looking at the code, I did not understand how this assert failure can happen. The assert is thrown in following code in TruncateOnCommit: &lt;br/&gt;
public void update(Observable obj, Object arg) {&lt;br/&gt;
       if (SanityManager.DEBUG) &lt;/p&gt;
{
               if (arg == null)
               SanityManager.THROWASSERT(&quot;still on observer list &quot; + this);
       }

&lt;p&gt;I am puzzled by how &apos;arg&apos; can become null in this case. As I understand, &apos;update&apos; method of each Observer gets called by the notifyObserver method in java.util.Observable class. notifyObserver passes &apos;arg&apos;, which describes the type of change, as the second argument to update. In this code path, &apos;arg&apos; passed to notifyObserver is RawTransaction.COMMIT (which is not null).  However the code has an assert to check for null value which means there is some situation where the &apos;arg&apos; can become null.  I have not understood what causes this situation but it is always being hit when running in this environment. &lt;/p&gt;</description>
                <environment>IBM WCTME5.7 j9 foundation VM </environment>
        <key id="12325081">DERBY-654</key>
            <summary>unit/T_RawStoreFactory.unit fails with an assert failure in J2ME/CDC/FP</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="deepa">Deepa Remesh</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Oct 2005 01:24:29 +0100</created>
                <updated>Tue, 21 Jul 2009 18:42:04 +0100</updated>
                            <resolved>Tue, 21 Jul 2009 18:42:04 +0100</resolved>
                                    <version>10.2.1.6</version>
                                                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12362271" author="kmarsden" created="Tue, 10 Jan 2006 09:52:04 +0000"  >&lt;p&gt;In addition to answering Deepa&apos;s specific questions,  It would be good if someone with some Store knowledge could comment on this assertion  and estimate how serious it is.  We have not seen it manifested in any functional tests, but it does appear to be a regression from 10.1  so perhaps it should be marked with higher priority.&lt;/p&gt;
</comment>
                            <comment id="12363680" author="skambha" created="Tue, 24 Jan 2006 00:18:59 +0000"  >&lt;p&gt;I ran this test on my win2k/T40 laptop with wctme5.7 and this test passed OK.  I ran this test about 100 times repeatedly and it worked OK.&lt;/p&gt;

&lt;p&gt;If for someone, this test fails on their machine, can you please post more info - that would help to debug this failure. Thanks. &lt;/p&gt;</comment>
                            <comment id="12363681" author="skambha" created="Tue, 24 Jan 2006 00:20:08 +0000"  >&lt;p&gt;With respect to my earlier comment - Test passed OK with revision: 369993 on trunk (10.2)&lt;/p&gt;</comment>
                            <comment id="12368793" author="skambha" created="Sat, 4 Mar 2006 05:58:10 +0000"  >&lt;p&gt;As I was preparing to disable this test from running in the j9 vms, I ran this test one more time and it failed on my machine (win2k/t40). Looking at the diff, it is similar to the stack trace attached to this jira. &lt;/p&gt;

&lt;p&gt;1)I looked little bit at the code and I think this is the reason that a null arg is passed to the update(Observable obj,Object arg). &lt;/p&gt;

&lt;p&gt;In Xact.doComplete(), notifyObservers is called either with a commit or abort. After this step, in debug block, there is a check to countObservers and if observers!= 0, then another notifyObservers call is made with an arg of null.  This notify call is sending an arg of null and hence the update of TruncateOnCommit is getting a null arg and the assert failure. &lt;/p&gt;

&lt;p&gt;2) I put printlns and noticed that the first notifyObserver call in Xact.doComplete is actually making to the TruncateOnCommit and there it calls deleteObserver.  I am just not sure why the countObservers does not become 0. My guess is it maybe some timing issue.&lt;br/&gt;
Put checks in Xact.preComplete and verified that none of the corrupt conditions were happening here.&lt;/p&gt;

&lt;p&gt;&amp;#8211; I quickly tried if i could run with 10.2 derbyTesting.jar with 10.1 derby.jar but hit a npe in harness stuff. Didnt spend much time looking at it. &lt;/p&gt;

&lt;p&gt;In the meantime, I am attaching a patch (derby654.diff.txt) to disable this test with the wctme5.7 foundation and wsdd5.6.&lt;/p&gt;

&lt;p&gt;I think we should keep this bug open and someone can look at it and investigate whats the cause for this in the j9 vms. &lt;/p&gt;

&lt;p&gt;If this is ok, can someone please review and commit this patch. Thanks. &lt;/p&gt;</comment>
                            <comment id="12368796" author="mikem" created="Sat, 4 Mar 2006 06:20:35 +0000"  >&lt;p&gt;I have committed this change.  Removing it from the regression suite as no one is actively working on fixing this issue.  It is removed from the regression tests suite in the failing platform, so I have removed that component.&lt;/p&gt;

&lt;p&gt;m1_142:1&amp;gt;svn commit&lt;/p&gt;

&lt;p&gt;Adding         java\testing\org\apache\derbyTesting\functionTests\tests\unit\T_R&lt;br/&gt;
awStoreFactory_app.properties&lt;br/&gt;
Transmitting file data .&lt;br/&gt;
Committed revision 382931.&lt;/p&gt;</comment>
                            <comment id="12733743" author="rhillegas" created="Tue, 21 Jul 2009 18:42:04 +0100"  >&lt;p&gt;Closing this issue because the test was disabled on the offending platform and no-one has expressed any interest in this issue in 3 years.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12323690" name="Derby654.stat.txt" size="103" author="skambha" created="Sat, 4 Mar 2006 05:58:10 +0000"/>
                            <attachment id="12323689" name="derby654.diff.txt" size="539" author="skambha" created="Sat, 4 Mar 2006 05:58:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 10 Jan 2006 09:52:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22074</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0rzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38352</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>