<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:49:51 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5682/DERBY-5682.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5682] ProtocolTest failures: Unsupported encoding MacGreek</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5682</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I saw two failures in ProtocolTest when running them on a JVM where support for encodings not mandated by the Java platform specification had been removed.&lt;/p&gt;

&lt;p&gt;There were 2 failures:&lt;br/&gt;
1) protocol.tests_1150_1212(org.apache.derbyTesting.functionTests.tests.derbynet.ProtocolTest)junit.framework.AssertionFailedError: Unsupported encoding MacGreek&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.fail(BaseTestCase.java:879)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.ProtocolTest.writeEncodedLDString(ProtocolTest.java:781)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.ProtocolTest.processCommand(ProtocolTest.java:324)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.ProtocolTest.processCommands(ProtocolTest.java:230)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.ProtocolTest.testProtocolSequence(ProtocolTest.java:148)&lt;br/&gt;
	at sun.reflect.GeneratedMethodAccessor13.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:27)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:27)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:27)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:27)&lt;br/&gt;
Caused by: java.io.UnsupportedEncodingException: MacGreek&lt;br/&gt;
	at java.lang.StringCoding.encode(StringCoding.java:340)&lt;br/&gt;
	at java.lang.String.getBytes(String.java:955)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.ProtocolTest.writeEncodedLDString(ProtocolTest.java:774)&lt;br/&gt;
	... 41 more&lt;/p&gt;

&lt;p&gt;2) protocol.tests_1213_1243(org.apache.derbyTesting.functionTests.tests.derbynet.ProtocolTest)junit.framework.AssertionFailedError: Unsupported encoding MacGreek&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.fail(BaseTestCase.java:879)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.ProtocolTest.writeEncodedLDString(ProtocolTest.java:781)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.ProtocolTest.processCommand(ProtocolTest.java:324)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.ProtocolTest.processCommands(ProtocolTest.java:230)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.ProtocolTest.testProtocolSequence(ProtocolTest.java:148)&lt;br/&gt;
	at sun.reflect.GeneratedMethodAccessor13.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:27)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:27)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:27)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:27)&lt;br/&gt;
Caused by: java.io.UnsupportedEncodingException: MacGreek&lt;br/&gt;
	at java.lang.StringCoding.encode(StringCoding.java:340)&lt;br/&gt;
	at java.lang.String.getBytes(String.java:955)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.ProtocolTest.writeEncodedLDString(ProtocolTest.java:774)&lt;br/&gt;
	... 41 more&lt;/p&gt;</description>
                <environment></environment>
        <key id="12549024">DERBY-5682</key>
            <summary>ProtocolTest failures: Unsupported encoding MacGreek</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Sun, 1 Apr 2012 23:07:57 +0100</created>
                <updated>Tue, 24 Jul 2012 18:28:06 +0100</updated>
                            <resolved>Tue, 3 Apr 2012 06:18:57 +0100</resolved>
                                    <version>10.9.1.0</version>
                                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13243883" author="knutanders" created="Sun, 1 Apr 2012 23:14:37 +0100"  >&lt;p&gt;It looks to me as if the two test cases use MacGreek because they want to test a non-default CCSID. Using one that&apos;s guaranteed to be available on all platforms (like UTF-16) should be just as fine as using MacGreek, I think.&lt;/p&gt;</comment>
                            <comment id="13244010" author="kristwaa" created="Mon, 2 Apr 2012 08:02:17 +0100"  >&lt;p&gt;Started looking at this when I saw the JIRA got created, and missed that you had assigned yourself and already proposed a solution...&lt;/p&gt;

&lt;p&gt;Since my patch has already been produced, I&apos;m attaching it anyway.&lt;/p&gt;

&lt;p&gt;I agree that using a supported, but non-default, encoding is better, as the test itself is defined by the &quot;protocol test language&quot; in protocol.tests and this makes it a little worse to simply skip the test where MacGreek isn&apos;t supported.&lt;/p&gt;</comment>
                            <comment id="13244084" author="knutanders" created="Mon, 2 Apr 2012 10:16:31 +0100"  >&lt;p&gt;Thanks for picking up this bug, Kristian. I hadn&apos;t started on it (except a little reading of the code), so I&apos;m reassigning it to you.&lt;/p&gt;

&lt;p&gt;I applied the patch and verified that it ran successfully.&lt;/p&gt;

&lt;p&gt;The patch looks good to me. I&apos;m not completely sure, though, if the second argument to writeEncodedLDString should be &quot;UnicodeBigUnmarked&quot; or &quot;UTF-16BE&quot;. The argument ends up being passed to String.getBytes(String), whose javadoc says the encoding should be one supported by java.nio.charset.Charset, but java.nio.charset.Charset doesn&apos;t mention &quot;UnicodeBigUnmarked&quot;.&lt;/p&gt;

&lt;p&gt;On the other hand, &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/technotes/guides/intl/encoding.doc.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://docs.oracle.com/javase/7/docs/technotes/guides/intl/encoding.doc.html&lt;/a&gt; says &quot;UnicodeBigUnmarked&quot; is the canonical name for the java.lang APIs, so I suppose both names should be fairly portable. But this latter document is not part of the platform specification, I think, which is why I&apos;m not sure it&apos;s guaranteed to work.&lt;/p&gt;</comment>
                            <comment id="13244117" author="kristwaa" created="Mon, 2 Apr 2012 11:55:17 +0100"  >&lt;p&gt;Thanks for looking into the naming conventions, Knut Anders.&lt;/p&gt;

&lt;p&gt;The relevant Derby class (&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;) uses UnicodeBigUnmarked, which was what led me to the encoding doc. As the recommendation on this is to never remove an alias, I think UnicodeBigUnmarked should work for all VMs that have been around for a while - the fact that it is listed as a canonical name in the Internationalization Guide suggests so too.&lt;br/&gt;
However, it appears to me that it is easier to determine that UTF-16BE is always supported (&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;) since it is listed in the API Specification (the Javadocs), so I&apos;m using it instead in patch 1b (attached).&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; CharacterEncoding in the drda package, there&apos;s one for the client side too.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; The encoding doc/guide introduced UTF-16BE as a canonical name for the java.nio package in J2SE 1.4, whereas UnicodeBigUnmarked was the canonical name originally used in the Sun JDK.&lt;/p&gt;</comment>
                            <comment id="13244294" author="knutanders" created="Mon, 2 Apr 2012 17:21:32 +0100"  >&lt;p&gt;Thanks, Kristian. The 1b patch looks fine to me, and it still makes ProtocolTest pass in the environment that lacks support for MacGreek. +1 to commit.&lt;/p&gt;</comment>
                            <comment id="13244982" author="kristwaa" created="Tue, 3 Apr 2012 06:18:58 +0100"  >&lt;p&gt;Committed patch 1b to trunk with revision 1308694.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12520875" name="derby-5682-1a-use_supported_encoding.diff" size="1859" author="kristwaa" created="Mon, 2 Apr 2012 08:02:16 +0100"/>
                            <attachment id="12520965" name="derby-5682-1b-use_supported_encoding.diff" size="1839" author="kristwaa" created="Mon, 2 Apr 2012 11:55:17 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 2 Apr 2012 07:02:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>234097</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0anj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35544</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>