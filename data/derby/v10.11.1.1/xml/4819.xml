<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:08:25 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4819/DERBY-4819.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4819] add error reporting to ReplicationMessageTransmit.java MasterReceiverThread.run()</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4819</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;While working on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4812&quot; title=&quot;ReplicationMessageTransmit run does not unwrap PrivilegedActionException which can lead to failure of replicationTests.ReplicationRun_Local_StateTest_part1_1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4812&quot;&gt;&lt;del&gt;DERBY-4812&lt;/del&gt;&lt;/a&gt;, I noticed the following code in MasterReceiverThread,run().&lt;br/&gt;
I am not familiar enough with replication to know if the MasterReceiverThread can recover from such errors.  If it cannot i think it would better to have a clear failure at the time of the error than just a subsequent NullPointerException.&lt;br/&gt;
As the todo says, the exceptions should at least be logged.&lt;/p&gt;

&lt;p&gt;Also I just noticed this one bit of code, so don&apos;t know if there are similar issues or TODO&apos;s elsewhere in replication code.&lt;/p&gt;


&lt;p&gt;                } catch (SocketTimeoutException ste) &lt;/p&gt;
{
                    // ignore socket timeout on reads
                }
&lt;p&gt; catch (ClassNotFoundException cnfe) &lt;/p&gt;
{
                    // TODO: print problem to log
                }
&lt;p&gt; catch (IOException ex) &lt;/p&gt;
{
                    // TODO: print problem to log
                    // If we get an exception for this socket, the log shipper
                    // will clean up. Stop this thread.
                    stopMessageReceiver = true;
                    msgReceiver = null;
                }
&lt;p&gt;            }&lt;/p&gt;</description>
                <environment></environment>
        <key id="12474989">DERBY-4819</key>
            <summary>add error reporting to ReplicationMessageTransmit.java MasterReceiverThread.run()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="lilywei">Lily Wei</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                            <label>derby_triage10_8</label>
                    </labels>
                <created>Fri, 24 Sep 2010 01:35:18 +0100</created>
                <updated>Sat, 19 Feb 2011 03:20:50 +0000</updated>
                                            <version>10.4.2.0</version>
                    <version>10.5.3.0</version>
                    <version>10.6.1.0</version>
                    <version>10.7.1.1</version>
                                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12914376" author="knutanders" created="Fri, 24 Sep 2010 09:02:26 +0100"  >&lt;p&gt;I agree that we should log the ClassNotFoundException and the IOException. I don&apos;t think a SocketTimeoutException can happen here, since we haven&apos;t set a timeout on the socket, as far as I can see. Perhaps just let the SocketTimeoutException be handled by the IOException handler? Actually, I think it would be fine to handle the ClassNotFoundException the same way as IOException too, since that would indicate that the slave is not well-behaved.&lt;/p&gt;

&lt;p&gt;I didn&apos;t quite understand the comment about a clear failure at the time of the error rather than a subsequent NPE. With a clear failure, did you have something other in mind than logging the error? Since this is running in a separate thread, I don&apos;t think there&apos;s much else we can do. I don&apos;t see the potential for a NPE since we break out of the loop and stop the thread immediately after we&apos;ve set msgReceiver to null.&lt;/p&gt;</comment>
                            <comment id="12914378" author="knutanders" created="Fri, 24 Sep 2010 09:22:30 +0100"  >&lt;p&gt;It turns out that the msgReceiver field that&apos;s set to null in the error handler is not actually used except locally in startMessageReciverThread(). The other methods only set it to null and never actually use it. The attached patch removes the field and instead makes it a local variable in startMessageReciverThread(). It doesn&apos;t help with error reporting, but at least it simplifies the error handling a bit.&lt;/p&gt;</comment>
                            <comment id="12914416" author="knutanders" created="Fri, 24 Sep 2010 12:19:24 +0100"  >&lt;p&gt;All the tests ran cleanly with remove-msgReceiver.diff, so I committed revision 1000808.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12455471" name="remove-msgReceiver.diff" size="1568" author="knutanders" created="Fri, 24 Sep 2010 09:22:30 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 24 Sep 2010 08:02:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24479</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0htr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36706</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>