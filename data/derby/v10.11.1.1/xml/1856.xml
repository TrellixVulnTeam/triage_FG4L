<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:27:49 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1856/DERBY-1856.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1856] Multiple communication failures when starting server with derby.drda.timeSlice</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1856</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;In &lt;a href=&quot;http://www.nabble.com/Problem%3A-Communication-Link-Failure--derby.drda.timeSlice-p5966781.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/Problem%3A-Communication-Link-Failure--derby.drda.timeSlice-p5966781.html&lt;/a&gt; , Hannes Grund reported a problem with derby.drda.timeSlice property.&lt;/p&gt;

&lt;p&gt;I tried this property in my environment on trunk (10.3) and hit several communication failure problems with the following errors below.&lt;/p&gt;

&lt;p&gt;On server&lt;br/&gt;
------------&lt;br/&gt;
trunk2&amp;gt;java -Dderby.drda.maxThreads=100 -Dderby.drda.timeSlice=10000 org.apache.derby.drda.NetworkServerControl star&amp;gt;&lt;br/&gt;
Apache Derby Network Server - 10.3.0.0 alpha started and ready to accept connections on port 1527 at 2006-09-15 18:41:51.750 GMT&lt;br/&gt;
Execution failed because of Permanent Agent Error: SVRCOD = 40; RDBNAM = testdb5;create=true; diagnostic msg = Session in invalid state:4&lt;br/&gt;
org.apache.derby.impl.drda.DRDAProtocolException: Execution failed because of Permanent Agent Error: SVRCOD = 40; RDBNAM = testdb5;create=true; diagnostic msg = Session in invalid state:4&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAProtocolException.newAgentError(DRDAProtocolException.java:328)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.agentError(DRDAConnThread.java:476)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:278)&lt;br/&gt;
Execution failed because of Permanent Agent Error: SVRCOD = 40; RDBNAM = testdb5;create=true; diagnostic msg = Session in invalid state:4&lt;br/&gt;
org.apache.derby.impl.drda.DRDAProtocolException: Execution failed because of Permanent Agent Error: SVRCOD = 40; RDBNAM = testdb5;create=true; diagnostic msg = Session in invalid state:4&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAProtocolException.newAgentError(DRDAProtocolException.java:328)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.agentError(DRDAConnThread.java:476)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:278)&lt;/p&gt;


&lt;p&gt;On client:&lt;br/&gt;
-----------&lt;br/&gt;
trunk2&amp;gt;java org.apache.derby.tools.ij&lt;br/&gt;
ij version 10.3&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby://localhost:1527/testdb5;create=true;&apos;;&lt;br/&gt;
ij&amp;gt; select * from t1;&lt;br/&gt;
ERROR 42X05: Table/View &apos;T1&apos; does not exist.&lt;br/&gt;
ij&amp;gt; select * from t1;&lt;br/&gt;
ERROR 42X05: DERBY SQL error: SQLCODE: -1, SQLSTATE: 42X05, SQLERRMC: T1&#182;42X05&lt;br/&gt;
ij&amp;gt; select * from t1;&lt;br/&gt;
ERROR 58015: The DDM object 0x1232 is not supported.  The connection has been terminated.&lt;br/&gt;
ij&amp;gt; select * from t1;&lt;br/&gt;
ERROR 08003: No current connection.&lt;/p&gt;


&lt;p&gt;In some cases, the client gets the 58009 communications error. &lt;br/&gt;
trunk2&amp;gt;java org.apache.derby.tools.ij&lt;br/&gt;
ij version 10.3&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby://localhost:1527/testdb4;create=true;user=a;password=p&apos;;&lt;br/&gt;
ij&amp;gt; create table t1(i1 int);&lt;br/&gt;
ERROR 58009: A communications error has been detected: Software caused connection abort: recv failed.&lt;/p&gt;

&lt;p&gt;I am opening this jira because it seems like the basic problem may be just in the way the timeSlice property is being handled.  As part of this jira, make sure that the timeSlice property behaves the way it is expected to and also clarify the documentation. &lt;/p&gt;

&lt;p&gt;The documentation currently states this &quot;Use the derby.drda.timeslice property to set the number of milliseconds that each connection will use before yielding to another connection. &quot; and the default value is 0. Not clear what it means to have a default of 0. I think it is good to explain the behavior here. &lt;/p&gt;
</description>
                <environment>any ( but I tried  on windows/2k/t40 laptop/jdk142).</environment>
        <key id="12350057">DERBY-1856</key>
            <summary>Multiple communication failures when starting server with derby.drda.timeSlice</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bernt">Bernt M. Johnsen</assignee>
                                    <reporter username="skambha">Sunitha Kambhampati</reporter>
                        <labels>
                    </labels>
                <created>Fri, 15 Sep 2006 20:10:29 +0100</created>
                <updated>Tue, 30 Jun 2009 16:55:54 +0100</updated>
                            <resolved>Mon, 11 Dec 2006 14:03:54 +0000</resolved>
                                    <version>10.1.2.1</version>
                    <version>10.1.3.1</version>
                    <version>10.2.1.6</version>
                    <version>10.3.1.4</version>
                                    <fixVersion>10.1.3.2</fixVersion>
                    <fixVersion>10.2.2.0</fixVersion>
                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12456733" author="bernt" created="Fri, 8 Dec 2006 09:02:41 +0000"  >&lt;p&gt;The exception thrown is caused by a regression introduced in r126392&lt;br/&gt;
(2005-01-25) and is easily fixed by the attached&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1856&quot; title=&quot;Multiple communication failures when starting server with derby.drda.timeSlice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1856&quot;&gt;&lt;del&gt;DERBY-1856&lt;/del&gt;&lt;/a&gt;-r126392-regressionfix.diff. The cause is that two session&lt;br/&gt;
states introduced (SECACC and CHKSEC) is missing in the switch in&lt;br/&gt;
DRDAConnThread.run().&lt;/p&gt;

&lt;p&gt;Some comments: &lt;/p&gt;

&lt;p&gt;1) Testing of maxThreads/timeSlice is obviously non-existing since a&lt;br/&gt;
   regression can live for nearly two years. I&apos;ll file an issue on&lt;br/&gt;
   this.&lt;/p&gt;

&lt;p&gt;2) When timeSlice is defined, a timeout of the same size is set on the&lt;br/&gt;
   socket. It has been like this since the dawn of times (which in&lt;br/&gt;
   this case happens to be 2004-08-26 16:13:46), but Kathey added a&lt;br/&gt;
   comment that the timeout is &quot;highly suspect&quot;, and I agree. Since&lt;br/&gt;
   SocketTimeoutException (introduced in J2SE 1.4) is not handled, the&lt;br/&gt;
   socket will be closed down when the timeout expires. This may be ok&lt;br/&gt;
   for applications using a connection pool which sanitychecks&lt;br/&gt;
   connections before reusing them, but disastrous for other&lt;br/&gt;
   applications. Without the timeout, a DRDAConnThread waiting for&lt;br/&gt;
   input, will not yield until another request comes from the&lt;br/&gt;
   client.&lt;/p&gt;

&lt;p&gt;3) I experimented with catching the timeout in the DRDAConnThread as&lt;br/&gt;
   the only other change, and that seems to work. If the timeslice is&lt;br/&gt;
   setvery low (less than 100ms) I get problems which I guess stems&lt;br/&gt;
   from missing corner cases which may well appear with higher&lt;br/&gt;
   timeslices e.g. if the load is high or the query tekes a long time.&lt;/p&gt;


&lt;p&gt;I guess the best approach is to let the timeout be as it is for the&lt;br/&gt;
moment and file a separate issue for proper handling of the&lt;br/&gt;
timeout. &lt;/p&gt;

&lt;p&gt;Any comments?&lt;/p&gt;</comment>
                            <comment id="12456805" author="bernt" created="Fri, 8 Dec 2006 12:26:05 +0000"  >&lt;p&gt;Added a comment&lt;/p&gt;</comment>
                            <comment id="12456829" author="oysteing" created="Fri, 8 Dec 2006 13:54:22 +0000"  >&lt;p&gt;The fix looks good.  +1 to commit.&lt;br/&gt;
It would be great if you would make a test for timeSlice, too.&lt;/p&gt;</comment>
                            <comment id="12456837" author="bernt" created="Fri, 8 Dec 2006 14:13:14 +0000"  >&lt;p&gt;I have created &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2165&quot; title=&quot;Implement further testing of derby.drda.timeSlice property&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2165&quot;&gt;DERBY-2165&lt;/a&gt; for the test.&lt;/p&gt;</comment>
                            <comment id="12456839" author="bernt" created="Fri, 8 Dec 2006 14:15:22 +0000"  >&lt;p&gt;Committed revision 484615 on trunk&lt;/p&gt;</comment>
                            <comment id="12456843" author="bernt" created="Fri, 8 Dec 2006 14:19:44 +0000"  >&lt;p&gt;Committed revision 484616 on 10.2&lt;/p&gt;</comment>
                            <comment id="12457344" author="bernt" created="Mon, 11 Dec 2006 14:03:24 +0000"  >&lt;p&gt;Merge to 10.1&lt;/p&gt;</comment>
                            <comment id="12457345" author="bernt" created="Mon, 11 Dec 2006 14:03:54 +0000"  >&lt;p&gt;Committed revision 485667 on 10.1&lt;/p&gt;</comment>
                            <comment id="12551420" author="fuzzylogic" created="Thu, 13 Dec 2007 09:05:14 +0000"  >&lt;p&gt;This issue has been resolved for over a year with no further movement. Closing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12358111">DERBY-2165</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12358114">DERBY-2166</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12346763" name="DERBY-1856-r126392-regressionfix-v2.diff" size="551" author="bernt" created="Fri, 8 Dec 2006 12:26:05 +0000"/>
                            <attachment id="12346744" name="DERBY-1856-r126392-regressionfix.diff" size="475" author="bernt" created="Fri, 8 Dec 2006 09:02:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 8 Dec 2006 09:02:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22753</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0uq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38796</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>