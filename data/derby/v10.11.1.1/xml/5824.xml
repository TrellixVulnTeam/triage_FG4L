<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:08:19 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5824/DERBY-5824.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5824] testOSReadOnly fails with k.AssertionFailedError: expected an error indicating the db is readonly on HP java 1.6</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5824</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;This failure was reported running suites.All on HP. Read only database is apparently not read only.&lt;/p&gt;


&lt;p&gt;1) testOSReadOnly(org.apache.derbyTesting.functionTests.tests.store.OSReadOnlyTest)junit.framework.AssertionFailedError: expected an error indicating the db is readonly&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.OSReadOnlyTest.assertExpectedInsertBehaviour(OSReadOnlyTest.java:261)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.OSReadOnlyTest.testOSReadOnly(OSReadOnlyTest.java:139)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
2) testOSReadOnly(org.apache.derbyTesting.functionTests.tests.store.OSReadOnlyTest)junit.framework.AssertionFailedError: Failed to copy directory from /local1/derbytest/test/system/singleUse/oneuse4b to /local1/derbytest/test/system/singleUse/readOnly&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.OSReadOnlyTest.copyDatabaseOnOS(OSReadOnlyTest.java:282)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.OSReadOnlyTest.testOSReadOnly(OSReadOnlyTest.java:131)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;br/&gt;
Tests run: 11145,  Failures: 2,  Errors: 0&lt;/p&gt;

&lt;p&gt;bash-4.0#&lt;/p&gt;</description>
                <environment>HP Itanium Java version 1.6.0.14&lt;br/&gt;
OS name:         HP-UX&lt;br/&gt;
OS architecture: IA64N&lt;br/&gt;
OS version:      B.11.23&lt;br/&gt;
</environment>
        <key id="12595312">DERBY-5824</key>
            <summary>testOSReadOnly fails with k.AssertionFailedError: expected an error indicating the db is readonly on HP java 1.6</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                            <label>derby_triage10_11</label>
                    </labels>
                <created>Wed, 20 Jun 2012 19:00:57 +0100</created>
                <updated>Thu, 12 Jun 2014 09:56:24 +0100</updated>
                            <resolved>Thu, 12 Jun 2014 09:56:24 +0100</resolved>
                                    <version>10.5.3.1</version>
                                    <fixVersion>10.10.2.1</fixVersion>
                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="14009482" author="knutanders" created="Tue, 27 May 2014 09:11:00 +0100"  >&lt;p&gt;I don&apos;t know if that&apos;s what caused the problem originally reported, but I do see similar test failures if I run the test as root. I think the test makes some/all database files read-only, and then it expects to be unable to modify them. The root user is probably able to modify the database files even if they have the read-only bit set, and the test fails.&lt;/p&gt;</comment>
                            <comment id="14009698" author="rhillegas" created="Tue, 27 May 2014 15:11:10 +0100"  >&lt;p&gt;Thanks for that analysis, Knut. That sounds like a plausible explanation of this problem. This defect in this test probably affects all *nix platforms. Probably Windows platforms too.&lt;/p&gt;

&lt;p&gt;The test is trying to simulate running on read-only media. But the simulation isn&apos;t good enough.&lt;/p&gt;

&lt;p&gt;At a minimum, the test should be disabled if the user is the operating system&apos;s super-user account. However, I don&apos;t know how to detect that condition inside Java.&lt;/p&gt;

&lt;p&gt;I recommend removing this test from the regression suite. We can flag it as a test case which we run standalone from a non-root account when we vet releases. Or not.&lt;/p&gt;

&lt;p&gt;I am not terribly worried about removing this test. If the database really is located on read-only media, then I think Derby won&apos;t be able to circumvent the properties of the media. If Derby could, then, yes, there&apos;d be a bug, but not in Derby. The bug would be at the OS level beneath Derby.&lt;/p&gt;

&lt;p&gt;What are your thoughts?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="14009727" author="knutanders" created="Tue, 27 May 2014 15:46:12 +0100"  >&lt;p&gt;Maybe the test framework could set the read-only bit on a temporary file and then try to modify it. If it can modify it, it should skip the test. Otherwise, it could run the test. That&apos;s more generic than checking for a specific user account. There&apos;s also a possibility that the test fails because of some OS/file system peculiarity, for example that even non-privileged users are allowed to modify a file after they have set the read-only flag on it, if they own it. Having the test framework do the more generic check, would help silence the test in such environments too.&lt;/p&gt;

&lt;p&gt;I think the test has some value in that it verifies that attempts to modify a read-only database fail gracefully, not with NPEs and assert failures.&lt;/p&gt;</comment>
                            <comment id="14009746" author="rhillegas" created="Tue, 27 May 2014 15:56:38 +0100"  >&lt;p&gt;That&apos;s a clever solution. I don&apos;t have a better idea. Thanks.&lt;/p&gt;</comment>
                            <comment id="14016367" author="knutanders" created="Tue, 3 Jun 2014 11:26:55 +0100"  >&lt;p&gt;This issue was reported against 10.5, so the original problem might also have been caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4804&quot; title=&quot;Make database used in store.OSReadOnlyTest fully read-only&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4804&quot;&gt;&lt;del&gt;DERBY-4804&lt;/del&gt;&lt;/a&gt; (fixed in 10.7). Before that fix, the database used in the test was only partially read-only. But let&apos;s add the fix that skips the test for privileged users too, just in case.&lt;/p&gt;</comment>
                            <comment id="14016482" author="knutanders" created="Tue, 3 Jun 2014 14:15:54 +0100"  >&lt;p&gt;The attached patch, &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12648144/12648144_disable-for-root.diff&quot; title=&quot;disable-for-root.diff attached to DERBY-5824&quot;&gt;disable-for-root.diff&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;, adds the following check to the test:&lt;/p&gt;

&lt;p&gt;1) Create a temporary file in the directory in which the test runs&lt;/p&gt;

&lt;p&gt;2) Make the temporary file read-only&lt;/p&gt;

&lt;p&gt;3) Attempt to open the file in read-write mode&lt;/p&gt;

&lt;p&gt;If 3 fails, all is good, and the test runs. If 3 is successful, it means the database is not going to be read-only, so a message is printed and the test is skipped.&lt;/p&gt;

&lt;p&gt;I&apos;m now able to run the test as root without failures.&lt;/p&gt;

&lt;p&gt;I&apos;ve run the entire test suite with the patch. I saw one failure (logged as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6595&quot; title=&quot;CheckToursDBTest failed while updating sequence value on disk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6595&quot;&gt;&lt;del&gt;DERBY-6595&lt;/del&gt;&lt;/a&gt;), but I think it&apos;s not related to the patch. The failing test passed when I reran it.&lt;/p&gt;</comment>
                            <comment id="14016500" author="rhillegas" created="Tue, 3 Jun 2014 14:34:12 +0100"  >&lt;p&gt;Thanks, Knut. Looks good to me. +1&lt;/p&gt;</comment>
                            <comment id="14016508" author="jira-bot" created="Tue, 3 Jun 2014 14:43:07 +0100"  >&lt;p&gt;Commit 1599544 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1599544&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1599544&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5824&quot; title=&quot;testOSReadOnly fails with k.AssertionFailedError: expected an error indicating the db is readonly on HP java 1.6&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5824&quot;&gt;&lt;del&gt;DERBY-5824&lt;/del&gt;&lt;/a&gt;: Disable OSReadOnlyTest when run as privileged user&lt;/p&gt;

&lt;p&gt;When running the test as root, it is able to modify the database even&lt;br/&gt;
though all database files have been made read-only. Disable the test&lt;br/&gt;
in such environments.&lt;/p&gt;</comment>
                            <comment id="14016510" author="knutanders" created="Tue, 3 Jun 2014 14:44:47 +0100"  >&lt;p&gt;Thanks, Rick. I&apos;ve committed the patch to trunk. Will probably backport it to 10.10 as well, if it doesn&apos;t cause any problems in the nightly tests.&lt;/p&gt;</comment>
                            <comment id="14028946" author="jira-bot" created="Thu, 12 Jun 2014 09:55:43 +0100"  >&lt;p&gt;Commit 1602096 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/branches/10.10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1602096&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1602096&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5824&quot; title=&quot;testOSReadOnly fails with k.AssertionFailedError: expected an error indicating the db is readonly on HP java 1.6&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5824&quot;&gt;&lt;del&gt;DERBY-5824&lt;/del&gt;&lt;/a&gt;: Disable OSReadOnlyTest when run as privileged user&lt;/p&gt;

&lt;p&gt;Merged revision 1599544 from trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12474359">DERBY-4804</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12648144" name="disable-for-root.diff" size="5816" author="knutanders" created="Tue, 3 Jun 2014 14:15:54 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 27 May 2014 08:11:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245895</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0bcf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35656</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10053"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>