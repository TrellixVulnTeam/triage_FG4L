<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:51:30 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1274/DERBY-1274.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1274] Network Server does not shutdown the databases it has booted when started and shutdown from the command line</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1274</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If network server is started  and shutdown from the comand line t does not shutdown the database.   This can is evidenced by the fact that the db.lck file remains after  the following steps.&lt;/p&gt;


&lt;p&gt;java org.apache.derby.drda.NetworkServerControl start &amp;amp;&lt;/p&gt;

&lt;p&gt;&amp;lt;some database access&amp;gt;&lt;/p&gt;

&lt;p&gt;java org.apache.derby.drda.NetworkServerControl shutdown&lt;br/&gt;
 There is much discussion about the correct behavior of NetworkServer in this regard related to embedded server scenarios in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-51&quot; title=&quot;Need NetworkServerControl shutdown API method that does not shutdown derby embedded&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-51&quot;&gt;DERBY-51&lt;/a&gt;, but it seems clear in this  case the databases should be shutdown.&lt;/p&gt;




</description>
                <environment></environment>
        <key id="12332984">DERBY-1274</key>
            <summary>Network Server does not shutdown the databases it has booted when started and shutdown from the command line</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fernanda">Fernanda Pizzorno</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 May 2006 11:57:18 +0100</created>
                <updated>Mon, 14 May 2007 17:35:23 +0100</updated>
                            <resolved>Fri, 14 Jul 2006 11:14:04 +0100</resolved>
                                    <version>10.1.3.1</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12419688" author="fernanda" created="Fri, 7 Jul 2006 19:04:38 +0100"  >&lt;p&gt;The attached patch (derby-1472.diff) changes the Network Server so that it will shutdown the databases it has booted when started and shutdown from the command line.&lt;/p&gt;

&lt;p&gt;I have successfully run derbyall with this patch. Can someone please review it?&lt;/p&gt;</comment>
                            <comment id="12419694" author="knutanders" created="Fri, 7 Jul 2006 19:33:48 +0100"  >&lt;p&gt;Hi Fernanda,&lt;/p&gt;

&lt;p&gt;If I understand your patch correctly, using NetworkServerControl from&lt;br/&gt;
version 10.2 to stop a 10.1 network server will cause a protocol&lt;br/&gt;
error. Is that true?&lt;/p&gt;

&lt;p&gt;Do we really need to distinguish between whether the stop was&lt;br/&gt;
requested from command line or not? I think we only need to know&lt;br/&gt;
whether the network server was started from command line. If it was&lt;br/&gt;
started from command line, it should always shut down the databases&lt;br/&gt;
before exiting.&lt;/p&gt;

&lt;p&gt;If we don&apos;t care how the server was stopped, only how it was started,&lt;br/&gt;
then we don&apos;t need to change the protocol.&lt;/p&gt;</comment>
                            <comment id="12419717" author="fernanda" created="Fri, 7 Jul 2006 21:54:42 +0100"  >&lt;p&gt;Hi Knut Anders,&lt;/p&gt;

&lt;p&gt;It is true that using different versions of the NetworkServerControl to start and stop the server will cause a protocol error. This happens because the patch changes the command protocol, and the different versions of the NetworkServerControl would have different versions of the protocol. As soon as the databases should only be shut down if the server has been started and stopped from the command line, we need to change the command protocol, but, as you said, if we don&apos;t care how the server was stopped, only how it was started, then we don&apos;t need to change the protocol.&lt;/p&gt;</comment>
                            <comment id="12420086" author="fernanda" created="Mon, 10 Jul 2006 22:08:14 +0100"  >&lt;p&gt;The attached patch (derby-1274v2.diff) changes the Network Server so that it will shutdown the databases it has booted when started from the command line. It patch does not distinguish between whether the stop was requested from command line or not.&lt;/p&gt;

&lt;p&gt;I have successfully run derbyall with this patch. Can someone please review it?&lt;/p&gt;</comment>
                            <comment id="12420220" author="bryanpendleton" created="Tue, 11 Jul 2006 13:36:22 +0100"  >&lt;p&gt;I like the v2 patch; I think it is simple and clean, and a definite improvement to&lt;br/&gt;
the existing code. Thanks!&lt;/p&gt;

&lt;p&gt;It seems like it would be nice to have some tests to go with the patch; do you see&lt;br/&gt;
any simple way to augment some of our existing tests so that:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;we have a test that shows that if you start and stop the NS programmatically,&lt;br/&gt;
   it does not shut down the database&lt;/li&gt;
	&lt;li&gt;we have a test that shows that if you start the NS from the command line,&lt;br/&gt;
   then stop it, it does shut down the database&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think it would be sufficient to test for the presence/absence of the db.lck&lt;br/&gt;
file as proof of whether or not we shut down the database.&lt;/p&gt;</comment>
                            <comment id="12420818" author="fernanda" created="Thu, 13 Jul 2006 16:41:03 +0100"  >&lt;p&gt;The attached patch (derby-1274v3.diff) is v2 + a test (as suggested by Bryan Pendleton).&lt;/p&gt;

&lt;p&gt;The network server will be started from the command line before the test starts, the test will create a database, create a table, insert some data and then shut down the server and check that the file db.lck does not exist. Then it will start the server from the api, create the database ... etc, shut down the server and check that the file db.lck exists.&lt;/p&gt;

&lt;p&gt;I think the test would look better if the server had been started from the command line inside the test. Does anyone have a suggestion on how to do that?&lt;/p&gt;

&lt;p&gt;I have successfully run derbyall with this patch. Can someone please review it?&lt;/p&gt;</comment>
                            <comment id="12420844" author="johnemb" created="Thu, 13 Jul 2006 19:15:15 +0100"  >&lt;p&gt;I have taken a look at the patch derby-1274v3.diff, and I think it looks good. &lt;/p&gt;

&lt;p&gt;I found two minor typos in ShutDownDBWhenNSShutsDownTest.java:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;class level JavaDoc: &quot;when started form the command line&quot; should be &quot;when started from the command line&quot;.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;first comment inside testDatabasesShutDownWhenNSShutdown() method:&lt;br/&gt;
     &quot;Check that the database will be shut down when the server is start shut down.&quot; I think the word &quot;start&quot; should be removed here.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I do not know of a very clean and easy way of starting the Network Server from the command line from inside the test itself, without potentially losing some important property or setting that the harness usually sets. The harness.NetServer.java class might be helpful. Does anyone else have any ideas?&lt;br/&gt;
In the mean time, I think the way it is done in v3.diff is good enough.&lt;/p&gt;

</comment>
                            <comment id="12420849" author="fernanda" created="Thu, 13 Jul 2006 19:36:09 +0100"  >&lt;p&gt;The attached patch (derby-1274v4.diff) is the same as v3 - typos (see John&apos;s comment).&lt;/p&gt;</comment>
                            <comment id="12420862" author="knutanders" created="Thu, 13 Jul 2006 20:29:08 +0100"  >&lt;p&gt;I think the patch looks good. If you really want to start a network server from the command line inside the test, you could have a look at derbynet/testconnection.java. However, I don&apos;t think that would improve the test very much.&lt;/p&gt;

&lt;p&gt;One minor comment: The code that you uncommented says &quot;Cloudscape&quot; many times. Maybe it should be changed to Derby?&lt;/p&gt;</comment>
                            <comment id="12420881" author="fernanda" created="Thu, 13 Jul 2006 23:07:14 +0100"  >&lt;p&gt;I saw that the code I uncommented said &quot;Cloudscape&quot; and I thought of replacing it by &quot;Derby&quot;, but then I saw that &quot;Cloudscape&quot; was much more used in that file (NetworkServerControlImpl.java) so I did not change it. In my opinion it would be better replace all occurrences of &quot;Cloudscape&quot; by &quot;Derby&quot; than changing only the part of the code that I have uncommented, but I don&apos;t think it should be done as a part of this issue. If nobody objects, I will create a jira issue for replacing all occurrences of &quot;Cloudscape&quot; by &quot;Derby&quot; in NetworkServerControlImpl.java.&lt;/p&gt;</comment>
                            <comment id="12420888" author="djd" created="Thu, 13 Jul 2006 23:59:13 +0100"  >&lt;p&gt;In many cases &apos;Cloudscape&quot; should be replaced by Derby, but not in &lt;b&gt;all&lt;/b&gt; cases. Thus automated blanket changes are not appropriate, each change needs to be looked at individually. Examples are when the code is referring to Cloudscape releases prior to it being open sourced as Derby.&lt;/p&gt;</comment>
                            <comment id="12421066" author="knutanders" created="Fri, 14 Jul 2006 11:14:04 +0100"  >&lt;p&gt;Thanks Fernanda! I have committed the v4 patch into trunk with revision 421856.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12336502" name="derby-1274.diff" size="3373" author="fernanda" created="Fri, 7 Jul 2006 19:04:38 +0100"/>
                            <attachment id="12336503" name="derby-1274.stat" size="140" author="fernanda" created="Fri, 7 Jul 2006 19:04:38 +0100"/>
                            <attachment id="12336591" name="derby-1274v2.diff" size="2225" author="fernanda" created="Mon, 10 Jul 2006 22:08:14 +0100"/>
                            <attachment id="12336789" name="derby-1274v3.diff" size="10236" author="fernanda" created="Thu, 13 Jul 2006 16:41:03 +0100"/>
                            <attachment id="12336790" name="derby-1274v3.stat" size="532" author="fernanda" created="Thu, 13 Jul 2006 16:41:03 +0100"/>
                            <attachment id="12336804" name="derby-1274v4.diff" size="10231" author="fernanda" created="Thu, 13 Jul 2006 19:36:09 +0100"/>
                            <attachment id="12336805" name="derby-1274v4.stat" size="532" author="fernanda" created="Thu, 13 Jul 2006 19:36:09 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 7 Jul 2006 18:04:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22410</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy12dr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40036</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>