<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:27:37 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-244/DERBY-244.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-244] with linux, depending on env setting $LANG and console encoding, some i18n tests fail</title>
                <link>https://issues.apache.org/jira/browse/DERBY-244</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The tests&lt;br/&gt;
   i18n/messageLocale.sql&lt;br/&gt;
   i18n/urlLocale.sql&lt;br/&gt;
   i18n/iepnegativetests_ES.sql&lt;/p&gt;

&lt;p&gt;will fail on Linux if $LANG and as a result, console.encoding is not set in the same way as when the test master was created. The behavior is that some characters are not seen as outside the ANSI range and are displayed as a ?.&lt;br/&gt;
Result is as master when $LANG is en_US.UTF-8&lt;/p&gt;

&lt;p&gt;But then ieptest.sql will fail which will with ibm142 which pass if $LANG is en_US.&lt;/p&gt;

&lt;p&gt;This needs some further analysis, so this description may need to be updated later.&lt;br/&gt;
Whatever the solution is, will need to work for all situations.&lt;/p&gt;</description>
                <environment>Linux, with console.encoding *not* UTF-8</environment>
        <key id="32102">DERBY-244</key>
            <summary>with linux, depending on env setting $LANG and console encoding, some i18n tests fail</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Apr 2005 04:48:23 +0100</created>
                <updated>Mon, 3 Jun 2013 17:42:37 +0100</updated>
                            <resolved>Fri, 18 Aug 2006 18:32:06 +0100</resolved>
                                    <version>10.1.1.0</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12421439" author="knutanders" created="Sun, 16 Jul 2006 11:47:54 +0100"  >&lt;p&gt;I am stealing this bug from Myrna. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12421555" author="knutanders" created="Mon, 17 Jul 2006 09:26:55 +0100"  >&lt;p&gt;Attaching a patch which makes&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the i18n tests run with -Dfile.encoding=UTF-8&lt;/li&gt;
	&lt;li&gt;the streams in ProcessStreamResult use UTF-8 encoding for the i18n tests&lt;/li&gt;
	&lt;li&gt;Sed.java read result files from i18n tests using UTF-8 encoding&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Derbyall runs cleanly with the patch (en_US locale). The i18nTest suite runs cleanly with non-UTF locales. The patch is ready for review. Thanks!&lt;/p&gt;</comment>
                            <comment id="12421759" author="knutanders" created="Tue, 18 Jul 2006 02:31:39 +0100"  >&lt;p&gt;I&apos;m removing the &quot;patch available&quot; flag since the patch does not seem to work with IBM&apos;s JVM. I think the console.encoding has to be set as well. &lt;/p&gt;</comment>
                            <comment id="12421882" author="myrna" created="Tue, 18 Jul 2006 15:48:01 +0100"  >&lt;p&gt;Thx Knut, for testing with IBM jvm...&lt;/p&gt;

&lt;p&gt;I have some tidbits of half-researched information that may/may not be related, this is just a memory dump:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I noticed that when you&apos;re on Unix and $LANG is set to en_US.UTF-8, there is a difference in what file.encoding gets set to. With sun&apos;s jvm file encoding remains ISO-8559-1, but IBM&apos;s jvms pick up UTF-8. (I run a trusty little java program that just prints out all system properties).&lt;/li&gt;
	&lt;li&gt;As a result, I&apos;ve been running our tests with ibm jvms with $LANG set to en_US. (which is problematic on zOS, where $LANG appears to indicate a programming language, and en_US is just not valid for $LANG.)&lt;/li&gt;
	&lt;li&gt;I think there actually may be an odd kind of bug in ij when the file.encoding is UTF-8. I want to research that further.&lt;/li&gt;
	&lt;li&gt;Note also that RunTest does try to do something with the console encoding in certain cases.&lt;/li&gt;
	&lt;li&gt;I have been thinking that maybe if we can figure out why setting the encoding only really works with sun jvm 1.5, we could maybe use derbyTesting.encoding for these tests. Andrew had logged a bug 1027, but the actual problem may not be with the test harness, see Deepa&apos;s (Feb 7 2006)  comments in re &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-683&quot; title=&quot;Use correct encoding for ClobOutputStream on client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-683&quot;&gt;&lt;del&gt;DERBY-683&lt;/del&gt;&lt;/a&gt;.&lt;/li&gt;
	&lt;li&gt;part of all this is also to include the i18n/LocalizedDisplay.sql and LocalizedConnectionAttributes.sql tests into a suite at some point.&lt;/li&gt;
	&lt;li&gt;I tried to make the test harness hide some of the problems by wrapping the non-ascii characters in &amp;gt;Enc ### &amp;lt; lines. But I think that never worked properly.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12423789" author="knutanders" created="Thu, 27 Jul 2006 08:42:13 +0100"  >&lt;p&gt;Thanks for your comments, Myrna. The issue was that the test harness sets console.encoding to Cp1252. I think Sun&apos;s jvm ignores this property, but IBM&apos;s jvm used it instead of file.encoding. Since I had changed ProcessStreamResult to expect UTF-8 input when the tests were run with file.encoding=UTF-8, it crashed (silently) with a MalformedInputException.&lt;/p&gt;</comment>
                            <comment id="12423793" author="knutanders" created="Thu, 27 Jul 2006 08:58:15 +0100"  >&lt;p&gt;Attaching new patch (244-2.diff). The only change from the previous patch is that it uses -Dconsole.encoding=UTF-8 instead of -Dconsole.encoding=Cp1252 for the i18n tests.&lt;/p&gt;

&lt;p&gt;Derbyall runs cleanly with the patch on Sun JVM 1.5.0. There were a couple of failures on IBM JVM 1.5.0 (ran with LC_ALL and LANG set to ja_JP.eucjp), but they were already logged in JIRA. I have also run the i18nTest suite successfully on IBM JVM 1.4.2.&lt;/p&gt;

&lt;p&gt;Reviews would be welcome! Thanks.&lt;/p&gt;</comment>
                            <comment id="12424086" author="myrna" created="Fri, 28 Jul 2006 14:17:34 +0100"  >&lt;p&gt;I think the patch is an improvement. I did not run derbyall, but I ran i18nTest on Linux &amp;amp; Windows with ibm and sun jvms, and now get the same behavior with iepnegatieve_ES, urlLocale and messageLocale.sql tests.&lt;/p&gt;

&lt;p&gt;The one remark I have is that I still cannot get the LocalizedDisplay.sql and LocalizedConnectionAttribute.sql test from the i18n directory to behave the same under windows and Linux (with sun jdk 1.4.2.).&lt;br/&gt;
For windows, I had to update the masters for these tests, but running them on Linux still failed for me.&lt;br/&gt;
With jdk131, ibm131 and ibm142 the LocalizedDisplay.sql test hung, and LocalizedConnectionAttribute exits with a MalformedInputException.&lt;br/&gt;
It would be nice if we could figure out a way to add these tests to the suites...&lt;/p&gt;

&lt;p&gt;&amp;#8212; stack of LocalizedConnectionAttribute on Linux &amp;#8212;&lt;br/&gt;
Exception in thread &quot;main&quot; sun.io.MalformedInputException&lt;br/&gt;
        at sun.io.ByteToCharUTF8.convert(ByteToCharUTF8.java(Compiled Code))&lt;br/&gt;
        at sun.nio.cs.StreamDecoder$ConverterSD.convertInto(StreamDecoder.java:287)&lt;br/&gt;
        at sun.nio.cs.StreamDecoder$ConverterSD.implRead(StreamDecoder.java:337)&lt;br/&gt;
        at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:223)&lt;br/&gt;
        at java.io.InputStreamReader.read(InputStreamReader.java:208)&lt;br/&gt;
        at java.io.BufferedReader.fill(BufferedReader.java:153)&lt;br/&gt;
        at java.io.BufferedReader.readLine(BufferedReader.java:316)&lt;br/&gt;
        at java.io.BufferedReader.readLine(BufferedReader.java:379)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.harness.RunTest.setDirectories(RunTest.java:729)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.harness.RunTest.main(RunTest.java:262)&lt;br/&gt;
----------------------------------------------------------------------------&lt;/p&gt;</comment>
                            <comment id="12424237" author="rhillegas" created="Sat, 29 Jul 2006 01:02:39 +0100"  >&lt;p&gt;Hi Myrna,&lt;/p&gt;

&lt;p&gt;Are you recommending that we commit this patch but that additional work be put into analyzing LocalizedDisplay.sql and LocalizedConnectionAttribute.sql?&lt;/p&gt;</comment>
                            <comment id="12424266" author="myrna" created="Sat, 29 Jul 2006 04:01:05 +0100"  >&lt;p&gt;yes, that&apos;s exactly what I am proposing; unless someone has other ideas...&lt;/p&gt;</comment>
                            <comment id="12424854" author="rhillegas" created="Tue, 1 Aug 2006 14:11:15 +0100"  >&lt;p&gt;I&apos;m afraid I see diffs in these tests when run against jar files on Linux and jdk1.4:&lt;/p&gt;

&lt;p&gt;urlLocale&lt;br/&gt;
messageLocale&lt;br/&gt;
iepnegativetests_ES&lt;/p&gt;</comment>
                            <comment id="12425768" author="rhillegas" created="Fri, 4 Aug 2006 16:09:49 +0100"  >&lt;p&gt;Hi Myrna,&lt;/p&gt;

&lt;p&gt;On my linux machine $LANG is &quot;en_US.ISO-8859-1&quot; and I see the following diffs in the urlLocale test after applying this patch:&lt;/p&gt;

&lt;p&gt;21 del&lt;br/&gt;
&amp;lt; ERROR 08006: Arr EnC:&amp;gt;234&amp;lt; t de la base de donn EnC:&amp;gt;233&amp;lt; es &apos;swissdb&apos;.&lt;br/&gt;
21a21&lt;br/&gt;
&amp;gt; ERROR 08006: Arr EnC:&amp;gt;65533&amp;lt; t de la base de donn EnC:&amp;gt;65533&amp;lt; es &apos;swissdb&apos;.&lt;br/&gt;
28 del&lt;br/&gt;
&amp;lt; ERROR 08006: Arr EnC:&amp;gt;234&amp;lt; t de la base de donn EnC:&amp;gt;233&amp;lt; es &apos;swissdb&apos;.&lt;br/&gt;
28a28&lt;br/&gt;
&amp;gt; ERROR 08006: Arr EnC:&amp;gt;65533&amp;lt; t de la base de donn EnC:&amp;gt;65533&amp;lt; es &apos;swissdb&apos;.&lt;br/&gt;
Test Failed.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;End:   urlLocale jdk1.4.2_08 2006-08-04 08:09:58 ***&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12427946" author="knutanders" created="Mon, 14 Aug 2006 19:42:58 +0100"  >&lt;p&gt;Thanks for the reviews, Myrna and Rick!&lt;/p&gt;

&lt;p&gt;I also see that the tests fail with Sun JVM 1.4.2 under Linux when&lt;br/&gt;
LANG=en_US.ISO-8859-1. I don&apos;t know why, but it seems to work when&lt;br/&gt;
derby.ui.codeset is UTF-8.&lt;/p&gt;

&lt;p&gt;I am uploading a new patch (244-3.diff) which has these extra changes&lt;br/&gt;
in RunTest.java:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;adds a new variable, codeset, which holds the value of&lt;br/&gt;
    derby.ui.codeset if it is specified by the test in&lt;br/&gt;
    XXX_app.properties&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;sets derby.ui.codeset to UTF-8 in i18n tests for which no codeset&lt;br/&gt;
    has been specified&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;uses the encoding specified by derby.ui.codeset to read the output&lt;br/&gt;
    from the test (but it is still written as UTF-8 to the tmp file)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This seems to fix all the tests in the i18nTest suite for all (LANG,&lt;br/&gt;
VENDOR, VERSION) in (en_US.ISO-8859-1, en_US.UTF-8) x (Sun, IBM) x&lt;br/&gt;
(1.4.2, 1.5.0) under Linux.&lt;/p&gt;

&lt;p&gt;It is also possible that this patch makes LocalizedDisplay.sql have&lt;br/&gt;
the same behaviour on Windows and Linux, but I don&apos;t have any machine&lt;br/&gt;
running Windows to test it on. (I never saw the hang, by the way.)&lt;/p&gt;

&lt;p&gt;LocalizedConnectionAttribute.sql fails because RunTest expects all sql&lt;br/&gt;
files to be UTF-8 encoded, while LocalizedConnectionAttribute.sql is&lt;br/&gt;
Cp850 encoded. I think this can be solved by using&lt;br/&gt;
InputStream/OutputStream instead of Reader/Writer to copy the sql file&lt;br/&gt;
from derbyTesting.jar to the test directory, but I won&apos;t add that to&lt;br/&gt;
this patch as it is messy enough as it is.&lt;/p&gt;</comment>
                            <comment id="12429067" author="knutanders" created="Fri, 18 Aug 2006 18:32:06 +0100"  >&lt;p&gt;Committed revision 432645. The problems with LocalizedDisplay and LocalizedConnectionAttribute have been logged as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1726&quot; title=&quot;Make i18n/LocalizedDisplay.sql and i18n/LocalizedConnectionAttribute.sql behave equally on different platforms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1726&quot;&gt;&lt;del&gt;DERBY-1726&lt;/del&gt;&lt;/a&gt;, so I&apos;m marking this issue as resolved.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="32970">DERBY-323</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12337617" name="244-2.diff" size="6682" author="knutanders" created="Thu, 27 Jul 2006 08:58:15 +0100"/>
                            <attachment id="12337618" name="244-2.stat" size="245" author="knutanders" created="Thu, 27 Jul 2006 08:58:15 +0100"/>
                            <attachment id="12338828" name="244-3.diff" size="8092" author="knutanders" created="Mon, 14 Aug 2006 19:42:58 +0100"/>
                            <attachment id="12336997" name="244.diff" size="5894" author="knutanders" created="Mon, 17 Jul 2006 09:26:55 +0100"/>
                            <attachment id="12336998" name="244.stat" size="245" author="knutanders" created="Mon, 17 Jul 2006 09:26:55 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 16 Jul 2006 10:47:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21857</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxu9bj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>326</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>