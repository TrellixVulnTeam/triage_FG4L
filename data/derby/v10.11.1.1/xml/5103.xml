<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:35:14 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5103/DERBY-5103.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5103] ProcedureInTriggerTest depends on implicit ordering of test cases</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5103</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If for example the test case testTriggerContainsSql is executed as the first test case, it will fail with the following error:&lt;/p&gt;

&lt;p&gt;1) testTriggerContainsSql(org.apache.derbyTesting.functionTests.tests.lang.ProcedureInTriggerTest)junit.framework.AssertionFailedError: expected:&amp;lt;2&amp;gt; but was:&amp;lt;0&amp;gt;&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.ProcedureInTriggerTest.checkAndResetGetConnectionProcCount(ProcedureInTriggerTest.java:514)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.ProcedureInTriggerTest.testTriggerContainsSql(ProcedureInTriggerTest.java:120)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;/p&gt;

&lt;p&gt;The test should either make the order of the test cases explicit or make the test cases independent of the order in which they run.&lt;/p&gt;

&lt;p&gt;Seen in the nightly tests, for example here: &lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/testlog/lin/1076682-suitesAll_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/testlog/lin/1076682-suitesAll_diff.txt&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12500758">DERBY-5103</key>
            <summary>ProcedureInTriggerTest depends on implicit ordering of test cases</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Mar 2011 12:58:39 +0000</created>
                <updated>Thu, 30 Jun 2011 10:21:43 +0100</updated>
                            <resolved>Wed, 9 Mar 2011 14:07:11 +0000</resolved>
                                    <version>10.8.1.2</version>
                                    <fixVersion>10.8.1.2</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13004047" author="rhillegas" created="Tue, 8 Mar 2011 16:41:35 +0000"  >&lt;p&gt;I ran this test on linux on Java 7 build 132. I could not reproduce the unusual ordering of test cases which is turning up in the Java 7 test runs on Solaris. I ran the test 10 times without errors. I also tried running some other tests which show instability on Solaris on Java 7. Again, I am not able to reproduce these instabilities on linux on Java 7 build 132.&lt;/p&gt;</comment>
                            <comment id="13004081" author="lilywei" created="Tue, 8 Mar 2011 17:35:44 +0000"  >&lt;p&gt;I ran this test on Windows 7 on Java 7 build 132. I saw this same stack trace on my machine:&lt;br/&gt;
4) testTriggerContainsSql(org.apache.derbyTesting.functionTests.tests.lang.Proce&lt;br/&gt;
dureInTriggerTest)junit.framework.AssertionFailedError: expected:&amp;lt;2&amp;gt; but was:&amp;lt;4&amp;gt;&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.lang.ProcedureInTriggerTe&lt;br/&gt;
st.checkAndResetGetConnectionProcCount(ProcedureInTriggerTest.java:514)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.lang.ProcedureInTriggerTe&lt;br/&gt;
st.testTriggerContainsSql(ProcedureInTriggerTest.java:120)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.&lt;br/&gt;
java:57)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces&lt;br/&gt;
sorImpl.java:43)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:&lt;br/&gt;
112)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57&lt;br/&gt;
)&lt;br/&gt;
I am attaching my output rjall.out here.&lt;/p&gt;</comment>
                            <comment id="13004542" author="knutanders" created="Wed, 9 Mar 2011 13:41:58 +0000"  >&lt;p&gt;Thanks, Lily and Rick, for running the tests.&lt;/p&gt;

&lt;p&gt;I think there are multiple issues with this test that causes problems when the test cases are reordered:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;some tests leave rows in tables that are shared between the test cases&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;some tests don&apos;t drop the triggers they create&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;static counters are not reset between the test cases&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13004545" author="knutanders" created="Wed, 9 Mar 2011 13:57:39 +0000"  >&lt;p&gt;Attaching a patch that attempts to loosen up the dependency on a particular ordering. The patch does the following:&lt;/p&gt;

&lt;p&gt;1) Adds a tearDown() method that truncates the test tables between each run and resets the static counters.&lt;/p&gt;

&lt;p&gt;2) Move an insert statement from testTriggerNoSql to testTriggerContainsSql. testTriggerNoSql doesn&apos;t use that row (inserting it is the last thing it does), so it&apos;s better that it&apos;s inserted in the test case that actually needs it.&lt;/p&gt;

&lt;p&gt;3) Added an insert statement in testTriggerNegative to compensate for the rows that are removed by tearDown(). It used to depend on these rows getting inserted by testModifiesSql, but now it should work even if testModifiesSql hasn&apos;t been run yet.&lt;/p&gt;

&lt;p&gt;4) Drop the triggers created in testTriggerNegative.&lt;/p&gt;

&lt;p&gt;With these changes, the test runs cleanly in an environment where the test failed almost consistently before.&lt;/p&gt;</comment>
                            <comment id="13004550" author="knutanders" created="Wed, 9 Mar 2011 14:07:11 +0000"  >&lt;p&gt;Committed revision 1079805.&lt;/p&gt;</comment>
                            <comment id="13006176" author="knutanders" created="Sun, 13 Mar 2011 11:43:36 +0000"  >&lt;p&gt;There&apos;s still an intermittent failure in this test seen in the nightly runs: &lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/testlog/sol/1080669-suitesAll_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/testlog/sol/1080669-suitesAll_diff.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;When testTriggerNegative runs early, it may alter the ordering of rows returned in some other test cases because it creates an index on T1.&lt;/p&gt;

&lt;p&gt;The attached patch makes testTriggerNegative drop the index in the cleanup section.&lt;/p&gt;

&lt;p&gt;Committed revision 1081081.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12473127" name="derby-5103-1a.diff" size="2974" author="knutanders" created="Wed, 9 Mar 2011 13:57:39 +0000"/>
                            <attachment id="12473501" name="derby-5103-2a.diff" size="923" author="knutanders" created="Sun, 13 Mar 2011 11:43:36 +0000"/>
                            <attachment id="12473013" name="rjall.out" size="712665" author="lilywei" created="Tue, 8 Mar 2011 17:35:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 8 Mar 2011 16:41:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24649</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0fuf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36385</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>