<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:41:57 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3735/DERBY-3735.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3735] Incorrect position calculation in PositionedStoreStream with read(byte[],...)</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3735</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;A bug in the methods &apos;read(byte[])&apos; and &apos;read(byte[],int,int)&apos; in PositionedStoreStream can cause the position variable to be set to an incorrect value.&lt;br/&gt;
The bug is only triggered if one of the two read methods is invoked after EOF of the underlying stream has been reached.&lt;/p&gt;

&lt;p&gt;If the bug is triggered, the position will be decreased by one because the underlying stream returns -1. Subsequent reads will further decrease the position. This can cause EOF-exceptions (during repositioning) or incorrect data being returned in subsequent calls.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12398905">DERBY-3735</key>
            <summary>Incorrect position calculation in PositionedStoreStream with read(byte[],...)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kristwaa">Kristian Waagan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Jun 2008 11:38:34 +0100</created>
                <updated>Mon, 4 May 2009 19:22:00 +0100</updated>
                            <resolved>Tue, 1 Jul 2008 13:14:35 +0100</resolved>
                                    <version>10.3.1.4</version>
                    <version>10.4.1.3</version>
                    <version>10.5.1.1</version>
                                    <fixVersion>10.4.2.0</fixVersion>
                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>JDBC</component>
                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12607634" author="kristwaa" created="Tue, 24 Jun 2008 15:50:08 +0100"  >&lt;p&gt;Attaching &apos;derby-3735-1a.diff&apos; that does the following:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;PositionedStoreStream&lt;br/&gt;
    Fixed the position calculation.&lt;br/&gt;
    Implemented read(byte[]) by forwarding to read(byte[],int,int).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;LoopingAlphabetStream&lt;br/&gt;
   Made it implement Resetable, so it can be used for testing PositionedStoreStream.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;PositionedStoreStreamTest&lt;br/&gt;
   Some simple tests and a regression test for the bug.&lt;br/&gt;
   Takes less than half a second to run (no database access).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;_Suite&lt;br/&gt;
    Added the new test to the store suite.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;I ran the regression tests without failures.&lt;br/&gt;
Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="12608023" author="knutanders" created="Wed, 25 Jun 2008 13:40:33 +0100"  >&lt;p&gt;The patch looks correct to me, and the change looks well tested. +1 to commit.&lt;/p&gt;

&lt;p&gt;A tiny nit: Now that read(byte[],int,int) has the same structure as read() which is located right below it, it would probably be better if they compared ret to the same number. Although it doesn&apos;t matter whether the condition is (ret &amp;gt; 0) or (ret &amp;gt; -1) in this case, the difference between the methods may be slightly confusing to those who read the code.&lt;/p&gt;</comment>
                            <comment id="12608372" author="kristwaa" created="Thu, 26 Jun 2008 11:04:15 +0100"  >&lt;p&gt;Thanks for the review Knut Anders.&lt;/p&gt;

&lt;p&gt;Committed &apos;derby-3735-1b.diff&apos; to trunk with revision 671840.&lt;br/&gt;
Will backport to 10.4 and maybe 10.3.&lt;/p&gt;

&lt;p&gt;Made a revision b of the patch due to a conflicting change in _Suite, and also addressed Knut Anders&apos; nit (both methods now use the same condition).&lt;/p&gt;</comment>
                            <comment id="12608739" author="kristwaa" created="Fri, 27 Jun 2008 12:52:58 +0100"  >&lt;p&gt;&apos;derby-3735-2a.diff&apos; fixes the bug introduced by the previous patch (1b)... &lt;/p&gt;

&lt;p&gt;0 (zero) is of course a valid return value for &quot;read()&quot;, and the position has to be incremented.&lt;br/&gt;
I changed the &quot;read(byte[],int,int)&quot; to check for -1 for consistency as well. This method will return 0 very seldom, in fact I think it requires a &quot;user error&quot; to happen; argument &apos;len&apos; must be zero.&lt;/p&gt;

&lt;p&gt;Regression tests run without failures.&lt;br/&gt;
Patch ready for review, but I will commit it shortly anyway to get rid of the tinderbox/nightly failures.&lt;/p&gt;
</comment>
                            <comment id="12608789" author="kristwaa" created="Fri, 27 Jun 2008 15:38:23 +0100"  >&lt;p&gt;Committed &apos;derby-3735-2a.diff&apos; to trunk with revision 672284.&lt;/p&gt;</comment>
                            <comment id="12609500" author="kristwaa" created="Tue, 1 Jul 2008 10:11:33 +0100"  >&lt;p&gt;Backported fix (patches 1b and 2a) to the 10.4 branch with revision 673030.&lt;br/&gt;
Running tests on 10.3.&lt;/p&gt;</comment>
                            <comment id="12609540" author="kristwaa" created="Tue, 1 Jul 2008 13:14:35 +0100"  >&lt;p&gt;Backported fix to the 10.3 branch with revision 673064.&lt;br/&gt;
Tests ran without failures.&lt;/p&gt;

&lt;p&gt;This concludes the work on this issue.&lt;/p&gt;</comment>
                            <comment id="12612414" author="kristwaa" created="Thu, 10 Jul 2008 10:29:56 +0100"  >&lt;p&gt;Closing.&lt;br/&gt;
No problems reported.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12384587" name="derby-3735-1a.diff" size="11782" author="kristwaa" created="Tue, 24 Jun 2008 15:50:08 +0100"/>
                            <attachment id="12384588" name="derby-3735-1a.stat" size="354" author="kristwaa" created="Tue, 24 Jun 2008 15:50:08 +0100"/>
                            <attachment id="12384753" name="derby-3735-1b.diff" size="12045" author="kristwaa" created="Thu, 26 Jun 2008 11:04:15 +0100"/>
                            <attachment id="12384826" name="derby-3735-2a.diff" size="800" author="kristwaa" created="Fri, 27 Jun 2008 12:52:58 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 25 Jun 2008 12:40:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23815</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0y1b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39332</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>