<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:26:43 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5839/DERBY-5839.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5839] dblook run on toursdb fails on triggers with java.lang.StringIndexOutOfBoundsException in dblook.log</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5839</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>
&lt;p&gt;Running dblook on toursdb (either in packaged demo/databases/toursdb in the bin distribution or generated/toursdb after a build) fails to generate ddl for triggers and gives a java.lang.StringIndexOutOfBoundsException in the dblook.log.&lt;/p&gt;

&lt;p&gt;To reproduce:&lt;/p&gt;


&lt;p&gt;java org.apache.derby.tools.dblook -d &apos;jdbc:derby:toursdb&apos;&lt;/p&gt;


&lt;p&gt;output shows:&lt;/p&gt;

&lt;p&gt;&amp;#8211; ----------------------------------------------&lt;br/&gt;
&amp;#8211; Note: At least one unexpected error/warning message was&lt;br/&gt;
&amp;#8211; DDL Statements for triggersration.  See dblook.log&lt;br/&gt;
&amp;#8211; ----------------------------------------------&lt;/p&gt;

&lt;p&gt;dblook.log contains:&lt;/p&gt;

&lt;p&gt;java.lang.StringIndexOutOfBoundsException&lt;br/&gt;
        at java.lang.String.substring(String.java:1131)&lt;br/&gt;
        at org.apache.derby.tools.dblook.getColumnListFromDescription(dblook.java:664)&lt;br/&gt;
        at org.apache.derby.impl.tools.dblook.DB_Trigger.createTrigger(DB_Trigger.java:130)&lt;br/&gt;
        at org.apache.derby.impl.tools.dblook.DB_Trigger.doTriggers(DB_Trigger.java:82)&lt;br/&gt;
        at org.apache.derby.tools.dblook.go(dblook.java:547)&lt;br/&gt;
        at org.apache.derby.tools.dblook.&amp;lt;init&amp;gt;(dblook.java:142)&lt;br/&gt;
        at org.apache.derby.tools.dblook.main(dblook.java:97)&lt;/p&gt;


&lt;p&gt;This seems to be a regression in 10.9. 10.8 works fine for me&lt;/p&gt;</description>
                <environment>Not JVM/platform specific&lt;br/&gt;
reproduced on Windows&lt;br/&gt;
java version &amp;quot;1.7.0&amp;quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build pwi3270-20110906_01)&lt;br/&gt;
IBM J9 VM (build 2.6, JRE 1.7.0 Windows 7 x86-32 20110810_88604 (JIT enabled, AOT enabled)&lt;br/&gt;
J9VM - R26_Java726_GA_20110810_1208_B88592&lt;br/&gt;
JIT  - r11_20110810_20466&lt;br/&gt;
GC   - R26_Java726_GA_20110810_1208_B88592&lt;br/&gt;
J9CL - 20110810_88604)&lt;br/&gt;
JCL - 20110809_01 based on Oracle 7b147&lt;br/&gt;
&lt;br/&gt;
Also seen on Mac with JDK 1.6</environment>
        <key id="12596840">DERBY-5839</key>
            <summary>dblook run on toursdb fails on triggers with java.lang.StringIndexOutOfBoundsException in dblook.log</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mamtas">Mamta A. Satoor</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                            <label>derby_backport_reject_10_8</label>
                    </labels>
                <created>Mon, 2 Jul 2012 23:43:45 +0100</created>
                <updated>Wed, 3 Sep 2014 09:31:45 +0100</updated>
                            <resolved>Tue, 7 Aug 2012 20:41:52 +0100</resolved>
                                    <version>10.9.1.0</version>
                                    <fixVersion>10.9.2.2</fixVersion>
                    <fixVersion>10.10.1.1</fixVersion>
                                    <component>Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13425112" author="mamtas" created="Mon, 30 Jul 2012 19:38:29 +0100"  >&lt;p&gt;I have been working on this issue and problem appears to be that starting 10.9, we have extended SYSTRIGGERS.REFERENCEDCOLUMNS to hold more information that it used to in prior releases. Prior to 10.9, REFERENCEDCOLUMNS held informatoin about the columns(optional). on which the trigger is defined. Starting 10.9, in addition to the columns info on which trigger is defined, we also hold information about the columns being used inside the trigger action plan. REFERENCEDCOLUMNS is an internal structure which users should not rely but dblook uses the information to construct trigger statements. I will debug more to see why the additional information in REFERENCEDCOLUMNS causing an issue with dblook in 10.9&lt;/p&gt;</comment>
                            <comment id="13430551" author="mamtas" created="Tue, 7 Aug 2012 20:23:35 +0100"  >&lt;p&gt;Committed fix for this jira with following comment&lt;br/&gt;
********************************&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5839&quot; title=&quot;dblook run on toursdb fails on triggers with java.lang.StringIndexOutOfBoundsException in dblook.log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5839&quot;&gt;&lt;del&gt;DERBY-5839&lt;/del&gt;&lt;/a&gt; (dblook run on toursdb fails on triggers with java.lang.StringIndexOutOfBoundsException in dblook.log)&lt;/p&gt;

&lt;p&gt;We document that SYSTRIGGERS.REFERENCEDCOLUMNS is not part of the public API and hence that allows Derby to change underneath the behavior of the column. Prior to 10.9, this column only had information about columns referenced by UPDATE trigger. But, with 10.9, we use this column to also hold information about the trigger columns being used inside trigger action plan. This enables Derby to read only necessary columns from trigger table. But because of this change, it is not enough in dblook to check if SYSTRIGGERS.REFERENCEDCOLUMNS.wasNull. We need to also check if the string representation of that column is &quot;NULL&quot;. Making this change fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5839&quot; title=&quot;dblook run on toursdb fails on triggers with java.lang.StringIndexOutOfBoundsException in dblook.log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5839&quot;&gt;&lt;del&gt;DERBY-5839&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
********************************&lt;/p&gt;

&lt;p&gt;Please let me know if there is any feedback.&lt;/p&gt;</comment>
                            <comment id="13430562" author="mamtas" created="Tue, 7 Aug 2012 20:36:19 +0100"  >&lt;p&gt;Since this does not involve any engine changes and only test change, I have backported it to 10.9 too with revision 1370464.&lt;/p&gt;</comment>
                            <comment id="14119645" author="knutanders" created="Wed, 3 Sep 2014 09:31:45 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 30 Jul 2012 18:38:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245851</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10422"><![CDATA[High Value Fix]]></customfieldvalue>
    <customfieldvalue key="10423"><![CDATA[Newcomer]]></customfieldvalue>
    <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0aif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35521</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>