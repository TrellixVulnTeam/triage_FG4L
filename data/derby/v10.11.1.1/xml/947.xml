<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:49:05 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-947/DERBY-947.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-947] Miscellaneous PreparedStatement methods added by JDBC4</title>
                <link>https://issues.apache.org/jira/browse/DERBY-947</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;As described in the JDBC 4 spec sections 13.2 and 3.1.&lt;/p&gt;

&lt;p&gt;This involves building support for JDBC4 methods added to PreparedStatement and not addressed by other JIRAs: isPoolable() and setPoolable().&lt;/p&gt;</description>
                <environment></environment>
        <key id="12328835">DERBY-947</key>
            <summary>Miscellaneous PreparedStatement methods added by JDBC4</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="forsini">Francois Orsini</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Sat, 11 Feb 2006 06:44:03 +0000</created>
                <updated>Wed, 1 Jul 2009 01:34:47 +0100</updated>
                            <resolved>Fri, 10 Mar 2006 18:24:34 +0000</resolved>
                                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12369442" author="forsini" created="Wed, 8 Mar 2006 21:35:26 +0000"  >&lt;p&gt;Here are the changes to address JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-947&quot; title=&quot;Miscellaneous PreparedStatement methods added by JDBC4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-947&quot;&gt;&lt;del&gt;DERBY-947&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Uploaded &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-947&quot; title=&quot;Miscellaneous PreparedStatement methods added by JDBC4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-947&quot;&gt;&lt;del&gt;DERBY-947&lt;/del&gt;&lt;/a&gt;-v1.diff which implements PreparedStatement.isPoolable() and&lt;br/&gt;
PreparedStatement.isPoolable()  on embedded and client sides.&lt;/p&gt;

&lt;p&gt;Added some test cases to jdbc4/TestPreparedStatementMethods.java.&lt;/p&gt;

&lt;p&gt;There is a FIXME in some of the unit test logic as a reminder  to use Statement.isClosed() instead of a local hint when it is implemented as part of JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-953&quot; title=&quot;Add miscellaneous Statement methods introduced by JDBC 4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-953&quot;&gt;&lt;del&gt;DERBY-953&lt;/del&gt;&lt;/a&gt; - Also, the proper SQL State should be checked against to detect if the exception is due to a statement that has already been closed - right now, the proper SQLState for a statement already closed is only set in embedded - There is already a JIRA to fix SQLState on some of the client side classes.&lt;/p&gt;

&lt;p&gt;I have run the jdbc4 suite as well as derbyall on Windows XP / Sun JVM 1.6.0_b72 without errors.&lt;/p&gt;

&lt;p&gt;Let me know of your comments. Thanks.&lt;/p&gt;</comment>
                            <comment id="12369454" author="knutanders" created="Wed, 8 Mar 2006 22:30:39 +0000"  >&lt;p&gt;Hi Francois,&lt;/p&gt;

&lt;p&gt;Your code changes look very good, but I have one comment to the test&lt;br/&gt;
code:&lt;/p&gt;

&lt;p&gt;+            if (SQLState.ALREADY_CLOSED.equals(sqle.getSQLState()) ||&lt;br/&gt;
+                stmtIsClosed) {&lt;br/&gt;
+                // All is good and is expected&lt;/p&gt;

&lt;p&gt;SQLState.ALREADY_CLOSED is &quot;XJ012.S&quot;. However, it seems like&lt;br/&gt;
sqle.getSQLState() will return &quot;XJ012&quot;. (EmbedSQLException invokes&lt;br/&gt;
StandardException.getSQLStateFromIdentifier, which performs&lt;br/&gt;
substring(0, 5) on the SQL state identifier.)&lt;/p&gt;

&lt;p&gt;Would it make sense to replace SQLState.ALREADY_CLOSED with &quot;XJ012&quot;?&lt;br/&gt;
Alternatively, you could define a local constant&lt;/p&gt;

&lt;p&gt;    final String ALREADY_CLOSED =&lt;br/&gt;
        SQLState.ALREADY_CLOSED.substring(0, 5); // ugh!&lt;/p&gt;</comment>
                            <comment id="12369786" author="forsini" created="Fri, 10 Mar 2006 12:02:17 +0000"  >&lt;p&gt;Knut, thanks for the review.&lt;/p&gt;

&lt;p&gt;Good catch - I actually followed some logic which is there all accross the JDBC 4 tests, such as:&lt;/p&gt;

&lt;p&gt;        } catch(SQLException e) {&lt;br/&gt;
            if(SQLState.NOT_IMPLEMENTED.equals (e.getSQLState())) &lt;/p&gt;
{
                System.out.println(&quot;Unexpected SQLException&quot;+e);
            }
&lt;p&gt;        &lt;br/&gt;
        }&lt;/p&gt;

&lt;p&gt;which is exposing the same issue...Also I believe the equal expression above should be reversed - it is evaluated to false right now everytime in both client and engine modes...I will fill in a separate JIRA for this (it is independent of the scope of the changes for this JIRA).&lt;/p&gt;

&lt;p&gt;Interestingly enough, the SQL state on the client driver is not always being set - for instance, logic in&lt;br/&gt;
\trunk\java\client\org\apache\derby\client\am\Statement.java&lt;/p&gt;

&lt;p&gt;do not set the sql state upon throwing new sql exceptions - hence the following logic below,&lt;br/&gt;
...&lt;br/&gt;
throw new SqlException(agent_.logWriter_, &quot;Invalid maxFieldSize value: &quot; + max);&lt;br/&gt;
... &lt;/p&gt;

&lt;p&gt;will yield to &apos;null&apos; when retrieving the sql state of a raised exception via SQLException.getSQLState(), hence making it impossible to write a JDBC application which relies on sql state for the client/server mode - we don&apos;t have this problem with the embedded driver...This is already reported as part of JIRA-254 which is supposed to address this issue as well.&lt;/p&gt;

&lt;p&gt;I have changed the code to use a sql exception util method in ExceptionUtil class from the shared package to extract the 5 chars sql state out of the message identifier (like embedded does and client should do) - interestingly enough the logic to extract the state our of the msg id is duplicated in trunk\java\engine\org\apache\derby\iapi\error\StandardException.java but it is a different problem and not in the scope of this JIRA.&lt;/p&gt;</comment>
                            <comment id="12369787" author="forsini" created="Fri, 10 Mar 2006 12:05:22 +0000"  >&lt;p&gt;to follow-up on above comments - new changes have been posted as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-947&quot; title=&quot;Miscellaneous PreparedStatement methods added by JDBC4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-947&quot;&gt;&lt;del&gt;DERBY-947&lt;/del&gt;&lt;/a&gt;-v2.stat and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-947&quot; title=&quot;Miscellaneous PreparedStatement methods added by JDBC4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-947&quot;&gt;&lt;del&gt;DERBY-947&lt;/del&gt;&lt;/a&gt;-v2.diff.&lt;/p&gt;</comment>
                            <comment id="12369837" author="knutanders" created="Fri, 10 Mar 2006 18:24:34 +0000"  >&lt;p&gt;Patch looks good!&lt;/p&gt;

&lt;p&gt;I got one failure in derbyall. lang/closed.java produced a diff, but&lt;br/&gt;
it seemed totally unrelated to the patch. A line containing&lt;/p&gt;

&lt;p&gt;  ERROR 08006: Database &apos;wombat&apos; shutdown.&lt;/p&gt;

&lt;p&gt;was printed earlier than expected. Probably a timing issue. At least,&lt;br/&gt;
it wasn&apos;t there when I re-ran the test manually.&lt;/p&gt;

&lt;p&gt;The jdbc4 suite ran successfully (Sun JVM 1.6.0-beta2-b74).&lt;/p&gt;

&lt;p&gt;Committed revision 384753.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12323926" name="DERBY-947-v1.diff" size="11533" author="forsini" created="Wed, 8 Mar 2006 21:36:37 +0000"/>
                            <attachment id="12323925" name="DERBY-947-v1.stat" size="254" author="forsini" created="Wed, 8 Mar 2006 21:36:11 +0000"/>
                            <attachment id="12324008" name="DERBY-947-v2.diff" size="11816" author="forsini" created="Fri, 10 Mar 2006 12:03:51 +0000"/>
                            <attachment id="12324007" name="DERBY-947-v2.stat" size="254" author="forsini" created="Fri, 10 Mar 2006 12:03:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 8 Mar 2006 21:35:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29797</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0sk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38445</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>