<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:15:30 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1554/DERBY-1554.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1554] IDENTITY_VAL_LOCAL() returned value is modified incorrectly by a multi-row INSERT statement.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1554</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Changes made in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-353&quot; title=&quot;It is desirable to have IDENTITY_VAL_LOCAL() function return last recent user specified value or system generated value for BY DEFAULT identity columns.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-353&quot;&gt;&lt;del&gt;DERBY-353&lt;/del&gt;&lt;/a&gt; break the documented behaviour of IDENTITY_VAL_LOCAL(). Now the returned value is modified when a multi-row insert is performed.&lt;br/&gt;
IDENTITY_VAL_LOCAL() should not be updated when this occurs.&lt;/p&gt;

&lt;p&gt;For this script the last value returned should be 2 (as in 10.1) but in 10.2 is 4&lt;/p&gt;

&lt;p&gt;create table ta (a int, b int generated always as identity);&lt;br/&gt;
insert into ta(a) values 100;&lt;br/&gt;
values IDENTITY_VAL_LOCAL();&lt;br/&gt;
insert into ta(a) values 200;&lt;br/&gt;
values IDENTITY_VAL_LOCAL();&lt;br/&gt;
insert into ta(a) values 300,400;&lt;br/&gt;
values IDENTITY_VAL_LOCAL();&lt;/p&gt;</description>
                <environment></environment>
        <key id="12346367">DERBY-1554</key>
            <summary>IDENTITY_VAL_LOCAL() returned value is modified incorrectly by a multi-row INSERT statement.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yipng">Yip Ng</assignee>
                                    <reporter username="djd">Daniel John Debrunner</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Jul 2006 21:59:52 +0100</created>
                <updated>Tue, 30 Jun 2009 16:55:41 +0100</updated>
                            <resolved>Thu, 10 Aug 2006 14:44:17 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.1.3.2</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12422490" author="djd" created="Thu, 20 Jul 2006 22:00:30 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-353&quot; title=&quot;It is desirable to have IDENTITY_VAL_LOCAL() function return last recent user specified value or system generated value for BY DEFAULT identity columns.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-353&quot;&gt;&lt;del&gt;DERBY-353&lt;/del&gt;&lt;/a&gt; changes caused this regression&lt;/p&gt;</comment>
                            <comment id="12422492" author="djd" created="Thu, 20 Jul 2006 22:01:36 +0100"  >&lt;p&gt;The comment by Kathey in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-353&quot; title=&quot;It is desirable to have IDENTITY_VAL_LOCAL() function return last recent user specified value or system generated value for BY DEFAULT identity columns.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-353&quot;&gt;&lt;del&gt;DERBY-353&lt;/del&gt;&lt;/a&gt; alerted me to this regression, thanks Kathey for noticing the strange diff in the test output.&lt;/p&gt;</comment>
                            <comment id="12423853" author="rhillegas" created="Thu, 27 Jul 2006 16:01:05 +0100"  >&lt;p&gt;Assigning this bug to 10.2 and bumping its priority to Critical. This will make it visible to bug-fixers. Once the Urgency field appears, we can adjust the severity of this bug.&lt;/p&gt;</comment>
                            <comment id="12423917" author="rhillegas" created="Thu, 27 Jul 2006 21:52:40 +0100"  >&lt;p&gt;Bumping urgency.&lt;/p&gt;</comment>
                            <comment id="12425552" author="narayanan" created="Thu, 3 Aug 2006 17:05:53 +0100"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;If we could avoid calling the setIdentity() function in the GenericLanguageContext class when we have an multi-row insert the above bug would be fixed. I tried the same in the above patch with a single line fix and it seemed to work. &lt;/p&gt;

&lt;p&gt;I was going throught the earlier patch I submitted for 353 when I thought this small fix might resolve this issue. Pls do tell me if you see any problems with the above fix or if u see any case I might have missed.&lt;/p&gt;

&lt;p&gt;Attaching relevant diff and stat files. I tested this patch only using the test case with this issue. I also tested test cases for 353 and 439. &lt;/p&gt;

&lt;p&gt;PLEASE NOTE THAT I HAVE NOT RUN DERBYALL on this patch.&lt;/p&gt;

&lt;p&gt;thanx&lt;br/&gt;
Narayanan&lt;/p&gt;</comment>
                            <comment id="12425615" author="yipng" created="Thu, 3 Aug 2006 22:16:56 +0100"  >&lt;p&gt;Hi Narayanan&lt;/p&gt;

&lt;p&gt;   I looked at the attached patch.  It is returning the wrong result in the following case:&lt;br/&gt;
It should be null.&lt;/p&gt;

&lt;p&gt;ij&amp;gt; create table t1 (i int generated by default as identity, j int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; create table t2 (i int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t1 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; select i from t2;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; values identity_val_local();&lt;br/&gt;
1&lt;br/&gt;
-------------------------------&lt;br/&gt;
0&lt;/p&gt;

&lt;p&gt;1 row selected&lt;/p&gt;
</comment>
                            <comment id="12425618" author="yipng" created="Thu, 3 Aug 2006 22:32:05 +0100"  >&lt;p&gt;Hi Narayanan&lt;/p&gt;

&lt;p&gt;   It is failing in this case also, the result should be null.  I think the rowCount comparison cannot be used&lt;br/&gt;
to determine whether to set the identity val or not.  It should be based on the source resultset type.&lt;/p&gt;

&lt;p&gt;ij&amp;gt; create table t1 (i int generated by default as identity, j int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; create table t2 (i int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t2 values 10;&lt;br/&gt;
1 row inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t1 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; select i from t2;&lt;br/&gt;
1 row inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; values identity_val_local();&lt;br/&gt;
1&lt;br/&gt;
-------------------------------&lt;br/&gt;
10&lt;/p&gt;

&lt;p&gt;1 row selected&lt;/p&gt;</comment>
                            <comment id="12425684" author="yipng" created="Fri, 4 Aug 2006 07:26:05 +0100"  >&lt;p&gt;Attaching my initial patch - derby1554trunkdiff01.txt for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1554&quot; title=&quot;IDENTITY_VAL_LOCAL() returned value is modified incorrectly by a multi-row INSERT statement.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1554&quot;&gt;&lt;del&gt;DERBY-1554&lt;/del&gt;&lt;/a&gt;.  This patch only contains the fix.  I ran derbyall and there are some diffs but they are expected.  Will go through the diffs to see if patch is ok and submit a followup patch for fixing the master output with additional testcases.&lt;/p&gt;

&lt;p&gt;The patch is now checking for RowResultSet type for user supplied value for identity column.  If the source result set is not of that type, Derby won&apos;t update the identityVal.   &lt;/p&gt;</comment>
                            <comment id="12425939" author="yipng" created="Sat, 5 Aug 2006 08:21:09 +0100"  >&lt;p&gt;Submitting follow up patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1554&quot; title=&quot;IDENTITY_VAL_LOCAL() returned value is modified incorrectly by a multi-row INSERT statement.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1554&quot;&gt;&lt;del&gt;DERBY-1554&lt;/del&gt;&lt;/a&gt;.  This patch contains the fix + the correct master outputs.  There were quite a number of diffs in the master files, so I had to go throught the regression results to make sure they are correct.  I also ran the autoincrement script against DB2 to double check the results.  Appreciate if someone can review this.  The patch is in derby1554trunkdiff02.txt.  &lt;/p&gt;</comment>
                            <comment id="12425941" author="yipng" created="Sat, 5 Aug 2006 08:26:08 +0100"  >&lt;p&gt;Running derbyall now, will post the result tomorrow...&lt;/p&gt;</comment>
                            <comment id="12425982" author="yipng" created="Sat, 5 Aug 2006 18:38:40 +0100"  >&lt;p&gt;derbyall passes except for the following tests which are known issues.&lt;/p&gt;

&lt;p&gt;derbyall/derbynetclientmats/derbynetclientmats.fail:jdbcapi/XATest.java (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1640&quot; title=&quot;Instability in XATest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1640&quot;&gt;&lt;del&gt;DERBY-1640&lt;/del&gt;&lt;/a&gt;)&lt;br/&gt;
derbyall/derbynetclientmats/derbynetmats.fail:lang/wisconsin.java  (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1649&quot; title=&quot;lang/wisconsin.java   fails with different cursor names&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1649&quot;&gt;&lt;del&gt;DERBY-1649&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="12426239" author="rhillegas" created="Mon, 7 Aug 2006 15:42:09 +0100"  >&lt;p&gt;Thanks, Yip. The edits look good to me. As a sanity check, I&apos;m running derbyall on my linux machine. Will commit if the tests run fine.&lt;/p&gt;</comment>
                            <comment id="12426282" author="rhillegas" created="Mon, 7 Aug 2006 19:33:52 +0100"  >&lt;p&gt;Committed derby1554trunkdiff02.txt at subversion revision 429425. As Yip says, derbyall only shows the expected diffs in XATest and wisconsin.&lt;/p&gt;</comment>
                            <comment id="12426284" author="kmarsden" created="Mon, 7 Aug 2006 19:41:55 +0100"  >&lt;p&gt;Now that this is fixed and we have returned to the previous behavior, there should no longer be Existing Application Impact, so unchecking that..  The Existing application checkbox should reflect the current state as  it affects users.  The idea is that users can generate a report of issues which have existing application impact and see what changes might affect their application.&lt;/p&gt;</comment>
                            <comment id="12427218" author="kmarsden" created="Thu, 10 Aug 2006 14:44:17 +0100"  >&lt;p&gt;Fixed in 10.1.3.2&lt;/p&gt;

&lt;p&gt;Date: Thu Aug 10 06:43:20 2006&lt;br/&gt;
New Revision: 430381&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=430381&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?rev=430381&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-353&quot; title=&quot;It is desirable to have IDENTITY_VAL_LOCAL() function return last recent user specified value or system generated value for BY DEFAULT identity columns.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-353&quot;&gt;&lt;del&gt;DERBY-353&lt;/del&gt;&lt;/a&gt; It is desirable to have IDENTITY_VAL_LOCAL() function return last recent user specified value or system generated value for BY DEFAULT identity columns.&lt;/p&gt;

&lt;p&gt;Merged from trunk 267331, contributed by V.Narayanan&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1554&quot; title=&quot;IDENTITY_VAL_LOCAL() returned value is modified incorrectly by a multi-row INSERT statement.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1554&quot;&gt;&lt;del&gt;DERBY-1554&lt;/del&gt;&lt;/a&gt; IDENTITY_VAL_LOCAL() returned value is modified incorrectly by a multi-row INSERT statement.&lt;/p&gt;

&lt;p&gt;Merged from trunk 429425, contributed by Yip Ng&lt;/p&gt;



</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12311324">DERBY-353</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12338078" name="DERBY-1554.diff" size="739" author="narayanan" created="Thu, 3 Aug 2006 17:05:53 +0100"/>
                            <attachment id="12338079" name="DERBY-1554.stat" size="167" author="narayanan" created="Thu, 3 Aug 2006 17:05:53 +0100"/>
                            <attachment id="12338121" name="derby1554trunkdiff01.txt" size="2018" author="yipng" created="Fri, 4 Aug 2006 07:26:05 +0100"/>
                            <attachment id="12338205" name="derby1554trunkdiff02.txt" size="25356" author="yipng" created="Sat, 5 Aug 2006 08:21:09 +0100"/>
                            <attachment id="12338120" name="derby1554trunkstat01.txt" size="171" author="yipng" created="Fri, 4 Aug 2006 07:26:03 +0100"/>
                            <attachment id="12338204" name="derby1554trunkstat02.txt" size="637" author="yipng" created="Sat, 5 Aug 2006 08:21:09 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 27 Jul 2006 15:01:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22566</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0uzb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38837</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10051"><![CDATA[Urgent]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>