<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:22:22 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-623/DERBY-623.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-623] Derby monitor accesses two system properties without using a privileged block when built sane=true</title>
                <link>https://issues.apache.org/jira/browse/DERBY-623</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When built with sane=true and testing with the jars these permissions are required to be granted all the way up the stack, currently this means for the tests granting them to the network server jar.&lt;/p&gt;

&lt;p&gt;  permission java.util.PropertyPermission &quot;derby.monitor.verbose&quot;, &quot;read&quot;;&lt;br/&gt;
  permission java.util.PropertyPermission &quot;derby.debug.*&quot;, &quot;read&quot;;&lt;/p&gt;

&lt;p&gt;The engine contains code to read system properties using privileged blocks, this should be used by the monitor.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12317924">DERBY-623</key>
            <summary>Derby monitor accesses two system properties without using a privileged block when built sane=true</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="djd">Daniel John Debrunner</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Oct 2005 23:41:33 +0100</created>
                <updated>Fri, 17 Mar 2006 15:59:26 +0000</updated>
                            <resolved>Fri, 17 Mar 2006 15:59:26 +0000</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12368615" author="djd" created="Fri, 3 Mar 2006 07:05:11 +0000"  >&lt;p&gt;The engine method to read a system property is:&lt;/p&gt;

&lt;p&gt;org.apache.derby.iapi.services.property.PropertyUtil.getSystemProperty&lt;/p&gt;</comment>
                            <comment id="12368624" author="djd" created="Fri, 3 Mar 2006 08:47:04 +0000"  >&lt;p&gt;To reproduce this bug remove these permissions from derby_test.policy&lt;/p&gt;

&lt;p&gt;  // BUG &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-623&quot; title=&quot;Derby monitor accesses two system properties without using a privileged block when built sane=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-623&quot;&gt;&lt;del&gt;DERBY-623&lt;/del&gt;&lt;/a&gt; - sane=true&lt;br/&gt;
  permission java.util.PropertyPermission &quot;derby.monitor.verbose&quot;, &quot;read&quot;;&lt;br/&gt;
  permission java.util.PropertyPermission &quot;derby.debug.*&quot;, &quot;read&quot;;&lt;/p&gt;


&lt;p&gt;Build with sane=true and then run derbyall with the sane jars. Probably will see the issue by only running derbynetclientmats and derbynetmats suites.&lt;/p&gt;</comment>
                            <comment id="12369015" author="kristwaa" created="Mon, 6 Mar 2006 21:04:50 +0000"  >&lt;p&gt;A separate patch (&apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-623&quot; title=&quot;Derby monitor accesses two system properties without using a privileged block when built sane=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-623&quot;&gt;&lt;del&gt;DERBY-623&lt;/del&gt;&lt;/a&gt;-2a-javadoc.diff&apos;) for a few Javadoc fixes. First, a spelling error is corrected several places (&apos;privledged&apos; -&amp;gt; &apos;priviledged&apos;) and the prefix for properties have been changed from &apos;db2j&apos; to &apos;derby.&apos; (only documentation is changed in this patch, implementation is untouched). &lt;/p&gt;

&lt;p&gt;A committer should be able to both review and commit this small patch (8 lines changed).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-623&quot; title=&quot;Derby monitor accesses two system properties without using a privileged block when built sane=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-623&quot;&gt;&lt;del&gt;DERBY-623&lt;/del&gt;&lt;/a&gt;-2a-javadoc.diff does not resolve this issue, it is only an additional documentation fix.&lt;/p&gt;</comment>
                            <comment id="12369032" author="kristwaa" created="Tue, 7 Mar 2006 00:19:57 +0000"  >&lt;p&gt;&apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-623&quot; title=&quot;Derby monitor accesses two system properties without using a privileged block when built sane=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-623&quot;&gt;&lt;del&gt;DERBY-623&lt;/del&gt;&lt;/a&gt;-2b-javadoc.diff&apos; is a patch fixing spelling errors for a patch fixing spelling errors &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
See description for rev 2a for patch description.&lt;/p&gt;

&lt;p&gt;Must have had a blackout or something. Sorry for the noise... &lt;/p&gt;</comment>
                            <comment id="12369195" author="kristwaa" created="Tue, 7 Mar 2006 18:07:22 +0000"  >&lt;p&gt;&apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-623&quot; title=&quot;Derby monitor accesses two system properties without using a privileged block when built sane=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-623&quot;&gt;&lt;del&gt;DERBY-623&lt;/del&gt;&lt;/a&gt;-1a.diff&apos; is a patch changing BaseMonitor to use privileged blocks for reading system properties and also removing the workaround permissions granted in &apos;derby_tests.policy&apos;. &lt;/p&gt;

&lt;p&gt;Reading of specific properties are done with &apos;PropertyUtil.getSystemProperty()&apos;.&lt;br/&gt;
Besides general feedback, I would like feedback on the following issues:&lt;/p&gt;

&lt;p&gt;1) I have not separated reading all system properties (System.getProperties) into its own method, because this is done only here (and one place in testing code). It is also something we should in general not do. Further, keeping it inside the sanity block removes it in insane builds.&lt;/p&gt;

&lt;p&gt;2) Should the swallowed exception be logged somewhere?&lt;/p&gt;

&lt;p&gt;3) Is the order of the &apos;startServices&apos; calls important? If not, I would move the call inside the sanity block to the end. I also removed the call for insane builds, since the variable passed in is only set for sane builds.&lt;/p&gt;

&lt;p&gt;The patch is a mix of my own work and the patch I got by Rick Hillegas on derby-dev (subject &apos;Security manager problems with Class.forName()&apos;).&lt;/p&gt;</comment>
                            <comment id="12369468" author="kristwaa" created="Wed, 8 Mar 2006 23:29:39 +0000"  >&lt;p&gt;Patch ready for review &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12369478" author="djd" created="Wed, 8 Mar 2006 23:46:14 +0000"  >&lt;p&gt;which tests were tests run? with classes and with jars?&lt;/p&gt;</comment>
                            <comment id="12369497" author="djd" created="Thu, 9 Mar 2006 01:04:00 +0000"  >&lt;p&gt;The changes to reading system properties are really outside the scope of this bug. I actually think that the original code should be removed,&lt;br/&gt;
ideally the debug (sane) server should not behave differently to the non-debug (insane) server. There is already a mechanism that works&lt;br/&gt;
in both sane and insane for adding additional modules, debug or otherwise. That is having an additional modules.properties in the class path.&lt;/p&gt;

&lt;p&gt;I believe the code of having system properties set modules should be removed because it can be a security risk, that is enabled&lt;br/&gt;
by just allowing the derby engine to read system properties. Then malicious code has the possibility to change runtime modules,&lt;br/&gt;
by setting system properties, such as changing the authentication module to allow any user. That&apos;s why the code is not security&lt;br/&gt;
manager enabled at the moment, though that is not a complete solution, removing the code would be better.&lt;/p&gt;</comment>
                            <comment id="12369559" author="kristwaa" created="Thu, 9 Mar 2006 06:44:09 +0000"  >&lt;p&gt;By looking at the description of the bug, I really can&apos;t see that the changes I implemented are outside the scope of the bug:&lt;br/&gt;
&quot;The engine contains code to read system properties using privileged blocks, this should be used by the monitor.&quot;&lt;/p&gt;

&lt;p&gt;About the only thing changed by patch &apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-623&quot; title=&quot;Derby monitor accesses two system properties without using a privileged block when built sane=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-623&quot;&gt;&lt;del&gt;DERBY-623&lt;/del&gt;&lt;/a&gt;-1a.diff&apos; is that the properties (including &apos;System.getProperties()&apos;) that was previously read outside a privileged block is now read inside one.&lt;br/&gt;
I take your previous comment was related to the parts of the code that use the result of &apos;System.getProperties()&apos;, and removing this should be easy enough for someone that knows the code a little. Based on the comments in the method &apos;runWithState&apos;, I think I&apos;ll step down since I don&apos;t know the story of the unit tests and the overall function of BaseMonitor.&lt;/p&gt;

&lt;p&gt;In my opinion, your previous comment points in the direction of a new Jira issue.&lt;br/&gt;
That said, discarding the current patch and implementing the changes you talk about as part of this issue is fine with me - but for the reason mentioned above this is not my itch.&lt;/p&gt;</comment>
                            <comment id="12369713" author="djd" created="Fri, 10 Mar 2006 02:50:57 +0000"  >&lt;p&gt;It seems out of scope to me because the summary talks about reading two specific properties, listed in the description, and the description talks about using existing code with existing privilege blocks.&lt;/p&gt;

&lt;p&gt;Your code addresses reading all system properties and adds a new privilege block, doesn&apos;t seem to overlap in my mind.&lt;/p&gt;

&lt;p&gt;I think the patch is fine and can go into the trunk, but say I wanted to merge this up to 10.1 branch, I would be more comfortable merging just the specific fix rather than this additional change that can change the behaviour.&lt;/p&gt;</comment>
                            <comment id="12369835" author="kristwaa" created="Fri, 10 Mar 2006 18:06:03 +0000"  >&lt;p&gt;Dan, I see your point now! I do still mean we need another Jira though, to track cleaning up BaseMonitor (primarily method &apos;runWithState&apos;).&lt;/p&gt;

&lt;p&gt;&apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-623&quot; title=&quot;Derby monitor accesses two system properties without using a privileged block when built sane=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-623&quot;&gt;&lt;del&gt;DERBY-623&lt;/del&gt;&lt;/a&gt;-1b.diff&apos; is a reduced patch, only addressing reading two specific system properties in privileged blocks and updating the test policy file accordingly.&lt;br/&gt;
Patch &apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-623&quot; title=&quot;Derby monitor accesses two system properties without using a privileged block when built sane=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-623&quot;&gt;&lt;del&gt;DERBY-623&lt;/del&gt;&lt;/a&gt;-1a.diff&apos; is now deprecated.&lt;br/&gt;
Tests run on Solaris10, Sun 1.5:&lt;br/&gt;
derbyall - insane - jars:  derbynet/runtimeinfo.java, jdbcapi/Stream.java and jdbcapi/SURTest.junit failed.&lt;br/&gt;
derbyall - sane - jars: OK! (stress.multi failed)&lt;br/&gt;
derbyall - sane - classes: NSinSameJVM failed.&lt;/p&gt;

&lt;p&gt;I don&apos;t think the errors are caused by the changes, but if anyone else thinks so, speak up!&lt;/p&gt;</comment>
                            <comment id="12370401" author="djd" created="Wed, 15 Mar 2006 03:23:58 +0000"  >&lt;p&gt;Patch derby-623-1b.diff Committed revision 385859&lt;/p&gt;</comment>
                            <comment id="12370792" author="kristwaa" created="Fri, 17 Mar 2006 15:59:26 +0000"  >&lt;p&gt;Closing the issue. No problems reported regarding the fix.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12323849" name="DERBY-623-1a.diff" size="3280" author="kristwaa" created="Tue, 7 Mar 2006 18:07:21 +0000"/>
                            <attachment id="12323850" name="DERBY-623-1a.stat" size="157" author="kristwaa" created="Tue, 7 Mar 2006 18:07:22 +0000"/>
                            <attachment id="12324014" name="DERBY-623-1b.diff" size="1519" author="kristwaa" created="Fri, 10 Mar 2006 18:06:03 +0000"/>
                            <attachment id="12324015" name="DERBY-623-1b.stat" size="157" author="kristwaa" created="Fri, 10 Mar 2006 18:06:03 +0000"/>
                            <attachment id="12323771" name="DERBY-623-2b-javadoc.diff" size="2593" author="kristwaa" created="Tue, 7 Mar 2006 00:19:57 +0000"/>
                            <attachment id="12323772" name="DERBY-623-2b-javadoc.stat" size="229" author="kristwaa" created="Tue, 7 Mar 2006 00:19:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 6 Mar 2006 21:04:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22053</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy16zj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40782</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>