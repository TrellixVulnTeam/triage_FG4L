<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:22:18 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-515/DERBY-515.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-515] Network Server should log server start and shutdown time to derby.log</title>
                <link>https://issues.apache.org/jira/browse/DERBY-515</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Network server currently only reports the start and stop of network server to the console output and does not print an associated timestamp.&lt;/p&gt;

&lt;p&gt;It would be helpful if the start and stop times of network server  were recorded in the derby.log, so there would not be a need to check t the  console output.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12313521">DERBY-515</key>
            <summary>Network Server should log server start and shutdown time to derby.log</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="deepa">Deepa Remesh</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Aug 2005 23:47:24 +0100</created>
                <updated>Wed, 24 May 2006 05:58:55 +0100</updated>
                            <resolved>Sat, 25 Feb 2006 02:30:19 +0000</resolved>
                                    <version>10.1.2.1</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                            <comments>
                            <comment id="12319327" author="oysteing" created="Fri, 19 Aug 2005 17:14:34 +0100"  >&lt;p&gt;This would be even more helpful if the derby.log file was not overwritten on the next startup.  (Probably a separate issue).&lt;/p&gt;</comment>
                            <comment id="12361379" author="deepa" created="Fri, 30 Dec 2005 01:21:38 +0000"  >&lt;p&gt;Attaching a patch &apos;derby-515.diff&apos; which does the following:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Adds timestamp to server start and shutdown messages written to derby.log and console. Timestamp formatting is done in the same way as it is done for Derby boot message.&lt;/li&gt;
	&lt;li&gt;Adds additional parameters to start and shutdown messages in the properties files.&lt;/li&gt;
	&lt;li&gt;Modifies test output of derbynet/NSinSameJVM.java and derbynet/testProperties.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Ran derbyall with Sun JDK 1.4.2 on Windows XP. No failures. Please review/commit this patch. Thanks.&lt;/p&gt;

&lt;p&gt;For the issue mentioned by Oystein &quot;This would be even more helpful if the derby.log file was not overwritten on the next startup. (Probably a separate issue).&quot; - property derby.infolog.append can be used to avoid overwriting derby.log file. &lt;/p&gt;</comment>
                            <comment id="12362113" author="kmarsden" created="Sun, 8 Jan 2006 15:31:11 +0000"  >&lt;p&gt;A few  thoughts looking at this patch.  I am interested in input from others.&lt;/p&gt;

&lt;p&gt;1) I think maybe we should print the time on the same line because it doesn&apos;t look clear what  the time is associated with, particularly for shutdown.&lt;/p&gt;

&lt;p&gt;2) For the messages, I think it is   ok to checkin just the English message and wait for someone with interest to translate particularly if the first parameter stays the same (see 3)&lt;/p&gt;

&lt;p&gt;3) Maybe now that the startup and shutdown messages are printing to the log and not just the network server console, we should consider something more descriptive for our start and shutdown messages.  Perhaps:&lt;br/&gt;
    Apache Derby Network Server - 10.2.0.0 started and ready to accept connections on port 1527 at 2006-01-08 05:46:31.527 GMT&lt;br/&gt;
    Apache Derby Network Server  - 10.2.0.0  shutdown at 2006-01-08 05:46:31.527 GMT&lt;/p&gt;


&lt;p&gt;------ derby.log output --------------------&lt;/p&gt;

&lt;p&gt;2006-01-08 05:46:31.527 GMT:&lt;br/&gt;
 Server is ready to accept connections on port 1527.&lt;br/&gt;
----------------------------------------------------------------&lt;br/&gt;
2006-01-08 05:46:41.021 GMT:&lt;br/&gt;
 Booting Derby version The Apache Software Foundation - Apache Derby - 10.2.0.0&lt;br/&gt;
alpha - (1): instance c013800d-0108-a88d-3029-000000098a28&lt;br/&gt;
on database directory D:\testout\wombat&lt;/p&gt;

&lt;p&gt;Database Class Loader started - derby.database.classpath=&apos;&apos;&lt;br/&gt;
----------------------------------------------------------------&lt;br/&gt;
2006-01-08 05:47:13.678 GMT:&lt;br/&gt;
 Booting Derby version The Apache Software Foundation - Apache Derby - 10.2.0.0&lt;br/&gt;
alpha - (1): instance a816c00e-0108-a88d-3029-000000098a28&lt;br/&gt;
on database directory D:\testout\wombat2&lt;/p&gt;

&lt;p&gt;Database Class Loader started - derby.database.classpath=&apos;&apos;&lt;br/&gt;
2006-01-08 06:09:44.080 GMT:&lt;br/&gt;
 Shutdown successful.&lt;/p&gt;</comment>
                            <comment id="12366432" author="deepa" created="Wed, 15 Feb 2006 13:25:56 +0000"  >&lt;p&gt;Attaching a revised patch &apos;derby-515-v2.diff&apos; which adds timestamp to network server start and shutdown messages. &lt;/p&gt;

&lt;p&gt;Summary of patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Changes network server start and shutdown messages to include product name, version and timestamp. I changed the messages to what Kathey suggested. With the patch, messages will look like this:&lt;br/&gt;
Apache Derby Network Server - 10.2.0.0 alpha started and ready to accept connections on port 1527 at  2006-02-15 03:42:51.676 GMT&lt;br/&gt;
Apache Derby Network Server - 10.2.0.0 alpha shutdown at 2006-02-15 03:49:14.988 GMT&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Changes only English messages. The first parameter for start message is kept the same.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Modifies NetworkServerControlImpl to pass in the additional parameters to the messages. Formatiing of timestamp is done same way as it is done for Derby boot message.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Modifies master files.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Since the changed master files contain version information, they are added to tools\release\build.xml so that version will get bumped at release time.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In Derby Server and Admin guide, we may have to change the messages in sample output for NsSample program. I will open another  jira once this patch is reviewed and committed.&lt;/p&gt;

&lt;p&gt;I have a couple of questions and would appreciate if someone can answer them:&lt;br/&gt;
1. I found that the test derbynet/NSinSameJVM.java has two masters - one for client and one for jcc driver. These masters are identical. Can we remove these and keep a single copy in top &quot;master&quot; folder? &lt;br/&gt;
2. Will it be useful to add timestamp to messages for other netwrok server commands (like trace, timeslice, maxthreads etc) ?&lt;/p&gt;

&lt;p&gt;With this patch, I ran derbynetmats and derbynetclientmats with Sun JDK 1.4.2 on Win XP. No failures. Please take a look at this patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="12366519" author="bryanpendleton" created="Thu, 16 Feb 2006 03:43:47 +0000"  >&lt;p&gt;I think this is quite nice &amp;#8211; thanks!&lt;/p&gt;

&lt;p&gt;I don&apos;t see any need to timestamp the trace or other messages&lt;br/&gt;
at this time. I think we should just start with the startup&lt;br/&gt;
and shutdown messages and get some feel for it.&lt;/p&gt;

&lt;p&gt;Why did you choose GMT for the timestamp? Since it&apos;s intended&lt;br/&gt;
for a human to read, it seems like it might be slightly nicer to&lt;br/&gt;
display the time in the server&apos;s local timezone?&lt;/p&gt;

&lt;p&gt;Lastly, what do you think about handling the version number in&lt;br/&gt;
the error message with a test-time filter, the same way that&lt;br/&gt;
the xxxxxxFILTERED-TIMESTAMPxxxxxx is handled, so that the master&lt;br/&gt;
test files would say xxxxxxFILTERED-VERSION-NUMBERxxxxxx? Presumably,&lt;br/&gt;
we could make it so that the software which did the filtering&lt;br/&gt;
verified that the version number was correct, then filtered it out;&lt;br/&gt;
that would mean fewer files had to change when bumping the version number.&lt;/p&gt;</comment>
                            <comment id="12366554" author="deepa" created="Thu, 16 Feb 2006 07:29:55 +0000"  >&lt;p&gt;Thanks Bryan for looking at the patch.&lt;/p&gt;

&lt;p&gt;I chose GMT to keep it consistent with what is used for Derby boot message. The network server start and shutdown messages get printed along with derby boot messages in derby.log.  Something like this:&lt;/p&gt;

&lt;p&gt;Apache Derby Network Server - 10.2.0.0 alpha started and ready to accept connections on port 1527 at 2006-02-15 21:43:13.252 GMT &lt;br/&gt;
----------------------------------------------------------------&lt;br/&gt;
2006-02-15 21:44:07.871 GMT:&lt;br/&gt;
 Booting Derby version The Apache Software Foundation - Apache Derby - 10.2.0.0 alpha - (1): instance c013800d-0109-6faa-b988-00000015dbe8&lt;br/&gt;
on database directory C:\deepa\Derby\derby_testing\nwserver\testdb  &lt;/p&gt;

&lt;p&gt;Database Class Loader started - derby.database.classpath=&apos;&apos;&lt;br/&gt;
Apache Derby Network Server - 10.2.0.0 alpha shutdown at 2006-02-15 21:47:02.772 GMT&lt;/p&gt;

&lt;p&gt;If we are using local time, I think we should do it for all messages to keep it consistent in derby.log. &lt;/p&gt;

&lt;p&gt;About using xxxxxxFILTERED-VERSION-NUMBERxxxxxx, I did&apos;nt see other tests doing it. I saw the current pattern in tests is to add master files with version number to release/build.xml file. I would like to know what problems you see if there are more files in this list.&lt;/p&gt;</comment>
                            <comment id="12366714" author="kmarsden" created="Fri, 17 Feb 2006 07:58:50 +0000"  >&lt;p&gt;I committed this patch.&lt;br/&gt;
I think it would be good to add a comment to the code regarding why we use CheapDateFormatter and GMT.&lt;/p&gt;

&lt;p&gt;On  your questions&lt;br/&gt;
1. I found that the test derbynet/NSinSameJVM.java has two masters - one for client and one for jcc driver. These masters are identical. Can we remove these and keep a single copy in top &quot;master&quot; folder?&lt;/p&gt;

&lt;p&gt;Yes, that sounds like a good idea&lt;/p&gt;

&lt;p&gt;2. Will it be useful to add timestamp to messages for other netwrok server commands (like trace, timeslice, maxthreads etc) ? &lt;/p&gt;

&lt;p&gt;I think it would be useful for all messages to the console be timestamped, particularly for the connection messages an any exception information.&lt;/p&gt;
</comment>
                            <comment id="12366850" author="deepa" created="Sat, 18 Feb 2006 06:44:32 +0000"  >&lt;p&gt;Attaching a second patch &apos;derby-515-patch2-v1.diff&apos; for Kathey&apos;s comments. Summary of patch:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Removes identical master files in DerbyNetClient and DerbyNet for derbynet/NSinSameJVM.java and moves it the top master directory.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Modified tools/release/build.xml to point to the new master file.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Adds comments as to why CheapDateFormatter and GMT is used to format timestamp. Moves formatting of timestamp to a method getFormattedTimestamp(). This will be helpful if timestamp is planned to be used for more messages as Kathey indicated. I will open a JIRA for this.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;With this patch, I ran derbynetmats and derbynetclientmats with Sun JDK1.4.2. 1 failure in derbynetmats (jdbcapi/checkDataSource30.java) also seen in tinderbox tests. Please take a look at this patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="12366971" author="bryanpendleton" created="Mon, 20 Feb 2006 02:50:36 +0000"  >&lt;p&gt;I checked derby-515-patch2-v1.diff.&lt;/p&gt;

&lt;p&gt;I thought it was a little odd that the diff contains changes to the two master files which are to be deleted. The status file is clear about the files which are to be deleted and the file which is to be added, so maybe I&apos;m just not practiced at reading diffs which contain deleted files.&lt;/p&gt;

&lt;p&gt;The changes to NetworkServerControlImpl.java look good to me, and the patch applied cleanly (modulo my confusion about the deleted files) and derbynet/NSinSameJVM.java passed for me with both client frameworks. So it looks good to me.&lt;/p&gt;</comment>
                            <comment id="12366972" author="kmarsden" created="Mon, 20 Feb 2006 03:10:43 +0000"  >&lt;p&gt;Bryan, would you be willing to commit this when you get the needed accounts and karma?&lt;/p&gt;</comment>
                            <comment id="12366973" author="bryanpendleton" created="Mon, 20 Feb 2006 03:16:38 +0000"  >&lt;p&gt;Yes, that sounds like a fine idea. Once I am fully set up, I will review and commit this change.&lt;/p&gt;</comment>
                            <comment id="12366996" author="deepa" created="Mon, 20 Feb 2006 09:27:26 +0000"  >&lt;p&gt;Thanks Bryan for reading patch2.&lt;/p&gt;</comment>
                            <comment id="12367233" author="deepa" created="Wed, 22 Feb 2006 02:36:32 +0000"  >&lt;p&gt;Suresh pointed out to me that this change caused the following failure in derbynetclientmats with 10.1 client and 10.2 server:&lt;/p&gt;

&lt;p&gt;derbynetclientmats/derbynetmats/derbynetmats.fail:derbynet/testProperties.java: &lt;br/&gt;
(&amp;lt; Shutdown successful.&lt;br/&gt;
    6a6&lt;br/&gt;
     &amp;gt; Apache Derby Network Server - 10.2.0.0 alpha shutdown at xxxxxxFILTERED-TIMESTAMPxxxxxGMT&lt;br/&gt;
     11 del&lt;br/&gt;
)&lt;/p&gt;

&lt;p&gt;The diff is in the shutdown message. The test executes a process to shutdown the network server that it started. This process currently dumps results to standard out. I am planning to change this test to make the shutdown process not write to the standard output. The test can use execCmd instead of execCmdDumpResults method for the shutdown process. I will submit a patch for this in a while. &lt;/p&gt;</comment>
                            <comment id="12367681" author="bryanpendleton" created="Sat, 25 Feb 2006 02:28:57 +0000"  >&lt;p&gt;Committed derby-515-patch2-v1.diff to the trunk as revision 380722.&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewcvs?rev=380722&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=380722&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This was my first commit (yay!) &amp;#8211; please let me know if I missed out a step.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12323127" name="derby-515-patch2-v1.diff" size="5704" author="deepa" created="Sat, 18 Feb 2006 06:44:32 +0000"/>
                            <attachment id="12323128" name="derby-515-patch2-v1.status" size="377" author="deepa" created="Sat, 18 Feb 2006 06:44:32 +0000"/>
                            <attachment id="12322979" name="derby-515-v2.diff" size="8953" author="deepa" created="Wed, 15 Feb 2006 13:25:56 +0000"/>
                            <attachment id="12322980" name="derby-515-v2.status" size="447" author="deepa" created="Wed, 15 Feb 2006 13:25:56 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12329386">DERBY-1041</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 19 Aug 2005 16:14:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29587</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy16an:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40670</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>