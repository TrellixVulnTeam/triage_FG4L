<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:41:29 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4068/DERBY-4068.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4068] Numeric arguments to functions/parameters raise overflow condition in client/server configuration.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4068</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The test_numeric_BigDecimal_BigDecimal() and test_decimal_BigDecimal_BigDecimal() test cases in AnsiSignaturesTest raise overflow errors when run in client/server mode.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12415386">DERBY-4068</key>
            <summary>Numeric arguments to functions/parameters raise overflow condition in client/server configuration.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Rick Hillegas</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Feb 2009 18:09:58 +0000</created>
                <updated>Fri, 21 Jan 2011 18:27:54 +0000</updated>
                            <resolved>Fri, 26 Mar 2010 12:26:55 +0000</resolved>
                                    <version>10.6.1.0</version>
                                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>JDBC</component>
                    <component>Network Server</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12726861" author="knutanders" created="Fri, 3 Jul 2009 11:04:40 +0100"  >&lt;p&gt;Triaged for 10.5.2. Changed component from SQL to Network Server, since there&apos;s no indication that the problem is in the SQL machinery, and flagged it as an embedded/client difference.&lt;/p&gt;

&lt;p&gt;The exceptions are thrown by impl.drda.DDMWriter.writeBigDecimal():&lt;/p&gt;

&lt;p&gt;            if (bigWholeIntegerLength &amp;gt; declaredWholeIntegerLength)&lt;/p&gt;
			{
				clearDdm ();
                throw new SQLException (&quot;Overflow occurred during numeric data type conversion of \&quot;&quot; +
                                       b.toString() +
                                       &quot;\&quot;.&quot;,
                                       &quot;22003&quot;,
                                       -413);
			}

&lt;p&gt;(The code is not even internationalized. Ouch!)&lt;/p&gt;</comment>
                            <comment id="12727279" author="knutanders" created="Sun, 5 Jul 2009 00:40:05 +0100"  >&lt;p&gt;The underlying issue appears to be that ResultSetMetadata (in the embedded driver) reports that both precision and scale for the return value are 31, whereas they are 7 and 2, respectively. This confuses the network server since scale==precision means that all the numbers are to the right of the decimal point, which is not the case for the returned value 12345.67. It correctly concludes that the value doesn&apos;t fit into a NUMERIC(31,31) column and raises an overflow error.&lt;/p&gt;

&lt;p&gt;Attached is a small program that shows that the precision and the scale for a function declared to return a NUMERIC(7,2) value are reported to be 31.&lt;/p&gt;</comment>
                            <comment id="12727280" author="knutanders" created="Sun, 5 Jul 2009 00:42:59 +0100"  >&lt;p&gt;Adding component JDBC since getPrecision() and getScale() in ResultSetMetadata return the wrong value.&lt;/p&gt;</comment>
                            <comment id="12797647" author="witoldsz" created="Thu, 7 Jan 2010 15:09:48 +0000"  >&lt;p&gt;I have exactly the same issue, my function returns BigDecimal, it is declared as DECIMAL(12,2) and Derby throws:&lt;/p&gt;

&lt;p&gt;Error code -1, SQL state 22003: Overflow occurred during numeric data type conversion of &quot;123.45&quot;.&lt;/p&gt;

&lt;p&gt;This is a big issue, the only workaround is to return Strings and wrap them in application logic (ugly!) or BigDecimal.movePointRight(2) and return integers, but again - dirty tricks across application are required.&lt;/p&gt;

&lt;p&gt;Can you consider raising the urgency of the issue?&lt;/p&gt;</comment>
                            <comment id="12797652" author="rhillegas" created="Thu, 7 Jan 2010 15:28:48 +0000"  >&lt;p&gt;Am marking this as a &quot;wrong results&quot; bug since the JDBC precision and scale are wrong. This will bump up the priority of this issue.&lt;/p&gt;</comment>
                            <comment id="12849363" author="rhillegas" created="Wed, 24 Mar 2010 19:12:55 +0000"  >&lt;p&gt;Attaching derby-4068-01-aa-bindMistake.diff. This fixes the precision/scale problem which Knut identified. I need to run regression tests.&lt;/p&gt;

&lt;p&gt;The precision and scale were defaulted early on during the bind() phase. This is another example of how type information can be lost as the compiler moves between the Java and SQL domains.&lt;/p&gt;

&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/compile/SQLToJavaValueNode.java&lt;/p&gt;

&lt;p&gt;A previous patch added the getDataType() method to JavaValueNode so that JavaValueNodes can retrieve SQL type information from the tree beneath them. This patch teaches another kind of JavaValueNode how to do this.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/lang/AnsiSignaturesTest.java&lt;/p&gt;

&lt;p&gt;Re-enables the running of this test in client-server mode since the defect is now fixed.&lt;/p&gt;
</comment>
                            <comment id="12849818" author="rhillegas" created="Thu, 25 Mar 2010 18:25:03 +0000"  >&lt;p&gt;Attaching a second rev of the patch, derby-4068-01-ab-bindMistake.diff. This expands the original patch by updating some canons for tests which failed.&lt;/p&gt;

&lt;p&gt;It turns out that the patch fixes another, related bug: VARCHAR returning functions defaulted to returning 32762 character strings.&lt;/p&gt;

&lt;p&gt;This patch additionally updates the following canons:&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/master/compressTable.out&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/master/functions.out&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/master/onlineBackupTest2.out&lt;/p&gt;</comment>
                            <comment id="12850114" author="rhillegas" created="Fri, 26 Mar 2010 12:26:55 +0000"  >&lt;p&gt;Tests passed cleanly for me. Committed the second rev of the patch at subversion 927631.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12395004">DERBY-3652</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12412549" name="ScaleAndPrecision.java" size="1077" author="knutanders" created="Sun, 5 Jul 2009 00:40:05 +0100"/>
                            <attachment id="12439686" name="derby-4068-01-aa-bindMistake.diff" size="1351" author="rhillegas" created="Wed, 24 Mar 2010 19:12:55 +0000"/>
                            <attachment id="12439804" name="derby-4068-01-ab-bindMistake.diff" size="42613" author="rhillegas" created="Thu, 25 Mar 2010 18:25:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10363"><![CDATA[Embedded/Client difference]]></customfieldvalue>
    <customfieldvalue key="10366"><![CDATA[Wrong query result]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 3 Jul 2009 10:04:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24005</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0jrb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37019</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>