<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:49:28 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5141/DERBY-5141.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5141] SSLTest fails with java.net.SocketException: Default SSL context init failed: null</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5141</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;With the latest upgrade to the ibm 1.4.2 jvm (SR13FP8) I see this failure with the SSLTest: &lt;/p&gt;

&lt;p&gt;START-SPAWNED:SpawnedNetworkServer STANDARD OUTPUT: exit code=1&lt;br/&gt;
Thu Mar 17 09:52:31 PDT 2011 : Security manager installed using the Basic server security policy.&lt;br/&gt;
Thu Mar 17 09:52:31 PDT 2011 : Could not listen on port 1527 on host localhost:&lt;br/&gt;
 java.net.SocketException: Default SSL context init failed: null&lt;br/&gt;
END-SPAWNED  :SpawnedNetworkServer STANDARD OUTPUT:&lt;br/&gt;
FSTART-SPAWNED:SpawnedNetworkServer STANDARD OUTPUT: exit code=1&lt;br/&gt;
Thu Mar 17 09:53:11 PDT 2011 : Security manager installed using the Basic server security policy.&lt;br/&gt;
Thu Mar 17 09:53:12 PDT 2011 : Could not listen on port 1527 on host localhost:&lt;br/&gt;
 java.net.SocketException: Default SSL context init failed: null&lt;br/&gt;
END-SPAWNED  :SpawnedNetworkServer STANDARD OUTPUT:&lt;br/&gt;
F&lt;br/&gt;
Time: 82.419&lt;br/&gt;
There were 2 failures:&lt;br/&gt;
1) testSSLBasicDSConnect(org.apache.derbyTesting.functionTests.tests.derbynet.SSLTest) junit.framework.AssertionFailedError: Timed out waiting for network server to start:Spawned SpawnedNetworkServer exitCode=1&lt;br/&gt;
STDOUT:&lt;br/&gt;
Thu Mar 17 09:52:31 PDT 2011 : Security manager installed using the Basic server security policy.&lt;br/&gt;
Thu Mar 17 09:52:31 PDT 2011 : Could not listen on port 1527 on host localhost:&lt;br/&gt;
 java.net.SocketException: Default SSL context init failed: null&lt;/p&gt;

&lt;p&gt;        at org.apache.derbyTesting.junit.NetworkServerTestSetup.setUp(NetworkServerTestSetup.java:204)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:18)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
2) testSSLBasicDSPlainConnect(org.apache.derbyTesting.functionTests.tests.derbynet.SSLTest) junit.framework.AssertionFailedError: Timed out waiting for network server to start:Spawned SpawnedNetworkServer exitCode=1&lt;br/&gt;
STDOUT:&lt;br/&gt;
Thu Mar 17 09:53:11 PDT 2011 : Security manager installed using the Basic server security policy.&lt;br/&gt;
Thu Mar 17 09:53:12 PDT 2011 : Could not listen on port 1527 on host localhost:&lt;br/&gt;
 java.net.SocketException: Default SSL context init failed: null&lt;/p&gt;

&lt;p&gt;        at org.apache.derbyTesting.junit.NetworkServerTestSetup.setUp(NetworkServerTestSetup.java:204)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:18)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;/p&gt;

&lt;p&gt;derby.log only has: &lt;br/&gt;
Thu Mar 17 09:53:12 PDT 2011 : Could not listen on port 1527 on host localhost:&lt;br/&gt;
 java.net.SocketException: Default SSL context init failed: null&lt;/p&gt;

&lt;p&gt;There are no other files.&lt;/p&gt;

&lt;p&gt;This worked fine with the latest ibm 1.5 version (sr12 fp4), and with ibm 1.4.2. sr13 fp4 (I don&apos;t know about fpt5, 6, or 7), so it could be a jvm issue.&lt;/p&gt;</description>
                <environment>Suse Linux, IBM Classic jvm 1.4.2, build cxia32142ifx-20110215 (SR13 FP8+PM31983) (JIT enabled: jitc))</environment>
        <key id="12501709">DERBY-5141</key>
            <summary>SSLTest fails with java.net.SocketException: Default SSL context init failed: null</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Mar 2011 17:46:28 +0000</created>
                <updated>Mon, 17 Jun 2013 10:19:19 +0100</updated>
                            <resolved>Thu, 24 Mar 2011 19:18:29 +0000</resolved>
                                    <version>10.7.1.1</version>
                                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13010854" author="kmarsden" created="Thu, 24 Mar 2011 19:18:02 +0000"  >&lt;p&gt;This first appeared in IBM 1.4.2. FP6. The problem does not appear with :&lt;br/&gt;
java version &quot;1.4.2&quot;&lt;br/&gt;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.4.2)&lt;br/&gt;
Classic VM (build 1.4.2, J2RE 1.4.2 IBM build cxia32142ifx-20100705 (SR13 FP5) (&lt;br/&gt;
JIT enabled: jitc))&lt;/p&gt;

&lt;p&gt;but does with &lt;br/&gt;
java version &quot;1.4.2&quot;&lt;br/&gt;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.4.2)&lt;br/&gt;
Classic VM (build 1.4.2, J2RE 1.4.2 IBM build cxia32142ifx-20100918 (SR13 FP6) (&lt;br/&gt;
JIT enabled: jitc))&lt;/p&gt;

&lt;p&gt;The problem may have been introduced  with the fix for this APAR:&lt;br/&gt;
&lt;a href=&quot;http://www-01.ibm.com/support/docview.wss?uid=swg1IZ75870&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www-01.ibm.com/support/docview.wss?uid=swg1IZ75870&lt;/a&gt;.   &lt;/p&gt;

&lt;p&gt;I will close the issue invalid and file a jvm issue.&lt;/p&gt;</comment>
                            <comment id="13010855" author="kmarsden" created="Thu, 24 Mar 2011 19:18:29 +0000"  >&lt;p&gt;Not a derby issue.&lt;/p&gt;</comment>
                            <comment id="13012274" author="kmarsden" created="Tue, 29 Mar 2011 00:40:20 +0100"  >&lt;p&gt;I attached a reproduction outside of the harness, but have not been able to isolate it outside of Derby.&lt;br/&gt;
To run the reproduction on Linux.&lt;br/&gt;
0) Unzip reproderby5141.zip and cd to the test directory&lt;br/&gt;
1) Change env.sh to match your environment for TESTDIR IBM142FP5 IBM142FP6&lt;br/&gt;
2) . ./env.sh &lt;br/&gt;
    to set up your environment. (I would suggest first starting with JAVA_HOME set to IBM142FP5 to make sure the test case works as small environment issues can cause the same error.)_&lt;br/&gt;
3) Run start.sh &lt;br/&gt;
   With FP5 you will see the expected behavior&lt;br/&gt;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.4.2)&lt;br/&gt;
Classic VM (build 1.4.2, J2RE 1.4.2 IBM build cxia32142ifx-20100705 (SR13 FP5) (&lt;br/&gt;
JIT enabled: jitc))&lt;br/&gt;
  kmarsden@kmarsden-ln2:~/repro/derby-5141&amp;gt; ./start.sh&lt;br/&gt;
Mon Mar 28 16:19:19 PDT 2011 : Security manager installed using the Basic server&lt;br/&gt;
 security policy.&lt;br/&gt;
Mon Mar 28 16:19:20 PDT 2011 : Apache Derby Network Server - 10.8.0.1 alpha - (1&lt;br/&gt;
084778M) started and ready to accept SSL connections on port 1527&lt;/p&gt;

&lt;p&gt;(To stop the server, you can press &amp;lt;ctrl c&amp;gt; or run shutdown.sh from another window after sourcing env.sh&lt;/p&gt;

&lt;p&gt;   With FP6 you will see the error:&lt;br/&gt;
kmarsden@kmarsden-ln2:~/repro/derby-5141&amp;gt; ./start.sh&lt;br/&gt;
Mon Mar 28 16:24:08 PDT 2011 : Security manager installed using the Basic server&lt;br/&gt;
 security policy.&lt;br/&gt;
Mon Mar 28 16:24:09 PDT 2011 : Could not listen on port 1527 on host localhost:&lt;br/&gt;
 java.net.SocketException: Default SSL context init failed: null&lt;br/&gt;
Mon Mar 28 16:24:09 PDT 2011 : DRDA_ListenPort.S:Could not listen on port 1527 o&lt;br/&gt;
n host localhost:&lt;br/&gt;
 java.net.SocketException: Default SSL context init failed: null&lt;br/&gt;
java.lang.Exception: DRDA_ListenPort.S:Could not listen on port 1527 on host loc&lt;br/&gt;
alhost:&lt;br/&gt;
 java.net.SocketException: Default SSL context init failed: null&lt;br/&gt;
        at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMe&lt;br/&gt;
ssageWork(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMe&lt;br/&gt;
ssage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.NetworkServerControlImpl.blockingStart(Unk&lt;br/&gt;
nown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.NetworkServerControlImpl.executeWork(Unkno&lt;br/&gt;
wn Source)&lt;br/&gt;
        at org.apache.derby.drda.NetworkServerControl.main(Unknown Source)&lt;/p&gt;


&lt;p&gt;This problem also occurs with the latest IBM 1.4.2 fixpack SR13 FP8 but may have been introduces with this FP6 APAR which you can view here-&amp;gt;&lt;a href=&quot;http://www-01.ibm.com/support/docview.wss?uid=swg1IZ75870&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www-01.ibm.com/support/docview.wss?uid=swg1IZ75870&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13012328" author="myrna" created="Tue, 29 Mar 2011 04:45:47 +0100"  >&lt;p&gt;I thought this only occurred on linux, but it seems on windows it might be also happening, for I noticed a similar failure with 10.4 (the only environment where our nightly tests run SSLTest with ibm 1.4.2 on windows): for instance, &lt;a href=&quot;http://people.apache.org/~myrnavl/derby_test_results/v10_4/windows/testlog/ibm142/1085632-suites.All_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~myrnavl/derby_test_results/v10_4/windows/testlog/ibm142/1085632-suites.All_diff.txt&lt;/a&gt;. &lt;/p&gt;
</comment>
                            <comment id="13015478" author="kmarsden" created="Mon, 4 Apr 2011 17:09:52 +0100"  >&lt;p&gt;The person working on the issue for the jvm notes the following workaround.&lt;br/&gt;
 If we explicitly add the trustStore and its password in the start.sh file, then the error is not present:&lt;br/&gt;
-Djavax.net.ssl.trustStore=extinout/SSLTestServerKey.key -Djavax.net.ssl.trustStorePassword=qwerty&lt;/p&gt;</comment>
                            <comment id="13017646" author="kmarsden" created="Fri, 8 Apr 2011 22:09:44 +0100"  >&lt;p&gt;I have another workaround for this issue.&lt;br/&gt;
 the problem happens because the certificate &quot;entrustrootcag2&quot;, which is signed by SHA256withRSA algorithm, is added to the default keystore &quot;cacerts&quot; in 1.4.2 JVM. As SHA256withRSA is not supported in 1.4.2, the exception will be thrown when the keystore is initialized.&lt;/p&gt;

&lt;p&gt;If you don&apos;t require this certificate, please delete it from the default cacerts keystore (the default password for cacerts is &quot;changeit&quot;):&lt;/p&gt;

&lt;p&gt;keytool -delete -alias entrustrootcag2 -keystore ./cacerts&lt;/p&gt;

&lt;p&gt;I confirmed derbynet.SSL test passed with this workaround run on jre/lib/security/cacerts&lt;/p&gt;
</comment>
                            <comment id="13019070" author="kmarsden" created="Tue, 12 Apr 2011 22:53:56 +0100"  >&lt;p&gt;Another recommendation on this issue  is to consider switching to IBMJSSE2 since the IBMJSSE provider is deprecated and will not be available in Java 5.0 and above.  I found this bit of information on the topic, but it is not clear to me where we specify the provider, but I will leave it here as a breadcrumb for future generations.  There may also be a tech note published.  For nightly testing I think using the work-around in the previous comment is sufficient.&lt;/p&gt;

&lt;p&gt; &lt;a href=&quot;http://publib.boulder.ibm.com/infocenter/realtime/v1r0/topic/com.ibm.rt.doc.10/security/jsse2/ibmjsse2_differences_ibmjsse.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://publib.boulder.ibm.com/infocenter/realtime/v1r0/topic/com.ibm.rt.doc.10/security/jsse2/ibmjsse2_differences_ibmjsse.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13027806" author="kmarsden" created="Mon, 2 May 2011 20:56:46 +0100"  >&lt;p&gt;A bit more information:&lt;br/&gt;
JSSE is the default implementation for 1.4.2 but you can switch to JSSE2. &lt;br/&gt;
To switch to JSSE2 you need to follow the next steps: &lt;br/&gt;
1. Ensure JSSE2 provider is added and listed just above JSSE in java.security file &lt;br/&gt;
2. Ensure that socketfactory in java.security file are set to use the JSSE2 ones: &lt;br/&gt;
ssl.SocketFactory.provider=com.ibm.jsse2.SSLSocketFactoryImpl &lt;br/&gt;
ssl.ServerSocketFactory.provider=com.ibm.jsse2.SSLServerSocketFactoryImpl &lt;/p&gt;
</comment>
                            <comment id="13685197" author="knutanders" created="Mon, 17 Jun 2013 10:19:19 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12474830" name="reproderby5141.zip" size="3366111" author="kmarsden" created="Tue, 29 Mar 2011 00:38:07 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 24 Mar 2011 19:18:02 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24673</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0gd3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36469</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>