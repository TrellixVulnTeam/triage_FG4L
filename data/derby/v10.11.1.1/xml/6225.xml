<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:14:30 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6225/DERBY-6225.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6225] SecureServerTest assertion error on contents of stdout from subprocess</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6225</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description></description>
                <environment></environment>
        <key id="12648801">DERBY-6225</key>
            <summary>SecureServerTest assertion error on contents of stdout from subprocess</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 May 2013 05:29:19 +0100</created>
                <updated>Tue, 5 Aug 2014 13:33:12 +0100</updated>
                            <resolved>Wed, 3 Jul 2013 20:40:35 +0100</resolved>
                                    <version>10.11.1.1</version>
                                    <fixVersion>10.10.2.0</fixVersion>
                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13663758" author="dagw" created="Wed, 22 May 2013 05:37:43 +0100"  >&lt;p&gt;Cf this output from &lt;a href=&quot;http://download.java.net/javadesktop/derby/javadb-5577046-report/javadb-task-3654391.html:&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://download.java.net/javadesktop/derby/javadb-5577046-report/javadb-task-3654391.html:&lt;/a&gt;&lt;/p&gt;

&lt;p&gt; junit.framework.AssertionFailedError: SecureServerTest( Opened = false, Authenticated= false, CustomDerbyProperties= functionTests/tests/derbynet/SecureServerTest.derby.properties, WildCardHost= null )&lt;br/&gt;
Expected: Security manager installed using the Basic server security policy.&lt;br/&gt;
But saw: &lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.SecureServerTest.testServerStartup(SecureServerTest.java:328)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117)&lt;br/&gt;
        ;&lt;/p&gt;

&lt;p&gt;so the stdout is empty, but we expect to see the server report that the basic server security policy has been installed.  I suspect this can be a race condition. In the source for the test I see these lines:&lt;/p&gt;

&lt;p&gt;    String      serverOutput = getServerOutput();  &lt;br/&gt;
    boolean     serverCameUp = serverCameUp();&lt;br/&gt;
    boolean     outputOK = ( serverOutput.indexOf( _outcome.expectedServerOutput() ) &amp;gt;= 0 );&lt;/p&gt;

&lt;p&gt;    assertEquals( myName + &quot;: serverCameUp = &quot; + serverCameUp, &lt;br/&gt;
                  _outcome.serverShouldComeUp(), serverCameUp );&lt;/p&gt;

&lt;p&gt;    if (!(runsWithEmma() || runsWithJaCoCo())) {&lt;br/&gt;
        // With Emma we run without the security manager, so we can&apos;t&lt;br/&gt;
        // assert on seeing it.&lt;br/&gt;
        assertTrue( myName + &quot;\nExpected: &quot; +&lt;br/&gt;
                    _outcome.expectedServerOutput() +&lt;br/&gt;
                    &quot;\nBut saw: &quot; + serverOutput , outputOK );&lt;/p&gt;

&lt;p&gt;We assert against the variable serverOutput which is collected &lt;b&gt;before&lt;/b&gt; the call to serverCameUp. The latter has a ping/wait loop to wait for a slow server startup.  It seems to be it would be safer to collect the server output &lt;b&gt;after&lt;/b&gt; we check that has indeed been started.&lt;/p&gt;
</comment>
                            <comment id="13663781" author="dagw" created="Wed, 22 May 2013 06:06:02 +0100"  >&lt;p&gt;Attaching a small patch to change the order to avoid the race.  FWIW, the test worked for me with the changed order.&lt;/p&gt;</comment>
                            <comment id="13663817" author="knutanders" created="Wed, 22 May 2013 07:05:15 +0100"  >&lt;p&gt;The proposed change looks like an improvement, so +1.&lt;/p&gt;</comment>
                            <comment id="13666019" author="dagw" created="Fri, 24 May 2013 06:53:29 +0100"  >&lt;p&gt;Committed at svn 1485936, resolving.&lt;/p&gt;
</comment>
                            <comment id="13699215" author="kmarsden" created="Wed, 3 Jul 2013 18:28:02 +0100"  >&lt;p&gt;reopen for backport. Assigning to myself temporarily&lt;/p&gt;</comment>
                            <comment id="13699359" author="jira-bot" created="Wed, 3 Jul 2013 20:39:35 +0100"  >&lt;p&gt;Commit 1499537 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kmarsden&quot; class=&quot;user-hover&quot; rel=&quot;kmarsden&quot;&gt;Kathey Marsden&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1499537&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1499537&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6225&quot; title=&quot;SecureServerTest assertion error on contents of stdout from subprocess&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6225&quot;&gt;&lt;del&gt;DERBY-6225&lt;/del&gt;&lt;/a&gt; SecureServerTest assertion error on contents of stdout from subprocess&lt;br/&gt;
merge revision 1485936 from trunk&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12732006">DERBY-6686</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12584238" name="derby-6225.diff" size="937" author="dagw" created="Wed, 22 May 2013 06:06:02 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 22 May 2013 06:05:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>329131</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzemmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>329471</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>