<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:45:54 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4910/DERBY-4910.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4910] Four replication tests fail on z/OS with junit.framework.AssertionFailedError: startMaster did not succeed.     </title>
                <link>https://issues.apache.org/jira/browse/DERBY-4910</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Four replication tests failed with junit.framework.AssertionFailedError: startMaster did not succeed. running on the 64bit JVM on z/OS:&lt;br/&gt;
ReplicationRun_Local_3_p2               ReplicationRun_Local_StateTest_part1&lt;br/&gt;
ReplicationRun_Local_3_p3               ReplicationRun_Local_StateTest_part1_2&lt;/p&gt;


&lt;p&gt;Below are the stack traces. I will attach the fail directory.&lt;/p&gt;

&lt;p&gt;There were 4 failures:&lt;br/&gt;
1) testReplication_Local_StateTest_part1(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1)junit.framework.AssertionFailedError: startMaster did not succeed.&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster_direct(ReplicationRun.java:1072)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster(ReplicationRun.java:906)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1._testPreStartedMaster(ReplicationRun_Local_StateTest_part1.java:375)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1.testReplication_Local_StateTest_part1(ReplicationRun_Local_StateTest_part1.java:136)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:48)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:207)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:16)&lt;br/&gt;
2) testReplication_Local_StateTest_part1_2(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_2)junit.framework.AssertionFailedError: startMaster did not succeed.&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster_direct(ReplicationRun.java:1072)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster(ReplicationRun.java:906)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_2.testReplication_Local_StateTest_part1_2(ReplicationRun_Local_StateTest_part1_2.java:128)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:48)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:207)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:16)&lt;br/&gt;
3) testReplication_Local_3_p2_StateTests_bigInsert_sleepBeforeStopMaster(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p2)junit.framework.AssertionFailedError: startMaster did not succeed.&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster_direct(ReplicationRun.java:1072)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster(ReplicationRun.java:906)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p2.replication_Local_3_p2_StateTests(ReplicationRun_Local_3_p2.java:128)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p2.testReplication_Local_3_p2_StateTests_bigInsert_sleepBeforeStopMaster(ReplicationRun_Local_3_p2.java:248)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:48)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:207)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:16)&lt;br/&gt;
4) testReplication_Local_3_p3_StateNegativeTests(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p3)junit.framework.AssertionFailedError: startMaster did not succeed.&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster_direct(ReplicationRun.java:1072)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster(ReplicationRun.java:906)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p3.testReplication_Local_3_p3_StateNegativeTests(ReplicationRun_Local_3_p3.java:128)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:48)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:207)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:16)&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;br/&gt;
Tests run: 13032,  Failures: 4,  Errors: 0&lt;/p&gt;



</description>
                <environment>z/OS&lt;br/&gt;
java version &amp;quot;1.6.0&amp;quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build pmz6460sr8fp1-20100624_01(SR8 FP1))&lt;br/&gt;
IBM J9 VM (build 2.4, JRE 1.6.0 IBM J9 2.4 z/OS s390x-64 jvmmz6460sr8ifx-2010060&lt;br/&gt;
9_59383 (JIT enabled, AOT enabled)&lt;br/&gt;
J9VM - 20100609_059383&lt;br/&gt;
JIT  - r9_20100401_15339ifx2&lt;br/&gt;
GC   - 20100308_AA)&lt;br/&gt;
JCL  - 20100624_01&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
10.7 release candidate 1.10.7.1.0 - (1035301)&lt;br/&gt;
</environment>
        <key id="12480623">DERBY-4910</key>
            <summary>Four replication tests fail on z/OS with junit.framework.AssertionFailedError: startMaster did not succeed.     </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                            <label>derby_backport_reject_10_5</label>
                    </labels>
                <created>Mon, 22 Nov 2010 23:49:24 +0000</created>
                <updated>Fri, 15 Nov 2013 08:15:13 +0000</updated>
                            <resolved>Mon, 11 Apr 2011 11:00:40 +0100</resolved>
                                    <version>10.7.1.1</version>
                                    <fixVersion>10.7.1.4</fixVersion>
                    <fixVersion>10.8.1.2</fixVersion>
                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12965758" author="knutanders" created="Wed, 1 Dec 2010 17:40:07 +0000"  >&lt;p&gt;I saw one of these failures again with the 10.7.1.1 release candidate on Solaris Express 11, JDK 7 (1.7.0-ea-b119):&lt;/p&gt;

&lt;p&gt;testReplication_Local_3_p2_StateTests_bigInsert_immediateStopMaster(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p2) FAILURE:&lt;br/&gt;
junit.framework.AssertionFailedError: startMaster did not succeed.&lt;br/&gt;
        at junit.framework.Assert.fail(Assert.java:47)&lt;br/&gt;
        at junit.framework.Assert.assertTrue(Assert.java:20)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster_direct(ReplicationRun.java:1072)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster(ReplicationRun.java:906)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p2.replication_Local_3_p2_StateTests(ReplicationRun_Local_3_p2.java:128)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p2.testReplication_Local_3_p2_StateTests_bigInsert_immediateStopMaster(ReplicationRun_Local_3_p2.java:233)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:613)&lt;br/&gt;
        at junit.framework.TestCase.runTest(TestCase.java:164)&lt;br/&gt;
        at junit.framework.TestCase.runBare(TestCase.java:130)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:207)&lt;/p&gt;</comment>
                            <comment id="12969540" author="knutanders" created="Wed, 8 Dec 2010 22:47:49 +0000"  >&lt;p&gt;The attached patch makes the replication tests preserve stack traces of the underlying errors, so that we can hopefully see more of what&apos;s going on the next time they fail.&lt;/p&gt;

&lt;p&gt;Committed revision 1043748.&lt;/p&gt;</comment>
                            <comment id="13017123" author="knutanders" created="Thu, 7 Apr 2011 21:20:07 +0100"  >&lt;p&gt;Saw this again with Derby 10.8.1.0 on FreeBSD 8.2, OpenJDK 6 (b20). After the patch that preserved the underlying exceptions, the stack trace now looks like this:&lt;/p&gt;

&lt;p&gt;junit.framework.AssertionFailedError: startMaster did not succeed&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.fail(BaseTestCase.java:771)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster_direct(ReplicationRun.java:1062)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster(ReplicationRun.java:911)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_2.testReplication_Local_StateTest_part1_2(ReplicationRun_Local_StateTest_part1_2.java:128)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:207)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
Caused by: java.sql.SQLException: DERBY SQL error: SQLCODE: -1, SQLSTATE: XRE04, SQLERRMC: Could not establish a connection to the peer of the replicated database &apos;/var/hudson/workspace/Derby-10.8.1.0-FreeBSD-openjdk6-junit/tst/db_master/wombat&apos; on address &apos;localhost:1533&apos;.&lt;br/&gt;
	at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.am.SqlException.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.jdbc.ClientDataSource.getConnection(Unknown Source)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster_direct(ReplicationRun.java:1042)&lt;br/&gt;
Caused by: org.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: -1, SQLSTATE: XRE04, SQLERRMC: Could not establish a connection to the peer of the replicated database &apos;/var/hudson/workspace/Derby-10.8.1.0-FreeBSD-openjdk6-junit/tst/db_master/wombat&apos; on address &apos;localhost:1533&apos;.&lt;br/&gt;
	at org.apache.derby.client.am.Connection.completeSqlca(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseRdbAccessFailed(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseAccessRdbError(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseACCRDBreply(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.readAccessDatabase(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.readSecurityCheckAndAccessRdb(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowSecurityCheckAndAccessRdb(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowUSRIDONLconnect(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowConnect(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.initialize(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection40.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.ClientJDBCObjectFactoryImpl40.newNetConnection(Unknown Source)&lt;br/&gt;
	at org.apache.derby.jdbc.ClientDataSource.getConnectionX(Unknown Source)&lt;/p&gt;</comment>
                            <comment id="13017331" author="knutanders" created="Fri, 8 Apr 2011 08:47:20 +0100"  >&lt;p&gt;I think I see what&apos;s going on. derby.log for the slave showed the following exception had been raised:&lt;/p&gt;

&lt;p&gt;java.net.SocketTimeoutException: Accept timed out&lt;br/&gt;
	at java.net.PlainSocketImpl.socketAccept(Native Method)&lt;br/&gt;
	at java.net.AbstractPlainSocketImpl.accept(AbstractPlainSocketImpl.java:358)&lt;br/&gt;
	at java.net.ServerSocket.implAccept(ServerSocket.java:470)&lt;br/&gt;
	at java.net.ServerSocket.accept(ServerSocket.java:438)&lt;br/&gt;
	at org.apache.derby.impl.store.replication.net.ReplicationMessageReceive$1.run(Unknown Source)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
	at org.apache.derby.impl.store.replication.net.ReplicationMessageReceive.initConnection(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.replication.slave.SlaveController.setupConnection(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.replication.slave.SlaveController.startSlave(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.RawStore.boot(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.bootModule(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(Unknown Source)&lt;br/&gt;
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.access.RAMAccessManager.boot(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.boot(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.bootModule(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(Unknown Source)&lt;br/&gt;
	at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.bootStore(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.boot(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.bootBasicDatabase(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.access$000(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase$SlaveDatabaseBootThread.run(Unknown Source)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:636)&lt;/p&gt;

&lt;p&gt;The timeout for the accept call is 1 second, but the code is prepared to handle timeouts in SlaveController.setupConnection():&lt;/p&gt;

&lt;p&gt;        } catch (Exception e) {&lt;br/&gt;
            // SocketTimeoutException is wrapped in&lt;br/&gt;
            // PrivilegedActionException.&lt;br/&gt;
            Throwable cause = e.getCause();&lt;br/&gt;
            if (cause instanceof SocketTimeoutException) &lt;/p&gt;
{
                // Timeout! 
                return false;
            }
&lt;p&gt; else &lt;/p&gt;
{
                throw StandardException.newException
                    (SQLState.REPLICATION_CONNECTION_EXCEPTION, e,
                    dbname, getHostName(), String.valueOf(getPortNumber()));
            }
&lt;p&gt;        }&lt;/p&gt;

&lt;p&gt;The timeout-handling code assumes that the timeout exception is wrapped in a PrivilegedActionException. However, &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4812&quot; title=&quot;ReplicationMessageTransmit run does not unwrap PrivilegedActionException which can lead to failure of replicationTests.ReplicationRun_Local_StateTest_part1_1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4812&quot;&gt;&lt;del&gt;DERBY-4812&lt;/del&gt;&lt;/a&gt; changed this by unwrapping the PrivilegedActionException in ReplicationMessageReceive.initConnection().&lt;/p&gt;</comment>
                            <comment id="13017335" author="knutanders" created="Fri, 8 Apr 2011 08:56:35 +0100"  >&lt;p&gt;Marking this as a regression. To reproduce the bug, perform the following steps in ij with Derby 10.7.1.1 or later:&lt;/p&gt;

&lt;p&gt;ij version 10.7&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby:db;create=true&apos;;&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby:db;shutdown=true&apos;;&lt;br/&gt;
ERROR 08006: Database &apos;db&apos; shutdown.&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby:db;startSlave=true&apos;;&lt;br/&gt;
ERROR XJ040: Failed to start database &apos;db&apos; with class loader sun.misc.Launcher$AppClassLoader@360be0, see the next exception for details.&lt;br/&gt;
ERROR XRE04: Could not establish a connection to the peer of the replicated database &apos;db&apos; on address &apos;localhost:4851&apos;.&lt;br/&gt;
ij&amp;gt; &lt;/p&gt;

&lt;p&gt;The startSlave command fails after one second. When doing the same in Derby 10.6.2.1, startSlave will hang until the master is started.&lt;/p&gt;

&lt;p&gt;This sounds like a serious problem. It essentially gives startMaster a one second window to start after the slave has been started, which may be very hard to code reliably, especially when the master and the slave run on different hosts.&lt;/p&gt;</comment>
                            <comment id="13017336" author="knutanders" created="Fri, 8 Apr 2011 09:06:21 +0100"  >&lt;p&gt;The attached patch changes the logic in the timeout handling to account for the changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4812&quot; title=&quot;ReplicationMessageTransmit run does not unwrap PrivilegedActionException which can lead to failure of replicationTests.ReplicationRun_Local_StateTest_part1_1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4812&quot;&gt;&lt;del&gt;DERBY-4812&lt;/del&gt;&lt;/a&gt;. This makes startSlave behave as it did in 10.6.2.1 and earlier again (it waits until the master is started, even if it takes more than one second.)&lt;/p&gt;

&lt;p&gt;I&apos;ll see if I can write a test that exposes the problem.&lt;/p&gt;</comment>
                            <comment id="13018076" author="knutanders" created="Sun, 10 Apr 2011 14:20:18 +0100"  >&lt;p&gt;I ran the regression tests on the catch.diff patch and saw one failure in suites.All. The failure was in one of the replication tests, which is a bit suspicious, but its stack trace looks like the one in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4269&quot; title=&quot;Failover did not succeed in 2 min.: testReplication_Local_3_p6_autocommit_OK&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4269&quot;&gt;&lt;del&gt;DERBY-4269&lt;/del&gt;&lt;/a&gt;, so I believe it&apos;s unrelated to the patch. I&apos;ve also rerun suites.All twice without seeing any failures.&lt;/p&gt;

&lt;p&gt;Attaching a new patch (derby-4910-1a.diff) which adds a test case. The test case was created by copying the existing test case ReplicationRun_Local_1 and adding a sleep() call to it. Before the patch can be applied, the following svn command must be run:&lt;/p&gt;

&lt;p&gt;svn copy java/testing/org/apache/derbyTesting/functionTests/tests/replicationTests/ReplicationRun_Local_1.java java/testing/org/apache/derbyTesting/functionTests/tests/replicationTests/ReplicationRun_Local_Derby4910.java&lt;/p&gt;

&lt;p&gt;The new test case fails without the fix in SlaveController, and passes with the fix.&lt;/p&gt;</comment>
                            <comment id="13018264" author="knutanders" created="Mon, 11 Apr 2011 11:00:40 +0100"  >&lt;p&gt;Committed revision 1091000.&lt;/p&gt;</comment>
                            <comment id="13018281" author="knutanders" created="Mon, 11 Apr 2011 12:07:16 +0100"  >&lt;p&gt;Merged to 10.8 with revision 1091004.&lt;/p&gt;</comment>
                            <comment id="13018363" author="knutanders" created="Mon, 11 Apr 2011 15:15:21 +0100"  >&lt;p&gt;Merged to 10.7 with revision 1091081.&lt;/p&gt;</comment>
                            <comment id="13018576" author="kmarsden" created="Mon, 11 Apr 2011 22:24:17 +0100"  >&lt;p&gt;Thank you Knut for tracking this issue down and fixing it and for the test!  I think I have become too accustomed to ignoring the noise in replication tests and didn&apos;t make the connection with &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4812&quot; title=&quot;ReplicationMessageTransmit run does not unwrap PrivilegedActionException which can lead to failure of replicationTests.ReplicationRun_Local_StateTest_part1_1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4812&quot;&gt;&lt;del&gt;DERBY-4812&lt;/del&gt;&lt;/a&gt; when this showed up a couple months later on z/OS.  It is good now to have a solid deterministic test for the expected behavior.&lt;/p&gt;


</comment>
                            <comment id="13823428" author="knutanders" created="Fri, 15 Nov 2013 08:15:13 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update: close all resolved issues that haven&amp;#39;t had any activity the last year&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12474876">DERBY-4812</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12475799" name="catch.diff" size="1251" author="knutanders" created="Fri, 8 Apr 2011 09:06:21 +0100"/>
                            <attachment id="12475931" name="derby-4910-1a.diff" size="4862" author="knutanders" created="Sun, 10 Apr 2011 14:20:18 +0100"/>
                            <attachment id="12475932" name="derby-4910-1a.stat" size="309" author="knutanders" created="Sun, 10 Apr 2011 14:20:18 +0100"/>
                            <attachment id="12460213" name="fail.zip" size="3564899" author="kmarsden" created="Mon, 22 Nov 2010 23:51:34 +0000"/>
                            <attachment id="12465851" name="traces.diff" size="5898" author="knutanders" created="Wed, 8 Dec 2010 22:47:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 1 Dec 2010 17:40:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24525</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0a4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35458</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>