<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:47:13 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3156/DERBY-3156.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3156] Convert testing of derby error stream to JUnit</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3156</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Convert the tests that are related to derby error stream properties and functionality.&lt;/p&gt;

&lt;p&gt;Seems to be these two tests:&lt;br/&gt;
lang/logStream.java &lt;br/&gt;
lang/errorStream.java&lt;/p&gt;</description>
                <environment></environment>
        <key id="12381357">DERBY-3156</key>
            <summary>Convert testing of derby error stream to JUnit</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vemund">Vemund &#216;stgaard</assignee>
                                    <reporter username="vemund">Vemund &#216;stgaard</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Oct 2007 08:15:38 +0000</created>
                <updated>Wed, 1 Jul 2009 00:40:20 +0100</updated>
                            <resolved>Mon, 19 Nov 2007 12:58:13 +0000</resolved>
                                                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12539611" author="vemund" created="Fri, 2 Nov 2007 15:16:56 +0000"  >&lt;p&gt;This patch removes the old lang/errorStream.java and lang/logStream.java tests from derbylang.runall, so they will no longer be run as part of the old harness testing. I have not removed the test code.&lt;/p&gt;

&lt;p&gt;A new test, ErrorStreamTest, is added that runs in the JUnit framework. &lt;br/&gt;
Feeling that this test didn&apos;t really belong in the &quot;lang&quot; suite in the first place, I&apos;ve created a new suite named &quot;engine&quot; for this test and added this suite to the AllPackages suite that is run as part of suites.All. I don&apos;t have any strong feelings about where the test really belongs, but from my limited knowledge of the testing this seemed to make most sense.&lt;/p&gt;

&lt;p&gt;The new test runs only in the embedded environment. When I ran it in a networkServer environment it failed with a problem that I logged as a new Jira &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3170&quot; title=&quot;Connecting through network server after engine has been stopped causes NullPointerException on the server side&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3170&quot;&gt;DERBY-3170&lt;/a&gt;. I don&apos;t think the bug will have a high priority so I&apos;ve submitted this version of the test running only in the embedded environment so it will not fail.&lt;/p&gt;</comment>
                            <comment id="12539621" author="djd" created="Fri, 2 Nov 2007 15:44:16 +0000"  >&lt;p&gt;The test contains a number of static fields, do they all need to be static? Static fields will lead to problems and are not typical in JUnit tests, each test fixture(testXXX method)   is an unique instance of a class so either instance fields should be used or even better just pass the information around. E.g. the setUp method will be called for every fixture, so there&apos;s no real benefit to storing information in fields since they will not be shared across fixtures.&lt;/p&gt;

&lt;p&gt;Can you comment the reason the test doesn&apos;t run with a security manager.&lt;/p&gt;</comment>
                            <comment id="12540188" author="vemund" created="Mon, 5 Nov 2007 12:59:37 +0000"  >&lt;p&gt;Thank you for looking at the patch, Dan.&lt;/p&gt;

&lt;p&gt;I&apos;ve now uploaded a new patch (3156-diffv2) with the following changes, based on the comments:&lt;/p&gt;

&lt;p&gt;I looked at the use of static fields. A few fields have to be static for the test to work (code accessed by Derby in a static context), but there shouldn&apos;t be any static fields now that don&apos;t have to be.&lt;/p&gt;

&lt;p&gt;I had postponed making the test work with a security manager, and forgot about it when I submitted the patch on Friday. I&apos;ve looked at it now and believe I have it working with the security manager the way it should. &lt;/p&gt;

&lt;p&gt;I added 10 different wrapper-methods for the doPrivileged stuff related to accessing files and redirecting System.err. I guess some of these might be useful enough to move to BaseTestCase for reuse in other tests, but I left them in ErrorStreamTest for the time being.&lt;/p&gt;</comment>
                            <comment id="12540205" author="knutanders" created="Mon, 5 Nov 2007 15:42:03 +0000"  >&lt;p&gt;Hi Vemund,&lt;/p&gt;

&lt;p&gt;The patch generally looks good. A couple of comments/questions:&lt;/p&gt;

&lt;p&gt;1) Do the original tests run with the client driver? It seems to me they don&apos;t, so I think it&apos;s okay to run the new test only in embedded mode.&lt;/p&gt;

&lt;p&gt;2) I think it would be good to null out the fields when the test has completed (in tearDown()) so that the objects they reference can be garbage collected.&lt;/p&gt;

&lt;p&gt;3) Instead of using File.deleteOnExit(), perhaps it&apos;s cleaner to delete the files explicitly in tearDown()? Seems that it would also remove the need for the runNo field.&lt;/p&gt;

&lt;p&gt;4) I&apos;m wondering if this code&lt;/p&gt;

&lt;p&gt;+              new File(getSystemProperty(&quot;derby.system.home&quot;) +&quot;foo&quot;, &lt;br/&gt;
+              makeStreamFilename(&quot;file&quot;)).getCanonicalPath()); // erroneous path&lt;/p&gt;

&lt;p&gt;would be more robust if it was written as&lt;/p&gt;

&lt;p&gt;    new File(new File(getSystemProperty(&quot;derby.system.home&quot;), &quot;foo&quot;), ...)&lt;/p&gt;

&lt;p&gt;As it is now, I think it depends on derby.system.home ending with the path separator character.&lt;/p&gt;</comment>
                            <comment id="12540450" author="vemund" created="Tue, 6 Nov 2007 15:05:55 +0000"  >&lt;p&gt;Thank you for the comments Knut, I&apos;ve uploaded a v3 of the patch that addresses your comments as follows:&lt;/p&gt;

&lt;p&gt;1. I don&apos;t think it has run with the client driver before, it would have failed with the same bug that I hit.&lt;/p&gt;

&lt;p&gt;2. The fields are now nulled out in tearDown().&lt;/p&gt;

&lt;p&gt;3. The files are now deleted directly in tearDown(). I haven&apos;t removed the use of the runNo field, somehow it gives me a warm feeling knowing that the filenames used are unique, so that the chance of one of the tests passing by accident is less (The correct setting for the property carries over from a previous execution or the file wasn&apos;t deleted and was accidentally there with the correct name, etc.). So, I&apos;ve left the use of the runNo field as it was.&lt;/p&gt;

&lt;p&gt;4. I&apos;ve changed the code as you suggest, I agree it is more predictable. &lt;/p&gt;
</comment>
                            <comment id="12540756" author="knutanders" created="Wed, 7 Nov 2007 14:31:57 +0000"  >&lt;p&gt;Thanks for updating the patch, Vemund.&lt;/p&gt;

&lt;p&gt;I tried to run the test standalone, but then all test cases failed with errors like this one:&lt;/p&gt;

&lt;p&gt;1) testDefault(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)java.io.FileNotFoundException: /tmp/derbytst/system&lt;br/&gt;
/method-1.log (No such file or directory)&lt;br/&gt;
        at java.io.FileOutputStream.open(Native Method)&lt;br/&gt;
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:179)&lt;br/&gt;
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:131)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest$9.run(ErrorStreamTest.java:502)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest.newFileOutputStream(ErrorStreamTest.java:499)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest.openStreams(ErrorStreamTest.java:360)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest.setUp(ErrorStreamTest.java:100)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95)&lt;/p&gt;

&lt;p&gt;If I first run another test and don&apos;t delete the &apos;system&apos; directory, it works fine. Seems like openStreams() requires that the database directory exists.&lt;/p&gt;

&lt;p&gt;nits:&lt;/p&gt;

&lt;p&gt;The method deleteFileOnExit() is now unused and can be deleted.&lt;/p&gt;

&lt;p&gt;Perhaps the assert methods that throw IOException would have been simpler if they had thrown Exception instead? Then we could skip the try/catch+cast. The PrivilegedActionException will be linked to the IOException, so we will still get the stack trace, and if someone changes the code so that we can get other exceptions than IOException, we get the original exception instead of a ClassCastException.&lt;/p&gt;</comment>
                            <comment id="12540779" author="vemund" created="Wed, 7 Nov 2007 16:14:33 +0000"  >&lt;p&gt;Thanks again Knut, made a new patch and hope it works better now. It had worked standalone until I made the last change in the previous patch, of course... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Also removed the deleteFileOnExit() method.&lt;/p&gt;

&lt;p&gt;About the IOExceptions I&apos;m not really sure. This:&lt;/p&gt;

&lt;p&gt;public Object run() throws IOException { &lt;/p&gt;

&lt;p&gt;will not compile if the code in run() suddenly starts throwing other exceptions, so we shouldn&apos;t be getting any ClassCastException from the catch() all of a sudden. If it did change to throw other exceptions you might want these assertmethods to throw both exceptions without any wrapping to make it possible to make different choices easily. I also think the methods are more useful when they wrap away the uninteresting PrivilegedActionException for you.&lt;/p&gt;</comment>
                            <comment id="12541797" author="knutanders" created="Mon, 12 Nov 2007 15:09:28 +0000"  >&lt;p&gt;Thanks Vemund! I have committed your patch to trunk (revision 594169). Should we also remove the old tests before we close the issue?&lt;/p&gt;</comment>
                            <comment id="12542060" author="knutanders" created="Tue, 13 Nov 2007 08:15:41 +0000"  >&lt;p&gt;Seems like this caused an AccessControlException on Windows. Please take a look at &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3202&quot; title=&quot;&amp;#39;AccessControlException: access denied (java.io.FilePermission C:\....\file-2.log read)&amp;#39; in ErrorStreamTest.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3202&quot;&gt;&lt;del&gt;DERBY-3202&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12542763" author="vemund" created="Thu, 15 Nov 2007 12:52:58 +0000"  >&lt;p&gt;Added a patch 3156-remove-old-tests-diff that removes the files for the old tests that is no longer in use: &lt;br/&gt;
errorStream.java&lt;br/&gt;
errorStream.policy&lt;br/&gt;
errorStream_app.properties&lt;br/&gt;
logStream.java&lt;br/&gt;
logStream_app.properties&lt;/p&gt;</comment>
                            <comment id="12543547" author="knutanders" created="Mon, 19 Nov 2007 12:58:13 +0000"  >&lt;p&gt;Thanks Vemund. Committed revision 596285.&lt;/p&gt;

&lt;p&gt;I also removed lang/errorStream.java from DerbyNet.exclude and DerbyNetClient.exclude.&lt;/p&gt;</comment>
                            <comment id="12543977" author="mikem" created="Tue, 20 Nov 2007 18:12:33 +0000"  >&lt;p&gt;I am seeing junit failures in this test when run on j9 - see &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3217&quot; title=&quot;ErrorStreamTest failing on ibm j9 jvm&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3217&quot;&gt;&lt;del&gt;DERBY-3217&lt;/del&gt;&lt;/a&gt;.  Unfortunately the machine running these&lt;br/&gt;
tests had a number of problems so I don&apos;t know exactly when the issue started, but it has been happening at least &lt;br/&gt;
since 11/12/2007.&lt;/p&gt;</comment>
                            <comment id="12544495" author="knutanders" created="Wed, 21 Nov 2007 15:18:57 +0000"  >&lt;p&gt;Could we also remove the canons now? (errorStream.out and logStream.out)&lt;/p&gt;</comment>
                            <comment id="12544746" author="knutanders" created="Thu, 22 Nov 2007 09:46:45 +0000"  >&lt;p&gt;Removed errorStream.out and logStream.out and committed revision 597356.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12382405">DERBY-3202</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12368882" name="3156-diff" size="25576" author="vemund" created="Fri, 2 Nov 2007 15:16:56 +0000"/>
                            <attachment id="12368881" name="3156-diff.stat" size="538" author="vemund" created="Fri, 2 Nov 2007 15:16:56 +0000"/>
                            <attachment id="12368974" name="3156-diffv2" size="29629" author="vemund" created="Mon, 5 Nov 2007 12:59:36 +0000"/>
                            <attachment id="12368975" name="3156-diffv2.stat" size="538" author="vemund" created="Mon, 5 Nov 2007 12:59:37 +0000"/>
                            <attachment id="12369029" name="3156-diffv3" size="29431" author="vemund" created="Tue, 6 Nov 2007 15:05:54 +0000"/>
                            <attachment id="12369030" name="3156-diffv3.stat" size="538" author="vemund" created="Tue, 6 Nov 2007 15:05:54 +0000"/>
                            <attachment id="12369111" name="3156-diffv4" size="29592" author="vemund" created="Wed, 7 Nov 2007 16:14:33 +0000"/>
                            <attachment id="12369112" name="3156-diffv4.stat" size="538" author="vemund" created="Wed, 7 Nov 2007 16:14:33 +0000"/>
                            <attachment id="12369592" name="3156-remove-old-tests-diff" size="23064" author="vemund" created="Thu, 15 Nov 2007 12:52:57 +0000"/>
                            <attachment id="12369593" name="3156-remove-old-tests-diff.stat" size="448" author="vemund" created="Thu, 15 Nov 2007 12:52:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 2 Nov 2007 15:44:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30746</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0u47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38697</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>