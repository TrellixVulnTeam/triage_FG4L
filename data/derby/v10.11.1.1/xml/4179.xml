<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:19:47 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4179/DERBY-4179.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4179] bootLock.java fails with missing exception on z/OS with  pmz3160sr2ifix-20081021_01(SR2+IZ32776+IZ33456), and Windows Vista</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4179</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I saw this diff in store/bootLock.java. I did not see it with the 64bit jvm run on 10.5.1.0 RC1&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;Start: bootLock jdk1.6.0 storeall:storemore 2009-04-21 19:10:18 ***&lt;br/&gt;
2,4d1&lt;br/&gt;
&amp;lt; expected exception&lt;br/&gt;
&amp;lt; SQLSTATE(XJ040):&lt;br/&gt;
&amp;lt; SQLSTATE(XSDB6):&lt;br/&gt;
Test Failed.&lt;/li&gt;
			&lt;li&gt;End:   bootLock jdk1.6.0 storeall:storemore 2009-04-21 19:11:00 ***&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The test passed on rerun when run independently.&lt;/p&gt;</description>
                <environment>java version &amp;quot;1.6.0&amp;quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build pmz3160sr2ifix-20081021_01(SR2+IZ32776+IZ33456))&lt;br/&gt;
IBM J9 VM (build 2.4, J2RE 1.6.0 IBM J9 2.4 z/OS s390-31 jvmmz3160ifx-20081010_24288 (JIT enabled, AOT enabled)&lt;br/&gt;
J9VM - 20081009_024288_bHdSMr&lt;br/&gt;
JIT  - r9_20080721_1330ifx2&lt;br/&gt;
GC   - 20080724_AA)&lt;br/&gt;
JCL  - 20080808_02&lt;br/&gt;
------------------------------------------&lt;br/&gt;
Also seen on : Vista Ultimate 32 bits under cygwin with Sun JRE 1.6.0_07-b06</environment>
        <key id="12423486">DERBY-4179</key>
            <summary>bootLock.java fails with missing exception on z/OS with  pmz3160sr2ifix-20081021_01(SR2+IZ32776+IZ33456), and Windows Vista</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Apr 2009 17:07:55 +0100</created>
                <updated>Wed, 12 Jan 2011 22:24:25 +0000</updated>
                            <resolved>Sat, 8 May 2010 01:44:03 +0100</resolved>
                                    <version>10.5.1.1</version>
                                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.2.1</fixVersion>
                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>Store</component>
                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12705182" author="kmarsden" created="Sat, 2 May 2009 00:30:33 +0100"  >&lt;p&gt;This happened just once and with an older version of the JVM, so I think we won&apos;t fix it unless it comes up again.&lt;/p&gt;</comment>
                            <comment id="12777978" author="knutanders" created="Sat, 14 Nov 2009 18:02:28 +0000"  >&lt;p&gt;This has happened again on a different JVM, so I&apos;m reopening the issue. See comment by Sylvain Leroux on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4430&quot; title=&quot;Make ij&amp;#39;s SHOW and DESCRIBE commands more db agnostic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4430&quot;&gt;&lt;del&gt;DERBY-4430&lt;/del&gt;&lt;/a&gt;, 14/Nov/09 12:18 PM.&lt;/p&gt;</comment>
                            <comment id="12778088" author="sleroux" created="Sun, 15 Nov 2009 12:07:11 +0000"  >&lt;p&gt;As a reference, I attach the corresponding *_report.txt. I&apos;m running on Debien/Lenny with a custom kernel.&lt;/p&gt;

&lt;p&gt;The problem appears to be reproducible on my specific environment.&lt;/p&gt;</comment>
                            <comment id="12863149" author="dagw" created="Sun, 2 May 2010 16:52:38 +0100"  >&lt;p&gt;I also saw this now on the db-derby-10.6.1.0 RC1 (insane) on Windows Vista (32 bits), Sun JDK 1.6.0_07-b06 running under Cygwin. It is reproducable&lt;br/&gt;
in my enviroment also when run alone (sane and insane jars).&lt;/p&gt;</comment>
                            <comment id="12863167" author="dagw" created="Sun, 2 May 2010 18:58:24 +0100"  >&lt;p&gt;I ran the test on trunk (svn 939730) with both classes and sane jars, otherwise same environment (I think!), but could not reproduce the error there. Hmm.&lt;/p&gt;</comment>
                            <comment id="12863173" author="dagw" created="Sun, 2 May 2010 19:19:10 +0100"  >&lt;p&gt;Attaching sysinfo.txt for the case which fails. I tried to use the same classpath but with absolute jar paths, but then I didn&apos;t see the error. That could be a red herring of course; I&apos;ll try to narrow it down a bit.&lt;/p&gt;</comment>
                            <comment id="12863186" author="dagw" created="Sun, 2 May 2010 20:21:15 +0100"  >&lt;p&gt;Using this (relative) minimal classpath I was able to reproduce on trunk/cygwin;&lt;/p&gt;

&lt;p&gt;&amp;gt;echo $CLASSPATH&lt;br/&gt;
./jars/sane/derby.jar;./jars/sane/derbytools.jar;./jars/sane/derbyTesting.jar;./tools/java/jakarta-oro-2.0.8.jar;./tools/java/junit.jar&lt;/p&gt;

&lt;p&gt;&amp;gt;java org.apache.derbyTesting.functionTests.harness.RunTest store/bootLock.java&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;Start: bootLock jdk1.6.0_07 2010-05-02 21:13:49 ***&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;SecurityManager not installed &amp;#8211;&lt;br/&gt;
2,4d1&lt;br/&gt;
&amp;lt; expected exception&lt;br/&gt;
&amp;lt; SQLSTATE(XJ040): &lt;br/&gt;
&amp;lt; SQLSTATE(XSDB6): &lt;br/&gt;
Test Failed.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Making the CLASSPATH consist of absolute jar references makes the problem go away. &lt;/p&gt;</comment>
                            <comment id="12863190" author="dagw" created="Sun, 2 May 2010 21:02:04 +0100"  >&lt;p&gt;Testing relative jar paths on trunk / Solaris, I see the same symptom. Running test with useprocess=false made no difference.&lt;/p&gt;</comment>
                            <comment id="12863191" author="kmarsden" created="Sun, 2 May 2010 21:19:56 +0100"  >&lt;p&gt;Thank you Dag and Sylvain for tracking this one down.  Any dual boot opportunity is very very bad and hard to track down in a production environment. especially if sensitive to subtle classpath changes.   I kind of doubt it is the same thing I saw when I originally logged this issue as I typically set up scripts for testing with absolute paths and would have used the same script when I upgraded the JVM that made the problem go away.  Does the relative path issue reproduce on 10.5 or is it a 10.6 regression? Especially if it is a regression and maybe if it is not,  it might make sense to file a new bug.&lt;/p&gt;
</comment>
                            <comment id="12863192" author="dagw" created="Sun, 2 May 2010 21:24:08 +0100"  >&lt;p&gt;bootLock.java starts another VM; this may be a lead.&lt;/p&gt;</comment>
                            <comment id="12863222" author="dagw" created="Mon, 3 May 2010 01:03:37 +0100"  >&lt;p&gt;Ok, the test framework starts bootLock in a subdirectory (different from the cwd when the test is started), so the forked&lt;br/&gt;
process (bootLock1), will have the wrong CLASSPATH: since it consists of relative paths to the jars, i.e. relative to the directory in which the test is &lt;b&gt;started&lt;/b&gt;, not relative to the created subdirectory, the forked subprocess will fail, leaving the way open for bootLock to open wombat without seeing it already opened/locked. No dual boot is really happening &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;As far as I can see, this is a test bug, not a product bug, at least in the incarnation I am seeing.&lt;/p&gt;</comment>
                            <comment id="12863223" author="dagw" created="Mon, 3 May 2010 01:05:49 +0100"  >&lt;p&gt;Kathey, If you think this incarnation has a different root cause than yours, I&apos;ll file a new issue for it.&lt;/p&gt;</comment>
                            <comment id="12863360" author="kmarsden" created="Mon, 3 May 2010 15:26:05 +0100"  >&lt;p&gt;Dag said:&lt;br/&gt;
&amp;gt;No dual boot is really happening.&lt;/p&gt;

&lt;p&gt;Thank goodness!  I really didn&apos;t sleep all that well thinking this was back.  I guess then it would be fine to leave it on this bug since this is where all the comments are and you understand the problem now and it is also on 10.5,  The history is here to show the original thing might have been something else, if we happen to ever see it resurface on z/os and if we do can file another bug for that one.&lt;/p&gt;</comment>
                            <comment id="12863376" author="dagw" created="Mon, 3 May 2010 16:24:41 +0100"  >&lt;p&gt;Adding test component as well.&lt;/p&gt;</comment>
                            <comment id="12863572" author="dagw" created="Tue, 4 May 2010 00:46:49 +0100"  >&lt;p&gt;Here is a patch which makes store/bootLock.java work in the presence of a classpath with relative pathnames. I tested manually on Solaris and Windows/cygwin, with variants of CLASSPATH env vars. I addmittedly  presumed any explicit -cp args gets picked up by system property java.class.path as well..&lt;/p&gt;

&lt;p&gt;A weakness is that I had to up the source level to 1.5 to be able to read the process environment to be able to replace &lt;br/&gt;
just the value of the system property java.class.path in order to make a suitable new enviroment to pass on to the forkee. The approach feels like a bit of a hack; better suggestions are welcome!&lt;/p&gt;

&lt;p&gt;I am not sure if we require that tests be runnable with 1.4, or just the product.. Running full regressions.&lt;/p&gt;

&lt;p&gt;Please review.&lt;/p&gt;</comment>
                            <comment id="12863591" author="kmarsden" created="Tue, 4 May 2010 01:52:57 +0100"  >&lt;p&gt;Would perhaps converting the test to JUnit provide cleaner options? BaseTestCase.execJavaCmd() uses java.class.path as is, but perhaps you would not have the problem with the nested directory.&lt;/p&gt;</comment>
                            <comment id="12863814" author="dagw" created="Tue, 4 May 2010 14:45:21 +0100"  >&lt;p&gt;Thanks Kathey, yes, I think that&apos;s probably a better way out here... I started with just a tiny fix, but it grew and by the time I had it working I didn&apos;t like it... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I&apos;ll have a go at  a rewrite.&lt;/p&gt;</comment>
                            <comment id="12863824" author="knutanders" created="Tue, 4 May 2010 15:31:38 +0100"  >&lt;p&gt;I think it would also be useful to make the test report that the sub-process failed. If the original test had just printed a line saying &quot;sub-process terminated with exit code 1&quot; or something, we would probably have known earlier where to look.&lt;/p&gt;</comment>
                            <comment id="12864039" author="dagw" created="Tue, 4 May 2010 23:04:37 +0100"  >&lt;p&gt;Uploading a patch which rewrites store/bootLock to JUnit. If the test fails, the subprocess will leave its log file around for inspection. It appears to run happily with relative jars.&lt;/p&gt;

&lt;p&gt;I notice that the old test properties had these settings:&lt;br/&gt;
  -runwithj9=false&lt;br/&gt;
  -runwithibm13=false&lt;br/&gt;
  -runwithjdk13=false&lt;/p&gt;

&lt;p&gt;The latter is stale and probably ibm13 as well&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, but please let me know if the &quot;j9&quot; exception is still relevant, and if so, how my test should skip the test for this platform.&lt;/p&gt;</comment>
                            <comment id="12864085" author="kmarsden" created="Wed, 5 May 2010 01:12:56 +0100"  >&lt;p&gt;I am guessing the old runwithj9=false because the spawned process stuff did not work with the old harness and j9, but I just tried the new test with weme6.1 and it failed with:&lt;br/&gt;
1) testBootLock(org.apache.derbyTesting.functionTests.tests.store.BootLockTest)j&lt;br/&gt;
unit.framework.AssertionFailedError: Dual boot not detected: check BootLockMinio&lt;br/&gt;
n.log&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.BootLockTest.testBo&lt;br/&gt;
otLock(BootLockTest.java:92)&lt;br/&gt;
        at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)&lt;/p&gt;

&lt;p&gt;        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:&lt;br/&gt;
109)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57&lt;br/&gt;
)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;/p&gt;

&lt;p&gt;I don&apos;t see BootLockMinion.log though.  I will try to take a look later, but if you want to check it in with it disabled that would be fine.  &lt;/p&gt;

&lt;p&gt;I also noticed when I tried to add the file  I got:&lt;br/&gt;
svn: Error resolving case of &apos;java\testing\org\apache\derbyTesting\functionTest&lt;br/&gt;
&apos;tests\store\BootLockTest.java&lt;/p&gt;

&lt;p&gt;That may be an environment issue on my part as I just started using cygwin instead of mks.  I haven&apos;t looked at either issue closely. &lt;/p&gt;</comment>
                            <comment id="12864332" author="dagw" created="Wed, 5 May 2010 14:47:40 +0100"  >&lt;p&gt;Thanks for testing this, Kathey! If there is no BootLockMinion.log, I guess the spawned program never got as far as booting Derby for some reason. You should be able to test the minion program standalone to see what happens, cf class Javadoc in BootLockMinion.&lt;br/&gt;
That said, I have yet to test the new patch on Windows/cygwin, I&apos;ll get to that today.&lt;/p&gt;</comment>
                            <comment id="12864343" author="dagw" created="Wed, 5 May 2010 15:29:47 +0100"  >&lt;p&gt;Regressions passed on Solaris/Sun JDK 1.6, but I&apos;ll do one on Windows as well.&lt;/p&gt;</comment>
                            <comment id="12864364" author="kmarsden" created="Wed, 5 May 2010 16:33:34 +0100"  >&lt;p&gt;I think maybe I have the wrong patch.  I see one was removed and then added with the same name after I downloaded it.  I will get that one instead.  What is the difference?&lt;/p&gt;

</comment>
                            <comment id="12864374" author="kmarsden" created="Wed, 5 May 2010 16:54:56 +0100"  >&lt;p&gt;Here is the error running BootLockMinion. Do we need to use EmbeddedSimpleDataSource instead?&lt;/p&gt;

&lt;p&gt;org.aache.derbyTesting.functionTests.tests.store.BootLockMinion wombat&lt;br/&gt;
Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: javax.naming.Referenc&lt;br/&gt;
eable&lt;br/&gt;
        at java.lang.ClassLoader.defineClassImpl(Native Method)&lt;br/&gt;
        at java.lang.ClassLoader.defineClass(ClassLoader.java:239)&lt;br/&gt;
        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:10&lt;br/&gt;
9)&lt;br/&gt;
        at java.net.URLClassLoader.findClassImpl(URLClassLoader.java:1073)&lt;br/&gt;
        at java.net.URLClassLoader.findClassImpl(URLClassLoader.java:1078)&lt;br/&gt;
        at java.net.URLClassLoader$LoadContext.run(URLClassLoader.java:570)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(AccessController.java:227&lt;br/&gt;
)&lt;br/&gt;
        at java.net.URLClassLoader.findClass(URLClassLoader.java:586)&lt;br/&gt;
        at com.ibm.oti.vm.URLSystemClassLoader.findClass(URLSystemClassLoader.ja&lt;br/&gt;
va:26)&lt;br/&gt;
        at java.lang.ClassLoader.loadClass(ClassLoader.java:641)&lt;br/&gt;
        at com.ibm.oti.vm.URLAppClassLoader.loadClass(URLAppClassLoader.java:146&lt;br/&gt;
)&lt;br/&gt;
        at java.lang.ClassLoader.loadClass(ClassLoader.java:607)&lt;br/&gt;
        at java.lang.ClassLoader.defineClassImpl(Native Method)&lt;br/&gt;
        at java.lang.ClassLoader.defineClass(ClassLoader.java:239)&lt;br/&gt;
        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:10&lt;br/&gt;
9)&lt;br/&gt;
        at java.net.URLClassLoader.findClassImpl(URLClassLoader.java:1073)&lt;br/&gt;
        at java.net.URLClassLoader.findClassImpl(URLClassLoader.java:1078)&lt;br/&gt;
        at java.net.URLClassLoader$LoadContext.run(URLClassLoader.java:570)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(AccessController.java:227&lt;br/&gt;
)&lt;br/&gt;
        at java.net.URLClassLoader.findClass(URLClassLoader.java:586)&lt;br/&gt;
        at com.ibm.oti.vm.URLSystemClassLoader.findClass(URLSystemClassLoader.ja&lt;br/&gt;
va:26)&lt;br/&gt;
        at java.lang.ClassLoader.loadClass(ClassLoader.java:641)&lt;br/&gt;
        at com.ibm.oti.vm.URLAppClassLoader.loadClass(URLAppClassLoader.java:146&lt;br/&gt;
)&lt;br/&gt;
        at java.lang.ClassLoader.loadClass(ClassLoader.java:607)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.BootLockMinion.main&lt;br/&gt;
(BootLockMinion.java:50)&lt;/p&gt;</comment>
                            <comment id="12864378" author="dagw" created="Wed, 5 May 2010 17:01:07 +0100"  >
&lt;p&gt;Kathey Marsden (JIRA) writes:&lt;br/&gt;
 &amp;gt;     [ &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4179?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=12864364#action_12864364&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DERBY-4179?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=12864364#action_12864364&lt;/a&gt; ] &lt;br/&gt;
 &amp;gt; &lt;br/&gt;
 &amp;gt; Kathey Marsden commented on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4179&quot; title=&quot;bootLock.java fails with missing exception on z/OS with  pmz3160sr2ifix-20081021_01(SR2+IZ32776+IZ33456), and Windows Vista&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4179&quot;&gt;&lt;del&gt;DERBY-4179&lt;/del&gt;&lt;/a&gt;:&lt;br/&gt;
 &amp;gt; ---------------------------------------&lt;br/&gt;
 &amp;gt; &lt;/p&gt;

&lt;p&gt; &amp;gt; I think maybe I have the wrong patch.  I see one was removed and&lt;br/&gt;
 &amp;gt; then added with the same name after I downloaded it.  I will get&lt;br/&gt;
 &amp;gt; that one instead.  What is the difference?&lt;/p&gt;

&lt;p&gt;I cleaned up some blankspace/tab stuff I had forgotten. Originally I&lt;br/&gt;
made the patch via &quot;svn rename&quot; instead of &quot;remove/add&quot; of the minion&lt;br/&gt;
program. But I think the second version of the patch has no sign of&lt;br/&gt;
the svn rename op. I am not really sure of that could have tripped&lt;br/&gt;
things up when yo you applied the patch.. I&apos;ll try it myself on cygwin&lt;br/&gt;
now.&lt;/p&gt;

&lt;p&gt;Sorry for the inconvenience!&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Dag&lt;/p&gt;</comment>
                            <comment id="12864379" author="dagw" created="Wed, 5 May 2010 17:01:20 +0100"  >&lt;p&gt;Thanks, Kathey! I guess this is a small device limitation. I&apos;ll try your suggestion!&lt;/p&gt;</comment>
                            <comment id="12864399" author="dagw" created="Wed, 5 May 2010 17:55:23 +0100"  >&lt;p&gt;Uploading derby-4179-junit-2, replacing earlier patches. This version uses EmbeddedSimpleDataSource in the minion program, which hopefully makes it run on a small device platform. I had no issues running the new test on Vista/cygwin. &lt;/p&gt;

&lt;p&gt;Note: I cut down the waiting time for the child to start and boot Derby from 30s to 15s in the interest of speed, our regressions are taking longer and longer.  Is that too tight? &lt;/p&gt;</comment>
                            <comment id="12864401" author="kmarsden" created="Wed, 5 May 2010 17:59:25 +0100"  >&lt;p&gt;Thanks Dag. I think Knut&apos;s suggestion to check that it is not the process itself that failed is a good one.  I am not exactly sure how you do that though and what exitValue() returns when something is still running.&lt;/p&gt;</comment>
                            <comment id="12864408" author="kmarsden" created="Wed, 5 May 2010 18:06:55 +0100"  >&lt;p&gt;Maybe instead it could just loop with 1 second waits for a period of time looking for the database lock file. That way it would wait just as long as needed.  It might also help solve the problem of determining if BootLockMinion just didn&apos;t do its thing.  Sometimes with JVM testing I know the tests are run with various options like turning JIT off which make things run very slowly and so it would be better to have the progress as soon as it is ready but wait 60 seconds total.&lt;/p&gt;
</comment>
                            <comment id="12864466" author="dagw" created="Wed, 5 May 2010 20:41:51 +0100"  >&lt;p&gt;Thanks for that idea, Kathey! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Meanwhile I went ahead and coded the parent to listen on a socket for the minion to be done, Since this test only runs embedded I can reuse the current configuration&apos;s server port, I think. So now the test runs in 2.5 seconds, maximally waiting for a minute. I am not sure, but I think CDC supports only datagram sockets, but I never open a stream, just listen for a connect, so hopefully it will work there as well. What do you think?&lt;/p&gt;

&lt;p&gt;Attaching derby-4179-junit-3 for this.&lt;/p&gt;


</comment>
                            <comment id="12864470" author="dagw" created="Wed, 5 May 2010 20:49:17 +0100"  >&lt;p&gt;As far as the exit value, I din&apos;t trust using that; after detroying the minion I saw an exit code of 143 on the Sun VM, but I don&apos;t know if that&apos;s standard or to be counted upon. Before the minion is killed I think exitValue will throw. In the new solution, the test fails if it doesn&apos;t hear from the minion program in 60 secs, so I think that should be sufficient hint.&lt;/p&gt;</comment>
                            <comment id="12864543" author="kmarsden" created="Wed, 5 May 2010 22:55:19 +0100"  >&lt;p&gt;Still failing with weme for some reason with the Minion did not start message.  The trick of running BootLockMinion doesn&apos;t work though because we don&apos;t have a server socket.  I will debug a bit and try to dump the process output.&lt;/p&gt;</comment>
                            <comment id="12864562" author="kmarsden" created="Wed, 5 May 2010 23:38:01 +0100"  >&lt;p&gt;Well I guess we aren&apos;t as set up to spawn a j9 process as I thought.&lt;/p&gt;

&lt;p&gt;The error is actually &lt;br/&gt;
.JVMJ9VM011W Unable to load jclfoun10_24: The specified module could not be foun&lt;br/&gt;
d.&lt;br/&gt;
JVMEXEX013E Internal VM error: Failed to create Java VM&lt;br/&gt;
JVMEXEX014I Run C:\cygwin\ibmsvn\ntsoftware\weme6.2\bin\j9.exe -help for usage&lt;/p&gt;

&lt;p&gt;execJavaProcess does pick up the j9 executable but  does not pass on the other settings.&lt;/p&gt;

&lt;p&gt;This is how my script invokes the test with j9.  It probably has a lot of legacy system properties not needed, but I suppose execJavaCmd should just pass along all system properties, but I don&apos;t know how it would get the bootclasspath.  Perhaps -Dbootcp was a way to pass it on in the old harness.&lt;/p&gt;

&lt;p&gt;c:/cygwin/ibmsvn/ntsoftware/weme6.2/bin/j9 -jcl:foun11 -DderbyTesting.serverho&lt;br/&gt;
st=localhost -DderbyTesting.clienthost=localhost -Demma.active= -Xbootclasspath/&lt;br/&gt;
a:c:/cygwin/ibmsvn/ntsoftware/weme6.2/lib/jdbc.jar -Dbootcp=c:/cygwin/ibmsvn/nts&lt;br/&gt;
oftware/weme6.2/lib/jdbc.jar junit.textui.TestRunner org.apache.derbyTesting.fun&lt;br/&gt;
ctionTests.tests.store.BootLockTest&lt;/p&gt;

&lt;p&gt;Anyway I best get back to my 10.6 testing. Disabling for J2ME for now and and adding an issue to enable it later would be fine by me.  It might be convenient to have the code below to print the error output on error.&lt;/p&gt;

&lt;p&gt;....&lt;br/&gt;
catch (SocketTimeoutException e) {&lt;br/&gt;
            p.destroy();&lt;br/&gt;
            p.waitFor();&lt;br/&gt;
            // Print error output&lt;br/&gt;
            BufferedReader  er = new BufferedReader(new InputStreamReader(p.getErrorStream()));&lt;br/&gt;
            String failmsg = &quot;Minion did not start or boot db in 60 seconds\n&quot;;&lt;br/&gt;
            String erout= null ;&lt;br/&gt;
            do &lt;/p&gt;
{
            	erout = er.readLine();
            	if (erout != null) failmsg += erout;
            }
&lt;p&gt; while (erout != null);&lt;br/&gt;
            fail(failmsg);&lt;br/&gt;
        }&lt;/p&gt;
</comment>
                            <comment id="12864601" author="dagw" created="Thu, 6 May 2010 01:32:32 +0100"  >&lt;p&gt;Thanks again, Kathey! I tried to run the test on the Sun phoneME, it forked the minion all right, but the&lt;br/&gt;
parent didn&apos;t experience an error connecting. I just saw the warning XSDB7 on derby.log instead. apparently because of&lt;br/&gt;
StorageFile.NO_FILE_LOCK_SUPPORT. &lt;/p&gt;

&lt;p&gt;So, the test would have to be changed for phoneMe in any case, maybe by setting derby.database.forceDatabaseLock.&lt;/p&gt;

&lt;p&gt;I&apos;ll just disable for now for J2ME as you suggest.&lt;/p&gt;</comment>
                            <comment id="12864817" author="kmarsden" created="Thu, 6 May 2010 17:31:01 +0100"  >&lt;p&gt;Are you saying that with phoneME you can actually dual boot? I have always only used weme on Windows where it is ok, but should probably try a linux version if I can find one if this is the case.&lt;/p&gt;</comment>
                            <comment id="12864945" author="dagw" created="Thu, 6 May 2010 23:02:45 +0100"  >&lt;p&gt;Yes, I am. For phoneME, we don&apos;t use DirStorageFactory4, which again uses DirFile4, which contains the working code for file locking. Cf. the test ca line 1693  in BaseMonitor.java. &lt;/p&gt;

&lt;p&gt;DirFile#getExclusiveFileLock which is used instead of DirFile4, always returns NO_FILE_LOCK_SUPPORT. &lt;/p&gt;

&lt;p&gt;I tried letting phoneME run with the *4 classes, but Foundation 1.1 &lt;span class=&quot;error&quot;&gt;&amp;#91;*&amp;#93;&lt;/span&gt; seems to lack the NIO classes necessary, notably the crucial FileChannel.lock method used by DirFile4#getExclusiveFileLock.&lt;/p&gt;

&lt;p&gt;On the bright side, I guess dual booting on constrained device is a less likely scenario?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;*&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://java.sun.com/javame/reference/apis/jsr219/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://java.sun.com/javame/reference/apis/jsr219/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12864949" author="dagw" created="Thu, 6 May 2010 23:28:24 +0100"  >&lt;p&gt;Filed &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4646&quot; title=&quot;Implement dual boot protection on CDC Foundation 1.1/phoneME platform for non-Windows platforms.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4646&quot;&gt;&lt;del&gt;DERBY-4646&lt;/del&gt;&lt;/a&gt; as an improvement issue for the lacking dual boot protection on ME. I guess it could qualify as a bug as well..&lt;/p&gt;</comment>
                            <comment id="12865235" author="dagw" created="Fri, 7 May 2010 17:55:43 +0100"  >&lt;p&gt;Uploading version 4 of this test, please review.&lt;br/&gt;
Passes for me on Windows, Sun phoneME and Solaris/Linux.&lt;br/&gt;
Rerunning regressions now.&lt;/p&gt;

&lt;p&gt;Details:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Rewrite of boot lock test to JUnit, this also solves the problem&lt;br/&gt;
  with running with jars in relative classpaths.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Added test of effectiveness of derby.database.forceDatabaseLock for&lt;br/&gt;
  phoneME platforms, until we implement &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4646&quot; title=&quot;Implement dual boot protection on CDC Foundation 1.1/phoneME platform for non-Windows platforms.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4646&quot;&gt;&lt;del&gt;DERBY-4646&lt;/del&gt;&lt;/a&gt;. (I could not find&lt;br/&gt;
  any other such test).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Fixed JUnit harness to correctly fork a Sun phoneME vm (image name&lt;br/&gt;
  is cvm, not java),&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Added logic to capture what happens to minion (if it fails) by&lt;br/&gt;
  capturing its stderr (if it ever gets started, that is), cf. example enclosed.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Added socket logic to communicate to parent when minion has booted&lt;br/&gt;
  the &quot;dual boot&quot; candidate to avoid having to wait for 30 seconds or&lt;br/&gt;
  more to be sure it has done so. Test now runs in a few seconds.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Skips test for j9 for now, since this platform fails on the fork&lt;br/&gt;
  operation according to Kathey. I suggest we open a new JIRA to fix&lt;br/&gt;
  this if desired.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Example of the minion failing:&lt;br/&gt;
-----------------------------&lt;br/&gt;
There was 1 failure:&lt;br/&gt;
1) testBootLock(org.apache.derbyTesting.functionTests.tests.store.BootLockTest)junit.framework.AssertionFailedError: Minion did not start or boot db in 60 seconds.&lt;br/&gt;
----Minion&apos;s stderr:&lt;br/&gt;
java.lang.Exception: Stack trace	at java.lang.Thread.dumpStack(Thread.java:1206)	at org.apache.derbyTesting.functionTests.tests.store.BootLockMinion.main(BootLockMinion.java:48)&lt;br/&gt;
----Minion&apos;s stderr ended&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.store.BootLockTest.testBootLock(BootLockTest.java:201)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;br/&gt;
Tests run: 1,  Failures: 1,  Errors: 0&lt;/p&gt;</comment>
                            <comment id="12865256" author="kmarsden" created="Fri, 7 May 2010 19:18:18 +0100"  >&lt;p&gt;I probably won&apos;t have time to look at the final patch, but it all sounds great based on previous looks and the changes you describe.  I&apos;d say go ahead and commit. I will file an issue regarding spawning the process  with weme&lt;/p&gt;</comment>
                            <comment id="12865267" author="dagw" created="Fri, 7 May 2010 19:48:13 +0100"  >&lt;p&gt;Thanks for your help with this one, Kathey! &lt;/p&gt;</comment>
                            <comment id="12865365" author="dagw" created="Sat, 8 May 2010 01:34:39 +0100"  >&lt;p&gt;Uploaded version #5, which contains some small improvements relative to version 4.&lt;/p&gt;</comment>
                            <comment id="12865367" author="dagw" created="Sat, 8 May 2010 01:41:21 +0100"  >&lt;p&gt;Committed derby-4179-junit-5 as svn 942286 and some doc/comment fixes in svn 942476 and 942480.&lt;/p&gt;</comment>
                            <comment id="12865369" author="dagw" created="Sat, 8 May 2010 01:43:35 +0100"  >&lt;p&gt;Resolving, since the original failing test is gone, even though the root cause may have been different.&lt;/p&gt;</comment>
                            <comment id="12865586" author="knutanders" created="Sun, 9 May 2010 13:17:52 +0100"  >&lt;p&gt;+            // Can&apos;t use the DatabasePropertyTestSetup.singleProperty, since&lt;br/&gt;
+            // that method sets a database property (not a system property),&lt;br/&gt;
+            // and the minion is the one creating the database here. An&lt;br/&gt;
+            // alternative would be to let minion set it.&lt;/p&gt;

&lt;p&gt;Would SystemPropertyTestSetup be an alternative?&lt;/p&gt;</comment>
                            <comment id="12865614" author="dagw" created="Sun, 9 May 2010 18:45:05 +0100"  >&lt;p&gt;Ah, thanks, missed that one &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I was considering writing one.. this saves me that effort!&lt;/p&gt;</comment>
                            <comment id="12865627" author="dagw" created="Sun, 9 May 2010 20:22:05 +0100"  >&lt;p&gt;Committed patch svn 942587 which replaces the home-grown system property setup/teardown code with SystemPropertyTestSetup.&lt;/p&gt;</comment>
                            <comment id="12881933" author="kmarsden" created="Wed, 23 Jun 2010 23:39:23 +0100"  >&lt;p&gt;Backported to 10.6 and 10.5 &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12463933">DERBY-4646</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12464015">DERBY-4647</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12424996" name="bootLock.diff" size="1978" author="sleroux" created="Sun, 15 Nov 2009 12:07:11 +0000"/>
                            <attachment id="12443731" name="derby-4179-junit-2.diff" size="19338" author="dagw" created="Wed, 5 May 2010 17:55:23 +0100"/>
                            <attachment id="12443732" name="derby-4179-junit-2.stat" size="846" author="dagw" created="Wed, 5 May 2010 17:55:23 +0100"/>
                            <attachment id="12443756" name="derby-4179-junit-3.diff" size="20316" author="dagw" created="Wed, 5 May 2010 20:42:27 +0100"/>
                            <attachment id="12443757" name="derby-4179-junit-3.stat" size="846" author="dagw" created="Wed, 5 May 2010 20:42:27 +0100"/>
                            <attachment id="12443980" name="derby-4179-junit-4.diff" size="28054" author="dagw" created="Fri, 7 May 2010 17:55:43 +0100"/>
                            <attachment id="12443981" name="derby-4179-junit-4.stat" size="997" author="dagw" created="Fri, 7 May 2010 17:55:43 +0100"/>
                            <attachment id="12444021" name="derby-4179-junit-5.diff" size="28177" author="dagw" created="Sat, 8 May 2010 01:34:39 +0100"/>
                            <attachment id="12444022" name="derby-4179-junit-5.stat" size="997" author="dagw" created="Sat, 8 May 2010 01:34:39 +0100"/>
                            <attachment id="12443662" name="derby-4179-junit.diff" size="19320" author="dagw" created="Wed, 5 May 2010 00:55:18 +0100"/>
                            <attachment id="12443663" name="derby-4179-junit.stat" size="846" author="dagw" created="Wed, 5 May 2010 00:55:18 +0100"/>
                            <attachment id="12443525" name="derby-4179.diff" size="5630" author="dagw" created="Tue, 4 May 2010 00:46:49 +0100"/>
                            <attachment id="12443526" name="derby-4179.stat" size="166" author="dagw" created="Tue, 4 May 2010 00:46:49 +0100"/>
                            <attachment id="12424994" name="derbyall_report.txt" size="3671" author="sleroux" created="Sun, 15 Nov 2009 12:07:11 +0000"/>
                            <attachment id="12424995" name="storeall_report.txt" size="2924" author="sleroux" created="Sun, 15 Nov 2009 12:07:11 +0000"/>
                            <attachment id="12443418" name="sysinfo.txt" size="3080" author="dagw" created="Sun, 2 May 2010 19:19:10 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 14 Nov 2009 18:02:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24081</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0o07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37707</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>