<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:52:56 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4907/DERBY-4907.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4907] EmbeddedXADataSource with ;create=true attribute set in setDatabaseName fails with java.sql.SQLException: Database not available</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4907</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Setting the ;create=true attribute in setDatabaseName with EmbededXADataSource and EmbeddedXADataSource40  fails with &lt;br/&gt;
$ java TestDerbyCreate&lt;br/&gt;
Exception in thread &quot;main&quot; java.sql.SQLException: Database not available&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedXADataSource.setupResourceAdapter(Embe&lt;br/&gt;
dedXADataSource.java:175)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedXADataSource.getXAConnection(EmbeddedX&lt;br/&gt;
DataSource.java:101)&lt;br/&gt;
        at TestDerbyCreate.main(TestDerbyCreate.java:18)&lt;/p&gt;


&lt;p&gt;using the create attributie in databaseName works fine with EmbeddedDataSource.  &lt;/p&gt;

&lt;p&gt;Using setCreateDatabase(&quot;create&quot;) with EmbeddedXADataSource is a good work around and I think generally preferable.&lt;/p&gt;



&lt;p&gt;import java.sql.*;&lt;br/&gt;
import javax.sql.*;&lt;/p&gt;

&lt;p&gt;public class TestDerbyCreate&lt;br/&gt;
{&lt;br/&gt;
    public static void main(String[] args) throws Throwable&lt;br/&gt;
    {&lt;br/&gt;
        org.apache.derby.jdbc.EmbeddedXADataSource ds =&lt;br/&gt;
            new &lt;br/&gt;
org.apache.derby.jdbc.EmbeddedXADataSource();&lt;/p&gt;

&lt;p&gt;        ds.setDatabaseName(&quot;TestDB;create=true&quot;);&lt;br/&gt;
        ds.setUser(&quot;dbuser1&quot;);&lt;br/&gt;
        ds.setPassword(&quot;dbpwd1&quot;);&lt;/p&gt;

&lt;p&gt;	PooledConnection pooledConn = ds.getXAConnection();&lt;br/&gt;
        Connection conn = pooledConn.getConnection();&lt;/p&gt;


&lt;p&gt;        System.out.println(&quot;Database product: &quot; + &lt;br/&gt;
conn.getMetaData().getDatabaseProductName());&lt;br/&gt;
        System.out.println(&quot;Database version: &quot; + &lt;br/&gt;
conn.getMetaData().getDatabaseProductVersion());&lt;br/&gt;
        System.out.println(&quot;Driver name:      &quot; + &lt;br/&gt;
conn.getMetaData().getDriverName());&lt;br/&gt;
        System.out.println(&quot;Driver version:   &quot; + &lt;br/&gt;
conn.getMetaData().getDriverVersion());&lt;br/&gt;
        System.out.println(&quot;JDBC driver major ve&lt;/p&gt;</description>
                <environment></environment>
        <key id="12480392">DERBY-4907</key>
            <summary>EmbeddedXADataSource with ;create=true attribute set in setDatabaseName fails with java.sql.SQLException: Database not available</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="siddharthsrivastava">Siddharth Srivastava</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                            <label>derby_triage10_8</label>
                    </labels>
                <created>Thu, 18 Nov 2010 23:49:54 +0000</created>
                <updated>Thu, 2 May 2013 03:29:37 +0100</updated>
                            <resolved>Thu, 24 Mar 2011 16:41:55 +0000</resolved>
                                    <version>10.1.3.1</version>
                    <version>10.2.2.0</version>
                    <version>10.3.3.0</version>
                    <version>10.4.2.0</version>
                    <version>10.5.3.0</version>
                    <version>10.6.2.1</version>
                                    <fixVersion>10.5.3.2</fixVersion>
                    <fixVersion>10.6.2.4</fixVersion>
                    <fixVersion>10.7.1.4</fixVersion>
                    <fixVersion>10.8.1.2</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12988605" author="siddharthsrivastava" created="Sun, 30 Jan 2011 16:28:32 +0000"  >&lt;p&gt;Initially the problem seem to be with the findService. Though database is being created in the default location as per the repro attached above.  &lt;/p&gt;</comment>
                            <comment id="12989283" author="siddharthsrivastava" created="Tue, 1 Feb 2011 17:11:16 +0000"  >&lt;p&gt;What coding and naming conventions need to be followed for Derby ? Is there any documentation related to the same.  &lt;/p&gt;</comment>
                            <comment id="12989287" author="siddharthsrivastava" created="Tue, 1 Feb 2011 17:24:49 +0000"  >&lt;p&gt;Discussed with Kathey on IRC. Got the appropriate resources. Thanks Kathey&lt;/p&gt;</comment>
                            <comment id="12989379" author="siddharthsrivastava" created="Tue, 1 Feb 2011 20:52:58 +0000"  >&lt;p&gt;adding this to EmbeddedXADataSource.java &lt;br/&gt;
if (dbName != null) &lt;/p&gt;
{
String dbShort = shortDatabaseName();
//other code

if (Monitor.getMonitor() != null)
	database = (Database)
	Monitor.findService(Property.DATABASE_MODULE, dbShort);
}


&lt;p&gt;String shortDatabaseName is defined as follows:&lt;/p&gt;
{
    String delim = &quot;[;]&quot;;
    String[] dbShort = databaseName.split(delim);
    return dbShort[0];
}


&lt;p&gt;Now java TestDerbyCreate.java gives this error:&lt;/p&gt;

&lt;p&gt;Default implementation list not found&lt;br/&gt;
XBM02.D : &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; org.apache.derby.iapi.services.stream.InfoStreams&lt;br/&gt;
ERROR XBM02: XBM02.D : &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; org.apache.derby.iapi.services.stream.InfoStreams&lt;br/&gt;
        at org.apache.derby.iapi.error.StandardException.newException(StandardEx&lt;br/&gt;
ception.java:286)&lt;br/&gt;
        at org.apache.derby.iapi.services.monitor.Monitor.missingImplementation(&lt;br/&gt;
Monitor.java:672)&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.TopService.bootModule(TopServi&lt;br/&gt;
ce.java:325)&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMo&lt;br/&gt;
nitor.java:531)&lt;br/&gt;
        at org.apache.derby.iapi.services.monitor.Monitor.startSystemModule(Moni&lt;br/&gt;
tor.java:366)&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.BaseMonitor.runWithState(BaseM&lt;br/&gt;
onitor.java:344)&lt;br/&gt;
        at org.apache.derby.impl.services.monitor.FileMonitor.&amp;lt;init&amp;gt;(FileMonitor&lt;br/&gt;
.java:60)&lt;br/&gt;
        at org.apache.derby.iapi.services.monitor.Monitor.startMonitor(Monitor.j&lt;br/&gt;
ava:289)&lt;br/&gt;
        at org.apache.derby.iapi.jdbc.JDBCBoot.boot(JDBCBoot.java:69)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDriver.boot(EmbeddedDriver.java:199)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDriver.&amp;lt;clinit&amp;gt;(EmbeddedDriver.java:96)&lt;/p&gt;

&lt;p&gt;        at org.apache.derby.jdbc.EmbeddedDataSource.findDriver(EmbeddedDataSourc&lt;br/&gt;
e.java:501)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(EmbeddedDataSo&lt;br/&gt;
urce.java:480)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(EmbeddedDataSo&lt;br/&gt;
urce.java:424)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedXADataSource.setupResourceAdapter(Embed&lt;br/&gt;
dedXADataSource.java:166)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedXADataSource.getXAConnection(EmbeddedXA&lt;br/&gt;
DataSource.java:101)&lt;br/&gt;
        at TestDerbyCreate.main(TestDerbyCreate.java:16)&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.sql.SQLException: No suitable driver&lt;br/&gt;
        at java.sql.DriverManager.getDriver(Unknown Source)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDataSource.findDriver(EmbeddedDataSourc&lt;br/&gt;
e.java:506)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(EmbeddedDataSo&lt;br/&gt;
urce.java:480)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(EmbeddedDataSo&lt;br/&gt;
urce.java:424)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedXADataSource.setupResourceAdapter(Embed&lt;br/&gt;
dedXADataSource.java:166)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedXADataSource.getXAConnection(EmbeddedXA&lt;br/&gt;
DataSource.java:101)&lt;br/&gt;
        at TestDerbyCreate.main(TestDerbyCreate.java:16)&lt;/p&gt;</comment>
                            <comment id="12989386" author="kmarsden" created="Tue, 1 Feb 2011 21:20:14 +0000"  >&lt;p&gt;I think this might be a problem with your build. I would ant clobber and remove your old jars and then rebuild checking carefully that there are no build errors.  If I am not mistaken it is not getting as far as the original error.&lt;/p&gt;</comment>
                            <comment id="12989535" author="siddharthsrivastava" created="Wed, 2 Feb 2011 06:59:46 +0000"  >&lt;p&gt;build errors weren&apos;t there earlier too. jars were required to be manually removed. Shouldn&apos;t they be overwritten ?&lt;/p&gt;

&lt;p&gt;Just tested again with all modifications made i.e. passing database name to the findService().  Now it seems to work &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Output is: &lt;br/&gt;
Database product: Apache Derby&lt;br/&gt;
Database version: 10.8.0.0 alpha - (???)&lt;br/&gt;
Driver name: Apache Derby Embedded JDBC Driver&lt;br/&gt;
Driver version: 10.8.0.0 alpha - (???)&lt;br/&gt;
JDBC driver major ve&lt;/p&gt;</comment>
                            <comment id="12989731" author="siddharthsrivastava" created="Wed, 2 Feb 2011 18:10:55 +0000"  >&lt;p&gt;The code changes done seem to resolve this issue. I have created a patch using Eclipse (Team-&amp;gt;create Patch). But when I upload it on jira using:&lt;br/&gt;
MoreActions-&amp;gt;Attach File, I get Unknown error occurred uploading file.&lt;/p&gt;
</comment>
                            <comment id="12990184" author="siddharthsrivastava" created="Thu, 3 Feb 2011 17:11:12 +0000"  >&lt;p&gt;I have attached a patch for the changes I have made. The code changes work fine for me. &lt;br/&gt;
Now I have started writing regression test cases for it.&lt;/p&gt;</comment>
                            <comment id="12990264" author="kmarsden" created="Thu, 3 Feb 2011 19:53:13 +0000"  >&lt;p&gt;Thank you Siddharth for working on this issue.  My only substantive comment is I think it would make sense to move shortDatabaseName all the way up to ReferenceableDatasource in case it is needed for other DataSources since it is not related to XA.  There also seemed to be a white space diff introduced in update() that would be good to get rid of in the final patch.  I am looking forward to seeing your test. Keep up the good work.&lt;/p&gt;
</comment>
                            <comment id="12990266" author="kmarsden" created="Thu, 3 Feb 2011 20:01:51 +0000"  >&lt;p&gt;oops. shortDatabaseName() is already in ReferenceableDataSource!  I looked at the diff too quickly.  Looks good then.&lt;/p&gt;</comment>
                            <comment id="12991853" author="siddharthsrivastava" created="Tue, 8 Feb 2011 09:29:47 +0000"  >&lt;p&gt;thanks Kathey for your review. I will remove the redundant space in the final diff.&lt;/p&gt;

&lt;p&gt;While writing junit test, I was a bit confused over getting datasources for test in J2EEDataSourceTest.java. As we need to test the function in EmbeddedXADataSource, so is there a way to convert between the two or a specific methods needs to be written for EmbeddedXADataSource as for XADataSource in J2EEDataSource.java. (which I think would need certain addition to the JDBCClient.java too )&lt;br/&gt;
I think I am missing a link in here.&lt;/p&gt;
</comment>
                            <comment id="12993151" author="kmarsden" created="Thu, 10 Feb 2011 18:16:40 +0000"  >&lt;p&gt;J2EEDatasource.getXADatasource() is smart and will get the right XADatasource, one of 4, EmbeddedXADatasource, EmbeddedXADatasource40,  ClientXADatasource or ClientXADatasource40. Try running the test printing the claasname of the datasource you get in the fixture. You will see with JDK 1.6 you cover the 40 ones and with JDK 1.5 to see the others.&lt;/p&gt;</comment>
                            <comment id="12993152" author="siddharthsrivastava" created="Thu, 10 Feb 2011 18:17:33 +0000"  >&lt;p&gt;The diff consists of the bug fix and the regression test. &lt;/p&gt;

&lt;p&gt;As far as the empty line is concerned, my observation says that its a whitespace. I set my editor to remove it but somehow the change is not getting detected. Would try to fix that the redundant whitespaces till the review goes on.&lt;/p&gt;</comment>
                            <comment id="12993154" author="siddharthsrivastava" created="Thu, 10 Feb 2011 18:20:19 +0000"  >&lt;p&gt;thanks Kathey for the suggestion. I am much clear about the loop I was getting in &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12993241" author="kmarsden" created="Thu, 10 Feb 2011 22:14:54 +0000"  >&lt;p&gt;Thanks Siddharth.  I think if databaseName is an empty string &quot;&quot;, which is what is used for engine shutdown, shortDatabaseName will return null instead of &quot;&quot;;&lt;/p&gt;

&lt;p&gt;Maybe instead  do the split only if  the databaseName is not null and if it contains a semicolon. Otherwise return databaseName.  That way we only have the overhead of the split call when it is really needed and don&apos;t have to worry so much about these edge cases. &lt;/p&gt;

&lt;p&gt;In the test I think it would also be good to test with  the other datasource types, JDBCDataSource.getDataSource() and J2EEDataSource.getConnectionPoolDataSource() too.   These were not broken before but good to have coverage.&lt;/p&gt;

&lt;p&gt;I think I would not include spelling corrections that are far removed from the code change, especially in files that have no code changes.   This type of thing is best done separately.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;
</comment>
                            <comment id="12995332" author="siddharthsrivastava" created="Wed, 16 Feb 2011 15:07:03 +0000"  >&lt;p&gt;Thanks Kathey for your review.&lt;/p&gt;

&lt;p&gt;I would keep in mind to not to change the comments. It really looks odd. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I have added tests for JDBCDataSource, Pool DataSource and XADataSource.&lt;/p&gt;

&lt;p&gt;As well as modified the shortDatabseName for avoiding unnecessary split.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="12995334" author="siddharthsrivastava" created="Wed, 16 Feb 2011 15:09:17 +0000"  >&lt;p&gt;Sorry for the noise, I forgot to grant the license to previous attachment for inclusion in ASF works.&lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="12995380" author="espinha" created="Wed, 16 Feb 2011 16:43:20 +0000"  >&lt;p&gt;Hi Siddharth,&lt;/p&gt;

&lt;p&gt;I&apos;ve skimmed through the patch and it looks good, but I have one remark. When you submit a patch, try to avoid white-space changes like the second change in your latest patch. As you can see, the only difference is that you added a tab character in front of the bracket, which makes svn pick it up as a change and makes it harder to review the patch.&lt;/p&gt;

&lt;p&gt;There&apos;s a few more cases like:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;xa.close();&lt;br/&gt;
+        xa.close();         &lt;br/&gt;
(again, the same situation with the tab)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It&apos;s a cosmetic thing but especially with large patches, it does matter for whoever&apos;s reviewing it.&lt;/p&gt;

&lt;p&gt;I will give the patch a better look later today, once I get home.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="12995454" author="kmarsden" created="Wed, 16 Feb 2011 18:55:04 +0000"  >&lt;p&gt;For the white space issue, I have found in Eclipse that the setting Windows -&amp;gt;Preferences -&amp;gt; General -&amp;gt;Editors -&amp;gt; Text Editors -&amp;gt; Show whitespace characters is very helpful to differentiate tabs and spaces.  Although they don&apos;t show with &amp;lt;right click&amp;gt; compare you can move the cursor in the white space to see the difference. Tabs will jump several spaces.&lt;/p&gt;

&lt;p&gt;I think the patch is fine based on a cursory review.  I will let Tiago do the commit since he wants to take a look at it too.&lt;/p&gt;

&lt;p&gt;I think you asked a couple important questions on IRC that I wanted to answer here. Maybe you answered them yourself as I don&apos;t see any such issues with the patch.&lt;/p&gt;

&lt;p&gt;Q1) Shouldn&apos;t  shortDatabaseName do some checking on the validity of the database name format?  &lt;br/&gt;
I am not sure what checking would be required, but If there is any checking needed on the databaseName that should occur in setDatabaseName at the time that the user sets it, rather than in shortDatabaseName where it is just being parsed in the getConneciton() call.&lt;/p&gt;

&lt;p&gt;Q2) Shouldn&apos;t errors print or be logged somewhere?&lt;br/&gt;
Because Derby is typically embedded in an application, the way we generally communicate problems to the application is by throwing an Exception.  That way the application can either  catch the exception and handle it or throw it back to the user if appropriate.  These can optionally be logged to the derby.log if the user wants by setting the derby.stream.error.logSeverity property &lt;a href=&quot;http://db.apache.org/derby/manuals/tuning/perf90.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/manuals/tuning/perf90.html&lt;/a&gt;&lt;br/&gt;
If your work ever requires adding a new message for an exception, give the list a ping as there are some steps needed to make sure the message is localized, etc.&lt;/p&gt;



</comment>
                            <comment id="12995529" author="espinha" created="Wed, 16 Feb 2011 21:28:22 +0000"  >&lt;p&gt;Ok, I have a couple more comments. I agree with Kathey. The short database name is something that we can manage whenever a database name is set. We could have an attribute shortDatabaseName that we define whenever the actual database name is set (setDatabaseName). Then the getShortName() method would simply return this field, without having to do any kind of checks (Kathey, you mention checking but I can&apos;t seem to think of anything that would be required...).&lt;/p&gt;

&lt;p&gt;I&apos;ve also noticed that you have: a) spelling changes, b) production code changes and c) test additions in one single patch. I&apos;m not sure if everyone will agree with me on this, but I&apos;ve always done code changes and test changes in separate patches. Sure, maybe for a small patch like this it doesn&apos;t matter much, but when we start dealing with larger patches, I think it&apos;s good practice to keep the two separated.&lt;/p&gt;

&lt;p&gt;I might also be nit picking but I would prefer (for standard&apos;s sake) that getter methods (like shortDatabaseName() ) would actually start with &quot;get&quot;.&lt;/p&gt;</comment>
                            <comment id="12995536" author="kmarsden" created="Wed, 16 Feb 2011 21:49:58 +0000"  >&lt;p&gt;It would be a good performance optimization to set a shortDatabaseName  field on set rather than parsing databaseName  on every connection.  I think the current  implementation is ok too as I don&apos;t think it creates that big a hit.&lt;/p&gt;

&lt;p&gt;I have always combined code and test in the patch, but it actually would be nice to have them separate so the reviewer could run the test first and see that it fails and then with the code change to see that it passes.  Maybe I&apos;ll start doing that #&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;On shortName() vs getShortName() I think the name is ok. I am concerned that often reflection is used to get the bean properties on DataSources and don&apos;t want this one to show up but perhaps if it is not public that is not an issue.  I am just not sure. Also as it is currently implemented it is not just a straight getter and does some manipulation so the name is ok in that regard too.&lt;/p&gt;

</comment>
                            <comment id="12995931" author="kmarsden" created="Thu, 17 Feb 2011 17:17:41 +0000"  >&lt;p&gt;I see in the javadoc for getDeclaredMethods() &lt;a href=&quot;http://download.oracle.com/javase/6/docs/api/java/lang/Class.html#getDeclaredMethods(&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://download.oracle.com/javase/6/docs/api/java/lang/Class.html#getDeclaredMethods(&lt;/a&gt;) it does return non-public methods but does not return inherited methods. Since getShortDatabaseName() would be in ReferenceableDataSource  I think it would be safe to call it that and not worry about it showing up as a phantom bean property in reflection.&lt;/p&gt;
</comment>
                            <comment id="12996823" author="siddharthsrivastava" created="Sat, 19 Feb 2011 17:49:34 +0000"  >&lt;p&gt;Thanks Kathey, Tiago for your review.&lt;/p&gt;

&lt;p&gt;I have removed erroneous spaces and edits. Also I have removed shortDatabaseName() and moved that to setDatabaseName.&lt;/p&gt;

&lt;p&gt;three tests(for XA DataSource, JDBC DataSource, PoolDataSource) are also added. &lt;/p&gt;

&lt;p&gt;Testing: the individual test runs successfully. &lt;/p&gt;</comment>
                            <comment id="12996824" author="siddharthsrivastava" created="Sat, 19 Feb 2011 17:53:29 +0000"  >&lt;p&gt;When I run the suites.All, I get the following 2 errors&lt;/p&gt;

&lt;p&gt;run &quot;suites.All&quot; I get this error : ( I emptied the directory from which I was running tests before starting running suites.All)&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Error/failure logged at Sat Feb 19 15:40:32 IST 2011&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.sql.SQLException: An IOException occurred while writing data to the file.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:98)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.seeNextException(Util.java:278)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:348)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2290)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:82)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1334)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1686)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(EmbedPreparedStatement.java:1341)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.tools.ImportExportBaseTest.doExportQueryLobsToExtFile(ImportExportBaseTest.java:197)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.tools.ImportExportLobTest.testImportDataExportQueryLobsInExtFile(ImportExportLobTest.java:332)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Unknown Source)&lt;br/&gt;
	at junit.framework.TestCase.runTest(TestCase.java:164)&lt;br/&gt;
	at junit.framework.TestCase.runBare(TestCase.java:130)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112)&lt;br/&gt;
	at junit.framework.TestResult$1.protect(TestResult.java:106)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
	at junit.framework.TestResult.run(TestResult.java:109)&lt;br/&gt;
	at junit.framework.TestCase.run(TestCase.java:120)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
	at junit.textui.TestRunner.doRun(TestRunner.java:121)&lt;br/&gt;
	at junit.textui.TestRunner.start(TestRunner.java:185)&lt;br/&gt;
	at junit.textui.TestRunner.main(TestRunner.java:143)&lt;br/&gt;
Caused by: java.sql.SQLException: An IOException occurred while writing data to the file.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)&lt;br/&gt;
	... 42 more&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;extinout\books.del (Access is denied): java.io.FileNotFoundException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.javaException(Util.java:299)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:408)&lt;br/&gt;
	... 40 more&lt;br/&gt;
Caused by: java.io.FileNotFoundException: extinout\books.del (Access is denied)&lt;br/&gt;
	at java.io.FileOutputStream.open(Native Method)&lt;br/&gt;
	at java.io.FileOutputStream.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at java.io.FileOutputStream.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.load.ExportWriteData.openFiles(ExportWriteData.java:108)&lt;br/&gt;
	at org.apache.derby.impl.load.ExportWriteData.run(ExportWriteData.java:93)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
	at org.apache.derby.impl.load.ExportWriteData.init(ExportWriteData.java:85)&lt;br/&gt;
	at org.apache.derby.impl.load.ExportWriteData.&amp;lt;init&amp;gt;(ExportWriteData.java:78)&lt;br/&gt;
	at org.apache.derby.impl.load.Export.getExportWriteData(Export.java:296)&lt;br/&gt;
	at org.apache.derby.impl.load.ExportAbstract.doAllTheWork(ExportAbstract.java:187)&lt;br/&gt;
	at org.apache.derby.impl.load.Export.doExport(Export.java:65)&lt;br/&gt;
	at org.apache.derby.impl.load.Export.exportQuery(Export.java:285)&lt;br/&gt;
	at org.apache.derby.catalog.SystemProcedures.SYSCS_EXPORT_QUERY_LOBS_TO_EXTFILE(SystemProcedures.java:1430)&lt;br/&gt;
	at org.apache.derby.exe.ac685dd88bx012ex3d61x7f08x00004762b9942.g0(Unknown Source)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(ReflectMethod.java:46)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(CallStatementResultSet.java:75)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:436)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:317)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1242)&lt;br/&gt;
	... 35 more&lt;/p&gt;

&lt;p&gt;2) &lt;span class=&quot;error&quot;&gt;&amp;#91;Error/failure logged at Sat Feb 19 17:04:10 IST 2011&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.sql.SQLException: DERBY SQL error: SQLCODE: -1, SQLSTATE: XJ041, SQLERRMC: Failed to create database &apos;F:\eclipsework\testGarbage\db_master\wombat&apos;, see the next exception for details.::SQLSTATE: XBM0JDirectory F:\eclipsework\testGarbage\db_master\F:\eclipsework\testGarbage\db_master\wombat already exists.&lt;br/&gt;
	at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:99)&lt;br/&gt;
	at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:358)&lt;br/&gt;
	at org.apache.derby.jdbc.ClientDriver.connect(ClientDriver.java:166)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(Unknown Source)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(Unknown Source)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.bootMasterDatabase(ReplicationRun.java:868)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.makeReadyForReplication(ReplicationRun.java:2746)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_1Indexing.testReplication_Local_1_Indexing(ReplicationRun_Local_1Indexing.java:70)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Unknown Source)&lt;br/&gt;
	at junit.framework.TestCase.runTest(TestCase.java:164)&lt;br/&gt;
	at junit.framework.TestCase.runBare(TestCase.java:130)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:207)&lt;br/&gt;
	at junit.framework.TestResult$1.protect(TestResult.java:106)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
	at junit.framework.TestResult.run(TestResult.java:109)&lt;br/&gt;
	at junit.framework.TestCase.run(TestCase.java:120)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
	at junit.textui.TestRunner.doRun(TestRunner.java:121)&lt;br/&gt;
	at junit.textui.TestRunner.start(TestRunner.java:185)&lt;br/&gt;
	at junit.textui.TestRunner.main(TestRunner.java:143)&lt;br/&gt;
Caused by: org.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: -1, SQLSTATE: XJ041, SQLERRMC: Failed to create database &apos;F:\eclipsework\testGarbage\db_master\wombat&apos;, see the next exception for details.::SQLSTATE: XBM0JDirectory F:\eclipsework\testGarbage\db_master\F:\eclipsework\testGarbage\db_master\wombat already exists.&lt;br/&gt;
	at org.apache.derby.client.am.Connection.completeSqlca(Connection.java:2121)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseRdbAccessFailed(NetConnectionReply.java:541)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseAccessRdbError(NetConnectionReply.java:434)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseACCRDBreply(NetConnectionReply.java:297)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.readAccessDatabase(NetConnectionReply.java:121)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.readSecurityCheckAndAccessRdb(NetConnection.java:846)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowSecurityCheckAndAccessRdb(NetConnection.java:769)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowUSRIDONLconnect(NetConnection.java:601)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowConnect(NetConnection.java:408)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.&amp;lt;init&amp;gt;(NetConnection.java:218)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection40.&amp;lt;init&amp;gt;(NetConnection40.java:79)&lt;br/&gt;
	at org.apache.derby.client.net.ClientJDBCObjectFactoryImpl40.newNetConnection(ClientJDBCObjectFactoryImpl40.java:269)&lt;br/&gt;
	at org.apache.derby.jdbc.ClientDriver.connect(ClientDriver.java:157)&lt;br/&gt;
	... 34 more&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;br/&gt;
Tests run: 13327,  Failures: 0,  Errors: 2&lt;/p&gt;</comment>
                            <comment id="12997105" author="espinha" created="Sun, 20 Feb 2011 07:28:00 +0000"  >&lt;p&gt;This looks most definitely like a permissions issue: &quot;Caused by: java.sql.SQLException: Java exception: &apos;extinout\books.del (Access is denied): java.io.FileNotFoundException&apos;. &quot;&lt;/p&gt;

&lt;p&gt;Maybe you can try to disable UAC &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; and give it another try? Then if it works, we&apos;ll know what&apos;s causing it and we can try a more gentle approach (maybe just changing the permissions of the folder...).&lt;/p&gt;

&lt;p&gt;I&apos;m not sure, but maybe running the command line in elevated mode (right click on it, and &quot;Run as Administrator) would also fix it, but I&apos;d still give it a try just with UAC disabled beforehand.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - &lt;a href=&quot;http://www.mydigitallife.info/2008/12/30/how-to-disable-and-turn-off-uac-in-windows-7/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.mydigitallife.info/2008/12/30/how-to-disable-and-turn-off-uac-in-windows-7/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12998771" author="siddharthsrivastava" created="Thu, 24 Feb 2011 09:12:54 +0000"  >&lt;p&gt;In continuation to previous comment:&lt;/p&gt;

&lt;p&gt;I have tried closing the connection in my tests.&lt;/p&gt;

&lt;p&gt;With this 3 tests failed while running suites.All, namely,&lt;br/&gt;
1) AutomaticIndexStatisticsTests&lt;br/&gt;
2) ReplicationRun_Local_1Indexing&lt;br/&gt;
3) RolesTest&lt;/p&gt;

&lt;p&gt;I tried running these tests individually:&lt;br/&gt;
AutomaticIndexStatisticsTests failed with the following error:&lt;/p&gt;

&lt;p&gt;There was 1 failure:&lt;br/&gt;
1) testShutdownWhileScanningThenDelete(org.apache.derbyTesting.functionTests.tes&lt;br/&gt;
ts.store.AutomaticIndexStatisticsTest)junit.framework.AssertionFailedError: Fail&lt;br/&gt;
ed to delete 3 files (root=F:\eclipsework\testGarbage\system\singleUse\copyShutd&lt;br/&gt;
own: F:\eclipsework\testGarbage\system\singleUse\copyShutdown\seg0\c481.dat (isD&lt;br/&gt;
ir=false, canRead=true, canWrite=true, size=22351872), F:\eclipsework\testGarbag&lt;br/&gt;
e\system\singleUse\copyShutdown\seg0 (isDir=true, canRead=true, canWrite=true, s&lt;br/&gt;
ize=12288), F:\eclipsework\testGarbage\system\singleUse\copyShutdown (isDir=true&lt;br/&gt;
, canRead=true, canWrite=true, size=4096)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertDirectoryDeleted&lt;br/&gt;
(BaseJDBCTestCase.java:1496)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.AutomaticIndexStati&lt;br/&gt;
sticsTest.testShutdownWhileScanningThenDelete(AutomaticIndexStatisticsTest.java:&lt;br/&gt;
188)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:&lt;br/&gt;
112)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57&lt;br/&gt;
)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;br/&gt;
Tests run: 7,  Failures: 1,  Errors: 0&lt;/p&gt;

&lt;p&gt;Other two tests passed.&lt;/p&gt;</comment>
                            <comment id="12999013" author="kristwaa" created="Thu, 24 Feb 2011 19:59:11 +0000"  >&lt;p&gt;The failure in testShutdownWhileScanningThenDelete is most likely an intermittent failure seen on Windows only.&lt;br/&gt;
You can try to run it individually again, or apply patch 1a attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4915&quot; title=&quot;test failure in OSReadOnlyTest in assertDirectoryDeleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4915&quot;&gt;&lt;del&gt;DERBY-4915&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;If the test is failing consistently on your machine, it would be interesting to know if the patch I mentioned helps, and further if adding a sleep after the database shutdown makes the problem go away without the patch.&lt;/p&gt;

&lt;p&gt;Feel free to add a comment to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4915&quot; title=&quot;test failure in OSReadOnlyTest in assertDirectoryDeleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4915&quot;&gt;&lt;del&gt;DERBY-4915&lt;/del&gt;&lt;/a&gt; if you choose to test the patch, or add a sleep (i.e. either directly in the test or by modifying the shutdown method(s) in the test framework).&lt;/p&gt;</comment>
                            <comment id="13002615" author="espinha" created="Fri, 4 Mar 2011 14:16:20 +0000"  >&lt;p&gt;I ran derbyall without any failures, and the failures on suites.All also seem to be unrelated intermittent issues.&lt;/p&gt;

&lt;p&gt;Committed Siddharth&apos;s patch with revision 1077955.&lt;/p&gt;

&lt;p&gt;@ Siddharth, I will now resolve the issue. Please keep an eye on the regression runs for tomorrow and make sure there are no failures (also make sure that these changes are already picked up by that regression run by checking the revision number of the run). If there are no failures, then please go ahead and close the issue on JIRA.&lt;/p&gt;</comment>
                            <comment id="13002662" author="rhillegas" created="Fri, 4 Mar 2011 15:24:30 +0000"  >&lt;p&gt;The previous submission broke the Derby build. Because we are close to generating a release, I have backed out that fix at subversion revision 1077998.&lt;/p&gt;</comment>
                            <comment id="13002691" author="dbrosius@apache.org" created="Fri, 4 Mar 2011 16:24:24 +0000"  >&lt;p&gt;added patch (derby4907_with_contains_fix.diff) that switched the contains to indexOf(..) &amp;gt;= 0 for 1.4 compatibiilty&lt;/p&gt;</comment>
                            <comment id="13003150" author="espinha" created="Sun, 6 Mar 2011 12:20:08 +0000"  >&lt;p&gt;Apologies for breaking the build &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; .&lt;/p&gt;

&lt;p&gt;I hadn&apos;t set up the 1.4 JDK on my server and I also didn&apos;t pick this up on visual inspection. Thank you Dave for the fixed patch. Since this is a really small change that maintains the same functionality, I&apos;m gonna go ahead and commit Dave&apos;s patch so that it makes it to the 10.8.1 release candidate.&lt;/p&gt;

&lt;p&gt;@ Siddharth,&lt;/p&gt;

&lt;p&gt;Due to backwards compatibility issues, we make sure that Derby&apos;s code complies with version 1.4 of the JDK. This means that certain features that were introduced in Java 1.5 and 1.6 can&apos;t be used, as they would break this compatibility with older JDKs. The method .contains() is one of these features.&lt;/p&gt;

&lt;p&gt;What you can do to ensure that your code is 1.4-compliant is download a 1.4 JDK and point to it on the ant.properties file. For more information on how to do this, you can check the BUILDING.html file in the root of Derby&apos;s SVN trunk.&lt;/p&gt;

&lt;p&gt;In very general terms though, you need to create a file called ant.properties, put it on your home directory, and make its contents look something like this: j14lib=/usr/local/bin/jdks/j2sdk1.4.2_19/jre/lib/&lt;/p&gt;

&lt;p&gt;Then when you compile the code using &apos;ant all&apos;, it will automatically try to compile it against the 1.4 JDK.&lt;/p&gt;</comment>
                            <comment id="13003160" author="espinha" created="Sun, 6 Mar 2011 12:27:42 +0000"  >&lt;p&gt;Committed with revision 1078461.&lt;/p&gt;

&lt;p&gt;@ Siddharth,&lt;/p&gt;

&lt;p&gt;Please keep an eye out for regressions and close the issue if everything goes fine.&lt;/p&gt;</comment>
                            <comment id="13004073" author="siddharthsrivastava" created="Tue, 8 Mar 2011 17:22:52 +0000"  >&lt;p&gt;Thanks Tiago for committing and providing useful suggestions.&lt;br/&gt;
Thanks Dave, Rick for your inputs.&lt;/p&gt;</comment>
                            <comment id="13007168" author="kmarsden" created="Tue, 15 Mar 2011 20:47:27 +0000"  >&lt;p&gt;reopen for backport to 10.5&lt;/p&gt;</comment>
                            <comment id="13010756" author="kmarsden" created="Thu, 24 Mar 2011 16:41:55 +0000"  >&lt;p&gt;backported to 10.5. Thanks Siddharth for the fix.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12500370">DERBY-5091</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12471819" name="derby4907.diff" size="5654" author="siddharthsrivastava" created="Thu, 24 Feb 2011 09:12:54 +0000"/>
                            <attachment id="12471475" name="derby4907.diff" size="5602" author="siddharthsrivastava" created="Sat, 19 Feb 2011 17:49:34 +0000"/>
                            <attachment id="12471178" name="derby4907.diff" size="7034" author="siddharthsrivastava" created="Wed, 16 Feb 2011 15:09:17 +0000"/>
                            <attachment id="12471177" name="derby4907.diff" size="7034" author="siddharthsrivastava" created="Wed, 16 Feb 2011 15:07:03 +0000"/>
                            <attachment id="12470175" name="derby4907.txt" size="2531" author="siddharthsrivastava" created="Thu, 3 Feb 2011 18:48:17 +0000"/>
                            <attachment id="12470790" name="derby4907_final.diff" size="5331" author="siddharthsrivastava" created="Thu, 10 Feb 2011 18:17:32 +0000"/>
                            <attachment id="12472686" name="derby4907_with_contains_fix.diff" size="5790" author="dbrosius@apache.org" created="Fri, 4 Mar 2011 16:24:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 30 Jan 2011 16:28:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24523</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10423"><![CDATA[Newcomer]]></customfieldvalue>
    <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    <customfieldvalue key="10427"><![CDATA[Workaround attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0g5b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36434</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10053"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>