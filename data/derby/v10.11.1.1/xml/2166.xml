<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:31:26 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2166/DERBY-2166.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2166] Implement proper handling of SocketTimeoutException in DRDAConnThread</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2166</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;A timeout is set on the session socket (ClientThread) but the SocketTimeoutException is not taken care of. Connections is therefore closed down if derby.drda.timeSlice is set and the client idles longer then the timeslice. See &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1856&quot; title=&quot;Multiple communication failures when starting server with derby.drda.timeSlice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1856&quot;&gt;&lt;del&gt;DERBY-1856&lt;/del&gt;&lt;/a&gt; for more details.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12358114">DERBY-2166</key>
            <summary>Implement proper handling of SocketTimeoutException in DRDAConnThread</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bernt">Bernt M. Johnsen</assignee>
                                    <reporter username="bernt">Bernt M. Johnsen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Dec 2006 10:15:18 +0000</created>
                <updated>Thu, 14 Jun 2007 10:09:32 +0100</updated>
                            <resolved>Fri, 19 Jan 2007 09:14:32 +0000</resolved>
                                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12456755" author="bernt" created="Fri, 8 Dec 2006 10:16:44 +0000"  >&lt;p&gt;SocketTimeoutException was introduced in JDK 1.4&lt;/p&gt;</comment>
                            <comment id="12464762" author="bernt" created="Mon, 15 Jan 2007 12:40:25 +0000"  >&lt;p&gt;This patch catches SocketTimeOutException and throws a DRDASocketTimeoutException which is a subclass of DRDAProtocolException which then again is caught in DRDAConnThread.processCommand(). Not the nicest solution, but does the job.&lt;/p&gt;

&lt;p&gt;Comments please.&lt;/p&gt;</comment>
                            <comment id="12464863" author="bryanpendleton" created="Mon, 15 Jan 2007 17:08:37 +0000"  >&lt;p&gt;I&apos;m having a bit of trouble understanding why this is related to derby.drda.timeSlice. Are you saying that the &lt;b&gt;only&lt;/b&gt; time we will get this exception is if derby.drda.timeSlice was set? &lt;/p&gt;

&lt;p&gt;Also, regarding the change to DRDAConnThread.java, why do you have to catch all DRDAProtocolException and then test to see if you got a DRDASocketTimeoutException? Can you not just specifically catch DRDASocketTimeoutException?&lt;/p&gt;

&lt;p&gt;I guess I find it somewhat confusing to make this new exception be a subclass of DRDAProtocolException. It seems like DRDAProtocolException occurrences generally indicate severe bugs in the code, and this new exception seems like it would be a normal occurrence when time slicing. &lt;/p&gt;</comment>
                            <comment id="12465084" author="knutanders" created="Tue, 16 Jan 2007 09:18:24 +0000"  >&lt;p&gt;In DDMReader, wouldn&apos;t it be better to write&lt;br/&gt;
  catch (SocketTimeoutException ...) &lt;/p&gt;
{...}&lt;br/&gt;
  catch (IOException ...) {...}
&lt;p&gt;instead of&lt;br/&gt;
  catch (IOException ioe) {&lt;br/&gt;
    if (ioe instanceof SocketTimeoutException) &lt;/p&gt;
{
      ...
    } else {
      ...
    }
&lt;p&gt;  }&lt;br/&gt;
?&lt;/p&gt;</comment>
                            <comment id="12465098" author="bernt" created="Tue, 16 Jan 2007 10:03:48 +0000"  >&lt;p&gt;Thanks for the comments.&lt;br/&gt;
Bryan: setSoTimeout() is done in the client thread on the socket only if timeSlice is set, so we will get SocketTimeoutException only in that case in DDMReader.&lt;/p&gt;

&lt;p&gt;Bryan &amp;amp; Knut: All your commets are of course right and I will rewrite my patch.&lt;/p&gt;</comment>
                            <comment id="12465710" author="bernt" created="Thu, 18 Jan 2007 10:32:21 +0000"  >&lt;p&gt;I have attached a new version (v2).  I decided to keep DRDASocketTimeoutException as a subclass to DRDAProtocolException, since I found this the most clean approach to the problem. I tried to make a JUniit test for this, but there&apos;s too much magic going on when running under BaseJDBCTestCase so I couldn&apos;t make it work. Have attached a standalone Jaav program (MaxThreadsTest.java) which verifies this functionality.&lt;/p&gt;</comment>
                            <comment id="12465798" author="bryanpendleton" created="Thu, 18 Jan 2007 16:24:26 +0000"  >&lt;p&gt;I like the new patch better. The comments make it clearer how the new exception works. There&apos;s some tab/space awkwardness in the patch, but other than that I have no additional comments. Thanks for the updated version!&lt;/p&gt;</comment>
                            <comment id="12487513" author="mayureshnirhali" created="Mon, 9 Apr 2007 10:25:27 +0100"  >&lt;p&gt;I downloaded the repro and tried it on latest trunk.&lt;/p&gt;

&lt;p&gt;The repro FAILs on trunk. Are there any special config/seetings needed ??&lt;br/&gt;
I tried to play around with the waitForSeconds values to see if I was hitting any race condition, but this test failed consistently for me.&lt;/p&gt;

&lt;p&gt;here is the output,&lt;br/&gt;
&amp;lt;snip&amp;gt;&lt;br/&gt;
Apache Derby Network Server - 10.3.0.0 alpha - (526662M) started and ready to accept connections on port 1527 at 2007-04-09 09:18:26.286 GMT&lt;br/&gt;
Max threads changed to 1.&lt;br/&gt;
Apache Derby Network Server - 10.3.0.0 alpha - (526662M) shutdown at 2007-04-09 09:18:32.651 GMT&lt;br/&gt;
Apache Derby Network Server - 10.3.0.0 alpha - (526662M) started and ready to accept connections on port 1527 at 2007-04-09 09:18:32.842 GMT&lt;br/&gt;
Time slice changed to 500.&lt;br/&gt;
Max threads changed to 1.&lt;br/&gt;
FAILED!&lt;br/&gt;
Apache Derby Network Server - 10.3.0.0 alpha - (526662M) shutdown at 2007-04-09 09:18:37.475 GMT&lt;br/&gt;
&amp;lt;/snip&amp;gt;&lt;/p&gt;</comment>
                            <comment id="12489029" author="mayureshnirhali" created="Mon, 16 Apr 2007 08:21:57 +0100"  >&lt;p&gt;The fix to the parent issue Derby-1856 was ported to 10.2 and 10.1 trunk. but not this one.&lt;br/&gt;
I think, it will be very good if 2166 fix is ported to 10.2 n 10.1.&lt;/p&gt;



</comment>
                            <comment id="12489082" author="bernt" created="Mon, 16 Apr 2007 12:21:40 +0100"  >&lt;p&gt;This issue can&apos;t be ported to 10.2 or 10.1 since it needs SocketTimeoutException which was introduced in JDK 1.4 while 10.2 and 10.1 supports JDK 1.3.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12357097">DERBY-2121</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12350057">DERBY-1856</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12349149" name="MaxThreadTest.java" size="2684" author="bernt" created="Thu, 18 Jan 2007 10:27:02 +0000"/>
                            <attachment id="12349147" name="derby-2166-v2.diff" size="4343" author="bernt" created="Thu, 18 Jan 2007 10:27:02 +0000"/>
                            <attachment id="12349148" name="derby-2166-v2.stat" size="322" author="bernt" created="Thu, 18 Jan 2007 10:27:02 +0000"/>
                            <attachment id="12348952" name="derby-2166.diff" size="3772" author="bernt" created="Mon, 15 Jan 2007 12:37:42 +0000"/>
                            <attachment id="12348953" name="derby-2166.stat" size="260" author="bernt" created="Mon, 15 Jan 2007 12:37:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 15 Jan 2007 17:08:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30305</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy11w7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39957</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>