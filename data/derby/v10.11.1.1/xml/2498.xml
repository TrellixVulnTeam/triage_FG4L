<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:52:36 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2498/DERBY-2498.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2498] NullPointerException on ClientDataSource.getConnection() when ds.setdatabaseName was invalid </title>
                <link>https://issues.apache.org/jira/browse/DERBY-2498</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The following code snippet:&lt;br/&gt;
               ClientDataSource ds = &lt;br/&gt;
                    (ClientDataSource)JDBCDataSource.getDataSource();&lt;br/&gt;
                // invalid database string&lt;br/&gt;
                ds.setDatabaseName(&quot;jdbc:derby:wombat&quot;);&lt;br/&gt;
                ds.getConnection();&lt;br/&gt;
results (with jdk14) in this stack trace:&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.client.am.ProductLevel.&amp;lt;init&amp;gt;(ProductLevel.java:41)&lt;br/&gt;
	at org.apache.derby.client.net.NetDatabaseMetaData.&amp;lt;init&amp;gt;(NetDatabaseMetaData.java:40)&lt;br/&gt;
	at org.apache.derby.client.net.ClientJDBCObjectFactoryImpl.newNetDatabaseMetaData(ClientJDBCObjectFactoryImpl.java:276)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.newDatabaseMetaData_(NetConnection.java:1144)&lt;br/&gt;
	at org.apache.derby.client.am.Connection.completeConnect(Connection.java:1803)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.completeConnect(NetConnection.java:412)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.initialize(NetConnection.java:297)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.&amp;lt;init&amp;gt;(NetConnection.java:231)&lt;br/&gt;
	at org.apache.derby.client.net.ClientJDBCObjectFactoryImpl.newNetConnection(ClientJDBCObjectFactoryImpl.java:213)&lt;br/&gt;
	at org.apache.derby.jdbc.ClientDataSource.getConnection(ClientDataSource.java:186)&lt;br/&gt;
	at org.apache.derby.jdbc.ClientDataSource.getConnection(ClientDataSource.java:163)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.jdbcapi.DataSourceTest.testJira95ds(DataSourceTest.java:808)&lt;/p&gt;

&lt;p&gt;This is a similar situation as described for EmbeddedDataSource in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-95&quot; title=&quot;NPE when passing in url instead of database name to EmbeddedXADataSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-95&quot;&gt;&lt;del&gt;DERBY-95&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
This bug was found when converting the test for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-95&quot; title=&quot;NPE when passing in url instead of database name to EmbeddedXADataSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-95&quot;&gt;&lt;del&gt;DERBY-95&lt;/del&gt;&lt;/a&gt; to junit - the old test was explicitly creating an EmbeddedDataSource, so, this was never tested for Client (even when running with network server).&lt;br/&gt;
Note, that the similar test for XADataSource, even for client, does not result in an NPE. &lt;br/&gt;
I have not tested PooledDataSource, but it should be checked.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12366037">DERBY-2498</key>
            <summary>NullPointerException on ClientDataSource.getConnection() when ds.setdatabaseName was invalid </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="myrna">Myrna van Lunteren</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Mar 2007 17:30:08 +0100</created>
                <updated>Tue, 30 Jun 2009 17:06:52 +0100</updated>
                            <resolved>Tue, 4 Nov 2008 15:00:15 +0000</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12484928" author="myrna" created="Wed, 28 Mar 2007 18:01:39 +0100"  >&lt;p&gt;ClientConnectionPoolDataSource also gives a NPE if the database set is incorrect. I&apos;ll add a test to the converted checkDataSource.java (DataSourceTest.java).&lt;/p&gt;</comment>
                            <comment id="12641699" author="myrna" created="Wed, 22 Oct 2008 03:52:56 +0100"  >&lt;p&gt;I&apos;ll do some debugging and try to understand how the productID_ is set if we have a databaseName without colons in it., but I was wondering why in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-95&quot; title=&quot;NPE when passing in url instead of database name to EmbeddedXADataSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-95&quot;&gt;&lt;del&gt;DERBY-95&lt;/del&gt;&lt;/a&gt; the solution with XA/Embedded was to catch a null coming back from a getConnection call, in other words, why was there a null coming from a getConnection call.&lt;/p&gt;

&lt;p&gt;It seems to me that this is because in BaseMonitor we look for colons (&apos;:&apos;) in the databaseName passed in, and if we find them (more than one anyway; comments suggest one might be interpreted as being part of a drive indicator on windows) we return the null connection.&lt;/p&gt;

&lt;p&gt;This is a simplification, (we try to figure a suitable protocol) but I think what this means is that we don&apos;t accept database names with a &apos;:&apos; in it.&lt;br/&gt;
Experiments bear this out, e.g. &apos;my:db&apos; also gets thrown out (with Embedded DataSource).&lt;/p&gt;

&lt;p&gt;Is that OK to maintain? If so,  maybe the solution to the NPE with the client DataSource is to add a similar check for colons in NetConnection.checkDatabaseName()?&lt;/p&gt;</comment>
                            <comment id="12644799" author="myrna" created="Mon, 3 Nov 2008 20:24:07 +0000"  >&lt;p&gt;After thought and debugging, I decided looking for a : in checkDatabases was not the right thing to do - it would have duplicated code in InternalDriver. According to the api, Driver.connect() is allowed to return a null connection, so that&apos;s fine - we just shouldn&apos;t continue on from the DataSource.&lt;/p&gt;

&lt;p&gt;I added a check for isConnectionNull() in NetConnection.java, which throws the same SQLException as was implemented for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-95&quot; title=&quot;NPE when passing in url instead of database name to EmbeddedXADataSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-95&quot;&gt;&lt;del&gt;DERBY-95&lt;/del&gt;&lt;/a&gt;, so we get the same result with all three datasources in this situation.&lt;/p&gt;

&lt;p&gt;tests passed (sane jars on windows with jdk16 &amp;amp; ibm15).&lt;br/&gt;
I&apos;ll commit tomorrow unless someone thinks this is a bad idea.&lt;/p&gt;</comment>
                            <comment id="12644979" author="myrna" created="Tue, 4 Nov 2008 15:00:15 +0000"  >&lt;p&gt;Committed the patch with revision 711266. I don&apos;t think this merits a release note, the behavior has only changed in that we now get an appropriate SQLException where before we&apos;d get a NullPointerException.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12388462">DERBY-3407</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12393263" name="DERBY-2498.diff" size="6037" author="myrna" created="Mon, 3 Nov 2008 20:24:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23073</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10423"><![CDATA[Newcomer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0uif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38761</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>