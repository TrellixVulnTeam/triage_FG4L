<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:39:55 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1078/DERBY-1078.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1078] Be able to build Derby when JAVA_HOME is set 1.6</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1078</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Currently, the 1.4 compiler is used to build most of Derby. We use the 1.6 compiler to (optionally) build the JDBC4 support. If you try to build Derby in a shell window with a 1.6 JAVA_HOME, the 1.4 bits will fail to build. This is because those bits do not satisfy the JDBC4 contract. In addition, even if you could build those bits under 1.6, the 1.6 class files would fail to load on a 1.4 vm.&lt;/p&gt;

&lt;p&gt;We need to be able to use 1.6 as our default build environment but still generate jar files which run on 1.4 and 1.5. There may be compiler switches which allow this. If not, building in a 1.6 environment could fault in the 1.4 compiler as necessary.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12329860">DERBY-1078</key>
            <summary>Be able to build Derby when JAVA_HOME is set 1.6</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fuzzylogic">Andrew McIntyre</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Mar 2006 07:49:35 +0000</created>
                <updated>Tue, 13 Jun 2006 05:29:51 +0100</updated>
                            <resolved>Fri, 19 May 2006 03:56:25 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Build tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12369284" author="dagw" created="Wed, 8 Mar 2006 02:52:48 +0000"  >&lt;p&gt;&amp;gt; There may be compiler switches which allow this. If not, building&lt;br/&gt;
&amp;gt; in a 1.6 environment could fault in the 1.4 compiler as necessary.&lt;/p&gt;

&lt;p&gt;This option seems to do it:&lt;/p&gt;

&lt;p&gt;javac --help:&lt;br/&gt;
  :&lt;br/&gt;
  -target &amp;lt;release&amp;gt;          Generate class files for specific VM version&lt;/p&gt;</comment>
                            <comment id="12369285" author="fuzzylogic" created="Wed, 8 Mar 2006 03:04:04 +0000"  >&lt;p&gt;I don&apos;t think Ant has templated tasks yet, it&apos;s been a long-requested feature, but I don&apos;t think it&apos;s been added yet. So, this is possible, but unfortunately you&apos;ll need to update all of the &amp;lt;javac&amp;gt; tasks in the build.xml to include target=&quot;1.4&quot; with the exception, of course, of the new files for 1.6. Should be doable with a pretty simple Perl script.&lt;/p&gt;</comment>
                            <comment id="12369345" author="fuzzylogic" created="Wed, 8 Mar 2006 09:16:58 +0000"  >&lt;p&gt;FYI, I&apos;ve attached a patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-73&quot; title=&quot;Ability to compile under JDK1.5&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-73&quot;&gt;&lt;del&gt;DERBY-73&lt;/del&gt;&lt;/a&gt; that allows updating to JavaCC 4.0, which does not generate code with variables named &apos;enum&apos;. Linking that issue to this. I ran all tests with JavaCC 4.0 and saw no failures. 4.0 also does not contain a bug in JavaCC 3.2 that caused an exception in a rare case involving lookahead.&lt;/p&gt;</comment>
                            <comment id="12370759" author="rhillegas" created="Fri, 17 Mar 2006 05:58:06 +0000"  >&lt;p&gt;Bryan adds:&lt;/p&gt;

&lt;p&gt;Can you use &amp;lt;presetdef&amp;gt; for this? It lets you override/extend tasks and provide additional parms, etc.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://ant.apache.org/manual/CoreTasks/presetdef.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ant.apache.org/manual/CoreTasks/presetdef.html&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://stefan.samaflost.de/blog/en/Apache/Ant/customization_and_user_preferences_with_presetdef.writeback&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://stefan.samaflost.de/blog/en/Apache/Ant/customization_and_user_preferences_with_presetdef.writeback&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="12375155" author="fuzzylogic" created="Thu, 20 Apr 2006 00:52:41 +0100"  >&lt;p&gt;Attached patch adds appropriate source and target attributes to all javac tasks in the build. I want to do a number of tests before submitting this, primarily running a Derby built with a newer build on jdk131 and j9 (=JSR169). But, with this patch, you can now run a full build with Ant running in JDK 1.5 (and thus, with JDK 1.5&apos;s compiler).&lt;/p&gt;</comment>
                            <comment id="12375185" author="rhillegas" created="Thu, 20 Apr 2006 03:01:06 +0100"  >&lt;p&gt;Beautiful. It&apos;s a lot of edits but they have a familiar rhythm to them. Thanks for all this work! After applying the patch, I successfully built under 1.4, 1.5, and 1.6. After each build, I successfully ran the grantRevoke test under 1.4 and the jdbc40 suite under 1.6.&lt;/p&gt;</comment>
                            <comment id="12375225" author="fuzzylogic" created="Thu, 20 Apr 2006 09:23:55 +0100"  >&lt;p&gt;Sanity check on j9, jdk13, and jdk142 look good. Committed derby-1078.diff to trunk with revision 395458. Rick, please resolve and/or close if this takes care of this issue.&lt;/p&gt;</comment>
                            <comment id="12375226" author="fuzzylogic" created="Thu, 20 Apr 2006 09:24:28 +0100"  >&lt;p&gt;Sanity check on j9, jdk13, and jdk142 look good. Committed derby-1078.diff to trunk with revision 395458. Rick, please resolve and/or close if this takes care of this issue.&lt;/p&gt;</comment>
                            <comment id="12375322" author="dyret" created="Thu, 20 Apr 2006 18:29:06 +0100"  >&lt;p&gt;Since revision 395458 I can no longer run jdbcapi/metadata.java with DerbyNetClient under java 1.3.  (Still compiling with 1.4). I get the following error:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.lang.UnsupportedClassVersionError: org/apache/derby/iapi/services/i18n/MessageService (Unsupported major.minor version 48.0)&lt;br/&gt;
        at java.lang.ClassLoader.defineClass0(Native Method)&lt;br/&gt;
        at java.lang.ClassLoader.defineClass(ClassLoader.java:488)&lt;br/&gt;
        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:106)&lt;br/&gt;
        at java.net.URLClassLoader.defineClass(URLClassLoader.java:243)&lt;br/&gt;
        at java.net.URLClassLoader.access$100(URLClassLoader.java:51)&lt;br/&gt;
        at java.net.URLClassLoader$1.run(URLClassLoader.java:190)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
        at java.net.URLClassLoader.findClass(URLClassLoader.java:183)&lt;br/&gt;
        at java.lang.ClassLoader.loadClass(ClassLoader.java:294)&lt;br/&gt;
        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:288)&lt;br/&gt;
        at java.lang.ClassLoader.loadClass(ClassLoader.java:250)&lt;br/&gt;
        at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:310)&lt;br/&gt;
        at org.apache.derby.impl.tools.sysinfo.Main.getCompleteMessage(Main.java:1077)&lt;br/&gt;
        at org.apache.derby.impl.tools.sysinfo.Main.getTextMessage(Main.java:1056)&lt;br/&gt;
        at org.apache.derby.impl.tools.sysinfo.Main.&amp;lt;clinit&amp;gt;(Main.java:316)&lt;br/&gt;
        at org.apache.derby.tools.sysinfo.main(sysinfo.java:52)&lt;br/&gt;
Framework: DerbyNetClient&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;Start: metadata jdk1.3.1_15 DerbyNetClient 2006-04-20 11:17:30 ***&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12375327" author="dyret" created="Thu, 20 Apr 2006 18:39:56 +0100"  >&lt;p&gt;I have looked at the new patch and I think it looks good. Even better than the first which was also good ... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; IMHO, it is ready to be committed.&lt;/p&gt;</comment>
                            <comment id="12375328" author="dyret" created="Thu, 20 Apr 2006 18:41:37 +0100"  >&lt;p&gt;Please ignore the last comment, it was intended for another issue.&lt;/p&gt;</comment>
                            <comment id="12375398" author="fuzzylogic" created="Fri, 21 Apr 2006 01:08:08 +0100"  >&lt;p&gt;So it appears that my initial jdk131 test was misleading. Attaching a patch that at least gets Derby to pass metadata.java, and committed with revision 395643.&lt;/p&gt;

&lt;p&gt;I&apos;ll be running derbyall on jdk131 to clean up any lingering failures.&lt;/p&gt;

&lt;p&gt;One note on the patch: I had to add xercesImpl and xml-apis to tools/java because the compile of the XML datatype ended up pulling in most of iapi/types and iapi/services as side-compiles.&lt;/p&gt;</comment>
                            <comment id="12375458" author="fuzzylogic" created="Fri, 21 Apr 2006 09:25:53 +0100"  >&lt;p&gt;Committed another patch with revision 395749 to get client and demo working with 1.3 when compiled with 1.5 or higher. Unlike the engine, 1.3- and 1.4-dependent code are not well separated.  So, fixed by asking the compiler to generate 1.3-compatible classes, but linked against the 1.4 runtime classes. Client now passes the jdbcapi suite. Also fixed demo just by switching entirely over to 1.3. It was not dependent on any 1.4-specific methods.&lt;/p&gt;

&lt;p&gt;This just leaves scouring the java/testing hierarchy for the remaining classes which should be built as 1.3, but are currently compiled by a 1.4 dependent target. This is quite a few tests, but they are easily identifiable because they error out immediately with UnsupportedClassVersionError.&lt;/p&gt;</comment>
                            <comment id="12375656" author="fuzzylogic" created="Sat, 22 Apr 2006 08:07:05 +0100"  >&lt;p&gt;Committed revision 396035 which fixes the remaining issues in the tests built with JDK 1.5 or higher and then run on JDK 1.3.&lt;/p&gt;</comment>
                            <comment id="12375886" author="knutanders" created="Sun, 23 Apr 2006 23:33:46 +0100"  >&lt;p&gt;The storerecovery tests have failed a couple of days because the files in java/testing/org/apache/derbyTesting/functionTests/util/corruptio/ are no longer compiled. Added the missing files to functionTests/util/build.xml and committed revision 396285.&lt;/p&gt;</comment>
                            <comment id="12376534" author="fuzzylogic" created="Thu, 27 Apr 2006 03:42:34 +0100"  >&lt;p&gt;Committed revision 397278. Fixes XA, encryption and a couple of other tests on 1.3.1. I&apos;m still seeing some diffs in store tests, but they don&apos;t look related to this issue, they look like a timing/harness issue, might just be on my machine. I&apos;ll double check on another platform and follow up later.&lt;/p&gt;</comment>
                            <comment id="12376635" author="fuzzylogic" created="Thu, 27 Apr 2006 12:43:53 +0100"  >&lt;p&gt;I could not reproduce the diffs that I had seen in the store unit tests in a different environment, so I guess this must have been something specific to that particular test environment. So, I think that all potential issues surrounding these changes have been resolved.&lt;/p&gt;

&lt;p&gt;For reference, in case someone sees them in another environment, here is the diff that was present in each of the tests that had the problem:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;Start: recoveryTest jdk1.3.1_16 storeall:storeunit 2006-04-23 10:42:14 ***&lt;br/&gt;
1a2&lt;br/&gt;
&amp;gt; WARNING: Derby (instance xxxxFILTERED-UUIDxxxx) is attempting to boot the data&lt;br/&gt;
base /Users/andrewm/derby/testdir/131/derbyall/storeall/storeunit/storeunit/Reco&lt;br/&gt;
veryTest even though Derby (instance xxxxFILTERED-UUIDxxxx) may still be active.&lt;br/&gt;
  Only one instance of Derby should boot a database at a time. Severe and non-re&lt;br/&gt;
coverable corruption can result and may have already occurred.&lt;br/&gt;
Test Failed.&lt;/li&gt;
			&lt;li&gt;End:   recoveryTest jdk1.3.1_16 storeall:storeunit 2006-04-23 10:42:34 ***&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12377518" author="fuzzylogic" created="Wed, 3 May 2006 14:20:29 +0100"  >&lt;p&gt;Reopening this issue due to ij,jj issue with IBM JDK 1.3.1. See following comment.&lt;/p&gt;</comment>
                            <comment id="12377524" author="fuzzylogic" created="Wed, 3 May 2006 14:52:33 +0100"  >&lt;p&gt;Committed revision 399164. This fixes a couple more tests under jdk131, specifically stress.multi and dataSourcePermissions related tests. This should finally return the jdk131 tests to the state prior to any &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1078&quot; title=&quot;Be able to build Derby when JAVA_HOME is set 1.6&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1078&quot;&gt;&lt;del&gt;DERBY-1078&lt;/del&gt;&lt;/a&gt; changes. See:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://people.apache.org/~fuzzylogic/derby_test_results/main/testlog/jdk131/392471-derbyall_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~fuzzylogic/derby_test_results/main/testlog/jdk131/392471-derbyall_diff.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The testSecMec problem is specific to the test, and it appears we should not run SqlExceptionTest.junit under jdk131 due to its use of the jdk14-specific initCause() method. I believe the DerbyNetAutoStart.java test to be instability in the test. See &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-803&quot; title=&quot;derbynet/DerbyNetAutoStart.java test fails intermittently with org.apache.derby.iapi.services.context.ShutdownException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-803&quot;&gt;&lt;del&gt;DERBY-803&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;BUT, testing with IBM JDK 1.3.1 is showing a huge amount of failures due to a problem with the ij parser. The problem manifests itself as follows:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;Start:  big jdk1.3.1 DerbyNet derbynetmats:derbynetmats 2006-04-30 01:04:17 ***&lt;br/&gt;
4 del&lt;br/&gt;
&amp;lt; 0 rows inserted/updated/deleted&lt;br/&gt;
4a4&lt;br/&gt;
JAVA ERROR: java.lang.NoSuchFieldError: org.apache.derby.tools.ij.ij: field tokenImage not found&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;tokenImage is a String array in the interface ijConstants, which ij.java implements. So, the ij parser should be able to access the array by virtue of inheritence. It&apos;s not clear why the IBM jdk can&apos;t find the tokenImage array in ijConstants. I&apos;m searching for a resolution to the problem, but if I cannot find one, I may have to back all of these changes out after we branch 10.2.&lt;/p&gt;</comment>
                            <comment id="12377601" author="fuzzylogic" created="Thu, 4 May 2006 01:32:07 +0100"  >&lt;p&gt;If I qualify the inherit references to tokenImage in both ij.java and SQLParser.java by adding their classnames (e.g. in ij.java, tokenImage --&amp;gt; ijConstants.tokenImage, and in SQLParser.java, tokenImage --&amp;gt; SQLParserConstants.tokenImage) then the tests pass. So, as a workaround I&apos;d like to sed the classname into the generated file at build time.&lt;/p&gt;

&lt;p&gt;This clearly appears to be a JVM issue with IBM JDK 1.3.1, but if there are no objections, I&apos;d like to put in this workaround until support for JDK 1.3.1 is removed.&lt;/p&gt;</comment>
                            <comment id="12377609" author="rhillegas" created="Thu, 4 May 2006 02:39:11 +0100"  >&lt;p&gt;Hi Andrew,&lt;/p&gt;

&lt;p&gt;You can use the ant &amp;lt;replace&amp;gt; task for this. Thanks for digging into this problem!&lt;/p&gt;</comment>
                            <comment id="12377611" author="fuzzylogic" created="Thu, 4 May 2006 03:13:09 +0100"  >&lt;p&gt;Attaching patch3 to resolve the problem with the parsers in IBM JDK 1.3.1 mentioned above. I will commit this shortly if there are no objections.&lt;/p&gt;</comment>
                            <comment id="12377645" author="fuzzylogic" created="Thu, 4 May 2006 05:54:13 +0100"  >&lt;p&gt;Committed patch3 with revision 399450.&lt;/p&gt;</comment>
                            <comment id="12412410" author="fuzzylogic" created="Fri, 19 May 2006 03:56:25 +0100"  >&lt;p&gt;Marking this resolved. JDK 1.3.1 tests show several problems, but none related to this issue:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://people.apache.org/~fuzzylogic/derby_test_results/main/testSummary-405977.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~fuzzylogic/derby_test_results/main/testSummary-405977.html&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="28514">DERBY-73</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12325567" name="derby-1078.diff" size="34103" author="fuzzylogic" created="Thu, 20 Apr 2006 00:52:41 +0100"/>
                            <attachment id="12325628" name="derby-1078_part2.diff" size="21432" author="fuzzylogic" created="Fri, 21 Apr 2006 01:08:08 +0100"/>
                            <attachment id="12326210" name="derby-1078_part3.diff" size="2035" author="fuzzylogic" created="Thu, 4 May 2006 03:13:09 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 8 Mar 2006 02:52:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29849</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy165b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40646</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>