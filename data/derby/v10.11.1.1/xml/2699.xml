<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:41:00 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2699/DERBY-2699.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2699] performance of like in territory based collation databases may be improved by changing way collation elements are calculated.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2699</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;WorkHorseForCollatorDatatypes.java has a method getCollationElementsForString() which currently gets&lt;br/&gt;
called when processing like clauses in databases that have been created with territory based collation, this is&lt;br/&gt;
not an issue in pre-10.3 databases or post 10.3 default databases.&lt;br/&gt;
getCollationElementsForString gets the collation elements for the entire  value of the String held by&lt;br/&gt;
the datatype using the class.&lt;/p&gt;

&lt;p&gt;If you take the case of pattern &apos;A%&apos; and the value of datatype is &apos;BXXXXXXXXXXXXXXXXXXXXXXX&apos;, &lt;br/&gt;
then it would have been better to  better to get collation elements one character of the String value at a time&lt;br/&gt;
to avoid the  process of getting collation elements for the entire string when we don&apos;t really need it &lt;br/&gt;
One could imagine this might have a huge performance impact on running like against a long clob where&lt;br/&gt;
the like pattern has leading fixed-length pattern to match.&lt;/p&gt;

&lt;p&gt;Comments on this from Dan and Dag can be found in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2416&quot; title=&quot;Provide collation sensitive subclasses for SQLChar, SQLVarchar, SQLLongvarchar and SQLClob which will use the passed Collator to do the collation rather than the default collation of UCS_BASIC&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2416&quot;&gt;&lt;del&gt;DERBY-2416&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12370313">DERBY-2699</key>
            <summary>performance of like in territory based collation databases may be improved by changing way collation elements are calculated.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mamtas">Mamta A. Satoor</assignee>
                                    <reporter username="mikem">Mike Matrigali</reporter>
                        <labels>
                            <label>derby_triage10_10</label>
                    </labels>
                <created>Sat, 26 May 2007 01:21:51 +0100</created>
                <updated>Mon, 5 Aug 2013 07:35:12 +0100</updated>
                            <resolved>Thu, 3 Jan 2013 12:02:46 +0000</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.9.2.2</fixVersion>
                    <fixVersion>10.10.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12525494" author="djd" created="Thu, 6 Sep 2007 19:40:04 +0100"  >&lt;p&gt;I think the approach of getting collation elements as needed would have a large affect on all string comparisons.&lt;/p&gt;

&lt;p&gt;I created a scale 4 order entry database with and without a collated database. Just looking at the load collation will only affect &apos;index.sql&apos; which creates an index including the customer&apos;s last name. With UCS_BASIC collation the index created in about 2.5 seconds, with TERRITORY_BASED collation the time was over 11 seconds.&lt;/p&gt;

&lt;p&gt;I don&apos;t think that the collation overhead should be that high, I would expect maybe a 10-20% overhead, not around 450%&lt;/p&gt;</comment>
                            <comment id="13542214" author="knutanders" created="Wed, 2 Jan 2013 16:21:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3136&quot; title=&quot;Cut down on object creations in LIKE clause implementation of territory based characters.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3136&quot;&gt;&lt;del&gt;DERBY-3136&lt;/del&gt;&lt;/a&gt; improved the LIKE implementation along the lines suggested in this issue, so now WorkHorseForCollatorDatatypes.getCollationElementsForString() is only used for checking that the ESCAPE clause of a LIKE ... ESCAPE ... expression does not contain more than a single collation element (for example to disallow &apos;&#223;&apos; in an ESCAPE clause, as it has two collation elements).&lt;/p&gt;

&lt;p&gt;Since it&apos;s only used for ESCAPE clauses now, and they are typically just a single character, the performance benefits are probably not that big anymore. But we can simplify how the collation elements are calculated now that we only need to check if it&apos;s a single element. For example, there is no need to have an intermediate int[] representation of the collation elements.&lt;/p&gt;

&lt;p&gt;Attached is a patch that removes the getCollationElementsForString() and getCountOfCollationElements() methods from WorkHorseForCollatorDatatypes, CollationElementsInterface, and all classes that implement CollationElementsInterface. Those methods are replaced by a simpler hasSingleCollationElement() method.&lt;/p&gt;

&lt;p&gt;This shrinks the source files by approximately 100 lines in addition to reducing the number of objects allocated when evaluating LIKE ... ESCAPE with territory based collation, which might (perhaps) slightly improve the performance.&lt;/p&gt;

&lt;p&gt;I&apos;m running the full regression test suite on the patch now.&lt;/p&gt;</comment>
                            <comment id="13542394" author="knutanders" created="Wed, 2 Jan 2013 20:49:50 +0000"  >&lt;p&gt;All the regression tests ran cleanly.&lt;/p&gt;</comment>
                            <comment id="13542882" author="knutanders" created="Thu, 3 Jan 2013 12:02:47 +0000"  >&lt;p&gt;Committed revision 1428305.&lt;/p&gt;

&lt;p&gt;I&apos;m resolving the issue now since we no longer retrieve all collation elements.&lt;/p&gt;</comment>
                            <comment id="13729048" author="mamtas" created="Mon, 5 Aug 2013 01:47:00 +0100"  >&lt;p&gt;Working on backporting this jira&lt;/p&gt;</comment>
                            <comment id="13729081" author="jira-bot" created="Mon, 5 Aug 2013 03:49:10 +0100"  >&lt;p&gt;Commit 1510366 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt; in branch &apos;code/branches/10.9&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1510366&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1510366&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2699&quot; title=&quot;performance of like in territory based collation databases may be improved by changing way collation elements are calculated.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2699&quot;&gt;&lt;del&gt;DERBY-2699&lt;/del&gt;&lt;/a&gt;(performance of like in territory based collation databases may be improved by changing way collation elements are calculated.)&lt;/p&gt;

&lt;p&gt;Backporting to 10.9. Fix contributed by Knut Anders Hatlen&lt;/p&gt;</comment>
                            <comment id="13729138" author="jira-bot" created="Mon, 5 Aug 2013 07:35:12 +0100"  >&lt;p&gt;Commit 1510373 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt; in branch &apos;code/branches/10.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1510373&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1510373&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2699&quot; title=&quot;performance of like in territory based collation databases may be improved by changing way collation elements are calculated.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2699&quot;&gt;&lt;del&gt;DERBY-2699&lt;/del&gt;&lt;/a&gt;(performance of like in territory based collation databases may be improved by changing way collation elements are calculated.)&lt;/p&gt;

&lt;p&gt;Backporting to 10.8. Fix contributed by Knut Anders Hatlen&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12370310">DERBY-2698</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12380740">DERBY-3136</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12562920" name="d2699-1a.diff" size="11869" author="knutanders" created="Wed, 2 Jan 2013 16:21:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 6 Sep 2007 18:40:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30569</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy08ev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35181</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>