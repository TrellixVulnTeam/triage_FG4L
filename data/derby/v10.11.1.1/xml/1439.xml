<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:09:09 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1439/DERBY-1439.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1439] Investigate removing the antiGC thread in embedded Derby</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1439</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The antiGC thread was originally created to avoid the DriverManager class being garbage collected when no refrences existed to it and it had loaded the embedded JDBC driver (and hence shutting down the engine). This was an issue with JDK 1.1. Since Derby does not support jdk1.1 and garbage collection of classes is clearly defined, it is possible the thread serves no useful purpose.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12344799">DERBY-1439</key>
            <summary>Investigate removing the antiGC thread in embedded Derby</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="djd">Daniel John Debrunner</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Jun 2006 00:39:48 +0100</created>
                <updated>Mon, 17 Jun 2013 10:19:30 +0100</updated>
                            <resolved>Tue, 26 Oct 2010 14:49:13 +0100</resolved>
                                                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12920179" author="knutanders" created="Tue, 12 Oct 2010 14:09:10 +0100"  >&lt;p&gt;I tried the naive approach to removing AntiGC (see the attached patch1.diff), but that led to many IllegalThreadStateExceptions in suites.All. This can also be seen by shutting down the only booted database and rebooting it in the same JVM:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; connect &apos;jdbc:derby:db1;create=true&apos;;&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby:db1;shutdown=true&apos;;&lt;br/&gt;
ERROR 08006: Database &apos;db1&apos; shutdown.&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby:db1&apos;;&lt;br/&gt;
ERROR XJ040: Failed to start database &apos;db1&apos; with class loader sun.misc.Launcher$AppClassLoader@fabe9, see the next exception for details.&lt;br/&gt;
ERROR XJ001: Java exception: &apos;: java.lang.IllegalThreadStateException&apos;.&lt;/p&gt;

&lt;p&gt;The problem with removing AntiGC is that BaseMonitor has a daemon ThreadGroup in which all service threads are started. Since the thread group is a daemon group, it will be destroyed automatically when its thread count becomes zero. AntiGC would prevent the thread group from being destroyed as long as the driver was loaded, since it would stay alive until the driver was unloaded and keep the thread count greater than zero. When there is no AntiGC thread to keep up the thread count, it may go down to zero on database shutdown, as in the example above, even if the driver is still loaded. The next attempt to start a service thread will then fail, since one cannot add threads to a destroyed thread group.&lt;/p&gt;

&lt;p&gt;I suppose we could make the thread group a non-daemon group and destroy it manually when the driver is unloaded, but then we&apos;d first have to wait for all service threads to complete, which may introduce possibilities for hangs on system shutdown (for example because of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-594&quot; title=&quot;Some rawStoreDaemon threads are not stopped&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-594&quot;&gt;&lt;del&gt;DERBY-594&lt;/del&gt;&lt;/a&gt;). Another option may be to detect that this has happened and create a new daemon group when needed.&lt;/p&gt;</comment>
                            <comment id="12923423" author="knutanders" created="Thu, 21 Oct 2010 13:34:09 +0100"  >&lt;p&gt;Attaching a new patch that addresses the problem with the first patch. The patch makes the following changes:&lt;/p&gt;

&lt;p&gt;M       java/engine/org/apache/derby/impl/services/monitor/BaseMonitor.java&lt;/p&gt;

&lt;p&gt;Remove the AntiGC class and the code that starts and stops the AntiGC thread.&lt;/p&gt;

&lt;p&gt;M       java/engine/org/apache/derby/iapi/services/i18n/MessageService.java&lt;/p&gt;

&lt;p&gt;Make setFinder() void since its return value is no longer used.&lt;/p&gt;

&lt;p&gt;M       java/engine/org/apache/derby/impl/services/monitor/FileMonitor.java&lt;/p&gt;

&lt;p&gt;Create a new daemon thread group if all the previously booted databases have been shut down and the old thread group have been destroyed.&lt;/p&gt;

&lt;p&gt;All the regression tests ran cleanly with the patch.&lt;/p&gt;</comment>
                            <comment id="12924968" author="knutanders" created="Tue, 26 Oct 2010 14:49:13 +0100"  >&lt;p&gt;I&apos;ve committed the patch (revision 1027552) so that we get more testing of it before 10.7. Hopefully, it doesn&apos;t cause any problems, but if it does, we can back it out from the 10.7 branch.&lt;/p&gt;</comment>
                            <comment id="13685264" author="knutanders" created="Mon, 17 Jun 2013 10:19:30 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12457746" name="d1439.diff" size="6385" author="knutanders" created="Thu, 21 Oct 2010 13:34:09 +0100"/>
                            <attachment id="12456962" name="patch1.diff" size="3600" author="knutanders" created="Tue, 12 Oct 2010 14:09:10 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 12 Oct 2010 13:09:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29993</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0onr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37813</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>