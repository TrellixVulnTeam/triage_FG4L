<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:50:17 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2933/DERBY-2933.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2933] When  network server disconnects due to an I/O Exception it does not always log the exception that caused the error</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2933</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I found this issue when debugging  my attempted fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2892&quot; title=&quot;Closing a resultset after retrieving a large &amp;gt; 32665 bytes value with Network Server does not release locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2892&quot;&gt;&lt;del&gt;DERBY-2892&lt;/del&gt;&lt;/a&gt;.  The I/O Exception that occurs in writeScalarStream is not logged.  To reproduce apply the patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2892&quot; title=&quot;Closing a resultset after retrieving a large &amp;gt; 32665 bytes value with Network Server does not release locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2892&quot;&gt;&lt;del&gt;DERBY-2892&lt;/del&gt;&lt;/a&gt; and run the repro there.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12373682">DERBY-2933</key>
            <summary>When  network server disconnects due to an I/O Exception it does not always log the exception that caused the error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                            <label>derby_triage10_9</label>
                    </labels>
                <created>Thu, 12 Jul 2007 23:36:27 +0100</created>
                <updated>Tue, 21 Feb 2012 19:35:11 +0000</updated>
                                            <version>10.2.2.1</version>
                                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12512295" author="kmarsden" created="Thu, 12 Jul 2007 23:37:17 +0100"  >&lt;p&gt;Reproducible case is in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2892&quot; title=&quot;Closing a resultset after retrieving a large &amp;gt; 32665 bytes value with Network Server does not release locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2892&quot;&gt;&lt;del&gt;DERBY-2892&lt;/del&gt;&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="12517042" author="kmarsden" created="Wed, 1 Aug 2007 19:37:17 +0100"  >&lt;p&gt;Attached is a patch that logs the IO/exceptions and other events that cause markCommunicationsFailure to be called.  This change caused testNetworkServerSecurityMechanism to start logging  this error. I am investigating that, but the patch to turn on the logging should not be committed until this is resolved.&lt;/p&gt;


&lt;p&gt;testNetworkServerSecurityMechanism(org.apache.derbyTesting.functionTests.tests.derbynet.NSSecurityMechanismTest)&lt;br/&gt;
java.lang.Exception: totalBytesRead &amp;lt; minimumBytesNeeded&lt;br/&gt;
	at org.apache.derby.impl.drda.DDMReader.fill(DDMReader.java:1936)&lt;br/&gt;
	at org.apache.derby.impl.drda.DDMReader.ensureALayerDataInBuffer(DDMReader.java:1651)&lt;br/&gt;
	at org.apache.derby.impl.drda.DDMReader.readDssHeader(DDMReader.java:321)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:677)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:275)&lt;/p&gt;</comment>
                            <comment id="12517074" author="kmarsden" created="Wed, 1 Aug 2007 21:55:29 +0100"  >&lt;p&gt;The error occurs whenever the datbase is shutdown and can be reproduced with this script.&lt;br/&gt;
It seems there is some cleanup needed of DDMReader  when a severe error occurs.&lt;/p&gt;

&lt;p&gt;ij&amp;gt; connect &apos;jdbc:derby://localhost:1527/wombat;create=true&apos;;&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby://localhost:1527/;shutdown=true&apos;;&lt;br/&gt;
totalBytesRead &amp;lt; minimumBytesNeeded&lt;br/&gt;
java.lang.Exception: totalBytesRead &amp;lt; minimumBytesNeeded&lt;br/&gt;
        at org.apache.derby.impl.drda.DDMReader.fill(DDMReader.java:1936)&lt;br/&gt;
        at org.apache.derby.impl.drda.DDMReader.ensureALayerDataInBuffer(DDMReader.java:1651)&lt;br/&gt;
        at org.apache.derby.impl.drda.DDMReader.readDssHeader(DDMReader.java:321)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:680)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:275)&lt;br/&gt;
ERROR XJ015: DERBY SQL error: SQLCODE: -1, SQLSTATE: XJ015, SQLERRMC: Derby system shutdown.&lt;/p&gt;</comment>
                            <comment id="12517118" author="kmarsden" created="Thu, 2 Aug 2007 00:38:48 +0100"  >&lt;p&gt;Here is another attempt at a patch.  I am not really all that pleased with it as I fear it may still gobble some unexpected exceptions.  This patch is the same as the first except for it does not log an exception for 1) SocketExceptions which are usually the client disconnecting.&lt;br/&gt;
2)The case where DDMReader.fill() expects bytes but gets none.   This is the case when the database is shutdown.&lt;/p&gt;

&lt;p&gt;I&apos;d appreciate if someone can take a look. At least the patch does have the advantage that it will log some of the exceptions that were not being logged before. It is just a question of whether that is good enough.&lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;
</comment>
                            <comment id="12517594" author="kmarsden" created="Fri, 3 Aug 2007 18:30:27 +0100"  >&lt;p&gt;Unassigning myself from this issue and reducing to minor. I fixed the error to log in writeScalarStream but there are still occassions where markCommunicationsFailure is called without logging, most notably when the server is brought down and active sessions are terminated.  I left this as is.  I am not sure if unexpected exceptions might still be left unlogged, so I am leaving this open.&lt;/p&gt;


&lt;p&gt;Kathey&lt;/p&gt;</comment>
                            <comment id="12518121" author="bernt" created="Tue, 7 Aug 2007 10:20:17 +0100"  >&lt;p&gt;The exception handling in the network server should be taken into consideration in  &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2412&quot; title=&quot;Refactor NetworkServerControlImpl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2412&quot;&gt;DERBY-2412&lt;/a&gt;. That should probably solve this in a decent way.&lt;/p&gt;</comment>
                            <comment id="12727631" author="rhillegas" created="Mon, 6 Jul 2009 18:39:44 +0100"  >&lt;p&gt;Triage for 10.5.2: Assign normal urgency; note that has reproducible test case.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12372921">DERBY-2892</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12364338">DERBY-2412</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12362990" name="DERBY-2933_no_commit_diff.txt" size="4333" author="kmarsden" created="Wed, 1 Aug 2007 19:37:17 +0100"/>
                            <attachment id="12363015" name="derby-2933_diff.txt" size="5487" author="kmarsden" created="Thu, 2 Aug 2007 00:38:47 +0100"/>
                            <attachment id="12363016" name="derby-2933_stat.txt" size="185" author="kmarsden" created="Thu, 2 Aug 2007 00:39:14 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 7 Aug 2007 09:20:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23326</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0d8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35963</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>