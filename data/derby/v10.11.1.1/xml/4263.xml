<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:47:29 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4263/DERBY-4263.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4263] PropertySetter isn&apos;t able to recognize JDK without version number in path</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4263</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;With empty ant.properties and JDK 6 installed in /tmp/jdk as the only JDK on the system, PropertySetter complains that it&apos;s not able to set java16compile.classpath:&lt;/p&gt;

&lt;p&gt;,----&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; PropertySetter environment =&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; java.vendor = Sun Microsystems Inc.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; java.home = /tmp/jdk/jre&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; java.version = 1.6.0_13&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; os.name = SunOS&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; j14lib = null&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; j15lib = null&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; j16lib = null&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; BUILD FAILED&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; /code/derby/trunk0/build.xml:203: Don&apos;t know how to set java15compile.classpath, java16compile.classpath using this environment:&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; java.vendor = Sun Microsystems Inc.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; java.home = /tmp/jdk/jre&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; java.version = 1.6.0_13&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; os.name = SunOS&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; j14lib = null&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; j15lib = null&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; j16lib = null&lt;br/&gt;
`----&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;Since it is able to detect both that the version of the default JDK is 1.6.0_13 and where it is installed, setting java16compile.classpath should be trivial.&lt;/p&gt;

&lt;p&gt;If the name of the JDK directory is changed from /tmp/jdk to /tmp/jdk1.6.0, Derby is built successfully.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12427415">DERBY-4263</key>
            <summary>PropertySetter isn&apos;t able to recognize JDK without version number in path</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Jun 2009 00:26:06 +0100</created>
                <updated>Tue, 18 Oct 2011 20:57:43 +0100</updated>
                            <resolved>Fri, 7 Aug 2009 10:56:58 +0100</resolved>
                                    <version>10.6.1.0</version>
                                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>Build tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12721301" author="kristwaa" created="Thu, 18 Jun 2009 16:24:55 +0100"  >&lt;p&gt;I have written an alternative algorithm for detecting JDKs. It is using the same basics as the existing one, but instead of looking at the directory name it looks for specific JAR files.&lt;br/&gt;
The new code has been tested lightly on Solaris, Linux and Windows, and has worked with JDKs from Sun, IBM and Oracle/BEA. It doesn&apos;t work with Apache Harmony, and I haven&apos;t looked at IcedTea.&lt;br/&gt;
The new algorithm will first try to pick the newest JDK from the same vendor as the running JDK, and if that fails it will pick the newest JDK from any vendor.&lt;br/&gt;
If the new algorithm doesn&apos;t find the required JDKs, the old algorithm will be attempted.&lt;br/&gt;
Note that I changed the property setter to go ahead also if the JDK vendor isn&apos;t recognized. I don&apos;t really see a reason for aborting. Does anyone disagree?&lt;br/&gt;
The PropertySetter should behave as before for the Mac, but testing wouldn&apos;t hurt!&lt;/p&gt;

&lt;p&gt;There are many possible combinations, so it would be nice if people could take the new code for a test spin!&lt;/p&gt;


&lt;p&gt;Here&apos;s the output from running &quot;ant -DprintCompilerProperties&quot; (btw, using less gives you more &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ) on a system of mine:&lt;/p&gt;

&lt;p&gt;printCompilerProperties:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Before setting properties:  compilerPropsAlreadySet = $&lt;/p&gt;
{compilerPropsAlreadySet}
&lt;p&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Before setting properties:  compilerLevel16 = 1.5&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Before setting properties:  jsr169compile.classpath = $&lt;/p&gt;
{jsr169compile.classpath}
&lt;p&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Before setting properties:  j14lib = $&lt;/p&gt;
{j14lib}&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Before setting properties:  java14compile.classpath = ${java14compile.classpath}&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Before setting properties:  j15lib = ${j15lib}&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Before setting properties:  java15compile.classpath = ${java15compile.classpath}&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Before setting properties:  j16lib = ${j16lib}&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Before setting properties:  java16compile.classpath = ${java16compile.classpath}&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; PropertySetter environment =&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; java.vendor = Sun Microsystems Inc.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; java.home = /tmp/myjdk/jre&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; java.version = 1.5.0_16&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; os.name = SunOS&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; j14lib = null&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; j15lib = null&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; j16lib = null&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; jdkSearchPath = /tmp, /usr/jdk&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; found JDK: vendor=Sun Microsystems, Inc., specVersion=1.5, implVersion=1.5.0_16, path=/tmp/myjdk&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; found JDK: vendor=Sun Microsystems, Inc., specVersion=1.6, implVersion=1.6.0_11, path=/usr/jdk/jdk1.6.0_11&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; found JDK: vendor=Sun Microsystems, Inc., specVersion=1.5, implVersion=1.5.0_17, path=/usr/jdk/jdk1.5.0_17&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; found JDK: vendor=Sun Microsystems, Inc., specVersion=1.6, implVersion=1.6.0_13, path=/usr/jdk/latest&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; found JDK: vendor=Sun Microsystems, Inc., specVersion=1.4, implVersion=1.4.2_18, path=/usr/jdk/j2sdk1.4.2_18&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; found JDK: vendor=Sun Microsystems, Inc., specVersion=1.6, implVersion=1.6.0_14, path=/usr/jdk/jdk1.6.0_14&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; found JDK: vendor=Sun Microsystems, Inc., specVersion=1.6, implVersion=1.6.0_13, path=/usr/jdk/jdk1.6.0_13&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; found JDK: vendor=Sun Microsystems, Inc., specVersion=1.5, implVersion=1.5.0_16, path=/usr/jdk/jdk1.5.0_16&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; found JDK: vendor=Sun Microsystems, Inc., specVersion=1.6, implVersion=1.7.0-ea, path=/usr/jdk/jdk1.7.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; found JDK: vendor=Sun Microsystems, Inc., specVersion=1.6, implVersion=1.6.0_14-ea, path=/usr/jdk/jdk1.6.0_14-ea&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; Chosen JDK for specification version 1.4 (vendor Sun Microsystems Inc.): vendor=Sun Microsystems, Inc., specVersion=1.4, implVersion=1.4.2_18, path=/usr/jdk/j2sdk1.4.2_18&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; Chosen JDK for specification version 1.5 (vendor Sun Microsystems Inc.): vendor=Sun Microsystems, Inc., specVersion=1.5, implVersion=1.5.0_17, path=/usr/jdk/jdk1.5.0_17&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; Chosen JDK for specification version 1.6 (vendor Sun Microsystems Inc.): vendor=Sun Microsystems, Inc., specVersion=1.6, implVersion=1.6.0_14, path=/usr/jdk/jdk1.6.0_14&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; Setting property java14compile.classpath to /usr/jdk/j2sdk1.4.2_18/jre/lib/charsets.jar:/usr/jdk/j2sdk1.4.2_18/jre/lib/jce.jar:/usr/jdk/j2sdk1.4.2_18/jre/lib/jsse.jar:/usr/jdk/j2sdk1.4.2_18/jre/lib/plugin.jar:/usr/jdk/j2sdk1.4.2_18/jre/lib/rt.jar:/usr/jdk/j2sdk1.4.2_18/jre/lib/sunrsasign.jar&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; Setting property java15compile.classpath to /usr/jdk/jdk1.5.0_17/jre/lib/charsets.jar:/usr/jdk/jdk1.5.0_17/jre/lib/deploy.jar:/usr/jdk/jdk1.5.0_17/jre/lib/javaws.jar:/usr/jdk/jdk1.5.0_17/jre/lib/jce.jar:/usr/jdk/jdk1.5.0_17/jre/lib/jsse.jar:/usr/jdk/jdk1.5.0_17/jre/lib/plugin.jar:/usr/jdk/jdk1.5.0_17/jre/lib/rt.jar&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; Setting property java16compile.classpath to /usr/jdk/jdk1.6.0_14/jre/lib/alt-rt.jar:/usr/jdk/jdk1.6.0_14/jre/lib/charsets.jar:/usr/jdk/jdk1.6.0_14/jre/lib/deploy.jar:/usr/jdk/jdk1.6.0_14/jre/lib/javaws.jar:/usr/jdk/jdk1.6.0_14/jre/lib/jce.jar:/usr/jdk/jdk1.6.0_14/jre/lib/jsse.jar:/usr/jdk/jdk1.6.0_14/jre/lib/management-agent.jar:/usr/jdk/jdk1.6.0_14/jre/lib/plugin.jar:/usr/jdk/jdk1.6.0_14/jre/lib/resources.jar:/usr/jdk/jdk1.6.0_14/jre/lib/rt.jar&lt;br/&gt;
&lt;br/&gt;
printCompilerProperties:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; After setting properties:  compilerPropsAlreadySet = true&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; After setting properties:  compilerLevel16 = 1.5&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; After setting properties:  jsr169compile.classpath = /export/home/kw160128/derby/wdir/trunk-merge-basin/classes/stubs/jsr169:/usr/jdk/j2sdk1.4.2_18/jre/lib/charsets.jar:/usr/jdk/j2sdk1.4.2_18/jre/lib/jce.jar:/usr/jdk/j2sdk1.4.2_18/jre/lib/jsse.jar:/usr/jdk/j2sdk1.4.2_18/jre/lib/plugin.jar:/usr/jdk/j2sdk1.4.2_18/jre/lib/rt.jar:/usr/jdk/j2sdk1.4.2_18/jre/lib/sunrsasign.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; After setting properties:  j14lib = ${j14lib}
&lt;p&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; After setting properties:  java14compile.classpath = /usr/jdk/j2sdk1.4.2_18/jre/lib/charsets.jar:/usr/jdk/j2sdk1.4.2_18/jre/lib/jce.jar:/usr/jdk/j2sdk1.4.2_18/jre/lib/jsse.jar:/usr/jdk/j2sdk1.4.2_18/jre/lib/plugin.jar:/usr/jdk/j2sdk1.4.2_18/jre/lib/rt.jar:/usr/jdk/j2sdk1.4.2_18/jre/lib/sunrsasign.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; After setting properties:  j15lib = $&lt;/p&gt;
{j15lib}
&lt;p&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; After setting properties:  java15compile.classpath = /usr/jdk/jdk1.5.0_17/jre/lib/charsets.jar:/usr/jdk/jdk1.5.0_17/jre/lib/deploy.jar:/usr/jdk/jdk1.5.0_17/jre/lib/javaws.jar:/usr/jdk/jdk1.5.0_17/jre/lib/jce.jar:/usr/jdk/jdk1.5.0_17/jre/lib/jsse.jar:/usr/jdk/jdk1.5.0_17/jre/lib/plugin.jar:/usr/jdk/jdk1.5.0_17/jre/lib/rt.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; After setting properties:  j16lib = $&lt;/p&gt;
{jdk16}
&lt;p&gt;/jre/lib&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; After setting properties:  java16compile.classpath = /usr/jdk/jdk1.6.0_14/jre/lib/alt-rt.jar:/usr/jdk/jdk1.6.0_14/jre/lib/charsets.jar:/usr/jdk/jdk1.6.0_14/jre/lib/deploy.jar:/usr/jdk/jdk1.6.0_14/jre/lib/javaws.jar:/usr/jdk/jdk1.6.0_14/jre/lib/jce.jar:/usr/jdk/jdk1.6.0_14/jre/lib/jsse.jar:/usr/jdk/jdk1.6.0_14/jre/lib/management-agent.jar:/usr/jdk/jdk1.6.0_14/jre/lib/plugin.jar:/usr/jdk/jdk1.6.0_14/jre/lib/resources.jar:/usr/jdk/jdk1.6.0_14/jre/lib/rt.jar&lt;/p&gt;
</comment>
                            <comment id="12721334" author="rhillegas" created="Thu, 18 Jun 2009 17:34:36 +0100"  >&lt;p&gt;Thanks for this patch, Kristian. After applying it, the build runs cleanly for me on Mac OS X using both the default Java 5 compiler and the beta Java 6 compiler. I have a couple comments on the patch:&lt;/p&gt;

&lt;p&gt;o Class header for PropertySetter: In the third bullet, it&apos;s unclear whether version refers to the &quot;specification version&quot; or to the &quot;implementation version&quot;. I think the bullet means to say that for each specification version (VM level), we pick the latest implementation version (release number) at that level, regardless of which vendor created the VM release.&lt;/p&gt;

&lt;p&gt;o getJreLib() - header needs a descriptive paragraph in addition to the parameter and return value annotations&lt;/p&gt;

&lt;p&gt;o getJreLib() - a normalization operation (vendor.replaceAll(&quot;,&quot;, &quot;&quot;)) is applied to two strings before comparing them. I think it would be easier to understand if the normalization operation were factored out into a common method. That will also make the code less brittle if we need to improve this normalization later on.&lt;/p&gt;

&lt;p&gt;You asked the following: &quot;Note that I changed the property setter to go ahead also if the JDK vendor isn&apos;t recognized. I don&apos;t really see a reason for aborting. Does anyone disagree?&quot; The advantage of doing it the way you propose is that the build will not fail in cases where it really can just soldier on. The advantage of the abort is that it gives the developer some diagnostic information about what the real problem is in case the build tries to soldier on but trips over an impedance mismatch during compilation. A solution which provided both benefits might be this: If the JDK vendor isn&apos;t recognized, soldier on but first print out a diagnostic message saying that the vendor isn&apos;t recognized and this may confuse the build later on.&lt;/p&gt;</comment>
                            <comment id="12728548" author="kristwaa" created="Wed, 8 Jul 2009 08:53:29 +0100"  >&lt;p&gt;Thanks for the comments, Rick.&lt;/p&gt;

&lt;p&gt;I haven&apos;t forgotten this issue, but I have put it on hold for the time being. I hope I can return to it later and address your comments.&lt;br/&gt;
Since the comments aren&apos;t regarding the core functionality of the patch, it is still helpful if people test the patch (and disables their settings in ant.properties while doing so) on their systems.&lt;/p&gt;</comment>
                            <comment id="12737508" author="kristwaa" created="Fri, 31 Jul 2009 13:23:50 +0100"  >&lt;p&gt;Patch 1b addresses Rick&apos;s comments.&lt;/p&gt;

&lt;p&gt;&amp;gt; o Class header for PropertySetter: In the third bullet, it&apos;s unclear whether version refers to the &quot;specification version&quot; or to the &quot;implementation version&quot;. I think the bullet means to say that for &lt;br/&gt;
each specification version (VM level), we pick the latest implementation version (release number) at that level, regardless of which vendor created the VM release.&lt;br/&gt;
Right.&lt;br/&gt;
Note that the algorithm for determining if a specific implementation version satisfies a given specification version is very simple: implVer.contains(specVer)&lt;/p&gt;

&lt;p&gt;I also added a warning message if the vendor is unknown, but we will continue and try to understand the JDK. I briefly tested it using Apache Harmony, and it printed the warning message and failed.&lt;br/&gt;
For unknown JDKs, I think we have two options (assuming we require &apos;java&apos;, &apos;java&apos; and a &apos;jre&apos;-library);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;search for all jar files under the jre-library&lt;/li&gt;
	&lt;li&gt;start the VM and extract the boot class path&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I tried the second approach with Apache Harmony, and it worked fine when it came to configuring the JDK. The build failed however. Is doing this too radical, and will it cause us more trouble than benefit?&lt;br/&gt;
For reference, below is the code I added:&lt;/p&gt;

&lt;p&gt;                // Last desperate attempt (require 1.5 or 1.6).&lt;br/&gt;
                String implVersion = getProperty(&quot;java.version&quot;);&lt;br/&gt;
                boolean is15 = isValidVersion(implVersion, &quot;1.5&quot;);&lt;br/&gt;
                boolean is16 = isValidVersion(implVersion, &quot;1.6&quot;);&lt;br/&gt;
                if (!(isSet(J15CLASSPATH) || isSet(J16CLASSPATH)) &amp;amp;&amp;amp;&lt;br/&gt;
                        (is15 || is16)) &lt;/p&gt;
{
                    // See if we can continue with just the unknown running
                    // JDK, from which we can obtain the boot classpath.
                    echo(&quot;WARNING: Using running unknown JDK.&quot;);
                    String bootClassPath = getProperty(&quot;vm.boot.class.path&quot;);
                    setProperty(is15 ? J15CLASSPATH : J16CLASSPATH,
                                bootClassPath);
                }


&lt;p&gt;Patch ready for another round of review, and testing.&lt;/p&gt;</comment>
                            <comment id="12737591" author="rhillegas" created="Fri, 31 Jul 2009 17:46:37 +0100"  >&lt;p&gt;Thanks for the new patch, Kristian. It addresses my previous concerns. I don&apos;t know how to answer the question you posed at the end of your last comment. It seems to me that we may have to log some experience with this approach before we form an opinion. Thanks.&lt;/p&gt;</comment>
                            <comment id="12740484" author="kristwaa" created="Fri, 7 Aug 2009 10:56:58 +0100"  >&lt;p&gt;Thanks, Rick.&lt;/p&gt;

&lt;p&gt;Committed patch 1b to trunk with revision 801924.&lt;br/&gt;
I&apos;m marking as fixed, but there is a chance the change will trigger problems for some people (depending on the JDKs they have installed). If so, please reopen or create a new issue (linking to this one).&lt;/p&gt;

&lt;p&gt;I chose to commit because the change will only affect developers (or those building Derby), and problems can be worked around by settings in ant.properties.&lt;/p&gt;</comment>
                            <comment id="12740900" author="myrna" created="Sat, 8 Aug 2009 16:29:31 +0100"  >&lt;p&gt;Apologies for not testing out the patch - I was on vacation when you first posted it and it escaped my attention.&lt;/p&gt;

&lt;p&gt;Since this change, I see 7 extra warnings in the output (with the actual path to the top of trunk replaced by &amp;lt;...mypath...&amp;gt;)&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; &amp;lt;...mypath...&amp;gt;\java\client\org\apache\derby\client\am\LogicalCallableStatement40.java:42: warning: &lt;span class=&quot;error&quot;&gt;&amp;#91;deprecation&amp;#93;&lt;/span&gt; setUnicodeStream(int,java.io.InputStream,int) in java.sql.PreparedStatement has been deprecated&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; public class LogicalCallableStatement40&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;        ^&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; &amp;lt;...mypath...&amp;gt;\java\client\org\apache\derby\client\am\LogicalCallableStatement40.java:42: warning: &lt;span class=&quot;error&quot;&gt;&amp;#91;deprecation&amp;#93;&lt;/span&gt; getBigDecimal(int,int) in java.sql.CallableStatement has been deprecated&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; public class LogicalCallableStatement40&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;        ^&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; &amp;lt;...mypath...&amp;gt;\java\client\org\apache\derby\client\am\LogicalCallableStatement40.java:42: warning: &lt;span class=&quot;error&quot;&gt;&amp;#91;deprecation&amp;#93;&lt;/span&gt; setUnicodeStream(int,java.io.InputStream,int) in java.sql.PreparedStatement has been deprecated&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; public class LogicalCallableStatement40&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;        ^&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; &amp;lt;...mypath...&amp;gt;\java\client\org\apache\derby\client\am\LogicalPreparedStatement40.java:41: warning: &lt;span class=&quot;error&quot;&gt;&amp;#91;deprecation&amp;#93;&lt;/span&gt; setUnicodeStream(int,java.io.InputStream,int) in java.sql.PreparedStatement has been deprecated&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; public class LogicalPreparedStatement40&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;        ^&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; &amp;lt;...mypath...&amp;gt;\java\client\org\apache\derby\client\am\LogicalCallableStatement40.java:42: warning: &lt;span class=&quot;error&quot;&gt;&amp;#91;deprecation&amp;#93;&lt;/span&gt; setUnicodeStream(int,java.io.InputStream,int) in java.sql.PreparedStatement has been deprecated&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; public class LogicalCallableStatement40&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;        ^&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; &amp;lt;...mypath...&amp;gt;\java\client\org\apache\derby\client\am\LogicalCallableStatement40.java:42: warning: &lt;span class=&quot;error&quot;&gt;&amp;#91;deprecation&amp;#93;&lt;/span&gt; getBigDecimal(int,int) in java.sql.CallableStatement has been deprecated&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; public class LogicalCallableStatement40&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;        ^&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; &amp;lt;...mypath...&amp;gt;\java\client\org\apache\derby\client\am\LogicalCallableStatement40.java:42: warning: &lt;span class=&quot;error&quot;&gt;&amp;#91;deprecation&amp;#93;&lt;/span&gt; setUnicodeStream(int,java.io.InputStream,int) in java.sql.PreparedStatement has been deprecated&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; public class LogicalCallableStatement40&lt;/p&gt;

&lt;p&gt;I assume this is ok, we knew of this, but it&apos;s odd that this pops up even though I&apos;m always running with -Ddeprecation=off, so I thought I&apos;d mention it.&lt;/p&gt;</comment>
                            <comment id="12740951" author="kristwaa" created="Sat, 8 Aug 2009 20:32:38 +0100"  >&lt;p&gt;Hi Myrna,&lt;/p&gt;

&lt;p&gt;Maybe you could run with -DprintCompilerProperties=true and post the output from the target setting the classpaths?&lt;br/&gt;
If you do that with trunk first, and then again after commenting out the lines mentioned below, we could compare and see what has changed. If it&apos;s the same, I must have changed something else in the build process.&lt;/p&gt;

&lt;p&gt;To go back to old behavior, assuming the required JDKs are available, comment out the calls to the method &apos;setForMostJDKsJARInspection&apos; (only two of the three should do, but commenting out all three doesn&apos;t hurt).&lt;br/&gt;
If you pipe to less, the interesting information should be found on the first page and onwards.&lt;/p&gt;</comment>
                            <comment id="12742541" author="myrna" created="Wed, 12 Aug 2009 20:36:56 +0100"  >&lt;p&gt;The difference was that after your change, it picked a Sun 1.6 instead of an IBM 1.6 jvm.&lt;/p&gt;

&lt;p&gt;The environment where I saw this was using a somewhat convoluted setup, building a number of things, not just derby. Building derby not directly but using ant from the command line, but from another build file, using ant call to the &apos;all&apos; target of the trunk&apos;s top level build.xml.&lt;br/&gt;
Properties are not set in ant.properties but are set in this &quot;wrapper&quot; build file.&lt;/p&gt;

&lt;p&gt;I need to go and revamp that build setup - there&apos;s some cleanup that can be done / is necessary...&lt;/p&gt;

&lt;p&gt;So it&apos;s ok.&lt;br/&gt;
However, I&apos;d not like this change to get backported.&lt;/p&gt;</comment>
                            <comment id="12742585" author="kristwaa" created="Wed, 12 Aug 2009 22:29:27 +0100"  >&lt;p&gt;Do you mind posting the list of the JVMs detected? (as printed by the build script when using printCompilerProperties=true)&lt;br/&gt;
I&apos;d like to understand why the IBM JDK that used to get picked, dosen&apos;t anymore. My only educated guess would be that the metadata extracted from the JARs is incorrect / inaccurate and that the Sun JDK you have installed has version number considered to be higher - but I&apos;d like to verify this. Of course, I&apos;m assuming the running JVM (used to invoke the build script) is a IBM one.&lt;/p&gt;

&lt;p&gt;I don&apos;t have any plans to backport this change.&lt;/p&gt;</comment>
                            <comment id="12742954" author="myrna" created="Thu, 13 Aug 2009 21:47:52 +0100"  >&lt;p&gt;Well, I needed to do the cleanup to figure out what was actually happening.&lt;/p&gt;

&lt;p&gt;So, there is one strange thing; it &lt;b&gt;is&lt;/b&gt; reporting this for my IBM 1.6 jvm (SR5 sdk, I&apos;ve got a couple of the same installs in different directories)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; found JDK: vendor=unknown, specVersion=unknown, implVersion=6.0, path=c:\jvms\ibm16&lt;/p&gt;

&lt;p&gt;While for the 1.5 ibm jvms it reports:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; found JDK: vendor=IBM Corporation, specVersion=1.5.0, implVersion=1.5.0, path=c:\jvms\ibm15&lt;/p&gt;

&lt;p&gt;Note, that if I just try to run my trusty, rusty program that spits out all properties set by the jvm, it reports &lt;br/&gt;
key: java.vm.vendor	;value: IBM Corporation&lt;br/&gt;
key: java.vendor	;value: IBM Corporation&lt;br/&gt;
key: java.specification.version	;value: 1.6&lt;br/&gt;
key: java.vm.specification.version	;value: 1.0&lt;br/&gt;
key: java.specification.name	;value: Java Platform API Specification&lt;/p&gt;

&lt;p&gt;My build was setup up without setting java16compile.classpath (to the ibm16 jars) before the change. If I physically  remove the sun jdk 1.6 I have, It does pick up the ibm jvm and my build works as before...(i.e. pick up the IBM 1.6 that&apos;s there).&lt;br/&gt;
If I set java16compileclasspath it also picks up the ibm16.&lt;br/&gt;
The sun 1.6 is &lt;span class=&quot;error&quot;&gt;&amp;#91;setJdkProperties&amp;#93;&lt;/span&gt; found JDK: vendor=Sun Microsystems, Inc., specVersion=1.6, implVersion=1.6.0_01, path=c:\jvmsjdk16&lt;br/&gt;
(java -version gives: java version &quot;1.6.0_01&quot;&lt;br/&gt;
                                    Java(TM) SE Runtime Environment (build 1.6.0_01-b06)&lt;br/&gt;
                                    Java HotSpot(TM) Client VM (build 1.6.0_01-b06, mixed mode) )&lt;/p&gt;

&lt;p&gt;A little debugging  and it seems the propertySetter thinks my (1.6) vendor is null.&lt;br/&gt;
I&apos;ll try to find some time to debug this further, figure out why.&lt;/p&gt;</comment>
                            <comment id="12744031" author="kristwaa" created="Mon, 17 Aug 2009 13:10:31 +0100"  >&lt;p&gt;Thanks, Myrna.&lt;/p&gt;

&lt;p&gt;I&apos;m on vacation right now, but will look more into this when I come back.&lt;br/&gt;
Note that the new algorithm relies on meta data recorded in the jar files of the JDK distribution - it doesn&apos;t actually start the VM to extract it.&lt;br/&gt;
We could do that, but I thought that will be more expensive than just doing a few file checks on the file system.&lt;/p&gt;

&lt;p&gt;My quick notes from the IBM JDKs:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;To pick IBM, you have to run IBM (as the VM invoking ant)&lt;/li&gt;
	&lt;li&gt;I didn&apos;t know exactly which JAR file(s) to check for the IBM JDKs, all I found had incomplete information (i.e. no vendor)&lt;/li&gt;
	&lt;li&gt;Versions differ (i.e. 1.6.0 vs 6.0).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It may be that the logic for IBM JDK 6 is simply broken, due to the missing vendor and the different version string.&lt;/p&gt;</comment>
                            <comment id="12744203" author="myrna" created="Mon, 17 Aug 2009 22:07:20 +0100"  >&lt;p&gt;I&apos;ve logged a complaint regarding the strange 1.6 (SR5) MANIFEST.MF file; in the mean time I&apos;ve got things working again, so I suggest we leave things as is for now.&lt;/p&gt;</comment>
                            <comment id="12856692" author="derbyuserciu" created="Wed, 14 Apr 2010 00:45:24 +0100"  >&lt;p&gt;I am facing a similar &quot;Ant Build Failed&quot; issue complaining that it does not know to set compiler15.classpath and compiler16.classpath using my environment. How do I apply the given patch?&lt;/p&gt;</comment>
                            <comment id="12856701" author="myrna" created="Wed, 14 Apr 2010 01:08:23 +0100"  >&lt;p&gt;The patch was committed and has been in the codeline for quite a while. (click on &apos;All&apos; or &apos;Subversion Commits&apos; in JIRA to see the commits).&lt;br/&gt;
And the final problem I saw (with the MANIFEST.MF file in IBM SR5) was fixed by IBM in the 1.6 SR7 point release.&lt;br/&gt;
Sounds like you are seeing a different problem. &lt;br/&gt;
I suggest you run read the BUILDING.html carefully, if that gives no ideas, run ant with -DprintCompilerProperties=true (or set printCompilerProperties=true in $HOME/ant.properties or &amp;lt;topoftree&amp;gt;/local.properties) and send an email to the derby dev list (derby-dev@db.apache.org) with the output.&lt;br/&gt;
JIRA is for bugs, sounds like you are only running into some setup hurdles.&lt;/p&gt;</comment>
                            <comment id="12856702" author="derbyuserciu" created="Wed, 14 Apr 2010 01:09:21 +0100"  >&lt;p&gt;Even after applying the patch 1b given here, I am getting the same&quot;Ant Build Failed error&quot;.  Is there any workaround please?&lt;/p&gt;</comment>
                            <comment id="13129969" author="rhillegas" created="Tue, 18 Oct 2011 20:29:58 +0100"  >&lt;p&gt;Early access JDKs are ignored by PropertySetter due to logic added by derby-4263-1b-jdk_detection_by_jars.diff patch (committed on 2009-08-07 at subversion revision 801924). What was the motivation for ignoring early access JDKs? Put another way, what would break if we removed the logic which ignores early access JDKs? Thanks-Rick&lt;/p&gt;</comment>
                            <comment id="13129984" author="kristwaa" created="Tue, 18 Oct 2011 20:57:43 +0100"  >&lt;p&gt;I think the only reason was to be cautious. Building Derby with an early access JDK could potentially introduce strange bugs.&lt;br/&gt;
Another minor point is that in general one wouldn&apos;t want to use an early access build over a know production quality build that&apos;s accessible on the system.&lt;/p&gt;

&lt;p&gt;Nothing in the build system should break if we allow early access JDKs, but if it does anyway it&apos;s probably because the early access build is too far away from production quality.&lt;/p&gt;

&lt;p&gt;Since I&apos;m assuming this question is raised due to the JDK 1.7 on Mac issue, I want to point out that fixing the early access build is only one of the steps required to be able to build with JDK 1.7 only (this goes for all platforms).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12411088" name="derby-4263-1a-jdk_detection_by_jars.diff" size="16156" author="kristwaa" created="Thu, 18 Jun 2009 16:24:54 +0100"/>
                            <attachment id="12415121" name="derby-4263-1b-jdk_detection_by_jars.diff" size="20322" author="kristwaa" created="Fri, 31 Jul 2009 13:23:50 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 18 Jun 2009 15:24:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24138</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0f47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36267</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>