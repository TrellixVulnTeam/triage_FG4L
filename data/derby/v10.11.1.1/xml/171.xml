<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:11:01 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-171/DERBY-171.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-171] Need Correlation ID in UPDATE/DELETE statements</title>
                <link>https://issues.apache.org/jira/browse/DERBY-171</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;You currently can&apos;t use a correlation ID in an UPDATE/DELETE statement. This makes it cumbersome to do the following:&lt;/p&gt;

&lt;p&gt;UPDATE EMPLOYEE_BONUS&lt;br/&gt;
  SET BONUS = (SELECT SUM(BONUSES.BONUS) FROM BONUSES WHERE &lt;br/&gt;
          EMPLOYEE_BONUS.EMPL_ID = BONUSES.EMPL_ID);&lt;/p&gt;

&lt;p&gt;The use of a correlation ID makes this easier to code.&lt;/p&gt;

&lt;p&gt;UPDATE EMPLOYEE E&lt;br/&gt;
  SET BONUS = (SELECT SUM(B.BONUS) FROM BONUSES B WHERE B.EMPL_ID = E.EMPL_ID);&lt;/p&gt;

&lt;p&gt;This is particularly important if you get carried away with long SCHEMA and TABLE names!&lt;/p&gt;
</description>
                <environment>Windows XP SP1 Professional</environment>
        <key id="30758">DERBY-171</key>
            <summary>Need Correlation ID in UPDATE/DELETE statements</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Rick Hillegas</assignee>
                                    <reporter username="baklarz">George Baklarz</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Mar 2005 01:39:06 +0000</created>
                <updated>Tue, 20 Mar 2007 21:53:58 +0000</updated>
                            <resolved>Thu, 11 Aug 2005 11:13:39 +0100</resolved>
                                    <version>10.1.2.1</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12317144" author="rhillegas" created="Fri, 29 Jul 2005 09:16:05 +0100"  >&lt;p&gt;Grabbing this bug.&lt;/p&gt;</comment>
                            <comment id="12317718" author="rhillegas" created="Fri, 5 Aug 2005 10:27:17 +0100"  >&lt;p&gt;I am attaching the subversion diffs for my fix to this bug: bug171.diff. I am also attaching a description of the changes which need to be made to the Derby Reference manual: bug171.html. This bugfix affects the following files:&lt;/p&gt;

&lt;p&gt;M      trunk\java\engine\org\apache\derby\impl\sql\compile\FromTable.java&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\FromSubquery.java&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\SelectNode.java&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\ResultColumn.java&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\DeleteNode.java&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\UpdateNode.java&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\FromList.java&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\FromBaseTable.java&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\CurrentOfNode.java&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\sqlgrammar.jj&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\ColumnReference.java&lt;br/&gt;
A      trunk\java\testing\org\apache\derbyTesting\functionTests\tests\lang\bug171.sql&lt;br/&gt;
M      trunk\java\testing\org\apache\derbyTesting\functionTests\tests\lang\refActions1.sql&lt;br/&gt;
M      trunk\java\testing\org\apache\derbyTesting\functionTests\tests\lang\copyfiles.ant&lt;br/&gt;
M      trunk\java\testing\org\apache\derbyTesting\functionTests\master\refActions1.out&lt;br/&gt;
A      trunk\java\testing\org\apache\derbyTesting\functionTests\master\bug171.out&lt;br/&gt;
M      trunk\java\testing\org\apache\derbyTesting\functionTests\suites\derbylang.runall&lt;/p&gt;

&lt;p&gt;I ran derbyall and it reported one failed test: NSinSameJVM. I am ignoring this failure because this test failed the same way on a clean snapshot of the repository before I made my changes.&lt;/p&gt;

&lt;p&gt;I have added a new regression test (lang/bug171.sql) to track this bugfix.&lt;/p&gt;

&lt;p&gt;I have added the optional correlation name clauses to the UPDATE and DELETE productions in the parser and added supporting bind-time logic. In addition to fixing this particular bug, I have significantly changed  the binding of correlated subqueries which have GROUP BY or HAVING clauses: I am now passing the outer fromList context down the subquery binding stack. This makes it possible to bind correlated references in those subqueries and fixes a cluster of other bugs. These other correlated subqueries were failing to compile because the bind logic did not match the way that the parser rewrites the query tree in these cases. I tripped across these problems in the lang/refActions1.sql regression test. I have extensively updated the canon for that test. Looking at the old canon, it appears to me that the old canon was riddled with incorrect results.&lt;/p&gt;</comment>
                            <comment id="12317795" author="rhillegas" created="Sat, 6 Aug 2005 00:58:00 +0100"  >&lt;p&gt;Bug 156 appears to be a duplicate of this bug and so should be satisfied by this bugfix.&lt;/p&gt;</comment>
                            <comment id="12318247" author="rhillegas" created="Wed, 10 Aug 2005 10:00:33 +0100"  >&lt;p&gt;Here are some responses to issues which Army raised while reviewing the first rev of this bugfix:&lt;/p&gt;

&lt;p&gt;1) This bugfix fixes some other, unlogged bugs. These are basically syntax errors raised by the parser when it encounters correlated references in subqueries which contain GROUP BY or HAVING clauses. The problem was that the parser does something clever. It takes advantage of the fact that the HAVING clause functions like a WHERE clause on the GROUP BY result. The parser then makes the GROUP BY result an outer query with the HAVING clause as its WHERE clause, and the parser then turns the rest of the SELECT into a subquery which feeds the GROUP BY outer query. However, the the binding logic for these rewritten GROUP BY results was not as clever as the parser. Subselects which had GROUP BY or HAVING clauses were not passed the list of correlated tables and so failed to bind correlated references. Perhaps an example would help:&lt;/p&gt;

&lt;p&gt;   select e.* from employee e&lt;br/&gt;
   where e.bonus &amp;lt;&lt;br/&gt;
   ( select b.bonus  from bonus b where b.empid=e.empid group by bonus having bonus &amp;gt; 3)&lt;/p&gt;

&lt;p&gt;In this case, the query would be rewritten to have 3 rather than 2 levels. The outer level would remain like the original. But the subselect would be rewritten to have its own outer select, consisting of the GROUP BY and HAVING clauses and an inner select consisting of the SELECT B.BONUS. In binding this query,  level 1 would pass its correlated from list down to level 2, but level 2 would not pass the list on to level 3. However, level 3 needs the correleted from list in order to resolve b.empid=e.empid.&lt;/p&gt;

&lt;p&gt;2) This bugfix changes some queries in refActions1.sql. These are queries which used to raise syntax errors.because of the bugs mentioned in (1) above. I first changed these queries by qualifying some dangling references with correlation names. I did this to prove that the syntax errors were not being caused by ambiguity. I verified that the changed queries continued to raise the same syntax errors. Then I fixed the bugs mentioned in (1) above. Most of the queries then successfully compiled. What did the authors of this test hope  to demonstrate? It&apos;s hard to say since the comments indicate that these statements are supposed to both be correlated and to complete successfully but, of course, they didn&apos;t. complete. The changed queries satisfy the minimal contract in the comments: the statements have correlated references and they complete successfully. Do these changes mask other bugs? Possibly. Were those other bugs disclosed by the previous state of the test? No,  The changed queries at least track something useful now: syntax that is supposed to compile. I think this is an improvement.&lt;/p&gt;</comment>
                            <comment id="12318328" author="rhillegas" created="Wed, 10 Aug 2005 23:53:02 +0100"  >&lt;p&gt;Second rev of bugfix. Incorporates Army&apos;s feedback: 1) Removes FromBaseTable.java, which had a vacuous diff, 2) Moves regression tests into update.sql and delete.sql.&lt;/p&gt;</comment>
                            <comment id="12318330" author="rhillegas" created="Wed, 10 Aug 2005 23:55:21 +0100"  >&lt;p&gt;I&apos;ve attached a new rev of the bugfix which addresses Army&apos;s concerns. The contents are:&lt;/p&gt;

&lt;p&gt;M      trunk\java\engine\org\apache\derby\impl\sql\compile\FromTable.java&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\FromSubquery.java&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\SelectNode.java&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\ResultColumn.java&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\DeleteNode.java&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\UpdateNode.java&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\FromList.java&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\CurrentOfNode.java&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\sqlgrammar.jj&lt;br/&gt;
M      trunk\java\engine\org\apache\derby\impl\sql\compile\ColumnReference.java&lt;br/&gt;
M      trunk\java\testing\org\apache\derbyTesting\functionTests\tests\lang\delete.sql&lt;br/&gt;
M      trunk\java\testing\org\apache\derbyTesting\functionTests\tests\lang\update.sql&lt;br/&gt;
M      trunk\java\testing\org\apache\derbyTesting\functionTests\tests\lang\refActions1.sql&lt;br/&gt;
M      trunk\java\testing\org\apache\derbyTesting\functionTests\master\delete.out&lt;br/&gt;
M      trunk\java\testing\org\apache\derbyTesting\functionTests\master\update.out&lt;br/&gt;
M      trunk\java\testing\org\apache\derbyTesting\functionTests\master\refActions1.out&lt;/p&gt;</comment>
                            <comment id="12318426" author="davidvc" created="Thu, 11 Aug 2005 11:13:39 +0100"  >&lt;p&gt;Patch built successfully, derbyall passed.  Committed changes, revision 231366&lt;/p&gt;</comment>
                            <comment id="12329465" author="djd" created="Fri, 16 Sep 2005 05:05:39 +0100"  >&lt;p&gt;This was marked as fixed in 10.1.2, but the change was made to the trunk after 10.1 branch was created so the correct checkin is 10.2.0.0. Since this is an improvement and changes the syntax, I do not believe it is suitable for merging into the 10.1 branch.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="30510">DERBY-156</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12311669" name="bug171.diff" size="76720" author="rhillegas" created="Wed, 10 Aug 2005 23:53:02 +0100"/>
                            <attachment id="12311572" name="bug171.html" size="924" author="rhillegas" created="Fri, 5 Aug 2005 10:27:17 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 29 Jul 2005 08:16:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29421</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy130n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40139</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>