<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:34:06 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4549/DERBY-4549.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4549] NPE in JBitSet</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4549</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>
&lt;p&gt;A NPE occurs at org.apache.derby.iapi.util.JBitSet.or().&lt;/p&gt;

&lt;p&gt;A NPE occured at the same location before: &lt;a href=&quot;http://issues.apache.org/jira/browse/DERBY-1574&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/DERBY-1574&lt;/a&gt;&lt;br/&gt;
The bug was confirmed by Bryan Pendleton to show in the HEAD as well: &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/db-derby-user/201002.mbox/%3C4B79F74E.1000005@amberpoint.com%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/db-derby-user/201002.mbox/%3C4B79F74E.1000005@amberpoint.com%3E&lt;/a&gt;&lt;/p&gt;



&lt;p&gt;To reproduce:&lt;br/&gt;
----------------------&lt;/p&gt;

&lt;p&gt;CREATE TABLE ABC (ID int PRIMARY KEY NOT NULL);&lt;br/&gt;
CREATE TABLE DEF (ID int PRIMARY KEY NOT NULL);&lt;/p&gt;

&lt;p&gt;SELECT * &lt;br/&gt;
FROM ABC t1&lt;br/&gt;
WHERE (SELECT DISTINCT t2.ID FROM DEF t2) &lt;br/&gt;
        IN (SELECT t3.ID FROM DEF t3) &lt;/p&gt;

&lt;p&gt;----------------------&lt;/p&gt;

&lt;p&gt;Leads to &lt;/p&gt;

&lt;p&gt;error message: &lt;br/&gt;
Error: DERBY SQL error: SQLCODE: -1, SQLSTATE: XJ001, SQLERRMC: java.lang.NullPointerExceptionXJ001.U&lt;br/&gt;
SQLState:  XJ001&lt;br/&gt;
ErrorCode: -1&lt;/p&gt;

&lt;p&gt;Stacktrace:&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.iapi.util.JBitSet.or(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.OptimizerImpl.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.Level2OptimizerImpl.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.Level2OptimizerFactoryImpl.getOptimizerImpl(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.OptimizerFactoryImpl.getOptimizer(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ResultSetNode.getOptimizer(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.SelectNode.optimize(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.SubqueryNode.optimize(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.SubqueryList.optimize(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.SelectNode.optimize(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.DMLStatementNode.optimizeStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.CursorNode.optimizeStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement40.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAStatement.prepare(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAStatement.explicitPrepare(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.parsePRPSQLSTT(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)&lt;br/&gt;
Cleanup action completed&lt;/p&gt;</description>
                <environment></environment>
        <key id="12456398">DERBY-4549</key>
            <summary>NPE in JBitSet</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="jmc7479">Murat Knecht</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Feb 2010 09:24:58 +0000</created>
                <updated>Mon, 17 Jun 2013 10:19:35 +0100</updated>
                            <resolved>Thu, 18 Feb 2010 10:36:46 +0000</resolved>
                                    <version>10.3.1.4</version>
                    <version>10.5.3.0</version>
                    <version>10.6.1.0</version>
                                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12834137" author="kristwaa" created="Tue, 16 Feb 2010 09:37:49 +0000"  >&lt;p&gt;Ran repro on trunk, which also has the bug. Stack trace with line numbers below:&lt;/p&gt;

&lt;p&gt;ERROR XJ001: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
[ snip ]&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.iapi.util.JBitSet.or(JBitSet.java:241)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ReferencedTablesVisitor.visit(ReferencedTablesVisitor.java:77)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.QueryTreeNode.accept(QueryTreeNode.java:735)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.SubqueryNode.acceptChildren(SubqueryNode.java:2294)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.QueryTreeNode.accept(QueryTreeNode.java:738)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ValueNode.getTablesReferenced(ValueNode.java:790)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.BinaryRelationalOperatorNode.selfComparison(BinaryRelationalOperatorNode.java:531)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.BinaryRelationalOperatorNode.optimizableEqualityNode(BinaryRelationalOperatorNode.java:1400)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.PredicateList.hasOptimizableEqualityPredicate(PredicateList.java:389)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.FromBaseTable.isOneRowResultSet(FromBaseTable.java:4432)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.FromBaseTable.isOneRowResultSet(FromBaseTable.java:3864)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.FromBaseTable.nextAccessPath(FromBaseTable.java:441)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ProjectRestrictNode.nextAccessPath(ProjectRestrictNode.java:188)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.OptimizerImpl.getNextDecoratedPermutation(OptimizerImpl.java:1551)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.SelectNode.optimize(SelectNode.java:1912)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.DMLStatementNode.optimizeStatement(DMLStatementNode.java:315)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.CursorNode.optimizeStatement(CursorNode.java:558)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:381)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:90)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:828)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:606)&lt;br/&gt;
	... 14 more&lt;/p&gt;</comment>
                            <comment id="12834189" author="jmc7479" created="Tue, 16 Feb 2010 12:42:02 +0000"  >&lt;p&gt;Confirmed bug for version 10.3.1.4 and added it as &quot;affected&quot;.&lt;/p&gt;</comment>
                            <comment id="12834190" author="knutanders" created="Tue, 16 Feb 2010 12:43:53 +0000"  >&lt;p&gt;It looks like the problem is very similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1574&quot; title=&quot;NullPointerException in UPDATE with COALESCE and subquery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1574&quot;&gt;&lt;del&gt;DERBY-1574&lt;/del&gt;&lt;/a&gt;, only that in this case it&apos;s SubqueryNode that forgets to call preprocess() recursively on leftOperand. The attached patch (preprocess.diff) makes the NPE go away, and all the lang tests ran cleanly with it.&lt;/p&gt;</comment>
                            <comment id="12834715" author="knutanders" created="Wed, 17 Feb 2010 10:03:23 +0000"  >&lt;p&gt;Attaching an updated patch which includes a test case. All the regression tests ran cleanly with the patch.&lt;/p&gt;</comment>
                            <comment id="12834785" author="bryanpendleton" created="Wed, 17 Feb 2010 14:47:58 +0000"  >&lt;p&gt;The patch looks good to me. I agree with your analysis the that missing preprocess() call is the cause.&lt;/p&gt;

&lt;p&gt;+1 to commit.&lt;/p&gt;</comment>
                            <comment id="12835161" author="knutanders" created="Thu, 18 Feb 2010 10:36:46 +0000"  >&lt;p&gt;Thanks for looking at the patch, Bryan!&lt;br/&gt;
Committed revision 911315.&lt;/p&gt;

&lt;p&gt;I think this fix is a candidate for back-porting to 10.5. Will do that in a couple of days if it doesn&apos;t cause any problems in the nightly regression tests.&lt;/p&gt;</comment>
                            <comment id="12838792" author="knutanders" created="Fri, 26 Feb 2010 09:51:27 +0000"  >&lt;p&gt;Merged fix to 10.5 and committed revision 916631.&lt;/p&gt;</comment>
                            <comment id="13685292" author="knutanders" created="Mon, 17 Jun 2013 10:19:35 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12346494">DERBY-1574</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12436093" name="d4549-1a.diff" size="3426" author="knutanders" created="Wed, 17 Feb 2010 10:03:23 +0000"/>
                            <attachment id="12435972" name="preprocess.diff" size="686" author="knutanders" created="Tue, 16 Feb 2010 12:43:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10421"><![CDATA[Seen in production]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 16 Feb 2010 09:37:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24332</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0r1r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38200</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10051"><![CDATA[Urgent]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>