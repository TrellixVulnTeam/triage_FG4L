<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:29:37 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2008/DERBY-2008.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2008] NullPointerException with LTRIM, RTRIM and 2-argument SUBSTR() call in GROUP BY clause.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2008</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The following query, which fails with a syntax error in 10.1.3 (because functions are not allowed in a GROUP BY expression for 10.1) fails with a NullPointerException in 10.2 and in the codeline (10.3):&lt;/p&gt;

&lt;p&gt;create table dt (vc varchar(30)); &lt;br/&gt;
insert into dt values (&apos;1928-09-21&apos;), (&apos;1903-12-08&apos;); &lt;br/&gt;
select substr(vc, 3) from dt group by substr(vc, 3); &lt;/p&gt;

&lt;p&gt;Result (on trunk) is:&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.TernaryOperatorNode.isEquivalent(TernaryOperatorNode.java:924)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.GroupByList.findGroupingColumn(GroupByList.java:244)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.VerifyAggregateExpressionsVisitor.skipChildren(VerifyAggregateExpressionsVisitor.java:146)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.TernaryOperatorNode.accept(TernaryOperatorNode.java:497)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ResultColumn.accept(ResultColumn.java:1515)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.QueryTreeNodeVector.accept(QueryTreeNodeVector.java:159)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.SelectNode.bindExpressions(SelectNode.java:619)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.FromSubquery.bindExpressions(FromSubquery.java:262)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.FromList.bindExpressions(FromList.java:337)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.SelectNode.bindExpressions(SelectNode.java:500)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.DMLStatementNode.bindExpressions(DMLStatementNode.java:249)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.DMLStatementNode.bind(DMLStatementNode.java:162)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.CursorNode.bind(CursorNode.java:253)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:345)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:119)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:745)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:568)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:517)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12354083">DERBY-2008</key>
            <summary>NullPointerException with LTRIM, RTRIM and 2-argument SUBSTR() call in GROUP BY clause.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yipng">Yip Ng</assignee>
                                    <reporter username="army">A B</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Oct 2006 23:30:28 +0100</created>
                <updated>Wed, 21 Feb 2007 18:57:32 +0000</updated>
                            <resolved>Sat, 28 Oct 2006 17:15:29 +0100</resolved>
                                    <version>10.2.1.6</version>
                    <version>10.3.1.4</version>
                                    <fixVersion>10.2.2.0</fixVersion>
                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12445101" author="yipng" created="Fri, 27 Oct 2006 08:14:07 +0100"  >&lt;p&gt;Attaching patch derby2008-trunk-diff01.txt for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2008&quot; title=&quot;NullPointerException with LTRIM, RTRIM and 2-argument SUBSTR() call in GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2008&quot;&gt;&lt;del&gt;DERBY-2008&lt;/del&gt;&lt;/a&gt;.  For SUBSTR function, there can be 2 or 3 arguments, and in the case of 2-args, the rightOperand of the TernaryOperatorNode will be null.  In its isEquivalent() method, it did not take care of this case; thus, the NPE.  derbyall + junit suite pass.  &lt;/p&gt;</comment>
                            <comment id="12445255" author="yipng" created="Fri, 27 Oct 2006 20:12:48 +0100"  >&lt;p&gt;Patch available for review.  &lt;span class=&quot;error&quot;&gt;&amp;#91;Testing jira email&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="12445316" author="bryanpendleton" created="Sat, 28 Oct 2006 02:23:56 +0100"  >&lt;p&gt;Thanks for the patch, Yip! It looks good to me. The code change is clear and&lt;br/&gt;
well-commented. The new test cases fail without the code change, and they&lt;br/&gt;
pass once the code change is applied. Your explanation of the problem makes sense.&lt;/p&gt;

&lt;p&gt;I intend to commit this patch tomorrow. If anybody else is reviewing it, please let us know.&lt;/p&gt;</comment>
                            <comment id="12445387" author="bryanpendleton" created="Sat, 28 Oct 2006 17:13:45 +0100"  >&lt;p&gt;Hi Yip, I was just wondering: I see that TernaryOperatorNode is used for a few&lt;br/&gt;
other cases, besides just SUBSTR:  TRIM, LOCATE, LIKE, TIMESTAMPADD, &lt;br/&gt;
and TIMESTAMPDIFF all seem to be TernaryOperatorNodes.&lt;/p&gt;

&lt;p&gt;How does your patch affect the behavior of these functions? &lt;/p&gt;

&lt;p&gt;I suppose that if it had any affect at all, it would be to prevent similar NPE bugs&lt;br/&gt;
when one of these functions was used in an way which provoked an isEquivalent()&lt;br/&gt;
call for a case where the RHS of the Ternary was NULL.&lt;/p&gt;

&lt;p&gt;I think the patch is fine, I&apos;m just wondering whether it fixes any more problems&lt;br/&gt;
than just the SUBSTR-in-a-GROUP-BY case that is noted in the description.&lt;/p&gt;</comment>
                            <comment id="12445388" author="bryanpendleton" created="Sat, 28 Oct 2006 17:15:29 +0100"  >&lt;p&gt;Committed derby2008-trunk-diff01.txt to subversion as revision 468696.&lt;/p&gt;</comment>
                            <comment id="12445396" author="yipng" created="Sat, 28 Oct 2006 19:44:44 +0100"  >&lt;p&gt;Thanks Bryan for the review.  I am trying out other functions/expression with group by currently to see if other problems arise.  I found another problem with NULLIF and I have filed a jira issue(&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2014&quot; title=&quot;NullPointerException with NULLIF in GROUP BY clause&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2014&quot;&gt;&lt;del&gt;DERBY-2014&lt;/del&gt;&lt;/a&gt;) for this.  If I find more problems, I&apos;ll just generalize that jira entry with group by expression in general.&lt;/p&gt;</comment>
                            <comment id="12445465" author="yipng" created="Sun, 29 Oct 2006 22:12:23 +0000"  >&lt;p&gt;Hi Bryan, besides the SUBSTR function, the patch also fixes NPE for the trim functions (LTRIM, RTRIM).&lt;/p&gt;

&lt;p&gt;In 10.2:&lt;br/&gt;
ij&amp;gt; create table t1 (c1 char(10));&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t1 values &apos;123&apos;, &apos;abc&apos;;&lt;br/&gt;
2 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; select rtrim(c1) from t1 group by rtrim(c1);&lt;br/&gt;
ERROR XJ001: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
...&lt;br/&gt;
ij&amp;gt; select ltrim(c1) from t1 group by ltrim(c1);&lt;br/&gt;
ERROR XJ001: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;/p&gt;

&lt;p&gt;From what I see from the sqlgrammar.jj file, the other functions seem to have the third argument filled with a non-null value when its node is constructed, so the NPE won&apos;t occur in those cases.  I&apos;ll add the trim functions testcases in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2014&quot; title=&quot;NullPointerException with NULLIF in GROUP BY clause&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2014&quot;&gt;&lt;del&gt;DERBY-2014&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12445473" author="yipng" created="Sun, 29 Oct 2006 22:59:37 +0000"  >&lt;p&gt;Interesting.  This executed successfully due to the fact that the third parameter&apos;s is supplied with a value of  1 implicitly if the argument is not specified.&lt;/p&gt;

&lt;p&gt;ij&amp;gt; create table t1 (c1 varchar(10));&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t1 values &apos;abc&apos;, &apos;123&apos;;&lt;br/&gt;
2 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; select  locate(c1, &apos;abc&apos;) from t1 group by locate(c1, &apos;abc&apos;, 1);&lt;br/&gt;
1&lt;br/&gt;
-----------&lt;br/&gt;
0&lt;br/&gt;
1&lt;/p&gt;

&lt;p&gt;2 rows selected&lt;/p&gt;


</comment>
                            <comment id="12454131" author="rhillegas" created="Tue, 28 Nov 2006 21:42:51 +0000"  >&lt;p&gt;Ported to 10.2 branch at subversion revision 480219.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12328186">DERBY-883</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12343753" name="derby2008-trunk-diff01.txt" size="3516" author="yipng" created="Fri, 27 Oct 2006 08:14:07 +0100"/>
                            <attachment id="12343752" name="derby2008-trunk-stat01.txt" size="335" author="yipng" created="Fri, 27 Oct 2006 08:14:07 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 27 Oct 2006 07:14:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22833</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy139r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40180</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>