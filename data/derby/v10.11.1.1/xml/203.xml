<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:23:17 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-203/DERBY-203.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-203] setNull(x,JDBCType.DATE) does not work when batching is turned on</title>
                <link>https://issues.apache.org/jira/browse/DERBY-203</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Trying to execute batch on which setNull(x,DATE) was called gives the following exception:&lt;br/&gt;
SQL Exception: An attempt was made to get a data value of type &apos;DATE&apos; from a data value of type &apos;null&apos;.&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.newSQLException(EmbedConnection.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.ConnectionChild.newSQLException(ConnectionChild.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.dataTypeConversion(EmbedPreparedStatement.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.setObject(EmbedPreparedStatement.java)&lt;br/&gt;
        at org.apache.derby.iapi.types.DataType.setInto(DataType.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeBatchElement(EmbedPreparedStatement.java)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedStatement.executeBatch(EmbedStatement.java)&lt;br/&gt;
        at net.sf.hibernate.impl.BatchingBatcher.doExecuteBatch(BatchingBatcher.java:54)&lt;/p&gt;

&lt;p&gt;DATE column is nullable in db schema, so it should pass there ok. I believe the problem is in org.apache.derby.iapi.types.SQLDate, which does not implement setInto method, so DataType.setInto method is executed, calling setObject(x,null). setObject thinks this is JDBC spec violation and fails on exception.&lt;/p&gt;

&lt;p&gt;Problem exists in both 10.0.2.1 and 10.0.2.0&lt;/p&gt;</description>
                <environment>------------------ Java Information ------------------&lt;br/&gt;
Java Version:    1.4.2_07&lt;br/&gt;
Java Vendor:     Sun Microsystems Inc.&lt;br/&gt;
Java home:       /usr/local/java/j2sdk1.4.2_07/jre&lt;br/&gt;
Java classpath:  /home/oleg/prg/cs/lib/derby.jar:/home/oleg/prg/cs/lib/derbytools.jar:&lt;br/&gt;
OS name:         Linux&lt;br/&gt;
OS architecture: i386&lt;br/&gt;
OS version:      2.6.8.1-24mdk&lt;br/&gt;
Java user name:  oleg&lt;br/&gt;
Java user home:  /home/oleg&lt;br/&gt;
Java user dir:   /usr/local/home/oleg/prg/cs/frameworks/embedded/bin&lt;br/&gt;
--------- Derby Information --------&lt;br/&gt;
[/usr/local/home/oleg/prg/cs/lib/derby.jar] 10.0.2.0 - (30301)&lt;br/&gt;
[/usr/local/home/oleg/prg/cs/lib/derbytools.jar] 10.0.2.0 - (30301)&lt;br/&gt;
------------------------------------------------------&lt;br/&gt;
----------------- Locale Information -----------------&lt;br/&gt;
------------------------------------------------------&lt;br/&gt;
</environment>
        <key id="31564">DERBY-203</key>
            <summary>setNull(x,JDBCType.DATE) does not work when batching is turned on</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shreyas">Shreyas Kaushik</assignee>
                                    <reporter username="m0nstermind">Oleg Anastasyev</reporter>
                        <labels>
                    </labels>
                <created>Sat, 9 Apr 2005 21:53:12 +0100</created>
                <updated>Sat, 8 Jul 2006 11:01:22 +0100</updated>
                            <resolved>Wed, 25 May 2005 17:53:04 +0100</resolved>
                                    <version>10.0.2.1</version>
                                    <fixVersion>10.1.1.0</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="63028" author="shreyas" created="Mon, 18 Apr 2005 16:58:22 +0100"  >&lt;p&gt;I had fixed smilar problem with Blob and Timestamp. I will look into this and other types with which this problem can arise.&lt;/p&gt;</comment>
                            <comment id="64245" author="shreyas" created="Mon, 2 May 2005 20:35:18 +0100"  >&lt;p&gt;Test changes for parameterMapping.java&lt;/p&gt;</comment>
                            <comment id="64246" author="shreyas" created="Mon, 2 May 2005 20:36:16 +0100"  >&lt;p&gt;The output file after running test parameterMapping.java&lt;/p&gt;</comment>
                            <comment id="64247" author="shreyas" created="Mon, 2 May 2005 20:47:43 +0100"  >&lt;p&gt;  I have attached the changes I did to parameterMapping.java and the output I got. It is slightly tricky to figure out the failures when they occur for certain datatypes with the setNull method with batching turned on.&lt;/p&gt;

&lt;p&gt;  Firstly, I want to confirm the addition I did to the test is fine. If the additions are fine then I can start to figuring out which tests failed ( with batching turned on ) but are supposed to pass. The only way I found was comparing the output, the addition to the test case produces with the output got when batching is not performed, i.e comparing the output of executeUpdate() with executeBatch().&lt;/p&gt;

&lt;p&gt;  A peek into the output file I have attached will give a clearer picture of what I am trying to say. Correct me if I am wrong or suggest a better way to detect failures than what I am doing.&lt;/p&gt;</comment>
                            <comment id="65174" author="djd" created="Fri, 13 May 2005 05:25:23 +0100"  >&lt;p&gt;Changes to the test look good, and your method for finding which are right/wrong is correct.&lt;br/&gt;
I would advise that a good thing to do once you have fixed this issue is to then perform a similar test modification for setting a valid value and using batching.&lt;/p&gt;</comment>
                            <comment id="65598" author="shreyas" created="Tue, 17 May 2005 20:56:54 +0100"  >&lt;p&gt;     I have attached the latest test diff and test output file.&lt;/p&gt;

&lt;p&gt;      I feel with this issue we should fix the setNull aspect related to batching. For testing the batching with a valid value I can raise a new JIRA issue for that and then build on  parameterMapping.java to test batching with valid values.&lt;/p&gt;
</comment>
                            <comment id="65856" author="djd" created="Fri, 20 May 2005 23:31:02 +0100"  >&lt;p&gt;Patch committed - svn revision 171115&lt;/p&gt;

&lt;p&gt;Use explicit setXXX methods for binary, DATE and TIME types when setting&lt;br/&gt;
a DataValueDescriptor into a PreparedStatement. Replaced the use of setObject&lt;br/&gt;
for these types which lead to un-typed NULLs being set into a PreparedStatement.&lt;/p&gt;

&lt;p&gt;Patch contributed by Shreyas Kaushik &amp;lt;Shreyas.Kaushik@Sun.COM&amp;gt;&lt;/p&gt;</comment>
                            <comment id="66244" author="shreyas" created="Wed, 25 May 2005 17:52:59 +0100"  >&lt;p&gt;Fixed, as the earlier comment says&lt;/p&gt;</comment>
                            <comment id="66245" author="shreyas" created="Wed, 25 May 2005 17:54:18 +0100"  >&lt;p&gt;Patch submitted&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="20117" name="parameterMapping.diff" size="24453" author="shreyas" created="Tue, 17 May 2005 20:51:28 +0100"/>
                            <attachment id="20116" name="parameterMapping.out" size="147934" author="shreyas" created="Tue, 17 May 2005 20:47:24 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 18 Apr 2005 15:58:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21834</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy15uf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40597</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>