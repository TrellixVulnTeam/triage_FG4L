<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:24:25 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5391/DERBY-5391.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5391] The syscs_diag.error_log_reader() and syscs_diag.statement_duration() vtis do not work on derby error logs created since 10.7.1</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5391</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The format of timestamps in Derby logs seems to have changed. As a result, the ErrorLogReader vti can&apos;t parse the text of derby.log. That vti is looking for the literal string &quot;GMT&quot; in order to locate timestamps.&lt;/p&gt;

&lt;p&gt;To reproduce the problem, run ij with -Dderby.language.logStatementText=true and issue the following query:&lt;/p&gt;

&lt;p&gt;  select * from table (syscs_diag.error_log_reader( )) as t1;&lt;/p&gt;

&lt;p&gt;You will get an empty result.&lt;/p&gt;

&lt;p&gt;This regression was not caught by our tests because SysDiagVTIMappingTest uses a hardcoded derby.log created by version &quot;10.3.0.0 alpha&quot;.&lt;/p&gt;

&lt;p&gt;The same problem seems to have broken the statement duration vti too. The following query returns an empty result from 10.7 onward:&lt;/p&gt;

&lt;p&gt;  select * from table (syscs_diag.statement_duration()) as t1;&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12520243">DERBY-5391</key>
            <summary>The syscs_diag.error_log_reader() and syscs_diag.statement_duration() vtis do not work on derby error logs created since 10.7.1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Rick Hillegas</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Aug 2011 14:15:28 +0100</created>
                <updated>Fri, 14 Jun 2013 18:22:42 +0100</updated>
                            <resolved>Tue, 30 Aug 2011 20:46:09 +0100</resolved>
                                    <version>10.7.1.1</version>
                    <version>10.8.1.2</version>
                    <version>10.9.1.0</version>
                                    <fixVersion>10.7.1.4</fixVersion>
                    <fixVersion>10.8.2.2</fixVersion>
                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13091826" author="rhillegas" created="Fri, 26 Aug 2011 16:29:10 +0100"  >&lt;p&gt;Linking this issue to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4752&quot; title=&quot;CheapDateFormatter returns incorrect and invalid date strings&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4752&quot;&gt;&lt;del&gt;DERBY-4752&lt;/del&gt;&lt;/a&gt;. The formatting of timestamps in the log is handled by BasicGetLogHeaderWriter.getHeader(). The formatting was changed in revision 988874 as part of the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4752&quot; title=&quot;CheapDateFormatter returns incorrect and invalid date strings&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4752&quot;&gt;&lt;del&gt;DERBY-4752&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13091839" author="rhillegas" created="Fri, 26 Aug 2011 16:52:37 +0100"  >&lt;p&gt;Attaching derby-5391-01-aa-fixErrorLogReader.diff. This is the first rev of a fix for the ErrorLogReader problem. This fixes the vti so that it can handle the new and the old timestamp formats. I haven&apos;t run any regression tests against this patch. Just a proof-of-concept.&lt;/p&gt;</comment>
                            <comment id="13091930" author="rhillegas" created="Fri, 26 Aug 2011 19:25:24 +0100"  >&lt;p&gt;Attaching derby-5391-01-ac-fixErrorLogReaderAndStatementDuration.diff. I have not run the full regression suite yet. To prevent this kind of regression from creeping in again, I think that we need to add a test case which runs these vtis against the current shape of derby.log, not just a canned derby.log from an old release.&lt;/p&gt;

&lt;p&gt;The preceding rev of the patch fixed the error log vti. This rev of the patch also fixes the statement duration vti.&lt;/p&gt;

&lt;p&gt;In addition, this patch adjusts the existing regression test to account for the following behavioral change: The first varchar column of these vtis gives a string rendering of the timestamp. When run against old (pre-10.7) error logs, the leading column of these vtis now includes the GMT timezone indicator which appears in the log.&lt;/p&gt;

&lt;p&gt;To summarize the formatting change of that first column:&lt;/p&gt;

&lt;p&gt;1) Before 10.7, that column looked like this:&lt;/p&gt;

&lt;p&gt;2006-12-15 16:14:58.280&lt;/p&gt;

&lt;p&gt;2) Now, when you run these vtis on pre-10.7 logs, the column looks like this:&lt;/p&gt;

&lt;p&gt;2006-12-15 16:14:58.280 GMT&lt;/p&gt;

&lt;p&gt;3) And, when you run these vtis on 10.7 (or later) logs, the column looks like this:&lt;/p&gt;

&lt;p&gt;Fri Aug 26 10:53:23 PDT 2011&lt;/p&gt;


&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;--------&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/diag/StatementDuration.java&lt;br/&gt;
M      java/engine/org/apache/derby/diag/ErrorLogReader.java&lt;/p&gt;

&lt;p&gt;Fixes to the vtis.&lt;/p&gt;

&lt;p&gt;--------&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/lang/SysDiagVTIMappingTest.java&lt;/p&gt;

&lt;p&gt;Fix to the existing regression test.&lt;/p&gt;</comment>
                            <comment id="13091969" author="rhillegas" created="Fri, 26 Aug 2011 20:27:12 +0100"  >&lt;p&gt;Attaching derby-5391-01-ad-fixErrorLogReaderAndStatementDuration.diff. This rev of the patch includes a test case which runs the vtis against a current derby.log. This should help prevent these vtis from breaking if we change the format of logged timestamps again. I will run the full regression suite against this version of the patch. It is ready for review. Thanks.&lt;/p&gt;

&lt;p&gt;Touches the same files as the previous rev.&lt;/p&gt;</comment>
                            <comment id="13092863" author="rhillegas" created="Mon, 29 Aug 2011 15:32:45 +0100"  >&lt;p&gt;Regression tests passed cleanly for me on derby-5391-01-ad-fixErrorLogReaderAndStatementDuration.diff. Committed to trunk at subversion revision 1162827. Ported to 10.8 branch at subversion revision 1162832.&lt;/p&gt;</comment>
                            <comment id="13094027" author="rhillegas" created="Tue, 30 Aug 2011 20:42:19 +0100"  >&lt;p&gt;Ported 1162827 from trunk to the 10.7 branch at subversion revision 1163355.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12523205">DERBY-5414</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12469809">DERBY-4752</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12491800" name="derby-5391-01-aa-fixErrorLogReader.diff" size="2466" author="rhillegas" created="Fri, 26 Aug 2011 16:52:37 +0100"/>
                            <attachment id="12491820" name="derby-5391-01-ac-fixErrorLogReaderAndStatementDuration.diff" size="9087" author="rhillegas" created="Fri, 26 Aug 2011 19:25:24 +0100"/>
                            <attachment id="12491824" name="derby-5391-01-ad-fixErrorLogReaderAndStatementDuration.diff" size="12147" author="rhillegas" created="Fri, 26 Aug 2011 20:27:12 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24813</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0e3r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36103</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>